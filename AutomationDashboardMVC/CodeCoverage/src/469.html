<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Construction Vertical\Main Modules\Estimator\UI\Unitpricesearch.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Configuration;
using System.Data;
using System.Drawing;
using System.Globalization;
using System.IO;
using System.Reflection;
using System.Text;
using System.Web.Configuration;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core.IntegrationConnector;
using Aurigo.AMP3.Core.UserControls;
using Aurigo.AMP3.EstimatorBL;
using Aurigo.AMP3.EstimatorDTO;
using Aurigo.AMP3.Logging;
using Aurigo.AMP3.Resources.MessageResources;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.Brix.Core.WebUiHelper;
using Aurigo.Brix.Platform.BusinessLayer.BL;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Infragistics.WebUI.UltraWebGrid;
using System.Linq;
using System.Web;
using Aurigo.AMP3.Core.AbstractModels;
using System.Collections;
using Aurigo.Brix.Platform.BusinessLayer.UserControls;
using Aurigo.Brix.Platform.BusinessLayer.AbstractModels;
using Infragistics.WebUI.WebDataInput;
using Aurigo.Brix.Platform.BusinessLayer.Utility;

namespace Aurigo.AMP3.EstimatorUI
{
    public partial class Unitpricesearch : BrixPageBase, IXMLControl
    {
        protected ModalPopupExtender PopupExtender;
        protected ModalPopupExtender SubPopupExtender;
        protected global::Aurigo.Brix.Platform.BusinessLayer.UserControls.PickerGrid pickerContractors;
        protected global::Aurigo.Brix.Platform.BusinessLayer.UserControls.PickerGrid pickerItemNo;
        protected global::Aurigo.Brix.Platform.BusinessLayer.UserControls.PickerGrid pickerItemDesc;
        private DataTable dtUnitPriceSearch;
        private int nSearchPagerSize = 8;
        private double pageCount;
        private StateManagementBase pageState;
        private int projectID;
        private double recordCount;
        private readonly List&lt;MenuGroup&gt; menuGroups = new List&lt;MenuGroup&gt;();

        #region Enumerators

        #region Nested type: BidStatus

        private enum BidStatus
        {
            Rejected = -1,
            Accepted,
            Awarded,
        }

        #endregion

        #region Nested type: Operator

        private enum Operator : byte
        {
            NoOperator = 1,
            EqualTo,
            GreaterThan,
            LessThan,
            GreaterThanEqualTo,
            LessThanEqualTo,
            Between
        }

        #endregion

        #region Nested type: Search

        private enum Search : byte
        {
            EngineerEstimate = 1
        }

        #endregion

        #endregion

        protected override void OnInit(EventArgs e)
        {
            PermissionsToCheck.Add(Constants.MODFEAT_VISIBILITY);

            ((PagerControl)mypager).ItemClicked += HandlePagerEvent;
            mypager.EnableViewState = true;

            ((PagerControl)myProjectPager).ItemClicked += HandleProjectPagerEvent;
            myProjectPager.EnableViewState = true;

            PopupExtender.AddNewPopup(aspPnlProjects.ClientID, btnProjects.ClientID, btnGhostCancel.ClientID, 450, 500, &quot;Projects List&quot;);

            SubPopupExtender.Visible = true;
            SubPopupExtender.AddNewPopup(aspPnlFilter.ClientID, lblProjFilter.ClientID, btnCancel.ClientID, 250, 400);

            grdProjectList.DisplayLayout.StationaryMargins = StationaryMargins.Header;

            InitializePicker(&quot;Contractors&quot;);
            InitializePicker(&quot;ItemDesc&quot;);
            InitializePicker(&quot;ItemNo&quot;);
            base.OnInit(e);
        }

        private void InitializePicker(string type)
        {

            string json = &quot;{&quot;;
            json += &quot;\&quot;pickerType\&quot; : \&quot;&quot; + type + &quot;\&quot;&quot;;
            json += &quot;}&quot;;

            switch (type)
            {
                case &quot;Contractors&quot;:
                    pickerContractors.InitializePicker(&quot;/api/Estimator&quot;, GetPickerColumns(type), &quot;ID&quot;);
                    pickerContractors.TriggerButton.Style.Add(HtmlTextWriterStyle.Display, &quot;none&quot;);
                    pickerContractors.EnableMultiSelect = false;
                    pickerContractors.AfterPickerSelectScript = &quot;AddSelectedContractor({0})&quot;;
                    pickerContractors.Title = &quot;Contractors List&quot;;
                    btnContractor.OnClientClick = &quot;return openPickerPopUp(&#39;&quot; + pickerContractors.TriggerButton.ClientID + &quot;&#39;);&quot;;
                    pickerContractors.OptionalParamaters = pickerContractors.BuildOptionalParameters(json);

                    break;
                case &quot;ItemDesc&quot;:
                    pickerItemDesc.InitializePicker(&quot;/api/Estimator&quot;, GetPickerColumns(type), &quot;RowNum&quot;);
                    pickerItemDesc.TriggerButton.Style.Add(HtmlTextWriterStyle.Display, &quot;none&quot;);
                    pickerItemDesc.EnableMultiSelect = false;
                    pickerItemDesc.AfterPickerSelectScript = &quot;AddSelectedItems({0},&#39;&quot; + type + &quot;&#39;)&quot;;
                    pickerItemDesc.Title = &quot;Standard Items&quot;;
                    btnItemDescription.OnClientClick = &quot;return openPickerPopUp(&#39;&quot; + pickerItemDesc.TriggerButton.ClientID + &quot;&#39;);&quot;;
                    pickerItemDesc.OptionalParamaters = pickerItemDesc.BuildOptionalParameters(json);
                    break;
                case &quot;ItemNo&quot;:
                    pickerItemNo.InitializePicker(&quot;/api/Estimator&quot;, GetPickerColumns(type), &quot;RowNum&quot;);
                    pickerItemNo.TriggerButton.Style.Add(HtmlTextWriterStyle.Display, &quot;none&quot;);
                    pickerItemNo.EnableMultiSelect = false;
                    pickerItemNo.AfterPickerSelectScript = &quot;AddSelectedItems({0},&#39;&quot; + type + &quot;&#39;)&quot;;
                    pickerItemNo.Title = &quot;Standard Items&quot;;
                    btnPayG.OnClientClick = &quot;return openPickerPopUp(&#39;&quot; + pickerItemNo.TriggerButton.ClientID + &quot;&#39;);&quot;;
                    pickerItemNo.OptionalParamaters = pickerItemNo.BuildOptionalParameters(json);
                    break;
            }
        }


        private List&lt;PickerColumnDetails&gt; GetPickerColumns(string type)
        {

            List&lt;PickerColumnDetails&gt; gridColumns = new List&lt;PickerColumnDetails&gt;();
            List&lt;string&gt; allColumns = null;
            Dictionary&lt;string, string&gt; visibleColumns = null;
            switch (type)
            {
                case &quot;Contractors&quot;:
                    allColumns = new List&lt;string&gt;() {&quot;RecordID&quot;, &quot;Name&quot;, &quot;Contact&quot;, &quot;ID&quot; ,&quot;PhoneNo&quot;, &quot;FaxNo&quot;, &quot;EmailID&quot;,&quot;Address1&quot;,
            &quot;Address2&quot;, &quot;Address3&quot;,&quot;City&quot;, &quot;State&quot;,&quot;ZipCode&quot;,&quot;Type&quot;,&quot;RowNum&quot;};

                    visibleColumns = new Dictionary&lt;string, string&gt;();
                    visibleColumns.Add(&quot;Name&quot;, &quot;Name&quot;);
                    visibleColumns.Add(&quot;Contact&quot;, &quot;Contact&quot;);
                    visibleColumns.Add(&quot;ID&quot;, &quot;Contractor ID&quot;);
                    visibleColumns.Add(&quot;PhoneNo&quot;, &quot;Phone&quot;);
                    visibleColumns.Add(&quot;Address1&quot;, &quot;Address 1&quot;);
                    visibleColumns.Add(&quot;Address2&quot;, &quot;Address 2&quot;);
                    visibleColumns.Add(&quot;Address3&quot;, &quot;Address 3&quot;);
                    visibleColumns.Add(&quot;City&quot;, &quot;City&quot;);
                    visibleColumns.Add(&quot;State&quot;, &quot;State&quot;);
                    visibleColumns.Add(&quot;ZipCode&quot;, &quot;ZipCode&quot;);
                    visibleColumns.Add(&quot;FaxNo&quot;, &quot;Fax&quot;);
                    visibleColumns.Add(&quot;EmailID&quot;, &quot;Email&quot;);
                    visibleColumns.Add(&quot;Type&quot;, &quot;Contract Type&quot;);

                    foreach (string col in allColumns)
                    {
                        if (!visibleColumns.ContainsKey(col))
                        {
                            PickerColumnDetails tCol = new PickerColumnDetails { Caption = col, ColumnName = col, Hidden = true };
                            gridColumns.Add(tCol);
                        }
                        else
                        {
                            PickerColumnDetails tCol = new PickerColumnDetails { Caption = visibleColumns[col], ColumnName = col, Hidden = false, Width = 200, Type = &quot;string&quot; };
                            gridColumns.Add(tCol);
                        }
                    }
                    break;
                case &quot;ItemDesc&quot;:
                case &quot;ItemNo&quot;:
                    allColumns = new List&lt;string&gt;() { &quot;StandardTableName&quot;, &quot;StandardItemNo&quot;, &quot;Description&quot;, &quot;Unit&quot;, &quot;AccountingCode&quot;, &quot;RowNum&quot; };

                    visibleColumns = new Dictionary&lt;string, string&gt;();
                    visibleColumns.Add(&quot;StandardTableName&quot;, &quot;Standard Table Name&quot;);
                    visibleColumns.Add(&quot;StandardItemNo&quot;, &quot;Standard Item No&quot;);
                    visibleColumns.Add(&quot;Description&quot;, &quot;Description&quot;);
                    visibleColumns.Add(&quot;Unit&quot;, &quot;Unit&quot;);

                    foreach (string col in allColumns)
                    {
                        if (!visibleColumns.ContainsKey(col))
                        {
                            PickerColumnDetails tCol = new PickerColumnDetails { Caption = col, ColumnName = col, Hidden = true };
                            gridColumns.Add(tCol);
                        }
                        else
                        {
                            PickerColumnDetails tCol = new PickerColumnDetails { Caption = visibleColumns[col], ColumnName = col, Hidden = false, Width = 200, Type = &quot;string&quot; };
                            gridColumns.Add(tCol);
                        }
                    }
                    break;
            }

            return gridColumns;
        }


        public void HandlePagerEvent(object sender, ItemClickEventArgs e)
        {
            grdSearchResults.DisplayLayout.Pager.CurrentPageIndex = 1;
            int startIdx = ((HtmlInputHidden)mypager.FindControl(&quot;currentPage&quot;)).Value.ToInt32_2() - 1;
            startIdx = 1 + (nSearchPagerSize * startIdx);
            GenerateAndExecuteSQL(startIdx, nSearchPagerSize, false);
            BindGridControl();
        }

        protected void Page_Load(object sender, EventArgs e)
        {
            try
            {
                UIHelper.DisableRoleSelection(Page);

                if (!string.IsNullOrEmpty(Request[&quot;HideToolBar&quot;]) &amp;&amp; Request[&quot;HideToolBar&quot;].ToLower().Equals(&quot;true&quot;))
                {
                    ClientScript.RegisterClientScriptInclude(&quot;UnitPriceSearchScript&quot;, VirtualPathUtility.ToAbsolute(&quot;~/Modules/ESTMATE/Scripts/UnitPriceSearch_20140410_1600.js&quot;));
                    MainToolBar.Visible = PageTabBar.Visible = false;
                    btnAddtoUnitPrice.OnClientClick = string.Format(&quot;return CloseUnitPriceWindow(&#39;{0}&#39;,&#39;{1}&#39;);&quot;, Request[&quot;ItemID&quot;], txtFinalAvg.ClientID);
                }
                else
                    btnAddtoUnitPrice.OnClientClick = &quot;return setItemUP();&quot;;

                // Getting the projectID from the querystring
                if (String.IsNullOrEmpty(Request.QueryString.Get(EstimatorConstants.PID)) ||
                    !int.TryParse(Request.QueryString.Get(EstimatorConstants.PID), out projectID))
                    UIHelper.RedirectURL(&quot;Error loading the requested page.&quot;, ResolveUrl(Constants.URL_PROJECTS), null, Context);

                if (rdProjectAll.Checked)
                    txtProjects.Text = String.Empty;
                if (!IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX))
                {
                    hdnIsERP.Value = &quot;0&quot;;
                    trERPCurrency.Visible = false;
                }
                //Setting Localised strings
                SetLocalizedStrings();

                if (!Page.IsPostBack)
                {
                    wdt1.Value = wdt2.Value = MWDateTimeHelper.MWToday;
                    var item = new ListItem(&quot;All&quot;, &quot;&quot;);
                    DataTable uPSMeasureUnits = EstimateManager.Instance.GetUPSMeasureUnits();
                    if (uPSMeasureUnits.Rows.Count &gt; 0)
                    {
                        cboUnits.DataSource = uPSMeasureUnits;
                        cboUnits.DataTextField = cboUnits.DataValueField = &quot;Unit&quot;;
                        cboUnits.DataBind();
                    }
                    cboUnits.Items.Insert(0, item);

                    mypager.Visible = false;

                    string text = base.Request.QueryString.Get(&quot;Type&quot;);
                    ViewState[&quot;HideChkBox&quot;] = base.Request.QueryString.Get(&quot;Type&quot;);
                    trBack.Style.Add(HtmlTextWriterStyle.Display, &quot;none&quot;);
                    if (text == &quot;Item&quot; || text == &quot;ItemEdit&quot;)
                    {
                        hfItemEdit.Value = text;
                        btnAddtoUnitPrice.Visible = tdFinalAvg.Visible = txtFinalAvg.Visible = true;
                        if (!string.IsNullOrEmpty(Request[&quot;ItemDesc&quot;]))
                            txtItemDesc.Text = &quot;\&quot;&quot; + HttpUtility.UrlDecode(Request[&quot;ItemDesc&quot;].ToString()).Replace(&quot;__and__&quot;, &quot;&amp;&quot;) + &quot;\&quot;&quot;;
                    }
                    else if (text == &quot;PayItem&quot;)
                    {
                        hfItemEdit.Value = text;
                        btnAddtoUnitPrice.Visible = tdFinalAvg.Visible = txtFinalAvg.Visible = true;
                        if (!string.IsNullOrEmpty(Request[&quot;PayItemNo&quot;]))
                            txtPayNo.Text = &quot;\&quot;&quot; + HttpUtility.UrlDecode(Request[&quot;PayItemNo&quot;].ToString()).Replace(&quot;__and__&quot;, &quot;&amp;&quot;) + &quot;\&quot;&quot;;
                    }
                    else if (text == &quot;Workbook&quot;)
                        btnAddtoWorkbook.Visible = true;

                    hfsearchType.Value = &quot;1&quot;;
                    grdSearchResults.Visible = false;

                    // BIND ERP CURRENCY VALUES
                    BindERPCurrencies();
                }
                else
                {
                    var @operator = (Operator)cboUnitPrice.Value.ToByte2();
                    divwne1.Style.Add(HtmlTextWriterStyle.Display, (@operator == Operator.NoOperator) ? &quot;none&quot; : &quot;block&quot;);
                    divwne2.Style.Add(HtmlTextWriterStyle.Display, (@operator == Operator.Between) ? &quot;block&quot; : &quot;none&quot;);
                    var operator2 = (Operator)((byte)cboQuantity.Value.ToInt32_2());
                    divwne3.Style.Add(HtmlTextWriterStyle.Display, (operator2 == Operator.NoOperator) ? &quot;none&quot; : &quot;block&quot;);
                    divwne4.Style.Add(HtmlTextWriterStyle.Display, (operator2 == Operator.Between) ? &quot;block&quot; : &quot;none&quot;);
                    var operator3 = (Operator)((byte)cboDateCreated.Value.ToInt32_2());
                    div5.Style.Add(HtmlTextWriterStyle.Display, (operator3 == Operator.NoOperator) ? &quot;none&quot; : &quot;block&quot;);
                    div6.Style.Add(HtmlTextWriterStyle.Display, (operator3 == Operator.Between) ? &quot;block&quot; : &quot;none&quot;);
                }

                ProjectODS();

                ApplyFormat(wnePrice1, AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE);
                ApplyFormat(wneQuantity1, AMP3ApplicationSettings.Instance.FORMAT_QUANTITY);
                ApplyFormat(wnePrice2, AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE);
                ApplyFormat(wneQuantity2, AMP3ApplicationSettings.Instance.FORMAT_QUANTITY);

            }
            catch (Exception exception)
            {
                Logger.Log(Enumerations.LogType.Error, exception.Message, &quot;ESTMATE&quot;);
            }
        }

        private void ApplyFormat(WebNumericEdit wne, string format)
        {
            NumberFormatInfo nfi = new NumberFormatInfo();
            nfi = (NumberFormatInfo)wne.NumberFormat.Clone();
            nfi.NumberDecimalDigits = CoreDatabaseHelper.GetDigitsAfterDecimal(format);
            wne.NumberFormat = nfi;
        }

        private void ApplyLocalization(string currency)
        {
            tdLow.InnerText = &quot;Low in &quot; + currency + &quot; : &quot;;
            ;
            tdHigh.InnerText = &quot;High in &quot; + currency + &quot; : &quot;;
            ;
            tdWAAvg.InnerText = &quot;Weighted Average in &quot; + currency + &quot; : &quot;;
            tdAvgUP.InnerText = &quot;Average Unit Price in &quot; + currency + &quot; :&quot;;
            tdFinalAvg.InnerText = &quot;Unit Price in &quot; + currency + &quot; : &quot;;
            ColumnsCollection cols = grdSearchResults.Columns;
            if (cols.Exists(&quot;Unit Price&quot;))
                cols.FromKey(&quot;Unit Price&quot;).Header.Caption = &quot;Unit Price in &quot; + currency;
            if (cols.Exists(&quot;Amount&quot;))
                cols.FromKey(&quot;Amount&quot;).Header.Caption = &quot;Amount in &quot; + currency;
        }

        private void BindERPCurrencies()
        {
            var dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
            dictAdditionalInfo.Add(RegisteredEIS.AX,
                                   new EISAdditionalInfo(RegisteredEIS.AX).AddInfo(&quot;AXCompany&quot;,
                                                                                   Session[&quot;AXCompany&quot;].ToString2()));
            var ConnectorParameters =
                new ConnectorParameters(dictAdditionalInfo, MethodBase.GetCurrentMethod(),
                                        AMP3ObjectType.Unknown, null, null);
            DataSet ds = new BrixDataSet();
            int count = 0;
            if (IntegrationConnectorManager.HandleIntegration(ConnectorParameters, ref count, ref ds, true))
            {
                ddlERPCurrency.DataSource = ds.Tables[0];
                ddlERPCurrency.DataTextField = &quot;Currency Code&quot;;
                ddlERPCurrency.DataValueField = &quot;Currency Code&quot;;
                ddlERPCurrency.DataBind();
            }
        }


        private void SetLocalizedStrings()
        {
            hdnItem.Value = ItemNameAbbr;
        }

        private void GenerateAndExecuteSQL(int startRowIdx, int maxRows, bool getCount)
        {
            string queryForResult = string.Empty;
            string queryForSummary = string.Empty;
            grdSearchResults.Visible = true;

            Dictionary&lt;string, Type&gt; modelObjects = CustomizePageModel.GetModelObjects().Where(x =&gt; x.Key.ToUpper2() == &quot;UNITPRICESEARCH&quot;).ToDictionary(x =&gt; x.Key, x =&gt; x.Value);
            Dictionary&lt;string, object&gt; data = null;
            foreach (KeyValuePair&lt;string, Type&gt; kvp in modelObjects)
            {
                CustomizePageModel cpm = CustomizePageModel.GetInstance(kvp.Key);
                if (cpm != null)
                {
                    Dictionary&lt;string, int&gt; additionalParameters = new Dictionary&lt;string, int&gt;();
                    additionalParameters.Add(&quot;StartRowIdx&quot;, startRowIdx);
                    additionalParameters.Add(&quot;MaxRows&quot;, maxRows);
                    data = cpm.GetData(this.Page, mode: &quot;GetSql&quot;, callerContext: &quot;UnitPriceSearch&quot;, additionalParameters: additionalParameters);
                    queryForResult = data[&quot;SqlForResult&quot;].ToString();
                    queryForSummary = data[&quot;SqlForSummary&quot;].ToString();
                }
            }

            if (queryForResult == string.Empty)
            {
                queryForResult = (new UnitPriceSearchModel()).GetSqlForResult(this, startRowIdx, maxRows);
            }
            if (queryForSummary == string.Empty)
            {
                queryForSummary = (new UnitPriceSearchModel()).GetSqlForSummary(this, startRowIdx, maxRows);
            }

            Session[&quot;FinalQuery&quot;] = queryForResult;

            if (!getCount)
            {
                dtUnitPriceSearch = EstimateManager.Instance.UnitPriceSearch(queryForResult);
                mypager.Visible = true;
            }
            else
            {
                DataTable dtResultSet = EstimateManager.Instance.UnitPriceSearch(queryForSummary);
                if (dtResultSet.Rows.Count &gt; 0)
                {
                    DataRow row = dtResultSet.Rows[0];
                    grdSearchResults.DisplayLayout.Pager.PageSize = nSearchPagerSize;
                    pageCount = Math.Ceiling((row[&quot;cnt&quot;].ToDouble2() / nSearchPagerSize));
                    ViewState[&quot;PageCount&quot;] = pageCount;
                    ViewState[&quot;recordcount&quot;] = recordCount;
                    if (row[&quot;cnt&quot;] != null)
                        recordCount = row[&quot;cnt&quot;].ToDouble2();
                    divMetrics.Visible = true;

                    lblAverage.Text = row[&quot;AvgUP&quot;].ToDecimal2().ToString(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT,
                                                                         CultureInfo.CurrentCulture);
                    decimal num2 = row[&quot;smUP&quot;].ToString2().ToDecimal2();
                    lblWA.Text =
                        ((row[&quot;Quantity&quot;].ToDecimal2() == 0M)
                             ? 0M
                             : Math.Round((row[&quot;smAmt&quot;].ToDecimal2() / row[&quot;Quantity&quot;].ToDecimal2()), 4)).ToString(
                                 AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture);
                    ;
                    txtFinalAvg.Text =
                        ((row[&quot;Quantity&quot;].ToDecimal2() == 0M)
                             ? 0M
                             : Math.Round((row[&quot;smAmt&quot;].ToDecimal2() / row[&quot;Quantity&quot;].ToDecimal2()), 4)).ToString(
                                 AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture);
                    ;
                    lblHigh.Text = row[&quot;MaxUP&quot;].ToDecimal2().ToString(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT,
                                                                      CultureInfo.CurrentCulture);
                    ;
                    lblLow.Text = row[&quot;MinUP&quot;].ToDecimal2().ToString(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture);
                    ;
                }
            }
        }

        protected void btnSearch_Click(object sender, EventArgs e)
        {
            try
            {
                if (rdProject.Checked.Equals(true))
                {
                    trProjectSpecific.Style.Value = &quot;display:table-row;&quot;;
                    if (string.IsNullOrEmpty(txtProjects.Text))
                    {
                        trERPCurrency.Style.Value = &quot;display:table-row&quot;;
                        if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX))
                            ScriptManager.RegisterStartupScript(this, GetType(), &quot;4&quot;,
                                                                &quot;ShowError(&#39;Project is not specified. Please select a currency for the unit price search for all projects.&#39;);&quot;,
                                                                true);
                        else
                            ScriptManager.RegisterStartupScript(this, GetType(), &quot;4&quot;,
                                                                &quot;ShowError(&#39;Project is not specified.&#39;);&quot;, true);
                        return;
                    }
                }
                GenerateAndExecuteSQL(0, 0, true);
                grdSearchResults.DisplayLayout.Pager.PageSize = nSearchPagerSize;
                ((HtmlInputHidden)mypager.FindControl(&quot;pageCount&quot;)).Value =
                    recordCount &gt; nSearchPagerSize ? pageCount.ToString2() : recordCount &gt; 0 ? &quot;1&quot; : &quot;0&quot;;
                GenerateAndExecuteSQL(1, nSearchPagerSize, false);
                ((HtmlInputHidden)mypager.FindControl(&quot;currentPage&quot;)).Value = dtUnitPriceSearch.Rows.Count &gt; 0
                                                                                   ? &quot;1&quot;
                                                                                   : &quot;0&quot;;

                UltraGridLayout uglSearchResult = grdSearchResults.DisplayLayout;
                uglSearchResult.FrameStyle.Height = Unit.Percentage(100);
                uglSearchResult.Pager.PagerStyle.CustomRules = &quot;display:none&quot;;

                grdSearchResults.DataSource = dtUnitPriceSearch;
                grdSearchResults.DataBind();

                ViewState.Remove(&quot;PagerState&quot;);
                ColumnsCollection cols = grdSearchResults.DisplayLayout.Bands[0].Columns;

                if (cols.Exists(&quot;Unit Price&quot;))
                    cols.FromKey(&quot;Unit Price&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;
                if (cols.Exists(&quot;Quantity&quot;))
                    cols.FromKey(&quot;Quantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                if (cols.Exists(&quot;Amount&quot;))
                    cols.FromKey(&quot;Amount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                if (cols.Exists(&quot;RowNum&quot;))
                    cols.FromKey(&quot;RowNum&quot;).Hidden = true;
                if (cols.Exists(&quot;ERPCurrency&quot;))
                    cols.FromKey(&quot;ERPCurrency&quot;).Hidden = true;

                if (cols.Exists(&quot;Item Description&quot;))
                    cols.FromKey(&quot;Item Description&quot;).Header.Caption = &quot;ItemDescription&quot;;

                if (cols.Exists(&quot;CreatedDate&quot;))
                {
                    cols.FromKey(&quot;CreatedDate&quot;).Header.Caption = &quot;Created On&quot;;
                    cols.FromKey(&quot;CreatedDate&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_DATE;
                    if (cols.Exists(&quot;Estimate ID&quot;))
                        cols.FromKey(&quot;CreatedDate&quot;).Move(grdSearchResults.Columns.FromKey(&quot;Estimate ID&quot;).Index + 1);
                }

                cols.FromKey(&quot;To&quot;).Hidden = (ViewState[&quot;HideChkBox&quot;] != null &amp;&amp;
                                             ViewState[&quot;HideChkBox&quot;].ToString2() == &quot;Workbook&quot;)
                                                ? false
                                                : true;

                //SET LOCALIZATION FOR THE SELECTED ERP CURRENCY
                string currency = &quot;&quot;;
                if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX))
                {
                    if (rdProjectAll.Checked)
                        currency = ddlERPCurrency.SelectedValue.ToString2();
                    else
                        currency = LocalizationManager.GetModuleCurrency(&quot;PROJECT&quot;, hdnSearchProjectID.Value,
                                                                         Session[Constants.EIS_ADDITIONAL_INFO].
                                                                             ToString2());
                    ApplyLocalization(currency);
                }
                trERPCurrency.Style.Value = &quot;display:table-row&quot;;

                if (dtUnitPriceSearch.Rows.Count &gt; 0)
                    mypager.Visible = true;

                foreach (UltraGridColumn col in cols)
                {
                    col.HTMLEncodeContent = true;
                }

                setPagerProperties();
            }
            catch (Exception Ex)
            {
                Logger.Log(Enumerations.LogType.Error, Ex.Message, EstimatorConstants.ESTIMATOR);
                hfPrice.Value = hfQuantity.Value = hfProjEstimateId.Value = &quot;&quot;;
                hfsearchType.Value = &quot;1&quot;;
            }
        }

        protected void btnReset_Click(object sender, EventArgs e)
        {
            try
            {
                txtItemDesc.Text =
                    txtContractor.Text =
                    txtPayNo.Text =
                    txtProjectName.Text =
                    txtProjects.Text = String.Empty;
                wnePrice1.Value = wnePrice2.Value = wneQuantity1.Value = wneQuantity2.Value = &quot;&quot;;
                cboQuantity.Value = cboUnitPrice.Value = &quot;1&quot;;
                cboUnits.SelectedIndex = 0;
                cboSearchType.Value = &quot;2&quot;;
                divwne1.Style.Add(HtmlTextWriterStyle.Display, &quot;none&quot;);
                divwne2.Style.Add(HtmlTextWriterStyle.Display, &quot;none&quot;);
                divwne3.Style.Add(HtmlTextWriterStyle.Display, &quot;none&quot;);
                divwne4.Style.Add(HtmlTextWriterStyle.Display, &quot;none&quot;);
                hfUnit.Value = hfPrice.Value = hfQuantity.Value = hfProjEstimateId.Value = String.Empty;
                hfsearchType.Value = &quot;1&quot;;
                grdSearchResults.Rows.Clear();
                lblAverage.Text = lblLow.Text = lblWA.Text = lblHigh.Text = string.Empty;
                ViewState.Remove(&quot;PagerState&quot;);
                ((PagerControl)mypager).Set_Page(0, 0);
                txtProjects.Text = String.Empty;
                cboUnits.SelectedIndex = 0;
            }
            catch (Exception Ex)
            {
                Logger.Log(Enumerations.LogType.Error, Ex.Message, EstimatorConstants.ESTIMATOR);
            }
        }


        protected void btnAddtoWorkbook_Click(object sender, EventArgs e)
        {
            DataSet dsWrkDetails = new BrixDataSet();
            DataTable dtWrkbook = new BrixDataTable();

            dtWrkbook.Columns.Add(&quot;EstimateId&quot;, Type.GetType(EstimatorConstants.SYS_DATA_TYPE_STRING));
            dtWrkbook.Columns.Add(&quot;ItemID&quot;, Type.GetType(EstimatorConstants.SYS_DATA_TYPE_INT32));
            dtWrkbook.Columns.Add(&quot;ItemDescription&quot;, Type.GetType(EstimatorConstants.SYS_DATA_TYPE_STRING));
            dtWrkbook.Columns.Add(&quot;ItemQuantity&quot;, Type.GetType(EstimatorConstants.SYS_DATA_TYPE_DOUBLE));
            dtWrkbook.Columns.Add(&quot;Unit&quot;, Type.GetType(EstimatorConstants.SYS_DATA_TYPE_STRING));
            dtWrkbook.Columns.Add(&quot;UnitPrice&quot;, Type.GetType(EstimatorConstants.SYS_DATA_TYPE_DOUBLE));
            dtWrkbook.Columns.Add(&quot;ContractorNum&quot;, Type.GetType(EstimatorConstants.SYS_DATA_TYPE_STRING));
            dtWrkbook.Columns.Add(&quot;ContractorName&quot;, Type.GetType(EstimatorConstants.SYS_DATA_TYPE_STRING));
            dtWrkbook.Columns.Add(&quot;Amount&quot;, Type.GetType(EstimatorConstants.SYS_DATA_TYPE_DOUBLE));

            dsWrkDetails.Tables.Add(dtWrkbook);

            int wrkCount = 0;
            DataRow row;
            for (int i = 0; i &lt; grdSearchResults.Rows.Count; i++)
            {
                if (grdSearchResults.Rows[i].Cells[0].Value.ToString2().ToLower2() == &quot;true&quot;)
                {
                    row = dsWrkDetails.Tables[0].NewRow();
                    row[&quot;EstimateId&quot;] = grdSearchResults.Rows[i].Cells.FromKey(&quot;Estimate ID&quot;).Value.ToString2();
                    row[&quot;ItemID&quot;] = Session[&quot;ItemID&quot;].ToInt32_2();
                    row[&quot;ItemDescription&quot;] =
                        grdSearchResults.Rows[i].Cells.FromKey(&quot;Item Description&quot;).Value.ToString2();
                    row[&quot;ItemQuantity&quot;] =
                        grdSearchResults.Rows[i].Cells.FromKey(&quot;Quantity&quot;).Value.ToString2().ToDouble2();
                    row[&quot;Unit&quot;] = grdSearchResults.Rows[i].Cells.FromKey(&quot;Unit&quot;).Value.ToString2();
                    row[&quot;UnitPrice&quot;] =
                        grdSearchResults.Rows[i].Cells.FromKey(&quot;Unit Price&quot;).Value.ToString2().ToDouble2();
                    row[&quot;ContractorNum&quot;] = grdSearchResults.Rows[i].Cells.FromKey(&quot;Contractor ID&quot;).Value.ToString2();
                    row[&quot;ContractorName&quot;] = grdSearchResults.Rows[i].Cells.FromKey(&quot;Contractor Name&quot;).Value.ToString2();
                    row[&quot;Amount&quot;] = grdSearchResults.Rows[i].Cells.FromKey(&quot;Amount&quot;).Value.ToString2().ToDouble2();

                    dsWrkDetails.Tables[0].Rows.Add(row);

                    wrkCount++;
                }
            }

            if (grdSearchResults.Rows.Count &gt; 0)
            {
                Response.Redirect(
                    &quot;EstimateItems.aspx?Type=E&amp;&quot; + EstimatorConstants.PID + &quot;=&quot; + projectID.ToString2() + &quot;&amp;fromups=Y&quot;,
                    false);
                EstimateManager.Instance.AddToWorkbook(Session[&quot;ItemID&quot;].ToInt32_2(), dsWrkDetails.GetXml());
            }
        }

        protected override void CreateChildControls()
        {
            try
            {
                if (Request[&quot;UnitPriceSearch&quot;] != null)
                {
                    MenuGroup generalGroup = new MenuGroup(&quot;General&quot;);
                    generalGroup.AddMenu(new TextIcon(&quot;lnkBack&quot;, &quot;Back&quot;, &quot;Icn_Back_16.png&quot;));
                    menuGroups.Add(generalGroup);
                    CreateToolBarMenu(menuGroups, null);
                }
            }
            catch { }
        }

        protected override void CustomizeToolBar()
        {
            if (MainToolBar.GetMenuReference(&quot;lnkBack&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkBack&quot;).CausesValidation = false;
                MainToolBar.GetMenuReference(&quot;lnkBack&quot;).Click += lnkBack_Click;
            }
            //itemModel.CustomizeToolBar(MainToolBar);
        }

        protected void lnkBack_Click(object sender, EventArgs e)
        {
            if (hfItemEdit.Value == EstimatorConstants.ESTMATE_ITEMEDIT)
                Response.Redirect(
                    &quot;EstimateItems.aspx?Type=E&amp;&quot; + EstimatorConstants.PID + &quot;=&quot; + projectID.ToString2() + &quot;&amp;fromups=Y&quot;,
                    false);
            else if (btnAddtoUnitPrice.Visible)
            {
                string strReorderQS = string.Empty;
                if (!string.IsNullOrEmpty(Request.QueryString[&quot;Reorder&quot;]) &amp;&amp; Request.QueryString[&quot;Reorder&quot;] == &quot;1&quot;)
                {
                    strReorderQS = &quot;&amp;Reorder=1&amp;TargetID=&quot; + Request.QueryString[&quot;TargetID&quot;] + &quot;&amp;Action=&quot; + Request.QueryString[&quot;Action&quot;];
                }
                if (Request[&quot;ItemID&quot;] != null)
                    Response.Redirect(string.Format(&quot;~/Common/BrixItemPage.aspx?Context=ESTMATE&amp;ParentID={0}&amp;PID={1}&amp;ContainerID={2}&amp;ItemID={3}&amp;Mode={4}{5}&amp;UnitPriceSearch=&quot;, Request[&quot;ParentID&quot;], Request[&quot;PID&quot;], Request[&quot;ContainerID&quot;], Request[&quot;ItemID&quot;], Request[&quot;Mode&quot;], strReorderQS), false);//For Edit(Mode = 1) and View(Mode = 2) Estimate Item
                else
                    Response.Redirect(string.Format(&quot;~/Common/BrixItemPage.aspx?Context=ESTMATE&amp;ParentID={0}&amp;PID={1}&amp;ContainerID={2}{3}&amp;UnitPriceSearch=&quot;, Request[&quot;ParentID&quot;], Request[&quot;PID&quot;], Request[&quot;ContainerID&quot;], strReorderQS), false); //For New Estimate Item
                //string queryString = &quot;&amp;Add=&quot;;
                //queryString += Request[&quot;Add&quot;];

                //if (String.IsNullOrEmpty(Request[&quot;Add&quot;]))
                //    queryString = String.Empty;

                //Response.Redirect(
                //    &quot;EstimateItems.aspx?Type=N&amp;&quot; + EstimatorConstants.PID + &quot;=&quot; + projectID.ToString2() +
                //    &quot;&amp;fromups=Y&amp;back=Y&quot; + &quot;&amp;VID=&quot; + Request[&quot;VID&quot;] + queryString, false);
            }
            else if (btnAddtoWorkbook.Visible)
            {
                Response.Redirect(
                    &quot;EstimateItems.aspx?Type=E&amp;&quot; + EstimatorConstants.PID + &quot;=&quot; + projectID.ToString2() +
                    &quot;&amp;fromups=Y&amp;back=Y&quot;, false);
            }
            else if (hfItemEdit.Value == EstimatorConstants.ESTMATE_ITEM)
                Response.Redirect(string.Format(&quot;~/Common/BrixItemPage.aspx?Context=ESTMATE&amp;ParentID={0}&amp;PID={1}&amp;ContainerID={2}&amp;ItemID={3}&amp;Mode={4}&amp;UnitPriceSearch=&quot;, Request[&quot;ParentID&quot;], Request[&quot;PID&quot;], Request[&quot;ContainerID&quot;], Request[&quot;ItemID&quot;], Request[&quot;Mode&quot;]), false);//For Edit(Mode = 1) and View(Mode = 2) Estimate Item

        }

        protected void btnAddtoUnitPrice_Click(object sender, EventArgs e)
        {
            string text = (txtFinalAvg.Text != &quot;&quot;) ? txtFinalAvg.Text : &quot;0&quot;;
            text = text.Trim();

            if (text != &quot;0&quot; &amp;&amp; LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL).Contains(&quot;INR&quot;))
            {
                text = text.Replace(&quot;INR&quot;, &quot;&quot;);
            }
            //else if (text != &quot;0&quot;)
            //{
            //    text = text.Substring(1, text.Length - 1);
            //}
            if (hfItemEdit.Value == &quot;ItemEdit&quot;)
            {
                Response.Redirect(
                    &quot;EstimateItems.aspx?HistoryPrice=&quot; + Server.UrlEncode(text) + &quot;&amp;Type=E&amp;&quot; + EstimatorConstants.PID +
                    &quot;=&quot; + projectID.ToString2() + &quot;&amp;fromups=Y&quot;, false);
            }
            else if (btnAddtoUnitPrice.Visible)
            {
                //string queryString = &quot;&amp;Add=&quot;;
                //queryString += Request[&quot;Add&quot;];

                //if (String.IsNullOrEmpty(Request[&quot;Add&quot;]))
                //    queryString = String.Empty;                
                if (Session[&quot;UnitPriceSearchDetails&quot;] != null)
                {
                    Hashtable htItemDetail = new Hashtable();
                    htItemDetail = (Hashtable)Session[&quot;UnitPriceSearchDetails&quot;];
                    if (!string.IsNullOrEmpty(text))
                        htItemDetail[&quot;ItemUnitPrice&quot;] = text;

                    string strReorderQS = string.Empty;
                    if (!string.IsNullOrEmpty(Request.QueryString[&quot;Reorder&quot;]) &amp;&amp; Request.QueryString[&quot;Reorder&quot;] == &quot;1&quot;)
                    {
                        strReorderQS = &quot;&amp;Reorder=1&amp;TargetID=&quot; + Request.QueryString[&quot;TargetID&quot;] + &quot;&amp;Action=&quot; + Request.QueryString[&quot;Action&quot;];
                    }

                    if (Request[&quot;ItemID&quot;] != null)
                        Response.Redirect(string.Format(&quot;~/Common/BrixItemPage.aspx?Context=ESTMATE&amp;ParentID={0}&amp;PID={1}&amp;WeightedAverage={2}&amp;ItemID={3}&amp;Mode={4}{5}&amp;UnitPriceSearch=&quot;,
                                           Request[&quot;ParentID&quot;], Request[&quot;PID&quot;], Server.UrlEncode(text), Request[&quot;ItemID&quot;], Request[&quot;Mode&quot;], strReorderQS), false);
                    else
                        Response.Redirect(string.Format(&quot;~/Common/BrixItemPage.aspx?Context=ESTMATE&amp;ParentID={0}&amp;PID={1}&amp;WeightedAverage={2}{3}&amp;UnitPriceSearch=&quot;,
                                       Request[&quot;ParentID&quot;], Request[&quot;PID&quot;], Server.UrlEncode(text), strReorderQS), false);

                }

                //Response.Redirect(string.Format(&quot;~/Common/BrixItemPage.aspx?Context=ESTMATE&amp;ParentID={0}&amp;PID={1}&amp;ContainerID={2}&amp;WeightedAverage={3}&quot;,
                //                     Request[&quot;ParentID&quot;], Request[&quot;PID&quot;], Request[&quot;ContainerID&quot;], Server.UrlEncode(text)), false);  

                //Response.Redirect(
                //    &quot;EstimateItems.aspx?HistoryPrice=&quot; + Server.UrlEncode(text) + &quot;&amp;Type=N&amp;&quot; + EstimatorConstants.PID +
                //    &quot;=&quot; + projectID.ToString2() + &quot;&amp;fromups=Y&quot; + &quot;&amp;VID=&quot; + Request[&quot;VID&quot;] + queryString, false);
            }
        }

        protected void setPagerProperties()
        {
            int pageIdx = ((HtmlInputHidden)mypager.FindControl(&quot;currentPage&quot;)).Value.ToInt32_2();
            int pageCnt = ((HtmlInputHidden)mypager.FindControl(&quot;pageCount&quot;)).Value.ToInt32_2();
            ((TextBox)mypager.FindControl(&quot;txtPageNo&quot;)).Text =
                ((HtmlInputHidden)mypager.FindControl(&quot;currentPage&quot;)).Value + &quot; of &quot; +
                ((HtmlInputHidden)mypager.FindControl(&quot;pageCount&quot;)).Value;
            if (pageIdx &lt;= 1)
            {
                ((ImageButton)mypager.FindControl(&quot;btnFirst&quot;)).Enabled = false;
                ((ImageButton)mypager.FindControl(&quot;btnPrev&quot;)).Enabled = false;
                ((ImageButton)mypager.FindControl(&quot;btnPrev&quot;)).ImageUrl = &quot;~/Images/ImgPrevMD.gif&quot;;
                ((ImageButton)mypager.FindControl(&quot;btnFirst&quot;)).ImageUrl = &quot;~/Images/ImgFirstMD.gif&quot;;
            }
            else
            {
                ((ImageButton)mypager.FindControl(&quot;btnFirst&quot;)).Enabled = true;
                ((ImageButton)mypager.FindControl(&quot;btnPrev&quot;)).Enabled = true;
                ((ImageButton)mypager.FindControl(&quot;btnPrev&quot;)).ImageUrl = &quot;~/Images/ImgPrevMN.gif&quot;;
                ((ImageButton)mypager.FindControl(&quot;btnFirst&quot;)).ImageUrl = &quot;~/Images/ImgFirstMN.gif&quot;;
            }
            if (pageCnt &lt;= 1 || pageCnt == pageIdx)
            {
                ((ImageButton)mypager.FindControl(&quot;btnLast&quot;)).Enabled = false;
                ((ImageButton)mypager.FindControl(&quot;btnNext&quot;)).Enabled = false;
                ((ImageButton)mypager.FindControl(&quot;btnNext&quot;)).ImageUrl = &quot;~/Images/ImgNextMD.gif&quot;;
                ((ImageButton)mypager.FindControl(&quot;btnLast&quot;)).ImageUrl = &quot;~/Images/ImgLastMD.gif&quot;;
            }
            else
            {
                ((ImageButton)mypager.FindControl(&quot;btnLast&quot;)).Enabled = true;
                ((ImageButton)mypager.FindControl(&quot;btnNext&quot;)).Enabled = true;
                ((ImageButton)mypager.FindControl(&quot;btnNext&quot;)).ImageUrl = &quot;~/Images/ImgNextMN.gif&quot;;
                ((ImageButton)mypager.FindControl(&quot;btnLast&quot;)).ImageUrl = &quot;~/Images/ImgLastMN.gif&quot;;
            }
        }

        private void BindGridControl()
        {
            string finalQuery = Session[&quot;FinalQuery&quot;].ToString2();
            string sortExp = Session[&quot;upSearchSortBy&quot;].ToString2();
            if (!string.IsNullOrEmpty(finalQuery) &amp;&amp; !string.IsNullOrEmpty(sortExp))
            {
                finalQuery = finalQuery.Insert(finalQuery.LastIndexOf(&#39;;&#39;), sortExp);
            }
            grdSearchResults.DataSource = EstimateManager.Instance.UnitPriceSearch(finalQuery);
            grdSearchResults.DataBind();
            ColumnsCollection cols = grdSearchResults.DisplayLayout.Bands[0].Columns;

            if (cols.Exists(&quot;Unit Price&quot;))
                cols.FromKey(&quot;Unit Price&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;
            if (cols.Exists(&quot;Quantity&quot;))
                cols.FromKey(&quot;Quantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
            if (cols.Exists(&quot;Amount&quot;))
                cols.FromKey(&quot;Amount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
            if (cols.Exists(&quot;RowNum&quot;))
                cols.FromKey(&quot;RowNum&quot;).Hidden = true;

            if (cols.Exists(&quot;Item Description&quot;))
                cols.FromKey(&quot;Item Description&quot;).Header.Caption = &quot;ItemDescription&quot;;

            UltraGridLayout ugl = grdSearchResults.DisplayLayout;
            ugl.FrameStyle.Height = Unit.Percentage(100);
            ugl.Pager.PagerStyle.CustomRules = &quot;display:none&quot;;
            if (WebConfigurationManager.ConnectionStrings[&quot;AMP3ConnectionString&quot;].ProviderName.ToLower2() == &quot;system.data.oracleclient&quot;)
            {
                ugl.Bands[0].Columns.FromKey(&quot;RN&quot;).Hidden = true;

            }
            grdSearchResults.Visible = true;
            grdSearchResults.DisplayLayout.Pager.PageSize = nSearchPagerSize;
        }

        protected bool EndsWithStr(string s)
        {
            return (s != null &amp;&amp; s.StartsWith(EstimatorConstants.ESTIMATOR, StringComparison.CurrentCultureIgnoreCase));
        }

        #region &quot;Project List ODS&quot;

        public void HandleProjectPagerEvent(object sender, ItemClickEventArgs e)
        {
            BindProjectData();
            grdProjectList.DisplayLayout.Pager.CurrentPageIndex = 1;
            pageState.MaintainState(((HtmlInputHidden)myProjectPager.FindControl(&quot;currentPage&quot;)).Value.ToInt32_2(),
                pageState.SortKey, pageState.GetSortOrder(UIHelper.GetSortIndicator(ViewState[EstimatorConstants.PROJ_ODS_SORTORDER])),
                ViewState[EstimatorConstants.PROJ_ODS_FILTER] == null ? null : ViewState[EstimatorConstants.PROJ_ODS_FILTER].ToString2());
        }

        private void setProjectgridcolumns()
        {
            try
            {
                ColumnsCollection cols = grdProjectList.Bands[0].Columns;

                cols.FromKey(&quot;ProjectCode&quot;).Header.Caption = &quot;Code&quot;;
                cols.FromKey(&quot;ProjectName&quot;).Header.Caption = &quot;Project&quot;;
                cols.FromKey(&quot;StatusName&quot;).Header.Caption = &quot;Status&quot;;
                cols.FromKey(&quot;Date&quot;).Header.Caption = &quot;Date Created&quot;;
                cols.FromKey(&quot;actimage&quot;).Width = 70;
                cols.FromKey(&quot;ProjectName&quot;).HTMLEncodeContent = true;
                cols.FromKey(&quot;StatusName&quot;).HTMLEncodeContent = true;
                cols.FromKey(&quot;Date&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_DATE;
                cols.FromKey(&quot;ProjectId&quot;).Hidden =
                    cols.FromKey(&quot;StartDate&quot;).Hidden =
                    cols.FromKey(&quot;EndDate&quot;).Hidden =
                    cols.FromKey(&quot;StatusId&quot;).Hidden =
                    cols.FromKey(&quot;IsActive&quot;).Hidden =
                    cols.FromKey(&quot;TemplateId&quot;).Hidden =
                    cols.FromKey(&quot;DISPLAYTEXT&quot;).Hidden = true;

                grdProjectList.DisplayLayout.FrameStyle.Height = Unit.Percentage(100);
                grdProjectList.DisplayLayout.Pager.PagerStyle.CustomRules = &quot;display:none&quot;;

                foreach (UltraGridColumn col in cols)
                {
                    col.HTMLEncodeContent = true;
                }

            }
            catch (Exception err)
            {
                ShowNotificationMessage(err.ToString2(), NotificationType.Error);
            }
        }

        protected void grdProjectList_InitializeRow(object sender, RowEventArgs e)
        {
            try
            {
                if (e.Row.Cells.FromKey(&quot;IsActive&quot;).Value.ToString2() == &quot;True&quot;)
                {
                    e.Row.Cells.FromKey(&quot;actimage&quot;).Style.BackgroundImage = &quot;../../Images/toolbar/IcnActive.gif&quot;;
                    e.Row.Cells.FromKey(&quot;actimage&quot;).Style.CustomRules =
                        &quot;Background-repeat:no-repeat;background-position: center center&quot;;
                    e.Row.Cells.FromKey(&quot;actimage&quot;).Style.ForeColor = Color.White;
                    e.Row.Cells.FromKey(&quot;actimage&quot;).Style.Font.Size = FontUnit.Point(1);
                    e.Row.Cells.FromKey(&quot;actimage&quot;).Title = &quot;Active&quot;;
                }
                else
                {
                    e.Row.Cells.FromKey(&quot;actimage&quot;).Style.BackgroundImage = &quot;../../Images/toolbar/IcnInactive.gif&quot;;
                    e.Row.Cells.FromKey(&quot;actimage&quot;).Style.CustomRules =
                        &quot;Background-repeat:no-repeat;background-position: center center&quot;;
                    e.Row.Cells.FromKey(&quot;actimage&quot;).Style.ForeColor = Color.White;
                    e.Row.Cells.FromKey(&quot;actimage&quot;).Style.Font.Size = FontUnit.Point(1);
                    e.Row.Cells.FromKey(&quot;actimage&quot;).Title = &quot;Inactive&quot;;
                }
            }
            catch (Exception err)
            {
                ShowNotificationMessage(err.ToString2(), NotificationType.Error);
            }
        }

        protected void grdProjectList_SortColumn(object sender, SortColumnEventArgs e)
        {
            ApplyProjectSort(grdProjectList.Columns[e.ColumnNo].Key);
            pageState.MaintainState(((HtmlInputHidden)myProjectPager.FindControl(&quot;currentPage&quot;)).Value.ToInt32_2(),
                grdProjectList.Columns[e.ColumnNo].Key, pageState.GetSortOrder(UIHelper.GetSortIndicator(ViewState[EstimatorConstants.PROJ_ODS_SORTORDER])),
                ViewState[EstimatorConstants.PROJ_ODS_FILTER] == null ? null : ViewState[EstimatorConstants.PROJ_ODS_FILTER].ToString2());
        }

        protected void grdSearchResults_SortColumn(object sender, SortColumnEventArgs e)
        {
            string direction = string.Empty;
            if (grdSearchResults.Columns[e.ColumnNo].SortIndicator.ToString().StartsWith(&quot;As&quot;))
            {
                direction = grdSearchResults.Columns[e.ColumnNo].SortIndicator.ToString().Substring(0, 3).ToUpper2();
            }
            else if (grdSearchResults.Columns[e.ColumnNo].SortIndicator.ToString().StartsWith(&quot;De&quot;))
            {
                direction = grdSearchResults.Columns[e.ColumnNo].SortIndicator.ToString().Substring(0, 4).ToUpper2();
            }
            Session[&quot;upSearchSortBy&quot;] = &quot; ORDER BY [&quot; + grdSearchResults.Columns[e.ColumnNo].Key + &quot;] &quot; + direction;

            BindGridControl();
        }


        private void GetProjectPageCount()
        {
            double rCnt;
            string filter = &quot;&quot;;

            if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX))
            {
                filter = &quot;&lt;ERPCompany type=&#39;txt&#39;&gt;&quot; + Session[&quot;AXCompany&quot;].ToString2() + &quot;&lt;/ERPCompany&gt;&lt;/XMLRoot&gt;&quot;;

                if (ViewState[EstimatorConstants.PROJ_ODS_FILTER] == null)
                    filter = &quot;&lt;XMLRoot&gt;&quot; + filter;
                else
                    filter = ViewState[EstimatorConstants.PROJ_ODS_FILTER].ToString().Replace(&quot;&lt;/XMLRoot&gt;&quot;, filter);
            }

            rCnt = EstimateManager.Instance.GetProjectsCount(filter);

            if (pageState.PageIndex != 0 &amp;&amp;
                Math.Ceiling(rCnt / grdProjectList.DisplayLayout.Pager.PageSize) &gt;= pageState.PageIndex)
            {
                ((HtmlInputHidden)myProjectPager.FindControl(&quot;currentPage&quot;)).Value = pageState.PageIndex &gt; 0
                    ? pageState.PageIndex.ToString2() : &quot;0&quot;;
            }
            else
            {
                ((HtmlInputHidden)myProjectPager.FindControl(&quot;currentPage&quot;)).Value = rCnt &gt; 0 ? &quot;1&quot; : &quot;0&quot;;
            }
            ((HtmlInputHidden)myProjectPager.FindControl(&quot;pageCount&quot;)).Value =
                rCnt &gt; grdProjectList.DisplayLayout.Pager.PageSize
                    ? Math.Ceiling(rCnt / grdProjectList.DisplayLayout.Pager.PageSize).ToString2()
                    : rCnt &gt; 0 ? &quot;1&quot; : &quot;0&quot;;
            pageState.MaintainState(((HtmlInputHidden)myProjectPager.FindControl(&quot;currentPage&quot;)).Value.ToInt32_2(),
                pageState.SortKey, pageState.GetSortOrder(UIHelper.GetSortIndicator(ViewState[EstimatorConstants.PROJ_ODS_SORTORDER])),
                ViewState[EstimatorConstants.PROJ_ODS_FILTER] == null ? null : ViewState[EstimatorConstants.PROJ_ODS_FILTER].ToString2());
        }

        public void BindProjectData()
        {
            int startIdx = (myProjectPager as PagerControl).CurrentPage - 1;
            // BrixDatatypeHelper.ToInt32_2(((HtmlInputHidden)myProjectPager.FindControl(&quot;currentPage&quot;)).Value) - 1;

            startIdx = 1 + (grdProjectList.DisplayLayout.Pager.PageSize * startIdx);

            string filter = null;
            if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX))
            {
                filter = &quot;&lt;ERPCompany type=&#39;txt&#39;&gt;&quot; + Session[&quot;AXCompany&quot;].ToString2() + &quot;&lt;/ERPCompany&gt;&lt;/XMLRoot&gt;&quot;;

                if (ViewState[EstimatorConstants.PROJ_ODS_FILTER] == null)
                    filter = &quot;&lt;XMLRoot&gt;&quot; + filter;
                else
                    filter = ViewState[EstimatorConstants.PROJ_ODS_FILTER].ToString().Replace(&quot;&lt;/XMLRoot&gt;&quot;, filter);
            }

            string sortorder = null;
            if (ViewState[EstimatorConstants.PROJ_ODS_SORTORDER] != null &amp;&amp; ViewState[EstimatorConstants.PROJ_ODS_SORTORDER].ToString2().Length &gt; 4)
                sortorder = ViewState[EstimatorConstants.PROJ_ODS_SORTORDER].ToString2();//ViewState[EstimatorConstants.ODS_SORTORDER].ToString2();
            else
                sortorder = &quot;ProjectName asc&quot;;
            if (sortorder.ToLower2() == &quot;ascending&quot;)
                sortorder = &quot;ProjectName asc&quot;;

            DataTable projectDT = EstimateManager.Instance.GetProjectsList(startIdx,
                grdProjectList.DisplayLayout.Pager.PageSize, sortorder, filter);
            grdProjectList.DataSource = projectDT;
            grdProjectList.DataBind();
            setProjectgridcolumns();
            if (projectDT.Rows.Count == 0)
                grdProjectList.DisplayLayout.NoDataMessage = &quot;No Projects to display&quot;;
            else
                grdProjectList.Visible = true;
        }

        protected void ApplyProjectFilter()
        {
            try
            {
                ViewState[EstimatorConstants.PROJ_ODS_FILTER] = UIHelper.GenerateFilterXML(aspPnlFilter);
                GetProjectPageCount();
                BindProjectData();
                pageState.setPagerProperties(myProjectPager);
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_PROJECT);
                throw;
            }
        }

        protected void ApplyProjectSort(string sortKey)
        {
            switch (sortKey)
            {
                case &quot;actimage&quot;:
                    sortKey = &quot;IsActive&quot;;
                    break;
                case &quot;Date&quot;:
                    sortKey = &quot;CreateDate&quot;;
                    break;
                case null:
                    sortKey = &quot;ProjectName&quot;;
                    break;
            }

            //switch (colNo)
            //{
            //    case 0:
            //        sortKey = &quot;IsActive&quot;;
            //        break;
            //    case 4:
            //        sortKey = &quot;CreateDate&quot;;
            //        break;
            //    default:
            //        sortKey = grdProjectList.Columns[colNo].BaseColumnName;
            //        break;
            //}

            if (ViewState[EstimatorConstants.PROJ_ODS_SORTORDER] != null
                &amp;&amp; ViewState[EstimatorConstants.PROJ_ODS_SORTORDER].ToString2().EndsWith2(&quot;ASC&quot;)
                &amp;&amp; ViewState[EstimatorConstants.PROJ_ODS_SORTORDER].ToString2().StartsWith(sortKey, StringComparison.CurrentCultureIgnoreCase))
                ViewState[EstimatorConstants.PROJ_ODS_SORTORDER] = sortKey + &quot; DESC&quot;;
            else
                ViewState[EstimatorConstants.PROJ_ODS_SORTORDER] = sortKey + &quot; ASC&quot;;
            BindProjectData();
            foreach (UltraGridColumn uwgcol in grdProjectList.DisplayLayout.Bands[0].Columns)
                if (uwgcol.SortIndicator != SortIndicator.None)
                    uwgcol.SortIndicator = SortIndicator.None;
            if (grdProjectList.Bands[0].Columns.Exists(sortKey))
                grdProjectList.Bands[0].Columns.FromKey(sortKey).SortIndicator =
                    ViewState[EstimatorConstants.PROJ_ODS_SORTORDER].ToString2().EndsWith2(&quot;ASC&quot;) ? SortIndicator.Ascending : SortIndicator.Descending;
        }

        private void ProjectODS()
        {
            if ((pageState =
                 UIHelper.GetModuleFromStateBag(&quot;ProjectODS&quot;, Context) as StateManagementBase) ==
                null)
            {
                pageState = new StateManagementBase(&quot;ProjectODS&quot;);
                UIHelper.UpdateModuleStateBag(&quot;ProjectODS&quot;, pageState, Context);
            }
            else if (!WebConfigurationManager.AppSettings[&quot;StateMgmtGlobal&quot;].ToBoolean2() &amp;&amp;
                     Request.UrlReferrer != null &amp;&amp; !Array.Exists(Request.UrlReferrer.Segments, EndsWithStr))
            {
                pageState.ClearState();
            }
            else
            {
                ViewState[EstimatorConstants.PROJ_ODS_SORTORDER] = pageState.SortOrder;
                ViewState[EstimatorConstants.PROJ_ODS_FILTER] = pageState.FilterCriterion;
                ((HtmlInputHidden)myProjectPager.FindControl(&quot;currentPage&quot;)).Value = pageState.PageIndex.ToString2();
                if (ViewState[EstimatorConstants.PROJ_ODS_FILTER] != null &amp;&amp; !IsPostBack)
                {
                    pageState.RestoreFilterState(Page, ViewState[EstimatorConstants.PROJ_ODS_FILTER].ToString2());
                }
                //else if (ViewState[EstimatorConstants.PROJ_ODS_FILTER] == null &amp;&amp; pageState.PageIndex == 0)
                //{
                //    Page.ClientScript.RegisterStartupScript(GetType(), &quot;resetProjFilters&quot;, &quot;resetProjFilters();&quot;, true);
                //}
            }
            //if (ViewState[EstimatorConstants.PROJ_ODS_FILTER] != null)
            //{
            //    Page.ClientScript.RegisterStartupScript(GetType(), &quot;showHideProjectFilterButtons&quot;,
            //                                            &quot;showHideProjectFilterButtons();&quot;, true);
            //}

            if (!IsPostBack || (IsPostBack &amp;&amp; pageState.PageIndex == 0))
            {
                GetProjectPageCount();
                if (!string.IsNullOrEmpty(pageState.SortKey))
                {
                    BindProjectData();
                    foreach (UltraGridColumn uwgcol in grdProjectList.DisplayLayout.Bands[0].Columns)
                        if (uwgcol.SortIndicator != SortIndicator.None)
                            uwgcol.SortIndicator = SortIndicator.None;
                }
                else
                {
                    if (ViewState[EstimatorConstants.PROJ_ODS_SORTORDER] != null &amp;&amp;
                        ViewState[EstimatorConstants.PROJ_ODS_SORTORDER].ToString2().EndsWith2(&quot;ASC&quot;))
                        ViewState[EstimatorConstants.PROJ_ODS_SORTORDER] =
                            ViewState[EstimatorConstants.PROJ_ODS_SORTORDER].ToString2().Replace(&quot; ASC&quot;, &quot; DESC&quot;);
                    else
                        ViewState[EstimatorConstants.PROJ_ODS_SORTORDER] =
                            ViewState[EstimatorConstants.PROJ_ODS_SORTORDER].ToString2().Replace(&quot; DESC&quot;, &quot; ASC&quot;);
                    if (grdProjectList.Columns.Count &gt; 0 &amp;&amp; grdProjectList.Columns.Exists(pageState.SortKey))
                        ApplyProjectSort(pageState.SortKey);
                    else
                    {
                        //BindProjectData();
                        ApplyProjectSort(pageState.SortKey);
                    }
                }
                pageState.setPagerProperties(myProjectPager);
            }
        }

        protected void btnFilterGhost_Click(object sender, EventArgs e)
        {
            ApplyProjectFilter();
        }

        #endregion

        #region IXMLControl Members
        public HtmlGenericControl XMLContainterDiv
        {
            get { return divExtension; }
            set { throw new NotImplementedException(); }
        }

        public object[] ParentFormInstanceID
        {
            get { return null; }
        }

        public void HandleInjectionSaveException(object model, Exception ex, string parentFormInstanceId)
        { }

        public void HandleInjectionAfterSave(object model, string parentFormInstanceId)
        { }

        public bool SkipDefaultXMLInjectionSave { get; set; }
        #endregion
    }

    [ContextElement(Name = &quot;Project List&quot;)]
    public class ProjectListUPSearchContextMenuImplementation : ContextElementCallBack
    {
        #region ContextElementCallBack Members

        public List&lt;BrixContextMenu&gt; GetActionList()
        {
            var lst = new List&lt;BrixContextMenu&gt;();
            DataRow dr = ModuleManagementBL.ModuleManager.Instance.GetModuleDetails(&quot;ESTMATE&quot;);
            if (dr != null &amp;&amp; dr[&quot;IsActive&quot;] != DBNull.Value &amp;&amp; Convert.ToBoolean(dr[&quot;IsActive&quot;]))
            {
                var item = new BrixContextMenu();
                item.Name = item.Description = &quot;Unit Price Search&quot;;
                item.GridParameters = &quot;ProjectID&quot;;
                item.IconImage = &quot;IcnPage.gif&quot;;
                lst.Add(item);
            }
            return lst;
        }

        public void DoCallBack(string Name, CIDictionary Parameters)
        {
            switch (Name)
            {
                case &quot;Unit Price Search&quot;:
                    HttpContext.Current.Response.Redirect(
                        @&quot;~/Modules/ESTMATE/UnitPriceSearch.aspx?PID=&quot; + Parameters[&quot;ProjectId&quot;] + &quot;&amp;Context=ESTMATE&amp;nt=1&quot;, true);
                    break;
            }
        }

        #endregion
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[45,9,45,42,1],[50,9,50,77,1],[92,9,92,10,1],[93,13,93,66,1],[95,13,95,69,1],[96,13,96,44,1],[98,13,98,83,1],[99,13,99,51,1],[101,13,101,138,1],[103,13,103,45,1],[104,13,104,119,1],[106,13,106,87,1],[108,13,108,45,1],[109,13,109,42,1],[110,13,110,40,1],[111,13,111,28,1],[112,9,112,10,1],[115,9,115,10,1],[117,13,117,31,1],[118,13,118,57,1],[119,13,119,25,1],[121,13,121,26,1],[124,21,124,104,1],[125,21,125,100,1],[126,21,126,65,1],[127,21,127,94,1],[128,21,128,66,1],[129,21,129,129,1],[130,21,130,108,1],[132,21,132,27,1],[134,21,134,105,1],[135,21,135,97,1],[136,21,136,62,1],[137,21,137,101,1],[138,21,138,61,1],[139,21,139,131,1],[140,21,140,102,1],[141,21,141,27,1],[143,21,143,103,1],[144,21,144,95,1],[145,21,145,60,1],[146,21,146,99,1],[147,21,147,59,1],[148,21,148,118,1],[149,21,149,98,1],[150,21,150,27,1],[152,9,152,10,1],[156,9,156,10,1],[158,13,158,85,1],[159,13,159,44,1],[160,13,160,62,1],[161,13,161,26,1],[164,21,165,79,1],[167,21,167,71,1],[168,21,168,56,1],[169,21,169,62,1],[170,21,170,63,1],[171,21,171,60,1],[172,21,172,65,1],[173,21,173,65,1],[174,21,174,65,1],[175,21,175,56,1],[176,21,176,58,1],[177,21,177,62,1],[178,21,178,56,1],[179,21,179,60,1],[180,21,180,65,1],[182,21,182,28,1],[182,30,182,40,1],[182,41,182,43,1],[182,44,182,54,1],[183,21,183,22,1],[184,25,184,62,1],[185,25,185,26,1],[186,29,186,131,1],[187,29,187,51,1],[188,25,188,26,1],[190,25,190,26,1],[191,29,191,178,1],[192,29,192,51,1],[193,25,193,26,1],[194,21,194,22,1],[195,21,195,27,1],[198,21,198,146,1],[200,21,200,71,1],[201,21,201,84,1],[202,21,202,78,1],[203,21,203,70,1],[204,21,204,56,1],[206,21,206,28,1],[206,30,206,40,1],[206,41,206,43,1],[206,44,206,54,1],[207,21,207,22,1],[208,25,208,62,1],[209,25,209,26,1],[210,29,210,131,1],[211,29,211,51,1],[212,25,212,26,1],[214,25,214,26,1],[215,29,215,178,1],[216,29,216,51,1],[217,25,217,26,1],[218,21,218,22,1],[219,21,219,27,1],[222,13,222,32,1],[223,9,223,10,1],[227,9,227,10,1],[228,13,228,71,1],[229,13,229,104,1],[230,13,230,58,1],[231,13,231,70,1],[232,13,232,31,1],[233,9,233,10,1],[236,9,236,10,1],[238,13,238,14,1],[239,17,239,53,1],[241,17,241,118,1],[242,17,242,18,0],[243,21,243,180,0],[244,21,244,70,0],[245,21,245,155,0],[246,17,246,18,0],[248,21,248,77,1],[251,17,252,99,1],[253,21,253,130,0],[255,17,255,42,1],[256,21,256,53,1],[257,17,257,108,1],[258,17,258,18,1],[259,21,259,42,1],[260,21,260,51,1],[261,17,261,18,1],[263,17,263,39,1],[265,17,265,38,1],[266,17,266,18,1],[267,21,267,72,1],[268,21,268,56,1],[269,21,269,95,1],[270,21,270,56,1],[271,21,271,22,1],[272,25,272,63,1],[273,25,273,83,1],[274,25,274,45,1],[275,21,275,22,1],[276,21,276,52,1],[278,21,278,45,1],[280,21,280,72,1],[281,21,281,84,1],[282,21,282,75,1],[283,21,283,62,1],[284,21,284,22,1],[285,25,285,49,1],[286,25,286,101,1],[287,25,287,72,1],[288,29,288,140,1],[289,21,289,22,1],[290,26,290,48,1],[291,21,291,22,0],[292,25,292,49,0],[293,25,293,101,0],[294,25,294,73,0],[295,29,295,138,0],[296,21,296,22,0],[297,26,297,49,1],[298,25,298,57,0],[300,21,300,46,1],[301,21,301,54,1],[304,21,304,41,1],[305,17,305,18,1],[307,17,307,18,1],[308,21,308,76,1],[309,21,309,123,1],[310,21,310,120,1],[311,21,311,85,1],[312,21,312,123,1],[313,21,313,120,1],[314,21,314,88,1],[315,21,315,120,1],[316,21,316,117,1],[317,17,317,18,1],[319,17,319,30,1],[321,17,321,92,1],[322,17,322,93,1],[323,17,323,92,1],[324,17,324,93,1],[326,13,326,14,1],[327,13,327,40,0],[328,13,328,14,0],[329,17,329,86,0],[330,13,330,14,0],[331,9,331,10,1],[334,9,334,10,1],[335,13,335,59,1],[336,13,336,62,1],[337,13,337,88,1],[338,13,338,36,1],[339,9,339,10,1],[342,9,342,10,0],[343,13,343,60,0],[344,13,344,14,0],[345,13,345,62,0],[346,13,346,14,0],[347,13,347,75,0],[348,13,348,76,0],[349,13,349,72,0],[350,13,350,63,0],[351,13,351,43,0],[352,17,352,89,0],[353,13,353,39,0],[354,17,354,81,0],[355,9,355,10,0],[358,9,358,10,1],[359,13,359,89,1],[360,13,362,119,1],[363,13,365,77,1],[366,13,366,44,1],[367,13,367,27,1],[368,13,368,109,1],[369,13,369,14,0],[370,17,370,58,0],[371,17,371,64,0],[372,17,372,65,0],[373,17,373,43,0],[374,13,374,14,0],[375,9,375,10,1],[379,9,379,10,1],[380,13,380,42,1],[381,9,381,10,1],[384,9,384,10,1],[385,13,385,50,1],[386,13,386,51,1],[387,13,387,45,1],[389,13,389,101,1],[389,101,389,138,1],[389,138,389,158,1],[389,158,389,163,0],[389,163,389,170,1],[389,170,389,177,0],[389,177,389,179,1],[389,13,389,179,1],[390,13,390,52,1],[391,13,391,20,1],[391,22,391,52,0],[391,53,391,55,1],[391,56,391,68,1],[392,13,392,14,0],[393,17,393,82,0],[394,17,394,33,0],[395,17,395,18,0],[396,21,396,98,0],[397,21,397,74,0],[398,21,398,66,0],[399,21,399,145,0],[400,21,400,70,0],[401,21,401,72,0],[402,17,402,18,0],[403,13,403,14,0],[405,13,405,48,1],[406,13,406,14,1],[407,17,407,107,1],[408,13,408,14,1],[409,13,409,49,1],[410,13,410,14,1],[411,17,411,109,1],[412,13,412,14,1],[414,13,414,52,1],[416,13,416,27,1],[417,13,417,14,1],[418,17,418,94,1],[419,17,419,40,1],[420,13,420,14,1],[422,13,422,14,1],[423,17,423,99,1],[424,17,424,48,1],[425,17,425,18,1],[426,21,426,55,1],[427,21,427,86,1],[428,21,428,91,1],[429,21,429,56,1],[430,21,430,60,1],[431,21,431,44,1],[432,25,432,62,1],[433,21,433,47,1],[435,21,436,102,1],[437,21,437,73,1],[438,21,442,110,1],[443,21,443,22,1],[444,21,448,110,1],[449,21,449,22,1],[450,21,451,99,1],[452,21,452,22,1],[453,21,453,146,1],[454,21,454,22,1],[455,17,455,18,1],[456,13,456,14,1],[457,9,457,10,1],[460,9,460,10,1],[462,13,462,14,1],[463,17,463,52,1],[464,17,464,18,1],[465,21,465,74,1],[466,21,466,64,1],[467,21,467,22,1],[468,25,468,73,1],[469,25,469,115,1],[470,29,472,71,0],[474,29,475,114,1],[476,25,476,32,1],[478,17,478,18,1],[479,17,479,51,1],[480,17,480,82,1],[481,17,482,106,1],[483,17,483,67,1],[484,17,486,90,1],[488,17,488,82,1],[489,17,489,74,1],[490,17,490,79,1],[492,17,492,65,1],[493,17,493,45,1],[495,17,495,48,1],[496,17,496,90,1],[498,17,498,47,1],[499,21,499,108,1],[500,17,500,45,1],[501,21,501,104,1],[502,17,502,43,1],[503,21,503,100,1],[504,17,504,43,1],[505,21,505,58,1],[506,17,506,48,1],[507,21,507,63,0],[509,17,509,53,1],[510,21,510,89,1],[512,17,512,48,1],[513,17,513,18,1],[514,21,514,79,1],[515,21,515,103,1],[516,21,516,52,1],[517,25,517,117,1],[518,17,518,18,1],[520,17,523,56,1],[526,17,526,38,1],[527,17,527,107,1],[528,17,528,18,0],[529,21,529,46,0],[530,25,530,77,0],[532,25,534,91,0],[535,21,535,49,0],[536,17,536,18,0],[537,17,537,65,1],[539,17,539,54,1],[540,21,540,44,1],[542,17,542,24,1],[542,26,542,45,1],[542,46,542,48,1],[542,49,542,53,1],[543,17,543,18,1],[544,21,544,50,1],[545,17,545,18,1],[547,17,547,38,1],[548,13,548,14,1],[549,13,549,33,0],[550,13,550,14,0],[551,17,551,98,0],[552,17,552,80,0],[553,17,553,42,0],[554,13,554,14,0],[555,9,555,10,1],[558,9,558,10,1],[560,13,560,14,1],[561,17,565,53,1],[566,17,566,98,1],[567,17,567,62,1],[568,17,568,44,1],[569,17,569,43,1],[570,17,570,72,1],[571,17,571,72,1],[572,17,572,72,1],[573,17,573,72,1],[574,17,574,105,1],[575,17,575,42,1],[576,17,576,47,1],[577,17,577,90,1],[578,17,578,48,1],[579,17,579,56,1],[580,17,580,49,1],[581,17,581,44,1],[582,13,582,14,1],[583,13,583,33,0],[584,13,584,14,0],[585,17,585,98,0],[586,13,586,14,0],[587,9,587,10,1],[591,9,591,10,0],[592,13,592,54,0],[593,13,593,55,0],[595,13,595,104,0],[596,13,596,99,0],[597,13,597,109,0],[598,13,598,106,0],[599,13,599,98,0],[600,13,600,103,0],[601,13,601,107,0],[602,13,602,108,0],[603,13,603,100,0],[605,13,605,48,0],[607,13,607,30,0],[609,18,609,27,0],[609,29,609,60,0],[609,62,609,65,0],[610,13,610,14,0],[611,17,611,94,0],[612,17,612,18,0],[613,21,613,59,0],[614,21,614,113,0],[615,21,615,67,0],[616,21,617,102,0],[618,21,619,106,0],[620,21,620,100,0],[621,21,622,108,0],[623,21,623,118,0],[624,21,624,121,0],[625,21,625,116,0],[627,21,627,58,0],[629,21,629,32,0],[630,17,630,18,0],[631,13,631,14,0],[633,13,633,49,0],[634,13,634,14,0],[635,17,637,28,0],[638,17,638,110,0],[639,13,639,14,0],[640,9,640,10,0],[643,9,643,10,1],[645,13,645,14,1],[646,17,646,56,1],[647,17,647,18,1],[648,21,648,71,1],[649,21,649,94,1],[650,21,650,50,1],[651,21,651,57,1],[652,17,652,18,1],[653,13,653,14,1],[654,13,654,18,0],[654,19,654,20,0],[654,21,654,22,0],[655,9,655,10,1],[658,9,658,10,1],[659,13,659,65,1],[660,13,660,14,1],[661,17,661,82,1],[662,17,662,80,1],[663,13,663,14,1],[665,9,665,10,1],[668,9,668,10,0],[669,13,669,73,0],[670,17,672,28,0],[673,18,673,48,0],[674,13,674,14,0],[675,17,675,52,0],[676,17,676,116,0],[677,17,677,18,0],[678,21,678,138,0],[679,17,679,18,0],[680,17,680,47,0],[681,21,681,295,0],[683,21,683,239,0],[693,13,693,14,0],[694,18,694,47,0],[695,13,695,14,0],[696,17,698,49,0],[699,13,699,14,0],[700,18,700,74,0],[701,17,701,274,0],[703,9,703,10,0],[706,9,706,10,1],[707,13,707,77,1],[708,13,708,32,1],[710,13,710,112,1],[711,13,711,14,0],[712,17,712,48,0],[713,13,713,14,0],[718,13,718,48,1],[719,13,719,14,0],[720,17,722,72,0],[723,13,723,14,0],[724,18,724,48,1],[725,13,725,14,1],[731,17,731,63,1],[732,17,732,18,1],[733,21,733,62,1],[734,21,734,81,1],[735,21,735,53,1],[736,25,736,62,1],[738,21,738,56,1],[739,21,739,120,1],[740,21,740,22,0],[741,25,741,142,0],[742,21,742,22,0],[744,21,744,51,1],[745,25,746,163,0],[748,25,749,123,1],[751,17,751,18,1],[759,13,759,14,1],[760,9,760,10,1],[763,9,763,10,1],[764,13,764,99,1],[765,13,765,97,1],[766,13,768,75,1],[769,13,769,30,1],[770,13,770,14,1],[771,17,771,80,1],[772,17,772,79,1],[773,17,773,99,1],[774,17,774,101,1],[775,13,775,14,1],[777,13,777,14,0],[778,17,778,79,0],[779,17,779,78,0],[780,17,780,99,0],[781,17,781,101,0],[782,13,782,14,0],[783,13,783,52,1],[784,13,784,14,1],[785,17,785,79,1],[786,17,786,79,1],[787,17,787,99,1],[788,17,788,99,1],[789,13,789,14,1],[791,13,791,14,1],[792,17,792,78,1],[793,17,793,78,1],[794,17,794,99,1],[795,17,795,99,1],[796,13,796,14,1],[797,9,797,10,1],[800,9,800,10,1],[801,13,801,67,1],[802,13,802,68,1],[803,13,803,85,1],[804,13,804,14,0],[805,17,805,86,0],[806,13,806,14,0],[807,13,807,96,1],[808,13,808,41,1],[809,13,809,86,1],[811,13,811,43,1],[812,17,812,104,1],[813,13,813,41,1],[814,17,814,100,1],[815,13,815,39,1],[816,17,816,96,1],[817,13,817,39,1],[818,17,818,54,1],[820,13,820,49,1],[821,17,821,85,1],[823,13,823,66,1],[824,13,824,58,1],[825,13,825,63,1],[826,13,826,137,1],[827,13,827,14,0],[828,17,828,66,0],[830,13,830,14,0],[831,13,831,45,1],[832,13,832,78,1],[833,9,833,10,1],[836,9,836,10,1],[837,13,837,121,1],[838,9,838,10,1],[843,9,843,10,0],[844,13,844,31,0],[845,13,845,69,0],[846,13,848,139,0],[849,9,849,10,0],[852,9,852,10,1],[854,13,854,14,1],[855,17,855,74,1],[857,17,857,69,1],[858,17,858,72,1],[859,17,859,70,1],[860,17,860,70,1],[861,17,861,53,1],[862,17,862,70,1],[863,17,863,69,1],[864,17,864,92,1],[865,17,871,63,1],[873,17,873,87,1],[874,17,874,92,1],[876,17,876,24,1],[876,26,876,45,1],[876,46,876,48,1],[876,49,876,53,1],[877,17,877,18,1],[878,21,878,50,1],[879,17,879,18,1],[881,13,881,14,1],[882,13,882,34,0],[883,13,883,14,0],[884,17,884,82,0],[885,13,885,14,0],[886,9,886,10,1],[889,9,889,10,1],[891,13,891,14,1],[892,17,892,81,1],[893,17,893,18,1],[894,21,894,114,1],[895,21,896,90,1],[897,21,897,83,1],[898,21,898,89,1],[899,21,899,70,1],[900,17,900,18,1],[902,17,902,18,0],[903,21,903,116,0],[904,21,905,90,0],[906,21,906,83,0],[907,21,907,89,0],[908,21,908,72,0],[909,17,909,18,0],[910,13,910,14,1],[911,13,911,34,0],[912,13,912,14,0],[913,17,913,82,0],[914,13,914,14,0],[915,9,915,10,1],[918,9,918,10,0],[919,13,919,70,0],[920,13,922,139,0],[923,9,923,10,0],[926,9,926,10,0],[927,13,927,45,0],[928,13,928,96,0],[929,13,929,14,0],[930,17,930,118,0],[931,13,931,14,0],[932,18,932,101,0],[933,13,933,14,0],[934,17,934,118,0],[935,13,935,14,0],[936,13,936,117,0],[938,13,938,31,0],[939,9,939,10,0],[943,9,943,10,1],[945,13,945,32,1],[947,13,947,103,1],[948,13,948,14,0],[949,17,949,115,0],[951,17,951,75,0],[952,21,952,51,0],[954,21,954,117,0],[955,13,955,14,0],[957,13,957,70,1],[959,13,960,105,1],[961,13,961,14,0],[962,17,963,61,0],[964,13,964,14,0],[966,13,966,14,1],[967,17,967,107,1],[968,13,968,14,1],[969,13,972,44,1],[973,13,975,139,1],[976,9,976,10,1],[979,9,979,10,1],[980,13,980,77,1],[983,13,983,85,1],[985,13,985,34,1],[986,13,986,103,1],[987,13,987,14,0],[988,17,988,115,0],[990,17,990,75,0],[991,21,991,51,0],[993,21,993,117,0],[994,13,994,14,0],[996,13,996,37,1],[997,13,997,149,1],[998,17,998,90,1],[1000,17,1000,47,0],[1001,13,1001,53,1],[1002,17,1002,47,0],[1004,13,1005,81,1],[1006,13,1006,51,1],[1007,13,1007,39,1],[1008,13,1008,37,1],[1009,13,1009,43,1],[1010,17,1010,87,0],[1012,17,1012,47,1],[1013,9,1013,10,1],[1016,9,1016,10,0],[1018,13,1018,14,0],[1019,17,1019,106,0],[1020,17,1020,39,0],[1021,17,1021,35,0],[1022,17,1022,62,0],[1023,13,1023,14,0],[1024,13,1024,33,0],[1025,13,1025,14,0],[1026,17,1026,93,0],[1027,17,1027,23,0],[1029,9,1029,10,0],[1032,9,1032,10,1],[1033,13,1033,29,1],[1036,21,1036,42,0],[1037,21,1037,27,0],[1039,21,1039,44,0],[1040,21,1040,27,0],[1042,21,1042,45,1],[1043,21,1043,27,1],[1059,13,1061,144,1],[1062,17,1062,86,0],[1064,17,1064,85,1],[1065,13,1065,31,1],[1066,13,1066,20,1],[1066,22,1066,44,1],[1066,45,1066,47,1],[1066,48,1066,93,1],[1067,17,1067,64,1],[1068,21,1068,63,0],[1069,13,1069,65,1],[1070,17,1071,152,1],[1072,9,1072,10,1],[1075,9,1075,10,1],[1076,13,1078,22,1],[1079,13,1079,14,1],[1080,17,1080,67,1],[1081,17,1081,81,1],[1082,13,1082,14,1],[1083,18,1084,110,1],[1085,13,1085,14,1],[1086,17,1086,40,1],[1087,13,1087,14,1],[1089,13,1089,14,1],[1090,17,1090,88,1],[1091,17,1091,91,1],[1092,17,1092,118,1],[1093,17,1093,90,1],[1094,17,1094,18,0],[1095,21,1095,115,0],[1096,17,1096,18,0],[1101,13,1101,14,1],[1108,13,1108,73,1],[1109,13,1109,14,1],[1110,17,1110,39,1],[1111,17,1111,62,1],[1112,17,1112,18,0],[1113,21,1113,39,0],[1114,21,1114,28,0],[1114,30,1114,52,0],[1114,53,1114,55,0],[1114,56,1114,101,0],[1115,25,1115,72,0],[1116,29,1116,71,0],[1117,17,1117,18,0],[1119,17,1119,18,1],[1120,21,1121,103,1],[1122,25,1123,115,0],[1125,25,1126,115,1],[1127,21,1127,110,1],[1128,25,1128,61,0],[1130,21,1130,22,1],[1132,25,1132,61,1],[1133,21,1133,22,1],[1134,17,1134,18,1],[1135,17,1135,62,1],[1136,13,1136,14,1],[1137,9,1137,10,1],[1140,9,1140,10,0],[1141,13,1141,34,0],[1142,9,1142,10,0],[1149,17,1149,18,0],[1149,19,1149,39,0],[1149,40,1149,41,0],[1150,17,1150,18,0],[1150,19,1150,55,0],[1155,17,1155,18,1],[1155,19,1155,31,1],[1155,32,1155,33,1],[1159,9,1159,10,0],[1159,11,1159,12,0],[1162,9,1162,10,0],[1162,11,1162,12,0],[1164,51,1164,55,0],[1164,56,1164,60,0],[1174,9,1174,10,1],[1175,13,1175,51,1],[1176,13,1176,96,1],[1177,13,1177,99,1],[1178,13,1178,14,1],[1179,17,1179,50,1],[1180,17,1180,68,1],[1181,17,1181,51,1],[1182,17,1182,48,1],[1183,17,1183,31,1],[1184,13,1184,14,1],[1185,13,1185,24,1],[1186,9,1186,10,1],[1189,9,1189,10,0],[1190,13,1190,26,0],[1193,21,1194,131,0],[1195,21,1195,27,0],[1197,9,1197,10,0]]);
    </script>
  </body>
</html>