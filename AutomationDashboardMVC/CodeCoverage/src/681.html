<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Business Layer\BL\UserComponent.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Aurigo.AMP3.Common;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.AMP3.Logging;
using Aurigo.AMP3.Resources.MessageResources;
using Aurigo.AMP3.UserManagementDTO;
using Aurigo.Brix.DataAccess.Core;
using Aurigo.Brix.Platform.BusinessLayer.DataAccessHelper;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.Common;
using Aurigo.Common.Utility;
using CacheProvider;
using System;
using System.Collections;
using System.Collections.Generic;
using System.Data;
using System.Data.Common;
using System.Linq;

namespace Aurigo.AMP3.UserManagementDAC
{
    /// &lt;summary&gt;
    /// Class for all the methods that access the database
    /// &lt;/summary&gt;
    internal class UserComponent : SingletonManagerBase&lt;UserComponent&gt;
    {
        //private SqlDatabase db;


        private UserComponent()
        {
        }

        //checks whether user is active and unlocked and also if user account duration is valid
        internal bool CheckAccountValidity(int uid)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTCheckAccountValidity&quot;);

                    conn.DB.AddInParameter(cmd, &quot;UID&quot;, DbType.Int32, uid);
                    conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                    conn.DB.ExecuteScalar(cmd);

                    return (conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2() &gt; 0);
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        //Checks whether the email is present into the system
        internal bool CheckUserEmail(string email)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTCheckUserEmail&quot;);

                    conn.DB.AddInParameter(cmd, &quot;EMAIL&quot;, DbType.String, email);
                    conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);

                    conn.DB.ExecuteScalar(cmd);
                    return (conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2() == 1);
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        //gets the emails of all administrators
        internal Dictionary&lt;int, string&gt; GetAdminEmail()
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    var AdminEmails = new Dictionary&lt;int, string&gt;();
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetAdminEmail&quot;);

                    using (IDataReader dr = conn.DB.ExecuteReader(cmd))
                    {
                        while (dr.Read())
                            AdminEmails.Add(dr.GetInt32(0), dr.GetString(1));
                    }
                    return AdminEmails;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal string ForgotPassword(string userID, string email)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetUserPassword&quot;);

                    conn.DB.AddInParameter(cmd, &quot;USERNAME&quot;, DbType.String, userID);
                    conn.DB.AddInParameter(cmd, &quot;EMAIL&quot;, DbType.String, email);
                    conn.DB.AddOutParameter(cmd, &quot;PWD&quot;, DbType.String, 50);
                    conn.DB.ExecuteScalar(cmd);

                    return conn.DB.GetParameterValue(cmd, &quot;PWD&quot;).ToString2();
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }


        internal int GetUsersRoleId(string rolename)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetUsersRoleId&quot;);

                    conn.DB.AddInParameter(cmd, &quot;ROLENAME&quot;, DbType.String, rolename);
                    conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                    conn.DB.ExecuteScalar(cmd);

                    return conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal Dictionary&lt;int, string&gt; GetUsersInRole(int roleid)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    var activeUserColl = new Dictionary&lt;int, string&gt;();
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetUsersInRole&quot;);

                    conn.DB.AddInParameter(cmd, &quot;ROLEID&quot;, DbType.Int32, roleid);

                    using (IDataReader dr = conn.DB.ExecuteReader(cmd))
                    {
                        while (dr.Read()) //populate columns of dictionary from dataset
                            activeUserColl.Add(dr.GetInt32(0), dr.GetString(1));
                    }

                    return activeUserColl;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal DataTable GetUsersBasedOnRole(int roleid)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetUsersInRole&quot;);
                    conn.DB.AddInParameter(cmd, &quot;ROLEID&quot;, DbType.Int32, roleid);
                    return conn.DB.ExecuteDataSet(cmd).Tables[0];
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        //Adding users to role specified by roleid
        internal int AddUsersToRole(int roleid, int uid)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTAddUsersToRole&quot;);

                    conn.DB.AddInParameter(cmd, &quot;ROLEID&quot;, DbType.Int32, roleid);
                    conn.DB.AddInParameter(cmd, &quot;USERID&quot;, DbType.Int32, uid);
                    conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                    conn.DB.ExecuteScalar(cmd);

                    return (conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2() &gt; 0) ? 1 : 0;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal DataTable GetRole(int roleid)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetRole&quot;);
                    conn.DB.AddInParameter(cmd, &quot;ROLEID&quot;, DbType.Int32, roleid);
                    return conn.DB.ExecuteDataSet(cmd).Tables[0];
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal DataTable GetRoleNames(string roleids)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetRoleNames&quot;);
                    conn.DB.AddInParameter(cmd, &quot;ROLEID&quot;, DbType.String, roleids);
                    return conn.DB.ExecuteDataSet(cmd).Tables[0];
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        /// &lt;summary&gt;
        /// This method will give all the users available in DB.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        internal DataTable GetAllUsers()
        {

            {
                DataSet ds = ComponentHelper.Instance.ExecuteDataSet(StoredProcedure.usp_USRMGMTGetAllUsers, null);
                if (ds != null &amp;&amp; ds.Tables.Count &gt; 0 &amp;&amp; ds.Tables[0] != null)
                    return ds.Tables[0];
                else return new DataTable();
            }
        }

        internal int UpdateRole(Role roleDTO)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTUpdateRole&quot;);

                    conn.DB.AddInParameter(cmd, &quot;ROLEID&quot;, DbType.Int32, roleDTO.RoleId);
                    conn.DB.AddInParameter(cmd, &quot;ROLENAME&quot;, DbType.String, roleDTO.RoleName);
                    conn.DB.AddInParameter(cmd, &quot;ROLEDESC&quot;, DbType.String, roleDTO.RoleDescription);
                    conn.DB.AddInParameter(cmd, &quot;CreateFrom&quot;, DbType.String, roleDTO.CreateFrom);
                    conn.DB.AddInParameter(cmd, &quot;Permissions&quot;, DbType.String, roleDTO.Permissions);
                    conn.DB.AddInParameter(cmd, &quot;AUR_ModifiedBy&quot;, DbType.Int32, roleDTO.AUR_ModifiedBy);
                    conn.DB.AddInParameter(cmd, &quot;AUR_ModifiedOn&quot;, DbType.DateTime, roleDTO.AUR_ModifiedOn);
                    conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                    conn.DB.ExecuteScalar(cmd);

                    return (conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2() &gt; 0) ? 1 : 0;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal string GetUserName(int uid)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    string username;
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetUserName&quot;);

                    conn.DB.AddInParameter(cmd, &quot;USERID&quot;, DbType.Int32, uid);
                    conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.String, 1000);
                    conn.DB.ExecuteScalar(cmd);

                    username = conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2();
                    return String.IsNullOrEmpty(username) ? &quot;0&quot; : username;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal User GetAUser(string userid)
        {
            Hashtable ht = GetUserHT(userid);
            Int32 uid = 0;
            if (Int32.TryParse(ht[&quot;UID&quot;].ToString2(), out uid))
                return GetAUser(uid);
            else
                return null;
        }

        internal User GetAUser(int uid)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetAUser&quot;);
                    var UserDTO = new User();

                    conn.DB.AddInParameter(cmd, &quot;USERID&quot;, DbType.String, uid.ToString2());

                    using (IDataReader dr = conn.DB.ExecuteReader(cmd))
                    {
                        while (dr.Read())
                        {
                            UserDTO.UserId = uid;
                            UserDTO.FirstName = dr[0].ToString2();
                            UserDTO.MiddleName = dr[1].ToString2();
                            UserDTO.LastName = dr[2].ToString2();
                            UserDTO.CompanyName = dr[3].ToString2();
                            UserDTO.UserName = dr[4].ToString2();
                            UserDTO.Password = dr[5].ToString2();
                            UserDTO.Email = dr[6].ToString2();
                            UserDTO.Telephone = dr[7].ToString2();
                            UserDTO.Fax = dr[8].ToString2();
                            UserDTO.Address1 = dr[9].ToString2();
                            UserDTO.Address2 = dr[10].ToString2();
                            UserDTO.Address3 = dr[11].ToString2();
                            UserDTO.City = dr[12].ToString2();
                            UserDTO.State = dr[13].ToString2();
                            UserDTO.Zipcode = dr[14].ToString2();
                            UserDTO.IsActive = dr.GetBoolean(15);
                            UserDTO.ExpiryDate = dr.GetDateTime(16);
                            UserDTO.CertNo = dr[&quot;CertNo&quot;].ToString2();
                            UserDTO.WebUser = dr[&quot;WebUser&quot;].ToInt32_2();
                            UserDTO.MobileUser = dr[&quot;MobileUser&quot;].ToInt32_2();
                            UserDTO.MobileNo = dr[&quot;MobileNo&quot;].ToString2();
                            UserDTO.IsSMS = dr[&quot;IsSMS&quot;].ToBoolean2();
                            UserDTO.Country = dr[&quot;Country&quot;].ToString2();
                            UserDTO.PasswordLastChangedOn = dr[&quot;PasswordLastChangedOn&quot;] == DBNull.Value
                                ? null
                                : (DateTime?)dr[&quot;PasswordLastChangedOn&quot;].ToDateTime_MWCulture();
                            UserDTO.RegDate = dr[&quot;RegistrationDate&quot;].ToDateTime_MWCulture();
                            UserDTO.BusinessUnit = dr[&quot;BusinessUnits&quot;].ToString2();
                            if (dr[&quot;IsADUser&quot;] != DBNull.Value)
                                UserDTO.IsADUser = dr[&quot;IsADUser&quot;].ToBoolean2();
                            UserDTO.IsADACompliant= dr[&quot;IsADACompliant&quot;].ToBoolean2();
                            //if (dr[&quot;SendEmail&quot;] != null &amp;&amp; ! String.IsNullOrEmpty(dr[&quot;SendEmail&quot;].ToString2())  )
                            //    UserDTO.SendEmail = BrixDatatypeHelper.ToBoolean2(dr[&quot;SendEmail&quot;].ToString2());
                            //else
                            //    UserDTO.SendEmail = false;
                            //get all roles for this user
                            Dictionary&lt;int, string&gt; userroles = GetAssignedRolesOfUser(uid);
                            string csvrole = &quot;&quot;;

                            if (userroles.Count != 0)
                            {
                                foreach (var kvp in userroles)
                                    csvrole += kvp.Value.ToString2() + &quot;, &quot;;

                                csvrole = csvrole.Substring(0, csvrole.Length - 2);
                                UserDTO.RoleIDs = csvrole;
                            }
                        }
                    }
                    return UserDTO;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal Hashtable GetUserHT(int uid)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetAUser&quot;);
                    Hashtable UserHT;

                    conn.DB.AddInParameter(cmd, &quot;USERID&quot;, DbType.String, uid.ToString2());

                    using (IDataReader dr = conn.DB.ExecuteReader(cmd))
                    {
                        UserHT = new Hashtable();
                        while (dr.Read())
                        {
                            UserHT.Add(&quot;FirstName&quot;, dr[&quot;FirstName&quot;].ToString2());
                            UserHT.Add(&quot;MiddleName&quot;, dr[&quot;MiddleName&quot;].ToString2());
                            UserHT.Add(&quot;LastName&quot;, dr[&quot;LastName&quot;].ToString2());
                            UserHT.Add(&quot;CompanyName&quot;, dr[&quot;CompanyName&quot;].ToString2());
                            UserHT.Add(&quot;UserID&quot;, dr[&quot;Username&quot;].ToString2());
                            UserHT.Add(&quot;Password&quot;, dr[&quot;Password&quot;].ToString2());
                            UserHT.Add(&quot;Email&quot;, dr[&quot;Email&quot;].ToString2());
                            UserHT.Add(&quot;Telephone&quot;, dr[&quot;Telephone&quot;].ToString2());
                            UserHT.Add(&quot;Fax&quot;, dr[&quot;Fax&quot;].ToString2());
                            UserHT.Add(&quot;Address1&quot;, dr[&quot;Address1&quot;].ToString2());
                            UserHT.Add(&quot;Address2&quot;, dr[&quot;Address2&quot;].ToString2());
                            UserHT.Add(&quot;Address3&quot;, dr[&quot;Address3&quot;].ToString2());
                            UserHT.Add(&quot;City&quot;, dr[&quot;City&quot;].ToString2());
                            UserHT.Add(&quot;State&quot;, dr[&quot;State&quot;].ToString2());
                            UserHT.Add(&quot;Zipcode&quot;, dr[&quot;Zipcode&quot;].ToString2());
                            UserHT.Add(&quot;IsActive&quot;, dr.GetBoolean(15));
                            UserHT.Add(&quot;ExpiryDate&quot;, dr.GetDateTime(16));
                            UserHT.Add(&quot;IsLocked&quot;, dr.GetBoolean(17));
                            UserHT.Add(&quot;IsRegistered&quot;, dr.GetBoolean(18));
                            UserHT.Add(&quot;RegistrationDate&quot;, dr.GetDateTime(19));
                            UserHT.Add(&quot;CertNo&quot;, dr[&quot;CertNo&quot;].ToString2());
                            UserHT.Add(&quot;UID&quot;, dr[&quot;UserId&quot;].ToString2());
                            if (dr[&quot;IsADUser&quot;] == DBNull.Value)
                                UserHT.Add(&quot;IsADUser&quot;, false);
                            else
                                UserHT.Add(&quot;IsADUser&quot;, dr[&quot;IsADUser&quot;].ToBoolean2());
                            UserHT.Add(&quot;IsADACompliant&quot;, dr[&quot;IsADACompliant&quot;].ToBoolean2());
                        }
                    }
                    return UserHT;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal Hashtable GetUserHT(string userContact, string email = null)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetUserFromContact&quot;);
                    conn.DB.AddInParameter(cmd, &quot;UserName&quot;, DbType.String, userContact);
                    if (!string.IsNullOrEmpty(email))
                    {
                        conn.DB.AddInParameter(cmd, &quot;Email&quot;, DbType.String, email);
                    }

                    using (IDataReader dr = conn.DB.ExecuteReader(cmd))
                    {
                        Hashtable UserHT = new Hashtable();
                        if (dr.Read())
                        {
                            UserHT.Add(&quot;UID&quot;, dr[&quot;Userid&quot;].ToString2());
                            UserHT.Add(&quot;FirstName&quot;, dr[&quot;FirstName&quot;].ToString2());
                            UserHT.Add(&quot;MiddleName&quot;, dr[&quot;MiddleName&quot;].ToString2());
                            UserHT.Add(&quot;LastName&quot;, dr[&quot;LastName&quot;].ToString2());
                            UserHT.Add(&quot;CompanyName&quot;, dr[&quot;CompanyName&quot;].ToString2());
                            UserHT.Add(&quot;UserID&quot;, dr[&quot;Username&quot;].ToString2());
                            UserHT.Add(&quot;Password&quot;, dr[&quot;Password&quot;].ToString2());
                            UserHT.Add(&quot;Email&quot;, dr[&quot;Email&quot;].ToString2());
                            UserHT.Add(&quot;Telephone&quot;, dr[&quot;Telephone&quot;].ToString2());
                            UserHT.Add(&quot;Fax&quot;, dr[&quot;Fax&quot;].ToString2());
                            UserHT.Add(&quot;Address1&quot;, dr[&quot;Address1&quot;].ToString2());
                            UserHT.Add(&quot;Address2&quot;, dr[&quot;Address2&quot;].ToString2());
                            UserHT.Add(&quot;Address3&quot;, dr[&quot;Address3&quot;].ToString2());
                            UserHT.Add(&quot;City&quot;, dr[&quot;City&quot;].ToString2());
                            UserHT.Add(&quot;State&quot;, dr[&quot;State&quot;].ToString2());
                            UserHT.Add(&quot;Zipcode&quot;, dr[&quot;Zipcode&quot;].ToString2());
                            UserHT.Add(&quot;IsActive&quot;, dr.GetBoolean(16));
                            UserHT.Add(&quot;ExpiryDate&quot;, dr.GetDateTime(17));
                            UserHT.Add(&quot;IsLocked&quot;, dr.GetBoolean(18));
                            UserHT.Add(&quot;IsRegistered&quot;, dr.GetBoolean(19));
                            UserHT.Add(&quot;RegistrationDate&quot;, dr.GetDateTime(20));
                            UserHT.Add(&quot;CertNo&quot;, dr[&quot;CertNo&quot;].ToString2());
                            if (dr[&quot;IsADUser&quot;] == DBNull.Value)
                                UserHT.Add(&quot;IsADUser&quot;, false);
                            else
                                UserHT.Add(&quot;IsADUser&quot;, dr[&quot;IsADUser&quot;].ToBoolean2());
                            UserHT.Add(&quot;IsADACompliant&quot;, dr[&quot;IsADACompliant&quot;].ToBoolean2());
                        }
                        return UserHT;
                    }
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal Dictionary&lt;int, string&gt; GetUnassignedUserRoles(int uid)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    var userroles = new Dictionary&lt;int, string&gt;();
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetUserRoles&quot;);

                    conn.DB.AddInParameter(cmd, &quot;USERID&quot;, DbType.Int32, uid);

                    using (IDataReader dr = conn.DB.ExecuteReader(cmd))
                    {
                        while (dr.Read()) // Populate dictionary
                            userroles.Add(dr.GetInt32(0), dr.GetString(1));
                    }
                    return userroles;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal Dictionary&lt;int, string&gt; GetAssignedRolesOfUser(int uid)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    var savedroles = new Dictionary&lt;int, string&gt;();
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetRolesOfUser&quot;);

                    conn.DB.AddInParameter(cmd, &quot;USERID&quot;, DbType.Int32, uid);

                    using (IDataReader dr = conn.DB.ExecuteReader(cmd))
                    {
                        while (dr.Read()) //populate columns of dictionary from dataset
                            savedroles.Add(dr.GetInt32(0), dr.GetString(1));
                    }
                    return savedroles;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        //Adding roles to user specified by uid
        internal int AddRolesToUser(int uid, int roleid, int approvingUserID)
        {
            try
            {
                var dic = new Dictionary&lt;string, object&gt;();
                var Aur_ModifiedBy = approvingUserID;
                var Aur_ModifiedOn = DateTime.UtcNow;
                ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                    StoredProcedure.usp_USRMGMTAddRolesToUser, dic, roleid, uid, Aur_ModifiedBy, Aur_ModifiedOn);
                int retValue;
                int.TryParse(dic[&quot;Status&quot;].ToString2(), out retValue);
                return retValue;
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        //deletes uerid with ids in userids
        internal int DeleteUser(int uid)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTDeleteUser&quot;);

                    conn.DB.AddInParameter(cmd, &quot;USERID&quot;, DbType.Int32, uid);
                    conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                    conn.DB.ExecuteScalar(cmd);

                    return conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal int UpdateUser(User UserDTO)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTUpdateUser&quot;);

                    conn.DB.AddInParameter(cmd, &quot;FIRSTNAME&quot;, DbType.String, UserDTO.FirstName);
                    conn.DB.AddInParameter(cmd, &quot;MIDDLENAME&quot;, DbType.String, UserDTO.MiddleName);
                    conn.DB.AddInParameter(cmd, &quot;LASTNAME&quot;, DbType.String, UserDTO.LastName);
                    conn.DB.AddInParameter(cmd, &quot;COMPANYNAME&quot;, DbType.String, UserDTO.CompanyName);
                    conn.DB.AddInParameter(cmd, &quot;USERNAME&quot;, DbType.String, UserDTO.UserName);
                    conn.DB.AddInParameter(cmd, &quot;PASSWORD&quot;, DbType.String, UserDTO.Password);
                    conn.DB.AddInParameter(cmd, &quot;EMAIL&quot;, DbType.String, UserDTO.Email);
                    conn.DB.AddInParameter(cmd, &quot;ADDRESS1&quot;, DbType.String, UserDTO.Address1);
                    conn.DB.AddInParameter(cmd, &quot;ADDRESS2&quot;, DbType.String, UserDTO.Address2);
                    conn.DB.AddInParameter(cmd, &quot;ADDRESS3&quot;, DbType.String, UserDTO.Address3);
                    conn.DB.AddInParameter(cmd, &quot;CITY&quot;, DbType.String, UserDTO.City);
                    conn.DB.AddInParameter(cmd, &quot;STATE&quot;, DbType.String, UserDTO.State);
                    conn.DB.AddInParameter(cmd, &quot;ZIPCODE&quot;, DbType.String, UserDTO.Zipcode);
                    conn.DB.AddInParameter(cmd, &quot;TELEPHONE&quot;, DbType.String, UserDTO.Telephone);
                    conn.DB.AddInParameter(cmd, &quot;FAX&quot;, DbType.String, UserDTO.Fax);
                    conn.DB.AddInParameter(cmd, &quot;USERID&quot;, DbType.Int32, UserDTO.UserId);
                    conn.DB.AddInParameter(cmd, &quot;ISACTIVE&quot;, DbType.Boolean, UserDTO.IsActive);
                    conn.DB.AddInParameter(cmd, &quot;EXPDATE&quot;, DbType.DateTime, UserDTO.ExpiryDate);
                    conn.DB.AddInParameter(cmd, &quot;CERTNO&quot;, DbType.String, UserDTO.CertNo);
                    conn.DB.AddInParameter(cmd, &quot;WEBUSER&quot;, DbType.Boolean, UserDTO.WebUser);
                    conn.DB.AddInParameter(cmd, &quot;MOBILEUSER&quot;, DbType.Boolean, UserDTO.MobileUser);
                    //conn.DB.AddInParameter(cmd, &quot;SENDEMAIL&quot;, DbType.Boolean, UserDTO.SendEmail);
                    conn.DB.AddInParameter(cmd, &quot;MOBILENO&quot;, DbType.String, UserDTO.MobileNo);
                    conn.DB.AddInParameter(cmd, &quot;ISSMS&quot;, DbType.Boolean, UserDTO.IsSMS);
                    conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                    conn.DB.AddInParameter(cmd, &quot;COUNTRY&quot;, DbType.String, UserDTO.Country);
                    conn.DB.AddInParameter(cmd, &quot;PasswordLastChangedOn&quot;, DbType.DateTime,
                        UserDTO.PasswordLastChangedOn.HasValue ? (DateTime?)UserDTO.PasswordLastChangedOn.Value : null);
                    conn.DB.AddInParameter(cmd, &quot;AUR_ModifiedBy&quot;, DbType.Int32, UserDTO.AUR_ModifiedBy);
                    conn.DB.AddInParameter(cmd, &quot;AUR_ModifiedOn&quot;, DbType.DateTime, UserDTO.AUR_ModifiedOn);
                    conn.DB.AddInParameter(cmd, &quot;IsADACompliant&quot;, DbType.Boolean, UserDTO.IsADACompliant);
                    conn.DB.ExecuteScalar(cmd);

                    return conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal int ActivateUser(int uid)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTActivateUser&quot;);

                    conn.DB.AddInParameter(cmd, &quot;USERID&quot;, DbType.Int32, uid);
                    conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                    conn.DB.ExecuteScalar(cmd);

                    return conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal Dictionary&lt;int, object&gt; GetPendingUsers()
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    var pendingusercoll = new Dictionary&lt;int, object&gt;();
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetPendingUsers&quot;);

                    using (IDataReader dr = conn.DB.ExecuteReader(cmd))
                    {
                        while (dr.Read())
                        {
                            var DTOobj = new User();

                            //populate all fields of DTO object from dataset
                            DTOobj.UserId = dr.GetInt32(0);
                            DTOobj.FirstName = dr[1].ToString2();
                            DTOobj.MiddleName = dr[2].ToString2();
                            DTOobj.LastName = dr[3].ToString2();
                            DTOobj.UserName = dr[4].ToString2();
                            DTOobj.Email = dr[5].ToString2();
                            DTOobj.RegDate = dr.GetDateTime(6);
                            DTOobj.CertNo = dr[&quot;CertNo&quot;].ToString2();
                            pendingusercoll.Add(dr.GetInt32(0), DTOobj);
                        }
                    }
                    return pendingusercoll;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        //setting isregistered to 1 
        internal int ApproveUser(string uids)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    int result;
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTApproveUser&quot;);
                    conn.DB.AddInParameter(cmd, &quot;USERIDS&quot;, DbType.String, uids);
                    conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                    conn.DB.ExecuteScalar(cmd);

                    result = conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();

                    if (result == 1)
                    {
                        //add default role to user
                        string[] csvuids = uids.Split(&#39;,&#39;);
                        for (int i = 0; i &lt; csvuids.Length; i++)
                            if (UserDetail.GetCurrentUserDetail() == null)
                                AddRolesToUser(csvuids[i].ToInt32_2(), Constants.USRMGMT_USER_RID, 1);
                            else
                                AddRolesToUser(csvuids[i].ToInt32_2(), Constants.USRMGMT_USER_RID, UserDetail.GetCurrentUserDetail().UID);
                    }

                    return result;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        //deleting users who are rejected
        internal int RejectUser(string uids)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTRejectUser&quot;);

                    conn.DB.AddInParameter(cmd, &quot;USERIDS&quot;, DbType.String, uids);
                    conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                    conn.DB.ExecuteScalar(cmd);

                    return conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        //deletes existing users for role
        internal int DeleteRoleUsers(int roleid)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    int result;
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTDeleteRoleUsers&quot;);

                    conn.DB.AddInParameter(cmd, &quot;ROLEID&quot;, DbType.Int32, roleid);
                    conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                    conn.DB.ExecuteScalar(cmd);

                    result = conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();
                    return result == 1 ? 1 : result;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        //deletes existing roles for user
        internal int DeleteUserRoles(int uid)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    int result;
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTDeleteUserRoles&quot;);

                    conn.DB.AddInParameter(cmd, &quot;USERID&quot;, DbType.Int32, uid);
                    conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                    conn.DB.ExecuteScalar(cmd);

                    result = conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();
                    return result == 1 ? 1 : result;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal int DeleteUserRole(int uId, int rId)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    int result;
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTDeleteUserRole&quot;);

                    conn.DB.AddInParameter(cmd, &quot;UserID&quot;, DbType.Int32, uId);
                    conn.DB.AddInParameter(cmd, &quot;RoleID&quot;, DbType.Int32, rId);
                    conn.DB.AddOutParameter(cmd, &quot;Status&quot;, DbType.Int32, 4);
                    conn.DB.ExecuteScalar(cmd);

                    result = conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();
                    return result == 1 ? 1 : result;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal Dictionary&lt;int, string&gt; GetRoles()
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    var rolecollection = new Dictionary&lt;int, string&gt;();
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetAllRoles&quot;);

                    using (IDataReader dr = conn.DB.ExecuteReader(cmd))
                    {
                        while (dr.Read())
                            rolecollection.Add(dr[&quot;RoleId&quot;].ToInt32_2(), dr[&quot;RoleName&quot;].ToString2());
                    }
                    return rolecollection;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal DataTable GetRolesDataTable()
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetAllRoles&quot;);
                DataSet ds = conn.DB.ExecuteDataSet(cmd);
                if (ds.Tables.Count &gt; 0)
                    return (ds.Tables[0]);
                else
                    return (new DataTable());
            }
        }

        internal Dictionary&lt;string, string&gt; GetUserSettings()
        {
            Dictionary&lt;string, string&gt; settings = CacheBroker.Get&lt;Dictionary&lt;string, string&gt;&gt;(RedisKeyConstants.GetSettings, regionName: AMP3ApplicationSettings.Instance.RedisRegionName);

            return (settings != null &amp;&amp; settings.Count &gt; 0) ? settings : UpdateSettingsCache();
        }

        internal DataSet GetADSettings()
        {
            return ComponentHelper.Instance.ExecuteDataSet(StoredProcedure.usp_USRMGMTGetADSettings, null);
        }

        private Dictionary&lt;string, string&gt; UpdateSettingsCache()
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    var SettingsHT = new Dictionary&lt;string, string&gt;();

                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetSettings&quot;);
                    using (IDataReader dr = conn.DB.ExecuteReader(cmd))
                    {
                        while (dr.Read())
                            SettingsHT.Add(dr.GetString(0), dr.GetString(1));

                        CacheBroker.Put(RedisKeyConstants.GetSettings, SettingsHT, timeout: TimeSpan.FromMinutes(AMP3ApplicationSettings.Instance.SessionTimeout)
                            , regionName: AMP3ApplicationSettings.Instance.RedisRegionName);
                    }
                    return SettingsHT;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal int UpdateSettings(Dictionary&lt;string, string&gt; Settingsht)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    int result = 0;

                    foreach (var kvp in Settingsht)
                    {
                        DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTUpdateSettings&quot;);
                        conn.DB.AddInParameter(cmd, &quot;SETTINGNAME&quot;, DbType.String, kvp.Key);
                        conn.DB.AddInParameter(cmd, &quot;SETTINGVAL&quot;, DbType.String, kvp.Value);
                        conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                        conn.DB.ExecuteScalar(cmd);
                        result = conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToInt32_2();
                    }

                    if (result == 1)
                        UpdateSettingsCache();

                    return result;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal int ADUpdateSettings(string Server, string Domain, string UserName, string Password,
            string ImportFilter, string ImportFilterGroup, string DirectorySearcher)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    int result = 0;

                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_ADUpdateSettings&quot;);
                    conn.DB.AddInParameter(cmd, &quot;Server&quot;, DbType.String, Server);
                    conn.DB.AddInParameter(cmd, &quot;Domain&quot;, DbType.String, Domain);
                    conn.DB.AddInParameter(cmd, &quot;UserName&quot;, DbType.String, UserName);
                    conn.DB.AddInParameter(cmd, &quot;Pwd&quot;, DbType.String, Password);
                    conn.DB.AddInParameter(cmd, &quot;ImportFilter&quot;, DbType.String, ImportFilter);
                    conn.DB.AddInParameter(cmd, &quot;ImportFilterGroup&quot;, DbType.String, ImportFilterGroup);
                    conn.DB.AddInParameter(cmd, &quot;DirectorySearcher&quot;, DbType.String, DirectorySearcher);
                    conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                    conn.DB.ExecuteScalar(cmd);
                    result = conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToInt32_2();

                    return result;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        //locks the user from logging in to insite3.0
        internal int LockUser(int uid)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTLockUser&quot;);

                    conn.DB.AddInParameter(cmd, &quot;USERID&quot;, DbType.Int32, uid);
                    conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                    conn.DB.ExecuteScalar(cmd);

                    return conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToInt32_2();
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        //unlocks user 
        internal int UnlockUser(int uid)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTUnlockUser&quot;);

                    conn.DB.AddInParameter(cmd, &quot;USERID&quot;, DbType.Int32, uid);
                    conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                    conn.DB.ExecuteScalar(cmd);

                    return conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal DataTable GetUserSummary()
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetUserSummary&quot;);

                    return conn.DB.ExecuteDataSet(cmd).Tables[0];
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        /// &lt;summary&gt;
        /// ggets the complete details of all the users or requested users (for QSR))
        /// &lt;/summary&gt;
        /// &lt;returns&gt;Dictionary&lt;int,string&gt;(key-uid,value-username)&lt;/returns&gt;
        internal DataTable GetAllUsersDetails(string userlist)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetAllActiveUsers&quot;);

                    if (!String.IsNullOrEmpty(userlist))
                        conn.DB.AddInParameter(cmd, &quot;Userlist&quot;, DbType.String, userlist);

                    return conn.DB.ExecuteDataSet(cmd).Tables[0];
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal DataTable SearchActiveUsers(int currentUserId, string searchText, bool isFilterBidder)
        {
            int totalCount = 0;
            return SearchActiveUsers_ByPaging(currentUserId, searchText, isFilterBidder, 0, 0, ref totalCount);
        }

        internal DataTable SearchActiveUsers_ByPaging(int currentUserId, string searchText, bool isFilterBidder, int maxRowsInPage, int lastKnownOffset, ref int totalCount)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTSearchActiveUsers&quot;);

                    conn.DB.AddInParameter(cmd, &quot;@CurrentUserId&quot;, DbType.Int32, currentUserId);
                    conn.DB.AddInParameter(cmd, &quot;@SearchText&quot;, DbType.String, searchText);
                    conn.DB.AddInParameter(cmd, &quot;@IsFilterBidder&quot;, DbType.Boolean, isFilterBidder);
                    conn.DB.AddInParameter(cmd, &quot;@MaxRowsInPage&quot;, DbType.Int32, maxRowsInPage);
                    conn.DB.AddInParameter(cmd, &quot;@LastKnownOffset&quot;, DbType.Int32, lastKnownOffset);
                    conn.DB.AddOutParameter(cmd, &quot;@TotalCount&quot;, DbType.Int32, totalCount);

                    DataSet userDT = conn.DB.ExecuteDataSet(cmd);

                    if (conn.DB.GetParameterValue(cmd, &quot;@TotalCount&quot;) != DBNull.Value)
                        totalCount = conn.DB.GetParameterValue(cmd, &quot;@TotalCount&quot;).ToString2().ToInt32_2();
                    else
                        totalCount = 0;

                    return userDT.Tables[0];
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        /// &lt;summary&gt;
        /// gets the uid and username from the DB in the form of a Dictionary(for DWR2)
        /// &lt;/summary&gt;
        /// &lt;returns&gt;Dictionary&lt;int,string&gt;(key-uid,value-username)&lt;/returns&gt;
        internal Dictionary&lt;int, string&gt; GetAllUsersDT(bool filterBidder = false)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    var userDT = new Dictionary&lt;int, string&gt;();
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetAllActiveUsers&quot;);
                    conn.DB.AddInParameter(cmd, &quot;@FilterBidder&quot;, DbType.Boolean, filterBidder);
                    using (IDataReader dr = conn.DB.ExecuteReader(cmd))
                    {
                        while (dr.Read())
                        {
                            //populate dictionary key - uid,value - username
                            string fullname;
                            if (!String.IsNullOrEmpty(dr[2].ToString2()))
                                fullname = dr[1].ToString2() + &quot; &quot; + dr[2].ToString2() + &quot; &quot; + dr[3].ToString2();
                            else
                                fullname = dr[1].ToString2() + &quot; &quot; + dr[3].ToString2();

                            userDT.Add(dr.GetInt32(0), fullname);
                        }
                    }

                    return userDT;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal DataTable GetUserDetails(bool filterBidder = false)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetAllActiveUsers&quot;);
                    conn.DB.AddInParameter(cmd, &quot;@FilterBidder&quot;, DbType.Boolean, filterBidder);
                    return conn.DB.ExecuteDataSet(cmd).Tables[0];
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal DataTable GetUsersForProjectManageUsersByPagination(bool isFetchProjectUsersOnly, int projectId,
            int maxRowsInPage, int currentPage, ref int totalCount,
            string filterText, string sortOrder,
            bool isFilterBidder = false, string userIdToFilterCSV = null)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetUsersForProjectManageUsersByPagination&quot;);
                    //this is a distinguising factor
                    conn.DB.AddInParameter(cmd, &quot;@IsFetchProjectUsersOnly&quot;, DbType.Boolean, isFetchProjectUsersOnly);
                    conn.DB.AddInParameter(cmd, &quot;@ProjectId&quot;, DbType.Int32, projectId);

                    conn.DB.AddInParameter(cmd, &quot;@IsFilterBidder&quot;, DbType.Boolean, isFilterBidder);

                    conn.DB.AddInParameter(cmd, &quot;@MaxRowsInPage&quot;, DbType.Int32, maxRowsInPage);
                    conn.DB.AddInParameter(cmd, &quot;@CurrentPage&quot;, DbType.Int32, currentPage);
                    conn.DB.AddOutParameter(cmd, &quot;@TotalCount&quot;, DbType.Int32, totalCount);

                    conn.DB.AddInParameter(cmd, &quot;@FilterText&quot;, DbType.String, filterText);
                    conn.DB.AddInParameter(cmd, &quot;@SortOrder&quot;, DbType.String, sortOrder);

                    if (!string.IsNullOrEmpty(userIdToFilterCSV))
                        conn.DB.AddInParameter(cmd, &quot;@UserFilterList&quot;, DbType.String, null); //not used as of now.

                    DataSet ds = conn.DB.ExecuteDataSet(cmd);

                    totalCount = conn.DB.GetParameterValue(cmd, &quot;@TotalCount&quot;).ToString2().ToInt32_2();

                    return ds.Tables[0];
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }


        //internal DataTable GetUSRMGMTGetAllActiveUsersByPagination(string filterText, int maxRowsInPage, 
        //    string sortOrder, ref int currentPage, ref int totalCount, int projectId, bool filterBidder = false)
        //{
        //    try
        //    {
        //        using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
        //        {
        //            DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetUsersForProjectManageUsersByPagination&quot;);
        //            //this is a distinguising factor
        //            conn.DB.AddInParameter(cmd, &quot;@IsFetchProjectUsersOnly&quot;, DbType.Boolean, true);
        //            conn.DB.AddInParameter(cmd, &quot;@ProjectId&quot;, DbType.Int32, projectId);

        //            conn.DB.AddInParameter(cmd, &quot;@IsFilterBidder&quot;, DbType.Boolean, filterBidder);

        //            conn.DB.AddInParameter(cmd, &quot;@MaxRowsInPage&quot;, DbType.Int32, maxRowsInPage);
        //            conn.DB.AddInParameter(cmd, &quot;@CurrentPage&quot;, DbType.Int32, currentPage);
        //            conn.DB.AddOutParameter(cmd, &quot;@TotalCount&quot;, DbType.Int32, totalCount);

        //            conn.DB.AddInParameter(cmd, &quot;@FilterText&quot;, DbType.String, filterText);
        //            conn.DB.AddInParameter(cmd, &quot;@SortOrder&quot;, DbType.String, sortOrder);
        //            //conn.DB.AddInParameter(cmd, &quot;@UserFilterList&quot;, DbType.String, null); //not used as of now.

        //            DataSet ds = conn.DB.ExecuteDataSet(cmd);

        //            totalCount = conn.DB.GetParameterValue(cmd, &quot;@TotalCount&quot;).ToString2().ToInt32_2();

        //            return ds.Tables[0];
        //        }
        //    }
        //    catch (Exception ex)
        //    {
        //        Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
        //        throw;
        //    }
        //}

        //internal DataTable GetProjectUsersWithPrimaryByPagination(string filterText, int maxRowsInPage,
        //   string sortOrder, ref int currentPage, ref int totalCount, int projectId, bool filterBidder = false)
        //{
        //    try
        //    {
        //        using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
        //        {
        //            DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetUsersForProjectManageUsersByPagination&quot;);
        //            //this is a distinguising factor
        //            conn.DB.AddInParameter(cmd, &quot;@IsFetchProjectUsersOnly&quot;, DbType.Boolean, true);
        //            conn.DB.AddInParameter(cmd, &quot;@ProjectId&quot;, DbType.Int32, projectId);

        //            conn.DB.AddInParameter(cmd, &quot;@IsFilterBidder&quot;, DbType.Boolean, filterBidder);

        //            conn.DB.AddInParameter(cmd, &quot;@MaxRowsInPage&quot;, DbType.Int32, maxRowsInPage);
        //            conn.DB.AddInParameter(cmd, &quot;@CurrentPage&quot;, DbType.Int32, currentPage);
        //            conn.DB.AddOutParameter(cmd, &quot;@TotalCount&quot;, DbType.Int32, totalCount);

        //            conn.DB.AddInParameter(cmd, &quot;@FilterText&quot;, DbType.String, filterText);
        //            conn.DB.AddInParameter(cmd, &quot;@SortOrder&quot;, DbType.String, sortOrder);
        //            //conn.DB.AddInParameter(cmd, &quot;@UserFilterList&quot;, DbType.String, null); //not used as of now.

        //            DataSet ds = conn.DB.ExecuteDataSet(cmd);

        //            totalCount = conn.DB.GetParameterValue(cmd, &quot;@TotalCount&quot;).ToString2().ToInt32_2();

        //            return ds.Tables[0];
        //        }
        //    }
        //    catch (Exception ex)
        //    {
        //        Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
        //        throw;
        //    }
        //}


        /// &lt;summary&gt;
        /// gets the user login id from a uid.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;uid&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;string&lt;/returns&gt;
        internal string GetLoginId(int uid)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    string userid;

                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetLoginId&quot;);

                    conn.DB.AddInParameter(cmd, &quot;USERID&quot;, DbType.Int32, uid);
                    conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.String, 100);
                    conn.DB.ExecuteScalar(cmd);

                    userid = conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2();
                    return String.IsNullOrEmpty(userid) ? &quot;0&quot; : userid;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal int GetPasswordLength()
        {
            Dictionary&lt;string, string&gt; settings = GetUserSettings();
            string pwdformat = settings[&quot;PasswordFormat&quot;];
            //int indx = pwdformat.IndexOf(&quot;{&quot;);
            int comma = pwdformat.IndexOf(&quot;,&quot;, StringComparison.OrdinalIgnoreCase);
            int endbkt = pwdformat.IndexOf(&quot;}&quot;, StringComparison.OrdinalIgnoreCase);
            int pwdlength = pwdformat.Substring(comma + 1, endbkt - (comma + 1)).ToInt32_2();
            return pwdlength;
        }

        internal int UpdateUserPassword(string pwd, int uid)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTUpdateUserPassword&quot;);

                    conn.DB.AddInParameter(cmd, &quot;PASSWORD&quot;, DbType.String, pwd);
                    conn.DB.AddInParameter(cmd, &quot;USERID&quot;, DbType.Int32, uid);
                    conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                    conn.DB.ExecuteScalar(cmd);

                    return conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal bool IsUserRole(int uid, int roleid)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTIsUserRole&quot;);

                    conn.DB.AddInParameter(cmd, &quot;USERID&quot;, DbType.String, uid);
                    conn.DB.AddInParameter(cmd, &quot;ROLEID&quot;, DbType.String, roleid);
                    conn.DB.AddOutParameter(cmd, &quot;RESULT&quot;, DbType.Int32, 4);
                    conn.DB.ExecuteScalar(cmd);

                    return conn.DB.GetParameterValue(cmd, &quot;RESULT&quot;).ToString2().ToInt32_2() == 1 ? true : false;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal Dictionary&lt;string, string&gt; GetUserEmailIdByRole(int roleid)
        {
            try
            {
                var result = new Dictionary&lt;string, string&gt;();

                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetUsersEmailInRole&quot;);

                    conn.DB.AddInParameter(cmd, &quot;ROLEID&quot;, DbType.Int32, roleid);

                    using (IDataReader dr = conn.DB.ExecuteReader(cmd))
                    {
                        while (dr.Read()) //populate dictionary key - emailid,value - username
                            result.Add(dr.GetString(0), dr.GetString(1));
                    }
                    return result;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal int GetCountOfMobileUsers()
        {
            try
            {

                {
                    return
                        ComponentHelper.Instance.ExecuteScalar(StoredProcedure.usp_USRMGMTGetCountOfMobileUsers, null)
                            .ToInt32_2();
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        // This function is for the mobile. It checks whether the registered user is marked as mobile user.
        internal bool CheckForMobileUser(string userID, string password)
        {
            try
            {

                {
                    return
                        ComponentHelper.Instance.ExecuteScalar(StoredProcedure.usp_USRMGMTCheckForMobileUser, null,
                            userID, password).ToInt32_2() == 1
                            ? true
                            : false;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal bool IsUserOnlyMobileuser(string userID, string password)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    return
                        ComponentHelper.Instance.ExecuteScalar(StoredProcedure.usp_USRMGMTCheckIsUserOnlyMobileuser,
                            null, userID, password).ToInt32_2() == 1
                            ? true
                            : false;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal User GetUserDTO(string userName)
        {
            try
            {
                return (from usr in new CoreDb().Users
                        where usr.UserName == userName
                        select usr).Single();
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal User GetUserDTO(int uid)
        {
            try
            {
                return (from usr in new CoreDb().Users
                        where usr.UserId == uid
                        select usr).Single();
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        public DataTable GetAllPermissionsForRole(int? roleID)
        {
            return
                ComponentHelper.Instance.ExecuteDataSet(StoredProcedure.usp_USRMGMTGetAllPermissionsForRole, null,
                    roleID).Tables[0];
        }

        public int CheckForUniqueEmail(string email, string userName)
        {
            object count = ComponentHelper.Instance.ExecuteScalar(StoredProcedure.usp_USRMGMTCheckForUniqueEmail, null,
                email, userName, &quot;U&quot;);
            if (count != null)
                return count.ToInt32_2();
            else
                return 0;
        }

        public int CheckForUniqueEmailInPendingRegistrations(string email)
        {
            object count = ComponentHelper.Instance.ExecuteScalar(StoredProcedure.usp_USRMGMTCheckForUniqueEmail, null,
                email, &quot;&quot;, &quot;P&quot;);
            if (count != null)
                return count.ToInt32_2();
            else
                return 0;
        }

        public bool IsUserAssociatedWithContractor(int userId)
        {
            int count =
                ComponentHelper.Instance.ExecuteScalar(StoredProcedure.usp_USRMGMTIsUserAssociatedWithContractor, null,
                    userId.ToString2()).ToInt32_2();
            if (count &gt; 0)
                return false;
            else
                return true;
        }

        public object IsAdUser(string username)
        {
            return ComponentHelper.Instance.ExecuteScalar(StoredProcedure.usp_USRMGMTCheckIsADUser, null, username);
        }

        public DataTable getResetPasswordDetails(string strGUID)
        {
            DataSet ds = null;

            {
                ds = ComponentHelper.Instance.ExecuteDataSet(StoredProcedure.usp_USRMGMTgetResetPasswordDetails, null,
                    strGUID);
            }
            DataTable dt = null;
            if (ds.Tables.Count &gt; 0) dt = ds.Tables[0];
            return dt;
        }

        public int DeactivateResetPasswordRequest(string strGUID)
        {
            int retVal = 0;

            {
                retVal =
                    retVal =
                        ComponentHelper.Instance.ExecuteScalar(
                            StoredProcedure.usp_USRMGMTDeactivateResetPasswordRequest, null, strGUID).ToInt32_2();
            }
            return retVal;
        }

        /// &lt;summary&gt;
        /// Gets the password expiry settings.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;uid&quot;&gt;User ID for which the details are to be fetched.&lt;/param&gt;
        /// &lt;returns&gt;DataTable with details&lt;/returns&gt;
        public DataTable GetPasswordStatusDetails(int uid)
        {
            DataSet ds = ComponentHelper.Instance.ExecuteDataSet(StoredProcedure.usp_USRMGMTGetPasswordStatusDetails,
                null, uid);

            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0)
                return ds.Tables[0];

            return new DataTable();
        }

        /// &lt;summary&gt;
        /// Updates the last password changed date.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;uid&quot;&gt;User for which the date is to be updated.&lt;/param&gt;
        /// &lt;param name=&quot;lastUpdateDate&quot;&gt;DateTime the passowrd was last changed.&lt;/param&gt;
        public void UpdateLastPasswordChanged(int uid, DateTime lastUpdateDate)
        {
            ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                StoredProcedure.usp_USRMGMTUpdateLastPasswordChanged, null, uid, lastUpdateDate);
        }

        /// &lt;summary&gt;
        /// Creates a row in the PasswordChangeHistory table.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;userId&quot;&gt;UserId of the user whose password is being changed. Can be NULL if the UserName is being passed&lt;/param&gt;
        /// &lt;param name=&quot;userName&quot;&gt;UserName of the user whose password is being changed. Can be NULL if the UserId is being passed&lt;/param&gt;
        /// &lt;param name=&quot;password&quot;&gt;Encrypted password (Hash)&lt;/param&gt;
        /// &lt;param name=&quot;userIP&quot;&gt;IP address from where the password is being changed&lt;/param&gt;
        /// &lt;param name=&quot;changedBy&quot;&gt;UserId of the user changing the password. (Admin or self)&lt;/param&gt;
        /// &lt;param name=&quot;comments&quot;&gt;Comments if any&lt;/param&gt;
        public void AddPasswordChangeHistory(int? userId, string userName, string password, string userIP,
            int? changedBy, string comments)
        {
            ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                StoredProcedure.usp_USRMGMTAddPasswordChangeHistory, null,
                userId, userName, password, userIP, changedBy, comments);
        }


        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;userId&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public DataSet GetLoginFailedCount(int userId, DateTime startDate)
        {
            return ComponentHelper.Instance.ExecuteDataSet(StoredProcedure.usp_USRMGMTGetLoginFailedCount, null, userId, startDate);
        }

        /// &lt;summary&gt;
        /// Creates a row in the USRMGMTLoginFailedHistory table.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;userId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;userIP&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;isActive&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;isTempLocked&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;loginDateTime&quot;&gt;Datetime when the login failed&lt;/param&gt;
        public void AddUSRMGMTLoginFailedHistory(int userId, string userIP, bool isActive, bool isTempLocked, DateTime loginDateTime)
        {
            ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                StoredProcedure.usp_USRMGMTAddLoginFailedHistory, null, userId, userIP, isActive, isTempLocked, loginDateTime);
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;userId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;startDate&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        internal bool IsUserTemporarilyLocked(int userId, DateTime startDate)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTIsUserTemporarilyLocked&quot;);

                    conn.DB.AddInParameter(cmd, &quot;UserId&quot;, DbType.Int32, userId);
                    conn.DB.AddInParameter(cmd, &quot;StartDate&quot;, DbType.DateTime, startDate);
                    conn.DB.AddOutParameter(cmd, &quot;IsTempLocked&quot;, DbType.Int32, 4);

                    conn.DB.ExecuteScalar(cmd);
                    return (conn.DB.GetParameterValue(cmd, &quot;IsTempLocked&quot;).ToString2().ToInt32_2() == 1);
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;userId&quot;&gt;&lt;/param&gt;
        public void InactivatePastFailedLoginAttempts(int userId)
        {
            ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                StoredProcedure.usp_USRMGMTInactivatePastFailedLoginAttempts, null, userId);
        }

        /// &lt;summary&gt;
        /// Gets the notification details if there is any
        /// &lt;/summary&gt;
        /// &lt;returns&gt;Datatable&lt;/returns&gt;
        internal DataTable GetNotificationDetails()
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetNotificationDetails&quot;);

                    var tables = conn.DB.ExecuteDataSet(cmd);
                    if (tables.Tables.Count &gt; 0)
                        return tables.Tables[0];

                    return null;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                return new DataTable();
            }
        }

        internal DataSet GetLastNPasswords(int topN, int userId)
        {
            try
            {
                return ComponentHelper.Instance.ExecuteDataSet(StoredProcedure.usp_USRMGMTGetTopNPasswords, null,
                    topN, userId);
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                return new DataSet();
            }
        }

        /// &lt;summary&gt;
        /// Gets details of all the users invited to the project for specified roles.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;roles&quot;&gt;Comma separated list of roles&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        internal DataSet GetProjectUserDetailsByRoleNames(int pid, string roles)
        {
            try
            {
                return
                    ComponentHelper.Instance.ExecuteDataSet(
                        StoredProcedure.usp_USRMGMTGetProjectUserDetailsByRoleNames, null, pid, roles);
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                return new DataSet();
            }
        }

        /// &lt;summary&gt;
        /// Gets details of all the users invited to the project for specified roles.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;roles&quot;&gt;Comma separated list of roles&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        internal DataSet GetProjectUsersByProjects(string pidList)
        {
            try
            {
                return ComponentHelper.Instance.ExecuteDataSet(StoredProcedure.usp_USRMGMTGetProjectUsersByProjects, null, pidList);
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                return new DataSet();
            }
        }

        #region Mobile APIs - used only when running in mobile mode

        //public User ValidateUserFromWebServer(string userName, string hashPassword)
        //{
        //    // call a web service and then return the details
        //    // finally you need to save the details in the local database
        //    User user = new User();
        //    return user;

        //}

        internal DataSet GetFormExplorerXML(string username)
        {
            return ComponentHelper.Instance.ExecuteDataSet(StoredProcedure.usp_OFFLINEGetFormExplorerXML, null, username);
        }

        internal DataSet GetMobileUserData(string username)
        {
            return ComponentHelper.Instance.ExecuteDataSet(StoredProcedure.usp_OFFLINEGetMobileUserData, null, username);
        }

        internal void InsertProjects(string xmlProjects, int UserID)
        {
            ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(StoredProcedure.usp_OFFLINEInsertProjects,
                null, xmlProjects, UserID);
        }

        internal void InsertContracts(string xmlContracts)
        {
            ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(StoredProcedure.usp_OFFLINEInsertContracts,
                null, xmlContracts);
        }

        internal void InsertModules(string xmlModules)
        {
            ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(StoredProcedure.usp_OFFLINEInsertModules,
                null, xmlModules);
        }

        internal void InsertContModules(string xmlContModules)
        {
            ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                StoredProcedure.usp_OFFLINEInsertContModules, null, xmlContModules);
        }

        /// &lt;summary&gt;
        /// Creates an entry in the USRMGMTOnlineMobileUsers Table
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;token&quot;&gt;Generated token number.&lt;/param&gt;
        /// &lt;param name=&quot;userName&quot;&gt;UserName&lt;/param&gt;
        /// &lt;param name=&quot;sessionDuration&quot;&gt;Duration in minutes&lt;/param&gt;
        /// &lt;param name=&quot;ipAddress&quot;&gt;IP Address&lt;/param&gt;
        /// &lt;param name=&quot;sessionID&quot;&gt;Session ID&lt;/param&gt;
        /// &lt;returns&gt;No of rows affected&lt;/returns&gt;
        internal int CreateOnlineMobileUser(string token, string userName, int sessionDuration, string ipAddress,
            string sessionID)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTCreateOnlineMobileUser&quot;);

                    conn.DB.AddInParameter(cmd, &quot;Token&quot;, DbType.String, token);
                    conn.DB.AddInParameter(cmd, &quot;UserName&quot;, DbType.String, userName);
                    conn.DB.AddInParameter(cmd, &quot;SessionDuration&quot;, DbType.Int32, sessionDuration);
                    conn.DB.AddInParameter(cmd, &quot;IPAddress&quot;, DbType.String, ipAddress);
                    conn.DB.AddInParameter(cmd, &quot;SessionID&quot;, DbType.String, sessionID);

                    return conn.DB.ExecuteNonQuery(cmd);
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                return -1;
            }
        }

        /// &lt;summary&gt;
        /// Deletes the entry from USRMGMTOnlineMobileUsers table.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;token&quot;&gt;User sent token&lt;/param&gt;
        /// &lt;param name=&quot;ipAddress&quot;&gt;IP Address&lt;/param&gt;
        /// &lt;returns&gt;No of rows affected&lt;/returns&gt;
        internal int DeleteOnlineMobileUser(string token, string ipAddress)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTDeleteOnlineMobileUser&quot;);

                    conn.DB.AddInParameter(cmd, &quot;Token&quot;, DbType.String, token);
                    conn.DB.AddInParameter(cmd, &quot;IPAddress&quot;, DbType.String, ipAddress);

                    return conn.DB.ExecuteNonQuery(cmd);
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                return -1;
            }
        }

        /// &lt;summary&gt;
        /// Gets the details of the current user.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;token&quot;&gt;Token Number&lt;/param&gt;
        /// &lt;param name=&quot;ipAddress&quot;&gt;IP Address&lt;/param&gt;
        /// &lt;returns&gt;DataSet&lt;/returns&gt;
        internal DataSet GetOnlineMobileUserDetails(string token, string ipAddress, int sessionDuration)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTGetOnlineMobileUserDetails&quot;);

                    conn.DB.AddInParameter(cmd, &quot;Token&quot;, DbType.String, token);
                    conn.DB.AddInParameter(cmd, &quot;IPAddress&quot;, DbType.String, ipAddress);
                    conn.DB.AddInParameter(cmd, &quot;SessionDuration&quot;, DbType.Int32, sessionDuration);
                    conn.DB.AddInParameter(cmd, &quot;Now&quot;, DbType.DateTime, DateTime.UtcNow);

                    return conn.DB.ExecuteDataSet(cmd);
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                return new DataSet();
            }
        }

        /// &lt;summary&gt;
        /// Updates the user role based on the token.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;token&quot;&gt;Token for which role is to be updated&lt;/param&gt;
        /// &lt;param name=&quot;newRoleName&quot;&gt;New role name&lt;/param&gt;
        /// &lt;returns&gt;No of rows affected&lt;/returns&gt;
        internal int UpdateOnlineMobileUserRole(string token, string newRoleName)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_USRMGMTUpdateOnlineMobileUserRole&quot;);

                    conn.DB.AddInParameter(cmd, &quot;Token&quot;, DbType.String, token);
                    conn.DB.AddInParameter(cmd, &quot;Role&quot;, DbType.String, newRoleName);

                    return conn.DB.ExecuteNonQuery(cmd);
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                return -1;
            }
        }

        #endregion


        internal DataTable GetBusinessUnits_GetAll()
        {
            try
            {
                return ComponentHelper.Instance.ExecuteDataSet(BusinessUnitStoredProcedures.usp_COREGetBusinessUnit, null).Tables[0];
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        internal List&lt;int&gt; GetBusinessUnitIdList_ForUserId(int userId)
        {
            try
            {
                DataSet result = ComponentHelper.Instance.ExecuteDataSet(string.Format(&quot;SELECT DISTINCT BusinessUnitId FROM USRMGMTUserBusinessUnitMapping WHERE UserId=&#39;{0}&#39;&quot;, userId));

                List&lt;int&gt; retValue = result.Tables[0].AsEnumerable().Select(t =&gt; t[&quot;BusinessUnitId&quot;].ToInt32_2()).ToList();

                return retValue;
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                throw;
            }
        }

        /// &lt;summary&gt;
        /// Add assigned BusinessUnits
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;businessUnitIDs_CSV&quot;&gt;comma separated values&lt;/param&gt;
        /// &lt;param name=&quot;userId&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public int AddMultipleBusinessUnitIdsToUser(string businessUnitIDs_CSV, int userId)
        {
            int rowcount = ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(BusinessUnitStoredProcedures.usp_USRMGMTSaveUserBusinessUnits, null, businessUnitIDs_CSV, userId);
            return rowcount;
        }

        /// &lt;summary&gt;
        /// Get assigned BusinessUnits
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public DataSet GetAssignedBusinessUnits(int roleId)
        {
            try
            {
                DataSet ds = ComponentHelper.Instance.ExecuteDataSet(BusinessUnitStoredProcedures.usp_USRMGMTGetAssignedBusinessUnits, null, roleId);
                return ds;
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                return new DataSet();
            }
        }

        /// &lt;summary&gt;
        /// Remove Business Units associated with User
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;roleId&quot;&gt;&lt;/param&gt;
        public int DeleteBusinessUnitUserMapping(int roleId)
        {
            try
            {
                int rowAff = ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(BusinessUnitStoredProcedures.usp_USRMGMTDeleteBusinessUnitUserMapping, null, roleId);
                return rowAff;
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                return -1;
            }
        }

        public int ValidateUserName(string userName, string encPassword, int ADAuthentication)
        {
            try
            {
                var dic = new Dictionary&lt;string, object&gt;();
                int status;
                ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(StoredProcedure.usp_USRMGMTValidateUser,
        dic, userName, encPassword, ADAuthentication);
                int.TryParse(dic[&quot;Status&quot;].ToString2(), out status);
                return status;
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                return -10;
            }

        }
        public bool ValidateAdminHash(string passwordHash)
        {
            bool isValid = false;
            var outputDic = new Dictionary&lt;string, object&gt;();
            int status;
            ComponentHelper.Instance.ExecuteDataSet(StoredProcedure.usp_USRMGMTValidateAdminHash, outputDic,passwordHash);
            
            if(int.TryParse(outputDic[&quot;Status&quot;].ToString2(), out status))
            {
                if (status &gt; 0)
                {
                    isValid = true;
                }
            }
            return isValid;
        }
        public int ValidateUserEmail(string userEmail, string encPassword, int ADAuthentication)
        {
            try
            {
                var dic = new Dictionary&lt;string, object&gt;();
                int status;
                ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(StoredProcedure.usp_USRMGMTValidateUserEmail,
        dic, userEmail, encPassword, ADAuthentication);
                int.TryParse(dic[&quot;Status&quot;].ToString2(), out status);
                return status;
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_USRMGMT);
                return -10;
            }

        }

    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[30,9,30,32,1],[31,9,31,10,1],[32,9,32,10,1],[36,9,36,10,0],[38,13,38,14,0],[39,24,39,89,0],[40,17,40,18,0],[41,21,41,101,0],[43,21,43,75,0],[44,21,44,77,0],[45,21,45,48,0],[47,21,47,99,0],[50,13,50,33,0],[51,13,51,14,0],[52,17,52,93,0],[53,17,53,23,0],[55,9,55,10,0],[59,9,59,10,0],[61,13,61,14,0],[62,24,62,89,0],[63,17,63,18,0],[64,21,64,95,0],[66,21,66,80,0],[67,21,67,77,0],[69,21,69,48,0],[70,21,70,100,0],[73,13,73,33,0],[74,13,74,14,0],[75,17,75,93,0],[76,17,76,23,0],[78,9,78,10,0],[82,9,82,10,0],[84,13,84,14,0],[85,24,85,89,0],[86,17,86,18,0],[87,21,87,69,0],[88,21,88,94,0],[90,28,90,71,0],[91,21,91,22,0],[92,25,92,42,0],[93,29,93,78,0],[94,21,94,22,0],[95,21,95,40,0],[98,13,98,33,0],[99,13,99,14,0],[100,17,100,93,0],[101,17,101,23,0],[103,9,103,10,0],[106,9,106,10,0],[108,13,108,14,0],[109,24,109,89,0],[110,17,110,18,0],[111,21,111,96,0],[113,21,113,84,0],[114,21,114,80,0],[115,21,115,76,0],[116,21,116,48,0],[118,21,118,78,0],[121,13,121,33,0],[122,13,122,14,0],[123,17,123,93,0],[124,17,124,23,0],[126,9,126,10,0],[130,9,130,10,0],[132,13,132,14,0],[133,24,133,89,0],[134,17,134,18,0],[135,21,135,95,0],[137,21,137,86,0],[138,21,138,77,0],[139,21,139,48,0],[141,21,141,93,0],[144,13,144,33,0],[145,13,145,14,0],[146,17,146,93,0],[147,17,147,23,0],[149,9,149,10,0],[152,9,152,10,1],[154,13,154,14,1],[155,24,155,89,1],[156,17,156,18,1],[157,21,157,72,1],[158,21,158,95,1],[160,21,160,81,1],[162,28,162,71,1],[163,21,163,22,1],[164,25,164,42,1],[165,29,165,81,1],[166,21,166,22,1],[168,21,168,43,1],[171,13,171,33,0],[172,13,172,14,0],[173,17,173,93,0],[174,17,174,23,0],[176,9,176,10,1],[179,9,179,10,0],[181,13,181,14,0],[182,24,182,89,0],[183,17,183,18,0],[184,21,184,95,0],[185,21,185,81,0],[186,21,186,66,0],[189,13,189,33,0],[190,13,190,14,0],[191,17,191,93,0],[192,17,192,23,0],[194,9,194,10,0],[198,9,198,10,0],[200,13,200,14,0],[201,24,201,89,0],[202,17,202,18,0],[203,21,203,95,0],[205,21,205,81,0],[206,21,206,78,0],[207,21,207,77,0],[208,21,208,48,0],[210,21,210,107,0],[213,13,213,33,0],[214,13,214,14,0],[215,17,215,93,0],[216,17,216,23,0],[218,9,218,10,0],[221,9,221,10,1],[223,13,223,14,1],[224,24,224,89,1],[225,17,225,18,1],[226,21,226,88,1],[227,21,227,81,1],[228,21,228,66,1],[231,13,231,33,0],[232,13,232,14,0],[233,17,233,93,0],[234,17,234,23,0],[236,9,236,10,1],[239,9,239,10,0],[241,13,241,14,0],[242,24,242,89,0],[243,17,243,18,0],[244,21,244,93,0],[245,21,245,83,0],[246,21,246,66,0],[249,13,249,33,0],[250,13,250,14,0],[251,17,251,93,0],[252,17,252,23,0],[254,9,254,10,0],[261,9,261,10,0],[263,13,263,14,0],[264,17,264,116,0],[265,17,265,79,0],[266,21,266,41,0],[267,22,267,45,0],[269,9,269,10,0],[272,9,272,10,1],[274,13,274,14,1],[275,24,275,89,1],[276,17,276,18,1],[277,21,277,91,1],[279,21,279,89,1],[280,21,280,94,1],[281,21,281,101,1],[282,21,282,98,1],[283,21,283,100,1],[284,21,284,105,1],[285,21,285,108,1],[286,21,286,77,1],[287,21,287,48,1],[289,21,289,107,1],[292,13,292,33,0],[293,13,293,14,0],[294,17,294,93,0],[295,17,295,23,0],[297,9,297,10,1],[300,9,300,10,0],[302,13,302,14,0],[303,24,303,89,0],[304,17,304,18,0],[306,21,306,92,0],[308,21,308,78,0],[309,21,309,81,0],[310,21,310,48,0],[312,21,312,85,0],[313,21,313,76,0],[316,13,316,33,0],[317,13,317,14,0],[318,17,318,93,0],[319,17,319,23,0],[321,9,321,10,0],[324,9,324,10,1],[325,13,325,46,1],[326,13,326,27,1],[327,13,327,64,1],[328,17,328,38,1],[330,17,330,29,1],[331,9,331,10,1],[334,9,334,10,1],[336,13,336,14,1],[337,24,337,89,1],[338,17,338,18,1],[339,21,339,89,1],[340,21,340,46,1],[342,21,342,91,1],[344,28,344,71,1],[345,21,345,22,1],[346,25,346,42,1],[347,25,347,26,1],[348,29,348,50,1],[349,29,349,67,1],[350,29,350,68,1],[351,29,351,66,1],[352,29,352,69,1],[353,29,353,66,1],[354,29,354,66,1],[355,29,355,63,1],[356,29,356,67,1],[357,29,357,61,1],[358,29,358,66,1],[359,29,359,67,1],[360,29,360,67,1],[361,29,361,63,1],[362,29,362,64,1],[363,29,363,66,1],[364,29,364,66,1],[365,29,365,69,1],[366,29,366,71,1],[367,29,367,73,1],[368,29,368,79,1],[369,29,369,75,1],[370,29,370,70,1],[371,29,371,73,1],[372,29,374,97,1],[375,29,375,93,1],[376,29,376,84,1],[377,29,377,64,1],[378,33,378,80,1],[379,29,379,87,1],[385,29,385,93,1],[386,29,386,49,1],[388,29,388,54,1],[389,29,389,30,1],[390,33,390,40,1],[390,42,390,49,1],[390,50,390,52,1],[390,53,390,62,1],[391,37,391,77,1],[393,33,393,84,1],[394,33,394,59,1],[395,29,395,30,1],[396,25,396,26,1],[397,21,397,22,1],[398,21,398,36,1],[401,13,401,33,0],[402,13,402,14,0],[403,17,403,93,0],[404,17,404,23,0],[406,9,406,10,1],[409,9,409,10,1],[411,13,411,14,1],[412,24,412,89,1],[413,17,413,18,1],[414,21,414,89,1],[417,21,417,91,1],[419,28,419,71,1],[420,21,420,22,1],[421,25,421,50,1],[422,25,422,42,1],[423,25,423,26,1],[424,29,424,82,1],[425,29,425,84,1],[426,29,426,80,1],[427,29,427,86,1],[428,29,428,78,1],[429,29,429,80,1],[430,29,430,74,1],[431,29,431,82,1],[432,29,432,70,1],[433,29,433,80,1],[434,29,434,80,1],[435,29,435,80,1],[436,29,436,72,1],[437,29,437,74,1],[438,29,438,78,1],[439,29,439,71,1],[440,29,440,74,1],[441,29,441,71,1],[442,29,442,75,1],[443,29,443,80,1],[444,29,444,76,1],[445,29,445,73,1],[446,29,446,64,1],[447,33,447,63,0],[449,33,449,85,1],[450,29,450,93,1],[451,25,451,26,1],[452,21,452,22,1],[453,21,453,35,1],[456,13,456,33,0],[457,13,457,14,0],[458,17,458,93,0],[459,17,459,23,0],[461,9,461,10,1],[464,9,464,10,1],[466,13,466,14,1],[467,24,467,89,1],[468,17,468,18,1],[469,21,469,99,1],[470,21,470,89,1],[471,21,471,54,1],[472,21,472,22,1],[473,25,473,84,1],[474,21,474,22,1],[476,28,476,71,1],[477,21,477,22,1],[478,25,478,60,1],[479,25,479,39,1],[480,25,480,26,1],[481,29,481,73,1],[482,29,482,82,1],[483,29,483,84,1],[484,29,484,80,1],[485,29,485,86,1],[486,29,486,78,1],[487,29,487,80,1],[488,29,488,74,1],[489,29,489,82,1],[490,29,490,70,1],[491,29,491,80,1],[492,29,492,80,1],[493,29,493,80,1],[494,29,494,72,1],[495,29,495,74,1],[496,29,496,78,1],[497,29,497,71,1],[498,29,498,74,1],[499,29,499,71,1],[500,29,500,75,1],[501,29,501,80,1],[502,29,502,76,1],[503,29,503,64,1],[504,33,504,63,0],[506,33,506,85,1],[507,29,507,93,1],[508,25,508,26,1],[509,25,509,39,1],[513,13,513,33,0],[514,13,514,14,0],[515,17,515,93,0],[516,17,516,23,0],[518,9,518,10,1],[521,9,521,10,1],[523,13,523,14,1],[524,24,524,89,1],[525,17,525,18,1],[526,21,526,67,1],[527,21,527,93,1],[529,21,529,78,1],[531,28,531,71,1],[532,21,532,22,1],[533,25,533,42,1],[534,29,534,76,1],[535,21,535,22,1],[536,21,536,38,1],[539,13,539,33,0],[540,13,540,14,0],[541,17,541,93,0],[542,17,542,23,0],[544,9,544,10,1],[547,9,547,10,1],[549,13,549,14,1],[550,24,550,89,1],[551,17,551,18,1],[552,21,552,68,1],[553,21,553,95,1],[555,21,555,78,1],[557,28,557,71,1],[558,21,558,22,1],[559,25,559,42,1],[560,29,560,77,1],[561,21,561,22,1],[562,21,562,39,1],[565,13,565,33,0],[566,13,566,14,0],[567,17,567,93,0],[568,17,568,23,0],[570,9,570,10,1],[574,9,574,10,0],[576,13,576,14,0],[577,17,577,60,0],[578,17,578,54,0],[579,17,579,54,0],[580,17,581,114,0],[583,17,583,71,0],[584,17,584,33,0],[586,13,586,33,0],[587,13,587,14,0],[588,17,588,93,0],[589,17,589,23,0],[591,9,591,10,0],[595,9,595,10,0],[597,13,597,14,0],[598,24,598,89,0],[599,17,599,18,0],[600,21,600,91,0],[602,21,602,78,0],[603,21,603,77,0],[604,21,604,48,0],[606,21,606,93,0],[609,13,609,33,0],[610,13,610,14,0],[611,17,611,93,0],[612,17,612,23,0],[614,9,614,10,0],[617,9,617,10,1],[619,13,619,14,1],[620,24,620,89,1],[621,17,621,18,1],[622,21,622,91,1],[624,21,624,96,1],[625,21,625,98,1],[626,21,626,94,1],[627,21,627,100,1],[628,21,628,94,1],[629,21,629,94,1],[630,21,630,88,1],[631,21,631,94,1],[632,21,632,94,1],[633,21,633,94,1],[634,21,634,86,1],[635,21,635,88,1],[636,21,636,92,1],[637,21,637,96,1],[638,21,638,84,1],[639,21,639,89,1],[640,21,640,95,1],[641,21,641,97,1],[642,21,642,90,1],[643,21,643,93,1],[644,21,644,99,1],[646,21,646,94,1],[647,21,647,89,1],[648,21,648,77,1],[649,21,649,92,1],[650,21,651,121,1],[652,21,652,105,1],[653,21,653,108,1],[654,21,654,107,1],[655,21,655,48,1],[657,21,657,93,1],[660,13,660,33,0],[661,13,661,14,0],[662,17,662,93,0],[663,17,663,23,0],[665,9,665,10,1],[668,9,668,10,0],[670,13,670,14,0],[671,24,671,89,0],[672,17,672,18,0],[673,21,673,93,0],[675,21,675,78,0],[676,21,676,77,0],[677,21,677,48,0],[679,21,679,93,0],[682,13,682,33,0],[683,13,683,14,0],[684,17,684,93,0],[685,17,685,23,0],[687,9,687,10,0],[690,9,690,10,0],[692,13,692,14,0],[693,24,693,89,0],[694,17,694,18,0],[695,21,695,73,0],[696,21,696,96,0],[698,28,698,71,0],[699,21,699,22,0],[700,25,700,42,0],[701,25,701,26,0],[702,29,702,53,0],[705,29,705,60,0],[706,29,706,66,0],[707,29,707,67,0],[708,29,708,65,0],[709,29,709,65,0],[710,29,710,62,0],[711,29,711,64,0],[712,29,712,70,0],[713,29,713,73,0],[714,25,714,26,0],[715,21,715,22,0],[716,21,716,44,0],[719,13,719,33,0],[720,13,720,14,0],[721,17,721,93,0],[722,17,722,23,0],[724,9,724,10,0],[728,9,728,10,0],[730,13,730,14,0],[731,24,731,89,0],[732,17,732,18,0],[734,21,734,92,0],[735,21,735,81,0],[736,21,736,77,0],[737,21,737,48,0],[739,21,739,95,0],[741,21,741,37,0],[742,21,742,22,0],[744,25,744,60,0],[745,30,745,39,0],[745,41,745,59,0],[745,61,745,64,0],[746,29,746,75,0],[747,33,747,103,0],[749,33,749,139,0],[750,21,750,22,0],[752,21,752,35,0],[755,13,755,33,0],[756,13,756,14,0],[757,17,757,93,0],[758,17,758,23,0],[760,9,760,10,0],[764,9,764,10,1],[766,13,766,14,1],[767,24,767,89,1],[768,17,768,18,1],[769,21,769,91,1],[771,21,771,81,1],[772,21,772,77,1],[773,21,773,48,1],[775,21,775,93,1],[778,13,778,33,0],[779,13,779,14,0],[780,17,780,93,0],[781,17,781,23,0],[783,9,783,10,1],[787,9,787,10,0],[789,13,789,14,0],[790,24,790,89,0],[791,17,791,18,0],[793,21,793,96,0],[795,21,795,81,0],[796,21,796,77,0],[797,21,797,48,0],[799,21,799,95,0],[800,21,800,53,0],[803,13,803,33,0],[804,13,804,14,0],[805,17,805,93,0],[806,17,806,23,0],[808,9,808,10,0],[812,9,812,10,0],[814,13,814,14,0],[815,24,815,89,0],[816,17,816,18,0],[818,21,818,96,0],[820,21,820,78,0],[821,21,821,77,0],[822,21,822,48,0],[824,21,824,95,0],[825,21,825,53,0],[828,13,828,33,0],[829,13,829,14,0],[830,17,830,93,0],[831,17,831,23,0],[833,9,833,10,0],[836,9,836,10,0],[838,13,838,14,0],[839,24,839,89,0],[840,17,840,18,0],[842,21,842,95,0],[844,21,844,78,0],[845,21,845,78,0],[846,21,846,77,0],[847,21,847,48,0],[849,21,849,95,0],[850,21,850,53,0],[853,13,853,33,0],[854,13,854,14,0],[855,17,855,93,0],[856,17,856,23,0],[858,9,858,10,0],[861,9,861,10,1],[863,13,863,14,1],[864,24,864,89,1],[865,17,865,18,1],[866,21,866,72,1],[867,21,867,92,1],[869,28,869,71,1],[870,21,870,22,1],[871,25,871,42,1],[872,29,872,102,1],[873,21,873,22,1],[874,21,874,43,1],[877,13,877,33,0],[878,13,878,14,0],[879,17,879,93,0],[880,17,880,23,0],[882,9,882,10,1],[885,9,885,10,1],[886,20,886,85,1],[887,13,887,14,1],[888,17,888,88,1],[889,17,889,58,1],[890,17,890,41,1],[891,21,891,43,1],[893,21,893,46,0],[895,9,895,10,1],[898,9,898,10,1],[899,13,899,188,1],[901,13,901,96,1],[902,9,902,10,1],[905,9,905,10,0],[906,13,906,108,0],[907,9,907,10,0],[910,9,910,10,1],[912,13,912,14,1],[913,24,913,89,1],[914,17,914,18,1],[915,21,915,71,1],[917,21,917,92,1],[918,28,918,71,1],[919,21,919,22,1],[920,25,920,42,1],[921,29,921,78,1],[923,25,924,93,1],[925,21,925,22,1],[926,21,926,39,1],[929,13,929,33,0],[930,13,930,14,0],[931,17,931,93,0],[932,17,932,23,0],[934,9,934,10,1],[937,9,937,10,1],[939,13,939,14,1],[940,24,940,89,1],[941,17,941,18,1],[942,21,942,36,1],[944,21,944,28,1],[944,30,944,37,1],[944,38,944,40,1],[944,41,944,51,1],[945,21,945,22,1],[946,25,946,99,1],[947,25,947,92,1],[948,25,948,93,1],[949,25,949,81,1],[950,25,950,52,1],[951,25,951,87,1],[952,21,952,22,1],[954,21,954,37,1],[955,25,955,47,1],[957,21,957,35,1],[960,13,960,33,0],[961,13,961,14,0],[962,17,962,93,0],[963,17,963,23,0],[965,9,965,10,1],[969,9,969,10,0],[971,13,971,14,0],[972,24,972,89,0],[973,17,973,18,0],[974,21,974,36,0],[976,21,976,90,0],[977,21,977,82,0],[978,21,978,82,0],[979,21,979,86,0],[980,21,980,81,0],[981,21,981,94,0],[982,21,982,104,0],[983,21,983,104,0],[984,21,984,77,0],[985,21,985,48,0],[986,21,986,83,0],[988,21,988,35,0],[991,13,991,33,0],[992,13,992,14,0],[993,17,993,93,0],[994,17,994,23,0],[996,9,996,10,0],[1000,9,1000,10,0],[1002,13,1002,14,0],[1003,24,1003,89,0],[1004,17,1004,18,0],[1005,21,1005,89,0],[1007,21,1007,78,0],[1008,21,1008,77,0],[1009,21,1009,48,0],[1011,21,1011,81,0],[1014,13,1014,33,0],[1015,13,1015,14,0],[1016,17,1016,93,0],[1017,17,1017,23,0],[1019,9,1019,10,0],[1023,9,1023,10,0],[1025,13,1025,14,0],[1026,24,1026,89,0],[1027,17,1027,18,0],[1028,21,1028,91,0],[1030,21,1030,78,0],[1031,21,1031,77,0],[1032,21,1032,48,0],[1034,21,1034,93,0],[1037,13,1037,33,0],[1038,13,1038,14,0],[1039,17,1039,93,0],[1040,17,1040,23,0],[1042,9,1042,10,0],[1045,9,1045,10,0],[1047,13,1047,14,0],[1048,24,1048,89,0],[1049,17,1049,18,0],[1050,21,1050,95,0],[1052,21,1052,66,0],[1055,13,1055,33,0],[1056,13,1056,14,0],[1057,17,1057,93,0],[1058,17,1058,23,0],[1060,9,1060,10,0],[1067,9,1067,10,0],[1069,13,1069,14,0],[1070,24,1070,89,0],[1071,17,1071,18,0],[1072,21,1072,98,0],[1074,21,1074,57,0],[1075,25,1075,90,0],[1077,21,1077,66,0],[1080,13,1080,33,0],[1081,13,1081,14,0],[1082,17,1082,93,0],[1083,17,1083,23,0],[1085,9,1085,10,0],[1088,9,1088,10,0],[1089,13,1089,32,0],[1090,13,1090,112,0],[1091,9,1091,10,0],[1094,9,1094,10,1],[1096,13,1096,14,1],[1097,24,1097,89,1],[1098,17,1098,18,1],[1099,21,1099,98,1],[1101,21,1101,96,1],[1102,21,1102,91,1],[1103,21,1103,100,1],[1104,21,1104,96,1],[1105,21,1105,100,1],[1106,21,1106,91,1],[1108,21,1108,66,1],[1110,21,1110,87,1],[1111,25,1111,108,1],[1113,25,1113,40,0],[1115,21,1115,45,1],[1118,13,1118,33,0],[1119,13,1119,14,0],[1120,17,1120,93,0],[1121,17,1121,23,0],[1123,9,1123,10,1],[1130,9,1130,10,0],[1132,13,1132,14,0],[1133,24,1133,89,0],[1134,17,1134,18,0],[1135,21,1135,64,0],[1136,21,1136,98,0],[1137,21,1137,96,0],[1138,28,1138,71,0],[1139,21,1139,22,0],[1140,25,1140,42,0],[1141,25,1141,26,0],[1144,29,1144,74,0],[1145,33,1145,114,0],[1147,33,1147,88,0],[1149,29,1149,66,0],[1150,25,1150,26,0],[1151,21,1151,22,0],[1153,21,1153,35,0],[1156,13,1156,33,0],[1157,13,1157,14,0],[1158,17,1158,93,0],[1159,17,1159,23,0],[1161,9,1161,10,0],[1164,9,1164,10,0],[1166,13,1166,14,0],[1167,24,1167,89,0],[1168,17,1168,18,0],[1169,21,1169,98,0],[1170,21,1170,96,0],[1171,21,1171,66,0],[1174,13,1174,33,0],[1175,13,1175,14,0],[1176,17,1176,93,0],[1177,17,1177,23,0],[1179,9,1179,10,0],[1185,9,1185,10,1],[1187,13,1187,14,1],[1188,24,1188,89,1],[1189,17,1189,18,1],[1190,21,1190,122,1],[1192,21,1192,118,1],[1193,21,1193,88,1],[1195,21,1195,100,1],[1197,21,1197,96,1],[1198,21,1198,92,1],[1199,21,1199,91,1],[1201,21,1201,91,1],[1202,21,1202,89,1],[1204,21,1204,66,1],[1205,25,1205,93,0],[1207,21,1207,62,1],[1209,21,1209,104,1],[1211,21,1211,41,1],[1214,13,1214,33,0],[1215,13,1215,14,0],[1216,17,1216,93,0],[1217,17,1217,23,0],[1219,9,1219,10,1],[1301,9,1301,10,1],[1303,13,1303,14,1],[1304,24,1304,89,1],[1305,17,1305,18,1],[1308,21,1308,91,1],[1310,21,1310,78,1],[1311,21,1311,80,1],[1312,21,1312,48,1],[1314,21,1314,83,1],[1315,21,1315,72,1],[1318,13,1318,33,0],[1319,13,1319,14,0],[1320,17,1320,93,0],[1321,17,1321,23,0],[1323,9,1323,10,1],[1326,9,1326,10,0],[1327,13,1327,69,0],[1328,13,1328,59,0],[1330,13,1330,84,0],[1331,13,1331,85,0],[1332,13,1332,94,0],[1333,13,1333,30,0],[1334,9,1334,10,0],[1337,9,1337,10,0],[1339,13,1339,14,0],[1340,24,1340,89,0],[1341,17,1341,18,0],[1342,21,1342,99,0],[1344,21,1344,81,0],[1345,21,1345,78,0],[1346,21,1346,77,0],[1347,21,1347,48,0],[1349,21,1349,93,0],[1352,13,1352,33,0],[1353,13,1353,14,0],[1354,17,1354,93,0],[1355,17,1355,23,0],[1357,9,1357,10,0],[1360,9,1360,10,0],[1362,13,1362,14,0],[1363,24,1363,89,0],[1364,17,1364,18,0],[1365,21,1365,91,0],[1367,21,1367,79,0],[1368,21,1368,82,0],[1369,21,1369,77,0],[1370,21,1370,48,0],[1372,21,1372,113,0],[1375,13,1375,33,0],[1376,13,1376,14,0],[1377,17,1377,93,0],[1378,17,1378,23,0],[1380,9,1380,10,0],[1383,9,1383,10,0],[1385,13,1385,14,0],[1386,17,1386,63,0],[1388,24,1388,89,0],[1389,17,1389,18,0],[1390,21,1390,100,0],[1392,21,1392,81,0],[1394,28,1394,71,0],[1395,21,1395,22,0],[1396,25,1396,42,0],[1397,29,1397,74,0],[1398,21,1398,22,0],[1399,21,1399,35,0],[1402,13,1402,33,0],[1403,13,1403,14,0],[1404,17,1404,93,0],[1405,17,1405,23,0],[1407,9,1407,10,0],[1410,9,1410,10,0],[1412,13,1412,14,0],[1414,17,1414,18,0],[1415,21,1417,42,0],[1420,13,1420,33,0],[1421,13,1421,14,0],[1422,17,1422,93,0],[1423,17,1423,23,0],[1425,9,1425,10,0],[1429,9,1429,10,0],[1431,13,1431,14,0],[1433,17,1433,18,0],[1434,21,1438,37,0],[1441,13,1441,33,0],[1442,13,1442,14,0],[1443,17,1443,93,0],[1444,17,1444,23,0],[1446,9,1446,10,0],[1449,9,1449,10,1],[1451,13,1451,14,1],[1452,24,1452,89,1],[1453,17,1453,18,1],[1454,21,1458,37,1],[1461,13,1461,33,0],[1462,13,1462,14,0],[1463,17,1463,93,0],[1464,17,1464,23,0],[1466,9,1466,10,1],[1469,9,1469,10,0],[1471,13,1471,14,0],[1472,17,1474,46,0],[1476,13,1476,33,0],[1477,13,1477,14,0],[1478,17,1478,93,0],[1479,17,1479,23,0],[1481,9,1481,10,0],[1484,9,1484,10,0],[1486,13,1486,14,0],[1487,17,1489,46,0],[1491,13,1491,33,0],[1492,13,1492,14,0],[1493,17,1493,93,0],[1494,17,1494,23,0],[1496,9,1496,10,0],[1499,9,1499,10,0],[1500,13,1502,39,0],[1503,9,1503,10,0],[1506,9,1506,10,1],[1507,13,1508,39,1],[1509,13,1509,31,1],[1510,17,1510,42,1],[1512,17,1512,26,0],[1513,9,1513,10,1],[1516,9,1516,10,1],[1517,13,1518,33,1],[1519,13,1519,31,1],[1520,17,1520,42,1],[1522,17,1522,26,0],[1523,9,1523,10,1],[1526,9,1526,10,1],[1527,13,1529,53,1],[1530,13,1530,27,1],[1531,17,1531,30,0],[1533,17,1533,29,1],[1534,9,1534,10,1],[1537,9,1537,10,1],[1538,13,1538,117,1],[1539,9,1539,10,1],[1542,9,1542,10,0],[1543,13,1543,31,0],[1545,13,1545,14,0],[1546,17,1547,30,0],[1548,13,1548,14,0],[1549,13,1549,33,0],[1550,13,1550,37,0],[1550,38,1550,56,0],[1551,13,1551,23,0],[1552,9,1552,10,0],[1555,9,1555,10,0],[1556,13,1556,28,0],[1558,13,1558,14,0],[1559,17,1562,115,0],[1563,13,1563,14,0],[1564,13,1564,27,0],[1565,9,1565,10,0],[1573,9,1573,10,1],[1574,13,1575,28,1],[1577,13,1577,51,1],[1578,17,1578,37,1],[1580,13,1580,36,0],[1581,9,1581,10,1],[1589,9,1589,10,0],[1590,13,1591,98,0],[1592,9,1592,10,0],[1605,9,1605,10,1],[1606,13,1608,74,1],[1609,9,1609,10,1],[1618,9,1618,10,1],[1619,13,1619,133,1],[1620,9,1620,10,1],[1631,9,1631,10,1],[1632,13,1633,128,1],[1634,9,1634,10,1],[1643,9,1643,10,1],[1645,13,1645,14,1],[1646,24,1646,89,1],[1647,17,1647,18,1],[1648,21,1648,104,1],[1650,21,1650,81,1],[1651,21,1651,90,1],[1652,21,1652,83,1],[1654,21,1654,48,1],[1655,21,1655,106,1],[1658,13,1658,33,0],[1659,13,1659,14,0],[1660,17,1660,93,0],[1661,17,1661,23,0],[1663,9,1663,10,1],[1670,9,1670,10,1],[1671,13,1672,93,1],[1673,9,1673,10,1],[1680,9,1680,10,1],[1682,13,1682,14,1],[1683,24,1683,89,1],[1684,17,1684,18,1],[1685,21,1685,103,1],[1687,21,1687,62,1],[1688,21,1688,49,1],[1689,25,1689,49,0],[1691,21,1691,33,1],[1694,13,1694,33,0],[1695,13,1695,14,0],[1696,17,1696,93,0],[1697,17,1697,40,0],[1699,9,1699,10,1],[1702,9,1702,10,1],[1704,13,1704,14,1],[1705,17,1706,35,1],[1708,13,1708,33,0],[1709,13,1709,14,0],[1710,17,1710,93,0],[1711,17,1711,38,0],[1713,9,1713,10,1],[1721,9,1721,10,1],[1723,13,1723,14,1],[1724,17,1726,104,1],[1728,13,1728,33,0],[1729,13,1729,14,0],[1730,17,1730,93,0],[1731,17,1731,38,0],[1733,9,1733,10,1],[1741,9,1741,10,1],[1743,13,1743,14,1],[1744,17,1744,133,1],[1746,13,1746,33,0],[1747,13,1747,14,0],[1748,17,1748,93,0],[1749,17,1749,38,0],[1751,9,1751,10,1],[1765,9,1765,10,0],[1766,13,1766,123,0],[1767,9,1767,10,0],[1770,9,1770,10,0],[1771,13,1771,122,0],[1772,9,1772,10,0],[1775,9,1775,10,0],[1776,13,1777,44,0],[1778,9,1778,10,0],[1781,9,1781,10,0],[1782,13,1783,37,0],[1784,9,1784,10,0],[1787,9,1787,10,0],[1788,13,1789,35,0],[1790,9,1790,10,0],[1793,9,1793,10,0],[1794,13,1795,85,0],[1796,9,1796,10,0],[1809,9,1809,10,1],[1811,13,1811,14,1],[1812,24,1812,89,1],[1813,17,1813,18,1],[1814,21,1814,103,1],[1816,21,1816,80,1],[1817,21,1817,86,1],[1818,21,1818,99,1],[1819,21,1819,88,1],[1820,21,1820,88,1],[1822,21,1822,57,1],[1825,13,1825,33,0],[1826,13,1826,14,0],[1827,17,1827,93,0],[1828,17,1828,27,0],[1830,9,1830,10,1],[1839,9,1839,10,0],[1841,13,1841,14,0],[1842,24,1842,89,0],[1843,17,1843,18,0],[1844,21,1844,103,0],[1846,21,1846,80,0],[1847,21,1847,88,0],[1849,21,1849,57,0],[1852,13,1852,33,0],[1853,13,1853,14,0],[1854,17,1854,93,0],[1855,17,1855,27,0],[1857,9,1857,10,0],[1866,9,1866,10,1],[1868,13,1868,14,1],[1869,24,1869,89,1],[1870,17,1870,18,1],[1871,21,1871,107,1],[1873,21,1873,80,1],[1874,21,1874,88,1],[1875,21,1875,99,1],[1876,21,1876,90,1],[1878,21,1878,56,1],[1881,13,1881,33,0],[1882,13,1882,14,0],[1883,17,1883,93,0],[1884,17,1884,38,0],[1886,9,1886,10,1],[1895,9,1895,10,0],[1897,13,1897,14,0],[1898,24,1898,89,0],[1899,17,1899,18,0],[1900,21,1900,107,0],[1902,21,1902,80,0],[1903,21,1903,85,0],[1905,21,1905,57,0],[1908,13,1908,33,0],[1909,13,1909,14,0],[1910,17,1910,93,0],[1911,17,1911,27,0],[1913,9,1913,10,0],[1919,9,1919,10,1],[1921,13,1921,14,1],[1922,17,1922,134,1],[1924,13,1924,33,0],[1925,13,1925,14,0],[1926,17,1926,93,0],[1927,17,1927,23,0],[1929,9,1929,10,1],[1932,9,1932,10,1],[1934,13,1934,14,1],[1935,17,1935,186,1],[1937,17,1937,82,1],[1937,82,1937,113,1],[1937,113,1937,124,1],[1937,17,1937,124,1],[1939,17,1939,33,1],[1941,13,1941,33,0],[1942,13,1942,14,0],[1943,17,1943,93,0],[1944,17,1944,23,0],[1946,9,1946,10,1],[1955,9,1955,10,1],[1956,13,1956,189,1],[1957,13,1957,29,1],[1958,9,1958,10,1],[1965,9,1965,10,1],[1967,13,1967,14,1],[1968,17,1968,150,1],[1969,17,1969,27,1],[1971,13,1971,33,0],[1972,13,1972,14,0],[1973,17,1973,93,0],[1974,17,1974,38,0],[1976,9,1976,10,1],[1983,9,1983,10,1],[1985,13,1985,14,1],[1986,17,1986,178,1],[1987,17,1987,31,1],[1989,13,1989,33,0],[1990,13,1990,14,0],[1991,17,1991,93,0],[1992,17,1992,27,0],[1994,9,1994,10,1],[1997,9,1997,10,1],[1999,13,1999,14,1],[2000,17,2000,60,1],[2002,17,2003,55,1],[2004,17,2004,69,1],[2005,17,2005,31,1],[2007,13,2007,33,0],[2008,13,2008,14,0],[2009,17,2009,93,0],[2010,17,2010,28,0],[2013,9,2013,10,1],[2015,9,2015,10,0],[2016,13,2016,34,0],[2017,13,2017,62,0],[2019,13,2019,123,0],[2021,13,2021,74,0],[2022,13,2022,14,0],[2023,17,2023,32,0],[2024,17,2024,18,0],[2025,21,2025,36,0],[2026,17,2026,18,0],[2027,13,2027,14,0],[2028,13,2028,28,0],[2029,9,2029,10,0],[2031,9,2031,10,1],[2033,13,2033,14,1],[2034,17,2034,60,1],[2036,17,2037,56,1],[2038,17,2038,69,1],[2039,17,2039,31,1],[2041,13,2041,33,0],[2042,13,2042,14,0],[2043,17,2043,93,0],[2044,17,2044,28,0],[2047,9,2047,10,1]]);
    </script>
  </body>
</html>