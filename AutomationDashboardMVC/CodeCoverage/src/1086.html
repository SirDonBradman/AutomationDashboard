<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Business Layer\Controller\API Controllers\WorkflowController.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Aurigo.AMP3.Common;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.AMP3.DocumentManagementBL;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.AMP3.UserManagementBL;
using Aurigo.Brix.Platform.BusinessLayer.AbstractModels;
using Aurigo.Brix.Platform.BusinessLayer.BL;
using Aurigo.Brix.Platform.BusinessLayer.XmlForm_Framework;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.Common;
using Aurigo.Workflow;
using System;
using System.Collections.Generic;
using System.Data;
using System.Globalization;
using System.Linq;
using System.Net;
using System.Net.Http;
using System.Threading;
using System.Web;
using System.Web.Http;
using System.Web.Script.Serialization;
using System.Xml;

namespace Aurigo.Brix.Platform.BusinessLayer.Controller
{
    [MWAuthentication]
    public class WorkflowController : ApiController
    {
        [HttpGet]
        public HttpResponseMessage WorkflowDetails(string moduleId, string jsonParameters)
        {
            try
            {
                UserDetail ud = CurrentUser.CurrentUserDetail;

                CultureInfo ci = new CultureInfo(AMP3ApplicationSettings.Instance.Culture);
                Thread.CurrentThread.CurrentCulture = ci;
                Thread.CurrentThread.CurrentUICulture = ci;

                var model = new BrixFormModel(XMLForms.GetXMLFormModuleID(moduleId), moduleId + &quot;.xml&quot;, XMLType.Form,
                    null, null);

                JavaScriptSerializer js = new JavaScriptSerializer();
                Dictionary&lt;string, object&gt; jsonParams = string.IsNullOrEmpty(jsonParameters)
                    ? new Dictionary&lt;string, object&gt;()
                    : js.Deserialize&lt;Dictionary&lt;string, object&gt;&gt;(jsonParameters);

                Dictionary&lt;string, object&gt; formParams = jsonParams.ContainsKey(moduleId)
                    ? jsonParams[moduleId] as Dictionary&lt;string, object&gt;
                    : new Dictionary&lt;string, object&gt;();
                string sPid = formParams.ContainsKey(&quot;pid&quot;)
                    ? formParams[&quot;pid&quot;].ToString()
                    : (jsonParams.ContainsKey(&quot;pid&quot;) ? jsonParams[&quot;pid&quot;].ToString() : &quot;0&quot;);
                string sParentId = formParams.ContainsKey(&quot;parentid&quot;)
                    ? formParams[&quot;parentid&quot;].ToString()
                    : (jsonParams.ContainsKey(&quot;parentid&quot;) ? jsonParams[&quot;parentid&quot;].ToString() : &quot;0&quot;);
                string sParentMod = formParams.ContainsKey(&quot;parentmodule&quot;)
                    ? formParams[&quot;parentmodule&quot;].ToString()
                    : model.form.ParentModuleID;

                List&lt;string&gt; permissions =
                    ModuleManager.Instance.GetPermissionByUserOrRole(
                        string.IsNullOrEmpty(model.form.AssociatedModuleID) ? moduleId : model.form.AssociatedModuleID,
                        ud.UID, ud.RID, sPid.ToInt32_2());
                if (permissions == null) throw new Exception(&quot;The user does not have permissions.&quot;);
                if (!permissions.Contains(&quot;Edit&quot;)) throw new Exception(&quot;The user does not have permissions.&quot;);

                string wftid = WFRuntimeHandlerDB.GetAssociatedtWorkflowGuidForForm(moduleId, sPid, sParentId);
                if (string.IsNullOrEmpty(wftid)) throw new Exception(&quot;There is no workflow associated with this form.&quot;);

                List&lt;APPMGMTBinaryStore&gt; lst = null;
                BinaryStoreManager bsm = new BinaryStoreManager();
                string fileName = null, useThisFileId = null;
                string sPath = WFTemplateManager.GetFileForTemplate(wftid, out useThisFileId, out fileName);
                if (!string.IsNullOrEmpty(fileName))
                    useThisFileId = WFTemplateManager.MoveWorkflowFileToDB(wftid, sPath);
                lst = bsm.GetStreams(ConnectionHelper.GetCurrentCompany(), useThisFileId);

                XmlDocument doc = new XmlDocument();
                doc.Load(lst[0].AsStream());

                var resp = Request.CreateResponse&lt;XmlElement&gt;(HttpStatusCode.OK, doc.DocumentElement);
                return resp;
            }
            catch (Exception ex)
            {
                XmlDocument xmlDoc = new XmlDocument();
                xmlDoc.LoadXml(&quot;&lt;Error&gt;&quot; + ex.Message + &quot;&lt;/Error&gt;&quot;);
                return Request.CreateResponse&lt;XmlElement&gt;(HttpStatusCode.BadRequest, xmlDoc.DocumentElement);
            }
        }

        [HttpGet]
        public HttpResponseMessage GetActions(string moduleId, string formInstanceid, string jsonParameters)
        {
            try
            {
                UserDetail ud = CurrentUser.CurrentUserDetail;

                CultureInfo ci = new CultureInfo(AMP3ApplicationSettings.Instance.Culture);
                Thread.CurrentThread.CurrentCulture = ci;
                Thread.CurrentThread.CurrentUICulture = ci;

                var model = new BrixFormModel(XMLForms.GetXMLFormModuleID(moduleId), moduleId + &quot;.xml&quot;, XMLType.Form,
                    null, null);

                JavaScriptSerializer js = new JavaScriptSerializer();
                Dictionary&lt;string, object&gt; jsonParams = string.IsNullOrEmpty(jsonParameters)
                    ? new Dictionary&lt;string, object&gt;()
                    : js.Deserialize&lt;Dictionary&lt;string, object&gt;&gt;(jsonParameters);

                model.form.RequestParameters = new Dictionary&lt;string, object&gt;(jsonParams,
                    StringComparer.OrdinalIgnoreCase);
                Dictionary&lt;string, object&gt; formParams = jsonParams.ContainsKey(moduleId)
                    ? jsonParams[moduleId] as Dictionary&lt;string, object&gt;
                    : new Dictionary&lt;string, object&gt;();
                string sPid = formParams.ContainsKey(&quot;pid&quot;)
                    ? formParams[&quot;pid&quot;].ToString()
                    : (jsonParams.ContainsKey(&quot;pid&quot;) ? jsonParams[&quot;pid&quot;].ToString() : &quot;0&quot;);
                string sParentId = formParams.ContainsKey(&quot;parentid&quot;)
                    ? formParams[&quot;parentid&quot;].ToString()
                    : (jsonParams.ContainsKey(&quot;parentid&quot;) ? jsonParams[&quot;parentid&quot;].ToString() : &quot;0&quot;);
                string sParentMod = formParams.ContainsKey(&quot;parentmodule&quot;)
                    ? formParams[&quot;parentmodule&quot;].ToString()
                    : model.form.ParentModuleID;

                List&lt;string&gt; permissions =
                    ModuleManager.Instance.GetPermissionByUserOrRole(
                        string.IsNullOrEmpty(model.form.AssociatedModuleID) ? moduleId : model.form.AssociatedModuleID,
                        ud.UID, ud.RID, sPid.ToInt32_2());
                if (permissions == null) throw new Exception(&quot;The user does not have permissions.&quot;);
                if (!permissions.Contains(&quot;Edit&quot;)) throw new Exception(&quot;The user does not have permissions.&quot;);


                DataRow[] drs = null;
                Dictionary&lt;string, bool?&gt; dicRolesToPlay = null;
                bool canSave;
                List&lt;Guid&gt; lstWfInstances = null;
                string wfGuid = string.Empty;
                List&lt;WorkflowActions&gt; actions = GetWorkflowButtons(moduleId, formInstanceid, sPid, sParentId,
                    out lstWfInstances, out drs, out dicRolesToPlay, out canSave, out wfGuid);
                bool bHasRoleToPlay = false;
                foreach (string key in dicRolesToPlay.Keys)
                    if (dicRolesToPlay[key] == true)
                    {
                        bHasRoleToPlay = true;
                        break;
                    }

                bool bIsWorkflowAssociatedatFormLevel = true;
                if (bIsWorkflowAssociatedatFormLevel)
                {
                    var dicHasRoleToPlay = new Dictionary&lt;string, bool?&gt;();
                    DataTable dt = BrixWorkflowManager.Instance.GetWorkflowMappingDetails(formInstanceid,
                        model.form.ModuleID);
                    List&lt;string&gt; stakeHolders = new List&lt;string&gt;();
                    if (dt.Rows.Count &gt; 0)
                        for (int i = 0; i &lt; dt.Rows.Count; i++)
                        {
                            bool bIsComplete = DBNull.Value == dt.Rows[i][&quot;IsCompleted&quot;]
                                ? false
                                : dt.Rows[i][&quot;IsCompleted&quot;].ToString() == &quot;True&quot;;
                            if (bIsComplete) continue;
                            string[] roles = DBNull.Value == dt.Rows[i][&quot;CurrentRole&quot;]
                                ? null
                                : dt.Rows[i][&quot;CurrentRole&quot;].ToString().Split(&#39;,&#39;);
                            if (null == roles) continue;
                            stakeHolders.AddRange(roles);
                        }

                    UserDetail sCurrentUser = CurrentUser.CurrentUserDetail;
                    Dictionary&lt;int, string&gt; userRoles = new Dictionary&lt;int, string&gt;();

                    userRoles = UserManager.Instance.GetUserRolesBasedOnProjectId(sCurrentUser.UID,
                        model.form.RequestParameters.ContainsKey(&quot;PID&quot;)
                            ? model.form.RequestParameters[&quot;PID&quot;].ToInt32_2()
                            : 0,
                        sCurrentUser.RID, sCurrentUser.RoleName);

                    foreach (string stakeHolderRole in stakeHolders)
                    {
                        int stakeHolderRoleID = UserManager.Instance.GetUsersRoleId(stakeHolderRole);
                        if (userRoles.ContainsKey(stakeHolderRoleID))
                        {
                            bHasRoleToPlay = true;

                            //if current user role matches the stakeholders roles, then proceed further
                            string workflowInstanceGuid = dt.Rows[0][&quot;WorkflowInstanceGuid&quot;].ToString();

                            bHasRoleToPlay =
                                !WFRuntimeHandlerDB.HasCurrentUserPerformedWorkflowAction(workflowInstanceGuid,
                                    userRoles, sCurrentUser.UID);
                            break;
                        }
                    }
                }

                List&lt;WorkflowActions&gt; result = bHasRoleToPlay ? actions : new List&lt;WorkflowActions&gt;();
                //XmlDocument xDoc = new XmlDocument();
                //xDoc.LoadXml(&quot;&lt;Result&gt;&lt;/Result&gt;&quot;);
                //XmlElement e = xDoc.DocumentElement;
                //XmlElement em = null;
                //result.ForEach(kv =&gt; { em = xDoc.CreateElement(kv.Key); em.InnerText = kv.Value; e.AppendChild(em); });

                var resp =
                    Request.CreateResponse&lt;List&lt;WorkflowActions&gt;&gt;(
                        bHasRoleToPlay ? HttpStatusCode.OK : HttpStatusCode.Forbidden, result);
                return resp;
            }
            catch (Exception ex)
            {
                XmlDocument xmlDoc = new XmlDocument();
                xmlDoc.LoadXml(&quot;&lt;Error&gt;&quot; + ex.Message + &quot;&lt;/Error&gt;&quot;);
                return Request.CreateResponse&lt;XmlElement&gt;(HttpStatusCode.BadRequest, xmlDoc.DocumentElement);
            }
        }

        [HttpGet]
        public HttpResponseMessage GetDocumentActions(string moduleId, string formInstanceid, string jsonParameters,
            string pid)
        {
            try
            {
                UserDetail ud = CurrentUser.CurrentUserDetail;

                CultureInfo ci = new CultureInfo(AMP3ApplicationSettings.Instance.Culture);
                Thread.CurrentThread.CurrentCulture = ci;
                Thread.CurrentThread.CurrentUICulture = ci;

                var model = new BrixFormModel(XMLForms.GetXMLFormModuleID(moduleId), moduleId + &quot;.xml&quot;, XMLType.Form,
                    null, null);

                JavaScriptSerializer js = new JavaScriptSerializer();
                Dictionary&lt;string, object&gt; jsonParams = string.IsNullOrEmpty(jsonParameters)
                    ? new Dictionary&lt;string, object&gt;()
                    : js.Deserialize&lt;Dictionary&lt;string, object&gt;&gt;(jsonParameters);

                Dictionary&lt;string, object&gt; formParams = jsonParams.ContainsKey(moduleId)
                    ? jsonParams[moduleId] as Dictionary&lt;string, object&gt;
                    : new Dictionary&lt;string, object&gt;();
                string sPid = formParams.ContainsKey(&quot;pid&quot;)
                    ? formParams[&quot;pid&quot;].ToString()
                    : (jsonParams.ContainsKey(&quot;pid&quot;) ? jsonParams[&quot;pid&quot;].ToString() : &quot;0&quot;);
                string sParentId = formParams.ContainsKey(&quot;parentid&quot;)
                    ? formParams[&quot;parentid&quot;].ToString()
                    : (jsonParams.ContainsKey(&quot;parentid&quot;) ? jsonParams[&quot;parentid&quot;].ToString() : &quot;0&quot;);
                string sParentMod = formParams.ContainsKey(&quot;parentmodule&quot;)
                    ? formParams[&quot;parentmodule&quot;].ToString()
                    : model.form.ParentModuleID;

                List&lt;string&gt; permissions =
                    ModuleManager.Instance.GetPermissionByUserOrRole(
                        string.IsNullOrEmpty(model.form.AssociatedModuleID) ? moduleId : model.form.AssociatedModuleID,
                        ud.UID, ud.RID, sPid.ToInt32_2());
                if (permissions == null) throw new Exception(&quot;The user does not have permissions.&quot;);
                if (!permissions.Contains(&quot;EditWF&quot;)) throw new Exception(&quot;The user does not have permissions.&quot;);

                DataRow[] drs = null;
                Dictionary&lt;string, bool?&gt; dicRolesToPlay = null;
                bool canSave;
                List&lt;Guid&gt; lstWfInstances = null;
                string wfGuid = string.Empty;
                List&lt;WorkflowActions&gt; actions = GetDocumentWorkflowButtons(moduleId, formInstanceid, sPid, sParentId,
                    out lstWfInstances, out drs, out dicRolesToPlay, out canSave, out wfGuid);
                bool bHasRoleToPlay = false;
                foreach (string key in dicRolesToPlay.Keys)
                    if (dicRolesToPlay[key] == true)
                    {
                        bHasRoleToPlay = true;
                        break;
                    }

                List&lt;WorkflowActions&gt; result = bHasRoleToPlay ? actions : new List&lt;WorkflowActions&gt;();
                //XmlDocument xDoc = new XmlDocument();
                //xDoc.LoadXml(&quot;&lt;Result&gt;&lt;/Result&gt;&quot;);
                //XmlElement e = xDoc.DocumentElement;
                //XmlElement em = null;
                //result.ForEach(kv =&gt; { em = xDoc.CreateElement(kv.Key); em.InnerText = kv.Value; e.AppendChild(em); });

                var resp =
                    Request.CreateResponse&lt;List&lt;WorkflowActions&gt;&gt;(
                        bHasRoleToPlay ? HttpStatusCode.OK : HttpStatusCode.Forbidden, result);
                return resp;
            }
            catch (Exception ex)
            {
                XmlDocument xmlDoc = new XmlDocument();
                xmlDoc.LoadXml(&quot;&lt;Error&gt;&quot; + ex.Message + &quot;&lt;/Error&gt;&quot;);
                return Request.CreateResponse&lt;XmlElement&gt;(HttpStatusCode.BadRequest, xmlDoc.DocumentElement);
            }
        }

        [HttpGet]
        public HttpResponseMessage GetDocumentDetails(string moduleId, string formInstanceid, string storageId,
            string jsonParameters)
        {
            try
            {
                UserDetail ud = CurrentUser.CurrentUserDetail;
                DataRow[] drs = null;
                CultureInfo ci = new CultureInfo(AMP3ApplicationSettings.Instance.Culture);
                Thread.CurrentThread.CurrentCulture = ci;
                Thread.CurrentThread.CurrentUICulture = ci;
                List&lt;Dictionary&lt;string, string&gt;&gt; documentResponse = new List&lt;Dictionary&lt;string, string&gt;&gt;();
                var model = new BrixFormModel(XMLForms.GetXMLFormModuleID(moduleId), moduleId + &quot;.xml&quot;, XMLType.Form,
                    null, null);

                var document = DocumentManager.Instance.GetDocumentDetails(storageId);
                JavaScriptSerializer js = new JavaScriptSerializer();
                Dictionary&lt;string, object&gt; jsonParams = string.IsNullOrEmpty(jsonParameters)
                    ? new Dictionary&lt;string, object&gt;()
                    : js.Deserialize&lt;Dictionary&lt;string, object&gt;&gt;(jsonParameters);

                Dictionary&lt;string, object&gt; formParams = jsonParams.ContainsKey(moduleId)
                    ? jsonParams[moduleId] as Dictionary&lt;string, object&gt;
                    : new Dictionary&lt;string, object&gt;();
                string sPid = formParams.ContainsKey(&quot;pid&quot;)
                    ? formParams[&quot;pid&quot;].ToString()
                    : (jsonParams.ContainsKey(&quot;pid&quot;) ? jsonParams[&quot;pid&quot;].ToString() : &quot;0&quot;);
                string sParentId = formParams.ContainsKey(&quot;parentid&quot;)
                    ? formParams[&quot;parentid&quot;].ToString()
                    : (jsonParams.ContainsKey(&quot;parentid&quot;) ? jsonParams[&quot;parentid&quot;].ToString() : &quot;0&quot;);
                string sParentMod = formParams.ContainsKey(&quot;parentmodule&quot;)
                    ? formParams[&quot;parentmodule&quot;].ToString()
                    : model.form.ParentModuleID;

                List&lt;string&gt; permissions =
                    ModuleManager.Instance.GetPermissionByUserOrRole(
                        string.IsNullOrEmpty(model.form.AssociatedModuleID) ? moduleId : model.form.AssociatedModuleID,
                        ud.UID, ud.RID, sPid.ToInt32_2());
                if (permissions == null) throw new Exception(&quot;The user does not have permissions.&quot;);
                if (!permissions.Contains(&quot;EditWF&quot;)) throw new Exception(&quot;The user does not have permissions.&quot;);

                Dictionary&lt;string, string&gt; docdetails = new Dictionary&lt;string, string&gt;();
                if (formInstanceid.ToLower() != &quot;undefined&quot;)
                {
                    DataTable mappingDetails = BrixWorkflowManager.Instance.GetWorkflowMappingDetails(formInstanceid,
                        moduleId);
                    drs = mappingDetails.Select(&quot;IsCompleted=False&quot;);


                    if (mappingDetails.Rows.Count &gt; 0)
                    {
                        docdetails.Add(&quot;WorkflowInstanceGuid&quot;, (string)mappingDetails.Rows[0][&quot;WorkflowInstanceGuid&quot;]);
                        docdetails.Add(&quot;IsCompleted&quot;, Convert.ToString(mappingDetails.Rows[0][&quot;IsCompleted&quot;]));
                    }
                    else
                    {
                        docdetails.Add(&quot;WorkflowInstanceGuid&quot;, &quot;&quot;);
                        docdetails.Add(&quot;IsCompleted&quot;, &quot;false&quot;);
                    }
                }
                else
                {
                    docdetails.Add(&quot;WorkflowInstanceGuid&quot;, &quot;&quot;);
                    docdetails.Add(&quot;IsCompleted&quot;, &quot;false&quot;);
                }
                docdetails.Add(&quot;DocName&quot;, Convert.ToString(document.DocName));
                docdetails.Add(&quot;DocSize&quot;, Convert.ToString(document.DocSize));
                docdetails.Add(&quot;Status&quot;, Convert.ToString(document.Status));
                docdetails.Add(&quot;DocDesc&quot;, Convert.ToString(document.DocDesc));
                docdetails.Add(&quot;AuthorName&quot;, Convert.ToString(document.AuthorName));
                docdetails.Add(&quot;CreationDate&quot;, Convert.ToString(document.CreationDate));
                docdetails.Add(&quot;UpdationDate&quot;, Convert.ToString(document.UpdationDate));
                docdetails.Add(&quot;StorageId&quot;, Convert.ToString(document.StorageId));
                docdetails.Add(&quot;XMLInfo&quot;, Convert.ToString(document.XMLInfo));
                docdetails.Add(&quot;CheckedByName&quot;, Convert.ToString(document.CheckedByName));
                docdetails.Add(&quot;IsTemplate&quot;, Convert.ToString(document.IsTemplate));

                documentResponse.Add(docdetails);
                return Request.CreateResponse&lt;List&lt;Dictionary&lt;string, string&gt;&gt;&gt;(HttpStatusCode.OK, documentResponse);
            }
            catch (Exception ex)
            {
                XmlDocument xmlDoc = new XmlDocument();
                xmlDoc.LoadXml(&quot;&lt;Error&gt;&quot; + ex.Message + &quot;&lt;/Error&gt;&quot;);
                return Request.CreateResponse&lt;XmlElement&gt;(HttpStatusCode.BadRequest, xmlDoc.DocumentElement);
            }
        }


        [HttpGet]
        public HttpResponseMessage GetWorkflowHistory(string moduleId, string formInstanceid,
            string workflowInstanceGuid, string jsonParameters)
        {
            DataSet ds = BrixWorkflowManager.Instance.GetWorkflowHistory(workflowInstanceGuid);
            if (ds.Tables.Count &gt; 0)
            {
                DataSet ds1 = new DataSet();
                ds1.Merge(ds.Tables[0].Select(&quot;&quot;, &quot;ID DESC&quot;));
                DataTable dt = ds1.Tables[0];
                foreach (DataColumn dc in dt.Columns)
                    dc.ColumnName = dc.ColumnName.Replace(&quot; &quot;, &quot;&quot;);
                if (dt.Columns.Contains(&quot;Date&quot;))
                    dt.Columns[&quot;Date&quot;].ColumnName = &quot;DateCreated&quot;;
                if (dt.Columns.Contains(&quot;Notes&quot;))
                    dt.Columns[&quot;Notes&quot;].ColumnName = &quot;ActionNotes&quot;;
                if (!dt.Columns.Contains(&quot;ActionUser&quot;))
                    dt.Columns.Add(&quot;ActionUser&quot;);
                if (!dt.Columns.Contains(&quot;ActionDate&quot;))
                    dt.Columns.Add(&quot;ActionDate&quot;);
                if (dt.Rows.Count == 1)
                {
                    DataRow dr = dt.Rows[0];
                    dr[&quot;Action&quot;] = &quot;Created&quot;;
                    dr[&quot;ActionUser&quot;] = dr[&quot;User&quot;];
                    dr[&quot;ActionDate&quot;] = dr[&quot;DateCreated&quot;];
                }
                else if (dt.Rows.Count &gt; 1)
                {
                    foreach (DataRow dr2 in dt.Rows)
                    {
                        dr2[&quot;ActionUser&quot;] = dr2[&quot;User&quot;];
                        dr2[&quot;ActionDate&quot;] = dr2[&quot;DateCreated&quot;];
                    }
                    DataRow dr1 = dt.Rows[dt.Rows.Count - 1];
                    DataRow dr = dt.NewRow();
                    dr[&quot;Action&quot;] = &quot;Created&quot;;
                    dr[&quot;ActionUser&quot;] = dr1[&quot;User&quot;];
                    dr[&quot;ActionDate&quot;] = dr1[&quot;DateCreated&quot;];
                    dr[&quot;ID&quot;] = 0;
                    dt.Rows.InsertAt(dr, dt.Rows.Count);

                    //dt.Rows.RemoveAt(dt.Rows.Count - 1);
                }
                return Request.CreateResponse&lt;DataTable&gt;(HttpStatusCode.OK, ds1.Tables[0]);
            }
            return Request.CreateResponse&lt;DataTable&gt;(HttpStatusCode.OK, ds.Tables[0]);
        }

        [HttpGet]
        public HttpResponseMessage GetAssociatedWorkflows(string moduleId, string jsonParameters)
        {
            DataRow[] aWorkFlows;
            List&lt;Dictionary&lt;string, string&gt;&gt; workflowsList = new List&lt;Dictionary&lt;string, string&gt;&gt;();
            BrixWorkflowManager.Instance.GetAssociatedWorkflows(moduleId, out aWorkFlows);
            if (null != aWorkFlows)
            {
                foreach (DataRow row in aWorkFlows)
                {
                    Dictionary&lt;string, string&gt; wfdetails = new Dictionary&lt;string, string&gt;();
                    wfdetails.Add(&quot;Name&quot;, (string)row[&quot;Name&quot;]);
                    wfdetails.Add(&quot;WorkflowGUID&quot;, (string)row[&quot;WorkflowGUID&quot;]);
                    workflowsList.Add(wfdetails);
                }

                return Request.CreateResponse&lt;List&lt;Dictionary&lt;string, string&gt;&gt;&gt;(HttpStatusCode.OK, workflowsList);
            }
            return Request.CreateResponse&lt;List&lt;Dictionary&lt;string, string&gt;&gt;&gt;(HttpStatusCode.OK, workflowsList);
        }

        [HttpPost]
        public HttpResponseMessage PerformAction(string moduleId, string formInstanceId, string actionId,
            string actionName, [FromBody] string jsonParameters)
        {
            Dictionary&lt;string, Dictionary&lt;string, string&gt;&gt; result = new Dictionary&lt;string, Dictionary&lt;string, string&gt;&gt;();
            Dictionary&lt;string, string&gt; item = new Dictionary&lt;string, string&gt;();
            try
            {
                UserDetail ud = CurrentUser.CurrentUserDetail;
                if (HttpContext.Current.Session[&quot;UserDetail&quot;] == null)
                    HttpContext.Current.Session[&quot;UserDetail&quot;] = ud;

                CultureInfo ci = new CultureInfo(AMP3ApplicationSettings.Instance.Culture);
                Thread.CurrentThread.CurrentCulture = ci;
                Thread.CurrentThread.CurrentUICulture = ci;

                var model = new BrixFormModel(XMLForms.GetXMLFormModuleID(moduleId), moduleId + &quot;.xml&quot;, XMLType.Form,
                    null, null);

                JavaScriptSerializer js = new JavaScriptSerializer();
                Dictionary&lt;string, object&gt; jsonParams = string.IsNullOrEmpty(jsonParameters)
                    ? new Dictionary&lt;string, object&gt;()
                    : js.Deserialize&lt;Dictionary&lt;string, object&gt;&gt;(jsonParameters);

                Dictionary&lt;string, object&gt; formParams = jsonParams.ContainsKey(moduleId)
                    ? jsonParams[moduleId] as Dictionary&lt;string, object&gt;
                    : new Dictionary&lt;string, object&gt;();
                string sPid = formParams.ContainsKey(&quot;pid&quot;)
                    ? formParams[&quot;pid&quot;].ToString()
                    : (jsonParams.ContainsKey(&quot;pid&quot;) ? jsonParams[&quot;pid&quot;].ToString() : &quot;0&quot;);
                string sParentId = formParams.ContainsKey(&quot;parentid&quot;)
                    ? formParams[&quot;parentid&quot;].ToString()
                    : (jsonParams.ContainsKey(&quot;parentid&quot;) ? jsonParams[&quot;parentid&quot;].ToString() : &quot;0&quot;);
                string sParentMod = formParams.ContainsKey(&quot;parentmodule&quot;)
                    ? formParams[&quot;parentmodule&quot;].ToString()
                    : model.form.ParentModuleID;
                string sNotes = jsonParams.ContainsKey(&quot;notes&quot;) ? jsonParams[&quot;notes&quot;].ToString() : &quot;&quot;;
                string sDaysToComplete = jsonParams.ContainsKey(&quot;daystocompleteoverride&quot;)
                    ? jsonParams[&quot;daystocompleteoverride&quot;].ToString()
                    : &quot;&quot;;

                List&lt;string&gt; permissions =
                    ModuleManager.Instance.GetPermissionByUserOrRole(
                        string.IsNullOrEmpty(model.form.AssociatedModuleID) ? moduleId : model.form.AssociatedModuleID,
                        ud.UID, ud.RID, sPid.ToInt32_2());

                if (permissions == null) throw new Exception(&quot;The user does not have permissions.&quot;);
                if (!permissions.Contains(&quot;Edit&quot;)) throw new Exception(&quot;The user does not have permissions.&quot;);


                DataRow[] drs = null;
                Dictionary&lt;string, bool?&gt; dicRolesToPlay = null;
                bool canSave;
                List&lt;Guid&gt; lstWfInstances = null;
                string wfGuid = string.Empty;
                List&lt;WorkflowActions&gt; actions = GetWorkflowButtons(moduleId, formInstanceId, sPid, sParentId,
                    out lstWfInstances, out drs, out dicRolesToPlay, out canSave, out wfGuid);
                bool bHasRoleToPlay = false;

                string[] aIds = actionId.Split(&#39;_&#39;);
                string aActionId = actionId.Contains(&#39;_&#39;) &amp;&amp; aIds.Length &gt;= 2 ? aIds[1] : actionId;
                string sMessages = &quot;&quot;;

                DateTime? dueDate = ComputeDueDate(sDaysToComplete);
                int hID = BrixWorkflowManager.Instance.CreateWorkflowNotes(0, sNotes, aActionId == &quot;RouteTo&quot;
                    ? &quot;RoutedTo:&quot; + ud.UserName
                    : actionName.Replace(&quot;XXX&quot;, &quot; &quot;),
                    CurrentUser.CurrentUserDetail.UID,
                    aActionId == &quot;RouteTo&quot; ? ud.UserName : &quot;&quot;, lstWfInstances[0].ToString(), dueDate);

                foreach (string key in dicRolesToPlay.Keys)
                    if (dicRolesToPlay[key] == true)
                    {
                        bHasRoleToPlay = true;
                        break;
                    }
                if (bHasRoleToPlay &amp;&amp; lstWfInstances.Count() &gt; 0)
                {
                    sMessages = DoWorkflowActions(formInstanceId, actionName, aActionId, wfGuid,
                        lstWfInstances[0].ToString(), moduleId, sPid, sParentId, sParentMod,
                        sDaysToComplete, sNotes, ud.UserName, ud.CompanyCode, hID);

                    item.Add(&quot;Success&quot;, string.IsNullOrEmpty(sMessages) ? &quot;Success&quot; : sMessages);
                    result.Add(&quot;Result&quot;, item);
                    return Request.CreateResponse&lt;Dictionary&lt;string, Dictionary&lt;string, string&gt;&gt;&gt;(HttpStatusCode.OK,
                        result);
                }
                item.Add(&quot;Failure&quot;, &quot;Unknown error has occurred&quot;);
            }
            catch (Exception ex)
            {
                item.Add(&quot;Failure&quot;, ex.Message);
            }
            result.Add(&quot;Result&quot;, item);
            return Request.CreateResponse&lt;Dictionary&lt;string, Dictionary&lt;string, string&gt;&gt;&gt;(HttpStatusCode.OK, result);
        }


        [HttpPost]
        public HttpResponseMessage PerformDocumnetAction(string moduleId, string formInstanceId, string actionId,
            string actionName, [FromBody] string jsonParameters)
        {
            Dictionary&lt;string, Dictionary&lt;string, string&gt;&gt; result = new Dictionary&lt;string, Dictionary&lt;string, string&gt;&gt;();
            Dictionary&lt;string, string&gt; item = new Dictionary&lt;string, string&gt;();
            try
            {
                UserDetail ud = CurrentUser.CurrentUserDetail;
                if (HttpContext.Current.Session[&quot;UserDetail&quot;] == null)
                    HttpContext.Current.Session[&quot;UserDetail&quot;] = ud;

                CultureInfo ci = new CultureInfo(AMP3ApplicationSettings.Instance.Culture);
                Thread.CurrentThread.CurrentCulture = ci;
                Thread.CurrentThread.CurrentUICulture = ci;

                var model = new BrixFormModel(XMLForms.GetXMLFormModuleID(moduleId), moduleId + &quot;.xml&quot;, XMLType.Form,
                    null, null);

                JavaScriptSerializer js = new JavaScriptSerializer();
                Dictionary&lt;string, object&gt; jsonParams = string.IsNullOrEmpty(jsonParameters)
                    ? new Dictionary&lt;string, object&gt;()
                    : js.Deserialize&lt;Dictionary&lt;string, object&gt;&gt;(jsonParameters);

                Dictionary&lt;string, object&gt; formParams = jsonParams.ContainsKey(moduleId)
                    ? jsonParams[moduleId] as Dictionary&lt;string, object&gt;
                    : new Dictionary&lt;string, object&gt;();
                string sPid = formParams.ContainsKey(&quot;pid&quot;)
                    ? formParams[&quot;pid&quot;].ToString()
                    : (jsonParams.ContainsKey(&quot;pid&quot;) ? jsonParams[&quot;pid&quot;].ToString() : &quot;0&quot;);
                string sParentId = formParams.ContainsKey(&quot;parentid&quot;)
                    ? formParams[&quot;parentid&quot;].ToString()
                    : (jsonParams.ContainsKey(&quot;parentid&quot;) ? jsonParams[&quot;parentid&quot;].ToString() : &quot;0&quot;);
                string sParentMod = formParams.ContainsKey(&quot;parentmodule&quot;)
                    ? formParams[&quot;parentmodule&quot;].ToString()
                    : model.form.ParentModuleID;
                string sNotes = jsonParams.ContainsKey(&quot;notes&quot;) ? jsonParams[&quot;notes&quot;].ToString() : &quot;&quot;;
                string sDaysToComplete = jsonParams.ContainsKey(&quot;daystocompleteoverride&quot;)
                    ? jsonParams[&quot;daystocompleteoverride&quot;].ToString()
                    : &quot;&quot;;

                List&lt;string&gt; permissions =
                    ModuleManager.Instance.GetPermissionByUserOrRole(
                        string.IsNullOrEmpty(model.form.AssociatedModuleID) ? moduleId : model.form.AssociatedModuleID,
                        ud.UID, ud.RID, sPid.ToInt32_2());
                if (permissions == null) throw new Exception(&quot;The user does not have permissions.&quot;);
                if (!permissions.Contains(&quot;EditWF&quot;)) throw new Exception(&quot;The user does not have permissions.&quot;);

                DataRow[] drs = null;
                Dictionary&lt;string, bool?&gt; dicRolesToPlay = null;
                bool canSave;
                List&lt;Guid&gt; lstWfInstances = null;
                string wfGuid = string.Empty;
                List&lt;WorkflowActions&gt; actions = GetDocumentWorkflowButtons(moduleId, formInstanceId, sPid, sParentId,
                    out lstWfInstances, out drs, out dicRolesToPlay, out canSave, out wfGuid);
                bool bHasRoleToPlay = false;
                string[] aIds = actionId.Split(&#39;_&#39;);
                string aActionId = actionId.Contains(&#39;_&#39;) &amp;&amp; aIds.Length &gt;= 2 ? aIds[1] : actionId;
                string sMessages = &quot;&quot;;
                foreach (string key in dicRolesToPlay.Keys)
                    if (dicRolesToPlay[key] == true)
                    {
                        bHasRoleToPlay = true;
                        break;
                    }
                if (bHasRoleToPlay &amp;&amp; lstWfInstances.Count() &gt; 0)
                {
                    sMessages = DoWorkflowActions(formInstanceId, actionName, aActionId, wfGuid,
                        lstWfInstances[0].ToString(), moduleId, sPid, sParentId, sParentMod,
                        sDaysToComplete, sNotes, ud.UserName, ud.CompanyCode);

                    item.Add(&quot;Success&quot;, string.IsNullOrEmpty(sMessages) ? &quot;Success&quot; : sMessages);
                    result.Add(&quot;Result&quot;, item);
                    return Request.CreateResponse&lt;Dictionary&lt;string, Dictionary&lt;string, string&gt;&gt;&gt;(HttpStatusCode.OK,
                        result);
                }
                item.Add(&quot;Failure&quot;, &quot;Unknown error has occurred&quot;);
            }
            catch (Exception ex)
            {
                item.Add(&quot;Failure&quot;, ex.Message);
            }
            result.Add(&quot;Result&quot;, item);
            return Request.CreateResponse&lt;Dictionary&lt;string, Dictionary&lt;string, string&gt;&gt;&gt;(HttpStatusCode.OK, result);
        }


        private List&lt;WorkflowActions&gt; GetWorkflowButtons(string moduleid, string formInstanceId, string pid,
            string parentId, out List&lt;Guid&gt; lstWfInstances, out DataRow[] drs,
            out Dictionary&lt;string, bool?&gt; dicHasRoleToPlay, out bool canAddSaveButton, out string wfGuid)
        {
            dicHasRoleToPlay = new Dictionary&lt;string, bool?&gt;();
            drs = null;
            canAddSaveButton = false;
            lstWfInstances = new List&lt;Guid&gt;();
            wfGuid = string.Empty;
            List&lt;WorkflowActions&gt; dicActions = new List&lt;WorkflowActions&gt;();
            if (!BrixWorkflowManager.Instance.IsWorkflowAssociated(moduleid, pid, parentId)) return dicActions;
            DataTable mappingDetails = BrixWorkflowManager.Instance.GetWorkflowMappingDetails(formInstanceId, moduleid);
            drs = mappingDetails.Select(&quot;IsCompleted=False&quot;);
            if (null == drs || drs.Count() &lt; 1)
                throw new Exception(&quot;This instance has no workflow attached or has completed its activity.&quot;);

            foreach (DataRow dr in drs)
            {
                string sCurrentUser = CurrentUser.CurrentUserDetail.UserID;
                Guid actualGuid = Guid.Empty;
                int daysToComplete = 0;
                string actionsMustBePerformedBy = null;
                string stateName = string.Empty;
                Guid gd = new Guid((string)dr[&quot;WorkflowInstanceGuid&quot;]);
                wfGuid = gd.ToString();
                List&lt;IAction&gt; actions = BrixWorkflowManager.Instance.GetCurrentWorkflowActionButtons(gd, ref actualGuid,
                        ref daysToComplete, ref actionsMustBePerformedBy, ref stateName);
                if (actualGuid == Guid.Empty) actualGuid = gd;
                if (null == actions) continue;

                //give opinion and route to are not required for mobile
                //bool bGiveOpinion = BrixWorkflowManager.Instance.IsRouted(out sRoutedTo, &quot;&quot;, &quot;&quot;, actualGuid.ToString()) &amp;&amp;
                //                    sRoutedTo.Equals(sCurrentUser, StringComparison.CurrentCultureIgnoreCase);
                //if (bGiveOpinion)
                //    dicActions.Add(new WorkflowActions { Guid = actualGuid.ToString(), ActionId = &quot;GiveOpinion&quot;, ActionName = &quot;GiveOpinion&quot; });

                bool bHasLocalRoleToPlay = false;
                string[] stakeHolders = null == actionsMustBePerformedBy
                    ? null
                    : actionsMustBePerformedBy.Split(&#39;,&#39;);
                Dictionary&lt;int, string&gt; userRoles = new Dictionary&lt;int, string&gt;();

                userRoles = UserManager.Instance.GetUserRolesBasedOnProjectId(CurrentUser.CurrentUserDetail.UID,
                    string.IsNullOrEmpty(pid) ? 0 : pid.ToInt32_2(),
                    CurrentUser.CurrentUserDetail.RID, CurrentUser.CurrentUserDetail.RoleName);

                if (null != stakeHolders)
                    foreach (string stakeHolderRole in stakeHolders)
                    {
                        if (string.IsNullOrEmpty(stakeHolderRole)) continue;
                        if (dicHasRoleToPlay.ContainsKey(stakeHolderRole.ToLower()))
                        {
                            if (dicHasRoleToPlay[stakeHolderRole.ToLower()] == true)
                            {
                                canAddSaveButton = bHasLocalRoleToPlay = true;
                            }
                            continue;
                        }
                        int stakeHolderRoleID = UserManager.Instance.GetUsersRoleId(stakeHolderRole);
                        bool bHasRoleToPlay = userRoles.ContainsKey(stakeHolderRoleID);
                        dicHasRoleToPlay.Add(stakeHolderRole.ToLower(), bHasRoleToPlay);
                        if (bHasRoleToPlay)
                        {
                            canAddSaveButton = bHasLocalRoleToPlay = true;
                        }
                    }
                if (!bHasLocalRoleToPlay) continue;

                //if (!bGiveOpinion)
                //dicActions.Add(new WorkflowActions { Guid = actualGuid.ToString(), ActionId = &quot;RouteTo&quot;, ActionName = &quot;RouteTo&quot; });

                foreach (IAction action in actions)
                {
                    dicActions.Add(new WorkflowActions
                    {
                        Guid = actualGuid.ToString(),
                        ActionId = action.InstanceId,
                        ActionName =
                            string.IsNullOrEmpty(action.ActionDisplayName)
                                ? action.ActionName
                                : action.ActionDisplayName
                    });
                }
                lstWfInstances.Add(actualGuid);
            }
            return dicActions;
        }


        private List&lt;WorkflowActions&gt; GetDocumentWorkflowButtons(string moduleid, string formInstanceId, string pid,
            string parentId, out List&lt;Guid&gt; lstWfInstances, out DataRow[] drs,
            out Dictionary&lt;string, bool?&gt; dicHasRoleToPlay, out bool canAddSaveButton, out string wfGuid)
        {
            dicHasRoleToPlay = new Dictionary&lt;string, bool?&gt;();
            drs = null;
            canAddSaveButton = false;
            lstWfInstances = new List&lt;Guid&gt;();
            wfGuid = string.Empty;
            List&lt;WorkflowActions&gt; dicActions = new List&lt;WorkflowActions&gt;();
            DataTable mappingDetails = BrixWorkflowManager.Instance.GetWorkflowMappingDetails(formInstanceId, moduleid);
            drs = mappingDetails.Select(&quot;IsCompleted=False&quot;);
            if (null == drs || drs.Count() &lt; 1)
                throw new Exception(&quot;This instance has no workflow attached or has completed its activity.&quot;);

            foreach (DataRow dr in drs)
            {
                string sCurrentUser = CurrentUser.CurrentUserDetail.UserID;
                Guid actualGuid = Guid.Empty;
                int daysToComplete = 0;
                string actionsMustBePerformedBy = null;
                string stateName = string.Empty;
                Guid gd = new Guid((string)dr[&quot;WorkflowInstanceGuid&quot;]);
                wfGuid = gd.ToString();
                List&lt;IAction&gt; actions = BrixWorkflowManager.Instance.GetCurrentWorkflowActionButtons(gd, ref actualGuid,
                       ref daysToComplete, ref actionsMustBePerformedBy, ref stateName);
                if (actualGuid == Guid.Empty) actualGuid = gd;
                if (null == actions) continue;

                //give opinion and route to are not required for mobile
                //bool bGiveOpinion = BrixWorkflowManager.Instance.IsRouted(out sRoutedTo, &quot;&quot;, &quot;&quot;, actualGuid.ToString()) &amp;&amp;
                //                    sRoutedTo.Equals(sCurrentUser, StringComparison.CurrentCultureIgnoreCase);
                //if (bGiveOpinion)
                //    dicActions.Add(new WorkflowActions { Guid = actualGuid.ToString(), ActionId = &quot;GiveOpinion&quot;, ActionName = &quot;GiveOpinion&quot; });

                bool bHasLocalRoleToPlay = false;
                string[] stakeHolders = null == actionsMustBePerformedBy
                    ? null
                    : actionsMustBePerformedBy.Split(&#39;,&#39;);
                if (null != stakeHolders)
                    foreach (string stakeHolderRole in stakeHolders)
                    {
                        if (string.IsNullOrEmpty(stakeHolderRole)) continue;
                        if (dicHasRoleToPlay.ContainsKey(stakeHolderRole.ToLower()))
                        {
                            if (dicHasRoleToPlay[stakeHolderRole.ToLower()] == true)
                            {
                                canAddSaveButton = bHasLocalRoleToPlay = true;
                            }
                            continue;
                        }
                        bool bHasRoleToPlay = UserManager.Instance.IsUserRole(CurrentUser.CurrentUserDetail.UID,
                            UserManager.Instance.GetUsersRoleId(stakeHolderRole));
                        dicHasRoleToPlay.Add(stakeHolderRole.ToLower(), bHasRoleToPlay);
                        if (bHasRoleToPlay)
                        {
                            canAddSaveButton = bHasLocalRoleToPlay = true;
                        }
                    }
                if (!bHasLocalRoleToPlay) continue;

                //if (!bGiveOpinion)
                //dicActions.Add(new WorkflowActions { Guid = actualGuid.ToString(), ActionId = &quot;RouteTo&quot;, ActionName = &quot;RouteTo&quot; });

                foreach (IAction action in actions)
                {
                    dicActions.Add(new WorkflowActions
                    {
                        Guid = actualGuid.ToString(),
                        ActionId = action.InstanceId,
                        ActionName =
                            string.IsNullOrEmpty(action.ActionDisplayName)
                                ? action.ActionName
                                : action.ActionDisplayName
                    });
                }
                lstWfInstances.Add(actualGuid);
            }
            return dicActions;
        }

        private List&lt;string&gt; GetCurrentWorkflowStakeHolders(Guid wfInstanceGuid)
        {
            Guid newGuid = Guid.Empty;
            IState currentState = BrixWorkflowManager.Instance.GetCurrentState(wfInstanceGuid, ref newGuid);

            List&lt;string&gt; stakeHolders = new List&lt;string&gt;();

            if (currentState != null &amp;&amp; !string.IsNullOrEmpty(currentState.ActionsMustBePerformedBy))
            {
                foreach (string stakeHolder in currentState.ActionsMustBePerformedBy.Split(&#39;,&#39;))
                    stakeHolders.Add(stakeHolder);
            }

            return stakeHolders;
        }

        private IState GetCurrentWorkflowStage(Guid wfGuid)
        {
            List&lt;string&gt; stakeHolders = new List&lt;string&gt;();
            Guid newGuid = Guid.Empty;
            Dictionary&lt;string, IState&gt; _wfStates = new Dictionary&lt;string, IState&gt;();
            if (wfGuid == null || wfGuid == Guid.Empty) return null;
            List&lt;IAction&gt; actions = new List&lt;IAction&gt;();
            if (_wfStates.ContainsKey(wfGuid.ToString()))
            {
                return _wfStates[wfGuid.ToString()];
            }
            return null;
        }

        private string DoWorkflowActions(string formInstanceID, string actionName, string sActionId, string wfGuid,
            string sWfInstanceId,
            string moduleid, string pid, string parentId, string parentModule,
            string daysToCompleteOverride, string notes, string user, string mwCompany, int wfNotesID = 0)
        {
            DateTime? dueDate = ComputeDueDate(daysToCompleteOverride);

            if (sActionId == &quot;RouteTo&quot;) return null;

            Dictionary&lt;string, string&gt; ds = new Dictionary&lt;string, string&gt;();
            ds.Add(&quot;Company&quot;, &quot;&quot;);
            ds.Add(&quot;Culture&quot;, Thread.CurrentThread.CurrentCulture.Name);
            ds.Add(&quot;UICulture&quot;, Thread.CurrentThread.CurrentUICulture.Name);
            ds.Add(&quot;SaasCompany&quot;, mwCompany);
            ds.Add(&quot;SaasSmtp&quot;, PlatformAppSettings.AppServer);
            ds.Add(&quot;Pid&quot;, pid);
            ds.Add(&quot;ParentId&quot;, parentId);
            ds.Add(&quot;ParentObjectPath&quot;, parentModule); //to be used later
            ds.Add(&quot;ObjectPath&quot;, moduleid); //to be used later
            ds.Add(&quot;ObjectInstanceId&quot;, formInstanceID); //to be used later
            if (null != dueDate) ds.Add(&quot;DueDateOverride&quot;, dueDate.Value.Ticks.ToString()); //to be used later

            string errMsg = BrixWorkflowManager.Instance.TriggerActionOnWorkflowInstance(Guid.Parse(sWfInstanceId),
                sActionId,
                pid.ToInt32_2(),
                formInstanceID,
                null,
                ds, wfNotesID);
            if (null != errMsg &amp;&amp; errMsg.ToLower().Contains(&quot;timed out&quot;))
                throw new Exception(&quot;Workflow action has timed out. The processing continues in the background.&quot;);

            return errMsg;
        }

        public DateTime? ComputeDueDate(string days)
        {
            if (string.IsNullOrEmpty(days)) return null;

            double daysToComplete = 0;
            if (!double.TryParse(days, out daysToComplete)) return null;

            if (daysToComplete &gt; -1)
                return DateTime.UtcNow.AddDays(daysToComplete);
            else
                return new DateTime(1900, 1, 1);
        }
    }
  
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[32,9,32,10,0],[34,13,34,14,0],[35,17,35,63,0],[37,17,37,92,0],[38,17,38,58,0],[39,17,39,60,0],[41,17,42,33,0],[44,17,44,70,0],[45,17,47,82,0],[49,17,51,56,0],[52,17,54,92,0],[55,17,57,102,0],[58,17,60,49,0],[62,17,65,59,0],[66,17,66,41,0],[66,42,66,101,0],[67,17,67,51,0],[67,52,67,111,0],[69,17,69,112,0],[70,17,70,49,0],[70,50,70,121,0],[72,17,72,53,0],[73,17,73,67,0],[74,17,74,39,0],[74,41,74,61,0],[75,17,75,109,0],[76,17,76,53,0],[77,21,77,90,0],[78,17,78,91,0],[80,17,80,53,0],[81,17,81,45,0],[83,17,83,103,0],[84,17,84,29,0],[86,13,86,33,0],[87,13,87,14,0],[88,17,88,56,0],[89,17,89,69,0],[90,17,90,110,0],[92,9,92,10,0],[96,9,96,10,1],[98,13,98,14,1],[99,17,99,63,1],[101,17,101,92,1],[102,17,102,58,1],[103,17,103,60,1],[105,17,106,33,1],[108,17,108,70,1],[109,17,111,82,1],[113,17,114,55,1],[115,17,117,56,1],[118,17,120,92,1],[121,17,123,102,1],[124,17,126,49,1],[128,17,131,59,1],[132,17,132,41,1],[132,42,132,101,0],[133,17,133,51,1],[133,52,133,111,0],[136,17,136,38,1],[137,17,137,65,1],[139,17,139,50,1],[140,17,140,46,1],[141,17,142,95,1],[143,17,143,45,1],[144,17,144,24,1],[144,26,144,36,1],[144,37,144,39,1],[144,40,144,59,1],[145,21,145,53,1],[146,21,146,22,1],[147,25,147,47,1],[148,25,148,31,1],[151,17,151,62,1],[152,17,152,54,1],[153,17,153,18,1],[154,21,154,76,1],[155,21,156,46,1],[157,21,157,68,1],[158,21,158,43,1],[159,30,159,39,1],[159,41,159,58,1],[159,60,159,63,1],[160,25,160,26,1],[161,29,163,82,1],[164,29,164,45,1],[164,46,164,55,0],[165,29,167,83,1],[168,29,168,47,1],[168,48,168,57,0],[169,29,169,58,1],[170,25,170,26,1],[172,21,172,77,1],[173,21,173,87,1],[175,21,179,66,1],[181,21,181,28,1],[181,30,181,52,1],[181,53,181,55,1],[181,56,181,68,1],[182,21,182,22,1],[183,25,183,102,1],[184,25,184,70,1],[185,25,185,26,1],[186,29,186,51,1],[189,29,189,105,1],[191,29,193,66,1],[194,29,194,35,1],[196,21,196,22,1],[197,17,197,18,1],[199,17,199,103,1],[206,17,208,96,1],[209,17,209,29,1],[211,13,211,33,1],[212,13,212,14,1],[213,17,213,56,1],[214,17,214,69,1],[215,17,215,110,1],[217,9,217,10,1],[222,9,222,10,0],[224,13,224,14,0],[225,17,225,63,0],[227,17,227,92,0],[228,17,228,58,0],[229,17,229,60,0],[231,17,232,33,0],[234,17,234,70,0],[235,17,237,82,0],[239,17,241,56,0],[242,17,244,92,0],[245,17,247,102,0],[248,17,250,49,0],[252,17,255,59,0],[256,17,256,41,0],[256,42,256,101,0],[257,17,257,53,0],[257,54,257,113,0],[259,17,259,38,0],[260,17,260,65,0],[262,17,262,50,0],[263,17,263,46,0],[264,17,265,95,0],[266,17,266,45,0],[267,17,267,24,0],[267,26,267,36,0],[267,37,267,39,0],[267,40,267,59,0],[268,21,268,53,0],[269,21,269,22,0],[270,25,270,47,0],[271,25,271,31,0],[274,17,274,103,0],[281,17,283,96,0],[284,17,284,29,0],[286,13,286,33,0],[287,13,287,14,0],[288,17,288,56,0],[289,17,289,69,0],[290,17,290,110,0],[292,9,292,10,0],[297,9,297,10,0],[299,13,299,14,0],[300,17,300,63,0],[301,17,301,38,0],[302,17,302,92,0],[303,17,303,58,0],[304,17,304,60,0],[305,17,305,108,0],[306,17,307,33,0],[309,17,309,87,0],[310,17,310,70,0],[311,17,313,82,0],[315,17,317,56,0],[318,17,320,92,0],[321,17,323,102,0],[324,17,326,49,0],[328,17,331,59,0],[332,17,332,41,0],[332,42,332,101,0],[333,17,333,53,0],[333,54,333,113,0],[335,17,335,90,0],[336,17,336,61,0],[337,17,337,18,0],[338,21,339,35,0],[340,21,340,70,0],[343,21,343,55,0],[344,21,344,22,0],[345,25,345,120,0],[346,25,346,112,0],[347,21,347,22,0],[349,21,349,22,0],[350,25,350,68,0],[351,25,351,64,0],[352,21,352,22,0],[353,17,353,18,0],[355,17,355,18,0],[356,21,356,64,0],[357,21,357,60,0],[358,17,358,18,0],[359,17,359,79,0],[360,17,360,79,0],[361,17,361,77,0],[362,17,362,79,0],[363,17,363,85,0],[364,17,364,89,0],[365,17,365,89,0],[366,17,366,83,0],[367,17,367,79,0],[368,17,368,91,0],[369,17,369,85,0],[371,17,371,50,0],[372,17,372,118,0],[374,13,374,33,0],[375,13,375,14,0],[376,17,376,56,0],[377,17,377,69,0],[378,17,378,110,0],[380,9,380,10,0],[386,9,386,10,1],[387,13,387,96,1],[388,13,388,37,1],[389,13,389,14,1],[390,17,390,45,1],[391,17,391,63,1],[392,17,392,46,1],[393,17,393,24,1],[393,26,393,39,1],[393,40,393,42,1],[393,43,393,53,1],[394,21,394,68,1],[395,17,395,49,1],[396,21,396,67,1],[397,17,397,50,1],[398,21,398,68,0],[399,17,399,56,1],[400,21,400,50,0],[401,17,401,56,1],[402,21,402,50,0],[403,17,403,40,1],[404,17,404,18,1],[405,21,405,45,1],[406,21,406,46,1],[407,21,407,51,1],[408,21,408,58,1],[409,17,409,18,1],[410,22,410,44,1],[411,17,411,18,1],[412,21,412,28,1],[412,30,412,41,1],[412,42,412,44,1],[412,45,412,52,1],[413,21,413,22,1],[414,25,414,57,1],[415,25,415,64,1],[416,21,416,22,1],[417,21,417,62,1],[418,21,418,46,1],[419,21,419,46,1],[420,21,420,52,1],[421,21,421,59,1],[422,21,422,34,1],[423,21,423,57,1],[426,17,426,18,1],[427,17,427,92,1],[429,13,429,87,0],[430,9,430,10,1],[434,9,434,10,0],[436,13,436,101,0],[437,13,437,91,0],[438,13,438,36,0],[439,13,439,14,0],[440,17,440,24,0],[440,26,440,37,0],[440,38,440,40,0],[440,41,440,51,0],[441,17,441,18,0],[442,21,442,93,0],[443,21,443,64,0],[444,21,444,80,0],[445,21,445,50,0],[446,17,446,18,0],[448,17,448,115,0],[450,13,450,111,0],[451,9,451,10,0],[456,9,456,10,1],[457,13,457,122,1],[458,13,458,80,1],[460,13,460,14,1],[461,17,461,63,1],[462,17,462,71,1],[463,21,463,68,0],[465,17,465,92,1],[466,17,466,58,1],[467,17,467,60,1],[469,17,470,33,1],[472,17,472,70,1],[473,17,475,82,1],[477,17,479,56,1],[480,17,482,92,1],[483,17,485,102,1],[486,17,488,49,1],[489,17,489,103,1],[490,17,492,26,1],[494,17,497,59,1],[499,17,499,41,1],[499,42,499,101,0],[500,17,500,51,1],[500,52,500,111,0],[503,17,503,38,1],[504,17,504,65,1],[506,17,506,50,1],[507,17,507,46,1],[508,17,509,95,1],[510,17,510,45,1],[512,17,512,53,1],[513,17,513,100,1],[514,17,514,39,1],[516,17,516,69,1],[517,17,521,103,1],[523,17,523,24,1],[523,26,523,36,1],[523,37,523,39,1],[523,40,523,59,1],[524,21,524,53,1],[525,21,525,22,1],[526,25,526,47,1],[527,25,527,31,1],[529,17,529,66,1],[530,17,530,18,1],[531,21,533,84,1],[535,21,535,98,1],[536,21,536,48,1],[537,21,538,33,1],[540,17,540,67,0],[541,13,541,14,0],[542,13,542,33,0],[543,13,543,14,0],[544,17,544,49,0],[545,13,545,14,0],[546,13,546,40,0],[547,13,547,118,0],[548,9,548,10,1],[554,9,554,10,0],[555,13,555,122,0],[556,13,556,80,0],[558,13,558,14,0],[559,17,559,63,0],[560,17,560,71,0],[561,21,561,68,0],[563,17,563,92,0],[564,17,564,58,0],[565,17,565,60,0],[567,17,568,33,0],[570,17,570,70,0],[571,17,573,82,0],[575,17,577,56,0],[578,17,580,92,0],[581,17,583,102,0],[584,17,586,49,0],[587,17,587,103,0],[588,17,590,26,0],[592,17,595,59,0],[596,17,596,41,0],[596,42,596,101,0],[597,17,597,53,0],[597,54,597,113,0],[599,17,599,38,0],[600,17,600,65,0],[602,17,602,50,0],[603,17,603,46,0],[604,17,605,95,0],[606,17,606,45,0],[607,17,607,53,0],[608,17,608,100,0],[609,17,609,39,0],[610,17,610,24,0],[610,26,610,36,0],[610,37,610,39,0],[610,40,610,59,0],[611,21,611,53,0],[612,21,612,22,0],[613,25,613,47,0],[614,25,614,31,0],[616,17,616,66,0],[617,17,617,18,0],[618,21,620,79,0],[622,21,622,98,0],[623,21,623,48,0],[624,21,625,33,0],[627,17,627,67,0],[628,13,628,14,0],[629,13,629,33,0],[630,13,630,14,0],[631,17,631,49,0],[632,13,632,14,0],[633,13,633,40,0],[634,13,634,118,0],[635,9,635,10,0],[641,9,641,10,1],[642,13,642,64,1],[643,13,643,24,1],[644,13,644,38,1],[645,13,645,47,1],[646,13,646,35,1],[647,13,647,76,1],[648,13,648,93,1],[648,94,648,112,0],[649,13,649,121,1],[650,13,650,62,1],[651,13,651,48,1],[652,17,652,110,1],[654,13,654,20,1],[654,22,654,32,1],[654,33,654,35,1],[654,36,654,39,1],[655,13,655,14,1],[656,17,656,76,1],[657,17,657,46,1],[658,17,658,40,1],[659,17,659,56,1],[660,17,660,49,1],[661,17,661,72,1],[662,17,662,40,1],[663,17,664,90,1],[665,17,665,46,1],[665,47,665,63,1],[666,17,666,37,1],[666,38,666,47,0],[674,17,674,50,1],[675,17,677,59,1],[678,17,678,83,1],[680,17,682,96,1],[684,17,684,42,1],[685,21,685,28,1],[685,30,685,52,1],[685,53,685,55,1],[685,56,685,68,1],[686,21,686,22,1],[687,25,687,67,1],[687,68,687,77,0],[688,25,688,85,1],[689,25,689,26,0],[690,29,690,85,0],[691,29,691,30,0],[692,33,692,79,0],[693,29,693,30,0],[694,29,694,38,0],[696,25,696,102,1],[697,25,697,88,1],[698,25,698,89,1],[699,25,699,44,1],[700,25,700,26,1],[701,29,701,75,1],[702,25,702,26,1],[703,21,703,22,1],[704,17,704,42,1],[704,43,704,52,0],[709,17,709,24,1],[709,26,709,40,1],[709,41,709,43,1],[709,44,709,51,1],[710,17,710,18,1],[711,21,719,24,1],[720,17,720,18,1],[721,17,721,48,1],[722,13,722,14,1],[723,13,723,31,1],[724,9,724,10,1],[730,9,730,10,0],[731,13,731,64,0],[732,13,732,24,0],[733,13,733,38,0],[734,13,734,47,0],[735,13,735,35,0],[736,13,736,76,0],[737,13,737,121,0],[738,13,738,62,0],[739,13,739,48,0],[740,17,740,110,0],[742,13,742,20,0],[742,22,742,32,0],[742,33,742,35,0],[742,36,742,39,0],[743,13,743,14,0],[744,17,744,76,0],[745,17,745,46,0],[746,17,746,40,0],[747,17,747,56,0],[748,17,748,49,0],[749,17,749,72,0],[750,17,750,40,0],[751,17,752,89,0],[753,17,753,46,0],[753,47,753,63,0],[754,17,754,37,0],[754,38,754,47,0],[762,17,762,50,0],[763,17,765,59,0],[766,17,766,42,0],[767,21,767,28,0],[767,30,767,52,0],[767,53,767,55,0],[767,56,767,68,0],[768,21,768,22,0],[769,25,769,67,0],[769,68,769,77,0],[770,25,770,85,0],[771,25,771,26,0],[772,29,772,85,0],[773,29,773,30,0],[774,33,774,79,0],[775,29,775,30,0],[776,29,776,38,0],[778,25,779,83,0],[780,25,780,89,0],[781,25,781,44,0],[782,25,782,26,0],[783,29,783,75,0],[784,25,784,26,0],[785,21,785,22,0],[786,17,786,42,0],[786,43,786,52,0],[791,17,791,24,0],[791,26,791,40,0],[791,41,791,43,0],[791,44,791,51,0],[792,17,792,18,0],[793,21,801,24,0],[802,17,802,18,0],[803,17,803,48,0],[804,13,804,14,0],[805,13,805,31,0],[806,9,806,10,0],[809,9,809,10,0],[810,13,810,39,0],[811,13,811,109,0],[813,13,813,60,0],[815,13,815,102,0],[816,13,816,14,0],[817,17,817,24,0],[817,26,817,44,0],[817,45,817,47,0],[817,48,817,96,0],[818,21,818,51,0],[819,13,819,14,0],[821,13,821,33,0],[822,9,822,10,0],[825,9,825,10,0],[826,13,826,60,0],[827,13,827,39,0],[828,13,828,85,0],[829,13,829,56,0],[829,57,829,69,0],[830,13,830,57,0],[831,13,831,58,0],[832,13,832,14,0],[833,17,833,53,0],[835,13,835,25,0],[836,9,836,10,0],[842,9,842,10,1],[843,13,843,72,1],[845,13,845,40,1],[845,41,845,53,0],[847,13,847,78,1],[848,13,848,35,1],[849,13,849,73,1],[850,13,850,77,1],[851,13,851,46,1],[852,13,852,63,1],[853,13,853,32,1],[854,13,854,42,1],[855,13,855,54,1],[856,13,856,44,1],[857,13,857,56,1],[858,13,858,33,1],[858,34,858,92,0],[860,13,865,32,1],[866,13,866,74,1],[867,17,867,115,0],[869,13,869,27,1],[870,9,870,10,1],[873,9,873,10,1],[874,13,874,44,1],[874,45,874,57,1],[876,13,876,39,0],[877,13,877,60,0],[877,61,877,73,0],[879,13,879,37,0],[880,17,880,64,0],[882,17,882,49,0],[883,9,883,10,1]]);
    </script>
  </body>
</html>