<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Construction Vertical\Addon Modules\Contract Manager\Work Order\NewACTIWorkOrder.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Configuration;
using System.Data;
using System.Data.OleDb;
using System.Drawing;
using System.Globalization;
using System.IO;
using System.Reflection;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Xml;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.ContmgtDTO;
using Aurigo.AMP3.ContractManager.BusinessLayer;
using Aurigo.AMP3.Core.BusinessLayer.BL;
using Aurigo.AMP3.Core.IntegrationConnector;
using Aurigo.AMP3.Core.UserControls;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.AMP3.Resources.MessageResources;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.AMP3.WORKORDBL;
using Aurigo.AMP3.WORKORDDTO;
using Aurigo.Brix.Core.WebUiHelper;
using Aurigo.Brix.Platform.BusinessLayer.BL;
using Aurigo.Brix.Platform.BusinessLayer.DTO;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Infragistics.Documents.Excel;
using Infragistics.WebUI.UltraWebGrid;
using Infragistics.WebUI.UltraWebGrid.ExcelExport;
using Aurigo.Common;
using Aurigo.AMP3.DataAccess.Core;
using System.Web.Script.Serialization;
namespace Aurigo.AMP3.WORKORDUI
{
    public partial class NewACTIWorkOrder : BrixPageBase, IWorkflowEnabled
    {
        #region ItemDivEnums enum

        public enum ItemDivEnums
        {
            ItemPicker = 1,
            CreateWO = 2,
            PrepaymentPicker = 3,
            RetentionPicker = 4
        }

        #endregion

        private const string MSG_INVALID_FILE = &quot;Please upload a valid Excel file&quot;;
        private readonly List&lt;string&gt; list = new List&lt;string&gt; { &quot;Number&quot;, &quot;Length&quot;, &quot;Width&quot;, &quot;Height&quot; };

        private List&lt;DeletedActivityItems&gt; DelItems;
        private bool IsNewInstance = true;
        public int _ContractID;
        public int _ProjectID;
        private int _WorkOrderID;
        private DataTable dtPrepayment;
        private DataTable dtRecovery;
        private DataTable dtRetention;
        private bool editRecoveryDetails = true;
        private bool editRetentionDetails = true;
        private GenericPickerControl genericPicker;
        private bool isAward;
        private bool isOldWONo;
        private bool isVersion;
        private GenericPickerControl prepaymentPicker;
        private GenericPickerControl retentionPicker;
        protected UltraWebGridExcelExporter uwgExcelExporter;
        private string VersionNo;
        List&lt;string&gt; permissions;

        /// &lt;summary&gt;
        /// Gets the Integration Cutoff Date
        /// &lt;/summary&gt;
        private DateTime IntegrationCutoffDate
        {
            get { return ((DateTime)Session[Constants.APP_IntegrationCutoffDate]).AddDays(-1); }
        }

        /// &lt;summary&gt;
        /// Gets the Default Record Date
        /// &lt;/summary&gt;
        private DateTime DefaultRecordDate
        {
            get { return (DateTime)Session[Constants.APP_DefaultRecordDate]; }
        }

        private bool HideContractorFilter
        {
            get
            {
                return (!IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX) ||
                        (AMP3ApplicationSettings.Instance.appSettings.ContainsKey(&quot;ContactorFilter&quot;) &amp;&amp;
                        AMP3ApplicationSettings.Instance.appSettings[&quot;ContactorFilter&quot;].ToUpper2().Equals(&quot;OFF&quot;)));
            }
        }

        private string ProjectMode
        {
            get
            {
                return (CacheManager.Instance.IsIntegrated(Request.QueryString[Constants.QRY_PROJECTID].ToInt32_2())
                            ? &quot;I&quot;
                            : &quot;L&quot;);
            }
        }

        private List&lt;DeletedActivityItems&gt; _DelItems
        {
            get
            {
                if (ViewState[&quot;DeletedActivityItems&quot;] == null)
                    return new List&lt;DeletedActivityItems&gt;();
                else
                    return ViewState[&quot;DeletedActivityItems&quot;] as List&lt;DeletedActivityItems&gt;;
            }
            set { ViewState[&quot;DeletedActivityItems&quot;] = value; }
        }

        public string FormInstanceId
        {
            get
            {
                int id = -1;
                if (string.IsNullOrEmpty(Request.QueryString[&quot;Version&quot;]) ||
                    (!string.IsNullOrEmpty(Request.QueryString[&quot;Version&quot;]) &amp;&amp;
                     !string.IsNullOrEmpty(Request.QueryString[&quot;IsEditVersion&quot;])) ||
                    string.IsNullOrEmpty(hdnWorkOrderID.Value))
                {
                    id = String.IsNullOrEmpty(Request.QueryString[&quot;WOID&quot;])
                             ? -1
                             : int.TryParse(Request.QueryString[&quot;WOID&quot;], out id) ? id : -1;
                }
                else
                {
                    id = hdnWorkOrderID.Value.ToInt32_2();
                }
                return id.ToString();
            }
        }

        public string FormKey { get { return string.Format(&quot;Work Order Number : {0}, Version : {1}&quot;, txtWONo.Text, VersionNo); } }

        public string FormName
        {
            get { return &quot;XWRKORD&quot;; }
        }

        public string ClientValidationFunction
        {
            get { return &quot;Validate()&quot;; }
        }

        public bool IsOldWorkflow
        {
            get { return true; }
        }

        public int PID
        {
            get { return Request.QueryString[&quot;PID&quot;].ToInt32_2(); }
        }

        public int ParentModuleId
        {
            get
            {
                int id = String.IsNullOrEmpty(Request.QueryString[&quot;ContractID&quot;])
                             ? -1
                             : int.TryParse(Request.QueryString[&quot;ContractID&quot;], out id) ? id : -1;
                return id;
            }
        }

        public string PostCancelRedirectUrl
        {
            get
            {
                return
                    &quot;~/Common/BrixListPage.aspx?Context=WORKORD&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&quot;.Format2(
                        Request[WOConstants.QRY_PROJECTID], Request[WOConstants.QRY_CONTRACTID]);
            }
        }

        //need to assign this after fetching from the contract settings
        public bool AllowZeroQuantity
        {
            get { return hdnAllowZeroQty.Value.Equals(&quot;1&quot;); }
            set { hdnAllowZeroQty.Value = value ? &quot;1&quot; : &quot;0&quot;; }
        }

        protected DataColumn[] QuotationsItemsSchema()
        {
            return new[]
                       {
                           new DataColumn(&quot;ActivityID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                           new DataColumn(&quot;ActivityName&quot;, Type.GetType(&quot;System.String&quot;)),
                           new DataColumn(&quot;ItemID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                           new DataColumn(&quot;LineNo&quot;, Type.GetType(&quot;System.String&quot;)),
                           new DataColumn(&quot;StandardItemNo&quot;, Type.GetType(&quot;System.String&quot;)),
                           new DataColumn(&quot;Description&quot;, Type.GetType(&quot;System.String&quot;)),
                           new DataColumn(&quot;SubItem&quot;, Type.GetType(&quot;System.String&quot;)),
                           new DataColumn(&quot;Unit&quot;, Type.GetType(&quot;System.String&quot;)),
                           new DataColumn(&quot;Quantity&quot;, Type.GetType(&quot;System.Double&quot;)),
                           new DataColumn(&quot;UnitCost&quot;, Type.GetType(&quot;System.Double&quot;)),
                           new DataColumn(&quot;Rate&quot;, Type.GetType(&quot;System.Double&quot;)),
                           new DataColumn(&quot;Amount&quot;, Type.GetType(&quot;System.Double&quot;))
                       };
        }

        protected DataColumn[] ActivitiesItemsSchema()
        {
            return new[]
                       {
                           new DataColumn(&quot;LineNo&quot;, Type.GetType(&quot;System.Int32&quot;)),
                           new DataColumn(&quot;ItemId&quot;, Type.GetType(&quot;System.Int32&quot;)),
                           new DataColumn(&quot;Description&quot;, Type.GetType(&quot;System.String&quot;)),
                           new DataColumn(&quot;Unit&quot;, Type.GetType(&quot;System.String&quot;)),
                           new DataColumn(&quot;Quantity&quot;, Type.GetType(&quot;System.Double&quot;)),
                           //new DataColumn(&quot;Rate&quot;,Type.GetType(&quot;System.Double&quot;)),
                           new DataColumn(&quot;UnitPrice&quot;, Type.GetType(&quot;System.Double&quot;)),
                           new DataColumn(&quot;PriceDistribution&quot;, Type.GetType(&quot;System.Double&quot;)),
                           new DataColumn(&quot;QuantityDistribution&quot;, Type.GetType(&quot;System.Double&quot;))
                       };
        }

        //private ItemPickerControl itemPicker;


        protected override void OnInit(EventArgs e)
        {

            permissions = ModuleManager.Instance.GetPermissionByUserOrRole(&quot;WORKORD&quot;, UserDetail.GetCurrentUserDetail().UID,
                            UserDetail.GetCurrentUserDetail().RID, Request.QueryString[&quot;PID&quot;].ToInt32_2());
            #region Init ItemPicker

            //itemPicker = (ucItemPicker as ItemPickerControl);
            //itemPicker.BackClicked += new EventHandler(BtnCancelItemPicker_Click);
            ////itemPicker.SelectedIndexChanged += new ClickEventHandler(itemPicker_SelectedIndexChanged);
            //itemPicker.MultipleSelectedIndexChanged += new ClickEventHandler(itemPicker_MultipleSelectedIndexChanged);
            //itemPicker.ModuleID = Constants.MODID_CONTMGT;
            //itemPicker.MinimumQuantity = &quot;0&quot;;
            //itemPicker.IsComplete =
            //itemPicker.IsNonContract = false;
            //itemPicker.CurrentModuleID = &quot;WORKORD&quot;;
            //itemPicker.EnableMultipleSelect = true;

            //itemPicker.ParentInstanceID = BrixDatatypeHelper.ToInt32_2(Request[&quot;ContractID&quot;]);

            #endregion

            #region Generic Picker

            genericPicker = (ucGenericPicker as GenericPickerControl);

            genericPicker.BackClicked += BtnCancelItemPicker_Click;
            genericPicker.ItemSelected += genericPicker_ItemSelected;
            genericPicker.DataSourceCommandType = DataSourceType.View;
            genericPicker.TableOrViewName = &quot;ACTIWOItemsByActivity&quot;;
            genericPicker.StateMgmtContext = &quot;ACTIWORKORD&quot;;
            genericPicker.IsFilterXml = genericPicker.DisplayFilter = true;
            var filters = new BrixFilter[1];

            filters[0] = new BrixFilter();
            filters[0].Title = &quot;Activity Name :&quot;;
            filters[0].Name = &quot;ActivityName&quot;;
            filters[0].FilterType = BrixFilter.Type.Text;

            //filters[1] = new BrixFilter();
            //filters[1].Title = &quot;Activity Description :&quot;;
            //filters[1].Name = &quot;Activity Description&quot;;
            //filters[1].FilterType = BrixFilter.Type.Text;

            genericPicker.Filters = filters;
            genericPicker.EnableMultipleSelect = true;
            genericPicker.DefaultSortColumn = &quot;[Activity Description]&quot;;

            var hiddenColumns = new[]
                                    {
                                        &quot;UnitID&quot;, &quot;ItemID&quot;, &quot;UnitPrice&quot;, &quot;SubItemID&quot;, &quot;ModuleID&quot;,
                                        &quot;ParentInstanceID&quot;, &quot;ActivityID&quot;, &quot;RowNum&quot;, &quot;AssociatedResourceID&quot;, &quot;AvailQty&quot;
                                    };

            foreach (string col in hiddenColumns)
                genericPicker.ModifyColumnProperties(col, true, null, null, null, false);

            genericPicker.ModifyColumnProperties(&quot;Quantity&quot;, false, null, AMP3ApplicationSettings.Instance.FORMAT_QUANTITY, null, false);

            genericPicker.ModifyColumnProperties(&quot;SubItem&quot;, false, null, null, null, false, &quot;Sub Item&quot;);
            genericPicker.ModifyColumnProperties(&quot;StandardItemNo&quot;, false, null, null, null, false,
                                                 LocalizationManager.GetString(&quot;StandardItemNo&quot;));
            genericPicker.ModifyColumnProperties(&quot;ActivityName&quot;, false, null, null, null, false, &quot;Activity Name&quot;);
            genericPicker.ModifyColumnProperties(&quot;Description&quot;, false, null, null, null, false,
                                                 ItemNameAbbr + &quot; Description&quot;);

            genericPicker.DataSourceFilter = new Dictionary&lt;string, string&gt;();
            genericPicker.DataSourceFilter.Add(&quot;ModuleID&quot;, &quot;CONTMGT&quot;);
            genericPicker.DataSourceFilter.Add(&quot;ParentInstanceID&quot;, Request[&quot;ContractID&quot;]);

            #endregion Generic Picker

            #region uwgQuotItems Grid

            uwgQuotItems.DisplayLayout.AllowSortingDefault = AllowSorting.OnClient;
            uwgQuotItems.DisplayLayout.FrameStyle.Height = new Unit(&quot;110px&quot;, CultureInfo.CurrentCulture);
            uwgQuotItems.DisplayLayout.StationaryMargins = StationaryMargins.No;

            #endregion

            #region uwgActiItems Grid

            uwgActiItems.DisplayLayout.AllowSortingDefault = AllowSorting.OnClient;
            uwgActiItems.DisplayLayout.FrameStyle.Height = new Unit(&quot;110px&quot;, CultureInfo.CurrentCulture);
            uwgActiItems.DisplayLayout.StationaryMargins = StationaryMargins.No;

            #endregion

            #region Initializing prepayment picker

            prepaymentPicker = (ucPrepaymentPicker as GenericPickerControl);
            prepaymentPicker.IsFilterXml = true;
            prepaymentPicker.DisplayFilter = true;
            prepaymentPicker.BackClicked += prepaymentRulePicker_BackClicked;
            prepaymentPicker.ItemSelected += prepaymentRulePicker_SelectedIndexChanged;
            prepaymentPicker.BindData += prepaymentRulePicker_BindData;
            prepaymentPicker.DataSourceCommandType = DataSourceType.StoredProcedure;
            prepaymentPicker.StateMgmtContext = &quot;Actprepayment&quot;;
            prepaymentPicker.Filters = GetPrepaymentFilters();

            prepaymentPicker.ModifyColumnProperties(&quot;RecoveryId&quot;, true, null, null, null, false);
            prepaymentPicker.ModifyColumnProperties(&quot;ModuleID&quot;, true, null, null, null, false);
            prepaymentPicker.ModifyColumnProperties(&quot;ParentInstanceID&quot;, true, null, null, null, false);
            prepaymentPicker.ModifyColumnProperties(&quot;Prepaymentmode&quot;, true, null, null, null, false);
            prepaymentPicker.ModifyColumnProperties(&quot;Notes&quot;, true, null, null, null, false);
            prepaymentPicker.ModifyColumnProperties(&quot;IsActive&quot;, true, null, null, null, false);
            prepaymentPicker.ModifyColumnProperties(&quot;PrepayValue&quot;, true, null, null, null, false, &quot;Pre-payment Value&quot;);

            prepaymentPicker.ModifyColumnProperties(&quot;RecoveryRuleName&quot;, false, null, null, null, false,
                                                    &quot;Pre-payment Rule&quot;);
            prepaymentPicker.ModifyColumnProperties(&quot;Value&quot;, false, null, null, null, false, (&quot;Pre-payment Value&quot;));

            #endregion

            #region Initializing retention picker

            retentionPicker = (ucRetentionPicker as GenericPickerControl);
            retentionPicker.IsFilterXml = true;
            retentionPicker.DisplayFilter = true;
            retentionPicker.BackClicked += retentionRulePicker_BackClicked;
            retentionPicker.ItemSelected += retentionRulePicker_SelectedIndexChanged;
            retentionPicker.BindData += retentionRulePicker_BindData;
            retentionPicker.DataSourceCommandType = DataSourceType.StoredProcedure;
            retentionPicker.StateMgmtContext = &quot;Actretention&quot;;
            retentionPicker.Filters = GetRetentionFilters();

            retentionPicker.ModifyColumnProperties(&quot;RetentionId&quot;, true, null, null, null, false);
            retentionPicker.ModifyColumnProperties(&quot;ModuleID&quot;, true, null, null, null, false);
            retentionPicker.ModifyColumnProperties(&quot;ParentInstanceID&quot;, true, null, null, null, false);
            retentionPicker.ModifyColumnProperties(&quot;RetentionCeilingMode&quot;, true, null, null, null, false);
            retentionPicker.ModifyColumnProperties(&quot;RetentionCeilingValue&quot;, true, null, null, null, false);
            retentionPicker.ModifyColumnProperties(&quot;Notes&quot;, true, null, null, null, false);
            retentionPicker.ModifyColumnProperties(&quot;IsActive&quot;, true, null, null, null, false);

            retentionPicker.ModifyColumnProperties(&quot;RetentionRuleName&quot;, false, null, null, null, false,
                                                   &quot;Retention Rule Name&quot;);
            retentionPicker.ModifyColumnProperties(&quot;RetentionPercentage&quot;, false, null, null, null, false,
                                                   &quot;Retention Percentage&quot;);
            retentionPicker.ModifyColumnProperties(&quot;RetentnValue&quot;, false, null, null, null, false,
                                                   &quot;Retention Ceiling Value&quot;);

            #endregion

            hdnAmountDigits.Value = CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT).ToString2();

            base.OnInit(e);
        }

        private void Page_PreRender(object sender, EventArgs e)
        {
            string mode = string.Empty;
            if (uwgActivities.Rows.Count != 0)
            {
                mode = WOConstants.MODE_NEITHER;
            }
            if (txtPrepaymentRule.Text != string.Empty)
            {
                try
                {
                    DataTable dt =
                        dtRecovery.Select(&quot;RecoveryRuleName=&#39;&quot; + txtPrepaymentRule.Text.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) + &quot;&#39;&quot;).CopyToDataTable();
                    DataRow row = dt.Rows[0];
                    mode = ((row[&quot;Prepaymentmode&quot;].ToString2().ToLower2() == &quot;false&quot; ||
                             row[&quot;Prepaymentmode&quot;].ToString2() == &quot;0&quot;)
                                ? WOConstants.MODE_AMOUNT
                                : WOConstants.MODE_PERCENTAGE);
                }
                catch
                {
                    mode = WOConstants.MODE_NEITHER;
                }
            }
            HideShowTB(mode);
        }

        protected void Page_Load(object sender, EventArgs e)
        {
            if (!permissions.Contains(&quot;CreateAWO&quot;))
            {
                UIHelper.RedirectURL(
                    MessageResourceManager.GetString(&quot;E_USRMGMT_NO_PERMISSIONS_TO_VIEW_PAGE&quot;,
                                                     Enumerations.MessageType.ErrorMessage),
                    ResolveUrl(Constants.URL_ENTERPRISE), null, Context);
            }
            if (!permissions.Contains(&quot;RecoveryRule&quot;))
            {
                editRecoveryDetails = false;
            }
            if (!permissions.Contains(&quot;RetentionRule&quot;))
            {
                editRetentionDetails = false;
            }
            DelItems = _DelItems;
            EnsureChildControls();
            btnGetItems.Text = &quot;Get &quot; + ItemNameAbbr + &quot;s&quot;;
            UIHelper.DisableRoleSelection(Page);
            if (String.IsNullOrEmpty(Request[WOConstants.QRY_CONTRACTID]) ||
                String.IsNullOrEmpty(Request[Constants.QRY_PROJECTID]))
                Response.Redirect(
                    &quot;~/Modules/CONTMGT/Contracts.aspx?PID=&quot; + Request[Constants.QRY_PROJECTID] ?? String.Empty, true);
            _ContractID = Request.QueryString[WOConstants.QRY_CONTRACTID].ToInt32_2();
            _ProjectID = Request.QueryString[WOConstants.QRY_PROJECTID].ToInt32_2();
            lblErr.Text = &quot;&quot;;
            txtWONo.ReadOnly = true;
            IsNewInstance = (String.IsNullOrEmpty(Request[WOConstants.QRY_WORKORDERID]));
            if (!IsNewInstance)
                _WorkOrderID = Request.QueryString[WOConstants.QRY_WORKORDERID].ToInt32_2();

            isVersion = (!String.IsNullOrEmpty(Request[&quot;Version&quot;]) &amp;&amp; (Request[&quot;Version&quot;].Equals(&quot;true&quot;)));

            PopulateDataTables();
            if (!IsPostBack)
            {
                wdcCreatedOn.CalendarLayout.Culture = DateFormatCulture.GetDateFormatCulture();
                if (ProjectMode.Equals(&quot;I&quot;) || IsNewInstance)
                {
                    wdcCreatedOn.MinDate = ProjectMode.Equals(&quot;L&quot;) ? DateTime.UtcNow : DefaultRecordDate;
                    wdcCreatedOn.MaxDate = ProjectMode.Equals(&quot;L&quot;) ? DateTime.UtcNow : IntegrationCutoffDate;
                }
                if (ProjectMode.Equals(&quot;I&quot;))
                {
                    dtStartDate.MinDate = dtEndDate.MinDate = dtWODate.MinDate = DefaultRecordDate;
                    dtStartDate.MaxDate = dtEndDate.MaxDate = dtWODate.MaxDate = IntegrationCutoffDate;
                    dtStartDate.Value = dtEndDate.Value = dtWODate.Value = DefaultRecordDate;
                }
                DataTable dtUnits = BL.Instance.GetMeasSys(Session[Constants.EIS_ADDITIONAL_INFO].ToString2(),
                                                           BL.Instance.GetContract(_ContractID, FetchSet.Details).
                                                               MeasSysID);
                UIHelper.BindDropDownData(ddlActiUnit, dtUnits, &quot;Unit&quot;, &quot;ID&quot;);
                lblActiLength.Text = AMP3ApplicationSettings.Instance.Dim1Title;
                lblActiWidth.Text = AMP3ApplicationSettings.Instance.Dim2Title;
                lblActiHeight.Text = AMP3ApplicationSettings.Instance.Dim3Title;

                if (IsNewInstance) //New Record Creation
                {
                    SetPreReqData();
                    hdnWorkOrderID.Value = &quot;&quot;;
                    hdnStage.Value = WOConstants.STAGE_DRAFT.ToString2();
                    PageTitle = &quot;New Activity based Work Order&quot;;
                    chkWithMaterial.Checked = chkWithEquipment.Checked = chkWithLabour.Checked = false;
                    wdcCreatedOn.Value = ProjectMode.Equals(&quot;L&quot;) ? DateTime.UtcNow : DefaultRecordDate; //Fix for R19-21753
                    DataTable dtContractSettings = BL.Instance.GetOwnerDetails(_ContractID);
                    hdnValidateWOQty.Value = bool.Parse(dtContractSettings.Rows[0][&quot;ValidateWOQty&quot;].ToString()) ? &quot;1&quot; : &quot;0&quot;;
                }
                else //editing here
                {
                    LoadWorkOrderInstanceDetails();
                    (attachments as AttachmentsControl).InstanceID = _WorkOrderID.ToString2();
                    (attachments as AttachmentsControl).SrcType = WOConstants.MODULE_NAME;
                    LinksUserControl.SetInstanceAndType(_WorkOrderID.ToString2(), WOConstants.MODULE_NAME);
                    PageTitle = &quot;Edit Activity based Work Order&quot;;
                }

                if (hdnStage.Value != &quot;1&quot; &amp;&amp; !IsNewInstance)
                {
                    btnAddItem.Enabled = btnDeleteItem.Enabled = false;
                    if (!isVersion)
                    {
                        btnSaveActi.Enabled = btnCancelActi.Enabled = false;
                    }
                }
                hdnVisibleTab.Value = WOConstants.TAB_WO;
                if (!string.IsNullOrEmpty(Request[&quot;Tab&quot;]) &amp;&amp; Request[&quot;Tab&quot;] == WOConstants.TAB_QUOT)
                {
                    hdnVisibleTab.Value = WOConstants.TAB_QUOT;
                    Page.ClientScript.RegisterStartupScript(GetType(), &quot;S&quot;,
                                                            @&quot;showPane(document.getElementById(document.getElementById(&#39;&quot; +
                                                            hdnVisibleTab.ClientID + &quot;&#39;).value), true);&quot;, true);
                }
                wdcCreatedOn.Enabled = !ProjectMode.Equals(&quot;L&quot;); //Fix for R19-21753
            }
            //if (hdnVisibleTab.Value == WOConstants.TAB_WO)
            //{
            //    MainToolBar.HideMenu(&quot;lnkNew&quot;);
            //    MainToolBar.HideMenu(&quot;lnkGet&quot;);
            //    MainToolBar.HideMenu(&quot;lnkEdit&quot;);
            //    MainToolBar.HideMenu(&quot;lnkDelete&quot;);
            //    MainToolBar.HideMenu(&quot;lnkShortClose&quot;);
            //    MainToolBar.HideMenu(&quot;lnkActions&quot;);
            //}
            lblQuotError.Style.Add(&quot;display&quot;, &quot;none&quot;);
            if (isVersion)
            {
                MainToolBar.DisableMenu(&quot;lnkAward&quot;);
                MainToolBar.DisableMenu(&quot;lnkReject&quot;);
                MainToolBar.DisableMenu(&quot;lnkRevert&quot;);
                //MainToolBar.DisableMenu(&quot;lnkNew&quot;);
                //MainToolBar.DisableMenu(&quot;lnkDelete&quot;);
                //MainToolBar.DisableMenu(&quot;lnkGet&quot;);
            }
            if (isAward &amp;&amp;
                (!string.IsNullOrEmpty(hdnStage.Value) &amp;&amp; hdnStage.Value.ToInt32_2() &gt;= WOConstants.STAGE_APPROVED))
            {
                uwgActivities.Columns.FromKey(&quot;ContractUnitCost&quot;).Hidden = false;
                uwgActivities.Columns.FromKey(&quot;ContractUnitCost&quot;).Header.Caption = &quot;Est. Unit Cost&quot;;
                uwgActivities.Columns.FromKey(&quot;UnitCost&quot;).Hidden = false;
            }
            if (hdnStage.Value != &quot;1&quot; &amp;&amp; !IsNewInstance)
            {
                dtStartDate.Enabled =
                    dtEndDate.Enabled =
                    dtWODate.Enabled = false;
                //btnPrepaymentRulePicker.Enabled =
                //btnRetentionRulePicker.Enabled = false;
            }

            if (IsAwarded())
            {
                hdnIsAwarded.Value = &quot;1&quot;;
                if (hdnVisibleTab.Value == WOConstants.TAB_QUOT)
                    MainToolBar.GetMenuReference(&quot;lnkNew&quot;).Enabled =
                        MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).Enabled =
                        MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).Enabled = false;
            }
            litCurrency.Text = LocalizationManager.GetModuleCurrency(Constants.MODID_CONTMGT, _ContractID.ToString2());

            if (HideContractorFilter)
            {
                trSegment.Style.Value =
                    trCategory.Style.Value =
                    trCertification.Style.Value = trContractorFilterButton.Style.Value = &quot;display:none&quot;;
            }

            if (prepaymentPicker.Visible != false)
            {
                PageTitle = &quot;select pre-payment rule&quot;;
            }

            if (retentionPicker.Visible != false)
            {
                PageTitle = &quot;Select Retention Rule&quot;;
            }

            if (Request[&quot;Type&quot;] == &quot;E&quot; &amp;&amp; PageTitle == &quot;New Work Order&quot;)
                PageTitle = &quot;Edit Activity based Work Order&quot;;
            else if (PageTitle == &quot;New Work Order&quot;)
                PageTitle = &quot;New Activity based Work Order&quot;;

        }

        private void LoadWorkOrderInstanceDetails()
        {
            WorkOrderDTO WODTO = WOManager.Instance.GetWorkOrderDetails(_WorkOrderID);
            if (WODTO == null)
            {
                Page.ClientScript.RegisterClientScriptBlock(GetType(), &quot;Instance deleted.&quot;,
                                                            &quot;&lt;script&gt; alert(&#39;&lt;%= Aurigo.AMP3.Resources.TerminologyResources.ResourceFactory.Instance.GetString(&#39;The Work Order instance has been deleted.&#39;) %&gt;&#39;); document.location=&#39;&quot; +
                                                            &quot;~/Common/BrixListPage.aspx?Context=WORKORD&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&quot;
                                                                .Format2(UIHelper.UrlEncode(Request[WOConstants.QRY_PROJECTID]),
                                                                          UIHelper.UrlEncode(_ContractID.ToString2())) + &quot;&#39;;&lt;/script&gt;&quot;);
                return;
            }

            txtWONo.Text = WODTO.WorkOrderNo;
            txtExtReference.Text = WODTO.ExtReference;
            txtTaxPayerID.Text = WODTO.TaxPayerID;
            txtLicenseState.Text = WODTO.LicenseState;
            txtLicenseCity.Text = WODTO.LicenseCity;
            txtInsurance.Text = WODTO.Insurance;
            txtWOReqBy.Text = WODTO.WorkOrderRequestedBy;
            isOldWONo = (WODTO.IsNew == null) ? true : false;
            dtWODate.Value = WODTO.WorkOrderDate;
            lblContractor.Text = WODTO.Contractor;
            txtDesc.Text = WODTO.Description;
            txtNotes.Text = WODTO.Notes;
            txtScope.Text = WODTO.ScopeOfWork;
            chkWithMaterial.Checked = WODTO.WithMaterial;
            chkWithLabour.Checked = WODTO.WithLabour;
            chkWithEquipment.Checked = WODTO.WithEquipment;
            dtStartDate.Value = WODTO.StartDate;
            dtEndDate.Value = WODTO.EndDate;
            tdCreatedBy2.InnerText = WODTO.CreatedBy;
            wdcCreatedOn.Value = WODTO.CreatedOn;
            //tdCreatedOn.InnerText = WODTO.CreatedOn.ToString(Constants.FORMAT_DATE, CultureInfo.CurrentCulture);
            //remove the above after adding the attribute in td
            hdnStage.Value = WODTO.Status.ToString2();

            hdnWorkOrderID.Value = WODTO.WorkOrderID.ToString2();
            LoadContractors();
            BindActivitiesData(WODTO);
            BindQuotationData();

            hdnTotalAmt.Value =
                (WODTO.TotalAmount == 0 ? hdnTotalAmt.Value.ToDecimal2() : WODTO.TotalAmount).ToString2();
            hdnValidateWOQty.Value = WODTO.ValidateWOQty.ToString();

            #region Loading Prepayment Rule, Prepayment Types and Retention details

            DataSet dsRRDetails = WORKORDManager.Instance.GetRecoveryRetentionDetails(&quot;WORKORD&quot;, _WorkOrderID);
            //Table[0] - Recovery Details
            //Table[1] - Associated Prepayment Types
            //Table[2] - Retention Details

            string mode = string.Empty;
            if (dsRRDetails.Tables[0].Rows.Count != 0 &amp;&amp; dsRRDetails.Tables[1].Rows.Count != 0)
            {
                #region Loading Prepayment Rule

                DataRow row = dsRRDetails.Tables[0].Rows[0];
                mode = ((row[&quot;Prepaymentmode&quot;].ToString2().ToLower2() == &quot;false&quot; ||
                         row[&quot;Prepaymentmode&quot;].ToString2() == &quot;0&quot;)
                            ? WOConstants.MODE_AMOUNT
                            : WOConstants.MODE_PERCENTAGE);
                wneMaxPercentage.Value =
                    ((row[&quot;Prepaymentmode&quot;].ToString2().ToLower2() == &quot;true&quot; || row[&quot;Prepaymentmode&quot;].ToString2() == &quot;1&quot;)
                         ? row[&quot;Value&quot;].ToString2()
                         : &quot;0&quot;).ToDecimal2().ToString(AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE, CultureInfo.CurrentCulture);
                wneMaxAmount.Value =
                    ((row[&quot;Prepaymentmode&quot;].ToString2().ToLower2() == &quot;false&quot; ||
                      row[&quot;Prepaymentmode&quot;].ToString2() == &quot;0&quot;)
                         ? row[&quot;Value&quot;].ToString2()
                         : &quot;0&quot;).ToDecimal2().ToString(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture);

                txtPrepaymentRule.Text = row[&quot;RecoveryRuleName&quot;].ToString2();

                hdnRecoveryID.Value = row[&quot;RecoveryID&quot;].ToString2();

                #endregion

                #region Loading Prepayment Types

                DataTable dtTypes = dsRRDetails.Tables[1];
                dtTypes.Columns.Add(WOConstants.HEADING_RV_IN_RAB);
                string format = (mode == WOConstants.MODE_PERCENTAGE
                                     ? AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE
                                     : AMP3ApplicationSettings.Instance.FORMAT_AMOUNT);
                foreach (DataRow rw in dtTypes.Rows)
                {
                    rw[WOConstants.HEADING_RV_IN_RAB] =
                        CalculateRecoveryValueInEachRAB(rw[&quot;RecoveryValue&quot;].ToString2(),
                                                        rw[&quot;PrepaymentValue&quot;].ToString2(), mode).ToDecimal2().ToString(
                                                            AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture);
                    ;
                    rw[WOConstants.HEADING_AMOUNT_PAID] =
                        rw[WOConstants.HEADING_AMOUNT_PAID].ToDecimal2().ToString(format, CultureInfo.CurrentCulture).
                            ToDecimal2();
                    rw[WOConstants.HEADING_RECOVERED_AMOUNT] =
                        rw[WOConstants.HEADING_RECOVERED_AMOUNT].ToDecimal2().ToString(format,
                                                                                       CultureInfo.CurrentCulture).
                            ToDecimal2();
                }
                dtTypes.AcceptChanges();
                uwgPrepaymentTypes.DataSource = dtTypes;
                uwgPrepaymentTypes.DataBind();

                FormatPrepaymentTypesGrid(mode);

                CalculateAmountOrPercentage(mode);

                HideShowTB(mode);

                #endregion
            }
            if (dsRRDetails.Tables[2].Rows.Count != 0)
            {
                #region Loading Retention Details

                DataRow row1 = dsRRDetails.Tables[2].Rows[0];
                mode = ((row1[&quot;RetentionCeilingMode&quot;].ToString2().ToLower2() == &quot;false&quot; ||
                         row1[&quot;RetentionCeilingMode&quot;].ToString2() == &quot;0&quot;)
                            ? WOConstants.MODE_AMOUNT
                            : WOConstants.MODE_PERCENTAGE);
                lblRetentionCeiling.Text = (mode == WOConstants.MODE_PERCENTAGE
                                                ? &quot;Retention Ceiling Percentage :&quot;
                                                : &quot;Retention Ceiling Amount in &quot; +
                                                  LocalizationManager.GetModuleCurrency(Constants.MODID_CONTMGT,
                                                                                        _ContractID.ToString2()) + &quot; :&quot;);
                wneRetentionPercentage.Value =
                    (row1[&quot;RetentionPercentage&quot;].ToString2() == &quot;&quot; ? &quot;0&quot; : row1[&quot;RetentionPercentage&quot;]).ToDecimal2().
                        ToString(AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE, CultureInfo.CurrentCulture);
                wneRetentionCeiling.Value =
                    (row1[&quot;RetentionCeilingValue&quot;].ToString2() == &quot;&quot; ? &quot;0&quot; : row1[&quot;RetentionCeilingValue&quot;]).ToDecimal2()
                        .ToString(
                            mode == WOConstants.MODE_PERCENTAGE ? AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE : AMP3ApplicationSettings.Instance.FORMAT_AMOUNT,
                            CultureInfo.CurrentCulture);

                txtRetentionRule.Text = row1[&quot;RetentionRuleName&quot;].ToString2();

                hdnRetentionID.Value = row1[&quot;RetentionID&quot;].ToString2();

                #endregion
            }

            #endregion

            if (WODTO.Status &gt;= WOConstants.STAGE_APPROVED &amp;&amp; WODTO.Status != WOConstants.STAGE_DRAFT_AMENDMENT)
            {
                tdApprovedBy.InnerText = WODTO.ApprovedBy;
                tdApprovedOn.InnerText = WODTO.ApprovedOn.ToString(AMP3ApplicationSettings.Instance.FORMAT_DATE, CultureInfo.CurrentCulture);
                tdCreatedBy.Visible = true;
                btnPrepaymentRulePicker.Enabled =
                    btnRetentionRulePicker.Enabled = false;
                if (WODTO.Status &gt;= WOConstants.STAGE_ISSUED &amp;&amp; WODTO.Status != WOConstants.STAGE_APPROVE_AMENDMENT)
                {
                    trIssuedBy.Visible = true;
                    tdIssuedBy2.InnerText = WODTO.IssuedBy;
                    tdIssuedOn2.InnerText = WODTO.IssuedOn.ToString(AMP3ApplicationSettings.Instance.FORMAT_DATE, CultureInfo.CurrentCulture);
                }
                else
                {
                    trIssuedBy.Visible = false;
                }
                if (!isVersion)
                {
                    wneMaxAmount.Enabled =
                        wneMaxPercentage.Enabled =
                        wneRetentionCeiling.Enabled =
                        wneRetentionPercentage.Enabled = false;
                }
                else
                {
                    btnPrepaymentRulePicker.Enabled =
                        btnRetentionRulePicker.Enabled = true;
                }
            }
            else
            {
                trApprovedBy.Visible = false;
                trIssuedBy.Visible = false;
            }

            if (isVersion) //Version being created.
            {
                txtWONo.ReadOnly = true;
                hdnIsVersion.Value = &quot;1&quot;;
            }
            else
                hdnIsVersion.Value = &quot;&quot;;

            if (WODTO.Status &gt;= WOConstants.STAGE_ISSUED &amp;&amp; WODTO.Status != WOConstants.STAGE_DRAFT_AMENDMENT &amp;&amp;
                WODTO.Status != WOConstants.STAGE_APPROVE_AMENDMENT)
            {
                MainToolBar.DisableMenu(&quot;lnkAward&quot;);
                MainToolBar.DisableMenu(&quot;lnkReject&quot;);
                MainToolBar.DisableMenu(&quot;lnkRevert&quot;);
                //MainToolBar.DisableMenu(&quot;lnkNew&quot;);
                //MainToolBar.DisableMenu(&quot;lnkDelete&quot;);
                //MainToolBar.DisableMenu(&quot;lnkGet&quot;);
                //MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).Text = MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).Text.Replace(&quot;Edit&quot;, &quot;View&quot;);

                btnSaveQuot.Style.Add(&quot;display&quot;, &quot;none&quot;);
            }
        }

        private void SetPreReqData()
        {
            uwgActivities.DataSource = GetActivitySchema();
            uwgActivities.DataBind();
            SetActivityGridColumns(null);

            ////bind Schema to WOItemsGrid
            //uwgActiItems.DataSource = GetActiItemsSchema();
            //uwgActiItems.DataBind();
            //SetActivityItemsGridColumns();

            //Load WorkOrderNumber
            if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX))
                txtWONo.Text = WORKORDManager.Instance.GetWONumber(_ContractID, _ProjectID, false,
                                                          Session[Constants.EIS_ADDITIONAL_INFO].ToString2());
            else
                txtWONo.Text = WORKORDManager.Instance.GetWONumber(_ContractID, _ProjectID, false, String.Empty);

            //Load Sub-Contractors list
            LoadContractors();
            dtEndDate.Value =
                dtStartDate.Value =
                dtWODate.Value = DateTime.UtcNow;

            trApprovedBy.Visible =
                trCreatedBy.Visible =
                trIssuedBy.Visible = false;
        }

        private DataTable LoadVendorInfoFromAX(string info)
        {
            if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX) &amp;&amp;
                (AMP3ApplicationSettings.Instance.appSettings.ContainsKey(&quot;ContactorFilter&quot;) &amp;&amp;
                 AMP3ApplicationSettings.Instance.appSettings[&quot;ContactorFilter&quot;].ToUpper2().Equals(&quot;ON&quot;)))
            {
                int count = 0;
                DataSet ds = null;
                string mappedCompany = String.Empty;
                DataTable dtMap = IntegrationConnectorManager.Instance.GetERPObjectMapInfo(Request[&quot;ContractID&quot;],
                                                                                           AMP3Object.CONTMGT, null,
                                                                                           AMP3Object.UNKNOWN,
                                                                                           RegisteredEIS.AX);
                if (dtMap == null || dtMap.Rows.Count &lt;= 0)
                {
                    Page.ClientScript.RegisterClientScriptBlock(GetType(), &quot;Error&quot;,
                                                                &quot;&lt;script&gt;alert(&lt;%= Aurigo.AMP3.Resources.TerminologyResources.ResourceFactory.Instance.GetString(&#39;Contract is not mapped to AX Sub project.&#39;) %&gt;); &lt;/script&gt;&quot;);
                }
                else
                    mappedCompany = dtMap.Rows[0][&quot;ERPCompany&quot;].ToString();


                var objAdditionalInfo = new EISAdditionalInfo(RegisteredEIS.AX);
                objAdditionalInfo.AddInfo(Constants.EIS_ADDITIONAL_INFO, mappedCompany);
                var dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
                dictAdditionalInfo.Add(RegisteredEIS.AX, objAdditionalInfo);
                var ConBrixInfo = new List&lt;ConnectionBrixInfo&gt;();

                var connectorParameter = new ConnectorParameters(dictAdditionalInfo,
                                                                 MethodBase.GetCurrentMethod().DeclaringType.ToString(),
                                                                 MethodBase.GetCurrentMethod().Name + &quot;_&quot; + info,
                                                                 AMP3ObjectType.Unknown, null, null);

                if (IntegrationConnectorManager.HandleIntegration(connectorParameter, ref count, ref ds, true))
                {
                    if (ds.Tables[0].Rows.Count &gt; 0 &amp;&amp; ds != null)
                        return ds.Tables[0];
                    else
                        return null;
                }
                return ds.Tables[0];
            }
            return null;
        }

        private void LoadContractors()
        {
            DataTable SubContracotrs = WORKORDManager.Instance.GetSubContractorsList(_ContractID);
            ddlContractors.DataSource = SubContracotrs;
            ddlContractors.DataTextField = &quot;Contact&quot;;
            ddlContractors.DataValueField = &quot;ContractorID&quot;;
            ddlContractors.DataBind();
            var li = new ListItem(&quot;--Select One--&quot;, &quot;--Select One--&quot;);
            ddlContractors.Items.Insert(0, li);

            wbcDate.Value = MWDateTimeHelper.MWToday;
        }

        private void SetQuotationItemsGridColumns()
        {
            uwgQuotItems.DisplayLayout.AllowSortingDefault = AllowSorting.OnClient;
            uwgQuotItems.DisplayLayout.NoDataMessage = &quot;No items to display&quot;;
            ColumnsCollection cols = uwgQuotItems.Columns;
            if (cols.Exists(&quot;ActivityID&quot;))
                cols.FromKey(&quot;ActivityID&quot;).Hidden = true;
            if (cols.Exists(&quot;QuotationID&quot;))
                cols.FromKey(&quot;QuotationID&quot;).Hidden = true;
            if (cols.Exists(&quot;WorkOrderID&quot;))
                cols.FromKey(&quot;WorkOrderID&quot;).Hidden = true;
            if (cols.Exists(&quot;Number&quot;))
                cols.FromKey(&quot;Number&quot;).Hidden = true;
            if (cols.Exists(&quot;Length&quot;))
                cols.FromKey(&quot;Length&quot;).Hidden = true;
            if (cols.Exists(&quot;Width&quot;))
                cols.FromKey(&quot;Width&quot;).Hidden = true;
            if (cols.Exists(&quot;Height&quot;))
                cols.FromKey(&quot;Height&quot;).Hidden = true;
            if (cols.Exists(&quot;ActivityName&quot;))
                cols.FromKey(&quot;ActivityName&quot;).Header.Caption = &quot;Activity Name&quot;;
            if (cols.Exists(&quot;Quantity&quot;))
            {
                cols.FromKey(&quot;Quantity&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;Quantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                cols.FromKey(&quot;Quantity&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;Quantity&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;Quantity&quot;).CellStyle.Padding.Right = new Unit(&quot;2px&quot;);
                cols.FromKey(&quot;Quantity&quot;).Header.Style.Padding.Right = new Unit(&quot;2px&quot;);
            }
            if (cols.Exists(&quot;Amount&quot;))
            {
                cols.FromKey(&quot;Amount&quot;).FieldLen = 14;
                cols.FromKey(&quot;Amount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                cols.FromKey(&quot;Amount&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;Amount&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;Amount&quot;).CellStyle.Padding.Right = new Unit(&quot;2px&quot;);
                cols.FromKey(&quot;Amount&quot;).Header.Style.Padding.Right = new Unit(&quot;2px&quot;);
            }
            if (cols.Exists(&quot;ContractUnitCost&quot;))
                cols.FromKey(&quot;ContractUnitCost&quot;).Hidden = true;
            if (cols.Exists(&quot;UnitCost&quot;))
                cols.FromKey(&quot;UnitCost&quot;).Hidden = true;
            if (cols.Exists(&quot;Rate&quot;))
            {
                cols.FromKey(&quot;Rate&quot;).Header.Caption = &quot;Rate&quot;;
                cols.FromKey(&quot;Rate&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;
                cols.FromKey(&quot;Rate&quot;).AllowUpdate = AllowUpdate.Yes;
                cols.FromKey(&quot;Rate&quot;).CellStyle.BackColor = Color.Yellow;
                cols.FromKey(&quot;Rate&quot;).FieldLen = 14;
                cols.FromKey(&quot;Rate&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;Rate&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;Rate&quot;).CellStyle.Padding.Right = new Unit(&quot;2px&quot;);
                cols.FromKey(&quot;Rate&quot;).Header.Style.Padding.Right = new Unit(&quot;2px&quot;);
            }
        }

        private void SetActivityGridColumns(WorkOrderDTO WODTO)
        {
            string currency = LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL);
            ColumnsCollection cols = uwgActivities.Columns;
            foreach (UltraGridColumn col in cols)
                if (col.Key != &quot;To&quot;)
                    col.Width = 100;
            if (cols.Exists(&quot;ContractUnitCost&quot;))
            {
                cols.FromKey(&quot;ContractUnitCost&quot;).Header.Caption = &quot;Estimated Rate (&quot; + currency + &quot;)&quot;;
                cols.FromKey(&quot;ContractUnitCost&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;
            }
            if (cols.Exists(&quot;UnitCost&quot;))
            {
                cols.FromKey(&quot;UnitCost&quot;).Hidden = true;
                cols.FromKey(&quot;UnitCost&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;
                cols.FromKey(&quot;UnitCost&quot;).Header.Caption = &quot;WO Rate (&quot; + currency + &quot;)&quot;;
            }
            if (WODTO != null)
            {
                if (WODTO.Status &gt;= WOConstants.STAGE_ISSUED &amp;&amp; isVersion &amp;&amp;
                    WODTO.Status != WOConstants.STAGE_DRAFT_AMENDMENT &amp;&amp;
                    WODTO.Status != WOConstants.STAGE_APPROVE_AMENDMENT)
                {
                    (new List&lt;string&gt; { &quot;UnitCost&quot;, &quot;WOQuantity&quot; }).ForEach(x =&gt;
                                                                              {
                                                                                  if (cols.Exists(x))
                                                                                  {
                                                                                      cols.FromKey(x).Hidden = false;
                                                                                      cols.FromKey(x).AllowUpdate =
                                                                                          AllowUpdate.Yes;
                                                                                      cols.FromKey(x).CellStyle.
                                                                                          BackColor = Color.Yellow;
                                                                                  }
                                                                              });
                }
                else if (WODTO.Status &lt; WOConstants.STAGE_ISSUED)
                {
                    if (cols.Exists(&quot;WOQuantity&quot;))
                    {
                        if (WODTO.Status != WOConstants.STAGE_APPROVED)
                        {
                            cols.FromKey(&quot;WOQuantity&quot;).AllowUpdate = AllowUpdate.Yes;
                            cols.FromKey(&quot;WOQuantity&quot;).CellStyle.BackColor = Color.Yellow;
                        }
                    }
                }
                if ((isVersion) &amp;&amp; (WODTO.Status == WOConstants.STAGE_DRAFT_AMENDMENT))
                {
                    cols.FromKey(&quot;WOQuantity&quot;).AllowUpdate = AllowUpdate.Yes;
                    cols.FromKey(&quot;WOQuantity&quot;).CellStyle.BackColor = Color.Yellow;
                }
                if (WODTO.Status &gt;= WOConstants.STAGE_ISSUED)
                {
                    (new List&lt;string&gt;
                         {
                             &quot;Posted Quantity&quot;,
                             &quot;AvailQty&quot;,
                             &quot;Total Billed Quantity&quot;,
                             &quot;Total Certified Quantity&quot;,
                             &quot;Amount&quot;,
                             &quot;ContractUnitCost&quot;,
                             &quot;Line Number&quot;,
                             &quot;Description&quot;,
                             &quot;Standard Item No.&quot;
                         }).ForEach(x =&gt;
                                        {
                                            if (cols.Exists(x))
                                                cols.FromKey(x).AllowUpdate = AllowUpdate.No;
                                        });
                }
            }
            else if (IsNewInstance)
            {
                if (cols.Exists(&quot;WOQuantity&quot;))
                {
                    cols.FromKey(&quot;WOQuantity&quot;).AllowUpdate = AllowUpdate.Yes;
                    cols.FromKey(&quot;WOQuantity&quot;).CellStyle.BackColor = Color.Yellow;
                }
            }
            if (cols.Exists(&quot;ActivityName&quot;))
            {
                cols.FromKey(&quot;ActivityName&quot;).Header.Caption = &quot;Activity&quot;;
                //cols.FromKey(&quot;ActivityName&quot;).IsGroupByColumn = true;
                //uwgActivities.DisplayLayout.GroupByBox.Hidden = true;
            }
            if (cols.Exists(&quot;SubItem&quot;))
                cols.FromKey(&quot;SubItem&quot;).Header.Caption = &quot;Sub Item&quot;;
            if (cols.Exists(&quot;AvailQty&quot;))
            {
                cols.FromKey(&quot;AvailQty&quot;).Header.Caption = &quot;Available Quantity&quot;;
                cols.FromKey(&quot;AvailQty&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
            }
            if (cols.Exists(&quot;WOQuantity&quot;))
            {
                cols.FromKey(&quot;WOQuantity&quot;).Header.Caption = &quot;Quantity&quot;;
                cols.FromKey(&quot;WOQuantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
            }
            if (cols.Exists(&quot;Amount&quot;))
                cols.FromKey(&quot;Amount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
            (new List&lt;string&gt; { &quot;Amount&quot;, &quot;Quantity&quot;, &quot;ContractUnitCost&quot;, &quot;WOQuantity&quot; }).ForEach(x =&gt;
                                                                                                    {
                                                                                                        if (
                                                                                                            cols.Exists(
                                                                                                                x))
                                                                                                        {
                                                                                                            cols.FromKey
                                                                                                                (x).
                                                                                                                Header.
                                                                                                                Style.
                                                                                                                HorizontalAlign
                                                                                                                =
                                                                                                                cols.
                                                                                                                    FromKey
                                                                                                                    (x).
                                                                                                                    CellStyle
                                                                                                                    .
                                                                                                                    HorizontalAlign
                                                                                                                =
                                                                                                                HorizontalAlign
                                                                                                                    .
                                                                                                                    Right;
                                                                                                            cols.FromKey
                                                                                                                (x).
                                                                                                                CellStyle
                                                                                                                .Padding
                                                                                                                .Right =
                                                                                                                cols.
                                                                                                                    FromKey
                                                                                                                    (x).
                                                                                                                    Header
                                                                                                                    .
                                                                                                                    Style
                                                                                                                    .
                                                                                                                    Padding
                                                                                                                    .
                                                                                                                    Right
                                                                                                                =
                                                                                                                new Unit
                                                                                                                    (&quot;2px&quot;);
                                                                                                        }
                                                                                                    });
            (new List&lt;string&gt;
                 {
                     &quot;Quantity&quot;,
                     &quot;ItemID&quot;,
                     &quot;ActivityID&quot;,
                     &quot;WorkOrderID&quot;,
                     &quot;Amt&quot;,
                     &quot;SubItemID&quot;,
                     &quot;ActID&quot;,
                     &quot;PreVerActID&quot;,
                     &quot;ActivityName&quot;,
                     &quot;UnitID&quot;,
                     &quot;ItemCompletedQuantity&quot;,
                     &quot;CompletedQuantity&quot;,
                     &quot;AssociatedResourceID&quot;
                 }).ForEach(x =&gt; { if (cols.Exists(x)) cols.FromKey(x).Hidden = true; });
            (list).ForEach(x =&gt; { if (cols.Exists(x)) cols.FromKey(x).Hidden = true; });
            //(list).ForEach(x =&gt;
            //{
            //    if (cols.Exists(x))
            //    {
            //        cols.FromKey(x).Format = Constants.FORMAT_AMOUNT;
            //        cols.FromKey(x).Header.Style.HorizontalAlign = cols.FromKey(x).CellStyle.HorizontalAlign = HorizontalAlign.Right;
            //        cols.FromKey(x).CellStyle.Padding.Right = cols.FromKey(x).Header.Style.Padding.Right = new Unit(&quot;2px&quot;);
            //    }
            //}
            //);
            if (cols.Exists(&quot;IsShortClose&quot;)) cols.FromKey(&quot;IsShortClose&quot;).Hidden = true;
            if (cols.Exists(&quot;PreVerActID&quot;)) cols.FromKey(&quot;PreVerActID&quot;).Hidden = true;
            if (!isVersion)
            {
                if (cols.Exists(&quot;Posted Quantity/MBook Quantity&quot;))
                    cols.FromKey(&quot;Posted Quantity/MBook Quantity&quot;).Hidden = true;
                if (cols.Exists(&quot;BilledQuantity&quot;)) cols.FromKey(&quot;BilledQuantity&quot;).Hidden = true;
                if (cols.Exists(&quot;CertifiedQuantity&quot;)) cols.FromKey(&quot;CertifiedQuantity&quot;).Hidden = true;
            }
            else
            {
                if (cols.Exists(&quot;Posted Quantity/MBook Quantity&quot;))
                    cols.FromKey(&quot;Posted Quantity/MBook Quantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                if (cols.Exists(&quot;BilledQuantity&quot;))
                {
                    cols.FromKey(&quot;BilledQuantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                    cols.FromKey(&quot;BilledQuantity&quot;).Header.Caption = &quot;Total Billed Quantity&quot;;
                }
                if (cols.Exists(&quot;CertifiedQuantity&quot;))
                {
                    cols.FromKey(&quot;CertifiedQuantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                    cols.FromKey(&quot;CertifiedQuantity&quot;).Header.Caption = &quot;Total Certified Quantity&quot;;
                }
                (new List&lt;string&gt;
                     {
                         &quot;Posted Quantity/MBook Quantity&quot;,
                         &quot;AvailQty&quot;,
                         &quot;BilledQuantity&quot;,
                         &quot;CertifiedQuantity&quot;,
                         &quot;Amount&quot;,
                         &quot;ContractUnitCost&quot;
                     }).ForEach(x =&gt;
                                    {
                                        if (cols.Exists(x))
                                            cols.FromKey(x).AllowUpdate = AllowUpdate.No;
                                    });
            }
            if (cols.Exists(&quot;Activity Description&quot;))
            {
                cols.FromKey(&quot;Activity Description&quot;).Move(cols.FromKey(&quot;Activity Name&quot;).Index + 1);
                cols.FromKey(&quot;Activity Description&quot;).Width = 125;
            }

            if (cols.Exists(&quot;Activity Name&quot;))
            {
                cols.FromKey(&quot;Activity Name&quot;).Width = 125;
            }
            uwgActivities.Height = Unit.Pixel(175);
        }

        private DataTable GetActivitySchema()
        {
            DataTable dtActivity = new BrixDataTable(&quot;Activities&quot;);
            dtActivity.Columns.AddRange(new[]
                                            {
                                                new DataColumn(&quot;ActID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                                                new DataColumn(&quot;ActivityID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                                                new DataColumn(&quot;WorkOrderID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                                                new DataColumn(&quot;ActivityName&quot;),
                                                new DataColumn(&quot;Activity Name&quot;),
                                                new DataColumn(&quot;Activity Description&quot;),
                                                new DataColumn(&quot;SubItem&quot;),
                                                new DataColumn(&quot;Unit&quot;),
                                                new DataColumn(&quot;Number&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                new DataColumn(&quot;Length&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                new DataColumn(&quot;Width&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                new DataColumn(&quot;Height&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                new DataColumn(&quot;AvailQty&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                new DataColumn(&quot;Quantity&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                new DataColumn(&quot;WOQuantity&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                new DataColumn(&quot;BilledQuantity&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                new DataColumn(&quot;CertifiedQuantity&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                new DataColumn(&quot;Posted Quantity/MBook Quantity&quot;,
                                                               Type.GetType(&quot;System.Double&quot;)),
                                                new DataColumn(&quot;UnitCost&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                new DataColumn(&quot;ContractUnitCost&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                new DataColumn(&quot;Amount&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                new DataColumn(&quot;Amt&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                new DataColumn(&quot;ItemID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                                                new DataColumn(&quot;SubItemID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                                                new DataColumn(&quot;LineNo&quot;),
                                                new DataColumn(&quot;StandardItemNo&quot;),
                                                new DataColumn(&quot;Description&quot;),
                                                new DataColumn(&quot;UnitID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                                                new DataColumn(&quot;ItemCompletedQuantity&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                new DataColumn(&quot;CompletedQuantity&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                new DataColumn(&quot;AssociatedResourceID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                                                new DataColumn(&quot;IsShortClose&quot;, Type.GetType(&quot;System.Boolean&quot;)),
                                                new DataColumn(&quot;PreVerActID&quot;, Type.GetType(&quot;System.Boolean&quot;))
                                            });
            return dtActivity;
        }

        private DataTable GetActiItemsSchema()
        {
            DataTable dtActiItems = new BrixDataTable(&quot;Items&quot;);
            dtActiItems.Columns.AddRange(new[]
                                             {
                                                 new DataColumn(&quot;ItemID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                                                 new DataColumn(&quot;LineNo&quot;),
                                                 new DataColumn(&quot;StandardItemNo&quot;),
                                                 new DataColumn(&quot;Description&quot;),
                                                 new DataColumn(&quot;SubItem&quot;),
                                                 new DataColumn(&quot;WOQuantity&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                 new DataColumn(&quot;Quantity&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                 new DataColumn(&quot;Unit&quot;),
                                                 new DataColumn(&quot;UnitPrice&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                 new DataColumn(&quot;SubItemID&quot;, Type.GetType(&quot;System.Int32&quot;))
                                             });
            return dtActiItems;
        }

        protected void btnItemPicker_Click(object sender, EventArgs e)
        {
            ShowDiv(ItemDivEnums.ItemPicker);
            genericPicker.ItemSelected += genericPicker_ItemSelected;
            genericPicker.ChangeTableOrViewAndBind(&quot;ACTIWOItemsByActivity&quot;);
        }

        protected void btnGetItems_Click(object sender, EventArgs e)
        {
            //DataTable dt = WOManager.Instance.GetBOQsForActivity(_ContractID, ddlActivityName.Text, null);
            //btnGetItems.Style.Add(&quot;display&quot;, &quot;block&quot;);
            //txtActivityName.Style.Add(&quot;display&quot;, &quot;none&quot;);
            //RowsCollection rows = uwgActiItems.Rows;
            //rows.Clear();
            //foreach (DataRow dr in dt.Rows)
            //{
            //    bool Exists = false;
            //    for (int i = 0; i &lt; rows.Count; i++)
            //    {
            //        if (rows[i].Cells.FromKey(&quot;ItemID&quot;).Value.ToInt32_2() == dr[&quot;ItemID&quot;].ToInt32_2()
            //            &amp;&amp; rows[i].Cells.FromKey(&quot;SubItemID&quot;).Value.ToInt32_2() == dr[&quot;SubItemID&quot;].ToInt32_2())
            //            Exists = true;
            //    }
            //    if (!Exists)
            //    {
            //        uwgActiItems.Rows.Add();

            //        UltraGridRow row = uwgActiItems.Rows[uwgActiItems.Rows.Count - 1];
            //        row.Cells.FromKey(&quot;ItemID&quot;).Value = dr[&quot;ItemID&quot;];
            //        row.Cells.FromKey(&quot;LineNo&quot;).Value = dr[&quot;LineNo&quot;];
            //        row.Cells.FromKey(&quot;StandardItemNo&quot;).Value = dr[&quot;StandardItemNo&quot;];
            //        row.Cells.FromKey(&quot;Description&quot;).Value = dr[&quot;Description&quot;];
            //        row.Cells.FromKey(&quot;Unit&quot;).Value = dr[&quot;Unit&quot;];
            //        row.Cells.FromKey(&quot;UnitPrice&quot;).Value = dr[&quot;UnitPrice&quot;];
            //        row.Cells.FromKey(&quot;WOQuantity&quot;).Value = 0.0;
            //        row.Cells.FromKey(&quot;Quantity&quot;).Value = dr[&quot;Quantity&quot;];
            //        row.Cells.FromKey(&quot;SubItem&quot;).Value = dr[&quot;SubItem&quot;];
            //        row.Cells.FromKey(&quot;SubItemID&quot;).Value = dr[&quot;SubItemID&quot;];
            //    }
            //}
            //ShowDiv(ItemDivEnums.CreateWO);
            //hdnVisibleTab.Value = WOConstants.TAB_ACTI;
            ////Page.ClientScript.RegisterStartupScript(GetType(), &quot;showActivityDetails1&quot;, &quot;setTimeout(&#39;ShowActivityDetails();&#39;, 1000);&quot;, true);
        }

        private void genericPicker_ItemSelected(object sender, ItemSelectedEventArgs e)
        {
            RowsCollection rows = uwgActivities.Rows;
            //uwgActivities.Columns.FromKey(&quot;ActivityName&quot;).IsGroupByColumn = false;
            foreach (DataRow dr in e.SelectedItems.Rows)
            {
                bool Exists = false;
                for (int i = 0; i &lt; rows.Count; i++)
                {
                    if (rows[i].Cells.FromKey(&quot;ActID&quot;).Value.ToInt32_2() == dr[&quot;ActivityID&quot;].ToInt32_2()
                        &amp;&amp; rows[i].Cells.FromKey(&quot;ItemID&quot;).Value.ToInt32_2() == dr[&quot;ItemID&quot;].ToInt32_2()
                        &amp;&amp; rows[i].Cells.FromKey(&quot;SubItemID&quot;).Value.ToInt32_2() == dr[&quot;SubItemID&quot;].ToInt32_2())
                        Exists = true;
                }
                if (!Exists)
                {
                    uwgActivities.Rows.Add();

                    UltraGridRow row = uwgActivities.Rows[uwgActivities.Rows.Count - 1];
                    row.Cells.FromKey(&quot;ActivityID&quot;).Value = 0;
                    row.Cells.FromKey(&quot;ActID&quot;).Value = dr[&quot;ActivityID&quot;];
                    row.Cells.FromKey(&quot;ActivityName&quot;).Value =
                        row.Cells.FromKey(&quot;Activity Name&quot;).Value = dr[&quot;ActivityName&quot;];
                    row.Cells.FromKey(&quot;Activity Description&quot;).Value = dr[&quot;Activity description&quot;];
                    row.Cells.FromKey(&quot;ItemID&quot;).Value = dr[&quot;ItemID&quot;];
                    row.Cells.FromKey(&quot;LineNo&quot;).Value = dr[&quot;LineNo&quot;];
                    row.Cells.FromKey(&quot;StandardItemNo&quot;).Value = dr[&quot;StandardItemNo&quot;];
                    row.Cells.FromKey(&quot;Description&quot;).Value = dr[&quot;Description&quot;];
                    row.Cells.FromKey(&quot;Unit&quot;).Value = dr[&quot;Unit&quot;];
                    if (row.Cells.Exists(&quot;ContractUnitCost&quot;))
                    {
                        if (!string.IsNullOrEmpty(dr[&quot;AssociatedResourceID&quot;].ToString()))
                        {
                            try
                            {
                                row.Cells.FromKey(&quot;ContractUnitCost&quot;).Value =
                                    ItemManager.Instance.GetRateAnalysis(int.Parse(dr[&quot;AssociatedResourceID&quot;].ToString())).
                                        Rate;
                            }
                            catch (Exception)
                            {
                                row.Cells.FromKey(&quot;ContractUnitCost&quot;).Value = 0.0;
                            }
                        }
                        else
                            row.Cells.FromKey(&quot;ContractUnitCost&quot;).Value = 0.0;
                    }
                    row.Cells.FromKey(&quot;WOQuantity&quot;).Value = 0.0;
                    row.Cells.FromKey(&quot;Amount&quot;).Value = 0.0;
                    row.Cells.FromKey(&quot;Quantity&quot;).Value =
                        row.Cells.FromKey(&quot;AvailQty&quot;).Value =
                        dr[&quot;AvailQty&quot;].ToDecimal2() +
                        GetDelQty(dr[&quot;ActivityName&quot;].ToString2(), dr[&quot;ItemID&quot;].ToInt32_2(),
                                  dr[&quot;SubItemID&quot;].Equals(DBNull.Value) ? 0 : dr[&quot;SubItemID&quot;].ToInt32_2());
                    row.Cells.FromKey(&quot;SubItem&quot;).Value = dr[&quot;SubItem&quot;];
                    row.Cells.FromKey(&quot;SubItemID&quot;).Value = dr[&quot;SubItemID&quot;];
                    row.Cells.FromKey(&quot;UnitID&quot;).Value = dr[&quot;UnitID&quot;];
                    if (row.Cells.Exists(&quot;AssociatedResourceID&quot;)) row.Cells.FromKey(&quot;AssociatedResourceID&quot;).Value = dr[&quot;AssociatedResourceID&quot;].ToString();
                    // Set editable based on the settings
                    bool allowEditing = WORKORDManager.Instance.ShouldAllowUnlimitedQuotRate(_ContractID, _ProjectID);
                    if (row.Cells.Exists(&quot;ContractUnitCost&quot;))
                    {
                        row.Cells.FromKey(&quot;ContractUnitCost&quot;).AllowEditing =
                            (!string.IsNullOrEmpty(dr[&quot;AssociatedResourceID&quot;].ToString()))
                                ? AllowEditing.No
                                : AllowEditing.Yes;
                        row.Cells.FromKey(&quot;ContractUnitCost&quot;).Style.BackColor =
                            (!string.IsNullOrEmpty(dr[&quot;AssociatedResourceID&quot;].ToString()) &amp;&amp; !allowEditing)
                                ? Color.Transparent
                                : Color.Yellow;
                    }
                }
            }
            //uwgActivities.Columns.FromKey(&quot;ActivityName&quot;).IsGroupByColumn = true;
            ShowDiv(ItemDivEnums.CreateWO);
            hdnVisibleTab.Value = WOConstants.TAB_ACTI;
            //Page.ClientScript.RegisterStartupScript(GetType(), &quot;showActivityDetails1&quot;, &quot;setTimeout(&#39;ShowActivityDetails();&#39;, 1000);&quot;, true);
        }

        private Decimal GetDelQty(string ActivityName, int ItemID, int SubItemID)
        {
            if (DelItems.Count == 0 ||
                !DelItems.Exists(f =&gt; f.ActivityName == ActivityName &amp;&amp; f.ItemID == ItemID &amp;&amp; f.SubItemID == SubItemID))
                return 0;
            else
                return
                    DelItems.Find(f =&gt; f.ActivityName == ActivityName &amp;&amp; f.ItemID == ItemID &amp;&amp; f.SubItemID == SubItemID)
                        .Quantity;
        }

        protected void uwgActivities_InitializeGroupByRow(object sender, RowEventArgs e)
        {
            e.Row.Expanded = true;
        }

        protected void btnFetchContractor_Click(object sender, EventArgs e)
        {
            if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX))
            {
                int count = 0;
                DataSet ds = null;
                string mappedCompany = String.Empty;
                string filterCriteria = &quot;&quot;;
                DataTable SubContracotrs = WORKORDManager.Instance.GetSubContractorsList(_ContractID);
                DataTable dtMainSubContractors = SubContracotrs.Clone();
                string contractorList = &quot;&quot;;
                foreach (DataRow dr in SubContracotrs.Rows)
                    contractorList += dr[&quot;ContractorID&quot;] + &quot;;&quot;;
                contractorList = contractorList.Substring(0, (contractorList.Length - 1));
                DataTable dtMap = IntegrationConnectorManager.Instance.GetERPObjectMapInfo(Request[&quot;ContractID&quot;],
                                                                                           AMP3Object.CONTMGT, null,
                                                                                           AMP3Object.UNKNOWN,
                                                                                           RegisteredEIS.AX);
                if (dtMap == null || dtMap.Rows.Count &lt;= 0)
                {
                    Page.ClientScript.RegisterClientScriptBlock(GetType(), &quot;Error&quot;,
                                                                &quot;&lt;script&gt;alert(&lt;%= Aurigo.AMP3.Resources.TerminologyResources.ResourceFactory.Instance.GetString(&#39;Contract is not mapped to AX Sub project.&#39;) %&gt;); &lt;/script&gt;&quot;);
                }
                else
                    mappedCompany = dtMap.Rows[0][&quot;ERPCompany&quot;].ToString();


                var confilter = new ConnectionFilter(filterCriteria, null, null, null, null);
                var objAdditionalInfo = new EISAdditionalInfo(RegisteredEIS.AX);
                objAdditionalInfo.AddInfo(Constants.EIS_ADDITIONAL_INFO, mappedCompany);
                objAdditionalInfo.AddInfo(&quot;Condition&quot;, contractorList);
                if (ddlCategory.SelectedValue.Equals(&quot;--Select One--&quot;))
                    objAdditionalInfo.AddInfo(&quot;CategoryId&quot;, &quot;&quot;);
                else
                    objAdditionalInfo.AddInfo(&quot;CategoryId&quot;, ddlCategory.SelectedValue);

                if (ddlSegment.SelectedValue.Equals(&quot;--Select One--&quot;))
                    objAdditionalInfo.AddInfo(&quot;SegmentId&quot;, &quot;&quot;);
                else
                    objAdditionalInfo.AddInfo(&quot;SegmentId&quot;, ddlSegment.SelectedValue);

                if (ddlCertification.SelectedValue.Equals(&quot;--Select One--&quot;))
                    objAdditionalInfo.AddInfo(&quot;CertificationId&quot;, &quot;&quot;);
                else

                    objAdditionalInfo.AddInfo(&quot;CertificationId&quot;, ddlCertification.SelectedValue);

                var dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
                dictAdditionalInfo.Add(RegisteredEIS.AX, objAdditionalInfo);

                var ConBrixInfo = new List&lt;ConnectionBrixInfo&gt;();

                var connectorParameter = new ConnectorParameters(dictAdditionalInfo, MethodBase.GetCurrentMethod(),
                                                                 AMP3ObjectType.Unknown, confilter, null);

                if (IntegrationConnectorManager.HandleIntegration(connectorParameter, ref count, ref ds, true))
                {
                    if (ds != null &amp;&amp; ds.Tables.Count != 0 &amp;&amp; ds.Tables[0].Rows.Count &gt; 0)
                    {
                        foreach (DataRow drN in ds.Tables[0].Rows)
                        {
                            if (drN != null &amp;&amp; drN[&quot;ContractorID&quot;] != null)
                            {
                                DataRow drMain = dtMainSubContractors.NewRow();
                                drMain = SubContracotrs.Select(&quot;ContractorID = &#39;&quot; + drN[&quot;ContractorID&quot;] + &quot;&#39;&quot;)[0];
                                dtMainSubContractors.ImportRow(drMain);
                            }
                        }
                    }
                    if (dtMainSubContractors.Rows.Count == 0)
                    {
                        DataRow drM = dtMainSubContractors.NewRow();
                        dtMainSubContractors.Rows.Add(drM);
                        dtMainSubContractors.Rows[0][0] = &quot;No Data&quot;;
                        dtMainSubContractors.Rows[0][1] = &quot;No Data&quot;;
                    }
                    ddlContractors.DataSource = dtMainSubContractors;
                    ddlContractors.DataTextField = &quot;Contact&quot;;
                    ddlContractors.DataValueField = &quot;ContractorID&quot;;
                    ddlContractors.DataBind();
                }
            }
            trQuotTemplate.Style.Add(&quot;display&quot;, &quot;table-row&quot;);
        }

        private void itemPicker_MultipleSelectedIndexChanged(object sender, ClickEventArgs e)
        {
            //RowsCollection rows = uwgActiItems.Rows;
            //List&lt;Item&gt; items = itemPicker.GetMultipleDTOFromHTTP();
            //items.ForEach(x =&gt;
            //{
            //    DataTable dt = WOManager.Instance.GetBOQsForActivity(_ContractID, null, x.ItemID);
            //    foreach (DataRow dr in dt.Rows)
            //    {
            //        bool Exists = false;
            //        for (int i = 0; i &lt; rows.Count; i++)
            //        {
            //            if (rows[i].Cells.FromKey(&quot;ItemID&quot;).Value.ToInt32_2() == dr[&quot;ItemID&quot;].ToInt32_2()
            //                &amp;&amp; rows[i].Cells.FromKey(&quot;SubItemID&quot;).Value.ToInt32_2() == dr[&quot;SubItemID&quot;].ToInt32_2())
            //                Exists = true;
            //        }
            //        if (!Exists)
            //        {
            //            uwgActiItems.Rows.Add();

            //            UltraGridRow row = uwgActiItems.Rows[uwgActiItems.Rows.Count - 1];
            //            row.Cells.FromKey(&quot;ItemID&quot;).Value = dr[&quot;ItemID&quot;];
            //            row.Cells.FromKey(&quot;LineNo&quot;).Value = dr[&quot;LineNo&quot;];
            //            row.Cells.FromKey(&quot;StandardItemNo&quot;).Value = dr[&quot;StandardItemNo&quot;];
            //            row.Cells.FromKey(&quot;Description&quot;).Value = dr[&quot;Description&quot;];
            //            row.Cells.FromKey(&quot;Unit&quot;).Value = dr[&quot;Unit&quot;];
            //            row.Cells.FromKey(&quot;UnitPrice&quot;).Value = dr[&quot;UnitPrice&quot;];
            //            row.Cells.FromKey(&quot;WOQuantity&quot;).Value = 0.0;
            //            row.Cells.FromKey(&quot;Quantity&quot;).Value = dr[&quot;Quantity&quot;];
            //            row.Cells.FromKey(&quot;SubItem&quot;).Value = dr[&quot;SubItem&quot;];
            //            row.Cells.FromKey(&quot;SubItemID&quot;).Value = dr[&quot;SubItemID&quot;];
            //        }
            //    }   
            //});
            //ShowDiv(ItemDivEnums.CreateWO);
            //hdnVisibleTab.Value = WOConstants.TAB_ACTI;
            //Page.ClientScript.RegisterStartupScript(GetType(), &quot;showActivityDetails1&quot;, &quot;setTimeout(&#39;ShowActivityDetails();&#39;, 1000);&quot;, true);
        }

        //void itemPicker_SelectedIndexChanged(object sender, ClickEventArgs e)
        //{
        //    Item conItem = itemPicker.GetDTOFromHTTP(e);
        //    DataTable dt = WOManager.Instance.GetBOQsForActivity(_ContractID, null, conItem.ItemID);
        //    RowsCollection rows = uwgActiItems.Rows;
        //    foreach (DataRow dr in dt.Rows)
        //    {
        //        bool Exists = false;
        //        for (int i = 0; i &lt; rows.Count; i++)
        //        {
        //            if (rows[i].Cells.FromKey(&quot;ItemID&quot;).Value.ToInt32_2() == dr[&quot;ItemID&quot;].ToInt32_2()
        //                &amp;&amp; rows[i].Cells.FromKey(&quot;SubItemID&quot;).Value.ToInt32_2() == dr[&quot;SubItemID&quot;].ToInt32_2())
        //                Exists = true;
        //        }
        //        if (!Exists)
        //        {
        //            uwgActiItems.Rows.Add();

        //            UltraGridRow row = uwgActiItems.Rows[uwgActiItems.Rows.Count - 1];
        //            row.Cells.FromKey(&quot;ItemID&quot;).Value = dr[&quot;ItemID&quot;];
        //            row.Cells.FromKey(&quot;LineNo&quot;).Value = dr[&quot;LineNo&quot;];
        //            row.Cells.FromKey(&quot;StandardItemNo&quot;).Value = dr[&quot;StandardItemNo&quot;];
        //            row.Cells.FromKey(&quot;Description&quot;).Value = dr[&quot;Description&quot;];
        //            row.Cells.FromKey(&quot;Unit&quot;).Value = dr[&quot;Unit&quot;];
        //            row.Cells.FromKey(&quot;UnitPrice&quot;).Value = dr[&quot;UnitPrice&quot;];
        //            row.Cells.FromKey(&quot;WOQuantity&quot;).Value = 0.0;
        //            row.Cells.FromKey(&quot;Quantity&quot;).Value = dr[&quot;Quantity&quot;];
        //            row.Cells.FromKey(&quot;SubItem&quot;).Value = dr[&quot;SubItem&quot;];
        //            row.Cells.FromKey(&quot;SubItemID&quot;).Value = dr[&quot;SubItemID&quot;];
        //        }
        //    }
        //    //DataTable dt = ItemManager.Instance.GetSubItemData(Constants.MODID_CONTMGT, _ContractID, conItem.ItemID.Value).Tables[0];
        //    ////There is no sub item...
        //    //if (dt.Rows.Count == 0)
        //    //{
        //    //    for (int i = 0; i &lt; rows.Count; i++)
        //    //    {
        //    //        if (BrixDatatypeHelper.ToInt32_2(rows[i].Cells.FromKey(&quot;ItemID&quot;).Value) == (conItem.ItemID ?? 0))
        //    //        {
        //    //            ShowDiv(ItemDivEnums.CreateWO);
        //    //            hdnVisibleTab.Value = WOConstants.TAB_ACTI;

        //    //            Page.ClientScript.RegisterStartupScript(GetType(), &quot;Item already added.&quot;,
        //    //                &quot;alert(&#39;An &quot; + LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR) + &quot; can be added only once.&#39;);&quot;, true);
        //    //            Page.ClientScript.RegisterStartupScript(GetType(), &quot;showActivityDetails1&quot;, &quot;setTimeout(&#39;ShowActivityDetails();&#39;, 1000);&quot;, true);
        //    //            return;
        //    //        }
        //    //    }
        //    //    uwgActiItems.Rows.Add();
        //    //    row = uwgActiItems.Rows[uwgActiItems.Rows.Count - 1];
        //    //    row.Cells.FromKey(&quot;ItemID&quot;).Value = conItem.ItemID;
        //    //    row.Cells.FromKey(&quot;LineNo&quot;).Value = conItem.LineNo;
        //    //    row.Cells.FromKey(&quot;StandardItemNo&quot;).Value = conItem.StandardItemNo;
        //    //    row.Cells.FromKey(&quot;Description&quot;).Value = conItem.Description;
        //    //    row.Cells.FromKey(&quot;Unit&quot;).Value = conItem.Unit;
        //    //    row.Cells.FromKey(&quot;UnitPrice&quot;).Value = conItem.UnitPrice;
        //    //    row.Cells.FromKey(&quot;WOQuantity&quot;).Value = 0.0;
        //    //    row.Cells.FromKey(&quot;Quantity&quot;).Value = conItem.Quantity;
        //    //    row.Cells.FromKey(&quot;SubItemID&quot;).Value = 0;
        //    //    row.Cells.FromKey(&quot;SubItem&quot;).Value = &quot;-&quot;;
        //    //}
        //    //else
        //    //{
        //    //    foreach (DataRow dr in dt.Rows)
        //    //    {
        //    //        bool Exists = false;
        //    //        for (int i = 0; i &lt; rows.Count; i++)
        //    //        {
        //    //            if (rows[i].Cells.FromKey(&quot;ItemID&quot;).Value.ToInt32_2() == dr[&quot;ItemID&quot;].ToInt32_2()
        //    //            &amp;&amp; rows[i].Cells.FromKey(&quot;SubItemID&quot;).Value.ToInt32_2() == dr[&quot;SubItemID&quot;].ToInt32_2())
        //    //                Exists = true;
        //    //        }
        //    //        if (!Exists)
        //    //        {
        //    //            uwgActiItems.Rows.Add();
        //    //            row = uwgActiItems.Rows[uwgActiItems.Rows.Count - 1];
        //    //            row.Cells.FromKey(&quot;ItemID&quot;).Value = conItem.ItemID;
        //    //            row.Cells.FromKey(&quot;LineNo&quot;).Value = conItem.LineNo;
        //    //            row.Cells.FromKey(&quot;StandardItemNo&quot;).Value = conItem.StandardItemNo;
        //    //            row.Cells.FromKey(&quot;Description&quot;).Value = conItem.Description;
        //    //            row.Cells.FromKey(&quot;Unit&quot;).Value = conItem.Unit;
        //    //            row.Cells.FromKey(&quot;UnitPrice&quot;).Value = conItem.UnitPrice;
        //    //            row.Cells.FromKey(&quot;WOQuantity&quot;).Value = 0.0;
        //    //            row.Cells.FromKey(&quot;Quantity&quot;).Value = dr[&quot;Quantity&quot;];
        //    //            row.Cells.FromKey(&quot;SubItemID&quot;).Value = dr[&quot;SubItemID&quot;];
        //    //            row.Cells.FromKey(&quot;SubItem&quot;).Value = dr[&quot;Description&quot;];
        //    //        }
        //    //    }
        //    //}

        //    ShowDiv(ItemDivEnums.CreateWO);
        //    hdnVisibleTab.Value = WOConstants.TAB_ACTI;
        //    Page.ClientScript.RegisterStartupScript(GetType(), &quot;showActivityDetails1&quot;, &quot;setTimeout(&#39;ShowActivityDetails();&#39;, 1000);&quot;, true);
        //}

        /// &lt;summary&gt;
        /// Calculates the Qty Available for allocation for a particular item
        /// = contractQty - (posted quantity + quantity alloted to other Work Orders)
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;ItemID&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;ContractQty&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private decimal GetAvailableQuantity(int ItemID, int WorkOrderID)
        {
            decimal qtyRemaining = WORKORDManager.Instance.GetAvailableQuantityForItem(ItemID, WorkOrderID);
            return (qtyRemaining &gt; 0) ? qtyRemaining : 0;
        }

        protected void OnCheckedChanged_Click(object sender, EventArgs e)
        {
        }

        private decimal GetAppPostedQty(int ItemID, int WorkOrderID)
        {
            decimal qtyPosted = WORKORDManager.Instance.GetAppPostedQty(ItemID, WorkOrderID);
            return (qtyPosted &gt; 0) ? qtyPosted : 0;
        }

        protected void BtnCancelItemPicker_Click(object sender, EventArgs e)
        {
            ShowDiv(ItemDivEnums.CreateWO);
            hdnVisibleTab.Value = WOConstants.TAB_ACTI;
            //Page.ClientScript.RegisterStartupScript(GetType(), &quot;showActivityDetails1&quot;, &quot;setTimeout(&#39;ShowActivityDetails();&#39;, 1000);&quot;, true);
        }

        private void ShowDiv(ItemDivEnums divType)
        {
            bool itemPicker = (ItemDivEnums.ItemPicker == divType);
            bool prepaymentPicker = (ItemDivEnums.PrepaymentPicker == divType);
            bool retentionPicker = (ItemDivEnums.RetentionPicker == divType);
            bool woPicker = (ItemDivEnums.CreateWO == divType);

            DivItemPicker.Visible = itemPicker;
            DivWO.Visible = woPicker;
            DivPrepaymentPicker.Visible = prepaymentPicker;
            DivRetentionPicker.Visible = retentionPicker;
            string heading = string.Empty;
            if (itemPicker) heading = &quot;Select &quot; + ItemNameAbbr;
            if (prepaymentPicker) heading = &quot;Select Pre-payment Rule&quot;;
            if (retentionPicker) heading = &quot;Select Retention Rule&quot;;
            PageTitle = ((itemPicker || prepaymentPicker || retentionPicker)
                              ? heading
                              : (IsNewInstance ? &quot;New Activity based Work Order&quot; : &quot;Edit Activity based Work Order&quot;));

            switch (divType)
            {
                case ItemDivEnums.ItemPicker:
                case ItemDivEnums.PrepaymentPicker:
                case ItemDivEnums.RetentionPicker:
                    MainToolBar.Visible = false;
                    break;
                default:
                    MainToolBar.Visible = true;
                    break;
            }

        }

        private DataSet SaveActivities()
        {
            DataSet ds = new BrixDataSet();
            DataTable Activities = ds.Tables.Add(&quot;Activities&quot;);
            DataTable Items = ds.Tables.Add(&quot;Items&quot;);
            int i;
            DataRow Activity;
            DataRow ActiItem;
            string ItemXML = string.Empty;

            Activities.Columns.Add(&quot;ActivityID&quot;, Type.GetType(&quot;System.Int32&quot;));
            Activities.Columns.Add(&quot;ActivityName&quot;);
            Activities.Columns.Add(&quot;Description&quot;);
            Activities.Columns.Add(&quot;ContractUnitCost&quot;, Type.GetType(&quot;System.Double&quot;));
            Activities.Columns.Add(&quot;UnitCost&quot;, Type.GetType(&quot;System.Double&quot;));
            Activities.Columns.Add(&quot;Unit&quot;);
            Activities.Columns.Add(&quot;UnitID&quot;, Type.GetType(&quot;System.Int32&quot;));
            Activities.Columns.Add(&quot;Number&quot;, Type.GetType(&quot;System.Double&quot;));
            Activities.Columns.Add(&quot;Length&quot;, Type.GetType(&quot;System.Double&quot;));
            Activities.Columns.Add(&quot;Width&quot;, Type.GetType(&quot;System.Double&quot;));
            Activities.Columns.Add(&quot;Height&quot;, Type.GetType(&quot;System.Double&quot;));
            Activities.Columns.Add(&quot;Quantity&quot;, Type.GetType(&quot;System.Double&quot;));
            Activities.Columns.Add(&quot;ActID&quot;, Type.GetType(&quot;System.Int32&quot;));
            Activities.Columns.Add(&quot;TempID&quot;, Type.GetType(&quot;System.Int32&quot;));
            Activities.Columns.Add(&quot;IsShortClose&quot;, Type.GetType(&quot;System.Boolean&quot;));
            Activities.Columns.Add(&quot;CertifiedQuantity&quot;, Type.GetType(&quot;System.Double&quot;));
            Activities.Columns.Add(&quot;BilledQuantity&quot;, Type.GetType(&quot;System.Double&quot;));

            Items.Columns.Add(&quot;ActivityID&quot;, Type.GetType(&quot;System.Int32&quot;));
            Items.Columns.Add(&quot;ItemID&quot;, Type.GetType(&quot;System.Int32&quot;));
            Items.Columns.Add(&quot;Quantity&quot;, Type.GetType(&quot;System.Double&quot;));
            Items.Columns.Add(&quot;UnitPrice&quot;, Type.GetType(&quot;System.Double&quot;));
            Items.Columns.Add(&quot;ContractUnitPrice&quot;, Type.GetType(&quot;System.Double&quot;));
            Items.Columns.Add(&quot;SubItemID&quot;, Type.GetType(&quot;System.Int32&quot;));
            Items.Columns.Add(&quot;SubItem&quot;);
            Items.Columns.Add(&quot;TempID&quot;, Type.GetType(&quot;System.Int32&quot;));

            int TempID = 1;
            bool isShortClose;
            bool isEditVersion = ((isVersion) &amp;&amp; (hdnStage.Value.ToInt32_2() == 6)) ? true : false;
            for (i = 0; i &lt; uwgActivities.Rows.Count; i++)
            {
                CellsCollection cells = uwgActivities.Rows[i].Cells;

                Activity = Activities.NewRow();
                Activity[&quot;ActivityID&quot;] = cells.FromKey(&quot;ActivityID&quot;).Text.ToInt32_2();
                Activity[&quot;ActivityName&quot;] = cells.FromKey(&quot;ActivityName&quot;).Text;
                Activity[&quot;Description&quot;] = cells.FromKey(&quot;Activity Description&quot;).Text;
                Activity[&quot;Unit&quot;] = cells.FromKey(&quot;Unit&quot;).Text;
                Activity[&quot;UnitID&quot;] = cells.FromKey(&quot;UnitID&quot;).Text.ToInt32_2();
                Activity[&quot;ContractUnitCost&quot;] = cells.FromKey(&quot;ContractUnitCost&quot;).Text.ToDouble2();
                if (isVersion)
                    Activity[&quot;UnitCost&quot;] = cells.FromKey(&quot;UnitCost&quot;).Text.ToDouble2();

                if (isEditVersion)
                {
                    if (((cells.FromKey(&quot;PreVerActID&quot;).Value.ToInt32_2() == 0) ||
                         (cells.FromKey(&quot;PreVerActID&quot;).Value == null)))
                        Activity[&quot;ContractUnitCost&quot;] = Activity[&quot;UnitCost&quot;] = cells.FromKey(&quot;UnitCost&quot;).Text.ToDouble2();
                }
                else if (isVersion &amp;&amp; (cells.FromKey(&quot;PreVerActID&quot;).Value == null))
                    Activity[&quot;ContractUnitCost&quot;] = Activity[&quot;UnitCost&quot;] = cells.FromKey(&quot;UnitCost&quot;).Text.ToDouble2();


                Activity[&quot;ActID&quot;] = cells.FromKey(&quot;ActID&quot;).Text.ToInt32_2();
                if (Activity[&quot;ActID&quot;].ToInt32_2() == 0)
                {
                    if (!string.IsNullOrEmpty(cells.FromKey(&quot;Number&quot;).Text))
                        Activity[&quot;Number&quot;] = cells.FromKey(&quot;Number&quot;).Text.ToDouble2();
                    if (!string.IsNullOrEmpty(cells.FromKey(&quot;Length&quot;).Text))
                        Activity[&quot;Length&quot;] = cells.FromKey(&quot;Length&quot;).Text.ToDouble2();
                    if (!string.IsNullOrEmpty(cells.FromKey(&quot;Width&quot;).Text))
                        Activity[&quot;Width&quot;] = cells.FromKey(&quot;Width&quot;).Text.ToDouble2();
                    if (!string.IsNullOrEmpty(cells.FromKey(&quot;Height&quot;).Text))
                        Activity[&quot;Height&quot;] = cells.FromKey(&quot;Height&quot;).Text.ToDouble2();
                    Activity[&quot;Quantity&quot;] = cells.FromKey(&quot;WOQuantity&quot;).Text.ToDouble2();
                }
                Activity[&quot;TempID&quot;] = TempID;
                isShortClose = false;
                Activity[&quot;IsShortClose&quot;] = cells.Exists(&quot;IsShortClose&quot;) &amp;&amp;
                                           bool.TryParse(cells.FromKey(&quot;IsShortClose&quot;).Text, out isShortClose)
                                               ? isShortClose
                                               : false;
                if (cells.Exists(&quot;CertifiedQuantity&quot;))
                    Activity[&quot;CertifiedQuantity&quot;] = String.IsNullOrEmpty(cells.FromKey(&quot;CertifiedQuantity&quot;).Text)
                                                        ? DBNull.Value
                                                        : cells.FromKey(&quot;CertifiedQuantity&quot;).Value;
                if (cells.Exists(&quot;BilledQuantity&quot;))
                    Activity[&quot;BilledQuantity&quot;] = String.IsNullOrEmpty(cells.FromKey(&quot;BilledQuantity&quot;).Text)
                                                     ? DBNull.Value
                                                     : cells.FromKey(&quot;BilledQuantity&quot;).Value;
                Activities.Rows.Add(Activity);
                TempID++;

                if (cells.FromKey(&quot;ItemID&quot;).Text.ToInt32_2() &gt; 0)
                {
                    ActiItem = Items.NewRow();
                    ActiItem[&quot;ActivityID&quot;] = cells.FromKey(&quot;ActivityID&quot;).Text.ToInt32_2();
                    ActiItem[&quot;TempID&quot;] = TempID - 1;

                    ActiItem[&quot;ItemID&quot;] = cells.FromKey(&quot;ItemID&quot;).Text.ToInt32_2();
                    ActiItem[&quot;SubItem&quot;] = cells.FromKey(&quot;SubItem&quot;).Text;
                    ActiItem[&quot;SubItemID&quot;] = cells.FromKey(&quot;SubItemID&quot;).Text.ToInt32_2();
                    if (isVersion)
                    {
                        if (cells.FromKey(&quot;WOQuantity&quot;).Text == &quot;0&quot; &amp;&amp; !AllowZeroQuantity)
                            throw new Exception(&quot;Work order Quantity cannot be zero.&quot;);
                        //if (cells.FromKey(&quot;CompletedQuantity&quot;).Text != &quot;&quot; &amp;&amp; Convert.ToDecimal(cells.FromKey(&quot;WOQuantity&quot;).Text) &lt; Convert.ToDecimal(cells.FromKey(&quot;ItemCompletedQuantity&quot;).Text))
                        //    throw new Exception(&quot;Work order Quantity cannot be less than posted Quantity.&quot;);
                        //else if (cells.FromKey(&quot;ItemCompletedQuantity&quot;).Text != &quot;&quot; &amp;&amp; Convert.ToDecimal(cells.FromKey(&quot;WOQuantity&quot;).Text) &lt; Convert.ToDecimal(cells.FromKey(&quot;CompletedQuantity&quot;).Text))
                        //    throw new Exception(&quot;Work order Quantity cannot be less than posted Quantity.&quot;);
                    }

                    decimal availQty = 0, woQty = 0;
                    if (cells.Exists(&quot;AvailQty&quot;))
                        availQty =
                            cells.FromKey(&quot;AvailQty&quot;).Text.ToDecimal2().ToString(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY).ToDecimal2();
                    woQty =
                        cells.FromKey(&quot;WOQuantity&quot;).Text.ToDecimal2().ToString(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY).ToDecimal2();
                    if (cells.Exists(&quot;AvailQty&quot;) &amp;&amp; woQty &gt; availQty &amp;&amp; hdnValidateWOQty.Value == &quot;1&quot;)
                    {
                        throw new Exception(&quot;Work order Quantity cannot be more than the available Quantity.&quot;);
                    }
                    else
                        ActiItem[&quot;Quantity&quot;] = cells.FromKey(&quot;WOQuantity&quot;).Text.ToDouble2();
                    ActiItem[&quot;ContractUnitPrice&quot;] = cells.FromKey(&quot;ContractUnitCost&quot;).Text.ToDouble2();
                    if (isVersion)
                        Activity[&quot;UnitCost&quot;] = cells.FromKey(&quot;UnitCost&quot;).Text.ToDouble2();
                    Activity[&quot;Quantity&quot;] = (Activity[&quot;Quantity&quot;].Equals(DBNull.Value)
                                                ? 0
                                                : Activity[&quot;Quantity&quot;].ToDouble2()) + ActiItem[&quot;Quantity&quot;].ToDouble2();
                    Items.Rows.Add(ActiItem);
                }
            }
            return ds;
        }

        protected void btnSaveActi_Click(object sender, EventArgs e)
        {
            UltraGridRow row = null;
            if (string.IsNullOrEmpty(hdnActivityID.Value))
            {
                uwgActivities.Rows.Add();

                row = uwgActivities.Rows[uwgActivities.Rows.Count - 1];
                row.Cells.FromKey(&quot;ActivityID&quot;).Value = row.Cells.FromKey(&quot;ActID&quot;).Value = 0;
            }
            else
            {
                row = uwgActivities.DisplayLayout.ActiveRow;
            }
            row.Cells.FromKey(&quot;ActivityName&quot;).Value = row.Cells.FromKey(&quot;Activity Name&quot;).Value = txtActivityName.Text;
            row.Cells.FromKey(&quot;Activity Description&quot;).Value = txtDescription.Text;
            row.Cells.FromKey(&quot;Unit&quot;).Value = ddlActiUnit.SelectedItem.Text;
            row.Cells.FromKey(&quot;UnitID&quot;).Value = ddlActiUnit.SelectedItem.Value;
            if (!isVersion)
                row.Cells.FromKey(&quot;ContractUnitCost&quot;).Value = wneActiUnitCost.ValueDecimal;
            else
                row.Cells.FromKey(&quot;UnitCost&quot;).Value = wneActiUnitCost.ValueDecimal;

            row.Cells.FromKey(&quot;WOQuantity&quot;).Value = wneActiQuantity.ValueDecimal;
            row.Cells.FromKey(&quot;WOQuantity&quot;).AllowEditing = isVersion ? AllowEditing.Yes : AllowEditing.No;
            row.Cells.FromKey(&quot;WOQuantity&quot;).Style.BackColor = isVersion ? Color.Yellow : Color.White;
            row.Cells.FromKey(&quot;Amount&quot;).Value = wneActiQuantity.ValueDecimal * wneActiUnitCost.ValueDecimal;
            if (chkActiNumber.Checked)
                row.Cells.FromKey(&quot;Number&quot;).Value = wneNumber.ValueDecimal;
            if (chkActiLength.Checked)
                row.Cells.FromKey(&quot;Length&quot;).Value = wneActiLength.ValueDecimal;
            if (chkActiWidth.Checked)
                row.Cells.FromKey(&quot;Width&quot;).Value = wneActiWidth.ValueDecimal;
            if (chkActiHeight.Checked)
                row.Cells.FromKey(&quot;Height&quot;).Value = wneActiHeight.ValueDecimal;

            row.Cells.FromKey(&quot;Quantity&quot;).Value = DBNull.Value;
            row.Cells.FromKey(&quot;SubItem&quot;).Value = DBNull.Value;
            row.Cells.FromKey(&quot;SubItemID&quot;).Value = DBNull.Value;

            trActivitiesTemplete.Style.Add(&quot;display&quot;, &quot;none&quot;);
            EnableDisableActivitiesGrid(WOConstants.ENABLE);
            hdnVisibleTab.Value = WOConstants.TAB_ACTI;
        }

        protected void btnSave_Click(object sender, EventArgs e)
        {
            WorkflowEnabledSaveHandler();
        }

        protected void SaveWorkOrder(out string sErrors, out string sSavedInstanceToken, bool wfBtn)
        {
            sErrors = sSavedInstanceToken = string.Empty;
            if (ddlContractors.SelectedValue == &quot;No Data&quot;)
            {
                sErrors = &quot;Please select a contractor&quot;;
                sSavedInstanceToken = &quot;-1&quot;;
                return;
            }

            //Checking for unique work order number is removed.

            //Validate the presence of quotations here if stage is &gt; Approved

            //The Issued status cannot be changed as there are Item Postings associated with this Wo

            //decimal totAmt = 0.0M;
            try
            {
                var WODTO = new WorkOrderDTO();
                if (IsNewInstance)
                    WODTO.WorkOrderID = null;
                else
                    WODTO.WorkOrderID = Request.QueryString[WOConstants.QRY_WORKORDERID].ToInt32_2();

                DateTime startDate = ((DateTime)dtStartDate.Value).Date;
                if (startDate &lt; ((DateTime)dtWODate.Value).Date &amp;&amp; !isVersion)
                {
                    sErrors = lblErr.Text = &quot;Start Date should not be less than the Work Order Date.&quot;;
                    sSavedInstanceToken = &quot;-1&quot;;
                    hdnVisibleTab.Value = WOConstants.TAB_WO;
                    return;
                }
                if (WODTO.WorkOrderID != null &amp;&amp; !isVersion)
                {
                    if (WODTO.IssuedOn != null &amp;&amp; startDate &lt; WODTO.IssuedOn.Date)
                    {
                        sErrors = lblErr.Text = &quot;Start Date should not be less than the Issued Date.&quot;;
                        sSavedInstanceToken = &quot;-1&quot;;
                        hdnVisibleTab.Value = WOConstants.TAB_WO;
                        return;
                    }
                    else if (WODTO.ApprovedOn != null &amp;&amp; startDate &lt; WODTO.ApprovedOn.Date)
                    {
                        sErrors = lblErr.Text = &quot;Start Date should not be less than the Approved Date.&quot;;
                        sSavedInstanceToken = &quot;-1&quot;;
                        hdnVisibleTab.Value = WOConstants.TAB_WO;
                        return;
                    }
                    else if (WODTO.CreatedOn != null &amp;&amp; startDate &lt; WODTO.CreatedOn.Date)
                    {
                        sErrors = lblErr.Text = &quot;Start Date should not be less than the Created Date.&quot;;
                        sSavedInstanceToken = &quot;-1&quot;;
                        hdnVisibleTab.Value = WOConstants.TAB_WO;
                        return;
                    }
                }
                if (wfBtn)
                {
                    if (uwgActivities.Rows.Count == 0)
                    {
                        sErrors = &quot;Work order has no Activities. Request Denied.&quot;;
                        sSavedInstanceToken = &quot;-1&quot;;
                        //Page.ClientScript.RegisterStartupScript(this.GetType(), &quot;alerT&quot;, &quot;alert(&#39;&quot; + alertMsg + &quot;&#39;);&quot;, true);
                        return;
                    }
                }
                if (!isVersion)
                {
                    foreach (UltraGridRow ugr in uwgQuotations.Rows)
                    {
                        if (((DateTime)dtWODate.Value).Date &gt; ((DateTime)ugr.Cells.FromKey(&quot;Date&quot;).Value).Date)
                        {
                            sErrors = lblErr.Text = &quot;Work Order Date is greater than one or more of the Quotation Date.&quot;;
                            sSavedInstanceToken = &quot;-1&quot;;
                            hdnVisibleTab.Value = WOConstants.TAB_WO;
                            return;
                        }
                        if (startDate &lt; ((DateTime)ugr.Cells.FromKey(&quot;Date&quot;).Value).Date)
                        {
                            sErrors = lblErr.Text = &quot;One or more of the Quotation Date is greater than the Start Date.&quot;;
                            sSavedInstanceToken = &quot;-1&quot;;
                            hdnVisibleTab.Value = WOConstants.TAB_WO;
                            return;
                        }
                    }
                }

                WODTO.ContractID = _ContractID;

                WODTO.WorkOrderNo = txtWONo.Text.Trim();
                WODTO.ExtReference = txtExtReference.Text.Trim();
                WODTO.WorkOrderRequestedBy = txtWOReqBy.Text;
                WODTO.WorkOrderDate = (DateTime)dtWODate.Value;
                WODTO.CreatedOn = wdcCreatedOn.Value.ToDateTime_MWCulture();
                WODTO.Description = txtDesc.Text;
                WODTO.Notes = txtNotes.Text;
                WODTO.ScopeOfWork = txtScope.Text;
                WODTO.WithMaterial = chkWithMaterial.Checked;
                WODTO.WithEquipment = chkWithEquipment.Checked;
                WODTO.WithLabour = chkWithLabour.Checked;
                WODTO.StartDate = (DateTime)dtStartDate.Value;
                WODTO.EndDate = (DateTime)dtEndDate.Value;
                if (isVersion)
                    WODTO.Status = WOConstants.STAGE_DRAFT_AMENDMENT;
                else if (!IsNewInstance)
                    WODTO.Status = hdnStage.Value.ToInt32_2();
                else
                    WODTO.Status = WOConstants.STAGE_DRAFT;
                WODTO.ModifiedBy = UserDetail.GetCurrentUserDetail().UserName;
                WODTO.ModifiedByID = UserDetail.GetCurrentUserDetail().UID;
                if (isOldWONo)
                    WODTO.IsNew = null;
                else
                {
                    string[] strArr = txtWONo.Text.Split(&#39;/&#39;);
                    WODTO.IsNew = (txtWONo.Text.Contains(&quot;/&quot;))
                                      ? strArr[strArr.Length - 1].ToInt32_2()
                                      : txtWONo.Text.ToInt32_2();
                }

                WODTO.ModifiedOn = wdcCreatedOn.Value.ToDateTime_MWCulture();
                //save activities here..


                WODTO.IsVersion = isVersion;
                WODTO.WorkOrderItems = SaveActivities();

                WODTO.VersionNo = string.Empty;
                WODTO.TaxPayerID = txtTaxPayerID.Text;
                WODTO.LicenseCity = txtLicenseCity.Text;
                WODTO.LicenseState = txtLicenseState.Text;
                WODTO.Insurance = txtInsurance.Text;
                DelItems.Clear();
                _DelItems = DelItems;

                #region Storing Prepayment,recovery and retention information

                int rowCount = uwgPrepaymentTypes.Rows.Count;
                int incrmentor = 0;
                int InstanceID = _WorkOrderID;
                var dtoRecoveryItems = new PrepaymentRecoveryRulesItems[rowCount];


                if (rowCount &gt; 0)
                {
                    DataRow[] dr = dtPrepayment.Select(&quot;RecoveryId=&quot; + hdnRecoveryID.Value);
                    foreach (UltraGridRow row in uwgPrepaymentTypes.DisplayLayout.Rows)
                    {
                        dtoRecoveryItems[incrmentor] = new PrepaymentRecoveryRulesItems();
                        int TypeId =
                            Int32.Parse(dr != null &amp;&amp; dr.Length &gt; 0 &amp;&amp; dr[incrmentor][&quot;PrepaymentTypeID&quot;] != null
                                            ? dr[incrmentor][&quot;PrepaymentTypeID&quot;].ToString2()
                                            : row.Cells.FromKey(&quot;PrepaymentTypeID&quot;).ToString2());
                        dtoRecoveryItems[incrmentor].PrepaymentTypeID = TypeId;
                        dtoRecoveryItems[incrmentor].RecoveryID = int.Parse(IsNewInstance ? &quot;0&quot; : hdnRecoveryID.Value);

                        dtoRecoveryItems[incrmentor].PrepaymentValue =
                            decimal.Parse(row.Cells.FromKey(&quot;PrepaymentValue&quot;).ToString2());
                        dtoRecoveryItems[incrmentor].RABillNumber =
                            int.Parse(row.Cells.FromKey(&quot;RABillNumber&quot;).ToString2());
                        dtoRecoveryItems[incrmentor].RecoveryValue =
                            decimal.Parse(row.Cells.FromKey(&quot;RecoveryValue&quot;).ToString2());

                        incrmentor++;
                    }


                    WODTO.xmlPrepaymentItemList =
                        PrepaymentRecoveryrulesBL.Instance.SerializeDTO(dtoRecoveryItems).Replace(&quot;encoding=\&quot;utf-8\&quot;&quot;,
                                                                                                  String.Empty);
                    var dtoGeneral = new PrepaymentRecovery();
                    if (dtRecovery.Rows.Count != 0)
                    {
                        dtoGeneral.RecoveryID = int.Parse(IsNewInstance ? &quot;0&quot; : hdnRecoveryID.Value);
                        if (dtRecovery.Rows.Count != 0)
                        {
                            DataRow[] rowRecovery =
                                dtRecovery.Select(&quot;RecoveryRuleName=&#39;&quot; + txtPrepaymentRule.Text.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) + &quot;&#39;&quot;);
                            dtoGeneral.RecoveryRuleName = rowRecovery[0][&quot;RecoveryRuleName&quot;].ToString2();
                            dtoGeneral.Description = rowRecovery[0][&quot;Description&quot;].ToString2();
                            dtoGeneral.Value = ((rowRecovery[0][&quot;Prepaymentmode&quot;].ToString2() == &quot;True&quot; ||
                                                 rowRecovery[0][&quot;Prepaymentmode&quot;].ToString2() == &quot;1&quot;)
                                                    ? wneMaxPercentage.ValueDecimal
                                                    : wneMaxAmount.ValueDecimal);
                            dtoGeneral.Prepaymentmode = ((rowRecovery[0][&quot;Prepaymentmode&quot;].ToString2() == &quot;True&quot; ||
                                                          rowRecovery[0][&quot;Prepaymentmode&quot;].ToString2() == &quot;1&quot;)
                                                             ? true
                                                             : false);

                            WODTO.xmlGeneralDetails =
                                PrepaymentRecoveryrulesBL.Instance.SerializeDTO(dtoGeneral).Replace(
                                    &quot;encoding=\&quot;utf-8\&quot;&quot;, String.Empty);
                        }
                    }
                }

                var dtoRetention = new RetentionRuleItems();

                if (dtRetention.Rows.Count != 0)
                {
                    DataRow[] drRetention = dtRetention.Select(&quot;RetentionRuleName=&#39;&quot; + txtRetentionRule.Text.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) + &quot;&#39;&quot;);
                    if (drRetention.Length != 0)
                    {
                        dtoRetention.RetentionID = IsNewInstance
                                                       ? 0
                                                       : Convert.ToInt32(IsNewInstance ? &quot;0&quot; : hdnRetentionID.Value);
                        dtoRetention.RetentionRuleName = drRetention[0][&quot;RetentionRuleName&quot;].ToString2();
                        dtoRetention.Description = drRetention[0][&quot;Description&quot;].ToString2();
                        dtoRetention.RetentionCeilingValue = wneRetentionCeiling.ValueDecimal;
                        dtoRetention.RetentionCeilingMode = ((drRetention[0][&quot;RetentionCeilingMode&quot;].ToString2().ToLower2() ==
                                                              &quot;true&quot; ||
                                                              drRetention[0][&quot;RetentionCeilingMode&quot;].ToString2() == &quot;1&quot;)
                                                                 ? true
                                                                 : false);
                        dtoRetention.RetentionPercentage = wneRetentionPercentage.ValueDecimal;

                        WODTO.xmlRetentionItemList =
                            RetentionRuleBL.Instance.SerializeDTO(dtoRetention).Replace(&quot;encoding=\&quot;utf-8\&quot;&quot;,
                                                                                        String.Empty);
                    }
                }
                WODTO.Mode = (IsNewInstance ? &quot;N&quot; : &quot;E&quot;);

                #endregion

                if ((_WorkOrderID = WOManager.Instance.CUWorkOrder(WODTO)) &gt; 0)
                {
                    //save attachments here
                    if (
                        !SaveAttachments(_WorkOrderID, UserDetail.GetCurrentUserDetail(),
                                         (isVersion &amp;&amp; _WorkOrderID != WODTO.WorkOrderID)))
                    {
                        ClientScript.RegisterClientScriptBlock(GetType(), &quot;Error_in_Attachments&quot;,
                                                               &quot;&lt;script&gt;alert(&quot; +
                                                               ResourceFactory.Instance.GetString(
                                                                   &quot;Error in uploading attachments. Work Order created successfully.&quot;) +
                                                               &quot;); &lt;/script&gt;&quot;);
                    }

                    sSavedInstanceToken = hdnWorkOrderID.Value = _WorkOrderID.ToString2();

                    #region

                    //if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX) &amp;&amp; isVersion == true)
                    //{

                    //    string mappedCompany = String.Empty;
                    //    string selWorkOrderID = _WorkOrderID.ToString();
                    //    WorkOrderDTO WODTOObject = Aurigo.AMP3.WORKORDBL.WOManager.Instance.GetWorkOrderDetails(Convert.ToInt32(_WorkOrderID));
                    //    //Check for Brix-ERP Subproject mapping if the ERP supports Contract Mapping
                    //    DataTable dtMap = IntegrationConnectorManager.Instance.GetERPObjectMapInfo(WODTO.ContractID.ToString(), AMP3Object.CONTMGT, null, AMP3Object.UNKNOWN, RegisteredEIS.AX);
                    //    if (dtMap == null || dtMap.Rows.Count &lt;= 0)
                    //    {
                    //        Page.ClientScript.RegisterClientScriptBlock(GetType(), &quot;Error&quot;,
                    //                                                &quot;&lt;script&gt;alert(&lt;%= Aurigo.AMP3.Resources.TerminologyResources.ResourceFactory.Instance.GetString(&#39;Contract is not mapped to AX Sub project . So Purchase Order is not pushed to AX.&#39;) %&gt;); &lt;/script&gt;&quot;);
                    //    }
                    //    else
                    //        mappedCompany = dtMap.Rows[0][&quot;ERPCompany&quot;].ToString();


                    //    EISAdditionalInfo objAdditionalInfo = new EISAdditionalInfo(RegisteredEIS.AX);
                    //    objAdditionalInfo.AddInfo(Constants.EIS_ADDITIONAL_INFO, mappedCompany);
                    //    Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt; dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
                    //    dictAdditionalInfo.Add(RegisteredEIS.AX, objAdditionalInfo);
                    //    List&lt;ConnectionBrixInfo&gt; ConBrixInfo = new List&lt;ConnectionBrixInfo&gt;();
                    //    ConBrixInfo.Add(new ConnectionBrixInfo(AMP3Object.CONTMGT, WODTO.ContractID.ToString(), AMP3Object.UNKNOWN, &quot;0&quot;));
                    //    ConnectorParameters connectorParameter = new ConnectorParameters(dictAdditionalInfo, MethodInfo.GetCurrentMethod(), AMP3ObjectType.Unknown, null, ConBrixInfo);

                    //    string purchId = &quot;&quot;;
                    //    DataTable dtPurchInfo = IntegrationConnectorManager.Instance.GetERPObjectMapInfo(WODTO.WorkOrderID.ToString(), AMP3Object.WORKORD, WODTO.ContractID.ToString(), AMP3Object.CONTMGT, RegisteredEIS.AX);
                    //    if (dtPurchInfo.Rows.Count &gt; 0)
                    //        purchId = dtPurchInfo.Rows[0][&quot;ERPId&quot;].ToString();
                    //    DataSet dsPO = new DataSet();
                    //    DataTable dt = new DataTable();

                    //    dt.Columns.Add(&quot;PurchId&quot;, typeof(System.String));
                    //    dt.Columns.Add(&quot;Qty&quot;, typeof(System.String));
                    //    dt.Columns.Add(&quot;WorkOrderId&quot;, typeof(System.String));
                    //    dt.Columns.Add(&quot;ContractId&quot;, typeof(System.String));
                    //    dt.Columns.Add(&quot;OrderAccount&quot;, typeof(System.String));
                    //    DataRow dr = dt.NewRow();
                    //    dr[&quot;PurchId&quot;] = purchId;
                    //    dr[&quot;Qty&quot;] = WODTOObject.TotalAmount;
                    //    dr[&quot;WorkOrderId&quot;] = _WorkOrderID.ToString2();
                    //    dr[&quot;ContractId&quot;] = WODTO.ContractID.ToString();
                    //    dr[&quot;OrderAccount&quot;] = WODTOObject.ContractorID.ToString();

                    //    dt.Rows.Add(dr);
                    //    dsPO.Tables.Add(dt);
                    //    int count = 0;
                    //    Dictionary&lt;string, object&gt; dict = new Dictionary&lt;string, object&gt;();
                    //    dict.Add(&quot;ObjectId&quot;, purchId);
                    //    dict.Add(&quot;AXCompany&quot;, mappedCompany);
                    //    dict.Add(&quot;ObjectType&quot;, EISObjectType.WOVersion);

                    //    IntegrationConnectorManager.Instance.AddERPMapInfo(_WorkOrderID.ToString2(), AMP3Object.WORKORD, WODTO.ContractID.ToString(), AMP3Object.CONTMGT, dict, RegisteredEIS.AX);

                    //    if (IntegrationConnectorManager.HandleIntegration(connectorParameter, ref count, ref dsPO, false))
                    //    {

                    //    }
                    //}

                    #endregion

                    //Response.Redirect(BrixDatatypeHelper.Format2(&quot;~/Common/BrixListPage.aspx?Context=WORKORD&amp;PID={0}&amp;ContractID={1}&quot;, Request[WOConstants.QRY_PROJECTID], Request[WOConstants.QRY_CONTRACTID]), false);
                }
            }
            catch (Exception ex)
            {
                base.ShowError(ex.Message);
            }
        }

        private bool ValidateWOQuantityOnIssue(decimal WOQty, int ItemID)
        {
            return !(WOQty &gt; GetAvailableQuantity(ItemID, _WorkOrderID));
        }

        protected void Cncl_Click(object sender, EventArgs e)
        {
            //Response.Redirect(BrixDatatypeHelper.Format2(&quot;~/Common/BrixListPage.aspx?context=ACTI-WO&amp;PID={0}&amp;ContractID={1}&quot;, Request[WOConstants.QRY_PROJECTID], Request[WOConstants.QRY_CONTRACTID]), false);
            Response.Redirect(
                &quot;~/Common/BrixListPage.aspx?Context=WORKORD&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&quot;.Format2(
                    Request[WOConstants.QRY_PROJECTID], Request[WOConstants.QRY_CONTRACTID]), false);
        }

        protected void btnSaveQuot_Click(object sender, EventArgs e)
        {
            if (ddlContractors.SelectedValue == &quot;No Data&quot;)
            {
                string alertMsg = &quot;Please select a contractor&quot;;
                Page.ClientScript.RegisterStartupScript(GetType(), &quot;alerT&quot;, &quot;alert(&#39;&quot; + alertMsg + &quot;&#39;);&quot;, true);
                return;
            }

            WorkOrderDTO WODTO = WOManager.Instance.GetWorkOrderDetails(_WorkOrderID);
            DateTime quotationDate = ((DateTime)wbcDate.Value).Date;
            if (WODTO.StartDate.Date &lt; quotationDate)
            {
                SetErrorMessage(&quot;Start Date cannot be less than the Quotation Date&quot;);
                hdnVisibleTab.Value = WOConstants.TAB_QUOT;
                trQuotTemplate.Style.Add(&quot;display&quot;, &quot;table-row&quot;);
                return;
            }
            if (quotationDate &lt; WODTO.WorkOrderDate.Date)
            {
                SetErrorMessage(&quot;Quotation Date cannot be less than the Work Order Date&quot;);
                hdnVisibleTab.Value = WOConstants.TAB_QUOT;
                trQuotTemplate.Style.Add(&quot;display&quot;, &quot;table-row&quot;);
                return;
            }
            if (quotationDate &lt; WODTO.ApprovedOn.Date)
            {
                SetErrorMessage(&quot;Quotation Date cannot be less than the Approval Date&quot;);
                hdnVisibleTab.Value = WOConstants.TAB_QUOT;
                trQuotTemplate.Style.Add(&quot;display&quot;, &quot;table-row&quot;);
                return;
            }
            decimal total = 0.0M;
            int ContractorID = 0;
            int qid = 0;
            string Contractor = ddlContractors.Items[ddlContractors.SelectedIndex].Value;
            string ContractorName = ddlContractors.Items[ddlContractors.SelectedIndex].Text;
            DataSet ds = new BrixDataSet();
            DataTable Items = ds.Tables.Add(&quot;Item&quot;);
            int i;
            DataRow Item;
            string ItemXML = string.Empty;

            if (!string.IsNullOrEmpty(Contractor))
            {
                string[] strContr = Contractor.Split(&#39;,&#39;);

                ContractorID = strContr[0].ToInt32_2();
            }

            Items.Columns.Add(&quot;ActivityID&quot;, Type.GetType(&quot;System.Int32&quot;));
            Items.Columns.Add(&quot;UnitCost&quot;, Type.GetType(&quot;System.Double&quot;));

            for (i = 0; i &lt; uwgQuotItems.Rows.Count; i++)
            {
                Item = Items.NewRow();

                Item[&quot;ActivityID&quot;] = uwgQuotItems.Rows[i].Cells.FromKey(&quot;ActivityID&quot;).Text.ToInt32_2();
                Item[&quot;UnitCost&quot;] = uwgQuotItems.Rows[i].Cells.FromKey(&quot;Rate&quot;).Text.ToDouble2();
                total += Item[&quot;UnitCost&quot;].ToString2().ToDecimal2() *
                         uwgQuotItems.Rows[i].Cells.FromKey(&quot;Quantity&quot;).Text.ToDecimal2();
                Items.Rows.Add(Item);
            }

            ItemXML = ds.GetXml();
            WOManager.Instance.CreateWorkOrderQuotations(
                ((!String.IsNullOrEmpty(hdnQuotationID.Value)) ? hdnQuotationID.Value.ToInt32_2() : 0), _WorkOrderID,
                ContractorID, ContractorName, wbcDate.Value.ToDateTime_MWCulture(), txtQNotes.Text, total,
                WOConstants.QUOTATION_STAGE_RECIEVED, ItemXML, qid);
            BindQuotationData();
            BindActivitiesData(null);
            trQuotTemplate.Style.Add(&quot;display&quot;, &quot;none&quot;);
            hdnVisibleTab.Value = WOConstants.TAB_QUOT;
        }

        protected void uwgQuotations_InitializeRow(object sender, RowEventArgs e)
        {
            int status = e.Row.Cells.FromKey(&quot;Status&quot;).Value.ToInt32_2();
            e.Row.Cells.FromKey(&quot;Status&quot;).Style.BackgroundImage = (status == WOConstants.QUOTATION_STAGE_REJECTED)
                                                                      ? &quot;../../Images/toolbar/IcnUnapprove.gif&quot;
                                                                      : (status == WOConstants.QUOTATION_STAGE_AWARDED)
                                                                            ? &quot;../../Images/toolbar/IcnAward.gif&quot;
                                                                            : null;

            e.Row.Cells.FromKey(&quot;Status&quot;).Style.Padding.Left = new Unit(&quot;16px&quot;, CultureInfo.CurrentCulture);
            e.Row.Cells.FromKey(&quot;Status&quot;).Style.CustomRules = &quot;background-repeat: no-repeat&quot;;
            e.Row.Cells.FromKey(&quot;Status&quot;).Value = (status == WOConstants.QUOTATION_STAGE_REJECTED)
                                                      ? &quot;Rejected&quot;
                                                      : (status == WOConstants.QUOTATION_STAGE_AWARDED)
                                                            ? &quot;Awarded&quot;
                                                            : &quot;Received&quot;;
            e.Row.Cells.FromKey(&quot;Notes&quot;).Title = e.Row.Cells.FromKey(&quot;Notes&quot;).Text;
        }

        protected void btnCancelQuot_Click(object sender, EventArgs e)
        {
            ddlContractors.ClearSelection();
            wbcDate.Value = MWDateTimeHelper.MWToday;
            hdnVisibleTab.Value = WOConstants.TAB_QUOT;
        }

        protected void btnCancelActi_Click(object sender, EventArgs e)
        {
            EnableDisableActivitiesGrid(WOConstants.ENABLE);
            hdnVisibleTab.Value = WOConstants.TAB_ACTI;
        }

        private void BindActivitiesData(WorkOrderDTO WODTO)
        {
            DataTable dsActivities = WOManager.Instance.GetActivities(_WorkOrderID).Tables[0];

            uwgActivities.DisplayLayout.NoDataMessage = &quot;No items to display&quot;;

            uwgActivities.Height = Unit.Pixel(100);
            uwgActivities.DataSource = dsActivities;
            uwgActivities.DataBind();
            SetActivityGridColumns(WODTO);
            decimal totalAmt = 0;
            for (int i = 0; i &lt; uwgActivities.Rows.Count; i++)
            {
                CellsCollection cells = uwgActivities.Rows[i].Cells;
                if (cells.FromKey(&quot;ActID&quot;).Text.ToInt32_2() == 0 &amp;&amp; cells.Exists(&quot;IsShortClose&quot;) &amp;&amp;
                    !cells.FromKey(&quot;IsShortClose&quot;).Value.ToBoolean2())
                {
                    cells.FromKey(&quot;WOQuantity&quot;).AllowEditing = AllowEditing.No;
                    cells.FromKey(&quot;WOQuantity&quot;).Style.BackColor = Color.White;
                    cells.FromKey(&quot;UnitCost&quot;).AllowEditing = AllowEditing.No;
                    cells.FromKey(&quot;UnitCost&quot;).Style.BackColor = Color.White;
                    if ((isVersion) &amp;&amp; (WODTO.Status == WOConstants.STAGE_DRAFT_AMENDMENT))
                    {
                        cells.FromKey(&quot;WOQuantity&quot;).AllowEditing = AllowEditing.Yes;
                        cells.FromKey(&quot;WOQuantity&quot;).Style.BackColor = Color.Yellow;
                        cells.FromKey(&quot;UnitCost&quot;).AllowEditing = (cells.Exists(&quot;CertifiedQuantity&quot;) &amp;&amp;
                                                                  cells.FromKey(&quot;CertifiedQuantity&quot;).Value.ToDecimal2() !=
                                                                  0)
                                                                     ? AllowEditing.No
                                                                     : AllowEditing.Yes;
                        cells.FromKey(&quot;UnitCost&quot;).Style.BackColor = (cells.Exists(&quot;CertifiedQuantity&quot;) &amp;&amp;
                                                                     cells.FromKey(&quot;CertifiedQuantity&quot;).Value.ToDecimal2
                                                                         () != 0)
                                                                        ? Color.White
                                                                        : Color.Yellow;
                        //cells.FromKey(&quot;ContractUnitCost&quot;).AllowEditing = (cells.Exists(&quot;CertifiedQuantity&quot;) &amp;&amp; cells.FromKey(&quot;CertifiedQuantity&quot;).Value.ToDecimal2() != 0) ? AllowEditing.Yes : AllowEditing.No;
                        //cells.FromKey(&quot;ContractUnitCost&quot;).Style.BackColor = (cells.Exists(&quot;CertifiedQuantity&quot;) &amp;&amp; cells.FromKey(&quot;CertifiedQuantity&quot;).Value.ToDecimal2() != 0) ? Color.Yellow : Color.White;
                    }
                    //cells.FromKey(&quot;UnitCost&quot;).Row.RowSelectorStyle.BackColor = Color.FromArgb(238, 234, 254);
                }
                else
                {
                    if (string.IsNullOrEmpty(hdnStage.Value) || hdnStage.Value.ToInt32_2() == WOConstants.STAGE_DRAFT)
                    {
                        bool allowEditing = WORKORDManager.Instance.ShouldAllowUnlimitedQuotRate(_ContractID, _ProjectID);
                        cells.FromKey(&quot;ContractUnitCost&quot;).AllowEditing =
                            ((cells.FromKey(&quot;AssociatedResourceID&quot;).Value != null) &amp;&amp; !allowEditing)
                                ? AllowEditing.No
                                : AllowEditing.Yes;
                        cells.FromKey(&quot;ContractUnitCost&quot;).Style.BackColor =
                            ((cells.FromKey(&quot;AssociatedResourceID&quot;).Value != null) &amp;&amp; !allowEditing)
                                ? Color.Transparent
                                : Color.Yellow;
                    }
                }
                totalAmt += cells.FromKey(&quot;Amount&quot;).Value.ToDecimal2();
            }
            hdnTotalAmt.Value = totalAmt.ToString2();
            lblWOAmount.Text = totalAmt.ToString(&quot;N&quot; + hdnAmountDigits.Value);
        }

        protected void btnExport_Click(object sender, EventArgs e)
        {
            uwgExcelExporter.WorksheetName = &quot;Activity Based Order Activities&quot;;
            uwgExcelExporter.DownloadName = txtWONo.Text + &quot;_Activities.XLS&quot;;
            var book = new Workbook();

            if (uwgActivities.Columns.Exists(&quot;AvailQty&quot;))
                uwgActivities.Columns.FromKey(&quot;AvailQty&quot;).Hidden = true;
            if (uwgActivities.Columns.Exists(&quot;Amount&quot;))
                uwgActivities.Columns.FromKey(&quot;Amount&quot;).Hidden = true;
            if (uwgActivities.Columns.Exists(&quot;ContractUnitCost&quot;))
                uwgActivities.Columns.FromKey(&quot;ContractUnitCost&quot;).Hidden = true;
            if (uwgActivities.Columns.Exists(&quot;LineNo&quot;))
                uwgActivities.Columns.FromKey(&quot;LineNo&quot;).Header.Caption = &quot;LineNo&quot;;
            if (uwgActivities.Columns.Exists(&quot;Activity Name&quot;))
                uwgActivities.Columns.FromKey(&quot;Activity Name&quot;).Header.Caption = &quot;ActivityName&quot;;

            if ((uwgActivities.Columns.FromKey(&quot;UnitCost&quot;) == null) ||
                (uwgActivities.Columns.FromKey(&quot;UnitCost&quot;).Hidden))
            {
                if (!uwgActivities.Columns.Exists(&quot;Rate&quot;))
                    uwgActivities.Columns.Add(new UltraGridColumn(&quot;Rate&quot;, &quot;Rate&quot;, ColumnType.NotSet, &quot;0.0000&quot;), true);
                uwgActivities.Columns.FromKey(&quot;Rate&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;
                uwgActivities.Columns.FromKey(&quot;Rate&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                uwgActivities.Columns.FromKey(&quot;Rate&quot;).CellStyle.BackColor = Color.Yellow;
            }
            if (uwgActivities.Columns.Exists(&quot;WOQuantity&quot;))
            {
                uwgActivities.Columns.FromKey(&quot;WOQuantity&quot;).CellStyle.BackColor = Color.White;
                uwgActivities.Columns.FromKey(&quot;WOQuantity&quot;).Header.Caption = &quot;Quantity&quot;;
            }

            uwgActivities.Columns[0].Hidden = true;

            book = uwgExcelExporter.Export(uwgActivities);
            string sheetName = &quot;Work Order &quot; + LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR) + &quot;s&quot;;
            uwgExcelExporter.Export(uwgActivities);

            if (uwgActivities.Columns.FromKey(&quot;Rate&quot;) != null)
            {
                uwgActivities.Columns.Remove(uwgActivities.Columns.FromKey(&quot;Rate&quot;));
            }

            if (uwgActivities.Columns.Exists(&quot;WOQuantity&quot;))
            {
                uwgActivities.Columns.FromKey(&quot;WOQuantity&quot;).Header.Caption = &quot;WO Quantity&quot;;
                uwgActivities.Columns.FromKey(&quot;WOQuantity&quot;).CellStyle.BackColor = Color.Yellow;
            }
            if (uwgActivities.Columns.Exists(&quot;StandardItemNo&quot;))
            {
                uwgActivities.Columns.FromKey(&quot;StandardItemNo&quot;).Header.Caption =
                    LocalizationManager.GetString(KeyConstants.LOC_PAY_ITEM_NO.ToString());
            }

            uwgActivities.Columns[0].Hidden = false;

            //Undo Changes
            if (uwgActivities.Columns.Exists(&quot;AvailQty&quot;))
                uwgActivities.Columns.FromKey(&quot;AvailQty&quot;).Hidden = false;
            if (uwgActivities.Columns.Exists(&quot;Amount&quot;))
                uwgActivities.Columns.FromKey(&quot;Amount&quot;).Hidden = false;
            if (uwgActivities.Columns.Exists(&quot;ContractUnitCost&quot;))
                uwgActivities.Columns.FromKey(&quot;ContractUnitCost&quot;).Hidden = false;
            if (uwgActivities.Columns.Exists(&quot;Activity Name&quot;))
                uwgActivities.Columns.FromKey(&quot;Activity Name&quot;).Header.Caption = &quot;Activity Name&quot;;

            if (uwgActivities.Columns.Exists(&quot;WOQuantity&quot;))
            {
                uwgActivities.Columns.FromKey(&quot;WOQuantity&quot;).CellStyle.BackColor = Color.Yellow;
                uwgActivities.Columns.FromKey(&quot;WOQuantity&quot;).Header.Caption = &quot;Quantity&quot;;
            }

            uwgActivities.Columns[0].Hidden = true;

        }

        private void BindQuotationData()
        {
            DataSet dsQuotations = WOManager.Instance.GetQuotations(_WorkOrderID);

            uwgQuotations.DisplayLayout.NoDataMessage = &quot;No items to display&quot;;

            uwgQuotations.Height = Unit.Pixel(100);
            uwgQuotations.DataSource = dsQuotations.Tables[0];
            uwgQuotations.DataBind();

            uwgQuotations.Columns.FromKey(&quot;QuotationID&quot;).Hidden = true;
            uwgQuotations.Columns.FromKey(&quot;ContractorID&quot;).Hidden = true;

            uwgQuotations.Columns.FromKey(&quot;Date&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_DATE;
            uwgQuotations.Columns.FromKey(&quot;TotalAmount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
            uwgQuotations.Columns.FromKey(&quot;TotalAmount&quot;).Header.Caption = &quot;Total&quot;;

            uwgQuotations.Columns.FromKey(&quot;% Over Low Bid&quot;).Format =
                uwgQuotations.Columns.FromKey(&quot;% Over Contract&quot;).Format = &quot;##0.00&quot;;
            uwgQuotations.Columns.FromKey(&quot;% Over Contract&quot;).Header.Caption = &quot;% Over Est.&quot;;

            //Load Items for the Quotations template
            uwgQuotItems.Columns.Clear();
            uwgQuotItems.DataSource = dsQuotations.Tables[1];
            uwgQuotItems.DataBind();
            SetQuotationItemsGridColumns();

            if (!(dsQuotations.Tables[0].Select(&quot;Status = 3&quot;).Length == 0))
            {
                //MainToolBar.DisableMenu(&quot;lnkNew&quot;);
                //MainToolBar.DisableMenu(&quot;lnkEdit&quot;);
                MainToolBar.DisableMenu(&quot;lnkAward&quot;);
                //MainToolBar.DisableMenu(&quot;lnkDelete&quot;);
                isAward = true;
                if (!string.IsNullOrEmpty(hdnStage.Value) &amp;&amp; hdnStage.Value.ToInt32_2() &gt;= WOConstants.STAGE_APPROVED)
                {
                    uwgActivities.Columns.FromKey(&quot;ContractUnitCost&quot;).Hidden = false;
                    uwgActivities.Columns.FromKey(&quot;ContractUnitCost&quot;).Header.Caption = &quot;Est. Unit Cost&quot;;
                    uwgActivities.Columns.FromKey(&quot;UnitCost&quot;).Hidden = false;
                }
                hdnIsAwarded.Value = &quot;1&quot;;
            }
            else
            {
                hdnIsAwarded.Value = &quot;0&quot;;
                MainToolBar.GetMenuReference(&quot;lnkNew&quot;).Enabled =
                    //MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).Enabled =
                    MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).Enabled =
                    MainToolBar.GetMenuReference(&quot;lnkAward&quot;).Enabled = true;
                isAward = false;
            }
            if (!HideContractorFilter)
            {
                ddlSegment.DataSource = LoadVendorInfoFromAX(&quot;Segment&quot;);
                ddlSegment.DataTextField = &quot;SegmentId&quot;;
                ddlSegment.DataValueField = &quot;SegmentId&quot;;
                ddlSegment.DataBind();
                var li = new ListItem(&quot;--Select One--&quot;, &quot;--Select One--&quot;);
                ddlSegment.Items.Insert(0, li);

                ddlCategory.DataSource = LoadVendorInfoFromAX(&quot;Category&quot;);
                ddlCategory.DataTextField = &quot;CategoryName&quot;;
                ddlCategory.DataValueField = &quot;CategoryName&quot;;
                ddlCategory.DataBind();
                var li1 = new ListItem(&quot;--Select One--&quot;, &quot;--Select One--&quot;);
                ddlCategory.Items.Insert(0, li1);

                ddlCertification.DataSource = LoadVendorInfoFromAX(&quot;Certification&quot;);
                ddlCertification.DataTextField = &quot;CertificationNo&quot;;
                ddlCertification.DataValueField = &quot;CertificationNo&quot;;
                ddlCertification.DataBind();
                var li2 = new ListItem(&quot;--Select One--&quot;, &quot;--Select One--&quot;);
                ddlCertification.Items.Insert(0, li2);
            }
        }

        protected void lnkReject_Click(object sender, EventArgs e)
        {
            string rej = hdnMulti.Value;
            hdnMulti.Value = &quot;&quot;;
            if (rej.LastIndexOf(&#39;,&#39;) &gt; 0)
                rej = rej.Substring(0, rej.LastIndexOf(&#39;,&#39;));
            if (rej == &quot;&quot;)
                return;

            WOManager.Instance.SetQuotationStatus(rej, WOConstants.QUOTATION_STAGE_REJECTED);
            BindQuotationData();
            BindActivitiesData(null);
            hdnVisibleTab.Value = WOConstants.TAB_QUOT;
        }

        protected void lnkRevert_Click(object sender, EventArgs e)
        {
            string rev = hdnMulti.Value;
            hdnMulti.Value = &quot;&quot;;
            if (rev.LastIndexOf(&#39;,&#39;) &gt; 0)
                rev = rev.Substring(0, rev.LastIndexOf(&#39;,&#39;));
            if (rev == &quot;&quot;)
                return;

            WOManager.Instance.SetQuotationStatus(rev, WOConstants.QUOTATION_STAGE_RECIEVED);
            BindActivitiesData(null);
            BindQuotationData();
            hdnVisibleTab.Value = WOConstants.TAB_QUOT;
        }

        private bool IsAwarded()
        {
            for (int i = 0; i &lt; uwgQuotations.Rows.Count; i++)
            {
                if (uwgQuotations.Rows[i].Cells.FromKey(&quot;Status&quot;).Value.ToString2() == &quot;Awarded&quot;)
                    return true;
            }
            return false;
        }

        protected void uwgActivities_InitializeRow(object sender, RowEventArgs e)
        {
            if (string.IsNullOrEmpty(hdnStage.Value) || hdnStage.Value.ToInt32_2() == WOConstants.STAGE_DRAFT)
            {
                if (e.Row.Cells.FromKey(&quot;ActID&quot;).Text.ToInt32_2() != 0)
                {
                    e.Row.Cells.FromKey(&quot;ContractUnitCost&quot;).AllowEditing = AllowEditing.Yes;
                    e.Row.Cells.FromKey(&quot;ContractUnitCost&quot;).Style.BackColor = Color.Yellow;
                }

                //bool allowEditing = WORKORDManager.Instance.ShouldAllowUnlimitedQuotRate(_ContractID, _ProjectID);
            }
            if (isVersion)
            {
                if (e.Row.Cells.Exists(&quot;IsShortClose&quot;) &amp;&amp; e.Row.Cells.FromKey(&quot;IsShortClose&quot;).Value.ToBoolean2())
                {
                    e.Row.Style.BackColor = Color.LightGray;
                    e.Row.Cells.FromKey(&quot;WOQuantity&quot;).AllowEditing = AllowEditing.No;
                    e.Row.Cells.FromKey(&quot;ContractUnitCost&quot;).AllowEditing = AllowEditing.No;
                    e.Row.Cells.FromKey(&quot;UnitCost&quot;).AllowEditing = AllowEditing.No;
                }
                else if (e.Row.Cells.Exists(&quot;CertifiedQuantity&quot;) &amp;&amp;
                         e.Row.Cells.FromKey(&quot;CertifiedQuantity&quot;).Value.ToDecimal2() != 0)
                {
                    e.Row.Cells.FromKey(&quot;ContractUnitCost&quot;).AllowEditing = AllowEditing.No;
                    e.Row.Cells.FromKey(&quot;ContractUnitCost&quot;).Style.BackColor = Color.Transparent;
                    e.Row.Cells.FromKey(&quot;UnitCost&quot;).AllowEditing = AllowEditing.No;
                    ;
                    e.Row.Cells.FromKey(&quot;UnitCost&quot;).Style.BackColor = Color.Transparent;
                }
                else if (!string.IsNullOrEmpty(hdnStage.Value) &amp;&amp; hdnStage.Value.ToInt32_2() == WOConstants.STAGE_APPROVE_AMENDMENT)
                {
                    e.Row.Cells.FromKey(&quot;WOQuantity&quot;).AllowEditing = AllowEditing.No;
                    e.Row.Cells.FromKey(&quot;UnitCost&quot;).AllowEditing = AllowEditing.No;
                }
                else
                {
                    e.Row.Cells.FromKey(&quot;Quantity&quot;).AllowEditing = AllowEditing.Yes;
                    e.Row.Cells.FromKey(&quot;Quantity&quot;).Style.BackColor = Color.Yellow;
                    e.Row.Cells.FromKey(&quot;UnitCost&quot;).AllowEditing = AllowEditing.Yes;
                    e.Row.Cells.FromKey(&quot;UnitCost&quot;).Style.BackColor = Color.Yellow;
                }
            }
            (new List&lt;string&gt;
                 {
                     &quot;ActivityName&quot;,
                     &quot;Activity Name&quot;,
                     &quot;Activity Description&quot;,
                     &quot;SubItem&quot;,
                     &quot;Unit&quot;,
                     &quot;LineNo&quot;,
                     &quot;StandardItemNo&quot;,
                     &quot;Description&quot;
                 }).ForEach(x =&gt;
                                {
                                    if (e.Row.Cells.Exists(x))
                                    {
                                        e.Row.Cells.FromKey(x).AllowEditing = AllowEditing.No;
                                    }
                                });
        }

        protected void uwgQuotItems_InitializeRow(object sender, RowEventArgs e)
        {
            if (e.Row.HasCells)
                e.Row.Cells.FromKey(&quot;UnitCost&quot;).Style.BackColor = Color.Yellow;
        }

        protected void lnkEdit_Click(object sender, EventArgs e)
        {
            DataSet ds;
            ListItem li = null;

            switch (hdnVisibleTab.Value)
            {
                case WOConstants.TAB_QUOT:
                    if (hdnQuotationID == null || string.IsNullOrEmpty(hdnQuotationID.Value))
                        return;

                    ds = WOManager.Instance.GetQuotation(hdnQuotationID.Value.ToInt32_2(), _WorkOrderID);
                    if ((li = ddlContractors.Items.FindByValue(ds.Tables[0].Rows[0][&quot;ContractorID&quot;].ToString2())) ==
                        null)
                    {
                        li = new ListItem(ds.Tables[0].Rows[0][&quot;ContractorID&quot;].ToString2(),
                                          ds.Tables[0].Rows[0][&quot;Contractor&quot;].ToString2());
                        ddlContractors.Items.Add(li);
                    }
                    ddlContractors.SelectedItem.Selected = false;
                    li.Selected = true;

                    wbcDate.Value = ds.Tables[0].Rows[0][&quot;Date&quot;];
                    txtQNotes.Text = ds.Tables[0].Rows[0][&quot;Notes&quot;].ToString2();
                    wneTotal.Value = ds.Tables[0].Rows[0][&quot;TotalAmount&quot;];
                    uwgQuotItems.Columns.Clear();
                    uwgQuotItems.DataSource = ds.Tables[1];
                    uwgQuotItems.DataBind();
                    SetQuotationItemsGridColumns();
                    Page.ClientScript.RegisterStartupScript(GetType(), &quot;ShowQuotationDetails&quot;,
                                                            &quot;setTimeout(&#39;ShowQuotationDetails()&#39;, 1000);&quot;, true);
                    break;
                case WOConstants.TAB_ACTI:
                    if (hdnActivityID == null || string.IsNullOrEmpty(hdnActivityID.Value))
                        return;

                    //ds = WOManager.Instance.GetActivity(BrixDatatypeHelper.ToInt32_2(hdnActivityID.Value), _WorkOrderID);

                    //DataRow dr = ds.Tables[0].Rows[0];
                    //txtActivityName.Text = dr[&quot;ActivityName&quot;].ToString2();
                    //wneActiUnitCost.Value = dr[&quot;ContractUnitCost&quot;].ToDecimal2();
                    //wneNumber.Enabled = chkActiNumber.Checked = (dr[&quot;Number&quot;] != DBNull.Value);
                    //wneNumber.Value = chkActiNumber.Checked ? dr[&quot;Number&quot;] : null;
                    //wneActiLength.Enabled = chkActiLength.Checked = (dr[&quot;Length&quot;] != DBNull.Value);
                    //wneActiLength.Value = chkActiLength.Checked ? dr[&quot;Length&quot;] : null;
                    //wneActiWidth.Enabled = chkActiWidth.Checked = (dr[&quot;Width&quot;] != DBNull.Value);
                    //wneActiWidth.Value = chkActiWidth.Checked ? dr[&quot;Width&quot;] : null;
                    //wneActiHeight.Enabled = chkActiHeight.Checked = (dr[&quot;Height&quot;] != DBNull.Value);
                    //wneActiHeight.Value = chkActiHeight.Checked ? dr[&quot;Height&quot;] : null;
                    //wneActiQuantity.Value = dr[&quot;Quantity&quot;];
                    //if (ddlActiUnit.Items.FindByText(dr[&quot;Unit&quot;].ToString2()) != null)
                    //{
                    //    ddlActiUnit.SelectedIndex = -1;
                    //    ddlActiUnit.Items.FindByText(dr[&quot;Unit&quot;].ToString2()).Selected = true;
                    //}
                    UltraGridRow row = uwgActivities.DisplayLayout.SelectedRows[0];
                    txtActivityName.Text = row.Cells.FromKey(&quot;ActivityName&quot;).Text;
                    txtDescription.Text = row.Cells.FromKey(&quot;Activity Description&quot;).Text;
                    wneActiUnitCost.Value = isVersion
                                                ? row.Cells.FromKey(&quot;UnitCost&quot;).Value.ToDecimal2()
                                                : row.Cells.FromKey(&quot;ContractUnitCost&quot;).Value.ToDecimal2();
                    wneNumber.Enabled = chkActiNumber.Checked = (row.Cells.FromKey(&quot;Number&quot;).Value != null);
                    wneNumber.Value = chkActiNumber.Checked ? row.Cells.FromKey(&quot;Number&quot;).Value : null;
                    wneActiLength.Enabled = chkActiLength.Checked = (row.Cells.FromKey(&quot;Length&quot;).Value != null);
                    wneActiLength.Value = chkActiLength.Checked ? row.Cells.FromKey(&quot;Length&quot;).Value : null;
                    wneActiWidth.Enabled = chkActiWidth.Checked = (row.Cells.FromKey(&quot;Width&quot;).Value != null);
                    wneActiWidth.Value = chkActiWidth.Checked ? row.Cells.FromKey(&quot;Width&quot;).Value : null;
                    wneActiHeight.Enabled = chkActiHeight.Checked = (row.Cells.FromKey(&quot;Height&quot;).Value != null);
                    wneActiHeight.Value = chkActiHeight.Checked ? row.Cells.FromKey(&quot;Height&quot;).Value : null;
                    wneActiQuantity.Value = row.Cells.FromKey(&quot;WOQuantity&quot;).Value;
                    if (ddlActiUnit.Items.FindByText(row.Cells.FromKey(&quot;Unit&quot;).Text) != null)
                    {
                        ddlActiUnit.SelectedIndex = -1;
                        ddlActiUnit.Items.FindByText(row.Cells.FromKey(&quot;Unit&quot;).Text).Selected = true;
                    }
                    if (row.Cells.Exists(&quot;CertifiedQuantity&quot;) &amp;&amp; row.Cells.FromKey(&quot;CertifiedQuantity&quot;).Value != null
                        &amp;&amp; row.Cells.FromKey(&quot;CertifiedQuantity&quot;).Value.ToDecimal2() != 0)
                    {
                        wneActiUnitCost.ReadOnly = true;
                    }
                    if (row.Cells.Exists(&quot;PreVerActID&quot;) &amp;&amp; row.Cells.FromKey(&quot;PreVerActID&quot;).Value.ToInt32_2() != 0)
                    {
                        txtActivityName.ReadOnly = true;
                        ddlActiUnit.Enabled = false;
                    }
                    else
                    {
                        txtActivityName.ReadOnly = false;
                        ddlActiUnit.Enabled = true;
                    }

                    EnableDisableActivitiesGrid(WOConstants.DISABLE);

                    Page.ClientScript.RegisterStartupScript(GetType(), &quot;ShowActivityDetails&quot;,
                                                            &quot;setTimeout(&#39;ShowActivityDetails()&#39;, 1000);&quot;, true);
                    break;
            }
        }

        private void EnableDisableActivitiesGrid(string enableDisable)
        {
            UltraGridBand band = uwgActivities.Bands[0];
            if (enableDisable == WOConstants.DISABLE)
            {
                band.HeaderStyle.ForeColor = Color.DarkGray;
                uwgActivities.DisplayLayout.ClientSideEvents.BeforeSelectChangeHandler = &quot;Grid_BeforeSelectChange&quot;;
                uwgActivities.DisplayLayout.ClientSideEvents.BeforeRowActivateHandler = &quot;Grid_BeforeRowActivate&quot;;
            }
            else if (enableDisable == WOConstants.ENABLE)
            {
                band.HeaderStyle.ForeColor = uwgActivities.DisplayLayout.HeaderStyleDefault.ForeColor;
                uwgActivities.DisplayLayout.ClientSideEvents.BeforeSelectChangeHandler = &quot;&quot;;
                uwgActivities.DisplayLayout.ClientSideEvents.BeforeRowActivateHandler = &quot;&quot;;
            }
        }

        protected void lnkDelete_Click(object sender, EventArgs e)
        {
            switch (hdnVisibleTab.Value)
            {
                case WOConstants.TAB_QUOT:
                    string del = hdnMulti.Value;
                    hdnMulti.Value = &quot;&quot;;
                    if (del.LastIndexOf(&#39;,&#39;) &gt; 0)
                        del = del.Substring(0, del.LastIndexOf(&#39;,&#39;));
                    if (del == &quot;&quot;)
                        return;
                    WORKORDManager.Instance.DeleteQuotation(del);
                    LoadWorkOrderInstanceDetails();
                    break;
                case WOConstants.TAB_ACTI:
                    //WOManager.Instance.DeleteActivities(del);
                    DeleteActivities();
                    break;
            }
            //LoadWorkOrderInstanceDetails();
        }

        private void DeleteActivities()
        {
            int exists = 0;
            bool hasCertifiedQty = false;
            var rowID = new List&lt;int&gt;();

            for (int i = 0; i &lt; uwgActivities.Rows.Count; i++)
            {
                if (uwgActivities.Rows[i].Cells.FromKey(&quot;To&quot;).Value.ToString2() == &quot;true&quot; ||
                    uwgActivities.Rows[i].Cells.FromKey(&quot;To&quot;).Value.ToString2() == &quot;1&quot;)
                {
                    int itemId = 0;
                    int retVal = 0;
                    itemId = uwgActivities.Rows[i].Cells.FromKey(&quot;ItemID&quot;).Value.ToInt32_2();
                    retVal = WORKORDManager.Instance.ValidateBOQDelete(_WorkOrderID, itemId);
                    exists += retVal;

                    if (isVersion)
                        hasCertifiedQty = (uwgActivities.Rows[i].Cells.FromKey(&quot;CertifiedQuantity&quot;).Value.ToDecimal2() &gt; 0);

                    if (retVal == 0 &amp;&amp; !hasCertifiedQty)
                        rowID.Add(i);
                    else
                        break;
                }
            }
            if (exists &gt; 0)
            {
                Page.ClientScript.RegisterStartupScript(GetType(), &quot;Deleted.&quot;,
                                                        &quot;alert (&#39;Could not delete one or more Activities as they are part of one or more Material Issues or Purchase Indents.&#39;);&quot;,
                                                        true);
            }
            else if (hasCertifiedQty)
            {
                Page.ClientScript.RegisterStartupScript(GetType(), &quot;Deleted.&quot;,
                                            &quot;alert (&#39;Could not delete one or more activities as there exist certified quantity for them.&#39;);&quot;, true);
            }
            else
            {
                int count = 0;
                decimal totalAmt = hdnTotalAmt.Value.ToDecimal2();
                foreach (int i in rowID)
                {
                    totalAmt -= uwgActivities.Rows[i - count].Cells.FromKey(&quot;Amount&quot;).Value.ToDecimal2();
                    uwgActivities.Rows[i - count].Delete();
                    count++;
                }
                hdnTotalAmt.Value = totalAmt.ToString2();
                lblWOAmount.Text = totalAmt.ToString(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT);
            }
        }

        private void SetDeletedActivityItem(UltraGridRow row)
        {
            CellsCollection cells = row.Cells;
            if (_WorkOrderID &gt; 0 &amp;&amp; cells.FromKey(&quot;ActID&quot;).Value.ToInt32_2() &gt; 0)
            {
                var item = new DeletedActivityItems();
                item.ActivityName = cells.FromKey(&quot;ActivityName&quot;).Value.ToString2();
                item.ItemID = cells.FromKey(&quot;ItemID&quot;).Value.ToInt32_2();
                item.SubItemID = cells.FromKey(&quot;SubItemID&quot;).Value.ToInt32_2();
                item.Quantity = (row.Cells.FromKey(&quot;ActivityID&quot;).Value.ToDecimal2() == 0)
                                    ? 0
                                    : cells.FromKey(&quot;Quantity&quot;).Value.ToDecimal2();
                if (DelItems.Contains(item))
                    DelItems.Find(
                        f =&gt;
                        f.ActivityName == item.ActivityName &amp;&amp; f.ItemID == item.ItemID &amp;&amp; f.SubItemID == item.SubItemID)
                        .Quantity += item.Quantity;
                else
                    DelItems.Add(item);
            }
            _DelItems = DelItems;
        }

        protected void lnkAward_Click(object sender, EventArgs e)
        {
            try
            {
                if (hdnQuotationID == null || string.IsNullOrEmpty(hdnQuotationID.Value))
                {
                    return;
                }

                switch (WOManager.Instance.SetQuotationStatus(hdnQuotationID.Value, WOConstants.QUOTATION_STAGE_AWARDED))
                {
                    case -2:
                        throw new Exception(
                            &quot;Either the quotaion is already awarded or there exist another quotation which is awarded. Request denied.&quot;);
                    case -3:
                        throw new Exception(
                            &quot;One or more activities have been quoted more than the estimated rate. Request denied.&quot;);
                }
            }
            catch (Exception ex)
            {
                base.ShowError(ex.Message);
            }
            finally
            {
                //Update WorkOrderItems Table with new unit prices and update Contractor
                LoadWorkOrderInstanceDetails();
                hdnVisibleTab.Value = WOConstants.TAB_QUOT;
            }
        }

        protected void btnUpload_Click(object sender, EventArgs e)
        {
            if (FileUpload1.HasFile)
            {
                string FileName = FileUpload1.PostedFile.FileName;
                string FileGuid = Guid.NewGuid().ToString2();
                string Extension = Path.GetExtension(FileUpload1.FileName);
                if (Extension.Equals(&quot;.xls&quot;, StringComparison.CurrentCultureIgnoreCase))
                {
                    if (hdnStage.Value.ToInt32_2() == 2)
                    {
                        string filePath = FileGuid + &quot;.xls&quot;;
                        FileUpload1.SaveAs(Server.MapPath(filePath));

                        DataSet obj;

                        bool status = ImportExcel(HttpContext.Current.Server.MapPath(filePath), out obj);
                        if (status)
                        {
                            SetStatusMessage(status);
                        }

                        if (obj != null
                            &amp;&amp; status)
                        {
                            ViewState[&quot;ImportData&quot;] = obj;
                        }
                        try
                        {
                            File.Delete(Server.MapPath(filePath));
                        }
                        catch
                        {
                        }

                        trQuotTemplate.Style.Add(&quot;display&quot;, &quot;table-row&quot;);
                    }
                }
                else
                {
                    SetErrorMessage(MSG_INVALID_FILE);
                }
            }
            else
            {
                SetErrorMessage(MSG_INVALID_FILE);
            }

            hdnVisibleTab.Value = WOConstants.TAB_QUOT;
        }

        //protected void btnSave1_Click(object sender, EventArgs e)
        //{
        //    trQuotTemplate.Style.Value = &quot;display:block&quot;;
        //    DataSet dataSet = (DataSet)ViewState[&quot;ImportData&quot;];
        //    DataTable dt=dataSet.Tables[0];
        //    dt.Columns.Remove(dt.Columns[&quot;Quantity&quot;]);
        //    dt.Columns[&quot;WOQuantity&quot;].ColumnName=&quot;Quantity&quot;;
        //        dt.Columns.Remove(dt.Columns[&quot;ItemId&quot;]);
        //    dt.Columns[&quot;StandardItemNo#&quot;].ColumnName=&quot;ItemId&quot;;
        //    uwgQuotItems.DataSource = dt;
        //    uwgQuotItems.DataBind();
        //    SetQuotationItemsGridColumns();
        //    //bool status = PersistExcelData(dataSet);
        //    //if (status)
        //    //{
        //    //    SetStatusMessage(status);
        //    //}
        //    //else
        //    //{
        //    //    SetErrorMessage(&quot;Import Failed&quot;);
        //    //}
        //    //SetStatusMessage(status);
        //}

        private void SetStatusMessage(bool status)
        {
            lblQuotError.Style.Add(&quot;display&quot;, &quot;block&quot;);
            lblQuotError.CssClass = (status) ? &quot;lblCOk&quot; : &quot;lblCErr&quot;;
            lblQuotError.Text = &quot;Import Succeeded&quot;;
        }

        private void SetErrorMessage(string errMessage)
        {
            lblQuotError.Style.Add(&quot;display&quot;, &quot;block&quot;);
            lblQuotError.Visible = true;
            lblQuotError.Text = errMessage;
            lblQuotError.CssClass = &quot;lblCErr&quot;;
        }

        protected bool ImportExcel(string FileName, out DataSet xslData)
        {
            DataTable xlsDataTable;
            bool status = true;
            xslData = null;
            int TableNumber = 0;
            try
            {
                string strConn = &quot;Provider=Microsoft.Jet.OLEDB.4.0;Data Source=&quot; + FileName +
                                 &quot;;Extended Properties=&#39;Excel 8.0;HDR=Yes;IMEX=1&#39;&quot;;
                string sheetName = null;
                // Extract list of tables from Excel sheet.
                var objConn = new OleDbConnection(strConn);
                objConn.Open(); // Open connection with the database.

                #region If multiple sheets are present in the Excel choose

                DataTable dtXLSSchema = objConn.GetOleDbSchemaTable((OleDbSchemaGuid.Tables), null);
                DataSet tblSchemaSet = new BrixDataSet();
                tblSchemaSet = GetSchema();
                // Get the data table containg the schema guid.
                if ((dtXLSSchema == null) || (dtXLSSchema.Rows.Count &lt; 1))
                {
                    status = false;
                    SetErrorMessage(&quot;Import Failed.&quot;);
                    return status;
                }
                else if ((dtXLSSchema.Rows.Count) != (tblSchemaSet.Tables.Count))
                {
                    status = false;
                    SetErrorMessage(
                        &quot;Import Failed. Number of tables in Excel file does not match the required number of tables&quot;);
                    return status;
                }
                do
                {
                    sheetName = dtXLSSchema.Rows[TableNumber][&quot;TABLE_NAME&quot;].ToString2();

                    #endregion

                    #region Column Schema validation...

                    DataTable xlsSchemaTable;
                    var xlsData = new OleDbDataAdapter(&quot;SELECT top 1 * FROM [&quot; + sheetName + &quot;]&quot;, objConn);
                    xlsSchemaTable = new BrixDataTable();
                    xlsData.Fill(xlsSchemaTable);

                    #region check whether all columns in table are present in the excel sheet..

                    foreach (DataColumn dc in tblSchemaSet.Tables[TableNumber].Columns)
                    {
                        string colName = dc.ColumnName;
                        switch (colName)
                        {
                            case &quot;StandardItemNo&quot;:
                            case &quot;Amount&quot;:
                            case &quot;UnitCost&quot;:
                            case &quot;ItemID&quot;:
                            case &quot;ActivityID&quot;:
                                colName =
                                    LocalizationManager.GetString(KeyConstants.LOC_PAY_ITEM_NO.ToString()).Replace(&quot;.&quot;,
                                                                                                                   &quot;#&quot;);
                                break;
                            case &quot;SubItem&quot;:
                                colName = &quot;Sub Item&quot;;
                                break;
                        }

                        if (!xlsSchemaTable.Columns.Contains(colName))
                        {
                            status = false;
                            SetErrorMessage(&quot;Import failed. The column \&quot;&quot; + colName +
                                            &quot;\&quot; is missing in the Excel file. &quot;);
                            return status;
                        }
                    }

                    #endregion

                    #endregion

                    #region Load Data..

                    xlsDataTable = new BrixDataTable();

                    foreach (DataColumn dc in tblSchemaSet.Tables[TableNumber].Columns)
                    {
                        var col = new DataColumn();
                        col.ColumnName = dc.ColumnName;
                        switch (dc.DataType.Name.ToString2().ToUpper2())
                        {
                            case &quot;INT32&quot;:
                                col.DataType = Type.GetType(&quot;System.Int32&quot;);
                                col.DefaultValue = 0;
                                break;
                            case &quot;DECIMAL&quot;:
                                col.DataType = Type.GetType(&quot;System.Decimal&quot;);
                                col.DefaultValue = 0.0;
                                break;
                            case &quot;DATETIME&quot;:
                                col.DataType = Type.GetType(&quot;System.DateTime&quot;);
                                col.DefaultValue = MWDateTimeHelper.MWToday;
                                break;
                            case &quot;DOUBLE&quot;:
                                col.DataType = Type.GetType(&quot;System.Double&quot;);
                                col.DefaultValue = 0.0;
                                break;
                            default:
                                col.DataType = Type.GetType(&quot;System.String&quot;);
                                col.DefaultValue = &quot;NA&quot;;
                                break;
                        }
                        col.AllowDBNull = dc.AllowDBNull;

                        xlsDataTable.Columns.Add(col);
                    }

                    string testQuery = &quot;SELECT * FROM [&quot; + sheetName + &quot;]&quot;;
                    ;
                    xlsData = new OleDbDataAdapter(testQuery, objConn);
                    xlsData.Fill(xlsDataTable);

                    if (xslData == null)
                        xslData = new BrixDataSet();
                    xslData.Tables.Add(xlsDataTable);
                    TableNumber++;
                } while (TableNumber &lt; dtXLSSchema.Rows.Count - 1);

                //Verify if the list of items in the excel matches the one in the grid.
                DataTable dtXlItems = xslData.Tables[0];
                int xlRowCnt = dtXlItems.Rows.Count;
                if (xlRowCnt != uwgQuotItems.Rows.Count)
                {
                    SetErrorMessage(&quot;The number of rows in the Excel file do not match the number of &quot; +
                                    LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR) +
                                    &quot;s that are part of this Work Order&quot;);
                    return false;
                }

                RowsCollection rows = uwgQuotItems.Rows;
                decimal totalAmount = 0;
                for (int i = 0; i &lt; rows.Count; i++)
                {
                    string actName = rows[i].Cells.FromKey(&quot;ActivityName&quot;).Text;
                    DataRow[] dtRows = dtXlItems.Select(&quot;ActivityName = &#39;&quot; + actName + &quot;&#39;&quot;);
                    if (dtRows.Length == 0)
                    {
                        SetErrorMessage(&quot;Activity with Activity Name : &quot; + actName + &quot;is missing in the Excel file.&quot;);
                        ResetQuotationItemsRate();
                        return false;
                    }
                    else
                    {
                        string ratetxt = dtRows[0][&quot;Rate&quot;].ToString2();
                        decimal rate = 0;
                        if (string.IsNullOrEmpty(ratetxt) || !decimal.TryParse(ratetxt, out rate))
                        {
                            SetErrorMessage(&quot;Activity with Activity Name : &quot; + actName +
                                            &quot;does not have a valid entry for rate.&quot;);
                            ResetQuotationItemsRate();
                            return false;
                        }
                        rows[i].Cells.FromKey(&quot;Rate&quot;).Value = rate;
                        rows[i].Cells.FromKey(&quot;Amount&quot;).Value = rate *
                                                                rows[i].Cells.FromKey(&quot;Quantity&quot;).Value.ToDecimal2();
                        totalAmount += rate * rows[i].Cells.FromKey(&quot;Quantity&quot;).Value.ToDecimal2();
                    }
                }
                wneTotal.Value = totalAmount;

                return status;
            }
            catch (Exception ex)
            {
                SetErrorMessage(ex.Message);
                //retStatus.Message = ex.Message;
                return false;
            }

            #endregion
        }

        private void ResetQuotationItemsRate()
        {
            RowsCollection rows = uwgQuotItems.Rows;
            for (int i = 0; i &lt; rows.Count; i++)
            {
                rows[i].Cells.FromKey(&quot;UnitCost&quot;).Value = 0;
            }
        }

        protected bool PersistExcelData(DataSet xlsData)
        {
            bool status = true;
            string ID = &quot;ID&quot;;
            DataTable dtdatafromtable = new BrixDataTable();
            DataSet ds = WOManager.Instance.GetQuotations(_WorkOrderID);
            dtdatafromtable = ds.Tables[1];
            DataRow[] dx;

            //if (xlsData.Tables.Count == 0 || xlsData.Tables[0].Rows[0][ID].ToString2() == &quot;&quot;)
            //{
            //    status.Status = false;
            //    status.Message = &quot;No records to save&quot;;
            //    return status;
            //}

            DataTable xlsDataTable1 = xlsData.Tables[0];

            xlsDataTable1.Columns.Add(&quot;MustDelete&quot;, typeof(string));
            xlsDataTable1.Columns[&quot;MustDelete&quot;].DefaultValue = &quot;N&quot;;
            foreach (DataRow dr in xlsDataTable1.Select(ID + &quot;=&#39;&#39;&quot;))
            {
                //xlsDataTable.Rows.Remove(dr);
                dr[ID] = 0;
                dr[&quot;MustDelete&quot;] = &quot;Y&quot;;
            }

            foreach (DataRow dr in xlsDataTable1.Rows)
            {
                dx = dtdatafromtable.Select(ID + &quot;=&#39;&quot; + dr[ID] + &quot;&#39;&quot;);
                if (dx.Length &gt; 0)
                    dr[&quot;MustDelete&quot;] = &quot;Y&quot;;
                DataRow[] duplicateRowsExcel = xlsDataTable1.Select(ID + &quot;=&#39;&quot;
                                                                    + dr[ID].ToString2().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) + &quot;&#39;&quot;);
                if (duplicateRowsExcel.Length &gt; 1)
                {
                    dr[&quot;MustDelete&quot;] = &quot;Y&quot;;
                    continue;
                }
            }

            foreach (DataRow dr in xlsDataTable1.Select(&quot;MustDelete=&#39;Y&#39;&quot;))
            {
                dr.Delete();
            }
            xlsDataTable1.Columns.Remove(&quot;MustDelete&quot;);

            xlsDataTable1.AcceptChanges();
            //if (xlsDataTable1.Rows.Count == 0)
            //{
            //    status.Status = false;
            //    status.Message = &quot;No data was Imported.&quot;;
            //    return status;
            //}

            uwgQuotItems.DataSource = xlsDataTable1;

            status = (uwgQuotItems.Rows.Count == 0) ? false : true;
            //GetResult(xlsData, ParentInstanceID);
            return status;
        }

        protected DataSet GetSchema()
        {
            DataTable ItemTab = new BrixDataTable();
            DataSet dsitems = new BrixDataSet();
            ItemTab = dsitems.Tables.Add(&quot;WorkOrderItems&quot;);
            ItemTab.Columns.AddRange(QuotationsItemsSchema());
            ItemTab.Rows.Add(new object[] { null, null, null });

            return dsitems;
        }

        private bool SaveAttachments(int WorkOrderID, UserDetail user, bool IsVersion)
        {
            try
            {
                ((AttachmentsControl)attachments).ParentModuleID = Constants.MODID_CONTMGT;
                ((AttachmentsControl)attachments).ParentInstanceID = Request[WOConstants.QRY_CONTRACTID].ToInt32_2();
                return ((IsVersion)
                            ? ((AttachmentsControl)attachments).CreateAttachmentsForVersions(WorkOrderID.ToString2(),
                                                                                              WOConstants.MODULE_NAME,
                                                                                              user.UID, user.UserName,
                                                                                              &quot;Work Order Attachments&quot;)
                            : ((AttachmentsControl)attachments).SaveAttachments(WorkOrderID.ToString2(),
                                                                                 WOConstants.MODULE_NAME, user.UID,
                                                                                 user.UserName, &quot;Work Order Attachments&quot;));
            }
            catch
            {
                return false;
            }
        }

        protected override void CreateChildControls()
        {
            //var menus = new MenuArray();
            //menus.Add(new BrixMenu(&quot;lnkNew&quot;, &quot;New&quot;, &quot;Icn_New.png&quot;, 55));
            //menus.Add(new BrixMenu(&quot;lnkGet&quot;, &quot;Add Activities&quot;, &quot;Icn_StandardItems.png&quot;, 55));
            //menus.Add(new BrixMenu(&quot;lnkEdit&quot;, &quot;Edit&quot;, &quot;Icn_Edit.png&quot;, 55));
            //menus.Add(new BrixMenu(&quot;lnkDelete&quot;, &quot;Delete&quot;, &quot;Icn_Delete.png&quot;, 55));
            //menus.Add(new BrixMenu(&quot;lnkShortClose&quot;, &quot;Short Close&quot;, &quot;Icn_Version.png&quot;, 55));
            ////The menus Award,Reject and Revert are changed as sub menus under Actions menu.
            //var actionsMenu = new BrixMenu(&quot;lnkActions&quot;, &quot;Actions&quot;, &quot;Icn_Others.png&quot;, 70, 170);
            //actionsMenu.subMenus.Add(new BrixMenu(&quot;lnkAward&quot;, &quot;Award&quot;, &quot;Icn_Award_16.png&quot;, 15));
            //actionsMenu.subMenus.Add(new BrixMenu(&quot;lnkReject&quot;, &quot;Reject&quot;, &quot;Icn_Reject_16.PNG&quot;, 15));
            //actionsMenu.subMenus.Add(new BrixMenu(&quot;lnkRevert&quot;, &quot;Revert&quot;, &quot;Icn_Revert_16.png&quot;, 15));

            //menus.Add(actionsMenu);

            //if (AllowSave)
            //    menus.Add(new BrixMenu(&quot;lnkSave&quot;, &quot;Save&quot;, &quot;Icn_Save.png&quot;, 55));
            //menus.Add(new BrixMenu(&quot;lnkImport&quot;, &quot;Export To Excel&quot;, &quot;Icn_export.png&quot;, 55));
            //menus.Add(new BrixMenu(&quot;lnkCancel&quot;, &quot;Cancel&quot;, &quot;Icn_Cancel.png&quot;, 55));

            //CreateToolBarMenu(menus, null);

            var menuGroups = new List&lt;MenuGroup&gt;();
            MenuGroup generalGroup = new MenuGroup(&quot;General&quot;);
            if (AllowSave)
                generalGroup.AddMenu(new LargeButton(&quot;lnkSave&quot;, &quot;Save&quot;, &quot;Icn_Save.png&quot;));
            generalGroup.AddMenu(new LargeButton(&quot;lnkImport&quot;, &quot;Export&quot;, &quot;Icn_export.png&quot;));
            generalGroup.AddMenu(new LargeButton(&quot;lnkCancel&quot;, &quot;Cancel&quot;, &quot;Icn_Cancel.png&quot;));

            generalGroup.AddMenu(new TextIcon(&quot;lnkNew&quot;, &quot;New&quot;, &quot;Icn_New_16.png&quot;));
            generalGroup.AddMenu(new TextIcon(&quot;lnkEdit&quot;, &quot;Edit&quot;, &quot;Icn_Edit_16.png&quot;));
            generalGroup.AddMenu(new TextIcon(&quot;lnkDelete&quot;, &quot;Delete&quot;, &quot;Icn_Delete_16.png&quot;));
            generalGroup.AddMenu(new TextIcon(&quot;lnkGet&quot;, &quot;Add Activities&quot;, &quot;Icn_AllActivities_16.png&quot;));
            generalGroup.AddMenu(new TextIcon(&quot;lnkShortClose&quot;, &quot;Short Close&quot;, &quot;Icn_ShortClose_16.png&quot;));

            LargeButton actionButton = new LargeButton(&quot;lnkActions&quot;, &quot;Actions&quot;, &quot;Icn_Others.png&quot;);
            actionButton.AddSubMenu(new LargeButton(&quot;lnkAward&quot;, &quot;Award&quot;, &quot;Icn_Award_16.png&quot;));
            actionButton.AddSubMenu(new LargeButton(&quot;lnkReject&quot;, &quot;Reject&quot;, &quot;Icn_Reject_16.png&quot;));
            actionButton.AddSubMenu(new LargeButton(&quot;lnkRevert&quot;, &quot;Revert&quot;, &quot;Icn_Revert_16.png&quot;));
            generalGroup.AddMenu(actionButton);
            menuGroups.Add(generalGroup);

            CreateToolBarMenu(menuGroups, null);

            base.CreateChildControls();
        }

        protected override void CustomizeToolBar()
        {
            if (MainToolBar.GetMenuReference(&quot;lnkNew&quot;) != null)
                MainToolBar.GetMenuReference(&quot;lnkNew&quot;).OnClientClick = &quot;return AddQuotation();&quot;;

            if (MainToolBar.GetMenuReference(&quot;lnkGet&quot;) != null)
                MainToolBar.GetMenuReference(&quot;lnkGet&quot;).Click += btnItemPicker_Click;

            if (MainToolBar.GetMenuReference(&quot;lnkEdit&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).Click += lnkEdit_Click;
                MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).OnClientClick = &quot;javascript:return Edit();&quot;;
            }
            if (MainToolBar.GetMenuReference(&quot;lnkDelete&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).Click += lnkDelete_Click;
                MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).OnClientClick = &quot;javascript:return HandleDelete();&quot;;
            }
            //If the user has enough permission then only can do award,reject,revert
            if (MainToolBar.GetMenuReference(&quot;lnkAward&quot;) != null)
            {
                if (permissions.Contains(&quot;AwardQtn&quot;))
                {
                    MainToolBar.GetMenuReference(&quot;lnkAward&quot;).Click += lnkAward_Click;
                    MainToolBar.GetMenuReference(&quot;lnkAward&quot;).OnClientClick = &quot;javascript:return AwardQuotation();&quot;;
                }
                else
                {
                    MainToolBar.DisableMenu(&quot;lnkAward&quot;);
                    MainToolBar.GetMenuReference(&quot;lnkAward&quot;).OnClientClick = &quot;javascript:return false;&quot;;
                }
            }
            if (MainToolBar.GetMenuReference(&quot;lnkReject&quot;) != null &amp;&amp; permissions.Contains(&quot;RejectQtn&quot;))
            {
                MainToolBar.GetMenuReference(&quot;lnkReject&quot;).Click += lnkReject_Click;
                MainToolBar.GetMenuReference(&quot;lnkReject&quot;).OnClientClick =
                    &quot;javascript:return MultiOpsQuotations(&#39;reject&#39;);&quot;;
            }
            else
            {
                MainToolBar.DisableMenu(&quot;lnkReject&quot;);
            }
            if (MainToolBar.GetMenuReference(&quot;lnkRevert&quot;) != null &amp;&amp; permissions.Contains(&quot;RevertQtn&quot;))
            {
                MainToolBar.GetMenuReference(&quot;lnkRevert&quot;).Click += lnkRevert_Click;
                MainToolBar.GetMenuReference(&quot;lnkRevert&quot;).OnClientClick =
                    &quot;javascript:return MultiOpsQuotations(&#39;revert&#39;);&quot;;
            }
            else
            {
                MainToolBar.DisableMenu(&quot;lnkRevert&quot;);
            }
            if (MainToolBar.GetMenuReference(&quot;lnkShortClose&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkShortClose&quot;).Click += lnkShortClose_Click;
                MainToolBar.GetMenuReference(&quot;lnkShortClose&quot;).OnClientClick = &quot;javascript:return ShortClose();&quot;;
            }
            if (MainToolBar.GetMenuReference(&quot;lnkSave&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkSave&quot;).Click += btnSave_Click;
                MainToolBar.GetMenuReference(&quot;lnkSave&quot;).OnClientClick = &quot;javascript:return Validate();&quot;;
            }
            if (MainToolBar.GetMenuReference(&quot;lnkImport&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkImport&quot;).Click += btnExport_Click;
                MainToolBar.GetMenuReference(&quot;lnkImport&quot;).OnClientClick = &quot;javascript:return ValidateExport();&quot;;
            }
            if (MainToolBar.GetMenuReference(&quot;lnkCancel&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkCancel&quot;).Click += Cncl_Click;
            }
        }

        protected void lnkShortClose_Click(object sender, EventArgs e)
        {
        }

        public void CancelHandler(object sender, bool bAfterSave, out string sRedirectTo)
        {
            throw new NotImplementedException();
        }

        public string PostSaveRedirectUrl(string sSavedToken = &quot;&quot;)
        {
            return
                &quot;~/Common/BrixListPage.aspx?Context=WORKORD&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&quot;.Format2(
                    Request[WOConstants.QRY_PROJECTID], Request[WOConstants.QRY_CONTRACTID]);
        }

        public bool SaveHandler(object sender, out string sSavedInstanceToken, out string sErrors,
                                out string sRedirectTo)
        {
            sSavedInstanceToken = &quot;&quot;;
            sErrors = &quot;&quot;;
            sRedirectTo = &quot;&quot;;
            bool wfBtn = false;
            if (sender.GetType().FullName.Contains(&quot;HiddenField&quot;))
                wfBtn = true;

            if (hdnStage.Value != WOConstants.STAGE_APPROVE_AMENDMENT.ToString2())
                SaveWorkOrder(out sErrors, out sSavedInstanceToken, wfBtn);
            else
                sSavedInstanceToken = hdnWorkOrderID.Value;
            //sSavedInstanceToken = hdnWorkOrderID.Value.ToString();
            VersionNo = ComponentHelper.Instance.ExecuteScalar(&quot;SELECT VersionNo from WORKORDMain where WorkOrderNo = {0}&quot;, txtWONo.Text).ToString2();

            if (string.IsNullOrEmpty(sErrors) &amp;&amp; !(string.IsNullOrEmpty(sSavedInstanceToken)) &amp;&amp;
                sSavedInstanceToken != &quot;-1&quot;)
                return true;
            else
            {
                if (!string.IsNullOrEmpty(sErrors))
                    sErrors = sErrors.Replace(&quot;Prepayment&quot;, &quot;Pre-Payment&quot;).Replace(&quot;BOQ&quot;, ItemNameAbbr);
                return false;
            }
        }

        protected override void SetModes()
        {
            _IsEdit = !string.IsNullOrEmpty(Request.QueryString[&quot;Type&quot;]) &amp;&amp; Request.QueryString[&quot;Type&quot;].ToLower() == &quot;e&quot;;
            _IsView = !string.IsNullOrEmpty(Request.QueryString[&quot;Type&quot;]) &amp;&amp; Request.QueryString[&quot;Type&quot;].ToLower() == &quot;v&quot;;
            _IsNew = (string.IsNullOrEmpty(Request.QueryString[&quot;Version&quot;])
                          ? (!string.IsNullOrEmpty(Request.QueryString[&quot;Type&quot;])
                                 ? Request.QueryString[&quot;Type&quot;].ToLower() == &quot;n&quot;
                                 : !IsEdit &amp;&amp; !IsView
                            )
                          : (Request.QueryString[&quot;Version&quot;] == &quot;true&quot; &amp;&amp;
                             string.IsNullOrEmpty(Request.QueryString[&quot;IsEditVersion&quot;]))
                     );
            _IsList = !string.IsNullOrEmpty(Request.QueryString[&quot;Type&quot;]) &amp;&amp;
                      Request.QueryString[&quot;Type&quot;].ToLower() == &quot;list&quot;;
        }

        #region Prepayment rule and retention rule association

        #region Event handlers

        public void prepaymentRulePicker_BindData(string Filter, string SortOrder, out DataSet DsResult,
                                                  ref int CurrentPage, int PageSize, out int PageCount)
        {
            DsResult = new DataSet();
            DataTable dtPrepaymentDetails = new BrixDataTable();
            if (!string.IsNullOrEmpty(Filter))
            {
                prepaymentPicker.Currency = LocalizationManager.GetModuleCurrency(&quot;WORKORD&quot;, _WorkOrderID.ToString2());
                var doc = new XmlDocument();
                doc.LoadXml(Filter);
                string prepaymentRule = ((doc).DocumentElement.SelectSingleNode(&quot;PrepaymentRuleName&quot;)) == null
                                            ? string.Empty
                                            : ((doc).DocumentElement.SelectSingleNode(&quot;PrepaymentRuleName&quot;)).InnerText.
                                                  ToString2();
                string description = ((doc).DocumentElement.SelectSingleNode(&quot;Description&quot;)) == null
                                         ? string.Empty
                                         : ((doc).DocumentElement.SelectSingleNode(&quot;Description&quot;)).InnerText.ToString2();
                try
                {
                    //Exception is thrown if the select queries returns zero rows.
                    dtPrepaymentDetails =
                        dtRecovery.Copy().Select(&quot;RecoveryRuleName like &#39;%&quot; + prepaymentRule.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) +
                                                 &quot;%&#39; and Description like &#39;%&quot; + description.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) + &quot;%&#39;&quot;).CopyToDataTable();
                }
                catch
                {
                }
            }
            else
            {
                dtPrepaymentDetails = dtRecovery.Copy();
            }
            dtPrepaymentDetails.Columns.Add(&quot;PrepayValue&quot;, typeof(string));
            for (int i = 0; i &lt; dtPrepaymentDetails.Rows.Count; i++)
            {
                if (dtPrepaymentDetails.Rows[i][&quot;prepaymentmode&quot;].ToString2().ToLower2() == &quot;true&quot; ||
                    dtPrepaymentDetails.Rows[i][&quot;prepaymentmode&quot;].ToString2() == &quot;1&quot;)
                    dtPrepaymentDetails.Rows[i][&quot;PrepayValue&quot;] =
                        dtPrepaymentDetails.Rows[i][&quot;Value&quot;].ToDecimal2().ToString(AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE,
                                                                                   CultureInfo.CurrentCulture) + &quot; %&quot;;
                else
                    dtPrepaymentDetails.Rows[i][&quot;PrepayValue&quot;] =
                        dtPrepaymentDetails.Rows[i][&quot;Value&quot;].ToDecimal2().ToString(AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE,
                                                                                   CultureInfo.CurrentCulture) + &quot; in &quot; +
                        LocalizationManager.GetModuleCurrency(Constants.MODID_CONTMGT, _ContractID.ToString2());
            }
            dtPrepaymentDetails.AcceptChanges();
            DsResult.Tables.Add(dtPrepaymentDetails);
            PageCount = (int)Math.Ceiling(dtPrepaymentDetails.Rows.Count.ToDecimal2() / PageSize);
        }

        private void prepaymentRulePicker_BackClicked(object sender, EventArgs e)
        {
            ShowDiv(ItemDivEnums.CreateWO);
        }

        private void prepaymentRulePicker_SelectedIndexChanged(object sender, ItemSelectedEventArgs e)
        {
            string mode = string.Empty;
            string format = string.Empty;
            string recoveryID = e.SelectedItems.Rows[0][&quot;RecoveryID&quot;].ToString2();
            bool addPrepayment = false;

            if (isVersion)
            {
                int isValid = WORKORDManager.Instance.ValidatePrepaymentRule(_WorkOrderID, recoveryID.ToInt32_2());
                if (isValid == 0)
                    addPrepayment = true;
                else
                    addPrepayment = false;
            }
            else
                addPrepayment = true;

            if (addPrepayment)
            {
                DataRow[] dtRec = dtRecovery.Select(&quot;RecoveryId=&quot; + recoveryID);
                DataRow rowPrepaymentDetails = dtRec[0];
                mode = ((rowPrepaymentDetails[&quot;Prepaymentmode&quot;].ToString2() == &quot;False&quot; ||
                         rowPrepaymentDetails[&quot;Prepaymentmode&quot;].ToString2() == &quot;1&quot;)
                            ? WOConstants.MODE_AMOUNT
                            : WOConstants.MODE_PERCENTAGE);
                format = (mode == WOConstants.MODE_PERCENTAGE ? AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE : AMP3ApplicationSettings.Instance.FORMAT_AMOUNT);
                wneMaxPercentage.Value =
                    ((rowPrepaymentDetails[&quot;Prepaymentmode&quot;].ToString2() == &quot;True&quot; ||
                      rowPrepaymentDetails[&quot;Prepaymentmode&quot;].ToString2() == &quot;0&quot;)
                         ? rowPrepaymentDetails[&quot;Value&quot;].ToString2()
                         : &quot;0&quot;).ToDecimal2().ToString(AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE, CultureInfo.CurrentCulture);
                wneMaxAmount.Value =
                    ((rowPrepaymentDetails[&quot;Prepaymentmode&quot;].ToString2() == &quot;False&quot; ||
                      rowPrepaymentDetails[&quot;Prepaymentmode&quot;].ToString2() == &quot;1&quot;)
                         ? rowPrepaymentDetails[&quot;Value&quot;].ToString2()
                         : &quot;0&quot;).ToDecimal2().ToString(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture);
                txtPrepaymentRule.Text = e.SelectedItems.Rows[0][&quot;RecoveryRuleName&quot;].ToString2();

                CalculateAmountOrPercentage(mode);
                HideShowTB(mode);

                DataTable dtPrepaymentType = new BrixDataTable();
                var col = new DataColumn[] { };

                dtPrepaymentType.Columns.AddRange(new[]
                                                      {
                                                          new DataColumn(WOConstants.HEADING_SL_NO),
                                                          new DataColumn(WOConstants.HEADING_PREPAYMENTNAME),
                                                          new DataColumn(WOConstants.HEADING_PREPAYMENTVALUE),
                                                          new DataColumn(WOConstants.HEADING_RECOVERYVALUE),
                                                          new DataColumn(WOConstants.HEADING_RV_IN_RAB),
                                                          new DataColumn(WOConstants.HEADING_RABNO),
                                                          new DataColumn(WOConstants.HEADING_AMOUNT_PAID),
                                                          new DataColumn(WOConstants.HEADING_RECOVERED_AMOUNT)
                                                      });


                int i = 0;
                foreach (DataRow row in dtPrepayment.Rows)
                {
                    if (recoveryID == row[&quot;RecoveryID&quot;].ToString2())
                    {
                        i++;
                        DataRow r = dtPrepaymentType.NewRow();
                        r[WOConstants.HEADING_SL_NO] = i;
                        r[WOConstants.HEADING_PREPAYMENTNAME] = row[&quot;PrepaymentType&quot;];
                        r[WOConstants.HEADING_PREPAYMENTVALUE] =
                            (row[&quot;PrepaymentValue&quot;].ToString2() == &quot;&quot; ? &quot;0&quot; : row[&quot;PrepaymentValue&quot;]).ToDecimal2().
                                ToString(format, CultureInfo.CurrentCulture).ToDecimal2();
                        r[WOConstants.HEADING_RECOVERYVALUE] =
                            (row[&quot;RecoveryValue&quot;].ToString2() == &quot;&quot; ? &quot;0&quot; : row[&quot;RecoveryValue&quot;]).ToDecimal2().ToString(
                                format, CultureInfo.CurrentCulture).ToDecimal2();
                        r[WOConstants.HEADING_RV_IN_RAB] =
                            CalculateRecoveryValueInEachRAB(row[&quot;RecoveryValue&quot;].ToString2(),
                                                            row[&quot;PrepaymentValue&quot;].ToString2(), mode).ToDecimal2().
                                ToString(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture).ToDecimal2();
                        r[WOConstants.HEADING_RABNO] = row[&quot;RABillNumber&quot;];
                        r[WOConstants.HEADING_AMOUNT_PAID] =
                            row[WOConstants.HEADING_AMOUNT_PAID].ToDecimal2().ToString(format,
                                                                                       CultureInfo.CurrentCulture).
                                ToDecimal2();
                        r[WOConstants.HEADING_RECOVERED_AMOUNT] =
                            row[WOConstants.HEADING_RECOVERED_AMOUNT].ToDecimal2().ToString(format,
                                                                                            CultureInfo.CurrentCulture).
                                ToDecimal2();
                        dtPrepaymentType.Rows.Add(r);
                        dtPrepaymentType.AcceptChanges();
                    }
                }
                hdnRecoveryID.Value = recoveryID;
                uwgPrepaymentTypes.DataSource = dtPrepaymentType;
                uwgPrepaymentTypes.DataBind();

                FormatPrepaymentTypesGrid(mode);

                ShowDiv(ItemDivEnums.CreateWO);
            }
            else
                Page.ClientScript.RegisterStartupScript(GetType(), &quot;Prepayment&quot;,
                                                        &quot;alert(&#39;This Pre-payment Rule does not have all the pre-payment types for which the pre-payments have already been raised. Request denied.&#39;);&quot;,
                                                        true);
        }

        public void retentionRulePicker_BindData(string Filter, string SortOrder, out DataSet DsResult,
                                                 ref int CurrentPage, int PageSize, out int PageCount)
        {
            DsResult = new DataSet();

            prepaymentPicker.Currency = LocalizationManager.GetModuleCurrency(&quot;WORKORD&quot;, _WorkOrderID.ToString2());
            DataTable dtRetentionDetails = new BrixDataTable();
            if (Filter != null)
            {
                prepaymentPicker.Currency = LocalizationManager.GetModuleCurrency(&quot;WORKORD&quot;, _WorkOrderID.ToString2());
                var doc = new XmlDocument();
                doc.LoadXml(Filter);
                string prepaymentRule = ((doc).DocumentElement.SelectSingleNode(&quot;RetentionRuleName&quot;)) == null
                                            ? string.Empty
                                            : ((doc).DocumentElement.SelectSingleNode(&quot;RetentionRuleName&quot;)).InnerText.
                                                  ToString2();
                string description = ((doc).DocumentElement.SelectSingleNode(&quot;Description&quot;)) == null
                                         ? string.Empty
                                         : ((doc).DocumentElement.SelectSingleNode(&quot;Description&quot;)).InnerText.ToString2();
                try
                {
                    //Exception is thrown if the select queries returns zero rows.
                    dtRetentionDetails =
                        dtRetention.Copy().Select(&quot;RetentionRuleName like &#39;%&quot; + prepaymentRule.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) +
                                                  &quot;%&#39; and Description like &#39;%&quot; + description.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) + &quot;%&#39;&quot;).CopyToDataTable();
                }
                catch
                {
                }
            }
            else
            {
                dtRetentionDetails = dtRetention.Copy();
            }
            dtRetentionDetails.Columns.Add(&quot;RetentnValue&quot;, typeof(string));
            for (int i = 0; i &lt; dtRetentionDetails.Rows.Count; i++)
            {
                if (dtRetentionDetails.Rows[i][&quot;RetentionCeilingMode&quot;].ToString2().ToLower2() == &quot;true&quot; ||
                    dtRetentionDetails.Rows[i][&quot;RetentionCeilingMode&quot;].ToString2() == &quot;1&quot;)
                    dtRetentionDetails.Rows[i][&quot;RetentnValue&quot;] =
                        dtRetentionDetails.Rows[i][&quot;RetentionCeilingValue&quot;].ToDecimal2().ToString(
                            AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE, CultureInfo.CurrentCulture) + &quot; %&quot;;
                else
                    dtRetentionDetails.Rows[i][&quot;RetentnValue&quot;] =
                        dtRetentionDetails.Rows[i][&quot;RetentionCeilingValue&quot;].ToDecimal2().ToString(
                            AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture) + &quot; in &quot; +
                        LocalizationManager.GetModuleCurrency(Constants.MODID_CONTMGT, _ContractID.ToString2());
                dtRetentionDetails.Rows[i][&quot;RetentionPercentage&quot;] =
                    dtRetentionDetails.Rows[i][&quot;RetentionPercentage&quot;].ToDecimal2().ToString(
                        AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE, CultureInfo.CurrentCulture);
            }
            dtRetentionDetails.AcceptChanges();
            DsResult.Tables.Add(dtRetentionDetails);
            PageCount = (int)Math.Ceiling(dtRetentionDetails.Rows.Count.ToDecimal2() / PageSize);
        }

        private void retentionRulePicker_BackClicked(object sender, EventArgs e)
        {
            ShowDiv(ItemDivEnums.CreateWO);
        }

        private void retentionRulePicker_SelectedIndexChanged(object sender, ItemSelectedEventArgs e)
        {
            string mode = string.Empty;
            string retentionId = e.SelectedItems.Rows[0][&quot;RetentionID&quot;].ToString2();
            DataRow[] dtRet = dtRetention.Select(&quot;RetentionID=&quot; + retentionId);
            DataRow row = dtRet[0];

            mode = ((row[&quot;RetentionCeilingMode&quot;].ToString2().ToLower2() == &quot;false&quot; ||
                     row[&quot;RetentionCeilingMode&quot;].ToString2() == &quot;0&quot;)
                        ? WOConstants.MODE_AMOUNT
                        : WOConstants.MODE_PERCENTAGE);
            lblRetentionCeiling.Text = (mode == WOConstants.MODE_PERCENTAGE
                                            ? &quot;Retention Ceiling Percentage :&quot;
                                            : &quot;Retention Ceiling Amount in &quot; +
                                              LocalizationManager.GetModuleCurrency(Constants.MODID_CONTMGT,
                                                                                    _ContractID.ToString2()) + &quot; :&quot;);
            wneRetentionPercentage.Value = (row[&quot;RetentionPercentage&quot;].ToString2() == &quot;&quot;
                                                ? &quot;0&quot;
                                                : row[&quot;RetentionPercentage&quot;]).ToDecimal2().ToString(
                                                    AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE, CultureInfo.CurrentCulture);
            wneRetentionCeiling.Value = (row[&quot;RetentionCeilingValue&quot;].ToString2() == &quot;&quot;
                                             ? &quot;0&quot;
                                             : row[&quot;RetentionCeilingValue&quot;]).ToDecimal2().ToString(
                                                 mode == WOConstants.MODE_PERCENTAGE
                                                     ? AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE
                                                     : AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture);
            txtRetentionRule.Text = e.SelectedItems.Rows[0][&quot;RetentionRuleName&quot;].ToString2();

            hdnRetentionID.Value = retentionId;

            ShowDiv(ItemDivEnums.CreateWO);
        }

        protected void btnPrepaymentRulePicker_Click(object sender, EventArgs e)
        {
            ShowDiv(ItemDivEnums.PrepaymentPicker);
            prepaymentPicker.BindData += prepaymentRulePicker_BindData;
            prepaymentPicker.ChangeTableOrViewAndBind(&quot;Actprepayment&quot;);


        }

        protected void btnRetentionRulePicker_Click(object sender, EventArgs e)
        {
            ShowDiv(ItemDivEnums.RetentionPicker);
            retentionPicker.BindData += retentionRulePicker_BindData;
            retentionPicker.ChangeTableOrViewAndBind(&quot;Actretention&quot;);


        }

        #endregion

        #region Custom Functions

        private void FormatPrepaymentTypesGrid(string mode)
        {
            int stage = int.Parse(hdnStage.Value == &quot;&quot; ? &quot;0&quot; : hdnStage.Value);
            //stage 1 - Draft; 2 - Approve; 3 - Issued.

            ColumnsCollection cols = uwgPrepaymentTypes.Columns;
            uwgPrepaymentTypes.Width = 500;

            if (cols.Exists(WOConstants.HEADING_SL_NO))
                cols.FromKey(WOConstants.HEADING_SL_NO).Width = 40;

            if (cols.Exists(WOConstants.HEADING_PREPAYMENTVALUE))
            {
                cols.FromKey(WOConstants.HEADING_PREPAYMENTVALUE).Header.Caption = (mode == WOConstants.MODE_AMOUNT
                                                                                        ? &quot;Pre-payment Amount&quot;
                                                                                        : &quot;Pre-payment Percentage&quot;);
                cols.FromKey(WOConstants.HEADING_PREPAYMENTVALUE).Width = 125;
                cols.FromKey(WOConstants.HEADING_PREPAYMENTVALUE).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(WOConstants.HEADING_PREPAYMENTVALUE).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(WOConstants.HEADING_PREPAYMENTVALUE).Header.Caption =
                    cols.FromKey(WOConstants.HEADING_PREPAYMENTVALUE).Header.Caption + &quot; &quot; +
                    (mode == WOConstants.MODE_PERCENTAGE
                         ? &quot;&quot;
                         : &quot; in &quot; +
                           LocalizationManager.GetModuleCurrency(Constants.MODID_CONTMGT, _ContractID.ToString2()));

                if (stage &lt; 2 || isVersion)
                {
                    cols.FromKey(WOConstants.HEADING_PREPAYMENTVALUE).AllowUpdate = editRecoveryDetails
                                                                                        ? AllowUpdate.Yes
                                                                                        : AllowUpdate.No;
                    cols.FromKey(WOConstants.HEADING_PREPAYMENTVALUE).CellStyle.BackColor = editRecoveryDetails
                                                                                                ? Color.Yellow
                                                                                                : Color.Transparent;
                }
            }
            if (cols.Exists(WOConstants.HEADING_RECOVERYVALUE))
            {
                cols.FromKey(WOConstants.HEADING_RECOVERYVALUE).Header.Caption = (mode == WOConstants.MODE_AMOUNT
                                                                                      ? &quot;Recovery Amount&quot;
                                                                                      : &quot;Recovery Percentage&quot;);
                cols.FromKey(WOConstants.HEADING_RECOVERYVALUE).Width = 125;
                cols.FromKey(WOConstants.HEADING_RECOVERYVALUE).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(WOConstants.HEADING_RECOVERYVALUE).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(WOConstants.HEADING_RECOVERYVALUE).Header.Caption =
                    cols.FromKey(WOConstants.HEADING_RECOVERYVALUE).Header.Caption + &quot; &quot; +
                    (mode == WOConstants.MODE_PERCENTAGE
                         ? &quot;&quot;
                         : &quot; in &quot; +
                           LocalizationManager.GetModuleCurrency(Constants.MODID_CONTMGT, _ContractID.ToString2()));

                if (stage &lt; 2 || isVersion)
                {
                    cols.FromKey(WOConstants.HEADING_RECOVERYVALUE).AllowUpdate = editRecoveryDetails
                                                                                      ? AllowUpdate.Yes
                                                                                      : AllowUpdate.No;
                    cols.FromKey(WOConstants.HEADING_RECOVERYVALUE).CellStyle.BackColor = editRecoveryDetails
                                                                                              ? Color.Yellow
                                                                                              : Color.Transparent;
                }
            }
            if (cols.Exists(WOConstants.HEADING_RABNO))
            {
                cols.FromKey(WOConstants.HEADING_RABNO).Header.Caption = &quot;From RA Bill&quot;;
                cols.FromKey(WOConstants.HEADING_RABNO).Width = 100;
                if (stage &lt; 2 || isVersion)
                {
                    cols.FromKey(WOConstants.HEADING_RABNO).AllowUpdate = editRecoveryDetails
                                                                              ? AllowUpdate.Yes
                                                                              : AllowUpdate.No;
                    cols.FromKey(WOConstants.HEADING_RABNO).CellStyle.BackColor = editRecoveryDetails
                                                                                      ? Color.Yellow
                                                                                      : Color.Transparent;
                }
            }
            if (cols.Exists(WOConstants.HEADING_RV_IN_RAB))
            {
                cols.FromKey(WOConstants.HEADING_RV_IN_RAB).Width = 125;
                cols.FromKey(WOConstants.HEADING_RV_IN_RAB).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(WOConstants.HEADING_RV_IN_RAB).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(WOConstants.HEADING_RV_IN_RAB).Header.Caption =
                    cols.FromKey(WOConstants.HEADING_RV_IN_RAB).Header.Caption + &quot; &quot; + &quot; in &quot; +
                    LocalizationManager.GetModuleCurrency(Constants.MODID_CONTMGT, _ContractID.ToString2());
            }

            if (cols.Exists(WOConstants.HEADING_AMOUNT_PAID))
            {
                cols.FromKey(WOConstants.HEADING_AMOUNT_PAID).Width = 100;
                cols.FromKey(WOConstants.HEADING_AMOUNT_PAID).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(WOConstants.HEADING_AMOUNT_PAID).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(WOConstants.HEADING_AMOUNT_PAID).Header.Caption =
                    cols.FromKey(WOConstants.HEADING_AMOUNT_PAID).Header.Caption + &quot; &quot; + &quot; in &quot; +
                    LocalizationManager.GetModuleCurrency(Constants.MODID_CONTMGT, _ContractID.ToString2());
            }

            if (cols.Exists(WOConstants.HEADING_RECOVERED_AMOUNT))
            {
                cols.FromKey(WOConstants.HEADING_RECOVERED_AMOUNT).Width = 100;
                cols.FromKey(WOConstants.HEADING_RECOVERED_AMOUNT).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(WOConstants.HEADING_RECOVERED_AMOUNT).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(WOConstants.HEADING_RECOVERED_AMOUNT).Header.Caption =
                    cols.FromKey(WOConstants.HEADING_RECOVERED_AMOUNT).Header.Caption + &quot; &quot; + &quot; in &quot; +
                    LocalizationManager.GetModuleCurrency(Constants.MODID_CONTMGT, _ContractID.ToString2());
            }


            if (cols.Exists(&quot;PrepaymentTypeID&quot;))
            {
                cols.FromKey(&quot;PrepaymentTypeID&quot;).Hidden = true;
                if (cols.Exists(WOConstants.HEADING_RV_IN_RAB))
                    cols.FromKey(WOConstants.HEADING_RV_IN_RAB).Move(5);
            }
            else if (cols.Exists(WOConstants.HEADING_RV_IN_RAB))
                cols.FromKey(WOConstants.HEADING_RV_IN_RAB).Move(4);

            if (cols.Exists(&quot;PrepaymentType&quot;))
            {
                cols.FromKey(&quot;PrepaymentType&quot;).Header.Caption = WOConstants.HEADING_PREPAYMENTNAME;
                cols.FromKey(&quot;PrepaymentType&quot;).Width = 125;
            }

            if (cols.Exists(WOConstants.HEADING_PREPAYMENTNAME))
            {
                cols.FromKey(WOConstants.HEADING_PREPAYMENTNAME).Header.Caption = WOConstants.HEADING_PREPAYMENTNAME;
                cols.FromKey(WOConstants.HEADING_PREPAYMENTNAME).Width = 125;
            }

            if (mode == WOConstants.MODE_PERCENTAGE)
            {
                //Percentage Based Prepayment rule
                if (cols.Exists(WOConstants.HEADING_RV_IN_RAB))
                {
                    cols.FromKey(WOConstants.HEADING_RV_IN_RAB).Hidden = false;
                    cols.FromKey(WOConstants.HEADING_RV_IN_RAB).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                }

                if (cols.Exists(WOConstants.HEADING_PREPAYMENTVALUE))
                    cols.FromKey(WOConstants.HEADING_PREPAYMENTVALUE).Format = AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE;

                if (cols.Exists(WOConstants.HEADING_RECOVERYVALUE))
                    cols.FromKey(WOConstants.HEADING_RECOVERYVALUE).Format = AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE;
            }
            else if (mode == WOConstants.MODE_AMOUNT)
            {
                //Amount Based Prepayment rule
                if (cols.Exists(WOConstants.HEADING_RV_IN_RAB))
                    cols.FromKey(WOConstants.HEADING_RV_IN_RAB).Hidden = true;

                if (cols.Exists(WOConstants.HEADING_PREPAYMENTVALUE))
                    cols.FromKey(WOConstants.HEADING_PREPAYMENTVALUE).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;

                if (cols.Exists(WOConstants.HEADING_RECOVERYVALUE))
                    cols.FromKey(WOConstants.HEADING_RECOVERYVALUE).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
            }
            uwgPrepaymentTypes.DisplayLayout.AllowSortingDefault = AllowSorting.OnClient;

            #region Enabling or disabling controls based on permission

            if (editRecoveryDetails)
            {
                if (mode == WOConstants.MODE_AMOUNT)
                {
                    if (mode == WOConstants.MODE_AMOUNT) wneMaxAmount.Enabled = true;
                    wneMaxPercentage.Enabled = false;
                }
                else if (mode == WOConstants.MODE_PERCENTAGE)
                {
                    if (mode == WOConstants.MODE_PERCENTAGE) wneMaxPercentage.Enabled = true;
                    wneMaxAmount.Enabled = false;
                }
            }
            else
            {
                wneMaxPercentage.Enabled = false;
                wneMaxAmount.Enabled = false;
            }

            if (editRetentionDetails)
            {
                if (txtRetentionRule.Text != string.Empty) wneRetentionPercentage.Enabled = true;
                if (txtRetentionRule.Text != string.Empty) wneRetentionCeiling.Enabled = true;
            }
            else
            {
                wneRetentionCeiling.Enabled = false;
                wneRetentionPercentage.Enabled = false;
            }

            #endregion
        }

        private decimal CalculateRecoveryValueInEachRAB(string RecoveryValue, string prepaymentValue, string mode)
        {
            string woAmt = hdnTotalAmt.Value;
            decimal rabRecoveryValue = 0;

            if (mode == WOConstants.MODE_PERCENTAGE)
            {
                decimal prepaymentAmt = decimal.Parse(prepaymentValue) / 100 * decimal.Parse(woAmt);
                rabRecoveryValue = (decimal.Parse(RecoveryValue) / 100 * prepaymentAmt);
            }
            return rabRecoveryValue;
        }

        private void PopulateDataTables()
        {
            string moduleId = isVersion ? &quot;WORKVER&quot; : Constants.MODID_CONTMGT;
            int instanceId = isVersion ? _WorkOrderID : _ContractID;
            DataSet dsPrepaymentRecovery = WOManager.Instance.GetPrepaymentRecoveryRules(moduleId, instanceId);
            try
            {
                dtRecovery = dsPrepaymentRecovery.Tables[0].Select(&quot;isActive=1&quot;).CopyToDataTable();
            }
            catch
            {
                dtRecovery = new BrixDataTable();
            }
            ;
            try
            {
                dtPrepayment = dsPrepaymentRecovery.Tables[1];
            }
            catch
            {
                dtPrepayment = new BrixDataTable();
            }
            ;
            try
            {
                dtRetention =
                    WOManager.Instance.GetRetentionRules(Constants.MODID_CONTMGT, _ContractID).Tables[0].Select(
                        &quot;isActive=1&quot;).CopyToDataTable();
            }
            catch
            {
                dtRetention = new BrixDataTable();
            }
            ;
        }

        private void CalculateAmountOrPercentage(string mode)
        {
            try
            {
                if (uwgActivities.Rows.Count &gt; 0 &amp;&amp; txtPrepaymentRule.Text != &quot;&quot;)
                {
                    if (mode == WOConstants.MODE_PERCENTAGE)
                        wneMaxAmount.Value =
                            (wneMaxPercentage.ValueDecimal / 100 * decimal.Parse(hdnTotalAmt.Value)).ToDecimal2().ToString(
                                AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE, CultureInfo.CurrentCulture);
                    else
                        wneMaxPercentage.Value =
                            (wneMaxAmount.ValueDecimal / decimal.Parse(hdnTotalAmt.Value) * 100).ToDecimal2().ToString(
                                AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture);
                }
            }
            catch
            {
            }
        }

        private void HideShowTB(string mode)
        {
            if (uwgActivities.Rows.Count == 0)
                mode = (mode == &quot;&quot; ? WOConstants.MODE_NEITHER : mode);
            else
                mode = WOConstants.MODE_NEITHER;

            ScriptManager.RegisterStartupScript(this, typeof(Page), &quot;HideShow&quot;, &quot;HideShowTB(&#39;&quot; + UIHelper.JavascriptEncode(mode) + &quot;&#39;);&quot;, true);
        }

        private BrixFilter[] GetRetentionFilters()
        {
            var filters = new BrixFilter[2];

            filters[0] = new BrixFilter();
            filters[0].Title = &quot;Retention Rule Name :&quot;;
            filters[0].Name = &quot;RetentionRuleName&quot;;
            filters[0].FilterType = BrixFilter.Type.Text;

            filters[1] = new BrixFilter();
            filters[1].Title = &quot;Description :&quot;;
            filters[1].Name = &quot;Description&quot;;
            filters[1].FilterType = BrixFilter.Type.Text;

            return filters;
        }

        private BrixFilter[] GetPrepaymentFilters()
        {
            var filters = new BrixFilter[2];

            filters[0] = new BrixFilter();
            filters[0].Title = &quot;Pre-payment Rule Name :&quot;;
            filters[0].Name = &quot;PrepaymentRuleName&quot;;
            filters[0].FilterType = BrixFilter.Type.Text;

            filters[1] = new BrixFilter();
            filters[1].Title = &quot;Description :&quot;;
            filters[1].Name = &quot;Description&quot;;
            filters[1].FilterType = BrixFilter.Type.Text;

            return filters;
        }

        #endregion

        #endregion
    }

    [Serializable]
    internal class DeletedActivityItems
    {
        public string ActivityName;
        public int ItemID;
        public Decimal Quantity;
        public int? SubItemID;
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[53,9,53,105,0],[56,9,56,43,0],[63,9,63,49,0],[64,9,64,50,0],[80,17,80,18,0],[80,19,80,95,0],[80,96,80,97,0],[88,17,88,18,0],[88,19,88,77,0],[88,78,88,79,0],[94,13,94,14,0],[95,17,97,116,0],[98,13,98,14,0],[104,13,104,14,0],[105,17,107,36,0],[108,13,108,14,0],[114,13,114,14,0],[115,17,115,63,0],[116,21,116,61,0],[118,21,118,92,0],[119,13,119,14,0],[120,17,120,18,0],[120,19,120,61,0],[120,62,120,63,0],[126,13,126,14,0],[127,17,127,29,0],[128,17,131,64,0],[132,17,132,18,0],[133,21,135,92,0],[136,17,136,18,0],[138,17,138,18,0],[139,21,139,59,0],[140,17,140,18,0],[141,17,141,38,0],[142,13,142,14,0],[145,37,145,38,0],[145,39,145,127,0],[145,128,145,129,0],[149,17,149,18,0],[149,19,149,36,0],[149,37,149,38,0],[154,17,154,18,0],[154,19,154,39,0],[154,40,154,41,0],[159,17,159,18,0],[159,19,159,31,0],[159,32,159,33,0],[164,17,164,18,0],[164,19,164,65,0],[164,66,164,67,0],[170,13,170,14,0],[171,17,173,98,0],[174,17,174,27,0],[175,13,175,14,0],[181,13,181,14,0],[182,17,184,98,0],[185,13,185,14,0],[191,17,191,18,0],[191,19,191,60,0],[191,61,191,62,0],[192,17,192,18,0],[192,19,192,61,0],[192,62,192,63,0],[196,9,196,10,0],[197,13,211,26,0],[212,9,212,10,0],[215,9,215,10,0],[216,13,227,26,0],[228,9,228,10,0],[234,9,234,10,0],[236,13,237,108,0],[257,13,257,71,0],[259,13,259,68,0],[260,13,260,70,0],[261,13,261,71,0],[262,13,262,69,0],[263,13,263,60,0],[264,13,264,76,0],[265,13,265,45,0],[267,13,267,43,0],[268,13,268,50,0],[269,13,269,46,0],[270,13,270,58,0],[277,13,277,45,0],[278,13,278,55,0],[279,13,279,72,0],[281,13,285,39,0],[287,13,287,20,0],[287,22,287,32,0],[287,33,287,35,0],[287,36,287,49,0],[288,17,288,90,0],[290,13,290,138,0],[292,13,292,105,0],[293,13,294,99,0],[295,13,295,115,0],[296,13,297,81,0],[299,13,299,79,0],[300,13,300,71,0],[301,13,301,91,0],[307,13,307,84,0],[308,13,308,106,0],[309,13,309,81,0],[315,13,315,84,0],[316,13,316,106,0],[317,13,317,81,0],[323,13,323,77,0],[324,13,324,49,0],[325,13,325,51,0],[326,13,326,78,0],[327,13,327,88,0],[328,13,328,72,0],[329,13,329,85,0],[330,13,330,65,0],[331,13,331,63,0],[333,13,333,98,0],[334,13,334,96,0],[335,13,335,104,0],[336,13,336,102,0],[337,13,337,93,0],[338,13,338,96,0],[339,13,339,120,0],[341,13,342,73,0],[343,13,343,117,0],[349,13,349,75,0],[350,13,350,48,0],[351,13,351,50,0],[352,13,352,76,0],[353,13,353,86,0],[354,13,354,70,0],[355,13,355,84,0],[356,13,356,63,0],[357,13,357,61,0],[359,13,359,98,0],[360,13,360,95,0],[361,13,361,103,0],[362,13,362,107,0],[363,13,363,108,0],[364,13,364,92,0],[365,13,365,95,0],[367,13,368,75,0],[369,13,370,76,0],[371,13,372,79,0],[376,13,376,138,0],[378,13,378,28,0],[379,9,379,10,0],[382,9,382,10,0],[383,13,383,40,0],[384,13,384,47,0],[385,13,385,14,0],[386,17,386,49,0],[387,13,387,14,0],[388,13,388,56,0],[389,13,389,14,0],[391,17,391,18,0],[392,21,393,133,0],[394,21,394,46,0],[395,21,398,64,0],[399,17,399,18,0],[400,17,400,22,0],[401,17,401,18,0],[402,21,402,53,0],[403,17,403,18,0],[404,13,404,14,0],[405,13,405,30,0],[406,9,406,10,0],[409,9,409,10,0],[410,13,410,52,0],[411,13,411,14,0],[412,17,415,74,0],[416,13,416,14,0],[417,13,417,55,0],[418,13,418,14,0],[419,17,419,45,0],[420,13,420,14,0],[421,13,421,56,0],[422,13,422,14,0],[423,17,423,46,0],[424,13,424,14,0],[425,13,425,34,0],[426,13,426,35,0],[427,13,427,60,0],[428,13,428,49,0],[429,13,430,72,0],[431,17,432,119,0],[433,13,433,87,0],[434,13,434,85,0],[435,13,435,30,0],[436,13,436,37,0],[437,13,437,90,0],[438,13,438,32,0],[439,17,439,93,0],[441,13,441,108,0],[443,13,443,34,0],[444,13,444,29,0],[445,13,445,14,0],[446,17,446,96,0],[447,17,447,62,0],[448,17,448,18,0],[449,21,449,106,0],[450,21,450,110,0],[451,17,451,18,0],[452,17,452,45,0],[453,17,453,18,0],[454,21,454,100,0],[455,21,455,104,0],[456,21,456,94,0],[457,17,457,18,0],[458,17,460,75,0],[461,17,461,79,0],[462,17,462,81,0],[463,17,463,80,0],[464,17,464,81,0],[466,17,466,35,0],[467,17,467,18,0],[468,21,468,37,0],[469,21,469,47,0],[470,21,470,74,0],[471,21,471,65,0],[472,21,472,104,0],[473,21,473,104,0],[474,21,474,93,0],[475,21,475,125,0],[476,17,476,18,0],[478,17,478,18,0],[479,21,479,52,0],[480,21,480,95,0],[481,21,481,91,0],[482,21,482,108,0],[483,21,483,66,0],[484,17,484,18,0],[486,17,486,61,0],[487,17,487,18,0],[488,21,488,72,0],[489,21,489,36,0],[490,21,490,22,0],[491,25,491,77,0],[492,21,492,22,0],[493,17,493,18,0],[494,17,494,58,0],[495,17,495,101,0],[496,17,496,18,0],[497,21,497,64,0],[498,21,500,113,0],[501,17,501,18,0],[502,17,502,65,0],[503,13,503,14,0],[513,13,513,55,0],[514,13,514,27,0],[515,13,515,14,0],[516,17,516,53,0],[517,17,517,54,0],[518,17,518,54,0],[522,13,522,14,0],[523,13,524,117,0],[525,13,525,14,0],[526,17,526,82,0],[527,17,527,101,0],[528,17,528,74,0],[529,13,529,14,0],[530,13,530,57,0],[531,13,531,14,0],[532,17,534,46,0],[537,13,537,14,0],[539,13,539,29,0],[540,13,540,14,0],[541,17,541,42,0],[542,17,542,65,0],[543,21,545,83,0],[546,13,546,14,0],[547,13,547,120,0],[549,13,549,38,0],[550,13,550,14,0],[551,17,553,105,0],[554,13,554,14,0],[556,13,556,51,0],[557,13,557,14,0],[558,17,558,55,0],[559,13,559,14,0],[561,13,561,50,0],[562,13,562,14,0],[563,17,563,53,0],[564,13,564,14,0],[566,13,566,73,0],[567,17,567,62,0],[568,18,568,52,0],[569,17,569,61,0],[571,9,571,10,0],[574,9,574,10,0],[575,13,575,87,0],[576,13,576,31,0],[577,13,577,14,0],[578,17,582,137,0],[583,17,583,24,0],[586,13,586,46,0],[587,13,587,55,0],[588,13,588,51,0],[589,13,589,55,0],[590,13,590,53,0],[591,13,591,49,0],[592,13,592,58,0],[593,13,593,62,0],[594,13,594,50,0],[595,13,595,51,0],[596,13,596,46,0],[597,13,597,41,0],[598,13,598,47,0],[599,13,599,58,0],[600,13,600,54,0],[601,13,601,60,0],[602,13,602,49,0],[603,13,603,45,0],[604,13,604,54,0],[605,13,605,50,0],[608,13,608,55,0],[610,13,610,66,0],[611,13,611,31,0],[612,13,612,39,0],[613,13,613,33,0],[615,13,616,107,0],[617,13,617,69,0],[621,13,621,112,0],[626,13,626,40,0],[627,13,627,96,0],[628,13,628,14,0],[631,17,631,61,0],[632,17,635,60,0],[636,17,639,135,0],[640,17,644,131,0],[646,17,646,78,0],[648,17,648,69,0],[654,17,654,59,0],[655,17,655,68,0],[656,17,658,88,0],[659,17,659,24,0],[659,26,659,36,0],[659,37,659,39,0],[659,40,659,52,0],[660,17,660,18,0],[661,21,664,137,0],[665,21,665,22,0],[666,21,668,42,0],[669,21,672,42,0],[673,17,673,18,0],[674,17,674,41,0],[675,17,675,57,0],[676,17,676,47,0],[678,17,678,49,0],[680,17,680,51,0],[682,17,682,34,0],[685,13,685,14,0],[686,13,686,55,0],[687,13,687,14,0],[690,17,690,62,0],[691,17,694,60,0],[695,17,699,122,0],[700,17,702,114,0],[703,17,707,57,0],[709,17,709,79,0],[711,17,711,72,0],[714,13,714,14,0],[718,13,718,113,0],[719,13,719,14,0],[720,17,720,59,0],[721,17,721,142,0],[722,17,722,44,0],[723,17,724,60,0],[725,17,725,117,0],[726,17,726,18,0],[727,21,727,47,0],[728,21,728,60,0],[729,21,729,143,0],[730,17,730,18,0],[732,17,732,18,0],[733,21,733,48,0],[734,17,734,18,0],[735,17,735,32,0],[736,17,736,18,0],[737,21,740,64,0],[741,17,741,18,0],[743,17,743,18,0],[744,21,745,63,0],[746,17,746,18,0],[747,13,747,14,0],[749,13,749,14,0],[750,17,750,46,0],[751,17,751,44,0],[752,13,752,14,0],[754,13,754,27,0],[755,13,755,14,0],[756,17,756,41,0],[757,17,757,42,0],[758,13,758,14,0],[760,17,760,41,0],[762,13,763,69,0],[764,13,764,14,0],[765,17,765,53,0],[766,17,766,54,0],[767,17,767,54,0],[773,17,773,58,0],[774,13,774,14,0],[775,9,775,10,0],[778,9,778,10,0],[779,13,779,60,0],[780,13,780,38,0],[781,13,781,42,0],[789,13,789,103,0],[790,17,791,111,0],[793,17,793,114,0],[796,13,796,31,0],[797,13,799,50,0],[801,13,803,44,0],[804,9,804,10,0],[807,9,807,10,0],[808,13,810,107,0],[811,13,811,14,0],[812,17,812,31,0],[813,17,813,35,0],[814,17,814,53,0],[815,17,818,110,0],[819,17,819,60,0],[820,17,820,18,0],[821,21,822,224,0],[823,17,823,18,0],[825,21,825,76,0],[828,17,828,81,0],[829,17,829,89,0],[830,17,830,93,0],[831,17,831,77,0],[832,17,832,66,0],[834,17,837,102,0],[839,17,839,112,0],[840,17,840,18,0],[841,21,841,67,0],[842,25,842,45,0],[844,25,844,37,0],[846,17,846,37,0],[848,13,848,25,0],[849,9,849,10,0],[852,9,852,10,0],[853,13,853,99,0],[854,13,854,56,0],[855,13,855,54,0],[856,13,856,60,0],[857,13,857,39,0],[858,13,858,71,0],[859,13,859,48,0],[861,13,861,54,0],[862,9,862,10,0],[865,9,865,10,0],[866,13,866,84,0],[867,13,867,78,0],[868,13,868,59,0],[869,13,869,43,0],[870,17,870,58,0],[871,13,871,44,0],[872,17,872,59,0],[873,13,873,44,0],[874,17,874,59,0],[875,13,875,39,0],[876,17,876,54,0],[877,13,877,39,0],[878,17,878,54,0],[879,13,879,38,0],[880,17,880,53,0],[881,13,881,39,0],[882,17,882,54,0],[883,13,883,45,0],[884,17,884,79,0],[885,13,885,41,0],[886,13,886,14,0],[887,17,887,92,0],[888,17,888,100,0],[889,17,889,95,0],[890,17,890,92,0],[891,17,891,84,0],[892,17,892,87,0],[893,13,893,14,0],[894,13,894,39,0],[895,13,895,14,0],[896,17,896,54,0],[897,17,897,96,0],[898,17,898,93,0],[899,17,899,90,0],[900,17,900,82,0],[901,17,901,85,0],[902,13,902,14,0],[903,13,903,49,0],[904,17,904,64,0],[905,13,905,41,0],[906,17,906,56,0],[907,13,907,37,0],[908,13,908,14,0],[909,17,909,62,0],[910,17,910,98,0],[911,17,911,68,0],[912,17,912,73,0],[913,17,913,52,0],[914,17,914,91,0],[915,17,915,88,0],[916,17,916,80,0],[917,17,917,83,0],[918,13,918,14,0],[919,9,919,10,0],[922,9,922,10,0],[923,13,923,95,0],[924,13,924,60,0],[925,13,925,20,0],[925,22,925,41,0],[925,42,925,44,0],[925,45,925,49,0],[926,17,926,37,0],[927,21,927,37,0],[928,13,928,49,0],[929,13,929,14,0],[930,17,930,103,0],[931,17,931,110,0],[932,13,932,14,0],[933,13,933,41,0],[934,13,934,14,0],[935,17,935,56,0],[936,17,936,102,0],[937,17,937,88,0],[938,13,938,14,0],[939,13,939,31,0],[940,13,940,14,0],[941,17,943,73,0],[944,17,944,18,0],[945,21,946,79,0],[946,79,946,80,0],[946,80,947,83,0],[947,83,947,102,0],[947,102,948,83,0],[948,83,948,84,0],[948,84,949,87,0],[949,87,949,118,0],[949,118,950,87,0],[950,87,951,107,0],[951,107,952,87,0],[952,87,953,116,0],[953,116,954,83,0],[954,83,954,84,0],[954,84,955,79,0],[955,79,955,80,0],[955,80,955,82,0],[945,21,955,82,0],[956,17,956,18,0],[957,22,957,66,0],[958,17,958,18,0],[959,21,959,51,0],[960,21,960,22,0],[961,25,961,72,0],[962,25,962,26,0],[963,29,963,86,0],[964,29,964,91,0],[965,25,965,26,0],[966,21,966,22,0],[967,17,967,18,0],[968,17,968,88,0],[969,17,969,18,0],[970,21,970,78,0],[971,21,971,83,0],[972,17,972,18,0],[973,17,973,62,0],[974,17,974,18,0],[975,21,987,41,0],[987,41,987,42,0],[987,42,988,45,0],[988,45,988,64,0],[988,64,989,49,0],[989,49,989,94,0],[989,94,990,41,0],[990,41,990,42,0],[990,42,990,44,0],[975,21,990,44,0],[991,17,991,18,0],[992,13,992,14,0],[993,18,993,36,0],[994,13,994,14,0],[995,17,995,47,0],[996,17,996,18,0],[997,21,997,78,0],[998,21,998,83,0],[999,17,999,18,0],[1000,13,1000,14,0],[1001,13,1001,45,0],[1002,13,1002,14,0],[1003,17,1003,74,0],[1006,13,1006,14,0],[1007,13,1007,40,0],[1008,17,1008,69,0],[1009,13,1009,41,0],[1010,13,1010,14,0],[1011,17,1011,80,0],[1012,17,1012,100,0],[1013,13,1013,14,0],[1014,13,1014,43,0],[1015,13,1015,14,0],[1016,17,1016,72,0],[1017,17,1017,102,0],[1018,13,1018,14,0],[1019,13,1019,39,0],[1020,17,1020,96,0],[1021,13,1022,101,0],[1022,101,1022,102,0],[1022,102,1023,105,0],[1023,105,1025,116,0],[1025,116,1026,105,0],[1026,105,1026,106,0],[1026,106,1027,109,0],[1027,109,1042,123,0],[1042,123,1043,109,0],[1043,109,1060,125,0],[1060,125,1061,105,0],[1061,105,1061,106,0],[1061,106,1062,101,0],[1062,101,1062,102,0],[1062,102,1062,104,0],[1021,13,1062,104,0],[1063,13,1078,34,0],[1078,34,1078,35,0],[1078,35,1078,36,0],[1078,36,1078,55,0],[1078,55,1078,56,0],[1078,56,1078,86,0],[1078,86,1078,87,0],[1078,87,1078,88,0],[1078,88,1078,90,0],[1063,13,1078,90,0],[1079,13,1079,33,0],[1079,33,1079,34,0],[1079,34,1079,35,0],[1079,35,1079,54,0],[1079,54,1079,55,0],[1079,55,1079,85,0],[1079,85,1079,86,0],[1079,86,1079,87,0],[1079,87,1079,89,0],[1079,13,1079,89,0],[1090,13,1090,45,0],[1090,46,1090,89,0],[1091,13,1091,44,0],[1091,45,1091,87,0],[1092,13,1092,28,0],[1093,13,1093,14,0],[1094,17,1094,67,0],[1095,21,1095,82,0],[1096,17,1096,51,0],[1096,52,1096,97,0],[1097,17,1097,54,0],[1097,55,1097,103,0],[1098,13,1098,14,0],[1100,13,1100,14,0],[1101,17,1101,67,0],[1102,21,1102,126,0],[1103,17,1103,51,0],[1104,17,1104,18,0],[1105,21,1105,110,0],[1106,21,1106,93,0],[1107,17,1107,18,0],[1108,17,1108,54,0],[1109,17,1109,18,0],[1110,21,1110,113,0],[1111,21,1111,99,0],[1112,17,1112,18,0],[1113,17,1122,37,0],[1122,37,1122,38,0],[1122,38,1123,41,0],[1123,41,1123,60,0],[1123,60,1124,45,0],[1124,45,1124,90,0],[1124,90,1125,37,0],[1125,37,1125,38,0],[1125,38,1125,40,0],[1113,17,1125,40,0],[1126,13,1126,14,0],[1127,13,1127,53,0],[1128,13,1128,14,0],[1129,17,1129,100,0],[1130,17,1130,66,0],[1131,13,1131,14,0],[1133,13,1133,46,0],[1134,13,1134,14,0],[1135,17,1135,59,0],[1136,13,1136,14,0],[1137,13,1137,52,0],[1138,9,1138,10,0],[1141,9,1141,10,0],[1142,13,1142,68,0],[1143,13,1179,48,0],[1180,13,1180,31,0],[1181,9,1181,10,0],[1184,9,1184,10,0],[1185,13,1185,64,0],[1186,13,1198,49,0],[1199,13,1199,32,0],[1200,9,1200,10,0],[1203,9,1203,10,0],[1204,13,1204,46,0],[1205,13,1205,70,0],[1206,13,1206,77,0],[1207,9,1207,10,0],[1210,9,1210,10,0],[1245,9,1245,10,0],[1248,9,1248,10,0],[1249,13,1249,54,0],[1251,13,1251,20,0],[1251,22,1251,32,0],[1251,33,1251,35,0],[1251,36,1251,56,0],[1252,13,1252,14,0],[1253,17,1253,37,0],[1254,22,1254,31,0],[1254,33,1254,47,0],[1254,49,1254,52,0],[1255,17,1255,18,0],[1256,21,1258,112,0],[1259,25,1259,39,0],[1260,17,1260,18,0],[1261,17,1261,29,0],[1262,17,1262,18,0],[1263,21,1263,46,0],[1265,21,1265,89,0],[1266,21,1266,63,0],[1267,21,1267,73,0],[1268,21,1269,87,0],[1270,21,1270,98,0],[1271,21,1271,70,0],[1272,21,1272,70,0],[1273,21,1273,86,0],[1274,21,1274,80,0],[1275,21,1275,66,0],[1276,21,1276,62,0],[1277,21,1277,22,0],[1278,25,1278,90,0],[1279,25,1279,26,0],[1281,29,1281,30,0],[1282,33,1284,46,0],[1285,29,1285,30,0],[1286,29,1286,46,0],[1287,29,1287,30,0],[1288,33,1288,83,0],[1289,29,1289,30,0],[1290,25,1290,26,0],[1292,29,1292,79,0],[1293,21,1293,22,0],[1294,21,1294,65,0],[1295,21,1295,61,0],[1296,21,1300,107,0],[1301,21,1301,72,0],[1302,21,1302,76,0],[1303,21,1303,70,0],[1304,21,1304,66,0],[1304,67,1304,155,0],[1306,21,1306,119,0],[1307,21,1307,62,0],[1308,21,1308,22,0],[1309,25,1312,52,0],[1313,25,1316,48,0],[1317,21,1317,22,0],[1318,17,1318,18,0],[1319,13,1319,14,0],[1321,13,1321,44,0],[1322,13,1322,56,0],[1324,9,1324,10,0],[1327,9,1327,10,0],[1328,13,1329,39,0],[1329,39,1329,119,0],[1329,119,1329,121,0],[1328,13,1329,121,0],[1330,17,1330,26,0],[1332,17,1333,40,0],[1333,40,1333,120,0],[1333,120,1334,35,0],[1332,17,1334,35,0],[1335,9,1335,10,0],[1338,9,1338,10,0],[1339,13,1339,35,0],[1340,9,1340,10,0],[1343,9,1343,10,0],[1344,13,1344,103,0],[1345,13,1345,14,0],[1346,17,1346,31,0],[1347,17,1347,35,0],[1348,17,1348,53,0],[1349,17,1349,44,0],[1350,17,1350,103,0],[1351,17,1351,73,0],[1352,17,1352,44,0],[1353,17,1353,24,0],[1353,26,1353,36,0],[1353,37,1353,39,0],[1353,40,1353,59,0],[1354,21,1354,64,0],[1355,17,1355,91,0],[1356,17,1359,110,0],[1360,17,1360,60,0],[1361,17,1361,18,0],[1362,21,1363,224,0],[1364,17,1364,18,0],[1366,21,1366,76,0],[1369,17,1369,94,0],[1370,17,1370,81,0],[1371,17,1371,89,0],[1372,17,1372,72,0],[1373,17,1373,72,0],[1374,21,1374,65,0],[1376,21,1376,88,0],[1378,17,1378,71,0],[1379,21,1379,64,0],[1381,21,1381,86,0],[1383,17,1383,77,0],[1384,21,1384,70,0],[1387,21,1387,98,0],[1389,17,1389,93,0],[1390,17,1390,77,0],[1392,17,1392,66,0],[1394,17,1395,107,0],[1397,17,1397,112,0],[1398,17,1398,18,0],[1399,21,1399,91,0],[1400,21,1400,22,0],[1401,25,1401,32,0],[1401,34,1401,45,0],[1401,46,1401,48,0],[1401,49,1401,66,0],[1402,25,1402,26,0],[1403,29,1403,76,0],[1404,29,1404,30,0],[1405,33,1405,80,0],[1406,33,1406,115,0],[1407,33,1407,72,0],[1408,29,1408,30,0],[1409,25,1409,26,0],[1410,21,1410,22,0],[1411,21,1411,62,0],[1412,21,1412,22,0],[1413,25,1413,69,0],[1414,25,1414,60,0],[1415,25,1415,69,0],[1416,25,1416,69,0],[1417,21,1417,22,0],[1418,21,1418,70,0],[1419,21,1419,62,0],[1420,21,1420,68,0],[1421,21,1421,47,0],[1422,17,1422,18,0],[1423,13,1423,14,0],[1424,13,1424,62,0],[1425,9,1425,10,0],[1428,9,1428,10,0],[1464,9,1464,10,0],[1569,9,1569,10,0],[1570,13,1570,109,0],[1571,13,1571,58,0],[1572,9,1572,10,0],[1575,9,1575,10,0],[1576,9,1576,10,0],[1579,9,1579,10,0],[1580,13,1580,94,0],[1581,13,1581,52,0],[1582,9,1582,10,0],[1585,9,1585,10,0],[1586,13,1586,44,0],[1587,13,1587,56,0],[1589,9,1589,10,0],[1592,9,1592,10,0],[1593,13,1593,68,0],[1594,13,1594,80,0],[1595,13,1595,78,0],[1596,13,1596,64,0],[1598,13,1598,48,0],[1599,13,1599,38,0],[1600,13,1600,60,0],[1601,13,1601,58,0],[1602,13,1602,43,0],[1603,13,1603,28,0],[1603,29,1603,64,0],[1604,13,1604,34,0],[1604,35,1604,71,0],[1605,13,1605,33,0],[1605,34,1605,68,0],[1606,13,1608,119,0],[1610,13,1610,29,0],[1615,21,1615,49,0],[1616,21,1616,27,0],[1618,21,1618,48,0],[1619,21,1619,27,0],[1622,9,1622,10,0],[1625,9,1625,10,0],[1626,13,1626,44,0],[1627,13,1627,64,0],[1628,13,1628,54,0],[1632,13,1632,43,0],[1634,13,1634,80,0],[1635,13,1635,52,0],[1636,13,1636,51,0],[1637,13,1637,87,0],[1638,13,1638,79,0],[1639,13,1639,44,0],[1640,13,1640,76,0],[1641,13,1641,77,0],[1642,13,1642,77,0],[1643,13,1643,76,0],[1644,13,1644,77,0],[1645,13,1645,79,0],[1646,13,1646,75,0],[1647,13,1647,76,0],[1648,13,1648,84,0],[1649,13,1649,88,0],[1650,13,1650,85,0],[1652,13,1652,75,0],[1653,13,1653,71,0],[1654,13,1654,74,0],[1655,13,1655,75,0],[1656,13,1656,83,0],[1657,13,1657,74,0],[1658,13,1658,42,0],[1659,13,1659,71,0],[1661,13,1661,28,0],[1663,13,1663,100,0],[1664,18,1664,23,0],[1664,25,1664,53,0],[1664,55,1664,58,0],[1665,13,1665,14,0],[1666,17,1666,69,0],[1668,17,1668,48,0],[1669,17,1669,87,0],[1670,17,1670,79,0],[1671,17,1671,86,0],[1672,17,1672,63,0],[1673,17,1673,79,0],[1674,17,1674,99,0],[1675,17,1675,31,0],[1676,21,1676,87,0],[1678,17,1678,35,0],[1679,17,1679,18,0],[1680,21,1681,72,0],[1682,25,1682,122,0],[1683,17,1683,18,0],[1684,22,1684,84,0],[1685,21,1685,118,0],[1688,17,1688,77,0],[1689,17,1689,56,0],[1690,17,1690,18,0],[1691,21,1691,77,0],[1692,25,1692,87,0],[1693,21,1693,77,0],[1694,25,1694,87,0],[1695,21,1695,76,0],[1696,25,1696,85,0],[1697,21,1697,77,0],[1698,25,1698,87,0],[1699,21,1699,89,0],[1700,17,1700,18,0],[1701,17,1701,45,0],[1702,17,1702,38,0],[1703,17,1706,56,0],[1707,17,1707,55,0],[1708,21,1710,100,0],[1711,17,1711,52,0],[1712,21,1714,94,0],[1715,17,1715,47,0],[1716,17,1716,26,0],[1718,17,1718,66,0],[1719,17,1719,18,0],[1720,21,1720,47,0],[1721,21,1721,91,0],[1722,21,1722,53,0],[1724,21,1724,83,0],[1725,21,1725,73,0],[1726,21,1726,89,0],[1727,21,1727,35,0],[1728,21,1728,22,0],[1729,25,1729,91,0],[1730,29,1730,88,0],[1735,21,1735,22,0],[1737,21,1737,41,0],[1737,43,1737,52,0],[1738,21,1738,50,0],[1739,25,1740,145,0],[1741,21,1742,143,0],[1743,21,1743,103,0],[1744,21,1744,22,0],[1745,25,1745,112,0],[1748,25,1748,93,0],[1749,21,1749,104,0],[1750,21,1750,35,0],[1751,25,1751,91,0],[1752,21,1754,120,0],[1755,21,1755,46,0],[1756,17,1756,18,0],[1757,13,1757,14,0],[1758,13,1758,23,0],[1759,9,1759,10,0],[1762,9,1762,10,0],[1763,13,1763,37,0],[1764,13,1764,59,0],[1765,13,1765,14,0],[1766,17,1766,42,0],[1768,17,1768,72,0],[1769,17,1769,94,0],[1770,13,1770,14,0],[1772,13,1772,14,0],[1773,17,1773,61,0],[1774,13,1774,14,0],[1775,13,1775,119,0],[1776,13,1776,83,0],[1777,13,1777,77,0],[1778,13,1778,80,0],[1779,13,1779,28,0],[1780,17,1780,92,0],[1782,17,1782,84,0],[1784,13,1784,82,0],[1785,13,1785,107,0],[1786,13,1786,102,0],[1787,13,1787,109,0],[1788,13,1788,39,0],[1789,17,1789,76,0],[1790,13,1790,39,0],[1791,17,1791,80,0],[1792,13,1792,38,0],[1793,17,1793,78,0],[1794,13,1794,39,0],[1795,17,1795,80,0],[1797,13,1797,64,0],[1798,13,1798,63,0],[1799,13,1799,65,0],[1801,13,1801,63,0],[1802,13,1802,61,0],[1803,13,1803,56,0],[1804,9,1804,10,0],[1807,9,1807,10,0],[1808,13,1808,42,0],[1809,9,1809,10,0],[1812,9,1812,10,0],[1813,13,1813,58,0],[1814,13,1814,59,0],[1815,13,1815,14,0],[1816,17,1816,56,0],[1817,17,1817,44,0],[1818,17,1818,24,0],[1829,13,1829,14,0],[1830,17,1830,48,0],[1831,17,1831,35,0],[1832,21,1832,46,0],[1834,21,1834,102,0],[1836,17,1836,73,0],[1837,17,1837,79,0],[1838,17,1838,18,0],[1839,21,1839,103,0],[1840,21,1840,48,0],[1841,21,1841,62,0],[1842,21,1842,28,0],[1844,17,1844,61,0],[1845,17,1845,18,0],[1846,21,1846,83,0],[1847,21,1847,22,0],[1848,25,1848,103,0],[1849,25,1849,52,0],[1850,25,1850,66,0],[1851,25,1851,32,0],[1853,26,1853,92,0],[1854,21,1854,22,0],[1855,25,1855,105,0],[1856,25,1856,52,0],[1857,25,1857,66,0],[1858,25,1858,32,0],[1860,26,1860,90,0],[1861,21,1861,22,0],[1862,25,1862,104,0],[1863,25,1863,52,0],[1864,25,1864,66,0],[1865,25,1865,32,0],[1867,17,1867,18,0],[1868,17,1868,27,0],[1869,17,1869,18,0],[1870,21,1870,55,0],[1871,21,1871,22,0],[1872,25,1872,83,0],[1873,25,1873,52,0],[1875,25,1875,32,0],[1877,17,1877,18,0],[1878,17,1878,32,0],[1879,17,1879,18,0],[1880,21,1880,28,0],[1880,30,1880,46,0],[1880,47,1880,49,0],[1880,50,1880,68,0],[1881,21,1881,22,0],[1882,25,1882,112,0],[1883,25,1883,26,0],[1884,29,1884,122,0],[1885,29,1885,56,0],[1886,29,1886,70,0],[1887,29,1887,36,0],[1889,25,1889,90,0],[1890,25,1890,26,0],[1891,29,1891,121,0],[1892,29,1892,56,0],[1893,29,1893,70,0],[1894,29,1894,36,0],[1896,21,1896,22,0],[1897,17,1897,18,0],[1899,17,1899,48,0],[1901,17,1901,57,0],[1902,17,1902,66,0],[1903,17,1903,62,0],[1904,17,1904,64,0],[1905,17,1905,77,0],[1906,17,1906,50,0],[1907,17,1907,45,0],[1908,17,1908,51,0],[1909,17,1909,62,0],[1910,17,1910,64,0],[1911,17,1911,58,0],[1912,17,1912,63,0],[1913,17,1913,59,0],[1914,17,1914,31,0],[1915,21,1915,70,0],[1916,22,1916,41,0],[1917,21,1917,63,0],[1919,21,1919,60,0],[1920,17,1920,79,0],[1921,17,1921,76,0],[1922,17,1922,31,0],[1923,21,1923,40,0],[1925,17,1925,18,0],[1926,21,1926,63,0],[1927,21,1929,66,0],[1930,17,1930,18,0],[1932,17,1932,78,0],[1936,17,1936,45,0],[1937,17,1937,57,0],[1939,17,1939,48,0],[1940,17,1940,55,0],[1941,17,1941,57,0],[1942,17,1942,59,0],[1943,17,1943,53,0],[1944,17,1944,34,0],[1945,17,1945,38,0],[1949,17,1949,62,0],[1950,17,1950,36,0],[1951,17,1951,47,0],[1952,17,1952,83,0],[1955,17,1955,34,0],[1956,17,1956,18,0],[1957,21,1957,93,0],[1958,21,1958,28,0],[1958,30,1958,46,0],[1958,47,1958,49,0],[1958,50,1958,87,0],[1959,21,1959,22,0],[1960,25,1960,91,0],[1961,25,1964,98,0],[1965,25,1965,80,0],[1966,25,1966,120,0],[1968,25,1969,93,0],[1970,25,1971,86,0],[1972,25,1973,91,0],[1975,25,1975,38,0],[1976,21,1976,22,0],[1979,21,1981,113,0],[1982,21,1982,63,0],[1983,21,1983,52,0],[1984,21,1984,22,0],[1985,25,1985,102,0],[1986,25,1986,56,0],[1987,25,1987,26,0],[1988,29,1989,123,0],[1990,29,1990,106,0],[1991,29,1991,96,0],[1992,29,1995,82,0],[1996,29,1999,71,0],[2001,29,2003,73,0],[2004,25,2004,26,0],[2005,21,2005,22,0],[2006,17,2006,18,0],[2008,17,2008,61,0],[2010,17,2010,49,0],[2011,17,2011,18,0],[2012,21,2012,136,0],[2013,21,2013,49,0],[2014,21,2014,22,0],[2015,25,2017,118,0],[2018,25,2018,106,0],[2019,25,2019,94,0],[2020,25,2020,95,0],[2021,25,2025,75,0],[2026,25,2026,96,0],[2028,25,2030,103,0],[2031,21,2031,22,0],[2032,17,2032,18,0],[2033,17,2033,58,0],[2037,17,2037,80,0],[2038,17,2038,18,0],[2040,21,2042,92,0],[2043,21,2043,22,0],[2044,25,2048,80,0],[2049,21,2049,22,0],[2051,21,2051,91,0],[2118,17,2118,18,0],[2119,13,2119,14,0],[2120,13,2120,33,0],[2121,13,2121,14,0],[2122,17,2122,44,0],[2123,13,2123,14,0],[2124,9,2124,10,0],[2127,9,2127,10,0],[2128,13,2128,74,0],[2129,9,2129,10,0],[2132,9,2132,10,0],[2134,13,2136,102,0],[2137,9,2137,10,0],[2140,9,2140,10,0],[2141,13,2141,59,0],[2142,13,2142,14,0],[2143,17,2143,64,0],[2144,17,2144,113,0],[2145,17,2145,24,0],[2148,13,2148,87,0],[2149,13,2149,69,0],[2150,13,2150,54,0],[2151,13,2151,14,0],[2152,17,2152,86,0],[2153,17,2153,60,0],[2154,17,2154,66,0],[2155,17,2155,24,0],[2157,13,2157,58,0],[2158,13,2158,14,0],[2159,17,2159,91,0],[2160,17,2160,60,0],[2161,17,2161,66,0],[2162,17,2162,24,0],[2164,13,2164,55,0],[2165,13,2165,14,0],[2166,17,2166,89,0],[2167,17,2167,60,0],[2168,17,2168,66,0],[2169,17,2169,24,0],[2171,13,2171,34,0],[2172,13,2172,34,0],[2173,13,2173,25,0],[2174,13,2174,90,0],[2175,13,2175,93,0],[2176,13,2176,44,0],[2177,13,2177,53,0],[2180,13,2180,43,0],[2182,13,2182,51,0],[2183,13,2183,14,0],[2184,17,2184,59,0],[2186,17,2186,56,0],[2187,13,2187,14,0],[2189,13,2189,75,0],[2190,13,2190,74,0],[2192,18,2192,23,0],[2192,25,2192,52,0],[2192,54,2192,57,0],[2193,13,2193,14,0],[2194,17,2194,39,0],[2196,17,2196,104,0],[2197,17,2197,96,0],[2198,17,2199,91,0],[2200,17,2200,38,0],[2201,13,2201,14,0],[2203,13,2203,35,0],[2204,13,2207,69,0],[2208,13,2208,33,0],[2209,13,2209,38,0],[2210,13,2210,57,0],[2211,13,2211,56,0],[2212,9,2212,10,0],[2215,9,2215,10,0],[2216,13,2216,74,0],[2217,13,2221,84,0],[2223,13,2223,109,0],[2224,13,2224,94,0],[2225,13,2229,74,0],[2230,13,2230,84,0],[2231,9,2231,10,0],[2234,9,2234,10,0],[2235,13,2235,45,0],[2236,13,2236,54,0],[2237,13,2237,56,0],[2238,9,2238,10,0],[2241,9,2241,10,0],[2242,13,2242,61,0],[2243,13,2243,56,0],[2244,9,2244,10,0],[2247,9,2247,10,0],[2248,13,2248,95,0],[2250,13,2250,79,0],[2252,13,2252,52,0],[2253,13,2253,53,0],[2254,13,2254,38,0],[2255,13,2255,43,0],[2256,13,2256,34,0],[2257,18,2257,27,0],[2257,29,2257,57,0],[2257,59,2257,62,0],[2258,13,2258,14,0],[2259,17,2259,69,0],[2260,17,2261,71,0],[2262,17,2262,18,0],[2263,21,2263,80,0],[2264,21,2264,79,0],[2265,21,2265,78,0],[2266,21,2266,77,0],[2267,21,2267,92,0],[2268,21,2268,22,0],[2269,25,2269,85,0],[2270,25,2270,84,0],[2271,25,2275,89,0],[2276,25,2280,88,0],[2283,21,2283,22,0],[2285,17,2285,18,0],[2287,17,2287,18,0],[2288,21,2288,119,0],[2289,21,2289,22,0],[2290,25,2290,123,0],[2291,25,2294,52,0],[2295,25,2298,48,0],[2299,21,2299,22,0],[2300,17,2300,18,0],[2301,17,2301,72,0],[2302,13,2302,14,0],[2303,13,2303,54,0],[2304,13,2304,79,0],[2305,9,2305,10,0],[2308,9,2308,10,0],[2309,13,2309,80,0],[2310,13,2310,78,0],[2311,13,2311,39,0],[2313,13,2313,58,0],[2314,17,2314,73,0],[2315,13,2315,56,0],[2316,17,2316,71,0],[2317,13,2317,66,0],[2318,17,2318,81,0],[2319,13,2319,56,0],[2320,17,2320,83,0],[2321,13,2321,63,0],[2322,17,2322,96,0],[2324,13,2325,68,0],[2326,13,2326,14,0],[2327,17,2327,59,0],[2328,21,2328,119,0],[2329,17,2329,115,0],[2330,17,2330,105,0],[2331,17,2331,90,0],[2332,13,2332,14,0],[2333,13,2333,60,0],[2334,13,2334,14,0],[2335,17,2335,95,0],[2336,17,2336,89,0],[2337,13,2337,14,0],[2339,13,2339,52,0],[2341,13,2341,59,0],[2342,13,2342,112,0],[2343,13,2343,52,0],[2345,13,2345,63,0],[2346,13,2346,14,0],[2347,17,2347,85,0],[2348,13,2348,14,0],[2350,13,2350,60,0],[2351,13,2351,14,0],[2352,17,2352,92,0],[2353,17,2353,96,0],[2354,13,2354,14,0],[2355,13,2355,64,0],[2356,13,2356,14,0],[2357,17,2358,92,0],[2359,13,2359,14,0],[2361,13,2361,53,0],[2364,13,2364,58,0],[2365,17,2365,74,0],[2366,13,2366,56,0],[2367,17,2367,72,0],[2368,13,2368,66,0],[2369,17,2369,82,0],[2370,13,2370,63,0],[2371,17,2371,97,0],[2373,13,2373,60,0],[2374,13,2374,14,0],[2375,17,2375,96,0],[2376,17,2376,89,0],[2377,13,2377,14,0],[2379,13,2379,52,0],[2381,9,2381,10,0],[2384,9,2384,10,0],[2385,13,2385,83,0],[2387,13,2387,79,0],[2389,13,2389,52,0],[2390,13,2390,63,0],[2391,13,2391,38,0],[2393,13,2393,72,0],[2394,13,2394,73,0],[2396,13,2396,105,0],[2397,13,2397,114,0],[2398,13,2398,83,0],[2400,13,2401,84,0],[2402,13,2402,93,0],[2405,13,2405,42,0],[2406,13,2406,62,0],[2407,13,2407,37,0],[2408,13,2408,44,0],[2410,13,2410,76,0],[2411,13,2411,14,0],[2414,17,2414,53,0],[2416,17,2416,32,0],[2417,17,2417,119,0],[2418,17,2418,18,0],[2419,21,2419,86,0],[2420,21,2420,105,0],[2421,21,2421,78,0],[2422,17,2422,18,0],[2423,17,2423,42,0],[2424,13,2424,14,0],[2426,13,2426,14,0],[2427,17,2427,42,0],[2428,17,2431,77,0],[2432,17,2432,33,0],[2433,13,2433,14,0],[2434,13,2434,39,0],[2435,13,2435,14,0],[2436,17,2436,73,0],[2437,17,2437,56,0],[2438,17,2438,57,0],[2439,17,2439,39,0],[2440,17,2440,75,0],[2441,17,2441,48,0],[2443,17,2443,75,0],[2444,17,2444,60,0],[2445,17,2445,61,0],[2446,17,2446,40,0],[2447,17,2447,76,0],[2448,17,2448,50,0],[2450,17,2450,85,0],[2451,17,2451,68,0],[2452,17,2452,69,0],[2453,17,2453,45,0],[2454,17,2454,76,0],[2455,17,2455,55,0],[2456,13,2456,14,0],[2457,9,2457,10,0],[2460,9,2460,10,0],[2461,13,2461,41,0],[2462,13,2462,33,0],[2463,13,2463,42,0],[2464,17,2464,62,0],[2465,13,2465,27,0],[2466,17,2466,24,0],[2468,13,2468,94,0],[2469,13,2469,33,0],[2470,13,2470,38,0],[2471,13,2471,56,0],[2472,9,2472,10,0],[2475,9,2475,10,0],[2476,13,2476,41,0],[2477,13,2477,33,0],[2478,13,2478,42,0],[2479,17,2479,62,0],[2480,13,2480,27,0],[2481,17,2481,24,0],[2483,13,2483,94,0],[2484,13,2484,38,0],[2485,13,2485,33,0],[2486,13,2486,56,0],[2487,9,2487,10,0],[2490,9,2490,10,0],[2491,18,2491,27,0],[2491,29,2491,57,0],[2491,59,2491,62,0],[2492,13,2492,14,0],[2493,17,2493,98,0],[2494,21,2494,33,0],[2495,13,2495,14,0],[2496,13,2496,26,0],[2497,9,2497,10,0],[2500,9,2500,10,0],[2501,13,2501,111,0],[2502,13,2502,14,0],[2503,17,2503,72,0],[2504,17,2504,18,0],[2505,21,2505,93,0],[2506,21,2506,92,0],[2507,17,2507,18,0],[2510,13,2510,14,0],[2511,13,2511,27,0],[2512,13,2512,14,0],[2513,17,2513,114,0],[2514,17,2514,18,0],[2515,21,2515,61,0],[2516,21,2516,86,0],[2517,21,2517,92,0],[2518,21,2518,84,0],[2519,17,2519,18,0],[2520,22,2521,91,0],[2522,17,2522,18,0],[2523,21,2523,92,0],[2524,21,2524,97,0],[2525,21,2525,84,0],[2526,21,2526,22,0],[2527,21,2527,89,0],[2528,17,2528,18,0],[2529,22,2529,133,0],[2530,17,2530,18,0],[2531,21,2531,86,0],[2532,21,2532,84,0],[2533,17,2533,18,0],[2535,17,2535,18,0],[2536,21,2536,85,0],[2537,21,2537,84,0],[2538,21,2538,85,0],[2539,21,2539,84,0],[2540,17,2540,18,0],[2541,13,2541,14,0],[2542,13,2553,33,0],[2553,33,2553,34,0],[2553,34,2554,37,0],[2554,37,2554,63,0],[2554,63,2555,37,0],[2555,37,2555,38,0],[2555,38,2556,41,0],[2556,41,2556,95,0],[2556,95,2557,37,0],[2557,37,2557,38,0],[2557,38,2558,33,0],[2558,33,2558,34,0],[2558,34,2558,36,0],[2542,13,2558,36,0],[2559,9,2559,10,0],[2562,9,2562,10,0],[2563,13,2563,32,0],[2564,17,2564,80,0],[2565,9,2565,10,0],[2568,9,2568,10,0],[2570,13,2570,32,0],[2572,13,2572,41,0],[2575,21,2575,94,0],[2576,25,2576,32,0],[2578,21,2578,106,0],[2579,21,2580,30,0],[2581,21,2581,22,0],[2582,25,2583,91,0],[2584,25,2584,54,0],[2585,21,2585,22,0],[2586,21,2586,66,0],[2587,21,2587,40,0],[2589,21,2589,66,0],[2590,21,2590,80,0],[2591,21,2591,74,0],[2592,21,2592,50,0],[2593,21,2593,60,0],[2594,21,2594,45,0],[2595,21,2595,52,0],[2596,21,2597,114,0],[2598,21,2598,27,0],[2600,21,2600,92,0],[2601,25,2601,32,0],[2622,21,2622,84,0],[2623,21,2623,83,0],[2624,21,2624,90,0],[2625,21,2627,108,0],[2628,21,2628,109,0],[2629,21,2629,104,0],[2630,21,2630,113,0],[2631,21,2631,108,0],[2632,21,2632,110,0],[2633,21,2633,105,0],[2634,21,2634,113,0],[2635,21,2635,108,0],[2636,21,2636,83,0],[2637,21,2637,94,0],[2638,21,2638,22,0],[2639,25,2639,56,0],[2640,25,2640,102,0],[2641,21,2641,22,0],[2642,21,2643,91,0],[2644,21,2644,22,0],[2645,25,2645,57,0],[2646,21,2646,22,0],[2647,21,2647,116,0],[2648,21,2648,22,0],[2649,25,2649,57,0],[2650,25,2650,53,0],[2651,21,2651,22,0],[2653,21,2653,22,0],[2654,25,2654,58,0],[2655,25,2655,52,0],[2656,21,2656,22,0],[2658,21,2658,70,0],[2660,21,2661,113,0],[2662,21,2662,27,0],[2664,9,2664,10,0],[2667,9,2667,10,0],[2668,13,2668,57,0],[2669,13,2669,54,0],[2670,13,2670,14,0],[2671,17,2671,61,0],[2672,17,2672,116,0],[2673,17,2673,114,0],[2674,13,2674,14,0],[2675,18,2675,58,0],[2676,13,2676,14,0],[2677,17,2677,103,0],[2678,17,2678,93,0],[2679,17,2679,92,0],[2680,13,2680,14,0],[2681,9,2681,10,0],[2684,9,2684,10,0],[2685,13,2685,41,0],[2688,21,2688,49,0],[2689,21,2689,41,0],[2690,21,2690,50,0],[2691,25,2691,70,0],[2692,21,2692,35,0],[2693,25,2693,32,0],[2694,21,2694,66,0],[2695,21,2695,52,0],[2696,21,2696,27,0],[2699,21,2699,40,0],[2700,21,2700,27,0],[2703,9,2703,10,0],[2706,9,2706,10,0],[2707,13,2707,28,0],[2708,13,2708,42,0],[2709,13,2709,41,0],[2711,18,2711,27,0],[2711,29,2711,57,0],[2711,59,2711,62,0],[2712,13,2712,14,0],[2713,17,2714,88,0],[2715,17,2715,18,0],[2716,21,2716,36,0],[2717,21,2717,36,0],[2718,21,2718,94,0],[2719,21,2719,94,0],[2720,21,2720,38,0],[2722,21,2722,35,0],[2723,25,2723,125,0],[2725,21,2725,57,0],[2726,25,2726,38,0],[2728,25,2728,31,0],[2729,17,2729,18,0],[2730,13,2730,14,0],[2731,13,2731,28,0],[2732,13,2732,14,0],[2733,17,2735,63,0],[2736,13,2736,14,0],[2737,18,2737,38,0],[2738,13,2738,14,0],[2739,17,2740,149,0],[2741,13,2741,14,0],[2743,13,2743,14,0],[2744,17,2744,31,0],[2745,17,2745,67,0],[2746,17,2746,24,0],[2746,26,2746,31,0],[2746,32,2746,34,0],[2746,35,2746,40,0],[2747,17,2747,18,0],[2748,21,2748,106,0],[2749,21,2749,60,0],[2750,21,2750,29,0],[2751,17,2751,18,0],[2752,17,2752,58,0],[2753,17,2753,102,0],[2754,13,2754,14,0],[2755,9,2755,10,0],[2758,9,2758,10,0],[2759,13,2759,47,0],[2760,13,2760,82,0],[2761,13,2761,14,0],[2762,17,2762,55,0],[2763,17,2763,85,0],[2764,17,2764,73,0],[2765,17,2765,79,0],[2766,17,2768,84,0],[2769,17,2769,45,0],[2770,21,2772,25,0],[2772,25,2772,120,0],[2772,120,2773,52,0],[2770,21,2773,52,0],[2775,21,2775,40,0],[2776,13,2776,14,0],[2777,13,2777,34,0],[2778,9,2778,10,0],[2781,9,2781,10,0],[2783,13,2783,14,0],[2784,17,2784,90,0],[2785,17,2785,18,0],[2786,21,2786,28,0],[2789,17,2789,122,0],[2792,25,2793,138,0],[2795,25,2796,118,0],[2798,13,2798,14,0],[2799,13,2799,33,0],[2800,13,2800,14,0],[2801,17,2801,44,0],[2802,13,2802,14,0],[2804,13,2804,14,0],[2806,17,2806,48,0],[2807,17,2807,60,0],[2808,13,2808,14,0],[2809,9,2809,10,0],[2812,9,2812,10,0],[2813,13,2813,37,0],[2814,13,2814,14,0],[2815,17,2815,67,0],[2816,17,2816,62,0],[2817,17,2817,76,0],[2818,17,2818,89,0],[2819,17,2819,18,0],[2820,21,2820,57,0],[2821,21,2821,22,0],[2822,25,2822,61,0],[2823,25,2823,70,0],[2827,25,2827,106,0],[2828,25,2828,36,0],[2829,25,2829,26,0],[2830,29,2830,54,0],[2831,25,2831,26,0],[2833,25,2834,39,0],[2835,25,2835,26,0],[2836,29,2836,59,0],[2837,25,2837,26,0],[2839,25,2839,26,0],[2840,29,2840,67,0],[2841,25,2841,26,0],[2842,25,2842,30,0],[2843,25,2843,26,0],[2844,25,2844,26,0],[2846,25,2846,74,0],[2847,21,2847,22,0],[2848,17,2848,18,0],[2850,17,2850,18,0],[2851,21,2851,55,0],[2852,17,2852,18,0],[2853,13,2853,14,0],[2855,13,2855,14,0],[2856,17,2856,51,0],[2857,13,2857,14,0],[2859,13,2859,56,0],[2860,9,2860,10,0],[2887,9,2887,10,0],[2888,13,2888,56,0],[2889,13,2889,69,0],[2890,13,2890,52,0],[2891,9,2891,10,0],[2894,9,2894,10,0],[2895,13,2895,56,0],[2896,13,2896,41,0],[2897,13,2897,44,0],[2898,13,2898,47,0],[2899,9,2899,10,0],[2902,9,2902,10,0],[2904,13,2904,32,0],[2905,13,2905,28,0],[2906,13,2906,33,0],[2908,13,2908,14,0],[2909,17,2910,84,0],[2911,17,2911,41,0],[2913,17,2913,60,0],[2914,17,2914,32,0],[2918,17,2918,101,0],[2919,17,2919,58,0],[2920,17,2920,44,0],[2922,17,2922,75,0],[2923,17,2923,18,0],[2924,21,2924,36,0],[2925,21,2925,55,0],[2926,21,2926,35,0],[2928,22,2928,82,0],[2929,17,2929,18,0],[2930,21,2930,36,0],[2931,21,2932,119,0],[2933,21,2933,35,0],[2936,17,2936,18,0],[2937,21,2937,89,0],[2944,21,2944,108,0],[2945,21,2945,58,0],[2946,21,2946,50,0],[2950,21,2950,28,0],[2950,30,2950,43,0],[2950,44,2950,46,0],[2950,47,2950,87,0],[2951,21,2951,22,0],[2952,25,2952,56,0],[2953,25,2953,41,0],[2960,33,2962,121,0],[2963,33,2963,39,0],[2965,33,2965,54,0],[2966,33,2966,39,0],[2969,25,2969,71,0],[2970,25,2970,26,0],[2971,29,2971,44,0],[2972,29,2973,82,0],[2974,29,2974,43,0],[2976,21,2976,22,0],[2984,21,2984,56,0],[2986,21,2986,28,0],[2986,30,2986,43,0],[2986,44,2986,46,0],[2986,47,2986,87,0],[2987,21,2987,22,0],[2988,25,2988,52,0],[2989,25,2989,56,0],[2990,25,2990,73,0],[2993,33,2993,77,0],[2994,33,2994,54,0],[2995,33,2995,39,0],[2997,33,2997,79,0],[2998,33,2998,56,0],[2999,33,2999,39,0],[3001,33,3001,80,0],[3002,33,3002,77,0],[3003,33,3003,39,0],[3005,33,3005,78,0],[3006,33,3006,56,0],[3007,33,3007,39,0],[3009,33,3009,78,0],[3010,33,3010,57,0],[3011,33,3011,39,0],[3013,25,3013,58,0],[3015,25,3015,55,0],[3016,21,3016,22,0],[3018,21,3018,76,0],[3019,21,3019,22,0],[3020,21,3020,72,0],[3021,21,3021,48,0],[3023,21,3023,41,0],[3024,25,3024,53,0],[3025,21,3025,54,0],[3026,21,3026,35,0],[3027,17,3027,18,0],[3027,19,3027,68,0],[3030,17,3030,57,0],[3031,17,3031,53,0],[3032,17,3032,57,0],[3033,17,3033,18,0],[3034,21,3036,75,0],[3037,21,3037,34,0],[3040,17,3040,57,0],[3041,17,3041,41,0],[3042,22,3042,31,0],[3042,33,3042,47,0],[3042,49,3042,52,0],[3043,17,3043,18,0],[3044,21,3044,81,0],[3045,21,3045,93,0],[3046,21,3046,44,0],[3047,21,3047,22,0],[3048,25,3048,119,0],[3049,25,3049,51,0],[3050,25,3050,38,0],[3053,21,3053,22,0],[3054,25,3054,72,0],[3055,25,3055,42,0],[3056,25,3056,99,0],[3057,25,3057,26,0],[3058,29,3059,86,0],[3060,29,3060,55,0],[3061,29,3061,42,0],[3063,25,3063,68,0],[3064,25,3065,118,0],[3066,25,3066,100,0],[3067,21,3067,22,0],[3068,17,3068,18,0],[3069,17,3069,46,0],[3071,17,3071,31,0],[3073,13,3073,33,0],[3074,13,3074,14,0],[3075,17,3075,45,0],[3077,17,3077,30,0],[3081,9,3081,10,0],[3084,9,3084,10,0],[3085,13,3085,53,0],[3086,18,3086,27,0],[3086,29,3086,43,0],[3086,45,3086,48,0],[3087,13,3087,14,0],[3088,17,3088,61,0],[3089,13,3089,14,0],[3090,9,3090,10,0],[3093,9,3093,10,0],[3094,13,3094,32,0],[3095,13,3095,30,0],[3096,13,3096,61,0],[3097,13,3097,73,0],[3098,13,3098,44,0],[3108,13,3108,57,0],[3110,13,3110,69,0],[3111,13,3111,68,0],[3112,13,3112,20,0],[3112,22,3112,32,0],[3112,33,3112,35,0],[3112,36,3112,68,0],[3113,13,3113,14,0],[3115,17,3115,28,0],[3116,17,3116,40,0],[3117,13,3117,14,0],[3119,13,3119,20,0],[3119,22,3119,32,0],[3119,33,3119,35,0],[3119,36,3119,54,0],[3120,13,3120,14,0],[3121,17,3121,71,0],[3122,17,3122,35,0],[3123,21,3123,44,0],[3124,17,3125,116,0],[3126,17,3126,51,0],[3127,17,3127,18,0],[3128,21,3128,44,0],[3129,21,3129,30,0],[3131,13,3131,14,0],[3133,13,3133,20,0],[3133,22,3133,32,0],[3133,33,3133,35,0],[3133,36,3133,74,0],[3134,13,3134,14,0],[3135,17,3135,29,0],[3136,13,3136,14,0],[3137,13,3137,56,0],[3139,13,3139,43,0],[3147,13,3147,53,0],[3149,13,3149,68,0],[3151,13,3151,27,0],[3152,9,3152,10,0],[3155,9,3155,10,0],[3156,13,3156,53,0],[3157,13,3157,49,0],[3158,13,3158,60,0],[3159,13,3159,63,0],[3160,13,3160,65,0],[3162,13,3162,28,0],[3163,9,3163,10,0],[3166,9,3166,10,0],[3168,13,3168,14,0],[3169,17,3169,92,0],[3170,17,3170,118,0],[3171,17,3178,124,0],[3180,13,3180,18,0],[3181,13,3181,14,0],[3182,17,3182,30,0],[3184,9,3184,10,0],[3187,9,3187,10,0],[3209,13,3209,52,0],[3210,13,3210,63,0],[3211,13,3211,27,0],[3212,17,3212,90,0],[3213,13,3213,92,0],[3214,13,3214,92,0],[3216,13,3216,83,0],[3217,13,3217,86,0],[3218,13,3218,92,0],[3219,13,3219,104,0],[3220,13,3220,105,0],[3222,13,3222,99,0],[3223,13,3223,95,0],[3224,13,3224,98,0],[3225,13,3225,98,0],[3226,13,3226,48,0],[3227,13,3227,42,0],[3229,13,3229,49,0],[3231,13,3231,40,0],[3232,9,3232,10,0],[3235,9,3235,10,0],[3236,13,3236,64,0],[3237,17,3237,97,0],[3239,13,3239,64,0],[3240,17,3240,85,0],[3242,13,3242,65,0],[3243,13,3243,14,0],[3244,17,3244,80,0],[3245,17,3245,101,0],[3246,13,3246,14,0],[3247,13,3247,67,0],[3248,13,3248,14,0],[3249,17,3249,84,0],[3250,17,3250,111,0],[3251,13,3251,14,0],[3253,13,3253,66,0],[3254,13,3254,14,0],[3255,17,3255,54,0],[3256,17,3256,18,0],[3257,21,3257,86,0],[3258,21,3258,116,0],[3259,17,3259,18,0],[3261,17,3261,18,0],[3262,21,3262,57,0],[3263,21,3263,105,0],[3264,17,3264,18,0],[3265,13,3265,14,0],[3266,13,3266,104,0],[3267,13,3267,14,0],[3268,17,3268,84,0],[3269,17,3270,71,0],[3271,13,3271,14,0],[3273,13,3273,14,0],[3274,17,3274,54,0],[3275,13,3275,14,0],[3276,13,3276,104,0],[3277,13,3277,14,0],[3278,17,3278,84,0],[3279,17,3280,71,0],[3281,13,3281,14,0],[3283,13,3283,14,0],[3284,17,3284,54,0],[3285,13,3285,14,0],[3286,13,3286,71,0],[3287,13,3287,14,0],[3288,17,3288,92,0],[3289,17,3289,113,0],[3290,13,3290,14,0],[3291,13,3291,65,0],[3292,13,3292,14,0],[3293,17,3293,80,0],[3294,17,3294,105,0],[3295,13,3295,14,0],[3296,13,3296,67,0],[3297,13,3297,14,0],[3298,17,3298,84,0],[3299,17,3299,113,0],[3300,13,3300,14,0],[3301,13,3301,67,0],[3302,13,3302,14,0],[3303,17,3303,79,0],[3304,13,3304,14,0],[3305,9,3305,10,0],[3308,9,3308,10,0],[3309,9,3309,10,0],[3312,9,3312,10,0],[3313,13,3313,49,0],[3317,9,3317,10,0],[3318,13,3320,94,0],[3321,9,3321,10,0],[3325,9,3325,10,0],[3326,13,3326,38,0],[3327,13,3327,26,0],[3328,13,3328,30,0],[3329,13,3329,32,0],[3330,13,3330,67,0],[3331,17,3331,30,0],[3333,13,3333,83,0],[3334,17,3334,76,0],[3336,17,3336,60,0],[3338,13,3338,151,0],[3340,13,3341,45,0],[3342,17,3342,29,0],[3344,13,3344,14,0],[3345,17,3345,52,0],[3346,21,3346,105,0],[3347,17,3347,30,0],[3349,9,3349,10,0],[3352,9,3352,10,0],[3353,13,3353,122,0],[3354,13,3354,122,0],[3355,13,3362,24,0],[3363,13,3364,71,0],[3365,9,3365,10,0],[3373,9,3373,10,0],[3374,13,3374,38,0],[3375,13,3375,65,0],[3376,13,3376,47,0],[3377,13,3377,14,0],[3378,17,3378,120,0],[3379,17,3379,45,0],[3380,17,3380,37,0],[3381,17,3384,63,0],[3385,17,3387,122,0],[3389,17,3389,18,0],[3391,21,3393,138,0],[3394,17,3394,18,0],[3395,17,3395,22,0],[3396,17,3396,18,0],[3397,17,3397,18,0],[3398,13,3398,14,0],[3400,13,3400,14,0],[3401,17,3401,57,0],[3402,13,3402,14,0],[3403,13,3403,76,0],[3404,18,3404,27,0],[3404,29,3404,63,0],[3404,65,3404,68,0],[3405,13,3405,14,0],[3406,17,3407,86,0],[3408,21,3410,119,0],[3412,21,3415,113,0],[3416,13,3416,14,0],[3417,13,3417,49,0],[3418,13,3418,54,0],[3419,13,3419,99,0],[3420,9,3420,10,0],[3423,9,3423,10,0],[3424,13,3424,44,0],[3425,9,3425,10,0],[3428,9,3428,10,0],[3429,13,3429,40,0],[3430,13,3430,42,0],[3431,13,3431,83,0],[3432,13,3432,40,0],[3434,13,3434,27,0],[3435,13,3435,14,0],[3436,17,3436,116,0],[3437,17,3437,34,0],[3438,21,3438,42,0],[3440,21,3440,43,0],[3441,13,3441,14,0],[3443,17,3443,38,0],[3445,13,3445,31,0],[3446,13,3446,14,0],[3447,17,3447,81,0],[3448,17,3448,57,0],[3449,17,3452,60,0],[3453,17,3453,166,0],[3454,17,3458,135,0],[3459,17,3463,131,0],[3464,17,3464,98,0],[3466,17,3466,51,0],[3467,17,3467,34,0],[3469,17,3469,66,0],[3470,17,3470,48,0],[3472,17,3482,58,0],[3485,17,3485,27,0],[3486,17,3486,24,0],[3486,26,3486,37,0],[3486,38,3486,40,0],[3486,41,3486,58,0],[3487,17,3487,18,0],[3488,21,3488,69,0],[3489,21,3489,22,0],[3490,25,3490,29,0],[3491,25,3491,63,0],[3492,25,3492,58,0],[3493,25,3493,87,0],[3494,25,3496,91,0],[3497,25,3499,82,0],[3500,25,3503,131,0],[3504,25,3504,76,0],[3505,25,3508,46,0],[3509,25,3512,46,0],[3513,25,3513,54,0],[3514,25,3514,58,0],[3515,21,3515,22,0],[3516,17,3516,18,0],[3517,17,3517,50,0],[3518,17,3518,66,0],[3519,17,3519,47,0],[3521,17,3521,49,0],[3523,17,3523,48,0],[3524,13,3524,14,0],[3526,17,3528,63,0],[3529,9,3529,10,0],[3533,9,3533,10,0],[3534,13,3534,38,0],[3536,13,3536,116,0],[3537,13,3537,64,0],[3538,13,3538,32,0],[3539,13,3539,14,0],[3540,17,3540,120,0],[3541,17,3541,45,0],[3542,17,3542,37,0],[3543,17,3546,63,0],[3547,17,3549,122,0],[3551,17,3551,18,0],[3553,21,3555,139,0],[3556,17,3556,18,0],[3557,17,3557,22,0],[3558,17,3558,18,0],[3559,17,3559,18,0],[3560,13,3560,14,0],[3562,13,3562,14,0],[3563,17,3563,57,0],[3564,13,3564,14,0],[3565,13,3565,76,0],[3566,18,3566,27,0],[3566,29,3566,62,0],[3566,64,3566,67,0],[3567,13,3567,14,0],[3568,17,3569,91,0],[3570,21,3572,116,0],[3574,21,3577,113,0],[3578,17,3580,105,0],[3581,13,3581,14,0],[3582,13,3582,48,0],[3583,13,3583,53,0],[3584,13,3584,98,0],[3585,9,3585,10,0],[3588,9,3588,10,0],[3589,13,3589,44,0],[3590,9,3590,10,0],[3593,9,3593,10,0],[3594,13,3594,40,0],[3595,13,3595,85,0],[3596,13,3596,80,0],[3597,13,3597,36,0],[3599,13,3602,56,0],[3603,13,3607,118,0],[3608,13,3611,133,0],[3612,13,3617,132,0],[3618,13,3618,94,0],[3620,13,3620,48,0],[3622,13,3622,44,0],[3623,9,3623,10,0],[3626,9,3626,10,0],[3627,13,3627,52,0],[3628,13,3628,72,0],[3629,13,3629,72,0],[3632,9,3632,10,0],[3635,9,3635,10,0],[3636,13,3636,51,0],[3637,13,3637,70,0],[3638,13,3638,70,0],[3641,9,3641,10,0],[3648,9,3648,10,0],[3649,13,3649,80,0],[3652,13,3652,65,0],[3653,13,3653,44,0],[3655,13,3655,56,0],[3656,17,3656,68,0],[3658,13,3658,66,0],[3659,13,3659,14,0],[3660,17,3662,117,0],[3663,17,3663,79,0],[3664,17,3664,117,0],[3665,17,3665,120,0],[3666,17,3671,117,0],[3673,17,3673,44,0],[3674,17,3674,18,0],[3675,21,3677,106,0],[3678,21,3680,117,0],[3681,17,3681,18,0],[3682,13,3682,14,0],[3683,13,3683,64,0],[3684,13,3684,14,0],[3685,17,3687,112,0],[3688,17,3688,77,0],[3689,17,3689,115,0],[3690,17,3690,118,0],[3691,17,3696,117,0],[3698,17,3698,44,0],[3699,17,3699,18,0],[3700,21,3702,104,0],[3703,21,3705,115,0],[3706,17,3706,18,0],[3707,13,3707,14,0],[3708,13,3708,56,0],[3709,13,3709,14,0],[3710,17,3710,89,0],[3711,17,3711,69,0],[3712,17,3712,44,0],[3713,17,3713,18,0],[3714,21,3716,96,0],[3717,21,3719,107,0],[3720,17,3720,18,0],[3721,13,3721,14,0],[3722,13,3722,60,0],[3723,13,3723,14,0],[3724,17,3724,73,0],[3725,17,3725,111,0],[3726,17,3726,114,0],[3727,17,3729,109,0],[3730,13,3730,14,0],[3732,13,3732,62,0],[3733,13,3733,14,0],[3734,17,3734,75,0],[3735,17,3735,113,0],[3736,17,3736,116,0],[3737,17,3739,109,0],[3740,13,3740,14,0],[3742,13,3742,67,0],[3743,13,3743,14,0],[3744,17,3744,80,0],[3745,17,3745,118,0],[3746,17,3746,121,0],[3747,17,3749,109,0],[3750,13,3750,14,0],[3753,13,3753,49,0],[3754,13,3754,14,0],[3755,17,3755,64,0],[3756,17,3756,64,0],[3757,21,3757,73,0],[3758,13,3758,14,0],[3759,18,3759,65,0],[3760,17,3760,69,0],[3762,13,3762,47,0],[3763,13,3763,14,0],[3764,17,3764,100,0],[3765,17,3765,60,0],[3766,13,3766,14,0],[3768,13,3768,65,0],[3769,13,3769,14,0],[3770,17,3770,118,0],[3771,17,3771,78,0],[3772,13,3772,14,0],[3774,13,3774,53,0],[3775,13,3775,14,0],[3777,17,3777,64,0],[3778,17,3778,18,0],[3779,21,3779,80,0],[3780,21,3780,121,0],[3781,17,3781,18,0],[3783,17,3783,70,0],[3784,21,3784,131,0],[3786,17,3786,68,0],[3787,21,3787,129,0],[3788,13,3788,14,0],[3789,18,3789,54,0],[3790,13,3790,14,0],[3792,17,3792,64,0],[3793,21,3793,79,0],[3795,17,3795,70,0],[3796,21,3796,127,0],[3798,17,3798,68,0],[3799,21,3799,125,0],[3800,13,3800,14,0],[3801,13,3801,90,0],[3805,13,3805,37,0],[3806,13,3806,14,0],[3807,17,3807,53,0],[3808,17,3808,18,0],[3809,21,3809,57,0],[3809,58,3809,86,0],[3810,21,3810,54,0],[3811,17,3811,18,0],[3812,22,3812,62,0],[3813,17,3813,18,0],[3814,21,3814,61,0],[3814,62,3814,94,0],[3815,21,3815,50,0],[3816,17,3816,18,0],[3817,13,3817,14,0],[3819,13,3819,14,0],[3820,17,3820,50,0],[3821,17,3821,46,0],[3822,13,3822,14,0],[3824,13,3824,38,0],[3825,13,3825,14,0],[3826,17,3826,59,0],[3826,60,3826,98,0],[3827,17,3827,59,0],[3827,60,3827,95,0],[3828,13,3828,14,0],[3830,13,3830,14,0],[3831,17,3831,53,0],[3832,17,3832,56,0],[3833,13,3833,14,0],[3836,9,3836,10,0],[3839,9,3839,10,0],[3840,13,3840,46,0],[3841,13,3841,42,0],[3843,13,3843,53,0],[3844,13,3844,14,0],[3845,17,3845,101,0],[3846,17,3846,89,0],[3847,13,3847,14,0],[3848,13,3848,37,0],[3849,9,3849,10,0],[3852,9,3852,10,0],[3853,13,3853,79,0],[3854,13,3854,69,0],[3855,13,3855,112,0],[3857,13,3857,14,0],[3858,17,3858,100,0],[3859,13,3859,14,0],[3860,13,3860,18,0],[3861,13,3861,14,0],[3862,17,3862,50,0],[3863,13,3863,14,0],[3864,13,3864,14,0],[3866,13,3866,14,0],[3867,17,3867,63,0],[3868,13,3868,14,0],[3869,13,3869,18,0],[3870,13,3870,14,0],[3871,17,3871,52,0],[3872,13,3872,14,0],[3873,13,3873,14,0],[3875,13,3875,14,0],[3876,17,3878,57,0],[3879,13,3879,14,0],[3880,13,3880,18,0],[3881,13,3881,14,0],[3882,17,3882,51,0],[3883,13,3883,14,0],[3884,13,3884,14,0],[3885,9,3885,10,0],[3888,9,3888,10,0],[3890,13,3890,14,0],[3891,17,3891,82,0],[3892,17,3892,18,0],[3893,21,3893,61,0],[3894,25,3896,113,0],[3898,25,3900,109,0],[3901,17,3901,18,0],[3902,13,3902,14,0],[3903,13,3903,18,0],[3904,13,3904,14,0],[3905,13,3905,14,0],[3906,9,3906,10,0],[3909,9,3909,10,0],[3910,13,3910,47,0],[3911,17,3911,71,0],[3913,17,3913,49,0],[3915,13,3915,145,0],[3916,9,3916,10,0],[3919,9,3919,10,0],[3920,13,3920,45,0],[3922,13,3922,43,0],[3923,13,3923,56,0],[3924,13,3924,51,0],[3925,13,3925,58,0],[3927,13,3927,43,0],[3928,13,3928,48,0],[3929,13,3929,45,0],[3930,13,3930,58,0],[3932,13,3932,28,0],[3933,9,3933,10,0],[3936,9,3936,10,0],[3937,13,3937,45,0],[3939,13,3939,43,0],[3940,13,3940,58,0],[3941,13,3941,52,0],[3942,13,3942,58,0],[3944,13,3944,43,0],[3945,13,3945,48,0],[3946,13,3946,45,0],[3947,13,3947,58,0],[3949,13,3949,28,0],[3950,9,3950,10,0]]);
    </script>
  </body>
</html>