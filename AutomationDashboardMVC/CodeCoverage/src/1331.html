<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Platform UI\Common\BrixListPage.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections;
using System.Collections.Generic;
using System.Data;
using System.Data.SqlClient;
using System.Drawing;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Reflection;
using System.Text;
using System.Threading;
using System.Web;
using System.Web.Script.Serialization;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Xml;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core.AbstractModels;
using Aurigo.AMP3.Core.BusinessLayer.BL;
using Aurigo.AMP3.Core.UserControls;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.AMP3.ExceptionManagement;
using Aurigo.AMP3.Logging;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.AMP3.Resources.MessageResources;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.AMP3.UserManagementBL;
using Aurigo.Brix.Core.WebUiHelper;
using Aurigo.Brix.Evaluator;
using Aurigo.Brix.Platform.BusinessLayer.BL;
using Aurigo.Brix.Platform.BusinessLayer.DataAccessHelper;
using Aurigo.Brix.Platform.BusinessLayer.DataResouces;
using Aurigo.Brix.Platform.BusinessLayer.DTO;
using Aurigo.Brix.Platform.BusinessLayer.UserControls;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Aurigo.Brix.Platform.BusinessLayer.XMLForm;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.Brix.Platform.UI.Common.Helpers;
using Aurigo.Brix.WorkflowMediators;
using Aurigo.Common;
using Aurigo.Workflow;
using DataDynamics.ActiveReports;
using DataDynamics.ActiveReports.Export.Pdf;
using Infragistics.Documents.Excel;
using Infragistics.WebUI.UltraWebGrid.ExcelExport;
using Telerik.Web.UI;
using Image = System.Drawing.Image;
using Label = DataDynamics.ActiveReports.Label;
using Section = Aurigo.Brix.Platform.BusinessLayer.XMLForm.Section;
using TextBox = DataDynamics.ActiveReports.TextBox;

using XC = Aurigo.Brix.Platform.BusinessLayer.XMLForm;

namespace Aurigo.AMP3.Core
{
    public partial class BrixListPage : BrixPageBase, ICallbackEventHandler, IWorkflowEnabled
    {
        #region &quot;Class Variables&quot;

        private const int GRID_COLUMN_WIDTH_OFFSET = 20;
        private const int GRID_COLUMN_MIN_WIDTH = 120;
        private const int GRID_COLUMN_MIN_WIDTH_DATETIME = 200;
        private const int MIN_GRID_COLUMNS_FOR_RESIZE = 8;
        protected ColumnSettings ColumnSettings;
        private bool _IsWorkflowAssociated;
        protected ModalPopupExtender PopupExtender;
        protected ModalPopupExtender PopupSubmit;
        protected UltraWebGridExcelExporter UltraWebGridExcelExporter1;
        private ApprovalHistory approvalHistory;
        private Button btnWFHistory;
        private FormCheckLists formCheckLists;
        private Button btnFormCheckLists;
        private string context;
        public ListModel listModel;
        protected MailMergeControl mmMailMergeControl;
        protected MailMergeManageControl mmMailMergeManageControl;
        protected MailMergeAndAttach mmMailMergeAndAttachControl;
        protected MailMergeAndEmail mmMailMergeAndEmailControl;

        private XMLRenderingEngine engine;
        public ESRIMapControl esriMap;
        private bool IsMapFilterClicked = false;

        private int PageSize
        {
            set { MWGrid.PageSize = value; }
            get { return MWGrid.PageSize; }
        }

        private ArrayList TimezoneColumns
        {
            get { return (ArrayList)ViewState[&quot;TimezoneColumns&quot;]; }
            set { ViewState[&quot;TimezoneColumns&quot;] = value; }
        }

        private ArrayList DataBaseColumns
        {
            get { return (ArrayList)ViewState[&quot;DataBaseColumns&quot;]; }
            set { ViewState[&quot;DataBaseColumns&quot;] = value; }
        }

        public string ListModelName { get; set; } = string.Empty;

        #endregion &quot;Class Variables&quot;

        #region &quot;Overriden Functions&quot;

        public override int GetProjectIdFromInstanceId()
        {
            return listModel.GetProjectIdFromInstanceId();
        }

        /// &lt;summary&gt;
        /// &lt;remarks&gt;
        ///  &lt;![CDATA[ Author : Lijo ]]&gt;
        /// This is a overrided function that is called before pageload.This creates all the controls dynamically.
        /// &lt;/remarks&gt;
        /// &lt;/summary&gt;
        protected override void CreateChildControls()
        {
            try
            {
                // create the child controls if the server control does not contains child controls
                EnsureChildControls();

                // Creates a new ControlCollection.
                CreateControlCollection();

                InitHtmlData();

                //ToDo: This method handles PageStae initialization, Change the method to something meaningful
                InitSortAndFilter();

                if (!Page.IsPostBack)
                    ApplySort(PageState.SortKey, PageState.SortOrder, false);

                SetJcriptDetailsForMenuButtons();
                listModel.ApplyToolBarCustomisation(MainToolBar);
                listModel.SetToolbarDetails();
                base.CreateChildControls();
                // Prevent child controls from being created again.
                ChildControlsCreated = true;
            }
            catch (Exception)
            {
                // ignored
            }
        }

        protected override void CreateContextMenu()
        {
            #region Adding Applicable Reports (in the layout) as CMenu

            List&lt;BrixContextMenu&gt; Menu = CMenu.CMenuArray;
            if (listModel != null) //KK: fix possible null reference error
            {
                listModel.CustomizeContextMenu(Menu);

                if (listModel.layout != null &amp;&amp; listModel.layout.Reports.Count &gt; 0)
                {
                    foreach (ReportDetails report in listModel.layout.Reports)
                    {
                        if (report.ModelType.ToLower().Contains(ModelType.ContextMenu.ToString().ToLower()) &amp;&amp;
                            report.IsActive)
                            Menu.Add(new BrixContextMenu(report.Context, report.Name, report.Description,
                                &quot;Icn_viewPDF.gif&quot;,
                                ContextMenuActionType.Report, string.Empty));
                    }
                }
                else if (listModel.xmlModel != null &amp;&amp; listModel.xmlModel.form != null &amp;&amp;
                         listModel.xmlModel.form.Reports.Count &gt; 0)
                {
                    foreach (ReportDetails report in listModel.xmlModel.form.Reports)
                    {
                        if (report.ModelType.ToLower().Contains(ModelType.ContextMenu.ToString().ToLower()) &amp;&amp;
                            report.IsActive)
                            Menu.Add(new BrixContextMenu(report.Context, report.Name, report.Description,
                                &quot;Icn_viewPDF.gif&quot;, ContextMenuActionType.Report, string.Empty));
                    }
                }
            }

            #endregion Adding Applicable Reports (in the layout) as CMenu

            if (Menu.Count &gt; 0)
                CMenu.ReportItemClick += CMenu_ReportItemClick;
        }

        //private void CreateControls()
        //{
        //    ManageLoggedInUserPermission();
        //}

        private bool ValidateURLParams()
        {
            // perform the validation to prevent XSS attack
            if (!string.IsNullOrEmpty(Request[&quot;POTypeInstanceID&quot;]))
            {
                int id;
                if (!int.TryParse(Request[&quot;POTypeInstanceID&quot;], out id))
                    return false;
            }

            //if (!string.IsNullOrEmpty(Request[&quot;POType&quot;]))
            //{
            //    // to do
            //}

            if (!string.IsNullOrEmpty(Request[&quot;module&quot;]))
            {
                if (!ModuleManager.Instance.ModuleExists(Request[&quot;module&quot;]))
                    return false;
            }

            return true;
        }

        public override bool CheckAccess()
        {
            // to prevent XSS attack
            if (!ValidateURLParams())
                return false;

            UserDetail ud = UserDetail.GetCurrentUserDetail();
            return listModel.CheckAccess(ud);
        }

        public override void InclueScriptAndStyleFiles()
        {
            base.InclueScriptAndStyleFiles();
            RegisterStyle(&quot;~/css/jsplumb.css&quot;);
            RegisterStyle(&quot;~/css/BrixListPageStyle.css&quot;);

            RegisterClientScriptInclude(&quot;~/Scripts/jquery.jsPlumb-1.2.5-all-min.js&quot;);
            RegisterClientScriptInclude(&quot;~/Scripts/excanvas.js&quot;);
            RegisterClientScriptInclude(&quot;~/Scripts/bundle.brixlist.*.js&quot;);
        }

        protected override void OnPreInit(EventArgs e)
        {
            base.OnPreInit(e);
            _IsListPage = true;
            //DO NOT MOVE this code elsewhere, if it is moved to OnInit Tab stickyness will stop working
            if (!IsPostBack)
                Session.Remove(&quot;ERRLOG&quot;);

            listModel = SetListModel();

            if (listModel == null)
            {
                //TODO: Display approrinate message
                UIHelper.RedirectURL(MessageResourceManager.GetString(&quot;E_USRMGMT_NO_PERMISSIONS_TO_VIEW_PAGE&quot;,
                    Enumerations.MessageType.ErrorMessage),
                    ResolveUrl(Constants.URL_ENTERPRISE), null, Context);

                return;
            }

            if (listModel.xmlModel != null &amp;&amp; listModel.xmlModel.form != null)
                listModel.xmlModel.form.RequestParameters = UIHelper.GetRequestParams();

            ContextElement = ContextMenuManager.Instance.GetContextElement(listModel);
            ModuleId = listModel.ModuleId;
            _IsWorkflowAssociated = BrixWorkflowManager.Instance.IsWorkflowAssociated(WFFormName(), Request[&quot;PID&quot;],
                Request[&quot;ParentID&quot;]);
            if (!listModel.DisplayWorkFlowHistory &amp;&amp; _IsWorkflowAssociated)
                listModel.DisplayWorkFlowHistory = listModel.DisplayWorkFlowStatus = true;

            if (!listModel.DisplayWorkFlowAssociation &amp;&amp; _IsWorkflowAssociated &amp;&amp;
                UserDetail.GetCurrentUserDetail() != null &amp;&amp; UserDetail.GetCurrentUserDetail().RID == 1)
                //If User is admin and workflow is published for this module then WorkFlow Association button will show
                listModel.DisplayWorkFlowAssociation = true;
            if (!listModel.DisplayWorkFlowHelpDescription &amp;&amp; _IsWorkflowAssociated &amp;&amp;
                UserDetail.GetCurrentUserDetail() != null)
                //If User is admin and workflow is published for this module then WorkFlow Association button will show
                listModel.DisplayWorkFlowHelpDescription = true;

            if (null == _ModuleComponents)
                InitModuleComponents();
            if (!listModel.DisplayWorkFlowUsers &amp;&amp; _ModuleComponents.Contains(&quot;ShowWorkflowUsersInListPage&quot;) &amp;&amp;
                _IsWorkflowAssociated)
                listModel.DisplayWorkFlowUsers = true;

            if (!listModel.DisplayCheckList &amp;&amp; ChecklistManager.Instance.IsCheckListAssociated(WFFormName()))
                listModel.DisplayCheckList = true;
        }

        //private void HandleGridDblClick(object sender, ClickEventArgs e)
        //{
        //    var list = (List&lt;string&gt;)Context.Items[Constants.MODULE_PERMISSIONS];
        //    if (list.Contains(Constants.MODFEAT_VIEW) || (ModuleId == Constants.MODID_ENTPRSE &amp;&amp; list.Contains(Constants.MODFEAT_VISIBILITY)))
        //        listModel.HandleGridDblClick(e.Row);
        //}

        private void HandleTGridDoubleClick(object sender, GridCommandEventArgs e)
        {
            var list = (List&lt;string&gt;)Context.Items[Constants.MODULE_PERMISSIONS];
            if (list.Contains(Constants.MODFEAT_VIEW) ||
                (ModuleId == Constants.MODID_ENTPRSE &amp;&amp; list.Contains(Constants.MODFEAT_VISIBILITY)))
                //listModel.GridSelectedIndexes = e.Item.RowIndex.ToString2(); // e.Item.OwnerTableView.Items[e.Item.RowIndex].ToString2();
                if (e.Item.OwnerTableView.ChildSelectedItems.Count &gt; 0)
                    listModel.HandleGridDblClick(e.Item.OwnerTableView.ChildSelectedItems[0] as GridDataItem);
        }

        protected override void OnInit(EventArgs e)
        {
            if (!listModel.DisplayWorkFlowActionOnListPage)
                ShowWorkFlowActionOnListPage = false;

            //listModel.brixGrid = brixGrid;
            listModel.mwGrid = MWGrid;

            listModel.OnInit();
            listModel.DateEditorControlID = wdcDate.UniqueID;

            PageTitle = listModel.Header;
            listModel.ListGrid = ContextElementRadGrid = MWGrid;

            listModel.BrixExcelExporter = UltraWebGridExcelExporter1;
            //To make the DownloadName and WorksheetName accept non alphanumeric characters.
            listModel.BrixExcelExporter.NameValidating += BrixExcelExporter_NameValidating;

            listModel.BrixExcelExporter.CellExported += BrixExcelExporter_CellExported;

            string showWfActions = (listModel.ModuleId == &quot;DOCMGMT&quot; || _IsWorkflowAssociated) &amp;&amp;
                                   (MWGrid.MasterTableView.GetColumnSafe(&quot;Multi&quot;).Display)
                ? (EnableWFActionsJSFunction + &quot;(&#39;&quot; + MWGrid.ClientID + &quot;&#39;);&quot;)
                : &quot;&quot;;
            if (null == _ModuleComponents) InitModuleComponents();
            if (!_ModuleComponents.Contains(&quot;ShowWorkflowActionsInListPage&quot;))
            {
                listModel.DisplayWorkFlowActionOnListPage = ShowWorkFlowActionOnListPage = false;
            }

            if (_ModuleComponents.Contains(&quot;ShowWorkflowActionsInListPage&quot;) &amp;&amp; listModel.DisplayWorkFlowActionOnListPage)
            {
                RegisterStartupScript(&quot;function ListPgCellClick(){ &quot; + showWfActions + &quot;}&quot;);

                //ToDo: Vefify these events and change to appropriate if they don&#39;t work
                MWGrid.ClientSettings.ClientEvents.OnRowSelected = &quot;ListPgCellClick&quot;;
                MWGrid.ClientSettings.ClientEvents.OnRowDeselected = &quot;ListPgCellClick&quot;;
            }
            if (!listModel.EnableGridDblClick)
            {
                MWGrid.ClientSettings.ClientEvents.OnRowDblClick = &quot;&quot;;
            }

            CreateToolBarMenu(listModel.MenuGroups, MainToolBar_MenuItemClick);

            PopupExtender = (ModalPopupExtender)Master?.FindControl(&quot;PopupExtender&quot;);
            PopupSubmit = (ModalPopupExtender)Master?.FindControl(&quot;PopupSubmit&quot;);

            if (!string.IsNullOrEmpty(Request.QueryString[Constants.QRY_PROJECTID]))
            {
                if (CacheManager.Instance.IsIntegrated(Request.QueryString[Constants.QRY_PROJECTID].ToInt32_2()))
                {
                    aspPnlSubmition.Visible = true;
                    PopupSubmit?.AddNewPopup(aspPnlSubmition.ClientID, btnSubPopup.ClientID, btnSubClose.ClientID, 200,
                        400);
                    listModel.SubmittionDateControl = btnSubDates.ClientID;
                    listModel.SubmitionDatePicker = wdcSubmitionDate;
                }
            }
            if (UserDetail.GetCurrentUserDetail().RID.Equals(1))
            {
                ColumnSettings.IsAdminUser = true;
                ColumnSettings.Roles = UserManager.Instance.GetRoles();
            }
            ColumnSettings.ListContext = context;
            ColumnSettings.Save += ColumnSettings_Save;
            PopupExtender.Visible = true;

            //Get Page Size from the database
            ColumnSettings.DefaultPageSize = MWGrid.PageSize;
            PageSize = ColumnSettings.InitPageSize(&quot;User&quot;);

            PopupExtender.AddNewPopup(pnlColumnSettings.ClientID,
                btnColumnSettings.ClientID,
                ColumnSettings.CancelButton.ClientID, 500, 350, &quot;Customize List&quot;);
            ColumnSettings.CancelButton.Attributes.Add(&quot;onclick&quot;,
                string.Format(&quot;$(&#39;#{0}&#39;).dialog(&#39;close&#39;)&quot;, pnlColumnSettings.ClientID));

            if (MailMergeManager.IsMailMergeEnabled)
            {
                //Mail Merge Platform-Existing
                //***************************************************
                //pnlMailMerge.Visible = true;

                ////mmMailMergeControl.ModuleID = listModel.ModuleId;
                //mmMailMergeControl.ListModelInstance = listModel;
                //mmMailMergeControl.ListDataSource = new MailMergeControl.GetListDataSource(GetDataSourceforMailMerge);

                //PopupExtender.AddNewPopup(pnlMailMerge.ClientID, btnMailMerge.ClientID,
                //    mmMailMergeControl.CancelButton.ClientID, 550, 590, &quot;Mail Merge&quot;);
                //mmMailMergeControl.CancelButton.Attributes.Add(&quot;onclick&quot;,
                //    string.Format(&quot;$(&#39;#{0}&#39;).dialog(&#39;close&#39;)&quot;, pnlMailMerge.ClientID));

                //****************************************************

                //Mail Merge Manage
                //***************************************************
                pnlMailMergeManage.Visible = true;

                mmMailMergeManageControl.ListModelInstance = listModel;
                PopupExtender.AddNewPopup(pnlMailMergeManage.ClientID, btnMailMergeManage.ClientID,
                    mmMailMergeManageControl.CancelButton.ClientID, 550, 590, &quot;Mail Merge Manage&quot;);
                mmMailMergeManageControl.CancelButton.Attributes.Add(&quot;onclick&quot;,
                    string.Format(&quot;$(&#39;#{0}&#39;).dialog(&#39;close&#39;);&quot;, pnlMailMergeManage.ClientID));

                mmMailMergeManageControl.SaveButton.Attributes.Add(&quot;onclick&quot;, $&quot;CloseMailMergeAndManage(&#39;{pnlMailMergeManage.ClientID}&#39;);&quot;);

                //****************************************************

                //Mail Merge And Attach
                //***************************************************
                pnlMailMergeAndAttach.Visible = true;

                mmMailMergeAndAttachControl.ModuleId = WFFormName();
                mmMailMergeAndAttachControl.ListModelInstance = listModel;
                mmMailMergeAndAttachControl.isSingleInstance = false;

                PopupExtender.AddNewPopup(pnlMailMergeAndAttach.ClientID, btnMailMergeAndAttach.ClientID,
                    mmMailMergeAndAttachControl.CancelButton.ClientID, 200, 522, &quot;Merge And Attach&quot;);
                mmMailMergeAndAttachControl.CancelButton.Attributes.Add(&quot;onclick&quot;,
                    string.Format(&quot;$(&#39;#{0}&#39;).dialog(&#39;close&#39;);&quot;, pnlMailMergeAndAttach.ClientID));
                //****************************************************

                //Mail Merge And Email
                //***************************************************
                pnlMailMergeAndEmail.Visible = true;

                mmMailMergeAndEmailControl.ModuleId = WFFormName();
                mmMailMergeAndEmailControl.isSingleInstance = false;
                mmMailMergeAndEmailControl.ListModelInstance = listModel;

                PopupExtender.AddNewPopup(pnlMailMergeAndEmail.ClientID, btnMailMergeAndEmail.ClientID,
                    mmMailMergeAndEmailControl.CancelButton.ClientID, 200, 522, &quot;Merge And Email&quot;);
                mmMailMergeAndEmailControl.CancelButton.Attributes.Add(&quot;onclick&quot;,
                    string.Format(&quot;$(&#39;#{0}&#39;).dialog(&#39;close&#39;);&quot;, pnlMailMergeAndEmail.ClientID));

                //****************************************************
            }

            if (listModel.DisplayNotesforReject)
            {
                PopupExtender.AddNewPopup(aspPnlNotes.ClientID, btnRejectNotes.ClientID, btnCncl.ClientID, 300, 565);
            }

            if (listModel.DisplayWorkFlowAllAssociations)
            {//Workflow Associations in Workflow list page
                PnlPageAssociation.Visible = true;

                PopupExtender.AddNewPopup(PnlPageAssociation.ClientID,
                btnWFAllAssociation.ClientID,
                ucPageAssociation.CancelButton.ClientID, 350, 473, &quot;Workflow Associations&quot;,
                &quot;var v = ValidatePageAssociation(); if (v == undefined || v == false) return false;&quot;);
                ucPageAssociation.CancelButton.Attributes.Add(&quot;onclick&quot;,
                    string.Format(&quot;$(&#39;#{0}&#39;).dialog(&#39;close&#39;)&quot;, PnlPageAssociation.ClientID));
            }

            if (listModel.DisplayWorkFlowHistory || _IsWorkflowAssociated)
            {
                approvalHistory = (ApprovalHistory)this.Master.FindControl(&quot;appWorkflowHistory&quot;);
                approvalHistory.Visible = true;
                btnWFHistory = (Button)this.Master.FindControl(&quot;btnWFHistory&quot;);

                approvalHistory.SetInstanceID(MWGrid, listModel.ModuleId);
                PopupExtender.AddNewPopup(approvalHistory.aspPnlWF.ClientID, btnWFHistory.ClientID,
                    approvalHistory.btnCncl.ClientID, 450, 600, &quot;WorkFlow History&quot;);
                approvalHistory.btnCncl.Attributes.Add(&quot;onclick&quot;,
                    string.Format(&quot;$(&#39;#{0}&#39;).dialog(&#39;close&#39;); return false;&quot;, approvalHistory.aspPnlWF.ClientID));
                if (listModel.DisplayWorkFlowStatus)
                {
                    if (MainToolBar.GetMenuReference(&quot;lnkWorkFlowStatus&quot;) != null)
                        MainToolBar.GetMenuReference(&quot;lnkWorkFlowStatus&quot;).AddAttribute(&quot;href&quot;, &quot;#&quot;);
                }
            }

            if (listModel.DisplayWorkFlowAssociation || _IsWorkflowAssociated)
            //For getting AssociatedFormID in WFAssociation.ascx.cs user control and open Popup window when click on button
            {
                appWorkflowAssociation.Visible = true;

                appWorkflowAssociation.SetInstanceID(MWGrid, WFFormName());
                PopupExtender.AddNewPopup(appWorkflowAssociation.aspPnlWF.ClientID, btnWFAssociation.ClientID,
                    appWorkflowAssociation.btnCncl.ClientID, 350, 400, &quot;Workflow Association&quot;);
                //Assign Workflow association popup window&#39;s hight,width and title here
                appWorkflowAssociation.btnCncl.Attributes.Add(&quot;onclick&quot;,
                    string.Format(&quot;$(&#39;#{0}&#39;).dialog(&#39;close&#39;); return false;&quot;, appWorkflowAssociation.aspPnlWF.ClientID));
            }

            if (listModel.DisplayWorkFlowUsers &amp;&amp; (listModel.ModuleId == &quot;DOCMGMT&quot; || _IsWorkflowAssociated))
            {
                appWorkflowUserOverriding.Visible = true;

                appWorkflowUserOverriding.SetInstanceID(MWGrid, WFFormName());
                appWorkflowUserOverriding.GetFormId = new WorkflowUserOverriding.GetForm(WFFormName);
                PopupExtender.AddNewPopup(appWorkflowUserOverriding.aspPnlWF.ClientID, btnWFUserOverriding.ClientID,
                    appWorkflowUserOverriding.btnCncl.ClientID, 550, 760, &quot;Workflow User(s)&quot;);
                //Assign Workflow association popup window&#39;s hight,width and title here
                appWorkflowUserOverriding.btnCncl.Attributes.Add(&quot;onclick&quot;,
                    string.Format(&quot;$(&#39;#{0}&#39;).dialog(&#39;close&#39;); return false;&quot;, appWorkflowUserOverriding.aspPnlWF.ClientID));
                //Closing the popup window
            }

            if (listModel.DisplayCheckList)
            {
                formCheckLists = (FormCheckLists)this.Master.FindControl(&quot;appFormCheckLists&quot;);
                formCheckLists.Visible = true;
                btnFormCheckLists = (Button)this.Master.FindControl(&quot;btnFormCheckLists&quot;);

                formCheckLists.SetInstanceID(MWGrid, WFFormName(), listModel.QueryStringName);
                formCheckLists.GetFormId = new FormCheckLists.GetForm(WFFormName);
                PopupExtender.AddNewPopup(formCheckLists.aspPnlChkList.ClientID, btnFormCheckLists.ClientID,
                    formCheckLists.btnCncl.ClientID, 550, 760, &quot;CheckList(s)&quot;);
                formCheckLists.btnCncl.Attributes.Add(&quot;onclick&quot;,
                    string.Format(&quot;$(&#39;#{0}&#39;).dialog(&#39;close&#39;); return false;&quot;, formCheckLists.aspPnlChkList.ClientID));
            }

            if (listModel.ShowMapView)
            {
                esriMap = (ESRIMapControl)Page.LoadControl(&quot;~/Modules/UserControls/ESRIMapControl.ascx&quot;);
                pnlMap.Controls.Add(esriMap);
            }
            base.OnInit(e);
        }

        //To make the DownloadName and WorksheetName accept non alphanumeric characters.
        private void BrixExcelExporter_NameValidating(object sender, NameValidatingEventArgs e)
        {
            e.ApprovedName = e.ProposedName.Replace(&#39;/&#39;, &#39;-&#39;);
        }

        private void BrixExcelExporter_CellExported(object sender, CellExportedEventArgs e)
        {
            if (e.GridColumn.DataType == &quot;System.DateTime&quot;)
            {
                if ((e.Value != null) &amp;&amp; (e.GridRow != null))
                {
                    IWorksheetCellFormat cfCellFmt;
                    int rIndex = e.CurrentRowIndex;
                    int cIndex = e.CurrentColumnIndex;

                    cfCellFmt = e.CurrentWorksheet.Rows[rIndex].Cells[cIndex].CellFormat;
                    cfCellFmt.FormatString = AMP3ApplicationSettings.Instance.FORMAT_DATE;

                    e.CurrentWorksheet.Rows[rIndex].Cells[cIndex].CellFormat.SetFormatting(cfCellFmt);
                }
            }
        }

        protected void approvalWorkflow_ApproveClicked(object sender, ApprovalEventArgs e)
        {
            if (e != null &amp;&amp; !e.Action.Equals(ApprovalAction.None))
            {
                if (e.Action.Equals(ApprovalAction.Approve))
                {
                    lnkApprove_Click(sender, new EventArgs());
                }
                else if (e.Action.Equals(ApprovalAction.Unapprove))
                {
                    var tea = new ToolBarEventArg();
                    tea.Text = e.Action.ToString2();
                    MainToolBar_MenuItemClick(sender, tea);
                }
                else if (e.Action.Equals(ApprovalAction.Reject))
                {
                    lnkReject_Click(sender, new EventArgs());
                }
            }
            else
            {
                BindGridControl();
            }
        }

        protected void Page_Init(object sender, System.EventArgs e)
        {
            //Add a custom filter menu item, called, &quot;Clear All Filter&quot; to the list. On click of this, clear filters from all the columns
            RadMenuItem menuItem = this.MWGrid.FilterMenu.Items.Find(x =&gt; x.Value == &quot;Custom&quot;);
            if (menuItem != null)
            {
                menuItem.Text = &quot;Clear All Filter&quot;;
                menuItem.Visible = true;
                menuItem.PostBack = false;

                menuItem.NavigateUrl = listModel.FilterTemplate_GetNavigationURL_WithClearFilter();
            }

            //Commenting the below line as all the event handlers are executed twice in the derived list model due to this
            //SetJcriptDetailsForMenuButtons();
        }

        //protected void FilterMenu_ItemClick(object sender, RadMenuEventArgs e)
        //{
        //    GridFilteringItem filterItem = this.MWGrid.MasterTableView.GetItems(GridItemType.FilteringItem)[0] as GridFilteringItem;
        //    filterItem.FireCommandEvent(&quot;ClearAllFilter&quot;, new Pair(e.Item.Value, null));
        //}

        private bool IsProposedProject
        {
            get
            {
                return (HttpContext.Current.Request == null ||
                        string.IsNullOrEmpty(HttpContext.Current.Request.QueryString[&quot;PP&quot;])
                    ? false
                    : (HttpContext.Current.Request.QueryString[&quot;PP&quot;] == &quot;1&quot;) ? true : false);
            }
        }

        protected void Page_Load(object sender, EventArgs e)
        {
            if (!IsPostBack)
            {
                hdnFileDownloadTokenID.Value = Guid.NewGuid().ToString();
            }

            listModel.ExportFileDownloadTokenID = hdnFileDownloadTokenID.Value;
            listModel.ExportFileDownloadTokenValue = string.IsNullOrEmpty(hdnFileDownloadToken.Value) ? string.Empty : hdnFileDownloadToken.Value;

            //Patch for Telerik Issue: http://www.telerik.com/forums/radgrid-filter-with-and-and-or
            GridFilterFunction.IllegalStrings = new string[] { }; //GridFilterFunction.IllegalStrings.Where(t =&gt; t != &quot; AND &quot; &amp;&amp; t != &quot; OR &quot;).ToArray();
            MWGrid.EnableLinqExpressions = false;

            string workflowErrorFromLastPage = (string)Session[&quot;WorkflowErrOnLastPage&quot;];
            string WorkflowSuccessOnLastPage = (string)Session[&quot;WorkflowSuccessOnLastPage&quot;];

            UserDetail userDetail = UserDetail.GetCurrentUserDetail();
            if (userDetail != null &amp;&amp; userDetail.IsADACompliant)
            {
                MWGrid.ClientSettings.Scrolling.AllowScroll = false;
                divRadGrid.Style[&quot;overflow&quot;] = &quot;auto&quot;;
                MWGrid.Attributes.Add(&quot;summary&quot;, listModel.Header);
            }
            else
            {
                divRadGrid.Style[&quot;overflow&quot;] = &quot;none&quot;;
                MWGrid.ClientSettings.Scrolling.AllowScroll = true;
            }

            if (!string.IsNullOrEmpty(workflowErrorFromLastPage))
                ShowError(workflowErrorFromLastPage.Replace(&quot;&#39;&quot;, &quot;\\&#39;&quot;).Replace(&quot;\n&quot;, &quot;\\n&quot;));
            if (!string.IsNullOrEmpty(WorkflowSuccessOnLastPage))
                ShowSuccess(WorkflowSuccessOnLastPage.Replace(&quot;&#39;&quot;, &quot;\\&#39;&quot;).Replace(&quot;\n&quot;, &quot;\\n&quot;));

            Session[&quot;WorkflowErrOnLastPage&quot;] = &quot;&quot;;
            Session[&quot;WorkflowSuccessOnLastPage&quot;] = &quot;&quot;;

            string calBackReference = Page.ClientScript.GetCallbackEventReference(this, &quot;arg&quot;, &quot;ReceiveServerData&quot;,
                &quot;context&quot;);
            string callbackScript;
            callbackScript = &quot;function SendServerRequest(arg,context) { try{ ShowLoadingOnRequest(); }catch(ex){ } \n&quot; +
                             calBackReference + &quot;;}&quot;;
            RegisterClientScriptBlock(callbackScript, this, &quot;SendServerRequest&quot;);

            var list = (List&lt;string&gt;)Context.Items[Constants.MODULE_PERMISSIONS];
            if (!String.IsNullOrEmpty(Request[&quot;ParentID&quot;]))
            {
                if (!list.Contains(Constants.MODFEAT_VISIBILITY))
                {
                    UIHelper.RedirectURL(
                        MessageResourceManager.GetString(&quot;E_USRMGMT_NO_PERMISSIONS_TO_VIEW_PAGE&quot;, Enumerations.MessageType.ErrorMessage),
                        ResolveUrl((IsProposedProject)
                            ? &quot;~/Common/BrixListPage.aspx?context=PROJECT&amp;PP=1&quot;
                            : &quot;~/Common/BrixListPage.aspx?context=PROJECT&quot;), null, Context);
                }
            }
            if (listModel.DisableRoleSelection)
                UIHelper.DisableRoleSelection(Page);
            else
                UIHelper.EnableRoleSelection(Page);

            //ToDo: test this and change the event if it doesn&#39;t work
            //MWGrid.ClientSettings.ClientEvents.OnKeyPress = &quot;grdResource_EditKeyDownHandler&quot;;

            // brixGrid.UpdateRow += delegate(Object gridObj, RowEventArgs rowEvent) { rowEvent.Cancel = true; };
            //Fox for [Double Click not working on Chrome]
            //ToDo: Commented for RadGrid. Looks like a hack for old grid. verify and remove this block if not required.
            /*
            if (Request.Form[&quot;__EVENTARGUMENT&quot;] != null &amp;&amp; Request.Form[&quot;__EVENTARGUMENT&quot;].StartsWith(&quot;RowDblClick&quot;) &amp;&amp;
                Request.Form[&quot;__EVENTTARGET&quot;] != null &amp;&amp; Request.Form[&quot;__EVENTTARGET&quot;] == brixGrid.ClientID.Replace(&quot;_&quot;, &quot;x&quot;) &amp;&amp;
                Request.Browser.Browser == &quot;Chrome&quot; &amp;&amp; brixGrid.DisplayLayout.SelectedRows.Count &gt; 0 &amp;&amp;
                list.Contains(Constants.MODFEAT_VIEW))
            {
                listModel.HandleGridDblClick(MWGrid.SelectedItems[0]);
            }
            */

            // set the page unique context for breadcrum from the list model
            if (string.IsNullOrEmpty(base.PageUniqueID) &amp;&amp; !string.IsNullOrEmpty(listModel.PageUniqueID))
                base.PageUniqueID = listModel.PageUniqueID;
            if (listModel.ShowMapView)
            {
                esriMap.ReadOnlyMap = true;
                esriMap.MapLoadCompleteScript = &quot;LoadDefaultView()&quot;;
            }

            try
            {
                if (listModel != null) listModel.Page_Load();
            }
            catch (Exception ex)
            {
                JavaScriptSerializer JS = new JavaScriptSerializer();
                ShowError(JS.Serialize(ex.Message.Replace(&quot;|&quot;, &quot;&lt;br/&gt;&quot;)));
            }
        }

        protected override void OnPreRender(EventArgs e)
        {
            // Update clear filter value in query string.
            if (Request.QueryString[ListModel.FILTERMENU_QUERYPARAM_KEY_OveriddenFilter] == &quot;1&quot;)
            {
                ClearFilterTextFromSelectedFilterMenu(PageState);

                var nameValues = HttpUtility.ParseQueryString(Request.QueryString.ToString());
                nameValues[ListModel.FILTERMENU_QUERYPARAM_KEY_OveriddenFilter] = &quot;0&quot;;
                string url = Request.Url.AbsolutePath;
                Server.Transfer(url + &quot;?&quot; + nameValues, true); // ToString() is called implicitly
            }

            if (UIHelper.IsOfflineMode)
            {
                foreach (GridDataItem ugr in MWGrid.MasterTableView.Items)
                {
                    // IF THE RECORD IS SYNCHRONISED , JUST CHANGE THE BACKGROUND COLOR AND THE FONT COLOR.
                    if (ugr[&quot;IsClientSync&quot;] != null &amp;&amp; ugr[&quot;IsClientSync&quot;].Text.ToBoolean2())
                    {
                        ugr.BackColor = Color.FromArgb(240, 240, 240);
                        ugr.ForeColor = Color.FromArgb(110, 110, 110);
                        ugr.Font.Italic = true;
                    }
                }
                if (MWGrid.MasterTableView.Items.Count &gt; 0 &amp;&amp;
                    MWGrid.MasterTableView.Columns.FindByUniqueName(&quot;IsClientSync&quot;) != null)
                    MWGrid.MasterTableView.GetColumn(&quot;IsClientSync&quot;).Display = false;
            }

            UseApplyGridWidthStyle = false;
            base.OnPreRender(e);
            listModel.OnPreRender();  // KK: Moved to before column resizing as prerender might change table columns

            /*
            //ToDo: Code should be changed for Hierarchical grid
            if (listModel.HasHierarchicalGrid &amp;&amp; brixGrid.Bands.Count &gt; 1 &amp;&amp; listModel.HierarchicalGridColumnMapping != null)
            {
                for (int k = 0; k &lt; brixGrid.Columns.Count; k++)
                {
                    UltraGridColumn c = brixGrid.Columns[k];
                    if (listModel.HierarchicalGridColumnMapping.ContainsKey(c.Key) &amp;&amp;
                        brixGrid.Bands[1].Columns.Exists(listModel.HierarchicalGridColumnMapping[c.Key]))
                        brixGrid.Bands[1].Columns.FromKey(listModel.HierarchicalGridColumnMapping[c.Key]).Move(c.Index);
                }
            }
             * */

            // This checking is after globalisation
            //Load the column settings from the database
            if (ColumnSettings.AllColumns == null)
            {
                InitColumnSetting();
            }
            else
            {
                ArrangeGridColumns(ColumnSettings.AllColumns);
            }

            ApplyColumnSize(MWGrid);
            FormatAttachmentColumns(MWGrid);
            FormatAnnotationColumns(MWGrid);
            FormatWorkflowColumns(MWGrid);

            // only rebind grid once for all modification.
            // Should perform better, and allow modification of grid by listModel.
            MWGrid.Rebind();

            /*
             * Below method should be called after rebind
             * In the below method, we are setting background color to the rows based on Format Grid functionality
             * IF Rebind() is called after FormatDynamicColumns method, it reverts the changes
             * */
            FormatDynamicColumns(MWGrid);
            listModel.FormatColumns(MWGrid);

            if (ShowWorkFlowActionOnListPage &amp;&amp; (listModel.ModuleId == &quot;DOCMGMT&quot; || _IsWorkflowAssociated))
            {
                RegisterStartupScript(&quot;HideAllWFActions();&quot;, UpdatePanel1, &quot;HideAllWFActionButtons&quot;);
            }

            //Below code is causing the sort filter to disappear and append the sort from PageState
            //Without the below line the code seems to work correctly
            //if (PageState.FilterCriterionType == StateManagementBase.FilterType.Sql)
            //{
            //    this.RestorePageStateUsingCurrentFilter(PageState);
            //    PageState.RestoreFilterState(MWGrid, PageState);
            //}

            //Mail Merge Manage Platform-Existing
            if (pnlMailMerge.Visible)
                mmMailMergeControl.AllColumns = ColumnSettings.AllColumns;

            if (MWGrid.MasterTableView.Items.Count == 0)
            {
                MWGrid.MasterTableView.NoMasterRecordsText = &quot;No records to display&quot;;
            }

            //Hiding reports link in the list page if there are no report under it.
            MenuGroup grpOths = MainToolBar.Groups.Find(grp =&gt; grp.Title == &quot;Others&quot;);
            if (grpOths != null)
            {
                UserControls.Menu rptMenu = grpOths.Menus.Find(m =&gt; m.Title == &quot;Reports&quot;);
                if (rptMenu != null &amp;&amp; rptMenu is MenuButton &amp;&amp; !(rptMenu as MenuButton).HasSubMenus)
                {
                    rptMenu.Visible = false;
                    MainToolBar.Bind();
                }
            }

            if (listModel.DisplayListSave)
            {
                if (MainToolBar.GetMenuReference(&quot;lnkListSave&quot;) != null)
                {
                    MainToolBar.GetMenuReference(&quot;lnkListSave&quot;).OnClientClick = &quot;$find(&#39;&quot; + MWGrid.ClientID +
                                                                                &quot;&#39;).get_batchEditingManager().saveChanges(&#39;&quot; +
                                                                                MWGrid.MasterTableView.ClientID +
                                                                                &quot;&#39;); return false;&quot;;
                }
            }

            //Bugfix: 28383: when checkbox for multi-selection is not displayed then multi select should be disabled for the grid (using Ctrl + click action)
            var multiSelectCheckboxGridCol = MWGrid.Columns.FindByUniqueName(&quot;Multi&quot;);
            if (multiSelectCheckboxGridCol != null &amp;&amp; !multiSelectCheckboxGridCol.Display)
                MWGrid.AllowMultiRowSelection = false;

            if (listModel.ShowMapView &amp;&amp; (ApplicationMapSettings.Instance.ShowMapViewByDefault) || (IsMapFilterClicked))
                hdnViewType.Value = &quot;Map&quot;;
            else
                hdnViewType.Value = &quot;List&quot;;
        }

        private DataTable GetDataSourceforMailMerge(bool isSelRows)
        {
            int pgno = 1;
            int pgcount;
            DataTable dt = null;
            DataSet ds = null;
            if (!isSelRows)
            {
                ds = listModel.GetList(int.MaxValue, string.Empty, string.Empty, ref pgno, out pgcount);
                dt = ds.Tables[0];
            }
            else
            {
                ds = listModel.GetList(1, string.Empty, string.Empty, ref pgno, out pgcount);
                dt = ds.Tables[0];
                dt.Rows.Clear();

                if (MWGrid.MasterTableView.GetColumnSafe(&quot;Multi&quot;).Display)
                {
                    foreach (GridDataItem item in MWGrid.MasterTableView.GetSelectedItems())
                    {
                        CreateDataRowFromGridRow(dt, item);
                    }
                }
                else
                {
                    foreach (GridDataItem item in MWGrid.MasterTableView.Items)
                    {
                        if (item.Selected &amp;&amp; !string.IsNullOrEmpty(item[listModel.QueryStringName].Text))
                        {
                            CreateDataRowFromGridRow(dt, item);
                        }
                    }
                }
            }
            if (listModel.ModuleId == &quot;DOCMGMT&quot; || _IsWorkflowAssociated)
            {
                string key = WFFormKey();
                string formName = WFFormName();
                AddWorkflowColumns(key, formName, ref dt);
                AddWorkflowColumnsToSecondBand(key, formName, ds);
            }
            AddDynamciColumns(ds);
            return dt;
        }

        private void CreateDataRowFromGridRow(DataTable dt, GridDataItem row)
        {
            DataRow newRow = dt.NewRow();
            foreach (DataColumn column in dt.Columns)
            {
                newRow[column.ColumnName] = ((row.OwnerTableView.GetColumnSafe(column.ColumnName) != null)
                    ? (object)row[column.ColumnName].Text
                    : DBNull.Value);
            }
            dt.Rows.Add(newRow);
        }

        #endregion &quot;Overriden Functions&quot;

        #region Grid Column Settings

        private void InitColumnSetting()
        {
            string scope = &quot;User&quot;;
            UserDetail ud = UserDetail.GetCurrentUserDetail();
            Dictionary&lt;string, ColumnDetails&gt; cols = ColumnSettingManager.Instance.GetColumnSettings(context, ud.UID, ud.RID, ref scope);
            ColumnSettings.Scope = scope;
            int idx = cols.Count + 1;

            using (DataSet dsDynColumns = DynamicColumnsManager.Instance.GetDynamicColumns(context, &quot;BrixListPage&quot;))
            {
                foreach (GridColumn column in MWGrid.MasterTableView.AutoGeneratedColumns.OrderBy(c =&gt; c.OrderIndex))
                {
                    string controlName = Aurigo.Brix.Platform.BusinessLayer.Utility.MWGrid.GetDatabaseFriendlyExpression(column.UniqueName);

                    if (column.Display &amp;&amp; !cols.ContainsKey(controlName))
                    {
                        if (dsDynColumns != null &amp;&amp; dsDynColumns.Tables.Count &gt; 0 &amp;&amp;
                            dsDynColumns.Tables[0].Rows.Count &gt; 0)
                        {
                            DataRow row = dsDynColumns.Tables[0].Select(&quot;ExpressionName=&#39;&quot; + controlName + &quot;&#39;&quot;).FirstOrDefault();

                            if (row != null)
                            {
                                column.HeaderText = UIHelper.JavascriptEncode(Convert.ToString(row[&quot;DisplayName&quot;]));
                            }
                        }
                        cols.Add(controlName,
                            new ColumnDetails
                            {
                                ColumnKey = controlName,
                                ColumnCaption = Aurigo.Brix.Platform.BusinessLayer.Utility.MWGrid.GetDatabaseFriendlyExpression(column.HeaderText),
                                IsVisible = column.Display,
                                Scope = scope,
                                Order = idx++
                            });
                    }
                }
            }

            ArrangeGridColumns(cols);
            ColumnSettings.AllColumns = cols;
        }

        private void ColumnSettings_Save(object sender, EventArgs e)
        {
            var cs = sender as ColumnSettings;
            // Save to Database
            var columnList = new List&lt;ColumnDetails&gt;();
            foreach (var col in cs.ArrangedColumns)
            {
                string caption = col.Value.Split(&#39;|&#39;)[0];
                bool isVisible = Convert.ToBoolean(col.Value.Split(&#39;|&#39;)[1]);
                columnList.Add(new ColumnDetails
                {
                    Context = context,
                    ColumnKey = col.Key,
                    ColumnCaption = caption,
                    Scope = cs.Scope,
                    IsVisible = isVisible,
                    RoleID = cs.RoleID,
                    UserID = UserDetail.GetCurrentUserDetail().UID
                });
            }
            if (columnList.Count &gt; 0)
                ColumnSettingManager.Instance.AddColumnSettings(columnList);
            Response.Redirect(Request.Url.PathAndQuery, true);
        }

        private bool IsHtmlNotEncoded(string Caption)
        {
            try
            {
                if (string.IsNullOrEmpty(Caption))
                    return true;
                return (HttpUtility.HtmlEncode(Caption).Equals(Caption, StringComparison.OrdinalIgnoreCase));
            }
            catch
            {
                return false;
            }
        }

        private void ArrangeGridColumns(Dictionary&lt;string, ColumnDetails&gt; cols)
        {
            if (cols == null || cols.Count == 0)
                return;
            var clientSelectColumn = MWGrid.MasterTableView.GetColumnSafe(&quot;Multi&quot;);
            if (clientSelectColumn != null)
            {
                clientSelectColumn.OrderIndex = 0;
            }
            var InvalidColumns = new List&lt;string&gt;();
            bool enableListPageHTMLEncodeContent = CoreModuleComponents.Contains(&quot;EnableListPageHTMLEncodeContent&quot;);

            // To avoid XSS attach
            foreach (GridColumn col in MWGrid.MasterTableView.AutoGeneratedColumns)
            {
                //This property permits to have html sensitive characters in the column&#39;s cells. The characters like &lt; &gt; &quot; etc. will be converted to &amp;lt; &amp;gt; and &amp;quot; accordingly
                if (enableListPageHTMLEncodeContent)
                {
                    //IsHtmlNotEncoded(col.HeaderText) &amp;&amp;
                    if ((col is GridBoundColumn) &amp;&amp;
                        string.IsNullOrEmpty((col as GridBoundColumn).DataFormatString))
                        (col as GridBoundColumn).HtmlEncode = true;
                }
            }

            foreach (var col in cols)
            {
                bool isExists = false;
                for (int k = 0; k &lt; MWGrid.MasterTableView.AutoGeneratedColumns.Count(); k++)
                {
                    GridColumn c = MWGrid.MasterTableView.AutoGeneratedColumns[k];
                    ////This property permits to have html sensitive characters in the column&#39;s cells. The characters like &lt; &gt; &quot; etc. will be converted to &amp;lt; &amp;gt; and &amp;quot; accordingly
                    //if (enableListPageHTMLEncodeContent)
                    //{
                    //    if (IsHtmlNotEncoded(c.HeaderText) &amp;&amp; (c is GridBoundColumn) &amp;&amp;
                    //        string.IsNullOrEmpty((c as GridBoundColumn).DataFormatString))
                    //        (c as GridBoundColumn).HtmlEncode = true;
                    //}
                    if (
                        Aurigo.Brix.Platform.BusinessLayer.Utility.MWGrid.GetDatabaseFriendlyExpression(c.UniqueName)
                            .ToUpper()
                            .Equals(col.Key.ToUpper()) &amp;&amp; c.Display)
                    {
                        c.Display = col.Value.IsVisible;
                        isExists = true;
                        if (col.Value.IsVisible)
                        {
                            //Customize-List settings are applied here.
                            //User settings on caption or column order are applied here.
                            //Order &quot;0&quot; is used for client-select column. Customize-List settings order starts from 1.
                            c.HeaderText = col.Value.ColumnCaption;
                            c.OrderIndex = col.Value.Order;

                            /*
                            //ToDo: Handle column reposition for  HierarchicalGrid
                            if (listModel.HasHierarchicalGrid &amp;&amp; brixGrid.Bands.Count &gt; 1 &amp;&amp;
                                listModel.HierarchicalGridColumnMapping != null &amp;&amp;
                                listModel.HierarchicalGridColumnMapping.ContainsKey(c.UniqueName) &amp;&amp;
                                brixGrid.Bands[1].Columns.Exists(listModel.HierarchicalGridColumnMapping[c.UniqueName]))
                                brixGrid.Bands[1].Columns.FromKey(listModel.HierarchicalGridColumnMapping[c.UniqueName]).Move(indx);
                             */
                        }
                        break;
                    }
                }
                if (!isExists &amp;&amp; !InvalidColumns.Contains(col.Key) &amp;&amp;
                    MWGrid.MasterTableView.GetColumnSafe(col.Key) == null)
                    InvalidColumns.Add(col.Key);
            }

            if (InvalidColumns.Count &gt; 0)
            {
                foreach (string key in InvalidColumns)
                    cols.Remove(key);
                ColumnSettingManager.Instance.DeleteColumnSettings(InvalidColumns, context);
            }
        }

        #endregion Grid Column Settings

        #region &quot;Page Events&quot;

        public string GetInitilize_ClientId_ForUseInJavascript()
        {
            JavascriptRenderFramework jrf = new JavascriptRenderFramework(&quot;CONST_BrixListPage&quot;);

            jrf.Add_ClientId(
                 MWGrid
                 , msg
                 , txtNotes
                 , btnSubDates
                 , aspPnlSubmition

                 , chkFilters
                 , hdnMapFilter
                 , hdnViewType
                 , UpdatePanel1
                 , pnlMapView
            );

            jrf.Add_ClientId(&quot;RadRibbonBar&quot;, this.MainToolBar.RadRibbonBarControl_ClientId);

            string scriptString = jrf.Generate();

            return scriptString;
            //ClientScript.RegisterClientScriptBlock(GetType(), &quot;ProjectInitilizeScript&quot;, scriptString, true);
            //ClientScript.RegisterClientScriptInclude(&quot;projects&quot;, ResolveClientUrl(&quot;~/Scripts/login.js&quot;));
        }

        private DataRow drCurrentRow;

        protected void lnkBack_Click(object sender, EventArgs e)
        {
            try
            {
                Response.Redirect(listModel.BackUrl, true);
            }
            catch (Exception ex)
            {
                JavaScriptSerializer JS = new JavaScriptSerializer();
                ShowError(JS.Serialize(ex.Message.Replace(&quot;|&quot;, &quot;\\n&quot;)));
            }
        }

        protected void lnkDocuments_Click(object sender, EventArgs e)
        {
            try
            {
                Response.Redirect(listModel.DocumentUrl, true);
            }
            catch (Exception ex)
            {
                JavaScriptSerializer JS = new JavaScriptSerializer();
                ShowError(JS.Serialize(ex.Message.Replace(&quot;|&quot;, &quot;\\n&quot;)));
            }
        }

        private new void SetJcriptDetailsForMenuButtons()
        {
            if (listModel.DisplayDeleteVieworDB)
                MainToolBar.GetMenuReference(&quot;lnkDeleteDB&quot;).OnClientClick = &quot;if(lnkValidation(&#39;&quot; +
                                                                            Convert.ToInt32(ValidateSelection.OneItem,
                                                                                CultureInfo.CurrentCulture) +
                                                                            &quot;&#39;, &#39;&quot; + MWGrid.ClientID + &quot;&#39;, &#39;&quot; +
                                                                            listModel.QueryStringName +
                                                                            &quot;&#39;)) return confirm(&#39;Are you sure you want to delete the record from the database?&#39;); else return false;&quot;;
            if (listModel.DisplayDeleteVieworDB)
                MainToolBar.GetMenuReference(&quot;lnkDeleteView&quot;).OnClientClick = &quot;if(lnkValidation(&#39;&quot; +
                                                                              Convert.ToInt32(ValidateSelection.OneItem,
                                                                                  CultureInfo.CurrentCulture) +
                                                                              &quot;&#39;, &#39;&quot; + MWGrid.ClientID + &quot;&#39;, &#39;&quot; +
                                                                              listModel.QueryStringName +
                                                                              &quot;&#39;)) return confirm(&#39;Are you sure you want to delete the record from the view?&#39;); else return false;&quot;;
            if (MainToolBar.GetMenuReference(&quot;lnkCopy&quot;) != null &amp;&amp; listModel.DisplayCopy)
                MainToolBar.GetMenuReference(&quot;lnkCopy&quot;).OnClientClick = &quot;if(lnkValidation(&#39;&quot; +
                                                                        Convert.ToInt32(
                                                                            ValidateSelection.OneOrMoreItems,
                                                                            CultureInfo.CurrentCulture) + &quot;&#39;, &#39;&quot; +
                                                                        MWGrid.ClientID + &quot;&#39;, &#39;&quot; +
                                                                        listModel.QueryStringName +
                                                                        &quot;&#39;)) return ConfirmAction(&#39;Copy&#39;); else return false;&quot;;
            if (listModel.DisplayEdit)
                MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).OnClientClick = &quot;return lnkValidation(&#39;&quot; +
                                                                        Convert.ToInt32(ValidateSelection.OneItem,
                                                                            CultureInfo.CurrentCulture) +
                                                                        &quot;&#39;, &#39;&quot; + MWGrid.ClientID + &quot;&#39;, &#39;&quot; +
                                                                        listModel.QueryStringName + &quot;&#39;);&quot;;
            if (listModel.DisplayCloseOut)
                MainToolBar.GetMenuReference(&quot;lnkCloseOut&quot;).OnClientClick = &quot;if(lnkValidation(&#39;&quot; +
                                                                            Convert.ToInt32(ValidateSelection.OneItem,
                                                                                CultureInfo.CurrentCulture) +
                                                                            &quot;&#39;, &#39;&quot; + MWGrid.ClientID + &quot;&#39;, &#39;&quot; +
                                                                            listModel.QueryStringName +
                                                                            &quot;&#39;)) return confirm(&#39;Are you sure you want to closeout?&#39;); else return false;&quot;;
            if (listModel.DisplayApprove)
            {
                //if (listModel.DisplayWorkFlow)
                //    MainToolBar.AddAttributeToMenu(&quot;lnkApprove&quot;, &quot;onClick&quot;, &quot;if (lnkValidation(&#39;&quot; + (listModel.HasMultiApprove ? Convert.ToInt32(ValidateSelection.OneOrMoreItems, CultureInfo.CurrentCulture) : Convert.ToInt32(ValidateSelection.OneItem, CultureInfo.CurrentCulture)) + &quot;&#39;, &#39;&quot; + brixGrid.ClientID + &quot;&#39;, &#39;&quot; + listModel.QueryStringName + &quot;&#39;)) ShowWFPopup(&#39;&quot; + btnWFApprove.ClientID + &quot;&#39;); return false;&quot;);
                //else
                MainToolBar.GetMenuReference(&quot;lnkApprove&quot;).OnClientClick = &quot;if (lnkValidation(&#39;&quot; +
                                                                           (listModel.HasMultiApprove
                                                                               ? Convert.ToInt32(
                                                                                   ValidateSelection.OneOrMoreItems,
                                                                                   CultureInfo.CurrentCulture)
                                                                               : Convert.ToInt32(
                                                                                   ValidateSelection.OneItem,
                                                                                   CultureInfo.CurrentCulture)) + &quot;&#39;, &#39;&quot; +
                                                                           MWGrid.ClientID + &quot;&#39;, &#39;&quot; +
                                                                           listModel.QueryStringName +
                                                                           &quot;&#39;)) return ConfirmAction(&#39;Approve&#39;); else return false;&quot;;
            }
            if (listModel.DisplayWorkFlowHistory || _IsWorkflowAssociated)
            {
                MainToolBar.GetMenuReference(&quot;lnkWorkFlowHistory&quot;).OnClientClick =
                    string.Format(
                        &quot;if(lnkValidation(&#39;{0}&#39;, &#39;{1}&#39;, &#39;{2}&#39;)) {{ LoadWorkfowHistory(); ShowWFPopup(&#39;{3}&#39;); }} return false;&quot;,
                        ValidateSelection.OneItem.ToInt32_2(), MWGrid.ClientID, listModel.QueryStringName,
                        btnWFHistory.ClientID);

                if (listModel.DisplayWorkFlowStatus)
                {
                    MainToolBar.GetMenuReference(&quot;lnkWorkFlowStatus&quot;).OnClientClick =
                        string.Format(
                            &quot;if(lnkValidation(&#39;{0}&#39;, &#39;{1}&#39;, &#39;{2}&#39;)) {{ LoadWorkfowStatus(&#39;{1}&#39;, &#39;{3}&#39;, &#39;{4}&#39;);  }} return false;&quot;,
                            ValidateSelection.OneItem.ToInt32_2(), // 0
                            MWGrid.ClientID, // 1
                            listModel.QueryStringName, //2
                            &quot;WorkflowInstanceGuid&quot;,
                            listModel.ModuleId); // 3
                }
            }
            if ((listModel.DisplayWorkFlowAssociation || _IsWorkflowAssociated) &amp;&amp;
                UserDetail.GetCurrentUserDetail().RID == 1)
            {
                MainToolBar.GetMenuReference(&quot;lnkWorkFlowAssociation&quot;).OnClientClick = string.Format(
                    &quot;{{ LoadWorkflowAssociation(); ShowWFPopup(&#39;{3}&#39;); }} return false;&quot;,
                    ValidateSelection.None.
                        ToInt32_2(), MWGrid.ClientID,
                    listModel.QueryStringName,
                    btnWFAssociation.ClientID);
            }
            if (listModel.DisplayWorkFlowHelpDescription || _IsWorkflowAssociated)
            //&amp;&amp; UserDetail.GetCurrentUserDetail().RID == 1)// Bug: 65794(Help button is not working for the non admin user).
            {
                //MainToolBar.GetMenuReference(&quot;lnkWorkFlowHelpDescription&quot;).OnClientClick = &quot;if(lnkValidation(&#39;&quot; +
                //                                                                           ValidateSelection.OneItem
                //                                                                               .ToInt32_2() + &quot;&#39;, &#39;&quot; +
                //                                                                           MWGrid.ClientID +
                //                                                                           &quot;&#39;, &#39;WF_Status&#39;)) {$(&#39;#&quot; +
                //                                                                           btnWFHelpDescription.ClientID +
                //                                                                           &quot;&#39;).click(); } return false;&quot;;

                MainToolBar.GetMenuReference(&quot;lnkWorkFlowHelpDescription&quot;).OnClientClick = &quot;if(lnkValidation(&#39;&quot; +
                                                                                           ValidateSelection.OneItem
                                                                                               .ToInt32_2() + &quot;&#39;, &#39;&quot; +
                                                                                           MWGrid.ClientID +
                                                                                           &quot;&#39;, &#39;WF_Status&#39;)) { WorkFlowHelpDescription_ShowDialog(&#39;&quot; + WFFormName() + &quot;&#39;, &#39;&quot; + MWGrid.ClientID + &quot;&#39;, &#39;&quot; + &quot;workFlowHelpDescriptionContent&quot; + &quot;&#39;); }&quot;
                                                                                           + &quot; return false; &quot;;
            }
            if (listModel.DisplayWorkFlowUsers &amp;&amp; (listModel.ModuleId == &quot;DOCMGMT&quot; || _IsWorkflowAssociated))
            {
                if (MainToolBar.GetMenuReference(&quot;lnkWorkFlowUserOverriding&quot;) != null)
                    MainToolBar.GetMenuReference(&quot;lnkWorkFlowUserOverriding&quot;).OnClientClick = string.Format(
                        &quot;{{ LoadWorkflowUserOverriding(&#39;{1}&#39;, &#39;{3}&#39;);}} return false;&quot;,
                        ValidateSelection.None.
                        ToInt32_2(), MWGrid.ClientID,
                        listModel.QueryStringName,
                        btnWFUserOverriding.ClientID);
            }

            if (listModel.DisplayCheckList)
            {
                if (MainToolBar.GetMenuReference(&quot;lnkCheckList&quot;) != null)
                    MainToolBar.GetMenuReference(&quot;lnkCheckList&quot;).OnClientClick = string.Format(
                        &quot;if(lnkValidation(&#39;{0}&#39;, &#39;{1}&#39;, &#39;{2}&#39;)) {{ LoadCheckLists(&#39;&#39;); ShowWFPopup(&#39;{3}&#39;);}} return false;&quot;,
                        ValidateSelection.OneItem.
                            ToInt32_2(), MWGrid.ClientID,
                        listModel.QueryStringName,
                        btnFormCheckLists.ClientID);
            }

            if (listModel.DisplayAttachWorkflow &amp;&amp; _IsWorkflowAssociated)
            {
                MainToolBar.GetMenuReference(&quot;lnkWorkFlowAttach&quot;).OnClientClick = &quot;if(lnkValidation(&#39;&quot; +
                                                                                  Convert.ToInt32(
                                                                                      ValidateSelection.OneItem,
                                                                                      CultureInfo.CurrentCulture) +
                                                                                  &quot;&#39;, &#39;&quot; +
                                                                                  MWGrid.ClientID + &quot;&#39;, &#39;&quot; +
                                                                                  listModel.QueryStringName +
                                                                                  &quot;&#39;)) return CheckWorkflowAttach(&#39;&quot; +
                                                                                  MWGrid.ClientID +
                                                                                  &quot;&#39;); else return false;&quot;;
            }

            if (listModel.DisplayView)
                MainToolBar.GetMenuReference(&quot;lnkView&quot;).OnClientClick = &quot;return lnkValidation(&#39;&quot; +
                                                                        Convert.ToInt32(ValidateSelection.OneItem,
                                                                            CultureInfo.CurrentCulture) +
                                                                        &quot;&#39;, &#39;&quot; + MWGrid.ClientID + &quot;&#39;, &#39;&quot; +
                                                                        listModel.QueryStringName + &quot;&#39;);&quot;;
            if (listModel.DisplayReply)
                MainToolBar.GetMenuReference(&quot;lnkReply&quot;).OnClientClick = &quot;return lnkValidation(&#39;&quot; +
                                                                         Convert.ToInt32(ValidateSelection.OneItem,
                                                                             CultureInfo.CurrentCulture) +
                                                                         &quot;&#39;, &#39;&quot; + MWGrid.ClientID + &quot;&#39;, &#39;&quot; +
                                                                         listModel.QueryStringName + &quot;&#39;);&quot;;
            if (listModel.DisplayTransmittal)
                MainToolBar.GetMenuReference(&quot;lnkTransmittal&quot;).OnClientClick = &quot;return lnkValidation(&#39;&quot; +
                                                                               Convert.ToInt32(
                                                                                   ValidateSelection.OneItem,
                                                                                   CultureInfo.CurrentCulture) + &quot;&#39;, &#39;&quot; +
                                                                               MWGrid.ClientID + &quot;&#39;, &#39;&quot; +
                                                                               listModel.QueryStringName + &quot;&#39;);&quot;;
            if (listModel.DisplayDelete)
                MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).OnClientClick = &quot;if(lnkValidation(&#39;&quot; +
                                                                          Convert.ToInt32(
                                                                              ValidateSelection.OneOrMoreItems,
                                                                              CultureInfo.CurrentCulture) + &quot;&#39;, &#39;&quot; +
                                                                          MWGrid.ClientID + &quot;&#39;, &#39;&quot; +
                                                                          listModel.QueryStringName +
                                                                          &quot;&#39;)) return ConfirmAction(&#39;Delete&#39;); else return false;&quot;;

            if (listModel.DisplayChangeStatus &amp;&amp; MainToolBar.GetMenuReference(&quot;lnkChgStatus&quot;) != null)
                MainToolBar.GetMenuReference(&quot;lnkChgStatus&quot;).OnClientClick = &quot;return lnkValidation(&#39;&quot; +
                                                                             Convert.ToInt32(
                                                                                 ValidateSelection.OneOrMoreItems,
                                                                                 CultureInfo.CurrentCulture) + &quot;&#39;, &#39;&quot; +
                                                                             MWGrid.ClientID + &quot;&#39;, &#39;&quot; +
                                                                             listModel.QueryStringName + &quot;&#39;);&quot;;
            if (listModel.DisplayManageUsers)
                MainToolBar.GetMenuReference(&quot;lnkManageUsers&quot;).OnClientClick = &quot;return lnkValidation(&#39;&quot; +
                                                                               Convert.ToInt32(
                                                                                   ValidateSelection
                                                                                       .ZeroOrMoreItemsAndContainers,
                                                                                   CultureInfo.CurrentCulture) + &quot;&#39;, &#39;&quot; +
                                                                               MWGrid.ClientID + &quot;&#39;, &#39;&quot; +
                                                                               listModel.QueryStringName + &quot;&#39;);&quot;;
            if (listModel.DisplayStandardItems)
                MainToolBar.GetMenuReference(&quot;lnkStandardItems&quot;).OnClientClick = &quot;return lnkValidation(&#39;&quot; +
                                                                                 Convert.ToInt32(
                                                                                     ValidateSelection.OneItem,
                                                                                     CultureInfo.CurrentCulture) +
                                                                                 &quot;&#39;, &#39;&quot; +
                                                                                 MWGrid.ClientID + &quot;&#39;, &#39;&quot; +
                                                                                 listModel.QueryStringName + &quot;&#39;);&quot;;
            if (listModel.DisplayUnlock)
                MainToolBar.GetMenuReference(&quot;lnkUnlock&quot;).OnClientClick = &quot;return lnkValidation(&#39;&quot; +
                                                                          Convert.ToInt32(
                                                                              ValidateSelection.
                                                                                  ZeroOrMoreItemsAndContainers,
                                                                              CultureInfo.CurrentCulture) + &quot;&#39;, &#39;&quot; +
                                                                          MWGrid.ClientID + &quot;&#39;, &#39;&quot; +
                                                                          listModel.QueryStringName + &quot;&#39;);&quot;;
            if (listModel.DisplayCreateVersion)
                MainToolBar.GetMenuReference(&quot;lnkCreateVersion&quot;).OnClientClick = &quot;if (lnkValidation(&#39;&quot; +
                                                                                 (listModel.HasMultiApprove
                                                                                     ? Convert.ToInt32(
                                                                                         ValidateSelection.
                                                                                             OneOrMoreItems,
                                                                                         CultureInfo.CurrentCulture)
                                                                                     : Convert.ToInt32(
                                                                                         ValidateSelection.OneItem,
                                                                                         CultureInfo.CurrentCulture)) +
                                                                                 &quot;&#39;, &#39;&quot; + MWGrid.ClientID + &quot;&#39;, &#39;&quot; +
                                                                                 listModel.QueryStringName +
                                                                                 &quot;&#39;)) return ConfirmAction(&#39;Create a version of&#39;); else return false;&quot;;
            if (listModel.DisplayUnApprove)
                MainToolBar.GetMenuReference(&quot;lnkUnApprove&quot;).OnClientClick = &quot;if (lnkValidation(&#39;&quot; +
                                                                             (listModel.HasMultiApprove
                                                                                 ? Convert.ToInt32(
                                                                                     ValidateSelection.OneOrMoreItems,
                                                                                     CultureInfo.CurrentCulture)
                                                                                 : Convert.ToInt32(
                                                                                     ValidateSelection.OneItem,
                                                                                     CultureInfo.CurrentCulture)) +
                                                                             &quot;&#39;, &#39;&quot; + MWGrid.ClientID + &quot;&#39;, &#39;&quot; +
                                                                             listModel.QueryStringName +
                                                                             &quot;&#39;)) return ConfirmAction(&#39;Undo Approve&#39;); else return false;&quot;;
            if (listModel.DisplayReject)
                MainToolBar.GetMenuReference(&quot;lnkReject&quot;).OnClientClick = &quot;if (lnkValidation(&#39;&quot; +
                                                                          (listModel.HasMultiApprove
                                                                              ? Convert.ToInt32(
                                                                                  ValidateSelection.OneOrMoreItems,
                                                                                  CultureInfo.CurrentCulture)
                                                                              : Convert.ToInt32(
                                                                                  ValidateSelection.OneItem,
                                                                                  CultureInfo.CurrentCulture)) + &quot;&#39;, &#39;&quot; +
                                                                          MWGrid.ClientID + &quot;&#39;, &#39;&quot; +
                                                                          listModel.QueryStringName + &quot;&#39;)){ &quot; +
                                                                          (listModel.DisplayNotesforReject
                                                                              ? &quot;ShowWFPopup(&#39;&quot; +
                                                                                btnRejectNotes.ClientID +
                                                                                &quot;&#39;); return false;&quot;
                                                                              : &quot;return ConfirmAction(&#39;Reject&#39;);&quot;) +
                                                                          &quot; }else return false;&quot;;
            if (listModel.DisplayComplete)
                MainToolBar.GetMenuReference(&quot;lnkComplete&quot;).OnClientClick = &quot;return lnkValidation(&#39;&quot; +
                                                                            Convert.ToInt32(ValidateSelection.OneItem,
                                                                                CultureInfo.CurrentCulture) +
                                                                            &quot;&#39;, &#39;&quot; + MWGrid.ClientID + &quot;&#39;, &#39;&quot; +
                                                                            listModel.QueryStringName + &quot;&#39;);&quot;;
            if (listModel.DisplayPermissions)
                MainToolBar.GetMenuReference(&quot;lnkPermissions&quot;).OnClientClick = &quot;return lnkValidation(&#39;&quot; +
                                                                               Convert.ToInt32(
                                                                                   ValidateSelection.OneItem,
                                                                                   CultureInfo.CurrentCulture) + &quot;&#39;, &#39;&quot; +
                                                                               MWGrid.ClientID + &quot;&#39;, &#39;&quot; +
                                                                               listModel.QueryStringName + &quot;&#39;);&quot;;
            if (listModel.DisplayLabourList)
                MainToolBar.GetMenuReference(&quot;lnkLabourList&quot;).OnClientClick = &quot;return lnkValidation(&#39;&quot; +
                                                                              Convert.ToInt32(ValidateSelection.OneItem,
                                                                                  CultureInfo.CurrentCulture) +
                                                                              &quot;&#39;, &#39;&quot; + MWGrid.ClientID + &quot;&#39;, &#39;&quot; +
                                                                              listModel.QueryStringName + &quot;&#39;);&quot;;
            if (listModel.DisplayAttachItems)
                MainToolBar.GetMenuReference(&quot;lnkItems&quot;).OnClientClick = &quot;return lnkValidation(&#39;&quot; +
                                                                         Convert.ToInt32(ValidateSelection.OneItem,
                                                                             CultureInfo.CurrentCulture) +
                                                                         &quot;&#39;, &#39;&quot; + MWGrid.ClientID + &quot;&#39;, &#39;&quot; +
                                                                         listModel.QueryStringName + &quot;&#39;);&quot;;

            if (MainToolBar.GetMenuReference(&quot;lnkGridSetting&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkGridSetting&quot;).OnClientClick = &quot;$(&#39;#&quot; + btnColumnSettings.ClientID + &quot;&#39;).click(); return false;&quot;;
            }

            //if (MainToolBar.GetMenuReference(&quot;lnkMailMerge&quot;) != null)
            //{
            //    MainToolBar.GetMenuReference(&quot;lnkMailMerge&quot;).OnClientClick = &quot;$(&#39;#&quot; + btnMailMerge.ClientID + &quot;&#39;).click(); return false;&quot;;
            //}

            // MailMergeManage
            if (MainToolBar.GetMenuReference(&quot;lnkMailMergeManage&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkMailMergeManage&quot;).Click += btnMailMergeManage_Click;
            }

            if (MainToolBar.GetMenuReference(&quot;lnkMailMergeAttach&quot;) != null)
            {
                if ((listModel.HasAttachments || listModel.xmlModel != null &amp;&amp; listModel.xmlModel.form.AllowAttachments))
                    MainToolBar.GetMenuReference(&quot;lnkMailMergeAttach&quot;).OnClientClick = $@&quot;if(lnkValidation(&#39;{Convert.ToInt32(ValidateSelection.OneOrMoreItems,
                                                                                     CultureInfo.CurrentCulture)}&#39;, &#39;{ MWGrid.ClientID}&#39;, &#39;{listModel.QueryStringName}&#39;))
                                                                            {{ LoadMailMergeAndAttach(); ShowWFPopup(&#39;{btnMailMergeAndAttach.ClientID}&#39;);}} return false;&quot;;
                else
                    MainToolBar.GetMenuReference(&quot;lnkMailMergeAttach&quot;).OnClientClick = &quot;ShowError(&#39;Functionality not supported&#39;); return false; &quot;;
            }

            if (MainToolBar.GetMenuReference(&quot;lnkMailMergeMail&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkMailMergeMail&quot;).OnClientClick = $@&quot;if(lnkValidation(&#39;{Convert.ToInt32(ValidateSelection.OneOrMoreItems,
                                                                                     CultureInfo.CurrentCulture)}&#39;, &#39;{ MWGrid.ClientID}&#39;, &#39;{listModel.QueryStringName}&#39;))
                                                                            {{ LoadMailMergeAndEmail(); ShowWFPopup(&#39;{btnMailMergeAndEmail.ClientID}&#39;);}} return false;&quot;;
            }

            //if (UIHelper.IsOfflineMode)
            //    if (listModel.DisplaySyncEIS)
            //        MainToolBar.GetMenuReference(&quot;lnkSync&quot;).Attributes.Add(&quot;onClick&quot;,
            //                                                               &quot;if(lnkValidation(&#39;&quot; +
            //                                                               Convert.ToInt32(
            //                                                                   ValidateSelection.OneOrMoreItems,
            //                                                                   CultureInfo.CurrentCulture) + &quot;&#39;, &#39;&quot; +
            //                                                               MWGrid.ClientID + &quot;&#39;, &#39;&quot; +
            //                                                               listModel.QueryStringName +
            //                                                               &quot;&#39;)) return true; else return false;&quot;);

            //trBack.Visible = listModel.DisplayBack;

            MenuGroup grpOthers = MainToolBar.Groups.Find(g =&gt; g.Title == &quot;Others&quot;);
            if (grpOthers != null)
            {
                MenuButton menu = grpOthers.Menus.Find(m =&gt; m.ID == &quot;lnkReports&quot;) as MenuButton;
                if (menu != null)
                {
                    //menu.lnkButton.Attributes.Add(&quot;href&quot;, &quot;#&quot;);
                    foreach (TextIcon n in menu.SubMenus)
                    {
                        if (n.ValidateSelection != ValidateSelection.None)
                        {
                            MainToolBar.GetMenuReference(n.ID).OnClientClick =
                                string.Format(&quot;return lnkValidation(&#39;{0}&#39;, &#39;{1}&#39;,&#39;{2}&#39;);&quot;,
                                    Convert.ToInt32(n.ValidateSelection, CultureInfo.CurrentCulture), MWGrid.ClientID,
                                    listModel.QueryStringName);
                        }
                    }
                }
            }

            // After page level jscript attachment Call List model customize  ToolBar function so that concrete models can do their customizations
            if (MainToolBar.GetMenuReference(&quot;lnkPgeAssocia&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkPgeAssocia&quot;).OnClientClick = &quot;$(&#39;#&quot; + btnWFAllAssociation.ClientID + &quot;&#39;).click(); return false;&quot;;
            }

            if (listModel.ShowMapView)
            {
                if (MainToolBar.GetMenuReference(&quot;lnkListView&quot;) != null)
                {
                    MainToolBar.GetMenuReference(&quot;lnkListView&quot;).OnClientClick = &quot;ShowView(&#39;List&#39;);return false;&quot;;
                }
                if (MainToolBar.GetMenuReference(&quot;lnkMapView&quot;) != null)
                {
                    MainToolBar.GetMenuReference(&quot;lnkMapView&quot;).OnClientClick = &quot;ShowView(&#39;Map&#39;);return false;&quot;;
                }
            }
            ConfigureFilterManagerContols();

            listModel.CustomizeToolBarMenu(MainToolBar);
        }

        private object GetDataSet(ref int pageno, out int pagecount, out bool isWFSort)
        {
            if (!Page.IsPostBack)
                MWGrid.CurrentPageIndex = (PageState.PageIndex &gt; 0) ? PageState.PageIndex - 1 : 0;
            else
                PageState.PageIndex = MWGrid.CurrentPageIndex + 1;

            pageno = MWGrid.CurrentPageIndex + 1;

            isWFSort = false;
            //if (!String.IsNullOrEmpty(PageState.SortKey) &amp;&amp;
            //    (PageState.SortKey.Contains(&quot;WF_Status&quot;) || PageState.SortKey.Contains(&quot;WF_PendingOnRole&quot;) || PageState.SortKey.Contains(&quot;WF_PendingOnUser&quot;)))
            //    isWFSort = true;

            string filter = PageState.FilterCriterion;
            if (!string.IsNullOrEmpty(Request[&quot;FS&quot;]))
                filter = GetFilterString();

            listModel.FilterOrSortHasPendingOnUser = PageState.GridFilterExpressionList.Find(x =&gt; x.ColumnName == &quot;WF_PendingOnUser&quot;) != null
                || (!String.IsNullOrEmpty(PageState.SortKey) &amp;&amp; PageState.SortKey.Contains(&quot;WF_PendingOnUser&quot;));

            if (!string.IsNullOrEmpty(PageState.SortKey))
            {
                string sortKey = PageState.SortKey.Replace(&quot;img_&quot;, &quot;&quot;);
                if (DataBaseColumns != null &amp;&amp; !DataBaseColumns.Contains(sortKey)
                    &amp;&amp; listModel.ColumnInfo != null &amp;&amp;
                    listModel.ColumnInfo.Select(&quot;Key=&#39;{0}&#39;&quot;.Format2(sortKey)).Length == 0)
                    PageState.SortKey = null;
            }
            bool isLinq = false;
            object contractorDT = listModel.GetList(PageSize, (isWFSort
                ? string.Empty
                : UIHelper.GetSortOrder(
                    string.IsNullOrEmpty(PageState.SortKey)
                        ? listModel.DefaultSortColumn
                        : PageState.SortKey.Replace(&quot;img_&quot;, &quot;&quot;),
                    string.IsNullOrEmpty(PageState.SortKey) ? listModel.DefaultSortIndicator : PageState.SortOrder)),
                filter, ref pageno, out pagecount);
            if (contractorDT == null)
            {
                isLinq = true;
                contractorDT = listModel.GetList(PageSize,
                    (isWFSort ? string.Empty : UIHelper.GetSortOrder(PageState.SortKey, PageState.SortOrder)),
                    filter, ref pageno, out pagecount, isLinq);
            }

            if (contractorDT != null &amp;&amp; ((DataSet)contractorDT).Tables.Count &gt; 0)
            {
                ArrayList dataBaseColumns = new ArrayList();
                foreach (DataColumn dc in ((DataSet)contractorDT).Tables[0].Columns)
                    dataBaseColumns.Add(dc.ColumnName);
                DataBaseColumns = dataBaseColumns;
            }
            return contractorDT;
        }

        private string WFFormName()
        {
            return listModel is IWorkflowEnabledList
                ? ((IWorkflowEnabledList)listModel).FormName
                : listModel.ModuleId == &quot;LIBRARY&quot; &amp;&amp; listModel.xmlModel != null
                    ? listModel.xmlModel.form.Name
                    : (string.IsNullOrEmpty(listModel.WorkflowModuleID))
                        ? listModel.ModuleId
                        : listModel.WorkflowModuleID;
        }

        private string WFFormKey()
        {
            return (listModel is IWorkflowEnabledList)
                ? ((IWorkflowEnabledList)listModel).ListPrimaryKey
                : listModel.QueryStringName;
        }

        protected void BindGridControl()
        {
            try
            {
                if (Trace.IsEnabled)
                    Trace.Write(&quot;aspx.page&quot;, &quot;Begin BindGridControl()&quot;);

                ReOrderGridColumns();

                int pageno = 0;
                int pagecount;
                bool isWFSort;

                object contractorDT = GetDataSet(ref pageno, out pagecount, out isWFSort);

                if (pagecount &lt; pageno &amp;&amp; pageno &gt; 1)
                {
                    pageno = MWGrid.CurrentPageIndex = PageState.PageIndex = pagecount; // show the last page.
                    contractorDT = GetDataSet(ref pageno, out pagecount, out isWFSort);
                }

                DataTable bindingTable = ((DataSet)contractorDT).Tables[0];
                if ((listModel.xmlModel != null &amp;&amp; listModel.xmlModel.form.AllowAttachments) || listModel.HasAttachments)
                {
                    if (listModel.ModuleId == &quot;LIBRARY&quot; || (Request.QueryString[&quot;module&quot;] != null &amp;&amp; Request.QueryString[&quot;module&quot;] == &quot;LIBRARY&quot;))
                    {
                        AddAttachmentColumns(listModel.QueryStringName, Request.QueryString[&quot;xContext&quot;] ?? listModel.Context,
                                                   ref bindingTable);
                    }
                    else
                    {
                        AddAttachmentColumns(listModel.QueryStringName, Request.QueryString[&quot;module&quot;] ?? listModel.ModuleId,
                            ref bindingTable);
                    }
                }

                if (listModel.HasAnnotations)
                {
                    AddAnnotationColumns(listModel.QueryStringName, Request.QueryString[&quot;module&quot;] ?? listModel.ModuleId,
                        ref bindingTable);
                }

                if (listModel.ModuleId == &quot;DOCMGMT&quot; || _IsWorkflowAssociated)
                {
                    string key = WFFormKey();
                    string formName = WFFormName();
                    if (contractorDT != null)
                    {
                        AddWorkflowColumns(key, formName, ref bindingTable);
                        AddWorkflowColumnsToSecondBand(key, formName, contractorDT);
                        if (isWFSort &amp;&amp; bindingTable.Rows.Count &gt; 0 &amp;&amp; !string.IsNullOrEmpty(PageState.SortKey))
                            bindingTable =
                                bindingTable.Select(&quot;&quot;,
                                    &quot;{0} {1}&quot;.Format2(PageState.SortKey,
                                        PageState.SortOrder == GridSortOrder.Descending ? &quot;DESC&quot; : &quot;ASC&quot;))
                                    .CopyToDataTable();
                    }
                }

                AddDynamciColumns((DataSet)contractorDT);

                //we must clear telerik filtering as we are doing explicit filtering in DB already.
                // telerik filtering has a problem when we search for a space char and say &quot;does not contain&quot; space
                // read about this property here : http://docs.telerik.com/devtools/aspnet-ajax/controls/grid/functionality/filtering/overview
                MWGrid.MasterTableView.FilterExpression = string.Empty;

                if (TimezoneColumns == null &amp;&amp; listModel != null)
                    TimezoneColumns = listModel.TimezoneColumns;

                Aurigo.Brix.Platform.BusinessLayer.Utility.MWGrid.GetTrimmedDataSet(bindingTable, TimezoneColumns);

                MWGrid.DataSource = contractorDT;

                if ((contractorDT as DataSet).Tables.Count &gt; 0 &amp;&amp; bindingTable.Rows.Count &gt; 0)
                {
                    MWGrid.MasterTableView.DataKeyNames = new string[] { listModel.QueryStringName };
                    MWGrid.MasterTableView.PageSize = PageSize;
                    MWGrid.VirtualItemCount = pagecount * PageSize;
                }
                else
                {
                    MWGrid.VirtualItemCount = 0;
                }

                listModel.SetGridColumnProperties(MWGrid);
                MWGrid.Height = Unit.Percentage(100);

                if (listModel.HasHierarchicalGrid &amp;&amp; !Page.IsPostBack)
                {
                    listModel.SetHierarchicalGridProperties((DataSet)contractorDT);
                }

                PageState.MaintainState(PageState.PageIndex, PageState.SortKey, PageState.SortOrder,
                    PageState.FilterCriterion, PageState.GridFilterExpressionList, PageState.GridGroupByExpressionList);

                SavePageStateToCurrentFilterState(PageState);

                if (Trace.IsEnabled)
                    Trace.Write(&quot;aspx.page&quot;, &quot;End BindGridControl()&quot;);
            }
            catch (Exception ex)
            {
                SetErrorMessage(ex, false);
            }
            CreateButtons();

            if (listModel.ShowMapView)
            {
                //if (hdnMapFilter.Value != &quot;&quot;)
                {
                    List&lt;string&gt; esriDetails = listModel.GetMapDetails(hdnMapFilter.Value);
                    if (esriDetails.Count &gt; 2)
                    {
                        esriMap.MapOptions = esriDetails[0];
                        esriMap.MapGraphics = esriDetails[1];
                        //esriMap.KMZURL = ConfigurationManager.AppSettings[&quot;SiteRoot&quot;] + &quot;/esri/&quot; + &quot;PROJECT_&quot; + Request.QueryString[&quot;PID&quot;] + &quot;.kmz&quot;;
                        if (!IsPostBack)
                        {
                            string filters = esriDetails[2];
                            List&lt;string&gt; values = filters.Split(&#39;,&#39;).ToList();
                            foreach (string value in values)
                            {
                                string[] vals = value.Split(new string[] { &quot;~~&quot; }, StringSplitOptions.RemoveEmptyEntries);
                                if (vals.Length &gt; 1)
                                {
                                    ListItem li = new ListItem(vals[1], vals[0]);
                                    li.Selected = true;
                                    chkFilters.Items.Add(li);
                                }
                            }
                        }
                    }
                }
            }
            //CreateButtons();
        }

        private void FormatAttachmentColumns(RadGrid grid)
        {
            //Change HeaderText
            if (grid.MasterTableView.GetItems(GridItemType.Header).Length &gt; 0)
            {
                GridHeaderItem header = grid.MasterTableView.GetItems(GridItemType.Header)[0] as GridHeaderItem;
                if (header != null &amp;&amp; grid.MasterTableView.GetColumnSafe(&quot;img_DataHasAttachments&quot;) != null)
                {
                    grid.MasterTableView.GetColumnSafe(&quot;img_DataHasAttachments&quot;).HeaderStyle.Width = new Unit(32,
                        System.Web.UI.WebControls.UnitType.Pixel);
                    (grid.MasterTableView.GetColumnSafe(&quot;img_DataHasAttachments&quot;) as GridBoundColumn).HeaderText =
                        &quot;&lt;img src=\&quot;../../Images/Toolbar/IcnAttachment.gif\&quot; alt=\&quot;Attachments\&quot; Title=\&quot;Attachments\&quot; /&gt;&quot;;
                    (grid.MasterTableView.GetColumnSafe(&quot;img_DataHasAttachments&quot;) as GridBoundColumn).AllowFiltering =
                        false;
                }
            }
        }

        private void FormatAnnotationColumns(RadGrid grid)
        {
            //Change HeaderText
            if (grid.MasterTableView.GetItems(GridItemType.Header).Length &gt; 0)
            {
                GridHeaderItem header = grid.MasterTableView.GetItems(GridItemType.Header)[0] as GridHeaderItem;
                if (header != null &amp;&amp; grid.MasterTableView.GetColumnSafe(&quot;img_DataHasAnnotations&quot;) != null)
                {
                    grid.MasterTableView.GetColumnSafe(&quot;img_DataHasAnnotations&quot;).HeaderStyle.Width = new Unit(32,
                        System.Web.UI.WebControls.UnitType.Pixel);
                    (grid.MasterTableView.GetColumnSafe(&quot;img_DataHasAnnotations&quot;) as GridBoundColumn).HeaderText =
                        &quot;&lt;img src=\&quot;../../Images/Toolbar/IcnModify.gif\&quot; alt=\&quot;Annotations\&quot; Title=\&quot;Annotations\&quot; /&gt;&quot;;
                    (grid.MasterTableView.GetColumnSafe(&quot;img_DataHasAnnotations&quot;) as GridBoundColumn).AllowFiltering =
                        false;
                }
            }
        }

        public static void AddAttachmentColumns(string keyColumn, string formName, ref DataTable bindingTable)
        {
            string instanceIDs = string.Empty;
            foreach (DataRow dr in bindingTable.Rows)
                instanceIDs += dr[keyColumn] + &quot;,&quot;;
            instanceIDs = instanceIDs.TrimEnd(&#39;,&#39;);

            DataColumn img_HasAttachments = new DataColumn(&quot;img_DataHasAttachments&quot;,
                System.Type.GetType(&quot;System.String&quot;));
            bindingTable.Columns.Add(img_HasAttachments);
            img_HasAttachments.SetOrdinal(0);

            DataTable mappingDetails =
                Aurigo.AMP3.LinksBL.LinksManager.Instance.GetModuleInstancesHasAttachments(instanceIDs, formName).Tables
                    [0];

            foreach (DataRow dr in bindingTable.Rows)
            {
                DataRow[] statusDetails = mappingDetails.Select(&quot;FormInstanceID = &#39;&quot; + dr[keyColumn] + &quot;&#39;&quot;);
                if (statusDetails.Length &gt; 0)
                {
                    if ((bool)statusDetails[0][&quot;HasAttachments&quot;])
                        dr[&quot;img_DataHasAttachments&quot;] = &quot;True&quot;;
                }
            }
        }

        public static void AddAnnotationColumns(string keyColumn, string formName, ref DataTable bindingTable)
        {
            string instanceIDs = string.Empty;
            foreach (DataRow dr in bindingTable.Rows)
                instanceIDs += dr[keyColumn] + &quot;,&quot;;
            instanceIDs = instanceIDs.TrimEnd(&#39;,&#39;);

            DataColumn img_HasAnnotations = new DataColumn(&quot;img_DataHasAnnotations&quot;,
                System.Type.GetType(&quot;System.String&quot;));
            bindingTable.Columns.Add(img_HasAnnotations);
            img_HasAnnotations.SetOrdinal(0);

            DataTable mappingDetails =
                LinksBL.LinksManager.Instance.GetModuleInstancesHasAnnotations(instanceIDs, formName).Tables[0];

            foreach (DataRow dr in bindingTable.Rows)
            {
                DataRow[] statusDetails = mappingDetails.Select(&quot;FormInstanceID = &#39;&quot; + dr[keyColumn] + &quot;&#39;&quot;);
                if (statusDetails.Length &gt; 0)
                {
                    if ((bool)statusDetails[0][&quot;HasAnnotations&quot;])
                        dr[&quot;img_DataHasAnnotations&quot;] = &quot;True&quot;;
                }
            }
        }

        private string GetUnformattedExpression(string expression)
        {
            return expression.Replace(&quot;xxxxxx&quot;, &quot; &quot;);
        }

        private void FormatWorkflowColumns(RadGrid grid)
        {
            try
            {
                //Hide columns
                foreach (string col in ListModel.workflowHiddenColumns)
                {
                    if ((listModel.ModuleId == &quot;DOCMGMT&quot; || _IsWorkflowAssociated) &amp;&amp;
                    grid.MasterTableView.GetColumnSafe(col) != null)
                        grid.MasterTableView.GetColumnSafe(col).Display = false;
                }

                //Change HeaderText
                if (grid.MasterTableView.GetItems(GridItemType.Header).Length &gt; 0)
                {
                    GridHeaderItem header = grid.MasterTableView.GetItems(GridItemType.Header)[0] as GridHeaderItem;
                    if ((listModel.ModuleId == &quot;DOCMGMT&quot; || _IsWorkflowAssociated) &amp;&amp; header != null &amp;&amp;
                        grid.MasterTableView.GetColumnSafe(&quot;WF_Status&quot;) != null)
                    {
                        (grid.MasterTableView.GetColumnSafe(&quot;WF_Status&quot;) as GridBoundColumn).HeaderText =
                            &quot;Workflow Status&quot;;
                        (grid.MasterTableView.GetColumnSafe(&quot;WF_Status&quot;) as GridBoundColumn).AllowFiltering = false;
                    }
                    if ((listModel.ModuleId == &quot;DOCMGMT&quot; || _IsWorkflowAssociated) &amp;&amp; header != null &amp;&amp;
                        grid.MasterTableView.GetColumnSafe(&quot;WF_FStatus&quot;) != null)
                    {
                        (grid.MasterTableView.GetColumnSafe(&quot;WF_FStatus&quot;) as GridBoundColumn).HeaderText =
                            &quot;Workflow Status&quot;;
                        (grid.MasterTableView.GetColumnSafe(&quot;WF_FStatus&quot;) as GridBoundColumn).AllowFiltering = true;
                    }
                    if ((listModel.ModuleId == &quot;DOCMGMT&quot; || _IsWorkflowAssociated) &amp;&amp; header != null &amp;&amp;
                        grid.MasterTableView.GetColumnSafe(&quot;WF_PendingOnRole&quot;) != null)
                    {
                        (grid.MasterTableView.GetColumnSafe(&quot;WF_PendingOnRole&quot;) as GridBoundColumn).HeaderText =
                            &quot;Pending On Role(s)&quot;;
                        (grid.MasterTableView.GetColumnSafe(&quot;WF_PendingOnRole&quot;) as GridBoundColumn).AllowFiltering =
                            true;
                    }
                    if ((listModel.ModuleId == &quot;DOCMGMT&quot; || _IsWorkflowAssociated) &amp;&amp; header != null &amp;&amp;
                        grid.MasterTableView.GetColumnSafe(&quot;WF_PendingOnUser&quot;) != null)
                    {
                        (grid.MasterTableView.GetColumnSafe(&quot;WF_PendingOnUser&quot;) as GridBoundColumn).HeaderText =
                            &quot;Pending On User(s)&quot;;
                        (grid.MasterTableView.GetColumnSafe(&quot;WF_PendingOnUser&quot;) as GridBoundColumn).AllowFiltering =
                            listModel.ModuleId == &quot;DOCMGMT&quot; ? false : true;
                    }
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_CORE);
            }
        }

        private void AddWorkflowColumnsToSecondBand(string keyColumn, string formName, object ContractorDT)
        {
            DataSet ds = (DataSet)ContractorDT;
            if (listModel.HasHierarchicalGrid &amp;&amp; ds.Tables.Count &gt; 1)
            {
                //DataTable childTable = ((DataSet)ContractorDT).Tables[1];
                //DataColumn workflowStatusColumn = new DataColumn(&quot;WF_Status&quot;, Type.GetType(&quot;System.String&quot;));
                //workflowStatusColumn.Caption = &quot;Workflow Status&quot;;
                //childTable.Columns.Add(workflowStatusColumn);
                //DataColumn workflowRoleColumn = new DataColumn(&quot;WF_PendingOnRole&quot;, System.Type.GetType(&quot;System.String&quot;));
                //workflowRoleColumn.Caption = &quot;Pending On&quot;;
                //childTable.Columns.Add(workflowRoleColumn);

                int tableCount = ds.Tables.Count;
                for (int i = 1; i &lt; tableCount; i++)
                {
                    DataTable dt = ds.Tables[i];
                    AddWorkflowColumns(keyColumn, formName, ref dt);
                }
            }
        }

        /// &lt;summary&gt;
        /// Get Workflow users who has not perfomed action
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;stakeHolders&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;formID&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;wfRoles&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private static string GetWorkflowUsers(DataSet stakeHolders, int pid, int formID, string wfRoles, DataTable dtUsers)
        {
            Dictionary&lt;string, List&lt;string&gt;&gt; wfUsers = new Dictionary&lt;string, List&lt;string&gt;&gt;();
            //StakeHolders Table 0 - All workflow users, Table 1 - All workflow users who has perform action
            DataRow[] wfStakeHolders = stakeHolders.Tables[0].Select(string.Format(&quot;FormInstanceID=&#39;{0}&#39;&quot;, formID));
            if (wfStakeHolders.Length &gt; 0)
            {
                foreach (DataRow drUsers in wfStakeHolders)
                {
                    string roleName = drUsers[&quot;RoleName&quot;].ToString().ToLower();
                    if (!wfUsers.Keys.Contains(roleName)) wfUsers.Add(roleName, new List&lt;string&gt;());

                    DataRow[] userActionPerformed = stakeHolders.Tables[1].Select(string.Format(&quot;FormInstanceID=&#39;{0}&#39; AND RoleId={1} AND UserId={2}&quot;, formID, drUsers[&quot;RoleId&quot;], drUsers[&quot;UserId&quot;]));

                    if (userActionPerformed.Length == 0)
                    {
                        wfUsers[roleName].Add(string.Format(&quot;{0} {1}&quot;, drUsers[&quot;FirstName&quot;], drUsers[&quot;LastName&quot;]));
                    }
                }
            }

            string[] roles = wfRoles.Split(&#39;,&#39;).Where(p =&gt; !wfUsers.Keys.Any(p2 =&gt; p2.ToLower() == p.ToLower())).ToArray();
            if (roles.Length &gt; 0)
            {
                //All project users for a role for which user overriding is not done
                //DataTable dtUsers = UserManager.Instance.GetProjectUserDetailsByRoleNames(pid, string.Join(&quot;,&quot;, roles.ToArray()));
                string pidFilter = dtUsers.Columns.Contains(&quot;ProjectId&quot;) ? string.Format(&quot;and ProjectId={0}&quot;, pid) : &quot;&quot;;

                foreach (string role in roles)
                {
                    DataRow[] rows = dtUsers.Select(string.Format(&quot;RoleName=&#39;{0}&#39;{1}&quot;, role, pidFilter));
                    foreach (DataRow drUsers in rows)
                    {
                        string roleName = drUsers[&quot;RoleName&quot;].ToString().ToLower();
                        if (!wfUsers.Keys.Contains(roleName)) wfUsers.Add(roleName, new List&lt;string&gt;());

                        DataRow[] userActionPerformed = stakeHolders.Tables[1].Select(string.Format(&quot;FormInstanceID=&#39;{0}&#39; AND RoleId={1} AND UserId={2}&quot;, formID, drUsers[&quot;RoleId&quot;], drUsers[&quot;UserId&quot;]));

                        if (userActionPerformed.Length == 0)
                        {
                            wfUsers[roleName].Add(string.Format(&quot;{0} {1}&quot;, drUsers[&quot;FirstName&quot;], drUsers[&quot;LastName&quot;]));
                        }
                    }
                }
            }

            return string.Join(&quot;,&quot;, wfUsers.Values.SelectMany(i =&gt; i).Distinct().ToArray());
        }

        public static void AddWorkflowColumns(string keyColumn, string formName, ref DataTable bindingTable)
        {
            if (HttpContext.Current.Trace.IsEnabled)
                HttpContext.Current.Trace.Write(&quot;aspx.page&quot;, &quot;Begin AddWorkflowColumns()&quot;);

            //if buttons Buttons column values are not blank, then set existing workflow.
            DataTable dtGetDefaultWF;
            string defaultstages = string.Empty;
            DataRow[] buttonDetails = bindingTable.Select(&quot;[Buttons] is null&quot;);
            Dictionary&lt;string, string&gt; dicStgButtons = new Dictionary&lt;string, string&gt;();
            if (buttonDetails != null &amp;&amp; buttonDetails.Length &gt; 0)
            {
                dtGetDefaultWF =
                    ComponentHelper.Instance.ExecuteDataSet(
                        WFStoredProcedure.usp_WORKFLWGetDefaultWorkflowByAssociatedForm, null, formName).Tables[0];

                if (dtGetDefaultWF != null &amp;&amp; dtGetDefaultWF.Rows.Count &gt; 0)
                {
                    IProviderManager _WfProviderMgr = AppProviderManager.Instance;
                    string _CompanyId = ConnectionHelper.GetCurrentCompany();
                    IProvider _Provider = _WfProviderMgr.GetProvider(&quot;BRIXProvider&quot;, _CompanyId);
                    ITemplateWFManager _TemplatesMgr = ((BrixCoreDataProvider)_Provider).GetTemplateWFManager();
                    IWFTemplate template =
                        (StateMachineTemplate)
                            _TemplatesMgr.GetOrLoadWFTemplate(dtGetDefaultWF.Rows[0][&quot;WorkflowGUID&quot;].ToString());
                    StateMachineTemplate st = (StateMachineTemplate)template;
                    st.OnDeserialize();
                    foreach (string activity in st.ActivitiesList)
                    {
                        //Get all stages in the workflow.
                        //Get all csv action names.
                        //Put data into dictionary
                        string sStageName = activity.Split(&#39;|&#39;)[0];
                        string sButtonNames = string.Empty;
                        var ai = (StateInfo)st.GetActivity(sStageName);
                        foreach (Object action in ai.ActionButtons)
                        {
                            //sButtonNames += action.ToString().Split(&#39;|&#39;)[1] + &quot;,&quot;;
                            sButtonNames += GetFormActionString(action as FormAction) + &quot;,&quot;;
                        }
                        sButtonNames = sButtonNames.TrimEnd(&#39;,&#39;).Replace(&quot; &quot;, &quot;XXX&quot;);
                        if (!dicStgButtons.ContainsKey(sStageName) &amp;&amp; !string.IsNullOrEmpty(sButtonNames))
                            dicStgButtons.Add(sStageName, sButtonNames);
                        //defaultstages += activity.DisplayName;
                    }
                }
            }

            foreach (DataRow dr in bindingTable.Rows)
            {
                ObjectList buttons = new ObjectList();
                //if buttons data exists in mapping table, the build the buttons column
                if (dr[&quot;Buttons&quot;] != null &amp;&amp; !dr[&quot;Buttons&quot;].Equals(DBNull.Value))
                {
                    buttons.Deserialize(dr[&quot;Buttons&quot;].ToString());
                    string strButtons = string.Empty;
                    foreach (object obj in buttons)
                    {
                        strButtons += &quot;,&quot; + GetFormActionString(obj as FormAction);
                    }
                    strButtons = strButtons.TrimStart(&#39;,&#39;).Replace(&quot; &quot;, &quot;XXX&quot;);
                    dr[&quot;Buttons&quot;] = strButtons;
                }
                else
                {
                    //if button data doesnt exist, then build buttons list from dictionary of default workflow.
                    string sButtons;
                    dicStgButtons.TryGetValue(dr[&quot;WF_Status&quot;].ToString(), out sButtons);
                    dr[&quot;Buttons&quot;] = !string.IsNullOrEmpty(sButtons) ? sButtons.Replace(&quot; &quot;, &quot;XXX&quot;) : sButtons;
                }
            }

            if (HttpContext.Current.Trace.IsEnabled)
                HttpContext.Current.Trace.Write(&quot;aspx.page&quot;, &quot;End AddWorkflowColumns()&quot;);
        }

        private string GetWorkflowLinks(string formName, string formInstanceId)
        {
            if (string.IsNullOrEmpty(formName) || string.IsNullOrEmpty(formInstanceId)) return &quot;&quot;;
            if (!IsWorkflowAssociated(formName)) return &quot;&quot;;
            _HasInCompleteWorkflows = BrixWorkflowManager.Instance.HasInCompleteWorkflows(formInstanceId, formName,
                WorkflowGuids);
            if (!HasInCompleteWorkflows()) return &quot;&quot;;
            DataTable mappingDetails = BrixWorkflowManager.Instance.GetWorkflowMappingDetails(formInstanceId, formName);
            _WorkflowsInitiated = new List&lt;Guid&gt;();
            _WorkflowStates = new Dictionary&lt;string, KeyValuePair&lt;string, List&lt;IAction&gt;&gt;&gt;();
            DataRow[] aRows = mappingDetails.Select(&quot;IsCompleted=False&quot;);
            foreach (DataRow dr in aRows)
            {
                Guid gd;
                if (Guid.TryParse((string)dr[&quot;WorkflowInstanceGuid&quot;], out gd)) _WorkflowsInitiated.Add(gd);
            }
            if (_WorkflowsInitiated.Count &lt; 1) return &quot;&quot;;
            string actions = &quot;\n&quot;;
            for (int i = 0; i &lt; _WorkflowsInitiated.Count; i++)
            {
                bool bGiveOpinion = BrixWorkflowManager.Instance.IsRoutedToUser(_WorkflowsInitiated[i].ToString(), UserDetail.GetCurrentUserDetail().UID);
                if (bGiveOpinion) actions += BrixWorkflowManager.GiveOpinion + &quot;\n&quot;;

                Guid newGuid = Guid.Empty;
                IState stage = GetWorkflowStageFor(_WorkflowsInitiated[i], ref newGuid);
                if (null == stage) return &quot;&quot;;
                if (newGuid != Guid.Empty) _WorkflowsInitiated[i] = newGuid;
                if (!UserManager.Instance.IsUserRole(UserDetail.GetCurrentUserDetail().UID,
                    UserManager.Instance.GetUsersRoleId(stage.ActionsMustBePerformedBy)))
                    continue;

                if (!bGiveOpinion) actions += &quot;Ball In Court\n&quot;;

                foreach (IAction action in stage.ActionButtons)
                {
                    actions += action.ActionName + &quot;\n&quot;; // action.InstanceId
                }
            }
            return actions;
        }

        private void FormatDynamicColumns(RadGrid grid)
        {
            try
            {
                using (DataSet dsDynColumns = DynamicColumnsManager.Instance.GetDynamicColumns(context, &quot;BrixListPage&quot;))
                {
                    if (dsDynColumns != null &amp;&amp; dsDynColumns.Tables.Count &gt; 0 &amp;&amp; dsDynColumns.Tables[0].Rows.Count &gt; 0)
                    {
                        foreach (DataRow dr in dsDynColumns.Tables[0].Rows)
                        {
                            string expressionName = Convert.ToString(dr[&quot;ExpressionName&quot;]);
                            string headerText = Convert.ToString(dr[&quot;DisplayName&quot;]);
                            if (grid.MasterTableView.GetColumnSafe(expressionName) != null)
                            {
                                (grid.MasterTableView.GetColumnSafe(expressionName) as GridBoundColumn).AllowFiltering =
                                    false;
                                GridHeaderItem header = (grid.MasterTableView.GetItems(GridItemType.Header).Length &gt; 0)
                                    ? grid.MasterTableView.GetItems(GridItemType.Header)[0] as GridHeaderItem
                                    : null;
                                if (header != null &amp;&amp;
                                    ((LinkButton)header[expressionName].Controls[0]).Text == expressionName)
                                {
                                    ((LinkButton)header[expressionName].Controls[0]).Text = headerText;
                                }
                            }
                        }
                    }
                }

                GridColumn formatColumn = grid.MasterTableView.GetColumnSafe(&quot;FomattorColumn&quot;);
                if (formatColumn != null)
                {
                    foreach (GridDataItem item in grid.MasterTableView.Items)
                    {
                        TableCell cell = item[&quot;FomattorColumn&quot;];
                        if (string.IsNullOrEmpty(cell.Text)) continue;

                        string[] formatterInfo = cell.Text.Split(&#39;:&#39;);
                        if (formatterInfo.Length &lt; 1) continue;
                        if (formatterInfo[0].ToLower() == &quot;hide&quot;) item.Display = false;
                        if (formatterInfo[0].ToLower() == &quot;color&quot; &amp;&amp; formatterInfo.Length &gt; 1)
                            item.BackColor = Color.FromName(formatterInfo[1]);
                    }
                    formatColumn.Display = false;
                }
            }
            catch (Exception ex)
            {
                SetErrorMessage(ex, false);
            }
        }

        private void SetErrorMessage(Exception ex, bool logError)
        {
            if (logError)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_CORE);
            }

            if (ex is SqlException)
            {
                if (!logError)
                {
                    Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_CORE);
                }
                msg.Text = &quot;Database Error.&quot;;
            }
            else
            {
                msg.Text = ex.Message;
            }
        }

        /// &lt;summary&gt;
        ///
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;dsGrid&quot;&gt;Original Dataset&lt;/param&gt;
        private void AddDynamciColumns(DataSet dsGrid)
        {
            DataSet dsDynColumns = DynamicColumnsManager.Instance.GetDynamicColumns(context, &quot;BrixListPage&quot;);
            if (dsDynColumns != null &amp;&amp; dsDynColumns.Tables.Count &gt; 0 &amp;&amp; dsDynColumns.Tables[0].Rows.Count &gt; 0)
            {
                foreach (DataRow dr in dsDynColumns.Tables[0].Rows)
                {
                    String ExpressionName = Convert.ToString(dr[&quot;ExpressionName&quot;]);
                    String ColumnName = Convert.ToString(dr[&quot;DisplayName&quot;]);
                    String DataType = Convert.ToString(dr[&quot;DataType&quot;]);

                    var dColumn = new DataColumn(ExpressionName, Type.GetType(&quot;System.&quot; + DataType));

                    dColumn.Caption = UIHelper.JavascriptEncode(ColumnName);
                    if (!dsGrid.Tables[0].Columns.Contains(ExpressionName))
                    {
                        dsGrid.Tables[0].Columns.Add(dColumn);
                        EvaluateDynamicColumn(dsGrid, ExpressionName);
                    }
                    else
                    {
                        msg.Text = &quot;Error: A column with name &#39;&quot; + ExpressionName + &quot;&#39; already exists in the grid!&quot;;
                        Utilities.LogToFile(AppConfig.LogFile(true), msg.Text, MethodBase.GetCurrentMethod());
                    }
                }
            }
            DataSet dsFormatColumns = DynamicColumnsManager.Instance.GetFormatterColumn(context, &quot;BrixListPage&quot;);
            if (null != dsFormatColumns &amp;&amp; dsFormatColumns.Tables.Count &gt; 0 &amp;&amp; dsFormatColumns.Tables[0].Rows.Count &gt; 0)
            {
                var dColumn = new DataColumn(&quot;FomattorColumn&quot;, Type.GetType(&quot;System.String&quot;));
                dsGrid.Tables[0].Columns.Add(dColumn);
                string sColumn = dsFormatColumns.Tables[0].Rows[0][&quot;ExpressionName&quot;].ToString();
                string sFormatterDetails = dsFormatColumns.Tables[0].Rows[0][&quot;FormatterDetails&quot;].ToString();
                EvaluateDynamicColumn(dsGrid, sColumn, sFormatterDetails);
            }
        }

        private bool ApplyColumnSize(RadGrid grid)
        {
            int roleID = 0;

            if (ModuleManager.Instance.IsEffectivePermissionOfRoles())
                roleID = 0;
            else
                roleID = UserDetail.GetCurrentUserDetail().RID;

            IEnumerable&lt;ColumnResizeSettings&gt; table = ColumnSettingManager.Instance.GetResizedColumns(context, roleID, UserDetail.GetCurrentUserDetail().UID);
            ColumnResizeSettings colSetting = table.FirstOrDefault();

            //try getting the 12 (font size) in the below parameters from headerstyle or some other settings rather than hardcoding the value
            // header font will be used to determin the pixel length of the text that appears in the columnn
            Font headerFont = new Font(grid.MasterTableView.HeaderStyle.Font.Name, 12, FontStyle.Bold, GraphicsUnit.Pixel);
            double tableWidth = 0;
            bool hasMulti = (grid.MasterTableView.Columns.FindByUniqueName(&quot;Multi&quot;) != null) ? true : false;

            int visibleColumns = 0;
            bool isWidthSettingRequiredForAll;
            bool useTableWidthFromDB = true;

            foreach (GridColumn column in grid.MasterTableView.AutoGeneratedColumns)
                if (column.Display)
                    visibleColumns++;

            if (hasMulti)
                visibleColumns++;

            if (visibleColumns &gt; MIN_GRID_COLUMNS_FOR_RESIZE)
                isWidthSettingRequiredForAll = true;
            else
                isWidthSettingRequiredForAll = false;

            using (System.Drawing.Graphics graphics = System.Drawing.Graphics.FromImage(new Bitmap(1, 1)))
            {
                if (colSetting != null &amp;&amp; !string.IsNullOrEmpty(colSetting.Settings))
                {
                    #region If column settings exist in DB

                    Dictionary&lt;string, string&gt; settings = colSetting.Settings.DeserializeToDictionary(&#39;~&#39;, &#39;=&#39;);

                    string colTitle = string.Empty;

                    bool isMaintainMinimunWidth = true;
                    int correctionFactor = GRID_COLUMN_WIDTH_OFFSET;
                    int columnSize = 0;

                    foreach (GridColumn column in grid.MasterTableView.AutoGeneratedColumns)
                    {
                        colTitle = Aurigo.Brix.Platform.BusinessLayer.Utility.MWGrid.GetDatabaseFriendlyExpression(column.UniqueName);

                        isMaintainMinimunWidth = true;
                        columnSize = 0;

                        if (colTitle != &quot;Multi&quot; &amp;&amp; column.Display &amp;&amp; settings.ContainsKey(colTitle))
                        {
                            isMaintainMinimunWidth = false;
                            correctionFactor = 0;
                            string pixelValueOfColumn = settings[colTitle];
                            columnSize = Convert.ToInt32((pixelValueOfColumn.Length &gt; 3) ? &quot;999&quot; : pixelValueOfColumn);
                            SetColumnWidthUsingCorrectionFactors(column, columnSize, ref tableWidth, correctionFactor, isMaintainMinimunWidth);
                        }
                        else if (colTitle != &quot;Multi&quot; &amp;&amp; column.Display &amp;&amp; isWidthSettingRequiredForAll)
                        {
                            useTableWidthFromDB = false;
                            correctionFactor = GRID_COLUMN_WIDTH_OFFSET;
                            columnSize = (int)graphics.MeasureString(column.HeaderText, headerFont).Width;
                            SetColumnWidthUsingCorrectionFactors(column, columnSize, ref tableWidth, correctionFactor, isMaintainMinimunWidth);
                        }
                    }

                    if (hasMulti)
                    {
                        grid.MasterTableView.Columns.FindByUniqueName(&quot;Multi&quot;).HeaderStyle.Width = 38;
                        tableWidth += 38;
                    }

                    if (!useTableWidthFromDB)
                        grid.MasterTableView.Width = new Unit(tableWidth, System.Web.UI.WebControls.UnitType.Pixel);
                    else if (settings.ContainsKey(&quot;tableWidth&quot;))
                        grid.MasterTableView.Width = new Unit(settings[&quot;tableWidth&quot;].ToInt32_2(), System.Web.UI.WebControls.UnitType.Pixel);

                    #endregion If column settings exist in DB
                }
                else
                {
                    #region If No column settings in DB

                    if (!isWidthSettingRequiredForAll)
                        return true;

                    foreach (GridColumn column in grid.MasterTableView.AutoGeneratedColumns)
                    {
                        if (column.Display)
                        {
                            int columnSize = (int)graphics.MeasureString(column.HeaderText, headerFont).Width;
                            SetColumnWidthUsingCorrectionFactors(column, columnSize, ref tableWidth, GRID_COLUMN_WIDTH_OFFSET, isMaintainMinimunWidth: true);
                        }
                    }

                    if (hasMulti)
                    {
                        grid.MasterTableView.Columns.FindByUniqueName(&quot;Multi&quot;).HeaderStyle.Width = 38;
                        tableWidth += 38;
                    }

                    grid.MasterTableView.Width = new Unit(tableWidth, System.Web.UI.WebControls.UnitType.Pixel);

                    #endregion If No column settings in DB
                }
            }
            return true;
        }

        /// &lt;summary&gt;
        /// Helper method called in ApplyColumnSize() to determine appropriate width of columns if not stored in database
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;column&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;widthInPixel&quot;&gt;&lt;/param&gt;
        private void SetColumnWidthUsingCorrectionFactors(GridColumn column, int widthInPixel, ref double tableWidth, int correctionFactor, bool isMaintainMinimunWidth)
        {
            if (column.UniqueName == &quot;img_DataHasAttachments&quot;)
                tableWidth += 32; //compensate for attachment indicator column//no neeed to set the width for this column
            else
            {
                int minValueLimit = (column is GridDateTimeColumn) ? GRID_COLUMN_MIN_WIDTH_DATETIME : GRID_COLUMN_MIN_WIDTH;

                if (isMaintainMinimunWidth &amp;&amp; widthInPixel + correctionFactor &lt;= minValueLimit)
                    column.HeaderStyle.Width = minValueLimit;
                else
                    column.HeaderStyle.Width = new Unit(widthInPixel + correctionFactor, System.Web.UI.WebControls.UnitType.Pixel);

                //correction factor will not get added to the table width
                tableWidth += (widthInPixel);
            }
        }

        private void EvaluateDynamicColumn(DataSet dsGrid, string ColumnName, string formatterDetails = &quot;&quot;)
        {
            try
            {
                if (dsGrid.Tables.Count &gt; 0 &amp;&amp; dsGrid.Tables[0].Rows.Count &gt; 0)
                {
                    foreach (DataRow dr in dsGrid.Tables[0].Rows)
                    {
                        drCurrentRow = dr;
                        try
                        {
                            //This object cannot be outside for loop because otherwise the parameters to
                            //resources used inside the resource gets cached.
                            IResource res = ExpressionDataSource.Instance.GetResourceById(ColumnName);
                            if (res == null) return;
                            IParams inParams = res.GetInputParamNames();

                            (res as ExpressionResource).ProcessParam += res_ResolveParameter;

                            IParams inputParams = (inParams != null) ? inParams.Clone() : new Params(Guid.NewGuid());
                            // detaching it from the associtated resource but I guess it was never attached(??) - Ashish
                            IParams output = res.Execute(inputParams);
                            if (!string.IsNullOrEmpty(formatterDetails))
                            {
                                dr[&quot;FomattorColumn&quot;] = Convert.ToString(output.GetParam(output.GetKeys()[0], true).Value);
                            }
                            else
                            {
                                dr[ColumnName] = output.GetParam(output.GetKeys()[0], true).Value;
                            }
                            (res as ExpressionResource).ProcessParam -= res_ResolveParameter;
                        }
                        catch (Exception ex)
                        {
                            SetErrorMessage(ex, false);
                            if (string.IsNullOrEmpty(formatterDetails) &amp;&amp;
                                dsGrid.Tables[0].Columns[ColumnName].DataType == typeof(string))
                                dr[ColumnName] = ex.Message;
                            Utilities.LogToFile(AppConfig.LogFile(true), ex.Message, MethodBase.GetCurrentMethod());
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                SetErrorMessage(ex, false);
                Utilities.LogToFile(AppConfig.LogFile(true), ex.Message, MethodBase.GetCurrentMethod());
            }
        }

        private IParam res_ResolveParameter(object sender, IParam e)
        {
            if (!String.IsNullOrWhiteSpace(e.DerivedPath))
            {
                try
                {
                    e.Value = drCurrentRow[e.DerivedPath];
                    e.IsResolved = true;
                }
                catch
                {
                    e.IsResolved = false;
                }
            }
            return e;
        }

        private void InitHtmlData()
        {
            ScriptManager.RegisterArrayDeclaration(tblFilter, &quot;FilterFields&quot;, listModel.GetFilterHtml(tblFilter));

            msg.Text = &quot;&quot;;
            //var myForm = (HtmlForm)Page.Master.FindControl(&quot;form1&quot;);
            //myForm.Attributes.Add(&quot;onkeypress&quot;, &quot;javascript:CheckEnter(e)&quot;);
        }

        //private void ManageLoggedInUserPermission()
        //{
        //    UserDetail ud = UserDetail.GetCurrentUserDetail();

        //    if (!listModel.CheckAccess(ud))
        //    {
        //        // Permissions Inadequate
        //        UIHelper.RedirectURL(
        //            MessageResourceManager.GetString(&quot;E_USRMGMT_NO_PERMISSIONS_TO_VIEW_PAGE&quot;,
        //                Enumerations.MessageType.ErrorMessage),
        //            ResolveUrl(Constants.URL_ENTERPRISE), null, Context);
        //    }
        //}

        private ListModel SetListModel()
        {
            ListModel listModel;
            if (string.IsNullOrEmpty(Request.QueryString[&quot;xcontext&quot;]))
            {
                context = Request.QueryString[&quot;context&quot;] + (Request.QueryString[&quot;Type&quot;] ?? &quot;&quot;);

                listModel = ListModel.GetInstance(Request, Response,
                    Session[Constants.EIS_ADDITIONAL_INFO] == null
                        ? string.Empty
                        : Session[Constants.EIS_ADDITIONAL_INFO].ToString2());
                listModel.Context = context;
            }
            else
            {
                context = Request.QueryString[&quot;xcontext&quot;];
                listModel = ListModel.GetXMLInstance(Request, Response,
                    Session[Constants.EIS_ADDITIONAL_INFO] == null
                        ? string.Empty
                        : Session[Constants.EIS_ADDITIONAL_INFO].ToString2());
                if (listModel != null)
                {
                    listModel.Context = context;

                    engine = new XMLRenderingEngine(this, listModel.xmlModel, null);
                    engine.Initialize();
                }
            }

            if (listModel != null)
            {
                //SET THE BASE CLASS PROPERTY FOR THE MODULE CURRENCY
                //ParentModuleID = listModel.layout.ParentModuleID;
                ParentModuleID = listModel.ModuleId;
                columnInfo = listModel.ColumnInfo;

                //Bind BindGridData event to BindGridControl

                listModel.BindGridData += new EventHandler(listModel_BindGridData);

                listModel.OnShowSuccess += ShowSuccess;
                listModel.OnShowError += ShowError;
                listModel.OnShowWarning += ShowWarning;
                listModel.OnShowInfo += ShowInfo;

                listModel.OnRegisterClientScriptBlock += RegisterClientScriptBlock;
                listModel.OnRegisterStartupScript += RegisterStartupScript;
                listModel.OnRegisterClientScriptInclude += RegisterClientScriptInclude;

                if (this.IsProposedProject)
                    listModel.ContextIdentifier = &quot;PP&quot;;
            }

            return listModel;
        }

        private void listModel_BindGridData(object sender, EventArgs e)
        {
            BindGridControl();
        }

        //private void SetMenuDetails()
        //{
        //    divTabs.Visible = listModel.DisplayTabs;
        //}

        private void CMenu_ReportItemClick(object sender, EventArgs e)
        {
            var eArg = (ContextMenuEventArg)e;

            #region Adding Applicable Reports (in the layout) as CMenu

            List&lt;ReportDetails&gt; reports = null;

            if (listModel.layout != null &amp;&amp; listModel.layout.Reports.Count &gt; 0)
                reports = listModel.layout.Reports;
            else if (listModel.xmlModel != null &amp;&amp; listModel.xmlModel.form != null &amp;&amp;
                     listModel.xmlModel.form.Reports.Count &gt; 0)
                reports = listModel.xmlModel.form.Reports;
            foreach (ReportDetails report in reports)
            {
                if (report.ModelType.ToLower().Contains(ModelType.ContextMenu.ToString().ToLower()) &amp;&amp; report.IsActive &amp;&amp;
                    report.Name.Equals(eArg.Name))
                    Response.Redirect(
                        ReportManager.Instance.GetReportPageUrl(report, Request,
                            MWGrid.SelectedItems.Count &gt; 0 ? MWGrid.SelectedItems[0] : null)
                        , true);
            }

            #endregion Adding Applicable Reports (in the layout) as CMenu
        }

        #region &quot;Custom Event Handlers&quot;

        #region &quot;Generic Events&quot;

        public void HandlePagerEvent(object sender, ItemClickEventArgs e)
        {
            try
            {
                BindGridControl();
                MWGrid.CurrentPageIndex = 0;
            }
            catch (Exception ex)
            {
                JavaScriptSerializer JS = new JavaScriptSerializer();
                ShowError(JS.Serialize(ex.Message.Replace(&quot;|&quot;, &quot;&lt;br/&gt;&quot;)));
            }
        }

        protected void lnkChgStatus_Click(object sender, EventArgs e)
        {
            try
            {
                ActivateUser();
                BindGridControl();
                Response.Redirect(Request.Url.PathAndQuery, true);
            }
            catch (Exception ex)
            {
                JavaScriptSerializer JS = new JavaScriptSerializer();
                ShowError(JS.Serialize(ex.Message.Replace(&quot;|&quot;, &quot;&lt;br/&gt;&quot;)));
            }
        }

        protected void lnkLock_Click(object sender, EventArgs e)
        {
            try
            {
                listModel.HandleLock();
                Response.Redirect(Request.Url.PathAndQuery, true);
            }
            catch (Exception ex)
            {
                JavaScriptSerializer JS = new JavaScriptSerializer();
                ShowError(JS.Serialize(ex.Message.Replace(&quot;|&quot;, &quot;&lt;br/&gt;&quot;)));
            }
        }

        protected void lnkUnlock_Click(object sender, EventArgs e)
        {
            try
            {
                UnlockUser();
            }
            catch (Exception ex)
            {
                JavaScriptSerializer JS = new JavaScriptSerializer();
                ShowError(JS.Serialize(ex.Message.Replace(&quot;|&quot;, &quot;&lt;br/&gt;&quot;)));
            }
        }

        protected void lnkAddDynamicColumns_Click(object sender, EventArgs e)
        {
            try
            {
                IParams parameters = new Params(Guid.NewGuid());
                if (MWGrid.MasterTableView.AutoGeneratedColumns.Count() &gt; 0)
                {
                    foreach (GridColumn col in MWGrid.MasterTableView.AutoGeneratedColumns)
                    {
                        if (
                            !Aurigo.Brix.Platform.BusinessLayer.Utility.MWGrid.GetDatabaseFriendlyExpression(
                                col.UniqueName).StartsWith(&quot;img_&quot;)) // show all the columns
                        {
                            IParam parameter = new Param
                            {
                                Name = col.HeaderText.Replace(&quot; &quot;, &quot;_&quot;),
                                Value = String.Empty,
                                Type = col.DataType.FullName,
                                IsResolved = false
                            };
                            parameter.DerivedPath =
                                Aurigo.Brix.Platform.BusinessLayer.Utility.MWGrid.GetDatabaseFriendlyExpression(
                                    col.UniqueName);
                            parameters.SetParam(parameter, true);
                        }
                    }
                }
                Session[context + &quot;_DynamicColumnDefaultValues&quot;] = parameters;
                Response.Redirect(
                    String.Format(
                        &quot;~/Common/BrixListPage.aspx?context=ADDCOLM&amp;ModuleID=PROJECT&amp;ParentPage={0}&amp;ParentContext={1}&amp;ParentQSName={2}&amp;PID={4}&amp;ParentID={5}&amp;ParentQueryString={3}&quot;,
                        &quot;BrixListPage&quot;, context, listModel.QueryStringName,
                        Server.UrlEncode(Request.QueryString.ToString()), Request[&quot;PID&quot;], Request[&quot;ParentID&quot;]), true);
            }
            catch (Exception ex)
            {
                JavaScriptSerializer JS = new JavaScriptSerializer();
                ShowError(JS.Serialize(ex.Message.Replace(&quot;|&quot;, &quot;&lt;br/&gt;&quot;)));
            }
        }

        protected void lnkNew_Click(object sender, EventArgs e)
        {
            try
            {
                if ((sender as Aurigo.AMP3.Core.UserControls.Menu).Enabled == false)
                    return;

                //When clicked on New and then on save, It should show first page
                MWGrid.CurrentPageIndex = 0;
                PageState.MaintainState(MWGrid.CurrentPageIndex, PageState.SortKey, PageState.SortOrder,
                    PageState.FilterCriterion, PageState.GridFilterExpressionList, PageState.GridGroupByExpressionList);

                SavePageStateToCurrentFilterState(PageState);
                //workflowsInitiated = BrixWorkflowManager.Instance.TriggerWorkflow(TriggerPoint.TriggerActions[0], context);
                //if (workflowsInitiated.Count &gt; 0)
                //    listModel.workflowGuid = workflowsInitiated[0];
                listModel.HandleNew();
            }
            catch (Exception ex)
            {
                JavaScriptSerializer JS = new JavaScriptSerializer();
                ShowError(JS.Serialize(ex.Message.Replace(&quot;|&quot;, &quot;&lt;br/&gt;&quot;)));
            }
        }

        protected void lnkEdit_Click(object sender, EventArgs e)
        {
            try
            {
                if ((sender as Aurigo.AMP3.Core.UserControls.Menu).Enabled == false)
                    return;
                //if (approvalWorkflow != null &amp;&amp; approvalWorkflow.IsWorkflowInProgress() &amp;&amp; (listModel.xmlModel != null &amp;&amp; !listModel.xmlModel.form.ShowInStages))
                //    throw new Exception(&quot;Workflow is in progress or Complete. Request denied.&quot;);
                if (UIHelper.IsOfflineMode)
                {
                    GridDataItem item = MWGrid.MasterTableView.GetSelectedItems()[0] as GridDataItem;
                    if (item != null &amp;&amp; item.OwnerTableView.GetColumnSafe(listModel.QueryStringName) != null)
                    {
                        int id = int.Parse(item[listModel.QueryStringName].Text);
                        if (listModel.IsSynchWithServer(id))
                            throw new Exception(
                                &quot;This record has been synchronised with the server and can not be edited.&quot;);
                    }
                }
                listModel.HandleEdit();
            }
            catch (Exception ex)
            {
                JavaScriptSerializer JS = new JavaScriptSerializer();
                ShowError(JS.Serialize(ex.Message.Replace(&quot;|&quot;, &quot;&lt;br/&gt;&quot;)));
            }
        }

        protected void lnkUnApprove_Click(object sender, EventArgs e)
        {
            try
            {
                if ((sender as Aurigo.AMP3.Core.UserControls.Menu).Enabled == false)
                    return;

                //listModel.HandleApprove();
            }
            catch (Exception ex)
            {
                JavaScriptSerializer JS = new JavaScriptSerializer();
                ShowError(JS.Serialize(ex.Message.Replace(&quot;|&quot;, &quot;&lt;br/&gt;&quot;)));
            }
        }

        public string GetScript_To_ShowStatusMessageForMenuAction(MenuHandlerStatus statusObject)
        {
            JavaScriptSerializer JS = new JavaScriptSerializer();
            string scriptCode = string.Empty;

            if (statusObject == null)
                scriptCode = string.Format(&quot;ShowError({0});&quot;, JS.Serialize(statusObject.Message));
            else
                switch (statusObject.ReturnMessageType)
                {
                    default: case Enumerations.MessageType.ErrorMessage: scriptCode = string.Format(&quot;ShowError({0});&quot;, JS.Serialize(statusObject.Message)); break;
                    case Enumerations.MessageType.WarningMessage: scriptCode = string.Format(&quot;ShowWarning({0});&quot;, JS.Serialize(statusObject.Message)); break;
                    case Enumerations.MessageType.InfoMessage: scriptCode = string.Format(&quot;ShowSuccess({0});&quot;, JS.Serialize(statusObject.Message)); break;
                }

            return scriptCode;
        }

        protected void lnkApprove_Click(object sender, EventArgs e)
        {
            //if ((sender as Aurigo.AMP3.Core.UserControls.Menu).Enabled == false)
            //    return;
            try
            {
                string script = GetScript_To_ShowStatusMessageForMenuAction(listModel.HandleApprove());
                RegisterStartupScript(script);
            }
            catch (ThreadAbortException)
            {
            }
            catch (Exception ex)
            {
                JavaScriptSerializer JS = new JavaScriptSerializer();
                ShowError(JS.Serialize(ex.Message.Replace(&quot;|&quot;, &quot;&lt;br/&gt;&quot;)));
            }
            finally
            {
                BindGridControl();
                //MainToolBar.CreateToolBar(listModel.Menus);
                MainToolBar.CreateToolBar(listModel.MenuGroups);
                CustomizeToolBar();
                SetJcriptDetailsForMenuButtons();
            }
        }

        protected void lnkView_Click(object sender, EventArgs e)
        {
            try
            {
                if ((sender as Aurigo.AMP3.Core.UserControls.Menu).Enabled == false)
                    return;

                listModel.HandleView();
            }
            catch (Exception ex)
            {
                JavaScriptSerializer JS = new JavaScriptSerializer();
                ShowError(JS.Serialize(ex.Message.Replace(&quot;|&quot;, &quot;&lt;br/&gt;&quot;)));
            }
        }

        protected void lnkDelete_Click(object sender, EventArgs e)
        {
            try
            {
                if ((sender as Aurigo.AMP3.Core.UserControls.Menu).Enabled == false)
                    return;
                if (listModel.DisplayDelete)
                {
                    listModel.HandleDelete();
                    BindGridControl();
                    //  Response.Redirect(Request.Url.PathAndQuery);
                }
            }
            catch (Exception ex)
            {
                JavaScriptSerializer JS = new JavaScriptSerializer();
                string errCallStack = ex.StackTrace;
                ShowError(JS.Serialize(ex.Message.Replace(&quot;|&quot;, &quot;\n&quot;).Replace(&quot;\&quot;&quot;, &quot;&quot;)));
                BindGridControl();
            }
        }

        protected void lnkReply_Click(object sender, EventArgs e)
        {
            try
            {
                if ((sender as Aurigo.AMP3.Core.UserControls.Menu).Enabled == false)
                    return;

                listModel.HandleReply();
            }
            catch (Exception ex)
            {
                JavaScriptSerializer JS = new JavaScriptSerializer();
                ShowError(JS.Serialize(ex.Message.Replace(&quot;|&quot;, &quot;&lt;br/&gt;&quot;)));
            }
        }

        protected void lnkTransmittal_Click(object sender, EventArgs e)
        {
            try
            {
                if ((sender as Aurigo.AMP3.Core.UserControls.Menu).Enabled == false)
                    return;

                listModel.HandleTransmittal();
            }
            catch (Exception ex)
            {
                JavaScriptSerializer JS = new JavaScriptSerializer();
                ShowError(JS.Serialize(ex.Message.Replace(&quot;|&quot;, &quot;&lt;br/&gt;&quot;)));
            }
        }

        public void lnkReject_Click(object sender, EventArgs e)
        {
            try
            {
                listModel.RejectNotes = txtNotes.Text;
                string message = listModel.HandleMenuItem(&quot;Reject&quot;);
                if (!string.IsNullOrEmpty(message)) throw new Exception(message);
                BindGridControl();
            }
            catch (Exception ex)
            {
                JavaScriptSerializer JS = new JavaScriptSerializer();
                ShowError(JS.Serialize(ex.Message.Replace(&quot;|&quot;, &quot;&lt;br/&gt;&quot;)));
            }
        }

        protected void lnkWorkFlowAttach_Click(object sender, EventArgs e)
        {
            try
            {
                var formID = WFFormName();
                string formInstaceID = listModel.GetSelectedIds();
                string pID = &quot;&quot;;
                string parentID = &quot;&quot;;
                if (Request[&quot;ParentID&quot;] == null)
                {
                    parentID = &quot;&quot;;
                }
                else
                {
                    parentID = Request[&quot;ParentID&quot;].ToString();
                }
                if (formID == &quot;XPROJCT&quot; &amp;&amp; !String.IsNullOrEmpty(formInstaceID))
                {
                    pID = formInstaceID;
                }

                if (BrixWorkflowManager.Instance.IsWorkflowAssociated(formID, pID, parentID))
                {
                    //string id = listModel.GetSelectedIds();
                    List&lt;Guid&gt; workflowsInitiated =
                        BrixWorkflowManager.Instance.TriggerWorkflow(TriggerPoint.TriggerActions[0], formID, pID, parentID, &quot;&quot;, formInstaceID, listModel.QueryStringName);
                    var waitForWFToStart = new AutoResetEvent(false);
                    waitForWFToStart.WaitOne(200);

                    if (null != workflowsInitiated &amp;&amp; workflowsInitiated.Count &gt; 0)
                        listModel.workflowGuid = workflowsInitiated[0];
                }
            }
            catch (Exception ex)
            {
                JavaScriptSerializer JS = new JavaScriptSerializer();
                ShowError(JS.Serialize(ex.Message.Replace(&quot;|&quot;, &quot;&lt;br/&gt;&quot;)));
            }
        }

        #endregion &quot;Generic Events&quot;

        #endregion &quot;Custom Event Handlers&quot;

        #endregion &quot;Page Events&quot;

        #region &quot;Custom functions&quot;

        protected void ActivateUser()
        {
            listModel.HandleActivate();
        }

        protected void UnlockUser()
        {
            /*BUG 27563 :: Error message should be shown as toastr notification....*/
            //try
            // {
            if (listModel.HandleUnlock() == 1)
            {
                msg.Text = &quot;&quot;;
                BindGridControl();
            }
            //  }
            //catch (Exception ex)
            //{
            //    SetErrorMessage(ex, true);
            //}
        }

        protected void lnkViewLog_Click(object sender, EventArgs e)
        {
            JavaScriptSerializer JS = new JavaScriptSerializer();
            try
            {
                string retMsg = listModel.HandleLogView(UltraWebGridExcelExporter1);
                if (!retMsg.Equals(String.Empty))
                {
                    ShowError(JS.Serialize(retMsg.Replace(&quot;|&quot;, &quot;&lt;br/&gt;&quot;)));
                }
            }
            catch (Exception ex)
            {
                ShowError(JS.Serialize(ex.Message.Replace(&quot;|&quot;, &quot;&lt;br/&gt;&quot;)));
            }
        }

        protected void lnkListSave_Click(object sender, EventArgs e)
        {
            try
            {
                if ((sender as Aurigo.AMP3.Core.UserControls.Menu).Enabled == false)
                    return;
                listModel.HandleListSave();
            }
            catch (Exception ex)
            {
                JavaScriptSerializer JS = new JavaScriptSerializer();
                ShowError(JS.Serialize(ex.Message.Replace(&quot;|&quot;, &quot;&lt;br/&gt;&quot;)));
            }
        }

        private void SetColumnAttributes()
        {
            int i = 0;
            if (MWGrid != null &amp;&amp; MWGrid.MasterTableView != null)
                i = MWGrid.MasterTableView.AutoGeneratedColumns.Count();

            Dictionary&lt;string, string&gt; dic = listModel.GetGridImageKeys();

            foreach (string key in dic.Keys)
            {
                foreach (GridTableView view in MWGrid.MasterTableView.DetailTables)
                {
                    view.Columns.Add(&quot;img_&quot; + key);
                    var column = view.Columns.FindByUniqueNameSafe(&quot;img_&quot; + key);
                    if (column != null) column.HeaderText = dic[key];
                    DataRow[] dr = listModel.ColumnInfo.Select(&quot;Key = &#39;&quot; + key + &quot;&#39;&quot;);
                    if (dr.Length &gt; 0)
                    {
                        if (dr[0][&quot;Position&quot;] != null &amp;&amp; dr[0][&quot;Position&quot;] != DBNull.Value)
                        {
                            int position = -1;
                            int.TryParse(dr[0][&quot;Position&quot;].ToString2(), out position);
                            if (position != -1 &amp;&amp; view.GetColumnSafe(&quot;img_&quot; + key) != null)
                                view.GetColumnSafe(&quot;img_&quot; + key).OrderIndex = dr[0][&quot;Position&quot;].ToInt32_2();
                        }
                        if (dr[0][&quot;ColumnWidth&quot;] != null &amp;&amp; dr[0][&quot;ColumnWidth&quot;] != DBNull.Value)
                        {
                            int width;
                            int.TryParse(dr[0][&quot;ColumnWidth&quot;].ToString2().Replace(&quot;px&quot;, &quot;&quot;), out width);
                            if (width &gt; 0 &amp;&amp; view.GetColumnSafe(&quot;img_&quot; + key) != null)
                                view.GetColumnSafe(&quot;img_&quot; + key).HeaderStyle.Width = Unit.Pixel(width);
                        }
                    }
                }
                i++;
            }
        }

        protected override void CustomizeToolBar()
        {
            if (listModel.DisplayNew)
            {
                if (string.IsNullOrEmpty(listModel.NewURL))
                    MainToolBar.GetMenuReference(&quot;lnkNew&quot;).Click += lnkNew_Click;
                else
                    MainToolBar.GetMenuReference(&quot;lnkNew&quot;).PostBackUrl = listModel.NewURL;
            }

            if (listModel.DisplayView)
            {
                if (string.IsNullOrEmpty(listModel.ViewURL))
                    MainToolBar.GetMenuReference(&quot;lnkView&quot;).Click += lnkView_Click;
                else
                    MainToolBar.GetMenuReference(&quot;lnkView&quot;).PostBackUrl = listModel.ViewURL;
            }

            if (listModel.DisplayDelete) MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).Click += lnkDelete_Click;
            if (listModel.DisplayEdit)
            {
                if (string.IsNullOrEmpty(listModel.EditURL))
                    MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).Click += lnkEdit_Click;
                else
                    MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).PostBackUrl = listModel.EditURL;
            }
            if (listModel.DisplayListSave)
            {
                MainToolBar.GetMenuReference(&quot;lnkListSave&quot;).Click += lnkListSave_Click;
            }
            if (listModel.DisplayChangeStatus &amp;&amp; MainToolBar.GetMenuReference(&quot;lnkChgStatus&quot;) != null)
                MainToolBar.GetMenuReference(&quot;lnkChgStatus&quot;).Click += lnkChgStatus_Click;

            if (listModel.DisplayApprove) MainToolBar.GetMenuReference(&quot;lnkApprove&quot;).Click += lnkApprove_Click;
            if (listModel.DisplayReply) MainToolBar.GetMenuReference(&quot;lnkReply&quot;).Click += lnkReply_Click;
            if (listModel.DisplayTransmittal)
                MainToolBar.GetMenuReference(&quot;lnkTransmittal&quot;).Click += lnkTransmittal_Click;
            if (listModel.DisplayLock) MainToolBar.GetMenuReference(&quot;lnkLock&quot;).Click += lnkLock_Click;
            if (listModel.DisplayUnlock) MainToolBar.GetMenuReference(&quot;lnkUnlock&quot;).Click += lnkUnlock_Click;
            if (listModel.DisplayErrorLog) MainToolBar.GetMenuReference(&quot;lnkViewLog&quot;).Click += lnkViewLog_Click;
            if (listModel.DisplayBack) MainToolBar.GetMenuReference(&quot;lnkBack&quot;).Click += lnkBack_Click;
            if (listModel.DisplayDocuments) MainToolBar.GetMenuReference(&quot;lnkDocuments&quot;).Click += lnkDocuments_Click;
            if (!listModel.EnableNew) MainToolBar.DisableMenu(&quot;lnkNew&quot;);
            if (!listModel.EnableDelete) MainToolBar.DisableMenu(&quot;lnkDelete&quot;);
            if (!listModel.EnableEdit) MainToolBar.DisableMenu(&quot;lnkEdit&quot;);
            if (MainToolBar.GetMenuReference(&quot;lnkAddDynamicColumns&quot;) != null &amp;&amp; listModel.DisplayAddDynamicColumns)
                MainToolBar.GetMenuReference(&quot;lnkAddDynamicColumns&quot;).Click += lnkAddDynamicColumns_Click;
            if (listModel.DisplayTabs)
            {
                listModel.TabDetails.ForEach(
                    otherAction =&gt;
                    {
                        PageTabBar.Tabs.Add(new Tab(otherAction.Name, otherAction.Link, otherAction.IsMainItem));
                    });
            }

            if (listModel.DisplayAttachWorkflow)
            {
                if (!(listModel.DisplayNew &amp;&amp; listModel.EnableNew))
                {
                    listModel.DisplayAttachWorkflow = false;
                    MainToolBar.HideMenu(&quot;lnkWorkFlowAttach&quot;);
                }
                if (listModel.DisplayAttachWorkflow)
                    MainToolBar.GetMenuReference(&quot;lnkWorkFlowAttach&quot;).Click += lnkWorkFlowAttach_Click;
            }

            if (MainToolBar.GetMenuReference(&quot;lnkExcelExport&quot;) != null)
                MainToolBar.GetMenuReference(&quot;lnkExcelExport&quot;).OnClientClick = &quot;blockUIForDownload(); return true;&quot;;
            if (MainToolBar.GetMenuReference(&quot;lnkExcelExportXlsx&quot;) != null)
                MainToolBar.GetMenuReference(&quot;lnkExcelExportXlsx&quot;).OnClientClick = &quot;blockUIForDownload(); return true;&quot;;

            if (MainToolBar.GetMenuReference(&quot;lnkTemplateExport&quot;) != null)
                MainToolBar.GetMenuReference(&quot;lnkTemplateExport&quot;).OnClientClick = &quot;blockUIForDownload(); return true;&quot;;
            if (MainToolBar.GetMenuReference(&quot;lnkTemplateExportXlsx&quot;) != null)
                MainToolBar.GetMenuReference(&quot;lnkTemplateExportXlsx&quot;).OnClientClick = &quot;blockUIForDownload(); return true;&quot;;

            if (MainToolBar.GetMenuReference(&quot;lnkTemplateExportWithData&quot;) != null)
                MainToolBar.GetMenuReference(&quot;lnkTemplateExportWithData&quot;).OnClientClick = &quot;blockUIForDownload(); return true;&quot;;
            if (MainToolBar.GetMenuReference(&quot;lnkTemplateExportWithDataXlsx&quot;) != null)
                MainToolBar.GetMenuReference(&quot;lnkTemplateExportWithDataXlsx&quot;).OnClientClick = &quot;blockUIForDownload(); return true;&quot;;

            listModel.ApplyToolBarCustomisation(MainToolBar);
        }

        protected override string PreWorkFlowValidation(string action, object obj)
        {
            return listModel.PreWorkFlowValidation(action, obj);
        }

        protected void MainToolBar_MenuItemClick(object sender, EventArgs e)
        {
            try
            {
                var toolBarEventArg = (ToolBarEventArg)e;
                string error = string.Empty;
                string eventString = toolBarEventArg.Text;
                if (!string.IsNullOrEmpty(toolBarEventArg.Tag))
                    eventString += &quot;-&quot; + toolBarEventArg.Tag;
                //if (toolBarEventArg.Text.Equals(&quot;List Page Report&quot;))
                //{
                //    if (listModel.xmlModel != null)
                //        GenerateXMLReport();
                //    else
                //        GenerateReport();
                //}
                //else
                {
                    try
                    {
                        string filter = PageState.FilterCriterion;
                        if (!string.IsNullOrEmpty(Request[&quot;FS&quot;]))
                            filter = GetFilterString();

                        error = listModel.HandleMenuItems(eventString, UltraWebGridExcelExporter1, filter);
                    }
                    catch (AMP3SuccessMessage ex)
                    {
                        JavaScriptSerializer JS = new JavaScriptSerializer();
                        string errMessage = ex.Message;
                        errMessage =
                            errMessage.Replace(&quot;\&#39;&quot;, &quot;\\&#39;&quot;)
                                .Replace(&quot;\n&quot;, &quot;&lt;br/&gt;&quot;)
                                .Replace(&quot;|&quot;, &quot;&lt;br/&gt;&quot;)
                                .Replace(&quot;\&quot;&quot;, &quot;&quot;);
                        errMessage = JS.Serialize(errMessage);
                        ShowSuccess(errMessage);
                    }
                    catch (Exception ex)
                    {
                        JavaScriptSerializer JS = new JavaScriptSerializer();
                        string errMessage = ex.Message;
                        errMessage =
                            errMessage.Replace(&quot;\&#39;&quot;, &quot;\\&#39;&quot;)
                                .Replace(&quot;\n&quot;, &quot;&lt;br/&gt;&quot;)
                                .Replace(&quot;|&quot;, &quot;&lt;br/&gt;&quot;)
                                .Replace(&quot;\&quot;&quot;, &quot;&quot;);
                        errMessage = JS.Serialize(errMessage);
                        ShowError(errMessage);
                    }
                }

                if (!listModel.IsMenuClickHandled)
                {
                    bool reportFound = false;

                    if (listModel.xmlModel != null &amp;&amp; listModel.xmlModel.form != null &amp;&amp;
                        listModel.xmlModel.form.Reports != null)
                    {
                        foreach (ReportDetails rd in listModel.xmlModel.form.Reports)
                        {
                            reportFound = HandleUploadedReport(toolBarEventArg, reportFound, rd);
                        }

                        //The below lines are redundant as we have already called HandleMenuItems above
                        //and it internally handles HandleMenuItem
                        //Keeping this code commented, incase if this breaks in some other scenario

                        //if (!reportFound)
                        //    error = listModel.HandleMenuItems(toolBarEventArg.Text, UltraWebGridExcelExporter1);
                    }

                    if (!reportFound &amp;&amp; listModel.layout != null &amp;&amp; listModel.layout.Reports != null)
                    {
                        foreach (ReportDetails rd in listModel.layout.Reports)
                        {
                            reportFound = HandleUploadedReport(toolBarEventArg, reportFound, rd);
                        }

                        //if (!reportFound)
                        //    error = listModel.HandleMenuItems(toolBarEventArg.Text, UltraWebGridExcelExporter1);
                    }
                }
                else
                {
                    listModel.SetUIDetails();
                    ReBindListPage();
                    //MainToolBar.CreateToolBar(listModel.MenuGroups);
                    //Added the new property not to recreate the menu items on MainToolBar_MenuItemClick event as an exception is thrown when the menu items are created twice
                    if (listModel.RecreateMenuItemsOnMenuItemClick)
                        CreateToolBarMenu(listModel.MenuGroups, MainToolBar_MenuItemClick);
                    CustomizeToolBar();
                    SetJcriptDetailsForMenuButtons();
                    CreateButtons();
                }
                if (!string.IsNullOrEmpty(error))
                {
                    throw new Exception(error);
                }
            }
            catch (Exception ex)
            {
                JavaScriptSerializer JS = new JavaScriptSerializer();
                string errMessage = ex.Message;
                errMessage = errMessage.Replace(&quot;|&quot;, &quot;\n&quot;).Replace(&quot;\&quot;&quot;, &quot;&quot;);
                errMessage = JS.Serialize(errMessage);
                string errCallStack = ex.StackTrace;
                ShowError(errMessage);
            }
        }

        private void ReOrderGridColumns()
        {
            //if (columnInfo.Columns.Contains(&quot;PositionForSort&quot;))
            //    columnInfo.Columns.Remove(&quot;PositionForSort&quot;);
            //columnInfo.Columns.Add(&quot;PositionForSort&quot;, typeof(int), &quot;Convert(Position, &#39;System.Int32&#39;)&quot;);

            //DataRow[] sortedRows = columnInfo.Select(&quot;&quot;, &quot;PositionForSort&quot;);
            //for (int i = 0; i &lt; sortedRows.Length; i++)
            //{
            //    sortedRows[i][&quot;Position&quot;] = i + 1;
            //}
        }

        protected override void ReBindListPage()
        {
            BindGridControl();
            if (IsPostBack &amp;&amp; listModel != null)
                listModel.CustomizeToolBarMenu(MainToolBar);
            SetJcriptDetailsForMenuButtons();
        }

        protected override string GetSelectedIDs()
        {
            return null == listModel ? null : listModel.GetSelectedIds();
        }

        private bool HandleUploadedReport(ToolBarEventArg toolBarEventArg, bool reportFound, ReportDetails rd)
        {
            if (toolBarEventArg.Text.Equals(string.IsNullOrEmpty(rd.Description) ? rd.Name : rd.Description))
            {
                reportFound = true;
                Session.Add(&quot;reportDTO&quot;, rd);
                string queryString = &quot;?ModuleID=&quot; + listModel.ModuleId;
                queryString += (string.IsNullOrEmpty(Request[&quot;PID&quot;]) ? &quot;&quot; : &quot;&amp;PID=&quot; + Request[&quot;PID&quot;]);
                queryString += (string.IsNullOrEmpty(Request[&quot;ParentID&quot;]) ? &quot;&quot; : &quot;&amp;ParentID=&quot; + Request[&quot;ParentID&quot;]);
                queryString += (string.IsNullOrEmpty(Request[&quot;ContractID&quot;])
                    ? &quot;&quot;
                    : &quot;&amp;ContractID=&quot; + Request[&quot;ContractID&quot;]);
                queryString += &quot;&amp;Context=&quot; + rd.Context;
                queryString += &quot;&amp;ParentContext=&quot; + rd.ParentContext;
                queryString += &quot;&amp;IsXml=&quot; + (!string.IsNullOrEmpty(Request[&quot;xContext&quot;])).ToString();
                queryString += (string.IsNullOrEmpty(rd.Code) ? &quot;&quot; : &quot;&amp;code=&quot; + rd.Code);

                string selectedID = listModel.GetSelectedIds();
                if (!string.IsNullOrEmpty(selectedID))
                {
                    if (queryString.Contains(&quot;FormInstanceID&quot;))
                    {
                        string[] temp = queryString.Split(&quot;&amp;&quot;.ToCharArray());
                        queryString += &quot;&amp;FormInstanceID=&quot; + selectedID;
                        queryString = string.Empty;
                        foreach (string str in temp)
                        {
                            string tempStr = str;
                            if (tempStr.Contains(&quot;FormInstanceID&quot;))
                                tempStr = &quot;FormInstanceID=&quot; + selectedID;
                            queryString = (string.IsNullOrEmpty(queryString) ? &quot;&quot; : queryString) + &quot;&amp;&quot; + tempStr;
                        }
                    }
                    else
                        queryString += &quot;&amp;FormInstanceID=&quot; + selectedID;
                }

                queryString += (string.IsNullOrEmpty(Request[&quot;POType&quot;]) ? &quot;&quot; : &quot;&amp;POType=&quot; + Request[&quot;POType&quot;]);
                queryString += (string.IsNullOrEmpty(Request[&quot;POTypeInstanceID&quot;])
                    ? &quot;&quot;
                    : &quot;&amp;POTypeInstanceID=&quot; + Request[&quot;POTypeInstanceID&quot;]);

                queryString = UIHelper.BuildURL(queryString,
                    new List&lt;string&gt;
                    {
                        &quot;ModuleID&quot;,
                        &quot;PID&quot;,
                        &quot;ParentID&quot;,
                        &quot;ContractID&quot;,
                        &quot;Context&quot;,
                        &quot;ParentContext&quot;,
                        &quot;IsXml&quot;,
                        &quot;FormInstanceID&quot;,
                        &quot;POType&quot;,
                        &quot;POTypeInstanceID&quot;
                    },
                    HttpContext.Current);

                if (rd.ReportType == ReportHostType.sql.ToString2())
                    Response.Redirect(&quot;~/Common/BrixListReportPage.aspx&quot; + queryString, true);
                else
                    Response.Redirect(&quot;~/Common/BrixReportPage.aspx&quot; + queryString, true);
            }
            return reportFound;
        }

        // MailMergeManage
        protected void btnMailMergeManage_Click(object sender, EventArgs e)
        {
            try
            {
                Response.Redirect(
                   String.Format(
                       &quot;~/Common/BrixListPage.aspx?xContext=MAILMNG&amp;Module=LIBRARY&amp;ParentModule=&quot; + WFFormName() + &quot;&amp;ParentPage={0}&amp;ParentQSName={1}&amp;ParentQueryString={2}&quot;,
                       &quot;BrixListPage&quot;, listModel.QueryStringName,
                       Server.UrlEncode(Request.QueryString.ToString())), true);
            }
            catch (Exception ex)
            {
                JavaScriptSerializer JS = new JavaScriptSerializer();
                ShowError(JS.Serialize(ex.Message));
            }
        }

        protected void btnSubOk_Click(object sender, EventArgs e)
        {
            try
            {
                listModel.SubmitionDate = Convert.ToDateTime(wdcSubmitionDate.Value);
                string error = listModel.HandleMenuItem(listModel.SubmitEvent);
                if (listModel.IsMenuClickHandled)
                {
                    BindGridControl();
                    //MainToolBar.CreateToolBar(listModel.Menus);
                    MainToolBar.CreateToolBar(listModel.MenuGroups);
                    CustomizeToolBar();
                    SetJcriptDetailsForMenuButtons();
                }
                if (!string.IsNullOrEmpty(error))
                {
                    throw new Exception(error);
                }
            }
            catch (Exception ex)
            {
                JavaScriptSerializer JS = new JavaScriptSerializer();
                ShowError(JS.Serialize(ex.Message));
            }
        }

        protected void btnSubDates_Click(object sender, EventArgs e)
        {
            listModel.SetSubmitionDates(wdcSubmitionDate);
            lblSubmittionDate.Text = listModel.SubmitionDateLabel;
            RegisterStartupScript(@&quot;document.getElementById(&quot; + &quot;&#39;&quot; + btnSubPopup.ClientID + &quot;&#39;&quot; + &quot;).click();&quot;);
            //Page.ClientScript.RegisterClientScriptBlock(GetType(), &quot;OpenSubDate&quot;, &quot;&lt;script&gt;document.getElementById(&quot; + btnSubPopup + &quot;).click()&lt;/script&gt;&quot;);
        }

        protected override void HandleDataFromWorkFlow()
        {
            listModel.HandleDataFromWorkFlow();
        }

        protected override void WorkflowActionComplete()
        {
            listModel.WorkflowActionComplete();
        }

        protected override void HandleSytemDataAfterWorkFlow()
        {
            listModel.HandleSytemDataAfterWorkFlow(UserDetail.GetCurrentUserDetail());
        }

        protected void chkFilters_SelectedIndexChanged(object sender, EventArgs e)
        {
            IsMapFilterClicked = true;
            BindGridControl();
        }

        #endregion &quot;Custom functions&quot;

        #region &quot;Report Generation&quot;

        private void GenerateReport()
        {
            try
            {
                DataSet ds = ComponentHelper.Instance.ExecuteDataSet(StoredProcedure.usp_APPMGMTGenericGetData, null,
                    listModel.layout.DataTable, &quot;&quot;, 0,
                    Convert.ToInt32(Request[&quot;ParentID&quot;],
                        CultureInfo.CurrentCulture));
                UIHelper.WritePDFOnResponse(Response, GenerateReportFromRPX(ds), listModel.ModuleId);
            }
            catch
            {
            }
        }

        private MemoryStream GenerateReportFromRPX(DataSet reportDataSet)
        {
            DataTable reportData = reportDataSet.Tables[0];
            var pdf = new PdfExport();
            var rpt = new ActiveReport();
            try
            {
                var strm = new MemoryStream();
                rpt = GetActiveReport(rpt, reportData);
                pdf.Export(rpt.Document, strm);
                return strm;
            }
            catch (Exception)
            {
                throw;
            }
            finally
            {
                pdf.Dispose();
                rpt.Dispose();
            }
        }

        private ActiveReport GetActiveReport(ActiveReport rpt, DataTable reportData)
        {
            string reportPath = HttpContext.Current.Server.MapPath(&quot;~/common/GenericListReport.rpx&quot;);
            string logoPath = HttpContext.Current.Server.MapPath(AMP3ApplicationSettings.Instance.AppLogo);
            XmlReader xReader = XmlReader.Create(reportPath);
            rpt.LoadLayout(xReader);
            ((Label)rpt.Sections[&quot;ReportHeader&quot;].Controls[&quot;lblRptHeader&quot;]).Text = listModel.layout.Header.ToUpper2();
            rpt.PageSettings.Margins.Top = 0.5F;
            rpt.PageSettings.Margins.Left = 0.5F;
            rpt.PageSettings.Margins.Bottom = 0.5F;
            rpt.PageSettings.Margins.Right = 0.5F;
            if (File.Exists(logoPath))
            {
                Image logoImage = new Bitmap(logoPath);
                var pic = ((Picture)rpt.Sections[&quot;ReportHeader&quot;].Controls[&quot;rptLogo&quot;]);
                pic.Image = logoImage;
                if (logoImage.Height &gt; pic.Height * 100 ||
                    logoImage.Width &gt; pic.Width * 100)
                    pic.SizeMode = SizeModes.Zoom;
            }
            ((TextBox)rpt.Sections[&quot;PageFooter&quot;].Controls[&quot;txtGeneratedDate&quot;]).Text = DateTime.UtcNow.ToString_WithFormatDateTime();
            rpt.ShowParameterUI = false;

            if (reportData != null)
            {
                CreateReportControls(rpt, reportData);
                rpt.DataSource = reportData;
            }
            rpt.Run();
            return rpt;
        }

        private void CreateReportControls(ActiveReport rpt, DataTable reportData)
        {
            rpt.Sections.InsertGroupHF();
            float LocX = 0f;
            float LocY = 0f;
            bool isHidden;

            DataTable dt = reportData;
            foreach (Column col in listModel.model.columns)
            {
                isHidden = !String.IsNullOrEmpty(col.ListProperties[&quot;IsHidden&quot;])
                    ? Convert.ToBoolean(col.ListProperties[&quot;IsHidden&quot;], CultureInfo.CurrentCulture)
                    : false;
                if (!isHidden)
                {
                    var txt = new TextBox();
                    txt.Text = string.IsNullOrEmpty(col.Caption) ? col.Name : col.Caption;
                    txt.CanGrow = true;
                    txt.Location = new PointF(LocX, LocY);
                    txt.Size =
                        new SizeF(
                            (float)Convert.ToDecimal(col.ListProperties[&quot;ReportWidth&quot;], CultureInfo.CurrentCulture),
                            0.2f);
                    txt.Style = &quot;font-weight: bold; font-size: 8pt;&quot;;
                    txt.ClassName = &quot;Caption&quot;;

                    var txtDetail = new TextBox();
                    txtDetail.DataField = col.Name;
                    txtDetail.CanGrow = true;
                    txtDetail.Location = new PointF(LocX, LocY);
                    txtDetail.Size =
                        new SizeF(
                            (float)Convert.ToDecimal(col.ListProperties[&quot;ReportWidth&quot;], CultureInfo.CurrentCulture),
                            0.2f);
                    txtDetail.Style = &quot;font-size: 8pt;&quot;;
                    txtDetail.OutputFormat = GetFormatForReport(col.ListProperties[&quot;Format&quot;]);
                    txtDetail.ClassName = &quot;Detail&quot;;

                    LocX += (float)Convert.ToDecimal(col.ListProperties[&quot;ReportWidth&quot;], CultureInfo.CurrentCulture);

                    rpt.Sections[&quot;PageHeader&quot;].Controls.Add(txt);
                    rpt.Sections[&quot;Detail&quot;].Controls.Add(txtDetail);
                }
            }
            var ln = new Line();
            ln.LineWeight = 1f;
            ln.Width = 7.5f;
            rpt.Sections[2].Controls.Add(ln);
        }

        private string GetFormatForReport(string format)
        {
            if (format.ToLower2() == &quot;amount&quot;)
                return LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) +
                       AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
            else if (format.ToLower2() == &quot;quantity&quot;)
                return AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
            else if (format.ToLower2() == &quot;datetime&quot;)
                return AMP3ApplicationSettings.Instance.FORMAT_DATETIME;
            else if (format.ToLower2() == &quot;date&quot;)
                return AMP3ApplicationSettings.Instance.FORMAT_DATE;
            else
                return &quot;&quot;;
        }

        #endregion &quot;Report Generation&quot;

        #region &quot;XML Report Generation&quot;

        private void GenerateXMLReport()
        {
            try
            {
                int pagecount;
                int pageno = MWGrid.CurrentPageIndex;
                DataSet ds = listModel.GetList(int.MaxValue,
                    UIHelper.GetSortOrder(PageState.SortKey, PageState.SortOrder),
                    PageState.FilterCriterion, ref pageno, out pagecount);
                UIHelper.WritePDFOnResponse(Response, GenerateXMLReportFromRPX(ds), listModel.xmlModel.form.ModuleID);
            }
            catch
            {
            }
        }

        private ActiveReport GetActiveXMLReport(ActiveReport rpt, DataTable reportData)
        {
            // This full code should move out of this file - Ashish
            string reportPath = HttpContext.Current.Server.MapPath(&quot;~/common/GenericListReport.rpx&quot;);
            string logoPath = HttpContext.Current.Server.MapPath(AMP3ApplicationSettings.Instance.AppLogo);
            XmlReader xReader = XmlReader.Create(reportPath);
            rpt.LoadLayout(xReader);
            ((Label)rpt.Sections[&quot;ReportHeader&quot;].Controls[&quot;lblRptHeader&quot;]).Text =
                listModel.xmlModel.form.ParseDynamicString(listModel.xmlModel.form.Header);

            rpt.PageSettings.Margins.Top = 0.5F;
            rpt.PageSettings.Margins.Left = 0.5F;
            rpt.PageSettings.Margins.Bottom = 0.5F;
            rpt.PageSettings.Margins.Right = 0.5F;
            if (File.Exists(logoPath))
            {
                Image logoImage = new Bitmap(logoPath);
                var pic = ((Picture)rpt.Sections[&quot;ReportHeader&quot;].Controls[&quot;rptLogo&quot;]);
                pic.Image = logoImage;
                if (logoImage.Height &gt; pic.Height * 100 ||
                    logoImage.Width &gt; pic.Width * 100)
                    pic.SizeMode = SizeModes.Zoom;
            }
            ((TextBox)rpt.Sections[&quot;PageFooter&quot;].Controls[&quot;txtGeneratedDate&quot;]).Text = DateTime.UtcNow.ToString_WithFormatDateTime();
            rpt.ShowParameterUI = false;

            if (reportData != null)
            {
                CreateXMLReportControls(rpt, reportData);
                rpt.DataSource = reportData;
            }
            rpt.Run();
            return rpt;
        }

        private void CreateXMLReportControls(ActiveReport rpt, DataTable reportData)
        {
            // This full code should move out of this file - Ashish
            rpt.Sections.InsertGroupHF();
            float LocX = 0f;
            float LocY = 0f;

            DataTable dt = reportData;
            foreach (ControlContainer c in listModel.xmlModel.form.Containers)
                if (c.GetType() == typeof(Section))
                {
                    CreateReportControlFromSection(rpt, ref LocX, ref LocY, c as Section);
                }
                else if (c.GetType() == typeof(Stage))
                {
                    foreach (Section sec in c.Containers.OfType&lt;Section&gt;())
                        CreateReportControlFromSection(rpt, ref LocX, ref LocY, sec);
                }
                else if (c.GetType() == typeof(xTabs))
                {
                    foreach (xTab xtab in c.Containers.OfType&lt;xTab&gt;())
                        foreach (Section sec in xtab.Containers.OfType&lt;Section&gt;())
                            CreateReportControlFromSection(rpt, ref LocX, ref LocY, sec);
                }

            var ln = new Line();
            ln.LineWeight = 1f;
            ln.Width = 7.5f;
            rpt.Sections[2].Controls.Add(ln);
        }

        private void CreateReportControlFromSection(ActiveReport rpt, ref float LocX, ref float LocY, Section sec)
        {
            if (sec == null)
                return;

            foreach (xControl ctrl in sec.Controls)
            {
                if (ctrl.Controls.Count &gt; 0)
                {
                    foreach (xControl innerCtrl in ctrl.Controls)
                        if (innerCtrl.IsListVisible)
                            CreateSingleReportControl(rpt, ref LocX, ref LocY, innerCtrl);
                }
                else
                {
                    if (ctrl.IsListVisible)
                        CreateSingleReportControl(rpt, ref LocX, ref LocY, ctrl);
                }
            }

            foreach (ControlContainer c in sec.Containers)
                CreateReportControlFromSection(rpt, ref LocX, ref LocY, c as Section);
        }

        private void CreateSingleReportControl(ActiveReport rpt, ref float LocX, ref float LocY, xControl ctrl)
        {
            var txt = new TextBox();
            txt.Text = string.IsNullOrEmpty(ctrl.Caption) ? ctrl.Name : ctrl.ParseDynamicString(ctrl.Caption);
            txt.CanGrow = true;
            txt.Location = new PointF(LocX, LocY);
            txt.Size = new SizeF((float)Convert.ToDecimal(ctrl.ReportWidth, CultureInfo.CurrentCulture), 0.2f);
            txt.Style = &quot;font-weight: bold; font-size: 8pt;&quot;;
            txt.ClassName = &quot;Caption&quot;;

            var txtDetail = new TextBox();
            txtDetail.DataField = ctrl.Name;
            txtDetail.CanGrow = true;
            txtDetail.Location = new PointF(LocX, LocY);
            txtDetail.Size = new SizeF((float)Convert.ToDecimal(ctrl.ReportWidth, CultureInfo.CurrentCulture), 0.2f);
            txtDetail.Style = &quot;font-size: 8pt;&quot;;
            txtDetail.OutputFormat = GetFormatForReport(string.IsNullOrEmpty(ctrl.Format) ? &quot;&quot; : ctrl.Format);
            txtDetail.ClassName = &quot;Detail&quot;;

            LocX += (float)Convert.ToDecimal(ctrl.ReportWidth, CultureInfo.CurrentCulture);

            rpt.Sections[&quot;PageHeader&quot;].Controls.Add(txt);
            rpt.Sections[&quot;Detail&quot;].Controls.Add(txtDetail);
        }

        private MemoryStream GenerateXMLReportFromRPX(DataSet reportDataSet)
        {
            DataTable reportData = reportDataSet.Tables[0];
            var pdf = new PdfExport();
            var rpt = new ActiveReport();
            try
            {
                var strm = new MemoryStream();
                rpt = GetActiveXMLReport(rpt, reportData);
                pdf.Export(rpt.Document, strm);
                return strm;
            }
            catch (Exception)
            {
                throw;
            }
            finally
            {
                pdf.Dispose();
                rpt.Dispose();
            }
        }

        #endregion &quot;XML Report Generation&quot;

        //ToDo: This full code should move out of this file - Ashish

        #region ICallbackEventHandler Members

        string ICallbackEventHandler.GetCallbackResult()
        {
            if (listModel.HasHierarchicalGrid &amp;&amp; listModel.HierarchicalGridColumnMapping != null &amp;&amp;
                listModel.HierarchicalGridColumnMapping.ContainsKey(
                    Aurigo.Brix.Platform.BusinessLayer.Utility.MWGrid.GetDatabaseFriendlyExpression(_key)))
                return
                    listModel.HierarchicalGridColumnMapping[
                        Aurigo.Brix.Platform.BusinessLayer.Utility.MWGrid.GetDatabaseFriendlyExpression(_key)];
            return string.Empty;
        }

        private string _key = string.Empty;

        void ICallbackEventHandler.RaiseCallbackEvent(string eventArgument)
        {
            int roleId = 0;

            if (ModuleManager.Instance.IsEffectivePermissionOfRoles())
                roleId = 0;
            else
                roleId = UserDetail.GetCurrentUserDetail().RID;

            string columnName, columnWidth, tableWidth = &quot;&quot;, tableWidthValue = &quot;&quot;;

            if (eventArgument.Contains(&quot;~&quot;))
            {
                string[] args = eventArgument.Split(&quot;~&quot;.ToCharArray(), StringSplitOptions.RemoveEmptyEntries);
                columnName = args[0].Split(&quot;&amp;&quot;.ToCharArray(), StringSplitOptions.RemoveEmptyEntries)[0];
                columnWidth = args[0].Split(&quot;&amp;&quot;.ToCharArray(), StringSplitOptions.RemoveEmptyEntries)[1];
                tableWidth = args[1].Split(&quot;&amp;&quot;.ToCharArray(), StringSplitOptions.RemoveEmptyEntries)[0];
                tableWidthValue = args[1].Split(&quot;&amp;&quot;.ToCharArray(), StringSplitOptions.RemoveEmptyEntries)[1];
            }
            else
            {
                columnName = eventArgument.Split(&quot;&amp;&quot;.ToCharArray(), StringSplitOptions.RemoveEmptyEntries)[0];
                columnWidth = eventArgument.Split(&quot;&amp;&quot;.ToCharArray(), StringSplitOptions.RemoveEmptyEntries)[1];
            }

            string key =
                  _key = Aurigo.Brix.Platform.BusinessLayer.Utility.MWGrid.GetDatabaseFriendlyExpression(columnName);

            string width = (columnWidth.Length &gt; 3) ? &quot;999&quot; : columnWidth;

            var resizeSetting = new ColumnResizeSettings();
            resizeSetting.Context = context;
            resizeSetting.UserID = UserDetail.GetCurrentUserDetail().UID;
            resizeSetting.RoleID = roleId;

            StringBuilder newSetting = new StringBuilder();

            IEnumerable&lt;ColumnResizeSettings&gt; setting = ColumnSettingManager.Instance.GetResizedColumns(context, roleId, UserDetail.GetCurrentUserDetail().UID);

            if (setting.Count() &gt; 0)
            {
                newSetting.Append(setting.FirstOrDefault().Settings);
                if (Array.Find(newSetting.ToString().Split(&#39;~&#39;), s =&gt; s.StartsWith(key + &quot;=&quot;)) != null)
                {
                    string temp = Array.Find(newSetting.ToString().Split(&#39;~&#39;), s =&gt; s.StartsWith(key + &quot;=&quot;));
                    newSetting = newSetting.Replace(temp, &quot;&quot;).Replace(&quot;~~&quot;, &quot;~&quot;);
                    newSetting.AppendFormat(&quot;~{0}={1}&quot;, key, width);
                }
                else
                    newSetting.AppendFormat(&quot;~{0}={1}&quot;, key, width);
            }
            else
                newSetting.AppendFormat(&quot;{0}={1}&quot;, key, width);

            if (!string.IsNullOrEmpty(tableWidth))
            {
                if (Array.Find(newSetting.ToString().Split(&#39;~&#39;), s =&gt; s.StartsWith(tableWidth + &quot;=&quot;)) != null)
                {
                    string temp = Array.Find(newSetting.ToString().Split(&#39;~&#39;), s =&gt; s.StartsWith(tableWidth + &quot;=&quot;));
                    newSetting = newSetting.Replace(temp, &quot;&quot;).Replace(&quot;~~&quot;, &quot;~&quot;);
                    newSetting.AppendFormat(&quot;~{0}={1}&quot;, tableWidth, tableWidthValue);
                }
                else
                    newSetting.AppendFormat(&quot;~{0}={1}&quot;, tableWidth, tableWidthValue);
            }

            newSetting = newSetting.Replace(&quot;~~&quot;, &quot;~&quot;);

            resizeSetting.Settings = newSetting.ToString();

            ColumnSettingManager.Instance.SaveColumnResize(resizeSetting);
        }

        #endregion ICallbackEventHandler Members

        #region IWorkflowEnabled Members

        public bool IsOldWorkflow
        {
            get { return false; }
        }

        public new string FormInstanceId
        {
            get { return null; }
        }

        public string FormName
        {
            get { return WFFormName(); }
        }

        public string FormKey
        {
            get { return WFFormKey(); }
        }

        public string ClientValidationFunction
        {
            get { return &quot;&quot;; }
        }

        public int ParentModuleId
        {
            get { return (string.IsNullOrEmpty(Request[&quot;ParentID&quot;])) ? 0 : Request[&quot;ParentID&quot;].ToInt32_2(); }
        }

        public int PID
        {
            get { return (string.IsNullOrEmpty(Request[&quot;PID&quot;])) ? 0 : Request[&quot;PID&quot;].ToInt32_2(); }
        }

        public string PostCancelRedirectUrl
        {
            get { return this.Request.Url.AbsolutePath; }
        }

        public bool SaveHandler(object sender, out string sSavedInstanceToken, out string sErrors,
            out string sRedirectTo)
        {
            throw new NotImplementedException();
        }

        public void CancelHandler(object sender, bool bAfterSave, out string sRedirectTo)
        {
            throw new NotImplementedException();
        }

        public string PostSaveRedirectUrl(string sSavedToken = &quot;&quot;)
        {
            return this.Request.Url.AbsolutePath;
        }

        #endregion IWorkflowEnabled Members

        //Teleric control methods starts here

        private GridKnownFunction GetGridKnownFunction(string filterFunctionName)
        {
            GridKnownFunction gridKnownFunction;
            switch (filterFunctionName)
            {
                case &quot;EqualTo&quot;:
                    gridKnownFunction = GridKnownFunction.EqualTo;
                    break;

                case &quot;NotEqualTo&quot;:
                    gridKnownFunction = GridKnownFunction.NotEqualTo;
                    break;

                case &quot;GreaterThan&quot;:
                    gridKnownFunction = GridKnownFunction.GreaterThan;
                    break;

                case &quot;LessThan&quot;:
                    gridKnownFunction = GridKnownFunction.LessThan;
                    break;

                case &quot;GreaterThanOrEqualTo&quot;:
                    gridKnownFunction = GridKnownFunction.GreaterThanOrEqualTo;
                    break;

                case &quot;LessThanOrEqualTo&quot;:
                    gridKnownFunction = GridKnownFunction.LessThanOrEqualTo;
                    break;

                case &quot;Between&quot;:
                    //column.CurrentFilterValue = &quot;&#39;&quot; + filterPattern + &quot;&#39; &lt;= [OrderDate] AND [OrderDate] &lt;= &#39;&quot; + filterPatternAssist + &quot;&#39;&quot;;
                    gridKnownFunction = GridKnownFunction.Between;
                    break;

                case &quot;NotBetween&quot;:
                    //column.CurrentFilterValue = &quot;[OrderDate] &lt;= &#39;&quot; + filterPattern + &quot;&#39; OR [OrderDate] &gt;= &#39;&quot; + filterPatternAssist + &quot;&#39;&quot;;
                    gridKnownFunction = GridKnownFunction.NotBetween;
                    break;

                case &quot;IsNull&quot;:
                    gridKnownFunction = GridKnownFunction.IsNull;
                    break;

                case &quot;NotIsNull&quot;:
                    gridKnownFunction = GridKnownFunction.NotIsNull;
                    break;

                default:
                    gridKnownFunction = GridKnownFunction.NoFilter;
                    break;
            }

            return gridKnownFunction;
        }

        private bool IsDate(GridBoundColumn column)
        {
            return (column != null)
                ? ((column.DataType == Type.GetType(&quot;System.DateTime&quot;)) &amp;&amp; !column.DataFormatString.ToLower().Contains(&quot;h&quot;))
                : false;
        }

        protected void MWGrid_ItemCommand(object sender, GridCommandEventArgs e)
        {
            switch (e.CommandName)
            {
                case &quot;RowDblClick&quot;:
                    HandleTGridDoubleClick(sender, e);
                    break;

                case &quot;ClearAllFilter&quot;:
                    //Clear all filters
                    e.Canceled = true;
                    ClearFilterTextFromSelectedFilterMenu(PageState);
                    break;

                case RadGrid.FilterCommandName:

                    //Patch for Telerik Issue: http://www.telerik.com/forums/radgrid-filter-with-and-and-or
                    foreach (var col in MWGrid.MasterTableView.Columns)
                    {
                        var tColumn = col as GridColumn;
                        //&#39;Replace AND/OR to avoid conflict with Telerik&#39;s reserved keywords
                        tColumn.CurrentFilterValue = tColumn.CurrentFilterValue.Replace(&quot; AND &quot;, &quot; and &quot;).Replace(&quot; OR &quot;, &quot; or &quot;);
                    }

                    //By default the expression takes Date along with time and we need to create a custom expression for where clause. Example: CAST(DateField AS DATE) = CAST(Value AS DATE)
                    //Below code fixes this and prepares a custom expression.
                    Pair filterPair = (Pair)e.CommandArgument;
                    string filterFunction = filterPair.First.ToString();
                    GridColumn column = e.Item.OwnerTableView.GetColumnSafe(filterPair.Second.ToString()) as GridColumn;
                    if (filterFunction == GridKnownFunction.Custom.ToString())
                    {
                        //Clear all filter
                        e.Canceled = true;
                        ClearFilterTextFromSelectedFilterMenu(PageState);
                    }
                    else if (filterFunction == GridKnownFunction.NoFilter.ToString())
                    {
                        //Remove associated filter expression from the list for applied column
                        PageState.GridFilterExpressionList.RemoveAll(x =&gt; x.ColumnName == column.UniqueName);
                    }
                    else
                    {
                        //If Date column, Cancel default filter operations and set columns CurrentFilterFunction which wil be used later to create custom filter expression for Date.
                        //Rest (non-date columns) will be handled automatically by RadGrid.
                        if (IsDate(column as GridBoundColumn))
                        {
                            e.Canceled = true;
                            column.CurrentFilterFunction = (!string.IsNullOrEmpty(column.CurrentFilterValue))
                                ? GetGridKnownFunction(filterFunction)
                                : column.CurrentFilterFunction;
                        }
                    }
                    break;
            }
        }

        protected void MWGrid_NeedDataSource(object sender, GridNeedDataSourceEventArgs e)
        {
            if (Trace.IsEnabled)
                Trace.Write(&quot;aspx.page&quot;, &quot;Begin MWGrid_NeedDataSource()&quot;);

            //Initialize pagestate
            if (PageState == null)
                InitSortAndFilter();

            //Prepare filter criteria
            PageState.FilterCriterion = GetCompleteFilterExpression();

            //Set GroupBy expression
            SetGroupByExpression();

            //Bind datasource
            BindGridControl();

            if (Trace.IsEnabled)
                Trace.Write(&quot;aspx.page&quot;, &quot;End MWGrid_NeedDataSource()&quot;);
        }

        private void SetGroupByExpression()
        {
            if ((!Page.IsPostBack))
            {
                MWGrid.MasterTableView.GroupByExpressions.Clear();
                foreach (Common.GridGroupByExpression item in PageState.GridGroupByExpressionList)
                {
                    Telerik.Web.UI.GridGroupByExpression expression = new Telerik.Web.UI.GridGroupByExpression();
                    GridGroupByField gridGroupByFieldForSelect = new GridGroupByField();
                    gridGroupByFieldForSelect.FieldName =
                        Aurigo.Brix.Platform.BusinessLayer.Utility.MWGrid.GetGridFriendlyExpression(item.ColumnName);
                    gridGroupByFieldForSelect.HeaderText = item.ColumnName;
                    //gridGroupByFieldForSelect.FormatString = &quot;&lt;strong&gt;{0}&lt;/strong&gt;&quot;;
                    expression.SelectFields.Add(gridGroupByFieldForSelect);
                    GridGroupByField gridGroupByFieldForGroupBy = new GridGroupByField();
                    gridGroupByFieldForGroupBy.CopyFrom(gridGroupByFieldForSelect);
                    gridGroupByFieldForGroupBy.SortOrder = item.SortOrder;
                    expression.GroupByFields.Add(gridGroupByFieldForGroupBy);
                    MWGrid.MasterTableView.GroupByExpressions.Add(expression);
                }
            }
        }

        protected void MWGrid_SortCommand(object source, GridSortCommandEventArgs e)
        {
            if (PageState == null)
                InitSortAndFilter();

            ApplySort(
                Aurigo.Brix.Platform.BusinessLayer.Utility.MWGrid.GetDatabaseFriendlyExpression(
                    e.CommandArgument.ToString()), e.NewSortOrder, e.OldSortOrder != GridSortOrder.None);

            // Apply new sort on GroupByFields if user sorts the grid by grouped field itself
            if (
                PageState.GridGroupByExpressionList.Where(
                    x =&gt;
                        x.ColumnName ==
                        Aurigo.Brix.Platform.BusinessLayer.Utility.MWGrid.GetDatabaseFriendlyExpression(e.SortExpression))
                    .ToList()
                    .Count &gt; 0)
            {
                MWGrid.MasterTableView.GroupByExpressions.OfType&lt;Telerik.Web.UI.GridGroupByExpression&gt;()
                    .ToList()
                    .ForEach(
                        ex =&gt;
                            ex.GroupByFields.OfType&lt;GridGroupByField&gt;()
                                .Where(x =&gt; x.FieldName == e.SortExpression)
                                .ToList()
                                .ForEach(x =&gt; x.SortOrder = e.NewSortOrder));
                PageState.GridGroupByExpressionList.Where(
                    x =&gt;
                        x.ColumnName ==
                        Aurigo.Brix.Platform.BusinessLayer.Utility.MWGrid.GetDatabaseFriendlyExpression(e.SortExpression))
                    .ForEach(x =&gt; x.SortOrder = e.NewSortOrder);
                PageState.MaintainState(PageState.PageIndex, PageState.SortKey, PageState.SortOrder,
                    PageState.FilterCriterion, PageState.GridFilterExpressionList, PageState.GridGroupByExpressionList);

                SavePageStateToCurrentFilterState(PageState);
            }
        }

        protected void MWGrid_Init(object sender, EventArgs e)
        {
            //Set filter commands
            /*
            GridFilterMenu menu = MWGrid.FilterMenu;
            int i = 0;
            while (i &lt; menu.Items.Count)
            {
                if (menu.Items[i].Text == &quot;NoFilter&quot; || menu.Items[i].Text == &quot;Contains&quot; || menu.Items[i].Text == &quot;EqualTo&quot; || menu.Items[i].Text == &quot;GreaterThan&quot; || menu.Items[i].Text == &quot;LessThan&quot;)
                {
                    i++;
                }
                else
                {
                    menu.Items.RemoveAt(i);
                }
            }
             * */
            //SetColumnAttributes();
        }

        private void FormatColumnCell(GridBoundColumn column, GridDataItem item)
        {
            if (column == null)
                return;

            //if (column != null)
            //{
            //    // Commenting this code, on Rebinding() it was converting again and again
            //    //if (IsDate(column) &amp;&amp; !string.IsNullOrEmpty(item[column.UniqueName].Text))
            //    //{
            //    //    item[column.UniqueName].Text = Convert.ToDateTime(item[column.UniqueName].Text).ToMWDateTime().ToString();
            //    //}

            //    item[column.UniqueName].ToolTip = (item[column.UniqueName].Text == string.Empty ||
            //                                       item[column.UniqueName].Text == &quot;&amp;nbsp;&quot;)
            //        ? &quot;&quot;
            //        : item[column.UniqueName].Text;
            //}

            string txt = item[column.UniqueName].Text;
            item[column.UniqueName].ToolTip = (string.IsNullOrEmpty(txt) || txt == &quot;&amp;nbsp;&quot;) ? string.Empty : System.Net.WebUtility.HtmlDecode(txt);
        }

        protected void MWGrid_ItemDataBound(object sender, GridItemEventArgs e)
        {
            if (e.Item is GridDataItem)
            {
                GridDataItem item = e.Item as GridDataItem;

                foreach (GridColumn column in MWGrid.MasterTableView.RenderColumns)
                {
                    string controlName = Brix.Platform.BusinessLayer.Utility.MWGrid.GetDatabaseFriendlyExpression(column.UniqueName);
                    xControl control = null;

                    if (listModel.xmlModel != null)
                        control = listModel.xmlModel.form.GetControl(controlName);

                    if (column is GridBoundColumn)
                    {
                        FormatColumnCell(column as GridBoundColumn, item);
                    }

                    if (control != null &amp;&amp; control.Type == XC.ControlType.Formatted)
                    {
                        object cellValue = item[controlName].Text.Replace(&quot;&amp;nbsp;&quot;, &quot;&quot;).Trim();

                        if (!Convert.IsDBNull(cellValue) &amp;&amp; !string.IsNullOrEmpty(cellValue.ToString()))
                        {
                            RadMaskedTextBox temp = new RadMaskedTextBox();
                            temp.Mask = control.Format;
                            temp.Text = cellValue.ToString();

                            item[controlName].Text = temp.TextWithLiterals;
                        }
                    }
                }

                string attachmentColumn = &quot;img_DataHasAttachments&quot;;
                if (Brix.Platform.BusinessLayer.Utility.MWGrid.ColumnExists(item, attachmentColumn))
                {
                    string value = Convert.ToString(item[attachmentColumn].Text, CultureInfo.CurrentCulture);
                    if (value.ToUpper() == &quot;TRUE&quot;)
                    {
                        item[attachmentColumn].Style.Add(&quot;background-image&quot;,
                            &quot;url(&#39;&quot; + string.Format(CultureInfo.CurrentCulture,
                                &quot;/Images/toolbar/IcnAttachmentBW.png&quot;) + &quot;&#39;)&quot;);
                        item[attachmentColumn].Style.Add(&quot;Background-repeat&quot;, &quot;no-repeat&quot;);
                        item[attachmentColumn].Style.Add(&quot;background-position&quot;, &quot;center center&quot;);
                        item[attachmentColumn].ForeColor = Color.White;
                        item[attachmentColumn].Font.Size = FontUnit.Point(1);
                    }
                }

                string annotationColumn = &quot;img_DataHasAnnotations&quot;;
                if (Brix.Platform.BusinessLayer.Utility.MWGrid.ColumnExists(item, annotationColumn))
                {
                    string value = Convert.ToString(item[annotationColumn].Text, CultureInfo.CurrentCulture);
                    if (value.ToUpper() == &quot;TRUE&quot;)
                    {
                        item[annotationColumn].Style.Add(&quot;background-image&quot;,
                            &quot;url(&#39;&quot; + string.Format(CultureInfo.CurrentCulture,
                                &quot;/Images/OfficeBar/Icn_Edit2_16.png&quot;) + &quot;&#39;)&quot;);
                        item[annotationColumn].Style.Add(&quot;Background-repeat&quot;, &quot;no-repeat&quot;);
                        item[annotationColumn].Style.Add(&quot;background-position&quot;, &quot;center center&quot;);
                        item[annotationColumn].ForeColor = Color.White;
                        item[annotationColumn].Font.Size = FontUnit.Point(1);
                    }
                }

                foreach (DataRow row in listModel.GridImageInfo.Rows)
                {
                    string key = row[&quot;Key&quot;].ToString2();
                    string imgkey = &quot;img_&quot; + row[&quot;Key&quot;].ToString2();
                    if (item.OwnerTableView.Columns.FindByUniqueNameSafe(key) != null &amp;&amp;
                        item.OwnerTableView.Columns.FindByUniqueNameSafe(imgkey) != null)
                    {
                        string value = Convert.ToString(item[key].Text, CultureInfo.CurrentCulture);
                        if (row[&quot;Value&quot;].ToString2().Equals(value))
                        {
                            item[imgkey].Style.Add(&quot;background-image&quot;,
                                &quot;url(&#39;&quot; + string.Format(CultureInfo.CurrentCulture,
                                    &quot;/Images/toolbar/{0}&quot;,
                                    row[&quot;ImageFile&quot;].ToString2()) + &quot;&#39;)&quot;);
                            item[imgkey].Style.Add(&quot;Background-repeat&quot;, &quot;no-repeat&quot;);
                            item[imgkey].Style.Add(&quot;background-position&quot;, &quot;center center&quot;);
                            item[imgkey].ForeColor = Color.White;
                            item[imgkey].Font.Size = FontUnit.Point(1);
                            item[imgkey].ToolTip = row[&quot;Caption&quot;].ToString2();
                        }
                    }
                }
            }
            // to Fix XSS attack in grid&#39;s group by header
            else if (e.Item is GridGroupHeaderItem)
            {
                GridGroupHeaderItem item = e.Item as GridGroupHeaderItem;
                string startKey = Guid.NewGuid().ToString();
                string endKey = Guid.NewGuid().ToString();
                string text = item.DataCell.Text;
                if (text.Contains(&quot;&lt;strong&gt;&quot;))
                    text = text.Replace(&quot;&lt;strong&gt;&quot;, startKey);
                if (text.Contains(&quot;&lt;/strong&gt;&quot;))
                    text = text.Replace(&quot;&lt;/strong&gt;&quot;, endKey);

                item.DataCell.Text = HttpUtility.HtmlEncode(text).Replace(startKey, &quot;&lt;strong&gt;&quot;).Replace(endKey, &quot;&lt;/strong&gt;&quot;);
            }
            listModel.HandleGridRowInitialization(sender, e.Item);

            #region To convert True to Yes and False to No : BugFix 58930

            if (e.Item is GridGroupHeaderItem)
            {
                //Src: https://www.telerik.com/forums/group-header---change-boolean-to-something-more-meaningful
                GridGroupHeaderItem hitem = (GridGroupHeaderItem)e.Item;

                DataRowView groupDataRow = (DataRowView)e.Item.DataItem;

                foreach (DataColumn column in groupDataRow.Row.Table.Columns)
                {
                    if (groupDataRow[column.ColumnName].GetType() == typeof(bool))
                    {
                        if (groupDataRow[column.ColumnName].ToString() == &quot;False&quot;)
                            hitem.DataCell.Text = column.Caption + &quot;: No&quot;;
                        else
                            hitem.DataCell.Text = column.Caption + &quot;: Yes&quot;;
                    }
                }
            }

            #endregion To convert True to Yes and False to No : BugFix 58930
        }

        protected void MWGrid_ItemCreated(object sender, GridItemEventArgs e)
        {
            RadGrid grid = (sender as RadGrid);

            if (e.Item is GridFilteringItem)
            {
                if (grid.DataSource != null)
                {
                    DataSet dataSet = grid.DataSource as DataSet;
                    if (dataSet.Tables.Count &gt; 0)
                    {
                        foreach (DataColumn column in dataSet.Tables[0].Columns)
                        {
                            /* Start: Commented code to allow filtering(Bug: 90629)*/

                            //// TODO: Filters for columns with dropdown list text are hidden intentionally in first release.
                            //// TODO: Custom dropdownlist(as filter) for these columns to be added.
                            //// Now filters are made invisible for such columns to avoid crash temporarily
                            //GridColumn gridColumn = MWGrid.MasterTableView.GetColumnSafe(column.ColumnName);
                            //if (gridColumn != null &amp;&amp; column.ExtendedProperties[&quot;ListItems&quot;] != null)
                            //{
                            //    if (gridColumn is GridBoundColumn) (gridColumn as GridBoundColumn).AllowFiltering = false;

                            //    //GridFilteringItem filteringItem = (e.Item as GridFilteringItem);
                            //    //filteringItem[column.ColumnName].Controls.Clear();
                            //    //filteringItem[column.ColumnName].Controls.Add(GetFilterDropdownControl(column.ExtendedProperties[&quot;ListItems&quot;] as Dictionary&lt;string, string&gt;));
                            //}

                            /* End: Commented code to allow filtering(Bug: 90629)*/

                            //Patch to prevent comma from appearing in numerif filter field.
                            //Src: http://www.telerik.com/forums/remove-comma-from-value-of-a-numeric-filter-for-radgrid
                            //BugFix:
                            GridColumn gridColumn = MWGrid.MasterTableView.GetColumnSafe(column.ColumnName);
                            if (gridColumn is GridNumericColumn)
                            {
                                GridFilteringItem filerItem = (GridFilteringItem)e.Item;
                                // Condition added for columns created from Expression List as these columns will not have Filters.
                                if (filerItem[gridColumn.UniqueName].Controls.Count &gt; 0)
                                {
                                    RadNumericTextBox textItem = (RadNumericTextBox)filerItem[gridColumn.UniqueName].Controls[0];
                                    textItem.NumberFormat.GroupSeparator = &quot;&quot;;
                                }
                            }
                        }
                    }
                }
            }
        }

        private RadComboBox GetFilterDropdownControl(Dictionary&lt;string, string&gt; dic)
        {
            RadComboBox filterDropdownControl = new RadComboBox();
            dic.ForEach(x =&gt; filterDropdownControl.Items.Add(new RadComboBoxItem(x.Value, x.Key)));
            //cbo.ID = &quot;activeFilterCbo&quot;;
            filterDropdownControl.Width = new Unit(65);
            filterDropdownControl.Skin = &quot;Office2007&quot;;
            filterDropdownControl.AutoPostBack = true;
            filterDropdownControl.SelectedIndexChanged += filterDropdownControl_SelectedIndexChanged;
            filterDropdownControl.Enabled = true;
            filterDropdownControl.EnableViewState = true;
            return filterDropdownControl;
        }

        private void filterDropdownControl_SelectedIndexChanged(object sender, RadComboBoxSelectedIndexChangedEventArgs e)
        {
            MWGrid.MasterTableView.Rebind();
        }

        protected void MWGrid_BatchEditCommand(object sender, GridBatchEditingEventArgs e)
        {
            if ((listModel.dtmwGridModified == null) || (listModel.dtmwGridModified.Columns.Count == 0))
            {
                listModel.dtmwGridModified = new DataTable();
                listModel.dtmwGridModified = listModel.SetInLineEditingDataColumn();
            }
            //listModel.SetMWGridPrimaryKey(listModel.GridPrimaryKey);
            // DataTable dtEditedTable = listModel.dtmwGridModified;

            foreach (GridBatchEditingCommand editItem in e.Commands)
            {
                DataRow drEditedRow = listModel.dtmwGridModified.NewRow();
                drEditedRow[listModel.GridPrimaryKey] = editItem.Item[listModel.GridPrimaryKey].Text;
                foreach (DataColumn coln in listModel.dtmwGridModified.Columns)
                {
                    if (!string.IsNullOrEmpty(editItem.NewValues[coln.ColumnName].ToString2()))
                    {
                        drEditedRow[coln.ColumnName] = editItem.NewValues[coln.ColumnName].ToString2();
                    }
                }
                listModel.dtmwGridModified.Rows.Add(drEditedRow);
            }
            listModel.HandleListSave();
        }

        protected void MWGrid_GroupsChanging(object sender, GridGroupsChangingEventArgs e)
        {
            if (e.Action == GridGroupsChangingAction.Group)
            {
                PageState.GridGroupByExpressionList = new List&lt;Common.GridGroupByExpression&gt;();
                MWGrid.MasterTableView.GroupByExpressions.OfType&lt;Telerik.Web.UI.GridGroupByExpression&gt;()
                    .ToList()
                    .ForEach(
                        x =&gt;
                            PageState.GridGroupByExpressionList.Add(
                                new Common.GridGroupByExpression(
                                    Brix.Platform.BusinessLayer.Utility.MWGrid.GetDatabaseFriendlyExpression(
                                        x.GroupByFields[0].FieldName), x.GroupByFields[0].SortOrder)));
                if (
                    !PageState.GridGroupByExpressionList.Any(
                        x =&gt; x.ColumnName == e.Expression.GroupByFields[0].FieldName))
                {
                    PageState.GridGroupByExpressionList.Add(
                        new Common.GridGroupByExpression(
                            Brix.Platform.BusinessLayer.Utility.MWGrid.GetDatabaseFriendlyExpression(
                                e.Expression.GroupByFields[0].FieldName), e.Expression.GroupByFields[0].SortOrder));
                }
                PageState.MaintainState(PageState.PageIndex, PageState.SortKey, PageState.SortOrder,
                    PageState.FilterCriterion, PageState.GridFilterExpressionList, PageState.GridGroupByExpressionList);

                SavePageStateToCurrentFilterState(PageState);
            }
            else if (e.Action == GridGroupsChangingAction.Ungroup)
            {
                PageState.GridGroupByExpressionList = new List&lt;Common.GridGroupByExpression&gt;();
                MWGrid.MasterTableView.GroupByExpressions.OfType&lt;Telerik.Web.UI.GridGroupByExpression&gt;()
                    .ToList()
                    .Where(
                        x =&gt;
                            x.GroupByFields[0].FieldName !=
                            Brix.Platform.BusinessLayer.Utility.MWGrid.GetDatabaseFriendlyExpression(
                                e.Expression.GroupByFields[0].FieldName))
                    .ForEach(
                        x =&gt;
                            PageState.GridGroupByExpressionList.Add(
                                new Common.GridGroupByExpression(x.GroupByFields[0].FieldName,
                                    x.GroupByFields[0].SortOrder)));
                PageState.MaintainState(PageState.PageIndex, PageState.SortKey, PageState.SortOrder,
                    PageState.FilterCriterion, PageState.GridFilterExpressionList, PageState.GridGroupByExpressionList);

                SavePageStateToCurrentFilterState(PageState);
            }
        }

        public static string GetFormActionString(FormAction action)
        {
            XmlDocument xdoc = new XmlDocument();
            xdoc.LoadXml(action.ToString());
            return xdoc.DocumentElement.InnerText;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[83,9,83,49,1],[87,17,87,18,1],[87,19,87,43,1],[87,44,87,45,1],[88,17,88,18,1],[88,19,88,42,1],[88,43,88,44,1],[93,17,93,18,1],[93,19,93,66,1],[93,67,93,68,1],[94,17,94,18,1],[94,19,94,56,1],[94,57,94,58,1],[99,17,99,18,0],[99,19,99,66,0],[99,67,99,68,0],[100,17,100,18,1],[100,19,100,56,1],[100,57,100,58,1],[103,39,103,43,0],[103,44,103,48,0],[103,53,103,65,1],[110,9,110,10,1],[111,13,111,59,1],[112,9,112,10,1],[121,9,121,10,1],[123,13,123,14,1],[125,17,125,39,1],[128,17,128,43,1],[130,17,130,32,1],[133,17,133,37,1],[135,17,135,38,1],[136,21,136,78,1],[138,17,138,50,1],[139,17,139,66,1],[140,17,140,47,1],[141,17,141,44,1],[143,17,143,45,1],[144,13,144,14,1],[145,13,145,30,0],[146,13,146,14,0],[148,13,148,14,0],[149,9,149,10,1],[152,9,152,10,1],[155,13,155,59,1],[156,13,156,35,1],[157,13,157,14,1],[158,17,158,54,1],[160,17,160,84,1],[161,17,161,18,1],[162,21,162,28,1],[162,30,162,50,1],[162,51,162,53,1],[162,54,162,78,1],[163,21,163,22,1],[164,25,165,45,1],[166,29,168,78,0],[169,21,169,22,1],[170,17,170,18,1],[171,22,172,68,1],[173,17,173,18,1],[174,21,174,28,1],[174,30,174,50,1],[174,51,174,53,1],[174,54,174,85,1],[175,21,175,22,1],[176,25,177,45,1],[178,29,179,97,0],[180,21,180,22,1],[181,17,181,18,1],[182,13,182,14,1],[186,13,186,32,1],[187,17,187,64,1],[188,9,188,10,1],[196,9,196,10,1],[198,13,198,68,1],[199,13,199,14,1],[201,17,201,72,1],[202,21,202,34,0],[203,13,203,14,1],[210,13,210,58,1],[211,13,211,14,1],[212,17,212,77,1],[213,21,213,34,0],[214,13,214,14,1],[216,13,216,25,1],[217,9,217,10,1],[220,9,220,10,1],[222,13,222,38,1],[223,17,223,30,0],[225,13,225,63,1],[226,13,226,46,1],[227,9,227,10,1],[230,9,230,10,1],[231,13,231,46,1],[232,13,232,48,1],[233,13,233,58,1],[235,13,235,86,1],[236,13,236,66,1],[237,13,237,75,1],[238,9,238,10,1],[241,9,241,10,1],[242,13,242,31,1],[243,13,243,32,1],[245,13,245,29,1],[246,17,246,42,1],[248,13,248,40,1],[250,13,250,35,1],[251,13,251,14,0],[253,17,255,74,0],[257,17,257,24,0],[260,13,260,79,1],[261,17,261,89,1],[263,13,263,87,1],[264,13,264,43,1],[265,13,266,38,1],[267,13,267,76,1],[268,17,268,91,1],[270,13,271,105,1],[273,17,273,61,1],[274,13,275,59,1],[277,17,277,65,1],[279,13,279,43,1],[280,17,280,40,1],[281,13,282,39,1],[283,17,283,55,1],[285,13,285,110,1],[286,17,286,51,0],[287,9,287,10,1],[297,9,297,10,1],[298,13,298,82,1],[299,13,300,102,1],[302,17,302,72,1],[303,21,303,111,1],[304,9,304,10,0],[307,9,307,10,1],[308,13,308,60,1],[309,17,309,54,0],[312,13,312,39,1],[314,13,314,32,1],[315,13,315,62,1],[317,13,317,42,1],[318,13,318,65,1],[320,13,320,70,1],[322,13,322,92,1],[324,13,324,88,1],[326,13,329,22,1],[330,13,330,43,1],[330,44,330,67,0],[331,13,331,78,1],[332,13,332,14,0],[333,17,333,98,0],[334,13,334,14,0],[336,13,336,122,1],[337,13,337,14,1],[338,17,338,93,1],[341,17,341,86,1],[342,17,342,88,1],[343,13,343,14,1],[344,13,344,47,1],[345,13,345,14,0],[346,17,346,71,0],[347,13,347,14,0],[349,13,349,80,1],[351,13,351,86,1],[352,13,352,82,1],[354,13,354,85,1],[355,13,355,14,0],[356,17,356,114,0],[357,17,357,18,0],[358,21,358,52,0],[359,21,360,30,0],[361,21,361,76,0],[362,21,362,70,0],[363,17,363,18,0],[364,13,364,14,0],[365,13,365,65,1],[366,13,366,14,1],[367,17,367,51,1],[368,17,368,72,1],[369,13,369,14,1],[370,13,370,50,1],[371,13,371,56,1],[372,13,372,42,1],[375,13,375,62,1],[376,13,376,60,1],[378,13,380,83,1],[381,13,382,89,1],[384,13,384,53,1],[385,13,385,14,1],[403,17,403,51,1],[405,17,405,72,1],[406,17,407,100,1],[408,17,409,95,1],[411,17,411,141,1],[417,17,417,54,1],[419,17,419,69,1],[420,17,420,75,1],[421,17,421,70,1],[423,17,424,102,1],[425,17,426,98,1],[431,17,431,53,1],[433,17,433,68,1],[434,17,434,69,1],[435,17,435,74,1],[437,17,438,100,1],[439,17,440,97,1],[443,13,443,14,1],[445,13,445,49,1],[446,13,446,14,0],[447,17,447,118,0],[448,13,448,14,0],[450,13,450,58,1],[451,13,451,14,0],[452,17,452,51,0],[454,17,457,103,0],[458,17,459,94,0],[460,13,460,14,0],[462,13,462,75,1],[463,13,463,14,0],[464,17,464,98,0],[465,17,465,48,0],[466,17,466,80,0],[468,17,468,75,0],[469,17,470,85,0],[471,17,472,115,0],[473,17,473,53,0],[474,17,474,18,0],[475,21,475,83,0],[476,25,476,101,0],[477,17,477,18,0],[478,13,478,14,0],[480,13,480,79,1],[482,13,482,14,0],[483,17,483,55,0],[485,17,485,76,0],[486,17,487,96,0],[489,17,490,122,0],[491,13,491,14,0],[493,13,493,110,1],[494,13,494,14,0],[495,17,495,58,0],[497,17,497,79,0],[498,17,498,102,0],[499,17,500,95,0],[502,17,503,125,0],[505,13,505,14,0],[507,13,507,44,1],[508,13,508,14,0],[509,17,509,95,0],[510,17,510,47,0],[511,17,511,90,0],[513,17,513,95,0],[514,17,514,83,0],[515,17,516,80,0],[517,17,518,119,0],[519,13,519,14,0],[521,13,521,39,1],[522,13,522,14,0],[523,17,523,106,0],[524,17,524,46,0],[525,13,525,14,0],[526,13,526,28,1],[527,9,527,10,1],[531,9,531,10,0],[532,13,532,63,0],[533,9,533,10,0],[536,9,536,10,0],[537,13,537,60,0],[538,13,538,14,0],[539,17,539,62,0],[540,17,540,18,0],[542,21,542,52,0],[543,21,543,55,0],[545,21,545,90,0],[546,21,546,91,0],[548,21,548,103,0],[549,17,549,18,0],[550,13,550,14,0],[551,9,551,10,0],[554,9,554,10,0],[555,13,555,68,0],[556,13,556,14,0],[557,17,557,61,0],[558,17,558,18,0],[559,21,559,63,0],[560,17,560,18,0],[561,22,561,68,0],[562,17,562,18,0],[563,21,563,53,0],[564,21,564,53,0],[565,21,565,60,0],[566,17,566,18,0],[567,22,567,65,0],[568,17,568,18,0],[569,21,569,62,0],[570,17,570,18,0],[571,13,571,14,0],[573,13,573,14,0],[574,17,574,35,0],[575,13,575,14,0],[576,9,576,10,0],[579,9,579,10,1],[581,13,581,75,1],[581,75,581,94,1],[581,94,581,96,1],[581,13,581,96,1],[582,13,582,34,1],[583,13,583,14,1],[584,17,584,52,1],[585,17,585,41,1],[586,17,586,43,1],[588,17,588,100,1],[589,13,589,14,1],[593,9,593,10,1],[604,13,604,14,1],[605,17,608,94,1],[609,13,609,14,1],[613,9,613,10,1],[614,13,614,29,1],[615,13,615,14,1],[616,17,616,74,1],[617,13,617,14,1],[619,13,619,80,1],[620,13,620,147,1],[623,13,623,66,1],[624,13,624,50,1],[626,13,626,89,1],[627,13,627,93,1],[629,13,629,71,1],[630,13,630,65,1],[631,13,631,14,0],[632,17,632,69,0],[633,17,633,55,0],[634,17,634,68,0],[635,13,635,14,0],[637,13,637,14,1],[638,17,638,55,1],[639,17,639,68,1],[640,13,640,14,1],[642,13,642,66,1],[643,17,643,95,1],[644,13,644,66,1],[645,17,645,97,1],[647,13,647,51,1],[648,13,648,55,1],[650,13,651,28,1],[653,13,654,54,1],[655,13,655,82,1],[657,13,657,82,1],[658,13,658,60,1],[659,13,659,14,1],[660,17,660,66,1],[661,17,661,18,0],[662,21,666,93,0],[667,17,667,18,0],[668,13,668,14,1],[669,13,669,48,1],[670,17,670,53,1],[672,17,672,52,1],[691,13,691,106,1],[692,17,692,60,1],[693,13,693,39,1],[694,13,694,14,0],[695,17,695,44,0],[696,17,696,69,0],[697,13,697,14,0],[700,13,700,14,1],[701,17,701,39,1],[701,40,701,62,1],[702,13,702,14,1],[703,13,703,33,0],[704,13,704,14,0],[705,17,705,70,0],[706,17,706,75,0],[707,13,707,14,0],[708,9,708,10,1],[711,9,711,10,1],[713,13,713,97,1],[714,13,714,14,1],[715,17,715,66,1],[717,17,717,95,1],[718,17,718,87,1],[719,17,719,55,1],[720,17,720,63,1],[721,13,721,14,0],[723,13,723,40,1],[724,13,724,14,0],[725,17,725,24,0],[725,26,725,42,0],[725,43,725,45,0],[725,46,725,74,0],[726,17,726,18,0],[728,21,728,94,0],[729,21,729,22,0],[730,25,730,71,0],[731,25,731,71,0],[732,25,732,48,0],[733,21,733,22,0],[734,17,734,18,0],[735,17,736,93,0],[737,21,737,86,0],[738,13,738,14,0],[740,13,740,44,1],[741,13,741,33,1],[742,13,742,37,1],[760,13,760,51,1],[761,13,761,14,1],[762,17,762,37,1],[763,13,763,14,1],[765,13,765,14,1],[766,17,766,63,1],[767,13,767,14,1],[769,13,769,37,1],[770,13,770,45,1],[771,13,771,45,1],[772,13,772,43,1],[776,13,776,29,1],[783,13,783,42,1],[784,13,784,45,1],[786,13,786,108,1],[787,13,787,14,1],[788,17,788,102,1],[789,13,789,14,1],[800,13,800,38,1],[801,17,801,75,0],[803,13,803,57,1],[804,13,804,14,1],[805,17,805,86,1],[806,13,806,14,1],[809,13,809,64,1],[809,64,809,85,1],[809,85,809,87,1],[809,13,809,87,1],[810,13,810,33,1],[811,13,811,14,1],[812,17,812,69,1],[812,69,812,89,1],[812,89,812,91,1],[812,17,812,91,1],[813,17,813,102,1],[814,17,814,18,0],[815,21,815,45,0],[816,21,816,40,0],[817,17,817,18,0],[818,13,818,14,1],[820,13,820,43,1],[821,13,821,14,1],[822,17,822,73,1],[823,17,823,18,1],[824,21,827,101,1],[828,17,828,18,1],[829,13,829,14,1],[832,13,832,87,1],[833,13,833,91,1],[834,17,834,55,1],[836,13,836,121,1],[837,17,837,43,0],[839,17,839,44,1],[840,9,840,10,1],[843,9,843,10,0],[844,13,844,26,0],[846,13,846,33,0],[847,13,847,31,0],[848,13,848,28,0],[849,13,849,14,0],[850,17,850,105,0],[851,17,851,35,0],[852,13,852,14,0],[854,13,854,14,0],[855,17,855,94,0],[856,17,856,35,0],[857,17,857,33,0],[859,17,859,75,0],[860,17,860,18,0],[861,21,861,28,0],[861,30,861,47,0],[861,48,861,50,0],[861,51,861,92,0],[862,21,862,22,0],[863,25,863,60,0],[864,21,864,22,0],[865,17,865,18,0],[867,17,867,18,0],[868,21,868,28,0],[868,30,868,47,0],[868,48,868,50,0],[868,51,868,79,0],[869,21,869,22,0],[870,25,870,106,0],[871,25,871,26,0],[872,29,872,64,0],[873,25,873,26,0],[874,21,874,22,0],[875,17,875,18,0],[876,13,876,14,0],[877,13,877,74,0],[878,13,878,14,0],[879,17,879,42,0],[880,17,880,48,0],[881,17,881,59,0],[882,17,882,67,0],[883,13,883,14,0],[884,13,884,35,0],[885,13,885,23,0],[886,9,886,10,0],[889,9,889,10,0],[890,13,890,42,0],[891,13,891,20,0],[891,22,891,39,0],[891,40,891,42,0],[891,43,891,53,0],[892,13,892,14,0],[893,17,895,37,0],[896,13,896,14,0],[897,13,897,33,0],[898,9,898,10,0],[905,9,905,10,1],[906,13,906,35,1],[907,13,907,63,1],[908,13,908,138,1],[909,13,909,42,1],[910,13,910,38,1],[912,20,912,116,1],[913,13,913,14,1],[914,17,914,24,1],[914,26,914,43,1],[914,44,914,46,1],[914,47,914,104,1],[914,104,914,116,1],[914,116,914,117,1],[914,47,914,117,1],[915,17,915,18,1],[916,21,916,141,1],[918,21,918,74,1],[919,21,919,22,1],[920,25,921,67,1],[922,25,922,26,0],[923,29,923,130,0],[925,29,925,45,0],[926,29,926,30,0],[927,33,927,117,0],[928,29,928,30,0],[929,25,929,26,0],[930,25,938,32,1],[939,21,939,22,1],[940,17,940,18,1],[941,13,941,14,1],[943,13,943,38,1],[944,13,944,46,1],[945,9,945,10,1],[948,9,948,10,1],[949,13,949,47,1],[951,13,951,56,1],[952,13,952,20,1],[952,22,952,29,1],[952,30,952,32,1],[952,33,952,51,1],[953,13,953,14,1],[954,17,954,58,1],[955,17,955,77,1],[956,17,965,20,1],[966,13,966,14,1],[967,13,967,38,1],[968,17,968,77,1],[969,13,969,63,1],[970,9,970,10,0],[973,9,973,10,0],[975,13,975,14,0],[976,17,976,51,0],[977,21,977,33,0],[978,17,978,110,0],[980,13,980,18,0],[981,13,981,14,0],[982,17,982,30,0],[984,9,984,10,0],[987,9,987,10,1],[988,13,988,49,1],[989,17,989,24,0],[990,13,990,84,1],[991,13,991,44,1],[992,13,992,14,1],[993,17,993,51,1],[994,13,994,14,1],[995,13,995,53,1],[996,13,996,117,1],[999,13,999,20,1],[999,22,999,36,1],[999,37,999,39,1],[999,40,999,83,1],[1000,13,1000,14,1],[1002,17,1002,53,1],[1003,17,1003,18,1],[1005,21,1006,89,1],[1007,25,1007,68,1],[1008,17,1008,18,1],[1009,13,1009,14,1],[1011,13,1011,20,1],[1011,22,1011,29,1],[1011,30,1011,32,1],[1011,33,1011,37,1],[1012,13,1012,14,1],[1013,17,1013,39,1],[1014,22,1014,31,1],[1014,33,1014,88,1],[1014,90,1014,93,1],[1015,17,1015,18,1],[1016,21,1016,83,1],[1024,21,1027,69,1],[1028,21,1028,22,1],[1029,25,1029,57,1],[1030,25,1030,41,1],[1031,25,1031,49,1],[1032,25,1032,26,1],[1036,29,1036,68,1],[1037,29,1037,60,1],[1047,25,1047,26,1],[1048,25,1048,31,1],[1050,17,1050,18,1],[1051,17,1052,75,1],[1053,21,1053,49,0],[1054,13,1054,14,1],[1056,13,1056,42,1],[1057,13,1057,14,0],[1058,17,1058,24,0],[1058,26,1058,36,0],[1058,37,1058,39,0],[1058,40,1058,54,0],[1059,21,1059,38,0],[1060,17,1060,93,0],[1061,13,1061,14,0],[1062,9,1062,10,1],[1069,9,1069,10,1],[1070,13,1070,97,1],[1072,13,1084,15,1],[1086,13,1086,93,1],[1088,13,1088,50,1],[1090,13,1090,33,1],[1093,9,1093,10,1],[1098,9,1098,10,0],[1100,13,1100,14,0],[1101,17,1101,60,0],[1102,13,1102,14,0],[1103,13,1103,33,0],[1104,13,1104,14,0],[1105,17,1105,70,0],[1106,17,1106,73,0],[1107,13,1107,14,0],[1108,9,1108,10,0],[1111,9,1111,10,1],[1113,13,1113,14,1],[1114,17,1114,64,1],[1115,13,1115,14,0],[1116,13,1116,33,1],[1117,13,1117,14,1],[1118,17,1118,70,1],[1119,17,1119,73,1],[1120,13,1120,14,1],[1121,9,1121,10,1],[1124,9,1124,10,1],[1125,13,1125,49,1],[1126,17,1131,183,0],[1132,13,1132,49,1],[1133,17,1138,181,0],[1139,13,1139,90,1],[1140,17,1146,128,1],[1147,13,1147,39,1],[1148,17,1152,107,1],[1153,13,1153,43,1],[1154,17,1159,156,0],[1160,13,1160,42,1],[1161,13,1161,14,1],[1165,17,1175,134,1],[1176,13,1176,14,1],[1177,13,1177,75,1],[1178,13,1178,14,1],[1179,17,1183,48,1],[1185,17,1185,53,1],[1186,17,1186,18,1],[1187,21,1194,49,1],[1195,17,1195,18,1],[1196,13,1196,14,1],[1197,13,1198,60,1],[1199,13,1199,14,1],[1200,17,1205,48,1],[1206,13,1206,14,1],[1207,13,1207,83,1],[1209,13,1209,14,1],[1218,17,1223,112,1],[1224,13,1224,14,1],[1225,13,1225,110,1],[1226,13,1226,14,1],[1227,17,1227,87,1],[1228,21,1233,55,1],[1234,13,1234,14,1],[1236,13,1236,44,1],[1237,13,1237,14,0],[1238,17,1238,74,0],[1239,21,1244,53,0],[1245,13,1245,14,0],[1247,13,1247,74,1],[1248,13,1248,14,0],[1249,17,1258,108,0],[1259,13,1259,14,0],[1261,13,1261,39,1],[1262,17,1266,107,1],[1267,13,1267,40,1],[1268,17,1272,108,0],[1273,13,1273,46,1],[1274,17,1279,114,0],[1280,13,1280,41,1],[1281,17,1287,132,1],[1289,13,1289,103,1],[1290,17,1295,112,1],[1296,13,1296,46,1],[1297,17,1303,114,1],[1304,13,1304,48,1],[1305,17,1311,116,1],[1312,13,1312,41,1],[1313,17,1319,109,1],[1320,13,1320,48,1],[1321,17,1332,152,0],[1333,13,1333,44,1],[1334,17,1344,141,0],[1345,13,1345,41,1],[1346,17,1361,98,1],[1362,13,1362,43,1],[1363,17,1367,111,0],[1368,13,1368,46,1],[1369,17,1374,114,1],[1375,13,1375,45,1],[1376,17,1380,113,0],[1381,13,1381,46,1],[1382,17,1386,108,1],[1388,13,1388,72,1],[1389,13,1389,14,1],[1390,17,1390,146,1],[1391,13,1391,14,1],[1399,13,1399,76,1],[1400,13,1400,14,1],[1401,17,1401,102,1],[1402,13,1402,14,1],[1404,13,1404,76,1],[1405,13,1405,14,1],[1406,17,1406,122,1],[1407,21,1409,172,1],[1411,21,1411,147,1],[1412,13,1412,14,1],[1414,13,1414,74,1],[1415,13,1415,14,1],[1416,17,1418,170,1],[1419,13,1419,14,1],[1434,13,1434,64,1],[1434,64,1434,83,1],[1434,83,1434,85,1],[1434,13,1434,85,1],[1435,13,1435,35,1],[1436,13,1436,14,1],[1437,17,1437,61,1],[1437,61,1437,81,1],[1437,81,1437,97,1],[1437,17,1437,97,1],[1438,17,1438,34,1],[1439,17,1439,18,1],[1441,21,1441,28,1],[1441,30,1441,40,1],[1441,41,1441,43,1],[1441,44,1441,57,1],[1442,21,1442,22,1],[1443,25,1443,75,1],[1444,25,1444,26,1],[1445,29,1448,64,1],[1449,25,1449,26,1],[1450,21,1450,22,1],[1451,17,1451,18,1],[1452,13,1452,14,1],[1455,13,1455,71,1],[1456,13,1456,14,0],[1457,17,1457,147,0],[1458,13,1458,14,0],[1460,13,1460,39,1],[1461,13,1461,14,0],[1462,17,1462,73,0],[1463,17,1463,18,0],[1464,21,1464,114,0],[1465,17,1465,18,0],[1466,17,1466,72,0],[1467,17,1467,18,0],[1468,21,1468,112,0],[1469,17,1469,18,0],[1470,13,1470,14,0],[1471,13,1471,45,1],[1473,13,1473,57,1],[1474,9,1474,10,1],[1477,9,1477,10,1],[1478,13,1478,34,1],[1479,17,1479,99,1],[1481,17,1481,67,1],[1483,13,1483,50,1],[1485,13,1485,30,1],[1490,13,1490,55,1],[1491,13,1491,54,1],[1492,17,1492,44,0],[1494,13,1494,99,1],[1494,99,1494,133,1],[1494,133,1495,113,1],[1494,13,1495,113,1],[1497,13,1497,58,1],[1498,13,1498,14,0],[1499,17,1499,72,0],[1500,17,1502,91,0],[1503,21,1503,46,0],[1504,13,1504,14,0],[1505,13,1505,33,1],[1506,13,1513,52,1],[1514,13,1514,38,1],[1515,13,1515,14,0],[1516,17,1516,31,0],[1517,17,1519,64,0],[1520,13,1520,14,0],[1522,13,1522,82,1],[1523,13,1523,14,1],[1524,17,1524,61,1],[1525,17,1525,24,1],[1525,26,1525,39,1],[1525,40,1525,42,1],[1525,43,1525,84,1],[1526,21,1526,56,1],[1527,17,1527,51,1],[1528,13,1528,14,1],[1529,13,1529,33,1],[1530,9,1530,10,1],[1533,9,1533,10,1],[1534,13,1540,54,1],[1541,9,1541,10,1],[1544,9,1544,10,1],[1545,13,1547,45,1],[1548,9,1548,10,1],[1551,9,1551,10,1],[1553,13,1553,14,1],[1554,17,1554,37,1],[1555,21,1555,73,0],[1557,17,1557,38,1],[1559,17,1559,32,1],[1563,17,1563,91,1],[1565,17,1565,54,1],[1566,17,1566,18,0],[1567,21,1567,88,0],[1568,21,1568,88,0],[1569,17,1569,18,0],[1571,17,1571,76,1],[1572,17,1572,122,1],[1573,17,1573,18,1],[1574,21,1574,146,1],[1575,21,1575,22,0],[1576,25,1577,70,0],[1578,21,1578,22,0],[1580,21,1580,22,1],[1581,25,1582,47,1],[1583,21,1583,22,1],[1584,17,1584,18,1],[1586,17,1586,46,1],[1587,17,1587,18,1],[1588,21,1589,43,1],[1590,17,1590,18,1],[1592,17,1592,78,1],[1593,17,1593,18,1],[1594,21,1594,46,1],[1595,21,1595,52,1],[1596,21,1596,46,1],[1597,21,1597,22,1],[1598,25,1598,77,1],[1599,25,1599,85,1],[1600,25,1600,113,1],[1601,29,1605,56,0],[1606,21,1606,22,1],[1607,17,1607,18,1],[1609,17,1609,58,1],[1614,17,1614,72,1],[1616,17,1616,66,1],[1617,21,1617,65,1],[1619,17,1619,116,1],[1621,17,1621,50,1],[1623,17,1623,95,1],[1624,17,1624,18,1],[1625,21,1625,102,1],[1626,21,1626,64,1],[1627,21,1627,68,1],[1628,17,1628,18,1],[1630,17,1630,18,1],[1631,21,1631,49,1],[1632,17,1632,18,1],[1634,17,1634,59,1],[1635,17,1635,54,1],[1637,17,1637,71,1],[1638,17,1638,18,1],[1639,21,1639,84,1],[1640,17,1640,18,1],[1642,17,1643,121,1],[1645,17,1645,62,1],[1647,17,1647,37,1],[1648,21,1648,71,0],[1649,13,1649,14,1],[1650,13,1650,33,0],[1651,13,1651,14,0],[1652,17,1652,44,0],[1653,13,1653,14,0],[1654,13,1654,29,1],[1656,13,1656,39,1],[1657,13,1657,14,0],[1659,17,1659,18,0],[1660,21,1660,92,0],[1661,21,1661,47,0],[1662,21,1662,22,0],[1663,25,1663,61,0],[1664,25,1664,62,0],[1666,25,1666,41,0],[1667,25,1667,26,0],[1668,29,1668,61,0],[1669,29,1669,79,0],[1670,29,1670,36,0],[1670,38,1670,50,0],[1670,51,1670,53,0],[1670,54,1670,60,0],[1671,29,1671,30,0],[1672,33,1672,123,0],[1673,33,1673,53,0],[1674,33,1674,34,0],[1675,37,1675,82,0],[1676,37,1676,56,0],[1677,37,1677,62,0],[1678,33,1678,34,0],[1679,29,1679,30,0],[1680,25,1680,26,0],[1681,21,1681,22,0],[1682,17,1682,18,0],[1683,13,1683,14,0],[1685,9,1685,10,1],[1688,9,1688,10,1],[1690,13,1690,79,1],[1691,13,1691,14,1],[1692,17,1692,113,1],[1693,17,1693,108,1],[1694,17,1694,18,1],[1695,21,1696,67,1],[1697,21,1698,124,1],[1699,21,1700,31,1],[1701,17,1701,18,1],[1702,13,1702,14,1],[1703,9,1703,10,1],[1706,9,1706,10,1],[1708,13,1708,79,1],[1709,13,1709,14,1],[1710,17,1710,113,1],[1711,17,1711,108,1],[1712,17,1712,18,1],[1713,21,1714,67,1],[1715,21,1716,120,1],[1717,21,1718,31,1],[1719,17,1719,18,1],[1720,13,1720,14,1],[1721,9,1721,10,1],[1724,9,1724,10,1],[1725,13,1725,47,1],[1726,13,1726,20,1],[1726,22,1726,32,1],[1726,33,1726,35,1],[1726,36,1726,53,1],[1727,17,1727,52,1],[1728,13,1728,52,1],[1730,13,1731,55,1],[1732,13,1732,58,1],[1733,13,1733,46,1],[1735,13,1737,25,1],[1739,13,1739,20,1],[1739,22,1739,32,1],[1739,33,1739,35,1],[1739,36,1739,53,1],[1740,13,1740,14,1],[1741,17,1741,109,1],[1742,17,1742,46,1],[1743,17,1743,18,0],[1744,21,1744,66,0],[1745,25,1745,63,0],[1746,17,1746,18,0],[1747,13,1747,14,1],[1748,9,1748,10,1],[1751,9,1751,10,1],[1752,13,1752,47,1],[1753,13,1753,20,1],[1753,22,1753,32,1],[1753,33,1753,35,1],[1753,36,1753,53,1],[1754,17,1754,52,1],[1755,13,1755,52,1],[1757,13,1758,55,1],[1759,13,1759,58,1],[1760,13,1760,46,1],[1762,13,1763,113,1],[1765,13,1765,20,1],[1765,22,1765,32,1],[1765,33,1765,35,1],[1765,36,1765,53,1],[1766,13,1766,14,1],[1767,17,1767,109,1],[1768,17,1768,46,1],[1769,17,1769,18,1],[1770,21,1770,66,1],[1771,25,1771,63,0],[1772,17,1772,18,1],[1773,13,1773,14,1],[1774,9,1774,10,1],[1777,9,1777,10,0],[1778,13,1778,54,0],[1779,9,1779,10,0],[1782,9,1782,10,1],[1784,13,1784,14,1],[1786,17,1786,24,1],[1786,26,1786,36,1],[1786,37,1786,39,1],[1786,40,1786,71,1],[1787,17,1787,18,1],[1788,21,1789,69,1],[1790,25,1790,81,1],[1791,17,1791,18,1],[1794,17,1794,83,1],[1795,17,1795,18,1],[1796,21,1796,117,1],[1797,21,1798,81,1],[1799,21,1799,22,1],[1800,25,1801,47,1],[1802,25,1802,117,1],[1803,21,1803,22,1],[1804,21,1805,82,1],[1806,21,1806,22,1],[1807,25,1808,47,1],[1809,25,1809,117,1],[1810,21,1810,22,1],[1811,21,1812,88,1],[1813,21,1813,22,1],[1814,25,1815,50,1],[1816,25,1817,34,1],[1818,21,1818,22,1],[1819,21,1820,88,1],[1821,21,1821,22,1],[1822,25,1823,50,1],[1824,25,1825,76,1],[1826,21,1826,22,1],[1827,17,1827,18,1],[1828,13,1828,14,1],[1829,13,1829,33,0],[1830,13,1830,14,0],[1831,17,1831,90,0],[1832,13,1832,14,0],[1833,9,1833,10,1],[1836,9,1836,10,1],[1837,13,1837,48,1],[1838,13,1838,70,1],[1839,13,1839,14,0],[1848,17,1848,50,0],[1849,22,1849,31,0],[1849,33,1849,47,0],[1849,49,1849,52,0],[1850,17,1850,18,0],[1851,21,1851,49,0],[1852,21,1852,69,0],[1853,17,1853,18,0],[1854,13,1854,14,0],[1855,9,1855,10,1],[1865,9,1865,10,0],[1866,13,1866,95,0],[1868,13,1868,117,0],[1869,13,1869,43,0],[1870,13,1870,14,0],[1871,17,1871,24,0],[1871,26,1871,41,0],[1871,42,1871,44,0],[1871,45,1871,59,0],[1872,17,1872,18,0],[1873,21,1873,80,0],[1874,21,1874,58,0],[1874,59,1874,101,0],[1876,21,1876,198,0],[1878,21,1878,57,0],[1879,21,1879,22,0],[1880,25,1880,116,0],[1881,21,1881,22,0],[1882,17,1882,18,0],[1883,13,1883,14,0],[1885,13,1885,60,0],[1885,60,1885,84,0],[1885,84,1885,111,0],[1885,111,1885,112,0],[1885,60,1885,112,0],[1885,112,1885,124,0],[1885,13,1885,124,0],[1886,13,1886,34,0],[1887,13,1887,14,0],[1890,17,1890,121,0],[1892,17,1892,24,0],[1892,26,1892,37,0],[1892,38,1892,40,0],[1892,41,1892,46,0],[1893,17,1893,18,0],[1894,21,1894,106,0],[1895,21,1895,28,0],[1895,30,1895,45,0],[1895,46,1895,48,0],[1895,49,1895,53,0],[1896,21,1896,22,0],[1897,25,1897,84,0],[1898,25,1898,62,0],[1898,63,1898,105,0],[1900,25,1900,202,0],[1902,25,1902,61,0],[1903,25,1903,26,0],[1904,29,1904,120,0],[1905,25,1905,26,0],[1906,21,1906,22,0],[1907,17,1907,18,0],[1908,13,1908,14,0],[1910,13,1910,68,0],[1910,68,1910,69,0],[1910,69,1910,93,0],[1910,13,1910,93,0],[1911,9,1911,10,0],[1914,9,1914,10,1],[1915,13,1915,53,1],[1916,17,1916,92,0],[1920,13,1920,49,1],[1921,13,1921,80,1],[1922,13,1922,89,1],[1923,13,1923,67,1],[1924,13,1924,14,1],[1925,17,1927,116,1],[1929,17,1929,77,1],[1930,17,1930,18,1],[1931,21,1931,83,1],[1932,21,1932,78,1],[1933,21,1933,98,1],[1934,21,1934,113,1],[1935,21,1937,114,1],[1938,21,1938,78,1],[1939,21,1939,40,1],[1940,21,1940,28,1],[1940,30,1940,45,1],[1940,46,1940,48,1],[1940,49,1940,66,1],[1941,21,1941,22,1],[1945,25,1945,68,1],[1946,25,1946,60,1],[1947,25,1947,72,1],[1948,25,1948,32,1],[1948,34,1948,47,1],[1948,48,1948,50,1],[1948,51,1948,67,1],[1949,25,1949,26,1],[1951,29,1951,93,1],[1952,25,1952,26,1],[1953,25,1953,86,1],[1954,25,1954,107,1],[1955,29,1955,73,1],[1957,21,1957,22,1],[1958,17,1958,18,1],[1959,13,1959,14,1],[1961,13,1961,20,1],[1961,22,1961,32,1],[1961,33,1961,35,1],[1961,36,1961,53,1],[1962,13,1962,14,1],[1963,17,1963,55,1],[1965,17,1965,82,1],[1966,17,1966,18,1],[1967,21,1967,67,1],[1968,21,1968,54,1],[1969,21,1969,28,1],[1969,30,1969,40,1],[1969,41,1969,43,1],[1969,44,1969,51,1],[1970,21,1970,22,1],[1971,25,1971,84,1],[1972,21,1972,22,1],[1973,21,1973,80,1],[1974,21,1974,48,1],[1975,17,1975,18,1],[1977,17,1977,18,1],[1980,21,1980,89,1],[1981,21,1981,111,1],[1982,17,1982,18,1],[1983,13,1983,14,1],[1985,13,1985,53,1],[1986,17,1986,90,0],[1987,9,1987,10,1],[1990,9,1990,10,0],[1991,13,1991,88,0],[1991,89,1991,99,0],[1992,13,1992,49,0],[1992,50,1992,60,0],[1993,13,1994,32,0],[1995,13,1995,43,0],[1995,44,1995,54,0],[1996,13,1996,121,0],[1997,13,1997,52,0],[1998,13,1998,93,0],[1999,13,1999,74,0],[2000,13,2000,20,0],[2000,22,2000,32,0],[2000,33,2000,35,0],[2000,36,2000,41,0],[2001,13,2001,14,0],[2003,17,2003,79,0],[2003,80,2003,108,0],[2004,13,2004,14,0],[2005,13,2005,47,0],[2005,48,2005,58,0],[2006,13,2006,35,0],[2007,18,2007,27,0],[2007,29,2007,58,0],[2007,60,2007,63,0],[2008,13,2008,14,0],[2009,17,2009,155,0],[2010,17,2010,34,0],[2010,35,2010,85,0],[2012,17,2012,43,0],[2013,17,2013,89,0],[2014,17,2014,35,0],[2014,36,2014,46,0],[2015,17,2015,43,0],[2015,44,2015,77,0],[2016,17,2017,90,0],[2018,21,2018,30,0],[2020,17,2020,35,0],[2020,36,2020,65,0],[2022,17,2022,24,0],[2022,26,2022,40,0],[2022,41,2022,43,0],[2022,44,2022,63,0],[2023,17,2023,18,0],[2024,21,2024,57,0],[2025,17,2025,18,0],[2026,13,2026,14,0],[2027,13,2027,28,0],[2028,9,2028,10,0],[2031,9,2031,10,1],[2033,13,2033,14,1],[2034,24,2034,120,1],[2035,17,2035,18,1],[2036,21,2036,120,1],[2037,21,2037,22,0],[2038,25,2038,32,0],[2038,34,2038,44,0],[2038,45,2038,47,0],[2038,48,2038,75,0],[2039,25,2039,26,0],[2040,29,2040,92,0],[2041,29,2041,85,0],[2042,29,2042,92,0],[2043,29,2043,30,0],[2044,33,2045,43,0],[2046,33,2048,44,0],[2049,33,2050,109,0],[2051,33,2051,34,0],[2052,37,2052,104,0],[2053,33,2053,34,0],[2054,29,2054,30,0],[2055,25,2055,26,0],[2056,21,2056,22,0],[2057,17,2057,18,1],[2059,17,2059,96,1],[2060,17,2060,42,1],[2061,17,2061,18,0],[2062,21,2062,28,0],[2062,30,2062,47,0],[2062,48,2062,50,0],[2062,51,2062,77,0],[2063,21,2063,22,0],[2064,25,2064,65,0],[2065,25,2065,61,0],[2065,62,2065,71,0],[2067,25,2067,71,0],[2068,25,2068,54,0],[2068,55,2068,64,0],[2069,25,2069,66,0],[2069,67,2069,88,0],[2070,25,2070,95,0],[2071,29,2071,79,0],[2072,21,2072,22,0],[2073,21,2073,50,0],[2074,17,2074,18,0],[2075,13,2075,14,1],[2076,13,2076,33,0],[2077,13,2077,14,0],[2078,17,2078,44,0],[2079,13,2079,14,0],[2080,9,2080,10,1],[2083,9,2083,10,0],[2084,13,2084,26,0],[2085,13,2085,14,0],[2086,17,2086,90,0],[2087,13,2087,14,0],[2089,13,2089,36,0],[2090,13,2090,14,0],[2091,17,2091,31,0],[2092,17,2092,18,0],[2093,21,2093,94,0],[2094,17,2094,18,0],[2095,17,2095,46,0],[2096,13,2096,14,0],[2098,13,2098,14,0],[2099,17,2099,39,0],[2100,13,2100,14,0],[2101,9,2101,10,0],[2108,9,2108,10,1],[2109,13,2109,110,1],[2110,13,2110,112,1],[2111,13,2111,14,0],[2112,17,2112,24,0],[2112,26,2112,36,0],[2112,37,2112,39,0],[2112,40,2112,67,0],[2113,17,2113,18,0],[2114,21,2114,84,0],[2115,21,2115,77,0],[2116,21,2116,72,0],[2118,21,2118,102,0],[2120,21,2120,77,0],[2121,21,2121,76,0],[2122,21,2122,22,0],[2123,25,2123,63,0],[2124,25,2124,71,0],[2125,21,2125,22,0],[2127,21,2127,22,0],[2128,25,2128,117,0],[2129,25,2129,111,0],[2130,21,2130,22,0],[2131,17,2131,18,0],[2132,13,2132,14,0],[2133,13,2133,114,1],[2134,13,2134,121,1],[2135,13,2135,14,0],[2136,17,2136,95,0],[2137,17,2137,55,0],[2138,17,2138,97,0],[2139,17,2139,109,0],[2140,17,2140,75,0],[2141,13,2141,14,0],[2142,9,2142,10,1],[2145,9,2145,10,1],[2146,13,2146,28,1],[2148,13,2148,71,1],[2149,17,2149,28,1],[2151,17,2151,64,0],[2153,13,2153,159,1],[2154,13,2154,70,1],[2158,13,2158,124,1],[2159,13,2159,35,1],[2160,13,2160,109,1],[2162,13,2162,36,1],[2164,13,2164,45,1],[2166,13,2166,20,1],[2166,22,2166,39,1],[2166,40,2166,42,1],[2166,43,2166,84,1],[2167,17,2167,36,1],[2168,21,2168,38,1],[2170,13,2170,26,1],[2171,17,2171,34,1],[2173,13,2173,62,1],[2174,17,2174,53,1],[2176,17,2176,54,1],[2178,20,2178,106,1],[2179,13,2179,14,1],[2180,17,2180,86,1],[2181,17,2181,18,0],[2184,21,2184,113,0],[2186,21,2186,52,0],[2188,21,2188,56,0],[2189,21,2189,69,0],[2190,21,2190,40,0],[2192,21,2192,28,0],[2192,30,2192,47,0],[2192,48,2192,50,0],[2192,51,2192,92,0],[2193,21,2193,22,0],[2194,25,2194,135,0],[2196,25,2196,55,0],[2197,25,2197,40,0],[2199,25,2199,101,0],[2200,25,2200,26,0],[2201,29,2201,60,0],[2202,29,2202,50,0],[2203,29,2203,76,0],[2204,29,2204,120,0],[2205,29,2205,144,0],[2206,25,2206,26,0],[2207,30,2207,104,0],[2208,25,2208,26,0],[2209,29,2209,57,0],[2210,29,2210,73,0],[2211,29,2211,107,0],[2212,29,2212,144,0],[2213,25,2213,26,0],[2214,21,2214,22,0],[2216,21,2216,34,0],[2217,21,2217,22,0],[2218,25,2218,103,0],[2219,25,2219,42,0],[2220,21,2220,22,0],[2222,21,2222,46,0],[2223,25,2223,117,0],[2224,26,2224,65,0],[2225,25,2225,141,0],[2228,17,2228,18,0],[2230,17,2230,18,1],[2233,21,2233,55,1],[2234,25,2234,37,1],[2236,21,2236,28,1],[2236,30,2236,47,1],[2236,48,2236,50,1],[2236,51,2236,92,1],[2237,21,2237,22,1],[2238,25,2238,44,1],[2239,25,2239,26,1],[2240,29,2240,111,1],[2241,29,2241,158,1],[2242,25,2242,26,1],[2243,21,2243,22,1],[2245,21,2245,34,1],[2246,21,2246,22,1],[2247,25,2247,103,1],[2248,25,2248,42,1],[2249,21,2249,22,1],[2251,21,2251,113,1],[2254,17,2254,18,1],[2255,13,2255,14,1],[2256,13,2256,25,1],[2257,9,2257,10,1],[2265,9,2265,10,1],[2266,13,2266,63,1],[2267,17,2267,34,1],[2269,13,2269,14,1],[2270,17,2270,125,1],[2272,17,2272,96,1],[2273,21,2273,62,1],[2275,21,2275,132,1],[2278,17,2278,46,1],[2279,13,2279,14,1],[2280,9,2280,10,1],[2283,9,2283,10,0],[2285,13,2285,14,0],[2286,17,2286,80,0],[2287,17,2287,18,0],[2288,21,2288,28,0],[2288,30,2288,40,0],[2288,41,2288,43,0],[2288,44,2288,65,0],[2289,21,2289,22,0],[2290,25,2290,43,0],[2292,25,2292,26,0],[2295,29,2295,103,0],[2296,29,2296,45,0],[2296,46,2296,53,0],[2297,29,2297,73,0],[2299,29,2299,94,0],[2301,29,2301,118,0],[2303,29,2303,71,0],[2304,29,2304,73,0],[2305,29,2305,30,0],[2306,33,2306,123,0],[2307,29,2307,30,0],[2309,29,2309,30,0],[2310,33,2310,99,0],[2311,29,2311,30,0],[2312,29,2312,94,0],[2313,25,2313,26,0],[2314,25,2314,45,0],[2315,25,2315,26,0],[2316,29,2316,56,0],[2317,29,2318,97,0],[2319,33,2319,61,0],[2320,29,2320,117,0],[2321,25,2321,26,0],[2322,21,2322,22,0],[2323,17,2323,18,0],[2324,13,2324,14,0],[2325,13,2325,33,0],[2326,13,2326,14,0],[2327,17,2327,44,0],[2328,17,2328,105,0],[2329,13,2329,14,0],[2330,9,2330,10,0],[2333,9,2333,10,0],[2334,13,2334,59,0],[2335,13,2335,14,0],[2337,17,2337,18,0],[2338,21,2338,59,0],[2339,21,2339,41,0],[2340,17,2340,18,0],[2341,17,2341,22,0],[2342,17,2342,18,0],[2343,21,2343,42,0],[2344,17,2344,18,0],[2345,13,2345,14,0],[2346,13,2346,22,0],[2347,9,2347,10,0],[2350,9,2350,10,1],[2351,13,2351,115,1],[2353,13,2353,27,1],[2356,9,2356,10,1],[2373,9,2373,10,1],[2375,13,2375,71,1],[2376,13,2376,14,1],[2377,17,2377,96,1],[2379,17,2382,79,1],[2383,17,2383,45,1],[2384,13,2384,14,1],[2386,13,2386,14,1],[2387,17,2387,59,1],[2388,17,2391,79,1],[2392,17,2392,39,1],[2393,17,2393,18,1],[2394,21,2394,49,1],[2396,21,2396,85,1],[2397,21,2397,41,1],[2398,17,2398,18,1],[2399,13,2399,14,1],[2401,13,2401,35,1],[2402,13,2402,14,1],[2405,17,2405,53,1],[2406,17,2406,51,1],[2410,17,2410,84,1],[2412,17,2412,56,1],[2413,17,2413,52,1],[2414,17,2414,56,1],[2415,17,2415,50,1],[2417,17,2417,84,1],[2418,17,2418,76,1],[2419,17,2419,88,1],[2421,17,2421,44,1],[2422,21,2422,56,1],[2423,13,2423,14,1],[2425,13,2425,30,1],[2426,9,2426,10,1],[2429,9,2429,10,1],[2430,13,2430,31,1],[2431,9,2431,10,1],[2439,9,2439,10,0],[2440,13,2440,47,0],[2444,13,2444,48,0],[2446,13,2446,80,0],[2447,17,2447,52,0],[2448,18,2449,64,0],[2450,17,2450,59,0],[2451,13,2451,20,0],[2451,22,2451,42,0],[2451,43,2451,45,0],[2451,46,2451,53,0],[2452,13,2452,14,0],[2453,17,2454,51,0],[2455,21,2458,33,0],[2459,13,2459,14,0],[2462,9,2462,10,0],[2469,9,2469,10,0],[2471,13,2471,14,0],[2472,17,2472,35,0],[2473,17,2473,45,0],[2474,13,2474,14,0],[2475,13,2475,33,0],[2476,13,2476,14,0],[2477,17,2477,70,0],[2478,17,2478,75,0],[2479,13,2479,14,0],[2480,9,2480,10,0],[2483,9,2483,10,1],[2485,13,2485,14,1],[2486,17,2486,32,1],[2487,17,2487,35,1],[2488,17,2488,67,1],[2489,13,2489,14,0],[2490,13,2490,33,1],[2491,13,2491,14,1],[2492,17,2492,70,1],[2493,17,2493,75,1],[2494,13,2494,14,1],[2495,9,2495,10,1],[2498,9,2498,10,0],[2500,13,2500,14,0],[2501,17,2501,40,0],[2502,17,2502,67,0],[2503,13,2503,14,0],[2504,13,2504,33,0],[2505,13,2505,14,0],[2506,17,2506,70,0],[2507,17,2507,75,0],[2508,13,2508,14,0],[2509,9,2509,10,0],[2512,9,2512,10,0],[2514,13,2514,14,0],[2515,17,2515,30,0],[2516,13,2516,14,0],[2517,13,2517,33,0],[2518,13,2518,14,0],[2519,17,2519,70,0],[2520,17,2520,75,0],[2521,13,2521,14,0],[2522,9,2522,10,0],[2525,9,2525,10,1],[2527,13,2527,14,1],[2528,17,2528,65,1],[2529,17,2529,77,1],[2530,17,2530,18,1],[2531,21,2531,28,1],[2531,30,2531,44,1],[2531,45,2531,47,1],[2531,48,2531,91,1],[2532,21,2532,22,1],[2533,25,2535,68,1],[2536,25,2536,26,1],[2537,29,2543,31,1],[2544,29,2546,53,1],[2547,29,2547,66,1],[2548,25,2548,26,1],[2549,21,2549,22,1],[2550,17,2550,18,1],[2551,17,2551,79,1],[2552,17,2556,119,1],[2557,13,2557,14,0],[2558,13,2558,33,1],[2559,13,2559,14,1],[2560,17,2560,70,1],[2561,17,2561,75,1],[2562,13,2562,14,1],[2563,9,2563,10,1],[2566,9,2566,10,1],[2568,13,2568,14,1],[2569,17,2569,85,1],[2570,21,2570,28,0],[2573,17,2573,45,1],[2574,17,2575,121,1],[2577,17,2577,62,1],[2581,17,2581,39,1],[2582,13,2582,14,1],[2583,13,2583,33,1],[2584,13,2584,14,1],[2585,17,2585,70,1],[2586,17,2586,75,1],[2587,13,2587,14,1],[2588,9,2588,10,1],[2591,9,2591,10,1],[2593,13,2593,14,1],[2594,17,2594,85,1],[2595,21,2595,28,0],[2598,17,2598,44,1],[2599,17,2599,18,0],[2600,21,2600,102,0],[2601,21,2601,110,0],[2602,21,2602,22,0],[2603,25,2603,82,0],[2604,25,2604,61,0],[2605,29,2606,109,0],[2607,21,2607,22,0],[2608,17,2608,18,0],[2609,17,2609,40,1],[2610,13,2610,14,1],[2611,13,2611,33,1],[2612,13,2612,14,1],[2613,17,2613,70,1],[2614,17,2614,75,1],[2615,13,2615,14,1],[2616,9,2616,10,1],[2619,9,2619,10,0],[2621,13,2621,14,0],[2622,17,2622,85,0],[2623,21,2623,28,0],[2626,13,2626,14,0],[2627,13,2627,33,0],[2628,13,2628,14,0],[2629,17,2629,70,0],[2630,17,2630,75,0],[2631,13,2631,14,0],[2632,9,2632,10,0],[2635,9,2635,10,0],[2636,13,2636,66,0],[2637,13,2637,46,0],[2639,13,2639,38,0],[2640,17,2640,99,0],[2642,17,2642,56,0],[2644,74,2644,156,0],[2644,157,2644,163,0],[2645,67,2645,151,0],[2645,152,2645,158,0],[2646,64,2646,148,0],[2646,149,2646,155,0],[2649,13,2649,31,0],[2650,9,2650,10,0],[2653,9,2653,10,0],[2657,13,2657,14,0],[2658,17,2658,104,0],[2659,17,2659,47,0],[2660,13,2660,14,0],[2661,13,2661,41,0],[2662,13,2662,14,0],[2663,13,2663,14,0],[2664,13,2664,33,0],[2665,13,2665,14,0],[2666,17,2666,70,0],[2667,17,2667,75,0],[2668,13,2668,14,0],[2670,13,2670,14,0],[2671,17,2671,35,0],[2673,17,2673,65,0],[2674,17,2674,36,0],[2675,17,2675,50,0],[2676,13,2676,14,0],[2677,9,2677,10,0],[2680,9,2680,10,1],[2682,13,2682,14,1],[2683,17,2683,85,1],[2684,21,2684,28,0],[2686,17,2686,40,1],[2687,13,2687,14,1],[2688,13,2688,33,1],[2689,13,2689,14,1],[2690,17,2690,70,1],[2691,17,2691,75,1],[2692,13,2692,14,1],[2693,9,2693,10,1],[2696,9,2696,10,1],[2698,13,2698,14,1],[2699,17,2699,85,1],[2700,21,2700,28,0],[2701,17,2701,45,1],[2702,17,2702,18,1],[2703,21,2703,46,1],[2704,21,2704,39,1],[2706,17,2706,18,1],[2707,13,2707,14,1],[2708,13,2708,33,1],[2709,13,2709,14,1],[2710,17,2710,70,1],[2711,17,2711,53,1],[2712,17,2712,90,1],[2713,17,2713,35,1],[2714,13,2714,14,1],[2715,9,2715,10,1],[2718,9,2718,10,0],[2720,13,2720,14,0],[2721,17,2721,85,0],[2722,21,2722,28,0],[2724,17,2724,41,0],[2725,13,2725,14,0],[2726,13,2726,33,0],[2727,13,2727,14,0],[2728,17,2728,70,0],[2729,17,2729,75,0],[2730,13,2730,14,0],[2731,9,2731,10,0],[2734,9,2734,10,0],[2736,13,2736,14,0],[2737,17,2737,85,0],[2738,21,2738,28,0],[2740,17,2740,47,0],[2741,13,2741,14,0],[2742,13,2742,33,0],[2743,13,2743,14,0],[2744,17,2744,70,0],[2745,17,2745,75,0],[2746,13,2746,14,0],[2747,9,2747,10,0],[2750,9,2750,10,0],[2752,13,2752,14,0],[2753,17,2753,55,0],[2754,17,2754,69,0],[2755,17,2755,52,0],[2755,53,2755,82,0],[2756,17,2756,35,0],[2757,13,2757,14,0],[2758,13,2758,33,0],[2759,13,2759,14,0],[2760,17,2760,70,0],[2761,17,2761,75,0],[2762,13,2762,14,0],[2763,9,2763,10,0],[2766,9,2766,10,0],[2768,13,2768,14,0],[2769,17,2769,43,0],[2770,17,2770,67,0],[2771,17,2771,33,0],[2772,17,2772,38,0],[2773,17,2773,49,0],[2774,17,2774,18,0],[2775,21,2775,35,0],[2776,17,2776,18,0],[2778,17,2778,18,0],[2779,21,2779,63,0],[2780,17,2780,18,0],[2781,17,2781,81,0],[2782,17,2782,18,0],[2783,21,2783,41,0],[2784,17,2784,18,0],[2786,17,2786,94,0],[2787,17,2787,18,0],[2789,21,2790,171,0],[2791,21,2791,70,0],[2792,21,2792,51,0],[2794,21,2794,84,0],[2795,25,2795,72,0],[2796,17,2796,18,0],[2797,13,2797,14,0],[2798,13,2798,33,0],[2799,13,2799,14,0],[2800,17,2800,70,0],[2801,17,2801,75,0],[2802,13,2802,14,0],[2803,9,2803,10,0],[2814,9,2814,10,1],[2815,13,2815,40,1],[2816,9,2816,10,1],[2819,9,2819,10,0],[2823,13,2823,47,0],[2824,13,2824,14,0],[2825,17,2825,31,0],[2826,17,2826,35,0],[2827,13,2827,14,0],[2833,9,2833,10,0],[2836,9,2836,10,0],[2837,13,2837,66,0],[2839,13,2839,14,0],[2840,17,2840,85,0],[2841,17,2841,50,0],[2842,17,2842,18,0],[2843,21,2843,75,0],[2844,17,2844,18,0],[2845,13,2845,14,0],[2846,13,2846,33,0],[2847,13,2847,14,0],[2848,17,2848,75,0],[2849,13,2849,14,0],[2850,9,2850,10,0],[2853,9,2853,10,0],[2855,13,2855,14,0],[2856,17,2856,85,0],[2857,21,2857,28,0],[2858,17,2858,44,0],[2859,13,2859,14,0],[2860,13,2860,33,0],[2861,13,2861,14,0],[2862,17,2862,70,0],[2863,17,2863,75,0],[2864,13,2864,14,0],[2865,9,2865,10,0],[2868,9,2868,10,0],[2869,13,2869,23,0],[2870,13,2870,66,0],[2871,17,2871,73,0],[2873,13,2873,75,0],[2875,13,2875,20,0],[2875,22,2875,32,0],[2875,33,2875,35,0],[2875,36,2875,44,0],[2876,13,2876,14,0],[2877,17,2877,24,0],[2877,26,2877,44,0],[2877,45,2877,47,0],[2877,48,2877,83,0],[2878,17,2878,18,0],[2879,21,2879,52,0],[2880,21,2880,82,0],[2881,21,2881,40,0],[2881,41,2881,70,0],[2882,21,2882,87,0],[2883,21,2883,39,0],[2884,21,2884,22,0],[2885,25,2885,92,0],[2886,25,2886,26,0],[2887,29,2887,47,0],[2888,29,2888,87,0],[2889,29,2889,92,0],[2890,33,2890,109,0],[2891,25,2891,26,0],[2892,25,2892,98,0],[2893,25,2893,26,0],[2895,29,2895,105,0],[2896,29,2896,87,0],[2897,33,2897,104,0],[2898,25,2898,26,0],[2899,21,2899,22,0],[2900,17,2900,18,0],[2901,17,2901,21,0],[2902,13,2902,14,0],[2903,9,2903,10,0],[2906,9,2906,10,1],[2907,13,2907,38,1],[2908,13,2908,14,1],[2909,17,2909,60,1],[2910,21,2910,82,1],[2912,21,2912,91,1],[2913,13,2913,14,1],[2915,13,2915,39,1],[2916,13,2916,14,1],[2917,17,2917,61,1],[2918,21,2918,84,1],[2920,21,2920,93,0],[2921,13,2921,14,1],[2923,13,2923,41,1],[2923,42,2923,109,1],[2924,13,2924,39,1],[2925,13,2925,14,1],[2926,17,2926,61,1],[2927,21,2927,84,1],[2929,21,2929,93,0],[2930,13,2930,14,1],[2931,13,2931,43,1],[2932,13,2932,14,1],[2933,17,2933,88,1],[2934,13,2934,14,1],[2935,13,2935,103,1],[2936,17,2936,90,1],[2938,13,2938,42,1],[2938,43,2938,112,1],[2939,13,2939,40,1],[2939,41,2939,106,0],[2940,13,2940,46,1],[2941,17,2941,94,0],[2942,13,2942,39,1],[2942,40,2942,103,0],[2943,13,2943,41,1],[2943,42,2943,109,1],[2944,13,2944,43,1],[2944,44,2944,113,0],[2945,13,2945,39,1],[2945,40,2945,103,1],[2946,13,2946,44,1],[2946,45,2946,118,1],[2947,13,2947,38,1],[2947,39,2947,73,1],[2948,13,2948,41,1],[2948,42,2948,79,1],[2949,13,2949,39,1],[2949,40,2949,75,1],[2950,13,2950,116,1],[2951,17,2951,106,1],[2952,13,2952,39,1],[2953,13,2953,14,0],[2954,17,2956,21,0],[2956,21,2956,22,0],[2956,22,2957,25,0],[2957,25,2957,114,0],[2957,114,2958,21,0],[2958,21,2958,22,0],[2958,22,2958,24,0],[2954,17,2958,24,0],[2959,13,2959,14,0],[2961,13,2961,49,1],[2962,13,2962,14,0],[2963,17,2963,68,0],[2964,17,2964,18,0],[2965,21,2965,61,0],[2966,21,2966,63,0],[2967,17,2967,18,0],[2968,17,2968,53,0],[2969,21,2969,104,0],[2970,13,2970,14,0],[2972,13,2972,72,1],[2973,17,2973,117,1],[2974,13,2974,76,1],[2975,17,2975,121,1],[2977,13,2977,75,1],[2978,17,2978,120,1],[2979,13,2979,79,1],[2980,17,2980,124,1],[2982,13,2982,83,1],[2983,17,2983,128,0],[2984,13,2984,87,1],[2985,17,2985,132,0],[2987,13,2987,62,1],[2988,9,2988,10,1],[2991,9,2991,10,1],[2992,13,2992,65,1],[2993,9,2993,10,1],[2996,9,2996,10,0],[2998,13,2998,14,0],[2999,17,2999,58,0],[3000,17,3000,45,0],[3001,17,3001,59,0],[3002,17,3002,64,0],[3003,21,3003,62,0],[3012,17,3012,18,0],[3014,21,3014,22,0],[3015,25,3015,67,0],[3016,25,3016,66,0],[3017,29,3017,56,0],[3019,25,3019,108,0],[3020,21,3020,22,0],[3021,21,3021,50,0],[3022,21,3022,22,0],[3023,25,3023,78,0],[3024,25,3024,56,0],[3025,25,3029,52,0],[3030,25,3030,63,0],[3031,25,3031,49,0],[3032,21,3032,22,0],[3033,21,3033,41,0],[3034,21,3034,22,0],[3035,25,3035,78,0],[3036,25,3036,56,0],[3037,25,3041,52,0],[3042,25,3042,63,0],[3043,25,3043,47,0],[3044,21,3044,22,0],[3045,17,3045,18,0],[3047,17,3047,51,0],[3048,17,3048,18,0],[3049,21,3049,46,0],[3051,21,3052,65,0],[3053,21,3053,22,0],[3054,25,3054,32,0],[3054,34,3054,50,0],[3054,51,3054,53,0],[3054,54,3054,85,0],[3055,25,3055,26,0],[3056,29,3056,98,0],[3057,25,3057,26,0],[3065,21,3065,22,0],[3067,21,3067,102,0],[3068,21,3068,22,0],[3069,25,3069,32,0],[3069,34,3069,50,0],[3069,51,3069,53,0],[3069,54,3069,78,0],[3070,25,3070,26,0],[3071,29,3071,98,0],[3072,25,3072,26,0],[3076,21,3076,22,0],[3077,17,3077,18,0],[3079,17,3079,18,0],[3080,21,3080,46,0],[3081,21,3081,38,0],[3084,21,3084,68,0],[3085,25,3085,92,0],[3086,21,3086,40,0],[3087,21,3087,54,0],[3088,21,3088,37,0],[3089,17,3089,18,0],[3090,17,3090,50,0],[3091,17,3091,18,0],[3092,21,3092,48,0],[3094,13,3094,14,0],[3095,13,3095,33,0],[3096,13,3096,14,0],[3097,17,3097,70,0],[3098,17,3098,48,0],[3099,17,3099,78,0],[3100,17,3100,55,0],[3101,17,3101,53,0],[3102,17,3102,39,0],[3103,13,3103,14,0],[3104,9,3104,10,0],[3107,9,3107,10,1],[3117,9,3117,10,1],[3120,9,3120,10,1],[3121,13,3121,31,1],[3122,13,3122,49,1],[3123,17,3123,61,1],[3124,13,3124,46,1],[3125,9,3125,10,1],[3128,9,3128,10,1],[3129,13,3129,74,1],[3130,9,3130,10,1],[3133,9,3133,10,1],[3134,13,3134,110,1],[3135,13,3135,14,0],[3136,17,3136,36,0],[3137,17,3137,46,0],[3138,17,3138,72,0],[3139,17,3139,103,0],[3140,17,3140,118,0],[3141,17,3143,63,0],[3144,17,3144,57,0],[3145,17,3145,69,0],[3146,17,3146,100,0],[3147,17,3147,90,0],[3149,17,3149,64,0],[3150,17,3150,55,0],[3151,17,3151,18,0],[3152,21,3152,64,0],[3153,21,3153,22,0],[3154,25,3154,78,0],[3155,25,3155,72,0],[3156,25,3156,52,0],[3157,25,3157,32,0],[3157,34,3157,44,0],[3157,45,3157,47,0],[3157,48,3157,52,0],[3158,25,3158,26,0],[3159,29,3159,50,0],[3160,29,3160,68,0],[3161,33,3161,74,0],[3162,29,3162,114,0],[3163,25,3163,26,0],[3164,21,3164,22,0],[3166,25,3166,72,0],[3167,17,3167,18,0],[3169,17,3169,112,0],[3170,17,3172,75,0],[3174,17,3188,42,0],[3190,17,3190,69,0],[3191,21,3191,95,0],[3193,21,3193,91,0],[3194,13,3194,14,0],[3195,13,3195,32,1],[3196,9,3196,10,1],[3200,9,3200,10,0],[3202,13,3202,14,0],[3203,17,3207,81,0],[3208,13,3208,14,0],[3209,13,3209,33,0],[3210,13,3210,14,0],[3211,17,3211,70,0],[3212,17,3212,53,0],[3213,13,3213,14,0],[3214,9,3214,10,0],[3217,9,3217,10,0],[3219,13,3219,14,0],[3220,17,3220,86,0],[3221,17,3221,80,0],[3222,17,3222,50,0],[3223,17,3223,18,0],[3224,21,3224,39,0],[3226,21,3226,69,0],[3227,21,3227,40,0],[3228,21,3228,54,0],[3229,17,3229,18,0],[3230,17,3230,50,0],[3231,17,3231,18,0],[3232,21,3232,48,0],[3234,13,3234,14,0],[3235,13,3235,33,0],[3236,13,3236,14,0],[3237,17,3237,70,0],[3238,17,3238,53,0],[3239,13,3239,14,0],[3240,9,3240,10,0],[3243,9,3243,10,0],[3244,13,3244,59,0],[3245,13,3245,67,0],[3246,13,3246,114,0],[3248,9,3248,10,0],[3251,9,3251,10,1],[3252,13,3252,48,1],[3253,9,3253,10,1],[3256,9,3256,10,1],[3257,13,3257,48,1],[3258,9,3258,10,1],[3261,9,3261,10,1],[3262,13,3262,87,1],[3263,9,3263,10,1],[3266,9,3266,10,0],[3267,13,3267,39,0],[3268,13,3268,31,0],[3269,9,3269,10,0],[3276,9,3276,10,0],[3278,13,3278,14,0],[3279,17,3282,54,0],[3283,17,3283,102,0],[3284,13,3284,14,0],[3285,13,3285,18,0],[3286,13,3286,14,0],[3287,13,3287,14,0],[3288,9,3288,10,0],[3291,9,3291,10,0],[3292,13,3292,60,0],[3293,13,3293,39,0],[3294,13,3294,42,0],[3296,13,3296,14,0],[3297,17,3297,47,0],[3298,17,3298,56,0],[3299,17,3299,48,0],[3300,17,3300,29,0],[3302,13,3302,30,0],[3303,13,3303,14,0],[3304,17,3304,23,0],[3307,13,3307,14,0],[3308,17,3308,31,0],[3309,17,3309,31,0],[3310,13,3310,14,0],[3311,9,3311,10,0],[3314,9,3314,10,0],[3315,13,3315,102,0],[3316,13,3316,108,0],[3317,13,3317,62,0],[3318,13,3318,37,0],[3319,13,3319,118,0],[3320,13,3320,49,0],[3321,13,3321,50,0],[3322,13,3322,52,0],[3323,13,3323,51,0],[3324,13,3324,39,0],[3325,13,3325,14,0],[3326,17,3326,56,0],[3327,17,3327,87,0],[3328,17,3328,39,0],[3329,17,3330,55,0],[3331,21,3331,51,0],[3332,13,3332,14,0],[3333,13,3333,133,0],[3334,13,3334,41,0],[3336,13,3336,36,0],[3337,13,3337,14,0],[3338,17,3338,55,0],[3339,17,3339,45,0],[3340,13,3340,14,0],[3341,13,3341,23,0],[3342,13,3342,24,0],[3343,9,3343,10,0],[3346,9,3346,10,0],[3347,13,3347,42,0],[3348,13,3348,29,0],[3349,13,3349,29,0],[3352,13,3352,39,0],[3353,13,3353,20,0],[3353,22,3353,32,0],[3353,33,3353,35,0],[3353,36,3353,59,0],[3354,13,3354,14,0],[3355,17,3357,29,0],[3358,17,3358,31,0],[3359,17,3359,18,0],[3360,21,3360,45,0],[3361,21,3361,91,0],[3362,21,3362,40,0],[3363,21,3363,59,0],[3364,21,3367,35,0],[3368,21,3368,70,0],[3369,21,3369,47,0],[3371,21,3371,51,0],[3372,21,3372,52,0],[3373,21,3373,46,0],[3374,21,3374,65,0],[3375,21,3378,35,0],[3379,21,3379,57,0],[3380,21,3380,95,0],[3381,21,3381,52,0],[3383,21,3383,117,0],[3385,21,3385,66,0],[3386,21,3386,68,0],[3387,17,3387,18,0],[3388,13,3388,14,0],[3389,13,3389,33,0],[3390,13,3390,32,0],[3391,13,3391,29,0],[3392,13,3392,46,0],[3393,9,3393,10,0],[3396,9,3396,10,0],[3397,13,3397,47,0],[3398,17,3399,71,0],[3400,18,3400,54,0],[3401,17,3401,73,0],[3402,18,3402,54,0],[3403,17,3403,73,0],[3404,18,3404,50,0],[3405,17,3405,69,0],[3407,17,3407,27,0],[3408,9,3408,10,0],[3415,9,3415,10,0],[3417,13,3417,14,0],[3419,17,3419,54,0],[3420,17,3422,75,0],[3423,17,3423,119,0],[3424,13,3424,14,0],[3425,13,3425,18,0],[3426,13,3426,14,0],[3427,13,3427,14,0],[3428,9,3428,10,0],[3431,9,3431,10,0],[3433,13,3433,102,0],[3434,13,3434,108,0],[3435,13,3435,62,0],[3436,13,3436,37,0],[3437,13,3438,92,0],[3440,13,3440,49,0],[3441,13,3441,50,0],[3442,13,3442,52,0],[3443,13,3443,51,0],[3444,13,3444,39,0],[3445,13,3445,14,0],[3446,17,3446,56,0],[3447,17,3447,87,0],[3448,17,3448,39,0],[3449,17,3450,55,0],[3451,21,3451,51,0],[3452,13,3452,14,0],[3453,13,3453,133,0],[3454,13,3454,41,0],[3456,13,3456,36,0],[3457,13,3457,14,0],[3458,17,3458,58,0],[3459,17,3459,45,0],[3460,13,3460,14,0],[3461,13,3461,23,0],[3462,13,3462,24,0],[3463,9,3463,10,0],[3466,9,3466,10,0],[3468,13,3468,42,0],[3469,13,3469,29,0],[3470,13,3470,29,0],[3472,13,3472,39,0],[3473,13,3473,20,0],[3473,22,3473,40,0],[3473,41,3473,43,0],[3473,44,3473,78,0],[3474,17,3474,52,0],[3475,17,3475,18,0],[3476,21,3476,91,0],[3477,17,3477,18,0],[3478,22,3478,55,0],[3479,17,3479,18,0],[3480,21,3480,28,0],[3480,30,3480,41,0],[3480,42,3480,44,0],[3480,45,3480,75,0],[3481,25,3481,86,0],[3482,17,3482,18,0],[3483,22,3483,55,0],[3484,17,3484,18,0],[3485,21,3485,28,0],[3485,30,3485,39,0],[3485,40,3485,42,0],[3485,43,3485,70,0],[3486,25,3486,32,0],[3486,34,3486,45,0],[3486,46,3486,48,0],[3486,49,3486,82,0],[3487,29,3487,90,0],[3488,17,3488,18,0],[3490,13,3490,33,0],[3491,13,3491,32,0],[3492,13,3492,29,0],[3493,13,3493,46,0],[3494,9,3494,10,0],[3497,9,3497,10,0],[3498,13,3498,29,0],[3499,17,3499,24,0],[3501,13,3501,20,0],[3501,22,3501,35,0],[3501,36,3501,38,0],[3501,39,3501,51,0],[3502,13,3502,14,0],[3503,17,3503,45,0],[3504,17,3504,18,0],[3505,21,3505,28,0],[3505,30,3505,48,0],[3505,49,3505,51,0],[3505,52,3505,65,0],[3506,25,3506,53,0],[3507,29,3507,91,0],[3508,17,3508,18,0],[3510,17,3510,18,0],[3511,21,3511,44,0],[3512,25,3512,82,0],[3513,17,3513,18,0],[3514,13,3514,14,0],[3516,13,3516,20,0],[3516,22,3516,40,0],[3516,41,3516,43,0],[3516,44,3516,58,0],[3517,17,3517,87,0],[3518,9,3518,10,0],[3521,9,3521,10,0],[3522,13,3522,37,0],[3523,13,3523,111,0],[3524,13,3524,32,0],[3525,13,3525,51,0],[3526,13,3526,112,0],[3527,13,3527,62,0],[3528,13,3528,39,0],[3530,13,3530,43,0],[3531,13,3531,45,0],[3532,13,3532,38,0],[3533,13,3533,57,0],[3534,13,3534,118,0],[3535,13,3535,49,0],[3536,13,3536,111,0],[3537,13,3537,44,0],[3539,13,3539,92,0],[3541,13,3541,58,0],[3542,13,3542,60,0],[3543,9,3543,10,0],[3546,9,3546,10,0],[3547,13,3547,60,0],[3548,13,3548,39,0],[3549,13,3549,42,0],[3551,13,3551,14,0],[3552,17,3552,47,0],[3553,17,3553,59,0],[3554,17,3554,48,0],[3555,17,3555,29,0],[3557,13,3557,30,0],[3558,13,3558,14,0],[3559,17,3559,23,0],[3562,13,3562,14,0],[3563,17,3563,31,0],[3564,17,3564,31,0],[3565,13,3565,14,0],[3566,9,3566,10,0],[3575,9,3575,10,0],[3576,13,3578,108,0],[3579,17,3581,112,0],[3582,13,3582,33,0],[3583,9,3583,10,0],[3585,9,3585,44,1],[3588,9,3588,10,0],[3589,13,3589,28,0],[3591,13,3591,71,0],[3592,17,3592,28,0],[3594,17,3594,64,0],[3596,45,3596,60,0],[3596,62,3596,82,0],[3598,13,3598,45,0],[3599,13,3599,14,0],[3600,17,3600,111,0],[3601,17,3601,105,0],[3602,17,3602,106,0],[3603,17,3603,105,0],[3604,17,3604,110,0],[3605,13,3605,14,0],[3607,13,3607,14,0],[3608,17,3608,111,0],[3609,17,3609,112,0],[3610,13,3610,14,0],[3612,13,3613,118,0],[3615,13,3615,75,0],[3617,13,3617,60,0],[3618,13,3618,45,0],[3619,13,3619,74,0],[3620,13,3620,43,0],[3622,13,3622,60,0],[3624,13,3624,161,0],[3626,13,3626,37,0],[3627,13,3627,14,0],[3628,17,3628,70,0],[3629,17,3629,71,0],[3629,71,3629,94,0],[3629,94,3629,104,0],[3629,17,3629,104,0],[3630,17,3630,18,0],[3631,21,3631,85,0],[3631,85,3631,108,0],[3631,108,3631,110,0],[3631,21,3631,110,0],[3632,21,3632,82,0],[3633,21,3633,69,0],[3634,17,3634,18,0],[3636,21,3636,69,0],[3637,13,3637,14,0],[3639,17,3639,64,0],[3641,13,3641,51,0],[3642,13,3642,14,0],[3643,17,3643,71,0],[3643,71,3643,101,0],[3643,101,3643,111,0],[3643,17,3643,111,0],[3644,17,3644,18,0],[3645,21,3645,85,0],[3645,85,3645,115,0],[3645,115,3645,117,0],[3645,21,3645,117,0],[3646,21,3646,82,0],[3647,21,3647,86,0],[3648,17,3648,18,0],[3650,21,3650,86,0],[3651,13,3651,14,0],[3653,13,3653,56,0],[3655,13,3655,60,0],[3657,13,3657,75,0],[3658,9,3658,10,0],[3666,17,3666,18,0],[3666,19,3666,32,0],[3666,33,3666,34,0],[3671,17,3671,18,1],[3671,19,3671,31,1],[3671,32,3671,33,1],[3676,17,3676,18,1],[3676,19,3676,39,1],[3676,40,3676,41,1],[3681,17,3681,18,0],[3681,19,3681,38,0],[3681,39,3681,40,0],[3686,17,3686,18,0],[3686,19,3686,29,0],[3686,30,3686,31,0],[3691,17,3691,18,1],[3691,19,3691,108,1],[3691,109,3691,110,1],[3696,17,3696,18,1],[3696,19,3696,98,1],[3696,99,3696,100,1],[3701,17,3701,18,0],[3701,19,3701,56,0],[3701,57,3701,58,0],[3706,9,3706,10,0],[3707,13,3707,49,0],[3711,9,3711,10,0],[3712,13,3712,49,0],[3716,9,3716,10,0],[3717,13,3717,50,0],[3718,9,3718,10,0],[3725,9,3725,10,0],[3727,13,3727,40,0],[3730,21,3730,67,0],[3731,21,3731,27,0],[3734,21,3734,70,0],[3735,21,3735,27,0],[3738,21,3738,71,0],[3739,21,3739,27,0],[3742,21,3742,68,0],[3743,21,3743,27,0],[3746,21,3746,80,0],[3747,21,3747,27,0],[3750,21,3750,77,0],[3751,21,3751,27,0],[3755,21,3755,67,0],[3756,21,3756,27,0],[3760,21,3760,70,0],[3761,21,3761,27,0],[3764,21,3764,66,0],[3765,21,3765,27,0],[3768,21,3768,69,0],[3769,21,3769,27,0],[3772,21,3772,68,0],[3773,21,3773,27,0],[3776,13,3776,38,0],[3777,9,3777,10,0],[3780,9,3780,10,1],[3781,13,3783,25,1],[3784,9,3784,10,1],[3787,9,3787,10,1],[3788,13,3788,35,1],[3791,21,3791,55,1],[3792,21,3792,27,0],[3796,21,3796,39,1],[3797,21,3797,70,1],[3798,21,3798,27,1],[3803,21,3803,28,1],[3803,30,3803,37,1],[3803,38,3803,40,1],[3803,41,3803,71,1],[3804,21,3804,22,1],[3805,25,3805,57,1],[3807,25,3807,131,1],[3808,21,3808,22,1],[3812,21,3812,63,1],[3813,21,3813,73,1],[3814,21,3814,121,1],[3815,21,3815,79,1],[3816,21,3816,22,1],[3818,25,3818,43,1],[3819,25,3819,74,1],[3820,21,3820,22,1],[3821,26,3821,86,1],[3822,21,3822,22,1],[3824,25,3824,75,1],[3824,75,3824,108,1],[3824,108,3824,110,1],[3824,25,3824,110,1],[3825,21,3825,22,1],[3827,21,3827,22,1],[3830,25,3830,63,1],[3831,25,3831,26,0],[3832,29,3832,47,0],[3833,29,3835,64,0],[3836,25,3836,26,0],[3837,21,3837,22,1],[3838,21,3838,27,1],[3840,9,3840,10,1],[3843,9,3843,10,1],[3844,13,3844,33,1],[3845,17,3845,75,0],[3848,13,3848,35,1],[3849,17,3849,37,1],[3852,13,3852,71,1],[3855,13,3855,36,1],[3858,13,3858,31,1],[3860,13,3860,33,1],[3861,17,3861,73,0],[3862,9,3862,10,1],[3865,9,3865,10,1],[3866,13,3866,36,1],[3867,13,3867,14,1],[3868,17,3868,67,1],[3869,17,3869,24,1],[3869,26,3869,59,0],[3869,60,3869,62,1],[3869,63,3869,98,1],[3870,17,3870,18,0],[3871,21,3871,114,0],[3872,21,3872,89,0],[3873,21,3874,118,0],[3875,21,3875,76,0],[3877,21,3877,76,0],[3878,21,3878,90,0],[3879,21,3879,84,0],[3880,21,3880,75,0],[3881,21,3881,78,0],[3882,21,3882,79,0],[3883,17,3883,18,0],[3884,13,3884,14,1],[3885,9,3885,10,1],[3888,9,3888,10,0],[3889,13,3889,35,0],[3890,17,3890,37,0],[3892,13,3894,106,0],[3897,13,3900,25,0],[3900,25,3901,122,0],[3901,122,3903,32,0],[3897,13,3903,32,0],[3904,13,3904,14,0],[3905,17,3909,29,0],[3909,29,3910,45,0],[3910,45,3910,76,0],[3910,76,3912,47,0],[3912,47,3912,75,0],[3912,75,3912,76,0],[3909,29,3912,76,0],[3912,76,3912,78,0],[3905,17,3912,78,0],[3913,17,3915,25,0],[3915,25,3916,122,0],[3916,122,3917,35,0],[3917,35,3917,63,0],[3917,63,3917,65,0],[3913,17,3917,65,0],[3918,17,3919,121,0],[3921,17,3921,62,0],[3922,13,3922,14,0],[3923,9,3923,10,0],[3926,9,3926,10,1],[3944,9,3944,10,1],[3947,9,3947,10,1],[3948,13,3948,32,1],[3949,17,3949,24,0],[3965,13,3965,55,1],[3966,13,3966,149,1],[3967,9,3967,10,1],[3970,9,3970,10,1],[3971,13,3971,40,1],[3972,13,3972,14,1],[3973,17,3973,60,1],[3975,17,3975,24,1],[3975,26,3975,43,1],[3975,44,3975,46,1],[3975,47,3975,83,1],[3976,17,3976,18,1],[3977,21,3977,134,1],[3978,21,3978,45,1],[3980,21,3980,52,1],[3981,25,3981,83,0],[3983,21,3983,51,1],[3984,21,3984,22,1],[3985,25,3985,75,1],[3986,21,3986,22,1],[3988,21,3988,85,1],[3989,21,3989,22,0],[3990,25,3990,96,0],[3992,25,3992,105,0],[3993,25,3993,26,0],[3994,29,3994,76,0],[3995,29,3995,56,0],[3996,29,3996,62,0],[3998,29,3998,76,0],[3999,25,3999,26,0],[4000,21,4000,22,0],[4001,17,4001,18,1],[4003,17,4003,68,1],[4004,17,4004,101,1],[4005,17,4005,18,0],[4006,21,4006,110,0],[4007,21,4007,51,0],[4008,21,4008,22,0],[4009,25,4011,80,0],[4012,25,4012,92,0],[4013,25,4013,98,0],[4014,25,4014,72,0],[4015,25,4015,78,0],[4016,21,4016,22,0],[4017,17,4017,18,0],[4019,17,4019,68,1],[4020,17,4020,101,1],[4021,17,4021,18,0],[4022,21,4022,110,0],[4023,21,4023,51,0],[4024,21,4024,22,0],[4025,25,4027,79,0],[4028,25,4028,92,0],[4029,25,4029,98,0],[4030,25,4030,72,0],[4031,25,4031,78,0],[4032,21,4032,22,0],[4033,17,4033,18,0],[4035,17,4035,24,1],[4035,26,4035,37,0],[4035,38,4035,40,1],[4035,41,4035,69,1],[4036,17,4036,18,0],[4037,21,4037,57,0],[4038,21,4038,69,0],[4039,21,4040,90,0],[4041,21,4041,22,0],[4042,25,4042,101,0],[4043,25,4043,68,0],[4044,25,4044,26,0],[4045,29,4048,75,0],[4049,29,4049,86,0],[4050,29,4050,92,0],[4051,29,4051,66,0],[4052,29,4052,72,0],[4053,29,4053,79,0],[4054,25,4054,26,0],[4055,21,4055,22,0],[4056,17,4056,18,0],[4057,13,4057,14,1],[4059,18,4059,52,1],[4060,13,4060,14,0],[4061,17,4061,74,0],[4062,17,4062,61,0],[4063,17,4063,59,0],[4064,17,4064,50,0],[4065,17,4065,47,0],[4066,21,4066,63,0],[4067,17,4067,48,0],[4068,21,4068,62,0],[4070,17,4070,126,0],[4071,13,4071,14,0],[4072,13,4072,67,1],[4076,13,4076,47,1],[4077,13,4077,14,0],[4079,17,4079,73,0],[4081,17,4081,73,0],[4083,17,4083,24,0],[4083,26,4083,43,0],[4083,44,4083,46,0],[4083,47,4083,77,0],[4084,17,4084,18,0],[4085,21,4085,83,0],[4086,21,4086,22,0],[4087,25,4087,83,0],[4088,29,4088,75,0],[4090,29,4090,76,0],[4091,21,4091,22,0],[4092,17,4092,18,0],[4093,13,4093,14,0],[4096,9,4096,10,1],[4099,9,4099,10,1],[4100,13,4100,48,1],[4102,13,4102,45,1],[4103,13,4103,14,1],[4104,17,4104,45,1],[4105,17,4105,18,1],[4106,21,4106,66,1],[4107,21,4107,50,1],[4108,21,4108,22,1],[4109,25,4109,32,1],[4109,34,4109,51,1],[4109,52,4109,54,1],[4109,55,4109,80,1],[4110,25,4110,26,1],[4131,29,4131,109,1],[4132,29,4132,65,1],[4133,29,4133,30,1],[4134,33,4134,89,1],[4136,33,4136,89,1],[4137,33,4137,34,1],[4138,37,4138,130,1],[4139,37,4139,79,1],[4140,33,4140,34,1],[4141,29,4141,30,1],[4142,25,4142,26,1],[4143,21,4143,22,1],[4144,17,4144,18,1],[4145,13,4145,14,1],[4146,9,4146,10,1],[4149,9,4149,10,0],[4150,13,4150,67,0],[4151,13,4151,30,0],[4151,30,4151,98,0],[4151,98,4151,100,0],[4151,13,4151,100,0],[4153,13,4153,56,0],[4154,13,4154,55,0],[4155,13,4155,55,0],[4156,13,4156,102,0],[4157,13,4157,50,0],[4158,13,4158,58,0],[4159,13,4159,42,0],[4160,9,4160,10,0],[4163,9,4163,10,0],[4164,13,4164,45,0],[4165,9,4165,10,0],[4168,9,4168,10,0],[4169,13,4169,105,0],[4170,13,4170,14,0],[4171,17,4171,62,0],[4172,17,4172,85,0],[4173,13,4173,14,0],[4177,13,4177,20,0],[4177,22,4177,54,0],[4177,55,4177,57,0],[4177,58,4177,68,0],[4178,13,4178,14,0],[4179,17,4179,75,0],[4180,17,4180,102,0],[4181,17,4181,24,0],[4181,26,4181,41,0],[4181,42,4181,44,0],[4181,45,4181,79,0],[4182,17,4182,18,0],[4183,21,4183,96,0],[4184,21,4184,22,0],[4185,25,4185,104,0],[4186,21,4186,22,0],[4187,17,4187,18,0],[4188,17,4188,66,0],[4189,13,4189,14,0],[4190,13,4190,40,0],[4191,9,4191,10,0],[4194,9,4194,10,0],[4195,13,4195,60,0],[4196,13,4196,14,0],[4197,17,4197,96,0],[4198,17,4202,29,0],[4202,29,4205,102,0],[4205,102,4205,104,0],[4198,17,4205,104,0],[4206,17,4208,30,0],[4208,30,4208,85,0],[4208,85,4208,87,0],[4206,17,4208,87,0],[4209,17,4209,18,0],[4210,21,4213,117,0],[4214,17,4214,18,0],[4215,17,4216,121,0],[4218,17,4218,62,0],[4219,13,4219,14,0],[4220,18,4220,67,0],[4221,13,4221,14,0],[4222,17,4222,96,0],[4223,17,4227,29,0],[4227,29,4229,73,0],[4229,73,4232,29,0],[4232,29,4234,67,0],[4234,67,4234,69,0],[4223,17,4234,69,0],[4235,17,4236,121,0],[4238,17,4238,62,0],[4239,13,4239,14,0],[4240,9,4240,10,0],[4243,9,4243,10,1],[4244,13,4244,50,1],[4245,13,4245,45,1],[4246,13,4246,51,1],[4247,9,4247,10,1]]);
    </script>
  </body>
</html>