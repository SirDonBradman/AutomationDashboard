<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Construction Vertical\Addon Modules\Contract Manager\Work Order\BL\WOManager.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Drawing;
using System.IO;
using System.Reflection;
using System.Web;
using System.Web.UI;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core.BusinessLayer.DTO;
using Aurigo.AMP3.Core.IntegrationConnector;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.AMP3.WORKORDDAC;
using Aurigo.AMP3.WORKORDDTO;
using Aurigo.Brix.Construction.ContractManager.BusinessLayer;
using Aurigo.Brix.Construction.ContractManager.BusinessLayer.BL;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.Brix.WorkflowMediators;
using DataDynamics.ActiveReports.Export.Pdf;
using TextBox = DataDynamics.ActiveReports.TextBox;
using Label = DataDynamics.ActiveReports.Label;
using System.Xml;
using System.Text;
using Aurigo.AMP3.ContractManager.BusinessLayer;

namespace Aurigo.AMP3.WORKORDBL
{
    [ContextAttribute(Name = &quot;WORKORD&quot;)]
    public class WORKORDManager : ILibrary, IModuleInstances, IItemVerifiable, IActivityVerifiable, ISubItemVerifiable
    {        
        private static volatile Dictionary&lt;string, WORKORDManager&gt; _Inst = null;
        private static readonly object _oSync = new object();
        public WORKORDManager() { }
        public static WORKORDManager Instance
        {
            get
            {
                lock (_oSync)
                {
                    if (_Inst == null) _Inst = new Dictionary&lt;string, WORKORDManager&gt;();
                    string currentCompany = ConnectionHelper.GetCurrentCompany();
                    if (!_Inst.ContainsKey(currentCompany))                       
                                _Inst.Add(currentCompany, new WORKORDManager());

                    return _Inst[currentCompany];
                }
            }
        }


        #region IActivityVerifiable Members

        public string ValidateActivityBeforeSave(Activity activityDTO)
        {
            string retValidate = String.Empty;

            var retDict = new Dictionary&lt;string, object&gt;();
            retDict[&quot;IsValidForChange&quot;] = Int32.Parse(&quot;0&quot;);
            retDict[&quot;ErrorMessage&quot;] = String.Empty;
            retDict[&quot;Mode&quot;] = 1; //Update

            int numRows =
                ComponentHelper.Instance.ExecuteNonQuery(WOStoredProcedure.usp_WORKORDValidateActivityAgainstWO, retDict,
                                                         activityDTO);
            int isValid = 0;
            if (retDict.ContainsKey(&quot;IsValidForChange&quot;) &amp;&amp; retDict[&quot;IsValidForChange&quot;] != null)
                Int32.TryParse(retDict[&quot;IsValidForChange&quot;].ToString2(), out isValid);
            if (retDict.ContainsKey(&quot;ErrorMessage&quot;) &amp;&amp; retDict[&quot;ErrorMessage&quot;] != null)
                retValidate = retDict[&quot;ErrorMessage&quot;].ToString2();

            return retValidate;
        }

        public string ValidateActivityBeforeDelete(Activity activityDTO)
        {
            string retValidate = String.Empty;

            var retDict = new Dictionary&lt;string, object&gt;();
            retDict[&quot;IsValidForChange&quot;] = Int32.Parse(&quot;0&quot;);
            retDict[&quot;ErrorMessage&quot;] = String.Empty;
            retDict[&quot;Mode&quot;] = 2; //Delete

            int numRows =
                ComponentHelper.Instance.ExecuteNonQuery(WOStoredProcedure.usp_WORKORDValidateActivityAgainstWO, retDict,
                                                         activityDTO);
            int isValid = 0;
            if (retDict.ContainsKey(&quot;IsValidForChange&quot;) &amp;&amp; retDict[&quot;IsValidForChange&quot;] != null)
                Int32.TryParse(retDict[&quot;IsValidForChange&quot;].ToString2(), out isValid);
            if (retDict.ContainsKey(&quot;ErrorMessage&quot;) &amp;&amp; retDict[&quot;ErrorMessage&quot;] != null)
                retValidate = retDict[&quot;ErrorMessage&quot;].ToString2();

            return retValidate;
        }

        #endregion

        #region IItemVerifiable Members

        public string ValidateItemBeforeSave(Item itemDTO)
        {
            return string.Empty;
        }

        public string ValidateItemBeforeDelete(Item itemDTO)
        {
            string retValidate = String.Empty;

            var retDict = new Dictionary&lt;string, object&gt;();
            retDict[&quot;IsValidForChange&quot;] = Int32.Parse(&quot;0&quot;);
            retDict[&quot;ErrorMessage&quot;] = String.Empty;
            retDict[&quot;Mode&quot;] = 2; //Delete

            int numRows = ComponentHelper.Instance.ExecuteNonQuery(WOStoredProcedure.usp_WORKORDValidateItemAgainstWO,
                                                                   retDict, itemDTO);
            int isValid = 0;
            if (retDict.ContainsKey(&quot;IsValidForChange&quot;) &amp;&amp; retDict[&quot;IsValidForChange&quot;] != null)
                Int32.TryParse(retDict[&quot;IsValidForChange&quot;].ToString2(), out isValid);
            if (retDict.ContainsKey(&quot;ErrorMessage&quot;) &amp;&amp; retDict[&quot;ErrorMessage&quot;] != null)
                retValidate = retDict[&quot;ErrorMessage&quot;].ToString2();

            return retValidate;
        }

        #endregion

        #region ILibrary Members

        public string FetchLibraryData(string typeOfData, int[] dependencyValues)
        {
            try
            {
                if (typeOfData.ToUpper2().Equals(&quot;WORKORDERS&quot;))
                {
                    DataSet dsItems = new BrixDataSet();
                    for (int idx = 0; idx &lt; dependencyValues.Length; idx += 2)
                    {
                        DataTable dt =
                            WORKORDComponent.Instance.GetWorkOrdersByContract(dependencyValues[idx]).Tables[0].Copy();
                        dt.TableName = &quot;WOS&quot; + dependencyValues[idx];
                        dsItems.Tables.Add(dt);
                    }
                    dsItems.DataSetName = &quot;Records&quot;;
                    if (dsItems.Tables.Count &lt; 1)
                        return &quot;&quot;;
                    else
                        return dsItems.GetXml();
                }
            }
            catch (Exception)
            {
                return &quot;&quot;;
            }
            return &quot;&quot;;
        }

        #endregion

        #region IModuleInstances Members

        public string GetModuleInstances(string parentID, string parentModuleID)
        {
            return &quot;SELECT WorkOrderID FROM WORKORDMain WHERE ContractID = &quot; + parentID;
        }

        #endregion

        #region ISubItemVerifiable Members

        public string ValidateSubItemBeforeSave(SubItem subItemDTO)
        {
            return String.Empty;
        }

        public string ValidateSubItemBeforeDelete(SubItem subItemDTO)
        {
            string retValidate = String.Empty;

            var retDict = new Dictionary&lt;string, object&gt;();
            retDict[&quot;IsValidForChange&quot;] = Int32.Parse(&quot;0&quot;);
            retDict[&quot;ErrorMessage&quot;] = String.Empty;
            retDict[&quot;Mode&quot;] = 2; //Delete

            int numRows = ComponentHelper.Instance.ExecuteNonQuery(
                WOStoredProcedure.usp_WORKORDValidateSubItemAgainstWO, retDict, subItemDTO);
            int isValid = 0;
            if (retDict.ContainsKey(&quot;IsValidForChange&quot;) &amp;&amp; retDict[&quot;IsValidForChange&quot;] != null)
                Int32.TryParse(retDict[&quot;IsValidForChange&quot;].ToString2(), out isValid);
            if (retDict.ContainsKey(&quot;ErrorMessage&quot;) &amp;&amp; retDict[&quot;ErrorMessage&quot;] != null)
                retValidate = retDict[&quot;ErrorMessage&quot;].ToString2();

            return retValidate;
        }

        #endregion

        public int CUWorkOrder(WorkOrderDTO WODTO)
        {
            return WORKORDComponent.Instance.CUWorkOrder(WODTO);
        }

        public int IssueWO(WorkOrderDTO WODTO)
        {
            return WORKORDComponent.Instance.IssueWO(WODTO);
        }

        public int UndoIssueWO(WorkOrderDTO WODTO)
        {
            return WORKORDComponent.Instance.UndoIssueWO(WODTO);
        }
        public DataSet ValidateUndoIssueWO(string strWOID, string ContractID, string WorkorderNO)
        {
            return WORKORDComponent.Instance.ValidateUndoIssueWO(strWOID, ContractID, WorkorderNO);
        }

        public int ValidateIssueWO(WorkOrderDTO WODTO)
        {
            return WORKORDComponent.Instance.ValidateIssueWO(WODTO);
        }

        public int GetWOCount(int contractID, string filterSearch)
        {
            return WORKORDComponent.Instance.GetWOCount(contractID, filterSearch);
        }

        public string GetWONumber(int contractID, int projectID, bool ContractLevel, string Company)
        {
            return WORKORDComponent.Instance.GetWONumber(contractID, projectID, ContractLevel, Company);
        }

        public bool ShouldAllowUnlimitedQuotRate(int contractId, int projectId)
        {
            return WORKORDComponent.Instance.ShouldAllowUnlimitedQuotRate(contractId, projectId)[0].ToBoolean2();
        }

        public DataRow GetWorkOrderSettings(int contractId, int projectId)
        {
            return WORKORDComponent.Instance.ShouldAllowUnlimitedQuotRate(contractId, projectId);
        }

        public void CUPrefix(int SettingID, int contractID, int projectID, string Prefix, bool allowUnlimitedQuotRate,
                             bool validateChecklists)
        {
            WORKORDComponent.Instance.CUPrefix(SettingID, contractID, projectID, Prefix, allowUnlimitedQuotRate,
                                               validateChecklists);
        }

        public DataSet GetWOList(int contractID, object startRowIdx, object maxRows, string sortOrder,
                                 string filterSearch)
        {
            return WORKORDComponent.Instance.GetWOList(contractID, startRowIdx, maxRows, sortOrder, filterSearch);
        }

        public WorkOrderDTO GetWorkOrderDetails(int WorkOrderID)
        {
            return WORKORDComponent.Instance.GetWorkOrderDetails(WorkOrderID);
        }

        public int CloseWorkOrder(int WorkOrderID, int ModifiedByID, string ModifiedBy, DateTime ModifiedOn,
                                  string VersionNo)
        {
            return CloseWorkOrder(WorkOrderID, ModifiedByID, ModifiedBy, ModifiedOn, VersionNo, &quot;N&quot;, MWDateTimeHelper.MWToday);
        }

        public int ValidateCloseWorkOrder(int WorkOrderID, int ModifiedByID, string ModifiedBy, DateTime ModifiedOn,
                                 string VersionNo)
        {
            return ValidateCloseWorkOrder(WorkOrderID, ModifiedByID, ModifiedBy, ModifiedOn, VersionNo, &quot;N&quot;, MWDateTimeHelper.MWToday);
        }

        public int CloseWorkOrder(int WorkOrderID, int ModifiedByID, string ModifiedBy, DateTime ModifiedOn,
                                  string VersionNo, DateTime? retRelDate)
        {
            return CloseWorkOrder(WorkOrderID, ModifiedByID, ModifiedBy, ModifiedOn, VersionNo, &quot;N&quot;, retRelDate);
        }

        public int CloseWorkOrder(int WorkOrderID, int ModifiedByID, string ModifiedBy, DateTime ModifiedOn,
                                  string VersionNo, string isFromPE)
        {
            return CloseWorkOrder(WorkOrderID, ModifiedByID, ModifiedBy, ModifiedOn, VersionNo, isFromPE, null);
        }

        public int CloseWorkOrder(int WorkOrderID, int ModifiedByID, string ModifiedBy, DateTime ModifiedOn,
                                  string VersionNo, string isFromPE, DateTime? retRelDate)
        {
            return WORKORDComponent.Instance.CloseWorkOrder(WorkOrderID, ModifiedByID, ModifiedBy, ModifiedOn, VersionNo,
                                                            isFromPE, retRelDate);
        }

        public int ValidateCloseWorkOrder(int WorkOrderID, int ModifiedByID, string ModifiedBy, DateTime ModifiedOn,
                                 string VersionNo, string isFromPE, DateTime? retRelDate)
        {
            return WORKORDComponent.Instance.ValidateCloseWorkOrder(WorkOrderID, ModifiedByID, ModifiedBy, ModifiedOn, VersionNo,
                                                            isFromPE, retRelDate);
        }

        public decimal GetAvailableQuantityForItem(int ItemID, int WorkOrderID)
        {
            return WORKORDComponent.Instance.GetAvailableQuantityForItem(ItemID, WorkOrderID);
        }

        public decimal GetUnitPrice(int ItemID, string ModuleID, bool chkWithMaterial, bool chkWithLabour,
                                    bool chkWithEquipment)
        {
            return WORKORDComponent.Instance.GetUnitPrice(ItemID, ModuleID, chkWithMaterial, chkWithLabour,
                                                          chkWithEquipment);
        }

        public decimal GetAppPostedQty(int ItemID, int WorkOrderID)
        {
            return WORKORDComponent.Instance.GetApprovedPostedQty(ItemID, WorkOrderID);
        }

        public bool SetItemsCompletedQuantity(int WorkOrderID, int ItemID, decimal QuantityPosted)
        {
            return WORKORDComponent.Instance.SetItemsCompletedQuantity(WorkOrderID, ItemID, QuantityPosted);
        }

        /// &lt;summary&gt;
        /// The input xml should be of the format
        /// &lt;Item ItemID=&quot;2&quot; UnitPrice=&quot;33.34&quot; Quantity =&quot;13&quot; /&gt;
        /// &lt;Item ItemID=&quot;4&quot; UnitPrice=&quot;12.34&quot; Quantity =&quot;21&quot; /&gt;
        /// Note: No root element
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;ItemXML&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;CreatedBy&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;QuotationID&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public bool UpdateQuotationDetails(string ItemXML, int CreatedBy, int QuotationID)
        {
            return WORKORDComponent.Instance.UpdateQuotationDetails(ItemXML, CreatedBy, QuotationID);
        }

        public bool CreateWorkOrderQuotations(int QID, int WorkOrderID, int ContractorID, string Contractor,
                                              DateTime Date, string quotNotes, Decimal TotalAmount, int Status,
                                              string ItemXML, int Output)
        {
            return WORKORDComponent.Instance.CreateWorkOrderQuotations(QID, WorkOrderID, ContractorID, Contractor, Date,
                                                                       quotNotes, TotalAmount, Status, ItemXML, Output);
        }

        public DataTable GetWorkOrderQuotations(int WorkOrderID)
        {
            return WORKORDComponent.Instance.GetWorkOrderQuotations(WorkOrderID);
        }

        public int SetQuotationStatus(string QuotationIDList, int Status)
        {
            return WORKORDComponent.Instance.SetQuotationStatus(QuotationIDList, Status);
        }

        public DataSet GetWorkOrderQuotationDetails(int WorkOrderID, int QuotationID)
        {
            return WORKORDComponent.Instance.GetWorkOrderQuotationDetails(WorkOrderID, QuotationID);
        }

        public DataSet GetQuotations(int WorkOrderID)
        {
            return WORKORDComponent.Instance.GetQuotations(WorkOrderID);
        }

        public DataSet GetQuotation(int QuotationID, int WorkOrderID)
        {
            return WORKORDComponent.Instance.GetQuotation(QuotationID, WorkOrderID);
        }

        public int DeleteQuotation(string QuotationIDList)
        {
            return WORKORDComponent.Instance.DeleteQuotation(QuotationIDList);
        }

        public int GetWorkOrderStatus(int WorkOrderID, int Status)
        {
            return WORKORDComponent.Instance.GetWorkOrderStatus(WorkOrderID, Status);
        }

        public bool IsWoNoUnique(string wonum, int woid, int contractID)
        {
            return WORKORDComponent.Instance.IsWoNoUnique(wonum, woid, contractID);
        }

        public MemoryStream GetPDF(int woId, int contID, string path, string logoFilePath, String REQ)
        {
            DataTable dtTemp;

            dtTemp = GetWOMainReport(contID, woId);

            var pdf = new PdfExport();
            var rpt = new DataDynamics.ActiveReports.ActiveReport();

            var subRptItems = new DataDynamics.ActiveReports.ActiveReport();
            XmlReader XReader = XmlReader.Create(System.Web.HttpContext.Current.Server.MapPath(&quot;.&quot;) + &quot;\\WOItems.rpx&quot;);
            subRptItems.LoadLayout(XReader);

            var strm = new MemoryStream();
            XmlReader XmReader = XmlReader.Create(System.Web.HttpContext.Current.Server.MapPath(&quot;.&quot;) + &quot;\\WOReport.rpx&quot;);
            rpt.LoadLayout(XmReader);

            rpt.PageSettings.Margins.Top = 0.5F;
            rpt.PageSettings.Margins.Left = 0.5F;
            rpt.PageSettings.Margins.Bottom = 0.5F;
            rpt.PageSettings.Margins.Right = 0.5F;
            //rpt.PrintWidth = 7.5F;

            // Assiging the datasource to the mainreport
            rpt.DataSource = dtTemp;

            // Assiging the datasource to the subreport
            DataTable dtTemp1 = GetWOSubReport(woId, contID);

            subRptItems.DataSource = dtTemp1;

            //DataDynamics.ActiveReports.DataSources.OleDBDataSource ds = ((DataDynamics.ActiveReports.DataSources.OleDBDataSource)(rpt.DataSource));
            //ds.ConnectionString = &quot;PROVIDER=OraOLEDB.Oracle;&quot; + WebConfigurationManager.ConnectionStrings[Constants.AMP3_CONNECTIONSTRING].ConnectionString;

            if (File.Exists(logoFilePath))
            {
                Image logoImage = new Bitmap(logoFilePath);
                var pic = ((DataDynamics.ActiveReports.Picture) rpt.Sections[&quot;ReportHeader&quot;].Controls[&quot;rptLogo&quot;]);
                pic.Image = logoImage;
                if (logoImage.Height &gt; pic.Height*100 ||
                    logoImage.Width &gt; pic.Width*100)

                    pic.SizeMode = DataDynamics.ActiveReports.SizeModes.Zoom;
            }


            // Applying the localization to both the reports
            string currency_up = LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) +
                                 AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;
            string currency_amount = LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) +
                                     AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
            string payItemNo = LocalizationManager.GetString(KeyConstants.LOC_PAY_ITEM_NO_ABBR);

            // Main Report
            ((TextBox) rpt.Sections[&quot;GrpHeader&quot;].Controls[&quot;TextBox&quot;]).OutputFormat = currency_amount;
            ((Label) rpt.Sections[&quot;GrpHeader&quot;].Controls[&quot;Label7&quot;]).Text = payItemNo;

            // Sub Report
            ((TextBox) subRptItems.Sections[&quot;Detail&quot;].Controls[&quot;TextBox5&quot;]).OutputFormat = currency_up;
            ((TextBox) subRptItems.Sections[&quot;Detail&quot;].Controls[&quot;TextBox6&quot;]).OutputFormat = currency_amount;
            // End of localization to both the reports

            ((DataDynamics.ActiveReports.SubReport) rpt.Sections[&quot;GrpHeader&quot;].Controls[&quot;subRptItems&quot;]).Report =
                subRptItems;

            //subRptItems.Parameters[&quot;@WOID&quot;].Value = rpt.Parameters[&quot;@WOID&quot;].Value = woId.ToString();
            //rpt.Parameters[&quot;@ContractID&quot;].Value = contID.ToString();
            subRptItems.ShowParameterUI = rpt.ShowParameterUI = false;

            //rpt.DataSource = ds;
            //((DataDynamics.ActiveReports.DataSources.OleDBDataSource)subRptItems.DataSource).ConnectionString = ds.ConnectionString;
            rpt.Run();

            pdf.Export(rpt.Document, strm);
            return strm;
        }

        public DataTable GetWOOrContractor(int ContractID, int? WorkOrderID, int? ContractorID)
        {
            return
                ComponentHelper.Instance.ExecuteDataSet(WOStoredProcedure.usp_WORKORDGetWOOrContractor, null,
                                                        new object[] {ContractID, WorkOrderID, ContractorID, 0}).Tables[
                                                            0];
        }

        public DataTable GetWOOrContractorForRAB(int ContractID, int? WorkOrderID, int? ContractorID)
        {
            return
                ComponentHelper.Instance.ExecuteDataSet(WOStoredProcedure.usp_WORKORDGetWOOrContractor, null,
                                                        new object[] {ContractID, WorkOrderID, ContractorID, 1}).Tables[
                                                            0];
        }

        public DataTable GetSubContractorsList(int ContractID)
        {
            return WORKORDComponent.Instance.GetSubContractorsList(ContractID);
        }

        public int DeleteWorkOrder(int WorkOrderID)
        {
            return WORKORDComponent.Instance.DeleteWO(WorkOrderID);
        }

        public DataTable GetWOSubReport(int workOrderID, int contID)
        {
            DataSet result = ComponentHelper.Instance.ExecuteDataSet(WOStoredProcedure.WORKORDReports, null, contID,
                                                                     workOrderID, &quot;S&quot;);
            return result.Tables[0];
        }

        public DataTable GetWOMainReport(int contID, int workOrderID)
        {
            DataSet result = ComponentHelper.Instance.ExecuteDataSet(WOStoredProcedure.WORKORDReports, null, contID,
                                                                     workOrderID, &quot;M&quot;);
            return result.Tables[0];
        }

        public DataTable GetRFQReport(int contID, int workOrderID)
        {
            DataSet result = ComponentHelper.Instance.ExecuteDataSet(WOStoredProcedure.WORKORDReports, null, contID,
                                                                     workOrderID, &quot;RFQ&quot;);
            return result.Tables[0];
        }

        public decimal GetMOHStatus(string WorkOrderNumber, int ContractID)
        {
            return WORKORDComponent.Instance.GetMOHStatus(WorkOrderNumber, ContractID);
        }

        internal DataSet GetPendingDetailsForCloseOut(int workOrderId)
        {
            return WORKORDComponent.Instance.GetPendingDetailsForCloseOut(workOrderId);
        }

        public void HandleAXIntegrationforCloseOut(string workOrderId, string contractId)
        {
            string mappedCompany = String.Empty;

            //Check for Brix-ERP Subproject mapping if the ERP supports Contract Mapping
            DataTable dtMap = IntegrationConnectorManager.Instance.GetERPObjectMapInfo(contractId, AMP3Object.CONTMGT,
                                                                                       null, AMP3Object.UNKNOWN,
                                                                                       RegisteredEIS.AX);
            if (dtMap != null &amp;&amp; dtMap.Rows.Count &gt; 0)
            {
                mappedCompany = dtMap.Rows[0][&quot;ERPCompany&quot;].ToString();
            }
            else
                //Throws this message to BrixListPage (messagebox pop up)
                return;
            //result = &quot;Contract is not mapped to AX Sub project . So Purchase Order is not pushed to AX&quot;;
            //return result;


            var objAdditionalInfo = new EISAdditionalInfo(RegisteredEIS.AX);
            objAdditionalInfo.AddInfo(Constants.EIS_ADDITIONAL_INFO, mappedCompany);
            var dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
            dictAdditionalInfo.Add(RegisteredEIS.AX, objAdditionalInfo);
            var ConBrixInfo = new List&lt;ConnectionBrixInfo&gt;();
            ConBrixInfo.Add(new ConnectionBrixInfo(AMP3Object.CONTMGT, contractId, AMP3Object.UNKNOWN, &quot;0&quot;));
            var connectorParameter = new ConnectorParameters(dictAdditionalInfo, MethodBase.GetCurrentMethod(),
                                                             AMP3ObjectType.Unknown, null, ConBrixInfo);
            var dsPO = new DataSet();
            var dtPO = new DataTable();
            dtPO.Columns.Add(&quot;PurchId&quot;, typeof (String));
            dtPO.Rows.Add(dtPO.NewRow());
            DataTable dtMapWO = IntegrationConnectorManager.Instance.GetERPObjectMapInfo(workOrderId, AMP3Object.WORKORD,
                                                                                         contractId, AMP3Object.CONTMGT,
                                                                                         RegisteredEIS.AX);
            if (dtMapWO.Rows.Count &gt; 0)

                dtPO.Rows[0][&quot;PurchId&quot;] = dtMapWO.Rows[0][&quot;ERPId&quot;].ToString();
            dsPO.Tables.Add(dtPO);
            int count = 0;
            if (IntegrationConnectorManager.HandleIntegration(connectorParameter, ref count, ref dsPO, false))
            {
                return;
            }
        }

        /// &lt;summary&gt;
        /// Returns the dataset which contains library&#39;s Recovery rules, prepayment types and retention rules
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;ModuleID&quot;&gt;LIBRARY for library,CONTMGT for settings and WORKORD for work order&lt;/param&gt;
        /// &lt;param name=&quot;InstanceId&quot;&gt;0 for library, ContractID for contract settings and WOID for Workorder&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public DataSet GetRecoveryRetentionDetails(string moduleId, int instanceId)
        {
            return WOComponent.Instance.GetRecoveryRetentionDetails(moduleId, instanceId);
        }

        public int ValidateBOQDelete(int workOrderID, int itemID)
        {
            return WOComponent.Instance.ValidateBOQDelete(workOrderID, itemID);
        }

        public int ValidatePrepaymentRule(int workOrderId, int recoveryId)
        {
            return WOComponent.Instance.ValidatePrepaymentRule(workOrderId, recoveryId);
        }

        public int CUDPrepaymentTypes(int mohTypeID, string mohType, string description, string mode)
        {
            return WOComponent.Instance.CUDPrepaymentTypes(mohTypeID, mohType, description, mode);
        }

        public DataTable GetPrepaymentTypes(int mohId)
        {
            return WOComponent.Instance.GetPrepaymentTypes(mohId);
        }

        public void SaveCommitmentsAndItems(int workorderId,int? previousWOId)
        {
            WOComponent.Instance.SaveCommitmentsAndItems(workorderId, previousWOId);
        }

        public void UndoIssueAmmendment(int workorderId)
        {
            WOComponent.Instance.UndoIssueAmmendment(workorderId);
        }
    }

    public class WOManager //: IFormSearch, ILibrary, IModuleInstances
    {        
        private static volatile Dictionary&lt;string, WOManager&gt; _Inst = null;
        private static readonly object _oSync = new object();
        private WOManager() { }
        public static WOManager Instance
        {
            get
            {
                lock (_oSync)
                {
                    if (_Inst == null) _Inst = new Dictionary&lt;string, WOManager&gt;();
                    string currentCompany = ConnectionHelper.GetCurrentCompany();
                    if (!_Inst.ContainsKey(currentCompany))                      
                                _Inst.Add(currentCompany, new WOManager());

                    return _Inst[currentCompany];
                }
            }
        }

        public int CUWorkOrder(WorkOrderDTO WODTO)
        {
            return WOComponent.Instance.CUWorkOrder(WODTO);
        }

        public WorkOrderDTO GetWorkOrderDetails(int WorkOrderID)
        {
            return WOComponent.Instance.GetWorkOrderDetails(WorkOrderID);
        }

        public int CloseWorkOrder(int WorkOrderID, int ModifiedByID, string ModifiedBy, DateTime ModifiedOn,
                                  string VersionNo)
        {
            return CloseWorkOrder(WorkOrderID, ModifiedByID, ModifiedBy, ModifiedOn, VersionNo, &quot;N&quot;, MWDateTimeHelper.MWToday);
        }

        public int ValidateCloseWorkOrder(int WorkOrderID, int ModifiedByID, string ModifiedBy, DateTime ModifiedOn,
                                 string VersionNo)
        {
            return ValidateCloseWorkOrder(WorkOrderID, ModifiedByID, ModifiedBy, ModifiedOn, VersionNo, &quot;N&quot;, MWDateTimeHelper.MWToday);
        }

        public int CloseWorkOrder(int WorkOrderID, int ModifiedByID, string ModifiedBy, DateTime ModifiedOn,
                                  string VersionNo, DateTime? retRelDate)
        {
            return CloseWorkOrder(WorkOrderID, ModifiedByID, ModifiedBy, ModifiedOn, VersionNo, &quot;N&quot;, retRelDate);
        }

        public int CloseWorkOrder(int WorkOrderID, int ModifiedByID, string ModifiedBy, DateTime ModifiedOn,
                                  string VersionNo, string isFromPE)
        {
            return CloseWorkOrder(WorkOrderID, ModifiedByID, ModifiedBy, ModifiedOn, VersionNo, isFromPE, null);
        }

        public int CloseWorkOrder(int WorkOrderID, int ModifiedByID, string ModifiedBy, DateTime ModifiedOn,
                                  string VersionNo, string isFromPE, DateTime? retRelDate)
        {
            return WOComponent.Instance.CloseWorkOrder(WorkOrderID, ModifiedByID, ModifiedBy, ModifiedOn, VersionNo,
                                                       isFromPE, retRelDate);
        }

        public int ValidateCloseWorkOrder(int WorkOrderID, int ModifiedByID, string ModifiedBy, DateTime ModifiedOn,
                                 string VersionNo, string isFromPE, DateTime? retRelDate)
        {
            return WOComponent.Instance.ValidateCloseWorkOrder(WorkOrderID, ModifiedByID, ModifiedBy, ModifiedOn, VersionNo,
                                                       isFromPE, retRelDate);
        }

        public bool CreateWorkOrderActivity(int AID, int WorkOrderID, string ActivityName, string Unit, Decimal UnitCost,
                                            Decimal Quantity, Decimal Amount, string ItemXML, Decimal? Number,
                                            Decimal? Length, Decimal? Width, Decimal? Height, int Output)
        {
            return WOComponent.Instance.CreateWorkOrderActivity(AID, WorkOrderID, ActivityName, Unit, UnitCost, Quantity,
                                                                Amount, ItemXML, Number, Length, Width, Height, Output);
        }

        public DataSet GetQuotations(int WorkOrderID)
        {
            return WOComponent.Instance.GetQuotations(WorkOrderID);
        }

        public DataSet GetActivities(int WorkOrderID)
        {
            return WOComponent.Instance.GetActivities(WorkOrderID);
        }


        public DataSet GetQuotation(int QuotationID, int WorkOrderID)
        {
            return WOComponent.Instance.GetQuotation(QuotationID, WorkOrderID);
        }

        public DataSet GetActivity(int ActivityID, int WorkOrderID)
        {
            return WOComponent.Instance.GetActivity(ActivityID, WorkOrderID);
        }

        public MemoryStream GetPDF(int woId, int contID, string path, string logoFilePath, String REQ)
        {
            DataTable dtTemp;

            dtTemp = GetWOMainReport(contID, woId);

            var pdf = new PdfExport();
            var rpt = new DataDynamics.ActiveReports.ActiveReport();

            var subRptItems = new DataDynamics.ActiveReports.ActiveReport();
            XmlReader XReader = XmlReader.Create(System.Web.HttpContext.Current.Server.MapPath(&quot;.&quot;) + &quot;\\WOItems.rpx&quot;);
            subRptItems.LoadLayout(XReader);

            var strm = new MemoryStream();
            XmlReader XmReader = XmlReader.Create(System.Web.HttpContext.Current.Server.MapPath(&quot;.&quot;) + &quot;\\WOReport.rpx&quot;);
            rpt.LoadLayout(XmReader);

            rpt.PageSettings.Margins.Top = 0.5F;
            rpt.PageSettings.Margins.Left = 0.5F;
            rpt.PageSettings.Margins.Bottom = 0.5F;
            rpt.PageSettings.Margins.Right = 0.5F;
            //rpt.PrintWidth = 7.5F;

            // Assiging the datasource to the mainreport
            rpt.DataSource = dtTemp;

            // Assiging the datasource to the subreport
            DataTable dtTemp1 = GetWOSubReport(woId, contID);

            subRptItems.DataSource = dtTemp1;

            //DataDynamics.ActiveReports.DataSources.OleDBDataSource ds = ((DataDynamics.ActiveReports.DataSources.OleDBDataSource)(rpt.DataSource));
            //ds.ConnectionString = &quot;PROVIDER=OraOLEDB.Oracle;&quot; + WebConfigurationManager.ConnectionStrings[Constants.AMP3_CONNECTIONSTRING].ConnectionString;

            if (File.Exists(logoFilePath))
            {
                Image logoImage = new Bitmap(logoFilePath);
                var pic = ((DataDynamics.ActiveReports.Picture) rpt.Sections[&quot;ReportHeader&quot;].Controls[&quot;rptLogo&quot;]);
                pic.Image = logoImage;
                if (logoImage.Height &gt; pic.Height*100 ||
                    logoImage.Width &gt; pic.Width*100)

                    pic.SizeMode = DataDynamics.ActiveReports.SizeModes.Zoom;
            }


            // Applying the localization to both the reports
            string currency_up = LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) +
                                 AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;
            string currency_amount = LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) +
                                     AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
            string payItemNo = LocalizationManager.GetString(KeyConstants.LOC_PAY_ITEM_NO_ABBR);

            // Main Report
            ((TextBox) rpt.Sections[&quot;GrpHeader&quot;].Controls[&quot;TextBox&quot;]).OutputFormat = currency_amount;
            ((Label) rpt.Sections[&quot;GrpHeader&quot;].Controls[&quot;Label7&quot;]).Text = payItemNo;

            // Sub Report
            ((TextBox) subRptItems.Sections[&quot;Detail&quot;].Controls[&quot;TextBox5&quot;]).OutputFormat = currency_up;
            ((TextBox) subRptItems.Sections[&quot;Detail&quot;].Controls[&quot;TextBox6&quot;]).OutputFormat = currency_amount;
            // End of localization to both the reports

            ((DataDynamics.ActiveReports.SubReport) rpt.Sections[&quot;GrpHeader&quot;].Controls[&quot;subRptItems&quot;]).Report =
                subRptItems;

            //subRptItems.Parameters[&quot;@WOID&quot;].Value = rpt.Parameters[&quot;@WOID&quot;].Value = woId.ToString();
            //rpt.Parameters[&quot;@ContractID&quot;].Value = contID.ToString();
            subRptItems.ShowParameterUI = rpt.ShowParameterUI = false;

            //rpt.DataSource = ds;
            //((DataDynamics.ActiveReports.DataSources.OleDBDataSource)subRptItems.DataSource).ConnectionString = ds.ConnectionString;
            rpt.Run();

            pdf.Export(rpt.Document, strm);
            return strm;
        }


        //public DataTable GetWOOrContractor(int ContractID, int? WorkOrderID, int? ContractorID)
        //{
        //    return ComponentHelper.Instance.ExecuteDataSet(WOStoredProcedure.usp_WORKORDGetWOOrContractor, null, new object[] { ContractID, WorkOrderID, ContractorID, 0 }).Tables[0];
        //}

        //public DataTable GetWOOrContractorForRAB(int ContractID, int? WorkOrderID, int? ContractorID)
        //{
        //    return ComponentHelper.Instance.ExecuteDataSet(WOStoredProcedure.usp_WORKORDGetWOOrContractor, null, new object[] { ContractID, WorkOrderID, ContractorID, 1 }).Tables[0];
        //}

        public DataTable GetWOSubReport(int workOrderID, int contID)
        {
            DataSet result = ComponentHelper.Instance.ExecuteDataSet(ACTIWOStoredProcedure.usp_ACTIWOReports, null,
                                                                     contID, workOrderID, &quot;S&quot;);
            return result.Tables[0];
        }

        public DataTable GetWOSubReportforActivities(int workOrderID, int contID)
        {
            DataSet result = ComponentHelper.Instance.ExecuteDataSet(ACTIWOStoredProcedure.usp_ACTIWOReports, null,
                                                                     contID, workOrderID, &quot;A&quot;);
            return result.Tables[0];
        }

        //public DataTable GetWOActivities(int workOrderID)
        //{
        //    return ComponentHelper.Instance.ExecuteDataSet(ACTIWOStoredProcedure.usp_ACTIWOGetActivities, null, workOrderID).Tables[0];
        //}

        public DataTable GetWOMainReport(int contID, int workOrderID)
        {
            DataSet result = ComponentHelper.Instance.ExecuteDataSet(ACTIWOStoredProcedure.usp_ACTIWOReports, null,
                                                                     contID, workOrderID, &quot;M&quot;);
            return result.Tables[0];
        }

        public DataSet GetWOPostingList(int WOID, int startRowIdx, int maxRows, string sortOrder, string filter,
                                        string getCount)
        {
            return ComponentHelper.Instance.ExecuteDataSet(ACTIWOStoredProcedure.usp_ACTIWOPostings, null, WOID,
                                                           startRowIdx, maxRows, sortOrder, filter, getCount);
        }

        public int GetBaseWorkOrderID(int WorkOrderID)
        {
            return
                Convert.ToInt32(
                    ComponentHelper.Instance.ExecuteDataSet(WOStoredProcedure.usp_WORKORDGetBaseOrLatestWOID, null,
                                                            WorkOrderID, null, null).Tables[0].Rows[0][&quot;BaseWOID&quot;]);
        }

        public int GetBaseWorkOrderID(string workOrderNo, int ContractID)
        {
            return
                Convert.ToInt32(
                    ComponentHelper.Instance.ExecuteDataSet(WOStoredProcedure.usp_WORKORDGetBaseOrLatestWOID, null, null,
                                                            workOrderNo, ContractID).Tables[0].Rows[0][&quot;BaseWOID&quot;]);
        }

        public int GetLatestWorkOrderID(int WorkOrderID)
        {
            return
                Convert.ToInt32(
                    ComponentHelper.Instance.ExecuteDataSet(WOStoredProcedure.usp_WORKORDGetBaseOrLatestWOID, null,
                                                            WorkOrderID, null, null).Tables[1].Rows[0][&quot;LatestWOID&quot;]);
        }

        public int GetLatestWorkOrderID(string workOrderNo, int ContractID)
        {
            return
                Convert.ToInt32(
                    ComponentHelper.Instance.ExecuteDataSet(WOStoredProcedure.usp_WORKORDGetBaseOrLatestWOID, null, null,
                                                            workOrderNo, ContractID).Tables[1].Rows[0][&quot;LatestWOID&quot;]);
        }

        public int CreateAWOPosting(int WOPostingID, int WOID, int DWRID, DateTime PostedDate, string Remarks,
                                    Decimal Amount, string PostingXml, int UID, string UserName)
        {
            return WOComponent.Instance.CreateAWOPosting(WOPostingID, WOID, DWRID, PostedDate, Remarks, Amount,
                                                         PostingXml, UID, UserName);
        }

        public DataSet GetWOPosting(int WOPostingID, int WOID, int DWRID)
        {
            return WOComponent.Instance.GetWOPosting(WOPostingID, WOID, DWRID);
        }

        public DataSet GetItemPostingsByWOPostingID(string WOPostingIDList)
        {
            return WOComponent.Instance.GetItemPostingsByWOPostingID(WOPostingIDList);
        }

        internal DataTable GetBOQActivities(int ContractID)
        {
            return
                ComponentHelper.Instance.ExecuteDataSet(ACTIWOStoredProcedure.usp_ACTIGetBOQActivities, null,
                                                        new object[] {ContractID}).Tables[0];
        }

        internal DataTable GetBOQsForActivity(int ContractID, string ActivityName, int? ItemID)
        {
            return
                ComponentHelper.Instance.ExecuteDataSet(ACTIWOStoredProcedure.usp_ACTIGetBOQsForActivity, null,
                                                        new object[] {ContractID, ActivityName, ItemID}).Tables[0];
        }

        internal bool CreateWorkOrderQuotations(int QID, int WorkOrderID, int ContractorID, string Contractor,
                                                DateTime Date, string quotNotes, Decimal TotalAmount, int Status,
                                                string ItemXML, int Output)
        {
            return WOComponent.Instance.CreateWorkOrderQuotations(QID, WorkOrderID, ContractorID, Contractor, Date,
                                                                  quotNotes, TotalAmount, Status, ItemXML, Output);
        }

        internal int DeleteActivities(string ActivityIDList)
        {
            return WOComponent.Instance.DeleteActivities(ActivityIDList);
        }

        internal int SetQuotationStatus(string QuotationIDList, int Status)
        {
            return WOComponent.Instance.SetQuotationStatus(QuotationIDList, Status);
        }

        public string UpdateActivityPostingStatus(string multipostingID, int destStatus, bool isDWR, int userID)
        {
            var retDict = new Dictionary&lt;string, object&gt;();
            ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                ACTIWOStoredProcedure.usp_ACTIWOUpdatePostStatus, retDict, multipostingID, destStatus, isDWR, userID);

            var ErrorMsgAndIDs = new StringBuilder();


            if (retDict.ContainsKey(&quot;ErrMessage&quot;) &amp;&amp; !String.IsNullOrEmpty(retDict[&quot;ErrMessage&quot;].ToString2()))
            {
                ErrorMsgAndIDs.Append(&quot;@&quot;); ErrorMsgAndIDs.Append(retDict[&quot;ErrMessage&quot;].ToString2());
            }
            if (retDict.ContainsKey(&quot;DeletedIds&quot;) &amp;&amp; !String.IsNullOrEmpty(retDict[&quot;DeletedIds&quot;].ToString2()))
            {
                ErrorMsgAndIDs.Append(&quot;@&quot;); ErrorMsgAndIDs.Append(ErrorMsgAndIDs + retDict[&quot;DeletedIds&quot;].ToString2());
            }

            return ErrorMsgAndIDs.ToString2();
        }

        public bool IsWorkFlowInProgress(int workOrderId)
        {
            bool isWFInPRogress = false;
            if (HttpContext.Current != null &amp;&amp; HttpContext.Current.Handler != null)
            {
                var currPage = (Page) HttpContext.Current.Handler;
                if (File.Exists(currPage.Server.MapPath(@&quot;~/Modules/WORKFLW/WORKORD.xml&quot;)))
                {
                    var item = new WFitem(workOrderId, &quot;WORKORD&quot;, null, null);
                    DataTable dt = new WorkflowFactory(null, null).GetWorkflowUsersHistory(item.Id, workOrderId,
                                                                                           &quot;WORKORD&quot;);
                    int stageCompleted = dt.Select(&quot;Completed=true&quot;).Length;
                    if (stageCompleted &gt; 0)
                        isWFInPRogress = true;
                }
            }

            return isWFInPRogress;
        }

        internal DataSet ApproveWorkOrder(int WorkOrderId, DateTime ApprovedOn, int ApprovedBy, bool IsApprove,
                                          string WorkOrderType)
        {
            return WOComponent.Instance.ApproveWorkOrder(WorkOrderId, ApprovedOn, ApprovedBy, IsApprove, WorkOrderType);
        }

        public DataSet ValidateEquipmentHireOrderVersion(string EquipmentID, int ActualEquipmentID, decimal Quantity,
                                                         string ModeType)
        {
            return WOComponent.Instance.ValidateEquipmentHireOrderVersion(EquipmentID, ActualEquipmentID, Quantity,
                                                                          ModeType);
        }

        /// &lt;summary&gt;
        /// Returns the Prepayment Recovery rules based on module and Instanceid
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;ModuleID&quot;&gt;LIBRARY for library,CONTMGT for settings and WORKORD for work order&lt;/param&gt;
        /// &lt;param name=&quot;InstanceId&quot;&gt;0 for library, ContractID for contract settings and WOID for Workorder&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public DataSet GetPrepaymentRecoveryRules(string ModuleID, int InstanceId)
        {
            return WOComponent.Instance.GetPrepaymentRecoveryRules(ModuleID, InstanceId);
        }

        /// &lt;summary&gt;
        /// Returns the retention rules based on module and Instanceid
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;ModuleID&quot;&gt;LIBRARY for library,CONTMGT for settings and WORKORD for work order&lt;/param&gt;
        /// &lt;param name=&quot;InstanceId&quot;&gt;0 for library, ContractID for contract settings and WOID for Workorder&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public DataSet GetRetentionRules(string ModuleID, int InstanceId)
        {
            return WOComponent.Instance.GetRetentionRules(ModuleID, InstanceId);
        }

        public DataSet GetMinMaxSubmitionDates(string AXCompany, int InstanceID, string ModuleID, string TableName,
                                               string InstanceIDColumn, string CreateDateColumn, bool IsModuleIdReq)
        {
            return WOComponent.Instance.GetMinMaxSubmitionDates(AXCompany, InstanceID, ModuleID, TableName,
                                                                InstanceIDColumn, CreateDateColumn, false);
        }

        public DateTime GetWOStartDate(int workOrderId)
        {
            return WOComponent.Instance.GetWOStartDate(workOrderId);
        }

        public DataTable GetAXPurchaseOrderJournals(string company, string workOrderID, string contractId)
        {
            DataTable dtTemp = new BrixDataTable();
            string filterCriteria = &quot;&quot;;
            DataTable dtPurchId = IntegrationConnectorManager.Instance.GetERPObjectMapInfo(workOrderID,
                                                                                           AMP3Object.WORKORD,
                                                                                           contractId,
                                                                                           AMP3Object.CONTMGT,
                                                                                           RegisteredEIS.AX);
            if (dtPurchId.Rows.Count &gt; 0)
            {
                filterCriteria = &quot;&lt;XMLRoot&gt;&lt;PurchId type=&#39;txt&#39;&gt;&quot; + dtPurchId.Rows[0][&quot;ERPId&quot;] + &quot;&lt;/PurchId&gt;&lt;/XMLRoot&gt;&quot;;
            }
            else
                return new DataTable();

            var filter = new ConnectionFilter(filterCriteria, null, null, null, null);

            var dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
            dictAdditionalInfo.Add(RegisteredEIS.AX,
                                   new EISAdditionalInfo(RegisteredEIS.AX).AddInfo(&quot;AXCompany&quot;, company));

            var ConnectorParameters =
                new ConnectorParameters(dictAdditionalInfo, MethodBase.GetCurrentMethod(),
                                        AMP3ObjectType.Unknown, filter, null);
            DataSet ds = new BrixDataSet();
            int count = 0;
            if (IntegrationConnectorManager.HandleIntegration(ConnectorParameters, ref count, ref ds, true))
            {
                if (ds.Tables.Count &gt; 0)
                    dtTemp = ds.Tables[0];
            }

            return dtTemp;
        }

        public DataTable GetTaxes(string company, string purchID, string purchOrderJournalId, string contractId)
        {
            DataTable dtTemp = new BrixDataTable();
            string filterCriteria = &quot;&quot;;
            DataTable dtProj = IntegrationConnectorManager.Instance.GetERPObjectMapInfo(contractId, AMP3Object.CONTMGT,
                                                                                        null, AMP3Object.UNKNOWN,
                                                                                        RegisteredEIS.AX);
            if (dtProj.Rows.Count &gt; 0)
            {
                filterCriteria = &quot;&lt;XMLRoot&gt;&lt;POJournalId type=&#39;txt&#39;&gt;&quot; + purchOrderJournalId + &quot;&lt;/POJournalId&gt;&lt;/XMLRoot&gt;&quot;;
            }
            var filter = new ConnectionFilter(filterCriteria, null, null, null, null);

            var dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
            dictAdditionalInfo.Add(RegisteredEIS.AX,
                                   new EISAdditionalInfo(RegisteredEIS.AX).AddInfo(&quot;AXCompany&quot;, company));
            var ConnectorParameters =
                new ConnectorParameters(dictAdditionalInfo, MethodBase.GetCurrentMethod(),
                                        AMP3ObjectType.Unknown, filter, null);
            DataSet ds = new BrixDataSet();
            int count = 0;
            if (IntegrationConnectorManager.HandleIntegration(ConnectorParameters, ref count, ref ds, true))
            {
                if (ds.Tables.Count &gt; 0)
                    dtTemp = ds.Tables[0];
            }

            return dtTemp;
        }
    }

    [Context(Name = &quot;WORKORD&quot;)]
    public class COBreadCrumb : ContractBreadCrumb
    {
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[33,9,33,81,0],[34,9,34,62,0],[35,9,35,32,0],[35,33,35,34,0],[35,35,35,36,0],[39,13,39,14,0],[40,17,40,30,0],[41,17,41,18,0],[42,21,42,39,0],[42,40,42,89,0],[43,21,43,82,0],[44,21,44,60,0],[45,33,45,81,0],[47,21,47,50,0],[49,13,49,14,0],[56,9,56,10,0],[57,13,57,47,0],[59,13,59,60,0],[60,13,60,60,0],[61,13,61,52,0],[62,13,62,33,0],[64,13,66,71,0],[67,13,67,29,0],[68,13,68,96,0],[69,17,69,86,0],[70,13,70,88,0],[71,17,71,67,0],[73,13,73,32,0],[74,9,74,10,0],[77,9,77,10,0],[78,13,78,47,0],[80,13,80,60,0],[81,13,81,60,0],[82,13,82,52,0],[83,13,83,33,0],[85,13,87,71,0],[88,13,88,29,0],[89,13,89,96,0],[90,17,90,86,0],[91,13,91,88,0],[92,17,92,67,0],[94,13,94,32,0],[95,9,95,10,0],[102,9,102,10,0],[103,13,103,33,0],[104,9,104,10,0],[107,9,107,10,0],[108,13,108,47,0],[110,13,110,60,0],[111,13,111,60,0],[112,13,112,52,0],[113,13,113,33,0],[115,13,116,86,0],[117,13,117,29,0],[118,13,118,96,0],[119,17,119,86,0],[120,13,120,88,0],[121,17,121,67,0],[123,13,123,32,0],[124,9,124,10,0],[131,9,131,10,0],[133,13,133,14,0],[134,17,134,64,0],[135,17,135,18,0],[136,21,136,57,0],[137,26,137,37,0],[137,39,137,68,0],[137,70,137,78,0],[138,21,138,22,0],[139,25,140,119,0],[141,25,141,70,0],[142,25,142,48,0],[143,21,143,22,0],[144,21,144,53,0],[145,21,145,50,0],[146,25,146,35,0],[148,25,148,49,0],[150,13,150,14,0],[151,13,151,30,0],[152,13,152,14,0],[153,17,153,27,0],[155,13,155,23,0],[156,9,156,10,0],[163,9,163,10,0],[164,13,164,89,0],[165,9,165,10,0],[172,9,172,10,0],[173,13,173,33,0],[174,9,174,10,0],[177,9,177,10,0],[178,13,178,47,0],[180,13,180,60,0],[181,13,181,60,0],[182,13,182,52,0],[183,13,183,33,0],[185,13,186,93,0],[187,13,187,29,0],[188,13,188,96,0],[189,17,189,86,0],[190,13,190,88,0],[191,17,191,67,0],[193,13,193,32,0],[194,9,194,10,0],[199,9,199,10,0],[200,13,200,65,0],[201,9,201,10,0],[204,9,204,10,0],[205,13,205,61,0],[206,9,206,10,0],[209,9,209,10,0],[210,13,210,65,0],[211,9,211,10,0],[213,9,213,10,0],[214,13,214,100,0],[215,9,215,10,0],[218,9,218,10,0],[219,13,219,69,0],[220,9,220,10,0],[223,9,223,10,0],[224,13,224,83,0],[225,9,225,10,0],[228,9,228,10,0],[229,13,229,105,0],[230,9,230,10,0],[233,9,233,10,0],[234,13,234,114,0],[235,9,235,10,0],[238,9,238,10,0],[239,13,239,98,0],[240,9,240,10,0],[244,9,244,10,0],[245,13,246,68,0],[247,9,247,10,0],[251,9,251,10,0],[252,13,252,115,0],[253,9,253,10,0],[256,9,256,10,0],[257,13,257,79,0],[258,9,258,10,0],[262,9,262,10,0],[263,13,263,128,0],[264,9,264,10,0],[268,9,268,10,0],[269,13,269,136,0],[270,9,270,10,0],[274,9,274,10,0],[275,13,275,114,0],[276,9,276,10,0],[280,9,280,10,0],[281,13,281,113,0],[282,9,282,10,0],[286,9,286,10,0],[287,13,288,83,0],[289,9,289,10,0],[293,9,293,10,0],[294,13,295,83,0],[296,9,296,10,0],[299,9,299,10,0],[300,13,300,95,0],[301,9,301,10,0],[305,9,305,10,0],[306,13,307,77,0],[308,9,308,10,0],[311,9,311,10,0],[312,13,312,88,0],[313,9,313,10,0],[316,9,316,10,0],[317,13,317,109,0],[318,9,318,10,0],[331,9,331,10,0],[332,13,332,102,0],[333,9,333,10,0],[338,9,338,10,0],[339,13,340,121,0],[341,9,341,10,0],[344,9,344,10,0],[345,13,345,82,0],[346,9,346,10,0],[349,9,349,10,0],[350,13,350,90,0],[351,9,351,10,0],[354,9,354,10,0],[355,13,355,101,0],[356,9,356,10,0],[359,9,359,10,0],[360,13,360,73,0],[361,9,361,10,0],[364,9,364,10,0],[365,13,365,85,0],[366,9,366,10,0],[369,9,369,10,0],[370,13,370,79,0],[371,9,371,10,0],[374,9,374,10,0],[375,13,375,86,0],[376,9,376,10,0],[379,9,379,10,0],[380,13,380,84,0],[381,9,381,10,0],[384,9,384,10,0],[387,13,387,52,0],[389,13,389,39,0],[390,13,390,69,0],[392,13,392,77,0],[393,13,393,120,0],[394,13,394,45,0],[396,13,396,43,0],[397,13,397,122,0],[398,13,398,38,0],[400,13,400,49,0],[401,13,401,50,0],[402,13,402,52,0],[403,13,403,51,0],[407,13,407,37,0],[410,13,410,62,0],[412,13,412,46,0],[417,13,417,43,0],[418,13,418,14,0],[419,17,419,60,0],[420,17,420,115,0],[421,17,421,39,0],[422,17,423,53,0],[425,21,425,78,0],[426,13,426,14,0],[430,13,431,85,0],[432,13,433,85,0],[434,13,434,97,0],[437,13,437,102,0],[438,13,438,85,0],[441,13,441,104,0],[442,13,442,108,0],[445,13,446,29,0],[450,13,450,71,0],[454,13,454,23,0],[456,13,456,44,0],[457,13,457,25,0],[458,9,458,10,0],[461,9,461,10,0],[462,13,465,64,0],[466,9,466,10,0],[469,9,469,10,0],[470,13,473,64,0],[474,9,474,10,0],[477,9,477,10,0],[478,13,478,80,0],[479,9,479,10,0],[482,9,482,10,0],[483,13,483,68,0],[484,9,484,10,0],[487,9,487,10,0],[488,13,489,88,0],[490,13,490,37,0],[491,9,491,10,0],[494,9,494,10,0],[495,13,496,88,0],[497,13,497,37,0],[498,9,498,10,0],[501,9,501,10,0],[502,13,503,90,0],[504,13,504,37,0],[505,9,505,10,0],[508,9,508,10,0],[509,13,509,88,0],[510,9,510,10,0],[513,9,513,10,0],[514,13,514,88,0],[515,9,515,10,0],[518,9,518,10,0],[519,13,519,49,0],[522,13,524,106,0],[525,13,525,55,0],[526,13,526,14,0],[527,17,527,72,0],[528,13,528,14,0],[531,17,531,24,0],[536,13,536,77,0],[537,13,537,85,0],[538,13,538,89,0],[539,13,539,73,0],[540,13,540,62,0],[541,13,541,110,0],[542,13,543,105,0],[544,13,544,38,0],[545,13,545,40,0],[546,13,546,58,0],[547,13,547,42,0],[548,13,550,108,0],[551,13,551,40,0],[553,17,553,79,0],[554,13,554,35,0],[555,13,555,27,0],[556,13,556,111,0],[557,13,557,14,0],[558,17,558,24,0],[560,9,560,10,0],[569,9,569,10,0],[570,13,570,91,0],[571,9,571,10,0],[574,9,574,10,0],[575,13,575,80,0],[576,9,576,10,0],[579,9,579,10,0],[580,13,580,89,0],[581,9,581,10,0],[584,9,584,10,0],[585,13,585,99,0],[586,9,586,10,0],[589,9,589,10,0],[590,13,590,67,0],[591,9,591,10,0],[594,9,594,10,0],[595,13,595,85,0],[596,9,596,10,0],[599,9,599,10,0],[600,13,600,67,0],[601,9,601,10,0],[606,9,606,76,1],[607,9,607,62,1],[608,9,608,28,1],[608,29,608,30,1],[608,31,608,32,1],[612,13,612,14,1],[613,17,613,30,1],[614,17,614,18,1],[615,21,615,39,1],[615,40,615,84,1],[616,21,616,82,1],[617,21,617,60,1],[618,33,618,76,1],[620,21,620,50,1],[622,13,622,14,1],[626,9,626,10,0],[627,13,627,60,0],[628,9,628,10,0],[631,9,631,10,0],[632,13,632,74,0],[633,9,633,10,0],[637,9,637,10,0],[638,13,638,128,0],[639,9,639,10,0],[643,9,643,10,0],[644,13,644,136,0],[645,9,645,10,0],[649,9,649,10,0],[650,13,650,114,0],[651,9,651,10,0],[655,9,655,10,0],[656,13,656,113,0],[657,9,657,10,0],[661,9,661,10,0],[662,13,663,78,0],[664,9,664,10,0],[668,9,668,10,0],[669,13,670,78,0],[671,9,671,10,0],[676,9,676,10,0],[677,13,678,121,0],[679,9,679,10,0],[682,9,682,10,0],[683,13,683,68,0],[684,9,684,10,0],[687,9,687,10,0],[688,13,688,68,0],[689,9,689,10,0],[693,9,693,10,0],[694,13,694,80,0],[695,9,695,10,0],[698,9,698,10,0],[699,13,699,78,0],[700,9,700,10,0],[703,9,703,10,0],[706,13,706,52,0],[708,13,708,39,0],[709,13,709,69,0],[711,13,711,77,0],[712,13,712,120,0],[713,13,713,45,0],[715,13,715,43,0],[716,13,716,122,0],[717,13,717,38,0],[719,13,719,49,0],[720,13,720,50,0],[721,13,721,52,0],[722,13,722,51,0],[726,13,726,37,0],[729,13,729,62,0],[731,13,731,46,0],[736,13,736,43,0],[737,13,737,14,0],[738,17,738,60,0],[739,17,739,115,0],[740,17,740,39,0],[741,17,742,53,0],[744,21,744,78,0],[745,13,745,14,0],[749,13,750,85,0],[751,13,752,85,0],[753,13,753,97,0],[756,13,756,102,0],[757,13,757,85,0],[760,13,760,104,0],[761,13,761,108,0],[764,13,765,29,0],[769,13,769,71,0],[773,13,773,23,0],[775,13,775,44,0],[776,13,776,25,0],[777,9,777,10,0],[791,9,791,10,0],[792,13,793,96,0],[794,13,794,37,0],[795,9,795,10,0],[798,9,798,10,0],[799,13,800,96,0],[801,13,801,37,0],[802,9,802,10,0],[810,9,810,10,0],[811,13,812,96,0],[813,13,813,37,0],[814,9,814,10,0],[818,9,818,10,0],[819,13,820,111,0],[821,9,821,10,0],[824,9,824,10,0],[825,13,828,117,0],[829,9,829,10,0],[832,9,832,10,0],[833,13,836,117,0],[837,9,837,10,0],[840,9,840,10,0],[841,13,844,119,0],[845,9,845,10,0],[848,9,848,10,0],[849,13,852,119,0],[853,9,853,10,0],[857,9,857,10,0],[858,13,859,85,0],[860,9,860,10,0],[863,9,863,10,0],[864,13,864,80,0],[865,9,865,10,0],[868,9,868,10,0],[869,13,869,87,0],[870,9,870,10,0],[873,9,873,10,0],[874,13,876,94,0],[877,9,877,10,0],[880,9,880,10,0],[881,13,883,116,0],[884,9,884,10,0],[889,9,889,10,0],[890,13,891,116,0],[892,9,892,10,0],[895,9,895,10,0],[896,13,896,74,0],[897,9,897,10,0],[900,9,900,10,0],[901,13,901,85,0],[902,9,902,10,0],[905,9,905,10,0],[906,13,906,60,0],[907,13,908,119,0],[910,13,910,54,0],[913,13,913,111,0],[914,13,914,14,0],[915,17,915,44,0],[915,45,915,102,0],[916,13,916,14,0],[917,13,917,111,0],[918,13,918,14,0],[919,17,919,44,0],[919,45,919,119,0],[920,13,920,14,0],[922,13,922,47,0],[923,9,923,10,0],[926,9,926,10,0],[927,13,927,41,0],[928,13,928,84,0],[929,13,929,14,0],[930,17,930,67,0],[931,17,931,92,0],[932,17,932,18,0],[933,21,933,79,0],[934,21,935,103,0],[936,21,936,77,0],[937,21,937,44,0],[938,25,938,47,0],[939,17,939,18,0],[940,13,940,14,0],[942,13,942,35,0],[943,9,943,10,0],[947,9,947,10,0],[948,13,948,121,0],[949,9,949,10,0],[953,9,953,10,0],[954,13,955,85,0],[956,9,956,10,0],[965,9,965,10,1],[966,13,966,90,1],[967,9,967,10,1],[976,9,976,10,0],[977,13,977,81,0],[978,9,978,10,0],[982,9,982,10,0],[983,13,984,108,0],[985,9,985,10,0],[988,9,988,10,0],[989,13,989,69,0],[990,9,990,10,0],[993,9,993,10,0],[994,13,994,52,0],[995,13,995,40,0],[996,13,1000,110,0],[1001,13,1001,42,0],[1002,13,1002,14,0],[1003,17,1003,120,0],[1004,13,1004,14,0],[1006,17,1006,40,0],[1008,13,1008,87,0],[1010,13,1010,89,0],[1011,13,1012,107,0],[1014,13,1016,79,0],[1017,13,1017,44,0],[1018,13,1018,27,0],[1019,13,1019,109,0],[1020,13,1020,14,0],[1021,17,1021,41,0],[1022,21,1022,43,0],[1023,13,1023,14,0],[1025,13,1025,27,0],[1026,9,1026,10,0],[1029,9,1029,10,0],[1030,13,1030,52,0],[1031,13,1031,40,0],[1032,13,1034,107,0],[1035,13,1035,39,0],[1036,13,1036,14,0],[1037,17,1037,121,0],[1038,13,1038,14,0],[1039,13,1039,87,0],[1041,13,1041,89,0],[1042,13,1043,107,0],[1044,13,1046,79,0],[1047,13,1047,44,0],[1048,13,1048,27,0],[1049,13,1049,109,0],[1050,13,1050,14,0],[1051,17,1051,41,0],[1052,21,1052,43,0],[1053,13,1053,14,0],[1055,13,1055,27,0],[1056,9,1056,10,0]]);
    </script>
  </body>
</html>