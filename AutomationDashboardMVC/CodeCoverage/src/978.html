<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Business Layer\Utility\MWGrid.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Drawing;
using System.Linq;
using Aurigo.Brix.Platform.BusinessLayer.AbstractModels;
using Telerik.Web.UI;
using System.Text;
using System.Collections;
using Aurigo.Brix.Platform.CoreUtilities.Utility;

namespace Aurigo.Brix.Platform.BusinessLayer.Utility
{
    public static partial class MWGrid
    {
        private const string EXCEL_FILE_TYPE = &quot;.xls&quot;;
        static string spaceReplacer = &quot;___&quot;;
        static string space = &quot; &quot;;
        static string percentReplacer = &quot;---&quot;;

        public static string GetCellValue&lt;T&gt;(T row, string columnName)
        {
            string value = null;
            if (row is GridDataItem)
            {
                GridDataItem dataItem = (row as GridDataItem);
                GridColumn column = dataItem.OwnerTableView.GetColumnSafe(columnName);
                if (column != null)
                {
                    switch (column.DataType.FullName)
                    {
                        case &quot;System.Boolean&quot;:
                            System.Web.UI.WebControls.CheckBox cb =
                                dataItem[columnName].Controls.OfType&lt;System.Web.UI.WebControls.CheckBox&gt;()
                                    .FirstOrDefault();
                            if (cb != null)
                            {
                                value = cb.Checked.ToString();
                            }
                            break;
                        default:
                            value = dataItem[columnName].Text;
                            break;
                    }
                }
            }
            return value;
        }

        //private static string AddExtensionForFile(string sheetName)
        //{
        //    return sheetName + EXCEL_FILE_TYPE;
        // }
        public static string GetCellValueForSelectedRow&lt;T&gt;(T grid, string columnName)
        {
            string value = null;
            if (grid is RadGrid)
            {
                GridDataItem[] dataItems = (grid as RadGrid).MasterTableView.GetSelectedItems();
                if (dataItems != null &amp;&amp; dataItems.Count() &gt; 0 &amp;&amp;
                    (grid as RadGrid).MasterTableView.GetColumnSafe(columnName) != null)
                {
                    value = dataItems[0][columnName].Text;
                }
            }
            return value;
        }

        public static object GetSelectedRow&lt;T&gt;(T grid)
        {
            GridDataItem row = null;
            if (grid is RadGrid)
            {
                GridDataItem[] dataItems = (grid as RadGrid).MasterTableView.GetSelectedItems();
                if (dataItems != null &amp;&amp; dataItems.Count() &gt; 0)
                {
                    row = dataItems[0];
                }
            }
            return row;
        }

        public static List&lt;object&gt; GetSelectedRows(object grid)
        {
            List&lt;object&gt; rows = new List&lt;object&gt;();
            if (grid is RadGrid)
            {
                GridDataItem[] dataItems = (grid as RadGrid).MasterTableView.GetSelectedItems();
                if (dataItems != null &amp;&amp; dataItems.Count() &gt; 0)
                {
                    rows.AddRange(dataItems);
                }
            }
            return rows;
        }

        public static List&lt;object&gt; GetRows&lt;T&gt;(T grid)
        {
            List&lt;object&gt; rows = new List&lt;object&gt;();
            if (grid is RadGrid)
            {
                foreach (GridDataItem row in (grid as RadGrid).MasterTableView.Items)
                {
                    rows.Add(row);
                }
            }
            return rows;
        }

        public static void SetColumnHeaderText&lt;T&gt;(T row, string columnName, string headerText)
        {
            if (row is GridDataItem)
            {
                GridColumn column = (row as GridDataItem).OwnerTableView.GetColumnSafe(columnName);
                if (column != null)
                {
                    column.HeaderText = headerText;
                }
            }
        }

        public static void SetCellValue&lt;T&gt;(T row, string columnName, string value)
        {
            if (row is GridDataItem)
            {
                GridColumn column = (row as GridDataItem).OwnerTableView.GetColumnSafe(columnName);
                if (column != null)
                {
                    (row as GridDataItem)[
                        Aurigo.Brix.Platform.BusinessLayer.Utility.MWGrid.GetGridFriendlyExpression(column.UniqueName)]
                        .Text = value;
                }
            }
        }

        public static bool ColumnExists&lt;T&gt;(T row, params string[] columns)
        {
            bool exist = true;
            if (row is GridDataItem)
            {
                GridDataItem dataItem = (row as GridDataItem);
                exist = (columns.ToList().Where(x =&gt; dataItem.OwnerTableView.GetColumnSafe(x) == null).Count() == 0);
            }
            return exist;
        }

        public static void HideColumn&lt;T&gt;(T grid, params string[] columns)
        {
            if (grid is RadGrid)
            {
                foreach (string column in columns)
                {
                    if ((grid as RadGrid).MasterTableView.GetColumnSafe(column) != null)
                    {
                        (grid as RadGrid).MasterTableView.GetColumnSafe(column).Display = false;
                    }
                }
            }
        }

        public static string GetDelimiterSeperatedSelectedRowCellValueByColumnName&lt;T&gt;(T grid, string columnName,
            char delimiter)
        {
            if (grid is RadGrid)
            {
                string value = &quot;&quot;;
                foreach (GridDataItem dataItem in (grid as RadGrid).MasterTableView.GetSelectedItems())
                {
                    if (dataItem.OwnerTableView.GetColumnSafe(columnName) != null)
                    {
                        value += dataItem[columnName].Text + delimiter;
                    }
                }
                return value.TrimEnd(delimiter);
            }
            return string.Empty;
        }

        public static List&lt;string&gt; GetColumns&lt;T&gt;(T grid)
        {
            List&lt;string&gt; columnList = new List&lt;string&gt;();
            if (grid is RadGrid)
            {
                //foreach (GridColumn column in (grid as RadGrid).MasterTableView.Columns)
                //{
                //    if (Aurigo.Brix.Platform.BusinessLayer.Utility.MWGrid.GetDatabaseFriendlyExpression(column.UniqueName) != &quot;Multi&quot;)
                //        columnList.Add(Aurigo.Brix.Platform.BusinessLayer.Utility.MWGrid.GetDatabaseFriendlyExpression(column.UniqueName));
                //}
                foreach (GridColumn column in (grid as RadGrid).MasterTableView.AutoGeneratedColumns)
                {
                    if (
                        Aurigo.Brix.Platform.BusinessLayer.Utility.MWGrid.GetDatabaseFriendlyExpression(
                            column.UniqueName) != &quot;Multi&quot;)
                        columnList.Add(
                            Aurigo.Brix.Platform.BusinessLayer.Utility.MWGrid.GetDatabaseFriendlyExpression(
                                column.UniqueName));
                }
            }
            return columnList;
        }

        public static void ClearDatasetConstraintsBeforeUpload(DataTable dtValidation)
        {
            foreach (DataColumn dc in dtValidation.Columns)
            {
                //added by venkat to
                dc.Unique = false;
                dc.DataType = typeof(String);
                dc.DefaultValue = null;
                dc.AllowDBNull = true;
            }
        }

        //public static void Export(HttpResponse Response, string WorkBookName, DataSet ds)
        //{
        //    ExcelHelper.ExportToExcel(Response, AddExtensionForFile(WorkBookName), ds);
        //}
        public static void Export(string eventString, ExportSettings.FileFormat fileFormat,
            ExportSettings.DataFormat dataFormat, DataSet ds, string fileName, string sheetName, BrixFormModel xmlModel,
            Dictionary&lt;string, Dictionary&lt;string, string&gt;&gt; formatDetails)
        {
            string WorkBookName = &quot;&quot;;
            if (xmlModel != null)
            {
                WorkBookName = xmlModel.form.GetSheetName(xmlModel.form.ParseDynamicString(sheetName));
            }
            else
            {
                WorkBookName = sheetName;
            }

            foreach (DataTable exDt in ds.Tables)
            {
                if (dataFormat == ExportSettings.DataFormat.Template)
                {
                    exDt.Rows.Add(exDt.NewRow());
                }
                //to remove illegal characters from TableName
                if (xmlModel != null)
                {
                    exDt.TableName = xmlModel.form.GetSheetName(xmlModel.form.ParseDynamicString(exDt.TableName));
                }
                else
                {
                    exDt.TableName = exDt.TableName;
                }
            }

            ds.DataSetName = fileName;
            ExcelExportEntity excelExportEntity = new ExcelExportEntity(ds);
            ExcelHelper.ExportToExcel(eventString, excelExportEntity);
        }

        public static void Export(string eventString, ExportSettings.FileFormat fileFormat,
            ExportSettings.DataFormat dataFormat, DataSet ds, string fileName, string sheetName, BrixFormModel xmlModel,
            Dictionary&lt;string, Dictionary&lt;string, string&gt;&gt; formatDetails, string fileDownloadTokenID = &quot;&quot;, string fileDownloadTokenValue = &quot;&quot;)
        {
            string WorkBookName = &quot;&quot;;
            if (xmlModel != null)
            {
                WorkBookName = xmlModel.form.GetSheetName(xmlModel.form.ParseDynamicString(sheetName));
            }
            else
            {
                WorkBookName = sheetName;
            }

            foreach (DataTable exDt in ds.Tables)
            {
                if (dataFormat == ExportSettings.DataFormat.Template)
                {
                    exDt.Rows.Add(exDt.NewRow());
                }
                //to remove illegal characters from TableName
                if (xmlModel != null)
                {
                    exDt.TableName = xmlModel.form.GetSheetName(xmlModel.form.ParseDynamicString(exDt.TableName));
                }
                else
                {
                    exDt.TableName = exDt.TableName;
                }
            }

            ds.DataSetName = fileName;
            ExcelExportEntity excelExportEntity = new ExcelExportEntity(ds);
            ExcelHelper.ExportToExcel(eventString, excelExportEntity, fileDownloadTokenID, fileDownloadTokenValue);
        }

        public static void Export(ExportSettings.FileFormat fileFormat, ExportSettings.DataFormat dataFormat, DataSet ds,
            string fileName, string sheetName, System.Web.UI.Page page, string errorIndicator)
        {
            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0 &amp;&amp;
                ds.Tables.OfType&lt;DataTable&gt;().Where(x =&gt; x.Rows.Count &gt; 0).ToList().Count &gt; 0)
            {
                if (ds.Tables.Count &lt;= 1)
                {
                    var grid = new RadGrid();
                    grid.ID = &quot;ExportableGrid&quot;;
                    grid.GridLines = System.Web.UI.WebControls.GridLines.Both;
                    grid.ExportSettings.FileName = fileName;
                    grid.ExportSettings.Excel.Format = GridExcelExportFormat.Biff;
                    grid.ExportSettings.ExportOnlyData = true;
                    grid.ExportSettings.HideStructureColumns = true;
                    grid.ExportSettings.IgnorePaging = true;
                    grid.ExportSettings.OpenInNewWindow = true;
                    grid.ExportCellFormatting += (object sender, ExportCellFormattingEventArgs e) =&gt;
                    {
                        if (!string.IsNullOrEmpty(e.Cell.Text) &amp;&amp; e.Cell.Text.Contains(errorIndicator))
                        {
                            e.Cell.BackColor = Color.LightPink;
                        }
                    };
                    grid.MasterTableView.EnableSplitHeaderText = false;
                    grid.DataSource = ds;
                    grid.DataBind();
                    page.Controls.Add(grid);
                    grid.MasterTableView.ExportToExcel();

                    //for (int i = 1; i &lt; bindingTable.Tables.Count; i++)
                    //{
                    //    ExportGridData(bindingTable.Tables[i], bindingTable.Tables[i].TableName, grid);
                    //}
                }
                else
                {
                    //this part is used when there are multiple tables in the dataset
                    foreach (DataTable exDt in ds.Tables)
                    {
                        if (dataFormat == ExportSettings.DataFormat.Template)
                        {
                            exDt.Rows.Add(exDt.NewRow());
                        }
                    }
                    ds.DataSetName = fileName;
                    ExcelExportEntity excelExportEntity = new ExcelExportEntity(ds);
                    ExcelHelper.ExportToExcel(&quot;Error Log&quot;, excelExportEntity);
                }
            }
        }

        public static void SetRowBackColor&lt;T&gt;(T row, Color color)
        {
            if (row is GridDataItem)
            {
                (row as GridDataItem).BackColor = color;
            }
        }

        public static void SetCellBackColor&lt;T&gt;(T source, string columnName, Color color)
        {
            if ((source is GridDataItem) &amp;&amp; (source as GridDataItem).OwnerTableView.GetColumnSafe(columnName) != null)
            {
                (source as GridDataItem)[columnName].BackColor = color;
            }

            if ((source is RadGrid) &amp;&amp; (source as RadGrid).MasterTableView.GetColumnSafe(columnName) != null)
            {
                (source as RadGrid).MasterTableView.GetColumnSafe(columnName).ItemStyle.BackColor = color;
            }
        }

        public static void SetCellProperties&lt;T&gt;(T row, string columnName, params Property[] propertyList)
        {
            if ((row is GridDataItem) &amp;&amp; (row as GridDataItem).OwnerTableView.GetColumnSafe(columnName) != null)
            {
                GridDataItem dataItem = (row as GridDataItem);
                foreach (Property p in propertyList)
                {
                    if (p.HorizontalAlign != System.Web.UI.WebControls.HorizontalAlign.NotSet)
                    {
                        dataItem[columnName].HorizontalAlign = p.HorizontalAlign;
                    }
                    if (p.AllowEditing != AllowEditing.NotSet)
                    {
                        // dataItem[columnName]. = p.HorizontalAlign;
                    }
                }
            }
        }

        public static void SetColumnProperties&lt;T&gt;(T grid, string columnName, params Property[] propertyList)
        {
            if ((grid is RadGrid) &amp;&amp; (grid as RadGrid).MasterTableView.GetColumnSafe(columnName) != null)
            {
                foreach (Property p in propertyList)
                {
                    if (p.HorizontalAlign != System.Web.UI.WebControls.HorizontalAlign.NotSet)
                    {
                        (grid as RadGrid).MasterTableView.GetColumnSafe(columnName).ItemStyle.HorizontalAlign =
                            p.HorizontalAlign;
                    }
                    if (p.AllowEditing != AllowEditing.NotSet)
                    {
                        // 
                    }
                }
            }
        }

        public static void SetHeaderProperties&lt;T&gt;(T grid, string columnName, params Property[] propertyList)
        {
            if ((grid is RadGrid) &amp;&amp; (grid as RadGrid).MasterTableView.GetColumnSafe(columnName) != null)
            {
                foreach (Property p in propertyList)
                {
                    if (p.HorizontalAlign != System.Web.UI.WebControls.HorizontalAlign.NotSet)
                    {
                        (grid as RadGrid).MasterTableView.GetColumnSafe(columnName).HeaderStyle.HorizontalAlign =
                            p.HorizontalAlign;
                    }
                }
            }
        }

        public static List&lt;object&gt; GetRows&lt;T&gt;(T grid, string columnName, string cellValue, Lookup lookup)
        {
            List&lt;object&gt; rows = new List&lt;object&gt;();
            if ((grid is RadGrid) &amp;&amp; (grid as RadGrid).MasterTableView.GetColumnSafe(columnName) != null)
            {
                if (lookup == Lookup.EqualTo)
                {
                    rows = (grid as RadGrid).MasterTableView.Items.OfType&lt;GridDataItem&gt;().ToList().Where(
                        x =&gt;
                            (x[columnName].Text.Equals(cellValue, StringComparison.CurrentCultureIgnoreCase))
                        ).OfType&lt;object&gt;().ToList();
                }
                else if (lookup == Lookup.NotEqualTo)
                {
                    rows = (grid as RadGrid).MasterTableView.Items.OfType&lt;GridDataItem&gt;().ToList().Where(
                        x =&gt;
                            (x[columnName].Text != cellValue)).OfType&lt;object&gt;().ToList();
                }
            }
            return rows;
        }

        public static void SetCellBackgroundImage&lt;T&gt;(T row, string columnName, string imagePath)
        {
            if ((row is GridDataItem) &amp;&amp; (row as GridDataItem).OwnerTableView.GetColumnSafe(columnName) != null)
            {
                (row as GridDataItem)[columnName].Style.Add(&quot;background&quot;, &quot;center center url(&#39;&quot; + imagePath + &quot;&#39;)&quot;);
            }
        }

        public static void SetCellStyle&lt;T&gt;(T row, string columnName, string key, string value)
        {
            if ((row is GridDataItem) &amp;&amp; (row as GridDataItem).OwnerTableView.GetColumnSafe(columnName) != null)
            {
                (row as GridDataItem)[columnName].Style.Add(key, value);
            }
        }

        public static void SetColumnStyle&lt;T&gt;(T grid, string columnName, string key, string value)
        {
            if ((grid is RadGrid) &amp;&amp; (grid as RadGrid).MasterTableView.GetColumnSafe(columnName) != null)
            {
                foreach (GridDataItem row in (grid as RadGrid).MasterTableView.Items)
                    (row as GridDataItem)[columnName].Style.Add(key, value);
            }
        }

        public static void SetHeaderStyle&lt;T&gt;(T grid, string columnName, string key, string value)
        {
            if ((grid is RadGrid) &amp;&amp; (grid as RadGrid).MasterTableView.GetColumnSafe(columnName) != null)
            {
                GridHeaderItem header =
                    ((grid as RadGrid).MasterTableView.GetItems(GridItemType.Header)[0] as GridHeaderItem);
                if (header != null)
                {
                    header[columnName].Style.Add(key, value);
                }
            }
        }

        public static string GetGridFriendlyExpression(string expression)
        {
            if(expression != null)
            {
                expression = expression.Replace(space, spaceReplacer);
                expression = expression.Replace(&quot;%&quot;, percentReplacer);
            }
            return expression;
        }

        public static string GetDatabaseFriendlyExpression(string expression)
        {
            return expression.Replace(spaceReplacer, space);
        }

        public static void GetTrimmedDataSet(DataTable dataTable, ArrayList dateTimeCols = null)
        {
            //ASHEESH_DateTime :Logic changed for optimization

            List&lt;string&gt; dateTimeColumnNameList = new List&lt;string&gt;();
            foreach (var colObj in dataTable.Columns.Cast&lt;DataColumn&gt;())
            {
                colObj.ColumnName = colObj.ColumnName.Replace(space, spaceReplacer);
                colObj.ColumnName = colObj.ColumnName.Replace(&quot;%&quot;, percentReplacer);
                if (colObj.DataType.FullName == &quot;System.DateTime&quot;)
                    dateTimeColumnNameList.Add(colObj.ColumnName);
            }

            foreach (var rowObj in dataTable.Rows.Cast&lt;DataRow&gt;())
            {
                foreach (var colName in dateTimeColumnNameList)
                {
                    object dateObj = rowObj[colName];

                    if (dateObj is DateTime)
                    {
                        //Step 1: Mark DateTime as UTC
                        DateTime dt_AsUTC = ((DateTime)(dateObj)).ToDateTimeAndSetKindToUtc();
                        //Step 2: Convert DateTime to Masterworks culture
                        DateTime dt_AsMWDateTime = dt_AsUTC.ToMWDateTime();
                        //Step 3: Assign new datetime to grid 
                        rowObj[colName] = dt_AsMWDateTime;
                    }
                }
            }
        }

        public static string GetFilterExpression(RadGrid grid, ArrayList dateTimeColumns = null)
        {
            const string CONST_OneIsEqualToOne = &quot; 1=1 &quot;;

            StringBuilder filterString = new StringBuilder();// string.Empty;
            filterString.Append(CONST_OneIsEqualToOne);

            GridColumn[] columns = (grid.AutoGenerateColumns)
                ? grid.MasterTableView.AutoGeneratedColumns
                : grid.MasterTableView.Columns.Cast&lt;GridColumn&gt;().ToArray();

            foreach (GridColumn column in columns)
            {
                string columnfilterString = string.Empty;
                if (
                    //If none of the below condition is satisfied then skip to next iteration (column)
                    !(column.Display &amp;&amp;
                        (!string.IsNullOrEmpty(column.CurrentFilterValue)
                        || (    //If it is a string field and filter type is Empty check or non empty check then don&#39;t care about column.CurrentFilterValue
                                column.DataType.FullName == &quot;System.String&quot;
                                &amp;&amp; (column.CurrentFilterFunction == GridKnownFunction.IsEmpty || column.CurrentFilterFunction == GridKnownFunction.NotIsEmpty)
                            )
                        )
                    )
                ) continue;

                switch (column.DataType.FullName)
                {
                    case &quot;System.DateTime&quot;:
                        columnfilterString = HandleDateTimeObject_CreatefilterString(column, dateTimeColumns);
                        filterString.Append(columnfilterString);
                        break;
                    case &quot;System.Byte&quot;:
                    case &quot;System.SByte&quot;:
                    case &quot;System.UInt16&quot;:
                    case &quot;System.UInt32&quot;:
                    case &quot;System.UInt64&quot;:
                    case &quot;System.Int16&quot;:
                    case &quot;System.Int32&quot;:
                    case &quot;System.Int64&quot;:
                    case &quot;System.Decimal&quot;:
                    case &quot;System.Double&quot;:
                    case &quot;System.Single&quot;:
                        #region Numeric Handler
                        double doubleCurrentFilterValue;
                        if (double.TryParse(column.CurrentFilterValue, out doubleCurrentFilterValue))
                        {
                            string lhs = string.Empty;
                            string rhs = string.Empty;
                            //if (((column is GridBoundColumn) &amp;&amp;
                            //     (!string.IsNullOrEmpty((column as GridBoundColumn).DataFormatString))))
                            //{
                            //    string format =
                            //        (column as GridBoundColumn).DataFormatString.TrimStart(&#39;{&#39;)
                            //            .TrimEnd(&#39;}&#39;)
                            //            .Trim()
                            //            .Substring(2);
                            //    lhs = &quot;FORMAT([&quot; + column.UniqueName + &quot;],&#39;&quot; + format + &quot;&#39;)&quot;;
                            //    rhs = &quot;FORMAT(&quot; + doubleCurrentFilterValue.ToString() + &quot;,&#39;&quot; + format + &quot;&#39;)&quot;;
                            //}
                            //else
                            {
                                lhs = &quot;[&quot; + column.UniqueName + &quot;]&quot;;
                                rhs = doubleCurrentFilterValue.ToString();
                            }

                            switch (column.CurrentFilterFunction)
                            {
                                case GridKnownFunction.EqualTo:
                                    columnfilterString = &quot;(&quot; + lhs + &quot; = &quot; + rhs + &quot;)&quot;;
                                    break;
                                case GridKnownFunction.NotEqualTo:
                                    columnfilterString = &quot;(&quot; + lhs + &quot; &lt;&gt; &quot; + rhs + &quot;)&quot;;
                                    break;
                                case GridKnownFunction.GreaterThan:
                                    columnfilterString = &quot;(&quot; + lhs + &quot; &gt; &quot; + rhs + &quot;)&quot;;
                                    break;
                                case GridKnownFunction.LessThan:
                                    columnfilterString = &quot;(&quot; + lhs + &quot; &lt; &quot; + rhs + &quot;)&quot;;
                                    break;
                                case GridKnownFunction.GreaterThanOrEqualTo:
                                    columnfilterString = &quot;(&quot; + lhs + &quot; &gt;= &quot; + rhs + &quot;)&quot;;
                                    break;
                                case GridKnownFunction.LessThanOrEqualTo:
                                    columnfilterString = &quot;(&quot; + lhs + &quot; &lt;= &quot; + rhs + &quot;)&quot;;
                                    break;
                                case GridKnownFunction.IsNull:
                                    columnfilterString = &quot;(&quot; + lhs + &quot; IS NULL&quot; + &quot;)&quot;;
                                    break;
                                case GridKnownFunction.NotIsNull:
                                    columnfilterString = &quot;(&quot; + lhs + &quot; IS NOT NULL&quot; + &quot;)&quot;;
                                    break;
                            }

                            if (!string.IsNullOrEmpty(columnfilterString))
                                filterString.Append(&quot; AND &quot; + columnfilterString);
                        }
                        #endregion Numeric Handler
                        break;
                    case &quot;System.String&quot;:
                        #region String Handler
                        // Escape sql serve LIKE wildcard characters
                        string filterValue =
                            column.CurrentFilterValue.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;)
                                .Replace(&quot;%&quot;, &quot;[%]&quot;)
                                .Replace(&quot;[&quot;, &quot;[[]&quot;)
                                .Replace(&quot;_&quot;, &quot;[_]&quot;);

                        switch (column.CurrentFilterFunction)
                        {
                            case GridKnownFunction.Contains:
                                columnfilterString = &quot;([&quot; + column.UniqueName + &quot;] LIKE &#39;%&quot; + filterValue + &quot;%&#39;)&quot;;
                                break;
                            case GridKnownFunction.DoesNotContain:
                                //columnfilterString = &quot;([&quot; + column.UniqueName + &quot;] NOT LIKE &#39;%&quot; + filterValue + &quot;%&#39;)&quot;;
                                //Bugfix 55784
                                if (!string.IsNullOrEmpty(filterValue))
                                    columnfilterString = string.Format(&quot; ( [{0}] NOT LIKE &#39;%{1}%&#39; OR [{0}] IS NULL ) &quot;, column.UniqueName, filterValue);
                                else
                                    columnfilterString = string.Format(&quot; ( [{0}] NOT LIKE &#39;%{1}%&#39; ) &quot;, column.UniqueName, filterValue);
                                break;
                            case GridKnownFunction.StartsWith:
                                columnfilterString = &quot;([&quot; + column.UniqueName + &quot;] LIKE &#39;&quot; + filterValue + &quot;%&#39;)&quot;;
                                break;
                            case GridKnownFunction.EndsWith:
                                columnfilterString = &quot;([&quot; + column.UniqueName + &quot;] LIKE &#39;%&quot; + filterValue + &quot;&#39;)&quot;;
                                break;
                            case GridKnownFunction.EqualTo:
                                columnfilterString = &quot;([&quot; + column.UniqueName + &quot;] LIKE &#39;&quot; + filterValue + &quot;&#39;)&quot;;
                                break;
                            case GridKnownFunction.NotEqualTo:
                                //Bugfix 55784
                                //columnfilterString = &quot;([&quot; + column.UniqueName + &quot;] &lt;&gt; &#39;&quot; + filterValue + &quot;&#39;)&quot;;
                                if (!string.IsNullOrEmpty(filterValue))
                                    columnfilterString = string.Format(&quot; ( [{0}] &lt;&gt; &#39;{1}&#39; OR [{0}] IS NULL ) &quot;, column.UniqueName, filterValue);
                                else
                                    columnfilterString = string.Format(&quot; ( [{0}] &lt;&gt; &#39;{1}&#39; ) &quot;, column.UniqueName, filterValue);
                                break;
                            case GridKnownFunction.IsEmpty:
                                //Asheesh: Changed: Null is DB is equivalent to EMPTY for end user in the UI
                                columnfilterString = string.Format(&quot; ( [{0}] = &#39;&#39; OR [{0}] IS NULL ) &quot;, column.UniqueName);
                                break;
                            case GridKnownFunction.NotIsEmpty:
                                //Asheesh: Changed: Null is DB is equivalent to EMPTY for end user in the UI
                                columnfilterString = string.Format(&quot; ( [{0}] &lt;&gt; &#39;&#39; AND [{0}] IS NOT NULL ) &quot;, column.UniqueName);

                                break;
                        }

                        if (!string.IsNullOrEmpty(columnfilterString))
                            filterString.Append(&quot; AND &quot; + columnfilterString);
                        #endregion String Handler
                        break;
                    case &quot;System.Boolean&quot;:
                        #region Bool Data Handler
                        bool boolCurrentFilterValue;
                        if (bool.TryParse(column.CurrentFilterValue, out boolCurrentFilterValue))
                        {
                            //The corrected logic
                            //switch (column.CurrentFilterFunction)
                            //{
                            //    case GridKnownFunction.EqualTo:
                            //        //when value is true then get exact value . if false then consider NULL value also same as false
                            //        columnfilterString = (boolCurrentFilterValue)
                            //                              ? string.Format(&quot;([{0}] = &#39;true&#39;)&quot;, column.UniqueName)
                            //                              : string.Format(&quot;([{0}] = &#39;false&#39; OR [{0}] IS NULL)&quot;, column.UniqueName);
                            //        break;
                            //    case GridKnownFunction.NotEqualTo:
                            //        columnfilterString = (!boolCurrentFilterValue)
                            //                              ? string.Format(&quot;([{0}] = &#39;true&#39;)&quot;, column.UniqueName)
                            //                              : string.Format(&quot;([{0}] = &#39;false&#39; OR [{0}] IS NULL)&quot;, column.UniqueName);
                            //        break;
                            //}

                            //Above logic is correctd for bug and is simplified below: Keepin above logic commented(not deleting it) only for understanding purpose of developer
                            var filterFn = column.CurrentFilterFunction;

                            if ((filterFn == GridKnownFunction.EqualTo &amp;&amp; boolCurrentFilterValue) || (filterFn == GridKnownFunction.NotEqualTo &amp;&amp; !boolCurrentFilterValue))
                                filterString.AppendFormat(&quot;  AND ([{0}] = &#39;true&#39;)&quot;, column.UniqueName);
                            else if (filterFn.IsEqualToAny(GridKnownFunction.EqualTo, GridKnownFunction.NotEqualTo))//this must not be done for these two filter only
                                filterString.AppendFormat(&quot;  AND ([{0}] = &#39;false&#39; OR [{0}] IS NULL)&quot;, column.UniqueName);
                            
                            //if (!string.IsNullOrEmpty(columnfilterString))
                            //    filterString.Append(&quot; AND &quot; + columnfilterString);
                        }
                        #endregion Bool Data Handler
                        break;
                }
            }

            if (filterString.ToString() == CONST_OneIsEqualToOne)
                return string.Empty;
            else
                return filterString.ToString();
        }

        public class Property
        {
            public Property()
            {
                AllowEditing = MWGrid.AllowEditing.NotSet;
                HorizontalAlign = System.Web.UI.WebControls.HorizontalAlign.NotSet;
            }

            public AllowEditing AllowEditing { get; set; }
            public System.Web.UI.WebControls.HorizontalAlign HorizontalAlign { get; set; }
        }

        public static class ExportSettings
        {
            public enum FileFormat
            {
                Excel
            }

            public enum DataFormat
            {
                Data,
                Template
            }
        }

        public enum SortOrder
        {
            Ascending,
            Descending,
            None
        }

        public enum AllowEditing
        {
            Yes,
            No,
            NotSet
        }

        public enum Lookup
        {
            EqualTo,
            NotEqualTo
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[17,9,17,45,1],[18,9,18,35,1],[19,9,19,47,1],[22,9,22,10,1],[23,13,23,33,1],[24,13,24,37,1],[25,13,25,14,1],[26,17,26,63,1],[27,17,27,87,1],[28,17,28,36,1],[29,17,29,18,1],[30,21,30,54,1],[33,29,35,55,1],[36,29,36,44,1],[37,29,37,30,1],[38,33,38,63,1],[39,29,39,30,1],[40,29,40,35,1],[42,29,42,63,1],[43,29,43,35,1],[45,17,45,18,1],[46,13,46,14,1],[47,13,47,26,1],[48,9,48,10,1],[55,9,55,10,0],[56,13,56,33,0],[57,13,57,33,0],[58,13,58,14,0],[59,17,59,97,0],[60,17,61,89,0],[62,17,62,18,0],[63,21,63,59,0],[64,17,64,18,0],[65,13,65,14,0],[66,13,66,26,0],[67,9,67,10,0],[70,9,70,10,1],[71,13,71,37,1],[72,13,72,33,1],[73,13,73,14,1],[74,17,74,97,1],[75,17,75,64,1],[76,17,76,18,1],[77,21,77,40,1],[78,17,78,18,1],[79,13,79,14,1],[80,13,80,24,1],[81,9,81,10,1],[84,9,84,10,1],[85,13,85,52,1],[86,13,86,33,1],[87,13,87,14,1],[88,17,88,97,1],[89,17,89,64,1],[90,17,90,18,1],[91,21,91,46,1],[92,17,92,18,1],[93,13,93,14,1],[94,13,94,25,1],[95,9,95,10,1],[98,9,98,10,1],[99,13,99,52,1],[100,13,100,33,1],[101,13,101,14,1],[102,17,102,24,1],[102,26,102,42,1],[102,43,102,45,1],[102,46,102,85,1],[103,17,103,18,1],[104,21,104,35,1],[105,17,105,18,1],[106,13,106,14,1],[107,13,107,25,1],[108,9,108,10,1],[111,9,111,10,0],[112,13,112,37,0],[113,13,113,14,0],[114,17,114,100,0],[115,17,115,36,0],[116,17,116,18,0],[117,21,117,52,0],[118,17,118,18,0],[119,13,119,14,0],[120,9,120,10,0],[123,9,123,10,1],[124,13,124,37,1],[125,13,125,14,1],[126,17,126,100,1],[127,17,127,36,1],[128,17,128,18,1],[129,21,131,39,1],[132,17,132,18,1],[133,13,133,14,1],[134,9,134,10,1],[137,9,137,10,1],[138,13,138,31,1],[139,13,139,37,1],[140,13,140,14,1],[141,17,141,63,1],[142,17,142,54,1],[142,54,142,102,1],[142,102,142,118,1],[142,17,142,118,1],[143,13,143,14,1],[144,13,144,26,1],[145,9,145,10,1],[148,9,148,10,1],[149,13,149,33,1],[150,13,150,14,1],[151,17,151,24,1],[151,26,151,39,1],[151,40,151,42,1],[151,43,151,50,1],[152,17,152,18,1],[153,21,153,89,1],[154,21,154,22,1],[155,25,155,97,1],[156,21,156,22,1],[157,17,157,18,1],[158,13,158,14,1],[159,9,159,10,1],[163,9,163,10,0],[164,13,164,33,0],[165,13,165,14,0],[166,17,166,35,0],[167,17,167,24,0],[167,26,167,47,0],[167,48,167,50,0],[167,51,167,103,0],[168,17,168,18,0],[169,21,169,83,0],[170,21,170,22,0],[171,25,171,72,0],[172,21,172,22,0],[173,17,173,18,0],[174,17,174,49,0],[176,13,176,33,0],[177,9,177,10,0],[180,9,180,10,0],[181,13,181,58,0],[182,13,182,33,0],[183,13,183,14,0],[189,17,189,24,0],[189,26,189,43,0],[189,44,189,46,0],[189,47,189,101,0],[190,17,190,18,0],[191,21,193,59,0],[194,25,196,53,0],[197,17,197,18,0],[198,13,198,14,0],[199,13,199,31,0],[200,9,200,10,0],[203,9,203,10,0],[204,13,204,20,0],[204,22,204,35,0],[204,36,204,38,0],[204,39,204,59,0],[205,13,205,14,0],[207,17,207,35,0],[208,17,208,46,0],[209,17,209,40,0],[210,17,210,39,0],[211,13,211,14,0],[212,9,212,10,0],[221,9,221,10,1],[222,13,222,38,1],[223,13,223,34,1],[224,13,224,14,1],[225,17,225,104,1],[226,13,226,14,1],[228,13,228,14,0],[229,17,229,42,0],[230,13,230,14,0],[232,13,232,20,1],[232,22,232,36,1],[232,37,232,39,1],[232,40,232,49,1],[233,13,233,14,1],[234,17,234,70,1],[235,17,235,18,0],[236,21,236,50,0],[237,17,237,18,0],[239,17,239,38,1],[240,17,240,18,1],[241,21,241,115,1],[242,17,242,18,1],[244,17,244,18,0],[245,21,245,53,0],[246,17,246,18,0],[247,13,247,14,1],[249,13,249,39,1],[250,13,250,77,1],[251,13,251,71,1],[252,9,252,10,1],[257,9,257,10,1],[258,13,258,38,1],[259,13,259,34,1],[260,13,260,14,1],[261,17,261,104,1],[262,13,262,14,1],[264,13,264,14,0],[265,17,265,42,0],[266,13,266,14,0],[268,13,268,20,1],[268,22,268,36,1],[268,37,268,39,1],[268,40,268,49,1],[269,13,269,14,1],[270,17,270,70,1],[271,17,271,18,1],[272,21,272,50,1],[273,17,273,18,1],[275,17,275,38,1],[276,17,276,18,1],[277,21,277,115,1],[278,17,278,18,1],[280,17,280,18,0],[281,21,281,53,0],[282,17,282,18,0],[283,13,283,14,1],[285,13,285,39,1],[286,13,286,77,1],[287,13,287,116,1],[288,9,288,10,1],[292,9,292,10,0],[293,13,294,58,0],[294,58,294,74,0],[294,74,294,95,0],[293,13,294,95,0],[295,13,295,14,0],[296,17,296,42,0],[297,17,297,18,0],[298,21,298,46,0],[299,21,299,48,0],[300,21,300,79,0],[301,21,301,61,0],[302,21,302,83,0],[303,21,303,63,0],[304,21,304,69,0],[305,21,305,61,0],[306,21,306,64,0],[307,21,308,21,0],[308,21,308,22,0],[308,22,309,25,0],[309,25,309,104,0],[309,104,310,25,0],[310,25,310,26,0],[310,26,311,29,0],[311,29,311,64,0],[311,64,312,25,0],[312,25,312,26,0],[312,26,313,21,0],[313,21,313,22,0],[313,22,313,23,0],[307,21,313,23,0],[314,21,314,72,0],[315,21,315,42,0],[316,21,316,37,0],[317,21,317,45,0],[318,21,318,58,0],[324,17,324,18,0],[326,17,326,18,0],[328,21,328,28,0],[328,30,328,44,0],[328,45,328,47,0],[328,48,328,57,0],[329,21,329,22,0],[330,25,330,78,0],[331,25,331,26,0],[332,29,332,58,0],[333,25,333,26,0],[334,21,334,22,0],[335,21,335,47,0],[336,21,336,85,0],[337,21,337,79,0],[338,17,338,18,0],[339,13,339,14,0],[340,9,340,10,0],[343,9,343,10,1],[344,13,344,37,1],[345,13,345,14,1],[346,17,346,57,1],[347,13,347,14,1],[348,9,348,10,1],[351,9,351,10,0],[352,13,352,119,0],[353,13,353,14,0],[354,17,354,72,0],[355,13,355,14,0],[357,13,357,110,0],[358,13,358,14,0],[359,17,359,107,0],[360,13,360,14,0],[361,9,361,10,0],[364,9,364,10,0],[365,13,365,113,0],[366,13,366,14,0],[367,17,367,63,0],[368,17,368,24,0],[368,26,368,36,0],[368,37,368,39,0],[368,40,368,52,0],[369,17,369,18,0],[370,21,370,95,0],[371,21,371,22,0],[372,25,372,82,0],[373,21,373,22,0],[374,21,374,63,0],[375,21,375,22,0],[377,21,377,22,0],[378,17,378,18,0],[379,13,379,14,0],[380,9,380,10,0],[383,9,383,10,1],[384,13,384,106,1],[385,13,385,14,1],[386,17,386,24,1],[386,26,386,36,1],[386,37,386,39,1],[386,40,386,52,1],[387,17,387,18,1],[388,21,388,95,1],[389,21,389,22,1],[390,25,391,47,1],[392,21,392,22,1],[393,21,393,63,1],[394,21,394,22,0],[396,21,396,22,0],[397,17,397,18,1],[398,13,398,14,1],[399,9,399,10,1],[402,9,402,10,1],[403,13,403,106,1],[404,13,404,14,1],[405,17,405,24,1],[405,26,405,36,1],[405,37,405,39,1],[405,40,405,52,1],[406,17,406,18,1],[407,21,407,95,1],[408,21,408,22,1],[409,25,410,47,1],[411,21,411,22,1],[412,17,412,18,1],[413,13,413,14,1],[414,9,414,10,1],[417,9,417,10,1],[418,13,418,52,1],[419,13,419,106,1],[420,13,420,14,1],[421,17,421,46,1],[422,17,422,18,0],[423,21,425,29,0],[425,29,425,110,0],[425,110,426,53,0],[423,21,426,53,0],[427,17,427,18,0],[428,22,428,54,1],[429,17,429,18,1],[430,21,432,29,1],[432,29,432,62,1],[432,62,432,90,1],[430,21,432,90,1],[433,17,433,18,1],[434,13,434,14,1],[435,13,435,25,1],[436,9,436,10,1],[439,9,439,10,1],[440,13,440,113,1],[441,13,441,14,1],[442,17,442,117,1],[443,13,443,14,1],[444,9,444,10,1],[447,9,447,10,1],[448,13,448,113,1],[449,13,449,14,1],[450,17,450,73,1],[451,13,451,14,1],[452,9,452,10,1],[455,9,455,10,1],[456,13,456,106,1],[457,13,457,14,1],[458,17,458,24,1],[458,26,458,42,1],[458,43,458,45,1],[458,46,458,85,1],[459,21,459,77,1],[460,13,460,14,1],[461,9,461,10,1],[464,9,464,10,1],[465,13,465,106,1],[466,13,466,14,1],[467,17,468,108,1],[469,17,469,36,1],[470,17,470,18,1],[471,21,471,62,1],[472,17,472,18,1],[473,13,473,14,1],[474,9,474,10,1],[477,9,477,10,1],[478,13,478,35,1],[479,13,479,14,1],[480,17,480,71,1],[481,17,481,71,1],[482,13,482,14,1],[483,13,483,31,1],[484,9,484,10,1],[487,9,487,10,1],[488,13,488,61,1],[489,9,489,10,1],[492,9,492,10,1],[495,13,495,70,1],[496,13,496,20,1],[496,22,496,32,1],[496,33,496,35,1],[496,36,496,72,1],[497,13,497,14,1],[498,17,498,85,1],[499,17,499,85,1],[500,17,500,67,1],[501,21,501,67,1],[502,13,502,14,1],[504,13,504,20,1],[504,22,504,32,1],[504,33,504,35,1],[504,36,504,66,1],[505,13,505,14,1],[506,17,506,24,1],[506,26,506,37,1],[506,38,506,40,1],[506,41,506,63,1],[507,17,507,18,1],[508,21,508,54,1],[510,21,510,45,1],[511,21,511,22,1],[513,25,513,95,1],[515,25,515,76,1],[517,25,517,59,1],[518,21,518,22,1],[519,17,519,18,1],[520,13,520,14,1],[521,9,521,10,1],[524,9,524,10,1],[527,13,527,62,1],[528,13,528,56,1],[530,13,532,77,1],[534,13,534,20,1],[534,22,534,39,1],[534,40,534,42,1],[534,43,534,50,1],[535,13,535,14,1],[536,17,536,58,1],[537,17,547,18,1],[547,19,547,28,1],[549,17,549,50,1],[552,25,552,111,0],[553,25,553,65,0],[554,25,554,31,0],[568,25,568,102,0],[569,25,569,26,0],[570,29,570,55,0],[571,29,571,55,0],[584,29,584,30,0],[585,33,585,69,0],[586,33,586,75,0],[587,29,587,30,0],[589,29,589,66,0],[592,37,592,88,0],[593,37,593,43,0],[595,37,595,89,0],[596,37,596,43,0],[598,37,598,88,0],[599,37,599,43,0],[601,37,601,88,0],[602,37,602,43,0],[604,37,604,89,0],[605,37,605,43,0],[607,37,607,89,0],[608,37,608,43,0],[610,37,610,87,0],[611,37,611,43,0],[613,37,613,91,0],[614,37,614,43,0],[617,29,617,75,0],[618,33,618,83,0],[619,25,619,26,0],[621,25,621,31,0],[625,25,629,54,1],[631,25,631,62,1],[634,33,634,115,1],[635,33,635,39,1],[639,33,639,72,0],[640,37,640,153,0],[642,37,642,136,0],[643,33,643,39,0],[645,33,645,114,0],[646,33,646,39,0],[648,33,648,114,0],[649,33,649,39,0],[651,33,651,113,1],[652,33,652,39,1],[656,33,656,72,0],[657,37,657,145,0],[659,37,659,128,0],[660,33,660,39,0],[663,33,663,124,0],[664,33,664,39,0],[667,33,667,130,0],[669,33,669,39,0],[672,25,672,71,1],[673,29,673,79,1],[675,25,675,31,1],[679,25,679,98,0],[680,25,680,26,0],[698,29,698,73,0],[700,29,700,172,0],[701,33,701,104,0],[702,34,702,117,0],[703,33,703,122,0],[707,25,707,26,0],[709,25,709,31,0],[711,13,711,14,1],[713,13,713,66,1],[714,17,714,37,1],[716,17,716,48,1],[717,9,717,10,1],[721,13,721,30,1],[722,13,722,14,1],[723,17,723,59,1],[724,17,724,84,1],[725,13,725,14,1],[727,48,727,52,1],[727,53,727,57,1],[728,80,728,84,1],[728,85,728,89,1]]);
    </script>
  </body>
</html>