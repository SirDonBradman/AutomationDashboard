<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Business Layer\UserControls\MeasurementEntry.ascx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Data;
using System.Data.OleDb;
using System.Drawing;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using Aurigo.AMP3.Common;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Infragistics.Documents.Excel;
using Infragistics.WebUI.UltraWebGrid;
using Infragistics.WebUI.UltraWebGrid.ExcelExport;
using Infragistics.WebUI.WebDataInput;

namespace Aurigo.AMP3.Core.UserControls
{
    public partial class MeasurementEntry : UserControl
    {
        private const string MSG_INVALID_FILE = &quot;Please upload a valid Excel file&quot;;
        protected UltraWebGridExcelExporter uwgExcelExporter;
        protected UltraWebGrid grdMBEntry;
        protected global::Infragistics.WebUI.WebDataInput.WebNumericEdit wneNumberFormatHidden;

        public int ParentInstanceID
        {
            get { return (int)ViewState[&quot;MEParentInstanceID&quot;]; }
            set { ViewState[&quot;MEParentInstanceID&quot;] = value; }
        }

        public int MBookItemID
        {
            get { return (int)ViewState[&quot;MEMBookItemID&quot;]; }
            set { ViewState[&quot;MEMBookItemID&quot;] = value; }
        }

        public int ItemID
        {
            get { return (int)ViewState[&quot;MEItemID&quot;]; }
            set { ViewState[&quot;MEItemID&quot;] = value; }
        }

        public int ActivityID
        {
            get { return (int)ViewState[&quot;MEActivityID&quot;]; }
            set { ViewState[&quot;MEActivityID&quot;] = value; }
        }

        public int SubItemID
        {
            get { return (int)ViewState[&quot;MESubItemID&quot;]; }
            set { ViewState[&quot;MESubItemID&quot;] = value; }
        }

        public decimal MBookQuantity
        {
            get { return (decimal)ViewState[&quot;MEMBookQuantity&quot;]; }
            set { ViewState[&quot;MEMBookQuantity&quot;] = value; }
        }

        public string MBookNo
        {
            get { return (string)ViewState[&quot;MEMBookNo&quot;]; }
            set { ViewState[&quot;MEMBookNo&quot;] = value; }
        }

        public string PageMode
        {
            get { return (string)ViewState[&quot;MEPageMode&quot;]; }
            set { ViewState[&quot;MEPageMode&quot;] = value; }
        }

        public DataTable DTMBookItems
        {
            get { return (DataTable)ViewState[&quot;MEDTMBookItems&quot;]; }
            set { ViewState[&quot;MEDTMBookItems&quot;] = value; }
        }

        public DataTable DTMBookItemsDetail
        {
            get { return (DataTable)ViewState[&quot;MEDTMBookItemsDetail&quot;]; }
            set { ViewState[&quot;MEDTMBookItemsDetail&quot;] = value; }
        }

        public DataTable DTExistingMBookItemsDetail
        {
            get { return (DataTable)ViewState[&quot;MEDTExistingMBookItemsDetail&quot;]; }
            set { ViewState[&quot;MEDTExistingMBookItemsDetail&quot;] = value; }
        }

        public decimal PostedCertifiedQty
        {
            get { return hdnPostedCertifiedQty.Value.ToDecimal2(); }
            set { hdnPostedCertifiedQty.Value = value.ToString(); }
        }

        public bool HasLength
        {
            get { return (bool)ViewState[&quot;HasLength&quot;]; }
            set { ViewState[&quot;HasLength&quot;] = value; }
        }

        public bool HasWidth
        {
            get { return (bool)ViewState[&quot;HasWidth&quot;]; }
            set { ViewState[&quot;HasWidth&quot;] = value; }
        }

        public bool HasHeight
        {
            get { return (bool)ViewState[&quot;HasHeight&quot;]; }
            set { ViewState[&quot;HasHeight&quot;] = value; }
        }

        protected void Page_Load(object sender, EventArgs e)
        {
            //wneNumberFormatHidden.MinDecimalPlaces = 
            var CurrencyFormatQty = new NumberFormatInfo();
            CurrencyFormatQty.NumberDecimalDigits =
                CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY);
            wneNumberFormatHidden.MinDecimalPlaces = (MinDecimalPlaces)CurrencyFormatQty.NumberDecimalDigits;

            wneNumberFormatHidden.NumberFormat = CurrencyFormatQty;

            if (!Page.IsPostBack)
            {
                tdMBookNo.InnerText = &quot;Measurement Book No :&quot;;
                tdMeasurementBookRequired.InnerText = &quot;Measurement Book Dimension :&quot;;
            }
        }

        public void lnkSave_Click(object sender, EventArgs e)
        {
            if (DTMBookItems.Rows.Count &gt; 0)
            {
                //Update the M Book Item data which are modified in Measurement Entry page to the DTMBookItems
                for (int i = 0; i &lt; DTMBookItems.Rows.Count; i++)
                {
                    DTMBookItems.Rows[i][&quot;ParentInstanceID&quot;] = ParentInstanceID.ToString();
                    if ((DTMBookItems.Rows[i][&quot;ID&quot;].ToInt32_2() != -1 &amp;&amp;
                         DTMBookItems.Rows[i][&quot;ID&quot;].ToInt32_2() == MBookItemID) ||
                        (DTMBookItems.Rows[i][&quot;ID&quot;].ToInt32_2() == MBookItemID &amp;&amp;
                         DTMBookItems.Rows[i][&quot;ItemID&quot;].ToInt32_2() == ItemID &amp;&amp;
                         DTMBookItems.Rows[i][&quot;ActivityID&quot;].ToInt32_2() == ActivityID &amp;&amp;
                         DTMBookItems.Rows[i][&quot;SubItemID&quot;].ToInt32_2() == SubItemID))
                    {
                        DTMBookItems.Rows[i][&quot;MBookNo&quot;] = txtMBookNo.Text;
                        DTMBookItems.Rows[i][&quot;MBookRequired&quot;] = chkMBRequired.Checked.ToString();
                        DTMBookItems.Rows[i][&quot;Length&quot;] = chkLength.Checked.ToString();
                        DTMBookItems.Rows[i][&quot;Width&quot;] = chkWidth.Checked.ToString();
                        DTMBookItems.Rows[i][&quot;Height&quot;] = chkHeight.Checked.ToString();

                        MBookNo = txtMBookNo.Text;
                        MBookQuantity = (grdMBEntry.Rows.GetFooterText(&quot;Quantity&quot;) != null &amp;&amp;
                                         !string.IsNullOrEmpty(grdMBEntry.Rows.GetFooterText(&quot;Quantity&quot;)))
                            ? grdMBEntry.Rows.GetFooterText(&quot;Quantity&quot;).ToDecimal2()
                            : 0;

                        HasLength = chkLength.Checked;
                        HasWidth = chkWidth.Checked;
                        HasHeight = chkHeight.Checked;

                        trImportStatus.Style.Value = &quot;display:none;&quot;;

                        break;
                    }
                }
            }

            //Track if any M Book Items Detail is added or modified or deleted
            AddMBookItemsDetailToDTMBookItemsDetail();
        }

        public void MEDataBind()
        {
            DataRow[] drSelectedMBookItem =
                DTMBookItems.Select(&quot;ID = &quot; + MBookItemID + &quot; AND ItemID = &quot; + ItemID + &quot; AND ActivityID = &quot; +
                                    ActivityID + &quot; AND SubItemID = &quot; + SubItemID);
            int noOfMBookItem = drSelectedMBookItem.Length;

            if (noOfMBookItem &gt; 0)
            {
                txtMBookNo.Text = (drSelectedMBookItem[0][&quot;MBookNo&quot;] != DBNull.Value &amp;&amp;
                                   drSelectedMBookItem[0][&quot;MBookNo&quot;].ToString() != &quot;-----&quot;)
                    ? drSelectedMBookItem[0][&quot;MBookNo&quot;].ToString()
                    : string.Empty;
                lblStandardItemNo.Text = (drSelectedMBookItem[0][&quot;StandardItemNo&quot;] != DBNull.Value)
                    ? drSelectedMBookItem[0][&quot;StandardItemNo&quot;].ToString()
                    : string.Empty;
                lblBOQDescription.Text = (drSelectedMBookItem[0][&quot;Description&quot;] != DBNull.Value)
                    ? drSelectedMBookItem[0][&quot;Description&quot;].ToString()
                    : string.Empty;
                lblSubItem.Text = (drSelectedMBookItem[0][&quot;SubItem&quot;] != DBNull.Value)
                    ? drSelectedMBookItem[0][&quot;SubItem&quot;].ToString()
                    : string.Empty;
                lblActivity.Text = (drSelectedMBookItem[0][&quot;ActivityName&quot;] != DBNull.Value)
                    ? drSelectedMBookItem[0][&quot;ActivityName&quot;].ToString()
                    : string.Empty;
                lblUnit.Text = (drSelectedMBookItem[0][&quot;Unit&quot;] != DBNull.Value)
                    ? drSelectedMBookItem[0][&quot;Unit&quot;].ToString()
                    : string.Empty;
                chkMBRequired.Checked = (drSelectedMBookItem[0][&quot;MBookRequired&quot;] != DBNull.Value)
                    ? drSelectedMBookItem[0][&quot;MBookRequired&quot;].ToString().ToBoolean2()
                    : false;
                chkLength.Checked = (drSelectedMBookItem[0][&quot;Length&quot;] != DBNull.Value)
                    ? drSelectedMBookItem[0][&quot;Length&quot;].ToString().ToBoolean2()
                    : false;
                chkWidth.Checked = (drSelectedMBookItem[0][&quot;Width&quot;] != DBNull.Value)
                    ? drSelectedMBookItem[0][&quot;Width&quot;].ToString().ToBoolean2()
                    : false;
                chkHeight.Checked = (drSelectedMBookItem[0][&quot;Height&quot;] != DBNull.Value)
                    ? drSelectedMBookItem[0][&quot;Height&quot;].ToString().ToBoolean2()
                    : false;
                ItemID = (drSelectedMBookItem[0][&quot;ItemID&quot;] != DBNull.Value)
                    ? drSelectedMBookItem[0][&quot;ItemID&quot;].ToString().ToInt32_2()
                    : -1;
                ActivityID = (drSelectedMBookItem[0][&quot;ActivityID&quot;] != DBNull.Value)
                    ? drSelectedMBookItem[0][&quot;ActivityID&quot;].ToString().ToInt32_2()
                    : -1;
                SubItemID = (drSelectedMBookItem[0][&quot;SubItemID&quot;] != DBNull.Value)
                    ? drSelectedMBookItem[0][&quot;SubItemID&quot;].ToString().ToInt32_2()
                    : -1;
            }

            if (ActivityID != -1)
            {
                trActivity.Style.Add(&quot;display&quot;, &quot;block&quot;);
            }

            if (SubItemID != -1)
            {
                trActivity.Style.Add(&quot;display&quot;, &quot;block&quot;);
            }

            //If the M Book Item already exists in the database manipulate the M Book Items Detail to display in grid(Measurement Entry)
            if (MBookItemID != -1)
            {
                if (!DTExistingMBookItemsDetail.Columns.Contains(&quot;ItemID&quot;))
                    DTExistingMBookItemsDetail.Columns.Add(&quot;ItemID&quot;);
                if (!DTExistingMBookItemsDetail.Columns.Contains(&quot;ActivityID&quot;))
                    DTExistingMBookItemsDetail.Columns.Add(&quot;ActivityID&quot;);
                if (!DTExistingMBookItemsDetail.Columns.Contains(&quot;SubItemID&quot;))
                    DTExistingMBookItemsDetail.Columns.Add(&quot;SubItemID&quot;);

                var dvMBookItemsDetail = new DataView(DTExistingMBookItemsDetail, &quot;MBookItemsID = &quot; + MBookItemID, &quot;ID&quot;,
                    DataViewRowState.CurrentRows);
                DataTable dtMBookItemsDetail = dvMBookItemsDetail.ToTable();
                DataRow[] drLatestMBookItemsDetail = DTMBookItemsDetail.Select(&quot;MBookItemsID = &quot; + MBookItemID);

                if (drLatestMBookItemsDetail.Length &gt; 0)
                {
                    for (int i = 0; i &lt; drLatestMBookItemsDetail.Length; i++)
                    {
                        //Display newly inserted Measurement Entries
                        if (drLatestMBookItemsDetail[i][&quot;Action&quot;].ToString() == &quot;Insert&quot;)
                            dtMBookItemsDetail.Rows.Add(CopyMBookItemsDetailDataRow(drLatestMBookItemsDetail[i],
                                dtMBookItemsDetail.NewRow()));
                        //Hide deleted Measurement Entries and display updated Measurement Entries
                        else
                        {
                            for (int j = 0; j &lt; dtMBookItemsDetail.Rows.Count; j++)
                            {
                                if (dtMBookItemsDetail.Rows[j][&quot;ID&quot;].ToInt32_2() ==
                                    drLatestMBookItemsDetail[i][&quot;ID&quot;].ToInt32_2())
                                {
                                    dtMBookItemsDetail.Rows[j].Delete();
                                    dtMBookItemsDetail.AcceptChanges();
                                    if (drLatestMBookItemsDetail[i][&quot;Action&quot;].ToString() == &quot;Update&quot;)
                                        dtMBookItemsDetail.Rows.Add(
                                            CopyMBookItemsDetailDataRow(drLatestMBookItemsDetail[i],
                                                dtMBookItemsDetail.NewRow()));
                                    break;
                                }
                            }
                        }
                    }
                }
                grdMBEntry.DataSource = dtMBookItemsDetail.ToMWDateTime();
            }
            else
            {
                grdMBEntry.DataSource = new DataView(DTMBookItemsDetail.ToMWDateTime(),
                    &quot;MBookItemsID = &quot; + MBookItemID + &quot; AND ItemID = &quot; + ItemID +
                    &quot; AND ActivityID = &quot; + ActivityID + &quot; AND SubItemID = &quot; + SubItemID,
                    &quot;ID&quot;, DataViewRowState.CurrentRows);
            }
            grdMBEntry.DataBind();
            SetMBookItemsDetailsColumns();
        }

        /// &lt;summary&gt;
        /// This adds all(which are newly added, modified and deleted) the M Book Items Detail(Measurement Entry) to DTMBookItemsDetail 
        /// on click of save in Measurement Entry
        /// &lt;/summary&gt;
        private void AddMBookItemsDetailToDTMBookItemsDetail()
        {
            //If the M Book Item is newly added.
            if (MBookItemID == -1)
            {
                // Delete all the Measurement Entries from DTMBookItemsDetail if it already exists in the DTMBookItemsDetail for the 
                //particular M Book Item and insert all the Measurement Entries which are currently in the grid .
                DataRow[] drExistingItemsDetail =
                    DTMBookItemsDetail.Select(&quot;MBookItemsID = &quot; + MBookItemID + &quot; AND ItemID = &quot; + ItemID +
                                              &quot; AND ActivityID = &quot; + ActivityID + &quot; AND SubItemID = &quot; + SubItemID +
                                              &quot; AND ParentInstanceID = &quot; + ParentInstanceID);
                if (drExistingItemsDetail.Length &gt; 0)
                {
                    int countDeleted = 0;
                    for (int j = 0; j &lt; DTMBookItemsDetail.Rows.Count; j++)
                    {
                        DataRow drItemsDetail = DTMBookItemsDetail.Rows[j];
                        if (drItemsDetail[&quot;MBookItemsID&quot;].ToInt32_2() == MBookItemID &amp;&amp;
                            drItemsDetail[&quot;ItemID&quot;].ToInt32_2() == ItemID
                            &amp;&amp; drItemsDetail[&quot;ActivityID&quot;].ToInt32_2() == ActivityID &amp;&amp;
                            drItemsDetail[&quot;SubItemID&quot;].ToInt32_2() == SubItemID
                            &amp;&amp; drItemsDetail[&quot;ParentInstanceID&quot;].ToInt32_2() == ParentInstanceID)
                        {
                            drItemsDetail.Delete();
                            DTMBookItemsDetail.AcceptChanges();
                            countDeleted++;
                            //As when we delete a DataRow, it will be deleted from the reference DataTable so the looping parametes is decremented
                            j--;
                        }

                        if (drExistingItemsDetail.Length == countDeleted)
                            break;
                    }
                }

                // Insert all the Measurement Entries which are currently in the grid  to DTMBookItemsDetail.
                for (int i = 0; i &lt; grdMBEntry.Rows.Count; i++)
                {
                    UltraGridRow currentRow = grdMBEntry.Rows[i];
                    DataRow drMBookItemsDetail = DTMBookItemsDetail.NewRow();
                    AddDataRowToDTMBookItemsDetail(drMBookItemsDetail, currentRow, &quot;Insert&quot;, -1);
                }
            }
            //If the M Book Item exists in database.
            else
            {
                // Delete all the Measurement Entries from DTMBookItemsDetail if it already exists in the DTMBookItemsDetail for the 
                //particular M Book Item and insert/update/delete all the Measurement Entries which are currently in the grid .
                DataRow[] drExistingItemsDetail = DTMBookItemsDetail.Select(&quot;MBookItemsID = &quot; + MBookItemID);

                if (drExistingItemsDetail.Length &gt; 0)
                {
                    int countDeleted = 0;
                    for (int j = 0; j &lt; DTMBookItemsDetail.Rows.Count; j++)
                    {
                        DataRow drItemsDetail = DTMBookItemsDetail.Rows[j];
                        if (drItemsDetail[&quot;MBookItemsID&quot;].ToInt32_2() == MBookItemID)
                        {
                            drItemsDetail.Delete();
                            DTMBookItemsDetail.AcceptChanges();
                            countDeleted++;
                            //As when we delete a DataRow, it will be deleted from the reference DataTable so the looping parametes is decremented
                            j--;
                        }

                        if (drExistingItemsDetail.Length == countDeleted)
                            break;
                    }
                }

                for (int k = 0; k &lt; grdMBEntry.Rows.Count; k++)
                {
                    UltraGridRow currentRow = grdMBEntry.Rows[k];

                    // Adding newly Measurement Entries to DTMBookItemsDetail in Edit mode
                    if (currentRow.Cells.FromKey(&quot;ID&quot;).Value == null ||
                        string.IsNullOrEmpty(currentRow.Cells.FromKey(&quot;ID&quot;).Value.ToString()) ||
                        currentRow.Cells.FromKey(&quot;ID&quot;).Value.ToInt32_2() == -1)
                    {
                        DataRow drMBookItemsDetail = DTMBookItemsDetail.NewRow();
                        AddDataRowToDTMBookItemsDetail(drMBookItemsDetail, currentRow, &quot;Insert&quot;, -1);
                    }
                    // Updating the existing Measurement Entries to DTMBookItemsDetail in Edit mode
                    else
                    {
                        DataRow[] drUpdatedItemDetails =
                            DTExistingMBookItemsDetail.Select(&quot;ID = &quot; + currentRow.Cells.FromKey(&quot;ID&quot;).Value.ToInt32_2());
                        if (drUpdatedItemDetails.Length &gt; 0 &amp;&amp;
                            ((drUpdatedItemDetails[0][&quot;SlNo&quot;].ToString() !=
                              currentRow.Cells.FromKey(&quot;SlNo&quot;).Value.ToString())
                             ||
                             (drUpdatedItemDetails[0][&quot;Description&quot;] != null &amp;&amp;
                              currentRow.Cells.FromKey(&quot;Description&quot;).Value != null &amp;&amp;
                              drUpdatedItemDetails[0][&quot;Description&quot;].ToString() !=
                              currentRow.Cells.FromKey(&quot;Description&quot;).Value.ToString())
                             ||
                             (drUpdatedItemDetails[0][&quot;Polarity&quot;].ToString() !=
                              currentRow.Cells.FromKey(&quot;Polarity&quot;).Value.ToString())
                             ||
                             (drUpdatedItemDetails[0][&quot;Number&quot;].ToString() !=
                              currentRow.Cells.FromKey(&quot;Number&quot;).Value.ToString())
                             ||
                             (drUpdatedItemDetails[0][&quot;Number2&quot;].ToString() !=
                              currentRow.Cells.FromKey(&quot;Number2&quot;).Value.ToString())
                             ||
                             (drUpdatedItemDetails[0][&quot;NumberPMember&quot;].ToString() !=
                              currentRow.Cells.FromKey(&quot;NumberPMember&quot;).Value.ToString())
                             ||
                             (drUpdatedItemDetails[0][&quot;Length&quot;] != null &amp;&amp;
                              currentRow.Cells.FromKey(&quot;Length&quot;).Value != null &amp;&amp;
                              drUpdatedItemDetails[0][&quot;Length&quot;].ToString() !=
                              currentRow.Cells.FromKey(&quot;Length&quot;).Value.ToString())
                             ||
                             (drUpdatedItemDetails[0][&quot;Width&quot;] != null &amp;&amp;
                              currentRow.Cells.FromKey(&quot;Width&quot;).Value != null &amp;&amp;
                              drUpdatedItemDetails[0][&quot;Width&quot;].ToString() !=
                              currentRow.Cells.FromKey(&quot;Width&quot;).Value.ToString())
                             ||
                             (drUpdatedItemDetails[0][&quot;Height&quot;] != null &amp;&amp;
                              currentRow.Cells.FromKey(&quot;Height&quot;).Value != null &amp;&amp;
                              drUpdatedItemDetails[0][&quot;Height&quot;].ToString() !=
                              currentRow.Cells.FromKey(&quot;Height&quot;).Value.ToString())
                             ||
                             (drUpdatedItemDetails[0][&quot;Quantity&quot;].ToString() !=
                              currentRow.Cells.FromKey(&quot;Quantity&quot;).Value.ToString())))
                        {
                            DataRow drMBookItemsDetail = DTMBookItemsDetail.NewRow();
                            AddDataRowToDTMBookItemsDetail(drMBookItemsDetail, currentRow, &quot;Update&quot;, -1);
                        }
                    }
                }

                // Tracking the existing deleted Measurement Entries in DTMBookItemsDetail in Edit mode
                for (int l = 0; l &lt; DTExistingMBookItemsDetail.Rows.Count; l++)
                {
                    if (DTExistingMBookItemsDetail.Rows[l][&quot;MBookItemsID&quot;].ToString().ToInt32_2() == MBookItemID)
                    {
                        UltraGridRow currentRow =
                            grdMBEntry.Rows.OfType&lt;UltraGridRow&gt;().ToList().Find(
                                row =&gt;
                                    (row.Cells.FromKey(&quot;ID&quot;).Text != null &amp;&amp;
                                     row.Cells.FromKey(&quot;ID&quot;).Text.Equals(
                                         DTExistingMBookItemsDetail.Rows[l][&quot;ID&quot;].ToString(),
                                         StringComparison.CurrentCultureIgnoreCase)));
                        if (currentRow == null)
                        {
                            DataRow drMBookItemsDetail = DTMBookItemsDetail.NewRow();
                            AddDataRowToDTMBookItemsDetail(drMBookItemsDetail, currentRow, &quot;Delete&quot;,
                                DTExistingMBookItemsDetail.Rows[l][&quot;ID&quot;].ToString().ToInt32_2
                                    ());
                        }
                    }
                }
            }
        }

        /// &lt;summary&gt;
        /// This adds a M Book Items Detail DataRow to DTMBookItemsDetail depending upon the actions
        /// This is called from AddMBookItemsDetailToDTMBookItemsDetail for different actions(Insert, Update, Delete)
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;drMBookItemsDetail&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;currentRow&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;action&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt;
        private void AddDataRowToDTMBookItemsDetail(DataRow drMBookItemsDetail, UltraGridRow currentRow, string action,
            int id)
        {
            drMBookItemsDetail[&quot;ID&quot;] = (action == &quot;Delete&quot;)
                ? id
                : (action == &quot;Insert&quot; || currentRow.Cells.FromKey(&quot;ID&quot;).Value == null)
                    ? -1
                    : currentRow.Cells.FromKey(&quot;ID&quot;).Value.ToInt32_2();
            drMBookItemsDetail[&quot;MBookItemsID&quot;] = MBookItemID;
            drMBookItemsDetail[&quot;SlNo&quot;] = (action == &quot;Delete&quot; || currentRow.Cells.FromKey(&quot;SlNo&quot;).Value == null)
                ? -1
                : currentRow.Cells.FromKey(&quot;SlNo&quot;).Value.ToInt32_2();
            drMBookItemsDetail[&quot;Description&quot;] = (action == &quot;Delete&quot; ||
                                                 currentRow.Cells.FromKey(&quot;Description&quot;).Value == null)
                ? &quot;-----&quot;
                : currentRow.Cells.FromKey(&quot;Description&quot;).Value.ToString();
            drMBookItemsDetail[&quot;Polarity&quot;] = (action == &quot;Delete&quot; || currentRow.Cells.FromKey(&quot;Polarity&quot;).Value == null)
                ? &quot;-1&quot;
                : currentRow.Cells.FromKey(&quot;Polarity&quot;).Value.ToString();
            drMBookItemsDetail[&quot;Number&quot;] = (action == &quot;Delete&quot; || currentRow.Cells.FromKey(&quot;Number&quot;).Value == null)
                ? &quot;-1&quot;
                : currentRow.Cells.FromKey(&quot;Number&quot;).Value.ToString();
            drMBookItemsDetail[&quot;Number2&quot;] = (action == &quot;Delete&quot; || currentRow.Cells.FromKey(&quot;Number2&quot;).Value == null)
                ? &quot;-1&quot;
                : currentRow.Cells.FromKey(&quot;Number2&quot;).Value.ToString();
            drMBookItemsDetail[&quot;NumberPMember&quot;] = (action == &quot;Delete&quot; ||
                                                   currentRow.Cells.FromKey(&quot;NumberPMember&quot;).Value == null)
                ? &quot;-1&quot;
                : currentRow.Cells.FromKey(&quot;NumberPMember&quot;).Value.ToString();
            drMBookItemsDetail[&quot;Length&quot;] = (action == &quot;Delete&quot; || currentRow.Cells.FromKey(&quot;Length&quot;).Value == null)
                ? &quot;-1&quot;
                : currentRow.Cells.FromKey(&quot;Length&quot;).Value.ToString();
            drMBookItemsDetail[&quot;Width&quot;] = (action == &quot;Delete&quot; || currentRow.Cells.FromKey(&quot;Width&quot;).Value == null)
                ? &quot;-1&quot;
                : currentRow.Cells.FromKey(&quot;Width&quot;).Value.ToString();
            drMBookItemsDetail[&quot;Height&quot;] = (action == &quot;Delete&quot; || currentRow.Cells.FromKey(&quot;Height&quot;).Value == null)
                ? &quot;-1&quot;
                : currentRow.Cells.FromKey(&quot;Height&quot;).Value.ToString();
            drMBookItemsDetail[&quot;Quantity&quot;] = (action == &quot;Delete&quot; || currentRow.Cells.FromKey(&quot;Quantity&quot;).Value == null)
                ? &quot;0&quot;
                : currentRow.Cells.FromKey(&quot;Quantity&quot;).Value.ToString();
            drMBookItemsDetail[&quot;ParentInstanceID&quot;] = ParentInstanceID;
            drMBookItemsDetail[&quot;ItemID&quot;] = ItemID;
            drMBookItemsDetail[&quot;ActivityID&quot;] = ActivityID;
            drMBookItemsDetail[&quot;SubItemID&quot;] = SubItemID;
            drMBookItemsDetail[&quot;Action&quot;] = action;

            DTMBookItemsDetail.Rows.Add(drMBookItemsDetail);
        }

        private void SetMBookItemsDetailsColumns()
        {
            // to fix XSS attack
            foreach (UltraGridColumn col in grdMBEntry.Columns)
            {
                col.HTMLEncodeContent = true;
            }

            grdMBEntry.DisplayLayout.ColFootersVisibleDefault = ShowMarginInfo.Yes;
            grdMBEntry.Height = Unit.Pixel(150);

            ColumnsCollection cols = grdMBEntry.Columns;

            if (cols.Exists(&quot;ID&quot;))
                cols.FromKey(&quot;ID&quot;).Hidden = true;

            if (cols.Exists(&quot;MBookItemsID&quot;))
                cols.FromKey(&quot;MBookItemsID&quot;).Hidden = true;

            if (cols.Exists(&quot;SlNo&quot;))
            {
                cols.FromKey(&quot;SlNo&quot;).Header.Caption = &quot;Sl. No.&quot;;
                cols.FromKey(&quot;SlNo&quot;).AllowUpdate = AllowUpdate.No;
                cols.FromKey(&quot;SlNo&quot;).Width = Unit.Pixel(40);
            }

            if (cols.Exists(&quot;Description&quot;) &amp;&amp; !PageMode.Equals(&quot;View&quot;))
            {
                cols.FromKey(&quot;Description&quot;).AllowUpdate = AllowUpdate.Yes;
                cols.FromKey(&quot;Description&quot;).CellStyle.BackColor = Color.Yellow;
            }

            if (cols.Exists(&quot;Polarity&quot;))
            {
                cols.FromKey(&quot;Polarity&quot;).Header.Caption = &quot;+/-&quot;;
                cols.FromKey(&quot;Polarity&quot;).Width = Unit.Pixel(75);
                UltraGridColumn sign = cols.FromKey(&quot;Polarity&quot;);
                sign.Type = ColumnType.DropDownList;

                //If there is no mode or the mode is View then the user should not able to modify the grid column values as well as 
                //the background color will be transparent
                if (!PageMode.Equals(&quot;View&quot;))
                {
                    sign.AllowUpdate = AllowUpdate.Yes;
                    sign.CellStyle.BackColor = Color.Yellow;
                }
                sign.ValueList.DisplayStyle = ValueListDisplayStyle.DisplayText;
                sign.DataType = typeof (string).ToString2();
                var lst2 = new ValueList();
                lst2.ValueListItems.Add(&quot;+&quot;, &quot;+&quot;);
                lst2.ValueListItems.Add(&quot;-&quot;, &quot;-&quot;);
                sign.ValueList = lst2;
            }

            if (cols.Exists(&quot;Number&quot;))
            {
                if (!PageMode.Equals(&quot;View&quot;))
                {
                    cols.FromKey(&quot;Number&quot;).AllowUpdate = AllowUpdate.Yes;
                    cols.FromKey(&quot;Number&quot;).CellStyle.BackColor = Color.Yellow;
                }
                cols.FromKey(&quot;Number&quot;).Header.Caption = &quot;Number 1&quot;;
                cols.FromKey(&quot;Number&quot;).Width = Unit.Pixel(75);
                cols.FromKey(&quot;Number&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                cols.FromKey(&quot;Number&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;Number&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;Number&quot;).EditorControlID = &quot;wneNumberFormatHidden&quot;;
                cols.FromKey(&quot;Number&quot;).Type = ColumnType.Custom;
                wneNumberFormatHidden.DataMode = NumericDataMode.Decimal;
                cols.FromKey(&quot;Number&quot;).Hidden = true;
            }

            if (cols.Exists(&quot;Number2&quot;))
            {
                if (!PageMode.Equals(&quot;View&quot;))
                {
                    cols.FromKey(&quot;Number2&quot;).AllowUpdate = AllowUpdate.Yes;
                    cols.FromKey(&quot;Number2&quot;).CellStyle.BackColor = Color.Yellow;
                }
                cols.FromKey(&quot;Number2&quot;).Header.Caption = &quot;Number 2&quot;;
                cols.FromKey(&quot;Number2&quot;).Width = Unit.Pixel(75);
                cols.FromKey(&quot;Number2&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                cols.FromKey(&quot;Number2&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;Number2&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;Number2&quot;).EditorControlID = &quot;wneNumberFormatHidden&quot;;
                cols.FromKey(&quot;Number2&quot;).Type = ColumnType.Custom;
                wneNumberFormatHidden.DataMode = NumericDataMode.Decimal;
                cols.FromKey(&quot;Number2&quot;).Hidden = true;
            }

            if (cols.Exists(&quot;NumberPMember&quot;))
            {
                if (!PageMode.Equals(&quot;View&quot;))
                {
                    cols.FromKey(&quot;NumberPMember&quot;).AllowUpdate = AllowUpdate.Yes;
                    cols.FromKey(&quot;NumberPMember&quot;).CellStyle.BackColor = Color.Yellow;
                }
                cols.FromKey(&quot;NumberPMember&quot;).Width = Unit.Pixel(100);
                cols.FromKey(&quot;NumberPMember&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                cols.FromKey(&quot;NumberPMember&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;NumberPMember&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;NumberPMember&quot;).Header.Caption = &quot;Number&quot;;
                cols.FromKey(&quot;NumberPMember&quot;).EditorControlID = &quot;wneNumberFormatHidden&quot;;
                cols.FromKey(&quot;NumberPMember&quot;).Type = ColumnType.Custom;
                wneNumberFormatHidden.DataMode = NumericDataMode.Decimal;
            }

            if (chkMBRequired.Checked)
                trDims.Style.Add(&quot;display&quot;, &quot;block&quot;);

            if (cols.Exists(&quot;Length&quot;))
            {
                if (!PageMode.Equals(&quot;View&quot;))
                {
                    cols.FromKey(&quot;Length&quot;).AllowUpdate = AllowUpdate.Yes;
                    cols.FromKey(&quot;Length&quot;).CellStyle.BackColor = Color.Yellow;
                }

                if (!chkLength.Checked)
                    cols.FromKey(&quot;Length&quot;).Hidden = true;
                else
                    cols.FromKey(&quot;Length&quot;).Hidden = false;

                cols.FromKey(&quot;Length&quot;).Width = Unit.Pixel(75);
                cols.FromKey(&quot;Length&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                cols.FromKey(&quot;Length&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;Length&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;Length&quot;).EditorControlID = &quot;wneNumberFormatHidden&quot;;
                cols.FromKey(&quot;Length&quot;).Type = ColumnType.Custom;
                wneNumberFormatHidden.DataMode = NumericDataMode.Decimal;
            }

            if (cols.Exists(&quot;Height&quot;))
            {
                if (!PageMode.Equals(&quot;View&quot;))
                {
                    cols.FromKey(&quot;Height&quot;).AllowUpdate = AllowUpdate.Yes;
                    cols.FromKey(&quot;Height&quot;).CellStyle.BackColor = Color.Yellow;
                }

                if (!chkHeight.Checked)
                    cols.FromKey(&quot;Height&quot;).Hidden = true;
                else
                    cols.FromKey(&quot;Height&quot;).Hidden = false;

                cols.FromKey(&quot;Height&quot;).Width = Unit.Pixel(75);
                cols.FromKey(&quot;Height&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                cols.FromKey(&quot;Height&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;Height&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;Height&quot;).EditorControlID = &quot;wneNumberFormatHidden&quot;;
                cols.FromKey(&quot;Height&quot;).Type = ColumnType.Custom;
                wneNumberFormatHidden.DataMode = NumericDataMode.Decimal;
            }

            if (cols.Exists(&quot;Width&quot;))
            {
                if (!PageMode.Equals(&quot;View&quot;))
                {
                    cols.FromKey(&quot;Width&quot;).AllowUpdate = AllowUpdate.Yes;
                    cols.FromKey(&quot;Width&quot;).CellStyle.BackColor = Color.Yellow;
                }

                if (!chkWidth.Checked)
                    cols.FromKey(&quot;Width&quot;).Hidden = true;
                else
                    cols.FromKey(&quot;Width&quot;).Hidden = false;

                cols.FromKey(&quot;Width&quot;).Width = Unit.Pixel(75);
                cols.FromKey(&quot;Width&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;Width&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;Width&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                cols.FromKey(&quot;Width&quot;).EditorControlID = &quot;wneNumberFormatHidden&quot;;
                cols.FromKey(&quot;Width&quot;).Type = ColumnType.Custom;
                wneNumberFormatHidden.DataMode = NumericDataMode.Decimal;
            }

            if (cols.Exists(&quot;Quantity&quot;))
            {
                cols.FromKey(&quot;Quantity&quot;).Width = Unit.Pixel(75);
                cols.FromKey(&quot;Quantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                cols.FromKey(&quot;Quantity&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;Quantity&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;Quantity&quot;).Footer.Total = SummaryInfo.Sum;
                cols.FromKey(&quot;Quantity&quot;).Footer.Style.HorizontalAlign = HorizontalAlign.Right;
            }

            if (cols.Exists(&quot;ParentInstanceID&quot;))
                cols.FromKey(&quot;ParentInstanceID&quot;).Hidden = true;

            if (cols.Exists(&quot;ItemID&quot;))
                cols.FromKey(&quot;ItemID&quot;).Hidden = true;

            if (cols.Exists(&quot;ActivityID&quot;))
                cols.FromKey(&quot;ActivityID&quot;).Hidden = true;

            if (cols.Exists(&quot;SubItemID&quot;))
                cols.FromKey(&quot;SubItemID&quot;).Hidden = true;

            if (cols.Exists(&quot;Action&quot;))
                cols.FromKey(&quot;Action&quot;).Hidden = true;

            AddAttributes();

            if (PageMode.Equals(&quot;View&quot;))
            {
                txtMBookNo.ReadOnly = true;
                chkMBRequired.Enabled = chkLength.Enabled = chkHeight.Enabled = chkWidth.Enabled = false;
                trMBEntryButtons.Style.Add(&quot;display&quot;, &quot;none&quot;);
            }
        }

        private DataRow CopyMBookItemsDetailDataRow(DataRow drFrom, DataRow drTo)
        {
            drTo[&quot;ID&quot;] = drFrom[&quot;ID&quot;];
            drTo[&quot;MBookItemsID&quot;] = drFrom[&quot;MBookItemsID&quot;];
            drTo[&quot;SlNo&quot;] = drFrom[&quot;SlNo&quot;];
            drTo[&quot;Description&quot;] = (drFrom[&quot;Description&quot;].ToString() == &quot;-----&quot;) ? null : drFrom[&quot;Description&quot;];
            drTo[&quot;Polarity&quot;] = drFrom[&quot;Polarity&quot;];
            drTo[&quot;Number&quot;] = drFrom[&quot;Number&quot;];
            drTo[&quot;Number2&quot;] = drFrom[&quot;Number2&quot;];
            drTo[&quot;NumberPMember&quot;] = drFrom[&quot;NumberPMember&quot;];
            drTo[&quot;Length&quot;] = drFrom[&quot;Length&quot;];
            drTo[&quot;Width&quot;] = drFrom[&quot;Width&quot;];
            drTo[&quot;Height&quot;] = drFrom[&quot;Height&quot;];
            drTo[&quot;Quantity&quot;] = drFrom[&quot;Quantity&quot;];
            drTo[&quot;ItemID&quot;] = ItemID;
            drTo[&quot;ActivityID&quot;] = ActivityID;
            drTo[&quot;SubItemID&quot;] = SubItemID;

            return drTo;
        }

        public DataTable GetMBookItemsDetailSchema()
        {
            DataTable dtMBookItemsDetail = new BrixDataTable(&quot;MBookItemsDetail&quot;);

            dtMBookItemsDetail.Columns.AddRange(new[]
            {
                new DataColumn(&quot;ID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                new DataColumn(&quot;MBookItemsID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                new DataColumn(&quot;SlNo&quot;, Type.GetType(&quot;System.Int32&quot;)),
                new DataColumn(&quot;Description&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;Polarity&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;Number&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                new DataColumn(&quot;Number2&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                new DataColumn(&quot;NumberPMember&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                new DataColumn(&quot;Length&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                new DataColumn(&quot;Width&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                new DataColumn(&quot;Height&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                new DataColumn(&quot;Quantity&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                new DataColumn(&quot;ParentInstanceID&quot;, Type.GetType(&quot;System.Int32&quot;))
                ,
                new DataColumn(&quot;ItemID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                new DataColumn(&quot;ActivityID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                new DataColumn(&quot;SubItemID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                new DataColumn(&quot;Action&quot;, Type.GetType(&quot;System.String&quot;))
            });
            return dtMBookItemsDetail;
        }

        /// &lt;summary&gt;
        /// When the user clicks the Add button to add a Measurement Entry
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;
        protected void btnAddMBEntry_Click(object sender, EventArgs e)
        {
            grdMBEntry.DisplayLayout.AllowAddNewDefault = AllowAddNew.Yes;
        }

        protected void grdMBEntry_InitializeLayout(object sender, LayoutEventArgs e)
        {
            e.Layout.AllowAddNewDefault = AllowAddNew.Yes;
            e.Layout.AddNewBox.Hidden = true;
        }

        private void AddAttributes()
        {
            ColumnsCollection cols = grdMBEntry.Columns;
            chkMBRequired.Attributes.Add(&quot;onClick&quot;, &quot;MB_Click(); HideColumn(&#39;&quot; + cols.FromKey(&quot;Length&quot;).Index + &quot;&#39;,&#39;&quot;
                                                    + cols.FromKey(&quot;Width&quot;).Index + &quot;&#39;,&#39;&quot; + cols.FromKey(&quot;Height&quot;).Index +
                                                    &quot;&#39;,&#39;-1&#39;,&#39;&quot;
                                                    + grdMBEntry.ClientID + &quot;&#39;,&#39;&quot; + chkMBRequired.ClientID + &quot;&#39;)&quot;);
            chkLength.Attributes.Add(&quot;onClick&quot;, &quot;HideColumn(&#39;&quot; + cols.FromKey(&quot;Length&quot;).Index + &quot;&#39;,&#39;-1&#39;,&#39;-1&#39;,&#39;-1&#39;,&#39;&quot;
                                                + grdMBEntry.ClientID + &quot;&#39;,&#39;&quot; + chkLength.ClientID + &quot;&#39;)&quot;);
            chkWidth.Attributes.Add(&quot;onClick&quot;, &quot;HideColumn(&#39;&quot; + cols.FromKey(&quot;Width&quot;).Index + &quot;&#39;,&#39;-1&#39;,&#39;-1&#39;,&#39;-1&#39;,&#39;&quot;
                                               + grdMBEntry.ClientID + &quot;&#39;,&#39;&quot; + chkWidth.ClientID + &quot;&#39;)&quot;);
            chkHeight.Attributes.Add(&quot;onClick&quot;, &quot;HideColumn(&#39;&quot; + cols.FromKey(&quot;Height&quot;).Index + &quot;&#39;,&#39;-1&#39;,&#39;-1&#39;,&#39;-1&#39;,&#39;&quot;
                                                + grdMBEntry.ClientID + &quot;&#39;,&#39;&quot; + chkHeight.ClientID + &quot;&#39;)&quot;);
        }

        #region Excel Import &amp; Export

        protected DataColumn[] MBookItemsSchema()
        {
            return new[]
            {
                new DataColumn(&quot;SlNo&quot;, Type.GetType(&quot;System.Int32&quot;)),
                new DataColumn(&quot;Description&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;Polarity&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;Number&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                new DataColumn(&quot;Number2&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                new DataColumn(&quot;NumberPMember&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                new DataColumn(&quot;Length&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                new DataColumn(&quot;Width&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                new DataColumn(&quot;Height&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                new DataColumn(&quot;Quantity&quot;, Type.GetType(&quot;System.Decimal&quot;))
            };
        }

        protected void btnExport_Click(object sender, EventArgs e)
        {
            ClearEmptyRows();
            uwgExcelExporter.WorksheetName = &quot;MBookDetails&quot;;
            uwgExcelExporter.DownloadName = &quot;_MBook.XLS&quot;;
            var book = new Workbook();
            if (chkMBRequired.Checked)
            {
                //Dimensions which are checked Exported
                grdMBEntry.Columns[8].Hidden = !chkLength.Checked;
                grdMBEntry.Columns[9].Hidden = !chkWidth.Checked;
                grdMBEntry.Columns[10].Hidden = !chkHeight.Checked;
            }
            book = uwgExcelExporter.Export(grdMBEntry);
        }

        private void ClearEmptyRows()
        {
            var collection = new RowsCollection();
            foreach (UltraGridRow row in grdMBEntry.Rows)
                if ((row.Cells.FromKey(&quot;SlNo&quot;).Value == null) ||
                    (row.Cells.FromKey(&quot;SlNo&quot;).Value != null &amp;&amp;
                     string.IsNullOrEmpty(row.Cells.FromKey(&quot;SlNo&quot;).Value.ToString2())))
                    collection.Add(row);

            foreach (UltraGridRow row in collection)
                grdMBEntry.Rows.Remove(row);
        }


        protected void btnUpload_Click(object sender, EventArgs e)
        {
            if (fuExcelUpload.HasFile)
            {
                string fileName = fuExcelUpload.PostedFile.FileName;
                string fileGuid = Guid.NewGuid().ToString2();
                string extension = Path.GetExtension(fuExcelUpload.FileName);
                if (extension.Equals(&quot;.xls&quot;, StringComparison.CurrentCultureIgnoreCase))
                {
                    string filePath = fileGuid + &quot;.xls&quot;;
                    fuExcelUpload.SaveAs(Server.MapPath(filePath));

                    DataSet obj;
                    ClearEmptyRows();
                    bool status = ImportExcel(HttpContext.Current.Server.MapPath(filePath), out obj);
                    if (status)
                    {
                        SetStatusMessage(status);
                    }
                    if (obj != null &amp;&amp; status)
                    {
                        ViewState[&quot;ImportData&quot;] = obj;
                    }
                    try
                    {
                        File.Delete(Server.MapPath(filePath));
                    }
                    catch
                    {
                    }
                    SetMBookItemsDetailsColumns();
                }
                else
                {
                    SetErrorMessage(MSG_INVALID_FILE);
                }
            }
            else
            {
                SetErrorMessage(MSG_INVALID_FILE);
            }
        }

        private void SetStatusMessage(bool status)
        {
            trImportStatus.Style.Add(&quot;display&quot;, &quot;block;&quot;);
            lblImportStatus.CssClass = (status) ? &quot;lblCOk&quot; : &quot;lblCErr&quot;;
            lblImportStatus.Text = &quot;Import Succeeded&quot;;
        }

        private void SetErrorMessage(string errMessage)
        {
            trImportStatus.Style.Add(&quot;display&quot;, &quot;block;&quot;);
            lblImportStatus.Text = errMessage;
            lblImportStatus.CssClass = &quot;lblCErr&quot;;
        }

        protected DataSet GetSchema()
        {
            DataTable MBItemTab = new BrixDataTable();
            DataSet dsItems = new BrixDataSet();
            MBItemTab = dsItems.Tables.Add(&quot;DTMBookItemsDetail&quot;); //MBookItemsSchema
            MBItemTab.Columns.AddRange(MBookItemsSchema());
            return dsItems;
        }

        protected bool ImportExcel(string fileName, out DataSet dsXLSData)
        {
            DataTable dtXLSDataTable;
            bool status = true;
            dsXLSData = null;
            int tableNumber = 0;
            try
            {
                string strConn = &quot;Provider=Microsoft.Jet.OLEDB.4.0;Data Source=&quot; +
                                 fileName +
                                 &quot;;Extended Properties=&#39;Excel 8.0;HDR=Yes;IMEX=1&#39;&quot;;
                string sheetName = null;

                // Extract list of tables from Excel sheet.
                var objConn = new OleDbConnection(strConn);
                objConn.Open(); // Open connection with the database.

                #region If multiple sheets are present in the Excel choose

                DataTable dtXLSSchema = objConn.GetOleDbSchemaTable((OleDbSchemaGuid.Tables), null);
                DataSet dsSchemaSet = new BrixDataSet();
                //gets MBGrid schema
                dsSchemaSet = GetSchema();
                // Get the data table containg the schema guid.
                if ((dtXLSSchema == null) || (dtXLSSchema.Rows.Count &lt; 1))
                {
                    status = false;
                    SetErrorMessage(&quot;Import Failed.&quot;);
                    return status;
                }
                else if ((dtXLSSchema.Rows.Count) != (dsSchemaSet.Tables.Count))
                {
                    status = false;
                    SetErrorMessage(
                        &quot;Import Failed. Number of tables in Excel file does not match the required number of tables&quot;);
                    return status;
                }

                #endregion

                do
                {
                    sheetName = dtXLSSchema.Rows[tableNumber][&quot;TABLE_NAME&quot;].ToString2();

                    #region Column Schema validation...

                    DataTable dtXLSSchemaTable = new BrixDataTable();
                    var odaXLSData = new OleDbDataAdapter(&quot;SELECT top 1 * FROM [&quot; + sheetName + &quot;]&quot;, objConn);
                    odaXLSData.Fill(dtXLSSchemaTable);

                    #region check whether all columns in table are present in the excel sheet..

                    foreach (DataColumn dc in dsSchemaSet.Tables[tableNumber].Columns)
                    {
                        string colName = dc.ColumnName;
                        switch (colName)
                        {
                            case &quot;SlNo&quot;:
                                colName = &quot;Sl# No#&quot;;
                                break;
                            case &quot;Polarity&quot;:
                                colName = &quot;+/-&quot;;
                                break;
                            case &quot;Number&quot;:
                                colName = &quot;Number 1&quot;;
                                break;
                            case &quot;Number2&quot;:
                                colName = &quot;Number 2&quot;;
                                break;
                            case &quot;NumberPMember&quot;:
                                colName = &quot;Number Per Member&quot;;
                                break;
                            case &quot;Height&quot;:
                                if (!chkHeight.Checked)
                                {
                                    continue;
                                }
                                break;
                            case &quot;Width&quot;:
                                if (!chkWidth.Checked)
                                {
                                    continue;
                                }
                                break;
                            case &quot;Length&quot;:
                                if (!chkLength.Checked)
                                {
                                    continue;
                                }
                                break;
                            case &quot;Quantity&quot;:
                                continue;
                            default:
                                break;
                        }
                        if (!dtXLSSchemaTable.Columns.Contains(colName))
                        {
                            status = false;
                            SetErrorMessage(&quot;Import failed. The column \&quot;&quot; + colName +
                                            &quot;\&quot; is missing in the Excel file. &quot;);
                            return status;
                        }
                    }

                    #endregion

                    #endregion

                    #region Load Data..

                    dtXLSDataTable = new BrixDataTable();
                    foreach (DataColumn dc in dsSchemaSet.Tables[tableNumber].Columns)
                    {
                        var col = new DataColumn();
                        col.ColumnName = dc.ColumnName;
                        switch (dc.DataType.Name.ToString2().ToUpper2())
                        {
                            case &quot;INT32&quot;:
                                col.DataType = Type.GetType(&quot;System.Int32&quot;);
                                col.DefaultValue = 0;
                                break;
                            case &quot;DECIMAL&quot;:
                                col.DataType = Type.GetType(&quot;System.Decimal&quot;);
                                col.DefaultValue = 0.0;
                                break;
                            case &quot;DATETIME&quot;:
                                col.DataType = Type.GetType(&quot;System.DateTime&quot;);
                                col.DefaultValue = MWDateTimeHelper.MWToday.ToString();
                                break;
                            case &quot;DOUBLE&quot;:
                                col.DataType = Type.GetType(&quot;System.Double&quot;);
                                col.DefaultValue = 0.0;
                                break;
                            case &quot;CHAR&quot;:
                                col.DataType = Type.GetType(&quot;System.String&quot;);
                                break;
                            default:
                                col.DataType = Type.GetType(&quot;System.String&quot;);
                                col.DefaultValue = &quot;NA&quot;;
                                break;
                        }
                        col.AllowDBNull = dc.AllowDBNull;
                        dtXLSDataTable.Columns.Add(col);
                    }

                    //query to fetch data from excel sheet
                    string selectQuery = &quot;SELECT &quot;;
                    DataTable temp = new BrixDataTable();
                    foreach (DataColumn dc in dsSchemaSet.Tables[tableNumber].Columns)
                    {
                        switch (dc.ColumnName)
                        {
                            case &quot;Polarity&quot;:
                                selectQuery = selectQuery + &quot;[+/-] AS Polarity,&quot;;
                                break;
                            case &quot;SlNo&quot;:
                                selectQuery = selectQuery + &quot;[Sl# No#] AS SlNo,&quot;;
                                break;
                            case &quot;NumberPMember&quot;:
                                selectQuery = selectQuery + &quot;[Number Per Member] AS NumberPMember,&quot;;
                                break;
                            case &quot;Number&quot;:
                                selectQuery = selectQuery + &quot;[Number 1] AS [Number],&quot;;
                                break;
                            case &quot;Number2&quot;:
                                selectQuery = selectQuery + &quot;[Number 2] AS Number2,&quot;;
                                break;
                            case &quot;Height&quot;:
                                if (chkHeight.Checked)
                                    selectQuery = selectQuery + &quot;[&quot; + dc.ColumnName + &quot;],&quot;;
                                break;
                            case &quot;Width&quot;:
                                if (chkWidth.Checked)
                                    selectQuery = selectQuery + &quot;[&quot; + dc.ColumnName + &quot;],&quot;;
                                break;
                            case &quot;Length&quot;:
                                if (chkLength.Checked)
                                    selectQuery = selectQuery + &quot;[&quot; + dc.ColumnName + &quot;],&quot;;
                                break;
                            case &quot;Quantity&quot;:
                                selectQuery = selectQuery + &quot;1 AS Quantity,&quot;;
                                break;
                            default:
                                selectQuery = selectQuery + &quot;[&quot; + dc.ColumnName + &quot;],&quot;;
                                break;
                        }
                    }
                    selectQuery = selectQuery.Substring(0, selectQuery.Length - 1);
                    selectQuery = selectQuery + &quot; FROM [&quot; + sheetName + &quot;] where [Number 1] &lt;&gt; &#39;&#39;&quot;;

                    odaXLSData = new OleDbDataAdapter(selectQuery, objConn);
                    odaXLSData.Fill(dtXLSDataTable);

                    if (dsXLSData == null)
                        dsXLSData = new BrixDataSet();
                    dsXLSData.Tables.Add(dtXLSDataTable);
                    tableNumber++;
                } while (tableNumber &lt; dtXLSSchema.Rows.Count - 1);

                //Verify if the list of items in the excel matches the one in the grid.
                DataTable dtXlItems = dsXLSData.Tables[0];
                //grdMBEntry.Rows.Clear();
                RowsCollection rcgrdrows = grdMBEntry.Rows;
                DataTable dtXlerrtab = dtXlItems.Clone();
                DataTable dtXlfiltab = dtXlItems.Clone();
                int i = grdMBEntry.Rows.Count;
                decimal totalQuantity = 0;
                foreach (DataRow drxlrow in dtXlItems.Rows)
                {
                    bool rowstatus = true;

                    string pvalue = drxlrow[&quot;Polarity&quot;].ToString2();
                    if (!(pvalue.Equals(&quot;+&quot;) || pvalue.Equals(&quot;-&quot;)))
                    {
                        SetErrorMessage(&quot;Wrong input for polarity(+/-) in the Excel file.&quot;);
                        status = rowstatus = false;
                    }
                    if (drxlrow[&quot;Number&quot;].ToDecimal2() &lt; 0 || drxlrow[&quot;Number2&quot;].ToDecimal2() &lt; 0 ||
                        drxlrow[&quot;NumberPMember&quot;].ToDecimal2() &lt; 0)
                    {
                        SetErrorMessage(
                            &quot;No negative values allowed in &#39;Number 1&#39;, &#39;Number 2&#39; and &#39;Number Per Member&#39; columns.&quot;);
                        status = rowstatus = false;
                    }
                    if ((!String.IsNullOrEmpty(drxlrow[&quot;Length&quot;].ToString2()) &amp;&amp; drxlrow[&quot;Length&quot;].ToDecimal2() &lt; 0)
                        || (!String.IsNullOrEmpty(drxlrow[&quot;Height&quot;].ToString2()) &amp;&amp; drxlrow[&quot;Height&quot;].ToDecimal2() &lt; 0)
                        || (!String.IsNullOrEmpty(drxlrow[&quot;Width&quot;].ToString2()) &amp;&amp; drxlrow[&quot;Width&quot;].ToDecimal2() &lt; 0))
                    {
                        SetErrorMessage(&quot;No negative values allowed in Dimensions. Please check&quot;);
                        status = rowstatus = false;
                    }

                    if (!String.IsNullOrEmpty(drxlrow[&quot;Length&quot;].ToString2()) &amp;&amp; drxlrow[&quot;Length&quot;].ToDecimal2() &gt; 0)
                    {
                        if (!chkMBRequired.Checked)
                            chkMBRequired.Checked = true;
                        chkLength.Checked = true;
                    }

                    if (!String.IsNullOrEmpty(drxlrow[&quot;Height&quot;].ToString2()) &amp;&amp; drxlrow[&quot;Height&quot;].ToDecimal2() &gt; 0)
                    {
                        if (!chkMBRequired.Checked)
                            chkMBRequired.Checked = true;
                        chkHeight.Checked = true;
                    }

                    if (!String.IsNullOrEmpty(drxlrow[&quot;Width&quot;].ToString2()) &amp;&amp; drxlrow[&quot;Width&quot;].ToDecimal2() &gt; 0)
                    {
                        if (!chkMBRequired.Checked)
                            chkMBRequired.Checked = true;
                        chkWidth.Checked = true;
                    }

                    if (rowstatus)
                    {
                        var urg = new UltraGridRow(new object[11]);
                        grdMBEntry.Rows.Add(urg);
                        rcgrdrows[i].Cells.FromKey(&quot;ID&quot;).Value = -1;
                        rcgrdrows[i].Cells.FromKey(&quot;MBookItemsID&quot;).Value = MBookItemID;
                        rcgrdrows[i].Cells.FromKey(&quot;ItemID&quot;).Value = ItemID;
                        rcgrdrows[i].Cells.FromKey(&quot;ActivityID&quot;).Value = ActivityID;
                        rcgrdrows[i].Cells.FromKey(&quot;SubItemID&quot;).Value = SubItemID;
                        rcgrdrows[i].Cells.FromKey(&quot;SlNo&quot;).Value = i + 1;
                        rcgrdrows[i].Cells.FromKey(&quot;Description&quot;).Value = drxlrow[&quot;Description&quot;].ToString2();
                        rcgrdrows[i].Cells.FromKey(&quot;Polarity&quot;).Value = drxlrow[&quot;Polarity&quot;].ToString2();
                        rcgrdrows[i].Cells.FromKey(&quot;Number&quot;).Value = drxlrow[&quot;Number&quot;].ToDecimal2();
                        rcgrdrows[i].Cells.FromKey(&quot;Number2&quot;).Value = drxlrow[&quot;Number2&quot;].ToDecimal2();
                        rcgrdrows[i].Cells.FromKey(&quot;NumberPMember&quot;).Value = drxlrow[&quot;NumberPMember&quot;].ToDecimal2();
                        rcgrdrows[i].Cells.FromKey(&quot;Length&quot;).Value =
                            !String.IsNullOrEmpty(drxlrow[&quot;Length&quot;].ToString2())
                                ? (drxlrow[&quot;Length&quot;].ToDecimal2() &gt; 0 ? drxlrow[&quot;Length&quot;].ToDecimal2() : 1)
                                : 1;
                        rcgrdrows[i].Cells.FromKey(&quot;Height&quot;).Value =
                            !String.IsNullOrEmpty(drxlrow[&quot;Height&quot;].ToString2())
                                ? (drxlrow[&quot;Height&quot;].ToDecimal2() &gt; 0 ? drxlrow[&quot;Height&quot;].ToDecimal2() : 1)
                                : 1;
                        rcgrdrows[i].Cells.FromKey(&quot;Width&quot;).Value = !String.IsNullOrEmpty(drxlrow[&quot;Width&quot;].ToString2())
                            ? (drxlrow[&quot;Width&quot;].ToDecimal2() &gt; 0
                                ? drxlrow[&quot;Width&quot;].ToDecimal2()
                                : 1)
                            : 1;
                        rcgrdrows[i].Cells.FromKey(&quot;Quantity&quot;).Value = drxlrow[&quot;Polarity&quot;].ToString2() +
                                                                       rcgrdrows[i].Cells.FromKey(&quot;NumberPMember&quot;).Value
                                                                           .ToDecimal2()*
                                                                       rcgrdrows[i].Cells.FromKey(&quot;Number&quot;).Value.
                                                                           ToDecimal2()*
                                                                       rcgrdrows[i].Cells.FromKey(&quot;Number2&quot;).Value.
                                                                           ToDecimal2()*
                                                                       rcgrdrows[i].Cells.FromKey(&quot;Length&quot;).Value.
                                                                           ToDecimal2()*
                                                                       rcgrdrows[i].Cells.FromKey(&quot;Height&quot;).Value.
                                                                           ToDecimal2()*
                                                                       rcgrdrows[i].Cells.FromKey(&quot;Width&quot;).Value.
                                                                           ToDecimal2();
                        totalQuantity = totalQuantity + rcgrdrows[i].Cells.FromKey(&quot;Quantity&quot;).Value.ToDecimal2();
                        i++;
                    }
                    else
                    {
                        dtXlerrtab.ImportRow(drxlrow);
                    }
                }
                return status;
            }
            catch (Exception ex)
            {
                SetErrorMessage(ex.Message);
                return false;
            }

            #endregion
        }

        #endregion
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[30,17,30,18,0],[30,19,30,63,0],[30,64,30,65,0],[31,17,31,18,0],[31,19,31,59,0],[31,60,31,61,0],[36,17,36,18,0],[36,19,36,58,0],[36,59,36,60,0],[37,17,37,18,0],[37,19,37,54,0],[37,55,37,56,0],[42,17,42,18,0],[42,19,42,53,0],[42,54,42,55,0],[43,17,43,18,0],[43,19,43,49,0],[43,50,43,51,0],[48,17,48,18,0],[48,19,48,57,0],[48,58,48,59,0],[49,17,49,18,0],[49,19,49,53,0],[49,54,49,55,0],[54,17,54,18,0],[54,19,54,56,0],[54,57,54,58,0],[55,17,55,18,0],[55,19,55,52,0],[55,53,55,54,0],[60,17,60,18,0],[60,19,60,64,0],[60,65,60,66,0],[61,17,61,18,0],[61,19,61,56,0],[61,57,61,58,0],[66,17,66,18,0],[66,19,66,57,0],[66,58,66,59,0],[67,17,67,18,0],[67,19,67,50,0],[67,51,67,52,0],[72,17,72,18,0],[72,19,72,58,0],[72,59,72,60,0],[73,17,73,18,0],[73,19,73,51,0],[73,52,73,53,0],[78,17,78,18,0],[78,19,78,65,0],[78,66,78,67,0],[79,17,79,18,0],[79,19,79,55,0],[79,56,79,57,0],[84,17,84,18,0],[84,19,84,71,0],[84,72,84,73,0],[85,17,85,18,0],[85,19,85,61,0],[85,62,85,63,0],[90,17,90,18,0],[90,19,90,79,0],[90,80,90,81,0],[91,17,91,18,0],[91,19,91,69,0],[91,70,91,71,0],[96,17,96,18,0],[96,19,96,67,0],[96,68,96,69,0],[97,17,97,18,0],[97,19,97,66,0],[97,67,97,68,0],[102,17,102,18,0],[102,19,102,55,0],[102,56,102,57,0],[103,17,103,18,0],[103,19,103,50,0],[103,51,103,52,0],[108,17,108,18,0],[108,19,108,54,0],[108,55,108,56,0],[109,17,109,18,0],[109,19,109,49,0],[109,50,109,51,0],[114,17,114,18,0],[114,19,114,55,0],[114,56,114,57,0],[115,17,115,18,0],[115,19,115,50,0],[115,51,115,52,0],[119,9,119,10,1],[121,13,121,60,1],[122,13,123,108,1],[124,13,124,110,1],[126,13,126,68,1],[128,13,128,34,1],[129,13,129,14,1],[130,17,130,63,1],[131,17,131,86,1],[132,13,132,14,1],[133,9,133,10,1],[136,9,136,10,0],[137,13,137,45,0],[138,13,138,14,0],[140,22,140,31,0],[140,33,140,60,0],[140,62,140,65,0],[141,17,141,18,0],[142,21,142,92,0],[143,21,148,86,0],[149,21,149,22,0],[150,25,150,75,0],[151,25,151,98,0],[152,25,152,87,0],[153,25,153,85,0],[154,25,154,87,0],[156,25,156,51,0],[157,25,160,33,0],[162,25,162,55,0],[163,25,163,53,0],[164,25,164,55,0],[166,25,166,70,0],[168,25,168,31,0],[170,17,170,18,0],[171,13,171,14,0],[174,13,174,55,0],[175,9,175,10,0],[178,9,178,10,0],[179,13,181,83,0],[182,13,182,60,0],[184,13,184,35,0],[185,13,185,14,0],[186,17,189,36,0],[190,17,192,36,0],[193,17,195,36,0],[196,17,198,36,0],[199,17,201,36,0],[202,17,204,36,0],[205,17,207,29,0],[208,17,210,29,0],[211,17,213,29,0],[214,17,216,29,0],[217,17,219,26,0],[220,17,222,26,0],[223,17,225,26,0],[226,13,226,14,0],[228,13,228,34,0],[229,13,229,14,0],[230,17,230,58,0],[231,13,231,14,0],[233,13,233,33,0],[234,13,234,14,0],[235,17,235,58,0],[236,13,236,14,0],[239,13,239,35,0],[240,13,240,14,0],[241,17,241,76,0],[242,21,242,70,0],[243,17,243,80,0],[244,21,244,74,0],[245,17,245,79,0],[246,21,246,73,0],[248,17,249,51,0],[250,17,250,77,0],[251,17,251,113,0],[253,17,253,57,0],[254,17,254,18,0],[255,26,255,35,0],[255,37,255,72,0],[255,74,255,77,0],[256,21,256,22,0],[258,25,258,90,0],[259,29,260,63,0],[263,25,263,26,0],[264,34,264,43,0],[264,45,264,78,0],[264,80,264,83,0],[265,29,265,30,0],[266,33,267,83,0],[268,33,268,34,0],[269,37,269,73,0],[270,37,270,72,0],[271,37,271,102,0],[272,41,274,79,0],[275,37,275,43,0],[277,29,277,30,0],[278,25,278,26,0],[279,21,279,22,0],[280,17,280,18,0],[281,17,281,75,0],[282,13,282,14,0],[284,13,284,14,0],[285,17,288,57,0],[289,13,289,14,0],[290,13,290,35,0],[291,13,291,43,0],[292,9,292,10,0],[299,9,299,10,0],[301,13,301,35,0],[302,13,302,14,0],[305,17,308,94,0],[309,17,309,54,0],[310,17,310,18,0],[311,21,311,42,0],[312,26,312,35,0],[312,37,312,70,0],[312,72,312,75,0],[313,21,313,22,0],[314,25,314,76,0],[315,25,319,98,0],[320,25,320,26,0],[321,29,321,52,0],[322,29,322,64,0],[323,29,323,44,0],[325,29,325,33,0],[326,25,326,26,0],[328,25,328,74,0],[329,29,329,35,0],[330,21,330,22,0],[331,17,331,18,0],[334,22,334,31,0],[334,33,334,58,0],[334,60,334,63,0],[335,17,335,18,0],[336,21,336,66,0],[337,21,337,78,0],[338,21,338,98,0],[339,17,339,18,0],[340,13,340,14,0],[343,13,343,14,0],[346,17,346,110,0],[348,17,348,54,0],[349,17,349,18,0],[350,21,350,42,0],[351,26,351,35,0],[351,37,351,70,0],[351,72,351,75,0],[352,21,352,22,0],[353,25,353,76,0],[354,25,354,86,0],[355,25,355,26,0],[356,29,356,52,0],[357,29,357,64,0],[358,29,358,44,0],[360,29,360,33,0],[361,25,361,26,0],[363,25,363,74,0],[364,29,364,35,0],[365,21,365,22,0],[366,17,366,18,0],[368,22,368,31,0],[368,33,368,58,0],[368,60,368,63,0],[369,17,369,18,0],[370,21,370,66,0],[373,21,375,80,0],[376,21,376,22,0],[377,25,377,82,0],[378,25,378,102,0],[379,21,379,22,0],[382,21,382,22,0],[383,25,384,123,0],[385,25,422,87,0],[423,25,423,26,0],[424,29,424,86,0],[425,29,425,106,0],[426,25,426,26,0],[427,21,427,22,0],[428,17,428,18,0],[431,22,431,31,0],[431,33,431,74,0],[431,76,431,79,0],[432,17,432,18,0],[433,21,433,114,0],[434,21,434,22,0],[435,25,438,37,0],[438,37,441,85,0],[441,85,441,87,0],[435,25,441,87,0],[442,25,442,48,0],[443,25,443,26,0],[444,29,444,86,0],[445,29,447,41,0],[448,25,448,26,0],[449,21,449,22,0],[450,17,450,18,0],[451,13,451,14,0],[452,9,452,10,0],[464,9,464,10,0],[465,13,469,72,0],[470,13,470,62,0],[471,13,473,70,0],[474,13,477,76,0],[478,13,480,73,0],[481,13,483,71,0],[484,13,486,72,0],[487,13,490,78,0],[491,13,493,71,0],[494,13,496,70,0],[497,13,499,71,0],[500,13,502,73,0],[503,13,503,71,0],[504,13,504,51,0],[505,13,505,59,0],[506,13,506,57,0],[507,13,507,51,0],[509,13,509,61,0],[510,9,510,10,0],[513,9,513,10,0],[515,13,515,20,0],[515,22,515,41,0],[515,42,515,44,0],[515,45,515,63,0],[516,13,516,14,0],[517,17,517,46,0],[518,13,518,14,0],[520,13,520,84,0],[521,13,521,49,0],[523,13,523,57,0],[525,13,525,35,0],[526,17,526,50,0],[528,13,528,45,0],[529,17,529,60,0],[531,13,531,37,0],[532,13,532,14,0],[533,17,533,65,0],[534,17,534,67,0],[535,17,535,61,0],[536,13,536,14,0],[538,13,538,72,0],[539,13,539,14,0],[540,17,540,75,0],[541,17,541,80,0],[542,13,542,14,0],[544,13,544,41,0],[545,13,545,14,0],[546,17,546,65,0],[547,17,547,65,0],[548,17,548,65,0],[549,17,549,53,0],[553,17,553,46,0],[554,17,554,18,0],[555,21,555,56,0],[556,21,556,61,0],[557,17,557,18,0],[558,17,558,81,0],[559,17,559,61,0],[560,17,560,44,0],[561,17,561,51,0],[562,17,562,51,0],[563,17,563,39,0],[564,13,564,14,0],[566,13,566,39,0],[567,13,567,14,0],[568,17,568,46,0],[569,17,569,18,0],[570,21,570,74,0],[571,21,571,79,0],[572,17,572,18,0],[573,17,573,68,0],[574,17,574,63,0],[575,17,575,98,0],[576,17,576,93,0],[577,17,577,90,0],[578,17,578,82,0],[579,17,579,65,0],[580,17,580,74,0],[581,17,581,54,0],[582,13,582,14,0],[584,13,584,40,0],[585,13,585,14,0],[586,17,586,46,0],[587,17,587,18,0],[588,21,588,75,0],[589,21,589,80,0],[590,17,590,18,0],[591,17,591,69,0],[592,17,592,64,0],[593,17,593,99,0],[594,17,594,94,0],[595,17,595,91,0],[596,17,596,83,0],[597,17,597,66,0],[598,17,598,74,0],[599,17,599,55,0],[600,13,600,14,0],[602,13,602,46,0],[603,13,603,14,0],[604,17,604,46,0],[605,17,605,18,0],[606,21,606,81,0],[607,21,607,86,0],[608,17,608,18,0],[609,17,609,71,0],[610,17,610,105,0],[611,17,611,100,0],[612,17,612,97,0],[613,17,613,73,0],[614,17,614,89,0],[615,17,615,72,0],[616,17,616,74,0],[617,13,617,14,0],[619,13,619,39,0],[620,17,620,54,0],[622,13,622,39,0],[623,13,623,14,0],[624,17,624,46,0],[625,17,625,18,0],[626,21,626,74,0],[627,21,627,79,0],[628,17,628,18,0],[630,17,630,40,0],[631,21,631,58,0],[633,21,633,59,0],[635,17,635,63,0],[636,17,636,98,0],[637,17,637,93,0],[638,17,638,90,0],[639,17,639,82,0],[640,17,640,65,0],[641,17,641,74,0],[642,13,642,14,0],[644,13,644,39,0],[645,13,645,14,0],[646,17,646,46,0],[647,17,647,18,0],[648,21,648,74,0],[649,21,649,79,0],[650,17,650,18,0],[652,17,652,40,0],[653,21,653,58,0],[655,21,655,59,0],[657,17,657,63,0],[658,17,658,98,0],[659,17,659,93,0],[660,17,660,90,0],[661,17,661,82,0],[662,17,662,65,0],[663,17,663,74,0],[664,13,664,14,0],[666,13,666,38,0],[667,13,667,14,0],[668,17,668,46,0],[669,17,669,18,0],[670,21,670,73,0],[671,21,671,78,0],[672,17,672,18,0],[674,17,674,39,0],[675,21,675,57,0],[677,21,677,58,0],[679,17,679,62,0],[680,17,680,92,0],[681,17,681,89,0],[682,17,682,97,0],[683,17,683,81,0],[684,17,684,64,0],[685,17,685,74,0],[686,13,686,14,0],[688,13,688,41,0],[689,13,689,14,0],[690,17,690,65,0],[691,17,691,100,0],[692,17,692,95,0],[693,17,693,92,0],[694,17,694,73,0],[695,17,695,95,0],[696,13,696,14,0],[698,13,698,49,0],[699,17,699,64,0],[701,13,701,39,0],[702,17,702,54,0],[704,13,704,43,0],[705,17,705,58,0],[707,13,707,42,0],[708,17,708,57,0],[710,13,710,39,0],[711,17,711,54,0],[713,13,713,29,0],[715,13,715,41,0],[716,13,716,14,0],[717,17,717,44,0],[718,17,718,106,0],[719,17,719,63,0],[720,13,720,14,0],[721,9,721,10,0],[724,9,724,10,0],[725,13,725,39,0],[726,13,726,59,0],[727,13,727,43,0],[728,13,728,112,0],[729,13,729,51,0],[730,13,730,47,0],[731,13,731,49,0],[732,13,732,61,0],[733,13,733,47,0],[734,13,734,45,0],[735,13,735,47,0],[736,13,736,51,0],[737,13,737,37,0],[738,13,738,45,0],[739,13,739,43,0],[741,13,741,25,0],[742,9,742,10,0],[745,9,745,10,0],[746,13,746,82,0],[748,13,768,16,0],[769,13,769,39,0],[770,9,770,10,0],[778,9,778,10,0],[779,13,779,75,0],[780,9,780,10,0],[783,9,783,10,0],[784,13,784,59,0],[785,13,785,46,0],[786,9,786,10,0],[789,9,789,10,0],[790,13,790,57,0],[791,13,794,116,0],[795,13,796,108,0],[797,13,798,106,0],[799,13,800,108,0],[801,9,801,10,0],[806,9,806,10,0],[807,13,819,15,0],[820,9,820,10,0],[823,9,823,10,0],[824,13,824,30,0],[825,13,825,61,0],[826,13,826,58,0],[827,13,827,39,0],[828,13,828,39,0],[829,13,829,14,0],[831,17,831,67,0],[832,17,832,66,0],[833,17,833,68,0],[834,13,834,14,0],[835,13,835,56,0],[836,9,836,10,0],[839,9,839,10,0],[840,13,840,51,0],[841,13,841,20,0],[841,22,841,38,0],[841,39,841,41,0],[841,42,841,57,0],[842,17,844,89,0],[845,21,845,41,0],[847,13,847,20,0],[847,22,847,38,0],[847,39,847,41,0],[847,42,847,52,0],[848,17,848,45,0],[849,9,849,10,0],[853,9,853,10,0],[854,13,854,39,0],[855,13,855,14,0],[856,17,856,69,0],[857,17,857,62,0],[858,17,858,78,0],[859,17,859,89,0],[860,17,860,18,0],[861,21,861,57,0],[862,21,862,68,0],[865,21,865,38,0],[866,21,866,102,0],[867,21,867,32,0],[868,21,868,22,0],[869,25,869,50,0],[870,21,870,22,0],[871,21,871,47,0],[872,21,872,22,0],[873,25,873,55,0],[874,21,874,22,0],[876,21,876,22,0],[877,25,877,63,0],[878,21,878,22,0],[879,21,879,26,0],[880,21,880,22,0],[881,21,881,22,0],[882,21,882,51,0],[883,17,883,18,0],[885,17,885,18,0],[886,21,886,55,0],[887,17,887,18,0],[888,13,888,14,0],[890,13,890,14,0],[891,17,891,51,0],[892,13,892,14,0],[893,9,893,10,0],[896,9,896,10,0],[897,13,897,59,0],[898,13,898,72,0],[899,13,899,55,0],[900,9,900,10,0],[903,9,903,10,0],[904,13,904,59,0],[905,13,905,47,0],[906,13,906,50,0],[907,9,907,10,0],[910,9,910,10,0],[911,13,911,55,0],[912,13,912,49,0],[913,13,913,66,0],[914,13,914,60,0],[915,13,915,28,0],[916,9,916,10,0],[919,9,919,10,0],[921,13,921,32,0],[922,13,922,30,0],[923,13,923,33,0],[925,13,925,14,0],[926,17,928,84,0],[929,17,929,41,0],[932,17,932,60,0],[933,17,933,32,0],[937,17,937,101,0],[938,17,938,57,0],[940,17,940,43,0],[942,17,942,75,0],[943,17,943,18,0],[944,21,944,36,0],[945,21,945,55,0],[946,21,946,35,0],[948,22,948,81,0],[949,17,949,18,0],[950,21,950,36,0],[951,21,952,119,0],[953,21,953,35,0],[959,17,959,18,0],[960,21,960,89,0],[964,21,964,70,0],[965,21,965,111,0],[966,21,966,55,0],[970,21,970,28,0],[970,30,970,43,0],[970,44,970,46,0],[970,47,970,86,0],[971,21,971,22,0],[972,25,972,56,0],[973,25,973,41,0],[976,33,976,53,0],[977,33,977,39,0],[979,33,979,49,0],[980,33,980,39,0],[982,33,982,54,0],[983,33,983,39,0],[985,33,985,54,0],[986,33,986,39,0],[988,33,988,63,0],[989,33,989,39,0],[991,33,991,56,0],[992,33,992,34,0],[993,37,993,46,0],[995,33,995,39,0],[997,33,997,55,0],[998,33,998,34,0],[999,37,999,46,0],[1001,33,1001,39,0],[1003,33,1003,56,0],[1004,33,1004,34,0],[1005,37,1005,46,0],[1007,33,1007,39,0],[1009,33,1009,42,0],[1011,33,1011,39,0],[1013,25,1013,73,0],[1014,25,1014,26,0],[1015,29,1015,44,0],[1016,29,1017,82,0],[1018,29,1018,43,0],[1020,21,1020,22,0],[1028,21,1028,58,0],[1029,21,1029,28,0],[1029,30,1029,43,0],[1029,44,1029,46,0],[1029,47,1029,86,0],[1030,21,1030,22,0],[1031,25,1031,52,0],[1032,25,1032,56,0],[1033,25,1033,73,0],[1036,33,1036,77,0],[1037,33,1037,54,0],[1038,33,1038,39,0],[1040,33,1040,79,0],[1041,33,1041,56,0],[1042,33,1042,39,0],[1044,33,1044,80,0],[1045,33,1045,88,0],[1046,33,1046,39,0],[1048,33,1048,78,0],[1049,33,1049,56,0],[1050,33,1050,39,0],[1052,33,1052,78,0],[1053,33,1053,39,0],[1055,33,1055,78,0],[1056,33,1056,57,0],[1057,33,1057,39,0],[1059,25,1059,58,0],[1060,25,1060,57,0],[1061,21,1061,22,0],[1064,21,1064,52,0],[1065,21,1065,58,0],[1066,21,1066,28,0],[1066,30,1066,43,0],[1066,44,1066,46,0],[1066,47,1066,86,0],[1067,21,1067,22,0],[1068,25,1068,47,0],[1071,33,1071,82,0],[1072,33,1072,39,0],[1074,33,1074,82,0],[1075,33,1075,39,0],[1077,33,1077,101,0],[1078,33,1078,39,0],[1080,33,1080,87,0],[1081,33,1081,39,0],[1083,33,1083,86,0],[1084,33,1084,39,0],[1086,33,1086,55,0],[1087,37,1087,92,0],[1088,33,1088,39,0],[1090,33,1090,54,0],[1091,37,1091,92,0],[1092,33,1092,39,0],[1094,33,1094,55,0],[1095,37,1095,92,0],[1096,33,1096,39,0],[1098,33,1098,78,0],[1099,33,1099,39,0],[1101,33,1101,88,0],[1102,33,1102,39,0],[1104,21,1104,22,0],[1105,21,1105,84,0],[1106,21,1106,100,0],[1108,21,1108,77,0],[1109,21,1109,53,0],[1111,21,1111,43,0],[1112,25,1112,55,0],[1113,21,1113,58,0],[1114,21,1114,35,0],[1115,17,1115,18,0],[1115,19,1115,68,0],[1118,17,1118,59,0],[1120,17,1120,60,0],[1121,17,1121,58,0],[1122,17,1122,58,0],[1123,17,1123,47,0],[1124,17,1124,43,0],[1125,17,1125,24,0],[1125,26,1125,41,0],[1125,42,1125,44,0],[1125,45,1125,59,0],[1126,17,1126,18,0],[1127,21,1127,43,0],[1129,21,1129,69,0],[1130,21,1130,69,0],[1131,21,1131,22,0],[1132,25,1132,93,0],[1133,25,1133,52,0],[1134,21,1134,22,0],[1135,21,1136,67,0],[1137,21,1137,22,0],[1138,25,1139,118,0],[1140,25,1140,52,0],[1141,21,1141,22,0],[1142,21,1144,119,0],[1145,21,1145,22,0],[1146,25,1146,99,0],[1147,25,1147,52,0],[1148,21,1148,22,0],[1150,21,1150,116,0],[1151,21,1151,22,0],[1152,25,1152,52,0],[1153,29,1153,58,0],[1154,25,1154,50,0],[1155,21,1155,22,0],[1157,21,1157,116,0],[1158,21,1158,22,0],[1159,25,1159,52,0],[1160,29,1160,58,0],[1161,25,1161,50,0],[1162,21,1162,22,0],[1164,21,1164,114,0],[1165,21,1165,22,0],[1166,25,1166,52,0],[1167,29,1167,58,0],[1168,25,1168,49,0],[1169,21,1169,22,0],[1171,21,1171,35,0],[1172,21,1172,22,0],[1173,25,1173,68,0],[1174,25,1174,50,0],[1175,25,1175,69,0],[1176,25,1176,88,0],[1177,25,1177,77,0],[1178,25,1178,85,0],[1179,25,1179,83,0],[1180,25,1180,74,0],[1181,25,1181,110,0],[1182,25,1182,104,0],[1183,25,1183,101,0],[1184,25,1184,103,0],[1185,25,1185,115,0],[1186,25,1189,37,0],[1190,25,1193,37,0],[1194,25,1198,33,0],[1199,25,1211,89,0],[1212,25,1212,115,0],[1213,25,1213,29,0],[1214,21,1214,22,0],[1216,21,1216,22,0],[1217,25,1217,55,0],[1218,21,1218,22,0],[1219,17,1219,18,0],[1220,17,1220,31,0],[1222,13,1222,33,0],[1223,13,1223,14,0],[1224,17,1224,45,0],[1225,17,1225,30,0],[1229,9,1229,10,0]]);
    </script>
  </body>
</html>