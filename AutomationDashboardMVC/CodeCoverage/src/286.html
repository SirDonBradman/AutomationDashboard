<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Construction Vertical\Addon Modules\Contract Manager\RFI\NewRFI.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Drawing;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Text.RegularExpressions;
using System.Threading;
using System.Web;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core.AbstractModels;
using Aurigo.AMP3.Core.UserControls;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.Brix.Construction.ContractManager.RFI.DTO;
using Aurigo.Brix.Constructon.RFI;
using Aurigo.Brix.Core.WebUiHelper;
using Aurigo.Brix.Platform.BusinessLayer.DataResouces;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.Common;
using Infragistics.WebUI.UltraWebGrid;
using Infragistics.WebUI.WebSchedule;
using Infragistics.WebUI.WebDataInput;
using Aurigo.Brix.Platform.BusinessLayer.BL;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.Brix.Platform.BusinessLayer.AbstractModels;

namespace Aurigo.Brix.Construction.ContractManager.RFI
{
    public partial class NewRFI : BrixPageBase, IXMLControl, IWorkflowEnabled
    {
        public static int pageno;
        protected HierarchicalGrid HGrid;
        protected ModalPopupExtender PopupExtender;
        protected ModalPopupExtender PostingsPopupExtender;
        protected Attachments RFIAttachments;
        private decimal actualQty;
        protected WebDateChooser wdcCreatedDate, wdcInspectionDate, wdcCreatedOn, wdcSubmittedDate, wdcReceivedDate, wdcApprovedDate;
        protected WebMaskEdit wmeReceivedTime, wmeInspectionTime;
        protected UltraWebGrid gridActivity, gridActivities, gridPostings;

        private List&lt;Container&gt; collection;
        //RFIStatus? action = null;
        private int itemSource; /* 1 --&gt; Contract Items
                            2 --&gt; Posting Items */

        private int itemType;
        /* 1 --&gt; Contract List
                2 --&gt; Execution List
                3 --&gt; Approved Postings */

        protected ItemListModel listModel;
        private int rfiID;
        private MeasurementEntry userControlMeasurementEntry;
        private InspectionDetails usercontrolInspectionDetails;

        #region &quot;ToolBar Menu&quot;

        protected override void CreateChildControls()
        {
            //var menus = new MenuArray();

            //menus.Add(new BrixMenu(&quot;lnkSave&quot;, &quot;Save&quot;, &quot;Icn_Save.png&quot;, 55));
            //menus.Add(new BrixMenu(&quot;lnkCancel&quot;, &quot;Cancel&quot;, &quot;Icn_Cancel.png&quot;, 55));

            //menus.Add(new BrixMenu(&quot;lnkUserControlDone&quot;, &quot;Done&quot;, &quot;Icn_Save.png&quot;, 55));
            //menus.Add(new BrixMenu(&quot;lnkUserControlCancel&quot;, &quot;Cancel&quot;, &quot;Icn_Cancel.png&quot;, 55));

            //menus.Add(new BrixMenu(&quot;lnkFilter&quot;, &quot;Filter&quot;, &quot;Icn_Filter.png&quot;, 70));
            // menus.Add(new BrixMenu(&quot;lnkFilterClr&quot;, &quot;Remove Filter&quot;, &quot;Icn_FilterRem.png&quot;, 70));

            var MenuGroupList = new List&lt;MenuGroup&gt;();

            MenuGroup GeneralGroup = new MenuGroup(&quot;General&quot;);
            if (AllowSave)
                GeneralGroup.AddMenu(new LargeButton(&quot;lnkSave&quot;, &quot;Save&quot;, &quot;Icn_Save.png&quot;));
            GeneralGroup.AddMenu(new LargeButton(&quot;lnkCancel&quot;, &quot;Cancel&quot;, &quot;Icn_Cancel.png&quot;));
            GeneralGroup.AddMenu(new LargeButton(&quot;lnkUserControlDone&quot;, &quot;Done&quot;, &quot;Icn_Save.png&quot;));
            GeneralGroup.AddMenu(new LargeButton(&quot;lnkUserControlCancel&quot;, &quot;Cancel&quot;, &quot;Icn_Cancel.png&quot;));

            LargeButton FilterGroup = new LargeButton(&quot;lnkFilter&quot;, &quot;Filter&quot;, &quot;Icn_Filter.png&quot;);
            FilterGroup.AddSubMenu(new LargeButton(&quot;lnkFilterClr&quot;, &quot;Remove Filter&quot;, &quot;Icn_Filterremove_16.png&quot;));
            GeneralGroup.AddMenu(FilterGroup);

            MenuGroupList.Add(GeneralGroup);

            CreateToolBarMenu(MenuGroupList, null);

            SetPopUpDetails();

            InitFilter();

            RegisterStartupScript(&quot;showHideFilterButtons(&#39;&quot; +
                    MainToolBar.GetMenuReference(&quot;lnkFilter&quot;).ClientID + &quot;&#39;, &#39;&quot; +
                    MainToolBar.GetMenuReference(&quot;lnkFilterClr&quot;).ClientID + &quot;&#39;);&quot;, aspPnlFilter, &quot;showHideFilterButtons&quot;);
            base.CreateChildControls();
        }

        private void SetPopUpDetails()
        {
            //PopupExtender = (ModalPopupExtender)this.Master.FindControl(&quot;filterExtender&quot;);
            PopupExtender.Visible = true;
            PopupExtender.AddNewPopup(aspPnl.ClientID, btnHelper.ClientID, btnActCancel.ClientID, 300, 550);

            //PostingsPopupExtender = (ModalPopupExtender)this.Master.FindControl(&quot;subFilterExtender&quot;);
            PostingsPopupExtender.AddNewPopup(pnlPostings.ClientID, btnPostingsHelper.ClientID,
                                              btnPostingsCancel.ClientID, 300, 550, &quot;Postings&quot;);

            if (MainToolBar.GetMenuReference(&quot;lnkFilter&quot;) != null &amp;&amp;
                MainToolBar.GetMenuReference(&quot;lnkFilterClr&quot;) != null)
            {
                //Commented since the remove filter dropdown is not coming
                //MainToolBar.GetMenuReference(&quot;lnkFilterClr&quot;).Style.Add(&quot;display&quot;, &quot;none&quot;);
                PopupExtender.AddNewPopup(aspPnlFilter.ClientID, MainToolBar.GetMenuReference(&quot;lnkFilter&quot;).ClientID,
                                          btnCancel.ClientID, 300, 400);
                btnFilter.OnClientClick = &quot;document.getElementById(&#39;&quot; + btnCancel.ClientID + &quot;&#39;).click();applyFilter(&#39;&quot; +
                                          btnFilterGhost.ClientID + &quot;&#39;, &#39;&quot; +
                                          MainToolBar.GetMenuReference(&quot;lnkFilter&quot;).ClientID + &quot;&#39;, &#39;&quot; +
                                          MainToolBar.GetMenuReference(&quot;lnkFilterClr&quot;).ClientID + &quot;&#39;);return false;&quot;;
                btnReset.Attributes.Add(&quot;onClick&quot;,
                                        &quot;document.getElementById(&#39;&quot; + btnCancel.ClientID +
                                        &quot;&#39;).click();return resetFilters(&#39;&quot; + btnFilterGhost.ClientID + &quot;&#39;, &#39;&quot; +
                                        MainToolBar.GetMenuReference(&quot;lnkFilter&quot;).ClientID + &quot;&#39;, &#39;&quot; +
                                        MainToolBar.GetMenuReference(&quot;lnkFilterClr&quot;).ClientID + &quot;&#39;);&quot;);
                MainToolBar.GetMenuReference(&quot;lnkFilterClr&quot;).OnClientClick = &quot;return resetFilters(&#39;&quot; +
                                                                             btnFilterGhost.ClientID + &quot;&#39;, &#39;&quot; +
                                                                             MainToolBar.GetMenuReference(&quot;lnkFilter&quot;).
                                                                                 ClientID + &quot;&#39;, &#39;&quot; +
                                                                             MainToolBar.GetMenuReference(&quot;lnkFilterClr&quot;)
                                                                                 .ClientID + &quot;&#39;);&quot;;
            }
            PopupExtender.Title = ((Request[hdnPickerClicked.ClientID] ?? &quot;R&quot;).Equals(&quot;P&quot;)) ? &quot;Filter&quot; : &quot;Activities&quot;;
        }

        private void InitFilter()
        {
            ClientScript.RegisterArrayDeclaration(&quot;FilterFields&quot;,
                                                  ModelHelper.GetFilterHtml(tblFilter, GetApplyFilterLabels()));
        }

        private BrixFilter[] GetApplyFilterLabels()
        {
            var filters = new BrixFilter[2];
            filters[0] = new BrixFilter();
            filters[0].Name = &quot;StandardItemNo&quot;;
            filters[0].Title = PayItemNo;
            filters[0].FilterType = BrixFilter.Type.Text;

            filters[1] = new BrixFilter();
            filters[1].Title = filters[1].Name = &quot;Description&quot;;
            filters[1].FilterType = BrixFilter.Type.Text;


            return filters;
        }

        protected override void CustomizeToolBar()
        {
            if (MainToolBar.GetMenuReference(&quot;lnkSave&quot;) != null)
                MainToolBar.GetMenuReference(&quot;lnkSave&quot;).Click += lnkSave_Click;
            MainToolBar.GetMenuReference(&quot;lnkCancel&quot;).Click += lnkCancel_Click;
            MainToolBar.GetMenuReference(&quot;lnkUserControlCancel&quot;).Click += lnkUserControlCancel_Click;
            MainToolBar.GetMenuReference(&quot;lnkUserControlDone&quot;).Click += lnkUserControlDone_Click;
            if (Mode != null &amp;&amp; Mode.Equals(&quot;View&quot;))
                if (MainToolBar.GetMenuReference(&quot;lnkSave&quot;) != null)
                    MainToolBar.HideMenu(&quot;lnkSave&quot;);
            if (Mode != null &amp;&amp; Mode.Equals(&quot;Edit&quot;) &amp;&amp; status == RFIStatus.Approved)
                if (MainToolBar.GetMenuReference(&quot;lnkSave&quot;) != null)
                    MainToolBar.HideMenu(&quot;lnkSave&quot;);
            if (MainToolBar.GetMenuReference(&quot;lnkSave&quot;) != null)
                MainToolBar.GetMenuReference(&quot;lnkSave&quot;).OnClientClick =
                    &quot;WorkflowCurrentAction = &#39;Save&#39;; return ValidateSave();&quot;;

            //MainToolBar.GetMenuReference(&quot;lnkSave&quot;).CausesValidation = true;
            //MainToolBar.GetMenuReference(&quot;lnkSave&quot;).ValidationGroup = &quot;CreateRFI&quot;;
            MainToolBar.GetMenuReference(&quot;lnkUserControlDone&quot;).OnClientClick = &quot;return lnkGetSelectedID(&#39;&quot; +
                                           Convert.ToInt32(ValidateSelection.ZeroOrMoreItemsAndContainers) + &quot;&#39;, &#39;&quot; +
                                           hdnContainerIDList.ClientID + &quot;&#39;, &#39;&quot; + hdnItemIDList.ClientID + &quot;&#39;, &#39;&quot; +
                                           hdnSubItemIDList.ClientID + &quot;&#39;,&#39;&quot; + hdnActivityIDList.ClientID + &quot;&#39;);&quot;;
        }

        #endregion

        private RFIStatus status
        {
            get { return (RFIStatus)(ViewState[&quot;RFIStatus&quot;] ?? RFIStatus.Draft); }
            set { ViewState[&quot;RFIStatus&quot;] = value; }
        }

        private bool hideWorkflowButtons
        {
            get { return (ViewState[&quot;hideWorkflowButtons&quot;] != null ? (bool)(ViewState[&quot;hideWorkflowButtons&quot;]) : false); }
            set { ViewState[&quot;hideWorkflowButtons&quot;] = value; }
        }

        /// Gets the Integration Cutoff Date
        /// &lt;/summary&gt;
        private DateTime IntegrationCutoffDate
        {
            get { return ((DateTime)Session[Constants.APP_IntegrationCutoffDate]).AddDays(-1); }
        }

        /// &lt;summary&gt;
        /// Gets the Default Record Date
        /// &lt;/summary&gt;
        private DateTime DefaultRecordDate
        {
            get { return (DateTime)Session[Constants.APP_DefaultRecordDate]; }
        }

        private string ProjectMode
        {
            get
            {
                return (CacheManager.Instance.IsIntegrated(Request.QueryString[Constants.QRY_PROJECTID].ToInt32_2())
                            ? &quot;I&quot;
                            : &quot;L&quot;);
            }
        }

        #region Measurement Book

        private int InstanceIDForUpdate
        {
            get { return hdnInstanceID.Value.ToInt32_2(); }
            set { hdnInstanceID.Value = value.ToString(); }
        }

        private int IsGoToListPage
        {
            get { return (int)ViewState[&quot;RFIIsGoToListPage&quot;]; }
            set { ViewState[&quot;RFIIsGoToListPage&quot;] = value; }
        }

        private int IsGoToMeasurementEntry
        {
            get { return (int)ViewState[&quot;RFIIsGoToMeasurementEntry&quot;]; }
            set { ViewState[&quot;RFIIsGoToMeasurementEntry&quot;] = value; }
        }

        private DataTable DTMBookItems
        {
            get { return (DataTable)ViewState[&quot;RFIDTMBookItems&quot;]; }
            set { ViewState[&quot;RFIDTMBookItems&quot;] = value; }
        }

        private DataTable DTMBookItemsDetail
        {
            get { return (DataTable)ViewState[&quot;RFIDTMBookItemsDetail&quot;]; }
            set { ViewState[&quot;RFIDTMBookItemsDetail&quot;] = value; }
        }

        #endregion

        #region IWorkflowEnabled Members
        private BrixFormModel model;
        private XMLFormManagerModel managerModel;
        public void CancelHandler(object sender, bool bAfterSave, out string sRedirectTo)
        {
            throw new NotImplementedException();
        }

        public string ClientValidationFunction
        {
            get { return &quot;ValidateSave()&quot;; }
        }

        public string FormInstanceId
        {
            get
            {
                int id = String.IsNullOrEmpty(Request.QueryString[&quot;InstanceID&quot;])
                             ? -1
                             : int.TryParse(Request.QueryString[&quot;InstanceID&quot;], out id) ? id : -1;
                return id.ToString();
            }
        }

        public string FormKey { get { return string.Format(&quot;RFI No :{0}&quot;, lblRFINo.Text); } }

        public string FormName
        {
            get { return &quot;XRFIFRM&quot;; }
        }

        public bool IsOldWorkflow
        {
            get { return true; }
        }

        int IWorkflowEnabled.PID
        {
            get { return Request.QueryString[&quot;PID&quot;].ToInt32_2(); }
        }

        public int ParentModuleId
        {
            get
            {
                int id = String.IsNullOrEmpty(Request.QueryString[&quot;ParentID&quot;])
                             ? -1
                             : int.TryParse(Request.QueryString[&quot;ParentID&quot;], out id) ? id : -1;
                return id;
            }
        }

        public string PostCancelRedirectUrl
        {
            get { return &quot;~/Common/BrixListPage.aspx?PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;Context={2}&quot;.Format2(PID, ContractID, ModuleID); }
        }

        public string PostSaveRedirectUrl(string sSavedToken = &quot;&quot;)
        {
            return &quot;~/Common/BrixListPage.aspx?PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;Context={2}&quot;.Format2(PID, ContractID, ModuleID);
        }

        public bool SaveHandler(object sender, out string sSavedInstanceToken, out string sErrors,
                                out string sRedirectTo)
        {
            sSavedInstanceToken = &quot;&quot;;
            sErrors = &quot;&quot;;
            sRedirectTo = &quot;&quot;;
            if (wmeInspectionTime.Text.Trim() != &quot;:&quot; &amp;&amp;
                !Regex.IsMatch(wmeInspectionTime.Text, @&quot;^((([0-1]?[1-9]|[2][0-3]))|([1]?[0-2]))?:[0-5]?[0-9]?$&quot;))
            {
                ShowError(&quot;Please enter valid Inspection Time.&quot;);
                return false;
            }

            if (Convert.ToDateTime(wdcInspectionDate.Value).Date &lt; Convert.ToDateTime(wdcCreatedDate.Value).Date)
            {
                ShowError(&quot;Inspection date cannot be less than &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot; date.&quot;);
                return false;
            }
            int rowCount = gridActivity.Rows.Count;
            int incrmentor = 0;
            string xmlIDList = string.Empty;

            var dto = new RFIMasterDTO[rowCount];

            if (rowCount &gt; 0)
            {
                UltraGridRowsEnumerator enParentRow = gridActivity.Bands[0].GetRowsEnumerator();

                while (enParentRow.MoveNext())
                {
                    CellsCollection cells = enParentRow.Current.Cells;

                    dto[incrmentor] = new RFIMasterDTO();

                    dto[incrmentor].ItemPostingID = cells.FromKey(&quot;ItemPostingID&quot;).Text;
                    dto[incrmentor].Remarks = cells.FromKey(&quot;Remarks&quot;).Text;
                    dto[incrmentor].RFIID = Convert.ToInt32(Request[&quot;InstanceID&quot;]);
                    dto[incrmentor].ID = cells.Exists(&quot;ID&quot;) ? Convert.ToInt32(cells.FromKey(&quot;ID&quot;).Text) : 0;
                    if (dto[incrmentor].ID &gt; 0)
                        xmlIDList += dto[incrmentor].ID + &quot;,&quot;;
                    dto[incrmentor].ItemID = Convert.ToInt32(cells.FromKey(&quot;ItemID&quot;).Text);
                    //dto[incrmentor].SubItemID = Convert.ToInt32(cells.FromKey(&quot;SubItemID&quot;).Text);
                    cells.FromKey(&quot;Submitted Quantity&quot;).Value = cells.FromKey(&quot;MB Quantity&quot;).Value;
                    dto[incrmentor].Quantity = Convert.ToDecimal(cells.FromKey(&quot;Submitted Quantity&quot;).Value);
                    if (cells.FromKey(&quot;MB Quantity&quot;).Value != null)
                        dto[incrmentor].MBQuantity = Convert.ToDecimal(cells.FromKey(&quot;MB Quantity&quot;).Value);
                    #region comment1
                    //else if (status &gt;= RFIStatus.Submitted)
                    //{
                    //    ClientScript.RegisterStartupScript(this.GetType(), &quot;ShowMBQAlert&quot;, &quot;alert(&#39;Please enter MB Quantity&#39;);&quot;, true);
                    //    return;
                    //}

                    //if (txtJobNumber.Text == &quot;&quot;)
                    //{
                    //    ClientScript.RegisterStartupScript(GetType(), &quot;ShowLocAlert&quot;,
                    //                                       &quot;alert(&#39;Please enter the Job No.&#39;);&quot;, true);
                    //    return false;
                    //}

                    //else if (string.IsNullOrEmpty(wdcInspectionDate.Text.ToString2()))
                    //{
                    //    ClientScript.RegisterStartupScript(GetType(), &quot;ShowLocAlert&quot;,
                    //                                       &quot;alert(&#39;Please enter the Inspection Date.&#39;);&quot;, true);
                    //    return false;
                    //}

                    //else if (wmeInspectionTime.Value.ToString() == &quot;    &quot;)
                    //{
                    //    ClientScript.RegisterStartupScript(GetType(), &quot;ShowLocAlert&quot;,
                    //                                       &quot;alert(&#39;Please enter the Inspection Time.&#39;);&quot;, true);
                    //    return false;
                    //}

                    //else if (txtKindAttention.Text == &quot;&quot;)
                    //{
                    //    ClientScript.RegisterStartupScript(GetType(), &quot;ShowLocAlert&quot;,
                    //                                       &quot;alert(&#39;Please enter the Kind Attention.&#39;);&quot;, true);
                    //    return false;
                    //}

                    //else if (txtReferenceNo.Text == &quot;&quot;)
                    //{
                    //    ClientScript.RegisterStartupScript(GetType(), &quot;ShowLocAlert&quot;,
                    //                                       &quot;alert(&#39;Please enter the Reference Number.&#39;);&quot;, true);
                    //    return false;
                    //}

                    //else if (string.IsNullOrEmpty(cells.FromKey(&quot;Location&quot;).Value.ToString2()))
                    //{
                    //    ClientScript.RegisterStartupScript(GetType(), &quot;ShowLocAlert&quot;, &quot;alert(&#39;Please enter Location&#39;);&quot;,
                    //                                       true);
                    //    return false;
                    //}
                    #endregion

                    dto[incrmentor].Location = cells.FromKey(&quot;Location&quot;).Value.ToString2();
                    //if (action.HasValue &amp;&amp; action.Value == RFIStatus.Rejected)
                    //{
                    //    dto[incrmentor].CertifiedQuantity = 0;
                    //    dto[incrmentor].RejectedQuantity = Convert.ToDecimal(cells.FromKey(&quot;Submitted Quantity&quot;).Value);
                    //}
                    //else
                    //{
                    if (cells.FromKey(&quot;Certified Quantity&quot;).Value != null)
                        dto[incrmentor].CertifiedQuantity = Convert.ToDecimal(cells.FromKey(&quot;Certified Quantity&quot;).Value);

                    if (cells.FromKey(&quot;Rejected Quantity&quot;).Value != null)
                        dto[incrmentor].RejectedQuantity = Convert.ToDecimal(cells.FromKey(&quot;Rejected Quantity&quot;).Value);
                    else if (status &gt;= RFIStatus.Submitted &amp;&amp; cells.FromKey(&quot;Certified Quantity&quot;).Value != null)
                    {
                        dto[incrmentor].RejectedQuantity =
                            Convert.ToDecimal(cells.FromKey(&quot;Submitted Quantity&quot;).Value) -
                            Convert.ToDecimal(cells.FromKey(&quot;Certified Quantity&quot;).Value);
                    }
                    //}
                    dto[incrmentor].AttachmentID = cells.FromKey(&quot;AttachmentID&quot;).Text;
                    if (cells.Exists(&quot;Activities&quot;) &amp;&amp; !string.IsNullOrEmpty(cells.FromKey(&quot;Activities&quot;).Text))
                    {
                        foreach (string acti in cells.FromKey(&quot;Activities&quot;).Text.Split(&#39;,&#39;))
                        {
                            if (!string.IsNullOrEmpty(acti))
                            {
                                string[] s = acti.Split(&#39;|&#39;);
                                dto[incrmentor].ActivitiesList.Add(new RFIActivityDetails
                                                                       {
                                                                           ActivityID = Convert.ToInt32(s[0]),
                                                                           ID = Convert.ToInt32(s[1]),
                                                                           RFIItemID = dto[incrmentor].RFIID
                                                                       });
                            }
                        }
                    }
                    incrmentor++;
                }

                string xmlItemList = RequestForInformationBL.Instance.SerializeDTO(dto).Replace(&quot;encoding=\&quot;utf-8\&quot;&quot;,
                                                                                                String.Empty);

                var dtoGeneral = new RFIGeneralDetails();

                dtoGeneral.IsFromPostings = (itemSource == 1) ? 0 : 1;
                dtoGeneral.Address = txtAddress.Text;
                dtoGeneral.Area = txtArea.Text;
                dtoGeneral.Remarks = txtNotes.Text;
                dtoGeneral.ContractID = ContractID;
                if (Mode == &quot;New&quot; &amp;&amp; InstanceIDForUpdate == 0)
                {
                    dtoGeneral.CreatedBy = UserDetail.GetCurrentUserDetail().UID;
                    dtoGeneral.CreatedDate =
                        Convert.ToDateTime(wdcCreatedOn.Value, DateFormatCulture.GetDateFormatCulture()).ToString(
                            &quot;MM/dd/yyyy&quot;);
                }
                dtoGeneral.DrawingNumber = txtDrawingNo.Text;
                dtoGeneral.InspectionDate =
                    Convert.ToDateTime(wdcInspectionDate.Value, DateFormatCulture.GetDateFormatCulture()).ToString(
                        &quot;MM/dd/yyyy&quot;);
                dtoGeneral.InspectionTime = wmeInspectionTime.Value.ToString();
                dtoGeneral.JobNumber = txtJobNumber.Text;
                dtoGeneral.KindAttention = txtKindAttention.Text;
                //dtoGeneral.Location = txtLocation.Text;
                dtoGeneral.RevisionNumber = txtRevisionNo.Text;
                dtoGeneral.RFIDate =
                    Convert.ToDateTime(wdcCreatedDate.Value, DateFormatCulture.GetDateFormatCulture()).ToString(
                        &quot;MM/dd/yyyy&quot;);
                dtoGeneral.RFIID = InstanceIDForUpdate;
                dtoGeneral.RefNumber = txtReferenceNo.Text;
                //if (action.HasValue &amp;&amp; action.Value == RFIStatus.Rejected)
                //    dtoGeneral.Status = RFIStatus.Rejected;
                //else
                //    dtoGeneral.Status = (RFIStatus)Enum.Parse(typeof(RFIStatus), ddlStatus.Text, true);
                dtoGeneral.DisciplineRoads = chk1.Checked;
                dtoGeneral.DisciplineBridge = chk2.Checked;
                dtoGeneral.DisciplineCulvert = chkCurvlet.Checked;
                dtoGeneral.DisciplineSurvey = chkSurvey.Checked;
                dtoGeneral.DisciplineOthers = chkOthers.Checked;
                dtoGeneral.DisciplineUtilities = chk3.Checked;
                dtoGeneral.DisciplineRef = txtSpecRefNotes.Text;
                //if (dtoGeneral.Status &gt;= RFIStatus.Submitted || (action.HasValue &amp;&amp; action.Value &gt;= RFIStatus.Submitted))
                //{
                dtoGeneral.SubmittedOwner = txtSubmittedOwner.Text;
                dtoGeneral.SubmittedByUID = UserDetail.GetCurrentUserDetail().UID;
                dtoGeneral.SubmittedBy = txtSubmittedByName.Text;
                dtoGeneral.SubmittedDate =
                    Convert.ToDateTime(wdcSubmittedDate.Value, DateFormatCulture.GetDateFormatCulture()).ToString(
                        &quot;MM/dd/yyyy&quot;);
                dtoGeneral.SubmittedDesignation = txtSubmittedDesignation.Text;
                //}

                //if (dtoGeneral.Status &gt;= RFIStatus.Submitted || (action.HasValue &amp;&amp; action.Value &gt;= RFIStatus.Submitted))
                //{

                //if (dtoGeneral.Status &gt;= RFIStatus.Submitted)
                //{
                dtoGeneral.ReceivedBy = txtReceivedBy.Text;
                dtoGeneral.ReceivedDate =
                    Convert.ToDateTime(wdcReceivedDate.Value, DateFormatCulture.GetDateFormatCulture()).ToString(
                        &quot;MM/dd/yyyy&quot;);
                dtoGeneral.ReceivedTime = wmeReceivedTime.Value.ToString();
                if (wmeReceivedTime.Text.Trim() != &quot;:&quot; &amp;&amp;
                    !Regex.IsMatch(wmeReceivedTime.Text, @&quot;^((([0-1]?[1-9]|[2][0-3]))|([1]?[0-2]))?:[0-5]?[0-9]?$&quot;))
                {
                    ShowError(&quot;Please enter valid Received Time.&quot;);
                    return false;
                }
                // }

                //}

                //if (status &gt;= RFIStatus.Submitted || dtoGeneral.Status &gt;= RFIStatus.Approved || (action.HasValue &amp;&amp; action.Value &gt;= RFIStatus.Approved))
                //{
                dtoGeneral.ApprovedOwner = txtApprovedOwner.Text;
                dtoGeneral.ApprovedByUID = UserDetail.GetCurrentUserDetail().UID;
                dtoGeneral.ApprovedBy = txtApprovedBy.Text;
                if (!ProjectMode.Equals(&quot;I&quot;))
                {
                    dtoGeneral.ApprovedDate =
                        Convert.ToDateTime(wdcApprovedDate.Value, DateFormatCulture.GetDateFormatCulture()).ToString(
                            &quot;MM/dd/yyyy&quot;);
                }
                dtoGeneral.ApprovedDesignation = txtApprovedDesignation.Text;
                //}

                string xmlRFIGeneral =
                    RequestForInformationBL.Instance.SerializeDTO(dtoGeneral).Replace(&quot;encoding=\&quot;utf-8\&quot;&quot;, String.Empty);

                //Place DTMBookItems inside dsMBookItems DataSet
                var dsMBookItems = new DataSet();
                dsMBookItems.Tables.Add(DTMBookItems.Copy());

                //Place DTMBookItemsDetail inside dsMBookItemsDetail DataSet
                var dsMBookItemsDetail = new DataSet();
                if (DTMBookItemsDetail != null)
                    dsMBookItemsDetail.Tables.Add(DTMBookItemsDetail.Copy());

                rfiID = RequestForInformationBL.Instance.CUDRFIDetails(xmlItemList, string.Empty, xmlRFIGeneral,
                                                                       dsMBookItems.GetXml(),
                                                                       (dsMBookItemsDetail == null)
                                                                           ? null
                                                                           : dsMBookItemsDetail.GetXml(),
                                                                       ((Mode == &quot;New&quot; &amp;&amp; InstanceIDForUpdate == 0)
                                                                            ? &quot;C&quot;
                                                                            : &quot;U&quot;));
                if (rfiID == -1)
                {
                    ShowError(&quot;One or More Selected Items are already consumed. Please Select again.&quot;);
                    return false;
                }
                if (dtoGeneral.Status &gt;= RFIStatus.Submitted)
                {
                    RequestForInformationBL.Instance.AddDeductions(dtoGeneral.RFIID);
                    RequestForInformationBL.Instance.GetPEIDs(dtoGeneral.RFIID);
                }
                SaveAttachments(rfiID);
            }
            sSavedInstanceToken = rfiID.ToString();
            InstanceIDForUpdate = rfiID;
            IsGoToMeasurementEntry = 1;
            return true;



            //if (IsGoToListPage == 1)
            //    Response.Redirect(string.Format(&quot;~/Common/BrixListPage.aspx?PID={0}&amp;ContractID={1}&amp;Context={2}&amp;&quot; + Constants.QRY_PROJECTMODE + &quot;={3}&quot;, PID, ContractID, ModuleID, PMode), false);
        }

        #endregion

        #region IXMLControl Members

        public object[] ParentFormInstanceID
        {
            get { return new object[1] { GetInstanceID() }; }
        }

        public HtmlGenericControl XMLContainterDiv
        {
            get { return divXMLControl; }
            set
            {
                //throw new NotImplementedException();
            }
        }

        public void HandleInjectionSaveException(object model, Exception ex, string parentFormInstanceId)
        { }

        public bool SkipDefaultXMLInjectionSave { get; set; }

        #endregion

        public override void InclueScriptAndStyleFiles()
        {
            base.InclueScriptAndStyleFiles();
            base.RegisterClientScriptInclude(&quot;~/Scripts/bundle.brixitem.*.js&quot;);
        }

        protected void SetInspectionDate(object sender, EventArgs e)
        {
            wdcInspectionDate.MinDate = Convert.ToDateTime(wdcCreatedDate.Value);
            usercontrolInspectionDetails.MinDate = Convert.ToDateTime(wdcCreatedDate.Value);
        }
        private void SetManagerModel()
        {
            model = BrixFormModel.GetInstance(&quot;XRFIFRM&quot;, &quot;XRFIFRM&quot;, Request, Response);

            if (!string.IsNullOrEmpty(model.form.ManagerDLL) &amp;&amp; !string.IsNullOrEmpty(model.form.FormManagerClass))
            {
                managerModel = AMP3InterfaceFactory.GetInstance&lt;XMLFormManagerModel&gt;(model.form.ManagerDLL,
                                                                                 model.form.FormManagerClass);

            }
        }
        protected override void OnInit(EventArgs e)
        {
            lnkInspectionDetails.ServerClick += lnkInspectionDetails_Click;

            usercontrolInspectionDetails = (ucInspectionDetails as InspectionDetails);
            usercontrolInspectionDetails.PID = Convert.ToInt32(Request[&quot;PID&quot;]);
            usercontrolInspectionDetails.Mode = Convert.ToString(Request[&quot;Mode&quot;]);
            usercontrolInspectionDetails.BackClicked += lnkUserControlCancel_Click;
            Mode = hdnMode.Value = Request[&quot;Mode&quot;];

            base.ContextElement = &quot;CONTRFI&quot;;
            ContextElementHGrid = HGrid;

            if (!String.IsNullOrEmpty(Request[&quot;InstanceID&quot;]))
                usercontrolInspectionDetails.RFIID = Convert.ToInt32(Request[&quot;InstanceID&quot;]);

            hdnQuantityDigits.Value = CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY).ToString2();


            base.OnInit(e);
            SetManagerModel();
            if (managerModel != null)
                managerModel.OnInit(model, new XmlFormArgs());
        }

        protected override void CreateContextMenu()
        {
            List&lt;BrixContextMenu&gt; Menu = CMenu.CMenuArray;

            HGrid.GetContextMenu(Menu);
        }

        protected void Page_Load(object sender, EventArgs e)
        {
            UIHelper.DisableRoleSelection(Page);
            ContractID = Convert.ToInt32(Request[&quot;ParentID&quot;]);
            PID = Convert.ToInt32(Request[&quot;PID&quot;]);

            ModuleID = &quot;CONTRFI&quot;;

            //if (!string.IsNullOrEmpty(Request[&quot;Action&quot;]))
            //    action = (RFIStatus)Enum.Parse(typeof(RFIStatus), Request[&quot;Action&quot;], true);

            BindGridControl();

            txtAddress.Attributes.Add(&quot;maxLength&quot;, &quot;1000&quot;);
            txtNotes.Attributes.Add(&quot;maxLength&quot;, &quot;8000&quot;);
            wdcInspectionDate.CalendarLayout.Culture = DateFormatCulture.GetDateFormatCulture();
            wdcCreatedDate.CalendarLayout.Culture = DateFormatCulture.GetDateFormatCulture();
            wdcCreatedOn.CalendarLayout.Culture = DateFormatCulture.GetDateFormatCulture();

            //wdcInspectionDate.MinDate = Convert.ToDateTime(wdcCreatedDate.Value);

            if (chk4.Checked)
            {
                txtSpecRefNotes.Style.Value = &quot;visibility: visible&quot;;
            }

            if (!Page.IsPostBack)
            {
                wdcCreatedOn.MinDate = ProjectMode.Equals(&quot;L&quot;) ? DateTime.UtcNow : DefaultRecordDate;
                wdcCreatedOn.MaxDate = ProjectMode.Equals(&quot;L&quot;) ? DateTime.UtcNow : IntegrationCutoffDate;
                wdcCreatedOn.Value = ProjectMode.Equals(&quot;L&quot;) ? DateTime.UtcNow : DefaultRecordDate;
                wdcCreatedOn.Enabled = !ProjectMode.Equals(&quot;L&quot;);

                //RFI Date
                wdcInspectionDate.MinDate =
                    wdcCreatedDate.MinDate = ProjectMode.Equals(&quot;L&quot;) ? DateTime.MinValue : DefaultRecordDate;
                wdcInspectionDate.MaxDate =
                    wdcCreatedDate.MaxDate = ProjectMode.Equals(&quot;L&quot;) ? DateTime.MaxValue : IntegrationCutoffDate;
                wdcInspectionDate.Value =
                    wdcCreatedDate.Value = ProjectMode.Equals(&quot;L&quot;) ? DateTime.UtcNow : DefaultRecordDate;

                #region Measurement Book

                InstanceIDForUpdate = string.IsNullOrEmpty(Request[&quot;InstanceID&quot;])
                                          ? 0
                                          : Request[&quot;InstanceID&quot;].ToInt32_2();
                IsGoToListPage = 1;
                DTMBookItems = GetMBookItemsSchema().Copy();
                DTMBookItemsDetail = (ucMeasurementEntry as MeasurementEntry).GetMBookItemsDetailSchema().Copy();

                #endregion

                DataSet dsRFIPreReqData = RequestForInformationBL.Instance.GetRFIPreReqData(ContractID);
                hdnValidateMBQty.Value = dsRFIPreReqData.Tables[1].Rows[0][0].ToString2();
                if (Mode == &quot;New&quot; &amp;&amp; InstanceIDForUpdate == 0)
                {
                    string rfiNo = dsRFIPreReqData.Tables[0].Rows[0][&quot;RFI Number&quot;].ToString2();
                    lblRFINo.Text = rfiNo;
                    status = RFIStatus.Draft;
                    lblCreatedBy.Text = UserDetail.GetCurrentUserDetail().UserName;
                    //lblCreatedOn.Text = DateTime.UtcNow.ToString(Constants.FORMAT_DATE, DateFormatCulture.GetDateFormatCulture());
                    var dtSchema = new DataTable();
                    LoadRFISchema(dtSchema);

                    BindItemGridAndFormat(dtSchema);
                }
                else
                {
                    PageTitle = (Mode == &quot;Edit&quot; &amp;&amp; InstanceIDForUpdate != 0) ? &quot;Edit &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) : &quot;View &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;);

                    LoadAttachments();

                    LoadPageForEditState();

                    //if (action.HasValue &amp;&amp; action.Value == RFIStatus.Rejected)
                    //{
                    //    lnkSave_Click(sender, e);
                    //}
                }
            }
            lblItemDetails.Text = LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR) + &quot; Details :&quot;;

            //Hiding the btnViewActivities if activities are not there
            List&lt;string&gt; components = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);
            if (!components.Contains(&quot;Activities&quot;))
                btnViewActivities.Style.Add(HtmlTextWriterStyle.Display, &quot;none&quot;);

            SetManagerModel();
            if (managerModel != null)
                managerModel.OnPageLoad(model, new XmlFormArgs());
        }
        private void LoadAttachments()
        {
            ((AttachmentsControl)attachments).InstanceID = Request[&quot;InstanceID&quot;];
            ((AttachmentsControl)attachments).SrcType = &quot;CONTRFI&quot;;
            ((AttachmentsControl)attachments).LoadAttachments();
        }
        protected void Page_LoadComplete(object sender, EventArgs e)
        {
            btnViewPostings.Visible = (itemSource == 2);
            if (!(hdnPickerClicked.Value.Equals(&quot;P&quot;) || hdnPickerClicked.Value.Equals(&quot;I&quot;)))
            {
                SetStatus(status, true);
            }
            if (status &gt;= RFIStatus.Submitted)
            {
                btnPostingsSave.Enabled = false;
            }
            if (Mode.Equals(&quot;Edit&quot;) &amp;&amp; status == RFIStatus.Approved)
            {
                Readonly();
            }
            if (Mode.Equals(&quot;View&quot;))
            {
                Readonly();

                if (MainToolBar.GetMenuReference(&quot;lnkSave&quot;) != null)
                    MainToolBar.GetMenuReference(&quot;lnkSave&quot;).Enabled = false;

                btnActSave.Enabled = false;
                btnPostingsSave.Enabled = false;
                ((InspectionDetails)ucInspectionDetails).ReadOnly =
                    RFIAttachments.ReadOnly = ((AttachmentsControl)attachments).ReadOnly = true;
            }
            if (!(hdnPickerClicked.Value.Equals(&quot;P&quot;) || hdnPickerClicked.Value.Equals(&quot;I&quot;)))
            {
                EnableGridEditStyle(gridActivity.Columns);
            }
        }

        protected override void OnPreRender(EventArgs e)
        {
            if (hideWorkflowButtons)
                HideWorkflowButtons();
            if (hdnPickerClicked.Value == &quot;P&quot;)
                PageTitle = LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR) + &quot; Picker&quot;;

            else if (hdnPickerClicked.Value == &quot;M&quot;)

                PageTitle = &quot;Measurement Entry&quot;;

            else
                PageTitle = (Mode == &quot;New&quot;)
                                         ? ((InstanceIDForUpdate == 0) ? &quot;New &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot; : &quot;Edit &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot;)
                                         : ((Mode == &quot;Edit&quot;) ? &quot;Edit &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot; : &quot;View &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot;);
            base.OnPreRender(e);

            SetManagerModel();
            if (managerModel != null)
                managerModel.OnPreRender(model, new XmlFormArgs());
        }

        private void SetStatus(RFIStatus rfiStatus, bool IsEnabled)
        {
            RFIStatus actStatus = rfiStatus;
            //if (action.HasValue)
            //{
            //    rfiStatus = action.Value;
            //    IsEnabled = false;
            //}
            switch (rfiStatus)
            {
                case RFIStatus.Draft:
                case RFIStatus.Complete:
                    //if (ddlStatus.Items.FindByValue(RFIStatus.Draft.ToString()) == null)
                    //    ddlStatus.Items.Add(RFIStatus.Draft.ToString());
                    //if (ddlStatus.Items.FindByValue(RFIStatus.Complete.ToString()) == null)
                    //    ddlStatus.Items.Add(RFIStatus.Complete.ToString());
                    gridActivity.Columns.FromKey(&quot;Submitted Quantity&quot;).AllowUpdate = AllowUpdate.Yes;
                    gridActivity.Columns.FromKey(&quot;MB Quantity&quot;).AllowUpdate = AllowUpdate.Yes;
                    break;
                case RFIStatus.Submitted:
                    //if (ddlStatus.Items.FindByValue(RFIStatus.Submitted.ToString()) == null)
                    //    ddlStatus.Items.Add(RFIStatus.Submitted.ToString());
                    //if (action.HasValue &amp;&amp; actStatus &lt; action.Value)
                    //{
                    //    gridActivity.Columns.FromKey(&quot;Submitted Quantity&quot;).AllowUpdate = AllowUpdate.Yes;
                    //    gridActivity.Columns.FromKey(&quot;Certified Quantity&quot;).AllowUpdate = AllowUpdate.No;
                    //    gridActivity.Columns.FromKey(&quot;Rejected Quantity&quot;).AllowUpdate = AllowUpdate.No;
                    //    //gridActivity.Columns.FromKey(&quot;Remarks&quot;).AllowUpdate = AllowUpdate.No;
                    //}
                    //else
                    //{                    
                    gridActivity.Columns.FromKey(&quot;Certified Quantity&quot;).AllowUpdate = AllowUpdate.Yes;
                    gridActivity.Columns.FromKey(&quot;Rejected Quantity&quot;).AllowUpdate = AllowUpdate.Yes;
                    gridActivity.Columns.FromKey(&quot;Remarks&quot;).AllowUpdate = AllowUpdate.Yes;
                    //}
                    btnPostingsSave.Enabled = btnAddPicker.Enabled = btnDeleteItem.Enabled = false;
                    gridActivity.Columns.FromKey(&quot;MB Quantity&quot;).AllowUpdate = AllowUpdate.No;
                    break;
                case RFIStatus.Approved:
                    //if (ddlStatus.Items.FindByValue(RFIStatus.Approved.ToString()) == null)
                    //    ddlStatus.Items.Add(RFIStatus.Approved.ToString());
                    btnAddPicker.Enabled = btnDeleteItem.Enabled = false;
                    gridActivity.Columns.FromKey(&quot;MB Quantity&quot;).AllowUpdate = AllowUpdate.No;
                    gridActivity.Columns.FromKey(&quot;Certified Quantity&quot;).AllowUpdate = AllowUpdate.No;
                    gridActivity.Columns.FromKey(&quot;Rejected Quantity&quot;).AllowUpdate = AllowUpdate.No;
                    gridActivity.Columns.FromKey(&quot;Remarks&quot;).AllowUpdate = AllowUpdate.No;
                    gridActivity.Columns.FromKey(&quot;Location&quot;).AllowUpdate = AllowUpdate.No;
                    //gridActivity.Columns.FromKey(&quot;Submitted Quantity&quot;).AllowUpdate=AllowUpdate.No;By Subeesh
                    //gridActivity.Columns.FromKey(&quot;Certified Quantity&quot;).AllowUpdate = AllowUpdate.No;By Subeesh for test

                    wdcCreatedDate.ReadOnly = true;

                    RFIAttachments.ReadOnly = ((AttachmentsControl)attachments).ReadOnly = true;
                    break;
                case RFIStatus.Rejected:
                    //if (ddlStatus.Items.FindByValue(RFIStatus.Rejected.ToString()) == null)
                    //    ddlStatus.Items.Add(RFIStatus.Rejected.ToString());
                    btnAddPicker.Enabled = btnDeleteItem.Enabled = false;
                    RFIAttachments.ReadOnly = ((AttachmentsControl)attachments).ReadOnly = true;
                    break;
            }

            //ddlStatus.SelectedIndex = -1;
            //ddlStatus.Items.FindByValue(rfiStatus.ToString()).Selected = true;

            //ddlStatus.Enabled = IsEnabled;
            wdcCreatedDate.Enabled = IsEnabled;
            wdcInspectionDate.Enabled = IsEnabled;

            if (rfiStatus &gt;= RFIStatus.Submitted)
            {
                wdcCreatedDate.Enabled = false;
                wdcInspectionDate.Enabled = false;
            }

            tdLblAproveDate.Visible = tdWdcApproveDate.Visible = trApprovedBy.Visible = ProjectMode.Equals(&quot;L&quot;);
        }

        protected void gridActivity_InitializeRow(object sender, RowEventArgs e)
        {

            if (e.Row != null &amp;&amp; e.Row.Cells.Exists(&quot;Measurement Book&quot;))
            {
                e.Row.Cells.FromKey(&quot;Measurement Book&quot;).Text = &quot;Measurement Book&quot;;
                e.Row.Cells.FromKey(&quot;Measurement Book&quot;).Column.Type = ColumnType.Button;
            }

            // If the RFI item is part of RAB, irrespective of the RAB status MB qty needs to be disabled.
            if (e.Row != null &amp;&amp; e.Row.Cells.Exists(&quot;PostingID&quot;) &amp;&amp;
                Convert.ToInt32(e.Row.Cells.FromKey(&quot;PostingID&quot;).Value) &gt; 0)
            {
                e.Row.Cells.FromKey(&quot;MB Quantity&quot;).AllowEditing = AllowEditing.No;
                e.Row.Cells.FromKey(&quot;MB Quantity&quot;).Style.BackColor = Color.White;
            }
        }


        protected void btnMB_Click(object sender, EventArgs e)
        {
            gridActivityButton_Click(sender, null);
        }

        protected void gridActivityButton_Click(object sender, CellEventArgs e)
        {
            IsGoToMeasurementEntry = 1;
            if (InstanceIDForUpdate == 0)
            {
                IsGoToListPage = 0;
                IsGoToMeasurementEntry = 0;
                lnkSave_Click(sender, e);
                IsGoToListPage = 1;
            }

            if (IsGoToMeasurementEntry == 1)
            {
                PageTitle = &quot;Measurement Entry&quot;;
                SetHiddenVariables(hdnPickerClicked, &quot;M&quot;);
                SetDiv(Div.MeasurementEntry);
                decimal postedCertifiedQty = 0;

                object itemid = (gridActivity.DisplayLayout.ActiveRow != null) ? gridActivity.DisplayLayout.ActiveRow.Cells.FromKey(&quot;ItemID&quot;).Value : hdnItemID.Value;

                DataRow[] drSelectedMBookItem = DTMBookItems.Select(&quot;ItemID = &quot; + itemid);
                userControlMeasurementEntry = (ucMeasurementEntry as MeasurementEntry);
                userControlMeasurementEntry.DTMBookItems = DTMBookItems;
                userControlMeasurementEntry.DTMBookItemsDetail = DTMBookItemsDetail;
                userControlMeasurementEntry.ParentInstanceID = InstanceIDForUpdate;
                decimal.TryParse(gridActivity.DisplayLayout.ActiveRow.Cells.FromKey(&quot;PostedCertifiedQty&quot;).Value.ToString2(), out postedCertifiedQty);
                userControlMeasurementEntry.PostedCertifiedQty = postedCertifiedQty;

                if (drSelectedMBookItem.Length &gt; 0)
                {
                    userControlMeasurementEntry.MBookItemID = drSelectedMBookItem[0][&quot;ID&quot;].ToString().ToInt32_2();
                    userControlMeasurementEntry.ItemID = drSelectedMBookItem[0][&quot;ItemID&quot;].ToString().ToInt32_2();
                    userControlMeasurementEntry.ActivityID = drSelectedMBookItem[0][&quot;ActivityID&quot;].ToString().ToInt32_2();
                    userControlMeasurementEntry.SubItemID = drSelectedMBookItem[0][&quot;SubItemID&quot;].ToString().ToInt32_2();
                }
                else
                {
                    userControlMeasurementEntry.MBookItemID = -1;
                    userControlMeasurementEntry.ItemID = itemid.ToInt32_2();
                    userControlMeasurementEntry.ActivityID = -1;
                    userControlMeasurementEntry.SubItemID = -1;
                }

                userControlMeasurementEntry.PageMode = Mode;
                userControlMeasurementEntry.MEDataBind();
            }

            if (MainToolBar.GetMenuReference(&quot;lnkSave&quot;) != null)
            {
                if (status == RFIStatus.Submitted)
                    MainToolBar.HideMenu(&quot;lnkSave&quot;);
            }

            //SetHiddenVariables(hdnPickerClicked, &quot;A&quot;);
            //(RFIAttachments as Attachments).GUID = e.Cell.Row.Cells.FromKey(&quot;AttachmentID&quot;).Value.ToString();
            //(RFIAttachments as Attachments).ItemName = (e.Cell.Row.Cells.FromKey(&quot;Description&quot;).Value ?? &quot;&quot;).ToString();
            //(RFIAttachments as Attachments).Location = (e.Cell.Row.Cells.FromKey(&quot;Location&quot;).Value ?? &quot;&quot;).ToString();
            //(RFIAttachments as Attachments).LoadAttachments();
        }

        protected void btnActSave_Click(object sender, EventArgs e)
        {
            hdnActClicked.Value = &quot;0&quot;;
            UltraGridCell cell = gridActivity.DisplayLayout.SelectedRows[0].Cells.FromKey(&quot;Activities&quot;);
            cell.Value = &quot;&quot;;
            foreach (UltraGridRow row in gridActivities.Rows)
                if (Convert.ToBoolean(row.Cells.FromKey(&quot;To&quot;).Value))
                    cell.Value += row.Cells.FromKey(&quot;ActivityID&quot;).Text + &quot;|&quot; + (row.Cells.FromKey(&quot;ID&quot;).Value ?? &quot;0&quot;) +
                                  &quot;,&quot;;
            cell.Value = cell.Value.ToString().TrimEnd(&#39;,&#39;);
        }

        protected void btnPostingsSave_Click(object sender, EventArgs e)
        {
            hdnPostClicked.Value = &quot;0&quot;;
            UltraGridCell cell = gridActivity.DisplayLayout.SelectedRows[0].Cells.FromKey(&quot;ItemPostingID&quot;);
            cell.Value = &quot;&quot;;
            decimal availableQty =
                decimal.Parse(
                    gridActivity.DisplayLayout.SelectedRows[0].Cells.FromKey(&quot;Avail Quantity&quot;).Value.ToString2());
            decimal unCertifiedQty = 0;
            actualQty =
                decimal.Parse(string.IsNullOrEmpty(ViewState[&quot;ActualQty&quot;].ToString2())
                                  ? &quot;0&quot;
                                  : ViewState[&quot;ActualQty&quot;].ToString2());
            unCertifiedQty = Math.Abs(availableQty - actualQty);
            actualQty = 0;
            foreach (UltraGridRow row in gridPostings.Rows)
            {
                actualQty += decimal.Parse(row.Cells.FromKey(&quot;Posted Quantity&quot;).Text);
            }
            foreach (UltraGridRow row in gridPostings.Rows)
            {
                if (Convert.ToBoolean(row.Cells.FromKey(&quot;To&quot;).Value))
                    cell.Value += row.Cells.FromKey(&quot;PostingID&quot;).Text + &quot;,&quot;;
                else
                {
                    cell.Value = cell.Value.ToString2().Replace(row.Cells.FromKey(&quot;PostingID&quot;).Text, &quot;&quot;);
                    actualQty -= decimal.Parse(row.Cells.FromKey(&quot;Posted Quantity&quot;).Text);
                }
            }
            cell.Value = cell.Value.ToString().TrimEnd(&#39;,&#39;);
            gridActivity.DisplayLayout.SelectedRows[0].Cells.FromKey(&quot;Avail Quantity&quot;).Value = (actualQty +
                                                                                                unCertifiedQty);
            gridActivity.DisplayLayout.SelectedRows[0].Cells.FromKey(&quot;Submitted Quantity&quot;).Value = (actualQty +
                                                                                                    unCertifiedQty);
            if (string.IsNullOrEmpty(cell.Value.ToString2()))
                gridActivity.DisplayLayout.SelectedRows[0].Delete();
        }

        protected void lnkSave_Click(object sender, EventArgs e)
        {
            if (hdnPickerClicked.Value.Equals(&quot;A&quot;))
            {
                //Save Attachments
                (RFIAttachments).SaveAttachments(ContractID, Constants.MODID_CONTMGT);
                SetDiv(Div.Main);
                SetHiddenVariables(hdnPickerClicked, &quot;R&quot;);
                PageTitle = (Mode == &quot;New&quot;)
                                      ? ((InstanceIDForUpdate == 0) ? &quot;New &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot; : &quot;Edit &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot;)
                                      : ((Mode == &quot;Edit&quot;) ? &quot;Edit &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot; : &quot;View &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot;);
            }
            else if (hdnPickerClicked.Value.Equals(&quot;I&quot;))
            {
                //Save Inspection Details
                (usercontrolInspectionDetails).Save(sender, e);
                SetDiv(Div.Main);
                SetHiddenVariables(hdnPickerClicked, &quot;R&quot;);
            }
            else if (hdnPickerClicked.Value.Equals(&quot;M&quot;))
            {
                userControlMeasurementEntry = (ucMeasurementEntry as MeasurementEntry);
                userControlMeasurementEntry.lnkSave_Click(sender, e);
                DTMBookItems = userControlMeasurementEntry.DTMBookItems.Copy();
                DTMBookItemsDetail = userControlMeasurementEntry.DTMBookItemsDetail.Copy();
                if (hdnValidateMBQty.Value.Equals(&quot;0&quot;) &amp;&amp;
                    gridActivity.DisplayLayout.ActiveRow.Cells.FromKey(&quot;Avail Quantity&quot;).Value.ToDecimal2() &lt;
                    userControlMeasurementEntry.MBookQuantity)
                {
                    ShowError(&quot;Submitted quantity cannot exceed the available quantity(&quot; +
                            UIHelper.JavascriptEncode(gridActivity.DisplayLayout.ActiveRow.Cells.FromKey(
                                &quot;Avail Quantity&quot;).Value.ToString2()));
                    return;
                }
                gridActivity.DisplayLayout.ActiveRow.Cells.FromKey(&quot;MB Quantity&quot;).Value =
                    userControlMeasurementEntry.MBookQuantity.ToString();
                SetDiv(Div.Main);
                SetHiddenVariables(hdnPickerClicked, &quot;R&quot;);
                PageTitle = (Mode == &quot;New&quot;)
                                      ? ((InstanceIDForUpdate == 0) ? &quot;New &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot; : &quot;Edit &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot;)
                                      : ((Mode == &quot;Edit&quot;) ? &quot;Edit &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot; : &quot;View &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot;);
            }
            else
            {
                if (sender.GetType().FullName.Contains(&quot;UltraWebGrid&quot;))
                    WorkflowEnabledSaveHandler(false);
                else
                    WorkflowEnabledSaveHandler(true);
            }

            #region Comment

            //    if (wmeInspectionTime.Text.Trim() != &quot;:&quot; &amp;&amp; !Regex.IsMatch(wmeInspectionTime.Text, @&quot;^((([0-1]?[1-9]|[2][0-3]))|([1]?[0-2]))?:[0-5]?[0-9]?$&quot;))
            //    {
            //        ClientScript.RegisterStartupScript(this.GetType(), &quot;ShowInsAlert&quot;, &quot;alert(&#39;Please enter valid Inspection Time.&#39;);&quot;, true);
            //        return;
            //    }
            //    if ( Convert.ToDateTime(wdcInspectionDate.Value) &lt; Convert.ToDateTime(wdcCreatedDate.Value))
            //    {
            //        ClientScript.RegisterStartupScript(this.GetType(), &quot;ShowInsAlert&quot;, &quot;alert(&#39;Inspection date cannot be less than RFI date.&#39;);&quot;, true);
            //        return;
            //    }
            //    int rowCount = gridActivity.Rows.Count;
            //    int incrmentor = 0;
            //    string xmlIDList = string.Empty;

            //    RFIMasterDTO[] dto = new RFIMasterDTO[rowCount];

            //    if (rowCount &gt; 0)
            //    {
            //        UltraGridRowsEnumerator enParentRow = gridActivity.Bands[0].GetRowsEnumerator();

            //        while (enParentRow.MoveNext())
            //        {
            //            CellsCollection cells = enParentRow.Current.Cells;

            //            dto[incrmentor] = new RFIMasterDTO();

            //            dto[incrmentor].ItemPostingID = cells.FromKey(&quot;ItemPostingID&quot;).Text;
            //            dto[incrmentor].Remarks = cells.FromKey(&quot;Remarks&quot;).Text;
            //            dto[incrmentor].RFIID = Convert.ToInt32(Request[&quot;InstanceID&quot;]);
            //            dto[incrmentor].ID = cells.Exists(&quot;ID&quot;) ? Convert.ToInt32(cells.FromKey(&quot;ID&quot;).Text) : 0;
            //            if (dto[incrmentor].ID &gt; 0)
            //                xmlIDList += dto[incrmentor].ID + &quot;,&quot;;
            //            dto[incrmentor].ItemID = Convert.ToInt32(cells.FromKey(&quot;ItemID&quot;).Text);
            //            //dto[incrmentor].SubItemID = Convert.ToInt32(cells.FromKey(&quot;SubItemID&quot;).Text);
            //            dto[incrmentor].Quantity = Convert.ToDecimal(cells.FromKey(&quot;Submitted Quantity&quot;).Value);
            //            if (cells.FromKey(&quot;MB Quantity&quot;).Value != null)
            //                dto[incrmentor].MBQuantity = Convert.ToDecimal(cells.FromKey(&quot;MB Quantity&quot;).Value);
            //            //else if (status &gt;= RFIStatus.Submitted)
            //            //{
            //            //    ClientScript.RegisterStartupScript(this.GetType(), &quot;ShowMBQAlert&quot;, &quot;alert(&#39;Please enter MB Quantity&#39;);&quot;, true);
            //            //    return;
            //            //}

            //                if(txtJobNumber.Text == &quot;&quot;){
            //                    ClientScript.RegisterStartupScript(this.GetType(), &quot;ShowLocAlert&quot;, &quot;alert(&#39;Please enter the Job No.&#39;);&quot;, true);
            //                return;
            //                 }

            //                else if (string.IsNullOrEmpty(wdcInspectionDate.Text.ToString2()))
            //                {
            //                    ClientScript.RegisterStartupScript(this.GetType(), &quot;ShowLocAlert&quot;, &quot;alert(&#39;Please enter the Inspection Date.&#39;);&quot;, true);
            //                    return;
            //                }

            //                else if (wmeInspectionTime.Value.ToString() == &quot;    &quot;)
            //                {
            //                    ClientScript.RegisterStartupScript(this.GetType(), &quot;ShowLocAlert&quot;, &quot;alert(&#39;Please enter the Inspection Time.&#39;);&quot;, true);
            //                    return;
            //                }

            //                else if (txtKindAttention.Text == &quot;&quot;)
            //                {
            //                    ClientScript.RegisterStartupScript(this.GetType(), &quot;ShowLocAlert&quot;, &quot;alert(&#39;Please enter the Kind Attention.&#39;);&quot;, true);
            //                    return;
            //                }

            //                else if (txtReferenceNo.Text == &quot;&quot;)
            //                {
            //                    ClientScript.RegisterStartupScript(this.GetType(), &quot;ShowLocAlert&quot;, &quot;alert(&#39;Please enter the Reference Number.&#39;);&quot;, true);
            //                    return;
            //                }

            //               else if (string.IsNullOrEmpty(cells.FromKey(&quot;Location&quot;).Value.ToString2()))
            //              {
            //                ClientScript.RegisterStartupScript(this.GetType(), &quot;ShowLocAlert&quot;, &quot;alert(&#39;Please enter Location&#39;);&quot;, true);
            //                return;
            //              }


            //            dto[incrmentor].Location = cells.FromKey(&quot;Location&quot;).Value.ToString2();
            //            if (action.HasValue &amp;&amp; action.Value == RFIStatus.Rejected)
            //            {
            //                dto[incrmentor].CertifiedQuantity = 0;
            //                dto[incrmentor].RejectedQuantity = Convert.ToDecimal(cells.FromKey(&quot;Submitted Quantity&quot;).Value);
            //            }
            //            else
            //            {
            //                if (cells.FromKey(&quot;Certified Quantity&quot;).Value != null)
            //                    dto[incrmentor].CertifiedQuantity = Convert.ToDecimal(cells.FromKey(&quot;Certified Quantity&quot;).Value);

            //                if (cells.FromKey(&quot;Rejected Quantity&quot;).Value != null)
            //                    dto[incrmentor].RejectedQuantity = Convert.ToDecimal(cells.FromKey(&quot;Rejected Quantity&quot;).Value);
            //                else if (status &gt;= RFIStatus.Submitted &amp;&amp; cells.FromKey(&quot;Certified Quantity&quot;).Value != null)
            //                {
            //                    dto[incrmentor].RejectedQuantity = Convert.ToDecimal(cells.FromKey(&quot;Submitted Quantity&quot;).Value) - Convert.ToDecimal(cells.FromKey(&quot;Certified Quantity&quot;).Value);
            //                }
            //            }
            //            dto[incrmentor].AttachmentID = cells.FromKey(&quot;AttachmentID&quot;).Text;
            //            if (cells.Exists(&quot;Activities&quot;) &amp;&amp; !string.IsNullOrEmpty(cells.FromKey(&quot;Activities&quot;).Text))
            //            {
            //                foreach (string acti in cells.FromKey(&quot;Activities&quot;).Text.Split(&#39;,&#39;))
            //                {
            //                    if (!string.IsNullOrEmpty(acti))
            //                    {
            //                        string[] s = acti.Split(&#39;|&#39;);
            //                        dto[incrmentor].ActivitiesList.Add(new RFIActivityDetails { ActivityID = Convert.ToInt32(s[0]), ID = Convert.ToInt32(s[1]), RFIItemID = dto[incrmentor].RFIID });
            //                    }
            //                }
            //            }
            //            incrmentor++;
            //        }

            //        string xmlItemList = RequestForInformationBL.Instance.SerializeDTO(dto).Replace(&quot;encoding=\&quot;utf-8\&quot;&quot;, String.Empty);

            //        RFIGeneralDetails dtoGeneral = new RFIGeneralDetails();

            //        dtoGeneral.IsFromPostings = (itemSource == 1) ? 0 : 1;
            //        dtoGeneral.Address = txtAddress.Text;
            //        dtoGeneral.Area = txtArea.Text;
            //        dtoGeneral.Remarks = txtNotes.Text;
            //        dtoGeneral.ContractID = ContractID;
            //        if (Mode == &quot;New&quot; &amp;&amp; InstanceIDForUpdate == 0)
            //        {
            //            dtoGeneral.CreatedBy = UserDetail.GetCurrentUserDetail().UID;
            //            dtoGeneral.CreatedDate = Convert.ToDateTime(wdcCreatedOn.Value, DateFormatCulture.GetDateFormatCulture()).ToString(&quot;MM/dd/yyyy&quot;);
            //        }
            //        dtoGeneral.DrawingNumber = txtDrawingNo.Text;
            //        dtoGeneral.InspectionDate = Convert.ToDateTime(wdcInspectionDate.Value, DateFormatCulture.GetDateFormatCulture()).ToString(&quot;MM/dd/yyyy&quot;);
            //        dtoGeneral.InspectionTime = wmeInspectionTime.Value.ToString();
            //        dtoGeneral.JobNumber = txtJobNumber.Text;
            //        dtoGeneral.KindAttention = txtKindAttention.Text;
            //        //dtoGeneral.Location = txtLocation.Text;
            //        dtoGeneral.RevisionNumber = txtRevisionNo.Text;
            //        dtoGeneral.RFIDate = Convert.ToDateTime(wdcCreatedDate.Value, DateFormatCulture.GetDateFormatCulture()).ToString(&quot;MM/dd/yyyy&quot;);
            //        dtoGeneral.RFIID = InstanceIDForUpdate;
            //        dtoGeneral.RefNumber = txtReferenceNo.Text;
            //        if (action.HasValue &amp;&amp; action.Value == RFIStatus.Rejected)
            //            dtoGeneral.Status = RFIStatus.Rejected;
            //        else
            //            dtoGeneral.Status = (RFIStatus)Enum.Parse(typeof(RFIStatus), ddlStatus.Text, true);
            //        dtoGeneral.DisciplineRoads = chk1.Checked;
            //        dtoGeneral.DisciplineBridge = chk2.Checked;
            //        dtoGeneral.DisciplineCulvert = chkCurvlet.Checked;
            //        dtoGeneral.DisciplineSurvey = chkSurvey.Checked;
            //        dtoGeneral.DisciplineOthers = chkOthers.Checked;
            //        dtoGeneral.DisciplineUtilities = chk3.Checked;
            //        dtoGeneral.DisciplineRef = txtSpecRefNotes.Text;
            //        if (dtoGeneral.Status &gt;= RFIStatus.Submitted || (action.HasValue &amp;&amp; action.Value &gt;= RFIStatus.Submitted))
            //        {
            //            dtoGeneral.SubmittedOwner = txtSubmittedOwner.Text;
            //            dtoGeneral.SubmittedByUID = UserDetail.GetCurrentUserDetail().UID;
            //            dtoGeneral.SubmittedBy = txtSubmittedByName.Text;
            //            dtoGeneral.SubmittedDate = Convert.ToDateTime(wdcSubmittedDate.Value, DateFormatCulture.GetDateFormatCulture()).ToString(&quot;MM/dd/yyyy&quot;);
            //            dtoGeneral.SubmittedDesignation = txtSubmittedDesignation.Text;
            //        }

            //        if (dtoGeneral.Status &gt;= RFIStatus.Submitted || (action.HasValue &amp;&amp; action.Value &gt;= RFIStatus.Submitted))
            //        {
            //            dtoGeneral.ReceivedBy = txtReceivedBy.Text;
            //            dtoGeneral.ReceivedDate = Convert.ToDateTime(wdcReceivedDate.Value, DateFormatCulture.GetDateFormatCulture()).ToString(&quot;MM/dd/yyyy&quot;);
            //            dtoGeneral.ReceivedTime = wmeReceivedTime.Value.ToString();
            //            if (wmeReceivedTime.Text.Trim() != &quot;:&quot; &amp;&amp; !Regex.IsMatch(wmeReceivedTime.Text, @&quot;^((([0-1]?[1-9]|[2][0-3]))|([1]?[0-2]))?:[0-5]?[0-9]?$&quot;))
            //            {
            //                ClientScript.RegisterStartupScript(GetType(), &quot;RecTime&quot;, &quot;&lt;script&gt;alert(&#39;Please enter valid Received Time.&#39;)&lt;/script&gt;&quot;);
            //                return;
            //            }
            //        }

            //        if (status &gt;= RFIStatus.Submitted || dtoGeneral.Status &gt;= RFIStatus.Approved || (action.HasValue &amp;&amp; action.Value &gt;= RFIStatus.Approved))
            //        {
            //            dtoGeneral.ApprovedOwner = txtApprovedOwner.Text;
            //            dtoGeneral.ApprovedByUID = UserDetail.GetCurrentUserDetail().UID;
            //            dtoGeneral.ApprovedBy = txtApprovedBy.Text;
            //            if (!PMode.Equals(&quot;I&quot;))
            //            {
            //                dtoGeneral.ApprovedDate = Convert.ToDateTime(wdcApprovedDate.Value, DateFormatCulture.GetDateFormatCulture()).ToString(&quot;MM/dd/yyyy&quot;);
            //            }
            //            dtoGeneral.ApprovedDesignation = txtApprovedDesignation.Text;
            //        }

            //        string xmlRFIGeneral = RequestForInformationBL.Instance.SerializeDTO(dtoGeneral).Replace(&quot;encoding=\&quot;utf-8\&quot;&quot;, String.Empty);

            //        //Place DTMBookItems inside dsMBookItems DataSet
            //        DataSet dsMBookItems = new DataSet();
            //        dsMBookItems.Tables.Add(DTMBookItems.Copy());

            //        //Place DTMBookItemsDetail inside dsMBookItemsDetail DataSet
            //        DataSet dsMBookItemsDetail = new DataSet();
            //        if (DTMBookItemsDetail != null)
            //            dsMBookItemsDetail.Tables.Add(DTMBookItemsDetail.Copy());

            //        rfiID = RequestForInformationBL.Instance.CUDRFIDetails(xmlItemList, string.Empty, xmlRFIGeneral, dsMBookItems.GetXml(), (dsMBookItemsDetail == null) ? null : dsMBookItemsDetail.GetXml(), ((Mode == &quot;New&quot; &amp;&amp; InstanceIDForUpdate == 0) ? &quot;C&quot; : &quot;U&quot;));
            //        if (rfiID == -1)
            //        {
            //            ClientScript.RegisterStartupScript(GetType(), &quot;RecTime&quot;, &quot;&lt;script&gt;alert(&#39;One or More Selected Items are already consumed. Please Select again.&#39;)&lt;/script&gt;&quot;);
            //            return;
            //        }
            //        if (dtoGeneral.Status &gt;= RFIStatus.Submitted)
            //        {
            //            RequestForInformationBL.Instance.AddDeductions(dtoGeneral.RFIID);
            //            RequestForInformationBL.Instance.GetPEIDs(dtoGeneral.RFIID);
            //        }
            //        SaveAttachments(rfiID);
            //    }

            //    InstanceIDForUpdate = rfiID;
            //    IsGoToMeasurementEntry = 1;

            //    if (IsGoToListPage == 1)
            //        Response.Redirect(string.Format(&quot;~/Common/BrixListPage.aspx?PID={0}&amp;ContractID={1}&amp;Context={2}&amp;&quot; + Constants.QRY_PROJECTMODE + &quot;={3}&quot;, PID, ContractID, ModuleID, PMode), false);
            //}

            #endregion Comment
        }

        protected void lnkCancel_Click(object sender, EventArgs e)
        {
            if (hdnPickerClicked.Value.Equals(&quot;A&quot;))
            {
                SetDiv(Div.Main);
                SetHiddenVariables(hdnPickerClicked, &quot;R&quot;);
                PageTitle = (Mode == &quot;New&quot;)
                                      ? ((InstanceIDForUpdate == 0) ? &quot;New &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot; : &quot;Edit &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot;)
                                      : ((Mode == &quot;Edit&quot;) ? &quot;Edit &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot; : &quot;View &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot;);
            }
            else if (hdnPickerClicked.Value.Equals(&quot;I&quot;))
            {
                //Cancel Inspection Details
                (usercontrolInspectionDetails).Cancel(sender, e);
                SetDiv(Div.Main);
                SetHiddenVariables(hdnPickerClicked, &quot;R&quot;);
            }
            else if (hdnPickerClicked.Value.Equals(&quot;M&quot;))
            {
                SetDiv(Div.Main);
                SetHiddenVariables(hdnPickerClicked, &quot;R&quot;);
                PageTitle = (Mode == &quot;New&quot;)
                                      ? ((InstanceIDForUpdate == 0) ? &quot;New &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot; : &quot;Edit &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot;)
                                      : ((Mode == &quot;Edit&quot;) ? &quot;Edit &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot; : &quot;View &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot;);
            }
            else
            {
                //if (action.HasValue &amp;&amp; action.Value &gt;= RFIStatus.Approved)
                //{
                if (
                    File.Exists(
                        ((Page)HttpContext.Current.Handler).Server.MapPath(@&quot;~/Modules/WORKFLW/&quot; + ModuleID + &quot;.xml&quot;)))
                {
                    if (!String.IsNullOrEmpty(Request[&quot;InstanceID&quot;]))
                    {
                        RequestForInformationBL.Instance.UndoApprove(Convert.ToInt32(Request[&quot;InstanceID&quot;]));
                    }
                }
                //}

                Response.Redirect(
                    string.Format(&quot;~/Common/BrixListPage.aspx?PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;Context={2}&quot;, PID, ContractID,
                                  ModuleID), false);
            }
        }

        protected void lnkUserControlDone_Click(object sender, EventArgs e)
        {
            SetDiv(Div.Main);

            hdnPickerClicked.Value = &quot;R&quot;;
            bool isDeleted = false;
            string xmlList = String.Empty;
            DataSet ds;
            if (hdnItemIDList.Value.Length &gt; 0 || hdnActivityIDList.Value.Length &gt; 0 ||
                hdnSubItemIDList.Value.Length &gt; 0 || (itemSource == 2 &amp;&amp; hdnContainerIDList.Value.Length &gt; 0))
            {
                xmlList = ProcessItemPicker(hdnItemIDList.Value, hdnSubItemIDList.Value, hdnActivityIDList.Value);
                if (itemSource == 2)
                {
                    string postings = string.Empty;
                    foreach (UltraGridRow row in gridActivity.Rows)
                    {
                        postings += row.Cells.FromKey(&quot;ItemPostingID&quot;).Value.ToString2();
                    }
                    ds = RequestForInformationBL.Instance.GetRFIItemList(xmlList, postings, hdnContainerIDList.Value);
                }
                else
                    ds = RequestForInformationBL.Instance.GetRFIItemList(xmlList);
                if (ds.Tables.Count &gt; 0)
                {
                    foreach (DataRow dr in ds.Tables[0].Rows)
                        dr[&quot;AttachmentID&quot;] = GetInstanceID() + &quot;-&quot; + dr[&quot;ItemID&quot;]; //Guid.NewGuid().ToString();
                    //dr[&quot;AttachmentID&quot;] = GetInstanceID() + &quot;-&quot; + dr[&quot;ItemID&quot;].ToString() + &quot;-&quot; + (dr[&quot;SubItemID&quot;].Equals(DBNull.Value) ? &quot;0&quot; : dr[&quot;SubItemID&quot;].ToString()); //Guid.NewGuid().ToString();
                    ds.Tables[0].AcceptChanges();
                    DataTable dt = null;
                    if (gridActivity.Rows.Count &gt; 0)
                        dt = EliminateDuplicates(ds.Tables[0]);
                    //isDeleted = DeleteInvalidRows((gridActivity.Rows.Count &gt; 0) ? dt : ds.Tables[0]);


                    BindItemGridAndFormat((gridActivity.Rows.Count &gt; 0) ? dt : ds.Tables[0]);
                    if (!string.IsNullOrEmpty(Request[&quot;InstanceID&quot;]))
                        FillActivities(
                            RequestForInformationBL.Instance.GetActivitiesForRFIItem(
                                Convert.ToInt32(Request[&quot;InstanceID&quot;]), 0));
                }
            }
            PageTitle = (Mode == &quot;New&quot;)
                                  ? ((InstanceIDForUpdate == 0) ? &quot;New &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot; : &quot;Edit &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot;)
                                  : ((Mode == &quot;Edit&quot;) ? &quot;Edit &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot; : &quot;View &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot;);

            for (int i = 0; i &lt; gridActivity.Rows.Count; i++)
            {
                DataRow drMBookItems =
                    DTMBookItems.Rows.OfType&lt;DataRow&gt;().ToList().Find(
                        row =&gt;
                        (row[&quot;ItemID&quot;].ToString().Equals(gridActivity.Rows[i].Cells.FromKey(&quot;ItemID&quot;).Value.ToString(),
                                                         StringComparison.CurrentCultureIgnoreCase)));
                if (drMBookItems == null)
                    AddMBookItemsToDataTable(gridActivity.Rows[i]);
            }

            if (isDeleted)
            {
                ShowError(&quot;BOQ(s) with zero available quantity cannot be added.&quot;);
            }
        }

        protected void btnDelete_Click(object sender, EventArgs e)
        {
            for (int j = 0; j &lt; gridActivity.Rows.Count; j++)
            {
                UltraGridRow row = gridActivity.Rows[j];
                if (row.Cells.FromKey(&quot;To&quot;).Value.ToString().Equals(&quot;true&quot;) ||
                    gridActivity.DisplayLayout.ActiveRow == row)
                {
                    //Delete from DTMBookItems
                    DataRow[] drExistingRow = DTMBookItems.Select(&quot;ItemID = &quot; + row.Cells.FromKey(&quot;ItemID&quot;).Value);
                    if (drExistingRow.Length &gt; 0)
                    {
                        DataRow[] drExistingItemDetailsRow =
                            DTMBookItemsDetail.Select(&quot;ItemID = &quot; + row.Cells.FromKey(&quot;ItemID&quot;).Value);
                        if (drExistingItemDetailsRow.Length &gt; 0)
                        {
                            for (int i = 0; i &lt; drExistingItemDetailsRow.Length; i++)
                            {
                                if (drExistingItemDetailsRow[i][&quot;MBookItemsID&quot;].ToString() == &quot;-1&quot;)
                                {
                                    drExistingItemDetailsRow[i].Delete();
                                    DTMBookItemsDetail.AcceptChanges();
                                }
                            }
                        }
                        drExistingRow[0].Delete();
                        DTMBookItems.AcceptChanges();
                    }
                    gridActivity.Rows.Remove(row);
                    j--;
                }
            }
        }

        protected void btnViewActivities_Click(object sender, EventArgs e)
        {
            if (hdnValidate.Value == &quot;0&quot;)
                return;
            UltraGridRow activeRow = null;
            foreach (UltraGridRow row in gridActivity.Rows)
            {
                if (row.Cells.FromKey(&quot;To&quot;).Value.ToString().Equals(&quot;true&quot;))
                {
                    activeRow = row;
                    break;
                }
            }
            if (activeRow == null)
            {
                activeRow = (gridActivity.DisplayLayout.ActiveRow != null) ? gridActivity.DisplayLayout.ActiveRow : null;
            }
            if (activeRow != null)
            {
                CellsCollection cells = activeRow.Cells;

                int itemID = Convert.ToInt32(cells.FromKey(&quot;ItemID&quot;).Value);

                DataTable dtActivities = RequestForInformationBL.Instance.GetActivities(ContractID, itemID);
                dtActivities.Columns.Add(&quot;ID&quot;, Type.GetType(&quot;System.Int32&quot;));
                dtActivities.Columns[&quot;ID&quot;].DefaultValue = 0;
                gridActivities.Rows.Clear(true);
                gridActivities.DataSource = dtActivities;
                gridActivities.DataBind();

                //if (!string.IsNullOrEmpty(Request[&quot;InstanceID&quot;]))
                //{
                if (!string.IsNullOrEmpty(cells.FromKey(&quot;Activities&quot;).Text))
                {
                    string[] activities = cells.FromKey(&quot;Activities&quot;).Text.Split(&#39;,&#39;);

                    foreach (UltraGridRow row in gridActivities.Rows)
                    {
                        foreach (string activity in activities)
                        {
                            string[] s = activity.Split(&#39;|&#39;);
                            if (s[0].Equals(row.Cells.FromKey(&quot;ActivityID&quot;).Text))
                            {
                                row.Cells.FromKey(&quot;To&quot;).Value = true;
                                row.Cells.FromKey(&quot;ID&quot;).Value = s[1] ?? &quot;0&quot;;
                            }
                        }
                    }
                }
                //}

                gridActivities.Width = Unit.Pixel(475);
                gridActivities.Height = Unit.Pixel(250);

                ColumnsCollection cols = gridActivities.Columns;

                var VisibleColumns = new List&lt;string&gt;(new[] { &quot;To&quot;, &quot;Name&quot;, &quot;Description&quot; });

                foreach (UltraGridColumn col in cols)
                    col.Hidden = !VisibleColumns.Contains(col.Key);
                hdnActClicked.Value = &quot;1&quot;;
            }
        }

        protected void btnViewPostings_Click(object sender, EventArgs e)
        {
            if (hdnValidate.Value == &quot;0&quot;)
                return;
            UltraGridRow activeRow = null;
            foreach (UltraGridRow row in gridActivity.Rows)
            {
                if (row.Cells.FromKey(&quot;To&quot;).Value.ToString().Equals(&quot;true&quot;))
                {
                    activeRow = row;
                    break;
                }
            }
            if (activeRow == null)
            {
                activeRow = (gridActivity.DisplayLayout.ActiveRow != null) ? gridActivity.DisplayLayout.ActiveRow : null;
            }
            if (activeRow != null)
            {
                CellsCollection cells = activeRow.Cells;

                string postingId = cells.FromKey(&quot;ItemPostingID&quot;).Value.ToString2();
                int itemID = Convert.ToInt32(cells.FromKey(&quot;ItemID&quot;).Value);
                //DataTable dtPostings = RequestForInformationBL.Instance.GetActivities(ContractID, itemID);
                DataTable dtPostings = RequestForInformationBL.Instance.GetPostings(itemID, postingId,
                                                                                    string.IsNullOrEmpty(
                                                                                        Request[&quot;InstanceID&quot;])
                                                                                        ? 0
                                                                                        : Convert.ToInt32(
                                                                                            Request[&quot;InstanceID&quot;]));
                dtPostings.Columns.Add(&quot;ID&quot;, Type.GetType(&quot;System.Int32&quot;));
                dtPostings.Columns[&quot;ID&quot;].DefaultValue = 0;
                gridPostings.Rows.Clear(true);
                gridPostings.DataSource = dtPostings;
                gridPostings.DataBind();
                btnPostingsSave.Enabled = (gridPostings.Rows.Count &gt; 0);
                actualQty = 0;
                if (!string.IsNullOrEmpty(cells.FromKey(&quot;ItemPostingID&quot;).Text))
                {
                    string[] postings = cells.FromKey(&quot;ItemPostingID&quot;).Text.Split(&#39;,&#39;);
                    List&lt;string&gt; postList = cells.FromKey(&quot;ItemPostingID&quot;).Text.Split(&#39;,&#39;).ToList();

                    foreach (UltraGridRow row in gridPostings.Rows)
                    {
                        foreach (string posting in postList)
                        {
                            if (posting.Trim().Equals(row.Cells.FromKey(&quot;PostingID&quot;).Text))
                            {
                                row.Cells.FromKey(&quot;To&quot;).Value = true;
                                actualQty += Convert.ToDecimal(row.Cells.FromKey(&quot;Posted Quantity&quot;).Value);
                                postList.Remove(posting);
                                break;
                            }
                        }
                    }
                }
                ViewState[&quot;ActualQty&quot;] = actualQty;
                gridPostings.Width = Unit.Pixel(475);
                gridPostings.Height = Unit.Pixel(250);

                ColumnsCollection cols = gridPostings.Columns;

                var VisibleColumns = new List&lt;string&gt;(new[] { &quot;To&quot;, &quot;Posting No&quot;, &quot;Posted Quantity&quot; });

                foreach (UltraGridColumn col in cols)
                    col.Hidden = !VisibleColumns.Contains(col.Key);
                btnPostingsSave.Enabled = (gridPostings.Rows.Count &gt; 0);
                hdnPostClicked.Value = &quot;1&quot;;

            }
        }

        protected void btnFilterGhost_Click(object sender, EventArgs e)
        {
            string filter = ModelHelper.GetFilterXML(tblFilter.UniqueID.Remove(tblFilter.UniqueID.Length - 9), Request,
                                                     GetApplyFilterLabels());
            BindGridControl(filter);
        }

        private DataTable EliminateDuplicates(DataTable dt)
        {
            DataTable dtGridTable = GetRFIItemsFromGrid();

            DataRow drRow = null;
            DataRow[] dr = null;
            foreach (DataRow row in dt.Rows)
            {
                //if (itemSource == 1)
                dr = dtGridTable.Select(&quot;ItemID=&#39;&quot; + row[&quot;ItemID&quot;] + &quot;&#39;&quot;);
                //else if (itemSource == 2)
                //    dr = dtGridTable.Select(&quot;ItemPostingID=&#39;&quot; + row[&quot;ItemPostingID&quot;].ToString() + &quot;&#39;&quot;);
                //dr = dtGridTable.Select(&quot;ItemID=&#39;&quot; + row[&quot;ItemID&quot;].ToString() + &quot;&#39; AND (SubItemID=&#39;0&#39; OR SubItemID =&#39;&quot; + row[&quot;SubItemID&quot;].ToString() + &quot;&#39;)&quot;);

                if (dr.Length == 0)
                {
                    drRow = dtGridTable.NewRow();

                    drRow[&quot;ID&quot;] = 0;
                    drRow[&quot;ItemID&quot;] = row[&quot;ItemID&quot;];
                    drRow[&quot;Line No.&quot;] = row[&quot;Line No.&quot;];
                    drRow[&quot;Pay Item No.&quot;] = row[&quot;Pay Item No.&quot;];
                    drRow[&quot;Description&quot;] = row[&quot;Description&quot;];
                    drRow[&quot;Unit&quot;] = row[&quot;Unit&quot;];
                    //drRow[&quot;UnitPrice&quot;] = row[&quot;UnitPrice&quot;];
                    //drRow[&quot;SubItemID&quot;] = row[&quot;SubItemID&quot;];
                    //drRow[&quot;Sub Item Name&quot;] = row[&quot;Sub Item Name&quot;];

                    //drRow[&quot;Submitted Quantity&quot;] = drRow[&quot;Avail Quantity&quot;] = row[&quot;Avail Quantity&quot;];

                    drRow[&quot;AttachmentID&quot;] = GetInstanceID() + &quot;-&quot; + row[&quot;ItemID&quot;];
                    //drRow[&quot;AttachmentID&quot;] = GetInstanceID() + &quot;-&quot; + row[&quot;ItemID&quot;].ToString() + &quot;-&quot; + row[&quot;SubItemID&quot;].ToString();
                    drRow[&quot;MB Quantity&quot;] = drRow[&quot;Certified Quantity&quot;] = DBNull.Value;
                    drRow[&quot;Submitted Quantity&quot;] = drRow[&quot;MB Quantity&quot;];
                    drRow[&quot;ItemPostingID&quot;] = row[&quot;ItemPostingID&quot;];
                    drRow[&quot;PostedCertifiedQty&quot;] = row[&quot;PostedCertifiedQty&quot;];
                    drRow[&quot;Avail Quantity&quot;] = row[&quot;Avail Quantity&quot;];

                    dtGridTable.Rows.Add(drRow);
                }
                else if (itemSource == 2)
                {
                    string[] postingIds = row[&quot;ItemPostingID&quot;].ToString().Split(&#39;,&#39;);
                    foreach (string postingId in postingIds)
                    {
                        dr =
                            dtGridTable.Select(&quot;ItemID=&#39;&quot; + row[&quot;ItemID&quot;] + &quot;&#39; AND ItemPostingID LIKE &#39;%&quot; + postingId +
                                               &quot;,%&#39;&quot;);
                        if (dr.Length == 0)
                        {
                            dr = dtGridTable.Select(&quot;ItemID=&#39;&quot; + row[&quot;ItemID&quot;] + &quot;&#39;&quot;);
                            dr[0].BeginEdit();
                            dr[0][&quot;ItemPostingID&quot;] = dr[0][&quot;ItemPostingID&quot;] + &quot;&quot; + row[&quot;ItemPostingID&quot;] + &quot;,&quot;;
                            //dr[0][&quot;Submitted Quantity&quot;] = (Convert.ToDecimal(dr[0][&quot;Submitted Quantity&quot;]) +
                            //                               Convert.ToDecimal(row[&quot;Avail Quantity&quot;]));
                            dr[0][&quot;Avail Quantity&quot;] = (Convert.ToDecimal(dr[0][&quot;Avail Quantity&quot;]) +
                                                       Convert.ToDecimal(row[&quot;Avail Quantity&quot;]));
                            dr[0].EndEdit();
                            dr[0].AcceptChanges();
                        }
                    }
                }
            }

            return dtGridTable;
        }

        private bool DeleteInvalidRows(DataTable dt)
        {
            bool isDeleted = false;
            DataRow[] dr = dt.Select(&quot;[Avail Quantity] = 0&quot;);
            if (dr.Length &gt; 0)
            {
                foreach (DataRow row in dr)
                {
                    dt.Rows.Remove(row);
                    isDeleted = true;
                }
            }
            dt.AcceptChanges();
            return isDeleted;
        }

        protected void lnkUserControlCancel_Click(object sender, EventArgs e)
        {
            SetDiv(Div.Main);

            SetHiddenVariables(hdnPickerClicked, &quot;R&quot;);

            PageTitle = (Mode == &quot;New&quot;)
                                  ? ((InstanceIDForUpdate == 0) ? &quot;New &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot; : &quot;Edit &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot;)
                                  : ((Mode == &quot;Edit&quot;) ? &quot;Edit &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot; : &quot;View &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot;&quot;);
        }

        protected void btnPicker_Click(object sender, EventArgs e)
        {
            SetDiv(Div.ItemPicker);

            SetHiddenVariables(hdnPickerClicked, &quot;P&quot;);

            PageTitle = LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR) + &quot; Picker&quot;;


        }

        protected void lnkInspectionDetails_Click(object sender, EventArgs e)
        {
            SetDiv(Div.InspectionDetails);
            SetHiddenVariables(hdnPickerClicked, &quot;I&quot;);
            PageTitle = &quot;Inspection Details&quot;;
        }

        private DataTable GetRFIItemsFromGrid()
        {
            var dt = new DataTable();

            LoadRFISchema(dt);

            UltraGridRowsEnumerator enParentRow = gridActivity.Bands[0].GetRowsEnumerator();

            DataRow dr = null;
            CellsCollection cells;
            while (enParentRow.MoveNext())
            {
                cells = enParentRow.Current.Cells;

                dr = dt.NewRow();
                dr[&quot;ID&quot;] = cells.FromKey(&quot;ID&quot;).Text;
                dr[&quot;ItemID&quot;] = cells.FromKey(&quot;ItemID&quot;).Text;
                dr[&quot;Line No.&quot;] = cells.FromKey(&quot;Line No.&quot;).Text;
                dr[&quot;Pay Item No.&quot;] = cells.FromKey(&quot;Pay Item No.&quot;).Text;
                dr[&quot;Description&quot;] = cells.FromKey(&quot;Description&quot;).Text;
                dr[&quot;Location&quot;] = cells.FromKey(&quot;Location&quot;).Text;
                dr[&quot;ItemPostingID&quot;] = cells.FromKey(&quot;ItemPostingID&quot;).Text;
                dr[&quot;Remarks&quot;] = cells.FromKey(&quot;Remarks&quot;).Text;
                if (cells.FromKey(&quot;Rejected Quantity&quot;).Value != null)
                    dr[&quot;Rejected Quantity&quot;] = cells.FromKey(&quot;Rejected Quantity&quot;).Text;
                //dr[&quot;SubItemID&quot;] = cells.FromKey(&quot;SubItemID&quot;).Value ?? &quot;0&quot;;
                //dr[&quot;Sub Item Name&quot;] = cells.FromKey(&quot;Sub Item Name&quot;).Text;
                dr[&quot;Unit&quot;] = cells.FromKey(&quot;Unit&quot;).Text;
                dr[&quot;Avail Quantity&quot;] = Convert.ToDecimal(cells.FromKey(&quot;Avail Quantity&quot;).Value);
                //dr[&quot;UnitPrice&quot;] = Convert.ToDecimal(cells.FromKey(&quot;UnitPrice&quot;).Value);
                dr[&quot;Submitted Quantity&quot;] = Convert.ToDecimal(cells.FromKey(&quot;Submitted Quantity&quot;).Value);
                if (cells.FromKey(&quot;MB Quantity&quot;).Value != null)
                {
                    dr[&quot;MB Quantity&quot;] = Convert.ToDecimal(cells.FromKey(&quot;MB Quantity&quot;).Value);
                    dr[&quot;Submitted Quantity&quot;] = dr[&quot;MB Quantity&quot;];
                }
                if (cells.FromKey(&quot;Certified Quantity&quot;).Value != null)
                    dr[&quot;Certified Quantity&quot;] = Convert.ToDecimal(cells.FromKey(&quot;Certified Quantity&quot;).Value);
                if (cells.Exists(&quot;PostedCertifiedQty&quot;))
                    dr[&quot;PostedCertifiedQty&quot;] = Convert.ToDecimal(cells.FromKey(&quot;PostedCertifiedQty&quot;).Value);
                dr[&quot;Measurement Book&quot;] = cells.FromKey(&quot;Measurement Book&quot;).Text;
                dr[&quot;AttachmentID&quot;] = cells.FromKey(&quot;AttachmentID&quot;).Text;
                dr[&quot;Activities&quot;] = cells.FromKey(&quot;Activities&quot;).Text;
                dt.Rows.Add(dr);
            }

            return dt;
        }

        private void Readonly()
        {
            txtDrawingNo.ReadOnly =
            txtReferenceNo.ReadOnly =
            txtKindAttention.ReadOnly =
            wmeInspectionTime.ReadOnly =
            txtJobNumber.ReadOnly =
            txtAddress.ReadOnly =
            txtArea.ReadOnly =
            txtReceivedBy.ReadOnly =
            wdcReceivedDate.ReadOnly =
            wmeReceivedTime.ReadOnly =
            txtNotes.ReadOnly =
            txtReferenceNo.ReadOnly =
            txtSubmittedOwner.ReadOnly =
            txtSubmittedByName.ReadOnly =
            txtSubmittedDesignation.ReadOnly =
            txtApprovedOwner.ReadOnly =
            txtApprovedBy.ReadOnly =
            txtApprovedDesignation.ReadOnly = true;
            wdcCreatedDate.Enabled =
            wdcInspectionDate.Enabled =
            wdcSubmittedDate.Enabled =
            wdcApprovedDate.Enabled =
            chk1.Enabled = chk2.Enabled =
            chk3.Enabled = chk4.Enabled =
            chkCurvlet.Enabled = chkSurvey.Enabled = chkOthers.Enabled = false;
            if (gridActivity.Columns.Exists(&quot;MB Quantity&quot;))
            {
                gridActivity.Columns.FromKey(&quot;MB Quantity&quot;).AllowUpdate = AllowUpdate.No;
                gridActivity.Columns.FromKey(&quot;MB Quantity&quot;).CellStyle.BackColor = Color.Transparent;
            }
            if (gridActivity.Columns.Exists(&quot;Certified Quantity&quot;))
            {
                gridActivity.Columns.FromKey(&quot;Certified Quantity&quot;).AllowUpdate = AllowUpdate.No;
                gridActivity.Columns.FromKey(&quot;Certified Quantity&quot;).CellStyle.BackColor = Color.Transparent;
            }
            if (gridActivity.Columns.Exists(&quot;Remarks&quot;))
            {
                gridActivity.Columns.FromKey(&quot;Remarks&quot;).AllowUpdate = AllowUpdate.No;
                gridActivity.Columns.FromKey(&quot;Remarks&quot;).CellStyle.BackColor = Color.Transparent;
            }


        }

        private void LoadPageForEditState()
        {
            //IState state = GetWorkflowStageFor(_WorkflowsInitiated[0]);
            DataSet ds = RequestForInformationBL.Instance.GetRFIDetails(Convert.ToInt32(Request[&quot;InstanceID&quot;]));

            BindItemGridAndFormat(ds.Tables[1]);

            DataRow dr = ds.Tables[0].Rows[0];

            wdcCreatedOn.Value = Convert.ToDateTime(dr[&quot;CreatedDate&quot;]);
            wdcCreatedDate.Value = Convert.ToDateTime(dr[&quot;RFIDate&quot;]);
            lblRFINo.Text = dr[&quot;RFI Number&quot;].ToString();
            txtAddress.Text = dr[&quot;Address&quot;].ToString();
            txtArea.Text = dr[&quot;Area&quot;].ToString();
            txtNotes.Text = dr[&quot;Remarks&quot;].ToString();
            txtDrawingNo.Text = dr[&quot;DrawingNumber&quot;].ToString();
            txtJobNumber.Text = dr[&quot;JobNumber&quot;].ToString();
            txtReferenceNo.Text = dr[&quot;RFIRefNumber&quot;].ToString2();
            txtKindAttention.Text = dr[&quot;KindAttention&quot;].ToString();
            //txtLocation.Text = dr[&quot;Location&quot;].ToString();
            txtRevisionNo.Text = dr[&quot;RevisionNumber&quot;].ToString();
            wdcInspectionDate.MinDate = Convert.ToDateTime(wdcCreatedDate.Value);
            wdcInspectionDate.Value = Convert.ToDateTime(dr[&quot;InspectionDate&quot;]);
            wmeInspectionTime.Value = dr[&quot;InspectionTime&quot;].ToString();
            usercontrolInspectionDetails.MinDate = Convert.ToDateTime(dr[&quot;RFIDate&quot;]);
            status = (RFIStatus)Enum.Parse(typeof(RFIStatus), dr[&quot;Status&quot;].ToString(), true);
            chk1.Checked = Convert.ToBoolean(dr[&quot;DisciplineRoads&quot;]);
            chk2.Checked = Convert.ToBoolean(dr[&quot;DisciplineBridge&quot;]);
            chk3.Checked = Convert.ToBoolean(dr[&quot;DisciplineUtilities&quot;]);
            chkCurvlet.Checked = Convert.ToBoolean(dr[&quot;DisciplineCulvert&quot;]);
            chkSurvey.Checked = Convert.ToBoolean(dr[&quot;DisciplineSurvey&quot;]);
            chkOthers.Checked = Convert.ToBoolean(dr[&quot;DisciplineOthers&quot;]);
            txtSpecRefNotes.Text = dr[&quot;DisciplineRef&quot;].ToString();
            chk4.Checked = (!string.IsNullOrEmpty(txtSpecRefNotes.Text));
            if (chk4.Checked)
                txtSpecRefNotes.Style.Add(HtmlTextWriterStyle.Visibility, &quot;visible&quot;);
            lblCreatedBy.Text = dr[&quot;Created By&quot;].ToString();
            if (!dr[&quot;Submitted By&quot;].Equals(DBNull.Value))
                lblSubmittedBy.Text = dr[&quot;Submitted By&quot;].ToString();
            if (!dr[&quot;SubmittedDate&quot;].Equals(DBNull.Value))
                lblSubmittedOn.Text = Convert.ToDateTime(dr[&quot;SubmittedDate&quot;]).ToString(AMP3ApplicationSettings.Instance.FORMAT_DATE,
                                                                                       DateFormatCulture.
                                                                                           GetDateFormatCulture());
            if (!dr[&quot;Approved By&quot;].Equals(DBNull.Value))
                lblApprovedBy.Text = dr[&quot;Approved By&quot;].ToString();
            if (!dr[&quot;ApprovedDate&quot;].Equals(DBNull.Value))
                lblApprovedOn.Text = Convert.ToDateTime(dr[&quot;ApprovedDate&quot;]).ToString(AMP3ApplicationSettings.Instance.FORMAT_DATE,
                                                                                     DateFormatCulture.
                                                                                         GetDateFormatCulture());
            if (status &gt;= RFIStatus.Submitted)
            {
                trInspection.Style.Value = &quot;display:block&quot;;
                usercontrolInspectionDetails.MinDate = Convert.ToDateTime(dr[&quot;RFIDate&quot;]);
            }

            //if (status &gt;= RFIStatus.Submitted || (action.HasValue &amp;&amp; action.Value == RFIStatus.Submitted))
            if (status &gt;= RFIStatus.Complete)
            {
                wdcSubmittedDate.MinDate = Convert.ToDateTime(dr[&quot;RFIDate&quot;]);
                wdcSubmittedDate.MaxDate = ProjectMode.Equals(&quot;L&quot;) ? DateTime.MaxValue : IntegrationCutoffDate;
                tableSubmitDetails.Style.Add(&quot;display&quot;, &quot;block&quot;);//For showing table tableSubmitDetails when status is Complete
                if (!dr[&quot;SubmittedOwner&quot;].Equals(DBNull.Value))
                {
                    txtSubmittedOwner.Text = dr[&quot;SubmittedOwner&quot;].ToString();
                }
                else
                {
                    txtSubmittedOwner.Text = dr[&quot;PrimeContractor&quot;].ToString();
                }
                if (!dr[&quot;SubmittedBy&quot;].Equals(DBNull.Value))
                    txtSubmittedByName.Text = dr[&quot;SubmittedBy&quot;].ToString();
                if (!dr[&quot;SubmittedDate&quot;].Equals(DBNull.Value))
                    wdcSubmittedDate.Value = Convert.ToDateTime(dr[&quot;SubmittedDate&quot;],
                                                                DateFormatCulture.GetDateFormatCulture());
                if (!dr[&quot;SubmittedDesignation&quot;].Equals(DBNull.Value))
                    txtSubmittedDesignation.Text = dr[&quot;SubmittedDesignation&quot;].ToString();
            }

            //if ((status &gt;= RFIStatus.Submitted &amp;&amp; !action.HasValue) || (action.HasValue &amp;&amp; action.Value == RFIStatus.Approved))
            if (status &gt;= RFIStatus.Submitted)
            {
                tableReceived.Style.Add(&quot;display&quot;, &quot;block&quot;);//For showing table tableReceived when status is Submitted
                tableReceivedBy.Style.Add(&quot;display&quot;, &quot;block&quot;);//For showing table tableReceivedBy when status is Submitted
                tableApproved.Style.Add(&quot;display&quot;, &quot;block&quot;);//For showing table tableApproved when status is Submitted

                if (!dr[&quot;ReceivedBy&quot;].Equals(DBNull.Value))
                    txtReceivedBy.Text = dr[&quot;ReceivedBy&quot;].ToString();
                if (!dr[&quot;ReceivedDate&quot;].Equals(DBNull.Value))
                    wdcReceivedDate.Value = Convert.ToDateTime(dr[&quot;ReceivedDate&quot;],
                                                               DateFormatCulture.GetDateFormatCulture());
                if (!dr[&quot;ReceivedTime&quot;].Equals(DBNull.Value))
                    wmeReceivedTime.Value = dr[&quot;ReceivedTime&quot;].ToString();
            }

            //if (status &gt;= RFIStatus.Submitted || (action.HasValue &amp;&amp; action.Value == RFIStatus.Approved))
            if (status &gt;= RFIStatus.Submitted)
            {
                tableReceived.Style.Add(&quot;display&quot;, &quot;block&quot;);//For showing table tableReceived when status is Submitted
                tableReceivedBy.Style.Add(&quot;display&quot;, &quot;block&quot;);//For showing table tableReceivedBy when status is Submitted
                tableApproved.Style.Add(&quot;display&quot;, &quot;block&quot;);//For showing table tableApproved when status is Submitted
                if (!dr[&quot;ApprovedOwner&quot;].Equals(DBNull.Value))
                {
                    txtApprovedOwner.Text = dr[&quot;ApprovedOwner&quot;].ToString();
                }
                else
                {
                    txtApprovedOwner.Text = dr[&quot;Owner&quot;].ToString();
                }
                if (!dr[&quot;ApprovedBy&quot;].Equals(DBNull.Value))
                    txtApprovedBy.Text = dr[&quot;ApprovedBy&quot;].ToString();
                if (!dr[&quot;ApprovedDate&quot;].Equals(DBNull.Value))
                    wdcApprovedDate.Value = Convert.ToDateTime(dr[&quot;ApprovedDate&quot;],
                                                               DateFormatCulture.GetDateFormatCulture());
                if (!dr[&quot;ApprovedDesignation&quot;].Equals(DBNull.Value))
                    txtApprovedDesignation.Text = dr[&quot;ApprovedDesignation&quot;].ToString();
            }

            FillActivities(ds.Tables[2]);

            ds.Tables[3].TableName = &quot;MBookItems&quot;;
            ds.Tables[4].TableName = &quot;MBookItemsDetail&quot;;

            DTMBookItems = ds.Tables[&quot;MBookItems&quot;].Copy();
            (ucMeasurementEntry as MeasurementEntry).DTExistingMBookItemsDetail = ds.Tables[&quot;MBookItemsDetail&quot;].Copy();
        }

        private void FillActivities(DataTable dt)
        {
            foreach (UltraGridRow row in gridActivity.DisplayLayout.Rows)
            {
                DataRow[] dr = dt.Select(&quot;RFIItemID=&quot; + row.Cells.FromKey(&quot;ID&quot;).Text);
                if (dr.Length &gt; 0)
                {
                    row.Cells.FromKey(&quot;Activities&quot;).Value = &quot;&quot;;
                    foreach (DataRow r in dt.Select(&quot;RFIItemID=&quot; + row.Cells.FromKey(&quot;ID&quot;).Text))
                        row.Cells.FromKey(&quot;Activities&quot;).Value += r[&quot;ActivityID&quot;] + &quot;|&quot; + r[&quot;ID&quot;] + &quot;,&quot;;
                    row.Cells.FromKey(&quot;Activities&quot;).Value = row.Cells.FromKey(&quot;Activities&quot;).Text.TrimEnd(&#39;,&#39;);
                }
            }
        }

        private string ProcessItemPicker(string itemList, string subItemList, string activitiesList)
        {
            collection = new List&lt;Container&gt;();

            string[] str = itemList.Split(&quot;;&quot;.ToCharArray());

            for (int i = 0; i &lt; str.Length - 1; i++)
            {
                if (!collection.Exists(x =&gt; x.ItemID == Convert.ToInt32(str[i])))
                {
                    var c = new Container();

                    c.ItemID = Convert.ToInt32(str[i]);
                    c.SubItemID = 0;
                    c.ActivityID = 0;
                    c.RFIID = String.IsNullOrEmpty(Request[&quot;InstanceID&quot;]) ? 0 : Convert.ToInt32(Request[&quot;InstanceID&quot;]);
                    c.ItemSource = itemSource;
                    c.ItemType = itemType;
                    collection.Add(c);

                }
            }

            string[] str1 = subItemList.Split(&quot;;&quot;.ToCharArray());

            for (int i = 0; i &lt; str1.Length - 1; i++)
            {
                string[] temp;
                temp = str1[0].Split(&quot;/&quot;.ToCharArray());

                int itemID = Convert.ToInt32(temp[0]);
                int subItemID = Convert.ToInt32(temp[1]);
                if (!collection.Exists(x =&gt; (x.ItemID == itemID) || (x.ItemID == itemID &amp;&amp; x.SubItemID == SubItemID)))
                {
                    var c = new Container();

                    c.ItemID = itemID;
                    c.SubItemID = subItemID;
                    c.ActivityID = 0;
                    c.ItemSource = itemSource;
                    c.ItemType = itemType;

                    collection.Add(c);
                }
            }

            string[] str2 = activitiesList.Split(&quot;;&quot;.ToCharArray());

            for (int i = 0; i &lt; str2.Length - 1; i++)
            {
                string[] temp1;
                temp1 = str2[0].Split(&quot;/&quot;.ToCharArray());

                int itemID = Convert.ToInt32(temp1[0]);
                int subItemID = Convert.ToInt32(temp1[1]);
                int activityID = Convert.ToInt32(temp1[2]);

                if (!collection.Exists(x =&gt; (x.ItemID == itemID) || (x.ItemID == itemID &amp;&amp; x.SubItemID == SubItemID)
                                            ||
                                            (x.ItemID == itemID &amp;&amp; x.SubItemID == subItemID &amp;&amp;
                                             x.ActivityID == activityID)))
                {
                    var c = new Container();

                    c.ItemID = itemID;
                    c.SubItemID = subItemID;
                    c.ActivityID = activityID;
                    c.ItemSource = itemSource;
                    c.ItemType = itemType;

                    collection.Add(c);
                }
            }

            string xmlList = RequestForInformationBL.Instance.SerializeDTO(collection).Replace(&quot;encoding=\&quot;utf-8\&quot;&quot;,
                                                                                               String.Empty);

            hdnSubItemIDList.Value =
                hdnActivityIDList.Value =
                hdnItemIDList.Value = String.Empty;

            return xmlList;
        }

        private int GetInstanceID()
        {
            if (ViewState[&quot;InstanceID&quot;] == null)
            {
                if (!string.IsNullOrEmpty(Request[&quot;InstanceID&quot;]))
                    ViewState[&quot;InstanceID&quot;] = Request[&quot;InstanceID&quot;];
                else
                    ViewState[&quot;InstanceID&quot;] =
                        Application[&quot;CONTRFI_InstanceID&quot;] =
                        (Application[&quot;CONTRFI_InstanceID&quot;] == null)
                            ? 1
                            : Convert.ToInt32(Application[&quot;CONTRFI_InstanceID&quot;]) + 1;
            }
            return Convert.ToInt32(ViewState[&quot;InstanceID&quot;]);
        }

        protected override void SetModes()
        {
            base.SetModes();
            _IsNew = string.IsNullOrEmpty(Request.QueryString[&quot;InstanceID&quot;]) &amp;&amp; !IsPostBack;
            _IsEdit = !(bool)_IsNew;
        }

        #region Measurement Book

        //For M Book Items
        private DataTable GetMBookItemsSchema()
        {
            DataTable dtMBookItems = new BrixDataTable(&quot;MBookItems&quot;);

            dtMBookItems.Columns.AddRange(new[]
                                              {
                                                  new DataColumn(&quot;ID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                                                  new DataColumn(&quot;ParentInstanceID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                                                  new DataColumn(&quot;ItemID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                                                  new DataColumn(&quot;LineNo&quot;, Type.GetType(&quot;System.Int32&quot;)),
                                                  new DataColumn(&quot;StandardItemNo&quot;, Type.GetType(&quot;System.String&quot;)),
                                                  new DataColumn(&quot;Description&quot;, Type.GetType(&quot;System.String&quot;)),
                                                  new DataColumn(&quot;ActivityID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                                                  new DataColumn(&quot;ActivityName&quot;, Type.GetType(&quot;System.String&quot;)),
                                                  new DataColumn(&quot;SubItemID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                                                  new DataColumn(&quot;SubItem&quot;, Type.GetType(&quot;System.String&quot;)),
                                                  new DataColumn(&quot;Unit&quot;, Type.GetType(&quot;System.String&quot;)),
                                                  new DataColumn(&quot;MBookNo&quot;, Type.GetType(&quot;System.String&quot;)),
                                                  new DataColumn(&quot;Quantity&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                  new DataColumn(&quot;MeasurementBook&quot;, Type.GetType(&quot;System.String&quot;)),
                                                  new DataColumn(&quot;MBookRequired&quot;, Type.GetType(&quot;System.Boolean&quot;)),
                                                  new DataColumn(&quot;Length&quot;, Type.GetType(&quot;System.Boolean&quot;)),
                                                  new DataColumn(&quot;Width&quot;, Type.GetType(&quot;System.Boolean&quot;)),
                                                  new DataColumn(&quot;Height&quot;, Type.GetType(&quot;System.Boolean&quot;))
                                              });
            return dtMBookItems;
        }

        //This adds the M Book Items to DTMBookItems while selecting rows in generic picker
        private void AddMBookItemsToDataTable(UltraGridRow ugr)
        {
            DataRow drMBookItems = DTMBookItems.NewRow();
            drMBookItems[&quot;ID&quot;] = &quot;-1&quot;;
            drMBookItems[&quot;ParentInstanceID&quot;] = InstanceIDForUpdate;
            drMBookItems[&quot;ItemID&quot;] = ugr.Cells.FromKey(&quot;ItemID&quot;).Text;
            drMBookItems[&quot;LineNo&quot;] = ugr.Cells.FromKey(&quot;Line No.&quot;).Text;
            drMBookItems[&quot;StandardItemNo&quot;] = ugr.Cells.FromKey(&quot;Pay Item No.&quot;).Text;
            drMBookItems[&quot;Description&quot;] = ugr.Cells.FromKey(&quot;Description&quot;).Text;
            drMBookItems[&quot;ActivityID&quot;] = &quot;-1&quot;;
            drMBookItems[&quot;ActivityName&quot;] = string.Empty;
            drMBookItems[&quot;SubItemID&quot;] = &quot;-1&quot;;
            drMBookItems[&quot;SubItem&quot;] = string.Empty;
            drMBookItems[&quot;Unit&quot;] = ugr.Cells.FromKey(&quot;Unit&quot;).Text;
            drMBookItems[&quot;MBookNo&quot;] = &quot;-----&quot;;
            drMBookItems[&quot;Quantity&quot;] = 0;
            drMBookItems[&quot;MeasurementBook&quot;] = LocalizationManager.GetString(&quot;LOC_MeasurementBook&quot;);
            drMBookItems[&quot;MBookRequired&quot;] = &quot;false&quot;;
            drMBookItems[&quot;Length&quot;] = &quot;false&quot;;
            drMBookItems[&quot;Width&quot;] = &quot;false&quot;;
            drMBookItems[&quot;Height&quot;] = &quot;false&quot;;
            DTMBookItems.Rows.Add(drMBookItems);
        }

        #endregion

        #region &quot;functions&quot;

        private void SetDiv(Div enumeration)
        {
            hideWorkflowButtons = (enumeration != Div.Main);
            RequestForInformationBL.Instance.ToggleDiv(divRFIMain, (enumeration == Div.Main));
            RequestForInformationBL.Instance.ToggleDiv(divItemPicker, (enumeration == Div.ItemPicker));
            RequestForInformationBL.Instance.ToggleDiv(divInspectionDetails, (enumeration == Div.InspectionDetails));
            RequestForInformationBL.Instance.ToggleDiv(divAttachments, (enumeration == Div.Attachments));
            RequestForInformationBL.Instance.ToggleDiv(divMeasurementEntry, (enumeration == Div.MeasurementEntry));
        }

        private void SetHiddenVariables(HiddenField hf, string value)
        {
            hf.Value = value;
        }

        private void FetchActivities(HierarchicalGrid sender, int itemID)
        {
            sender.ActivityTable = new DataTable();
        }

        private void FetchSubItems(HierarchicalGrid sender, int itemID)
        {
            sender.SubItemTable = new DataTable();
        }

        private void BindGridControl(string filter)
        {
            filter = string.IsNullOrEmpty(filter) ? &quot;&lt;XMLRoot&gt;&lt;/XMLRoot&gt;&quot; : filter;
            rfiID = 0;
            if (!String.IsNullOrEmpty(Request[&quot;InstanceID&quot;]))
                rfiID = Convert.ToInt32(Request[&quot;InstanceID&quot;]);
            DataSet ds = RequestForInformationBL.Instance.GetCOREItemList(rfiID, ContractID, filter, out itemSource,
                                                                          out itemType);
            if (itemSource == 1)
            {
                ds.Tables[0].TableName = &quot;Container&quot;;
                ds.Tables[1].TableName = &quot;Items&quot;;
                ds.Tables[2].TableName = &quot;ItemSummary&quot;;
                ds.Tables[4].TableName = &quot;ActivityDates&quot;;
                ds.AcceptChanges();

                HGrid.ContainerTable = ds.Tables[&quot;Container&quot;];
                HGrid.ItemTable = ds.Tables[&quot;Items&quot;];
                HGrid.ItemSummaryTable = ds.Tables[&quot;ItemSummary&quot;];
                HGrid.ContainerIDColumn = &quot;ContainerID&quot;;
                HGrid.ParentContainerIDColumn = &quot;ParentContainerID&quot;;
                HGrid.ContainerNameColumn = &quot;ContainerName&quot;;
                HGrid.ItemIDColumn = &quot;ItemID&quot;;
                HGrid.ItemNameColumn = &quot;StandardItemNo&quot;;
                HGrid.ItemContainerIDColumn = &quot;ContainerID&quot;;

                HGrid.AmountColumn = RequestForInformationBL.Instance.AmountColumn();
                HGrid.IsReadOnly = true;
                HGrid.Columns = RequestForInformationBL.Instance.HGridColumns();

                HGrid.FetchActivities += FetchActivities;
                HGrid.FetchSubItems += FetchSubItems;
                HGrid.FindControl(&quot;ESI&quot;).EnableViewState = false;
                HGrid.Bind();
            }
            else if (itemSource == 2)
            {
                ds.Tables[0].TableName = &quot;Container&quot;;
                ds.Tables[1].TableName = &quot;Items&quot;;
                ds.Tables[2].TableName = &quot;ItemSummary&quot;;

                HGrid.ContainerTable = ds.Tables[&quot;Container&quot;];
                HGrid.ItemTable = ds.Tables[&quot;Items&quot;];
                HGrid.ItemSummaryTable = ds.Tables[&quot;ItemSummary&quot;];

                HGrid.ContainerIDColumn = &quot;ContainerID&quot;;
                HGrid.ParentContainerIDColumn = &quot;ParentContainerID&quot;;
                HGrid.ContainerNameColumn = &quot;ContainerName&quot;;

                HGrid.ItemIDColumn = &quot;ItemPostingID&quot;;
                HGrid.ItemNameColumn = &quot;StandardItemNo&quot;;
                HGrid.ItemContainerIDColumn = &quot;ContainerID&quot;;

                HGrid.IsCalculateQtyOnChecked = true;
                //HGrid.IsCheckItemWithContainer = true;
                HGrid.QuantityColumn = &quot;Posted Quantity&quot;;

                HGrid.AmountColumn = RequestForInformationBL.Instance.AmountColumn();
                HGrid.IsReadOnly = true;
                HGrid.Columns = RequestForInformationBL.Instance.HGridPostingColumns();

                HGrid.FetchActivities += FetchActivities;
                HGrid.FetchSubItems += FetchSubItems;
                HGrid.FindControl(&quot;ESI&quot;).EnableViewState = false;
                HGrid.Bind();
            }
        }

        //private void BindGridControl(string filter)
        //{
        //    filter = string.IsNullOrEmpty(filter) ? &quot;&lt;XMLRoot&gt;&lt;IsContractView&gt;1&lt;/IsContractView&gt;&lt;/XMLRoot&gt;&quot; : filter.Replace(&quot;&lt;/XMLRoot&gt;&quot;, &quot;&lt;IsContractView&gt;1&lt;/IsContractView&gt;&lt;/XMLRoot&gt;&quot;);
        //    DataSet ds = RequestForInformationBL.Instance.GetItemList(filter, ContractID);

        //    HGrid.ContainerTable = ds.Tables[&quot;Container&quot;];
        //    HGrid.ItemTable = ds.Tables[&quot;Items&quot;];
        //    HGrid.ItemSummaryTable = ds.Tables[&quot;ItemSummary&quot;];
        //    HGrid.ContainerIDColumn = &quot;ContainerID&quot;;
        //    HGrid.ParentContainerIDColumn = &quot;ParentContainerID&quot;;
        //    HGrid.ContainerNameColumn = &quot;ContainerName&quot;;
        //    HGrid.ItemIDColumn = &quot;ItemID&quot;;
        //    HGrid.ItemNameColumn = &quot;StandardItemNo&quot;;
        //    HGrid.ItemContainerIDColumn = &quot;ContainerID&quot;;

        //    HGrid.AmountColumn = RequestForInformationBL.Instance.AmountColumn();
        //    HGrid.IsReadOnly = true;
        //    HGrid.Columns = RequestForInformationBL.Instance.HGridColumns();

        //    HGrid.FetchActivities += new OnDemandFetchHandler(FetchActivities);
        //    HGrid.FetchSubItems += new OnDemandFetchHandler(FetchSubItems);
        //    HGrid.FindControl(&quot;ESI&quot;).EnableViewState = false;
        //    HGrid.Bind();
        //}

        private void BindGridControl()
        {
            string filter = ModelHelper.GetFilterXML(tblFilter.UniqueID.Remove(tblFilter.UniqueID.Length - 9), Request,
                                                     GetApplyFilterLabels());
            BindGridControl(filter);
            //BindGridControl(string.Empty);
        }

        private void LoadRFISchema(DataTable dt)
        {
            dt.Columns.AddRange(
                new[]
                    {
                        new DataColumn(&quot;ID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                        new DataColumn(&quot;ItemID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                        new DataColumn(&quot;Line No.&quot;, Type.GetType(&quot;System.String&quot;)),
                        new DataColumn(&quot;Pay Item No.&quot;, Type.GetType(&quot;System.String&quot;)),
                        new DataColumn(&quot;Description&quot;, Type.GetType(&quot;System.String&quot;)),
                        new DataColumn(&quot;Location&quot;, Type.GetType(&quot;System.String&quot;)),
                        //new DataColumn(&quot;SubItemID&quot;,Type.GetType(&quot;System.Int32&quot;)),
                        //new DataColumn(&quot;Sub Item Name&quot;,Type.GetType(&quot;System.String&quot;)),
                        new DataColumn(&quot;Unit&quot;, Type.GetType(&quot;System.String&quot;)),
                        new DataColumn(&quot;PostedCertifiedQty&quot;,Type.GetType(&quot;System.Decimal&quot;)),
                        new DataColumn(&quot;Avail Quantity&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                        //new DataColumn(&quot;UnitPrice&quot;,Type.GetType(&quot;System.Decimal&quot;)),
                        new DataColumn(&quot;Submitted Quantity&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                        new DataColumn(&quot;MB Quantity&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                        new DataColumn(&quot;Measurement Book&quot;, Type.GetType(&quot;System.String&quot;)),
                        new DataColumn(&quot;Certified Quantity&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                        new DataColumn(&quot;AttachmentID&quot;, Type.GetType(&quot;System.String&quot;)),
                        new DataColumn(&quot;Activities&quot;, Type.GetType(&quot;System.String&quot;)),
                        new DataColumn(&quot;Rejected Quantity&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                        new DataColumn(&quot;Remarks&quot;, Type.GetType(&quot;System.String&quot;)),
                        new DataColumn(&quot;ItemPostingID&quot;, Type.GetType(&quot;System.String&quot;)),
                                               
                    }
                );
        }

        private void BindItemGridAndFormat(DataTable dt)
        {
            //dt.Columns.Add(&quot;Submitted Value&quot;, typeof(System.Decimal), &quot;UnitPrice*[Submitted Quantity]&quot;);
            //dt.Columns.Add(&quot;Certified Value&quot;, typeof(System.Decimal), &quot;UnitPrice*[Certified Quantity]&quot;);

            //dt.AcceptChanges();

            gridActivity.DataSource = dt;
            gridActivity.DataBind();
            gridActivity.Height = Unit.Pixel(200);


            var hdnList = new[] { &quot;ID&quot;, &quot;SubItemID&quot;, &quot;Sub Item Name&quot;, &quot;ItemID&quot;, &quot;AttachmentID&quot;, 
                &quot;Activities&quot;, &quot;IsSubmit&quot;, &quot;PostingID&quot;, &quot;ItemPostingID&quot;,&quot;PostedCertifiedQty&quot; };
            foreach (UltraGridColumn col in gridActivity.Columns)
                col.Hidden = hdnList.Contains(col.Key);
            if (gridActivity.Columns.Exists(&quot;Line No&quot;))
            {
                gridActivity.Columns.FromKey(&quot;Line No&quot;).CellStyle.Width = 200;
            }
            if (gridActivity.Columns.Exists(&quot;Unit&quot;))
            {
                gridActivity.Columns.FromKey(&quot;Unit&quot;).CellStyle.Width = 100;
            }
            if (gridActivity.Columns.Exists(&quot;Location&quot;))
            {
                gridActivity.Columns.FromKey(&quot;Location&quot;).AllowUpdate = AllowUpdate.Yes;
                gridActivity.Columns.FromKey(&quot;Location&quot;).FieldLen = 500;
                gridActivity.Columns.FromKey(&quot;Location&quot;).Hidden = true;
            }
            if (gridActivity.Columns.Exists(&quot;Measurement Book&quot;))
            {
                if (!(Request.Browser.IsBrowser(&quot;IE&quot;) &amp;&amp; Request.Browser.MajorVersion == 9))
                {
                    gridActivity.Columns.FromKey(&quot;Measurement Book&quot;).Type = ColumnType.Button;
                    gridActivity.DisplayLayout.ClientSideEvents.ClickCellButtonHandler = &quot;gridActivity_CellClickHandler&quot;;
                }

                gridActivity.Columns.FromKey(&quot;Measurement Book&quot;).Header.Caption = &quot;LOC_MBook&quot;;//&quot;&quot; + LocalizationManager.GetString(&quot;LOC_MeasurementBook&quot;);
            }
            //if (gridActivity.Columns.Exists(&quot;Rejected Quantity&quot;))
            //{
            //    gridActivity.Columns.FromKey(&quot;Rejected Quantity&quot;).AllowUpdate = AllowUpdate.Yes;
            //    gridActivity.Columns.FromKey(&quot;Rejected Quantity&quot;).FieldLen = 500;
            //}grid.columns[&quot;&quot;].cellStyle.width grid.columns[&quot;&quot;].width

            if (gridActivity.Columns.Exists(&quot;Remarks&quot;))
            {
                gridActivity.Columns.FromKey(&quot;Remarks&quot;).AllowUpdate = AllowUpdate.Yes;
                gridActivity.Columns.FromKey(&quot;Remarks&quot;).FieldLen = 500;
            }
            if (gridActivity.Columns.Exists(&quot;MB Quantity&quot;))
            {
                gridActivity.Columns.FromKey(&quot;MB Quantity&quot;).Header.Caption = &quot;Submitted Quantity&quot;;//&quot;&quot; + LocalizationManager.GetString(&quot;LOC_MeasurementBook&quot;) + &quot; Quantity&quot;;
                gridActivity.Columns.FromKey(&quot;MB Quantity&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
            }
            if (gridActivity.Columns.Exists(&quot;Submitted Quantity&quot;))
            {
                gridActivity.Columns.FromKey(&quot;Submitted Quantity&quot;).Hidden = true;
                gridActivity.Columns.FromKey(&quot;Submitted Quantity&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
            }
            if (gridActivity.Columns.Exists(&quot;Avail Quantity&quot;))
            {
                gridActivity.Columns.FromKey(&quot;Avail Quantity&quot;).Header.Caption = &quot;Available Quantity&quot;;//&quot;&quot; + LocalizationManager.GetString(&quot;LOC_MeasurementBook&quot;) + &quot; Quantity&quot;;
                gridActivity.Columns.FromKey(&quot;Avail Quantity&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
            }
            //if (gridActivity.Columns.Exists(&quot;UnitPrice&quot;))
            //{
            //    gridActivity.Columns.FromKey(&quot;UnitPrice&quot;).Hidden = true;

            //}
            if (gridActivity.Columns.Exists(&quot;Certified Quantity&quot;))
            {
                gridActivity.Columns.FromKey(&quot;Certified Quantity&quot;).AllowUpdate = AllowUpdate.Yes;
                gridActivity.Columns.FromKey(&quot;Certified Quantity&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                gridActivity.Columns.FromKey(&quot;Certified Quantity&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
            }

            //if (gridActivity.Columns.Exists(&quot;Submitted Value&quot;) &amp;&amp; gridActivity.Columns.Exists(&quot;MB Quantity&quot;))
            //{
            //    gridActivity.Columns.FromKey(&quot;Submitted Value&quot;).Move(gridActivity.Columns.FromKey(&quot;MB Quantity&quot;).Index + 1);
            //    gridActivity.Columns.FromKey(&quot;Submitted Value&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
            //    gridActivity.Columns.FromKey(&quot;Submitted Value&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
            //}

            //if (gridActivity.Columns.Exists(&quot;Certified Value&quot;) &amp;&amp; gridActivity.Columns.Exists(&quot;Certified Quantity&quot;))
            //{
            //    gridActivity.Columns.FromKey(&quot;Certified Value&quot;).Move(gridActivity.Columns.FromKey(&quot;Certified Quantity&quot;).Index + 1);
            //    gridActivity.Columns.FromKey(&quot;Certified Value&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
            //    gridActivity.Columns.FromKey(&quot;Certified Value&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
            //}
            if (gridActivity.Columns.Exists(&quot;Rejected Quantity&quot;))
            {
                gridActivity.Columns.FromKey(&quot;Rejected Quantity&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
            }

            gridActivity.DisplayLayout.ColFootersVisibleDefault = ShowMarginInfo.Yes;

            //gridActivity.Columns.FromKey(&quot;Submitted Value&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
            //gridActivity.Columns.FromKey(&quot;Submitted Value&quot;).Footer.Total = SummaryInfo.Sum;
            //gridActivity.Columns.FromKey(&quot;Submitted Value&quot;).Footer.Style.HorizontalAlign = HorizontalAlign.Right;

            //gridActivity.Columns.FromKey(&quot;Certified Value&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
            //gridActivity.Columns.FromKey(&quot;Certified Value&quot;).Footer.Total = SummaryInfo.Sum;
            //gridActivity.Columns.FromKey(&quot;Certified Value&quot;).Footer.Style.HorizontalAlign = HorizontalAlign.Right;

        }

        private void EnableGridEditStyle(ColumnsCollection cols)
        {
            foreach (UltraGridColumn col in cols)
            {
                if (col.AllowUpdate == AllowUpdate.Yes)
                {
                    if (col.Key.Equals(&quot;MB Quantity&quot;) &amp;&amp; cols.Exists(&quot;IsSubmit&quot;))
                    {
                        foreach (UltraGridRow row in cols.Band.Grid.Rows)
                            if (!row.Cells.FromKey(&quot;IsSubmit&quot;).Value.ToBoolean2() &amp;&amp;
                                Convert.ToInt32(row.Cells.FromKey(&quot;PostingID&quot;).Value) == 0)
                                row.Cells.FromKey(&quot;MB Quantity&quot;).Style.BackColor = Color.Yellow;
                            else
                                row.Cells.FromKey(&quot;MB Quantity&quot;).AllowEditing = AllowEditing.No;
                    }
                    else if (!col.Key.Equals(&quot;To&quot;))
                        col.CellStyle.BackColor = Color.Yellow;
                }
                if (col.Key.Contains(&quot;Quantity&quot;))
                    col.Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
            }
        }

        private void SaveAttachments(int rfiID)
        {
            try
            {
                ((AttachmentsControl)attachments).ParentModuleID = Constants.MODID_CONTMGT;
                ((AttachmentsControl)attachments).ParentInstanceID = ContractID;
                bool bUploadAttch = ((AttachmentsControl)attachments).SaveAttachments(rfiID.ToString(), &quot;CONTRFI&quot;,
                                                                                       UserDetail.GetCurrentUserDetail()
                                                                                           .UID,
                                                                                       UserDetail.GetCurrentUserDetail()
                                                                                           .UserName,
                                                                                       &quot;RFI Attachments&quot;);

                if (bUploadAttch &amp;&amp; IsGoToListPage == 1)
                    IsGoToListPage = 1;
                //Response.Redirect(&quot;~/Common/BrixListPage.aspx?context=CONTRFI&amp;PID=&quot; + PID.ToString() + &quot;&amp;ContractID=&quot; + ContractID.ToString(), false);
                else
                {
                    if (!bUploadAttch)
                        ShowError(&quot;Error in uploading attachments.\\n &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot; updated successfully.&#39;); document.location.href=&#39;/Common/BrixListPage.aspx?context=CONTRFI&amp;PID=&quot; +
                                PID + &quot;&amp;ContractID=&quot; + UIHelper.UrlEncode(ContractID.ToString()));
                }
            }
            catch (Exception)
            {
                ShowError(&quot;Error in uploading attachments.\\n &quot; + LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot; updated successfully.&#39;); document.location.href=&#39;/Common/BrixListPage.aspx?context=CONTRFI&amp;PID=&quot; +
                         PID + &quot;&amp;ContractID=&quot; + UIHelper.UrlEncode(ContractID.ToString()));
            }
        }

        #endregion

        #region &quot;Properties&quot;

        private int ContractID { get; set; }
        private int ItemID { get; set; }
        private int SubItemID { get; set; }
        private int ActivityID { get; set; }
        private int PID { get; set; }
        private string ModuleID { get; set; }
        private string Mode { get; set; }

        #endregion

        #region Nested type: Container

        public class Container
        {
            public int ItemID { get; set; }
            public int SubItemID { get; set; }
            public int ActivityID { get; set; }
            public int RFIID { get; set; }
            public int ItemSource { get; set; }
            public int ItemType { get; set; }
        }

        #endregion

        #region Nested type: Div

        private enum Div
        {
            Main,
            ItemPicker,
            InspectionDetails,
            Attachments,
            MeasurementEntry
        }

        #endregion

        public void HandleInjectionAfterSave(object model, string parentFormInstanceId) { }
    }

    [CustomResourceType(&quot;Forms&quot;, &quot;XRFIFRM&quot;)]
    public class PerformRFIOperation : FormsCustomResource
    {
        public PerformRFIOperation()
        {
            _Namespace = &quot;Forms&quot;;
            _Path = &quot;Forms.Contract.RFI&quot;;
            _Name = &quot;PerformRFIOperation&quot;;
            _Desc = &quot;Perform RFI Operations&quot;;

            _InParameters = new[] { &quot;Operation,System.String&quot; };
            _OutParameters = new[] { &quot;IsSuccessful,System.Boolean&quot;, &quot;Message,System.String&quot; };
        }

        public override void ExecuteDerived()
        {
            string operation = GetInputParam(&quot;Operation&quot;).ToString();
            string culture = GetInputParam(&quot;Culture&quot;).ToString();
            string uiCulture = GetInputParam(&quot;UICulture&quot;).ToString();
            Thread.CurrentThread.CurrentCulture = new CultureInfo(culture);
            Thread.CurrentThread.CurrentUICulture = new CultureInfo(uiCulture);
            string msg = string.Empty;

            switch (operation.ToUpper())
            {
                case &quot;REDRAFT&quot;:
                    msg = UpdateRFIStatus(RFIStatus.Draft);
                    break;
                case &quot;COMPLETE&quot;:
                    msg = UpdateRFIStatus(RFIStatus.Complete);
                    break;
                case &quot;VALIDATESUBMIT&quot;:
                    msg = ValidateUpdateRFIStatus(RFIStatus.Submitted);
                    break;
                case &quot;SUBMIT&quot;:
                    msg = UpdateRFIStatus(RFIStatus.Submitted);
                    break;
                case &quot;APPROVE&quot;:
                    msg = UpdateRFIStatus(RFIStatus.Approved);
                    break;
                case &quot;UNDOAPPROVE&quot;:
                    msg = UpdateRFIStatus(RFIStatus.UnApprove);
                    break;
                //case &quot;UNDOSUBMIT&quot;:
                //    msg = createRFI.UpdateRFIStatus(RFIStatus.Complete);
                //    break;
            }
            if (msg.Contains(&quot;Error -&quot;))
            {
                SetOutParam(&quot;IsSuccessful&quot;, false, &quot;System.Boolean&quot;);
                SetOutParam(&quot;Message&quot;, msg, &quot;System.String&quot;);
                throw new Exception(msg.Replace(&quot;Error -&quot;, &quot;Request denied.&quot;));
            }
            else
            {
                SetOutParam(&quot;IsSuccessful&quot;, true, &quot;System.Boolean&quot;);
                SetOutParam(&quot;Message&quot;, msg, &quot;System.String&quot;);
            }
        }

        public string ValidateUpdateRFIStatus(RFIStatus status)
        {
            int rfiID = InstanceId.ToInt32_2();
            int currentUserId = GetInputParam(&quot;_CurrentUserId&quot;).ToInt32_2();
            // get all the details from dDB using this rfi id and then use them in these methods.

            string msg = string.Empty;
            try
            {
                if (status == RFIStatus.UnApprove)
                {
                    msg = RequestForInformationBL.Instance.ValidateUpdateStatus(rfiID, RFIStatus.UnApprove.ToString2(),
                                                                        currentUserId);
                    if (!(msg == &quot;Unapproved Successfully&quot;))
                    {
                        msg = msg.Replace(&quot;LOC_PE&quot;, LocalizationManager.GetString(KeyConstants.LOC_PAY_ESTIMATE));
                        throw new Exception(msg);
                    }
                }
                return msg;
            }
            catch (Exception ex)
            {
                return &quot;Error - &quot; + ex.Message;
            }
        }

        public string UpdateRFIStatus(RFIStatus status)
        {
            int rfiID = InstanceId.ToInt32_2();
            int currentUserId = GetInputParam(&quot;_CurrentUserId&quot;).ToInt32_2();

            // get all the details from dDB using this rfi id and then use them in these methods.

            string msg = string.Empty;
            try
            {
                if (status == RFIStatus.Draft)
                    msg = RequestForInformationBL.Instance.UpdateStatus(rfiID, &quot;Draft&quot;, currentUserId);
                //msg = RequestForInformationBL.Instance.UpdateStatus(rfiID, &quot;Draft&quot;, UserDetail.GetCurrentUserDetail().UID, null, null, null, null, null, null, null);
                else if (status == RFIStatus.Complete)
                    msg = RequestForInformationBL.Instance.UpdateStatus(rfiID, &quot;Complete&quot;, currentUserId);
                //msg = RequestForInformationBL.Instance.UpdateStatus(rfiID, &quot;Completed&quot;, UserDetail.GetCurrentUserDetail().UID, null, null, null, null, null, null, null);
                else if (status == RFIStatus.Submitted)
                {
                    msg = RequestForInformationBL.Instance.UpdateStatus(rfiID, &quot;Submitted&quot;, currentUserId);

                    if (msg != &quot;Submitted successfully&quot;)
                        throw new Exception(msg);
                    //msg = RequestForInformationBL.Instance.UpdateStatus(rfiID, &quot;Submitted&quot;, UserDetail.GetCurrentUserDetail().UID, txtSubmittedByName.Text.Trim(), txtSubmittedDesignation.Text.Trim(), wdcSubmittedDate.Value.ToDateTime_MWCulture(), txtSubmittedOwner.Text.Trim(), null, null, null);
                    //RequestForInformationBL.Instance.AddDeductions(rfiID.ToInt32_2());
                    //RequestForInformationBL.Instance.GetPEIDs(rfiID.ToInt32_2());
                }
                else if (status == RFIStatus.Approved)
                {
                    msg = RequestForInformationBL.Instance.UpdateStatus(rfiID, &quot;Approved&quot;, currentUserId);

                    if (msg != &quot;Approved successfully&quot;)
                        throw new Exception(msg);
                    //msg = RequestForInformationBL.Instance.UpdateStatus(rfiID, &quot;Approved&quot;, UserDetail.GetCurrentUserDetail().UID, txtApprovedBy.Text.Trim(), txtApprovedDesignation.Text.Trim(), wdcApprovedDate.Value.ToDateTime_MWCulture(), txtApprovedOwner.Text.Trim(), txtReceivedBy.Text.Trim(), wdcReceivedDate.Value.ToDateTime_MWCulture(), wmeReceivedTime.Value.ToString2());
                    // Not required. Is handled by the pay estimate module.
                    //RequestForInformationBL.Instance.AddDeductions(rfiID.ToInt32_2());
                    //RequestForInformationBL.Instance.GetPEIDs(rfiID.ToInt32_2());
                    RequestForInformationBL.Instance.CreateWorkPosting(rfiID, &quot;Approved&quot;);
                }
                else if (status == RFIStatus.UnApprove)
                {
                    msg = RequestForInformationBL.Instance.UpdateStatus(rfiID, RFIStatus.UnApprove.ToString2(),
                                                                        currentUserId);
                    if (!(msg == &quot;Unapproved Successfully&quot;))
                    {
                        msg = msg.Replace(&quot;LOC_PE&quot;, LocalizationManager.GetString(KeyConstants.LOC_PAY_ESTIMATE));
                        throw new Exception(msg);
                    }

                    ProcurementWorkPosting.Instance.DeleteWorkPostingByReferenceID(rfiID.ToString(), &quot;CONTRFI&quot;);
                }
                return msg;
            }
            catch (Exception ex)
            {
                return &quot;Error - &quot; + ex.Message;
            }
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[64,9,64,10,0],[76,13,76,55,0],[78,13,78,63,0],[79,13,79,27,0],[80,17,80,90,0],[81,13,81,92,0],[82,13,82,97,0],[83,13,83,103,0],[85,13,85,96,0],[86,13,86,113,0],[87,13,87,47,0],[89,13,89,45,0],[91,13,91,52,0],[93,13,93,31,0],[95,13,95,26,0],[97,13,99,123,0],[100,13,100,40,0],[101,9,101,10,0],[104,9,104,10,0],[106,13,106,42,0],[107,13,107,109,0],[110,13,111,97,0],[113,13,114,70,0],[115,13,115,14,0],[118,17,119,73,0],[120,17,123,118,0],[124,17,128,104,0],[129,17,134,100,0],[135,13,135,14,0],[136,13,136,119,0],[137,9,137,10,0],[140,9,140,10,0],[141,13,142,113,0],[143,9,143,10,0],[146,9,146,10,0],[147,13,147,45,0],[148,13,148,43,0],[149,13,149,48,0],[150,13,150,42,0],[151,13,151,58,0],[153,13,153,43,0],[154,13,154,64,0],[155,13,155,58,0],[158,13,158,28,0],[159,9,159,10,0],[162,9,162,10,0],[163,13,163,65,0],[164,17,164,80,0],[165,13,165,80,0],[166,13,166,102,0],[167,13,167,98,0],[168,13,168,53,0],[169,17,169,69,0],[170,21,170,53,0],[171,13,171,85,0],[172,17,172,69,0],[173,21,173,53,0],[174,13,174,65,0],[175,17,176,78,0],[180,13,183,115,0],[184,9,184,10,0],[190,17,190,18,0],[190,19,190,81,0],[190,82,190,83,0],[191,17,191,18,0],[191,19,191,50,0],[191,51,191,52,0],[196,17,196,18,0],[196,19,196,120,0],[196,121,196,122,0],[197,17,197,18,0],[197,19,197,60,0],[197,61,197,62,0],[204,17,204,18,0],[204,19,204,95,0],[204,96,204,97,0],[212,17,212,18,0],[212,19,212,77,0],[212,78,212,79,0],[218,13,218,14,0],[219,17,221,36,0],[222,13,222,14,0],[229,17,229,18,0],[229,19,229,58,0],[229,59,229,60,0],[230,17,230,18,0],[230,19,230,58,0],[230,59,230,60,0],[235,17,235,18,0],[235,19,235,62,0],[235,63,235,64,0],[236,17,236,18,0],[236,19,236,58,0],[236,59,236,60,0],[241,17,241,18,0],[241,19,241,70,0],[241,71,241,72,0],[242,17,242,18,0],[242,19,242,66,0],[242,67,242,68,0],[247,17,247,18,0],[247,19,247,66,0],[247,67,247,68,0],[248,17,248,18,0],[248,19,248,56,0],[248,57,248,58,0],[253,17,253,18,0],[253,19,253,72,0],[253,73,253,74,0],[254,17,254,18,0],[254,19,254,62,0],[254,63,254,64,0],[263,9,263,10,0],[264,13,264,49,0],[269,17,269,18,0],[269,19,269,43,0],[269,44,269,45,0],[275,13,275,14,0],[276,17,278,98,0],[279,17,279,38,0],[280,13,280,14,0],[283,37,283,38,0],[283,39,283,90,0],[283,91,283,92,0],[287,17,287,18,0],[287,19,287,36,0],[287,37,287,38,0],[292,17,292,18,0],[292,19,292,31,0],[292,32,292,33,0],[297,17,297,18,0],[297,19,297,65,0],[297,66,297,67,0],[303,13,303,14,0],[304,17,306,96,0],[307,17,307,27,0],[308,13,308,14,0],[313,17,313,18,0],[313,19,313,138,0],[313,139,313,140,0],[317,9,317,10,0],[318,13,318,132,0],[319,9,319,10,0],[323,9,323,10,0],[324,13,324,38,0],[325,13,325,26,0],[326,13,326,30,0],[327,13,328,115,0],[329,13,329,14,0],[330,17,330,66,0],[331,17,331,30,0],[334,13,334,114,0],[335,13,335,14,0],[336,17,336,138,0],[337,17,337,30,0],[339,13,339,52,0],[340,13,340,32,0],[341,13,341,45,0],[343,13,343,50,0],[345,13,345,30,0],[346,13,346,14,0],[347,17,347,97,0],[349,17,349,47,0],[350,17,350,18,0],[351,21,351,71,0],[353,21,353,58,0],[355,21,355,89,0],[356,21,356,77,0],[357,21,357,84,0],[358,21,358,109,0],[359,21,359,48,0],[360,25,360,63,0],[361,21,361,92,0],[363,21,363,100,0],[364,21,364,109,0],[365,21,365,68,0],[366,25,366,108,0],[417,21,417,92,0],[425,21,425,75,0],[426,25,426,122,0],[428,21,428,74,0],[429,25,429,120,0],[430,26,430,113,0],[431,21,431,22,0],[432,25,434,90,0],[435,21,435,22,0],[437,21,437,87,0],[438,21,438,111,0],[439,21,439,22,0],[440,25,440,32,0],[440,34,440,45,0],[440,46,440,48,0],[440,49,440,92,0],[441,25,441,26,0],[442,29,442,61,0],[443,29,443,30,0],[444,33,444,62,0],[445,33,450,75,0],[451,29,451,30,0],[452,25,452,26,0],[453,21,453,22,0],[454,21,454,34,0],[455,17,455,18,0],[457,17,458,111,0],[460,17,460,58,0],[462,17,462,71,0],[463,17,463,54,0],[464,17,464,48,0],[465,17,465,52,0],[466,17,466,52,0],[467,17,467,63,0],[468,17,468,18,0],[469,21,469,82,0],[470,21,472,43,0],[473,17,473,18,0],[474,17,474,62,0],[475,17,477,39,0],[478,17,478,80,0],[479,17,479,58,0],[480,17,480,66,0],[482,17,482,64,0],[483,17,485,39,0],[486,17,486,56,0],[487,17,487,60,0],[492,17,492,59,0],[493,17,493,60,0],[494,17,494,67,0],[495,17,495,65,0],[496,17,496,65,0],[497,17,497,63,0],[498,17,498,65,0],[501,17,501,68,0],[502,17,502,83,0],[503,17,503,66,0],[504,17,506,39,0],[507,17,507,80,0],[515,17,515,60,0],[516,17,518,39,0],[519,17,519,76,0],[520,17,521,117,0],[522,17,522,18,0],[523,21,523,68,0],[524,21,524,34,0],[532,17,532,66,0],[533,17,533,82,0],[534,17,534,60,0],[535,17,535,46,0],[536,17,536,18,0],[537,21,539,43,0],[540,17,540,18,0],[541,17,541,78,0],[544,17,545,123,0],[548,17,548,50,0],[549,17,549,62,0],[552,17,552,56,0],[553,17,553,48,0],[554,21,554,78,0],[556,17,563,85,0],[564,17,564,33,0],[565,17,565,18,0],[566,21,566,104,0],[567,21,567,34,0],[569,17,569,62,0],[570,17,570,18,0],[571,21,571,86,0],[572,21,572,81,0],[573,17,573,18,0],[574,17,574,40,0],[575,13,575,14,0],[576,13,576,52,0],[577,13,577,41,0],[578,13,578,40,0],[579,13,579,25,0],[585,9,585,10,0],[593,17,593,18,0],[593,19,593,60,0],[593,61,593,62,0],[598,17,598,18,0],[598,19,598,40,0],[598,41,598,42,0],[600,13,600,14,0],[602,13,602,14,0],[606,9,606,10,0],[606,11,606,12,0],[608,51,608,55,0],[608,56,608,60,0],[613,9,613,10,0],[614,13,614,46,0],[615,13,615,80,0],[616,9,616,10,0],[619,9,619,10,0],[620,13,620,82,0],[621,13,621,93,0],[622,9,622,10,0],[624,9,624,10,0],[625,13,625,88,0],[627,13,627,116,0],[628,13,628,14,0],[629,17,630,111,0],[632,13,632,14,0],[633,9,633,10,0],[635,9,635,10,0],[636,13,636,76,0],[638,13,638,87,0],[639,13,639,80,0],[640,13,640,83,0],[641,13,641,84,0],[642,13,642,52,0],[644,13,644,45,0],[645,13,645,41,0],[647,13,647,62,0],[648,17,648,93,0],[650,13,650,142,0],[653,13,653,28,0],[654,13,654,31,0],[655,13,655,38,0],[656,17,656,63,0],[657,9,657,10,0],[660,9,660,10,0],[661,13,661,59,0],[663,13,663,40,0],[664,9,664,10,0],[667,9,667,10,0],[668,13,668,49,0],[669,13,669,63,0],[670,13,670,51,0],[672,13,672,34,0],[677,13,677,31,0],[679,13,679,60,0],[680,13,680,58,0],[681,13,681,97,0],[682,13,682,94,0],[683,13,683,92,0],[687,13,687,30,0],[688,13,688,14,0],[689,17,689,69,0],[690,13,690,14,0],[692,13,692,34,0],[693,13,693,14,0],[694,17,694,102,0],[695,17,695,106,0],[696,17,696,100,0],[697,17,697,65,0],[700,17,701,110,0],[702,17,703,114,0],[704,17,705,106,0],[709,17,711,79,0],[712,17,712,36,0],[713,17,713,61,0],[714,17,714,114,0],[718,17,718,105,0],[719,17,719,91,0],[720,17,720,63,0],[721,17,721,18,0],[722,21,722,96,0],[723,21,723,43,0],[724,21,724,46,0],[725,21,725,84,0],[727,21,727,52,0],[728,21,728,45,0],[730,21,730,53,0],[731,17,731,18,0],[733,17,733,18,0],[734,21,734,218,0],[736,21,736,39,0],[738,21,738,44,0],[744,17,744,18,0],[745,13,745,14,0],[746,13,746,108,0],[749,13,749,105,0],[750,13,750,52,0],[751,17,751,82,0],[753,13,753,31,0],[754,13,754,38,0],[755,17,755,67,0],[756,9,756,10,0],[758,9,758,10,0],[759,13,759,82,0],[760,13,760,67,0],[761,13,761,65,0],[762,9,762,10,0],[764,9,764,10,0],[765,13,765,57,0],[766,13,766,93,0],[767,13,767,14,0],[768,17,768,41,0],[769,13,769,14,0],[770,13,770,47,0],[771,13,771,14,0],[772,17,772,49,0],[773,13,773,14,0],[774,13,774,69,0],[775,13,775,14,0],[776,17,776,28,0],[777,13,777,14,0],[778,13,778,37,0],[779,13,779,14,0],[780,17,780,28,0],[782,17,782,69,0],[783,21,783,77,0],[785,17,785,44,0],[786,17,786,49,0],[787,17,788,97,0],[789,13,789,14,0],[790,13,790,93,0],[791,13,791,14,0],[792,17,792,59,0],[793,13,793,14,0],[794,9,794,10,0],[797,9,797,10,0],[798,13,798,37,0],[799,17,799,39,0],[800,13,800,47,0],[801,17,801,99,0],[803,18,803,52,0],[805,17,805,49,0],[808,17,810,213,0],[811,13,811,33,0],[813,13,813,31,0],[814,13,814,38,0],[815,17,815,68,0],[816,9,816,10,0],[819,9,819,10,0],[820,13,820,45,0],[826,13,826,31,0],[834,21,834,102,0],[835,21,835,95,0],[836,21,836,27,0],[849,21,849,102,0],[850,21,850,101,0],[851,21,851,91,0],[853,21,853,100,0],[854,21,854,94,0],[855,21,855,27,0],[859,21,859,74,0],[860,21,860,94,0],[861,21,861,101,0],[862,21,862,100,0],[863,21,863,90,0],[864,21,864,91,0],[868,21,868,52,0],[870,21,870,97,0],[871,21,871,27,0],[875,21,875,74,0],[876,21,876,97,0],[877,21,877,27,0],[884,13,884,48,0],[885,13,885,51,0],[887,13,887,50,0],[888,13,888,14,0],[889,17,889,48,0],[890,17,890,51,0],[891,13,891,14,0],[893,13,893,113,0],[894,9,894,10,0],[897,9,897,10,0],[899,13,899,73,0],[900,13,900,14,0],[901,17,901,83,0],[902,17,902,89,0],[903,13,903,14,0],[906,13,907,77,0],[908,13,908,14,0],[909,17,909,83,0],[910,17,910,82,0],[911,13,911,14,0],[912,9,912,10,0],[916,9,916,10,0],[917,13,917,52,0],[918,9,918,10,0],[921,9,921,10,0],[922,13,922,40,0],[923,13,923,42,0],[924,13,924,14,0],[925,17,925,36,0],[926,17,926,44,0],[927,17,927,42,0],[928,17,928,36,0],[929,13,929,14,0],[931,13,931,45,0],[932,13,932,14,0],[933,17,933,49,0],[934,17,934,59,0],[935,17,935,46,0],[936,17,936,48,0],[938,17,938,167,0],[940,17,940,91,0],[941,17,941,88,0],[942,17,942,73,0],[943,17,943,85,0],[944,17,944,84,0],[945,17,945,150,0],[946,17,946,85,0],[948,17,948,52,0],[949,17,949,18,0],[950,21,950,115,0],[951,21,951,114,0],[952,21,952,122,0],[953,21,953,120,0],[954,17,954,18,0],[956,17,956,18,0],[957,21,957,66,0],[958,21,958,77,0],[959,21,959,65,0],[960,21,960,64,0],[961,17,961,18,0],[963,17,963,61,0],[964,17,964,58,0],[965,13,965,14,0],[967,13,967,65,0],[968,13,968,14,0],[969,17,969,51,0],[970,21,970,53,0],[971,13,971,14,0],[978,9,978,10,0],[981,9,981,10,0],[982,13,982,39,0],[983,13,983,105,0],[984,13,984,29,0],[985,13,985,20,0],[985,22,985,38,0],[985,39,985,41,0],[985,42,985,61,0],[986,17,986,70,0],[987,21,988,39,0],[989,13,989,61,0],[990,9,990,10,0],[993,9,993,10,0],[994,13,994,40,0],[995,13,995,108,0],[996,13,996,29,0],[997,13,999,115,0],[1000,13,1000,40,0],[1001,13,1004,73,0],[1005,13,1005,65,0],[1006,13,1006,27,0],[1007,13,1007,20,0],[1007,22,1007,38,0],[1007,39,1007,41,0],[1007,42,1007,59,0],[1008,13,1008,14,0],[1009,17,1009,87,0],[1010,13,1010,14,0],[1011,13,1011,20,0],[1011,22,1011,38,0],[1011,39,1011,41,0],[1011,42,1011,59,0],[1012,13,1012,14,0],[1013,17,1013,70,0],[1014,21,1014,77,0],[1016,17,1016,18,0],[1017,21,1017,106,0],[1018,21,1018,91,0],[1019,17,1019,18,0],[1020,13,1020,14,0],[1021,13,1021,61,0],[1022,13,1023,113,0],[1024,13,1025,117,0],[1026,13,1026,62,0],[1027,17,1027,69,0],[1028,9,1028,10,0],[1031,9,1031,10,0],[1032,13,1032,52,0],[1033,13,1033,14,0],[1035,17,1035,87,0],[1036,17,1036,34,0],[1037,17,1037,59,0],[1038,17,1040,210,0],[1041,13,1041,14,0],[1042,18,1042,57,0],[1043,13,1043,14,0],[1045,17,1045,64,0],[1046,17,1046,34,0],[1047,17,1047,59,0],[1048,13,1048,14,0],[1049,18,1049,57,0],[1050,13,1050,14,0],[1051,17,1051,88,0],[1052,17,1052,70,0],[1053,17,1053,80,0],[1054,17,1054,92,0],[1055,17,1057,63,0],[1058,17,1058,18,0],[1059,21,1061,71,0],[1062,21,1062,28,0],[1064,17,1065,74,0],[1066,17,1066,34,0],[1067,17,1067,59,0],[1068,17,1070,210,0],[1071,13,1071,14,0],[1073,13,1073,14,0],[1074,17,1074,72,0],[1075,21,1075,55,0],[1077,21,1077,54,0],[1078,13,1078,14,0],[1295,9,1295,10,0],[1298,9,1298,10,0],[1299,13,1299,52,0],[1300,13,1300,14,0],[1301,17,1301,34,0],[1302,17,1302,59,0],[1303,17,1305,210,0],[1306,13,1306,14,0],[1307,18,1307,57,0],[1308,13,1308,14,0],[1310,17,1310,66,0],[1311,17,1311,34,0],[1312,17,1312,59,0],[1313,13,1313,14,0],[1314,18,1314,57,0],[1315,13,1315,14,0],[1316,17,1316,34,0],[1317,17,1317,59,0],[1318,17,1320,210,0],[1321,13,1321,14,0],[1323,13,1323,14,0],[1326,17,1328,120,0],[1329,17,1329,18,0],[1330,21,1330,70,0],[1331,21,1331,22,0],[1332,25,1332,110,0],[1333,21,1333,22,0],[1334,17,1334,18,0],[1337,17,1339,53,0],[1340,13,1340,14,0],[1341,9,1341,10,0],[1344,9,1344,10,0],[1345,13,1345,30,0],[1347,13,1347,42,0],[1348,13,1348,36,0],[1349,13,1349,43,0],[1351,13,1352,111,0],[1353,13,1353,14,0],[1354,17,1354,115,0],[1355,17,1355,37,0],[1356,17,1356,18,0],[1357,21,1357,52,0],[1358,21,1358,28,0],[1358,30,1358,46,0],[1358,47,1358,49,0],[1358,50,1358,67,0],[1359,21,1359,22,0],[1360,25,1360,90,0],[1361,21,1361,22,0],[1362,21,1362,119,0],[1363,17,1363,18,0],[1365,21,1365,83,0],[1366,17,1366,41,0],[1367,17,1367,18,0],[1368,21,1368,28,0],[1368,30,1368,40,0],[1368,41,1368,43,0],[1368,44,1368,61,0],[1369,25,1369,83,0],[1371,21,1371,50,0],[1372,21,1372,41,0],[1373,21,1373,53,0],[1374,25,1374,64,0],[1378,21,1378,94,0],[1379,21,1379,70,0],[1380,25,1382,77,0],[1383,17,1383,18,0],[1384,13,1384,14,0],[1385,13,1387,206,0],[1389,18,1389,27,0],[1389,29,1389,56,0],[1389,58,1389,61,0],[1390,13,1390,14,0],[1391,17,1394,25,0],[1394,25,1395,101,0],[1395,101,1395,103,0],[1391,17,1395,103,0],[1396,17,1396,42,0],[1397,21,1397,68,0],[1398,13,1398,14,0],[1400,13,1400,27,0],[1401,13,1401,14,0],[1402,17,1402,83,0],[1403,13,1403,14,0],[1404,9,1404,10,0],[1407,9,1407,10,0],[1408,18,1408,27,0],[1408,29,1408,56,0],[1408,58,1408,61,0],[1409,13,1409,14,0],[1410,17,1410,57,0],[1411,17,1412,65,0],[1413,17,1413,18,0],[1415,21,1415,116,0],[1416,21,1416,50,0],[1417,21,1417,22,0],[1418,25,1419,104,0],[1420,25,1420,65,0],[1421,25,1421,26,0],[1422,34,1422,43,0],[1422,45,1422,80,0],[1422,82,1422,85,0],[1423,29,1423,30,0],[1424,33,1424,100,0],[1425,33,1425,34,0],[1426,37,1426,74,0],[1427,37,1427,72,0],[1428,33,1428,34,0],[1429,29,1429,30,0],[1430,25,1430,26,0],[1431,25,1431,51,0],[1432,25,1432,54,0],[1433,21,1433,22,0],[1434,21,1434,51,0],[1435,21,1435,25,0],[1436,17,1436,18,0],[1437,13,1437,14,0],[1438,9,1438,10,0],[1441,9,1441,10,0],[1442,13,1442,42,0],[1443,17,1443,24,0],[1444,13,1444,43,0],[1445,13,1445,20,0],[1445,22,1445,38,0],[1445,39,1445,41,0],[1445,42,1445,59,0],[1446,13,1446,14,0],[1447,17,1447,77,0],[1448,17,1448,18,0],[1449,21,1449,37,0],[1450,21,1450,27,0],[1452,13,1452,14,0],[1453,13,1453,35,0],[1454,13,1454,14,0],[1455,17,1455,122,0],[1456,13,1456,14,0],[1457,13,1457,35,0],[1458,13,1458,14,0],[1459,17,1459,57,0],[1461,17,1461,77,0],[1463,17,1463,109,0],[1464,17,1464,78,0],[1465,17,1465,61,0],[1466,17,1466,49,0],[1467,17,1467,58,0],[1468,17,1468,43,0],[1472,17,1472,77,0],[1473,17,1473,18,0],[1474,21,1474,87,0],[1476,21,1476,28,0],[1476,30,1476,46,0],[1476,47,1476,49,0],[1476,50,1476,69,0],[1477,21,1477,22,0],[1478,25,1478,32,0],[1478,34,1478,49,0],[1478,50,1478,52,0],[1478,53,1478,63,0],[1479,25,1479,26,0],[1480,29,1480,62,0],[1481,29,1481,83,0],[1482,29,1482,30,0],[1483,33,1483,70,0],[1484,33,1484,77,0],[1485,29,1485,30,0],[1486,25,1486,26,0],[1487,21,1487,22,0],[1488,17,1488,18,0],[1491,17,1491,56,0],[1492,17,1492,57,0],[1494,17,1494,65,0],[1496,17,1496,94,0],[1498,17,1498,24,0],[1498,26,1498,45,0],[1498,46,1498,48,0],[1498,49,1498,53,0],[1499,21,1499,68,0],[1500,17,1500,43,0],[1501,13,1501,14,0],[1502,9,1502,10,0],[1505,9,1505,10,0],[1506,13,1506,42,0],[1507,17,1507,24,0],[1508,13,1508,43,0],[1509,13,1509,20,0],[1509,22,1509,38,0],[1509,39,1509,41,0],[1509,42,1509,59,0],[1510,13,1510,14,0],[1511,17,1511,77,0],[1512,17,1512,18,0],[1513,21,1513,37,0],[1514,21,1514,27,0],[1516,13,1516,14,0],[1517,13,1517,35,0],[1518,13,1518,14,0],[1519,17,1519,122,0],[1520,13,1520,14,0],[1521,13,1521,35,0],[1522,13,1522,14,0],[1523,17,1523,57,0],[1525,17,1525,85,0],[1526,17,1526,77,0],[1528,17,1533,117,0],[1534,17,1534,76,0],[1535,17,1535,59,0],[1536,17,1536,47,0],[1537,17,1537,54,0],[1538,17,1538,41,0],[1539,17,1539,73,0],[1540,17,1540,31,0],[1541,17,1541,80,0],[1542,17,1542,18,0],[1543,21,1543,88,0],[1544,21,1544,101,0],[1546,21,1546,28,0],[1546,30,1546,46,0],[1546,47,1546,49,0],[1546,50,1546,67,0],[1547,21,1547,22,0],[1548,25,1548,32,0],[1548,34,1548,48,0],[1548,49,1548,51,0],[1548,52,1548,60,0],[1549,25,1549,26,0],[1550,29,1550,92,0],[1551,29,1551,30,0],[1552,33,1552,70,0],[1553,33,1553,108,0],[1554,33,1554,58,0],[1555,33,1555,39,0],[1557,25,1557,26,0],[1558,21,1558,22,0],[1559,17,1559,18,0],[1560,17,1560,52,0],[1561,17,1561,54,0],[1562,17,1562,55,0],[1564,17,1564,63,0],[1566,17,1566,104,0],[1568,17,1568,24,0],[1568,26,1568,45,0],[1568,46,1568,48,0],[1568,49,1568,53,0],[1569,21,1569,68,0],[1570,17,1570,73,0],[1571,17,1571,44,0],[1573,13,1573,14,0],[1574,9,1574,10,0],[1577,9,1577,10,0],[1578,13,1579,78,0],[1580,13,1580,37,0],[1581,9,1581,10,0],[1584,9,1584,10,0],[1585,13,1585,59,0],[1587,13,1587,34,0],[1588,13,1588,33,0],[1589,13,1589,20,0],[1589,22,1589,33,0],[1589,34,1589,36,0],[1589,37,1589,44,0],[1590,13,1590,14,0],[1592,17,1592,75,0],[1597,17,1597,36,0],[1598,17,1598,18,0],[1599,21,1599,50,0],[1601,21,1601,37,0],[1602,21,1602,53,0],[1603,21,1603,57,0],[1604,21,1604,65,0],[1605,21,1605,63,0],[1606,21,1606,49,0],[1613,21,1613,83,0],[1615,21,1615,87,0],[1616,21,1616,72,0],[1617,21,1617,67,0],[1618,21,1618,77,0],[1619,21,1619,69,0],[1621,21,1621,49,0],[1622,17,1622,18,0],[1623,22,1623,42,0],[1624,17,1624,18,0],[1625,21,1625,86,0],[1626,21,1626,28,0],[1626,30,1626,46,0],[1626,47,1626,49,0],[1626,50,1626,60,0],[1627,21,1627,22,0],[1628,25,1630,55,0],[1631,25,1631,44,0],[1632,25,1632,26,0],[1633,29,1633,87,0],[1634,29,1634,47,0],[1635,29,1635,111,0],[1638,29,1639,98,0],[1640,29,1640,45,0],[1641,29,1641,51,0],[1642,25,1642,26,0],[1643,21,1643,22,0],[1644,17,1644,18,0],[1645,13,1645,14,0],[1647,13,1647,32,0],[1648,9,1648,10,0],[1651,9,1651,10,0],[1652,13,1652,36,0],[1653,13,1653,62,0],[1654,13,1654,31,0],[1655,13,1655,14,0],[1656,17,1656,24,0],[1656,26,1656,37,0],[1656,38,1656,40,0],[1656,41,1656,43,0],[1657,17,1657,18,0],[1658,21,1658,41,0],[1659,21,1659,38,0],[1660,17,1660,18,0],[1661,13,1661,14,0],[1662,13,1662,32,0],[1663,13,1663,30,0],[1664,9,1664,10,0],[1667,9,1667,10,0],[1668,13,1668,30,0],[1670,13,1670,55,0],[1672,13,1674,206,0],[1675,9,1675,10,0],[1678,9,1678,10,0],[1679,13,1679,36,0],[1681,13,1681,55,0],[1683,13,1683,95,0],[1686,9,1686,10,0],[1689,9,1689,10,0],[1690,13,1690,43,0],[1691,13,1691,55,0],[1692,13,1692,46,0],[1693,9,1693,10,0],[1696,9,1696,10,0],[1697,13,1697,38,0],[1699,13,1699,31,0],[1701,13,1701,93,0],[1703,13,1703,31,0],[1705,13,1705,43,0],[1706,13,1706,14,0],[1707,17,1707,51,0],[1709,17,1709,34,0],[1710,17,1710,53,0],[1711,17,1711,61,0],[1712,17,1712,65,0],[1713,17,1713,73,0],[1714,17,1714,71,0],[1715,17,1715,65,0],[1716,17,1716,75,0],[1717,17,1717,63,0],[1718,17,1718,70,0],[1719,21,1719,87,0],[1722,17,1722,57,0],[1723,17,1723,97,0],[1725,17,1725,105,0],[1726,17,1726,64,0],[1727,17,1727,18,0],[1728,21,1728,95,0],[1729,21,1729,66,0],[1730,17,1730,18,0],[1731,17,1731,71,0],[1732,21,1732,109,0],[1733,17,1733,56,0],[1734,21,1734,109,0],[1735,17,1735,81,0],[1736,17,1736,73,0],[1737,17,1737,69,0],[1738,17,1738,33,0],[1739,13,1739,14,0],[1741,13,1741,23,0],[1742,9,1742,10,0],[1745,9,1745,10,0],[1746,13,1763,52,0],[1764,13,1770,80,0],[1771,13,1771,60,0],[1772,13,1772,14,0],[1773,17,1773,90,0],[1774,17,1774,101,0],[1775,13,1775,14,0],[1776,13,1776,67,0],[1777,13,1777,14,0],[1778,17,1778,97,0],[1779,17,1779,108,0],[1780,13,1780,14,0],[1781,13,1781,56,0],[1782,13,1782,14,0],[1783,17,1783,86,0],[1784,17,1784,97,0],[1785,13,1785,14,0],[1788,9,1788,10,0],[1791,9,1791,10,0],[1793,13,1793,113,0],[1795,13,1795,49,0],[1797,13,1797,47,0],[1799,13,1799,72,0],[1800,13,1800,70,0],[1801,13,1801,57,0],[1802,13,1802,56,0],[1803,13,1803,50,0],[1804,13,1804,54,0],[1805,13,1805,64,0],[1806,13,1806,60,0],[1807,13,1807,66,0],[1808,13,1808,68,0],[1810,13,1810,66,0],[1811,13,1811,82,0],[1812,13,1812,80,0],[1813,13,1813,71,0],[1814,13,1814,86,0],[1815,13,1815,94,0],[1816,13,1816,69,0],[1817,13,1817,70,0],[1818,13,1818,73,0],[1819,13,1819,77,0],[1820,13,1820,75,0],[1821,13,1821,75,0],[1822,13,1822,67,0],[1823,13,1823,74,0],[1824,13,1824,30,0],[1825,17,1825,86,0],[1826,13,1826,61,0],[1827,13,1827,58,0],[1828,17,1828,69,0],[1829,13,1829,59,0],[1830,17,1832,116,0],[1833,13,1833,57,0],[1834,17,1834,67,0],[1835,13,1835,58,0],[1836,17,1838,114,0],[1839,13,1839,47,0],[1840,13,1840,14,0],[1841,17,1841,60,0],[1842,17,1842,90,0],[1843,13,1843,14,0],[1846,13,1846,46,0],[1847,13,1847,14,0],[1848,17,1848,78,0],[1849,17,1849,112,0],[1850,17,1850,66,0],[1851,17,1851,64,0],[1852,17,1852,18,0],[1853,21,1853,78,0],[1854,17,1854,18,0],[1856,17,1856,18,0],[1857,21,1857,79,0],[1858,17,1858,18,0],[1859,17,1859,61,0],[1860,21,1860,76,0],[1861,17,1861,63,0],[1862,21,1863,107,0],[1864,17,1864,70,0],[1865,21,1865,90,0],[1866,13,1866,14,0],[1869,13,1869,47,0],[1870,13,1870,14,0],[1871,17,1871,61,0],[1872,17,1872,63,0],[1873,17,1873,61,0],[1875,17,1875,60,0],[1876,21,1876,70,0],[1877,17,1877,62,0],[1878,21,1879,106,0],[1880,17,1880,62,0],[1881,21,1881,75,0],[1882,13,1882,14,0],[1885,13,1885,47,0],[1886,13,1886,14,0],[1887,17,1887,61,0],[1888,17,1888,63,0],[1889,17,1889,61,0],[1890,17,1890,63,0],[1891,17,1891,18,0],[1892,21,1892,76,0],[1893,17,1893,18,0],[1895,17,1895,18,0],[1896,21,1896,68,0],[1897,17,1897,18,0],[1898,17,1898,60,0],[1899,21,1899,70,0],[1900,17,1900,62,0],[1901,21,1902,106,0],[1903,17,1903,69,0],[1904,21,1904,88,0],[1905,13,1905,14,0],[1907,13,1907,42,0],[1909,13,1909,51,0],[1910,13,1910,57,0],[1912,13,1912,59,0],[1913,13,1913,120,0],[1914,9,1914,10,0],[1917,9,1917,10,0],[1918,13,1918,20,0],[1918,22,1918,38,0],[1918,39,1918,41,0],[1918,42,1918,73,0],[1919,13,1919,14,0],[1920,17,1920,87,0],[1921,17,1921,35,0],[1922,17,1922,18,0],[1923,21,1923,64,0],[1924,21,1924,28,0],[1924,30,1924,39,0],[1924,40,1924,42,0],[1924,43,1924,97,0],[1925,25,1925,104,0],[1926,21,1926,111,0],[1927,17,1927,18,0],[1928,13,1928,14,0],[1929,9,1929,10,0],[1932,9,1932,10,0],[1933,13,1933,48,0],[1935,13,1935,62,0],[1937,18,1937,27,0],[1937,29,1937,47,0],[1937,49,1937,52,0],[1938,13,1938,14,0],[1939,17,1939,45,0],[1939,45,1939,80,0],[1939,80,1939,82,0],[1939,17,1939,82,0],[1940,17,1940,18,0],[1941,21,1941,45,0],[1943,21,1943,56,0],[1944,21,1944,37,0],[1945,21,1945,38,0],[1946,21,1946,120,0],[1947,21,1947,47,0],[1948,21,1948,43,0],[1949,21,1949,39,0],[1951,17,1951,18,0],[1952,13,1952,14,0],[1954,13,1954,66,0],[1956,18,1956,27,0],[1956,29,1956,48,0],[1956,50,1956,53,0],[1957,13,1957,14,0],[1959,17,1959,57,0],[1961,17,1961,55,0],[1962,17,1962,58,0],[1963,17,1963,45,0],[1963,45,1963,117,0],[1963,117,1963,119,0],[1963,17,1963,119,0],[1964,17,1964,18,0],[1965,21,1965,45,0],[1967,21,1967,39,0],[1968,21,1968,45,0],[1969,21,1969,38,0],[1970,21,1970,47,0],[1971,21,1971,43,0],[1973,21,1973,39,0],[1974,17,1974,18,0],[1975,13,1975,14,0],[1977,13,1977,69,0],[1979,18,1979,27,0],[1979,29,1979,48,0],[1979,50,1979,53,0],[1980,13,1980,14,0],[1982,17,1982,58,0],[1984,17,1984,56,0],[1985,17,1985,59,0],[1986,17,1986,60,0],[1988,17,1988,45,0],[1988,45,1991,73,0],[1991,73,1991,75,0],[1988,17,1991,75,0],[1992,17,1992,18,0],[1993,21,1993,45,0],[1995,21,1995,39,0],[1996,21,1996,45,0],[1997,21,1997,47,0],[1998,21,1998,47,0],[1999,21,1999,43,0],[2001,21,2001,39,0],[2002,17,2002,18,0],[2003,13,2003,14,0],[2005,13,2006,110,0],[2008,13,2010,52,0],[2012,13,2012,28,0],[2013,9,2013,10,0],[2016,9,2016,10,0],[2017,13,2017,49,0],[2018,13,2018,14,0],[2019,17,2019,66,0],[2020,21,2020,69,0],[2022,21,2026,86,0],[2027,13,2027,14,0],[2028,13,2028,61,0],[2029,9,2029,10,0],[2032,9,2032,10,0],[2033,13,2033,29,0],[2034,13,2034,93,0],[2035,13,2035,37,0],[2036,9,2036,10,0],[2042,9,2042,10,0],[2043,13,2043,70,0],[2045,13,2065,50,0],[2066,13,2066,33,0],[2067,9,2067,10,0],[2071,9,2071,10,0],[2072,13,2072,58,0],[2073,13,2073,39,0],[2074,13,2074,68,0],[2075,13,2075,71,0],[2076,13,2076,73,0],[2077,13,2077,85,0],[2078,13,2078,81,0],[2079,13,2079,47,0],[2080,13,2080,57,0],[2081,13,2081,46,0],[2082,13,2082,52,0],[2083,13,2083,67,0],[2084,13,2084,47,0],[2085,13,2085,42,0],[2086,13,2086,100,0],[2087,13,2087,53,0],[2088,13,2088,46,0],[2089,13,2089,45,0],[2090,13,2090,46,0],[2091,13,2091,49,0],[2092,9,2092,10,0],[2099,9,2099,10,0],[2100,13,2100,61,0],[2101,13,2101,95,0],[2102,13,2102,104,0],[2103,13,2103,118,0],[2104,13,2104,106,0],[2105,13,2105,116,0],[2106,9,2106,10,0],[2109,9,2109,10,0],[2110,13,2110,30,0],[2111,9,2111,10,0],[2114,9,2114,10,0],[2115,13,2115,52,0],[2116,9,2116,10,0],[2119,9,2119,10,0],[2120,13,2120,51,0],[2121,9,2121,10,0],[2124,9,2124,10,0],[2125,13,2125,84,0],[2126,13,2126,23,0],[2127,13,2127,62,0],[2128,17,2128,64,0],[2129,13,2130,89,0],[2131,13,2131,33,0],[2132,13,2132,14,0],[2133,17,2133,54,0],[2134,17,2134,50,0],[2135,17,2135,56,0],[2136,17,2136,58,0],[2137,17,2137,36,0],[2139,17,2139,63,0],[2140,17,2140,54,0],[2141,17,2141,67,0],[2142,17,2142,57,0],[2143,17,2143,69,0],[2144,17,2144,61,0],[2145,17,2145,47,0],[2146,17,2146,57,0],[2147,17,2147,61,0],[2149,17,2149,86,0],[2150,17,2150,41,0],[2151,17,2151,81,0],[2153,17,2153,58,0],[2154,17,2154,54,0],[2155,17,2155,66,0],[2156,17,2156,30,0],[2157,13,2157,14,0],[2158,18,2158,38,0],[2159,13,2159,14,0],[2160,17,2160,54,0],[2161,17,2161,50,0],[2162,17,2162,56,0],[2164,17,2164,63,0],[2165,17,2165,54,0],[2166,17,2166,67,0],[2168,17,2168,57,0],[2169,17,2169,69,0],[2170,17,2170,61,0],[2172,17,2172,54,0],[2173,17,2173,57,0],[2174,17,2174,61,0],[2176,17,2176,54,0],[2178,17,2178,58,0],[2180,17,2180,86,0],[2181,17,2181,41,0],[2182,17,2182,88,0],[2184,17,2184,58,0],[2185,17,2185,54,0],[2186,17,2186,66,0],[2187,17,2187,30,0],[2188,13,2188,14,0],[2189,9,2189,10,0],[2217,9,2217,10,0],[2218,13,2219,78,0],[2220,13,2220,37,0],[2222,9,2222,10,0],[2225,9,2225,10,0],[2226,13,2252,19,0],[2253,9,2253,10,0],[2256,9,2256,10,0],[2262,13,2262,42,0],[2263,13,2263,37,0],[2264,13,2264,51,0],[2267,13,2268,95,0],[2269,13,2269,20,0],[2269,22,2269,41,0],[2269,42,2269,44,0],[2269,45,2269,65,0],[2270,17,2270,56,0],[2271,13,2271,56,0],[2272,13,2272,14,0],[2273,17,2273,79,0],[2274,13,2274,14,0],[2275,13,2275,53,0],[2276,13,2276,14,0],[2277,17,2277,76,0],[2278,13,2278,14,0],[2279,13,2279,57,0],[2280,13,2280,14,0],[2281,17,2281,88,0],[2282,17,2282,73,0],[2283,17,2283,72,0],[2284,13,2284,14,0],[2285,13,2285,65,0],[2286,13,2286,14,0],[2287,17,2287,93,0],[2288,17,2288,18,0],[2289,21,2289,95,0],[2290,21,2290,122,0],[2291,17,2291,18,0],[2293,17,2293,95,0],[2294,13,2294,14,0],[2301,13,2301,56,0],[2302,13,2302,14,0],[2303,17,2303,87,0],[2304,17,2304,72,0],[2305,13,2305,14,0],[2306,13,2306,60,0],[2307,13,2307,14,0],[2308,17,2308,99,0],[2309,17,2309,111,0],[2310,13,2310,14,0],[2311,13,2311,67,0],[2312,13,2312,14,0],[2313,17,2313,82,0],[2314,17,2314,118,0],[2315,13,2315,14,0],[2316,13,2316,63,0],[2317,13,2317,14,0],[2318,17,2318,102,0],[2319,17,2319,114,0],[2320,13,2320,14,0],[2326,13,2326,67,0],[2327,13,2327,14,0],[2328,17,2328,98,0],[2329,17,2329,121,0],[2330,17,2330,118,0],[2331,13,2331,14,0],[2346,13,2346,66,0],[2347,13,2347,14,0],[2348,17,2348,117,0],[2349,13,2349,14,0],[2351,13,2351,86,0],[2361,9,2361,10,0],[2364,9,2364,10,0],[2365,13,2365,20,0],[2365,22,2365,41,0],[2365,42,2365,44,0],[2365,45,2365,49,0],[2366,13,2366,14,0],[2367,17,2367,56,0],[2368,17,2368,18,0],[2369,21,2369,82,0],[2370,21,2370,22,0],[2371,25,2371,32,0],[2371,34,2371,50,0],[2371,51,2371,53,0],[2371,54,2371,73,0],[2372,29,2373,92,0],[2374,33,2374,97,0],[2376,33,2376,97,0],[2377,21,2377,22,0],[2378,26,2378,52,0],[2379,25,2379,64,0],[2380,17,2380,18,0],[2381,17,2381,50,0],[2382,21,2382,83,0],[2383,13,2383,14,0],[2384,9,2384,10,0],[2387,9,2387,10,0],[2389,13,2389,14,0],[2390,17,2390,92,0],[2391,17,2391,81,0],[2392,17,2397,107,0],[2399,17,2399,57,0],[2400,21,2400,40,0],[2403,17,2403,18,0],[2404,21,2404,39,0],[2405,25,2406,99,0],[2407,17,2407,18,0],[2408,13,2408,14,0],[2409,13,2409,30,0],[2410,13,2410,14,0],[2411,17,2412,92,0],[2413,13,2413,14,0],[2414,9,2414,10,0],[2420,34,2420,38,0],[2420,39,2420,43,0],[2421,30,2421,34,0],[2421,35,2421,39,0],[2422,33,2422,37,0],[2422,38,2422,42,0],[2423,34,2423,38,0],[2423,39,2423,43,0],[2424,27,2424,31,0],[2424,32,2424,36,0],[2425,35,2425,39,0],[2425,40,2425,44,0],[2426,31,2426,35,0],[2426,36,2426,40,0],[2434,33,2434,37,0],[2434,38,2434,42,0],[2435,36,2435,40,0],[2435,41,2435,45,0],[2436,37,2436,41,0],[2436,42,2436,46,0],[2437,32,2437,36,0],[2437,37,2437,41,0],[2438,37,2438,41,0],[2438,42,2438,46,0],[2439,35,2439,39,0],[2439,40,2439,44,0],[2457,89,2457,90,0],[2457,91,2457,92,0],[2463,9,2463,37,0],[2464,9,2464,10,0],[2465,13,2465,34,0],[2466,13,2466,42,0],[2467,13,2467,43,0],[2468,13,2468,46,0],[2470,13,2470,65,0],[2471,13,2471,95,0],[2472,9,2472,10,0],[2475,9,2475,10,0],[2476,13,2476,70,0],[2477,13,2477,66,0],[2478,13,2478,70,0],[2479,13,2479,76,0],[2480,13,2480,80,0],[2481,13,2481,39,0],[2483,13,2483,41,0],[2486,21,2486,60,0],[2487,21,2487,27,0],[2489,21,2489,63,0],[2490,21,2490,27,0],[2492,21,2492,72,0],[2493,21,2493,27,0],[2495,21,2495,64,0],[2496,21,2496,27,0],[2498,21,2498,63,0],[2499,21,2499,27,0],[2501,21,2501,64,0],[2502,21,2502,27,0],[2507,13,2507,41,0],[2508,13,2508,14,0],[2509,17,2509,70,0],[2510,17,2510,62,0],[2511,17,2511,80,0],[2514,13,2514,14,0],[2515,17,2515,69,0],[2516,17,2516,62,0],[2517,13,2517,14,0],[2518,9,2518,10,0],[2521,9,2521,10,0],[2522,13,2522,48,0],[2523,13,2523,77,0],[2526,13,2526,39,0],[2528,13,2528,14,0],[2529,17,2529,51,0],[2530,17,2530,18,0],[2531,21,2532,88,0],[2533,21,2533,61,0],[2534,21,2534,22,0],[2535,25,2535,115,0],[2536,25,2536,50,0],[2538,17,2538,18,0],[2539,17,2539,28,0],[2541,13,2541,33,0],[2542,13,2542,14,0],[2543,17,2543,48,0],[2545,9,2545,10,0],[2548,9,2548,10,0],[2549,13,2549,48,0],[2550,13,2550,77,0],[2554,13,2554,39,0],[2556,13,2556,14,0],[2557,17,2557,47,0],[2558,21,2558,104,0],[2560,22,2560,55,0],[2561,21,2561,107,0],[2563,22,2563,56,0],[2564,17,2564,18,0],[2565,21,2565,108,0],[2567,21,2567,57,0],[2568,25,2568,50,0],[2572,17,2572,18,0],[2573,22,2573,55,0],[2574,17,2574,18,0],[2575,21,2575,107,0],[2577,21,2577,56,0],[2578,25,2578,50,0],[2583,21,2583,91,0],[2584,17,2584,18,0],[2585,22,2585,56,0],[2586,17,2586,18,0],[2587,21,2588,88,0],[2589,21,2589,61,0],[2590,21,2590,22,0],[2591,25,2591,115,0],[2592,25,2592,50,0],[2595,21,2595,113,0],[2596,17,2596,18,0],[2597,17,2597,28,0],[2599,13,2599,33,0],[2600,13,2600,14,0],[2601,17,2601,48,0],[2603,9,2603,10,0]]);
    </script>
  </body>
</html>