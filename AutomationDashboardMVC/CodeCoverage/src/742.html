<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Business Layer\XmlForm Framework\Renderers\RendererJSON.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Json;
using System.Linq;
using System.Web;
using System.Xml;
using System.Xml.Linq;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.AMP3.DocumentManagementBL;
using Aurigo.AMP3.LinksBL;
using Aurigo.AMP3.LinksDTO;
using Aurigo.Brix.Platform.BusinessLayer.AbstractModels;
using Aurigo.Brix.Platform.BusinessLayer.DataAccessHelper;
using Aurigo.Brix.Platform.BusinessLayer.XMLForm;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Aurigo.Brix.Platform.BusinessLayer.DTO;

namespace Aurigo.AMP3.Common
{
    public class JSONRenderer : Renderer
    {
        private int ContainerIndex = 1;
        public JsonObject MasterDoc;
        public JsonArray GridAttachments;

        public JSONRenderer(BrixFormModel model)
            : base(model)
        {
            SetCellRenderers();
            SetCellGetServerValues();
            SetControlApplyChanges();
            SetContainerRenderers();
            SetRowGetters();
            SetDBContainerCellGetters();
            SetCellServerValue();

            // Here you can set the instance id from the datasource - but only in case if edit mode
        }

        private String GetContainerName(ControlContainer c)
        {
            String retVal = String.Empty;

            if (String.IsNullOrEmpty(c.Name))
            {
                String prefix = c.GetType().ToString();
                int lastdot = prefix.LastIndexOf(&#39;.&#39;);
                if (lastdot &gt;= 0)
                    prefix = prefix.Substring(lastdot + 1);
                retVal = prefix + ContainerIndex++;
                c.Name = retVal;
            }
            else
                retVal = c.Name;

            return (retVal.Replace(&#39; &#39;, &#39;_&#39;));
        }

        public object RenderJSONListNode(xControl ctrl, object parent, object valueObj)
        {
            String name = ctrl.Name.Replace(&#39; &#39;, &#39;_&#39;);
            string value = (valueObj == null) ? String.Empty : valueObj.ToString();
            MasterDoc.Add(name, value);

            return (value);
        }

        public object RenderJSONNode(xControl ctrl, object parent, object valueObj)
        {
            String name = ctrl.Name.Replace(&#39; &#39;, &#39;_&#39;);
            string value = (ctrl.valueObj == null) ? String.Empty : ((ctrl.IsTimezoneApplicable) ? valueObj.ToString().ToMWDateTimeString_Unformatted() : ctrl.valueObj.ToString());
            if (!(string.IsNullOrEmpty(value)) &amp;&amp; !string.IsNullOrEmpty(ctrl.DBType) &amp;&amp;
                ctrl.DBType.ToLower().StartsWith(&quot;numeric&quot;))
                MasterDoc.Add(name, float.Parse(value));
            else if (!(string.IsNullOrEmpty(value)) &amp;&amp; !string.IsNullOrEmpty(ctrl.DBType) &amp;&amp;
                     ctrl.DBType.ToLower().StartsWith(&quot;bit&quot;) &amp;&amp; ctrl.Type == ControlType.RadioButtonList &amp;&amp;
                     !string.IsNullOrEmpty(ctrl.ListItems))
                MasterDoc.Add(name, Convert.ToSByte(ctrl.valueObj));
            else if (!(string.IsNullOrEmpty(value)) &amp;&amp; !string.IsNullOrEmpty(ctrl.DBType) &amp;&amp;
                     ctrl.DBType.ToLower().StartsWith(&quot;int&quot;))
                MasterDoc.Add(name, Int32.Parse(value));
            else
                MasterDoc.Add(name, value);



            return (value);
        }

        public object RenderNumeric(xControl ctrl, object parent, object valueObj)
        {
            String name = ctrl.Name.Replace(&#39; &#39;, &#39;_&#39;);
            string value = (ctrl.valueObj == null) ? &quot;0&quot; : ctrl.valueObj.ToString();
            MasterDoc.Add(name, value);

            return (value);
        }

        public object RenderSet(xControl ctrl, object parent, object valueObj)
        {
            string key = GetContainerName(ctrl);

            bool emptyTemplate = false;
            if (ctrl.form.Table == null || ctrl.form.Table.Rows.Count &lt; 1)
                emptyTemplate = true;

            foreach (xControl innerctrl in ctrl.Controls)
            {
                if (!string.IsNullOrEmpty(innerctrl.DBType))
                    innerctrl.valueObj = emptyTemplate
                        ? (innerctrl.PrimaryKey ? ctrl.form.instanceID : string.Empty)
                        : innerctrl.form.Table.Rows[0].Field&lt;object&gt;(innerctrl.Name);
                else //else if its an expression
                    innerctrl.valueObj = innerctrl.EvaluateControlValue();

                //jsonStr += @&quot;&quot;&quot;&quot; + innerctrl.Name + &quot;\&quot;:\&quot;&quot; + innerctrl.valueObj + &quot;\&quot;&quot;;
                RenderJSONNode(innerctrl, parent, innerctrl.valueObj);
            }

            //MasterDoc.Add(key, JsonValue.Parse(jsonStr));
            //return MasterDoc;

            return parent;
        }

        private void SetCellRenderers()
        {
            xControl.RenderControl r = RenderJSONNode;
            xControl.RenderControl s = RenderJSONListNode;

            CellRenderers[(int)ControlType.Hidden] = r;
            CellRenderers[(int)ControlType.InsertHide] = r;
            CellRenderers[(int)ControlType.Display] = r;
            CellRenderers[(int)ControlType.TextBox] = r;
            CellRenderers[(int)ControlType.TextArea] = r;
            CellRenderers[(int)ControlType.Date] = r;
            CellRenderers[(int)ControlType.DateTime] = r;
            CellRenderers[(int)ControlType.Numeric] = RenderNumeric;
            CellRenderers[(int)ControlType.Integer] = r;
            CellRenderers[(int)ControlType.TimeInput] = r;
            CellRenderers[(int)ControlType.CheckBox] = r;
            CellRenderers[(int)ControlType.RadioButtonList] = r;
            CellRenderers[(int)ControlType.Formula] = r;
            CellRenderers[(int)ControlType.Formatted] = r;
            CellRenderers[(int)ControlType.Map] = r;

            CellRenderers[(int)ControlType.DropDownList] = s;
            CellRenderers[(int)ControlType.DropDownTreeDataControl] = s;
            CellRenderers[(int)ControlType.Listbox] = s;
            CellRenderers[(int)ControlType.MultiPicker] = s;

            CellRenderers[(int)ControlType.AutoIncrement] = r;
            CellRenderers[(int)ControlType.Link] = r;
            CellRenderers[(int)ControlType.Password] = r;
            CellRenderers[(int)ControlType.CheckBoxList] = r;
            CellRenderers[(int)ControlType.Button] = r;
            //CellRenderers[(int)ControlType.PlaceHolder] = r;
            CellRenderers[(int)ControlType.PickerTrigger] = r;
            CellRenderers[(int)ControlType.AttachmentControl] = new xControl.RenderControl(RenderAttachment);
            CellRenderers[(int)ControlType.Set] = new xControl.RenderControl(RenderSet);
        }

        private object RenderAttachment(xControl ctrl, object parent, object valueObj)
        {
            String name = ctrl.Name.Replace(&#39; &#39;, &#39;_&#39;);
            List&lt;LinkDetails&gt; links = LinksManager.Instance.GetLinksForModuleInstance(model.form.instanceID,
                (ctrl as AttachmentControl).ModuleId, &quot;&quot;);
            if(links!=null)
            links = links.Where(l =&gt; l.DestType.Equals(&quot;DOCMGMT&quot;)).ToList&lt;LinkDetails&gt;();
            JsonArray docs = new JsonArray();
            JsonObject doc;
            string moduleLastSyncedAt = model.form.RequestParameters.ContainsKey(&quot;modulelastsyncedat&quot;) ? model.form.RequestParameters[&quot;modulelastsyncedat&quot;].ToString() : &quot;EMPTY&quot;;

            if (links != null)
            {
                foreach (LinkDetails l in links)
                {
                    int versionNo;
                    doc = new JsonObject();
                    doc.Add(&quot;DocId&quot;, l.DestID);
                    doc.Add(&quot;DocName&quot;, l.LinkName);
                    doc.Add(&quot;Desc&quot;, l.Description);
                    doc.Add(&quot;New&quot;, false);
                    doc.Add(&quot;Deleted&quot;, false);
                    doc.Add(&quot;FilePath&quot;, &quot;&quot;);
                    doc.Add(&quot;LinkId&quot;, l.LinkID);
                    doc.Add(&quot;CreatedDate&quot;, l.CreatedDate);
                    versionNo = string.IsNullOrEmpty(l.VersionNumber) ? 0 : Convert.ToInt32(l.VersionNumber);
                    doc.Add(&quot;Version&quot;, versionNo);



                    // Annotations information for sync

                    AnnotationIds annotations = DocumentManager.Instance.GetDocumentAnnoationIdsForSync(Convert.ToInt32(l.DestID), l.LinkID, versionNo, moduleLastSyncedAt);

                    doc.Add(&quot;AllAnnotationIds&quot;, string.Join(&quot;, &quot;, annotations.AllAnnotationIds)); // This list will be used to delete all the local copies of the annotation if the annotation is deleted in server
                    doc.Add(&quot;NewOrModifiedAnnotationIds&quot;, string.Join(&quot;, &quot;, annotations.NewOrModifiedAnnotationIds)); // this will have list of annotation ids which needs to be downloaded in the sync
                    doc.Add(&quot;AnnotationInstanceIdsWithServerModifiedOn&quot;, string.Join(&quot;, &quot;, annotations.AnnotationInstanceIdsWithServerModifiedOn)); // this will have list of annotation ids which needs to be downloaded in the sync





                    JsonArray jMetaData = new JsonArray();
                    DataSet Metadata = DocumentManager.Instance.GetAttachmentMetadata(l.DestID);
                    if (Metadata != null &amp;&amp; Metadata.Tables.Count &gt; 0 &amp;&amp; Metadata.Tables[0].Rows.Count &gt; 0)
                    {
                        foreach (DataRow metadataRow in Metadata.Tables[0].Rows)
                        {
                            XmlDocument xdcDocument = new XmlDocument();


                            var metadataXML = metadataRow[&quot;MetadataXML&quot;].ToString();
                            xdcDocument.LoadXml(metadataXML);

                            XmlElement xelRoot = xdcDocument.DocumentElement;
                            XmlNodeList xnlNodes = xelRoot.SelectNodes(&quot;/METADATA/LINK/COLUMN&quot;);


                            foreach (XmlNode xndNode in xnlNodes)
                            {
                                //What to write here??
                                //My sql insert command will go here
                                JsonObject row = new JsonObject();
                                var colName = xndNode[&quot;NAME&quot;].InnerText.TrimStart().TrimEnd();
                                var colValue = xndNode[&quot;VALUE&quot;].InnerText.TrimStart().TrimEnd();
                                doc.Add(colName, colValue);

                                row.Add(&quot;colName&quot;, colName);
                                row.Add(&quot;colValue&quot;, colValue);
                                jMetaData.Add(row);
                            }

                            var columns =
                                XDocument.Parse(metadataXML)
                                    .Descendants(&quot;METADATA&quot;)
                                    .Descendants(&quot;LINK&quot;)
                                    .Descendants(&quot;COLUMN&quot;);
                        }
                    }
                    doc.Add(&quot;MetaData&quot;, jMetaData);

                    docs.Add(doc);
                    GridAttachments.Add(doc);
                }
            }


            MasterDoc.Add(name, docs);

            return (docs.ToString());
        }


        private string RenderGridAttachment(xControl ctrl, JsonObject parent, string instanceID)
        {
            String name = ctrl.Name.Replace(&#39; &#39;, &#39;_&#39;);
            List&lt;LinkDetails&gt; links = LinksManager.Instance.GetLinksForModuleInstance(instanceID,
                (ctrl as AttachmentControl).ModuleId, &quot;&quot;);
            if(links!=null)
            links = links.Where(l =&gt; l.DestType.Equals(&quot;DOCMGMT&quot;)).ToList&lt;LinkDetails&gt;();
            JsonArray docs = new JsonArray();
            JsonObject doc;
            string moduleLastSyncedAt = model.form.RequestParameters.ContainsKey(&quot;modulelastsyncedat&quot;) ? model.form.RequestParameters[&quot;modulelastsyncedat&quot;].ToString() : &quot;EMPTY&quot;;

            if (links != null)
            {
                foreach (LinkDetails l in links)
                {
                    int versionNo;
                    doc = new JsonObject();
                    doc.Add(&quot;DocId&quot;, l.DestID);
                    doc.Add(&quot;DocName&quot;, l.LinkName);
                    doc.Add(&quot;Desc&quot;, l.Description);
                    doc.Add(&quot;New&quot;, false);
                    doc.Add(&quot;Deleted&quot;, false);
                    doc.Add(&quot;FilePath&quot;, &quot;&quot;);
                    doc.Add(&quot;LinkId&quot;, l.LinkID);
                    doc.Add(&quot;CreatedDate&quot;, l.CreatedDate);
                    versionNo = string.IsNullOrEmpty(l.VersionNumber) ? 0 : Convert.ToInt32(l.VersionNumber);
                    doc.Add(&quot;Version&quot;, versionNo);



                    // Annotations information for sync

                    AnnotationIds annotations = DocumentManager.Instance.GetDocumentAnnoationIdsForSync(Convert.ToInt32(l.DestID), l.LinkID, versionNo, moduleLastSyncedAt);

                    doc.Add(&quot;AllAnnotationIds&quot;, string.Join(&quot;, &quot;, annotations.AllAnnotationIds)); // This list will be used to delete all the local copies of the annotation if the annotation is deleted in server
                    doc.Add(&quot;NewOrModifiedAnnotationIds&quot;, string.Join(&quot;, &quot;, annotations.NewOrModifiedAnnotationIds)); // this will have list of annotation ids which needs to be downloaded in the sync
                    doc.Add(&quot;AnnotationInstanceIdsWithServerModifiedOn&quot;, string.Join(&quot;, &quot;, annotations.AnnotationInstanceIdsWithServerModifiedOn)); // this will have list of annotation ids which needs to be downloaded in the sync

                    JsonArray jMetaData = new JsonArray();
                    DataSet Metadata = DocumentManager.Instance.GetAttachmentMetadata(l.DestID);
                    if (Metadata != null &amp;&amp; Metadata.Tables.Count &gt; 0 &amp;&amp; Metadata.Tables[0].Rows.Count &gt; 0)
                    {
                        foreach (DataRow metadataRow in Metadata.Tables[0].Rows)
                        {
                            XmlDocument xdcDocument = new XmlDocument();


                            var metadataXML = metadataRow[&quot;MetadataXML&quot;].ToString();
                            xdcDocument.LoadXml(metadataXML);

                            XmlElement xelRoot = xdcDocument.DocumentElement;
                            XmlNodeList xnlNodes = xelRoot.SelectNodes(&quot;/METADATA/LINK/COLUMN&quot;);


                            foreach (XmlNode xndNode in xnlNodes)
                            {
                                JsonObject row = new JsonObject();
                                //What to write here??
                                //My sql insert command will go here

                                var colName = xndNode[&quot;NAME&quot;].InnerText.TrimStart().TrimEnd();
                                var colValue = xndNode[&quot;VALUE&quot;].InnerText.TrimStart().TrimEnd();
                                doc.Add(colName, colValue);

                                row.Add(&quot;colName&quot;, colName);
                                row.Add(&quot;colValue&quot;, colValue);
                                jMetaData.Add(row);
                            }

                            var columns =
                                XDocument.Parse(metadataXML)
                                    .Descendants(&quot;METADATA&quot;)
                                    .Descendants(&quot;LINK&quot;)
                                    .Descendants(&quot;COLUMN&quot;);
                        }
                    }
                    doc.Add(&quot;MetaData&quot;, jMetaData);

                    docs.Add(doc);
                    GridAttachments.Add(doc);
                }
            }


            //parent.Add(name, docs);

            return (docs.ToString());
        }

        private void SetCellGetServerValues()
        {
            xControl.GetServerSideValue r = GetServerValueGeneric;

            ServerGetters[(int)ControlType.Hidden] = r;
            ServerGetters[(int)ControlType.InsertHide] = r;
            ServerGetters[(int)ControlType.Display] = r;
            ServerGetters[(int)ControlType.TextBox] = r;
            ServerGetters[(int)ControlType.TextArea] = r;
            ServerGetters[(int)ControlType.Date] = new xControl.GetServerSideValue(GetDateTimeOrNumeric);
            ServerGetters[(int)ControlType.DateTime] = new xControl.GetServerSideValue(GetDateTimeOrNumeric);
            ServerGetters[(int)ControlType.Numeric] = new xControl.GetServerSideValue(GetDateTimeOrNumeric);
            ;
            ServerGetters[(int)ControlType.Integer] = r;
            ServerGetters[(int)ControlType.TimeInput] = r;
            ServerGetters[(int)ControlType.CheckBox] = r;
            ServerGetters[(int)ControlType.RadioButtonList] = r;
            ServerGetters[(int)ControlType.Formula] = r;
            ServerGetters[(int)ControlType.Formatted] = r;
            ServerGetters[(int)ControlType.Map] = r;

            ServerGetters[(int)ControlType.DropDownList] = r;
            ServerGetters[(int)ControlType.DropDownTreeDataControl] = r;
            ServerGetters[(int)ControlType.Listbox] = r;
            ServerGetters[(int)ControlType.MultiPicker] = r;

            ServerGetters[(int)ControlType.AutoIncrement] = new xControl.GetServerSideValue(GetAutoIncrementValue);
            ServerGetters[(int)ControlType.Link] = r;
            ServerGetters[(int)ControlType.Password] = r;
            ServerGetters[(int)ControlType.CheckBoxList] = r;
            ServerGetters[(int)ControlType.Button] = r;
            //ServerGetters[(int)ControlType.PlaceHolder] = r;
            ServerGetters[(int)ControlType.PickerTrigger] = r;

            ServerGetters[(int)ControlType.Set] = r;
            ServerGetters[(int)ControlType.AttachmentControl] =
                new xControl.GetServerSideValue(GetAttachmentControlValue);
        }

        private string GetAttachmentControlValue(xControl ctrl)
        {
            string moduleID = (ctrl as AttachmentControl).ModuleId;
            string parentInstanceId = model.form.RequestParameters[&quot;ParentID&quot;].ToString();
            DocumentManager.Instance.CreateFolderForModule(moduleID, model.form.ParentModuleID,
                Convert.ToInt32(parentInstanceId));
            var ud = UserDetail.GetCurrentUserDetail();
            string projectId = model.form.RequestParameters[&quot;pId&quot;].ToString();
            var httpRequest = HttpContext.Current.Request;
            string instanceId = model.form.instanceID;
            int contractID = 0;
            object objContId = ComponentHelper.Instance.ExecuteScalar(StoredProcedure.usp_CONTMGTGetTopContract, null,
                projectId);
            if (objContId != null)
                contractID = Convert.ToInt32(objContId);

            if (httpRequest.Files.Count &gt; 0)
            {
                var docfiles = new List&lt;string&gt;();
                foreach (string file in httpRequest.Files)
                {
                    var postedFile = httpRequest.Files[file];
                    var filePath = postedFile.FileName;

                    string fileExt = filePath.Substring(filePath.IndexOf(&quot;.&quot;, StringComparison.OrdinalIgnoreCase) + 1,
                        filePath.Length - (filePath.IndexOf(&quot;.&quot;, StringComparison.OrdinalIgnoreCase) + 1)).ToLower();

                    //TODO: Need to handle file extension in a better way
                    //When a file is uploaded from the mobile gallery, file name does not contain extension
                    if (filePath.LastIndexOf(&quot;.&quot;, StringComparison.OrdinalIgnoreCase) == -1)
                    {
                        if (postedFile.ContentType == &quot;image/jpeg&quot;)
                            filePath += &quot;.jpg&quot;;
                        else if (postedFile.ContentType == &quot;image/png&quot;)
                            filePath += &quot;.png&quot;;
                    }

                    int nfilelength = postedFile.ContentLength;
                    var filebytes = new byte[nfilelength];
                    postedFile.InputStream.Read(filebytes, 0, nfilelength);


                    int folderId = DocumentManager.Instance.GetParentFolderIdForModule(instanceId, moduleID,
                        model.form.ParentModuleID, (contractID));

                    if (folderId == 0 &amp;&amp; int.Parse(projectId) == (contractID))
                    {
                        folderId = DocumentManager.Instance.GetParentFolderIdForModule(instanceId, moduleID, &quot;PROJECT&quot;,
                            (contractID));
                    }


                    string fileName = filePath.Substring(filePath.LastIndexOf(&quot;/&quot;) + 1,
                        filePath.Length - filePath.LastIndexOf(&quot;/&quot;) - 1);
                    int res = DocumentManager.Instance.SaveDocument(folderId, fileName, filebytes, ud.UID, ud.UserName,
                        DateTime.UtcNow, &quot;&quot;, moduleID, false);

                    if (res &gt; 0)
                    {
                        LinksManager.Instance.AddLinks(filePath, instanceId, moduleID, res.ToString(), &quot;DOCMGMT&quot;,
                            ud.UserName, null, &quot;&quot;, (int?)folderId);
                    }

                    docfiles.Add(filePath);
                }
            }

            return &quot;&quot;;
        }

        private void SetControlApplyChanges()
        {
            //ApplyChangesToControl[(int)ControlType.TextBox] =
            //    new xControl.ApplyChangesToControl(ApplyChangesToTextBox);
        }

        private void SetCellServerValue()
        {
            ServerSetters[(int)ControlType.Hidden] = SetServerNodeValue;
            ServerSetters[(int)ControlType.Map] = SetServerNodeValue;
            ServerSetters[(int)ControlType.TextBox] = SetServerNodeValue;
            ServerSetters[(int)ControlType.TextArea] = SetServerNodeValue;
            ServerSetters[(int)ControlType.Password] = SetServerNodeValue;
            ServerSetters[(int)ControlType.Date] = SetServerNodeValue;
            ServerSetters[(int)ControlType.DateTime] = SetServerNodeValue;
            ServerSetters[(int)ControlType.Numeric] = SetServerNodeValue;
            ServerSetters[(int)ControlType.Integer] = SetServerNodeValue;
            ServerSetters[(int)ControlType.TimeInput] = SetServerNodeValue;
            ServerSetters[(int)ControlType.CheckBox] = SetServerNodeValue;
            ServerSetters[(int)ControlType.DropDownList] = SetServerNodeValue;
            ServerSetters[(int)ControlType.DropDownTreeDataControl] = SetServerNodeValue;
            ServerSetters[(int)ControlType.RadioButtonList] = SetServerNodeValue;
            ServerSetters[(int)ControlType.Formatted] = SetServerNodeValue;
            ServerSetters[(int)ControlType.MultiPicker] = SetServerNodeValue;
            ServerSetters[(int)ControlType.Link] = SetServerNodeValue;
            ServerSetters[(int)ControlType.Listbox] = SetServerNodeValue;
            ServerSetters[(int)ControlType.CheckBoxList] = SetServerNodeValue;
            ServerSetters[(int)ControlType.PickerTrigger] = SetServerNodeValue;
            ServerSetters[(int)ControlType.Display] = SetServerNodeValue;
            ServerSetters[(int)ControlType.AutoIncrement] = SetServerNodeValue;
        }

        private string GetDateTimeOrNumeric(xControl ctrl)
        {
            var xdoc = new JsonObject();
            xdoc = (JsonObject)JsonValue.Parse(DataSource.ToString());
            JsonValue val = xdoc[ctrl.Name];
            string value = val == null ? string.Empty : val.ReadAs&lt;string&gt;();
            if (!string.IsNullOrEmpty(value) &amp;&amp; ctrl.IsTimezoneApplicable)
            {
                DateTime dt;
                if (DateTime.TryParse(value, out dt))
                {
                    return dt.ToMWUtcDateTime().ToString();
                }
            }

            return string.IsNullOrEmpty(value)
                ? &quot;_DBNULL_&quot;
                    : value;



        }



        private string GetAutoIncrementValue(xControl ctrl)
        {
            AutoIncrement ai = ctrl as AutoIncrement;
            if (ctrl.form.engine.IsNewMode)
            {
                int maxValue = GetMaxValue(ai);
                string prefix = ctrl.ParseDynamicString(ai.Prefix);
                string suffix = ctrl.ParseDynamicString(ai.Suffix);
                // set the value of the reference control for autoincrement control
                var xdoc = new JsonObject();
                xdoc = (JsonObject)JsonValue.Parse(DataSource.ToString());
                xdoc[ai.ValueControlReference.Name] = maxValue.ToString();
                DataSource = xdoc.ToString();
                if (ai.PadLeft &gt; 0)
                    return (prefix ?? string.Empty) + maxValue.ToString(&quot;D&quot; + ai.PadLeft) + (suffix ?? string.Empty);
                else
                    return (prefix ?? string.Empty) + maxValue.ToString() + (suffix ?? string.Empty);
            }
            else
            {
                var xdoc = new JsonObject();
                xdoc = (JsonObject)JsonValue.Parse(DataSource.ToString());
                JsonValue xNode = xdoc[ctrl.Name] = (xdoc == null ? string.Empty : xdoc[ctrl.Name]);
                return xNode.ReadAs&lt;string&gt;();
            }
        }

        private int GetMaxValue(AutoIncrement c)
        {
            string columnName = c.Name;
            string query = &quot;select max(&quot; + c.Name + &quot;_VCRef&quot; + &quot;) from &quot; + c.form.TableName;
            //TODO: Skipping this because scope cannot xml renderer cannot depend on page request
            if (!string.IsNullOrEmpty(c.ScopeFilter) &amp;&amp; this.model.form.RequestParameters != null &amp;&amp;
                this.model.form.RequestParameters.Count &gt; 0)
            {
                string whrCond = &quot; where &quot; + c.ParseDynamicString(c.ScopeFilter);
                query = query + whrCond;
            }

            object objMaxValue = ComponentHelper.Instance.ExecuteScalar(query);
            int maxValue = c.Seed;
            if (objMaxValue != System.DBNull.Value)
                maxValue = Int32.Parse(objMaxValue.ToString()) + c.Interval;

            return maxValue;
        }

        private string GetServerValue(object wc, xControl ctrl)
        {
            var xdoc = new JsonObject();
            xdoc = (JsonObject)JsonValue.Parse(DataSource.ToString());
            return (xdoc == null ? string.Empty : xdoc[ctrl.Name].ToString());
        }

        internal override string GetServerValue(xControl control)
        {
            if (ServerGetters[(int)control.Type] != null)
                return ServerGetters[(int)control.Type](control);
            else
                return (string.Empty);
        }

        internal string GetServerValueGeneric(xControl control)
        {
            string returnValue;
            JsonObject xdoc = new JsonObject();
            xdoc = (JsonObject)JsonValue.Parse(DataSource.ToString());
            returnValue = (xdoc == null ? string.Empty : xdoc[control.Name].ReadAs&lt;string&gt;());
            returnValue = returnValue.Replace(&quot;\n&quot;, Environment.NewLine);

            if (!string.IsNullOrEmpty(returnValue) &amp;&amp; control.IsTimezoneApplicable)
            {
                DateTime dt;
                if (control.ReEvaluate == true)
                {
                    return DateTime.UtcNow.ToString();
                }

                if (DateTime.TryParse(returnValue, out dt))
                {
                    return dt.ToMWUtcDateTime().ToString();
                }

            }

            if (control.Type == ControlType.Integer &amp;&amp; !string.IsNullOrEmpty(control.Format))
            {
                returnValue = System.Text.RegularExpressions.Regex.Replace(returnValue, &quot;[^0-9.]+&quot;, &quot;&quot;,
                    System.Text.RegularExpressions.RegexOptions.Compiled);
            }

            //Below Changes added by Santosh KA : This was checked in Release Branch by mistake. And now copied here
            if ((control.Type == ControlType.Integer || control.Type == ControlType.Numeric) &amp;&amp; returnValue == string.Empty)
            {
                returnValue = null;
            }

            if (control.IsTimezoneApplicable)
            {
                returnValue = System.Text.RegularExpressions.Regex.Replace(returnValue, &quot;[^0-9.]+&quot;, &quot;&quot;,
                    System.Text.RegularExpressions.RegexOptions.Compiled);
            }

            return returnValue;
        }

        internal override void SetServerValue(xControl control, object value)
        {
            if (ServerSetters[(int)control.Type] != null)
            {
                xControl.SetServerSideValue d = ServerSetters[(int)control.Type];
                if (d != null)
                    d(control, value);
            }
        }

        private void SetServerNodeValue(xControl control, object value)
        {
            if (value != null &amp;&amp; DataSource != null)
            {
                var xdoc = new JsonObject();
                xdoc = (JsonObject)JsonValue.Parse(DataSource.ToString());
                xdoc[control.Name] = value.ToString();

                DataSource = xdoc.ToString();
            }

            else
            {
                var xdoc = new JsonObject();
                xdoc = (JsonObject)JsonValue.Parse(MasterDoc.ToString());
                xdoc[control.Name] = value.ToString();

                MasterDoc = xdoc;
            }
        }


        private void RenderSection(ControlContainer cont, object parent)
        {
            JsonObject d = parent as JsonObject;
            bool emptyTemplate = false;
            if (cont.form.Table == null || cont.form.Table.Rows.Count &lt; 1)
                emptyTemplate = true;

            //XmlElement e = d.CreateElement(GetContainerName(cont));
            //d.DocumentElement.AppendChild(e);

            foreach (xControl ctrl in cont.Controls)
            {
                //If this control&#39;s value is stored in DB
                if (!string.IsNullOrEmpty(ctrl.DBType))
                    ctrl.valueObj = emptyTemplate
                        ? (ctrl.PrimaryKey ? cont.form.instanceID : string.Empty)
                        : cont.form.Table.Rows[0].Field&lt;object&gt;(ctrl.Name);
                else //else if its an expression
                    ctrl.valueObj = ctrl.EvaluateControlValue();

                ctrl.RenderSingleFormControl(ctrl.valueObj, RenderFormat.RenderJSON);

                //TODO: You need to take care of inner control also
            }

            foreach (ControlContainer sc in cont.Containers)
                sc.Render(parent, RenderFormat.RenderJSON);
        }

        private void RenderStage(ControlContainer cont, object parent)
        {
            JsonObject d = parent as JsonObject;
            bool emptytemplate = false;
            if (cont.form.Table == null || cont.form.Table.Rows.Count &lt; 1)
                emptytemplate = true;

            //XmlElement e = d.Add(GetContainerName(cont));
            //d.documentelement.appendchild(e); 

            foreach (xControl ctrl in cont.Controls)
            {
                //if this control&#39;s value is stored in db
                if (!string.IsNullOrEmpty(ctrl.DBType))
                    ctrl.valueObj = emptytemplate
                        ? (ctrl.PrimaryKey ? cont.form.instanceID : string.Empty)
                        : cont.form.Table.Rows[0].Field&lt;object&gt;(ctrl.Name);
                else //else if its an expression
                    ctrl.valueObj = ctrl.EvaluateControlValue();

                ctrl.RenderSingleFormControl(ctrl.valueObj, RenderFormat.RenderJSON);

                //todo: you need to take care of inner control also
            }

            foreach (ControlContainer sc in cont.Containers)
                sc.Render(parent, RenderFormat.RenderJSON);
        }

        private void RenderStaticGrid(ControlContainer cont, object parent)
        {
            var dcont = cont as DataBaseContainer;

            JsonObject d = MasterDoc;

            if (dcont.Table == null)
                return;

            string key = GetContainerName(cont);
            int rowCounter = 1;
            JsonObject obj = new JsonObject();
            JsonArray rows = new JsonArray();
            if (dcont.Table.Rows.Count == 0)
            {
                string rowKey = (&quot;Row&quot; + rowCounter);
                int colCounter = 0;
                int columnRenderCounter = 0;
                foreach (xControl c in dcont.Containers[0].Controls)
                {
                    {
                        obj.Add(dcont.Name + &quot;_&quot; + rowCounter + &quot;_&quot; + columnRenderCounter, &quot;&quot;);
                        columnRenderCounter++;
                    }
                    colCounter++;
                }
                rowCounter++;
            }
            else
                foreach (DataRow r in dcont.Table.Rows)
                {
                    string rowKey = (&quot;Row&quot; + rowCounter);
                    int colCounter = 0;
                    int columnRenderCounter = 0;
                    foreach (xControl c in dcont.Containers[0].Controls)
                    {

                        {
                            obj.Add(dcont.Name + &quot;_&quot; + rowCounter + &quot;_&quot; + columnRenderCounter,
                                Convert.ToString(r.Field&lt;object&gt;(c.Name)));
                            columnRenderCounter++;
                        }
                        colCounter++;
                    }
                    rowCounter++;
                }
            rows.Add(obj);
            d.Add(key, rows);
        }

        private void RenderDynamicGrid(ControlContainer cont, object parent)
        {
            var dcont = cont as DataBaseContainer;

            JsonObject d = MasterDoc;

            string key = GetContainerName(cont);

            string query = string.Empty;
            string parentInstanceID = string.Empty;
            if (parent is JsonObject)
            {
                Form f = ControlContainer.GetParent&lt;Form&gt;(dcont);
                parentInstanceID = (parent as JsonObject)[f.PrimaryKeyName].ToString();
            }
            else
            {
                //TODO:  this is for dynamic grid inside dynamic grid
                //parentInstanceID =
                //    parentElem.SelectSingleNode(&quot;./&quot; + ControlContainer.GetParent&lt;DynamicGrid&gt;(dcont).PrimaryKeyName).
                //        InnerText;
            }

            if (dcont.Table == null)
            {
                // dcont.ControlReference.Add(e);
                return;
            }
            else
            {
                JsonObject nd = (parent as JsonObject);
                dcont.Table = (dcont as DynamicGrid).CreateDerivedColumns(dcont.Table, nd);
            }

            //query += dcont.GetForeignKeyControls()[0].Name + &quot; = &quot; + parentInstanceID + &quot; &quot;;
            foreach (xControl ikey in dcont.GetForeignKeyControls())
            {
                if (ikey.Value == null)
                    query += ikey.Name + &quot; = &#39;&quot; + parentInstanceID + &quot;&#39; AND &quot;;
                else
                    query += ikey.Name + &quot; = &#39;&quot; + ikey.EvaluateControlValue() + &quot;&#39; AND &quot;;
            }
            if (query.EndsWith(&quot; AND &quot;))
                query = query.Remove(query.Length - 5);


            // we need to create and arrat if row items
            JsonArray rows = new JsonArray();
            DataRow[] gridRows = dcont.Table.Select(query);
            if(gridRows.Length == 0 &amp;&amp; model.form.DesignMode)
            {
                JsonObject obj = new JsonObject();
                foreach (xControl c in dcont.Controls)
                {
                    if (c.Type != ControlType.AttachmentControl)
                    {
                        obj.Add(c.Name, (c.valueObj ?? &quot;&quot;).ToString());
                    }
                    else
                    {
                        string ValObj = RenderGridAttachment(c, obj, &quot;&quot;);
                        obj.Add(c.Name, (ValObj).ToString());
                    }
                }
                rows.Add(obj);
                foreach (DynamicGrid innerGrid in dcont.Containers.OfType&lt;DynamicGrid&gt;())
                    RenderDynamicGrid(innerGrid, obj);
            }
            else
                foreach (DataRow r in dcont.Table.Select(query))
                {
                    JsonObject obj = new JsonObject();
                    foreach (xControl c in dcont.Controls)
                    {
                        if (c.Type != ControlType.AttachmentControl)
                        {
                            if (r != null)
                            {
                                if (r.Table.Columns.Contains(c.Name))
                                {
                                    object value = r.Field&lt;object&gt;(c.Name);
                                    c.valueObj = (value == null) ? String.Empty : ((c.IsTimezoneApplicable) ? value.ToString().ToMWDateTimeString_Unformatted() : value.ToString());
                                }
                                else
                                {
                                    c.valueObj = r;
                                    c.valueObj = c.EvaluateControlValue();
                                    string value = (c.valueObj == null) ? String.Empty : ((c.IsTimezoneApplicable) ? c.valueObj.ToString().ToMWDateTimeString_Unformatted() : c.valueObj.ToString());
                                    c.valueObj = value;
                                }
                            }

                            obj.Add(c.Name, (c.valueObj ?? &quot;&quot;).ToString());
                        }
                        else
                        {
                            string ValObj = RenderGridAttachment(c, obj,
                                Convert.ToString(r.Field&lt;object&gt;(dcont.PrimaryKeyName)));
                            obj.Add(c.Name, (ValObj).ToString());
                        }
                    }
                    rows.Add(obj);
                    foreach (DynamicGrid innerGrid in dcont.Containers.OfType&lt;DynamicGrid&gt;())
                        RenderDynamicGrid(innerGrid, obj);
                }

            d.Add(key, rows);
        }

        private void RenderCheckListGroup(ControlContainer cont, object parent)
        {
            var dcont = cont as CheckListGroup;

            if (dcont.Table == null) return;

            JsonObject d = MasterDoc;

            string key = GetContainerName(cont);
            int counter = 0;

            cont.Name = key;
            JsonObject groupsNode = new JsonObject();

            JsonArray groups = new JsonArray();
            groupsNode.Add(&quot;Groups&quot;, groups);

            (parent as JsonObject).Add(key, groupsNode);

            int groupCount = 0;
            int checkListCounter = 0;
            foreach (Group grp in dcont.Containers.OfType&lt;Group&gt;())
            {
                JsonObject group = new JsonObject();
                group.Add(&quot;Name&quot;, grp.Name);

                JsonArray checklists = new JsonArray();
                group.Add(&quot;Checklists&quot;, checklists);

                groups.Add(group);


                foreach (CheckList chkList in grp.Containers.OfType&lt;CheckList&gt;())
                {
                    JsonObject checklist = new JsonObject();
                    checklist.Add(&quot;Description&quot;, chkList.Description);
                    checklist.Add(&quot;SerialNo&quot;, counter + 1);

                    JsonArray options = new JsonArray();
                    checklist.Add(&quot;Options&quot;, options);

                    checklists.Add(checklist);

                    chkList.PKControl.Type = ControlType.Hidden;
                    chkList.PKControl.Name = dcont.PrimaryKeyName + &quot;_&quot; + groupCount + &quot;_&quot; + checkListCounter;
                    chkList.PKControl.DBType = &quot;Int Identity(1,1)&quot;;
                    chkList.PKControl.ParentObject = dcont;

                    if (dcont.engine.IsViewOrEditMode() &amp;&amp; !string.IsNullOrEmpty(chkList.PKControl.DBType) &amp;&amp;
                        dcont.Table.Rows.Count &gt; 0 &amp;&amp; dcont.Table.Rows.Count &gt;= checkListCounter)
                        dcont.valueObj = dcont.Table.Rows[checkListCounter].Field&lt;object&gt;(dcont.PrimaryKeyName);
                    else
                        dcont.valueObj = null;

                    JsonObject pkJsonObj = new JsonObject();
                    pkJsonObj.Add(chkList.PKControl.Name, (dcont.valueObj ?? &quot;&quot;).ToString());
                    options.Add(pkJsonObj);

                    foreach (xControl c in dcont.Controls)
                    {
                        JsonObject option = new JsonObject();
                        options.Add(option);

                        if (dcont.Table.Rows.Count &gt; 0 &amp;&amp; dcont.Table.Rows.Count &gt;= counter)
                        {
                            if (dcont.Table.Columns.Contains(c.Name))
                                c.valueObj = dcont.Table.Rows[counter][c.Name];
                            else
                            {
                                c.valueObj = dcont.Table.Rows[counter];
                                c.valueObj = c.EvaluateControlValue();
                            }
                        }
                        else
                            c.valueObj = &quot;&quot;;
                        option.Add(c.Name + &quot;_&quot; + groupCount + &quot;_&quot; + checkListCounter + &quot;_&quot; + dcont.Name,
                            c.valueObj.ToString());
                    }

                    counter++;
                    checkListCounter++;
                }
                groupCount++;
            }
        }

        private void RenderNothing(ControlContainer cont, object parent)
        {
        }

        private void SetContainerRenderers()
        {
            ContainerRenderers[(int)ContainerTypes.Section] = new ControlContainer.RenderContainer(RenderSection);
            ContainerRenderers[(int)ContainerTypes.Stage] = new ControlContainer.RenderContainer(RenderStage);
            ContainerRenderers[(int)ContainerTypes.DynamicGrid] =
                new ControlContainer.RenderContainer(RenderDynamicGrid);
            ContainerRenderers[(int)ContainerTypes.Spacer] = new ControlContainer.RenderContainer(RenderNothing);
            ContainerRenderers[(int)ContainerTypes.Text] = new ControlContainer.RenderContainer(RenderNothing);
            ContainerRenderers[(int)ContainerTypes.StaticGrid] = new ControlContainer.RenderContainer(RenderStaticGrid);
            ContainerRenderers[(int)ContainerTypes.CheckListGroup] =
                new ControlContainer.RenderContainer(RenderCheckListGroup);
            ContainerRenderers[(int)ContainerTypes.Tab] = new ControlContainer.RenderContainer(RenderTab);
            ContainerRenderers[(int)ContainerTypes.Tabs] = new ControlContainer.RenderContainer(RenderTabs);
        }

        private void RenderTabs(ControlContainer cont, object parent)
        {
            foreach (ControlContainer tab in cont.Containers)
            {
                tab.Render(parent, RenderFormat.RenderDataDynamics);
            }
        }

        private void RenderTab(ControlContainer cont, object parent)
        {
            foreach (ControlContainer sc in cont.Containers)
                if (!(sc is Section)) sc.Render(parent, RenderFormat.RenderJSON);
        }

        private void SetRowGetters()
        {
        }

        private void SetDBContainerCellGetters()
        {
            CellGetters[(int)ContainerTypes.DynamicGrid] = new DataBaseContainer.GetCellInformation(GetDynamicGridCell);
            CellGetters[(int)ContainerTypes.StaticGrid] = new DataBaseContainer.GetCellInformation(GetStaticGridCell);
            CellGetters[(int)ContainerTypes.CheckListGroup] =
                new DataBaseContainer.GetCellInformation(GetCheckListGroupCell);
        }


        private object GetDynamicGridCell(DataBaseContainer dbContainer, int rowIndex, int columnIndex)
        {
            var dGrid = dbContainer as DynamicGrid;
            int colCount = dGrid.Controls.Count;

            JsonArray rows = GetControlXMLNode(dGrid);

            if (rows == null || rows.Count &lt; 1) return null; //Dynamic grid not found in Input XML

            if (rows.Count &gt; rowIndex)
            {
                string returnValue = &quot;&quot;;

                if (dGrid.Controls[columnIndex].Type == ControlType.Integer &amp;&amp;
                    !string.IsNullOrEmpty(dGrid.Controls[columnIndex].Format))
                {
                    var objVal = rows[rowIndex][dGrid.Controls[columnIndex].Name];
                    returnValue =
                        System.Text.RegularExpressions.Regex.Replace((objVal == null) ? &quot;&quot; : objVal.ReadAs&lt;string&gt;(),
                            &quot;[^0-9.-]+&quot;, &quot;&quot;, System.Text.RegularExpressions.RegexOptions.Compiled);
                }
                else
                {
                    //THIS WILL HAVE A ISSUE IF JSON HAVE REAL NULL
                    var objVal = rows[rowIndex][dGrid.Controls[columnIndex].Name];
                    returnValue = (objVal == null) ? &quot;&quot; : objVal.ReadAs&lt;string&gt;();

                    //Below Changes added by Santosh KA : This was checked in Release Branch by mistake. And now copied here
                    if ((dGrid.Controls[columnIndex].Type == ControlType.Integer
                       || dGrid.Controls[columnIndex].Type == ControlType.Numeric)
                       &amp;&amp; (returnValue == string.Empty))
                    {
                        returnValue = &quot;_DBNULL_&quot;;
                    }
                }
                return returnValue;
            }
            else
                return null;
        }

        private object GetStaticGridCell(DataBaseContainer dbContainer, int rowIndex, int columnIndex)
        {
            var sGrid = dbContainer as StaticGrid;
            var h = (sGrid.Containers[0] as Header);
            xControl xctrl = h.Controls[columnIndex];
            int colCount = h.Controls.Count;

            JsonArray rows = GetControlXMLNode(sGrid);

            if (xctrl.ForeignKey)
                return sGrid.form.instanceID;
            else
            {
                if (rows.Count != 0)
                {
                    string Name = sGrid.Name + &quot;_&quot; + (rowIndex + 1) + &quot;_&quot; + columnIndex;
                    //Below Changes added by Santosh KA : This was checked in Release Branch by mistake. And now copied here
                    string value = rows[0][Name].ReadAs&lt;string&gt;();
                    string dbType = xctrl.DBType.ToLower();
                    if ((dbType.Contains(&quot;decimal&quot;) || (dbType.Contains(&quot;int&quot;))) &amp;&amp; value == string.Empty)
                    {
                        value = &quot;_DBNULL_&quot;;
                    }
                    return value;
                }
                else
                {
                    if (xctrl.PrimaryKey)
                    {
                        return &quot;&quot;;
                    }
                    else
                    {
                        return null;
                    }
                }
            }
        }

        private object GetCheckListGroupCell(DataBaseContainer dbContainer, int rowIndex, int columnIndex)
        {
            var clg = dbContainer as CheckListGroup;
            int colCount = clg.Controls.Count;

            var xdoc = new JsonObject();
            xdoc = (JsonObject)JsonValue.Parse(DataSource.ToString());

            JsonArray groups = (JsonArray)((JsonObject)xdoc[GetContainerName(clg)])[&quot;Groups&quot;];

            JsonObject checklistJson = GetCheckList(groups, rowIndex);

            if (checklistJson == null || checklistJson[&quot;Options&quot;].Count() &lt; 1)
                return null; //Dynamic grid not found in Input XML

            JsonArray options = (JsonArray)checklistJson[&quot;Options&quot;];
            if (options != null &amp;&amp; options.Count &gt; columnIndex)
                return ((JsonObject)options[columnIndex]).Values.First().ReadAs&lt;string&gt;();
            else
                return &quot;&quot;;
        }

        private JsonObject GetCheckList(JsonArray groups, int rowIndex)
        {
            int checkedCL = 0;
            foreach (JsonObject group in groups)
            {
                if (group[&quot;Checklists&quot;].Count() + checkedCL &lt;= rowIndex)
                {
                    checkedCL += group[&quot;Checklists&quot;].Count();
                    continue;
                }
                else
                    return (JsonObject)((JsonArray)group[&quot;Checklists&quot;])[rowIndex - checkedCL];
            }
            return null;
        }


        public override object BeginRendering(Form form)
        {
            MasterDoc = new JsonObject();
            base.BeginRendering(form);
            GridAttachments = new JsonArray();
            MasterDoc.Add(&quot;GridAttachments&quot;, GridAttachments);
            return (MasterDoc);
        }

        public override void EndRendering(Form form)
        {
            base.EndRendering(form);
        }


        public JsonArray GetControlXMLNode(DataBaseContainer dBContainer)
        {
            var xdoc = new JsonObject();
            xdoc = (JsonObject)JsonValue.Parse(DataSource.ToString());
            return (JsonArray)xdoc[GetContainerName(dBContainer)];
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[23,9,23,40,1],[28,15,28,26,1],[29,9,29,10,1],[30,13,30,32,1],[31,13,31,38,1],[32,13,32,38,1],[33,13,33,37,1],[34,13,34,29,1],[35,13,35,41,1],[36,13,36,34,1],[39,9,39,10,1],[42,9,42,10,1],[43,13,43,42,1],[45,13,45,46,1],[46,13,46,14,0],[47,17,47,56,0],[48,17,48,55,0],[49,17,49,34,0],[50,21,50,60,0],[51,17,51,52,0],[52,17,52,33,0],[53,13,53,14,0],[55,17,55,33,1],[57,13,57,47,1],[58,9,58,10,1],[61,9,61,10,1],[62,13,62,55,1],[63,13,63,84,1],[64,13,64,40,1],[66,13,66,28,1],[67,9,67,10,1],[70,9,70,10,1],[71,13,71,55,1],[72,13,72,181,1],[73,13,74,61,1],[75,17,75,57,0],[76,18,78,60,1],[79,17,79,69,1],[80,18,81,62,1],[82,17,82,57,1],[84,17,84,44,1],[88,13,88,28,1],[89,9,89,10,1],[92,9,92,10,1],[93,13,93,55,1],[94,13,94,85,1],[95,13,95,40,1],[97,13,97,28,1],[98,9,98,10,1],[101,9,101,10,1],[102,13,102,49,1],[104,13,104,40,1],[105,13,105,75,1],[106,17,106,38,1],[108,13,108,20,1],[108,22,108,40,1],[108,41,108,43,1],[108,44,108,57,1],[109,13,109,14,1],[110,17,110,61,1],[111,21,113,86,1],[115,21,115,75,1],[118,17,118,71,1],[119,13,119,14,1],[124,13,124,27,1],[125,9,125,10,1],[128,9,128,10,1],[129,13,129,55,1],[130,13,130,59,1],[132,13,132,56,1],[133,13,133,60,1],[134,13,134,57,1],[135,13,135,57,1],[136,13,136,58,1],[137,13,137,54,1],[138,13,138,58,1],[139,13,139,69,1],[140,13,140,57,1],[141,13,141,59,1],[142,13,142,58,1],[143,13,143,65,1],[144,13,144,57,1],[145,13,145,59,1],[146,13,146,53,1],[148,13,148,62,1],[149,13,149,73,1],[150,13,150,57,1],[151,13,151,61,1],[153,13,153,63,1],[154,13,154,54,1],[155,13,155,58,1],[156,13,156,62,1],[157,13,157,56,1],[159,13,159,63,1],[160,13,160,110,1],[161,13,161,89,1],[162,9,162,10,1],[165,9,165,10,0],[166,13,166,55,0],[167,13,168,59,0],[169,13,169,28,0],[170,13,170,38,0],[170,38,170,66,0],[170,66,170,90,0],[170,13,170,90,0],[171,13,171,46,0],[173,13,173,178,0],[175,13,175,31,0],[176,13,176,14,0],[177,17,177,24,0],[177,26,177,39,0],[177,40,177,42,0],[177,43,177,48,0],[178,17,178,18,0],[180,21,180,44,0],[181,21,181,48,0],[182,21,182,52,0],[183,21,183,52,0],[184,21,184,43,0],[185,21,185,47,0],[186,21,186,45,0],[187,21,187,49,0],[188,21,188,59,0],[189,21,189,110,0],[190,21,190,51,0],[196,21,196,173,0],[198,21,198,98,0],[199,21,199,118,0],[200,21,200,148,0],[206,21,206,59,0],[207,21,207,97,0],[208,21,208,108,0],[209,21,209,22,0],[210,25,210,32,0],[210,34,210,53,0],[210,54,210,56,0],[210,57,210,80,0],[211,25,211,26,0],[212,29,212,73,0],[215,29,215,85,0],[216,29,216,62,0],[218,29,218,78,0],[219,29,219,97,0],[222,29,222,36,0],[222,38,222,53,0],[222,54,222,56,0],[222,57,222,65,0],[223,29,223,30,0],[226,33,226,67,0],[227,33,227,95,0],[228,33,228,97,0],[229,33,229,60,0],[231,33,231,61,0],[232,33,232,63,0],[233,33,233,52,0],[234,29,234,30,0],[236,29,240,60,0],[241,25,241,26,0],[242,21,242,22,0],[243,21,243,52,0],[245,21,245,35,0],[246,21,246,46,0],[247,17,247,18,0],[248,13,248,14,0],[251,13,251,39,0],[253,13,253,38,0],[254,9,254,10,0],[258,9,258,10,0],[259,13,259,55,0],[260,13,261,59,0],[262,13,262,28,0],[263,13,263,38,0],[263,38,263,66,0],[263,66,263,90,0],[263,13,263,90,0],[264,13,264,46,0],[266,13,266,178,0],[268,13,268,31,0],[269,13,269,14,0],[270,17,270,24,0],[270,26,270,39,0],[270,40,270,42,0],[270,43,270,48,0],[271,17,271,18,0],[273,21,273,44,0],[274,21,274,48,0],[275,21,275,52,0],[276,21,276,52,0],[277,21,277,43,0],[278,21,278,47,0],[279,21,279,45,0],[280,21,280,49,0],[281,21,281,59,0],[282,21,282,110,0],[283,21,283,51,0],[289,21,289,173,0],[291,21,291,98,0],[292,21,292,118,0],[293,21,293,148,0],[295,21,295,59,0],[296,21,296,97,0],[297,21,297,108,0],[298,21,298,22,0],[299,25,299,32,0],[299,34,299,53,0],[299,54,299,56,0],[299,57,299,80,0],[300,25,300,26,0],[301,29,301,73,0],[304,29,304,85,0],[305,29,305,62,0],[307,29,307,78,0],[308,29,308,97,0],[311,29,311,36,0],[311,38,311,53,0],[311,54,311,56,0],[311,57,311,65,0],[312,29,312,30,0],[313,33,313,67,0],[317,33,317,95,0],[318,33,318,97,0],[319,33,319,60,0],[321,33,321,61,0],[322,33,322,63,0],[323,33,323,52,0],[324,29,324,30,0],[326,29,330,60,0],[331,25,331,26,0],[332,21,332,22,0],[333,21,333,52,0],[335,21,335,35,0],[336,21,336,46,0],[337,17,337,18,0],[338,13,338,14,0],[343,13,343,38,0],[344,9,344,10,0],[347,9,347,10,1],[348,13,348,67,1],[350,13,350,56,1],[351,13,351,60,1],[352,13,352,57,1],[353,13,353,57,1],[354,13,354,58,1],[355,13,355,106,1],[356,13,356,110,1],[357,13,357,109,1],[358,13,358,14,1],[359,13,359,57,1],[360,13,360,59,1],[361,13,361,58,1],[362,13,362,65,1],[363,13,363,57,1],[364,13,364,59,1],[365,13,365,53,1],[367,13,367,62,1],[368,13,368,73,1],[369,13,369,57,1],[370,13,370,61,1],[372,13,372,116,1],[373,13,373,54,1],[374,13,374,58,1],[375,13,375,62,1],[376,13,376,56,1],[378,13,378,63,1],[380,13,380,53,1],[381,13,382,76,1],[383,9,383,10,1],[386,9,386,10,0],[387,13,387,68,0],[388,13,388,91,0],[389,13,390,52,0],[391,13,391,56,0],[392,13,392,79,0],[393,13,393,59,0],[394,13,394,55,0],[395,13,395,32,0],[396,13,397,28,0],[398,13,398,35,0],[399,17,399,57,0],[401,13,401,45,0],[402,13,402,14,0],[403,17,403,51,0],[404,17,404,24,0],[404,26,404,37,0],[404,38,404,40,0],[404,41,404,58,0],[405,17,405,18,0],[406,21,406,62,0],[407,21,407,56,0],[409,21,410,118,0],[414,21,414,93,0],[415,21,415,22,0],[416,25,416,68,0],[417,29,417,48,0],[418,30,418,72,0],[419,29,419,48,0],[420,21,420,22,0],[422,21,422,64,0],[423,21,423,59,0],[424,21,424,76,0],[427,21,428,66,0],[430,21,430,79,0],[431,21,431,22,0],[432,25,433,43,0],[434,21,434,22,0],[437,21,438,74,0],[439,21,440,63,0],[442,21,442,33,0],[443,21,443,22,0],[444,25,445,68,0],[446,21,446,22,0],[448,21,448,44,0],[449,17,449,18,0],[450,13,450,14,0],[452,13,452,23,0],[453,9,453,10,0],[456,9,456,10,1],[459,9,459,10,1],[462,9,462,10,1],[463,13,463,73,1],[464,13,464,70,1],[465,13,465,74,1],[466,13,466,75,1],[467,13,467,75,1],[468,13,468,71,1],[469,13,469,75,1],[470,13,470,74,1],[471,13,471,74,1],[472,13,472,76,1],[473,13,473,75,1],[474,13,474,79,1],[475,13,475,90,1],[476,13,476,82,1],[477,13,477,76,1],[478,13,478,78,1],[479,13,479,71,1],[480,13,480,74,1],[481,13,481,79,1],[482,13,482,80,1],[483,13,483,74,1],[484,13,484,80,1],[485,9,485,10,1],[488,9,488,10,1],[489,13,489,41,1],[490,13,490,71,1],[491,13,491,45,1],[492,13,492,78,1],[493,13,493,75,1],[494,13,494,14,1],[496,17,496,54,1],[497,17,497,18,1],[498,21,498,60,1],[500,13,500,14,0],[502,13,504,29,1],[508,9,508,10,1],[513,9,513,10,1],[514,13,514,54,1],[515,13,515,44,1],[516,13,516,14,1],[517,17,517,48,1],[518,17,518,68,1],[519,17,519,68,1],[521,17,521,45,1],[522,17,522,75,1],[523,17,523,75,1],[524,17,524,46,1],[525,17,525,36,1],[526,21,526,118,0],[528,21,528,102,1],[531,13,531,14,0],[532,17,532,45,0],[533,17,533,75,0],[534,17,534,101,0],[535,17,535,47,0],[537,9,537,10,1],[540,9,540,10,1],[541,13,541,40,1],[542,13,542,93,1],[544,13,545,61,1],[546,13,546,14,1],[547,17,547,82,1],[548,17,548,41,1],[549,13,549,14,1],[551,13,551,80,1],[552,13,552,35,1],[553,13,553,52,1],[554,17,554,77,1],[556,13,556,29,1],[557,9,557,10,1],[560,9,560,10,0],[561,13,561,41,0],[562,13,562,71,0],[563,13,563,79,0],[564,9,564,10,0],[567,9,567,10,1],[568,13,568,58,1],[569,17,569,66,1],[571,17,571,39,0],[572,9,572,10,1],[575,9,575,10,1],[577,13,577,48,1],[578,13,578,71,1],[579,13,579,95,1],[580,13,580,74,1],[582,13,582,84,1],[583,13,583,14,1],[585,17,585,48,1],[586,17,586,18,1],[587,21,587,55,1],[590,17,590,60,1],[591,17,591,18,1],[592,21,592,60,1],[595,13,595,14,0],[597,13,597,94,1],[598,13,598,14,0],[599,17,600,75,0],[601,13,601,14,0],[604,13,604,125,1],[605,13,605,14,1],[606,17,606,36,1],[607,13,607,14,1],[609,13,609,46,1],[610,13,610,14,0],[611,17,612,75,0],[613,13,613,14,0],[615,13,615,32,1],[616,9,616,10,1],[619,9,619,10,1],[620,13,620,58,1],[621,13,621,14,1],[622,17,622,82,1],[623,17,623,31,1],[624,21,624,39,1],[625,13,625,14,1],[626,9,626,10,1],[629,9,629,10,1],[630,13,630,53,1],[631,13,631,14,1],[632,17,632,45,1],[633,17,633,75,1],[634,17,634,55,1],[636,17,636,46,1],[637,13,637,14,1],[640,13,640,14,0],[641,17,641,45,0],[642,17,642,74,0],[643,17,643,55,0],[645,17,645,34,0],[646,13,646,14,0],[647,9,647,10,1],[651,9,651,10,1],[652,13,652,49,1],[653,13,653,40,1],[654,13,654,75,1],[655,17,655,38,1],[660,13,660,20,1],[660,22,660,35,1],[660,36,660,38,1],[660,39,660,52,1],[661,13,661,14,1],[663,17,663,56,1],[664,21,666,76,1],[668,21,668,65,1],[670,17,670,86,1],[673,13,673,14,1],[675,13,675,20,1],[675,22,675,41,1],[675,42,675,44,1],[675,45,675,60,1],[676,17,676,60,1],[677,9,677,10,1],[680,9,680,10,1],[681,13,681,49,1],[682,13,682,40,1],[683,13,683,75,1],[684,17,684,38,1],[689,13,689,20,1],[689,22,689,35,0],[689,36,689,38,1],[689,39,689,52,1],[690,13,690,14,0],[692,17,692,56,0],[693,21,695,76,0],[697,21,697,65,0],[699,17,699,86,0],[702,13,702,14,0],[704,13,704,20,1],[704,22,704,41,1],[704,42,704,44,1],[704,45,704,60,1],[705,17,705,60,1],[706,9,706,10,1],[709,9,709,10,0],[710,13,710,51,0],[712,13,712,38,0],[714,13,714,37,0],[715,17,715,24,0],[717,13,717,49,0],[718,13,718,32,0],[719,13,719,47,0],[720,13,720,46,0],[721,13,721,45,0],[722,13,722,14,0],[723,17,723,54,0],[724,17,724,36,0],[725,17,725,45,0],[726,17,726,24,0],[726,26,726,36,0],[726,37,726,39,0],[726,40,726,68,0],[727,17,727,18,0],[728,21,728,22,0],[729,25,729,96,0],[730,25,730,47,0],[731,21,731,22,0],[732,21,732,34,0],[733,17,733,18,0],[734,17,734,30,0],[735,13,735,14,0],[737,17,737,24,0],[737,26,737,35,0],[737,36,737,38,0],[737,39,737,55,0],[738,17,738,18,0],[739,21,739,58,0],[740,21,740,40,0],[741,21,741,49,0],[742,21,742,28,0],[742,30,742,40,0],[742,41,742,43,0],[742,44,742,72,0],[743,21,743,22,0],[745,25,745,26,0],[746,29,747,76,0],[748,29,748,51,0],[749,25,749,26,0],[750,25,750,38,0],[751,21,751,22,0],[752,21,752,34,0],[753,17,753,18,0],[754,13,754,27,0],[755,13,755,30,0],[756,9,756,10,0],[759,9,759,10,1],[760,13,760,51,1],[762,13,762,38,1],[764,13,764,49,1],[766,13,766,41,1],[767,13,767,52,1],[768,13,768,38,1],[769,13,769,14,1],[770,17,770,66,1],[771,17,771,88,1],[772,13,772,14,1],[774,13,774,14,0],[779,13,779,14,0],[781,13,781,37,1],[782,13,782,14,0],[784,17,784,24,0],[787,13,787,14,1],[788,17,788,56,1],[789,17,789,92,1],[790,13,790,14,1],[793,13,793,20,1],[793,22,793,35,1],[793,36,793,38,1],[793,39,793,68,1],[794,13,794,14,1],[795,17,795,40,1],[796,21,796,79,1],[798,21,798,90,1],[799,13,799,14,1],[800,13,800,41,1],[801,17,801,56,1],[805,13,805,46,1],[806,13,806,60,1],[807,13,807,62,1],[808,13,808,14,0],[809,17,809,51,0],[810,17,810,24,0],[810,26,810,36,0],[810,37,810,39,0],[810,40,810,54,0],[811,17,811,18,0],[812,21,812,65,0],[813,21,813,22,0],[814,25,814,72,0],[815,21,815,22,0],[817,21,817,22,0],[818,25,818,74,0],[819,25,819,62,0],[820,21,820,22,0],[821,17,821,18,0],[822,17,822,31,0],[823,17,823,24,0],[823,26,823,47,0],[823,48,823,50,0],[823,51,823,89,0],[824,21,824,55,0],[825,13,825,14,0],[827,17,827,24,1],[827,26,827,35,0],[827,36,827,38,1],[827,39,827,64,1],[828,17,828,18,0],[829,21,829,55,0],[830,21,830,28,0],[830,30,830,40,0],[830,41,830,43,0],[830,44,830,58,0],[831,21,831,22,0],[832,25,832,69,0],[833,25,833,26,0],[834,29,834,43,0],[835,29,835,30,0],[836,33,836,70,0],[837,33,837,34,0],[838,37,838,76,0],[839,37,839,181,0],[840,33,840,34,0],[842,33,842,34,0],[843,37,843,52,0],[844,37,844,75,0],[845,37,845,198,0],[846,37,846,56,0],[847,33,847,34,0],[848,29,848,30,0],[850,29,850,76,0],[851,25,851,26,0],[853,25,853,26,0],[854,29,855,90,0],[856,29,856,66,0],[857,25,857,26,0],[858,21,858,22,0],[859,21,859,35,0],[860,21,860,28,0],[860,30,860,51,0],[860,52,860,54,0],[860,55,860,93,0],[861,25,861,59,0],[862,17,862,18,0],[864,13,864,30,1],[865,9,865,10,1],[868,9,868,10,0],[869,13,869,48,0],[871,13,871,37,0],[871,38,871,45,0],[873,13,873,38,0],[875,13,875,49,0],[876,13,876,29,0],[878,13,878,29,0],[879,13,879,54,0],[881,13,881,48,0],[882,13,882,46,0],[884,13,884,57,0],[886,13,886,32,0],[887,13,887,38,0],[888,13,888,20,0],[888,22,888,31,0],[888,32,888,34,0],[888,35,888,67,0],[889,13,889,14,0],[890,17,890,53,0],[891,17,891,45,0],[893,17,893,56,0],[894,17,894,53,0],[896,17,896,35,0],[899,17,899,24,0],[899,26,899,43,0],[899,44,899,46,0],[899,47,899,81,0],[900,17,900,18,0],[901,21,901,61,0],[902,21,902,71,0],[903,21,903,60,0],[905,21,905,57,0],[906,21,906,55,0],[908,21,908,47,0],[910,21,910,65,0],[911,21,911,111,0],[912,21,912,68,0],[913,21,913,60,0],[915,21,916,98,0],[917,25,917,113,0],[919,25,919,47,0],[921,21,921,61,0],[922,21,922,94,0],[923,21,923,44,0],[925,21,925,28,0],[925,30,925,40,0],[925,41,925,43,0],[925,44,925,58,0],[926,21,926,22,0],[927,25,927,62,0],[928,25,928,45,0],[930,25,930,93,0],[931,25,931,26,0],[932,29,932,70,0],[933,33,933,80,0],[935,29,935,30,0],[936,33,936,72,0],[937,33,937,71,0],[938,29,938,30,0],[939,25,939,26,0],[941,29,941,45,0],[942,25,943,52,0],[944,21,944,22,0],[946,21,946,31,0],[947,21,947,40,0],[948,17,948,18,0],[949,17,949,30,0],[950,13,950,14,0],[951,9,951,10,0],[954,9,954,10,0],[955,9,955,10,0],[958,9,958,10,1],[959,13,959,115,1],[960,13,960,111,1],[961,13,962,73,1],[963,13,963,114,1],[964,13,964,112,1],[965,13,965,121,1],[966,13,967,76,1],[968,13,968,107,1],[969,13,969,109,1],[970,9,970,10,1],[973,9,973,10,0],[974,13,974,20,0],[974,22,974,42,0],[974,43,974,45,0],[974,46,974,61,0],[975,13,975,14,0],[976,17,976,69,0],[977,13,977,14,0],[978,9,978,10,0],[981,9,981,10,0],[982,13,982,20,0],[982,22,982,41,0],[982,42,982,44,0],[982,45,982,60,0],[983,17,983,38,0],[983,39,983,82,0],[984,9,984,10,0],[987,9,987,10,1],[988,9,988,10,1],[991,9,991,10,1],[992,13,992,121,1],[993,13,993,119,1],[994,13,995,81,1],[996,9,996,10,1],[1000,9,1000,10,1],[1001,13,1001,52,1],[1002,13,1002,49,1],[1004,13,1004,55,1],[1006,13,1006,48,1],[1006,49,1006,61,1],[1008,13,1008,39,1],[1009,13,1009,14,1],[1010,17,1010,41,1],[1012,17,1013,79,1],[1014,17,1014,18,0],[1015,21,1015,83,0],[1016,21,1018,100,0],[1019,17,1019,18,0],[1021,17,1021,18,1],[1023,21,1023,83,1],[1024,21,1024,83,1],[1027,21,1029,57,1],[1030,21,1030,22,0],[1031,25,1031,50,0],[1032,21,1032,22,0],[1033,17,1033,18,1],[1034,17,1034,36,1],[1037,17,1037,29,1],[1038,9,1038,10,1],[1041,9,1041,10,0],[1042,13,1042,51,0],[1043,13,1043,53,0],[1044,13,1044,54,0],[1045,13,1045,45,0],[1047,13,1047,55,0],[1049,13,1049,34,0],[1050,17,1050,46,0],[1052,13,1052,14,0],[1053,17,1053,37,0],[1054,17,1054,18,0],[1055,21,1055,89,0],[1057,21,1057,67,0],[1058,21,1058,60,0],[1059,21,1059,107,0],[1060,21,1060,22,0],[1061,25,1061,44,0],[1062,21,1062,22,0],[1063,21,1063,34,0],[1066,17,1066,18,0],[1067,21,1067,42,0],[1068,21,1068,22,0],[1069,25,1069,35,0],[1072,21,1072,22,0],[1073,25,1073,37,0],[1077,9,1077,10,0],[1080,9,1080,10,0],[1081,13,1081,53,0],[1082,13,1082,47,0],[1084,13,1084,41,0],[1085,13,1085,71,0],[1087,13,1087,95,0],[1089,13,1089,71,0],[1091,13,1091,79,0],[1092,17,1092,29,0],[1094,13,1094,69,0],[1095,13,1095,64,0],[1096,17,1096,91,0],[1098,17,1098,27,0],[1099,9,1099,10,0],[1102,9,1102,10,0],[1103,13,1103,31,0],[1104,13,1104,20,0],[1104,22,1104,38,0],[1104,39,1104,41,0],[1104,42,1104,48,0],[1105,13,1105,14,0],[1106,17,1106,73,0],[1107,17,1107,18,0],[1108,21,1108,62,0],[1109,21,1109,30,0],[1112,21,1112,95,0],[1114,13,1114,25,0],[1115,9,1115,10,0],[1119,9,1119,10,1],[1120,13,1120,42,1],[1121,13,1121,39,1],[1122,13,1122,47,1],[1123,13,1123,63,1],[1124,13,1124,32,1],[1125,9,1125,10,1],[1128,9,1128,10,1],[1129,13,1129,37,1],[1130,9,1130,10,1],[1134,9,1134,10,1],[1135,13,1135,41,1],[1136,13,1136,71,1],[1137,13,1137,67,1],[1138,9,1138,10,1]]);
    </script>
  </body>
</html>