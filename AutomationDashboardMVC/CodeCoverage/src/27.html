<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Construction Vertical\Main Modules\Budget Manager\Business Layer\ConcreateModels\BudgetRevisionItemsListModel.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core.AbstractModels;
using Aurigo.AMP3.Core.BusinessLayer.BL;
using Aurigo.AMP3.Core.BusinessLayer.DTO;
using Aurigo.AMP3.Core.UserControls;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.Brix.Construction.BudgetManager.BusinessLayer.BL;
using Aurigo.Brix.Core.WebUiHelper;
using Aurigo.Brix.Platform.BusinessLayer.BL;
using Aurigo.Brix.Platform.BusinessLayer.UserControls;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Infragistics.WebUI.UltraWebGrid.ExcelExport;
using System;
using System.Collections.Generic;
using System.Data;
using System.Globalization;
using System.Linq;
using System.Text;
using System.Web;
using System.Web.Script.Serialization;
using System.Web.UI;
using System.Web.UI.WebControls;

namespace Aurigo.Brix.Construction.BudgetManager.BusinessLayer.ConcreateModels
{
    [ItemListModelContext(Name = &quot;BDGTREV&quot;)]
    public class BudgetRevisionItemsListModel : ItemListModel
    {
        #region Private Fields

        private Dictionary&lt;string, string&gt; _activeModulesDictionary = null;
        private List&lt;string&gt; _coreModuleComponents = null;
        private bool? _isWorkflowAssociated;
        private string _status = String.Empty;
        private HiddenField hdnBDGPickerSelectedRows;
        private List&lt;string&gt; _budgetManagementModuleComponents = null;
        private ApplyInflation applyInflation;
        private DataRow _grantManagementModuleDetails = null;
        private ApplyGrantRule applyGrantRule;

        #endregion

        #region Private Properties

        private DataRow GrantManagementModuleDetails
        {
            get
            {
                if (_grantManagementModuleDetails == null)
                    _grantManagementModuleDetails = ModuleManager.Instance.GetModuleDetails(Constants.MODID_GRTMGMT, ConnectionHelper.GetCurrentCompany());

                return _grantManagementModuleDetails;
            }
        }

        #endregion        

        #region Public Properties

        public override List&lt;MenuGroup&gt; MenuGroups
        {
            get
            {
                List&lt;MenuGroup&gt; menuGroups = base.MenuGroups;
                if (displayNewCO)
                {
                    MenuGroup generalGroup = menuGroups.Find(mg =&gt; mg.Title == GROUP_GENERAL);
                    if (generalGroup == null)
                    {
                        generalGroup = new MenuGroup(GROUP_GENERAL);
                        menuGroups.Insert(0, generalGroup);
                    }
                    var newMenuCO = new MenuButton(&quot;lnkNewCO&quot;, &quot;New&quot;, &quot;Icn_New.png&quot;);
                    newMenuCO.AddSubMenu(new TextIcon(&quot;lnkAddCOItem&quot;,
                                                        &quot;Add &quot; + GlobalizationUtility.SetResource(&quot;Item&quot;, false),
                                                        &quot;Icn_New_16.png&quot;));
                    newMenuCO.AddSubMenu(new TextIcon(&quot;lnkModifyExistingItem&quot;,
                                                        &quot;Modify Existing &quot; +
                                                        GlobalizationUtility.SetResource(&quot;Item&quot;, false), &quot;Icn_Edit_16.png&quot;));
                    newMenuCO.AddSubMenu(new TextIcon(&quot;lnkDeleteExistingItem&quot;,
                                                        &quot;Delete Existing &quot; +
                                                        GlobalizationUtility.SetResource(&quot;Item&quot;, false), &quot;Icn_Delete.png&quot;));
                    newMenuCO.AddSubMenu(new TextIcon(&quot;lnkNewContainer&quot;,
                                                        &quot;New &quot; + LocalizationManager.GetString(&quot;Container&quot;), &quot;Icn_Folder_16.png&quot;,
                                                         showRedirectConfirmMessage: true));

                    generalGroup.AddMenu(newMenuCO);
                }

                MenuGroup itemDetailGroup = menuGroups.Find(mg =&gt; mg.Title == GlobalizationUtility.SetResource(&quot;Item&quot;, false) + &quot; Details&quot;);
                if (itemDetailGroup == null)
                {
                    itemDetailGroup = new MenuGroup(GlobalizationUtility.SetResource(&quot;Item&quot;, false) + &quot; Details&quot;);
                    //menuGroups.Add(itemDetailGroup);
                    menuGroups.Insert((menuGroups.Count &gt; 1) ? 1 : menuGroups.Count, itemDetailGroup);
                }

                if (ActiveModules.ContainsKey(Constants.MODID_PLANING))
                {
                    if (!Mode.HasFlag(ModeTypes.View))
                        itemDetailGroup.AddMenu(new TextIcon(&quot;lnkAddWP&quot;, &quot;Add WPs&quot;, &quot;Icn_Reorder_16.png&quot;, showRedirectConfirmMessage: true));
                }

                if (Status() == &quot;Draft&quot;)
                {
                    if (!Mode.HasFlag(ModeTypes.View))
                        itemDetailGroup.AddMenu(new TextIcon(&quot;lnkRefLineNo&quot;, &quot;Refresh Line Number&quot;, &quot;Icn_MSPSync_16.png&quot;));
                }

                if (itemDetailGroup.Menus.Count == 0)
                    menuGroups.Remove(itemDetailGroup);

                //List&lt;MenuGroup&gt; menuGroups = base.MenuGroups;
                MenuGroup OthersGroup = menuGroups.Find(mg =&gt; mg.Title == &quot;Others&quot;);
                if (OthersGroup != null)
                {
                    if (BudgetManagementModuleComponents != null &amp;&amp; BudgetModuleComponent.Contains(&quot;EnableCostInflation&quot;))
                    {
                        OthersGroup.AddMenu(new TextIcon(&quot;lnkInflationRule&quot;, &quot;Associate Inflation Rule&quot;, &quot;icon_inflation.png&quot;, validateSelection: ValidateSelection.OneOrMoreItemsAndContainers,
                           showRedirectConfirmMessage: true));
                    }

                    if (GrantManagementModuleDetails != null &amp;&amp; GrantManagementModuleDetails.Table.Columns.Contains(&quot;IsActive&quot;) &amp;&amp; GrantManagementModuleDetails[&quot;IsActive&quot;].ToBoolean2())
                    {
                        OthersGroup.AddMenu(new TextIcon(&quot;lnkGrantRule&quot;, &quot;Link Grant Rule&quot;, &quot;icon_grants.png&quot;, validateSelection: ValidateSelection.OneOrMoreItemsAndContainers,
                            showRedirectConfirmMessage: true));
                    }
                }

                return menuGroups;
            }
        }

        public override string ModuleId
        {
            get { return &quot;BDGTREV&quot;; }
        }

        public override string QueryStringName
        {
            get { return &quot;ID&quot;; }
        }

        public override string SkinID
        {
            get { return string.Empty; }
        }

        public override OtherAction[] TabDetails
        {
            get
            {
                var list = new List&lt;OtherAction&gt;();

                var action = new OtherAction();
                action.Name = &quot;Budget Estimate Revision Details&quot;;
                action.IsMainItem = false;
                string projectID = Request.QueryString[&quot;PID&quot;];
                string parentID = Request.QueryString[&quot;ParentID&quot;];
                string mode = Request.QueryString[&quot;mode&quot;];
                if (string.IsNullOrEmpty(mode)) mode = ModeTypes.Edit.ToString();
                action.Link = string.Format(CultureInfo.CurrentCulture,
                                            &quot;~/Common/BrixForm.aspx?Context=BDGTREV&amp;PID={0}&amp;ParentID={0}&amp;InstanceID={1}&amp;mode={2}&quot;,
                                            projectID, parentID, mode);
                list.Add(action);

                action = new OtherAction();
                action.Name = string.Format(&quot;Budget Estimate Revision {0}s&quot;, ItemNameAbbr);
                action.IsMainItem = true;
                list.Add(action);

                return list.ToArray();
            }
        }

        #endregion

        #region Private Properties

        private Dictionary&lt;string, string&gt; ActiveModules
        {
            get
            {
                if (_activeModulesDictionary == null)
                    _activeModulesDictionary = ModuleManager.Instance.GetModuleList();

                return _activeModulesDictionary;
            }
        }

        private List&lt;string&gt; CoreModuleComponents
        {
            get
            {
                if (_coreModuleComponents == null)
                    _coreModuleComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);

                return _coreModuleComponents;
            }
        }

        private bool IsWorkflow
        {
            get
            {
                if (!_isWorkflowAssociated.HasValue)
                {
                    _isWorkflowAssociated = false;
                    if (HttpContext.Current.CurrentHandler is BrixPageBase)
                    {
                        BrixPageBase pb = HttpContext.Current.CurrentHandler as BrixPageBase;
                        if (pb.IsWorkflowAssociated(ModuleId))
                        {
                            DataTable mappingDetails = BrixWorkflowManager.Instance.GetWorkflowMappingDetails(parentID.ToString(), ModuleId);
                            _isWorkflowAssociated = (mappingDetails.Rows.Count &gt; 0 &amp;&amp; !mappingDetails.Rows[0][&quot;WorkflowInstanceGuid&quot;].Equals(DBNull.Value));
                        }
                    }
                }
                return _isWorkflowAssociated.Value;
            }
        }

        private string LoadPicker { get; set; }

        private ModeTypes Mode
        {
            get
            {
                if (!string.IsNullOrEmpty(Request.QueryString[&quot;mode&quot;]))
                    return (ModeTypes)Enum.Parse(typeof(ModeTypes), Request.QueryString[&quot;mode&quot;], true);

                return ModeTypes.New;
            }
        }

        private List&lt;string&gt; BudgetManagementModuleComponents
        {
            get
            {
                if (_budgetManagementModuleComponents == null)
                    _budgetManagementModuleComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_BDGMGMT);

                return _budgetManagementModuleComponents;
            }
        }

        #endregion

        #region Public Methods

        public override void CustomizeToolBarMenu(ToolBar toolBar)
        {
            var lnkAddWP = toolBar.GetMenuReference(&quot;lnkAddWP&quot;);

            if (Mode.HasFlag(ModeTypes.View))
            {
                if (lnkAddWP != null)
                    lnkAddWP.Enabled = false;

                var lnkAddNew_Btn = toolBar.GetMenuReference(&quot;lnkAddNew&quot;);
                if (lnkAddNew_Btn != null &amp;&amp; Mode.HasFlag(ModeTypes.View))
                    lnkAddNew_Btn.Enabled = false;
            }
            else
            {
                if (lnkAddWP != null)
                {
                    InitializeTaskWPPicker();
                    lnkAddWP.OnClientClick = LoadPicker;
                }
            }

            if (BudgetManagementModuleComponents != null &amp;&amp; BudgetModuleComponent.Contains(&quot;EnableCostInflation&quot;))
            {
                Page pg = (HttpContext.Current.CurrentHandler as Page);
                applyInflation = (ApplyInflation)pg.LoadControl(@&quot;~\Modules\UserControls\ApplyInflation.ascx&quot;);
                pg.Form.Controls.Add(applyInflation);
                ModalPopupExtender PopupExtender = (ModalPopupExtender)pg.Master.FindControl(&quot;PopupExtender&quot;);
                PopupExtender.AddNewPopup(applyInflation.aspPnlInflation.ClientID,
                                          toolBar.GetMenuReference(&quot;lnkInflationRule&quot;).ClientID,
                                          applyInflation.btnCancel.ClientID, 250, 400, &quot;Apply Inflation Rule&quot;, &quot;if(!applyValidation()){return false;};&quot;, &quot;LoadInflationRuleData()&quot;);
            }

            if (GrantManagementModuleDetails != null &amp;&amp; GrantManagementModuleDetails.Table.Columns.Contains(&quot;IsActive&quot;) &amp;&amp; GrantManagementModuleDetails[&quot;IsActive&quot;].ToBoolean2())
            {
                Page pg = (HttpContext.Current.CurrentHandler as Page);
                applyGrantRule = (ApplyGrantRule)pg.LoadControl(@&quot;~\Modules\UserControls\ApplyGrantRule.ascx&quot;);
                pg.Form.Controls.Add(applyGrantRule);
                ModalPopupExtender PopupExtender = (ModalPopupExtender)pg.Master.FindControl(&quot;PopupExtender&quot;);
                PopupExtender.AddNewPopup(applyGrantRule.aspPnlGrantRule.ClientID,
                                          toolBar.GetMenuReference(&quot;lnkGrantRule&quot;).ClientID,
                                          applyGrantRule.btnCancel.ClientID, 150, 300, &quot;Apply Grant Rule&quot;, &quot;if(!applyValidation()){return false;};&quot;);
            }

            base.CustomizeToolBarMenu(toolBar);
        }

        public Control FindControlRecursive(Control root, string id)
        {
            if (root.ID == id)
                return root;

            return root.Controls.Cast&lt;Control&gt;()
               .Select(c =&gt; FindControlRecursive(c, id))
               .FirstOrDefault(c =&gt; c != null);
        }

        public override DataSet GetSchema()
        {
            throw new NotImplementedException();
        }

        public override DataSet GetList(int pageSize, string sortOrder, string filter, ref int currentPage, out int count)
        {
            DataSet ds = base.GetList(pageSize, sortOrder, filter, ref currentPage, out count);
            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0)
            {
                DataTable Items = ds.Tables[&quot;Items&quot;];
                decimal totalAmount = 0;

                for (int item = 0; item &lt; Items.Rows.Count; item++)
                {
                    if (Items.Rows[item][&quot;IsDeleted&quot;].ToString().Equals(&quot;D&quot;, StringComparison.CurrentCultureIgnoreCase))
                    {
                        totalAmount = totalAmount - Items.Rows[item][&quot;Amount&quot;].ToDecimal2();
                        Items.Rows[item][&quot;Amount&quot;] = -Items.Rows[item][&quot;Amount&quot;].ToDecimal2();
                    }
                    else
                    {
                        totalAmount = totalAmount + Items.Rows[item][&quot;Amount&quot;].ToDecimal2();
                    }
                }

                ds.Tables[&quot;ItemSummary&quot;].Rows[0][&quot;Total Amount&quot;] = totalAmount;
            }

            return ds;
        }

        public override void AfterSave(ItemListModel itemListModel)
        {
            base.AfterSave(itemListModel);

            BudgetManagementManager.Instance.UpdateBudgetEstimateRevisionTotal(parentID);
        }

        public override void HandleDelete(ItemTypes type, string ids)
        {
            if (type == ItemTypes.Container &amp;&amp; BudgetManagementManager.Instance.HasItems(ids))
            {
                throw new Exception(&quot;Selected container has items, Deletion not allowed&quot;);
            }
            else
            {
                base.HandleDelete(type, ids);
                BudgetManagementComponent.Instance.UpdateBudgetEstimateRevisionTotal(parentID);
            }
        }

        public override void HandleEdit(ItemTypes type, int id)
        {
            if (type == ItemTypes.Item)
            {
                Item itemDto = ItemManager.Instance.GetItemDetails(ModuleId, parentID, id);
                if (itemDto != null)
                {
                    if (itemDto.ReferenceItemType.Equals(&quot;M&quot;))
                    {
                        Response.Redirect(string.Format(CultureInfo.CurrentCulture,
                                                        &quot;BrixItemPage.aspx?Context={0}&amp;ItemID={1}&amp;Mode={2}&amp;ParentID={3}&amp;PID={4}&amp;COType=M&amp;COMode={5}&quot;,
                                                        ModuleId, id, ModeTypes.Edit.ToInt32_2(), parentID, Request[&quot;PID&quot;], Mode.ToString()), true);
                    }
                    else if (itemDto.ReferenceItemType.Equals(&quot;D&quot;))
                    {
                        Response.Redirect(string.Format(CultureInfo.CurrentCulture,
                                                        &quot;BrixItemPage.aspx?Context={0}&amp;ItemID={1}&amp;Mode={2}&amp;ParentID={3}&amp;PID={4}&amp;COType=D&amp;COMode={5}&quot;,
                                                        ModuleId, id, ModeTypes.Edit.ToInt32_2(), parentID, Request[&quot;PID&quot;], Mode.ToString()), true);
                    }
                }

                Response.Redirect(string.Format(CultureInfo.CurrentCulture,
                                                &quot;BrixItemPage.aspx?Context={0}&amp;ItemID={1}&amp;Mode={2}&amp;ParentID={3}&amp;PID={4}&amp;COType=N&amp;COMode={5}&quot;,
                                                ModuleId, id, ModeTypes.Edit.ToInt32_2(), parentID, Request[&quot;PID&quot;], Mode.ToString()), true);
            }
            else if (type == ItemTypes.Container)
                Response.Redirect(string.Format(CultureInfo.CurrentCulture,
                    &quot;BrixItemContainer.aspx?Context={0}&amp;ContainerID={1}&amp;Mode={2}&amp;ParentID={3}&amp;PID={4}&amp;COMode={5}&quot;,
                    ModuleId, id, Convert.ToInt32(ModeTypes.Edit, CultureInfo.CurrentCulture), parentID, Request[&quot;PID&quot;], Mode.ToString()), true);
        }

        public override string HandleMenuItem(string eventString)
        {
            string projectID = Request[&quot;PID&quot;];
            string parentID = Request[&quot;ParentID&quot;];
            if (string.IsNullOrEmpty(projectID) || string.IsNullOrEmpty(parentID))
                return &quot;Error in redirecting page.&quot;;

            if (eventString.Contains(&quot;Modify Existing &quot;))
            {
                Response.Redirect(string.Format(CultureInfo.CurrentCulture,
                                                &quot;BrixItemPage.aspx?context=BDGTREV&amp;PID={0}&amp;ParentID={1}&amp;COType={2}&amp;ContractID={3}&amp;COMode={4}&quot;,
                                                projectID, parentID, &quot;M&quot;, parentID, Mode.ToString()), true);
            }
            if (eventString.Contains(&quot;Delete Existing &quot;))
            {
                Response.Redirect(string.Format(CultureInfo.CurrentCulture,
                                                &quot;BrixItemPage.aspx?context=BDGTREV&amp;PID={0}&amp;ParentID={1}&amp;COType={2}&amp;ContractID={3}&amp;COMode={4}&quot;,
                                                projectID, parentID, &quot;D&quot;, parentID, Mode.ToString()), true);
            }
            else if (eventString == &quot;Flat List&quot;)
            {
                string url = &quot;~/Common/BrixListPage.aspx?&quot; + Request.QueryString;
                url = url.ToLower().Replace(&quot;context=bdgtrev&quot;, &quot;Context=FLATREV&quot;).Replace(&quot;mode=edit&quot;, &quot;mode=Edit&quot;);
                Response.Redirect(url);
            }
            else
            {
                return base.HandleMenuItem(eventString);
            }

            return string.Empty;
        }

        public override void HandleMenuItems(string eventString, UltraWebGridExcelExporter expGrid, string ids)
        {
            string LOC_Item = LocalizationManager.GetString(&quot;Item&quot;);

            if (eventString.Contains(&quot;Add &quot; + LOC_Item))
            {
                string queryString = string.Empty;
                if (!string.IsNullOrEmpty(Request[&quot;ProjectEstimateID&quot;]))
                    queryString = string.Format(CultureInfo.CurrentCulture, &quot;&amp;ProjectEstimateID={0}&quot;, Request[&quot;ProjectEstimateID&quot;]);

                HttpContext.Current.Server.Transfer(string.Format(CultureInfo.CurrentCulture,
                                               &quot;BrixItemPage.aspx?Context={0}&amp;ParentID={1}&amp;PID={2}&amp;COType=N&amp;ContainerID={3}{4}&amp;COMode={5}&quot;,
                                               &quot;BDGTREV&quot;, parentID, Request[&quot;PID&quot;], string.IsNullOrEmpty(ids) ? &quot;0&quot; : ids, queryString, Mode.ToString()), false);
            }
            else if (eventString.ToLower2().Equals(&quot;reorder&quot;))
            {
                string queryString = string.Empty;
                if (!string.IsNullOrEmpty(Request[&quot;ProjectEstimateID&quot;]))
                    queryString = string.Format(CultureInfo.CurrentCulture, &quot;&amp;ProjectEstimateID={0}&quot;,
                        Request[&quot;ProjectEstimateID&quot;]);

                HttpContext.Current.Server.Transfer(string.Format(CultureInfo.CurrentCulture,
                    &quot;BrixItemContainer.aspx?Context={0}&amp;ParentID={1}&amp;IsSc=1&amp;PID={2}{3}&amp;COMode={4}&quot;,
                    ModuleId, parentID, Request[&quot;PID&quot;], queryString, Mode.ToString()), false);
            }
            else
                base.HandleMenuItems(eventString, expGrid, ids);
        }


        public override void HandleView(ItemTypes type, int id)
        {
            string redirectUrl = string.Empty;
            if (type == ItemTypes.Item)
            {
                if (Request.Form[&quot;ctl00$C2$hdnReferenceItemType&quot;].Equals(&quot;M&quot;))
                {
                    redirectUrl = string.Format(CultureInfo.CurrentCulture,
                                                       &quot;BrixItemPage.aspx?Context={0}&amp;ItemID={1}&amp;Mode={2}&amp;ParentID={3}&amp;PID={4}&amp;ContractID={5}&quot;,
                                                       ModuleId, id, ModeTypes.View.ToInt32_2(), parentID, Request[&quot;PID&quot;], parentID);

                    if (!string.IsNullOrEmpty(Request[&quot;Mode&quot;]))
                        redirectUrl += &quot;&amp;COMode=&quot; + Mode.ToString();

                    redirectUrl += &quot;&amp;COType=M&quot;;
                }
                else
                {
                    redirectUrl = string.Format(CultureInfo.CurrentCulture,
                                                      &quot;BrixItemPage.aspx?Context={0}&amp;ItemID={1}&amp;Mode={2}&amp;ParentID={3}&amp;PID={4}&amp;ContractID={5}&quot;,
                                                      ModuleId, id, ModeTypes.View.ToInt32_2(), parentID, Request[&quot;PID&quot;], parentID);

                    if (!string.IsNullOrEmpty(Request[&quot;Mode&quot;]))
                        redirectUrl += &quot;&amp;COMode=&quot; + Mode.ToString();
                }

                Response.Redirect(redirectUrl, true);
            }
            else if (type == ItemTypes.Container)
            {
                redirectUrl = string.Format(CultureInfo.CurrentCulture,
                   &quot;BrixItemContainer.aspx?Context={0}&amp;ContainerID={1}&amp;Mode={2}&amp;ParentID={3}&amp;PID={4}&quot;,
                   ModuleId, id, Convert.ToInt32(ModeTypes.View, CultureInfo.CurrentCulture), parentID, Request[&quot;PID&quot;]);

                if (!string.IsNullOrEmpty(Request[&quot;Mode&quot;]))
                    redirectUrl += &quot;&amp;COMode=&quot; + Mode.ToString();

                Response.Redirect(redirectUrl, true);
            }

        }

        public override HierarchicalGridColumns HGridColumns()
        {
            HierarchicalGridColumns cols = base.HGridColumns();

            HierarchicalGridColumn GroupNameCol = cols.FindByColumnName(&quot;GroupName&quot;);
            if (GroupNameCol != null)
                cols.Remove(GroupNameCol);
            if (GrantManagementModuleDetails != null &amp;&amp; GrantManagementModuleDetails.Table.Columns.Contains(&quot;IsActive&quot;) &amp;&amp; GrantManagementModuleDetails[&quot;IsActive&quot;].ToBoolean2())
            {
                cols.Add(new HierarchicalGridColumn(&quot;GrantRuleName&quot;, 100, false, null, false, &quot;Grant Rule&quot;));
            }

            if (CoreModuleComponents.IsNotNullAndHasItems() &amp;&amp; CoreModuleComponents.Contains(Constants.ModuleComponent.EnableResourceManagement))
            {
                cols.Add(new HierarchicalGridColumn(&quot;Resources&quot;, 200, false));
            }


            //// Show columns related to Inflation module component if enabled
            if (BudgetManagementModuleComponents != null &amp;&amp; BudgetModuleComponent.Contains(&quot;EnableCostInflation&quot;))
            {
                cols.Add(new HierarchicalGridColumn(&quot;InflationRuleName&quot;, 100, false, null, false, &quot;Inflation Rule&quot;));
                cols.Add(new HierarchicalGridColumn(&quot;AnnualInflationRate&quot;, 100, false, null, true, &quot;Inflation Rate&quot;));
                cols.Add(new HierarchicalGridColumn(&quot;InflationEffectiveFrom&quot;, 100, false, AMP3ApplicationSettings.Instance.FORMAT_DATE, false, &quot;Effective From&quot;));
            }


            return cols;
        }

        public override void SetUIDetails()
        {
            displayTabs = true;

            //  DisplayWorkFlowAssociation = displayWorkFlowActionOnListPage = DisplayWorkFlowHistory = DisplayWorkFlowStatus = IsWorkflow;
            displayNew = false;
            displayOtherDropMenu = displayNewCO = displayTabs = displaySubItems = displayRateAnalysis = true;
            header = string.Format(&quot;Change Order {0}&quot;, ItemNameAbbr);

            if (Request != null
                &amp;&amp; Request.QueryString[&quot;mode&quot;] != null)
            {
                if (Request.QueryString[&quot;mode&quot;].Equals(ModeTypes.View.ToString2(), StringComparison.CurrentCultureIgnoreCase)
                    || Request.QueryString[&quot;mode&quot;].Equals(ModeTypes.View.ToInt32_2().ToString2()))
                {
                    displayOtherDropMenu =
                        enableEdit = enableNewCO = EnableDelete = displaySubItems = displayRateAnalysis = false;
                }
            }
            if (Status() == &quot;Draft&quot; &amp;&amp; Request.QueryString[&quot;mode&quot;] != null
                &amp;&amp; !Request.QueryString[&quot;mode&quot;].Equals(ModeTypes.View.ToString2(), StringComparison.CurrentCultureIgnoreCase))
            {
                DisplayReorder = true;
            }

            ShowFlatList = true;
            AllowGridEdit = false;
        }

        public string Status()
        {
            _status = BudgetManagementManager.Instance.GetBudgetEstimateRevisionStatus(parentID);
            return _status;
        }

        #endregion

        #region Private Methods

        private void CreateItemDTOFromHttpRequest(int ID)
        {
            DataSet ds = BudgetManagementManager.Instance.GetWPforBudgetItems(ID, Int32.Parse(Request.QueryString[&quot;ParentID&quot;], CultureInfo.CurrentCulture), true);
            string context = Request[&quot;Context&quot;].Trim();
            var DTO = new Item();

            if (ds.Tables.Count &gt; 1 &amp;&amp; ds.Tables[0].Rows.Count &gt; 0 &amp;&amp; ds.Tables[1].Rows.Count &gt; 0)
            {
                for (int i = 0; i &lt; ds.Tables[0].Rows.Count; i++)
                {
                    DTO.ItemID = null;
                    //DTO.AccountingCode = null;
                    DTO.Description = Convert.ToString(ds.Tables[0].Rows[i][&quot;Description&quot;]);
                    DTO.StandardItemNo = Convert.ToString(ds.Tables[0].Rows[i][&quot;Name&quot;]);
                    DTO.Notes = Convert.ToString(ds.Tables[0].Rows[i][&quot;Comment&quot;]);
                    DTO.UnitCost = Convert.ToDecimal(ds.Tables[0].Rows[i][&quot;EstimatedCost&quot;]);
                    DTO.UnitPrice = Convert.ToDecimal(ds.Tables[0].Rows[i][&quot;EstimatedCost&quot;]);
                    DTO.CreatedBy = UserDetail.GetCurrentUserDetail().UID;
                    DTO.BaseUnitCost = Convert.ToDecimal(ds.Tables[0].Rows[i][&quot;EstimatedCost&quot;]);
                    DTO.Quantity = 1;
                    DTO.ReferenceItemType = &quot;W&quot;;
                    DTO.ReferenceItemID = ID;
                    DTO.ParentInstanceID = Int32.Parse(Request.QueryString[&quot;ParentID&quot;], CultureInfo.CurrentCulture);
                    DTO.ModuleID = context;
                    DTO.Notes = Convert.ToString(ds.Tables[0].Rows[i][&quot;Comment&quot;]);
                    DTO.UnitID = Convert.ToInt32(ds.Tables[1].Rows[0][&quot;UnitId&quot;]);
                    DTO.ActivityCount = 0;
                    // DTO.AlternateID = null;
                    DTO.ContainerID = 0;
                    DTO.Unit = &quot;LS&quot;;
                    // DTO.AccountingCode = &quot;&quot;;
                    // start To do
                    //if (hdnReferenceItemID.Value.Length &gt; 0)
                    //    DTO.ReferenceItemID = Convert.ToInt32(hdnReferenceItemID.Value, CultureInfo.CurrentCulture);

                    // DTO.ContainerID = Convert.ToInt32(ds.Tables[2].Rows[0][&quot;ContainerID&quot;]);
                    DTO.GroupID = Convert.ToInt32(ds.Tables[4].Rows[0][&quot;GroupID&quot;]);
                    DTO.GroupName = Convert.ToString(ds.Tables[4].Rows[0][&quot;GroupName&quot;]);
                    DTO.Margin = 0;
                    DTO.Discount = 0;
                    DTO.OverheadCost = 0;
                    //End To do
                    Item ObjItemDetails = DTO;
                    ItemManager.Instance.SaveItemDetails(ObjItemDetails);
                }
            }
        }

        private List&lt;PickerColumnDetails&gt; GetWPGridColumns()
        {
            List&lt;PickerColumnDetails&gt; gridColumns = new List&lt;PickerColumnDetails&gt;();

            gridColumns.Add(new PickerColumnDetails { ColumnName = &quot;ID&quot;, Caption = &quot;ID&quot;, Hidden = true, Type = &quot;number&quot; });
            gridColumns.Add(new PickerColumnDetails { ColumnName = &quot;Name&quot;, Caption = &quot;Name&quot;, Hidden = false, Type = &quot;string&quot; });
            gridColumns.Add(new PickerColumnDetails { ColumnName = &quot;Description&quot;, Caption = &quot;Description&quot;, Hidden = false, Type = &quot;string&quot; });
            gridColumns.Add(new PickerColumnDetails { ColumnName = &quot;EstimatedCost&quot;, Caption = &quot;Estimated Cost&quot;, Hidden = false, Type = &quot;number&quot; });
            gridColumns.Add(new PickerColumnDetails { ColumnName = &quot;ProgramYear&quot;, Caption = &quot;Program Year&quot;, Hidden = false, Type = &quot;string&quot; });
            gridColumns.Add(new PickerColumnDetails { ColumnName = &quot;ProgramCategory&quot;, Caption = &quot;Program Category&quot;, Hidden = false, Type = &quot;string&quot; });
            return gridColumns;
        }

        private void InitializeTaskWPPicker()
        {
            Page page = HttpContext.Current.Handler as Page;
            Control ct = page.LoadControl(&quot;~/Modules/UserControls/PickerGrid.ascx&quot;);

            HiddenField controlHdnBDGPickerSelectedRows = (HiddenField)FindControlRecursive(page, &quot;hdnBDGPickerSelectedRows&quot;);
            if (controlHdnBDGPickerSelectedRows == null)
            {
                hdnBDGPickerSelectedRows = new HiddenField();
                hdnBDGPickerSelectedRows.ID = &quot;hdnBDGPickerSelectedRows&quot;;
                hdnBDGPickerSelectedRows.ClientIDMode = ClientIDMode.Static;
                page.Form.Controls.Add(hdnBDGPickerSelectedRows);
            }

            PickerGrid controlAddBudgetItems = (PickerGrid)FindControlRecursive(page, &quot;addBudgetRevisionWPItems&quot;);
            if (controlAddBudgetItems == null)
            {
                PickerGrid objGrid = (PickerGrid)ct;
                objGrid.InitializePicker(&quot;/api/GenericXMLPicker/&quot;, GetWPGridColumns(), &quot;ID&quot;);
                objGrid.ID = &quot;addBudgetRevisionWPItems&quot;;
                objGrid.EnableMultiSelect = true;
                objGrid.ButtonText = &quot;Add&quot;;
                objGrid.PageSize = 20;
                objGrid.PostBackAfterSelect = true;
                objGrid.BeforePickerLoadScript = &quot;&quot;;

                objGrid.TriggerButton.Style.Add(HtmlTextWriterStyle.Display, &quot;none&quot;);

                objGrid.AfterPickerSelectScript = &quot;$(&#39;#hdnBDGPickerSelectedRows&#39;).val(JSON.stringify({0}));&quot;;
                objGrid.OnItemSelected += new PickerGrid.SelectedItems(WPobjGrid_OnItemSelected);

                objGrid.OnGridLoad += new PickerGrid.GridLoad(WPobjGrid_OnGridLoad);

                objGrid.Title = &quot;Select Work Projects&quot;;

                LoadPicker = &quot;$(&#39;#&quot; + objGrid.TriggerButton.ClientID + &quot;&#39;).click();return false;&quot;;
                page.Form.Controls.Add(objGrid);
            }
        }

        private void WPobjGrid_OnGridLoad(PickerGrid grid)
        {
            StringBuilder parameters = new StringBuilder();
            parameters.Append(&quot;{&quot;);
            parameters.Append(&quot;\&quot;DataSource\&quot; : \&quot;_table:vw_WORKPRJMaster\&quot;&quot;);
            parameters.Append(&quot;,\&quot;WhereCond\&quot; : \&quot;&quot;);
            parameters.AppendFormat(&quot;      (PID @^ {0} OR PID @^ 0 ) &quot;, Request[&quot;PID&quot;]);
            parameters.AppendFormat(&quot;  AND ID not in (select id from vw_PLANINGWPItemsAssociation  where ParentInstanceID @^ {0} ) &quot;, parentID);
            parameters.AppendFormat(&quot;  AND ProgramCategory @^ (SELECT TOP 1 ProgramCategory FROM LibraryProgramCategory WHERE ID in ( SELECT TOP 1 ProjectClass FROM PROJECTProjectMain WHERE ProjectId @^ {0}) )&quot;, Request[&quot;PID&quot;]);
            parameters.AppendFormat(&quot;  AND BusinessUnitId IS NOT NULL AND BusinessUnitId @^ (SELECT TOP 1 BusinessUnitId FROM PROJECTProjectMain  WHERE ProjectId @^ {0} )&quot;, Request[&quot;PID&quot;]);
            parameters.Append(&quot;\&quot;&quot;);

            // and ParentID NOT IN @^ &quot; + ParentID +  &quot;\\&quot;);
            parameters.Append(&quot;}&quot;);

            grid.OptionalParamaters = grid.BuildOptionalParameters(parameters.ToString());
        }

        private void WPobjGrid_OnItemSelected(PickerGrid grid, List&lt;Dictionary&lt;string, object&gt;&gt; selectedRows)
        {
            try
            {
                //foreach (Dictionary&lt;string, object&gt; entry in selectedRows)
                //{
                //    string WPID = entry[&quot;ID&quot;].ToString();
                //              if (!string.IsNullOrEmpty(WPID))
                //                  ComponentHelper.Instance.ExecuteDataSet(BudgetManagementStoredProcedure.usp_PLANINGAddWPsToProjects, null, Request[&quot;PID&quot;], WPID.ToInt32_2());
                //}

                foreach (Dictionary&lt;string, object&gt; entry in selectedRows)
                {
                    string WPID = entry[&quot;ID&quot;].ToString();
                    if (!string.IsNullOrEmpty(WPID))
                        ComponentHelper.Instance.ExecuteDataSet(BudgetManagementStoredProcedure.usp_PLANINGAddWPsToProjects, null, Request[&quot;PID&quot;], WPID.ToInt32_2());
                    CreateItemDTOFromHttpRequest(WPID.ToInt32_2());
                }
                BudgetManagementManager.Instance.UpdateBudgetREVEstimateTotal(Request[&quot;ParentID&quot;].ToString().ToInt32_2());
                Response.Redirect(Request.Url.ToString2(), true);
            }
            catch (System.Exception ex)
            {
                Page page = HttpContext.Current.Handler as Page;
                JavaScriptSerializer JS = new JavaScriptSerializer();
                string errMessage = JS.Serialize(ex.Message.Replace(&quot;|&quot;, &quot;&lt;br/&gt;&quot;));
                page.ClientScript.RegisterStartupScript(GetType(), &quot;ShowAlert&quot;, &quot;ShowError(&quot; + errMessage + &quot;);&quot;, true);
            }
        }

        #endregion
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[33,9,33,76,1],[34,9,34,59,1],[36,9,36,47,1],[38,9,38,71,1],[40,9,40,62,1],[50,13,50,14,1],[51,17,51,59,1],[52,21,52,156,1],[54,17,54,54,1],[55,13,55,14,1],[65,13,65,14,1],[66,17,66,62,1],[67,17,67,34,1],[68,17,68,18,1],[69,21,69,68,1],[69,68,69,93,1],[69,93,69,95,1],[69,21,69,95,1],[70,21,70,46,1],[71,21,71,22,0],[72,25,72,69,0],[73,25,73,60,0],[74,21,74,22,0],[75,21,75,86,1],[76,21,78,76,1],[79,21,81,126,1],[82,21,84,125,1],[85,21,87,93,1],[89,21,89,53,1],[90,17,90,18,1],[92,17,92,67,1],[92,67,92,139,1],[92,139,92,141,1],[92,17,92,141,1],[93,17,93,45,1],[94,17,94,18,1],[95,21,95,115,1],[97,21,97,103,1],[98,17,98,18,1],[100,17,100,72,1],[101,17,101,18,1],[102,21,102,55,1],[103,25,103,142,1],[104,17,104,18,1],[106,17,106,41,1],[107,17,107,18,1],[108,21,108,55,1],[109,25,109,124,1],[110,17,110,18,1],[112,17,112,54,1],[113,21,113,56,1],[116,17,116,63,1],[116,63,116,83,1],[116,83,116,85,1],[116,17,116,85,1],[117,17,117,41,1],[118,17,118,18,1],[119,21,119,123,1],[120,21,120,22,1],[121,25,122,63,1],[123,21,123,22,1],[125,21,125,186,1],[126,21,126,22,0],[127,25,128,64,0],[129,21,129,22,0],[130,17,130,18,1],[132,17,132,35,1],[133,13,133,14,1],[138,17,138,18,1],[138,19,138,36,1],[138,37,138,38,1],[143,17,143,18,0],[143,19,143,31,0],[143,32,143,33,0],[148,17,148,18,0],[148,19,148,39,0],[148,40,148,41,0],[154,13,154,14,1],[155,17,155,52,1],[157,17,157,48,1],[158,17,158,66,1],[159,17,159,43,1],[160,17,160,63,1],[161,17,161,67,1],[162,17,162,59,1],[163,17,163,48,1],[163,49,163,82,1],[164,17,166,72,1],[167,17,167,34,1],[169,17,169,44,1],[170,17,170,92,1],[171,17,171,42,1],[172,17,172,34,1],[174,17,174,39,1],[175,13,175,14,1],[185,13,185,14,1],[186,17,186,54,1],[187,21,187,87,1],[189,17,189,49,1],[190,13,190,14,1],[196,13,196,14,1],[197,17,197,51,1],[198,21,198,111,1],[200,17,200,46,1],[201,13,201,14,1],[207,13,207,14,0],[208,17,208,53,0],[209,17,209,18,0],[210,21,210,51,0],[211,21,211,76,0],[212,21,212,22,0],[213,25,213,94,0],[214,25,214,63,0],[215,25,215,26,0],[216,29,216,142,0],[217,29,217,157,0],[218,25,218,26,0],[219,21,219,22,0],[220,17,220,18,0],[221,17,221,52,0],[222,13,222,14,0],[225,37,225,41,1],[225,42,225,46,1],[230,13,230,14,1],[231,17,231,72,1],[232,21,232,104,1],[234,17,234,38,1],[235,13,235,14,1],[241,13,241,14,1],[242,17,242,63,1],[243,21,243,126,1],[245,17,245,58,1],[246,13,246,14,1],[254,9,254,10,1],[255,13,255,65,1],[257,13,257,46,1],[258,13,258,14,1],[259,17,259,38,1],[260,21,260,46,0],[262,17,262,75,1],[263,17,263,75,1],[264,21,264,51,0],[265,13,265,14,1],[267,13,267,14,1],[268,17,268,38,1],[269,17,269,18,1],[270,21,270,46,1],[271,21,271,57,1],[272,17,272,18,1],[273,13,273,14,1],[275,13,275,115,1],[276,13,276,14,1],[277,17,277,72,1],[278,17,278,112,1],[279,17,279,54,1],[280,17,280,111,1],[281,17,283,181,1],[284,13,284,14,1],[286,13,286,178,1],[287,13,287,14,0],[288,17,288,72,0],[289,17,289,112,0],[290,17,290,54,0],[291,17,291,111,0],[292,17,294,150,0],[295,13,295,14,0],[297,13,297,48,1],[298,9,298,10,1],[301,9,301,10,1],[302,13,302,31,1],[303,17,303,29,1],[305,13,306,29,1],[306,29,306,56,1],[306,56,307,37,1],[307,37,307,46,1],[307,46,307,48,1],[305,13,307,48,1],[308,9,308,10,1],[311,9,311,10,0],[312,13,312,49,0],[316,9,316,10,1],[317,13,317,96,1],[318,13,318,51,1],[319,13,319,14,1],[320,17,320,54,1],[321,17,321,41,1],[323,22,323,34,1],[323,36,323,59,1],[323,61,323,67,1],[324,17,324,18,1],[325,21,325,121,1],[326,21,326,22,1],[327,25,327,93,1],[328,25,328,95,1],[329,21,329,22,1],[331,21,331,22,1],[332,25,332,93,1],[333,21,333,22,1],[334,17,334,18,1],[336,17,336,80,1],[337,13,337,14,1],[339,13,339,23,1],[340,9,340,10,1],[343,9,343,10,0],[344,13,344,43,0],[346,13,346,90,0],[347,9,347,10,0],[350,9,350,10,1],[351,13,351,95,1],[352,13,352,14,1],[353,17,353,91,1],[356,13,356,14,1],[357,17,357,46,1],[358,17,358,96,1],[359,13,359,14,1],[360,9,360,10,1],[363,9,363,10,1],[364,13,364,40,1],[365,13,365,14,1],[366,17,366,92,1],[367,17,367,37,1],[368,17,368,18,1],[369,21,369,63,1],[370,21,370,22,0],[371,25,373,149,0],[374,21,374,22,0],[375,26,375,68,1],[376,21,376,22,0],[377,25,379,149,0],[380,21,380,22,0],[381,17,381,18,1],[383,17,385,141,1],[386,13,386,14,0],[387,18,387,50,0],[388,17,390,146,0],[391,9,391,10,0],[394,9,394,10,1],[395,13,395,47,1],[396,13,396,51,1],[397,13,397,83,1],[398,17,398,53,0],[400,13,400,58,1],[401,13,401,14,1],[402,17,404,109,1],[405,13,405,14,0],[406,13,406,58,1],[407,13,407,14,1],[408,17,410,109,1],[411,13,411,14,0],[412,18,412,49,1],[413,13,413,14,0],[414,17,414,82,0],[415,17,415,117,0],[416,17,416,40,0],[417,13,417,14,0],[419,13,419,14,1],[420,17,420,57,1],[423,13,423,33,0],[424,9,424,10,1],[427,9,427,10,1],[428,13,428,69,1],[430,13,430,57,1],[431,13,431,14,1],[432,17,432,51,1],[433,17,433,73,1],[434,21,434,133,0],[436,17,438,162,1],[439,13,439,14,0],[440,18,440,63,1],[441,13,441,14,1],[442,17,442,51,1],[443,17,443,73,1],[444,21,445,55,0],[447,17,449,95,1],[450,13,450,14,0],[452,17,452,65,1],[453,9,453,10,1],[457,9,457,10,0],[458,13,458,47,0],[459,13,459,40,0],[460,13,460,14,0],[461,17,461,79,0],[462,17,462,18,0],[463,21,465,134,0],[467,21,467,64,0],[468,25,468,69,0],[470,21,470,48,0],[471,17,471,18,0],[473,17,473,18,0],[474,21,476,133,0],[478,21,478,64,0],[479,25,479,69,0],[480,17,480,18,0],[482,17,482,54,0],[483,13,483,14,0],[484,18,484,50,0],[485,13,485,14,0],[486,17,488,121,0],[490,17,490,60,0],[491,21,491,65,0],[493,17,493,54,0],[494,13,494,14,0],[496,9,496,10,0],[499,9,499,10,1],[500,13,500,64,1],[502,13,502,86,1],[503,13,503,38,1],[504,17,504,43,1],[505,13,505,178,1],[506,13,506,14,0],[507,17,507,110,0],[508,13,508,14,0],[510,13,510,146,1],[511,13,511,14,0],[512,17,512,79,0],[513,13,513,14,0],[517,13,517,115,1],[518,13,518,14,1],[519,17,519,118,1],[520,17,520,119,1],[521,17,521,163,1],[522,13,522,14,1],[525,13,525,25,1],[526,9,526,10,1],[529,9,529,10,1],[530,13,530,32,1],[533,13,533,32,1],[534,13,534,110,1],[535,13,535,70,1],[537,13,538,56,1],[539,13,539,14,1],[540,17,541,99,1],[542,17,542,18,1],[543,21,544,113,1],[545,17,545,18,1],[546,13,546,14,1],[547,13,548,127,1],[549,13,549,14,1],[550,17,550,39,1],[551,13,551,14,1],[553,13,553,33,1],[554,13,554,35,1],[555,9,555,10,1],[558,9,558,10,1],[559,13,559,98,1],[560,13,560,28,1],[561,9,561,10,1],[568,9,568,10,0],[569,13,569,163,0],[570,13,570,56,0],[571,13,571,34,0],[573,13,573,99,0],[574,13,574,14,0],[575,22,575,31,0],[575,33,575,60,0],[575,62,575,65,0],[576,17,576,18,0],[577,21,577,39,0],[579,21,579,93,0],[580,21,580,89,0],[581,21,581,83,0],[582,21,582,93,0],[583,21,583,94,0],[584,21,584,75,0],[585,21,585,97,0],[586,21,586,38,0],[587,21,587,49,0],[588,21,588,46,0],[589,21,589,117,0],[590,21,590,44,0],[591,21,591,83,0],[592,21,592,82,0],[593,21,593,43,0],[595,21,595,41,0],[596,21,596,37,0],[603,21,603,84,0],[604,21,604,89,0],[605,21,605,36,0],[606,21,606,38,0],[607,21,607,42,0],[609,21,609,47,0],[610,21,610,74,0],[611,17,611,18,0],[612,13,612,14,0],[613,9,613,10,0],[616,9,616,10,1],[617,13,617,85,1],[619,13,619,124,1],[620,13,620,129,1],[621,13,621,143,1],[622,13,622,148,1],[623,13,623,144,1],[624,13,624,152,1],[625,13,625,32,1],[626,9,626,10,1],[629,9,629,10,1],[630,13,630,61,1],[631,13,631,85,1],[633,13,633,127,1],[634,13,634,57,1],[635,13,635,14,1],[636,17,636,62,1],[637,17,637,74,1],[638,17,638,77,1],[639,17,639,66,1],[640,13,640,14,1],[642,13,642,115,1],[643,13,643,47,1],[644,13,644,14,1],[645,17,645,53,1],[646,17,646,94,1],[647,17,647,57,1],[648,17,648,50,1],[649,17,649,44,1],[650,17,650,39,1],[651,17,651,52,1],[652,17,652,53,1],[654,17,654,86,1],[656,17,656,110,1],[657,17,657,98,1],[659,17,659,85,1],[661,17,661,56,1],[663,17,663,99,1],[664,17,664,49,1],[665,13,665,14,1],[666,9,666,10,1],[669,9,669,10,1],[670,13,670,60,1],[671,13,671,36,1],[672,13,672,79,1],[673,13,673,54,1],[674,13,674,89,1],[675,13,675,145,1],[676,13,676,229,1],[677,13,677,190,1],[678,13,678,37,1],[681,13,681,36,1],[683,13,683,91,1],[684,9,684,10,1],[687,9,687,10,0],[689,13,689,14,0],[697,17,697,24,0],[697,26,697,58,0],[697,59,697,61,0],[697,62,697,74,0],[698,17,698,18,0],[699,21,699,58,0],[700,21,700,53,0],[701,25,701,166,0],[702,21,702,68,0],[703,17,703,18,0],[704,17,704,123,0],[705,17,705,66,0],[706,13,706,14,0],[707,13,707,40,0],[708,13,708,14,0],[709,17,709,65,0],[710,17,710,70,0],[711,17,711,84,0],[712,17,712,121,0],[713,13,713,14,0],[714,9,714,10,0]]);
    </script>
  </body>
</html>