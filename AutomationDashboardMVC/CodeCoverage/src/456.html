<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Construction Vertical\Main Modules\Estimator\UI\NewEstimate.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Configuration;
using System.Data;
using System.Drawing;
using System.Globalization;
using System.Web.Configuration;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core.BusinessLayer.BL;
using Aurigo.AMP3.Core.UserControls;
using Aurigo.AMP3.DocumentManagementBL;
using Aurigo.AMP3.EstimatorBL;
using Aurigo.AMP3.EstimatorDTO;
using Aurigo.AMP3.Logging;
using Aurigo.AMP3.ProjectBL;
using Aurigo.AMP3.Resources.MessageResources;
using Aurigo.Brix.Core.WebUiHelper;
using Aurigo.Brix.Platform.BusinessLayer.UserControls;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.AMP3.DocumentManagementDTO;
using Aurigo.Brix.Platform.BusinessLayer.BL;
using Aurigo.Common;
using Aurigo.AMP3.Resources.TerminologyResources;
using System.Text.RegularExpressions;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.Brix.Platform.BusinessLayer.AbstractModels;

namespace Aurigo.AMP3.EstimatorUI
{
    //CLASS TO CREATE A NEW ESTIMATE
    public partial class NewEstimate : BrixPageBase, IXMLControl, IWorkflowEnabled
    {
        private int projectID;

        private int ProjectEstimateID
        {
            get { return Request[&quot;ProjectEstimateID&quot;].ToInt32_2(); }
        }

        private bool versionDeleted = false;

        private bool IsVersion
        {
            get { return ViewState[&quot;IsVersion&quot;].ToBoolean2(); }
            set { ViewState[&quot;IsVersion&quot;] = value; }
        }

        /// &lt;summary&gt;
        /// Gets the Project Mode : I-Integration, L-Live
        /// &lt;/summary&gt;
        private string ProjectMode
        {
            get { return (CacheManager.Instance.IsIntegrated(Request[Constants.QRY_PROJECTID].ToInt32_2()) ? &quot;I&quot; : &quot;L&quot;); }
        }

        /// &lt;summary&gt;
        /// Gets the Integration Cutoff Date
        /// &lt;/summary&gt;
        private DateTime IntegrationCutoffDate
        {
            get { return (DateTime)Session[Constants.APP_IntegrationCutoffDate]; }
        }

        /// &lt;summary&gt;
        /// Gets the Default Record Date
        /// &lt;/summary&gt;
        private DateTime DefaultRecordDate
        {
            get { return (DateTime)Session[Constants.APP_DefaultRecordDate]; }
        }

        protected override void CreateChildControls()
        {
            var menus = new MenuArray();
            AddSaveButton(menus);
            if ((!AMP3ApplicationSettings.Instance.IsSingleProjectMode &amp;&amp; ProjectEstimateID &gt; 0) || IsVersion)
                menus.Add(new BrixMenu(&quot;lnkDelete&quot;, &quot;Delete&quot;, &quot;Icn_Delete.png&quot;, 55));
            menus.Add(new BrixMenu(&quot;lnkCancel&quot;, &quot;Cancel&quot;, &quot;Icn_Cancel.png&quot;, 55));
            CreateToolBarMenu(menus, null);
        }

        protected override void CustomizeToolBar()
        {
            if (HasSaveButton)
            {
                Aurigo.AMP3.Core.UserControls.Menu lnkSave = GetSaveButton();
                if (null != lnkSave)
                {
                    lnkSave.Click += btnSave_Click;
                    lnkSave.OnClientClick = &quot;return save();&quot;;
                }
            }
            if (MainToolBar.GetMenuReference(&quot;lnkDelete&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).Click += btnDelete_Click;
                MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).OnClientClick = &quot;return DeleteClick();&quot;;
            }

            if (MainToolBar.GetMenuReference(&quot;lnkCancel&quot;) != null)
                MainToolBar.GetMenuReference(&quot;lnkCancel&quot;).Click += btnCancel_Click;

            Dictionary&lt;string, Type&gt; dicObj = CustomizePageModel.GetModelObjects();
            foreach (KeyValuePair&lt;string, Type&gt; kvp in dicObj)
            {
                CustomizePageModel cpm = CustomizePageModel.GetInstance(kvp.Key);
                if (cpm != null)
                    cpm.CustomizePageAfterCustomizeToolBar(this.Page, MainToolBar, &quot;&quot;, callerContext: &quot;NewEstimate&quot;);
            }
        }

        protected override void OnInit(EventArgs e)
        {
            // set the list of permissions to be checked.
            PermissionsToCheck.Add(Constants.MODFEAT_VISIBILITY);
            if (string.IsNullOrEmpty(Request[&quot;ProjectEstimateID&quot;]))
            {
                PermissionsToCheck.Add(Constants.MODFEAT_CREATE);
            }
            else
            {
                PermissionsToCheck.Add(Constants.MODFEAT_EDIT);
            }

            base.OnInit(e);
        }

        protected void Page_Load(object sender, EventArgs e)
        {
            hdnDateFormat.Value = AMP3ApplicationSettings.Instance.FORMAT_DATE;
            lblBidOpenDate.Text = LocalizationManager.GetString(&quot;Bid Opening Date&quot;) + &quot; :&quot;;

            try
            {
                //PageTitle = UIHelper.GetMessageById(EstimatorConstants.CREATE_ESTIMATE, EstimatorConstants.EST_ERR_FILENAME)[3].ToString2();
                PageTitle = string.IsNullOrEmpty(Request[&quot;ProjectEstimateID&quot;]) ? &quot;Create Estimate&quot; : &quot;Edit Estimate&quot;;
                // Disabling the role combo box
                UIHelper.DisableRoleSelection(Page);

                // Getting the projectID from the querystring
                if (String.IsNullOrEmpty(Request.QueryString.Get(EstimatorConstants.PID)) ||
                    !int.TryParse(Request.QueryString.Get(EstimatorConstants.PID), out projectID))
                {
                    UIHelper.RedirectURL(&quot;Error loading the requested page.&quot;, ResolveUrl(Constants.URL_PROJECTS), null,
                                         Context);
                }

                trGlobalGroup.Style[&quot;display&quot;] =
                    (AMP3ApplicationSettings.Instance.BOQGroupType.StartsWith(&quot;G&quot;, StringComparison.CurrentCultureIgnoreCase)) ? &quot;table-row&quot; : &quot;none&quot;;

                if (!IsPostBack)
                {
                    txtEstimateName.Focus();
                    Form.DefaultButton = btnSave.UniqueID;

                    if (ProjectMode == &quot;I&quot;)
                    {
                        wdcDateCreated.MaxDate = IntegrationCutoffDate.AddDays(-1).ToMWDateTime();
                        wdcDateCreated.Value = DefaultRecordDate.ToMWDateTime();
                        wdcDateCreated.Enabled = true;
                    }
                    else if (ProjectMode == &quot;L&quot;)
                    {
                        wdcDateCreated.MaxDate = MWDateTimeHelper.MWToday;
                        wdcDateCreated.Value = MWDateTimeHelper.MWToday;
                        wdcDateCreated.Enabled = false;
                    }


                    btnDelete.Visible = false;

                    Session[EstimatorConstants.ESTMATE_PROJECT_ID] = projectID;

                    DataTable dtStdTables = null;
                    if (Session[EstimatorConstants.ESTMATE_PROJECT_ID] != null)
                    {
                        string AXCompany = null;
                        if (ConfigurationManager.AppSettings[&quot;CompanyFilter&quot;] != null &amp;&amp;
                            ConfigurationManager.AppSettings[&quot;CompanyFilter&quot;].ToUpper2().Equals(&quot;ON&quot;))
                            AXCompany = Session[Constants.EIS_ADDITIONAL_INFO] == null
                                            ? null
                                            : Session[Constants.EIS_ADDITIONAL_INFO].ToString2();
                        dtStdTables = EstimateManager.Instance.GetStandardItemTables(AXCompany);
                    }

                    if (dtStdTables.Rows.Count &gt; 0)
                    {
                        ddlStdItemList.DataSource = dtStdTables;

                        ddlStdItemList.DataTextField = &quot;StandardTableName&quot;;
                        ddlStdItemList.DataValueField = &quot;StandardTableID&quot;;
                        ddlStdItemList.DataBind();
                        ddlStdItemList.SelectedValue = dtStdTables.Rows[0][&quot;StandardTableID&quot;].ToString2();
                    }

                    DataTable dtMeasureSys =
                        ProjectManager.Instance.GetMeasurementSystems(Session[Constants.EIS_ADDITIONAL_INFO].ToString2());

                    if (dtMeasureSys.Rows.Count &gt; 0)
                    {
                        ddlMeaSys.DataSource = dtMeasureSys;
                        ddlMeaSys.DataTextField = &quot;SystemName&quot;;
                        ddlMeaSys.DataValueField = &quot;SystemID&quot;;
                        ddlMeaSys.DataBind();
                    }

                    DataSet ds = EstimateManager.Instance.GetEstimateAndWorkType();

                    if (ds.Tables.Count &gt; 1)
                    {
                        cboWorkType.DataSource = ds.Tables[1];
                        cboWorkType.DataTextField = cboWorkType.DataValueField = &quot;WorkType&quot;;
                        cboWorkType.DataBind();
                    }

                    if (ds.Tables.Count &gt; 0)
                    {
                        cboEstType.DataSource = ds.Tables[0];
                        cboEstType.DataTextField = cboEstType.DataValueField = &quot;EstimateType&quot;;
                        cboEstType.DataBind();
                    }
                    List&lt;string&gt; components = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_ESTMATE);
                    if (components.Contains(&quot;ShowEstimateDocuments&quot;))
                    {
                        PopulateDocumentTemplates();
                    }
                    else
                    {
                        trDocTemplate.Style.Add(&quot;Display&quot;, &quot;none&quot;);
                    }


                    var li = new ListItem(EstimatorConstants.SELECT_ONE, EstimatorConstants.SELECT_ONE);

                    //cboStates.Items.Insert(0, li);
                    cboEstType.Items.Insert(0, li);
                    cboWorkType.Items.Insert(0, li);
                    ddlStdItemList.Items.Insert(0, li);
                    ddlMeaSys.Items.Insert(0, li);

                    if (ProjectEstimateID &gt; 0)
                    {
                        btnDelete.Visible = (AMP3ApplicationSettings.Instance.IsSingleProjectMode) ? false : true;

                        DataSet dsTemp = ItemManager.Instance.GetTaxCalculatorDetails(&quot;ESTMATE&quot;, ProjectEstimateID);
                        DataRow dr = dsTemp.Tables[1].Rows[0];

                        #region Estimate Total Calculations

                        int amountDigits = CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT);

                        decimal totalBaseCost =
                            Math.Round(Convert.ToDecimal(dr[&quot;TotalBaseCost&quot;].ToString2(), CultureInfo.CurrentCulture), amountDigits);
                        decimal origBaseCost =
                            Math.Round(Convert.ToDecimal(dr[&quot;OrigBaseCost&quot;].ToString2(), CultureInfo.CurrentCulture), amountDigits);
                        decimal totalOverheadCost =
                            Math.Round(
                                Convert.ToDecimal(dr[&quot;TotalOverheadCost&quot;].ToString2(), CultureInfo.CurrentCulture), amountDigits);
                        decimal totalBOQMargin =
                            Math.Round(Convert.ToDecimal(dr[&quot;TotalMargin&quot;].ToString2(), CultureInfo.CurrentCulture), amountDigits);
                        decimal totalBOQDiscount =
                            Math.Round(Convert.ToDecimal(dr[&quot;TotalDiscount&quot;].ToString2(), CultureInfo.CurrentCulture), amountDigits);
                        decimal totalEstimateCost = totalBaseCost + totalOverheadCost + totalBOQMargin -
                                                    totalBOQDiscount;

                        decimal profitMarginPercentage = Math.Round(dr[&quot;Margin&quot;].ToString2().ToDecimal2(), amountDigits);
                        decimal discountPercentage = Math.Round(dr[&quot;Discount&quot;].ToString2().ToDecimal2(), amountDigits);
                        decimal profitAmount = totalEstimateCost * profitMarginPercentage * (decimal)0.01;
                        decimal tempAmount = totalEstimateCost + profitAmount;
                        decimal discountAmount = tempAmount * discountPercentage * (decimal)0.01;
                        decimal totalProfit = totalBOQMargin + profitAmount;
                        decimal totalDiscount = totalBOQDiscount + discountAmount;
                        decimal netProfit = Math.Round((totalProfit - totalDiscount), amountDigits);
                        decimal netRevenue = netProfit + totalBaseCost + totalOverheadCost;

                        #endregion

                        EstimatorDTO.Estimator estObj = EstimateManager.Instance.GetEstimateDetails(ProjectEstimateID);

                        if (estObj != null)
                        {
                            PageTitle =
                                UIHelper.GetMessageById(EstimatorConstants.EDIT_ESTIMATE,
                                                        EstimatorConstants.EST_ERR_FILENAME)[3].ToString2();
                            estObj.GroupType = ItemManager.Instance.GetGroupType(estObj.ProjectEstimateId,
                                                                                 Constants.MODID_ESTMATE);
                            txtEstimateName.Text = estObj.EstimateId;
                            txtEstimateDesc.Text = string.IsNullOrEmpty(estObj.EstimateDescription) ? string.Empty : estObj.EstimateDescription;
                            // txtEstimateDesc.Text = estObj.EstimateDescription;

                            txtProjEngineer.Text = estObj.ProjectEngineer;
                            txtEstName.Text = estObj.EstimateName;
                            lblEstTotal.Text = LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) + &quot; &quot; + netRevenue.ToString(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT);
                            lblDateAdv.Text =
                                (estObj.DatePublished.ToMWDateTimeString_FormatDate() ==
                                 DateTime.MinValue.ToMWDateTimeString_FormatDate())
                                    ? &quot;&quot;
                                    : estObj.DatePublished.ToMWDateTimeString_FormatDate();
                            lblLetDate.Text =
                                (estObj.LettingDate.ToMWDateTimeString_FormatDate() ==
                                 DateTime.MinValue.ToMWDateTimeString_FormatDate())
                                    ? &quot;&quot;
                                    : estObj.LettingDate.ToMWDateTimeString_FormatDate();

                            if (estObj.EstimateType != &quot;&quot; &amp;&amp; cboEstType.Items.FindByValue(estObj.EstimateType) != null)
                            {
                                cboEstType.SelectedValue = estObj.EstimateType;
                            }
                            if (estObj.WorkType != &quot;&quot; &amp;&amp; cboWorkType.Items.FindByValue(estObj.WorkType) != null)
                            {
                                cboWorkType.SelectedValue = estObj.WorkType;
                            }

                            if (estObj.StdItemTable != 0 &amp;&amp;
                                ddlStdItemList.Items.FindByValue(estObj.StdItemTable.ToString2()) != null)
                            {
                                ddlStdItemList.SelectedValue = estObj.StdItemTable.ToString2();
                            }

                            if (estObj.MeasurementSysID != 0 &amp;&amp;
                                ddlMeaSys.Items.FindByValue(estObj.MeasurementSysID.ToString2()) != null)
                            {
                                ddlMeaSys.SelectedValue = estObj.MeasurementSysID.ToString2();
                            }
                            if (ddlGroupType.Items.FindByValue(estObj.GroupType.ToString2()) != null)
                            {
                                ddlGroupType.Items.FindByValue(estObj.GroupType.ToString2()).Selected = true;
                            }
                            if (ddlDocumentTemplate.Items.FindByValue(estObj.DocumentTemplateID.ToString2()) != null)
                            {
                                ddlDocumentTemplate.Items.FindByValue(estObj.DocumentTemplateID.ToString2()).Selected = true;
                            }

                            wdcDateCreated.Value = estObj.CreatedDate.ToMWDateTime();
                            hdnMode.Value = EstimatorConstants.EDIT;
                            IsVersion = estObj.IsVersion;

                            Session.Add(&quot;EstAttrList&quot;, estObj.EstmateAttributes);

                            PopulateAttributesGrid(EstimatorConstants.NEW);
                        }
                    }
                    else
                    {
                        var AttributeList = new Dictionary&lt;string, string&gt;();
                        Session.Add(&quot;EstAttrList&quot;, AttributeList);
                        PopulateAttributesGrid(EstimatorConstants.NEW);
                    }


                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, EstimatorConstants.ESTIMATOR);
            }
        }

        private void PopulateDocumentTemplates()
        {
            DataTable dt = DocumentManager.Instance.GetDocumentTemplates();

            if (dt != null)
            {
                ddlDocumentTemplate.DataSource = dt;
                ddlDocumentTemplate.DataTextField = &quot;DocTemplateName&quot;;
                ddlDocumentTemplate.DataValueField = &quot;DocTemplateID&quot;;
                ddlDocumentTemplate.DataBind();

                ddlDocumentTemplate.Items.Insert(0, new ListItem(&quot;Select One&quot;, &quot;0&quot;));
            }
        }

        //SAVE NEW ESTIMATE
        protected void btnSave_Click(object sender, EventArgs e)
        {
            WorkflowEnabledSaveHandler();
        }

        //CANCEL
        protected void btnCancel_Click(object sender, EventArgs e)
        {
            RedirectBack();
        }

        private void RedirectBack(bool refreshTree = false)
        {
            Response.Redirect(GetRedirectURL(refreshTree));
        }

        private string GetRedirectURL(bool refreshTree = false)
        {
            if (!AMP3ApplicationSettings.Instance.IsSingleProjectMode)
            {
                return
                    string.Format(&quot;~/Common/BrixListPage.aspx?Context=ESTMATE&amp;{0}={1}{2}&quot;, EstimatorConstants.PID,
                    projectID, refreshTree ? &quot;&amp;nt=1&quot; : string.Empty);
            }
            else
            {
                if (ProjectEstimateID &gt; 0 &amp;&amp; !versionDeleted)
                {
                    return
                        string.Format(&quot;EstimateDetails.aspx?{0}={1}&amp;ProjectEstimateID={2}&amp;Context=ESTMATE{3}&quot;,
                                      EstimatorConstants.PID, projectID, ProjectEstimateID, refreshTree ? &quot;&amp;nt=1&quot; : string.Empty);
                }
                else
                {
                    return
                         string.Format(&quot;~/Modules/PROJECT/ProjectDetails.aspx?{0}={1}{2}&quot;, EstimatorConstants.PID, projectID, refreshTree ? &quot;&amp;nt=1&quot; : string.Empty);
                }
            }
        }

        private void PopulateAttributesGrid(string mode)
        {
            DataTable projectDT = EstimateManager.Instance.GetAttributes();
            ddlAttributes.Items.Clear();
            if (mode == EstimatorConstants.NEW)
            {
                if (projectDT.Rows.Count &gt; 0)
                {
                    ddlAttributes.Visible =
                        txtAttrValue.Visible =
                        tdAttName.Visible =
                        tdAttValue.Visible = true;
                    lblNoAtt.Visible = false;

                    btnAddAttributes.Style.Value = &quot;&quot;;

                    ddlAttributes.DataSource = projectDT;
                    ddlAttributes.DataTextField = &quot;AttributeName&quot;;
                    ddlAttributes.DataValueField = &quot;AttributeIdType&quot;;
                    ddlAttributes.DataBind();
                }
                else
                {
                    btnAddAttributes.Style.Value = EstimatorConstants.HTML_DISPLAY_NONE;
                    ddlAttributes.Visible =
                        txtAttrValue.Visible =
                        tdAttName.Visible =
                        tdAttValue.Visible = false;
                    lblNoAtt.Visible = true;
                }
            }

            if (ProjectEstimateID &gt; 0)
            {
                if (Session[&quot;EstAttrList&quot;] != null)
                {
                    var attributes = (Dictionary&lt;string, string&gt;)Session[&quot;EstAttrList&quot;];
                    tblProjectAttributes.Rows.Clear();

                    if (attributes.Count &gt; 0)
                    {
                        HtmlTableRow tr;
                        HtmlTableCell td;

                        //creating headers
                        tr = new HtmlTableRow();
                        td = new HtmlTableCell();
                        td.InnerText = &quot;Attribute&quot;;
                        tr.Cells.Add(td);
                        td = new HtmlTableCell();
                        td.InnerText = &quot;Value&quot;;
                        td.ColSpan = 3;
                        tr.Cells.Add(td);
                        tblProjectAttributes.Rows.Add(tr);
                        foreach (var iaKey in attributes)
                        {
                            string atId = Server.HtmlEncode(iaKey.Key.Split(EstimatorConstants.COMMA)[0]);
                            string atype = Server.HtmlEncode(iaKey.Key.Split(EstimatorConstants.COMMA)[1]);
                            string qryStr = &quot;AttributeID = &quot; + atId.ToInt32_2();
                            DataRow[] row = projectDT.Select(qryStr);

                            tr = new HtmlTableRow();
                            //attributeName

                            tr.ID = atId;
                            td = new HtmlTableCell();
                            td.InnerText = Server.HtmlEncode(row[0][&quot;AttributeName&quot;].ToString2());
                            tr.Cells.Add(td);
                            //attributeValue
                            var inputText = new HtmlInputText();
                            td = new HtmlTableCell();
                            inputText.Attributes.Add(&quot;ECell&quot;, &quot;1&quot;);
                            inputText.Value = iaKey.Value.ToString2();
                            inputText.Disabled = true;
                            inputText.ID = &quot;tcell&quot; + Server.HtmlEncode(atId);
                            inputText.Attributes.Add(&quot;onblur&quot;,
                                                     &quot;javascript:ValidateValue(this,&#39;&quot; + Server.HtmlEncode(atype) +
                                                     &quot;&#39;);&quot;);
                            inputText.Attributes.Add(&quot;class&quot;, &quot;tbC&quot;);
                            inputText.Size = 40;
                            inputText.MaxLength = 20;
                            //inputText.Attributes.CssClass(&quot;tbC&quot;);
                            td.Controls.Add(inputText);
                            tr.Cells.Add(td);
                            //Edit link
                            td = new HtmlTableCell();
                            td.InnerHtml = &quot;&lt;a class=\&quot;loginLinks\&quot; href=\&quot;#\&quot; onclick=\&quot;editSAtt($(this));\&quot;&gt;Edit&lt;/a&gt;&quot;;
                            tr.Cells.Add(td);
                            //Delete link
                            td = new HtmlTableCell();
                            td.InnerHtml = &quot;&lt;a class=\&quot;loginLinks\&quot; href=\&quot;#\&quot; onclick=\&quot;deleteSAtt($(this),&quot; + atId + &quot;);\&quot;&gt;Delete&lt;/a&gt;&quot;;
                            tr.Cells.Add(td);
                            td = new HtmlTableCell();
                            td.InnerText = Server.HtmlEncode(iaKey.Key.ToString2());
                            td.Style.Value = EstimatorConstants.HTML_DISPLAY_NONE;
                            tr.Cells.Add(td);
                            tblProjectAttributes.Rows.Add(tr);
                        }

                        divAttributeTable.Style.Value = &quot;overflow: auto; height: 150px;&quot;;
                    }
                }
            }
        }

        protected void btnDelete_Click(object sender, EventArgs e)
        {
            try
            {
                if (ProjectEstimateID &gt; 0)
                {
                    int[] returnValue = EstimateManager.Instance.RemoveEstimate(ProjectEstimateID);


                    if (returnValue[0] == (int)Results.ErrorOccured)
                    {
                        ShowNotificationMessage(&quot;Error deleting the Estimate.&quot;, NotificationType.Error);
                        //lblError.ForeColor = Color.Red;
                        return;
                    }
                    else if (returnValue[0] == (int)RequestDenied.EstimateAwarded)
                    {
                        ShowNotificationMessage(&quot;Cannot delete a awarded estimate.&quot;, NotificationType.Error);
                        // lblError.ForeColor = Color.Red;
                        return;
                    }

                    //Mark VersionDeleted to true. This will be used in RedirectBack method to determine to which page to redirect.
                    versionDeleted = true;

                    //Session.Remove(EstimatorConstants.PROJECT_ESTIMATE_ID);
                    Session.Remove(&quot;workingEstimate&quot;);
                    //RedirectBack(true);
                    if (returnValue[1] == (int)Results.OrigEstDeleted)
                    {
                        Response.Redirect(
                            string.Format(&quot;~/Modules/PROJECT/ProjectDetails.aspx?{0}={1}&amp;nt=1&quot;, EstimatorConstants.PID,
                                          projectID), true);
                    }
                    RedirectBack(true);
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, EstimatorConstants.ESTIMATOR);
            }
        }

        #region Nested type: RequestDenied

        private enum RequestDenied
        {
            EstimateCreated = -5,
            EstimateAwarded = -10
        }

        #endregion

        #region Nested type: Results

        private enum Results
        {
            ErrorOccured = -5,
            OrigEstDeleted = -15,
            VersionDeleted = -9,
        }

        #endregion

        #region IXMLControl Members

        public object[] ParentFormInstanceID
        {
            get { return new object[] { Request[&quot;ProjectEstimateID&quot;] == null ? &quot;0&quot; : Request[&quot;ProjectEstimateID&quot;].ToString() }; }
        }

        public HtmlGenericControl XMLContainterDiv
        {
            get
            {
                return divExtension;
            }
            set
            { }
        }

        public void HandleInjectionSaveException(object model, Exception ex, string parentFormInstanceId)
        { }

        public void HandleInjectionAfterSave(object model, string parentFormInstanceId) { }

        public bool SkipDefaultXMLInjectionSave { get; set; }

        #endregion



        #region IWorkflowEnabled Members

        protected override void SetModes()
        {
            base.SetModes();
            _IsNew = string.IsNullOrEmpty(Request.QueryString[&quot;ProjectEstimateID&quot;]);
            _IsEdit = !(bool)_IsNew;
        }

        public void CancelHandler(object sender, bool bAfterSave, out string sRedirectTo)
        {
            throw new NotImplementedException();
        }

        public string ClientValidationFunction
        {
            get { return &quot;save()&quot;; }
        }

        public string FormInstanceId
        {
            get
            {
                int id = String.IsNullOrEmpty(Request.QueryString[&quot;ProjectEstimateID&quot;])
                             ? -1
                             : int.TryParse(Request.QueryString[&quot;ProjectEstimateID&quot;], out id) ? id : -1;
                return id.ToString();
            }
        }

        protected string _formkey = string.Empty;
        public string FormKey
        {
            get { return _formkey; }
        }

        public string FormName
        {
            get { return &quot;XESTMTE&quot;; }
        }

        public bool IsOldWorkflow
        {
            get { return true; }
        }

        public int PID
        {
            get { return Request.QueryString[&quot;PID&quot;].ToInt32_2(); }
        }

        public int ParentModuleId
        {
            get
            {
                return 0;
            }
        }

        public string PostCancelRedirectUrl
        {
            get { return GetRedirectURL(); }
        }

        public string PostSaveRedirectUrl(string sSavedToken = &quot;&quot;)
        {
            return GetRedirectURL(true);
        }

        public bool SaveHandler(object sender, out string sSavedInstanceToken, out string sErrors, out string sRedirectTo)
        {
            sSavedInstanceToken = sErrors = sRedirectTo = string.Empty;

            try
            {
                var dtoObj = new EstimateItem();
                var estObj = new EstimatorDTO.Estimator();

                //Space can be allowed in Estimate ID (LIMW-31926)
                //if (!String.IsNullOrEmpty(txtEstimateName.Text.Trim()))
                //{
                //    if (!Regex.IsMatch(txtEstimateName.Text.Trim(), @&quot;^[^\s]+$&quot;))
                //    {                    
                //        UIHelper.RedirectURL(
                //        &quot;Space is not allowed in Estimate ID.&quot;,
                //        string.Format(&quot;~/Modules/ESTMATE/NewEstimate.aspx?{0}={1}&quot;, EstimatorConstants.PID,projectID),null, Context);
                //    }
                //}

                if (Regex.IsMatch(txtEstimateName.Text.Trim(), @&quot;[\^|]&quot;))
                {
                    //UIHelper.RedirectURL(
                    //   &quot;Estimate ID cannot contain the following characters: ^ |&quot;,
                    //   string.Format(&quot;~/Modules/ESTMATE/NewEstimate.aspx?{0}={1}&quot;, EstimatorConstants.PID, projectID), null, Context);

                    throw new Exception(&quot;Estimate ID cannot contain the following characters: ^ |&quot;);
                }

                estObj.ProjectId = projectID;
                estObj.EstimateId = txtEstimateName.Text.Trim();
                estObj.EstimateName = txtEstName.Text.Trim();
                estObj.EstimateDescription = txtEstimateDesc.Text.Trim();
                estObj.EstimateIsLocked = false;
                estObj.EstimateTotal = 0.0m;
                estObj.ProjectEngineer = txtProjEngineer.Text;
                estObj.LettingDate = DateTime.UtcNow;
                estObj.CreatedDate = wdcDateCreated.Value.ToDateTime_MWCulture();
                estObj.States = (hfStates.Value != EstimatorConstants.SELECT_ONE) ? hfStates.Value : &quot;&quot;;
                estObj.WorkType = (cboWorkType.SelectedItem.Text != EstimatorConstants.SELECT_ONE)
                                      ? cboWorkType.SelectedValue
                                      : &quot;&quot;;
                estObj.EstimateType = (cboEstType.SelectedItem.Text != EstimatorConstants.SELECT_ONE)
                                          ? cboEstType.SelectedValue
                                          : &quot;&quot;;

                estObj.StdItemTable = (ddlStdItemList.SelectedItem.Text != EstimatorConstants.SELECT_ONE)
                                          ? ddlStdItemList.SelectedValue.ToInt32_2()
                                          : 0;

                estObj.MeasurementSysID = (ddlMeaSys.SelectedItem.Text != EstimatorConstants.SELECT_ONE)
                                              ? ddlMeaSys.SelectedValue.ToInt32_2()
                                              : 0;

                estObj.GroupType = Convert.ToChar(ddlGroupType.SelectedValue, CultureInfo.CurrentCulture);
                if (!string.IsNullOrEmpty(ddlDocumentTemplate.SelectedValue))
                    estObj.DocumentTemplateID = Convert.ToInt32(ddlDocumentTemplate.SelectedValue, CultureInfo.CurrentCulture);

                string[] atts = hdnAttributes.Value.Split(EstimatorConstants.PIPE);
                var aList = new Dictionary&lt;string, string&gt;();
                for (int i = 0; i &lt; atts.Length - 1; i++)
                    aList.Add(atts[i].Split(EstimatorConstants.COMMA)[0], atts[i].Split(EstimatorConstants.COMMA)[1]);
                estObj.EstmateAttributes = aList;
                List&lt;string&gt; components = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_ESTMATE);
                if (components.Contains(&quot;AutoCreateContractFromBid&quot;))
                {
                    estObj.CreateContractFromBid = true;
                }
                else
                {
                    estObj.CreateContractFromBid = false;
                }

                if (components.Contains(&quot;NotifyAddendumIssued&quot;))
                {
                    estObj.SendAddendumIssuedEmail = true;
                }
                else
                {
                    estObj.SendAddendumIssuedEmail = false;
                }

                if (components.Contains(&quot;NotifyBidInvitees&quot;))
                {
                    estObj.SendInviteEmail = true;
                }
                else
                {
                    estObj.SendInviteEmail = false;
                }

                int rtnValue = 0;
                if (hdnMode.Value == EstimatorConstants.SAVE)
                {
                    UserDetail userDetail = UserDetail.GetCurrentUserDetail();
                    if (userDetail != null)
                    {
                        estObj.ProjectEngineer = userDetail.UserName;
                        estObj.CreatedByID = userDetail.UID;
                    }

                    bool multiEstimates =
                        (WebConfigurationManager.AppSettings[&quot;EPSModeMultiple&quot;] ?? &quot;OFF&quot;).ToUpper2() == &quot;ON&quot;;
                    estObj.MultiEstimates = multiEstimates;
                    rtnValue = EstimateManager.Instance.CreateEstimate(estObj);

                    if (rtnValue == (int)RequestDenied.EstimateCreated)
                    {
                        //UIHelper.RedirectURL(
                        //    &quot;Estimate already created. Please click on the project to view the Estimate.&quot;,
                        //    ResolveUrl(Constants.URL_PROJECTS),
                        //    null, Context);

                        throw new Exception(&quot;Estimate already created. Please click on the project to view the Estimate.&quot;);
                    }
                }
                else if (hdnMode.Value == EstimatorConstants.EDIT)
                {
                    rtnValue = EstimateManager.Instance.UpdateEstimate(estObj, ProjectEstimateID, projectID);

                    if (rtnValue == 2)
                    {
                        throw new Exception(&quot;Cannot update Estimate. Estimate deleted.&quot;);
                        //lblError.ForeColor = Color.Red;

                        //return;
                    }
                }

                if (rtnValue == -2)
                {
                    //sErrors = lblError.Text =
                    //    UIHelper.GetMessageById(EstimatorConstants.EST_EXISTS, EstimatorConstants.EST_ERR_FILENAME)[3].
                    //        ToString2();
                    //lblError.ForeColor = Color.Red;

                    throw new Exception(UIHelper.GetMessageById(EstimatorConstants.EST_EXISTS, EstimatorConstants.EST_ERR_FILENAME)[3].ToString());
                }
                else
                {
                    if (hdnMode.Value == EstimatorConstants.SAVE)
                    {
                        //add default group
                        ItemManager.Instance.CUDGroupDetails(rtnValue, &quot;ESTMATE&quot;, EstimatorConstants.ESTMATE_DEFAULT,
                                                             EstimatorConstants.ESTMATE_DEFAULT, 0, 0, 0, &quot;N&quot;,
                                                             String.Empty);

                        // add basebid as a alternative
                        dtoObj.ProjectEstimateID = rtnValue;

                        dtoObj.AlternateCode = &quot;Base Bid&quot;;
                        dtoObj.AlternateName = &quot;Base Bid&quot;;

                        EstimateManager.Instance.AddAlternateInfo(dtoObj);

                        dtoObj.ProjectEstimateID = rtnValue;
                    }
                    int estID = (hdnMode.Value == EstimatorConstants.SAVE) ? rtnValue : ProjectEstimateID;
                    Folder projFolder = DocumentManager.Instance.GetInstanceRootFolder(projectID, &quot;PROJECT&quot;);

                    DocumentManager.Instance.AddFolder(new Folder()
                    {
                        ParentId = 0,
                        FolderName = &quot;{0}-{1}&quot;.Format2(estObj.EstimateName, estObj.EstimateId),
                        FolderDesc = &quot;Estimate Documents&quot;,
                        ModuleId = &quot;ESTMATE&quot;,
                        InstanceId = estID.ToString(),
                        ListID = projFolder.ListID,
                        ListPath = &quot;{0}-{1}&quot;.Format2(estObj.EstimateName, estObj.EstimateId),
                        ParentModuleId = &quot;PROJECT&quot;,
                        ParentInstanceId = projectID
                    });

                    Folder EstFolder = DocumentManager.Instance.GetInstanceRootFolder(estID, &quot;ESTMATE&quot;);
                    if (hdnMode.Value != EstimatorConstants.SAVE)
                    {
                        EstFolder.RootModuleFolderId = projFolder.FolderId;
                        EstFolder.FolderName = EstFolder.ListPath = &quot;{0}-{1}&quot;.Format2(estObj.EstimateName, estObj.EstimateId);
                        DocumentManager.Instance.ModifyFolder(EstFolder);
                    }
                    else
                    {
                        BrixWorkflowManager.Instance.TriggerWorkflow(TriggerPoint.TriggerActions[0], &quot;XESITWF&quot;, projectID.ToString(), estID.ToString(), &quot;&quot;, estID.ToString());
                    }

                    if (estID &gt; 0 &amp;&amp; ddlDocumentTemplate != null &amp;&amp; ddlDocumentTemplate.SelectedItem != null &amp;&amp; ddlDocumentTemplate.SelectedIndex &gt; 0)
                    {
                        int DocTemplateID;
                        if (int.TryParse(ddlDocumentTemplate.Items[ddlDocumentTemplate.SelectedIndex].Value, out DocTemplateID))
                            if (DocTemplateID &gt; 0)
                                DocumentManager.Instance.InstantiateDocumentTemplate(EstFolder, DocTemplateID);
                    }

                    // Creating Document folder for Estimate Bid Letting
                    DocumentManager.Instance.AddFolder(new Folder()
                    {
                        ModuleId = &quot;BIDLTDL&quot;,
                        InstanceId = &quot;0&quot;,
                        ParentInstanceId = estID,
                        FolderName = LocalizationManager.GetString(&quot;Bid Letting Documents&quot;),
                        FolderDesc = LocalizationManager.GetString(&quot;Bid Letting Documents&quot;),
                        ParentId = EstFolder.FolderId,
                        ParentModuleId = &quot;ESTMATE&quot;,
                        ListID = EstFolder.ListID,
                        ListPath = &quot;{0}{1}&quot;.Format2(!string.IsNullOrEmpty(EstFolder.ListPath) ? &quot;{0}{1}&quot;.Format2(EstFolder.ListPath, &quot;/&quot;) : string.Empty, &quot;Bid Letting Documents&quot;)
                    });

                    // Creating Document folder for Estimate Bids
                    DocumentManager.Instance.AddFolder(new Folder()
                    {
                        ModuleId = &quot;ESTMBID&quot;,
                        InstanceId = &quot;0&quot;,
                        ParentInstanceId = estID,
                        FolderName = LocalizationManager.GetString(&quot;Bid Documents&quot;),
                        FolderDesc = LocalizationManager.GetString(&quot;Bid Documents&quot;),
                        ParentId = EstFolder.FolderId,
                        ParentModuleId = &quot;ESTMATE&quot;,
                        ListID = EstFolder.ListID,
                        ListPath = &quot;{0}{1}&quot;.Format2(!string.IsNullOrEmpty(EstFolder.ListPath) ? &quot;{0}{1}&quot;.Format2(EstFolder.ListPath, &quot;/&quot;) : string.Empty, &quot;Bid Letting Documents&quot;)
                    });

                    sSavedInstanceToken = estID.ToString();
                    _formkey = string.Format(&quot;Estimate ID : {0}, Date Created : {1}&quot;, estObj.EstimateId, estObj.CreatedDate.ToMWDateTimeString_FormatDate());

                    return true;
                    //if (hdnMode.Value == EstimatorConstants.SAVE)
                    //    Response.Redirect(
                    //        string.Format(&quot;EstimateDetails.aspx?ProjectEstimateID={0}&amp;{1}={2}&amp;Context=ESTMATE&amp;nt=1&quot;,
                    //                      rtnValue, EstimatorConstants.PID, projectID), false);
                    //else
                    //{
                    //    if (ProjectEstimateID &gt; 0)
                    //    {
                    //        Response.Redirect(
                    //            string.Format(&quot;EstimateDetails.aspx?ProjectEstimateID={0}&amp;{1}={2}&amp;Context=ESTMATE&amp;nt=1&quot;,
                    //                          ProjectEstimateID, EstimatorConstants.PID, projectID), false);
                    //    }
                    //}
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, EstimatorConstants.ESTIMATOR);
                throw new Exception(ex.Message);
            }

        }

        #endregion IWorkflowEnabled Members

        public override int GetProjectIdFromInstanceId()
        {
            if (!string.IsNullOrEmpty(Request[&quot;ProjectEstimateID&quot;]))
                return EstimateManager.Instance.GetPIDFromEstimateId(Request[&quot;ProjectEstimateID&quot;].ToInt32_2());
            else
                return base.GetProjectIdFromInstanceId();
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[40,17,40,18,0],[40,19,40,67,0],[40,68,40,69,0],[43,9,43,45,0],[47,17,47,18,0],[47,19,47,62,0],[47,63,47,64,0],[48,17,48,18,0],[48,19,48,50,0],[48,51,48,52,0],[56,17,56,18,0],[56,19,56,121,0],[56,122,56,123,0],[64,17,64,18,0],[64,19,64,81,0],[64,82,64,83,0],[72,17,72,18,0],[72,19,72,77,0],[72,78,72,79,0],[76,9,76,10,0],[77,13,77,41,0],[78,13,78,34,0],[79,13,79,111,0],[80,17,80,86,0],[81,13,81,82,0],[82,13,82,44,0],[83,9,83,10,0],[86,9,86,10,0],[87,13,87,31,0],[88,13,88,14,0],[89,17,89,78,0],[90,17,90,37,0],[91,17,91,18,0],[92,21,92,52,0],[93,21,93,62,0],[94,17,94,18,0],[95,13,95,14,0],[96,13,96,67,0],[97,13,97,14,0],[98,17,98,84,0],[99,17,99,99,0],[100,13,100,14,0],[102,13,102,67,0],[103,17,103,84,0],[105,13,105,84,0],[106,13,106,20,0],[106,22,106,52,0],[106,53,106,55,0],[106,56,106,62,0],[107,13,107,14,0],[108,17,108,82,0],[109,17,109,33,0],[110,21,110,118,0],[111,13,111,14,0],[112,9,112,10,0],[115,9,115,10,0],[117,13,117,66,0],[118,13,118,68,0],[119,13,119,14,0],[120,17,120,66,0],[121,13,121,14,0],[123,13,123,14,0],[124,17,124,64,0],[125,13,125,14,0],[127,13,127,28,0],[128,9,128,10,0],[131,9,131,10,0],[132,13,132,80,0],[133,13,133,92,0],[136,13,136,14,0],[138,17,138,118,0],[140,17,140,53,0],[143,17,144,99,0],[145,17,145,18,0],[146,21,147,51,0],[148,17,148,18,0],[150,17,151,151,0],[153,17,153,33,0],[154,17,154,18,0],[155,21,155,45,0],[156,21,156,59,0],[158,21,158,44,0],[159,21,159,22,0],[160,25,160,99,0],[161,25,161,81,0],[162,25,162,55,0],[163,21,163,22,0],[164,26,164,49,0],[165,21,165,22,0],[166,25,166,75,0],[167,25,167,73,0],[168,25,168,56,0],[169,21,169,22,0],[172,21,172,47,0],[174,21,174,80,0],[176,21,176,50,0],[177,21,177,80,0],[178,21,178,22,0],[179,25,179,49,0],[180,25,181,103,0],[182,29,184,98,0],[185,25,185,97,0],[186,21,186,22,0],[188,21,188,52,0],[189,21,189,22,0],[190,25,190,65,0],[192,25,192,76,0],[193,25,193,75,0],[194,25,194,51,0],[195,25,195,107,0],[196,21,196,22,0],[198,21,199,123,0],[201,21,201,53,0],[202,21,202,22,0],[203,25,203,61,0],[204,25,204,64,0],[205,25,205,63,0],[206,25,206,46,0],[207,21,207,22,0],[209,21,209,84,0],[211,21,211,45,0],[212,21,212,22,0],[213,25,213,63,0],[214,25,214,93,0],[215,25,215,48,0],[216,21,216,22,0],[218,21,218,45,0],[219,21,219,22,0],[220,25,220,62,0],[221,25,221,95,0],[222,25,222,47,0],[223,21,223,22,0],[224,21,224,116,0],[225,21,225,70,0],[226,21,226,22,0],[227,25,227,53,0],[228,21,228,22,0],[230,21,230,22,0],[231,25,231,68,0],[232,21,232,22,0],[235,21,235,105,0],[238,21,238,52,0],[239,21,239,53,0],[240,21,240,56,0],[241,21,241,51,0],[243,21,243,47,0],[244,21,244,22,0],[245,25,245,115,0],[247,25,247,117,0],[248,25,248,63,0],[252,25,252,133,0],[254,25,255,134,0],[256,25,257,133,0],[258,25,260,131,0],[261,25,262,132,0],[263,25,264,134,0],[265,25,266,70,0],[268,25,268,122,0],[269,25,269,120,0],[270,25,270,107,0],[271,25,271,79,0],[272,25,272,98,0],[273,25,273,77,0],[274,25,274,83,0],[275,25,275,101,0],[276,25,276,92,0],[280,25,280,120,0],[282,25,282,44,0],[283,25,283,26,0],[284,29,286,109,0],[287,29,288,107,0],[289,29,289,70,0],[290,29,290,145,0],[293,29,293,75,0],[294,29,294,67,0],[295,29,295,188,0],[296,29,300,92,0],[301,29,305,90,0],[307,29,307,120,0],[308,29,308,30,0],[309,33,309,80,0],[310,29,310,30,0],[311,29,311,113,0],[312,29,312,30,0],[313,33,313,77,0],[314,29,314,30,0],[316,29,317,107,0],[318,29,318,30,0],[319,33,319,96,0],[320,29,320,30,0],[322,29,323,106,0],[324,29,324,30,0],[325,33,325,95,0],[326,29,326,30,0],[327,29,327,102,0],[328,29,328,30,0],[329,33,329,110,0],[330,29,330,30,0],[331,29,331,118,0],[332,29,332,30,0],[333,33,333,126,0],[334,29,334,30,0],[336,29,336,86,0],[337,29,337,69,0],[338,29,338,58,0],[340,29,340,82,0],[342,29,342,76,0],[343,25,343,26,0],[344,21,344,22,0],[346,21,346,22,0],[347,25,347,78,0],[348,25,348,67,0],[349,25,349,72,0],[350,21,350,22,0],[353,17,353,18,0],[354,13,354,14,0],[355,13,355,33,0],[356,13,356,14,0],[357,17,357,98,0],[358,13,358,14,0],[359,9,359,10,0],[362,9,362,10,0],[363,13,363,76,0],[365,13,365,28,0],[366,13,366,14,0],[367,17,367,53,0],[368,17,368,71,0],[369,17,369,70,0],[370,17,370,48,0],[372,17,372,86,0],[373,13,373,14,0],[374,9,374,10,0],[378,9,378,10,0],[379,13,379,42,0],[380,9,380,10,0],[384,9,384,10,0],[385,13,385,28,0],[386,9,386,10,0],[389,9,389,10,0],[390,13,390,60,0],[391,9,391,10,0],[394,9,394,10,0],[395,13,395,71,0],[396,13,396,14,0],[397,17,399,70,0],[402,13,402,14,0],[403,17,403,62,0],[404,17,404,18,0],[405,21,407,131,0],[410,17,410,18,0],[411,21,412,165,0],[415,9,415,10,0],[418,9,418,10,0],[419,13,419,76,0],[420,13,420,41,0],[421,13,421,48,0],[422,13,422,14,0],[423,17,423,46,0],[424,17,424,18,0],[425,21,428,51,0],[429,21,429,46,0],[431,21,431,55,0],[433,21,433,58,0],[434,21,434,67,0],[435,21,435,70,0],[436,21,436,46,0],[437,17,437,18,0],[439,17,439,18,0],[440,21,440,89,0],[441,21,444,52,0],[445,21,445,45,0],[446,17,446,18,0],[447,13,447,14,0],[449,13,449,39,0],[450,13,450,14,0],[451,17,451,52,0],[452,17,452,18,0],[453,21,453,89,0],[454,21,454,55,0],[456,21,456,46,0],[457,21,457,22,0],[462,25,462,49,0],[463,25,463,50,0],[464,25,464,52,0],[465,25,465,42,0],[466,25,466,50,0],[467,25,467,48,0],[468,25,468,40,0],[469,25,469,42,0],[470,25,470,59,0],[471,25,471,32,0],[471,34,471,43,0],[471,44,471,46,0],[471,47,471,57,0],[472,25,472,26,0],[473,29,473,107,0],[474,29,474,108,0],[475,29,475,81,0],[476,29,476,70,0],[478,29,478,53,0],[481,29,481,42,0],[482,29,482,54,0],[483,29,483,99,0],[484,29,484,46,0],[486,29,486,65,0],[487,29,487,54,0],[488,29,488,68,0],[489,29,489,71,0],[490,29,490,55,0],[491,29,491,78,0],[492,29,494,61,0],[495,29,495,70,0],[496,29,496,49,0],[497,29,497,54,0],[499,29,499,56,0],[500,29,500,46,0],[502,29,502,54,0],[503,29,503,121,0],[504,29,504,46,0],[506,29,506,54,0],[507,29,507,138,0],[508,29,508,46,0],[509,29,509,54,0],[510,29,510,85,0],[511,29,511,83,0],[512,29,512,46,0],[513,29,513,63,0],[514,25,514,26,0],[516,25,516,90,0],[517,21,517,22,0],[518,17,518,18,0],[519,13,519,14,0],[520,9,520,10,0],[523,9,523,10,0],[525,13,525,14,0],[526,17,526,43,0],[527,17,527,18,0],[528,21,528,100,0],[531,21,531,69,0],[532,21,532,22,0],[533,25,533,105,0],[535,25,535,32,0],[537,26,537,83,0],[538,21,538,22,0],[539,25,539,110,0],[541,25,541,32,0],[545,21,545,43,0],[548,21,548,55,0],[550,21,550,71,0],[551,21,551,22,0],[552,25,554,61,0],[555,21,555,22,0],[556,21,556,40,0],[557,17,557,18,0],[558,13,558,14,0],[559,13,559,33,0],[560,13,560,14,0],[561,17,561,98,0],[562,13,562,14,0],[563,9,563,10,0],[590,17,590,18,0],[590,19,590,128,0],[590,129,590,130,0],[596,13,596,14,0],[597,17,597,37,0],[598,13,598,14,0],[600,13,600,14,0],[600,15,600,16,0],[604,9,604,10,0],[604,11,604,12,0],[606,89,606,90,0],[606,91,606,92,0],[608,51,608,55,0],[608,56,608,60,0],[617,9,617,10,0],[618,13,618,29,0],[619,13,619,85,0],[620,13,620,37,0],[621,9,621,10,0],[624,9,624,10,0],[625,13,625,49,0],[630,17,630,18,0],[630,19,630,35,0],[630,36,630,37,0],[636,13,636,14,0],[637,17,639,105,0],[640,17,640,38,0],[641,13,641,14,0],[644,9,644,50,0],[647,17,647,18,0],[647,19,647,35,0],[647,36,647,37,0],[652,17,652,18,0],[652,19,652,36,0],[652,37,652,38,0],[657,17,657,18,0],[657,19,657,31,0],[657,32,657,33,0],[662,17,662,18,0],[662,19,662,65,0],[662,66,662,67,0],[668,13,668,14,0],[669,17,669,26,0],[670,13,670,14,0],[675,17,675,18,0],[675,19,675,43,0],[675,44,675,45,0],[679,9,679,10,0],[680,13,680,41,0],[681,9,681,10,0],[684,9,684,10,0],[685,13,685,72,0],[688,13,688,14,0],[689,17,689,49,0],[690,17,690,59,0],[703,17,703,74,0],[704,17,704,18,0],[709,21,709,101,0],[712,17,712,46,0],[713,17,713,65,0],[714,17,714,62,0],[715,17,715,74,0],[716,17,716,49,0],[717,17,717,45,0],[718,17,718,63,0],[719,17,719,54,0],[720,17,720,82,0],[721,17,721,105,0],[722,17,724,44,0],[725,17,727,48,0],[729,17,731,47,0],[733,17,735,51,0],[737,17,737,107,0],[738,17,738,78,0],[739,21,739,128,0],[741,17,741,84,0],[742,17,742,62,0],[743,22,743,31,0],[743,33,743,52,0],[743,54,743,57,0],[744,21,744,119,0],[745,17,745,50,0],[746,17,746,112,0],[747,17,747,70,0],[748,17,748,18,0],[749,21,749,57,0],[750,17,750,18,0],[752,17,752,18,0],[753,21,753,58,0],[754,17,754,18,0],[756,17,756,65,0],[757,17,757,18,0],[758,21,758,59,0],[759,17,759,18,0],[761,17,761,18,0],[762,21,762,60,0],[763,17,763,18,0],[765,17,765,62,0],[766,17,766,18,0],[767,21,767,51,0],[768,17,768,18,0],[770,17,770,18,0],[771,21,771,52,0],[772,17,772,18,0],[774,17,774,34,0],[775,17,775,62,0],[776,17,776,18,0],[777,21,777,79,0],[778,21,778,44,0],[779,21,779,22,0],[780,25,780,70,0],[781,25,781,61,0],[782,21,782,22,0],[784,21,785,110,0],[786,21,786,60,0],[787,21,787,80,0],[789,21,789,72,0],[790,21,790,22,0],[796,25,796,124,0],[798,17,798,18,0],[799,22,799,67,0],[800,17,800,18,0],[801,21,801,110,0],[803,21,803,39,0],[804,21,804,22,0],[805,25,805,90,0],[810,17,810,18,0],[812,17,812,36,0],[813,17,813,18,0],[819,21,819,148,0],[822,17,822,18,0],[823,21,823,66,0],[824,21,824,22,0],[826,25,828,76,0],[831,25,831,61,0],[833,25,833,59,0],[834,25,834,59,0],[836,25,836,75,0],[838,25,838,61,0],[839,21,839,22,0],[840,21,840,107,0],[841,21,841,110,0],[843,21,854,24,0],[856,21,856,105,0],[857,21,857,66,0],[858,21,858,22,0],[859,25,859,76,0],[860,25,860,127,0],[861,25,861,74,0],[862,21,862,22,0],[864,21,864,22,0],[865,25,865,175,0],[866,21,866,22,0],[868,21,868,151,0],[869,21,869,22,0],[871,25,871,129,0],[872,29,872,51,0],[873,33,873,112,0],[874,21,874,22,0],[877,21,888,24,0],[891,21,902,24,0],[904,21,904,60,0],[905,21,905,158,0],[907,21,907,33,0],[923,13,923,33,0],[924,13,924,14,0],[925,17,925,98,0],[926,17,926,49,0],[929,9,929,10,0],[934,9,934,10,0],[935,13,935,69,0],[936,17,936,112,0],[938,17,938,58,0],[939,9,939,10,0]]);
    </script>
  </body>
</html>