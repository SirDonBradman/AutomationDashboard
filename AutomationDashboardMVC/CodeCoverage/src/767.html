<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Business Layer\Integration Connectors\IntegrationConnectorManager.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Reflection;
using System.Web;
using System.Web.UI;
using System.Xml;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.AMP3.Logging;
using Aurigo.AMP3.Resources.MessageResources;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.Common.Utility;

namespace Aurigo.AMP3.Core.IntegrationConnector
{
    /// &lt;summary&gt;
    /// 
    /// &lt;/summary&gt;
    public enum AMP3ObjectType
    {
        Unknown = -1,
        Estimate = 0,
        ContMgmt,
        Project,
        Library
    }

    /// &lt;summary&gt;
    /// 
    /// &lt;/summary&gt;
    public class IntegrationConnectorManager //singleton base cannot be used here: SingletonManagerBase&lt;IntegrationConnectorManager&gt;
    {
        private const string EISCompany = &quot;Company&quot;;
        private const string EISDLL = &quot;DLLPath&quot;;
        private const string EISModuleOn = &quot;ON&quot;;
        private const string ObjectId = &quot;ObjectId&quot;;
        private const string Company = &quot;AXCompany&quot;;
        private const string ObjectType = &quot;ObjectType&quot;;
        private const string ERPCompany = &quot;ERPCompany&quot;;
        private const string DelimiterInKey = &quot;_&quot;;
        private DataSet dsEISSettings;
        private DataTable dtEISInfo;
        public Dictionary&lt;string, EISObject&gt; dictionaryConnectors;


        private static volatile Dictionary&lt;string, IntegrationConnectorManager&gt; _Inst = null;
        private static readonly object _oSync = new object();

        public static IntegrationConnectorManager Instance
        {
            get
            {
                if (_Inst == null)
                {
                    lock (_oSync)
                    {
                        if (_Inst == null) _Inst = new Dictionary&lt;string, IntegrationConnectorManager&gt;();
                    }
                }

                string currentCompany = ConnectionHelper.GetCurrentCompany();
                if (!_Inst.ContainsKey(currentCompany))
                {
                    lock (_oSync)
                    {
                        if (!_Inst.ContainsKey(currentCompany))
                        {
                            IntegrationConnectorManager instance = new IntegrationConnectorManager();
                            _Inst.Add(currentCompany, instance);
                            instance.InitInstance();
                        }
                    }
                }

                return _Inst[currentCompany];
            }
        }

        #region Private Methods

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        public IntegrationConnectorManager()
        {
        }

        private void InitInstance()
        {
            dictionaryConnectors = new Dictionary&lt;string, EISObject&gt;();
            dtEISInfo = IntegrationConnectorComponent.Instance.GetEISInfo();

            dsEISSettings = IntegrationConnectorComponent.Instance.GetEISSettings();

            foreach (DataRow drRegisteredEIS in dtEISInfo.Rows)
            {
                CreateEISInstance(drRegisteredEIS);
            }
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;Key&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public IntegrationConnectorInterface this[string Key]
        {
            get
            {
                if (dictionaryConnectors.ContainsKey(Key))
                {
                    return dictionaryConnectors[Key].ConnectorObject;
                }
                else
                {
                    return CreateEISInstance(GetEISFromKey(Key)).ConnectorObject;
                }
            }
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;registeredEIS&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private IntegrationConnectorInterface this[RegisteredEIS registeredEIS]
        {
            get
            {
                foreach (var pair in dictionaryConnectors)
                {
                    if (pair.Key.StartsWith2(registeredEIS.ToString2() + DelimiterInKey))
                        return pair.Value.ConnectorObject;
                }
                return null;
            }
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;registeredEIS&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;additionalInfo&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private string GetDictionaryKey(RegisteredEIS registeredEIS, EISAdditionalInfo additionalInfo)
        {
            // TODO : Check this - HashCode might not work
            return (registeredEIS.ToString2().ToUpper2() + DelimiterInKey +
                    (((additionalInfo != null) &amp;&amp; (additionalInfo[&quot;AXCompany&quot;] != null))
                        ? additionalInfo[&quot;AXCompany&quot;].ToString2().ToUpper2()
                        : &quot;&quot;));
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;registeredEIS&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private EISObject CreateEISInstance(RegisteredEIS registeredEIS)
        {
            if (registeredEIS == RegisteredEIS.Unknown)
                return null;

            return CreateEISInstance((int)registeredEIS);
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;EISID&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private EISObject CreateEISInstance(int EISID, DataTable dt = null)
        {
            dt = (null == dt) ? Instance.dtEISInfo : dt;
            DataRow[] arrdrEISInfo = dt.Select(&quot;ID=&quot; + EISID.ToString2());

            if (arrdrEISInfo == null) return null;
            if (arrdrEISInfo.Length == 0) return null;

            return CreateEISInstance(arrdrEISInfo[0]);
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;drRegisteredEIS&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private EISObject CreateEISInstance(DataRow drRegisteredEIS)
        {
            string strEISName = drRegisteredEIS[&quot;EISName&quot;].ToString2();
            var enmRegisteredEIS = (RegisteredEIS)Enum.Parse(typeof (RegisteredEIS), strEISName);

            DataRow[] drSetting =
                Instance.dsEISSettings.Tables[0].Select(&quot;EISId=&quot; + (int)enmRegisteredEIS +
                                                        &quot; AND SettingName=&#39;AXCompany&#39;&quot;);
            string company = (drSetting != null &amp;&amp; drSetting.Length &gt; 0) ? drSetting[0][&quot;SettingValue&quot;].ToString2() : &quot;&quot;;

            string strKey = enmRegisteredEIS.ToString2().ToUpper2() + DelimiterInKey + company.ToUpper2();
            if (Instance.dictionaryConnectors.ContainsKey(strKey))
                return Instance.dictionaryConnectors[strKey];

            IntegrationConnectorInterface integrationConnectorInterface =
                IntegrationConnectorInterfaceFactory.GetInstance(
                    strEISName,
                    drRegisteredEIS[&quot;EISAssembly&quot;].ToString2(),
                    drRegisteredEIS[&quot;EISClassName&quot;].ToString2());

            var objEIS = new EISObject(enmRegisteredEIS, integrationConnectorInterface);
            Instance.dictionaryConnectors.Add(strKey, objEIS);
            return objEIS;
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private RegisteredEIS GetEISFromKey(string key)
        {
            try
            {
                return
                    (RegisteredEIS)
                        Enum.Parse(typeof (RegisteredEIS),
                            key.Substring(0, key.IndexOf(DelimiterInKey, StringComparison.OrdinalIgnoreCase)));
            }
            catch
            {
                return RegisteredEIS.Unknown;
            }
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;strAdditionalEISInfo&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;dtObjectType&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;dsData&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;registeredEIS&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private NonQueryStatus DeleteERPObject(EISAdditionalInfo additionalInfo, EISObjectType dtObjectType,
            DataSet dsData, RegisteredEIS registeredEIS)
        {
            string strKey = GetDictionaryKey(registeredEIS, additionalInfo);
            return ((this[strKey] == null)
                ? (NonQueryStatus.GetNullCheckedObject(null))
                : (this[strKey].DeleteERPObject(additionalInfo, dtObjectType, dsData)));
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;filterCriteria&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private DataSet XMLToDataTable(string filterCriteria)
        {
            var doc = new XmlDocument();
            //Replacing the &amp; otherwise it will throw error while loading the XML document.
            filterCriteria = filterCriteria.Replace(&quot;&amp;&quot;, &quot;&amp;amp;&quot;);
            doc.LoadXml(filterCriteria);
            DataSet ds = new BrixDataSet();
            DataTable dt = new BrixDataTable();
            string type = null;
            XmlNode root = doc.DocumentElement;
            foreach (XmlNode node in root.ChildNodes)
            {
                var dc = new DataColumn(node.Name);
                if (node.Attributes[0].Value.Equals(&quot;txt&quot;))
                {
                    type = &quot;System.String&quot;;
                }
                if (node.Attributes[0].Value.Equals(&quot;int&quot;))
                {
                    type = &quot;System.Int32&quot;;
                }
                if (node.Attributes[0].Value.Equals(&quot;real&quot;))
                {
                    type = &quot;System.Double&quot;;
                }
                if (node.Attributes[0].Value.Equals(&quot;dc&quot;) || node.Attributes[0].Value.Equals(&quot;date&quot;))
                {
                    type = &quot;System.DateTime&quot;;
                }
                if (!dt.Columns.Contains(node.Name))
                {
                    dt.Columns.Add(dc.ToString2(), Type.GetType(type));
                }
            }
            DataRow dr = dt.NewRow();
            foreach (XmlNode node in root.ChildNodes)
            {
                dr[node.Name] = node.InnerText;
            }
            dt.Rows.Add(dr);
            ds.Tables.Add(dt);
            return ds;
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sortOrder&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private DataSet SortCriteriaToDataTable(string sortOrder)
        {
            string strColName = &quot;&quot;;
            string strOrder = &quot;&quot;;
            DataSet dsSortOrder = new BrixDataSet();
            DataTable dtSortOrder = new BrixDataTable();

            sortOrder = sortOrder.Trim();
            strColName = sortOrder.Substring(0, sortOrder.Length - 4).Trim();
            strOrder = sortOrder.Substring(sortOrder.Length - 4, 4).Trim();

            /* Removal of Square brackets from the Brix sortorder columns */
            if (strColName.Contains(&quot;[&quot;) || strColName.Contains(&quot;]&quot;))
            {
                strColName = strColName.Remove(0, 1);
                strColName = strColName.Remove(strColName.Length - 1, 1);
            }

            //iFirstIndex = sortOrder.IndexOf(&quot; &quot;);
            //strColName = sortOrder.Substring(0, iFirstIndex);
            //strOrder = sortOrder.Substring(++iFirstIndex);

            dtSortOrder.Columns.Add(strColName);
            DataRow drSort = dtSortOrder.NewRow();
            drSort[strColName] = strOrder;
            dtSortOrder.Rows.Add(drSort);

            dsSortOrder.Tables.Add(dtSortOrder);
            return dsSortOrder;
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;dt&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private string GetSortValueAsString(DataTable dt)
        {
            //Assumption : One column,One Row
            //TODO : MultiSort ??

            string strSortValue = &quot;&quot;;
            string strTableId = &quot;%1&quot;;

            int tableId = 1;

            foreach (DataColumn dc in dt.Columns)
            {
                if (!string.IsNullOrEmpty(dt.Rows[0][dc].ToString2()))
                {
                    strSortValue = dc.ColumnName;
                    if (strSortValue.Contains(&quot;Table&quot;))
                    {
                        string[] strTemp = strSortValue.Split(new[] { &#39;_&#39; });
                        tableId = strTemp[0].Substring(5).ToInt32_2();
                        strSortValue = strTemp[1];
                        strTableId = &quot;%&quot; + tableId;
                    }
                    else
                        strTableId = &quot;%1&quot;;

                    strSortValue = strTableId + &quot;.&quot; + strSortValue + &quot; &quot; + dt.Rows[0][dc].ToString2();
                }
            }
            return strSortValue;
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;strAdditionalInfo&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;enmAMP3ObjectType&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;strERPObject&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;strERPAction&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;selectedAttributes&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;filterCriteria&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;sortOrder&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;startRowIndex&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;noOfRowsToFetch&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;registeredEIS&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;amp3ClassName&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;amp3MethodName&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private QueryStatus ExecuteERPQueryTrigger(EISAdditionalInfo additionalInfo, AMP3ObjectType enmAMP3ObjectType,
            string strERPObject, string strERPAction, string[] selectedAttributes,
            EISFilter[] filterCriteria, string sortOrder, int? startRowIndex,
            int? noOfRowsToFetch, RegisteredEIS registeredEIS,
            string amp3ClassName, string amp3MethodName)
        {
            EISActions enmActionType = GetERPActionType(strERPAction);
            EISObjectType enmObjectType = GetERPObjectType(strERPObject);
            QueryStatus objSelectStatus = null;
            DataSet dsMain = null;

            if (enmObjectType == EISObjectType.Undefined)
                return
                    (new QueryStatus(EISOperationState.Failure, new Exception(&quot;Undefinded EIS Object Type&quot;), null, 0));

            if (additionalInfo != null &amp;&amp; registeredEIS == RegisteredEIS.AX)
            {
                additionalInfo.AddInfo(Company, additionalInfo[&quot;AXCompany&quot;].ToString2());
            }


            switch (enmActionType)
            {
                case EISActions.Select:
                {
                    objSelectStatus = GetDTObjectAsDataSet(additionalInfo, enmObjectType, selectedAttributes,
                        filterCriteria, sortOrder, startRowIndex, noOfRowsToFetch,
                        EISSelectType.Normal, registeredEIS);
                    break;
                }
                case EISActions.SelectWithChildLevel:
                {
                    objSelectStatus = GetDTObjectAsDataSet(additionalInfo, enmObjectType, selectedAttributes,
                        filterCriteria, sortOrder, startRowIndex, noOfRowsToFetch,
                        EISSelectType.SelectSingle, registeredEIS);
                    break;
                }
                case EISActions.SelectCount:
                {
                    objSelectStatus = GetDTObjectAsDataSet(additionalInfo, enmObjectType, selectedAttributes,
                        filterCriteria, sortOrder, startRowIndex, noOfRowsToFetch,
                        EISSelectType.SelectCount, registeredEIS);
                    break;
                }
                case EISActions.SelectJoinCount:
                {
                    objSelectStatus = GetDTObjectAsDataSet(additionalInfo, enmObjectType, selectedAttributes,
                        filterCriteria, sortOrder, startRowIndex, noOfRowsToFetch,
                        EISSelectType.SelectJoinCount, registeredEIS);
                    break;
                }

                default:
                    return (new QueryStatus(EISOperationState.Failure, new Exception(&quot;Unrecognized Command&quot;), null, 0));
            }

            if (objSelectStatus.Status == EISOperationState.Success)
            {
                if (enmActionType.Equals(EISActions.Select) || enmActionType.Equals(EISActions.SelectWithChildLevel))
                {
                    DataSet dsTable = IntegrationConnectorComponent.Instance.GetTableInfo(amp3ClassName, amp3MethodName,
                        registeredEIS, strERPObject);
                    DataTable dtTable = dsTable.Tables[0];
                    int iCount = 0;
                    while (iCount &lt; dtTable.Rows.Count)
                    {
                        int Index = dtTable.Rows[iCount][&quot;TableIndex&quot;].ToString2().Parse2();
                        objSelectStatus.ERPDataSet.Tables[Index].TableName =
                            dtTable.Rows[iCount][&quot;TableName&quot;].ToString2();
                        //get the tableid
                        iCount++;
                    }
                    dsMain = GetMappedDataSetFromERPToAMP3(objSelectStatus.ERPDataSet, enmObjectType, enmAMP3ObjectType,
                        true, registeredEIS);
                    objSelectStatus.ERPDataSet = dsMain;
                }

                return objSelectStatus;
            }
            else
            {
                throw objSelectStatus.Exception;
            }
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;dsMain&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;enmObjectType&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;enmAMP3ObjectType&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;IsERPToAMP3&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;registeredEIS&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private DataSet GetMappedDataSetFromERPToAMP3(DataSet dsMain, EISObjectType enmObjectType,
            AMP3ObjectType enmAMP3ObjectType, bool IsERPToAMP3,
            RegisteredEIS registeredEIS)
        {
            DataSet dsTemp = dsMain.Copy();
            string srcColumn = IsERPToAMP3 ? &quot;ERPColumn&quot; : &quot;AMP3Column&quot;;
            string destColumn = IsERPToAMP3 ? &quot;AMP3Column&quot; : &quot;ERPColumn&quot;;
            int iTableCount = 0;
            while (iTableCount &lt; dsTemp.Tables.Count)
            {
                string tableName = dsTemp.Tables[iTableCount].TableName;

                DataSet dsMap = IntegrationConnectorComponent.Instance.GetAllMappedData(enmObjectType, enmAMP3ObjectType,
                    tableName, registeredEIS);
                int iRowCount = 0;
                DataTable dtTempMain = dsMain.Tables[iTableCount];

                foreach (DataRow drMap in dsMap.Tables[0].Rows)
                {
                    if (drMap[destColumn].Equals(DBNull.Value))
                    {
                        // Its not required in Destination Table so remove it
                        if (dtTempMain.Columns[drMap[srcColumn].ToString2()] != null)
                            dtTempMain.Columns.Remove(drMap[srcColumn].ToString2());
                    }
                    else if (drMap[srcColumn].Equals(DBNull.Value))
                    {
                        // Its not there in Destination Table so add it
                        if (dtTempMain.Columns[drMap[destColumn].ToString2()] == null)
                            dtTempMain.Columns.Add(drMap[destColumn].ToString2(),
                                Type.GetType(drMap[&quot;Type&quot;].ToString2()));
                    }
                    else
                    {
                        // Its there in both tables so change destination column name as per mapping
                        if (dtTempMain.Columns[drMap[srcColumn].ToString2()] != null &amp;&amp; drMap[destColumn] != null)
                        {
                            dtTempMain.Columns[drMap[srcColumn].ToString2()].ColumnName = drMap[destColumn].ToString2();
                            // TODO : Cross check this type change part
                            //dsMain.Tables[iTableCount].Columns[drMap[srcColumn].ToString2()].DataType = Type.GetType(drMap[&quot;Type&quot;].ToString2());
                        }
                    }

                    if (IsERPToAMP3.Equals(true))
                    {
                        if (dsMap.Tables[0].Rows[iRowCount][&quot;IsMandatory&quot;].Equals(true))
                        {
                            if (dsMap.Tables[0].Rows[iRowCount][&quot;Type&quot;].Equals(&quot;System.Int32&quot;))
                            {
                                int iInnerLoopCount = 0;
                                int rowCount = dtTempMain.Rows.Count;
                                while (iInnerLoopCount &lt; rowCount)
                                {
                                    dtTempMain.Rows[iInnerLoopCount][drMap[destColumn].ToString2()] = iInnerLoopCount +
                                                                                                      1;
                                    iInnerLoopCount++;
                                }
                                //  dsMain.Tables[0].Rows[drMap[srcColumn.]][i] = i++;
                            }
                        }
                    }
                    iRowCount++;
                }
                iTableCount++;
            }

            return dsMain;
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;objectName&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private EISObjectType GetERPObjectType(string objectName)
        {
            if (!Enum.IsDefined(typeof (EISObjectType), objectName))
                return EISObjectType.Undefined;

            return (EISObjectType)(Enum.Parse(typeof (EISObjectType), objectName));
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;actionName&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private EISActions GetERPActionType(string actionName)
        {
            if (!Enum.IsDefined(typeof (EISActions), actionName))
                return EISActions.Undefined;

            return (EISActions)(Enum.Parse(typeof (EISActions), actionName));
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;strAdditionalEISInfo&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;logonInfo&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;registeredEIS&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private EISOperationStatus Logon(EISAdditionalInfo additionalInfo, Dictionary&lt;string, string&gt; logonInfo,
            RegisteredEIS registeredEIS)
        {
            string strKey = GetDictionaryKey(registeredEIS, additionalInfo);
            var objStatus = new EISOperationStatus(EISOperationState.Failure, new Exception(&quot;EIS is not recognized&quot;));
            if (this[strKey] != null)
            {
                objStatus = this[strKey].Logon(logonInfo);
                if (objStatus.Status == EISOperationState.Success)
                {
                    dictionaryConnectors[strKey].IsLoggedOn = true;
                }
            }
            return objStatus;
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;strAdditionalInfo&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;registeredEIS&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private EISOperationStatus Logoff(EISAdditionalInfo additionalInfo, RegisteredEIS registeredEIS)
        {
            string strKey = GetDictionaryKey(registeredEIS, additionalInfo);
            var objStatus = new EISOperationStatus(EISOperationState.Failure, new Exception(&quot;EIS is not logged in.&quot;));
            EISObject objEIS = (dictionaryConnectors.ContainsKey(strKey)) ? dictionaryConnectors[strKey] : null;

            if (objEIS != null)
            {
                if (objEIS.IsLoggedOn)
                {
                    objStatus = objEIS.ConnectorObject.Logoff(additionalInfo);
                    if (objStatus.Status == EISOperationState.Success)
                    {
                        objEIS.IsLoggedOn = false;
                    }
                }
            }
            return objStatus;
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;strAdditionalEISInfo&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;dtObjectType&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;selectedAttributes&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;filterCriteria&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;sortOrder&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;startRowIndex&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;noOfRowsToFetch&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;selectType&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;registeredEIS&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private QueryStatus GetDTObjectAsDataSet(EISAdditionalInfo additionalInfo, EISObjectType dtObjectType,
            string[] selectedAttributes, EISFilter[] filterCriteria,
            string sortOrder, int? startRowIndex, int? noOfRowsToFetch,
            EISSelectType selectType, RegisteredEIS registeredEIS)
        {
            string strKey = GetDictionaryKey(registeredEIS, additionalInfo);
            return ((this[strKey] == null)
                ? QueryStatus.GetNullCheckedObject(null)
                : this[strKey].GetERPObjectAsDataSet(additionalInfo, dtObjectType, selectedAttributes,
                    filterCriteria, sortOrder, startRowIndex, noOfRowsToFetch,
                    selectType));
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;strAdditionalEISInfo&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;dtObjectType&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;dsData&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;registeredEIS&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private NonQueryStatus PutDTObject(EISAdditionalInfo additionalInfo, EISObjectType dtObjectType, DataSet dsData,
            RegisteredEIS registeredEIS)
        {
            string strKey = GetDictionaryKey(registeredEIS, additionalInfo);
            return ((this[strKey] == null)
                ? NonQueryStatus.GetNullCheckedObject(null)
                : this[strKey].AddERPObject(additionalInfo, dtObjectType, dsData));
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;strAdditionalEISInfo&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;dtObjectType&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;dsData&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;registeredEIS&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private NonQueryStatus SetDTObject(EISAdditionalInfo additionalInfo, EISObjectType dtObjectType, DataSet dsData,
            RegisteredEIS registeredEIS)
        {
            string strKey = GetDictionaryKey(registeredEIS, additionalInfo);
            return ((this[strKey] == null)
                ? NonQueryStatus.GetNullCheckedObject(null)
                : this[strKey].UpdateERPObject(additionalInfo, dtObjectType, dsData));
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;strAdditionalEISInfo&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;enmAMP3ObjectType&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;strERPObject&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;strERPAction&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;ds&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;registeredEIS&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private NonQueryStatus ExecuteERPNonQueryTrigger(EISAdditionalInfo additionalInfo,
            AMP3ObjectType enmAMP3ObjectType, string strERPObject,
            string strERPAction, DataSet ds, RegisteredEIS registeredEIS)
        {
            EISActions enmActionType = GetERPActionType(strERPAction);
            EISObjectType enmObjectType = GetERPObjectType(strERPObject);
            List&lt;MapInfo&gt; BrixEISMapInfo;
            if (enmObjectType == EISObjectType.Undefined)
                return (new NonQueryStatus(EISOperationState.Failure, new Exception(&quot;Undefined EIS Object Type&quot;), 0));

            if (ds == null)
            {
                return null;
            }
            else
            {
                if (ds.Tables.Count == 0)
                    return null;
                if (ds.Tables[0].Rows.Count == 0)
                    return null;
            }
            switch (enmActionType)
            {
                case EISActions.Insert:
                {
                    NonQueryStatus objInsertStatus = PutDTObject(additionalInfo, enmObjectType,
                        GetMappedDataSetFromERPToAMP3(ds, enmObjectType,
                            enmAMP3ObjectType,
                            false, registeredEIS),
                        registeredEIS);
                    BrixEISMapInfo = objInsertStatus.BrixEISMapInfo;
                    if (BrixEISMapInfo != null &amp;&amp; objInsertStatus.Status == EISOperationState.Success)
                        AddBrixEISMapInfo(registeredEIS, BrixEISMapInfo);
                    return objInsertStatus;
                }
                case EISActions.Update:
                {
                    NonQueryStatus objUpdateStatus = SetDTObject(additionalInfo, enmObjectType,
                        GetMappedDataSetFromERPToAMP3(ds, enmObjectType,
                            enmAMP3ObjectType,
                            false, registeredEIS),
                        registeredEIS);
                    return objUpdateStatus;
                }
                case EISActions.Delete:
                {
                    NonQueryStatus objDeleteStatus = DeleteERPObject(additionalInfo, enmObjectType,
                        GetMappedDataSetFromERPToAMP3(ds, enmObjectType,
                            enmAMP3ObjectType,
                            false,
                            registeredEIS),
                        registeredEIS);
                    return objDeleteStatus;
                }
                default:
                    return null;
            }
        }

        private void AddBrixEISMapInfo(RegisteredEIS registeredEIS, List&lt;MapInfo&gt; BrixEISMapInfo)
        {
            int i = 0;
            while (i &lt; BrixEISMapInfo.Count)
            {
                var dataDict = new Dictionary&lt;string, object&gt;();
                dataDict.Add(&quot;ObjectId&quot;, BrixEISMapInfo[i].ObjectId.ToString2());
                dataDict.Add(&quot;AXCompany&quot;, BrixEISMapInfo[i].AXCompany.ToString2());
                dataDict.Add(&quot;ObjectType&quot;, BrixEISMapInfo[i].ObjectType.ToString2());
                Instance.AddERPMapInfo(BrixEISMapInfo[i].AMP3ObjectId.ToString2(),
                    (AMP3Object)
                        (Enum.Parse(typeof (AMP3Object), BrixEISMapInfo[i].AMP3ObjectType.ToString2())),
                    BrixEISMapInfo[i].AMP3ParentId.ToString2(),
                    (AMP3Object)
                        (Enum.Parse(typeof (AMP3Object), BrixEISMapInfo[i].AMP3ParentType.ToString2())),
                    dataDict, registeredEIS);
                i++;
            }
        }

        #endregion

        #region Public Methods

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;connectionParameter&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;dsMain&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;registeredEIS&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;dtTrigger&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public NonQueryStatus[] ExecuteERPTrigger(ConnectorParameters connectionParameter, DataSet dsMain,
            RegisteredEIS registeredEIS, DataTable dtTrigger)
        {
            connectionParameter = ConnectorParameters.GetNullCheckedObject(connectionParameter);
            string amp3ClassName = connectionParameter.strAMP3ClassName;
            string amp3MethodName = connectionParameter.strAMP3MethodName;
            EISAdditionalInfo specificEISadditionalInfo = null;
            //Retrieving the individual EIS additional info
            if (connectionParameter.AdditionalInfo != null)
            {
                specificEISadditionalInfo = connectionParameter.AdditionalInfo[registeredEIS];
            }

            NonQueryStatus[] arrobjQS = null;
            AMP3ObjectType enmAMP3ObjectType = connectionParameter.enmAMP3ObjectType;
            if (dtTrigger != null &amp;&amp; dtTrigger.Rows.Count &gt; 0)
            {
                arrobjQS = new NonQueryStatus[dtTrigger.Rows.Count];
                int iRowCount = 0;
                string strERPId = &quot;&quot;;
                string strColName = &quot;&quot;;
                List&lt;ConnectionBrixInfo&gt; lstMapInfo = connectionParameter.lstBrixMapInfo;

                foreach (DataRow dr in dtTrigger.Rows)
                {
                    string strObject = dr[0].ToString2();
                    string strAction = dr[1].ToString2();

                    DataSet dsFinal = new BrixDataSet();
                    DataSet dsTemp = dsMain.Copy();
                    int iCount = 0;
                    DataSet dsTable = IntegrationConnectorComponent.Instance.GetTableInfo(amp3ClassName, amp3MethodName,
                        registeredEIS, strObject);
                    DataTable dtTable = dsTable.Tables[0];

                    if (dtTable.Rows.Count &gt; 0)
                    {
                        while (iCount &lt; dtTable.Rows.Count)
                        {
                            int Index = dtTable.Rows[iCount][&quot;TableIndex&quot;].ToString2().Parse2();
                            dsTemp.Tables[Index].TableName = dtTable.Rows[iCount][&quot;TableName&quot;].ToString2();
                            // dsFinal.Merge(dsTemp.Tables[Index]);
                            DataTable dt = dsTemp.Tables[Index].Copy();
                            dsFinal.Tables.Add(dt);
                            //get the tableid
                            iCount++;
                        }
                    }
                    else
                    {
                        dsFinal = dsMain;
                    }
                    foreach (ConnectionBrixInfo conInfo in lstMapInfo)
                    {
                        DataTable dtMap = Instance.GetERPObjectMapInfo(conInfo.AMP3ObjectId, conInfo.AMP3ObjectType,
                            conInfo.AMP3ParentObjectId,
                            conInfo.AMP3ParentObjectType, registeredEIS);

                        if ((dtMap != null) &amp;&amp; (dtMap.Rows.Count &gt; 0))
                        {
                            strERPId = dtMap.Rows[0][&quot;ERPId&quot;].ToString2();
                            // TODO : Put some comments ... else no1 can understand this code
                            strColName = &quot;ERPId_&quot; + conInfo.AMP3ObjectType.ToString2();
                            if (!dsFinal.Tables[0].Columns.Contains(strColName))
                                dsFinal.Tables[0].Columns.Add(strColName);
                            foreach (DataRow drNew in dsFinal.Tables[0].Rows)
                            {
                                drNew[strColName] = strERPId;
                            }
                        }
                    }


                    bool bQueryStatus = dr[2].ToBoolean2();
                    if (!bQueryStatus)
                    {
                        arrobjQS[iRowCount] = ExecuteERPNonQueryTrigger(specificEISadditionalInfo, enmAMP3ObjectType,
                            strObject, strAction, dsFinal, registeredEIS);
                        iRowCount++;
                    }
                }
            }
            return arrobjQS;
        }


        // TODO : Do we really need to return more than one QueryStatus (its fine for NonQuery)
        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;connectionParameter&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;registeredEIS&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;dtTrigger&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public QueryStatus[] ExecuteERPTrigger(ConnectorParameters connectionParameter, RegisteredEIS registeredEIS,
            DataTable dtTrigger)
        {
            connectionParameter = ConnectorParameters.GetNullCheckedObject(connectionParameter);
            string amp3ClassName = connectionParameter.strAMP3ClassName;
            string amp3MethodName = connectionParameter.strAMP3MethodName;
            string filter = connectionParameter.objConnectionFilter.FilterSearch;
            AMP3ObjectType enmAMP3ObjectType = connectionParameter.enmAMP3ObjectType;
            string[] selectedAttributes = connectionParameter.objConnectionFilter.SelectedAttributes;
            int? startRowIndex = connectionParameter.objConnectionFilter.StartIndex;
            int? noOfRowsToFetch = connectionParameter.objConnectionFilter.MaxRowsPerPage;
            string sortOrder = connectionParameter.objConnectionFilter.SortOrder;

            //Retrieving the individual EIS additional info
            EISAdditionalInfo specificEISadditionalInfo = null;
            if (connectionParameter.AdditionalInfo != null)
            {
                specificEISadditionalInfo = connectionParameter.AdditionalInfo[registeredEIS];
            }

            DataTable dt = dtTrigger.Copy();
            DataSet dsMain = null;
            var arrobjQS = new QueryStatus[dt.Rows.Count];
            int iRowCount = 0;
            int i = 0;
            EISFilter[] mainfilterCriteria = null;
            string strSortOrder = &quot;&quot;;

            //Prepare FilterCriteria
            foreach (DataRow dr in dt.Rows)
            {
                string strObject = dr[0].ToString2();
                string strAction = dr[1].ToString2();
                bool bQueryStatus = dr[2].ToBoolean2();
                if (!string.IsNullOrEmpty(filter))
                {
                    dsMain = XMLToDataTable(filter);
                    int RowCount = dsMain.Tables[0].Columns.Count;
                    mainfilterCriteria = new EISFilter[dsMain.Tables[0].Columns.Count];
                    DataSet dsTemp = GetMappedDataSetFromERPToAMP3(dsMain, GetERPObjectType(strObject),
                        enmAMP3ObjectType, false, registeredEIS);

                    foreach (DataColumn dc in dsTemp.Tables[0].Columns)
                    {
                        foreach (DataRow drRow in dsTemp.Tables[0].Rows)
                        {
                            if (!drRow[dc].Equals(DBNull.Value))
                            {
                                if (drRow[dc].GetType().Name.Equals(&quot;String&quot;))
                                {
                                    mainfilterCriteria[i] = new EISFilter(dc.ColumnName, drRow[dc].ToString2(),
                                        EISColumnType.String,
                                        EISComparator.likeContain, EISPropagator.AND);
                                }
                                if (drRow[dc].GetType().Name.Equals(&quot;Double&quot;))
                                {
                                    mainfilterCriteria[i] = new EISFilter(dc.ColumnName, drRow[dc].ToString2(),
                                        EISColumnType.NumberRange,
                                        EISComparator.GreaterThanEqualTo,
                                        EISPropagator.AND);
                                }
                                if (drRow[dc].GetType().Name.Equals(&quot;Int32&quot;))
                                {
                                    mainfilterCriteria[i] = new EISFilter(dc.ColumnName, drRow[dc].ToString2(),
                                        EISColumnType.Number, EISComparator.Equal,
                                        EISPropagator.AND);
                                }
                                if (drRow[dc].GetType().Name.Equals(&quot;DateTime&quot;))
                                {
                                    mainfilterCriteria[i] = new EISFilter(dc.ColumnName, drRow[dc].ToString2(),
                                        EISColumnType.DateTime,
                                        EISComparator.likeStart, EISPropagator.AND);
                                }
                                i++;
                            }
                        }
                    }
                }
                else
                    mainfilterCriteria = null;

                //Prepare SortCriteria
                if (!string.IsNullOrEmpty(sortOrder))
                {
                    dsMain = SortCriteriaToDataTable(sortOrder);
                    dsMain = GetMappedDataSetFromERPToAMP3(dsMain, GetERPObjectType(strObject), enmAMP3ObjectType, false,
                        registeredEIS);
                    strSortOrder = GetSortValueAsString(dsMain.Tables[0]);
                }
                if (bQueryStatus)
                {
                    arrobjQS[iRowCount] = ExecuteERPQueryTrigger(specificEISadditionalInfo, enmAMP3ObjectType, strObject,
                        strAction,
                        selectedAttributes, mainfilterCriteria, strSortOrder,
                        startRowIndex, noOfRowsToFetch, registeredEIS,
                        amp3ClassName, amp3MethodName);
                    iRowCount++;
                }
            }

            return arrobjQS;
        }


        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;registeredEIS&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public Dictionary&lt;string, string&gt; GetEISSettings(RegisteredEIS registeredEIS)
        {
            return IntegrationConnectorComponent.Instance.GetEISSettings(registeredEIS);
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;amp3ObjectId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;amp3ObjectType&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;amp3ParentObjectId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;amp3ParentObjectType&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;registeredEIS&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public DataTable GetERPObjectMapInfo(string amp3ObjectId, AMP3Object amp3ObjectType, string amp3ParentObjectId,
            AMP3Object amp3ParentObjectType, RegisteredEIS registeredEIS)
        {
            return IntegrationConnectorComponent.Instance.GetERPObjectMapInfo(amp3ObjectId, amp3ObjectType,
                amp3ParentObjectId, amp3ParentObjectType,
                registeredEIS);
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;eisObjectType&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;EIS&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public DataTable GetEISFilterInfo(EISObjectType eisObjectType, RegisteredEIS EIS)
        {
            return IntegrationConnectorComponent.Instance.GetFilterInfo(eisObjectType, EIS);
        }


        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;amp3ObjectId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;AMP3ObjectType&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;AMP3ParentId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;AMP3ParentType&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;dictData&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;registeredEIS&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public int AddERPMapInfo(string amp3ObjectId, AMP3Object AMP3ObjectType, string AMP3ParentId,
            AMP3Object AMP3ParentType, Dictionary&lt;string, object&gt; dictData,
            RegisteredEIS registeredEIS)
        {
            return IntegrationConnectorComponent.Instance.AddERPMapInfo(amp3ObjectId, AMP3ObjectType, AMP3ParentId,
                AMP3ParentType, dictData, registeredEIS);
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;amp3ObjectId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;amp3ObjectType&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;AMP3ParentId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;AMP3ParentType&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;registeredEIS&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public int DeleteERPObjectMap(string amp3ObjectId, AMP3Object amp3ObjectType, string AMP3ParentId,
            AMP3Object AMP3ParentType, RegisteredEIS registeredEIS)
        {
            return IntegrationConnectorComponent.Instance.DeleteERPObjectMap(amp3ObjectId, amp3ObjectType, AMP3ParentId,
                AMP3ParentType, registeredEIS);
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;ContractID&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;getSummary&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;isMisc&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public DataSet GetRAItemList(int ContractID, string getSummary, string isMisc, string isForecast)
        {
            return IntegrationConnectorComponent.Instance.GetRAItemList(ContractID, getSummary, isMisc, isForecast);
        }

        public DataSet GetResourcesForForecast(int contractId, DateTime startDate, DateTime endDate, string MSPSyncCheck)
        {
            return IntegrationConnectorComponent.Instance.GetResourcesForForecast(contractId, startDate, endDate,
                MSPSyncCheck);
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;registeredEIS&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public bool IsIntegrationConnectorAttached(RegisteredEIS registeredEIS)
        {
            return (this[registeredEIS] != null);
        }

        public bool IsTriggerPointEnabled(ConnectorParameters connectorParameters)
        {
            //TODO: isTriggerPointExist flag still looks like Hack, Somu at later point we need to comeup with something better - Krishna
            bool isTriggerPointExist = false;
            string amp3ClassName = connectorParameters.strAMP3ClassName;
            string amp3MethodName = connectorParameters.strAMP3MethodName;

            if (dtEISInfo.Rows.Count &gt; 0)
            {
                DataSet dsMainTrigger = IntegrationConnectorComponent.Instance.GetTriggerInfo(amp3ClassName,
                    amp3MethodName);
                if (dsMainTrigger != null &amp;&amp; dsMainTrigger.Tables.Count &gt; 0 &amp;&amp; dsMainTrigger.Tables[0].Rows.Count &gt; 0)
                    isTriggerPointExist = true;
            }
            return isTriggerPointExist;
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public bool IsIntegrationConnectorLoggedIn(string key)
        {
            if (dictionaryConnectors.ContainsKey(key))
            {
                return dictionaryConnectors[key].IsLoggedOn;
            }
            else
                return false;
        }

        /// &lt;summary&gt;
        /// It will log the error in DataBase
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;message&quot;&gt;Exception message&lt;/param&gt;
        /// &lt;param name=&quot;source&quot;&gt;Module ID&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static int LogEISErrorMessage(string message, string source)
        {
            return Logger.Log(Enumerations.LogType.Error, message, source);
        }

        /// &lt;summary&gt;
        /// It handles the Integration for both query and non-query actions with respective EIS.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;connectorParameters&quot;&gt;parameters required for integration&lt;/param&gt;
        /// &lt;param name=&quot;count&quot;&gt;number of rows effected&lt;/param&gt;
        /// &lt;param name=&quot;ds&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;bQuery&quot;&gt;false if Nonquery,True if its a Query&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static bool HandleIntegration(ConnectorParameters connectorParameters, ref int count, ref DataSet ds,
            bool IsQuery, int projectID = 0)
        {
            //int projectID = 0;
            if (connectorParameters == null)
            {
                throw new Exception(&quot;Connector Parameters cannot be null&quot;);
            }

            if (connectorParameters.AdditionalInfo == null)
            {
                connectorParameters.AdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
            }
            string amp3ClassName = connectorParameters.strAMP3ClassName;
            string amp3MethodName = connectorParameters.strAMP3MethodName;
            //TODO: isTriggerPointExist flag still looks like Hack, Somu at later point we need to comeup with something better - Krishna
            bool isTriggerPointExist = false;
            QueryStatus[] objERPOutput = null;
            if (Instance.dtEISInfo.Rows.Count &gt; 0)
            {
                DataSet dsMainTrigger = IntegrationConnectorComponent.Instance.GetTriggerInfo(amp3ClassName,
                    amp3MethodName);
                DataTable dtt = Instance.dtEISInfo;
                foreach (DataRow row in dtt.Rows)
                {
                    var registeredEIS = (RegisteredEIS)row[&quot;ID&quot;].ToString2().Parse2();
                    //FILTER TRIGGER POINTS BASED ON EIS ID
                    DataTable dtTrigger = dsMainTrigger.Tables[0].Clone();
                    DataRow[] drTrigger = dsMainTrigger.Tables[0].Select(&quot;EISId=&quot; + (int)registeredEIS);
                    foreach (DataRow dr in drTrigger)
                    {
                        dtTrigger.ImportRow(dr);
                    }

                    # region Integration Date functionlity - Check for Project Integration Mode for all Connectors

                    for (int i = 0; i &lt; dtTrigger.Rows.Count; i++)
                    {
                        if (!Convert.ToBoolean(dtTrigger.Rows[i][&quot;IsIntegrationDateEnabled&quot;]))
                        {
                            if (CheckForProjectIntegrationMode(projectID))
                            {
                                dtTrigger.Rows.RemoveAt(i);
                                i--;
                            }
                        }
                    }

                    # endregion

                    Instance.HandleLogon(connectorParameters, dtTrigger, registeredEIS);
                    if (dtTrigger.Rows.Count &gt; 0)
                    {
                        isTriggerPointExist = true;
                    }
                    string strKey = string.Empty;
                    if (connectorParameters.AdditionalInfo.ContainsKey(registeredEIS))
                        strKey = Instance.GetDictionaryKey(registeredEIS,
                            connectorParameters.AdditionalInfo[registeredEIS]);
                    if (dtTrigger != null &amp;&amp; dtTrigger.Rows.Count &gt; 0)
                    {
                        if (Instance.IsIntegrationConnectorLoggedIn(strKey))
                        {
                            if (IsQuery)
                            {
                                objERPOutput = Instance.ExecuteERPTrigger(connectorParameters, registeredEIS, dtTrigger);
                                if (objERPOutput != null)
                                {
                                    if (objERPOutput.Length &gt; 0)
                                    {
                                        if (objERPOutput[0].Status == EISOperationState.Failure)
                                        {
                                            count = 0;
                                            throw objERPOutput[0].Exception;
                                        }
                                        else
                                        {
                                            count = objERPOutput[0].RowCount;
                                            if (objERPOutput[0].ERPDataSet != null)
                                            {
                                                ds = objERPOutput[0].ERPDataSet;
                                                return isTriggerPointExist;
                                            }
                                        }
                                    }
                                }
                            }
                            else // Non Query
                            {
                                NonQueryStatus[] objNonQuery = Instance.ExecuteERPTrigger(connectorParameters, ds,
                                    registeredEIS, dtTrigger);
                                string nonQueryErrors = &quot;&quot;;
                                foreach (NonQueryStatus nonQueryStatus in objNonQuery)
                                {
                                    if (nonQueryStatus != null)
                                    {
                                        if (nonQueryStatus.Status == EISOperationState.Failure)
                                        {
                                            count = 0;
                                            nonQueryErrors += nonQueryStatus.Exception.Message + &quot; &quot;;
                                        }
                                    }
                                }
                                if (!string.IsNullOrEmpty(nonQueryErrors))
                                {
                                    var nonQueryException = new Exception(nonQueryErrors);
                                    throw nonQueryException;
                                }
                            }
                        }
                    }
                }
            }
            return isTriggerPointExist;
        }


        /// &lt;summary&gt;
        /// For adding a map in ObjectMap Table
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;connectionParameter&quot;&gt;&lt;/param&gt;
        public static void HandleMap(ConnectorParameters connectionParameter)
        {
            var dataDict = new Dictionary&lt;string, object&gt;();
            DataSet dsMainTrigger = new BrixDataSet();
            List&lt;ConnectionBrixInfo&gt; lstMapInfo = connectionParameter.lstBrixMapInfo;
            string amp3ClassName = connectionParameter.strAMP3ClassName;
            string amp3MethodName = connectionParameter.strAMP3MethodName;

            if (connectionParameter == null)
            {
                throw new Exception(&quot;Connector Parameters cannot be null&quot;);
            }

            if (connectionParameter.AdditionalInfo == null)
            {
                connectionParameter.AdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
            }

            if (Instance.dtEISInfo.Rows.Count &gt; 0)
            {
                dsMainTrigger = IntegrationConnectorComponent.Instance.GetTriggerInfo(amp3ClassName, amp3MethodName);
                DataTable dtt = Instance.dtEISInfo;
                foreach (DataRow row in dtt.Rows)
                {
                    var registeredEIS = (RegisteredEIS)row[&quot;ID&quot;].ToString2().Parse2();

                    if (!connectionParameter.AdditionalInfo.ContainsKey(registeredEIS))
                    {
                        connectionParameter.AdditionalInfo.Add(registeredEIS, new EISAdditionalInfo(registeredEIS));
                    }
                    string strKey = &quot;&quot;;
                    if (connectionParameter.AdditionalInfo.ContainsKey(registeredEIS))
                        strKey = Instance.GetDictionaryKey(registeredEIS,
                            connectionParameter.AdditionalInfo[registeredEIS]);
                    DataTable dtSetting = Instance.dsEISSettings.Tables[0].Clone();
                    DataRow[] drSettings = Instance.dsEISSettings.Tables[0].Select(&quot;EISId=&quot; + (int)registeredEIS);
                    foreach (DataRow drSet in drSettings)
                    {
                        dtSetting.ImportRow(drSet);
                    }
                    Dictionary&lt;string, string&gt; settings =
                        IntegrationConnectorComponent.Instance.GetDictionaryFromTable(dtSetting);

                    DataTable dtTrigger = dsMainTrigger.Tables[0].Clone();
                    DataRow[] drTrigger = dsMainTrigger.Tables[0].Select(&quot;EISId=&quot; + row[&quot;ID&quot;].ToString2().Parse2());
                    foreach (DataRow dr in drTrigger)
                    {
                        dtTrigger.ImportRow(dr);
                    }
                    if (dtTrigger.Rows.Count &gt; 0)
                    {
                        if (!Instance.IsIntegrationConnectorLoggedIn(strKey))
                        {
                            EISOperationStatus status = Instance.Logon(
                                connectionParameter.AdditionalInfo[registeredEIS], settings, registeredEIS);

                            if (status.Status == EISOperationState.Success)
                            {
                                Instance.dictionaryConnectors[strKey].IsLoggedOn = true;
                            }
                        }
                        if (Instance.IsIntegrationConnectorLoggedIn(strKey))
                        {
                            List&lt;ConnectionBrixInfo&gt; Info = connectionParameter.lstBrixMapInfo;
                            // TODO : Check !!
                            DataTable dt = Instance.GetERPObjectMapInfo(Info[0].AMP3ObjectId,
                                Info[0].AMP3ObjectType,
                                Info[0].AMP3ParentObjectId,
                                Info[0].AMP3ParentObjectType,
                                registeredEIS);
                            if ((dt != null) &amp;&amp; (dt.Rows.Count &gt; 0))
                            {
                                dataDict.Add(ObjectId, Info[1].AMP3ObjectId.ToString2());
                                dataDict.Add(Company, dt.Rows[0][ERPCompany].ToString2());
                                dataDict.Add(ObjectType, connectionParameter.enmEISObjectType);
                                Instance.AddERPMapInfo(Info[1].AMP3ObjectId, Info[1].AMP3ObjectType,
                                    Info[1].AMP3ParentObjectId, Info[1].AMP3ParentObjectType,
                                    dataDict, registeredEIS);
                            }
                        }
                    }
                }
            }
        }


        /// &lt;summary&gt;
        /// It handles approval workflows.Restricts the user to delete an entry if mapping exists in AX
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;connectorParameters&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;eisObjectType&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static bool HandleApprovalWorkflow(ConnectorParameters connectorParameters, EISObjectType eisObjectType)
        {
            var dataDict = new Dictionary&lt;string, object&gt;();
            var dsMainTrigger = new DataSet();
            List&lt;ConnectionBrixInfo&gt; lstMapInfo = connectorParameters.lstBrixMapInfo;
            connectorParameters.strAMP3ClassName = MethodBase.GetCurrentMethod().DeclaringType.ToString();
            connectorParameters.strAMP3MethodName = MethodBase.GetCurrentMethod().Name;
            ;
            string amp3ClassName = MethodBase.GetCurrentMethod().DeclaringType.ToString();
            string amp3MethodName = MethodBase.GetCurrentMethod().Name;
            var dt = new DataTable();

            dsMainTrigger = IntegrationConnectorComponent.Instance.GetTriggerInfo(amp3ClassName, amp3MethodName);
            DataTable dtt = Instance.dtEISInfo;
            foreach (DataRow row in dtt.Rows)
            {
                var registeredEIS = (RegisteredEIS)row[&quot;ID&quot;].ToString2().Parse2();
                DataTable dtTrigger = dsMainTrigger.Tables[0].Clone();
                DataRow[] drTrigger = dsMainTrigger.Tables[0].Select(&quot;EISId=&quot; + (int)registeredEIS);
                foreach (DataRow dr in drTrigger)
                    dtTrigger.ImportRow(dr);
                Instance.HandleLogon(connectorParameters, dtTrigger, registeredEIS);
                List&lt;ConnectionBrixInfo&gt; Info = connectorParameters.lstBrixMapInfo;
                string strKey = &quot;&quot;;
                if (connectorParameters.AdditionalInfo.ContainsKey(registeredEIS))
                    strKey = Instance.GetDictionaryKey(registeredEIS, connectorParameters.AdditionalInfo[registeredEIS]);
                if (Instance.IsIntegrationConnectorLoggedIn(strKey))
                {
                    dt = Instance.GetERPObjectMapInfo(Info[0].AMP3ObjectId,
                        Info[0].AMP3ObjectType,
                        Info[0].AMP3ParentObjectId,
                        Info[0].AMP3ParentObjectType,
                        RegisteredEIS.AX);
                }
                if (dt.Rows.Count &gt; 0 &amp;&amp; dtTrigger.Rows.Count &gt; 0)
                {
                    string ERPId = dt.Rows[0][&quot;ERPId&quot;].ToString();
                    string filter = &quot;&lt;XML&gt;&lt;ERPId type = &#39;txt&#39; &gt;&quot; + ERPId + &quot;&lt;/ERPId&gt;&lt;ERPObjectType type = &#39;txt&#39; &gt; &quot; +
                                    eisObjectType + &quot;&lt;/ERPObjectType&gt;&lt;/XML&gt;&quot;;
                    var objConnectionFilter = new ConnectionFilter(filter, null, null, null, null);
                    connectorParameters.objConnectionFilter = objConnectionFilter;
                    var dtmain = new DataTable();
                    QueryStatus[] objERPOutput = Instance.ExecuteERPTrigger(connectorParameters, RegisteredEIS.AX,
                        dsMainTrigger.Tables[0]);
                    if (objERPOutput[0].enmOperationStatus == EISOperationState.Success)
                    {
                        if (objERPOutput[0].ERPDataSet.Tables[0].Rows.Count == 0)
                        {
                            Instance.DeleteERPObjectMap(Info[0].AMP3ObjectId,
                                Info[0].AMP3ObjectType, Info[0].AMP3ParentObjectId,
                                Info[0].AMP3ParentObjectType, RegisteredEIS.AX);
                            return true;
                        }
                        else
                            return false;
                    }
                    else
                        throw objERPOutput[0].Exception;
                }
                else
                    return true;
            }
            return true;
        }


        /// &lt;summary&gt;
        /// It handles login on to different companies
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;connectorParameters&quot;&gt;&lt;/param&gt;
        private void HandleLogon(ConnectorParameters connectorParameters, DataTable dtTrigger,
            RegisteredEIS registeredEIS)
        {
            string amp3ClassName = connectorParameters.strAMP3ClassName;
            string amp3MethodName = connectorParameters.strAMP3MethodName;

            DataTable dtSetting = Instance.dsEISSettings.Tables[0].Clone();
            DataRow[] drSettings = Instance.dsEISSettings.Tables[0].Select(&quot;EISId=&quot; + (int)registeredEIS);

            foreach (DataRow drSet in drSettings)
            {
                if (drSet[&quot;SettingName&quot;].Equals(&quot;AXCompany&quot;))
                {
                    // TODO : Check this
                    if (connectorParameters.AdditionalInfo.ContainsKey(registeredEIS))
                    {
                        object AXCompany = (connectorParameters.AdditionalInfo[registeredEIS] != null)
                            ? connectorParameters.AdditionalInfo[registeredEIS][&quot;AXCompany&quot;]
                            : null;
                        drSet[&quot;SettingValue&quot;] = (AXCompany != null) ? AXCompany : drSet[&quot;SettingValue&quot;];
                    }
                    else
                    {
                        // For the Brix-AX Login page - There is no Key for AX in Dictionary
                        //Create a key for ax, add axcopmany = drSet[&quot;SettingValue&quot;] [Default company - dmo]
                        connectorParameters.AdditionalInfo.Add(registeredEIS, new EISAdditionalInfo(registeredEIS));
                        connectorParameters.AdditionalInfo[registeredEIS].AddInfo(&quot;AXCompany&quot;,
                            drSet[&quot;SettingValue&quot;] != null
                                ? drSet[&quot;SettingValue&quot;]
                                : &quot;&quot;);
                    }
                }
                dtSetting.ImportRow(drSet);
            }

            Dictionary&lt;string, string&gt; settings =
                IntegrationConnectorComponent.Instance.GetDictionaryFromTable(dtSetting);

            if (dtTrigger != null &amp;&amp; dtTrigger.Rows.Count &gt; 0)
            {
                if (!connectorParameters.AdditionalInfo.ContainsKey(registeredEIS))
                {
                    connectorParameters.AdditionalInfo.Add(registeredEIS, new EISAdditionalInfo(registeredEIS));
                }

                string strKey = Instance.GetDictionaryKey(registeredEIS,
                    connectorParameters.AdditionalInfo[registeredEIS]);
                if (!Instance.IsIntegrationConnectorLoggedIn(strKey))
                {
                    EISOperationStatus status = Instance.Logon(connectorParameters.AdditionalInfo[registeredEIS],
                        settings, registeredEIS);
                    if (status.Status == EISOperationState.Success)
                    {
                        Instance.dictionaryConnectors[strKey].IsLoggedOn = true;
                    }
                    else
                    {
                        throw status.Exception;
                    }
                }
            }
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;brixId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;EISId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;EISType&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        ///
        public DataTable GetEISLookUpInfo(int brixId, RegisteredEIS EISId, EISObjectType EISType)
        {
            return IntegrationConnectorComponent.Instance.GetEISLookUpInfo(brixId, EISId, EISType);
        }

        public DataTable GetEISInfo()
        {
            return IntegrationConnectorComponent.Instance.GetEISInfo();
        }

        public DataSet GetEISDynamicUIInfo(string pageName)
        {
            return IntegrationConnectorComponent.Instance.GetEISDynamicUIInfo(pageName);
        }

        public DataTable GetAXApprovedMaterialIssues(int itemId, int subItemId, string resitemId)
        {
            return IntegrationConnectorComponent.Instance.GetAXApprovedMaterialIssues(itemId, subItemId, resitemId);
        }

        public DataTable GetAXMappedProjects()
        {
            return IntegrationConnectorComponent.Instance.GetAXMappedProjects();
        }

        public DataTable GetERPInfo()
        {
            return IntegrationConnectorComponent.Instance.GetERPInfo();
        }

        public static bool CheckForProjectIntegrationMode(int brixProjectID)
        {
            if (brixProjectID == 0)
            {
                if (HttpContext.Current != null)
                {
                    var page = (Page)(HttpContext.Current.Handler);
                    int projectID = page.Request[Constants.QRY_PROJECTID].ToInt32_2();
                    return CacheManager.Instance.IsIntegrated(projectID);
                }
                else
                {
                    return true;
                }
            }
            else
            {
                return CacheManager.Instance.IsIntegrated(brixProjectID);
            }
        }

        #endregion

        # region Public Properties

        public int NoOfEISConnectorsAttached
        {
            get { return dictionaryConnectors.Keys.Count; }
        }

        # endregion
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[48,9,48,94,1],[49,9,49,62,1],[54,13,54,14,1],[55,17,55,35,1],[56,17,56,18,1],[57,21,57,34,1],[58,21,58,22,1],[59,25,59,43,1],[59,44,59,106,1],[60,21,60,22,1],[61,17,61,18,1],[63,17,63,78,1],[64,17,64,56,1],[65,17,65,18,1],[66,21,66,34,1],[67,21,67,22,1],[68,25,68,64,1],[69,25,69,26,1],[70,29,70,102,1],[71,29,71,65,1],[72,29,72,53,1],[73,25,73,26,1],[74,21,74,22,1],[75,17,75,18,1],[77,17,77,46,1],[78,13,78,14,1],[86,9,86,45,1],[87,9,87,10,1],[88,9,88,10,1],[91,9,91,10,1],[92,13,92,72,1],[93,13,93,77,1],[95,13,95,85,1],[97,13,97,20,1],[97,22,97,45,0],[97,46,97,48,1],[97,49,97,63,1],[98,13,98,14,0],[99,17,99,52,0],[100,13,100,14,0],[101,9,101,10,1],[111,13,111,14,0],[112,17,112,59,0],[113,17,113,18,0],[114,21,114,70,0],[117,17,117,18,0],[118,21,118,82,0],[120,13,120,14,0],[131,13,131,14,1],[132,17,132,24,1],[132,26,132,34,0],[132,35,132,37,1],[132,38,132,58,1],[133,17,133,18,0],[134,21,134,90,0],[135,25,135,59,0],[136,17,136,18,0],[137,17,137,29,1],[138,13,138,14,1],[148,9,148,10,0],[150,13,153,32,0],[154,9,154,10,0],[162,9,162,10,0],[163,13,163,56,0],[164,17,164,29,0],[166,13,166,58,0],[167,9,167,10,0],[175,9,175,10,0],[176,13,176,57,0],[177,13,177,75,0],[179,13,179,38,0],[179,39,179,51,0],[180,13,180,42,0],[180,43,180,55,0],[182,13,182,55,0],[183,9,183,10,0],[191,9,191,10,0],[192,13,192,72,0],[193,13,193,98,0],[195,13,197,89,0],[198,13,198,122,0],[200,13,200,107,0],[201,13,201,67,0],[202,17,202,62,0],[204,13,208,66,0],[210,13,210,89,0],[211,13,211,63,0],[212,13,212,27,0],[213,9,213,10,0],[221,9,221,10,0],[223,13,223,14,0],[224,17,227,112,0],[229,13,229,18,0],[230,13,230,14,0],[231,17,231,46,0],[233,9,233,10,0],[245,9,245,10,0],[246,13,246,77,0],[247,13,249,89,0],[250,9,250,10,0],[258,9,258,10,0],[259,13,259,41,0],[261,13,261,67,0],[262,13,262,41,0],[263,13,263,44,0],[264,13,264,48,0],[265,13,265,32,0],[266,13,266,48,0],[267,13,267,20,0],[267,22,267,34,0],[267,35,267,37,0],[267,38,267,53,0],[268,13,268,14,0],[269,17,269,52,0],[270,17,270,60,0],[271,17,271,18,0],[272,21,272,44,0],[273,17,273,18,0],[274,17,274,60,0],[275,17,275,18,0],[276,21,276,43,0],[277,17,277,18,0],[278,17,278,61,0],[279,17,279,18,0],[280,21,280,44,0],[281,17,281,18,0],[282,17,282,102,0],[283,17,283,18,0],[284,21,284,46,0],[285,17,285,18,0],[286,17,286,53,0],[287,17,287,18,0],[288,21,288,72,0],[289,17,289,18,0],[290,13,290,14,0],[291,13,291,38,0],[292,13,292,20,0],[292,22,292,34,0],[292,35,292,37,0],[292,38,292,53,0],[293,13,293,14,0],[294,17,294,48,0],[295,13,295,14,0],[296,13,296,29,0],[297,13,297,31,0],[298,13,298,23,0],[299,9,299,10,0],[307,9,307,10,0],[308,13,308,36,0],[309,13,309,34,0],[310,13,310,53,0],[311,13,311,57,0],[313,13,313,42,0],[314,13,314,78,0],[315,13,315,76,0],[318,13,318,70,0],[319,13,319,14,0],[320,17,320,54,0],[321,17,321,74,0],[322,13,322,14,0],[328,13,328,49,0],[329,13,329,51,0],[330,13,330,43,0],[331,13,331,42,0],[333,13,333,49,0],[334,13,334,32,0],[335,9,335,10,0],[343,9,343,10,0],[347,13,347,38,0],[348,13,348,38,0],[350,13,350,29,0],[352,13,352,20,0],[352,22,352,35,0],[352,36,352,38,0],[352,39,352,49,0],[353,13,353,14,0],[354,17,354,71,0],[355,17,355,18,0],[356,21,356,50,0],[357,21,357,56,0],[358,21,358,22,0],[359,25,359,78,0],[360,25,360,71,0],[361,25,361,51,0],[362,25,362,52,0],[363,21,363,22,0],[365,25,365,43,0],[367,21,367,103,0],[368,17,368,18,0],[369,13,369,14,0],[370,13,370,33,0],[371,9,371,10,0],[394,9,394,10,0],[395,13,395,71,0],[396,13,396,74,0],[397,13,397,48,0],[398,13,398,35,0],[400,13,400,58,0],[401,17,402,120,0],[404,13,404,77,0],[405,13,405,14,0],[406,17,406,90,0],[407,13,407,14,0],[410,13,410,35,0],[413,17,413,18,0],[414,21,416,62,0],[417,21,417,27,0],[420,17,420,18,0],[421,21,423,68,0],[424,21,424,27,0],[427,17,427,18,0],[428,21,430,67,0],[431,21,431,27,0],[434,17,434,18,0],[435,21,437,71,0],[438,21,438,27,0],[442,21,442,121,0],[445,13,445,69,0],[446,13,446,14,0],[447,17,447,118,0],[448,17,448,18,0],[449,21,450,54,0],[451,21,451,59,0],[452,21,452,36,0],[453,21,453,56,0],[454,21,454,22,0],[455,25,455,93,0],[456,25,457,75,0],[459,25,459,34,0],[460,21,460,22,0],[461,21,462,46,0],[463,21,463,57,0],[464,17,464,18,0],[466,17,466,40,0],[469,13,469,14,0],[470,17,470,49,0],[472,9,472,10,0],[486,9,486,10,0],[487,13,487,44,0],[488,13,488,73,0],[489,13,489,74,0],[490,13,490,33,0],[491,13,491,54,0],[492,13,492,14,0],[493,17,493,73,0],[495,17,496,47,0],[497,17,497,35,0],[498,17,498,67,0],[500,17,500,24,0],[500,26,500,39,0],[500,40,500,42,0],[500,43,500,63,0],[501,17,501,18,0],[502,21,502,64,0],[503,21,503,22,0],[505,25,505,86,0],[506,29,506,85,0],[507,21,507,22,0],[508,26,508,68,0],[509,21,509,22,0],[511,25,511,87,0],[512,29,513,74,0],[514,21,514,22,0],[516,21,516,22,0],[518,25,518,115,0],[519,25,519,26,0],[520,29,520,121,0],[523,25,523,26,0],[524,21,524,22,0],[526,21,526,50,0],[527,21,527,22,0],[528,25,528,89,0],[529,25,529,26,0],[530,29,530,96,0],[531,29,531,30,0],[532,33,532,57,0],[533,33,533,70,0],[534,33,534,67,0],[535,33,535,34,0],[536,37,537,105,0],[538,37,538,55,0],[539,33,539,34,0],[541,29,541,30,0],[542,25,542,26,0],[543,21,543,22,0],[544,21,544,33,0],[545,17,545,18,0],[546,17,546,31,0],[547,13,547,14,0],[549,13,549,27,0],[550,9,550,10,0],[558,9,558,10,0],[559,13,559,69,0],[560,17,560,48,0],[562,13,562,84,0],[563,9,563,10,0],[571,9,571,10,0],[572,13,572,66,0],[573,17,573,45,0],[575,13,575,78,0],[576,9,576,10,0],[587,9,587,10,0],[588,13,588,77,0],[589,13,589,119,0],[590,13,590,38,0],[591,13,591,14,0],[592,17,592,59,0],[593,17,593,67,0],[594,17,594,18,0],[595,21,595,68,0],[596,17,596,18,0],[597,13,597,14,0],[598,13,598,30,0],[599,9,599,10,0],[608,9,608,10,0],[609,13,609,77,0],[610,13,610,119,0],[611,13,611,113,0],[613,13,613,32,0],[614,13,614,14,0],[615,17,615,39,0],[616,17,616,18,0],[617,21,617,79,0],[618,21,618,71,0],[619,21,619,22,0],[620,25,620,51,0],[621,21,621,22,0],[622,17,622,18,0],[623,13,623,14,0],[624,13,624,30,0],[625,9,625,10,0],[644,9,644,10,0],[645,13,645,77,0],[646,13,650,34,0],[651,9,651,10,0],[663,9,663,10,0],[664,13,664,77,0],[665,13,667,84,0],[668,9,668,10,0],[680,9,680,10,0],[681,13,681,77,0],[682,13,684,87,0],[685,9,685,10,0],[700,9,700,10,0],[701,13,701,71,0],[702,13,702,74,0],[704,13,704,58,0],[705,17,705,119,0],[707,13,707,28,0],[708,13,708,14,0],[709,17,709,29,0],[712,13,712,14,0],[713,17,713,42,0],[714,21,714,33,0],[715,17,715,50,0],[716,21,716,33,0],[717,13,717,14,0],[718,13,718,35,0],[721,17,721,18,0],[722,21,726,40,0],[727,21,727,69,0],[728,21,728,103,0],[729,25,729,74,0],[730,21,730,44,0],[733,17,733,18,0],[734,21,738,40,0],[739,21,739,44,0],[742,17,742,18,0],[743,21,748,40,0],[749,21,749,44,0],[752,21,752,33,0],[754,9,754,10,0],[757,9,757,10,0],[758,13,758,23,0],[759,13,759,45,0],[760,13,760,14,0],[761,17,761,65,0],[762,17,762,82,0],[763,17,763,84,0],[764,17,764,86,0],[765,17,771,46,0],[772,17,772,21,0],[773,13,773,14,0],[774,9,774,10,0],[790,9,790,10,0],[791,13,791,97,0],[792,13,792,73,0],[793,13,793,75,0],[794,13,794,64,0],[796,13,796,60,0],[797,13,797,14,0],[798,17,798,95,0],[799,13,799,14,0],[801,13,801,46,0],[802,13,802,86,0],[803,13,803,63,0],[804,13,804,14,0],[805,17,805,69,0],[806,17,806,35,0],[807,17,807,38,0],[808,17,808,40,0],[809,17,809,90,0],[811,17,811,24,0],[811,26,811,36,0],[811,37,811,39,0],[811,40,811,54,0],[812,17,812,18,0],[813,21,813,58,0],[814,21,814,58,0],[816,21,816,57,0],[817,21,817,52,0],[818,21,818,36,0],[819,21,820,51,0],[821,21,821,59,0],[823,21,823,48,0],[824,21,824,22,0],[825,25,825,60,0],[826,25,826,26,0],[827,29,827,97,0],[828,29,828,108,0],[830,29,830,72,0],[831,29,831,52,0],[833,29,833,38,0],[834,25,834,26,0],[835,21,835,22,0],[837,21,837,22,0],[838,25,838,42,0],[839,21,839,22,0],[840,21,840,28,0],[840,30,840,56,0],[840,57,840,59,0],[840,60,840,70,0],[841,21,841,22,0],[842,25,844,74,0],[846,25,846,71,0],[847,25,847,26,0],[848,29,848,75,0],[850,29,850,88,0],[851,29,851,81,0],[852,33,852,75,0],[853,29,853,36,0],[853,38,853,51,0],[853,52,853,54,0],[853,55,853,77,0],[854,29,854,30,0],[855,33,855,62,0],[856,29,856,30,0],[857,25,857,26,0],[858,21,858,22,0],[861,21,861,60,0],[862,21,862,39,0],[863,21,863,22,0],[864,25,865,75,0],[866,25,866,37,0],[867,21,867,22,0],[868,17,868,18,0],[869,13,869,14,0],[870,13,870,29,0],[871,9,871,10,0],[884,9,884,10,0],[885,13,885,97,0],[886,13,886,73,0],[887,13,887,75,0],[888,13,888,82,0],[889,13,889,86,0],[890,13,890,102,0],[891,13,891,85,0],[892,13,892,91,0],[893,13,893,82,0],[896,13,896,64,0],[897,13,897,60,0],[898,13,898,14,0],[899,17,899,95,0],[900,13,900,14,0],[902,13,902,45,0],[903,13,903,35,0],[904,13,904,59,0],[905,13,905,31,0],[906,13,906,23,0],[907,13,907,51,0],[908,13,908,38,0],[911,13,911,20,0],[911,22,911,32,0],[911,33,911,35,0],[911,36,911,43,0],[912,13,912,14,0],[913,17,913,54,0],[914,17,914,54,0],[915,17,915,56,0],[916,17,916,51,0],[917,17,917,18,0],[918,21,918,53,0],[919,21,919,67,0],[920,21,920,88,0],[921,21,922,66,0],[924,21,924,28,0],[924,30,924,43,0],[924,44,924,46,0],[924,47,924,71,0],[925,21,925,22,0],[926,25,926,32,0],[926,34,926,47,0],[926,48,926,50,0],[926,51,926,72,0],[927,25,927,26,0],[928,29,928,65,0],[929,29,929,30,0],[930,33,930,79,0],[931,33,931,34,0],[932,37,934,87,0],[935,33,935,34,0],[936,33,936,79,0],[937,33,937,34,0],[938,37,941,60,0],[942,33,942,34,0],[943,33,943,78,0],[944,33,944,34,0],[945,37,947,60,0],[948,33,948,34,0],[949,33,949,81,0],[950,33,950,34,0],[951,37,953,85,0],[954,33,954,34,0],[955,33,955,37,0],[956,29,956,30,0],[957,25,957,26,0],[958,21,958,22,0],[959,17,959,18,0],[961,21,961,47,0],[964,17,964,54,0],[965,17,965,18,0],[966,21,966,65,0],[967,21,968,40,0],[969,21,969,75,0],[970,17,970,18,0],[971,17,971,34,0],[972,17,972,18,0],[973,21,977,56,0],[978,21,978,33,0],[979,17,979,18,0],[980,13,980,14,0],[982,13,982,29,0],[983,9,983,10,0],[992,9,992,10,0],[993,13,993,89,0],[994,9,994,10,0],[1007,9,1007,10,0],[1008,13,1010,32,0],[1011,9,1011,10,0],[1020,9,1020,10,0],[1021,13,1021,93,0],[1022,9,1022,10,0],[1038,9,1038,10,0],[1039,13,1040,58,0],[1041,9,1041,10,0],[1054,9,1054,10,0],[1055,13,1056,48,0],[1057,9,1057,10,0],[1067,9,1067,10,0],[1068,13,1068,117,0],[1069,9,1069,10,0],[1072,9,1072,10,0],[1073,13,1074,31,0],[1075,9,1075,10,0],[1083,9,1083,10,1],[1084,13,1084,50,1],[1085,9,1085,10,1],[1088,9,1088,10,1],[1090,13,1090,46,1],[1091,13,1091,73,1],[1092,13,1092,75,1],[1094,13,1094,42,1],[1095,13,1095,14,0],[1096,17,1097,37,0],[1098,17,1098,119,0],[1099,21,1099,48,0],[1100,13,1100,14,0],[1101,13,1101,40,1],[1102,9,1102,10,1],[1110,9,1110,10,0],[1111,13,1111,55,0],[1112,13,1112,14,0],[1113,17,1113,61,0],[1116,17,1116,30,0],[1117,9,1117,10,0],[1126,9,1126,10,0],[1127,13,1127,76,0],[1128,9,1128,10,0],[1140,9,1140,10,1],[1142,13,1142,45,1],[1143,13,1143,14,0],[1144,17,1144,76,0],[1147,13,1147,60,1],[1148,13,1148,14,1],[1149,17,1149,105,1],[1150,13,1150,14,1],[1151,13,1151,73,1],[1152,13,1152,75,1],[1154,13,1154,46,1],[1155,13,1155,47,1],[1156,13,1156,51,1],[1157,13,1157,14,0],[1158,17,1159,37,0],[1160,17,1160,52,0],[1161,17,1161,24,0],[1161,26,1161,37,0],[1161,38,1161,40,0],[1161,41,1161,49,0],[1162,17,1162,18,0],[1163,21,1163,87,0],[1165,21,1165,75,0],[1166,21,1166,105,0],[1167,21,1167,28,0],[1167,30,1167,40,0],[1167,41,1167,43,0],[1167,44,1167,53,0],[1168,21,1168,22,0],[1169,25,1169,49,0],[1170,21,1170,22,0],[1174,26,1174,35,0],[1174,37,1174,61,0],[1174,63,1174,66,0],[1175,21,1175,22,0],[1176,25,1176,95,0],[1177,25,1177,26,0],[1178,29,1178,75,0],[1179,29,1179,30,0],[1180,33,1180,60,0],[1181,33,1181,37,0],[1182,29,1182,30,0],[1183,25,1183,26,0],[1184,21,1184,22,0],[1188,21,1188,89,0],[1189,21,1189,50,0],[1190,21,1190,22,0],[1191,25,1191,52,0],[1192,21,1192,22,0],[1193,21,1193,50,0],[1194,21,1194,87,0],[1195,25,1196,80,0],[1197,21,1197,71,0],[1198,21,1198,22,0],[1199,25,1199,77,0],[1200,25,1200,26,0],[1201,29,1201,41,0],[1202,29,1202,30,0],[1203,33,1203,122,0],[1204,33,1204,58,0],[1205,33,1205,34,0],[1206,37,1206,65,0],[1207,37,1207,38,0],[1208,41,1208,97,0],[1209,41,1209,42,0],[1210,45,1210,55,0],[1211,45,1211,77,0],[1214,41,1214,42,0],[1215,45,1215,78,0],[1216,45,1216,84,0],[1217,45,1217,46,0],[1218,49,1218,81,0],[1219,49,1219,76,0],[1221,41,1221,42,0],[1222,37,1222,38,0],[1223,33,1223,34,0],[1224,29,1224,30,0],[1226,29,1226,30,0],[1227,33,1228,63,0],[1229,33,1229,60,0],[1230,33,1230,40,0],[1230,42,1230,71,0],[1230,72,1230,74,0],[1230,75,1230,86,0],[1231,33,1231,34,0],[1232,37,1232,64,0],[1233,37,1233,38,0],[1234,41,1234,96,0],[1235,41,1235,42,0],[1236,45,1236,55,0],[1237,45,1237,102,0],[1238,41,1238,42,0],[1239,37,1239,38,0],[1240,33,1240,34,0],[1241,33,1241,75,0],[1242,33,1242,34,0],[1243,37,1243,91,0],[1244,37,1244,61,0],[1246,29,1246,30,0],[1247,25,1247,26,0],[1248,21,1248,22,0],[1249,17,1249,18,0],[1250,13,1250,14,0],[1251,13,1251,40,1],[1252,9,1252,10,1],[1260,9,1260,10,1],[1261,13,1261,61,1],[1262,13,1262,55,1],[1263,13,1263,86,1],[1264,13,1264,73,1],[1265,13,1265,75,1],[1267,13,1267,45,1],[1268,13,1268,14,0],[1269,17,1269,76,0],[1272,13,1272,60,1],[1273,13,1273,14,0],[1274,17,1274,105,0],[1275,13,1275,14,0],[1277,13,1277,51,1],[1278,13,1278,14,0],[1279,17,1279,118,0],[1280,17,1280,52,0],[1281,17,1281,24,0],[1281,26,1281,37,0],[1281,38,1281,40,0],[1281,41,1281,49,0],[1282,17,1282,18,0],[1283,21,1283,87,0],[1285,21,1285,88,0],[1286,21,1286,22,0],[1287,25,1287,117,0],[1288,21,1288,22,0],[1289,21,1289,40,0],[1290,21,1290,87,0],[1291,25,1292,80,0],[1293,21,1293,84,0],[1294,21,1294,115,0],[1295,21,1295,28,0],[1295,30,1295,43,0],[1295,44,1295,46,0],[1295,47,1295,57,0],[1296,21,1296,22,0],[1297,25,1297,52,0],[1298,21,1298,22,0],[1299,21,1300,98,0],[1302,21,1302,75,0],[1303,21,1303,117,0],[1304,21,1304,28,0],[1304,30,1304,40,0],[1304,41,1304,43,0],[1304,44,1304,53,0],[1305,21,1305,22,0],[1306,25,1306,49,0],[1307,21,1307,22,0],[1308,21,1308,50,0],[1309,21,1309,22,0],[1310,25,1310,78,0],[1311,25,1311,26,0],[1312,29,1313,109,0],[1315,29,1315,76,0],[1316,29,1316,30,0],[1317,33,1317,89,0],[1318,29,1318,30,0],[1319,25,1319,26,0],[1320,25,1320,77,0],[1321,25,1321,26,0],[1322,29,1322,96,0],[1324,29,1328,48,0],[1329,29,1329,69,0],[1330,29,1330,30,0],[1331,33,1331,90,0],[1332,33,1332,91,0],[1333,33,1333,96,0],[1334,33,1336,62,0],[1337,29,1337,30,0],[1338,25,1338,26,0],[1339,21,1339,22,0],[1340,17,1340,18,0],[1341,13,1341,14,0],[1342,9,1342,10,1],[1352,9,1352,10,0],[1353,13,1353,61,0],[1354,13,1354,47,0],[1355,13,1355,86,0],[1356,13,1356,107,0],[1357,13,1357,88,0],[1358,13,1358,14,0],[1359,13,1359,91,0],[1360,13,1360,72,0],[1361,13,1361,38,0],[1363,13,1363,114,0],[1364,13,1364,48,0],[1365,13,1365,20,0],[1365,22,1365,33,0],[1365,34,1365,36,0],[1365,37,1365,45,0],[1366,13,1366,14,0],[1367,17,1367,83,0],[1368,17,1368,71,0],[1369,17,1369,101,0],[1370,17,1370,24,0],[1370,26,1370,36,0],[1370,37,1370,39,0],[1370,40,1370,49,0],[1371,21,1371,45,0],[1372,17,1372,85,0],[1373,17,1373,84,0],[1374,17,1374,36,0],[1375,17,1375,83,0],[1376,21,1376,122,0],[1377,17,1377,69,0],[1378,17,1378,18,0],[1379,21,1383,43,0],[1384,17,1384,18,0],[1385,17,1385,67,0],[1386,17,1386,18,0],[1387,21,1387,67,0],[1388,21,1389,78,0],[1390,21,1390,100,0],[1391,21,1391,83,0],[1392,21,1392,50,0],[1393,21,1394,50,0],[1395,21,1395,89,0],[1396,21,1396,22,0],[1397,25,1397,82,0],[1398,25,1398,26,0],[1399,29,1401,81,0],[1402,29,1402,41,0],[1405,29,1405,42,0],[1408,25,1408,57,0],[1411,21,1411,33,0],[1413,13,1413,25,0],[1414,9,1414,10,0],[1423,9,1423,10,0],[1424,13,1424,73,0],[1425,13,1425,75,0],[1427,13,1427,76,0],[1428,13,1428,107,0],[1430,13,1430,20,0],[1430,22,1430,35,0],[1430,36,1430,38,0],[1430,39,1430,49,0],[1431,13,1431,14,0],[1432,17,1432,62,0],[1433,17,1433,18,0],[1435,21,1435,87,0],[1436,21,1436,22,0],[1437,25,1439,36,0],[1440,25,1440,105,0],[1441,21,1441,22,0],[1443,21,1443,22,0],[1446,25,1446,117,0],[1447,25,1450,39,0],[1451,21,1451,22,0],[1452,17,1452,18,0],[1453,17,1453,44,0],[1454,13,1454,14,0],[1456,13,1457,90,0],[1459,13,1459,63,0],[1460,13,1460,14,0],[1461,17,1461,84,0],[1462,17,1462,18,0],[1463,21,1463,113,0],[1464,17,1464,18,0],[1466,17,1467,72,0],[1468,17,1468,70,0],[1469,17,1469,18,0],[1470,21,1471,50,0],[1472,21,1472,68,0],[1473,21,1473,22,0],[1474,25,1474,81,0],[1475,21,1475,22,0],[1477,21,1477,22,0],[1478,25,1478,48,0],[1480,17,1480,18,0],[1481,13,1481,14,0],[1482,9,1482,10,0],[1493,9,1493,10,0],[1494,13,1494,100,0],[1495,9,1495,10,0],[1498,9,1498,10,0],[1499,13,1499,72,0],[1500,9,1500,10,0],[1503,9,1503,10,0],[1504,13,1504,89,0],[1505,9,1505,10,0],[1508,9,1508,10,0],[1509,13,1509,117,0],[1510,9,1510,10,0],[1513,9,1513,10,0],[1514,13,1514,81,0],[1515,9,1515,10,0],[1518,9,1518,10,0],[1519,13,1519,72,0],[1520,9,1520,10,0],[1523,9,1523,10,0],[1524,13,1524,36,0],[1525,13,1525,14,0],[1526,17,1526,49,0],[1527,17,1527,18,0],[1528,21,1528,68,0],[1529,21,1529,87,0],[1530,21,1530,74,0],[1533,17,1533,18,0],[1534,21,1534,33,0],[1538,13,1538,14,0],[1539,17,1539,74,0],[1541,9,1541,10,0],[1549,17,1549,18,1],[1549,19,1549,58,1],[1549,59,1549,60,1]]);
    </script>
  </body>
</html>