<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Platform UI\Modules\PROJECT\ProjectsToUser.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Drawing;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Xml;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core.UserControls;
using Aurigo.AMP3.ProjectBL;
using Aurigo.AMP3.ProjectDTO;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.AMP3.UserManagementBL;
using Aurigo.Brix.Core.WebUiHelper;
using Aurigo.Brix.Platform.BusinessLayer.UserControls;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Infragistics.WebUI.UltraWebGrid;
using Telerik.Web.UI;
using System.Text;
using Newtonsoft.Json;
using Aurigo.Common.Utility;
using Aurigo.Brix.Platform.UI.Common.Helpers;
using Aurigo.AMP3.Resources.MessageResources;
using System.Xml.Serialization;
using Aurigo.Brix.Platform.BusinessLayer.DataAccessHelper;
using Aurigo.AMP3.DataAccess.Core;

namespace Aurigo.AMP3.ProjectUI
{
    public partial class ProjectsToUser : BrixPageBase
    {
        #region Constants
        const int CONST_PAGE_SIZE = 10;
        const string CONST_VirtualColumn_UserRolesMapping = &quot;UserRolesMapping&quot;;
        const string CONST_VirtualColumn_RoleNameCSV = &quot;ComboUserRoles&quot;;

        const string CONST_UI_VirtualColumn_RoleNameCSV = &quot;UserRoles&quot;;
        const string CONST_UI_VirtualColumn_RoleIdCSV = &quot;RoleID&quot;;
        const string CONST_UI_VirtualColumn_EditedIsPrimary = &quot;EditedIsPrimary&quot;;

        const string CONST_MSG_NoRoles = &quot;No Role&quot;;

        const string CONST_URL_PARAM_SuccessSessionKey = &quot;SK&quot;;
        #endregion Constants

        #region Properties And Helper Methods
        private StateManagementBase _pageState_ProjectRoleGrid;

        protected string Localication_ProjectText { get { return LocalizationManager.GetString(&quot;Project&quot;); } }

        protected string SortingKeyWithSortOrder
        {
            get
            {
                if (_pageState_ProjectRoleGrid == null)
                    return string.Empty;

                return _pageState_ProjectRoleGrid.SortKey + &quot; &quot; + (_pageState_ProjectRoleGrid.SortOrder == GridSortOrder.Descending ? &quot;DESC&quot; : &quot;ASC&quot;);
            }
        }

        public bool IsEmptyOrNullOrHtmlSpace(string strObj)
        {
            return (string.IsNullOrEmpty(strObj) || strObj == &quot;&amp;nbsp;&quot;);
        }

        protected string BuildURL(string url)
        {
            return UIHelper.BuildURL(url, new List&lt;string&gt; { &quot;pid&quot;, &quot;nt&quot;, CONST_URL_PARAM_SuccessSessionKey }, HttpContext.Current);
        }

        private string GetBaseURL_ForGivenURL(string currentURL)
        {
            bool isProposedProject =
                (HttpContext.Current.Request == null || string.IsNullOrEmpty(HttpContext.Current.Request.QueryString[&quot;PP&quot;])
                    ? false
                    : (HttpContext.Current.Request.QueryString[&quot;PP&quot;] == &quot;1&quot;) ? true : false);

            if (isProposedProject)
                return BuildURL(currentURL + &quot;&amp;PP=1&quot;);
            else
                return BuildURL(currentURL);
        }

        #endregion Properties And Helper Methods

        #region Page Overrides

        public override void InclueScriptAndStyleFiles()
        {
            base.InclueScriptAndStyleFiles();
            RegisterClientScriptInclude(&quot;~/Scripts/usermgmt/ManageUsers.js&quot;);
        }

        public string GetInitilize_ClientId_ForUseInJavascript()
        {
            JavascriptRenderFramework jrf = new JavascriptRenderFramework(&quot;CONST_ManageUsers&quot;);

            jrf.Add_ClientId(
                 grdProjectsWithRoles
                 , ProjectPicker
                 , grdNewProjects
                 , hdnDeleteId
            );

            jrf.Add_ClientId(&quot;ProjectPicker_TriggerButton&quot;, ProjectPicker.TriggerButton);
            //jrf.Add_ClientId(btnEdit, btnDelete);

            //jrf.Add_Message(&quot;ConfirmProjectDelete&quot;, MessageResourceManager.GetString(&quot;W_PROJECT_CONFIRM_DELETE_PROJECT&quot;, Enumerations.MessageType.WarningMessage));

            jrf.Add_Message(&quot;ProjectText&quot;, Localication_ProjectText);
            string scriptString = jrf.Generate();

            return scriptString;
            //ClientScript.RegisterClientScriptBlock(GetType(), &quot;ProjectInitilizeScript&quot;, scriptString, true);
            //ClientScript.RegisterClientScriptInclude(&quot;projects&quot;, ResolveClientUrl(&quot;~/Scripts/login.js&quot;));
        }

        protected override void OnInit(EventArgs e)
        {
            PermissionsToCheck.Add(Constants.MODFEAT_VISIBILITY);
            PermissionsToCheck.Add(ProjectConstants.MODFEAT_MANAGEUSERPROJECT);

            _pageState_ProjectRoleGrid = UIHelper.GetModuleFromStateBag(&quot;ProjectToUser_ProjectRoleGrid&quot;, Context) as StateManagementBase;
            if (_pageState_ProjectRoleGrid == null)
            {
                _pageState_ProjectRoleGrid = new StateManagementBase(&quot;ProjectToUser_ProjectRoleGrid&quot;);
                UIHelper.UpdateModuleStateBag(&quot;ProjectToUser_ProjectRoleGrid&quot;, _pageState_ProjectRoleGrid, Context);
            }

            //(mypager).ItemClicked += HandlePagerEvent;
            //mypager.EnableViewState = false;
            ProjectPicker_Initialize();

            //ComboBoxUserSelection.ItemType = typeof(UserItemDto).ToString();
            base.OnInit(e);
        }

        /// &lt;summary&gt;
        /// &lt;remarks&gt;
        /// Author : Kalyan Chakradhar R.
        /// &lt;/remarks&gt;
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;
        protected void Page_Load(object sender, EventArgs e)
        {
            try
            {
                UpdateTree = true;
                btnProjectPicker.Enabled = !string.IsNullOrEmpty(ComboBoxUserSelection.SelectedValue);

                if (!IsPostBack)
                {
                    UIHelper.DisableRoleSelection(Page);

                    btnRemoveNewProject.Enabled = !string.IsNullOrEmpty(ComboBoxUserSelection.SelectedValue);
                    //grdNewProjects.Visible = 
                }

                if (!IsPostBack)
                {
                    string sessionkey = Request.QueryString[CONST_URL_PARAM_SuccessSessionKey];
                    if (!string.IsNullOrEmpty(sessionkey))
                    {
                        object message = Session[sessionkey];
                        if (message != null)
                        {
                            base.ShowSuccess(string.Format(&quot;Project/Role associations saved successfully for user {0}.&quot;, message));

                            Session[sessionkey] = null;
                        }
                    }
                }

                lblException.Text = string.Empty;

                if (AMP3ApplicationSettings.Instance.IsSingleProjectMode)
                {
                    if (grdProjectsWithRoles.MasterTableView.HasDetailTables)
                    {
                        grdProjectsWithRoles.MasterTableView.DetailTables[0].Visible = false;
                        grdProjectsWithRoles.MasterTableView.ExpandCollapseColumn.Visible = false;
                    }

                    if (grdNewProjects.MasterTableView.HasDetailTables)
                    {
                        grdNewProjects.MasterTableView.DetailTables[0].Visible = false;
                        grdNewProjects.MasterTableView.ExpandCollapseColumn.Visible = false;
                    }
                }

                grdNewProjects.ClientSettings.Selecting.UseClientSelectColumnOnly=true;
                grdProjectsWithRoles.ClientSettings.Selecting.UseClientSelectColumnOnly = true;
            }
            catch (Exception ex)
            {
                lblException.Text = ex.Message;
            }

            PageTitle = &quot;Manage User Membership&quot;;
        }

        #endregion Page Overrides

        #region Menu And Child Control Init
        protected override void CreateChildControls()
        {
            var menus = new MenuArray();
            menus.Add(new BrixMenu(&quot;lnkSave&quot;, &quot;Save&quot;, &quot;Icn_Save.png&quot;, 55));
            menus.Add(new BrixMenu(&quot;lnkRemoveUser&quot;, &quot;Remove&quot;, &quot;Icn_Delete.png&quot;, 55));

            menus.Add(new BrixMenu(&quot;lnkCancel&quot;, &quot;Switch User&quot;, &quot;Icn_Userreject.png&quot;, 55));

            menus.Add(new BrixMenu(&quot;lnkBack&quot;, &quot;Back&quot;, &quot;Icn_Back.png&quot;, 55));
            CreateToolBarMenu(menus, null);
        }

        protected override void CustomizeToolBar()
        {
            var lnkSave = MainToolBar.GetMenuReference(&quot;lnkSave&quot;);
            if (lnkSave != null)
            {
                lnkSave.Click += btnSave_Click;
                lnkSave.OnClientClick = &quot;return ManUsr_SaveProjectsForUser()&quot;;
            }

            var lnkBack = MainToolBar.GetMenuReference(&quot;lnkBack&quot;);
            if (lnkBack != null)
                lnkBack.PostBackUrl = GetBaseURL_ForGivenURL(Constants.URL_PROJECTS);

            var lnkRemoveUser = MainToolBar.GetMenuReference(&quot;lnkRemoveUser&quot;);
            if (lnkRemoveUser != null)
            {
                lnkRemoveUser.Click += btnRemove_Click;
                lnkRemoveUser.OnClientClick = &quot;return ManUsr_RemoveExistingProjects()&quot;;
            }

            var lnkCancel = MainToolBar.GetMenuReference(&quot;lnkCancel&quot;);
            if (lnkCancel != null)
                lnkCancel.PostBackUrl = HttpContext.Current.Request.Url.AbsoluteUri;// lnkCancel.OnClientClick = string.Format(&quot;return Combobox_ClearSelection(&#39;{0}&#39;)&quot;, ComboBoxUserSelection.ClientID);

            SetButtonStateBasedOnIfUserSelected(!string.IsNullOrEmpty(ComboBoxUserSelection.SelectedValue));
        }

        protected void SetButtonStateBasedOnIfUserSelected(bool isUserSelected)
        {
            var lnkSave = MainToolBar.GetMenuReference(&quot;lnkSave&quot;);
            if (lnkSave != null)
                lnkSave.Enabled = isUserSelected;

            var lnkBack = MainToolBar.GetMenuReference(&quot;lnkBack&quot;);
            if (lnkBack != null)
                lnkBack.Visible = true; //Always visible//!isUserSelected;

            var lnkRemoveUser = MainToolBar.GetMenuReference(&quot;lnkRemoveUser&quot;);
            if (lnkRemoveUser != null)
                lnkRemoveUser.Visible = isUserSelected;

            var lnkCancel = MainToolBar.GetMenuReference(&quot;lnkCancel&quot;);
            if (lnkCancel != null)
                lnkCancel.Visible = isUserSelected;

            btnProjectPicker.Enabled = isUserSelected;

            ComboBoxUserSelection.Enabled = !isUserSelected;

            string displayStyle = &quot;none&quot;;
            if (isUserSelected)
                displayStyle = &quot;block&quot;;

            grdNewProjects.Style.Add(&quot;display&quot;, displayStyle);
            grdProjectsWithRoles.Style.Add(&quot;display&quot;, displayStyle);
            spanButtonsForNewProjects.Style.Add(&quot;display&quot;, displayStyle);
            lblAddProjects.Style.Add(&quot;display&quot;, displayStyle);
            lblExistingProjects.Style.Add(&quot;display&quot;, displayStyle);

        }

        //private void lnkCancel_ClearUserSelection_Click(object sender, EventArgs e)
        //{
        //    ComboBoxUserSelection.ClearSelection();
        //}

        #endregion Menu And Child Control Init

        //------------------------------------------------------------------------------------------------

        #region User Selection Combobox

        protected void ComboBoxUserSelection_ItemsRequested(object sender, RadComboBoxItemsRequestedEventArgs e)
        {
            int totalCount = 0;

            int itemOffset = e.NumberOfItems;

            var curUserDetails = UserDetail.GetCurrentUserDetail();

            DataTable dtUsers = UserManager.Instance.SearchActiveUsers_ByPaging(curUserDetails.UID, e.Text, true, CONST_PAGE_SIZE, itemOffset, ref totalCount);

            int endOffset = Math.Min(itemOffset + CONST_PAGE_SIZE, totalCount);
            e.EndOfItems = endOffset == totalCount;

            ComboBoxUserSelection.DataTextField = &quot;FullName&quot;;
            ComboBoxUserSelection.DataValueField = &quot;UserId&quot;;
            ComboBoxUserSelection.DataSource = dtUsers;

            ComboBoxUserSelection.DataBind();

            //for (int i = itemOffset; i &lt; endOffset; i++)
            //{
            //    ComboBoxUserSelection.Items.Add(new RadComboBoxItem(dtUsers.Rows[i][&quot;FullName&quot;].ToString(), dtUsers.Rows[i][&quot;UserId&quot;].ToString()));
            //}

            //foreach (var dataRow in dtUsers.AsEnumerable())
            //    ComboBoxUserSelection.Items.Add(new RadComboBoxItem(dataRow[&quot;FullName&quot;].ToString(), dataRow[&quot;UserId&quot;].ToString()));

            e.Message = ComboBoxUserSelection_GetStatusMessage(endOffset, totalCount);
        }

        //protected void ComboBoxUserSelection_ItemDataBound(object sender, RadComboBoxItemEventArgs e)
        //{
        //    DataRowView dataSourceRow = (DataRowView)e.Item.DataItem;
        //    //set custom attributes from the datasource:  
        //    e.Item.Attributes[&quot;FullName&quot;] = dataSourceRow[&quot;FullName&quot;].ToString();
        //    e.Item.Attributes[&quot;UserId&quot;] = dataSourceRow[&quot;UserId&quot;].ToString();
        //    e.Item.Attributes[&quot;BusinessUnitIdCSV&quot;] = dataSourceRow[&quot;BusinessUnitIdCSV&quot;].ToString();
        //}

        protected static string ComboBoxUserSelection_GetStatusMessage(int offset, int total)
        {
            if (total &lt;= 0)
                return &quot;No matches&quot;;

            return String.Format(&quot;Items &lt;b&gt;1&lt;/b&gt;-&lt;b&gt;{0}&lt;/b&gt; out of &lt;b&gt;{1}&lt;/b&gt;&quot;, offset, total);
        }

        protected void ComboBoxUserSelection_SelectedIndexChanged(object sender, RadComboBoxSelectedIndexChangedEventArgs e)
        {
            SetButtonStateBasedOnIfUserSelected(!string.IsNullOrEmpty(e.Value));

            labelUnsavedChangesIndicator.Visible = false;

            hdnEditRoles.Value = null;
            hdnNewProjectAdded.Value = null;

            grdProjectsWithRoles_FetchAndSetData(null);

            grdProjectsWithRoles.DataBind();

            grdNewProjects_FetchAndSetData(null);
        }

        #endregion User Selection Combobox

        //------------------------------------------------------------------------------------------------

        #region  Temporary State Mgmt Related to Save Data Persistance
        protected static void SaveStateOfAllUpdatesForUsersInCurrentPage(Dictionary&lt;int, ProjectRolesDataMap&gt; currentStateLookup, GridDataItemCollection rowItems)
        {
            foreach (GridDataItem rowItem in rowItems)//grdProjectUsers.Items)
            {
                if (rowItem.OwnerTableView.DetailTableIndex &lt; 0)
                {
                    int projectID = 0;

                    if (!(int.TryParse(rowItem[&quot;ProjectId&quot;].Text, out projectID) &amp;&amp; projectID &gt; 0))
                        continue;

                    CheckBox oCBIsPrimary = (CheckBox)rowItem.FindControl(&quot;CBIsPrimary&quot;);

                    bool cur_IsPrimary = oCBIsPrimary.Checked;
                    bool original_IsPrimary = string.IsNullOrWhiteSpace(rowItem[&quot;IsPrimary&quot;].Text) ? cur_IsPrimary : rowItem[&quot;IsPrimary&quot;].Text.ToBoolean2();

                    RadComboBox oRadComboBox = (RadComboBox)rowItem.FindControl(&quot;RadComboBoxUserRoles&quot;);

                    string xmlRoleListMapping = rowItem[CONST_VirtualColumn_UserRolesMapping].Text;

                    List&lt;InviteUsersToProject.RoleDtl&gt; thisUsersGlobalRolesList = InviteUsersToProject.RoleList.XmlDecodeRoleListData(xmlRoleListMapping);

                    List&lt;int&gt; curSelected = oRadComboBox.CheckedItems.Where(t =&gt; t != null &amp;&amp; !string.IsNullOrEmpty(t.Value)).Select(t =&gt; t.Value.ToString2().ToInt32_2()).ToList();
                    List&lt;int&gt; originalProjectRoles = thisUsersGlobalRolesList.Where(t =&gt; t.HasProjectRole).Select(t =&gt; t.Id).ToList();//!string.IsNullOrEmpty(item[&quot;RoleIdCVSFromDB&quot;].Text) ? item[&quot;RoleIdCVSFromDB&quot;].Text.Split(&#39;,&#39;).Select(t =&gt; t.ToInt32_2()).ToList() : new List&lt;int&gt;();

                    //If original data is same as the existing edited data then remove the key from the edited data
                    if (currentStateLookup.ContainsKey(projectID) &amp;&amp; cur_IsPrimary == original_IsPrimary
                        &amp;&amp; originalProjectRoles.Count == curSelected.Count
                        &amp;&amp; curSelected.All(t =&gt; originalProjectRoles.Contains(t)))
                    {//if original is same as current data then no need to save anything so remove the element
                        currentStateLookup.Remove(projectID);
                    }

                    if (cur_IsPrimary != original_IsPrimary || originalProjectRoles.Count != curSelected.Count
                        || originalProjectRoles.Any(t =&gt; !curSelected.Contains(t))
                        || curSelected.Any(t =&gt; !originalProjectRoles.Contains(t)))
                    {
                        currentStateLookup[projectID] = new ProjectRolesDataMap()
                        {
                            ProjectId = projectID,
                            ProjectName = rowItem[&quot;ProjectName&quot;].Text,
                            SelectedRoleIdList = curSelected,
                            IsPrimary = cur_IsPrimary
                        };
                    }
                }
            }
        }

        /// &lt;summary&gt;
        /// This function will save the state info from the datagrid data to the memory object which will be used to generate the serialized text for the hidden field
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;currentStateLookup&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;rowItems&quot;&gt;&lt;/param&gt;
        protected static void SaveStateOfAllUpdatesFor_NewProjectList(Dictionary&lt;int, NewProjectDto&gt; currentStateLookup, GridDataItemCollection rowItems)
        {
            foreach (GridDataItem rowItem in rowItems)//grdProjectUsers.Items)
            {
                if (rowItem.OwnerTableView.DetailTableIndex &lt; 0)
                {                
                    int projectId = 0;

                    if (!(int.TryParse(rowItem[&quot;ProjectId&quot;].Text, out projectId) &amp;&amp; projectId &gt; 0))
                        continue;

                    if (!(currentStateLookup.ContainsKey(projectId)))
                        continue;

                    NewProjectDto objToUpdate = currentStateLookup[projectId];
                    //-------------------------------------------
                    CheckBox oCBIsPrimary = (CheckBox)rowItem.FindControl(&quot;CBIsPrimary&quot;);
                    //CheckBox oCBIsPrimary = (CheckBox)(((Telerik.Web.UI.GridTableCell)(rowItem[&quot;IsPrimary&quot;]))).FindControl(&quot;CBIsPrimary&quot;);
                    bool cur_IsPrimary = oCBIsPrimary.Checked;
                    objToUpdate.IsPrimary = string.IsNullOrWhiteSpace(rowItem[&quot;IsPrimary&quot;].Text) ? cur_IsPrimary : rowItem[&quot;IsPrimary&quot;].Text.ToBoolean2();
                    //-------------------------------------------
                    string xmlRoleListMapping = rowItem[&quot;UserRolesMappingXml&quot;].Text;
                    List&lt;InviteUsersToProject.RoleDtl&gt; thisUsersGlobalRolesList = InviteUsersToProject.RoleList.XmlDecodeRoleListData(xmlRoleListMapping);

                    RadComboBox oRadComboBox = (RadComboBox)rowItem.FindControl(&quot;RadComboBoxUserRoles&quot;);

                    List&lt;int&gt; curSelected = oRadComboBox.CheckedItems.Where(t =&gt; t != null &amp;&amp; !string.IsNullOrEmpty(t.Value)).Select(t =&gt; t.Value.ToString2().ToInt32_2()).ToList();

                    foreach (InviteUsersToProject.RoleDtl roleItem in thisUsersGlobalRolesList)
                    { roleItem.HasProjectRole = curSelected.Any(t =&gt; t == roleItem.Id); }

                    objToUpdate.UserRolesMappingXml = InviteUsersToProject.RoleList.XmlEncodeRoleListData(thisUsersGlobalRolesList);
                        //-------------------------------------------
                }
            }
        }

        protected Dictionary&lt;int, ProjectRolesDataMap&gt; grdProjectsWithRoles_BackUpState()
        {
            Dictionary&lt;int, ProjectRolesDataMap&gt; curProjectMaps = new Dictionary&lt;int, ProjectRolesDataMap&gt;();

            if (grdProjectsWithRoles.Items.Count != 0)
            {
                //hdnEditRoles.Value = &quot;[{userId:1, roleIdArray:[1,2,3,4] },{userId:3, roleIdArray:[1,2,3,4] },...]&quot;;
                //Get existing state if available
                if (!string.IsNullOrWhiteSpace(hdnEditRoles.Value))
                {
                    string decryptedText = SecurityHelpers.Decrypt_Simple(hdnEditRoles.Value);
                    curProjectMaps = AllProjectRolesData.ParseUpdatedProjectRoleMappingList(decryptedText);
                }

                //Update the state of all existing items which are gonna get removed by LoadProjectUsers() method
                SaveStateOfAllUpdatesForUsersInCurrentPage(curProjectMaps, grdProjectsWithRoles.Items);
            }

            labelUnsavedChangesIndicator.Visible = curProjectMaps.Any();

            //Save the current state to hidden control
            AllProjectRolesData newDataToPersist = new AllProjectRolesData(curProjectMaps);

            hdnEditRoles.Value = SecurityHelpers.Encrypt_Simple(newDataToPersist.ToJsonString());

            return curProjectMaps;
        }

        #endregion  Temporary State Mgmt Related to Save Data Persistance

        //------------------------------------------------------------------------------------------------

        #region  grdProjectsWithRoles Related

        protected void grdProjectsWithRoles_SetEmptyDataSource()
        {
            grdProjectsWithRoles.DataSource = new object[] { };
            grdProjectsWithRoles.VirtualItemCount = 0;
            grdProjectsWithRoles.CurrentPageIndex = 0;
            grdProjectsWithRoles.MasterTableView.NoMasterRecordsText = string.Format(&quot;No {0}s available.&quot;, Localication_ProjectText);
        }

        protected void grdProjectsWithRoles_NeedDataSource(object sender, Telerik.Web.UI.GridNeedDataSourceEventArgs e)
        {

            Dictionary&lt;int, ProjectRolesDataMap&gt; curProjectMaps = grdProjectsWithRoles_BackUpState();

            grdProjectsWithRoles_FetchAndSetData(curProjectMaps);

            //Save the current state to hidden control
            hdnEditRoles.Value = SecurityHelpers.Encrypt_Simple(new AllProjectRolesData(curProjectMaps).ToJsonString());
        }

        protected void grdProjectsWithRoles_FetchAndSetData(Dictionary&lt;int, ProjectRolesDataMap&gt; curProjectMaps)
        {
            if (string.IsNullOrEmpty(ComboBoxUserSelection.SelectedValue))
            {
                grdProjectsWithRoles_SetEmptyDataSource();
                mainUpdatePanel.Update();
                return;
            }

            curProjectMaps = curProjectMaps ?? new Dictionary&lt;int, ProjectRolesDataMap&gt;();

            try
            {
                string[] columnArray = new string[] { &quot;ProjectId&quot;, &quot;ProjectName&quot;, &quot;ProjectCode&quot;, CONST_VirtualColumn_UserRolesMapping, CONST_UI_VirtualColumn_RoleNameCSV, CONST_UI_VirtualColumn_RoleIdCSV, &quot;IsPrimary&quot;, CONST_VirtualColumn_RoleNameCSV, CONST_UI_VirtualColumn_EditedIsPrimary };

                DataTable dtProjectData = new BrixDataTable();

                foreach (string colName in columnArray)
                {
                    switch (colName)
                    {
                        default: dtProjectData.Columns.Add(colName); break;
                        case &quot;IsPrimary&quot;: case CONST_UI_VirtualColumn_EditedIsPrimary: dtProjectData.Columns.Add(colName, typeof(bool)); break;
                    }
                }

                int currentPageIndex = grdProjectsWithRoles.CurrentPageIndex + 1;
                int selectedUserId = ComboBoxUserSelection.SelectedValue.ToInt32_2();
                int totalRecordCount = 0;

                string optionalContractorBiddingRoleNameToExclude = AMP3ApplicationSettings.Instance.appSettings[&quot;ContractorBiddingRole&quot;];

                DataTable dtProjects = ProjectManager.Instance.GetActiveProjectsForUserId(Session[Constants.EIS_ADDITIONAL_INFO].ToString2(), selectedUserId, ref currentPageIndex, SortingKeyWithSortOrder, CONST_PAGE_SIZE, out totalRecordCount, optionalContractorBiddingRoleNameToExclude);

                foreach (DataRow dbRowItem in dtProjects.Rows)
                {
                    #region Create proxy row for each DB Tuple
                    DataRow newRow = dtProjectData.NewRow();

                    foreach (string colName in columnArray)
                    {
                        switch (colName)
                        {
                            default: newRow[colName] = dbRowItem[colName].ToString(); break;
                            case &quot;IsPrimary&quot;: case CONST_UI_VirtualColumn_EditedIsPrimary: newRow[colName] = dbRowItem[&quot;IsPrimary&quot;].ToBoolean2(); break;
                            case CONST_UI_VirtualColumn_RoleNameCSV: case CONST_UI_VirtualColumn_RoleIdCSV: case CONST_VirtualColumn_RoleNameCSV: break; //CONST_VirtualColumn_RoleNameCSV this will contain all selected user roles
                        }
                    }

                    string xmlRoleListMapping = dbRowItem[CONST_VirtualColumn_UserRolesMapping].ToString2();

                    List&lt;InviteUsersToProject.RoleDtl&gt; thisUsersGlobalRolesList = InviteUsersToProject.RoleList.XmlDecodeRoleListData(xmlRoleListMapping);
                    List&lt;InviteUsersToProject.RoleDtl&gt; thisUsersProjectRolesList = null;

                    int projectId = dbRowItem[&quot;ProjectId&quot;].ToInt32_2();

                    if (!curProjectMaps.ContainsKey(projectId))
                        thisUsersProjectRolesList = thisUsersGlobalRolesList.Where(t =&gt; t.HasProjectRole).OrderBy(t =&gt; t.Name).ToList();
                    else
                    {
                        //this may contain items which are temporarily selected in memory in another page
                        thisUsersProjectRolesList = thisUsersGlobalRolesList.Where(t =&gt; curProjectMaps[projectId].SelectedRoleIdList.Contains(t.Id)).OrderBy(t =&gt; t.Name).ToList();

                        newRow[CONST_UI_VirtualColumn_EditedIsPrimary] = curProjectMaps[projectId].IsPrimary;
                    }

                    //we shall be showing only project users
                    string roleNameCSV = CONST_MSG_NoRoles; string roleIdCSV = string.Empty;

                    if (thisUsersProjectRolesList.Any())
                    {
                        roleNameCSV = string.Join(&quot;, &quot;, thisUsersProjectRolesList.Select(t =&gt; t.Name));
                        roleIdCSV = string.Join(&quot;, &quot;, thisUsersProjectRolesList.Select(t =&gt; t.Id.ToString2()));
                    }

                    newRow[CONST_UI_VirtualColumn_RoleNameCSV] = roleNameCSV;
                    newRow[CONST_UI_VirtualColumn_RoleIdCSV] = roleIdCSV;
                    newRow[CONST_VirtualColumn_RoleNameCSV] = roleIdCSV;

                    dtProjectData.Rows.Add(newRow);

                    #endregion Create proxy row for each DB Tuple
                }

                if (dtProjectData.Rows.Count == 0)
                    grdProjectsWithRoles_SetEmptyDataSource();
                else
                {
                    grdProjectsWithRoles.DataSource = dtProjectData;
                    grdProjectsWithRoles.MasterTableView.PageSize = CONST_PAGE_SIZE;
                    grdProjectsWithRoles.VirtualItemCount = totalRecordCount;// totalRecordCount* pagesize;
                }

                mainUpdatePanel.Update();
            }
            catch (Exception ex)
            {
                lblException.Text = ex.Message;
            }
        }

        protected void grdProjectsWithRoles_ItemDataBound(object sender, Telerik.Web.UI.GridItemEventArgs e)
        {
            if (!(e.Item is GridDataItem))
                return;

            GridDataItem rowItem = e.Item as GridDataItem;

            int projectId = IsEmptyOrNullOrHtmlSpace(rowItem[&quot;ProjectId&quot;].Text) ? 0 : rowItem[&quot;ProjectId&quot;].Text.ToInt32_2();

            if (projectId == 0)//&amp;&amp; dtUserRoles != null &amp;&amp; dtUserRoles.ContainsKey(userId.ToInt32_2()))
                return;

            int UserId = ComboBoxUserSelection.SelectedValue.ToInt32_2();

            rowItem[CONST_VirtualColumn_UserRolesMapping].Text = GenerateUserRoleMapping_OnTheFly(UserId);
            string xmlRoleListMapping = rowItem[CONST_VirtualColumn_UserRolesMapping].Text;


            List&lt;int&gt; selectedRolesIdList = new List&lt;int&gt;();

            CheckBox CBIsPrimary;
            CheckBox CBIsSelected;

            if (e.Item.OwnerTableView.Name == &quot;Details&quot;)
            {

                CBIsSelected = (CheckBox)rowItem.FindControl(&quot;CBIsSelect&quot;);

                CBIsSelected.Attributes.Add(&quot;onclick&quot;, &quot;UpdateDetailsGridJson(this,&#39;&quot; + rowItem.ItemIndexHierarchical + &quot;&#39;,&#39;grdProjectsWithRoles&#39;)&quot;);

                CBIsPrimary = (CheckBox)rowItem.FindControl(&quot;CBContractIsPrimary&quot;);

                CBIsPrimary.Attributes.Add(&quot;onclick&quot;, &quot;UpdateDetailsGridJson(this,&#39;&quot; + rowItem.ItemIndexHierarchical + &quot;&#39;,&#39;grdProjectsWithRoles&#39;)&quot;);
                
                HiddenField hidContract = (e.Item.OwnerTableView.ParentItem as GridDataItem)[&quot;ContractRoles&quot;].FindControl(&quot;hidContractRoles&quot;) as HiddenField;

                var chkisPrimary = false;

                if (hidContract.Value != &quot;&quot;)
                {
                    ContractRole[] CRole = JsonConvert.DeserializeObject&lt;ContractRole[]&gt;(hidContract.Value);

                    for (int i = 0; i &lt; CRole.Length; i++)
                    {
                        if (CRole[i].Id == rowItem[&quot;ContractId&quot;].Text.ToInt32_2() &amp;&amp; CRole[i].Selected==true)
                        {
                            chkisPrimary = CRole[i].IsPrimary;
                            selectedRolesIdList = CRole[i].RoleIds.Split(&quot;,&quot;.ToCharArray(), StringSplitOptions.RemoveEmptyEntries).Select(t =&gt; t.ToInt32_2()).ToList();
                        }
                    }
                    CBIsPrimary.Checked = chkisPrimary;
                }
                else
                {
                    if (rowItem[&quot;RoleID&quot;].Text != &quot;&amp;nbsp;&quot;)
                        selectedRolesIdList = rowItem[&quot;RoleID&quot;].Text.Split(&quot;,&quot;.ToCharArray(), StringSplitOptions.RemoveEmptyEntries).Select(t =&gt; t.ToInt32_2()).ToList();

                    CBIsPrimary.Checked = IsEmptyOrNullOrHtmlSpace(rowItem[&quot;IsPrimary&quot;].Text) ? false : rowItem[&quot;IsPrimary&quot;].Text.ToBoolean2();
                }

                if (selectedRolesIdList.Count &gt; 0)
                    CBIsSelected.Checked = true;

            }
            else
            {
                if (!IsEmptyOrNullOrHtmlSpace(rowItem[CONST_UI_VirtualColumn_RoleIdCSV].Text))
                    selectedRolesIdList = rowItem[CONST_UI_VirtualColumn_RoleIdCSV].Text.Split(&quot;,&quot;.ToCharArray(), StringSplitOptions.RemoveEmptyEntries).Select(t =&gt; t.ToInt32_2()).ToList();

                CBIsPrimary = (CheckBox)rowItem.FindControl(&quot;CBIsPrimary&quot;);

            }

            List&lt;InviteUsersToProject.RoleDtl&gt; thisUsersGlobalRolesList = InviteUsersToProject.RoleList.XmlDecodeRoleListData(xmlRoleListMapping);
            List&lt;InviteUsersToProject.RoleDtl&gt; thisUsersProjectRolesList = thisUsersGlobalRolesList.Where(t =&gt; selectedRolesIdList.Contains(t.Id)).OrderBy(t =&gt; t.Name).ToList();

            RadComboBox oRadComboBox = (RadComboBox)rowItem.FindControl(&quot;RadComboBoxUserRoles&quot;);
            oRadComboBox.DataSource = thisUsersGlobalRolesList.ToDictionary(k =&gt; k.Id, v =&gt; v.Name).OrderBy(t =&gt; t.Value);
            oRadComboBox.DataBind();

            oRadComboBox.Style.Add(&quot;Display&quot;, &quot;none&quot;);

            Label olblComboRoleId = (Label)(((Telerik.Web.UI.GridTableCell)(rowItem[CONST_VirtualColumn_RoleNameCSV]))).FindControl(&quot;lblComboRoleId&quot;);
            olblComboRoleId.Style.Add(&quot;Display&quot;, &quot;none&quot;);

            Label olblComboUsers = (Label)(((Telerik.Web.UI.GridTableCell)(rowItem[CONST_VirtualColumn_RoleNameCSV]))).FindControl(&quot;lblComboUsers&quot;);

            if (thisUsersProjectRolesList.Count == 0)
                olblComboUsers.Text = CONST_MSG_NoRoles;
            else
            {
                foreach (InviteUsersToProject.RoleDtl roleDto in thisUsersProjectRolesList)
                {
                    RadComboBoxItem itemoRadComboBox = oRadComboBox.FindItemByValue(roleDto.Id.ToString());
                    if (itemoRadComboBox != null)
                    {
                        itemoRadComboBox.Selected = true;
                        itemoRadComboBox.Checked = true;
                    }
                }

                //e.Item.DataItem[&quot;EmployeeID&quot;] = 
                olblComboRoleId.Text = string.Join(&quot;,&quot;, thisUsersProjectRolesList.Select(t =&gt; t.Id));
                olblComboUsers.Text = string.Join(&quot;,&quot;, thisUsersProjectRolesList.Select(t =&gt; t.Name));
            }
            CBIsPrimary.Checked = IsEmptyOrNullOrHtmlSpace(rowItem[&quot;IsPrimary&quot;].Text) ? false : rowItem[&quot;IsPrimary&quot;].Text.ToBoolean2();
            //((CheckBox)rowItem.FindControl(&quot;CBIsPrimary&quot;)).Checked = IsEmptyOrNullOrHtmlSpace(rowItem[CONST_UI_VirtualColumn_EditedIsPrimary].Text) ? false : rowItem[CONST_UI_VirtualColumn_EditedIsPrimary].Text.ToBoolean2();
        }

        protected void grdProjectsWithRoles_SortCommand(object sender, GridSortCommandEventArgs e)
        {
            string key = Aurigo.Brix.Platform.BusinessLayer.Utility.MWGrid.GetDatabaseFriendlyExpression(e.CommandArgument.ToString());
            GridSortOrder sortOrder = e.NewSortOrder;
            _pageState_ProjectRoleGrid.SortKey = key;
            _pageState_ProjectRoleGrid.SortOrder = sortOrder;
        }
        #endregion  grdProjectsWithRoles Related

        //------------------------------------------------------------------------------------------------

        #region  grdNewProjects Related
        protected void grdNewProjects_NeedDataSource(object sender, GridNeedDataSourceEventArgs e)
        {
            Dictionary&lt;int, NewProjectDto&gt; curNewProjectMaps = new Dictionary&lt;int, NewProjectDto&gt;();

            if (!string.IsNullOrWhiteSpace(hdnNewProjectAdded.Value))
            {
                string decryptedText = SecurityHelpers.Decrypt_Simple(hdnNewProjectAdded.Value);
                curNewProjectMaps = AllNewProjectDtoData.ParseNewProjectDtoMappingList(decryptedText);
            }

            if (grdNewProjects.Items.Count &gt; 0)
                //Existing state of the datagrid item update it to hidden field
                SaveStateOfAllUpdatesFor_NewProjectList(curNewProjectMaps, grdNewProjects.Items);

            ////curProjectAssocaiations.Add(new NewProjectDto() { ProjectName = &quot;AAA&quot; });
            ////curProjectAssocaiations.Add(new NewProjectDto() { ProjectName = &quot;BBB&quot; });

            grdNewProjects_FetchAndSetData(curNewProjectMaps.Select(t =&gt; t.Value).ToList(), false);
        }

        protected void grdNewProjects_FetchAndSetData(List&lt;NewProjectDto&gt; curProjectAssocaiations, bool isCallDataBind = true)
        {
            curProjectAssocaiations = curProjectAssocaiations ?? new List&lt;NewProjectDto&gt;();

            try
            {
                DataTable dtProjectData = NewProjectDto.CreateDataTableToSupportNewProjectDtoClass();

                foreach (NewProjectDto newItem in curProjectAssocaiations.OrderBy(t =&gt; t.ProjectName))
                {
                    newItem.Set_RoleRelatedProperties_UsingXML();

                    #region Create proxy row for each DB Tuple
                    DataRow newRow = newItem.GetRowForDataTable_ByMappingThisObject(dtProjectData);

                    //string xmlRoleListMapping = newRow[&quot;RoleID&quot;].ToString2();

                    //List&lt;InviteUsersToProject.RoleDtl&gt; thisUsersGlobalRolesList = InviteUsersToProject.RoleList.XmlDecodeRoleListData(xmlRoleListMapping);
                    //List&lt;InviteUsersToProject.RoleDtl&gt; thisUsersProjectRolesList = null;

                    //int projectId = newRow[&quot;ProjectId&quot;].ToInt32_2();

                    //var related_newProjectDto = curProjectAssocaiations.FirstOrDefault(t =&gt; t.ProjectId == projectId);

                    //if (related_newProjectDto == null)
                    //    thisUsersProjectRolesList = thisUsersGlobalRolesList.Where(t =&gt; t.HasProjectRole).ToList();
                    //else
                    //{
                    //    //this may contain items which are temporarily selected in memory in another page
                    //    thisUsersProjectRolesList = thisUsersGlobalRolesList.Where(t =&gt; curProjectAssocaiations[projectId].SelectedRoleIdList.Contains(t.Id)).ToList();

                    //    newRow[CONST_UI_VirtualColumn_EditedIsPrimary] = related_newProjectDto.IsPrimary;
                    //}

                    ////we shall be showing only project users
                    //string roleNameCSV = CONST_MSG_NoRoles; string roleIdCSV = string.Empty;

                    //if (thisUsersProjectRolesList.Any())
                    //{
                    //    roleNameCSV = string.Join(&quot;, &quot;, thisUsersProjectRolesList.Select(t =&gt; t.Name));
                    //    roleIdCSV = string.Join(&quot;, &quot;, thisUsersProjectRolesList.Select(t =&gt; t.Id.ToString2()));
                    //}

                    //newRow[CONST_UI_VirtualColumn_RoleNameCSV] = roleNameCSV;
                    //newRow[CONST_UI_VirtualColumn_RoleIdCSV] = roleIdCSV;
                    //newRow[CONST_VirtualColumn_RoleNameCSV] = roleIdCSV;

                    dtProjectData.Rows.Add(newRow);

                    #endregion Create proxy row for each DB Tuple
                }

                grdNewProjects.DataSource = dtProjectData;                

                if (isCallDataBind)
                    grdNewProjects.DataBind();

                if (curProjectAssocaiations.Count == 0)
                {
                    //lblNewProjectAddStatus.Text = string.Format(&quot;No new {0}(s) added for this user.&quot;, Localication_ProjectText);
                    //grdNewProjects.Visible = false;
                    lblAddedProjectsNeedsSaving.Visible = false;
                    btnRemoveNewProject.Enabled = false;
                }
                else
                {
                    //lblNewProjectAddStatus.Text = string.Format(&quot;Below are {0}(s) added for this user.&quot;, Localication_ProjectText);
                    //grdNewProjects.Visible = true;
                    lblAddedProjectsNeedsSaving.Visible = true;
                    btnRemoveNewProject.Enabled = true;
                }

            }
            catch (Exception ex)
            {
                lblException.Text = ex.Message;
            }
        }

        protected void grdNewProjects_ItemDataBound(object sender, GridItemEventArgs e)
        {
            if (!(e.Item is GridDataItem))
                return;

            int projectId = 0;
            GridDataItem rowItem = e.Item as GridDataItem;

            projectId = IsEmptyOrNullOrHtmlSpace(rowItem[&quot;ProjectId&quot;].Text) ? 0 : rowItem[&quot;ProjectId&quot;].Text.ToInt32_2();

            if (projectId == 0)//&amp;&amp; dtUserRoles != null &amp;&amp; dtUserRoles.ContainsKey(userId.ToInt32_2()))
                return;

            int UserId=ComboBoxUserSelection.SelectedValue.ToInt32_2();

            rowItem[&quot;UserRolesMappingXml&quot;].Text = GenerateUserRoleMapping_OnTheFly(UserId);
            string xmlRoleListMapping = rowItem[&quot;UserRolesMappingXml&quot;].Text;

            List&lt;int&gt; selectedRolesIdList = new List&lt;int&gt;();

           

            List&lt;InviteUsersToProject.RoleDtl&gt; thisUsersGlobalRolesList = InviteUsersToProject.RoleList.XmlDecodeRoleListData(xmlRoleListMapping);
            List&lt;InviteUsersToProject.RoleDtl&gt; thisUsersProjectRolesList=null;
            RadComboBox oRadComboBox;
            Label olblComboRoleId;
            Label olblComboUsers;
            CheckBox CBIsPrimary;
            CheckBox CBIsSelected;

            if (e.Item.OwnerTableView.Name == &quot;Details&quot;)
            {
                CBIsSelected = (CheckBox)rowItem.FindControl(&quot;CBIsSelect&quot;);
                
                CBIsSelected.Attributes.Add(&quot;onclick&quot;, &quot;UpdateDetailsGridJson(this,&#39;&quot; + rowItem.ItemIndexHierarchical + &quot;&#39;,&#39;grdNewProjects&#39;)&quot;);

                CBIsPrimary = (CheckBox)rowItem.FindControl(&quot;CBContractIsPrimary&quot;);

                CBIsPrimary.Attributes.Add(&quot;onclick&quot;, &quot;UpdateDetailsGridJson(this,&#39;&quot; + rowItem.ItemIndexHierarchical + &quot;&#39;,&#39;grdNewProjects&#39;)&quot;);

                HiddenField hidContract= (e.Item.OwnerTableView.ParentItem as GridDataItem)[&quot;ContractRoles&quot;].FindControl(&quot;hidContractRoles&quot;) as HiddenField;

                if(hidContract.Value!=&quot;&quot;)
                {
                    ContractRole[] CRole = JsonConvert.DeserializeObject&lt;ContractRole[]&gt;(hidContract.Value);

                    for(int i=0; i&lt;CRole.Length;i++)
                    {
                        if(CRole[i].Id == rowItem[&quot;ContractId&quot;].Text.ToInt32_2() &amp;&amp; CRole[i].Selected==true)
                        {
                            selectedRolesIdList = CRole[i].RoleIds.Split(&quot;,&quot;.ToCharArray(), StringSplitOptions.RemoveEmptyEntries).Select(t =&gt; t.ToInt32_2()).ToList();
                        }
                    }
                }
                else
                {
                    if(rowItem[&quot;RoleID&quot;].Text!=&quot;&amp;nbsp;&quot;)
                        selectedRolesIdList = rowItem[&quot;RoleID&quot;].Text.Split(&quot;,&quot;.ToCharArray(), StringSplitOptions.RemoveEmptyEntries).Select(t =&gt; t.ToInt32_2()).ToList();
                }

                if (selectedRolesIdList.Count &gt; 0)
                    CBIsSelected.Checked = true;

            }               
            else
            {
                if (!IsEmptyOrNullOrHtmlSpace(rowItem[&quot;RoleID&quot;].Text))
                    selectedRolesIdList = rowItem[&quot;RoleID&quot;].Text.Split(&quot;,&quot;.ToCharArray(), StringSplitOptions.RemoveEmptyEntries).Select(t =&gt; t.ToInt32_2()).ToList();

                CBIsPrimary = (CheckBox)rowItem.FindControl(&quot;CBIsPrimary&quot;);
               
            }
           
            thisUsersProjectRolesList = thisUsersGlobalRolesList.Where(t =&gt; selectedRolesIdList.Contains(t.Id)).OrderBy(t =&gt; t.Name).ToList();


            oRadComboBox = (RadComboBox)rowItem.FindControl(&quot;RadComboBoxUserRoles&quot;);
            olblComboRoleId = (Label)(((Telerik.Web.UI.GridTableCell)(rowItem[CONST_VirtualColumn_RoleNameCSV]))).FindControl(&quot;lblComboRoleId&quot;);
            olblComboUsers = (Label)(((Telerik.Web.UI.GridTableCell)(rowItem[CONST_VirtualColumn_RoleNameCSV]))).FindControl(&quot;lblComboUsers&quot;);
            oRadComboBox.DataSource = thisUsersGlobalRolesList.ToDictionary(k =&gt; k.Id, v =&gt; v.Name).OrderBy(t =&gt; t.Value);
            oRadComboBox.DataBind();

            olblComboRoleId.Style.Add(&quot;Display&quot;, &quot;none&quot;);
            oRadComboBox.Style.Add(&quot;Display&quot;, &quot;none&quot;);

            //Label olblComboRoleId = (Label)(((Telerik.Web.UI.GridTableCell)(rowItem[CONST_VirtualColumn_RoleNameCSV]))).FindControl(&quot;lblComboRoleId&quot;);
            //olblComboRoleId.Style.Add(&quot;Display&quot;, &quot;none&quot;);

            //Label olblComboUsers = (Label)(((Telerik.Web.UI.GridTableCell)(rowItem[CONST_VirtualColumn_RoleNameCSV]))).FindControl(&quot;lblComboUsers&quot;);

            if (thisUsersProjectRolesList.Count == 0)
                olblComboUsers.Text = CONST_MSG_NoRoles;
            else
            {
                foreach (InviteUsersToProject.RoleDtl roleDto in thisUsersProjectRolesList)
                {
                    RadComboBoxItem itemoRadComboBox = oRadComboBox.FindItemByValue(roleDto.Id.ToString());
                    if (itemoRadComboBox != null)
                    {
                        itemoRadComboBox.Selected = true;
                        itemoRadComboBox.Checked = true;
                    }
                }

                //e.Item.DataItem[&quot;EmployeeID&quot;] = 
                olblComboRoleId.Text = string.Join(&quot;,&quot;, thisUsersProjectRolesList.Select(t =&gt; t.Id));
                olblComboUsers.Text = string.Join(&quot;,&quot;, thisUsersProjectRolesList.Select(t =&gt; t.Name));
            }
            CBIsPrimary.Checked = IsEmptyOrNullOrHtmlSpace(rowItem[&quot;IsPrimary&quot;].Text) ? false : rowItem[&quot;IsPrimary&quot;].Text.ToBoolean2();
            //((CheckBox)rowItem.FindControl(&quot;CBIsPrimary&quot;)).Checked = IsEmptyOrNullOrHtmlSpace(rowItem[&quot;IsPrimary&quot;].Text) ? false : rowItem[&quot;IsPrimary&quot;].Text.ToBoolean2();
        }


        protected void grdNewProjects_DetailTableDataBind(object source, Telerik.Web.UI.GridDetailTableDataBindEventArgs e)
        {
            GridDataItem dataItem = (GridDataItem)e.DetailTableView.ParentItem;
            string ProjectID = dataItem.GetDataKeyValue(&quot;ProjectId&quot;).ToString();


            if(e.DetailTableView.Name== &quot;Details&quot;)
            {
                DataTable dt = ComponentHelper.Instance.ExecuteDataSet(
                StoredProcedure.usp_getContractorForNewProject, null, ProjectID,ComboBoxUserSelection.SelectedValue).Tables[0];
                e.DetailTableView.DataSource = dt;              
            }
                      


        }

        protected void grdProjectsWithRoles_DetailTableDataBound(object source, Telerik.Web.UI.GridDetailTableDataBindEventArgs e)
        {
            GridDataItem dataItem = (GridDataItem)e.DetailTableView.ParentItem;
            string ProjectID = dataItem.GetDataKeyValue(&quot;ProjectId&quot;).ToString();


            if (e.DetailTableView.Name == &quot;Details&quot;)
            {
                DataTable dt = ComponentHelper.Instance.ExecuteDataSet(
                StoredProcedure.usp_getContractorForProject, null, ProjectID, ComboBoxUserSelection.SelectedValue).Tables[0];
                e.DetailTableView.DataSource = dt;
            }
        }

        #endregion  grdNewProjects Related

        //------------------------------------------------------------------------------------------------

        #region Picker

        protected void ProjectPicker_Initialize()
        {
            ProjectPicker.InitializePicker(&quot;/api/ManageProjects&quot;, ProjectPicker_GetColumsForProjection(), &quot;ProjectId&quot;);
            ProjectPicker.TriggerButton.Style.Add(HtmlTextWriterStyle.Display, &quot;none&quot;);
            ProjectPicker.PostBackAfterSelect = true;
            ProjectPicker.EnableMultiSelect = true;
            ProjectPicker.OnGridLoad += new PickerGrid.GridLoad(ProjectPicker_OnGridLoad);

            //ProjectPicker.PageSize = pickerPageSize;
            //ProjectPicker.BeforePickerLoadScript = &quot;FilterSelectedContractors(&#39;Prime&#39;)&quot;;

            ProjectPicker.Title = Localication_ProjectText + &quot;s List&quot;;
            ProjectPicker.OnItemSelected += new PickerGrid.SelectedItems(ProjectPicker_OnItemSelected);
        }

        protected void ProjectPicker_OnGridLoad(PickerGrid grid)
        {
            List&lt;int&gt; projectIdList = new List&lt;int&gt;();

            Dictionary&lt;int, NewProjectDto&gt; curNewProjectMaps = new Dictionary&lt;int, NewProjectDto&gt;();

            if (!string.IsNullOrWhiteSpace(hdnNewProjectAdded.Value))
            {
                string decryptedText = SecurityHelpers.Decrypt_Simple(hdnNewProjectAdded.Value);
                curNewProjectMaps = AllNewProjectDtoData.ParseNewProjectDtoMappingList(decryptedText);
            }

            foreach (GridDataItem rowItem in grdProjectsWithRoles.Items)
            {
                int projectId = 0;

                if (!(int.TryParse(rowItem[&quot;ProjectId&quot;].Text, out projectId) &amp;&amp; projectId &gt; 0))
                    continue;

                projectIdList.Add(projectId);
            }

            foreach (GridDataItem rowItem in grdNewProjects.Items)
            {
                int projectId = 0;

                if (!(int.TryParse(rowItem[&quot;ProjectId&quot;].Text, out projectId) &amp;&amp; projectId &gt; 0))
                    continue;

                projectIdList.Add(projectId);
            }

            var curUserDetails = UserDetail.GetCurrentUserDetail();

            string json = JsonConvert.SerializeObject(new Brix.Platform.BusinessLayer.BL.ActiveProjectsData()
            {
                ErpCompany = string.Empty,
                CurrentUserID = curUserDetails.UID,
                RoleId = curUserDetails.RID,
                SelectedUserID = ComboBoxUserSelection.SelectedValue.ToInt32_2(),
                ExcludeProjectIdCSV = string.Join(&quot;,&quot;, projectIdList),
            });

            //string json = &quot;{&quot;;
            //json += &quot;\&quot;ErpCompany\&quot; : \&quot;\&quot;  &quot;;
            //json += &quot;, \&quot;CurrentUserID\&quot; : &quot; + UserDetail.GetCurrentUserDetail().UID;
            //json += &quot;, \&quot;RoleId\&quot; : &quot; + UserDetail.GetCurrentUserDetail().RID;
            //json += &quot;, \&quot;SelectedUserID\&quot; : &quot; + ComboBoxUserSelection.SelectedValue;
            //json += string.Format(&quot;, \&quot;ExcludeProjectIdCSV\&quot; : \&quot;{0}\&quot;&quot;, string.Join(&quot;,&quot;, projectIdList));
            //json += &quot;}&quot;;

            ProjectPicker.OptionalParamaters = ProjectPicker.BuildOptionalParameters(json);

            //grdProjectsWithRoles_BackUpState();
        }

        protected void ProjectPicker_OnItemSelected(PickerGrid grid, List&lt;Dictionary&lt;string, object&gt;&gt; selectedRows)
        {
            if (string.IsNullOrWhiteSpace(ComboBoxUserSelection.SelectedValue))
                return;

            int userId = ComboBoxUserSelection.SelectedValue.ToInt32_2();

            //grdProjectsWithRoles_BackUpState();

            Dictionary&lt;int, NewProjectDto&gt; curNewProjectMaps = new Dictionary&lt;int, NewProjectDto&gt;();


            if (!string.IsNullOrWhiteSpace(hdnNewProjectAdded.Value))
            {
                string decryptedText = SecurityHelpers.Decrypt_Simple(hdnNewProjectAdded.Value);

                curNewProjectMaps = AllNewProjectDtoData.ParseNewProjectDtoMappingList(decryptedText);
            }

            //Existing state of the datagrid item update it to hidden field
            SaveStateOfAllUpdatesFor_NewProjectList(curNewProjectMaps, grdNewProjects.Items);

            string userRolesMappingXml_ForNewProject = GenerateUserRoleMapping_OnTheFly(userId);

            string selectedIDs = string.Empty;
            foreach (Dictionary&lt;string, object&gt; dic in selectedRows)
            {
                int projectId = dic[&quot;ProjectId&quot;].ToString().ToInt32_2();

                if (curNewProjectMaps.ContainsKey(projectId))
                    continue;

                string projectName = dic[&quot;ProjectName&quot;].ToString();
                string projectCode = dic[&quot;ProjectCode&quot;].ToString();

                curNewProjectMaps.Add(projectId, new NewProjectDto()
                {
                    UserId = userId,
                    ProjectId = projectId,
                    ProjectName = projectName,
                    ProjectCode = projectCode,
                    Selected_RoleNameCSV = string.Empty,
                    Selected_RoleIdCSV = string.Empty,
                    IsPrimary = true,
                    UserRolesMappingXml = userRolesMappingXml_ForNewProject,
                });

            }

            hdnNewProjectAdded.Value = SecurityHelpers.Encrypt_Simple((new AllNewProjectDtoData(curNewProjectMaps)).ToJsonString());

            grdNewProjects_FetchAndSetData(curNewProjectMaps.Select(t =&gt; t.Value).ToList());

            grdProjectsWithRoles.Rebind();

        }

        protected List&lt;PickerColumnDetails&gt; ProjectPicker_GetColumsForProjection()
        {
            List&lt;PickerColumnDetails&gt; gridColumns = new List&lt;PickerColumnDetails&gt;();

            List&lt;string&gt; allColumns = new List&lt;string&gt;() { &quot;ProjectId&quot;, &quot;ProjectCode&quot;, &quot;ProjectName&quot;, &quot;Description&quot; };

            Dictionary&lt;string, string&gt; visibleColumns = new Dictionary&lt;string, string&gt;();
            visibleColumns.Add(&quot;ProjectCode&quot;, LocalizationManager.GetString(&quot;Project Code&quot;));
            visibleColumns.Add(&quot;ProjectName&quot;, &quot;Project Name&quot;);
            visibleColumns.Add(&quot;Description&quot;, &quot;Description&quot;);
            foreach (string col in allColumns)
            {
                if (!visibleColumns.ContainsKey(col))
                {
                    PickerColumnDetails tCol = new PickerColumnDetails
                    {
                        Caption = col,
                        ColumnName = col,
                        Hidden = true
                    };
                    gridColumns.Add(tCol);
                }
                else
                {
                    PickerColumnDetails tCol = new PickerColumnDetails
                    {
                        Caption = visibleColumns[col],
                        ColumnName = col,
                        Hidden = false,
                        Width = 200,
                        Type = &quot;string&quot;
                    };
                    gridColumns.Add(tCol);
                }
            }

            return gridColumns;
        }

        protected string GenerateUserRoleMapping_OnTheFly(int userId)
        {
            Dictionary&lt;int, string&gt; roles = UserManager.Instance.GetAssignedRolesOfUser(userId);

            XmlDocument doc = new XmlDocument();
            XmlElement elRoleList = (XmlElement)doc.AppendChild(doc.CreateElement(&quot;RoleList&quot;));

            foreach (var item in roles)
            {
                //&lt; RoleList &gt;&lt; RoleDtl Id = &quot;1&quot; Name = &quot;Administrator&quot; HasProjectRole = &quot;false&quot; /&gt;&lt;/ RoleList &gt;
                XmlElement elRoleDtl = doc.CreateElement(&quot;RoleDtl&quot;);
                elRoleDtl.SetAttribute(&quot;Id&quot;, item.Key.ToString2());
                elRoleDtl.SetAttribute(&quot;Name&quot;, item.Value.ToString2());
                elRoleDtl.SetAttribute(&quot;HasProjectRole&quot;, &quot;true&quot;);

                elRoleList.AppendChild(elRoleDtl);
            }

            return doc.OuterXml;
        }
        #endregion

        //------------------------------------------------------------------------------------------------

        #region Save And Remove Button Handlers
        protected bool ValidateInvalidProjectUserBusinessUnit(out string projectCodeCSV)
        {
            bool flag = true;
            projectCodeCSV = string.Empty;

            StringBuilder sbProjectIds = new StringBuilder();
            int usersid = int.Parse(ComboBoxUserSelection.SelectedValue.ToString());

            foreach (GridDataItem item in grdProjectsWithRoles.Items)
                sbProjectIds.Append(item[&quot;ProjectID&quot;].Text).Append(&quot;,&quot;);

            foreach (GridDataItem item in grdNewProjects.Items)
                sbProjectIds.Append(item[&quot;ProjectID&quot;].Text).Append(&quot;,&quot;);

            if(sbProjectIds.Length &gt; 0)
            {
                sbProjectIds = sbProjectIds.Replace(&quot;,&quot;, string.Empty, sbProjectIds.Length - 1, 1);//remove the last comma
                flag = ProjectManager.Instance.PROJECTValidateInvalidProjectToUsers(sbProjectIds.ToString(), out projectCodeCSV);
            }
            return flag;
        }

        protected void btnRemove_Click(object sender, EventArgs e)
        {
            if (string.IsNullOrEmpty(ComboBoxUserSelection.SelectedValue) || string.IsNullOrEmpty(hdnDeleteId.Value))
            {
                //lblException.ForeColor = Color.Red;
                //lblException.Text = string.Format(&quot;No user selected to remove data for.&quot;);
                base.ShowError(&quot;No user/project selected to remove data for.&quot;);
                return;
            }

            try
            {
                var sWr = new StringWriter(CultureInfo.CurrentCulture);
                var xWr = new XmlTextWriter(sWr);

                try
                {
                    xWr.WriteStartElement(&quot;UserInfo&quot;);
                    xWr.WriteElementString(&quot;UserID&quot;, ComboBoxUserSelection.SelectedValue); //UserID
                                                                                           //RowsCollection rowColl = grdProjectsWithRoles.Rows;
                    try
                    {
                        string[] idArrayFromClient = hdnDeleteId.Value.Split(&quot;,&quot;.ToCharArray(), StringSplitOptions.RemoveEmptyEntries);

                        if (grdProjectsWithRoles.SelectedItems.Count == 0)
                        {
                            base.ShowError(&quot;There is no record to remove data.&quot;);
                            return;
                        }

                        foreach (GridDataItem rowItem in grdProjectsWithRoles.SelectedItems)
                        {
                            string rowIdToDelete = rowItem[&quot;ProjectID&quot;].Text;

                            if (!idArrayFromClient.Contains(rowIdToDelete))
                            {
                                base.ShowError(&quot;Operation failed (refresh of page not supported). Please do not refresh the page.&quot;);
                                return;
                            }
                        }

                    }
                    catch (Exception ex)
                    {
                        base.ShowError(&quot;Operation failed (refresh of page not supported). Please do not refresh the page.&quot;);
                        return;
                    }

                    foreach (GridDataItem rowItem in grdProjectsWithRoles.SelectedItems)
                    {
                        //RadComboBox oRadComboBox = (RadComboBox)item.FindControl(&quot;RadComboBoxUserRoles&quot;);
                        //Get the original mapping
                        string xmlRoleListMapping = rowItem[CONST_VirtualColumn_UserRolesMapping].Text;
                        List&lt;InviteUsersToProject.RoleDtl&gt; thisUsersGlobalRolesList = InviteUsersToProject.RoleList.XmlDecodeRoleListData(xmlRoleListMapping);

                        var allProjectRoleMapping = thisUsersGlobalRolesList.Where(t =&gt; t.HasProjectRole);

                        foreach (InviteUsersToProject.RoleDtl roleDtlItem in allProjectRoleMapping)
                        {
                            xWr.WriteStartElement(&quot;Project&quot;);
                            CheckBox oCBIsPrimary = (CheckBox)(((Telerik.Web.UI.GridTableCell)(rowItem[&quot;ComboUserRoles&quot;]))).FindControl(&quot;CBIsPrimary&quot;);

                            bool cur_IsPrimary = oCBIsPrimary.Checked;
                            bool original_IsPrimary = string.IsNullOrWhiteSpace(rowItem[&quot;IsPrimary&quot;].Text) ? cur_IsPrimary : rowItem[&quot;IsPrimary&quot;].Text.ToBoolean2();

                            xWr.WriteElementString(&quot;Selected&quot;, &quot;false&quot;);//false = means remove item
                            xWr.WriteElementString(&quot;ProjectID&quot;, rowItem[&quot;ProjectID&quot;].Text.ToString2());
                            xWr.WriteElementString(&quot;RoleID&quot;, roleDtlItem.Id.ToString2());
                            xWr.WriteElementString(&quot;IsPrimary&quot;, original_IsPrimary.ToString2());
                            xWr.WriteEndElement();
                        }
                    }
                }
                catch { throw; }
                finally
                {
                    xWr.WriteEndElement(); // UserInfo
                    xWr.Flush();
                    string s = sWr.ToString2();
                    sWr.Close();

                    ProjectManager.Instance.AddOrRemoveUserInProjects(s);
                }

                hdnDeleteId.Value = string.Empty;

                grdProjectsWithRoles.Rebind();

                grdNewProjects.Rebind();

                //lblException.ForeColor = Color.Green;
                //lblException.Text = &quot;Removed Successfully.&quot;;
                base.ShowSuccess(&quot;Removed Successfully.&quot;);
                return;
            }
            catch (Exception ex)
            {
                lblException.ForeColor = Color.Red;
                lblException.Text = ex.Message;
            }
        }

        protected void btnSave_Click(object sender, EventArgs e)
        {
            if (string.IsNullOrEmpty(ComboBoxUserSelection.SelectedValue))
            {
                //lblException.ForeColor = Color.Red;
                //lblException.Text = string.Format(&quot;No user selected to save data for.&quot;);
                base.ShowError(&quot;No user selected to save data for.&quot;);
                return;
            }

            string saveForUserName = ComboBoxUserSelection.Text;

            string projectCodeCSV = string.Empty;
            if (!ValidateInvalidProjectUserBusinessUnit(out projectCodeCSV))
            {
                //lblException.ForeColor = Color.Red;
                //lblException.Text = 
                string errMsg = String.Format(&quot;{0} is not same for {1} {2}&quot;, LocalizationManager.GetString(&quot;BusinessUnit&quot;), LocalizationManager.GetString(&quot;Project&quot;), projectCodeCSV);
                base.ShowError(errMsg);
                return;
            }

            try
            {
                Dictionary&lt;int, ProjectRolesDataMap&gt; lookupExistingEdits = new Dictionary&lt;int, ProjectRolesDataMap&gt;();

                //Step 1: First check any data from other pages that need to be saved.
                if (!string.IsNullOrWhiteSpace(hdnEditRoles.Value))
                {
                    string decryptedText = SecurityHelpers.Decrypt_Simple(hdnEditRoles.Value);
                    lookupExistingEdits = AllProjectRolesData.ParseUpdatedProjectRoleMappingList(decryptedText);
                }

                if (grdProjectsWithRoles.Items.Count &gt; 0)
                    //Update content of existing page to the lookupExistingEdits dictionary
                    SaveStateOfAllUpdatesForUsersInCurrentPage(lookupExistingEdits, grdProjectsWithRoles.Items);

                //Do a quick validation of all data to be saved

                if (!lookupExistingEdits.Keys.Any() &amp;&amp; grdNewProjects.Items.Count == 0 &amp;&amp; !IsContractRoleEditedForExistingProject())
                {
                    base.ShowInfo(&quot;No data to be saved.&quot;);
                    return;
                }

                bool isAllDataValid = true;

                StringBuilder sbError = new StringBuilder();

                sbError.Append(&quot;Please select at least one Role for the following &quot; + Localication_ProjectText + &quot;s : &quot;);

                foreach (int projectIdKey in lookupExistingEdits.Keys)
                {
                    //ProjectManager.Instance.DeleteUserRole(projectID, projectIdKey);
                    ProjectRolesDataMap uMap = lookupExistingEdits[projectIdKey];

                    if (uMap.SelectedRoleIdList == null || uMap.SelectedRoleIdList.Count == 0)
                    {
                        isAllDataValid = false;
                        sbError.Append(uMap.ProjectName);
                        sbError.Append(&quot;,&quot;);
                    }
                }

                foreach (GridDataItem item in grdNewProjects.Items)
                {
                    if (item.OwnerTableView.DetailTableIndex &lt; 0)
                    {
                        RadComboBox oRadComboBox = (RadComboBox)item.FindControl(&quot;RadComboBoxUserRoles&quot;);
                        if (oRadComboBox.CheckedItems.Count == 0)
                        {
                            isAllDataValid = false;
                            sbError.Append(item[&quot;ProjectName&quot;].Text);
                            sbError.Append(&quot;,&quot;);
                        }
                    }
                }

                if (!isAllDataValid)
                    base.ShowError(sbError.ToString());
                else
                {
                    //TODO: validate the same as above for the new project items also

                    var sWr = new StringWriter(CultureInfo.CurrentCulture);
                    var xWr = new XmlTextWriter(sWr);

                    xWr.WriteStartElement(&quot;UserInfo&quot;);
                    xWr.WriteElementString(&quot;UserID&quot;, ComboBoxUserSelection.SelectedValue); //UserID  //RowsCollection rowColl = grdProjectsWithRoles.Rows;

                    foreach (int projectIdKey in lookupExistingEdits.Keys)
                    {
                        //ProjectManager.Instance.DeleteUserRole(projectID, projectIdKey);
                        ProjectRolesDataMap uMap = lookupExistingEdits[projectIdKey];

                        foreach (int roleId in uMap.SelectedRoleIdList)
                        {
                            xWr.WriteStartElement(&quot;Project&quot;);

                            xWr.WriteElementString(&quot;Selected&quot;, &quot;true&quot;);//means it is for add or update
                            xWr.WriteElementString(&quot;ProjectID&quot;, projectIdKey.ToString2());
                            xWr.WriteElementString(&quot;RoleID&quot;, roleId.ToString2());
                            xWr.WriteElementString(&quot;IsPrimary&quot;, uMap.IsPrimary.ToString2().ToLower2());

                            xWr.WriteEndElement();
                        }
                    }

                    foreach (GridDataItem item in grdNewProjects.Items)
                    {
                        if (item.OwnerTableView.DetailTableIndex &lt; 0)
                        {
                            RadComboBox oRadComboBox = (RadComboBox)item.FindControl(&quot;RadComboBoxUserRoles&quot;);
                            foreach (RadComboBoxItem checkeditem in oRadComboBox.CheckedItems)
                            {                            
                                xWr.WriteStartElement(&quot;Project&quot;);
                                CheckBox oCBIsPrimary = (CheckBox)(((Telerik.Web.UI.GridTableCell)(item[&quot;ComboUserRoles&quot;]))).FindControl(&quot;CBIsPrimary&quot;);
                                bool isPrimary = oCBIsPrimary.Checked;

                                xWr.WriteElementString(&quot;Selected&quot;, &quot;true&quot;);//means it is for add or update
                                xWr.WriteElementString(&quot;ProjectID&quot;, item[&quot;ProjectID&quot;].Text.ToString2());
                                xWr.WriteElementString(&quot;RoleID&quot;, checkeditem.Value.ToString2());
                                xWr.WriteElementString(&quot;IsPrimary&quot;, isPrimary.ToString2());
                                xWr.WriteEndElement();
                            }                            
                        }
                    }

                    xWr.WriteEndElement(); // UserInfo
                    xWr.Flush();
                    string s = sWr.ToString2();
                    sWr.Close();
                                      
                    ProjectManager.Instance.AddOrRemoveUserInProjects(s);
                    ProjectManager.Instance.AddOrRemoveUserInProjectsContract(getContractUserRole());
                    grdProjectsWithRoles.Rebind();

                    hdnNewProjectAdded.Value = null;
                    grdNewProjects_FetchAndSetData(null);

                    string sessionKey = Uri.EscapeUriString(&quot;TMP_&quot; + DateTime.UtcNow.Ticks.ToString());
                    Session[sessionKey] = saveForUserName;

                    //base.ShowSuccess(&quot;User associations saved successfully.&quot;);

                    Response.Redirect(GetBaseURL_ForGivenURL(&quot;~/Modules/PROJECT/ProjectsToUser.aspx?{0}={1}&quot;.Format2(CONST_URL_PARAM_SuccessSessionKey, sessionKey)), false);

                    //lblException.ForeColor = Color.Green;
                    //lblException.Text = &quot;Saved Successfully.&quot;;
                }
            }
            catch (Exception ex)
            {
                lblException.ForeColor = Color.Red;
                lblException.Text = ex.Message;
            }
        }

        private bool IsContractRoleEditedForExistingProject()
        {

            foreach (GridDataItem item in grdProjectsWithRoles.Items)
            {
                if (item.OwnerTableView.DetailTableIndex &lt; 0)
                {
                    HiddenField hidContract = (HiddenField)(((Telerik.Web.UI.GridTableCell)(item[&quot;ContractRoles&quot;]))).FindControl(&quot;hidContractRoles&quot;);
                    if (hidContract.Value != &quot;&quot;)
                    {
                        return true;
                    }
                }               
            }
            return false;
        }

        private string getContractUserRole()
        {            
            Dictionary&lt;string, string&gt; Projects = new Dictionary&lt;string, string&gt;();

            var sWr = new StringWriter(CultureInfo.CurrentCulture);
            var xWr = new XmlTextWriter(sWr);

         
            ContractRole[] Jobject;
            string[] Roles;
            xWr.WriteStartElement(&quot;Roles&quot;);
            xWr.WriteStartElement(&quot;UserInfo&quot;);
            xWr.WriteStartElement(&quot;User&quot;);
            xWr.WriteElementString(&quot;UserID&quot;, ComboBoxUserSelection.SelectedValue);
            xWr.WriteEndElement();//User
            xWr.WriteEndElement();//UserInfo

            xWr.WriteStartElement(&quot;ContractInfo&quot;);

            foreach (GridDataItem item in grdProjectsWithRoles.Items)
            {
                if (item.OwnerTableView.DetailTableIndex &lt; 0)
                {
                 
                    Projects.Add(item[&quot;ProjectID&quot;].Text.ToString2(), &quot;0&quot;);


                    CheckBox oCBIsPrimary = (CheckBox)(((Telerik.Web.UI.GridTableCell)(item[&quot;ComboUserRoles&quot;]))).FindControl(&quot;CBContractIsPrimary&quot;);
                    HiddenField hidContract = (HiddenField)(((Telerik.Web.UI.GridTableCell)(item[&quot;ContractRoles&quot;]))).FindControl(&quot;hidContractRoles&quot;);

                    if (hidContract.Value != &quot;&quot;)
                    {
                        Jobject = JsonConvert.DeserializeObject&lt;ContractRole[]&gt;(hidContract.Value.ToString2());

                        for (var i = 0; i &lt; Jobject.Length; i++)
                        {
                            if (Jobject[i].RoleIds != &quot;&quot;)
                            {                            
                                Roles = Jobject[i].RoleIds.Split(&quot;,&quot;.ToCharArray(), StringSplitOptions.RemoveEmptyEntries);
                                for (int j = 0; j &lt; Roles.Length; j++)
                                {
                                    xWr.WriteStartElement(&quot;Contract&quot;);
                                    xWr.WriteElementString(&quot;Selected&quot;, Jobject[i].Selected.ToString2());//means it is for add or update
                                    xWr.WriteElementString(&quot;ProjectID&quot;, item[&quot;ProjectID&quot;].Text.ToString2());
                                    xWr.WriteElementString(&quot;ContractID&quot;, Jobject[i].Id.ToString2());
                                    xWr.WriteElementString(&quot;RoleID&quot;, Roles[j]);
                                    xWr.WriteElementString(&quot;IsPrimary&quot;, Jobject[i].IsPrimary.ToString2());
                                    xWr.WriteEndElement();//Contract
                                }
                            }
                            else
                            {
                                xWr.WriteStartElement(&quot;Contract&quot;);
                                xWr.WriteElementString(&quot;Selected&quot;, Jobject[i].Selected.ToString2());//means it is for add or update
                                xWr.WriteElementString(&quot;ProjectID&quot;, item[&quot;ProjectID&quot;].Text.ToString2());
                                xWr.WriteElementString(&quot;ContractID&quot;, Jobject[i].Id.ToString2());                               
                                xWr.WriteEndElement();//Contract
                            }
                        }
                    }                    
                }
            }

            foreach (GridDataItem item in grdNewProjects.Items)
            {
                if (item.OwnerTableView.DetailTableIndex &lt; 0)
                {
                    Projects.Add(item[&quot;ProjectID&quot;].Text.ToString2(), &quot;1&quot;);

                    CheckBox oCBIsPrimary = (CheckBox)(((Telerik.Web.UI.GridTableCell)(item[&quot;ComboUserRoles&quot;]))).FindControl(&quot;CBContractIsPrimary&quot;);                            
                    HiddenField hidContract = (HiddenField)(((Telerik.Web.UI.GridTableCell)(item[&quot;ContractRoles&quot;]))).FindControl(&quot;hidContractRoles&quot;);

                    if(hidContract.Value!=&quot;&quot;)
                    {
                        Jobject = JsonConvert.DeserializeObject&lt;ContractRole[]&gt;(hidContract.Value.ToString2());
                        for (var i = 0; i &lt; Jobject.Length; i++)
                        {
                            if (Jobject[i].RoleIds != &quot;&quot;)
                            {
                                Roles = Jobject[i].RoleIds.Split(&quot;,&quot;.ToCharArray(), StringSplitOptions.RemoveEmptyEntries);
                                for (int j = 0; j &lt; Roles.Length; j++)
                                {
                                    xWr.WriteStartElement(&quot;Contract&quot;);
                                    xWr.WriteElementString(&quot;Selected&quot;, Jobject[i].Selected.ToString2());//means it is for add or update
                                    xWr.WriteElementString(&quot;ProjectID&quot;, item[&quot;ProjectID&quot;].Text.ToString2());
                                    xWr.WriteElementString(&quot;ContractID&quot;, Jobject[i].Id.ToString2());
                                    xWr.WriteElementString(&quot;RoleID&quot;, Roles[j]);
                                    xWr.WriteElementString(&quot;IsPrimary&quot;, Jobject[i].IsPrimary.ToString2());
                                    xWr.WriteEndElement();//Contract
                                }
                            }
                            else
                            {
                                xWr.WriteStartElement(&quot;Contract&quot;);
                                xWr.WriteElementString(&quot;Selected&quot;, Jobject[i].Selected.ToString2());//means it is for add or update
                                xWr.WriteElementString(&quot;ProjectID&quot;, item[&quot;ProjectID&quot;].Text.ToString2());
                                xWr.WriteElementString(&quot;ContractID&quot;, Jobject[i].Id.ToString2());                               
                                xWr.WriteEndElement();
                            }
                        }
                    }                                                                                              
                }
            }

            xWr.WriteEndElement();//ContractInfo

            xWr.WriteStartElement(&quot;ProjectInfo&quot;);

            foreach (var item in Projects)
            {

                xWr.WriteStartElement(&quot;Project&quot;);
                xWr.WriteElementString(&quot;ProjectID&quot;, item.Key);
                xWr.WriteElementString(&quot;NewProject&quot;, item.Value);

                xWr.WriteEndElement();//Project
            }
            xWr.WriteEndElement();//ProjectInfo



            xWr.WriteEndElement(); // Roles
            xWr.Flush();
            return sWr.ToString2();            
        }

        protected void btnRemoveNewProject_Click(object sender, EventArgs e)
        {
            grdProjectsWithRoles_BackUpState();

            Dictionary&lt;int, NewProjectDto&gt; curNewProjectMaps = new Dictionary&lt;int, NewProjectDto&gt;();

            if (!string.IsNullOrWhiteSpace(hdnNewProjectAdded.Value))
            {
                string decryptedText = SecurityHelpers.Decrypt_Simple(hdnNewProjectAdded.Value);

                curNewProjectMaps = AllNewProjectDtoData.ParseNewProjectDtoMappingList(decryptedText);
            }

            //Existing state of the datagrid item update it to hidden field
            SaveStateOfAllUpdatesFor_NewProjectList(curNewProjectMaps, grdNewProjects.Items);

            foreach (GridDataItem rowItem in grdNewProjects.SelectedItems)
            {
                int projectId = IsEmptyOrNullOrHtmlSpace(rowItem[&quot;ProjectId&quot;].Text) ? 0 : rowItem[&quot;ProjectId&quot;].Text.ToInt32_2();

                if (projectId == 0)
                    continue;

                if (curNewProjectMaps.ContainsKey(projectId))
                    curNewProjectMaps.Remove(projectId);
            }

            hdnNewProjectAdded.Value = SecurityHelpers.Encrypt_Simple((new AllNewProjectDtoData(curNewProjectMaps)).ToJsonString());

            grdNewProjects_FetchAndSetData(curNewProjectMaps.Select(t =&gt; t.Value).ToList());
        }

        #endregion Save And Remove Button Handlers

        //------------------------------------------------------------------------------------------------

        #region Class Related to Temporary Data Persistanec accross page change

        public class ProjectRolesDataMap
        {
            public int ProjectId { get; set; }

            public string ProjectName { get; set; }

            public List&lt;int&gt; SelectedRoleIdList { get; set; } = new List&lt;int&gt;();

            public bool IsPrimary { get; set; } = false;
        }

        public class AllProjectRolesData
        {
            public List&lt;ProjectRolesDataMap&gt; Items { get; set; }

            public static Dictionary&lt;int, ProjectRolesDataMap&gt; ParseUpdatedProjectRoleMappingList(string jsonString)
            {
                if (string.IsNullOrWhiteSpace(jsonString))
                    return new Dictionary&lt;int, ProjectRolesDataMap&gt;();

                //jsonString = &quot;{Items: [{userId:1, roleIdArray:[1,2,3,4] },{userId:3, roleIdArray:[1,2,3,4] },...] }&quot;
                AllProjectRolesData obj = JsonConvert.DeserializeObject&lt;AllProjectRolesData&gt;(jsonString);

                return obj.Items.ToDictionary(k =&gt; k.ProjectId, v =&gt; v);
            }

            public string ToJsonString()
            {
                string jsonStr = JsonConvert.SerializeObject(this);

                return jsonStr;
            }

            public AllProjectRolesData() { }
            public AllProjectRolesData(Dictionary&lt;int, ProjectRolesDataMap&gt; curProjectMaps)
            {
                this.Items = curProjectMaps.Select(t =&gt; t.Value).ToList();
            }
        }

        /// &lt;summary&gt;
        /// This class will be bound to the datagrid directly (ie list of this class objects will be DataSource of the grid)
        /// &lt;/summary&gt;
        [Serializable]
        public class NewProjectDto
        {
            public int UserId { get; set; }

            public int ProjectId { get; set; }
            public string ProjectName { get; set; }
            public string ProjectCode { get; set; }
            [XmlIgnore]
            [JsonIgnore]
            public string Selected_RoleNameCSV { get; set; }
            [XmlIgnore]
            [JsonIgnore]
            public string Selected_RoleIdCSV { get; set; }
            public bool IsPrimary { get; set; }
            public string UserRolesMappingXml { get; set; }

            public DataRow GetRowForDataTable_ByMappingThisObject(DataTable tgtDataTableRowGenerator)
            {
                DataRow dr = tgtDataTableRowGenerator.NewRow();

                dr[&quot;UserId&quot;] = this.UserId;
                dr[&quot;ProjectId&quot;] = this.ProjectId;
                dr[&quot;ProjectName&quot;] = this.ProjectName;
                dr[&quot;ProjectCode&quot;] = this.ProjectCode;
                dr[&quot;UserRoles&quot;] = this.Selected_RoleNameCSV;
                dr[&quot;RoleId&quot;] = this.Selected_RoleIdCSV;
                dr[&quot;UserRolesMappingXml&quot;] = this.UserRolesMappingXml;

                dr[&quot;IsPrimary&quot;] = this.IsPrimary;

                return dr;
            }

            public void Set_RoleRelatedProperties_UsingXML()
            {
                if (string.IsNullOrEmpty(this.UserRolesMappingXml) || this.UserRolesMappingXml == &quot;&amp;nbsp;&quot;)
                    return;

                List&lt;InviteUsersToProject.RoleDtl&gt; allRoles = InviteUsersToProject.RoleList.XmlDecodeRoleListData(this.UserRolesMappingXml);

                allRoles = allRoles.Where(t =&gt; t.HasProjectRole).ToList();

                if (allRoles.Any())
                {
                    this.Selected_RoleNameCSV = string.Join(&quot;, &quot;, allRoles.Select(t =&gt; t.Name));
                    this.Selected_RoleIdCSV = string.Join(&quot;, &quot;, allRoles.Select(t =&gt; t.Id.ToString2()));
                }
            }

            public static DataTable CreateDataTableToSupportNewProjectDtoClass()
            {
                string[] columnArray = new string[] { &quot;UserId&quot;, &quot;ProjectId&quot;, &quot;ProjectName&quot;, &quot;ProjectCode&quot;, &quot;UserRoles&quot;, &quot;RoleId&quot;, &quot;IsPrimary&quot;, &quot;UserRolesMappingXml&quot; };

                DataTable dtProjectData = new BrixDataTable();

                foreach (string colName in columnArray)
                {
                    switch (colName)
                    {
                        default: dtProjectData.Columns.Add(colName); break;
                        case &quot;IsPrimary&quot;: dtProjectData.Columns.Add(colName, typeof(bool)); break;
                    }
                }

                return dtProjectData;
            }
        }

        public class AllNewProjectDtoData
        {
            public List&lt;NewProjectDto&gt; Items { get; set; }

            public static Dictionary&lt;int, NewProjectDto&gt; ParseNewProjectDtoMappingList(string jsonString)
            {
                if (string.IsNullOrWhiteSpace(jsonString))
                    return new Dictionary&lt;int, NewProjectDto&gt;();

                //jsonString = &quot;{Items: [{userId:1, roleIdArray:[1,2,3,4] },{userId:3, roleIdArray:[1,2,3,4] },...] }&quot;
                AllNewProjectDtoData obj = JsonConvert.DeserializeObject&lt;AllNewProjectDtoData&gt;(jsonString);

                return obj.Items.ToDictionary(k =&gt; k.ProjectId, v =&gt; v);
            }

            public string ToJsonString()
            {
                string jsonStr = JsonConvert.SerializeObject(this);

                return jsonStr;
            }

            public AllNewProjectDtoData() { }
            public AllNewProjectDtoData(Dictionary&lt;int, NewProjectDto&gt; curProjectMaps)
            {
                this.Items = curProjectMaps.Select(t =&gt; t.Value).ToList();
            }
        }

        public class UserItemDto
        {
            public int UserId { get; set; }
            public int UserFullName { get; set; }
            /// &lt;summary&gt;
            /// Comma separated value for all Business Unit Ids of this user
            /// &lt;/summary&gt;
            public int UserBusinessUnitId_CSV { get; set; }
        }       

        public class ContractRole
        {
            public int Id { get; set; }
            public string RoleIds { get; set; }
            public string RoleNames { get; set; }
            public bool IsPrimary { get; set; }

            public bool Selected { get; set; }
        }

        #endregion Class Related to Temporary Data Persistanec accross page change
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[54,57,54,58,1],[54,59,54,107,1],[54,108,54,109,1],[59,13,59,14,1],[60,17,60,56,1],[61,21,61,41,0],[63,17,63,151,1],[64,13,64,14,1],[68,9,68,10,1],[69,13,69,73,1],[70,9,70,10,1],[73,9,73,10,1],[74,13,74,133,1],[75,9,75,10,1],[78,9,78,10,1],[79,13,82,94,1],[84,13,84,35,1],[85,17,85,55,1],[87,17,87,45,0],[88,9,88,10,1],[95,9,95,10,1],[96,13,96,46,1],[97,13,97,78,1],[98,9,98,10,1],[101,9,101,10,1],[102,13,102,96,1],[104,13,109,15,1],[111,13,111,90,1],[116,13,116,70,1],[117,13,117,50,1],[119,13,119,33,1],[122,9,122,10,1],[125,9,125,10,1],[126,13,126,66,1],[127,13,127,80,1],[129,13,129,138,1],[130,13,130,52,1],[131,13,131,14,1],[132,17,132,103,1],[133,17,133,117,1],[134,13,134,14,1],[138,13,138,40,1],[141,13,141,28,1],[142,9,142,10,1],[152,9,152,10,1],[154,13,154,14,1],[155,17,155,35,1],[156,17,156,103,1],[158,17,158,33,1],[159,17,159,18,1],[160,21,160,57,1],[162,21,162,110,1],[164,17,164,18,1],[166,17,166,33,1],[167,17,167,18,1],[168,21,168,96,1],[169,21,169,59,1],[170,21,170,22,1],[171,25,171,62,1],[172,25,172,45,1],[173,25,173,26,1],[174,29,174,132,1],[176,29,176,56,1],[177,25,177,26,1],[178,21,178,22,1],[179,17,179,18,1],[181,17,181,50,1],[183,17,183,74,1],[184,17,184,18,1],[185,21,185,78,1],[186,21,186,22,1],[187,25,187,94,1],[188,25,188,99,1],[189,21,189,22,1],[191,21,191,72,1],[192,21,192,22,1],[193,25,193,88,1],[194,25,194,93,1],[195,21,195,22,1],[196,17,196,18,1],[198,17,198,88,1],[199,17,199,96,1],[200,13,200,14,1],[201,13,201,33,0],[202,13,202,14,0],[203,17,203,48,0],[204,13,204,14,0],[206,13,206,50,1],[207,9,207,10,1],[213,9,213,10,1],[214,13,214,41,1],[215,13,215,76,1],[216,13,216,86,1],[218,13,218,91,1],[220,13,220,76,1],[221,13,221,44,1],[222,9,222,10,1],[225,9,225,10,1],[226,13,226,67,1],[227,13,227,33,1],[228,13,228,14,1],[229,17,229,48,1],[230,17,230,79,1],[231,13,231,14,1],[233,13,233,67,1],[234,13,234,33,1],[235,17,235,86,1],[237,13,237,79,1],[238,13,238,39,1],[239,13,239,14,1],[240,17,240,56,1],[241,17,241,88,1],[242,13,242,14,1],[244,13,244,71,1],[245,13,245,35,1],[246,17,246,85,1],[248,13,248,109,1],[249,9,249,10,1],[252,9,252,10,1],[253,13,253,67,1],[254,13,254,33,1],[255,17,255,50,1],[257,13,257,67,1],[258,13,258,33,1],[259,17,259,40,1],[261,13,261,79,1],[262,13,262,39,1],[263,17,263,56,1],[265,13,265,71,1],[266,13,266,35,1],[267,17,267,52,1],[269,13,269,55,1],[271,13,271,61,1],[273,13,273,42,1],[274,13,274,32,1],[275,17,275,40,1],[277,13,277,63,1],[278,13,278,69,1],[279,13,279,74,1],[280,13,280,63,1],[281,13,281,68,1],[283,9,283,10,1],[297,9,297,10,1],[298,13,298,32,1],[300,13,300,46,1],[302,13,302,68,1],[304,13,304,160,1],[306,13,306,80,1],[307,13,307,52,1],[309,13,309,62,1],[310,13,310,61,1],[311,13,311,56,1],[313,13,313,46,1],[323,13,323,87,1],[324,9,324,10,1],[336,9,336,10,1],[337,13,337,28,1],[338,17,338,37,1],[340,13,340,96,1],[341,9,341,10,1],[344,9,344,10,1],[345,13,345,81,1],[347,13,347,58,1],[349,13,349,39,1],[350,13,350,45,1],[352,13,352,56,1],[354,13,354,45,1],[356,13,356,50,1],[357,9,357,10,1],[365,9,365,10,1],[366,13,366,20,1],[366,22,366,42,1],[366,43,366,45,1],[366,46,366,54,1],[367,13,367,14,1],[368,17,368,65,1],[369,17,369,18,1],[370,21,370,39,1],[372,21,372,100,1],[373,25,373,34,0],[375,21,375,90,1],[377,21,377,63,1],[378,21,378,157,1],[380,21,380,105,1],[382,21,382,100,1],[384,21,384,155,1],[386,21,386,82,1],[386,82,386,125,1],[386,125,386,139,1],[386,139,386,170,1],[386,170,386,181,1],[386,21,386,181,1],[387,21,387,90,1],[387,90,387,106,1],[387,106,387,120,1],[387,120,387,124,1],[387,124,387,135,1],[387,21,387,135,1],[390,21,392,49,1],[392,49,392,81,0],[392,81,392,83,1],[390,21,392,83,1],[393,21,393,22,0],[394,25,394,62,0],[395,21,395,22,0],[397,21,398,58,1],[398,58,398,82,1],[398,82,399,49,1],[399,49,399,82,1],[399,82,399,84,1],[397,21,399,84,1],[400,21,400,22,1],[401,25,407,27,1],[408,21,408,22,1],[409,17,409,18,1],[410,13,410,14,1],[411,9,411,10,1],[419,9,419,10,0],[420,13,420,20,0],[420,22,420,42,0],[420,43,420,45,0],[420,46,420,54,0],[421,13,421,14,0],[422,17,422,65,0],[423,17,423,18,0],[424,21,424,39,0],[426,21,426,100,0],[427,25,427,34,0],[429,21,429,70,0],[430,25,430,34,0],[432,21,432,79,0],[434,21,434,90,0],[436,21,436,63,0],[437,21,437,155,0],[439,21,439,85,0],[440,21,440,155,0],[442,21,442,105,0],[444,21,444,82,0],[444,82,444,125,0],[444,125,444,139,0],[444,139,444,170,0],[444,170,444,181,0],[444,21,444,181,0],[446,21,446,28,0],[446,30,446,67,0],[446,68,446,70,0],[446,71,446,95,0],[447,21,447,22,0],[447,23,447,70,0],[447,70,447,86,0],[447,86,447,88,0],[447,23,447,88,0],[447,89,447,90,0],[449,21,449,133,0],[451,17,451,18,0],[452,13,452,14,0],[453,9,453,10,0],[456,9,456,10,1],[457,13,457,110,1],[459,13,459,55,1],[460,13,460,14,1],[463,17,463,68,1],[464,17,464,18,1],[465,21,465,95,1],[466,21,466,108,1],[467,17,467,18,1],[470,17,470,104,1],[471,13,471,14,1],[473,13,473,73,1],[476,13,476,92,1],[478,13,478,98,1],[480,13,480,35,1],[481,9,481,10,1],[490,9,490,10,1],[491,13,491,64,1],[492,13,492,55,1],[493,13,493,55,1],[494,13,494,134,1],[495,9,495,10,1],[498,9,498,10,1],[500,13,500,102,1],[502,13,502,66,1],[505,13,505,121,1],[506,9,506,10,1],[509,9,509,10,1],[510,13,510,75,1],[511,13,511,14,1],[512,17,512,59,1],[513,17,513,42,1],[514,17,514,24,1],[517,13,517,91,1],[520,13,520,14,1],[521,17,521,293,1],[523,17,523,63,1],[525,17,525,24,1],[525,26,525,40,1],[525,41,525,43,1],[525,44,525,55,1],[526,17,526,18,1],[527,21,527,37,1],[529,34,529,69,1],[529,70,529,76,1],[530,88,530,137,1],[530,138,530,144,1],[532,17,532,18,1],[534,17,534,82,1],[535,17,535,86,1],[536,17,536,42,1],[538,17,538,139,1],[540,17,540,289,1],[542,17,542,24,1],[542,26,542,43,1],[542,44,542,46,1],[542,47,542,62,1],[543,17,543,18,1],[545,21,545,61,1],[547,21,547,28,1],[547,30,547,44,1],[547,45,547,47,1],[547,48,547,59,1],[548,21,548,22,1],[549,25,549,41,1],[551,38,551,86,1],[551,87,551,93,1],[552,92,552,146,1],[552,147,552,153,1],[553,147,553,153,1],[555,21,555,22,1],[557,21,557,109,1],[559,21,559,155,1],[560,21,560,89,1],[562,21,562,72,1],[564,21,564,64,1],[565,25,565,89,1],[565,89,565,105,1],[565,105,565,120,1],[565,120,565,126,1],[565,126,565,137,1],[565,25,565,137,1],[567,21,567,22,1],[569,25,569,89,1],[569,89,569,148,1],[569,148,569,163,1],[569,163,569,169,1],[569,169,569,180,1],[569,25,569,180,1],[571,25,571,110,1],[572,21,572,22,1],[575,21,575,60,1],[575,61,575,93,1],[577,21,577,57,1],[578,21,578,22,1],[579,25,579,95,1],[579,95,579,101,1],[579,101,579,104,1],[579,25,579,104,1],[580,25,580,93,1],[580,93,580,109,1],[580,109,580,112,1],[580,25,580,112,1],[581,21,581,22,1],[583,21,583,78,1],[584,21,584,74,1],[585,21,585,73,1],[587,21,587,52,1],[590,17,590,18,1],[592,17,592,51,1],[593,21,593,63,0],[595,17,595,18,1],[596,21,596,69,1],[597,21,597,85,1],[598,21,598,78,1],[599,17,599,18,1],[601,17,601,42,1],[602,13,602,14,1],[603,13,603,33,0],[604,13,604,14,0],[605,17,605,48,0],[606,13,606,14,0],[607,9,607,10,1],[610,9,610,10,1],[611,13,611,43,1],[612,17,612,24,1],[614,13,614,59,1],[616,13,616,125,1],[618,13,618,32,1],[619,17,619,24,0],[621,13,621,74,1],[623,13,623,107,1],[624,13,624,92,1],[627,13,627,61,1],[632,13,632,57,1],[633,13,633,14,0],[635,17,635,76,0],[637,17,637,150,0],[639,17,639,84,0],[641,17,641,149,0],[643,17,643,158,0],[645,17,645,42,0],[647,17,647,45,0],[648,17,648,18,0],[649,21,649,109,0],[651,26,651,35,0],[651,37,651,53,0],[651,55,651,58,0],[652,21,652,22,0],[653,25,653,110,0],[654,25,654,26,0],[655,29,655,63,0],[656,29,656,144,0],[656,144,656,157,0],[656,157,656,168,0],[656,29,656,168,0],[657,25,657,26,0],[658,21,658,22,0],[659,21,659,56,0],[660,17,660,18,0],[662,17,662,18,0],[663,21,663,60,0],[664,25,664,146,0],[664,146,664,159,0],[664,159,664,170,0],[664,25,664,170,0],[666,21,666,144,0],[667,17,667,18,0],[669,17,669,51,0],[670,21,670,49,0],[672,13,672,14,0],[674,13,674,14,1],[675,17,675,95,1],[676,21,676,166,1],[676,166,676,179,1],[676,179,676,190,1],[676,21,676,190,1],[678,17,678,76,1],[680,13,680,14,1],[682,13,682,147,1],[683,13,683,112,1],[683,112,683,146,1],[683,146,683,161,1],[683,161,683,167,1],[683,167,683,178,1],[683,13,683,178,1],[685,13,685,97,1],[686,13,686,82,1],[686,82,686,86,1],[686,86,686,93,1],[686,93,686,99,1],[686,99,686,114,1],[686,114,686,121,1],[686,121,686,123,1],[686,13,686,123,1],[687,13,687,37,1],[689,13,689,55,1],[691,13,691,151,1],[692,13,692,58,1],[694,13,694,149,1],[696,13,696,54,1],[697,17,697,57,0],[699,13,699,14,1],[700,17,700,24,1],[700,26,700,62,1],[700,63,700,65,1],[700,66,700,91,1],[701,17,701,18,1],[702,21,702,108,1],[703,21,703,50,1],[704,21,704,22,1],[705,25,705,58,1],[706,25,706,57,1],[707,21,707,22,1],[708,17,708,18,1],[711,17,711,95,1],[711,95,711,99,1],[711,99,711,102,1],[711,17,711,102,1],[712,17,712,94,1],[712,94,712,100,1],[712,100,712,103,1],[712,17,712,103,1],[713,13,713,14,1],[714,13,714,136,1],[716,9,716,10,1],[719,9,719,10,0],[720,13,720,136,0],[721,13,721,54,0],[722,13,722,54,0],[723,13,723,62,0],[724,9,724,10,0],[731,9,731,10,1],[732,13,732,101,1],[734,13,734,70,1],[735,13,735,14,0],[736,17,736,97,0],[737,17,737,103,0],[738,13,738,14,0],[740,13,740,48,1],[742,17,742,98,0],[747,13,747,74,1],[747,74,747,81,0],[747,81,747,100,1],[747,13,747,100,1],[748,9,748,10,1],[751,9,751,10,1],[752,13,752,92,1],[755,13,755,14,1],[756,17,756,102,1],[758,17,758,24,1],[758,26,758,47,0],[758,48,758,50,1],[758,51,758,88,1],[758,88,758,101,0],[758,101,758,102,1],[758,51,758,102,1],[759,17,759,18,0],[760,21,760,66,0],[763,21,763,100,0],[797,21,797,52,0],[800,17,800,18,0],[802,17,802,59,1],[804,17,804,36,1],[805,21,805,47,1],[807,17,807,56,1],[808,17,808,18,1],[811,21,811,65,1],[812,21,812,57,1],[813,17,813,18,1],[815,17,815,18,0],[818,21,818,64,0],[819,21,819,56,0],[820,17,820,18,0],[822,13,822,14,1],[823,13,823,33,0],[824,13,824,14,0],[825,17,825,48,0],[826,13,826,14,0],[827,9,827,10,1],[830,9,830,10,1],[831,13,831,43,1],[832,17,832,24,1],[834,13,834,31,0],[835,13,835,59,0],[837,13,837,121,0],[839,13,839,32,0],[840,17,840,24,0],[842,13,842,72,0],[844,13,844,92,0],[845,13,845,77,0],[847,13,847,61,0],[851,13,851,147,0],[852,13,852,79,0],[859,13,859,57,0],[860,13,860,14,0],[861,17,861,76,0],[863,17,863,144,0],[865,17,865,84,0],[867,17,867,143,0],[869,17,869,157,0],[871,17,871,42,0],[872,17,872,18,0],[873,21,873,109,0],[875,25,875,32,0],[875,34,875,48,0],[875,49,875,52,0],[876,21,876,22,0],[877,25,877,109,0],[878,25,878,26,0],[879,29,879,144,0],[879,144,879,157,0],[879,157,879,168,0],[879,29,879,168,0],[880,25,880,26,0],[881,21,881,22,0],[882,17,882,18,0],[884,17,884,18,0],[885,21,885,57,0],[886,25,886,146,0],[886,146,886,159,0],[886,159,886,170,0],[886,25,886,170,0],[887,17,887,18,0],[889,17,889,51,0],[890,21,890,49,0],[892,13,892,14,0],[894,13,894,14,0],[895,17,895,71,0],[896,21,896,142,0],[896,142,896,155,0],[896,155,896,166,0],[896,21,896,166,0],[898,17,898,76,0],[900,13,900,14,0],[902,13,902,77,0],[902,77,902,111,0],[902,111,902,126,0],[902,126,902,132,0],[902,132,902,143,0],[902,13,902,143,0],[905,13,905,85,0],[906,13,906,145,0],[907,13,907,143,0],[908,13,908,82,0],[908,82,908,86,0],[908,86,908,93,0],[908,93,908,99,0],[908,99,908,114,0],[908,114,908,121,0],[908,121,908,123,0],[908,13,908,123,0],[909,13,909,37,0],[911,13,911,58,0],[912,13,912,55,0],[919,13,919,54,0],[920,17,920,57,0],[922,13,922,14,0],[923,17,923,24,0],[923,26,923,62,0],[923,63,923,65,0],[923,66,923,91,0],[924,17,924,18,0],[925,21,925,108,0],[926,21,926,50,0],[927,21,927,22,0],[928,25,928,58,0],[929,25,929,57,0],[930,21,930,22,0],[931,17,931,18,0],[934,17,934,95,0],[934,95,934,99,0],[934,99,934,102,0],[934,17,934,102,0],[935,17,935,94,0],[935,94,935,100,0],[935,100,935,103,0],[935,17,935,103,0],[936,13,936,14,0],[937,13,937,136,0],[939,9,939,10,1],[943,9,943,10,0],[944,13,944,80,0],[945,13,945,81,0],[948,13,948,51,0],[949,13,949,14,0],[950,17,951,128,0],[952,17,952,51,0],[953,13,953,14,0],[957,9,957,10,0],[960,9,960,10,0],[961,13,961,80,0],[962,13,962,81,0],[965,13,965,53,0],[966,13,966,14,0],[967,17,968,126,0],[969,17,969,51,0],[970,13,970,14,0],[971,9,971,10,0],[980,9,980,10,1],[981,13,981,120,1],[982,13,982,88,1],[983,13,983,54,1],[984,13,984,52,1],[985,13,985,91,1],[990,13,990,71,1],[991,13,991,104,1],[992,9,992,10,1],[995,9,995,10,1],[996,13,996,55,1],[998,13,998,101,1],[1000,13,1000,70,1],[1001,13,1001,14,0],[1002,17,1002,97,0],[1003,17,1003,103,0],[1004,13,1004,14,0],[1006,13,1006,20,1],[1006,22,1006,42,1],[1006,43,1006,45,1],[1006,46,1006,72,1],[1007,13,1007,14,1],[1008,17,1008,35,1],[1010,17,1010,96,1],[1011,21,1011,30,0],[1013,17,1013,46,1],[1014,13,1014,14,1],[1016,13,1016,20,1],[1016,22,1016,42,0],[1016,43,1016,45,1],[1016,46,1016,66,1],[1017,13,1017,14,0],[1018,17,1018,35,0],[1020,17,1020,96,0],[1021,21,1021,30,0],[1023,17,1023,46,0],[1024,13,1024,14,0],[1026,13,1026,68,1],[1028,13,1035,16,1],[1045,13,1045,92,1],[1048,9,1048,10,1],[1051,9,1051,10,0],[1052,13,1052,80,0],[1053,17,1053,24,0],[1055,13,1055,74,0],[1059,13,1059,101,0],[1062,13,1062,70,0],[1063,13,1063,14,0],[1064,17,1064,97,0],[1066,17,1066,103,0],[1067,13,1067,14,0],[1070,13,1070,94,0],[1072,13,1072,97,0],[1074,13,1074,47,0],[1075,13,1075,20,0],[1075,22,1075,52,0],[1075,53,1075,55,0],[1075,56,1075,68,0],[1076,13,1076,14,0],[1077,17,1077,73,0],[1079,17,1079,62,0],[1080,21,1080,30,0],[1082,17,1082,68,0],[1083,17,1083,68,0],[1085,17,1095,20,0],[1097,13,1097,14,0],[1099,13,1099,133,0],[1101,13,1101,74,0],[1101,74,1101,81,0],[1101,81,1101,93,0],[1101,13,1101,93,0],[1103,13,1103,43,0],[1105,9,1105,10,0],[1108,9,1108,10,1],[1109,13,1109,85,1],[1111,13,1111,119,1],[1113,13,1113,90,1],[1114,13,1114,94,1],[1115,13,1115,63,1],[1116,13,1116,62,1],[1117,13,1117,20,1],[1117,22,1117,32,1],[1117,33,1117,35,1],[1117,36,1117,46,1],[1118,13,1118,14,1],[1119,17,1119,54,1],[1120,17,1120,18,1],[1121,21,1126,23,1],[1127,21,1127,43,1],[1128,17,1128,18,1],[1130,17,1130,18,1],[1131,21,1138,23,1],[1139,21,1139,43,1],[1140,17,1140,18,1],[1141,13,1141,14,1],[1143,13,1143,32,1],[1144,9,1144,10,1],[1147,9,1147,10,1],[1148,13,1148,97,1],[1150,13,1150,49,1],[1151,13,1151,96,1],[1153,13,1153,20,1],[1153,22,1153,30,1],[1153,31,1153,33,1],[1153,34,1153,39,1],[1154,13,1154,14,1],[1156,17,1156,69,1],[1157,17,1157,68,1],[1158,17,1158,72,1],[1159,17,1159,66,1],[1161,17,1161,51,1],[1162,13,1162,14,1],[1164,13,1164,33,1],[1165,9,1165,10,1],[1172,9,1172,10,1],[1173,13,1173,30,1],[1174,13,1174,43,1],[1176,13,1176,62,1],[1177,13,1177,85,1],[1179,13,1179,20,1],[1179,22,1179,39,1],[1179,40,1179,42,1],[1179,43,1179,69,1],[1180,17,1180,73,1],[1182,13,1182,20,1],[1182,22,1182,39,0],[1182,40,1182,42,1],[1182,43,1182,63,1],[1183,17,1183,73,0],[1185,13,1185,40,1],[1186,13,1186,14,1],[1187,17,1187,100,1],[1188,17,1188,130,1],[1189,13,1189,14,1],[1190,13,1190,25,1],[1191,9,1191,10,1],[1194,9,1194,10,0],[1195,13,1195,118,0],[1196,13,1196,14,0],[1199,17,1199,80,0],[1200,17,1200,24,0],[1204,13,1204,14,0],[1205,17,1205,72,0],[1206,17,1206,50,0],[1209,17,1209,18,0],[1210,21,1210,55,0],[1211,21,1211,91,0],[1214,21,1214,22,0],[1215,25,1215,136,0],[1217,25,1217,75,0],[1218,25,1218,26,0],[1219,29,1219,82,0],[1220,29,1220,36,0],[1223,25,1223,32,0],[1223,34,1223,54,0],[1223,55,1223,57,0],[1223,58,1223,92,0],[1224,25,1224,26,0],[1225,29,1225,78,0],[1227,29,1227,76,0],[1228,29,1228,30,0],[1229,33,1229,133,0],[1230,33,1230,40,0],[1232,25,1232,26,0],[1234,21,1234,22,0],[1235,21,1235,41,0],[1236,21,1236,22,0],[1237,25,1237,125,0],[1238,25,1238,32,0],[1241,21,1241,28,0],[1241,30,1241,50,0],[1241,51,1241,53,0],[1241,54,1241,88,0],[1242,21,1242,22,0],[1245,25,1245,104,0],[1246,25,1246,159,0],[1248,25,1248,89,0],[1248,89,1248,105,0],[1248,105,1248,107,0],[1248,25,1248,107,0],[1250,25,1250,32,0],[1250,34,1250,74,0],[1250,75,1250,77,0],[1250,78,1250,99,0],[1251,25,1251,26,0],[1252,29,1252,62,0],[1253,29,1253,152,0],[1255,29,1255,71,0],[1256,29,1256,165,0],[1258,29,1258,73,0],[1259,29,1259,104,0],[1260,29,1260,90,0],[1261,29,1261,97,0],[1262,29,1262,51,0],[1263,25,1263,26,0],[1264,21,1264,22,0],[1265,17,1265,18,0],[1266,17,1266,22,0],[1266,23,1266,24,0],[1266,25,1266,31,0],[1268,17,1268,18,0],[1269,21,1269,43,0],[1270,21,1270,33,0],[1271,21,1271,48,0],[1272,21,1272,33,0],[1274,21,1274,74,0],[1275,17,1275,18,0],[1277,17,1277,50,0],[1279,17,1279,47,0],[1281,17,1281,41,0],[1285,17,1285,59,0],[1286,17,1286,24,0],[1288,13,1288,33,0],[1289,13,1289,14,0],[1290,17,1290,52,0],[1291,17,1291,48,0],[1292,13,1292,14,0],[1293,9,1293,10,0],[1296,9,1296,10,1],[1297,13,1297,75,1],[1298,13,1298,14,0],[1301,17,1301,70,0],[1302,17,1302,24,0],[1305,13,1305,65,1],[1307,13,1307,50,1],[1308,13,1308,77,1],[1309,13,1309,14,0],[1312,17,1312,183,0],[1313,17,1313,40,0],[1314,17,1314,24,0],[1318,13,1318,14,1],[1319,17,1319,119,1],[1322,17,1322,68,1],[1323,17,1323,18,1],[1324,21,1324,95,1],[1325,21,1325,113,1],[1326,17,1326,18,1],[1328,17,1328,58,1],[1330,21,1330,113,1],[1334,17,1334,133,1],[1335,17,1335,18,0],[1336,21,1336,59,0],[1337,21,1337,28,0],[1340,17,1340,44,1],[1342,17,1342,61,1],[1344,17,1344,122,1],[1346,17,1346,24,1],[1346,26,1346,42,1],[1346,43,1346,45,1],[1346,46,1346,70,1],[1347,17,1347,18,1],[1349,21,1349,82,1],[1351,21,1351,95,1],[1352,21,1352,22,0],[1353,25,1353,48,0],[1354,25,1354,58,0],[1355,25,1355,45,0],[1356,21,1356,22,0],[1357,17,1357,18,1],[1359,17,1359,24,1],[1359,26,1359,43,0],[1359,44,1359,46,1],[1359,47,1359,67,1],[1360,17,1360,18,0],[1361,21,1361,66,0],[1362,21,1362,22,0],[1363,25,1363,106,0],[1364,25,1364,66,0],[1365,25,1365,26,0],[1366,29,1366,52,0],[1367,29,1367,70,0],[1368,29,1368,49,0],[1369,25,1369,26,0],[1370,21,1370,22,0],[1371,17,1371,18,0],[1373,17,1373,37,1],[1374,21,1374,56,0],[1376,17,1376,18,1],[1379,21,1379,76,1],[1380,21,1380,54,1],[1382,21,1382,55,1],[1383,21,1383,91,1],[1385,21,1385,28,1],[1385,30,1385,46,1],[1385,47,1385,49,1],[1385,50,1385,74,1],[1386,21,1386,22,1],[1388,25,1388,86,1],[1390,25,1390,32,1],[1390,34,1390,44,1],[1390,45,1390,47,1],[1390,48,1390,71,1],[1391,25,1391,26,1],[1392,29,1392,62,1],[1394,29,1394,72,1],[1395,29,1395,91,1],[1396,29,1396,82,1],[1397,29,1397,104,1],[1399,29,1399,51,1],[1400,25,1400,26,1],[1401,21,1401,22,1],[1403,21,1403,28,1],[1403,30,1403,47,0],[1403,48,1403,50,1],[1403,51,1403,71,1],[1404,21,1404,22,0],[1405,25,1405,70,0],[1406,25,1406,26,0],[1407,29,1407,110,0],[1408,29,1408,36,0],[1408,38,1408,65,0],[1408,66,1408,68,0],[1408,69,1408,94,0],[1409,29,1409,30,0],[1410,33,1410,66,0],[1411,33,1411,153,0],[1412,33,1412,71,0],[1414,33,1414,76,0],[1415,33,1415,105,0],[1416,33,1416,97,0],[1417,33,1417,92,0],[1418,33,1418,55,0],[1419,29,1419,30,0],[1420,25,1420,26,0],[1421,21,1421,22,0],[1423,21,1423,43,1],[1424,21,1424,33,1],[1425,21,1425,48,1],[1426,21,1426,33,1],[1428,21,1428,74,1],[1429,21,1429,102,1],[1430,21,1430,51,1],[1432,21,1432,53,1],[1433,21,1433,58,1],[1435,21,1435,104,1],[1436,21,1436,59,1],[1440,21,1440,174,1],[1444,17,1444,18,1],[1445,13,1445,14,1],[1446,13,1446,33,0],[1447,13,1447,14,0],[1448,17,1448,52,0],[1449,17,1449,48,0],[1450,13,1450,14,0],[1451,9,1451,10,1],[1454,9,1454,10,0],[1456,13,1456,20,0],[1456,22,1456,39,0],[1456,40,1456,42,0],[1456,43,1456,69,0],[1457,13,1457,14,0],[1458,17,1458,62,0],[1459,17,1459,18,0],[1460,21,1460,150,0],[1461,21,1461,49,0],[1462,21,1462,22,0],[1463,25,1463,37,0],[1465,17,1465,18,0],[1466,13,1466,14,0],[1467,13,1467,26,0],[1468,9,1468,10,0],[1471,9,1471,10,1],[1472,13,1472,84,1],[1474,13,1474,68,1],[1475,13,1475,46,1],[1480,13,1480,44,1],[1481,13,1481,47,1],[1482,13,1482,43,1],[1483,13,1483,83,1],[1484,13,1484,35,1],[1485,13,1485,35,1],[1487,13,1487,51,1],[1489,13,1489,20,1],[1489,22,1489,39,1],[1489,40,1489,42,1],[1489,43,1489,69,1],[1490,13,1490,14,1],[1491,17,1491,62,1],[1492,17,1492,18,1],[1494,21,1494,75,1],[1497,21,1497,149,1],[1498,21,1498,150,1],[1500,21,1500,49,1],[1501,21,1501,22,0],[1502,25,1502,112,0],[1504,30,1504,39,0],[1504,41,1504,59,0],[1504,61,1504,64,0],[1505,25,1505,26,0],[1506,29,1506,58,0],[1507,29,1507,30,0],[1508,33,1508,124,0],[1509,38,1509,47,0],[1509,49,1509,65,0],[1509,67,1509,70,0],[1510,33,1510,34,0],[1511,37,1511,71,0],[1512,37,1512,105,0],[1513,37,1513,109,0],[1514,37,1514,101,0],[1515,37,1515,80,0],[1516,37,1516,107,0],[1517,37,1517,59,0],[1518,33,1518,34,0],[1519,29,1519,30,0],[1521,29,1521,30,0],[1522,33,1522,67,0],[1523,33,1523,101,0],[1524,33,1524,105,0],[1525,33,1525,97,0],[1526,33,1526,55,0],[1527,29,1527,30,0],[1528,25,1528,26,0],[1529,21,1529,22,0],[1530,17,1530,18,1],[1531,13,1531,14,1],[1533,13,1533,20,1],[1533,22,1533,39,0],[1533,40,1533,42,1],[1533,43,1533,63,1],[1534,13,1534,14,0],[1535,17,1535,62,0],[1536,17,1536,18,0],[1537,21,1537,75,0],[1539,21,1539,149,0],[1540,21,1540,150,0],[1542,21,1542,46,0],[1543,21,1543,22,0],[1544,25,1544,112,0],[1545,30,1545,39,0],[1545,41,1545,59,0],[1545,61,1545,64,0],[1546,25,1546,26,0],[1547,29,1547,58,0],[1548,29,1548,30,0],[1549,33,1549,124,0],[1550,38,1550,47,0],[1550,49,1550,65,0],[1550,67,1550,70,0],[1551,33,1551,34,0],[1552,37,1552,71,0],[1553,37,1553,105,0],[1554,37,1554,109,0],[1555,37,1555,101,0],[1556,37,1556,80,0],[1557,37,1557,107,0],[1558,37,1558,59,0],[1559,33,1559,34,0],[1560,29,1560,30,0],[1562,29,1562,30,0],[1563,33,1563,67,0],[1564,33,1564,101,0],[1565,33,1565,105,0],[1566,33,1566,97,0],[1567,33,1567,55,0],[1568,29,1568,30,0],[1569,25,1569,26,0],[1570,21,1570,22,0],[1571,17,1571,18,0],[1572,13,1572,14,0],[1574,13,1574,35,1],[1576,13,1576,50,1],[1578,13,1578,20,1],[1578,22,1578,30,1],[1578,31,1578,33,1],[1578,34,1578,42,1],[1579,13,1579,14,1],[1581,17,1581,50,1],[1582,17,1582,63,1],[1583,17,1583,66,1],[1585,17,1585,39,1],[1586,13,1586,14,1],[1587,13,1587,35,1],[1591,13,1591,35,1],[1592,13,1592,25,1],[1593,13,1593,36,1],[1594,9,1594,10,1],[1597,9,1597,10,0],[1598,13,1598,48,0],[1600,13,1600,101,0],[1602,13,1602,70,0],[1603,13,1603,14,0],[1604,17,1604,97,0],[1606,17,1606,103,0],[1607,13,1607,14,0],[1610,13,1610,94,0],[1612,13,1612,20,0],[1612,22,1612,42,0],[1612,43,1612,45,0],[1612,46,1612,74,0],[1613,13,1613,14,0],[1614,17,1614,129,0],[1616,17,1616,36,0],[1617,21,1617,30,0],[1619,17,1619,62,0],[1620,21,1620,57,0],[1621,13,1621,14,0],[1623,13,1623,133,0],[1625,13,1625,74,0],[1625,74,1625,81,0],[1625,81,1625,93,0],[1625,13,1625,93,0],[1626,9,1626,10,0],[1636,36,1636,40,1],[1636,41,1636,45,1],[1638,41,1638,45,1],[1638,46,1638,50,1],[1640,51,1640,55,1],[1640,56,1640,60,1],[1640,65,1640,80,1],[1642,37,1642,41,1],[1642,42,1642,46,1],[1642,51,1642,56,1],[1647,54,1647,58,1],[1647,59,1647,63,1],[1650,13,1650,14,1],[1651,17,1651,59,1],[1652,21,1652,71,0],[1655,17,1655,106,1],[1657,17,1657,52,1],[1657,52,1657,63,1],[1657,63,1657,70,1],[1657,70,1657,71,1],[1657,71,1657,73,1],[1657,17,1657,73,1],[1658,13,1658,14,1],[1661,13,1661,14,1],[1662,17,1662,68,1],[1664,17,1664,32,1],[1665,13,1665,14,1],[1667,13,1667,41,1],[1667,42,1667,43,1],[1667,44,1667,45,1],[1668,13,1668,92,1],[1669,13,1669,14,1],[1670,17,1670,57,1],[1670,57,1670,64,1],[1670,64,1670,75,1],[1670,17,1670,75,1],[1671,13,1671,14,1],[1680,33,1680,37,0],[1680,38,1680,42,0],[1682,36,1682,40,0],[1682,41,1682,45,0],[1683,41,1683,45,0],[1683,46,1683,50,0],[1684,41,1684,45,0],[1684,46,1684,50,0],[1687,50,1687,54,0],[1687,55,1687,59,0],[1690,48,1690,52,0],[1690,53,1690,57,0],[1691,37,1691,41,0],[1691,42,1691,46,0],[1692,49,1692,53,0],[1692,54,1692,58,0],[1695,13,1695,14,0],[1696,17,1696,64,0],[1698,17,1698,44,0],[1699,17,1699,50,0],[1700,17,1700,54,0],[1701,17,1701,54,0],[1702,17,1702,61,0],[1703,17,1703,56,0],[1704,17,1704,70,0],[1706,17,1706,50,0],[1708,17,1708,27,0],[1709,13,1709,14,0],[1712,13,1712,14,0],[1713,17,1713,108,0],[1714,21,1714,28,0],[1716,17,1716,141,0],[1718,17,1718,48,0],[1718,48,1718,64,0],[1718,64,1718,75,0],[1718,17,1718,75,0],[1720,17,1720,36,0],[1721,17,1721,18,0],[1722,21,1722,88,0],[1722,88,1722,94,0],[1722,94,1722,97,0],[1722,21,1722,97,0],[1723,21,1723,86,0],[1723,86,1723,102,0],[1723,102,1723,105,0],[1723,21,1723,105,0],[1724,17,1724,18,0],[1725,13,1725,14,0],[1728,13,1728,14,1],[1729,17,1729,168,1],[1731,17,1731,63,1],[1733,17,1733,24,1],[1733,26,1733,40,1],[1733,41,1733,43,1],[1733,44,1733,55,1],[1734,17,1734,18,1],[1735,21,1735,37,1],[1737,34,1737,69,1],[1737,70,1737,76,1],[1738,43,1738,92,1],[1738,93,1738,99,1],[1740,17,1740,18,1],[1742,17,1742,38,1],[1743,13,1743,14,1],[1748,48,1748,52,0],[1748,53,1748,57,0],[1751,13,1751,14,0],[1752,17,1752,59,0],[1753,21,1753,65,0],[1756,17,1756,108,0],[1758,17,1758,52,0],[1758,52,1758,63,0],[1758,63,1758,70,0],[1758,70,1758,71,0],[1758,71,1758,73,0],[1758,17,1758,73,0],[1759,13,1759,14,0],[1762,13,1762,14,0],[1763,17,1763,68,0],[1765,17,1765,32,0],[1766,13,1766,14,0],[1768,13,1768,42,0],[1768,43,1768,44,0],[1768,45,1768,46,0],[1769,13,1769,87,0],[1770,13,1770,14,0],[1771,17,1771,57,0],[1771,57,1771,64,0],[1771,64,1771,75,0],[1771,17,1771,75,0],[1772,13,1772,14,0],[1777,33,1777,37,0],[1777,38,1777,42,0],[1778,39,1778,43,0],[1778,44,1778,48,0],[1782,49,1782,53,0],[1782,54,1782,58,0],[1787,29,1787,33,0],[1787,34,1787,38,0],[1788,37,1788,41,0],[1788,42,1788,46,0],[1789,39,1789,43,0],[1789,44,1789,48,0],[1790,37,1790,41,0],[1790,42,1790,46,0],[1792,36,1792,40,0],[1792,41,1792,45,0]]);
    </script>
  </body>
</html>