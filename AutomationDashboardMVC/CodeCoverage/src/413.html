<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Construction Vertical\Main Modules\Estimator\BusinessLayer\ConcreateModels\Estimate\ContractorBiddingListModel.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Web;
using System.Web.Configuration;
using System.Web.UI;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core.AbstractModels;
using Aurigo.AMP3.EstimatorBL;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Infragistics.WebUI.UltraWebGrid;
using System.Data;
using Aurigo.AMP3.Core.UserControls;
using System.Globalization;
using Infragistics.WebUI.UltraWebGrid.ExcelExport;
using Aurigo.Brix.Platform.BusinessLayer.UserControls;
using Aurigo.AMP3.LinksBL;
using Aurigo.AMP3.DocumentManagementBL;
using Aurigo.AMP3.LinksDTO;
using Aurigo.AMP3.DocumentManagementDTO;
using System.IO;
using System.Web.UI.WebControls;
using Infragistics.Documents.Excel;
using Aurigo.AMP3.Core.BusinessLayer.BL;
using System.Web.Http;
using System.Net.Http;
using Aurigo.AMP3.Estimator.UI;
using Aurigo.AMP3.DataAccess.Core;
using Newtonsoft.Json.Linq;
using System.Net;
using Newtonsoft.Json;
using System.Text;
using System.Linq;
using Aurigo.Brix.Platform.BusinessLayer.BL;
using Aurigo.Common;
using Aurigo.Brix.Platform.BusinessLayer.DataResouces;
using Aurigo.Brix.Platform.BusinessLayer.Utility;

namespace Aurigo.AMP3.EstimatorUI
{
    [ListModelContext(Name = &quot;CONTBID&quot;, Table = &quot;vw_ESTMATEBidderInvitationInfo&quot;)]
    public class ContractorBiddingListModel : ListModel
    {
        protected global::Aurigo.Brix.Platform.BusinessLayer.UserControls.PickerGrid downloadPickerGrid;
        protected UltraWebGridExcelExporter UWGExcelExporter;
        protected Infragistics.WebUI.UltraWebGrid.UltraWebGrid uwgExport;

        public override void OnInit()
        {
            base.OnInit();

            Page pg = (HttpContext.Current.CurrentHandler as Page);

            downloadPickerGrid = (PickerGrid)pg.LoadControl(&quot;~/Modules/UserControls/PickerGrid.ascx&quot;);
            downloadPickerGrid.ID = &quot;alternatePickerGrid&quot;;
            downloadPickerGrid.TriggerButton.Style.Add(&quot;display&quot;, &quot;none&quot;);
            downloadPickerGrid.EnableMultiSelect = true;
            downloadPickerGrid.PostBackAfterSelect = true;
            //string json = &quot;{\&quot;ProjectEstimateID\&quot;:\&quot;&quot; + ProjectEstimateID + &quot;\&quot;}&quot;;
            //downloadPickerGrid.OptionalParamaters = downloadPickerGrid.BuildOptionalParameters(json);
            downloadPickerGrid.BeforePickerLoadScript = &quot;FilterSelectedBid()&quot;;
            downloadPickerGrid.InitializePicker(&quot;/api/ContractorBiddingDocuments&quot;, GetAddendumGridColumns(), &quot;ID&quot;);
            downloadPickerGrid.Title = &quot;Choose Documents&quot;;
            downloadPickerGrid.EnableFilter = false;
            downloadPickerGrid.OnItemSelected += new PickerGrid.SelectedItems(downloadPickerGrid_OnItemSelected);
            downloadPickerGrid.AfterPickerSelectScript = &quot;$(&#39;#hdnIncludeAttachments&#39;).val(confirm(&#39;Include attachments?&#39;));&quot;;
            pg.Form.Controls.Add(downloadPickerGrid);
            UWGExcelExporter = new UltraWebGridExcelExporter();
            pg.Form.Controls.Add(UWGExcelExporter);

            HiddenField hdnIncludeAttachments = new HiddenField();
            hdnIncludeAttachments.ID = &quot;hdnIncludeAttachments&quot;;
            hdnIncludeAttachments.ClientIDMode = ClientIDMode.Static;
            pg.Form.Controls.Add(hdnIncludeAttachments);


        }

        public override void OnPreRender()
        {
            StringBuilder sbFilterSelectedBid = new StringBuilder();

            sbFilterSelectedBid.AppendFormat(
               @&quot;
                function FilterSelectedBid() 
                {{  
                    var selecetdId = &#39;&#39;; 
                    try 
                    {{
                        var masterTable = $find(&#39;{0}&#39;).get_masterTableView();
                        selecetdId = 0;
                        if(masterTable.get_selectedItems().length &gt; 0)
                        {{
                            selecetdId = masterTable.getCellByColumnUniqueName(masterTable.get_selectedItems()[0], &#39;ProjectEstimateID&#39;).innerHTML;
                        }}
                    }} catch (e) {{ }}
                    return selecetdId;
                }}&quot;, mwGrid.ClientID);

            sbFilterSelectedBid.AppendFormat(@&quot;
              function DownloadDocs()
              {{
                try 
                    {{
                        var masterTable = $find(&#39;{0}&#39;).get_masterTableView();
                        if(masterTable.get_selectedItems().length == 0)
                        {{
                            ShowError(&#39;Please select a record.&#39;);
                            return false;
                        }}
                        else
                        {{
                            $(&#39;#{1}&#39;).click();
                            return false;
                        }}
                    }} catch (e) {{ }}
              }}  
            &quot;, mwGrid.ClientID, downloadPickerGrid.TriggerButton.ClientID);


            Page pg = (HttpContext.Current.CurrentHandler as Page);

            pg.ClientScript.RegisterClientScriptBlock(pg.GetType(), &quot;FilterSelectedBid&quot;, sbFilterSelectedBid.ToString(), true);

            StringBuilder sbDownloadFile = new StringBuilder();
            sbDownloadFile.AppendFormat(
                @&quot; var downloadURL = function downloadURL(url) {{
                        var hiddenIFrameID = &#39;hiddenDownloader&#39;,
                            iframe = document.getElementById(hiddenIFrameID);
                        if (iframe === null) {{
                            iframe = document.createElement(&#39;iframe&#39;);
                            iframe.id = hiddenIFrameID;
                            iframe.style.display = &#39;none&#39;;
                            document.body.appendChild(iframe);
                        }}
                        iframe.src = url;
                    }};&quot;);

            pg.ClientScript.RegisterClientScriptBlock(pg.GetType(), &quot;DownloadFile&quot;, sbDownloadFile.ToString(), true);

            base.OnPreRender();
        }
        public override Dictionary&lt;string, string&gt; DataSourceFiltersWithValue
        {
            get
            {
                var filter = new Dictionary&lt;string, string&gt;();
                filter.Add(&quot;ContractorLoginID&quot;, UserDetail.GetCurrentUserDetail().UID.ToString2());
                return filter;
            }
        }

        public override string QueryStringName
        {
            get { return &quot;BidId&quot;; }
        }

        public override string ModuleId
        {
            get
            {
                return AMP3ApplicationSettings.Instance.IsContractorBidderUser ? &quot;CONTBID&quot; : Constants.MODID_ESTMATE;
            }
        }

        public override bool HasMultiApprove
        {
            get { return false; }
        }

        public override DataSet GetList(int pageSize, string sortOrder, string filter, ref int CurrentPage,
                                      out int count)
        {
            sortOrder = DefaultSortColumn + &quot; DESC&quot;;
            return base.GetList(pageSize, sortOrder, GetFilter(filter), ref CurrentPage, out count);
        }

        private string GetFilter(string filter)
        {
            string filterValue = string.Join(&quot;And&quot;, DataSourceFiltersWithValue.Select(kv =&gt; kv.Key + &quot;=&quot; + kv.Value).ToArray());
            return string.IsNullOrWhiteSpace(filter) ? filterValue : filter + &quot;And&quot; + filterValue;
        }
        public override void SetUIDetails()
        {
            DisableRoleSelection = true;
            header = &quot;Contractor Bidding List&quot;;

            //Hidden Columns
            ModifyColumnProperties(&quot;BidId&quot;, true, null, null, null, false);
            //vidhi
            ModifyColumnProperties(&quot;HasAttachments&quot;, true, 1, null, &quot;32px&quot;, false);
            //SetImageForRowValue(&quot;HasAttachments&quot;, &quot;&lt;img src=\&quot;../../Images/Toolbar/IcnAttachment.gif\&quot; alt=\&quot;Attachments\&quot; Title=\&quot;Attachments\&quot; /&gt;&quot;, &quot;1&quot;, &quot;IcnAttachmentBW.png&quot;);
            //SetImageForRowValue(&quot;HasAttachments&quot;, &quot;&lt;img src=\&quot;../../Images/Toolbar/IcnAttachment.gif\&quot; alt=\&quot;Attachments\&quot; Title=\&quot;Attachments\&quot; /&gt;&quot;, &quot;0&quot;, &quot;&quot;);

            ModifyColumnProperties(&quot;ProjectEstimateID&quot;, true, null, null, null, false);
            ModifyColumnProperties(&quot;ContractorId&quot;, true, null, null, null, false);
            ModifyColumnProperties(&quot;Multi&quot;, true, null, null, null, false);
            ModifyColumnProperties(&quot;RowNum&quot;, true, null, null, null, false);
            ModifyColumnProperties(&quot;Status&quot;, true, null, null, null, false);
            ModifyColumnProperties(&quot;ContractorName&quot;, true, null, null, null, false);
            ModifyColumnProperties(&quot;ContractorLoginID&quot;, true, null, null, null, false);
            ModifyColumnProperties(&quot;ProjectID&quot;, true, null, null, null, false);
            ModifyColumnProperties(&quot;Total Amount&quot;, false, null, AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, null, false, &quot;Bid Amount&quot;);
            ModifyColumnProperties(&quot;Bid Issue Date&quot;, false, null, AMP3ApplicationSettings.Instance.FORMAT_DATE, null, false, &quot;Bid Issue Date&quot;, true);
            ModifyColumnProperties(&quot;Bid Opening Date&quot;, false, null, AMP3ApplicationSettings.Instance.FORMAT_DATE, null, false, &quot;Bid Opening Date&quot;, true);
            ModifyColumnProperties(&quot;Modified On&quot;, false, null, AMP3ApplicationSettings.Instance.FORMAT_DATE, null, false, &quot;Modified On&quot;, true);
            ModifyColumnProperties(&quot;Advertisement Date&quot;, true, null, null, null, false, true);
            EnableGridDblClick = displayView = displayEdit = true;
            displayExport = true;
            displayViewPDF = false;
            displayDocuments = false;

        }

        public override bool HasAttachments { get { return false; } }



        protected override void SetModuleLevelPermissions(List&lt;string&gt; permissions)
        {
            if (HttpContext.Current != null)
            {
                List&lt;string&gt; list = (List&lt;string&gt;)HttpContext.Current.Items[Constants.MODULE_PERMISSIONS];
                if (list != null &amp;&amp; !list.Contains(Constants.MODFEAT_VIEW))
                    list.Add(Constants.MODFEAT_VIEW);
            }
            displayDelete = displayNew = false;
            EnableGridDblClick = displayView = displayEdit = true;
        }

        public override void HandleNew()
        {
            throw new NotImplementedException();
        }

        public override int HandleDelete()
        {
            if (MWGrid.GetSelectedRow(mwGrid) != null &amp;&amp; MWGrid.GetCellValue(MWGrid.GetSelectedRow(mwGrid), &quot;Status&quot;).ToInt16_2() == 0)
            {
                int nStatus = EstimateManager.Instance.DeleteBid(MWGrid.GetCellValue(MWGrid.GetSelectedRow(mwGrid), &quot;BidId&quot;).ToInt32_2());
                if (nStatus != 0)
                    throw new Exception((nStatus == -3)
                                            ? &quot;This bid is already deleted by another user.&quot;
                                            : &quot;Selected bid is awarded or rejected. Request Denied.&quot;);
                return 0;// CoreDatabaseHelper.GenericLibraryDelete(&quot;ESTMATEBidderInvitationInfo&quot;, &quot;ID&quot;, activeRow.Cells.FromKey(&quot;ID&quot;).Value.ToString2());
            }
            else if (MWGrid.GetSelectedRow(mwGrid) != null &amp;&amp; MWGrid.GetCellValue(MWGrid.GetSelectedRow(mwGrid), &quot;Status&quot;).ToInt16_2() != 0)
                throw new Exception(&quot;Selected bid is awarded or rejected. Request Denied.&quot;);
            return 0;
        }

        public override void HandleEdit()
        {
            if (MWGrid.GetSelectedRow(mwGrid) != null &amp;&amp; MWGrid.GetCellValue(MWGrid.GetSelectedRow(mwGrid), &quot;Status&quot;).ToInt16_2() == 0)
            {
                string msg;
                bool result = ValidateBid(MWGrid.GetCellValue(MWGrid.GetSelectedRow(mwGrid), &quot;ProjectEstimateID&quot;).ToInt32_2(), out msg);
                if ((MWGrid.GetCellValue(MWGrid.GetSelectedRow(mwGrid), MWGrid.GetGridFriendlyExpression(&quot;Bid Status&quot;)) ?? &quot;&quot;).ToString() == &quot;Submitted&quot;)
                {
                    Response.Redirect(
                       string.Format(
                           &quot;~/Modules/ESTMATE/ViewBidDetails.aspx?Mode=View&amp;{0}={1}&amp;ProjectEstimateID={2}&amp;BidId={3}&amp;Context=ESTMATE&quot;,
                           EstimatorConstants.PID, MWGrid.GetCellValue(MWGrid.GetSelectedRow(mwGrid), &quot;ProjectID&quot;),
                           MWGrid.GetCellValue(MWGrid.GetSelectedRow(mwGrid), &quot;ProjectEstimateID&quot;), MWGrid.GetCellValue(MWGrid.GetSelectedRow(mwGrid), &quot;BidId&quot;)), true);
                }
                else if (result)
                {
                    Response.Redirect(
                        string.Format(
                            &quot;~/Modules/ESTMATE/ViewBidDetails.aspx?Mode=Edit&amp;{0}={1}&amp;ProjectEstimateID={2}&amp;BidId={3}&amp;Context=ESTMATE&quot;,
                            EstimatorConstants.PID, MWGrid.GetCellValue(MWGrid.GetSelectedRow(mwGrid), &quot;ProjectID&quot;),
                           MWGrid.GetCellValue(MWGrid.GetSelectedRow(mwGrid), &quot;ProjectEstimateID&quot;), MWGrid.GetCellValue(MWGrid.GetSelectedRow(mwGrid), &quot;BidId&quot;)), true);
                }
                else
                {
                    if (!string.IsNullOrEmpty(msg))
                        throw new Exception(msg);
                    else
                        throw new Exception(&quot;This bid cannot be edited.&quot;);
                }
            }
            else if (MWGrid.GetSelectedRow(mwGrid) != null &amp;&amp; MWGrid.GetCellValue(MWGrid.GetSelectedRow(mwGrid), &quot;Status&quot;).ToInt16_2() != 0)
                (HttpContext.Current.CurrentHandler as Page).ClientScript.RegisterStartupScript(
                    HttpContext.Current.CurrentHandler.GetType(), &quot;NoEditMsg&quot;,
                    &quot;ShowError(&#39;Selected bid is awarded or rejected. Request Denied.&#39;);&quot;, true);
        }

        public override void HandleView()
        {
            try
            {
                if (MWGrid.GetSelectedRow(mwGrid) != null &amp;&amp; MWGrid.GetCellValue(MWGrid.GetSelectedRow(mwGrid), &quot;Status&quot;).ToInt16_2() == 0)
                    Response.Redirect(
                        string.Format(
                            &quot;~/Modules/ESTMATE/ViewBidDetails.aspx?Mode=View&amp;{0}={1}&amp;ProjectEstimateID={2}&amp;BidId={3}&amp;Context=ESTMATE&quot;,
                            EstimatorConstants.PID, MWGrid.GetCellValue(MWGrid.GetSelectedRow(mwGrid), &quot;ProjectID&quot;),
                           MWGrid.GetCellValue(MWGrid.GetSelectedRow(mwGrid), &quot;ProjectEstimateID&quot;), MWGrid.GetCellValue(MWGrid.GetSelectedRow(mwGrid), &quot;BidId&quot;)), true);
                else if (MWGrid.GetSelectedRow(mwGrid) != null &amp;&amp; MWGrid.GetCellValue(MWGrid.GetSelectedRow(mwGrid), &quot;Status&quot;).ToInt16_2() != 0)
                    (HttpContext.Current.CurrentHandler as Page).ClientScript.RegisterStartupScript(
                        HttpContext.Current.CurrentHandler.GetType(), &quot;NoViewMsg&quot;,
                        &quot;ShowError(&#39;Selected bid is awarded or rejected. Request Denied.&#39;);&quot;, true);
            }
            catch (Exception ex)
            {
                throw ex;
            }
        }

        public override void HandleGridDblClick&lt;T&gt;(T row)
        {
            try
            {
                if (row != null &amp;&amp; MWGrid.GetCellValue(row, &quot;Status&quot;).ToInt16_2() == 0)
                    Response.Redirect(
                        string.Format(
                            &quot;~/Modules/ESTMATE/ViewBidDetails.aspx?Mode=View&amp;{0}={1}&amp;ProjectEstimateID={2}&amp;BidId={3}&amp;Context=ESTMATE&quot;,
                            EstimatorConstants.PID, MWGrid.GetCellValue(row, &quot;ProjectID&quot;),
                            MWGrid.GetCellValue(row, &quot;ProjectEstimateID&quot;), MWGrid.GetCellValue(row, &quot;BidId&quot;)), true);
                else if (row != null &amp;&amp; MWGrid.GetCellValue(row, &quot;Status&quot;).ToInt16_2() != 0)
                    (HttpContext.Current.CurrentHandler as Page).ClientScript.RegisterStartupScript(
                        HttpContext.Current.CurrentHandler.GetType(), &quot;NoGridDblClickMsg&quot;,
                        &quot;ShowError(&#39;Selected bid is awarded or rejected. Request Denied.&#39;);&quot;, true);
            }
            catch (Exception ex)
            {
                throw ex;
            }
        }

        public override List&lt;MenuGroup&gt; MenuGroups
        {
            get
            {
                List&lt;MenuGroup&gt; menuGroups = base.MenuGroups;

                MenuGroup general = menuGroups.Find(x =&gt; x.Title == GROUP_GENERAL);

                if (general == null)
                {
                    general = new MenuGroup(GROUP_GENERAL);
                    menuGroups.Add(general);
                }

                general.AddMenu(new TextIcon(&quot;lnkSubmit&quot;, &quot;Submit&quot;, &quot;Icn_Button.png&quot;));

                #region Others
                MenuGroup othersGroup = menuGroups.Find(mg =&gt; mg.Title == GROUP_OTHERS);
                if (othersGroup == null)
                {
                    othersGroup = new MenuGroup(GROUP_OTHERS);
                    menuGroups.Add(othersGroup);
                }
                //Download Bid Sheet, Bid Items template(Excel), addendum, include attachments
                othersGroup.AddMenu(new TextIcon(&quot;lnkDownload&quot;, &quot;Download&quot;, &quot;Icn_Settings_16.png&quot;));
                //Export Bid Items template(Excel)
                // othersGroup.AddMenu(new TextIcon(&quot;lnkExcelExport&quot;, &quot;Excel Export&quot;, &quot;Icn_exportxl.gif&quot;));
                othersGroup.AddMenu(new TextIcon(&quot;lnkBidderAddendums&quot;, &quot;Addendums&quot;, &quot;Icn_New_16.png&quot;));
                #endregion

                return menuGroups;
            }
        }

        public override void CustomizeToolBarMenu(ToolBar toolBar)
        {
            base.CustomizeToolBarMenu(toolBar);

            if (!enableEdit) toolBar.DisableMenu(&quot;lnkEdit&quot;);
        }

        public override void ApplyToolBarCustomisation(ToolBar toolBarArg)
        {
            base.ApplyToolBarCustomisation(toolBarArg);
            if (toolBarArg.GetMenuReference(&quot;lnkBidderAddendums&quot;) != null)
                toolBarArg.GetMenuReference(&quot;lnkBidderAddendums&quot;).OnClientClick = &quot;return lnkValidation(&#39;&quot; + Convert.ToInt32(ValidateSelection.OneItem, CultureInfo.CurrentCulture) + &quot;&#39;, &#39;&quot; + mwGrid.ClientID + &quot;&#39;, &#39;ProjectEstimateID&#39;);&quot;;
            if (toolBarArg.GetMenuReference(&quot;lnkDownload&quot;) != null)
                toolBarArg.GetMenuReference(&quot;lnkDownload&quot;).OnClientClick = &quot;return DownloadDocs();&quot;;
            if (toolBarArg.GetMenuReference(&quot;lnkExcelExport&quot;) != null)
                toolBarArg.GetMenuReference(&quot;lnkExcelExport&quot;).OnClientClick = &quot;return lnkValidation(&#39;&quot; + Convert.ToInt32(ValidateSelection.OneItem, CultureInfo.CurrentCulture) + &quot;&#39;, &#39;&quot; + mwGrid.ClientID + &quot;&#39;, &#39;ProjectEstimateID&#39;);&quot;;
            if (toolBarArg.GetMenuReference(&quot;lnkSubmit&quot;) != null)
                toolBarArg.GetMenuReference(&quot;lnkSubmit&quot;).OnClientClick = &quot;if (lnkValidation(&#39;&quot; + Convert.ToInt32(ValidateSelection.OneItem, CultureInfo.CurrentCulture) + &quot;&#39;, &#39;&quot; + mwGrid.ClientID + &quot;&#39;, &#39;ProjectEstimateID&#39;))return confirm(&#39;Do you want to submit the Bid?&#39;);&quot;;
        }

        public override string HandleMenuItem(string eventString)
        {
            //base.HandleMenuItem(eventString);
            if (eventString == &quot;Addendums&quot;)
            {
                isMenuClickHandled = true;
                Response.Redirect(string.Format(&quot;~/Common/BrixListPage.aspx?Context=CONTBIDADDENDUM&amp;ProjectEstimateID={0}&amp;BidId={1}&quot;, GetActiveItemValue(&quot;ProjectEstimateID&quot;), GetActiveItemValue(&quot;BidId&quot;)), true);
            }
                //case &quot;Custom Excel Export&quot;:
                //    string excelfile;
                //    Export(false, out excelfile);
                //    isMenuClickHandled = true;
                //    break;
            if (eventString == &quot;Submit&quot;)
            {
                HandleSubmit();
                isMenuClickHandled = true;
                BindData();
                return string.Empty;
            }
            if (!isMenuClickHandled)
                return base.HandleMenuItem(eventString);
            return string.Empty;
        }

        private void HandleSubmit()
        {
            var selectedRow = MWGrid.GetSelectedRow(mwGrid);
            if (selectedRow != null)
            {
                int projEstId = MWGrid.GetCellValue(selectedRow, &quot;ProjectEstimateID&quot;).ToInt32_2();
                string msg = string.Empty;

                if (ValidateBid(projEstId, out msg))
                {
                    string workFlowStatus = MWGrid.GetCellValue(selectedRow, MWGrid.GetGridFriendlyExpression(&quot;Bid Status&quot;));
                    int projectId = MWGrid.GetCellValue(selectedRow, &quot;ProjectID&quot;).ToInt32_2();
                    int bidId = MWGrid.GetCellValue(selectedRow, &quot;BidID&quot;).ToInt32_2();

                    if ((workFlowStatus ?? &quot;Draft&quot;) != &quot;Draft&quot; &amp;&amp; (workFlowStatus ?? &quot;Rejected&quot;) != &quot;Rejected&quot;)
                    {
                        throw new Exception(&quot;The bid is already submitted.&quot;);
                    }

                    var sParams = new string[] { };
                    StartWorkflowInstancesFor.SimulateWorkflowAction(false, true, &quot;XBIDLST&quot;, bidId.ToString(), projEstId.ToString(),
                           projectId.ToString(), &quot;Submitted by bidder.&quot;, &quot;IEB169e4ca101914b5d980d5e0bf6bbe2d8&quot;, 1, &quot;&quot;, sParams);
                }
                else
                {
                    if (!string.IsNullOrEmpty(msg))
                        throw new Exception(msg);
                    else
                        throw new Exception(&quot;The bid cannot be submitted.&quot;);
                }
            }
        }

        public override string HandleMenuItems(string eventString,
                                             UltraWebGridExcelExporter UltraWebGridExcelExporter1, string filter = &quot;&quot;)
        {
            string error = String.Empty;
            switch (eventString)
            {
                case &quot;Excel Export (xls)&quot;:
                case &quot;Excel Export (xlsx)&quot;:                    
                    Export(eventString, filter);                    
                    isMenuClickHandled = true;
                    break;
                default:
                    error = base.HandleMenuItems(eventString, UltraWebGridExcelExporter1, filter);
                    break;
            }

            return error;
        }

        private void downloadPickerGrid_OnItemSelected(PickerGrid grid, List&lt;Dictionary&lt;string, object&gt;&gt; selectedRows)
        {
            string allowAttachments = ((HttpContext.Current.Handler as Page).Form.FindControl(&quot;hdnIncludeAttachments&quot;) as HiddenField).Value;
            if (selectedRows.Count &gt; 0)
            {

                var activeRow = MWGrid.GetSelectedRow(mwGrid);
                Dictionary&lt;string, string&gt; addendumIDList = new Dictionary&lt;string, string&gt;();
                bool includeAttachments = string.IsNullOrEmpty(allowAttachments) ? false : allowAttachments.ToBoolean2();
                bool bidDocuments = false;
                foreach (Dictionary&lt;string, object&gt; rows in selectedRows)
                {
                    //if (rows[&quot;ID&quot;].Equals(&quot;-1&quot;))
                    //    includeAttachments = true;
                    if (rows[&quot;ID&quot;].Equals(&quot;0&quot;))
                        bidDocuments = true;
                    else
                        addendumIDList.Add(rows[&quot;ID&quot;].ToString(), rows[&quot;AddendumID&quot;].ToString());
                }
                List&lt;string&gt; files = new List&lt;string&gt;();
                string excelFile = string.Empty;

                int cnt = 1;
                if (bidDocuments)
                {
                    Export(true, out excelFile, UWGExcelExporter);
                    files.Add(string.Format(&quot;{0}|Bid Template.xls&quot;, excelFile));
                    excelFile = BidReportPrint();
                    files.Add(string.Format(&quot;{0}|BidSheet.pdf&quot;, excelFile));

                    if (includeAttachments)
                    {

                        DataTable dtLetting = EstimateManager.Instance.GetBidLettingDetail(MWGrid.GetCellValue(activeRow, &quot;ProjectEstimateId&quot;).ToString2().ToInt32_2());
                        if (dtLetting.Rows.Count == 1 &amp;&amp; dtLetting.Columns.Contains(&quot;ID&quot;))
                        {
                            string lettingId = dtLetting.Rows[0][&quot;ID&quot;].ToString();
                            List&lt;LinkDetails&gt; list = LinksManager.Instance.GetLinksForModuleInstance(lettingId, &quot;BIDLTDL&quot;, &quot;&quot;);
                            if (list != null)
                            {
                                foreach (LinkDetails link in list)
                                {
                                    Document doc = DocumentManager.Instance.ViewDocumentDetails(link.DestID.ToInt32_2());
                                    if (doc != null)
                                        files.Add(string.Format(&quot;{0}|{1}_Bid Document_{2}&quot;, Path.Combine(DocumentManager.Instance.StoragePath, doc.StorageId), cnt++, link.LinkName));
                                }
                            }
                        }


                        //List&lt;LinkDetails&gt; list = LinksManager.Instance.GetLinksForModuleInstance(activeRow.Cells.FromKey(&quot;BidId&quot;).Value.ToString2(), &quot;ESTMBID&quot;, &quot;&quot;);
                        //if (list != null)
                        //{
                        //    foreach (LinkDetails link in list)
                        //    {
                        //        Document doc = DocumentManager.Instance.ViewDocumentDetails(link.DestID.ToInt32_2());
                        //        if (doc != null)
                        //            files.Add(string.Format(&quot;{0}|{1}Bid_Document_{2}&quot;, Path.Combine(DocumentManager.Instance.StoragePath, doc.StorageId), cnt++, link.LinkName));
                        //    }
                        //}
                    }
                }
                if (addendumIDList.Count &gt; 0)
                {
                    foreach (KeyValuePair&lt;string, string&gt; addendumID in addendumIDList)
                    {
                        files.Add(AddendumReportPrint(MWGrid.GetCellValue(activeRow, &quot;ProjectEstimateId&quot;).ToString2(), addendumID.Key, &quot;Addendum_&quot; + addendumID.Value + &quot;_Report&quot;));
                        if (includeAttachments)
                        {
                            List&lt;LinkDetails&gt; list = LinksManager.Instance.GetLinksForModuleInstance(addendumID.Key, &quot;BIDLTDL&quot;, &quot;&quot;);
                            if (list != null)
                            {
                                foreach (LinkDetails link in list)
                                {

                                    Document doc = DocumentManager.Instance.ViewDocumentDetails(link.DestID.ToInt32_2());
                                    if (doc != null)
                                        files.Add(string.Format(&quot;{0}|{1}_Addendum_{2}_Document_{3}&quot;, Path.Combine(DocumentManager.Instance.StoragePath, doc.StorageId), cnt++, addendumID.Value, link.LinkName));
                                }
                            }
                        }
                    }
                }

                //if (addendumIDList.Count &gt; 0 &amp;&amp; includeAttachments)
                //{
                //    foreach (KeyValuePair&lt;string, string&gt; addendumID in addendumIDList)
                //    {
                //        List&lt;LinkDetails&gt; list = LinksManager.Instance.GetLinksForModuleInstance(addendumID.Key, &quot;ESTMATE&quot;, &quot;&quot;);
                //        if (list != null)
                //        {
                //            foreach (LinkDetails link in list)
                //            {
                //                Document doc = DocumentManager.Instance.ViewDocumentDetails(link.DestID.ToInt32_2());
                //                if (doc != null)
                //                    files.Add(string.Format(&quot;{0}|{1}Addendum_{2}_Document_{3}&quot;, Path.Combine(DocumentManager.Instance.StoragePath, doc.StorageId), cnt++, addendumID.Value, link.LinkName));
                //            }
                //        }
                //    }
                //}
                if (files.Count &gt; 0)
                {
                    // string projectName = ComponentHelper.Instance.ExecuteScalar(&quot;select PM.ProjectName from PROJECTProjectMain PM  inner join ESTMATEInfo EI on PM.ProjectId = EI.ProjectID where EI.ProjectEstimateID = &quot; + MWGrid.GetCellValue(activeRow,&quot;ProjectEstimateId&quot;)).ToString();
                    string projectName = EstimateManager.Instance.GetProjectName(MWGrid.GetCellValue(activeRow, &quot;ProjectEstimateId&quot;).ToInt32_2());
                    DocumentManager.Instance.DownloadZipToBrowser(files, projectName + &quot;_Documents.zip&quot;);
                }
                if (!string.IsNullOrEmpty(excelFile) &amp;&amp; File.Exists(excelFile))
                    File.Delete(excelFile);
            }
        }

        private void Export(string eventString, string filter)
        {
            DataSet ds = new DataSet();
            var selectedRow = MWGrid.GetSelectedRow(mwGrid);
            DataTable dt = EstimateManager.Instance.GetBidItems(MWGrid.GetCellValue(selectedRow, &quot;ProjectEstimateID&quot;).ToInt32_2(), MWGrid.GetCellValue(selectedRow, &quot;BidId&quot;).ToInt32_2()).Select(filter).CopyToDataTable();
            dt.TableName = &quot;Bid Items&quot;;
            ds.Tables.Add(dt);
            ds.DataSetName = Guid.NewGuid().ToString();
            ExcelExportEntity excelExportEntity = new ExcelExportEntity(ds);
            ExcelHelper.ExportToExcel(eventString, excelExportEntity);
        }

        private void Export(bool createFile, out string excelFile, UltraWebGridExcelExporter UltraWebGridExcelExporter1)
        {
            if (uwgExport == null)
                uwgExport = new UltraWebGrid();
            var selectedRow = MWGrid.GetSelectedRow(mwGrid);
            uwgExport.DataSource = EstimateManager.Instance.GetBidItems(MWGrid.GetCellValue(selectedRow, &quot;ProjectEstimateID&quot;).ToInt32_2(), MWGrid.GetCellValue(selectedRow, &quot;BidId&quot;).ToInt32_2());
            uwgExport.DataBind();
            FormatGrid(uwgExport);

            excelFile = string.Empty;
            string exportWorksheetName = &quot;Bid Items&quot;;

            //if (createFile)
            //{
            //    Workbook book = UltraWebGridExcelExporter1.Export(uwgExport);
            //    if (book.Worksheets.Count &gt; 0)
            //        book.Worksheets[0].Name = exportWorksheetName;
            //    excelFile = string.Format(&quot;{0}.xls&quot;, Path.Combine(HttpContext.Current.Server.MapPath(@&quot;~/Modules/UploadedFiles&quot;), Guid.NewGuid().ToString()));
            //    book.Save(excelFile);
            //}
            //else
            //{
            //    UltraWebGridExcelExporter1.DownloadName = exportWorksheetName + &quot;.xls&quot;;
            //    UltraWebGridExcelExporter1.WorksheetName = exportWorksheetName;
            //    UltraWebGridExcelExporter1.Export(uwgExport);
            //}

            Workbook book = UltraWebGridExcelExporter1.Export(uwgExport);
            if (book.Worksheets.Count &gt; 0)
                book.Worksheets[0].Name = exportWorksheetName;
            excelFile = string.Format(&quot;{0}.xls&quot;, Path.Combine(HttpContext.Current.Server.MapPath(@&quot;~/Modules/UploadedFiles&quot;), Guid.NewGuid().ToString()));
            book.Save(excelFile);

            if (!createFile)
            {
                (HttpContext.Current.CurrentHandler as Page).ClientScript.RegisterStartupScript(BrixExcelExporter.GetType(), &quot;fileOpen&quot;, &quot;downloadURL(&#39;../Modules/UploadedFiles/&quot; + Path.GetFileName(excelFile) + &quot;&#39;);&quot;, true);
            }
        }

        protected string AddendumReportPrint(string projectEstinateId, string addendumId, string addendumName = &quot;&quot;)
        {
            string relativeFile = string.Format(&quot;~/Modules/UploadedFiles/{0}.pdf&quot;, string.IsNullOrEmpty(addendumName) ? Guid.NewGuid().ToString() : addendumName);
            string physFile = HttpContext.Current.Request.MapPath(relativeFile);

            Dictionary&lt;string, string&gt; parameters = new Dictionary&lt;string, string&gt;();
            parameters.Add(&quot;PARENTID&quot;, projectEstinateId);
            parameters.Add(&quot;AID&quot;, addendumId);
            parameters.Add(&quot;ADDENDUMID&quot;, addendumId);
            parameters.Add(&quot;MWTimezone&quot;, MWDateTimeHelper.CurrentTimeZone);
            ReportManager.Instance.RenderReportWithFormat(parameters, &quot;AddendumReport&quot;, physFile, &quot;pdf&quot;);
            return (physFile);
        }

        private void FormatGrid(UltraWebGrid grid)
        {
            ColumnsCollection cols = grid.Bands[0].Columns;
            // Hidding the columns.
            new List&lt;string&gt;() { &quot;BidUnitPriceId&quot;, &quot;DisplayBase&quot;, &quot;DisplayChild&quot;, &quot;Accounting Code&quot;, &quot;Path&quot;, &quot;BidId&quot;, &quot;AlternateID&quot;, &quot;ItemId&quot;, &quot;MustBid&quot;, &quot;ProjectEstimateId&quot; }.ForEach(key =&gt;
            {
                if (cols.Exists(key))
                    cols.FromKey(key).Hidden = true;
            });

            if (cols.Exists(&quot;Standard Item No&quot;))
                cols.FromKey(&quot;Standard Item No&quot;).Header.Caption = &quot;Standard Item No.&quot;;

            // Setting the format for the columns.
            if (cols.Exists(&quot;quantity&quot;))
            {
                cols.FromKey(&quot;quantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                cols.FromKey(&quot;quantity&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
            }
            if (cols.Exists(&quot;Unit price&quot;))
            {
                cols.FromKey(&quot;Unit price&quot;).Header.Caption = &quot;UnitPrice&quot;;
                cols.FromKey(&quot;Unit price&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;
                cols.FromKey(&quot;Unit price&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
            }
            if (cols.Exists(&quot;amount&quot;))
            {
                cols.FromKey(&quot;amount&quot;).Header.Caption = &quot;Amount&quot;;
                cols.FromKey(&quot;amount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                cols.FromKey(&quot;amount&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
            }
            // Group By column
            if (cols.Exists(&quot;AlternateCode&quot;))
                cols.FromKey(&quot;AlternateCode&quot;).IsGroupByColumn = true;

            //First Sorted by Path
            if (cols.Exists(&quot;Path&quot;))
            {
                grid.DisplayLayout.Bands[0].SortedColumns.Add(&quot;Path&quot;);
                grid.Columns.FromKey(&quot;Path&quot;).SortIndicator = SortIndicator.Ascending;
            }
            if (cols.Exists(&quot;Line No.&quot;))
            {
                //DEFAULT SORTING ON LINE NUMBER 
                grid.DisplayLayout.Bands[0].SortedColumns.Add(&quot;Line No.&quot;);
                grid.Columns.FromKey(&quot;Line No.&quot;).SortIndicator = SortIndicator.Ascending;
            }
        }

        protected string BidReportPrint()
        {
            string relativeFile = string.Format(&quot;~/Modules/UploadedFiles/{0}.pdf&quot;, Guid.NewGuid());
            string physFile = HttpContext.Current.Request.MapPath(relativeFile);

            var selectedRow = MWGrid.GetSelectedRow(mwGrid);

            Dictionary&lt;string, string&gt; parameters = new Dictionary&lt;string, string&gt;();
            parameters.Add(&quot;ParentID&quot;, MWGrid.GetCellValue(selectedRow, &quot;ProjectEstimateID&quot;).ToString2());
            parameters.Add(&quot;Code&quot;, &quot;BS&quot;); // BS-BidSheet, BR-BidResponse
            parameters.Add(&quot;WithDraft&quot;, &quot;0&quot;);
            parameters.Add(&quot;ShowTotals&quot;, &quot;true&quot;);
            parameters.Add(&quot;SortOrder&quot;, &quot;LineNo&quot;);
            parameters.Add(&quot;MWTimezone&quot;, MWDateTimeHelper.CurrentTimeZone);
            ReportManager.Instance.RenderReportWithFormat(parameters, &quot;BidSheetMain&quot;, physFile, &quot;pdf&quot;);
            return (physFile);
        }

        private List&lt;PickerColumnDetails&gt; GetAddendumGridColumns()
        {
            List&lt;PickerColumnDetails&gt; gridColumns = new List&lt;PickerColumnDetails&gt;();
            List&lt;string&gt; allColumns = new List&lt;string&gt;() { &quot;ID&quot;, &quot;Documents&quot;, &quot;AddendumID&quot; };

            Dictionary&lt;string, string&gt; visibleColumns = new Dictionary&lt;string, string&gt;();

            visibleColumns.Add(&quot;Documents&quot;, &quot;Documents&quot;);

            foreach (string col in allColumns)
            {
                PickerColumnDetails tCol = (!visibleColumns.ContainsKey(col)) ? new PickerColumnDetails { Caption = col, ColumnName = col, Hidden = true } :
                    new PickerColumnDetails { Caption = visibleColumns[col], ColumnName = col, Hidden = false, Width = 200, Type = &quot;string&quot; };
                gridColumns.Add(tCol);
            }
            return gridColumns;
        }

        private bool ValidateBid(int projectEstimateID, out string message)
        {
            DataTable dt = EstimateManager.Instance.GetBidLettingDetail(projectEstimateID);
            message = string.Empty;

            if (dt != null &amp;&amp; dt.Rows.Count &gt; 0)
            {
                DataRow dr = dt.Select(&quot;Type=&#39;Letting&#39;&quot;).FirstOrDefault();

                string status = dr[&quot;Status&quot;].ToString();
                DateTime issueDate, bidOpenDate,bidCloseDate;
                //int bidOpenHr = 0, bidOpenMin = 0;

                DateTime.TryParse(dr[&quot;IssueDate&quot;].ToString(), out issueDate);
                DateTime.TryParse(dr[&quot;LettingDate&quot;].ToString(), out bidOpenDate);
                DateTime.TryParse(dr[&quot;BidDueDateTime&quot;].ToString(), out bidCloseDate);
                //if (dr[&quot;BidDueTime&quot;] != null &amp;&amp; dr[&quot;BidDueTime&quot;].ToString() != &quot;&quot;)
                //{
                //    string openingTime = dr[&quot;BidDueTime&quot;].ToString();
                //    int.TryParse(openingTime.Split(&quot;:&quot;.ToCharArray())[0], out bidOpenHr);
                //    int.TryParse(openingTime.Split(&quot;:&quot;.ToCharArray())[1], out bidOpenMin);
                //}

                //bidOpenDate = bidOpenDate.AddHours(bidOpenHr).AddMinutes(bidOpenMin);
                /* -- Old Code 
                //if (status == &quot;Issued&quot; &amp;&amp;
                //    DateTime.Today &gt;= issueDate.Date &amp;&amp;
                //    bidOpenDate &gt;= DateTime.UtcNow)
                //{
                //    return true;
                //}

                //if (bidOpenDate &lt; DateTime.UtcNow)
                //{
                //    message = &quot;Request denied. Due date has passed.&quot;;
                //}
                */
                TimeZoneInfo tmi = string.IsNullOrEmpty(AMP3ApplicationSettings.Instance.CurrentTimeZone) ? TimeZoneInfo.Local : TimeZoneInfo.FindSystemTimeZoneById(AMP3ApplicationSettings.Instance.CurrentTimeZone);
                DateTime dtNow = TimeZoneInfo.ConvertTime(DateTime.UtcNow, tmi);
                DateTime bidDueDateTime = TimeZoneInfo.ConvertTimeFromUtc(bidCloseDate, tmi);
                DateTime bidLettingDate = TimeZoneInfo.ConvertTimeFromUtc(bidOpenDate, tmi);

                bidDueDateTime = bidLettingDate.Date.Add(bidDueDateTime.TimeOfDay);
                if (status == &quot;Issued&quot; &amp;&amp;
                    dtNow.Date &gt;= issueDate.Date &amp;&amp;
                    bidDueDateTime &gt;= dtNow)
                {
                    return true;
                }

                if (bidDueDateTime &lt; dtNow)
                {
                    message = &quot;Request denied. Due date has passed.&quot;;
                }
            }

            return false;
        }

    }

    [Authorize]
    public class ContractorBiddingDocumentsController : ApiController
    {
        [HttpGet]
        public HttpResponseMessage Get(HttpRequestMessage requestMessage)
        {
            DataSourceRequest request = JsonConvert.DeserializeObject&lt;DataSourceRequest&gt;(requestMessage.RequestUri.ParseQueryString().GetKey(0));

            KendoDataSource jf = GetAlternatesDetails(request);

            JObject jObject = JObject.FromObject(jf);
            var dffd = Request.CreateResponse&lt;JObject&gt;(HttpStatusCode.Created, jObject);
            return dffd;
        }
        private KendoDataSource GetAlternatesDetails(DataSourceRequest request)
        {
            // EstimateBidListData data = JsonConvert.DeserializeObject&lt;EstimateBidListData&gt;(request.additionalInfo.ToString());
            EstimateBidListData data = new EstimateBidListData();
            data.ProjectEstimateID = request.additionalInfo.ToString();
            DataSet ds = ComponentHelper.Instance.ExecuteDataSet(string.Format(&quot;select * from vw_ESTMATEBidderAddendums where ProjectEstimateID={0}&quot;, data.ProjectEstimateID)); ;
            DataTable dt = new DataTable();
            dt.Columns.Add(&quot;ID&quot;);
            dt.Columns.Add(&quot;Documents&quot;);
            dt.Columns.Add(&quot;AddendumID&quot;);
            DataRow row = dt.NewRow();
            //row[&quot;ID&quot;] = &quot;-1&quot;;
            //row[&quot;Documents&quot;] = &quot;Include Attachments&quot;;
            //dt.Rows.Add(row);
            row = dt.NewRow();
            row[&quot;ID&quot;] = &quot;0&quot;;
            row[&quot;Documents&quot;] = &quot;Bid Documents&quot;;
            dt.Rows.Add(row);
            foreach (DataRow dr in ds.Tables[0].Rows)
            {
                row = dt.NewRow();
                row[&quot;ID&quot;] = dr[&quot;ID&quot;];
                row[&quot;AddendumID&quot;] = dr[&quot;Addendum ID&quot;];
                row[&quot;Documents&quot;] = string.Format(&quot;Addendum &lt;{0}&gt;&quot;, dr[&quot;Addendum ID&quot;]);
                dt.Rows.Add(row);
            }
            dt.AcceptChanges();

            return new KendoDataSource
            {
                Data = dt.GetKendoDataSource(),
                Total = dt.Rows.Count
            };
        }

    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[48,9,48,10,0],[49,13,49,27,0],[51,13,51,68,0],[53,13,53,103,0],[54,13,54,59,0],[55,13,55,75,0],[56,13,56,57,0],[57,13,57,59,0],[60,13,60,79,0],[61,13,61,116,0],[62,13,62,59,0],[63,13,63,53,0],[64,13,64,114,0],[65,13,65,126,0],[66,13,66,54,0],[67,13,67,64,0],[68,13,68,52,0],[70,13,70,67,0],[71,13,71,64,0],[72,13,72,70,0],[73,13,73,57,0],[76,9,76,10,0],[79,9,79,10,0],[80,13,80,69,0],[82,13,97,39,0],[99,13,117,76,0],[120,13,120,68,0],[122,13,122,128,0],[124,13,124,64,0],[125,13,136,27,0],[138,13,138,118,0],[140,13,140,32,0],[141,9,141,10,0],[145,13,145,14,0],[146,17,146,63,0],[147,17,147,100,0],[148,17,148,31,0],[149,13,149,14,0],[154,17,154,18,0],[154,19,154,34,0],[154,35,154,36,0],[160,13,160,14,0],[161,17,161,118,0],[162,13,162,14,0],[167,17,167,18,0],[167,19,167,32,0],[167,33,167,34,0],[172,9,172,10,0],[173,13,173,53,0],[174,13,174,101,0],[175,9,175,10,0],[178,9,178,10,0],[179,13,179,93,0],[179,93,179,116,0],[179,116,179,129,0],[179,13,179,129,0],[180,13,180,99,0],[181,9,181,10,0],[183,9,183,10,0],[184,13,184,41,0],[185,13,185,48,0],[188,13,188,76,0],[190,13,190,84,0],[194,13,194,88,0],[195,13,195,83,0],[196,13,196,76,0],[197,13,197,77,0],[198,13,198,77,0],[199,13,199,85,0],[200,13,200,88,0],[201,13,201,80,0],[202,13,202,140,0],[203,13,203,150,0],[204,13,204,154,0],[205,13,205,144,0],[206,13,206,95,0],[207,13,207,67,0],[208,13,208,34,0],[209,13,209,36,0],[210,13,210,38,0],[212,9,212,10,0],[214,51,214,52,0],[214,53,214,66,0],[214,67,214,68,0],[219,9,219,10,0],[220,13,220,45,0],[221,13,221,14,0],[222,17,222,107,0],[223,17,223,76,0],[224,21,224,54,0],[225,13,225,14,0],[226,13,226,48,0],[227,13,227,67,0],[228,9,228,10,0],[231,9,231,10,0],[232,13,232,49,0],[236,9,236,10,0],[237,13,237,136,0],[238,13,238,14,0],[239,17,239,139,0],[240,17,240,34,0],[241,21,243,103,0],[244,17,244,26,0],[246,18,246,141,0],[247,17,247,93,0],[248,13,248,22,0],[249,9,249,10,0],[252,9,252,10,0],[253,13,253,136,0],[254,13,254,14,0],[256,17,256,137,0],[257,17,257,154,0],[258,17,258,18,0],[259,21,263,169,0],[264,17,264,18,0],[265,22,265,33,0],[266,17,266,18,0],[267,21,271,169,0],[272,17,272,18,0],[274,17,274,18,0],[275,21,275,52,0],[276,25,276,50,0],[278,25,278,75,0],[280,13,280,14,0],[281,18,281,141,0],[282,17,284,97,0],[285,9,285,10,0],[288,9,288,10,0],[290,13,290,14,0],[291,17,291,140,0],[292,21,296,169,0],[297,22,297,145,0],[298,21,300,101,0],[301,13,301,14,0],[302,13,302,33,0],[303,13,303,14,0],[304,17,304,26,0],[306,9,306,10,0],[309,9,309,10,0],[311,13,311,14,0],[312,17,312,88,0],[313,21,317,118,0],[318,22,318,93,0],[319,21,321,101,0],[322,13,322,14,0],[323,13,323,33,0],[324,13,324,14,0],[325,17,325,26,0],[327,9,327,10,0],[332,13,332,14,0],[333,17,333,62,0],[335,17,335,58,0],[335,58,335,82,0],[335,82,335,84,0],[335,17,335,84,0],[337,17,337,37,0],[338,17,338,18,0],[339,21,339,60,0],[340,21,340,45,0],[341,17,341,18,0],[343,17,343,88,0],[346,17,346,63,0],[346,63,346,87,0],[346,87,346,89,0],[346,17,346,89,0],[347,17,347,41,0],[348,17,348,18,0],[349,21,349,63,0],[350,21,350,49,0],[351,17,351,18,0],[353,17,353,101,0],[356,17,356,104,0],[359,17,359,35,0],[360,13,360,14,0],[364,9,364,10,0],[365,13,365,48,0],[367,13,367,29,0],[367,30,367,61,0],[368,9,368,10,0],[371,9,371,10,0],[372,13,372,56,0],[373,13,373,75,0],[374,17,374,237,0],[375,13,375,68,0],[376,17,376,101,0],[377,13,377,71,0],[378,17,378,233,0],[379,13,379,66,0],[380,17,380,274,0],[381,9,381,10,0],[384,9,384,10,0],[386,13,386,44,0],[387,13,387,14,0],[388,17,388,43,0],[389,17,389,212,0],[390,13,390,14,0],[396,13,396,41,0],[397,13,397,14,0],[398,17,398,32,0],[399,17,399,43,0],[400,17,400,28,0],[401,17,401,37,0],[403,13,403,37,0],[404,17,404,57,0],[405,13,405,33,0],[406,9,406,10,0],[409,9,409,10,0],[410,13,410,61,0],[411,13,411,37,0],[412,13,412,14,0],[413,17,413,99,0],[414,17,414,43,0],[416,17,416,53,0],[417,17,417,18,0],[418,21,418,126,0],[419,21,419,95,0],[420,21,420,87,0],[422,21,422,112,0],[423,21,423,22,0],[424,25,424,78,0],[427,21,427,52,0],[428,21,429,129,0],[430,17,430,18,0],[432,17,432,18,0],[433,21,433,52,0],[434,25,434,50,0],[436,25,436,77,0],[438,13,438,14,0],[439,9,439,10,0],[443,9,443,10,0],[444,13,444,41,0],[445,13,445,33,0],[449,21,449,49,0],[450,21,450,47,0],[451,21,451,27,0],[453,21,453,99,0],[454,21,454,27,0],[457,13,457,26,0],[458,9,458,10,0],[461,9,461,10,0],[462,13,462,142,0],[463,13,463,40,0],[464,13,464,14,0],[466,17,466,63,0],[467,17,467,94,0],[468,17,468,122,0],[469,17,469,43,0],[470,17,470,24,0],[470,26,470,57,0],[470,58,470,60,0],[470,61,470,73,0],[471,17,471,18,0],[474,21,474,48,0],[475,25,475,45,0],[477,25,477,98,0],[478,17,478,18,0],[479,17,479,57,0],[480,17,480,49,0],[482,17,482,29,0],[483,17,483,34,0],[484,17,484,18,0],[485,21,485,67,0],[486,21,486,81,0],[487,21,487,50,0],[488,21,488,77,0],[490,21,490,44,0],[491,21,491,22,0],[493,25,493,169,0],[494,25,494,91,0],[495,25,495,26,0],[496,29,496,83,0],[497,29,497,128,0],[498,29,498,46,0],[499,29,499,30,0],[500,33,500,40,0],[500,42,500,58,0],[500,59,500,61,0],[500,62,500,66,0],[501,33,501,34,0],[502,37,502,122,0],[503,37,503,53,0],[504,41,504,183,0],[505,33,505,34,0],[506,29,506,30,0],[507,25,507,26,0],[520,21,520,22,0],[521,17,521,18,0],[522,17,522,46,0],[523,17,523,18,0],[524,21,524,28,0],[524,30,524,69,0],[524,70,524,72,0],[524,73,524,87,0],[525,21,525,22,0],[526,25,526,181,0],[527,25,527,48,0],[528,25,528,26,0],[529,29,529,133,0],[530,29,530,46,0],[531,29,531,30,0],[532,33,532,40,0],[532,42,532,58,0],[532,59,532,61,0],[532,62,532,66,0],[533,33,533,34,0],[535,37,535,122,0],[536,37,536,53,0],[537,41,537,210,0],[538,33,538,34,0],[539,29,539,30,0],[540,25,540,26,0],[541,21,541,22,0],[542,17,542,18,0],[560,17,560,37,0],[561,17,561,18,0],[563,21,563,147,0],[564,21,564,106,0],[565,17,565,18,0],[566,17,566,80,0],[567,21,567,44,0],[568,13,568,14,0],[569,9,569,10,0],[572,9,572,10,0],[573,13,573,40,0],[574,13,574,61,0],[575,13,575,220,0],[576,13,576,40,0],[577,13,577,31,0],[578,13,578,56,0],[579,13,579,77,0],[580,13,580,71,0],[581,9,581,10,0],[584,9,584,10,0],[585,13,585,35,0],[586,17,586,48,0],[587,13,587,61,0],[588,13,588,195,0],[589,13,589,34,0],[590,13,590,35,0],[592,13,592,38,0],[593,13,593,54,0],[610,13,610,74,0],[611,13,611,43,0],[612,17,612,63,0],[613,13,613,155,0],[614,13,614,34,0],[616,13,616,29,0],[617,13,617,14,0],[618,17,618,224,0],[619,13,619,14,0],[620,9,620,10,0],[623,9,623,10,0],[624,13,624,163,0],[625,13,625,81,0],[627,13,627,86,0],[628,13,628,59,0],[629,13,629,47,0],[630,13,630,54,0],[631,13,631,76,0],[632,13,632,106,0],[633,13,633,31,0],[634,9,634,10,0],[637,9,637,10,0],[638,13,638,60,0],[640,13,641,13,0],[641,13,641,14,0],[641,14,642,17,0],[642,17,642,38,0],[642,38,643,21,0],[643,21,643,53,0],[643,53,644,13,0],[644,13,644,14,0],[644,14,644,16,0],[640,13,644,16,0],[646,13,646,49,0],[647,17,647,87,0],[650,13,650,41,0],[651,13,651,14,0],[652,17,652,100,0],[653,17,653,92,0],[654,13,654,14,0],[655,13,655,43,0],[656,13,656,14,0],[657,17,657,73,0],[658,17,658,104,0],[659,17,659,94,0],[660,13,660,14,0],[661,13,661,39,0],[662,13,662,14,0],[663,17,663,66,0],[664,17,664,96,0],[665,17,665,90,0],[666,13,666,14,0],[668,13,668,46,0],[669,17,669,70,0],[672,13,672,37,0],[673,13,673,14,0],[674,17,674,71,0],[675,17,675,86,0],[676,13,676,14,0],[677,13,677,41,0],[678,13,678,14,0],[680,17,680,75,0],[681,17,681,90,0],[682,13,682,14,0],[683,9,683,10,0],[686,9,686,10,0],[687,13,687,100,0],[688,13,688,81,0],[690,13,690,61,0],[692,13,692,86,0],[693,13,693,107,0],[694,13,694,42,0],[695,13,695,46,0],[696,13,696,50,0],[697,13,697,51,0],[698,13,698,76,0],[699,13,699,104,0],[700,13,700,31,0],[701,9,701,10,0],[704,9,704,10,0],[705,13,705,85,0],[706,13,706,94,0],[708,13,708,90,0],[710,13,710,58,0],[712,13,712,20,0],[712,22,712,32,0],[712,33,712,35,0],[712,36,712,46,0],[713,13,713,14,0],[714,17,715,143,0],[716,17,716,39,0],[717,13,717,14,0],[718,13,718,32,0],[719,9,719,10,0],[722,9,722,10,0],[723,13,723,92,0],[724,13,724,36,0],[726,13,726,49,0],[727,13,727,14,0],[728,17,728,75,0],[730,17,730,57,0],[734,17,734,78,0],[735,17,735,82,0],[736,17,736,86,0],[758,17,758,216,0],[759,17,759,81,0],[760,17,760,94,0],[761,17,761,93,0],[763,17,763,84,0],[764,17,766,45,0],[767,17,767,18,0],[768,21,768,33,0],[771,17,771,44,0],[772,17,772,18,0],[773,21,773,70,0],[774,17,774,18,0],[775,13,775,14,0],[777,13,777,26,0],[778,9,778,10,0],[787,9,787,10,0],[788,13,788,146,0],[790,13,790,64,0],[792,13,792,54,0],[793,13,793,89,0],[794,13,794,25,0],[795,9,795,10,0],[797,9,797,10,0],[799,13,799,66,0],[800,13,800,72,0],[801,13,801,176,0],[801,177,801,178,0],[802,13,802,44,0],[803,13,803,34,0],[804,13,804,41,0],[805,13,805,42,0],[806,13,806,39,0],[810,13,810,31,0],[811,13,811,29,0],[812,13,812,48,0],[813,13,813,30,0],[814,13,814,20,0],[814,22,814,32,0],[814,33,814,35,0],[814,36,814,53,0],[815,13,815,14,0],[816,17,816,35,0],[817,17,817,38,0],[818,17,818,55,0],[819,17,819,87,0],[820,17,820,34,0],[821,13,821,14,0],[822,13,822,32,0],[824,13,828,15,0],[829,9,829,10,0]]);
    </script>
  </body>
</html>