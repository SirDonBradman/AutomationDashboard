<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Business Layer\UserControls\ItemPickerControl.ascx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections;
using System.Collections.Generic;
using System.Configuration;
using System.Data;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Net;
using System.Net.Http;
using System.Runtime.Serialization;
using System.Web.Http;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Xml;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core.BusinessLayer.BL;
using Aurigo.AMP3.Core.BusinessLayer.DTO;
using Aurigo.AMP3.Core.IntegrationConnector;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.AMP3.Logging;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.Brix.Platform.BusinessLayer.UserControls;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Infragistics.WebUI.UltraWebGrid;
using Newtonsoft.Json;
using Newtonsoft.Json.Linq;

namespace Aurigo.AMP3.Core.UserControls
{
    public partial class ItemPickerControl : System.Web.UI.UserControl
    {
        protected global::Aurigo.Brix.Platform.BusinessLayer.UserControls.PickerGrid stdItemNumber;

        private string _ValidationGroup;
        string _AXCompany = &quot;&quot;;

        public delegate bool InitParams();

        public delegate void CustomizeColumns(ref List&lt;PickerColumnDetails&gt; lst);

        protected string Pages { get; set; }
        protected List&lt;Dictionary&lt;string, string&gt;&gt; _SelectedElem;

        #region Public Properties

        public event ClickEventHandler SelectedIndexChanged;
        public event ClickEventHandler MultipleSelectedIndexChanged;
        public event CustomizeColumns CustomizeGridColumns;

        public bool EnableMultipleSelect { get; set; }
        public string DefaultTableID { get; set; }
        public bool EnableQuantityEdit { get; set; }
        public bool DisplayIgnoreContainer { get; set; }
        public string Currency { get; set; }
        public string MinimumQuantity { get; set; }
        public string CurrentModuleID { get; set; }
        public string MinimumBaseCost { get; set; }
        public bool? IsNonContract { get; set; }
        public bool? IsComplete { get; set; }
        public bool? IsAmountFromCost { get; set; }
        public bool? IsContractView { get; set; }
        public bool TextOnly { get; set; }
        public bool ReadOnly { get; set; }
        public bool HideAll { get; set; }
        public int ParentInstanceID { get; set; }
        public ArrayList SelectedItems { get; set; }
        public string ReferenceItemType { get; set; }
        public bool ValidationSkipRequired { get; set; }
        public bool MandatoryMarkRequired { get; set; }

        public List&lt;int&gt; GridItems { get; set; }
        public string ItemValidationGroup
        {
            get { return string.IsNullOrEmpty(_ValidationGroup) ? &quot;CreateItem&quot; : _ValidationGroup; }
            set { _ValidationGroup = value; }
        }


        public TextBox SelectedText
        {
            get { return selectedText; }
        }

        public string Text
        {
            get { return selectedText.Text; }
            set { selectedText.Text = value; }
        }

        public string Value
        {
            get { return selectedValue.Text; }
            set { selectedValue.Text = value; }
        }

        public string PickerCaption
        {
            get { return stdItemNumber.Title; }
            set { stdItemNumber.Title = value; }
        }

        public TextBox PickerText
        {
            get { return selectedText; }
        }

        public TextBox PickerValue
        {
            get { return selectedValue; }
        }

        public Button PickerButton
        {
            get { return stdItemNumber.TriggerButton; }
        }

        public string FilterItemDesc
        {
            get { return txtStdItemDesc.Text; }
        }

        public string FilterStandardTables
        {
            get { return ddlStdItmTbl.Value; }
        }

        public string FilterContainer
        {
            get { return ddlFilterContainer.Value; }
        }

        public bool FilterIgnoreContainer
        {
            get { return chkIgnoreContainer.Checked; }
        }

        public bool FilterIgnoreContainerChecked { get; set; }
        public string PickerParent { get; set; }
        public bool DisplayUnitCost = true;
        public bool DisplayOverheadCost = true;

        public string TextValidationGroup { get; set; }
        public bool TextRequired { get; set; }
        public bool ValueRequired { get; set; }
        public bool SelectRequired { get; set; }
        public bool SkipRequired { get; set; }

        public string sortField = &quot;ItemID&quot;;

        public string ModuleID { get; set; }

        private bool? _DoPB;

        public bool DoPostBackAfterSelect
        {
            get { return null == _DoPB ? true : _DoPB.Value; }
            set { _DoPB = value; }
        }

        public string PostSelectCallBack { get; set; }
        public string OnCancelScript { get; set; }
        public string PreLaunchCall { get; set; }

        public string PickerGridButtonText { get; set; }

        public bool CollectFilterParameters = true;

        #endregion

        #region Public Methods

        public void InitializeGrid()
        {
            EnsureItemPickerParamsAreReady();
            stdItemNumber.ButtonText = PickerGridButtonText;
            stdItemNumber.PostBackAfterSelect = DoPostBackAfterSelect;
            stdItemNumber.BeforePickerLoadScript = this.ClientID + &quot;_CollectOnAjax()&quot;;
        }

        void stdItemNumber_OnGridLoad(PickerGrid grid)
        {
            string json = &quot;{&quot;;
            json += &quot;\&quot;axCompany\&quot; : \&quot;&quot; + Session[Constants.EIS_ADDITIONAL_INFO].ToString2() + &quot;\&quot;,&quot;;
            json += &quot;\&quot;moduleId\&quot; : \&quot;&quot; + ModuleID + &quot;\&quot;,&quot;;
            json += &quot;\&quot;parentInstanceId\&quot; : &quot; + ParentInstanceID + &quot;,&quot;;
            json += &quot;\&quot;hasDWRID\&quot; : \&quot;&quot; + (Request[&quot;DWRID&quot;] != null) + &quot;\&quot;,&quot;;
            json += &quot;\&quot;MinimumQuantity\&quot; : \&quot;&quot; + MinimumQuantity + &quot;\&quot;,&quot;;
            json += &quot;\&quot;MinimumBaseCost\&quot; : \&quot;&quot; + MinimumBaseCost + &quot;\&quot;,&quot;;
            json += &quot;\&quot;IsNonContract\&quot; : \&quot;&quot; + IsNonContract + &quot;\&quot;,&quot;;
            ;
            json += &quot;\&quot;IsContractView\&quot; : \&quot;&quot; + IsContractView + &quot;\&quot;,&quot;;
            json += &quot;\&quot;IsAmountFromCost\&quot; : \&quot;&quot; + IsAmountFromCost + &quot;\&quot;,&quot;;
            json += &quot;\&quot;CurrentModuleID\&quot; : \&quot;&quot; + CurrentModuleID + &quot;\&quot;,&quot;;
            json += &quot;\&quot;ReferenceItemType\&quot; : \&quot;&quot; + ReferenceItemType + &quot;\&quot;,&quot;;
            json += &quot;\&quot;ContainerID\&quot; : \&quot;&quot; + (Request[&quot;ContainerID&quot;] ?? &quot;0&quot;).ToInt32_2() + &quot;\&quot;,&quot;;
            json += &quot;\&quot;GridItems\&quot; : \&quot;&quot; + ((GridItems != null) ? string.Join(&quot;_&quot;, GridItems) : &quot;&quot;) + &quot;\&quot;&quot;;

            json += &quot;}&quot;;
            stdItemNumber.EnableMultiSelect = true;
            stdItemNumber.OptionalParamaters = stdItemNumber.BuildOptionalParameters(json);
        }

        JArray stdItemNumber_OnAllItemSelected(PickerGrid grid, Dictionary&lt;string, object&gt; additionalParams)
        {
            ItemPickerDataController data = new ItemPickerDataController();
            DataSourceRequest request = new DataSourceRequest();
            request.isPaginated = false;
            request.PageSize = additionalParams[&quot;pageSize&quot;].ToInt32_2();
            request.Page = additionalParams[&quot;page&quot;].ToInt32_2();
            request.additionalParameters = JObject.FromObject(additionalParams[&quot;additionalParameters&quot;]);
            request.additionalInfo = additionalParams[&quot;additionalInfo&quot;];
            if (additionalParams[&quot;filter&quot;] != null)
                request.Filter = JsonConvert.DeserializeObject&lt;KendoFilter&gt;(JObject.FromObject(additionalParams[&quot;filter&quot;]).ToString2());
            KendoDataSource jf = data.GetData(request);
            JObject jObject = JObject.FromObject(jf);
            JArray jData = (JArray)jObject[&quot;Data&quot;];
            //bind to the list page..
            stdItemNumber_OnItemSelected(grid, JsonConvert.DeserializeObject&lt;List&lt;Dictionary&lt;string, object&gt;&gt;&gt;(jData.ToString2()));
            return jData;
        }

        void stdItemNumber_OnItemSelected(PickerGrid grid, List&lt;Dictionary&lt;string, object&gt;&gt; selectedRows)
        {
            List&lt;Dictionary&lt;string, string&gt;&gt; sRows = new List&lt;Dictionary&lt;string, string&gt;&gt;();
            foreach (Dictionary&lt;string, object&gt; dic in selectedRows)
            {
                Dictionary&lt;string, string&gt; row1 = new Dictionary&lt;string, string&gt;();
                foreach (KeyValuePair&lt;string, object&gt; item in dic)
                {
                    row1.Add(item.Key, (item.Value ?? &quot;&quot;).ToString());
                }
                sRows.Add(row1);
            }

            _SelectedElem = sRows;
            SelectedItems = new ArrayList(sRows);
            if (EnableMultipleSelect)
            {
                if (null != MultipleSelectedIndexChanged) MultipleSelectedIndexChanged(this, null);
            }
            else
            {
                if (null != SelectedIndexChanged)
                {
                    if (CollectFilterParameters)
                        selectedText.Text = sRows[0][&quot;StandardItemNo&quot;].ToString2();
                    SelectedIndexChanged(this, null);
                }
            }
        }

        public List&lt;Item&gt; GetMultipleDTOFromHTTP()
        {
            List&lt;Item&gt; selectedItems = new List&lt;Item&gt;();
            if (null == _SelectedElem) return null;
            foreach (Dictionary&lt;string, string&gt; row in _SelectedElem)
            {
                Item selItem = GetItemFromSession(row[&quot;ItemID&quot;]);
                if (null == selItem) selItem = FillItemDetails(row);
                selectedItems.Add(selItem);
            }
            return selectedItems;
        }

        public Item GetDTOFromHTTP(ClickEventArgs e)
        {
            if (null == _SelectedElem) return null;
            Item selItem = new Item();
            string itemID = _SelectedElem[0][&quot;ItemID&quot;];
            selItem = GetItemFromSession(itemID);
            if (null == selItem)
            {
                foreach (Dictionary&lt;string, string&gt; row in _SelectedElem)
                {
                    selItem = FillItemDetails(row);
                    break;
                }
            }
            return selItem;
        }

        private Item GetItemFromSession(string itemID)
        {
            Item selItem = null;
            try
            {
                DataTable dt = (DataTable)Session[&quot;LastAutoComplete&quot;];
                if (null == dt) return null;
                DataRow[] dRows = dt.Select(&quot;ItemID=&quot; + itemID);
                if (dRows.Length &lt; 1) return null;
                selItem = new Item();
                ComponentHelper.CopyDataTableToDto(dRows[0], dt.Columns, selItem);
            }
            catch (Exception)
            {
            }
            return selItem;
        }

        private static Item FillItemDetails(Dictionary&lt;string, string&gt; row)
        {
            Item selItem = new Item();
            if (row.ContainsKey(&quot;ItemID&quot;))
                try
                {
                    selItem.ItemID = int.Parse(row[&quot;ItemID&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;AccountingCode&quot;))
                try
                {
                    selItem.AccountingCode = row[&quot;AccountingCode&quot;];
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;ActivityCount&quot;))
                try
                {
                    selItem.ActivityCount = int.Parse(row[&quot;ActivityCount&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;AlternateID&quot;))
                try
                {
                    selItem.AlternateID = int.Parse(row[&quot;AlternateID&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;BaseUnitCost&quot;))
                try
                {
                    selItem.BaseUnitCost = decimal.Parse(row[&quot;BaseUnitCost&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;ContainerID&quot;))
                try
                {
                    selItem.ContainerID = int.Parse(row[&quot;ContainerID&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;ContainerName&quot;))
                try
                {
                    selItem.ContainerName = row[&quot;ContainerName&quot;];
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;CreatedBy&quot;))
                try
                {
                    selItem.CreatedBy = int.Parse(row[&quot;CreatedBy&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;CreatedOn&quot;))
                try
                {
                    selItem.CreatedOn = row[&quot;CreatedOn&quot;].ToMWDateTime();
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;Description&quot;))
                try
                {
                    selItem.Description = row[&quot;Description&quot;];
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;DiffQuantity&quot;))
                try
                {
                    selItem.DiffQuantity = decimal.Parse(row[&quot;DiffQuantity&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;Discount&quot;))
                try
                {
                    selItem.Discount = decimal.Parse(row[&quot;Discount&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;GroupID&quot;))
                try
                {
                    selItem.GroupID = int.Parse(row[&quot;GroupID&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;GroupName&quot;))
                try
                {
                    selItem.GroupName = row[&quot;GroupName&quot;];
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;IsComplete&quot;))
                try
                {
                    selItem.IsComplete = bool.Parse(row[&quot;IsComplete&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;IsMustBid&quot;))
                try
                {
                    selItem.IsMustBid = bool.Parse(row[&quot;IsMustBid&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;IsNonContract&quot;))
                try
                {
                    selItem.IsNonContract = bool.Parse(row[&quot;IsNonContract&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;IsReWork&quot;))
                try
                {
                    selItem.IsReWork = bool.Parse(row[&quot;IsReWork&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;LastUpdatedBy&quot;))
                try
                {
                    selItem.LastUpdatedBy = int.Parse(row[&quot;LastUpdatedBy&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;LastUpdatedOn&quot;))
                try
                {
                    selItem.LastUpdatedOn = row[&quot;LastUpdatedOn&quot;].ToMWDateTime();
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;LineNo&quot;))
                try
                {
                    selItem.LineNo = int.Parse(row[&quot;LineNo&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;Margin&quot;))
                try
                {
                    selItem.Margin = decimal.Parse(row[&quot;Margin&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;ModuleID&quot;))
                try
                {
                    selItem.ModuleID = row[&quot;ModuleID&quot;];
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;OverheadCost&quot;))
                try
                {
                    selItem.OverheadCost = decimal.Parse(row[&quot;OverheadCost&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;ParentID&quot;))
                try
                {
                    selItem.ParentID = int.Parse(row[&quot;ParentID&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;ParentInstanceID&quot;))
                try
                {
                    selItem.ParentInstanceID = int.Parse(row[&quot;ParentInstanceID&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;Path&quot;))
                try
                {
                    selItem.Path = row[&quot;Path&quot;];
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;Quantity&quot;))
                try
                {
                    selItem.Quantity = decimal.Parse(row[&quot;Quantity&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;ReferenceItemID&quot;))
                try
                {
                    selItem.ReferenceItemID = int.Parse(row[&quot;ReferenceItemID&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;ReferenceItemType&quot;))
                try
                {
                    selItem.ReferenceItemType = row[&quot;ReferenceItemType&quot;];
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;StandardItemNo&quot;))
                try
                {
                    selItem.StandardItemNo = row[&quot;StandardItemNo&quot;];
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;Unit&quot;))
                try
                {
                    selItem.Unit = row[&quot;Unit&quot;];
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;UnitCost&quot;))
                try
                {
                    selItem.UnitCost = decimal.Parse(row[&quot;UnitCost&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;UnitID&quot;))
                try
                {
                    selItem.UnitID = int.Parse(row[&quot;UnitID&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;UnitPrice&quot;))
                try
                {
                    selItem.UnitPrice = decimal.Parse(row[&quot;UnitPrice&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;RuleName&quot;))
                try
                {
                    selItem.RuleName = row[&quot;RuleName&quot;];
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;LinkedBudgetItem&quot;))
                try
                {
                    selItem.LinkedBudgetItem = int.Parse(row[&quot;LinkedBudgetItem&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;LinkedBudgetItemName&quot;))
                try
                {
                    selItem.LinkedBudgetItemName = row[&quot;LinkedBudgetItemName&quot;];
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }

            /* Inflation fields */
            if (row.ContainsKey(&quot;AnnualInflationRate&quot;))
                try
                {
                    selItem.AnnualInflationRate = Convert.ToDecimal(row[&quot;AnnualInflationRate&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;Inflation&quot;))
                try
                {
                    selItem.Inflation = Convert.ToDecimal(row[&quot;Inflation&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;InflationEffectiveFrom&quot;))
                try
                {
                    selItem.InflationEffectiveFrom = Convert.ToDateTime(row[&quot;InflationEffectiveFrom&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;InflationRuleID&quot;))
                try
                {
                    selItem.InflationRuleID = Convert.ToInt32(row[&quot;InflationRuleID&quot;]);
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            if (row.ContainsKey(&quot;InflationRuleName&quot;))
                try
                {
                    selItem.InflationRuleName = row[&quot;InflationRuleName&quot;];
                }
                catch (Exception ex)
                {
                    Logger.Log(Resources.MessageResources.Enumerations.LogType.Information, ex.Message, &quot;itempicker&quot;);
                }
            /* End of Inflation fields */

            return selItem;
        }

        #endregion

        protected override void OnLoad(EventArgs e)
        {
            stdItemNumber.EnableMultiSelect = EnableMultipleSelect;

            stdItemNumber.InitializePicker(&quot;/api/ItemPickerData&quot;, GetGridColumns(), &quot;ItemID&quot;);
            EnsureItemPickerParamsAreReady();


            if (!ValidationSkipRequired)
            {
                if (!string.IsNullOrEmpty(ModuleID) &amp;&amp; ModuleID.ToLower() == &quot;library&quot;)
                    TextRequired = true;
                else
                    ValueRequired = true;
            }
            if (MandatoryMarkRequired)
                mandatory.InnerText = &quot;*&quot;;

            TextValidationGroup = ItemValidationGroup;

            if ((TextRequired || ValueRequired) &amp;&amp; SkipRequired != true)
            {
                RequiredFieldValidator rfv = new RequiredFieldValidator();
                rfv.ID = &quot;required&quot;;
                rfv.Style.Add(HtmlTextWriterStyle.Color, &quot;Red&quot;);
                rfv.Text = &quot;*&quot;;
                rfv.Display = ValidatorDisplay.Static;
                rfv.ControlToValidate = ValueRequired ? selectedValue.ID : selectedText.ID;
                rfv.ValidationGroup = TextValidationGroup;
            }

            stdItemNumber.ButtonText = PickerGridButtonText;

            if (this.Page.IsCallback || IsPostBack) return;
            InitUI();
        }

        protected override void OnInit(EventArgs e)
        {
            PickerGridButtonText = &quot;...&quot;;
            InitializeGrid();
            stdItemNumber.Title = &quot;Please select &quot; + LocalizationManager.GetString(&quot;an Item&quot;);
            //stdItemNumber.PickerParent = PickerParent;
            //stdItemNumber.DoDBAutoComplete += new Brix.Platform.BusinessLayer.UserControls.AutoComplete.SearchFromDB(stdItemNumber_DoDBAutoComplete);
            //stdItemNumber.ItemSelected += new Brix.Platform.BusinessLayer.UserControls.AutoComplete.Select(stdItemNumber_ItemSelected);
            //stdItemNumber.InitPickerParams += new Brix.Platform.BusinessLayer.UserControls.AutoComplete.InitParams(stdItemNumber_InitPickerParams);
            //stdItemNumber.EnsureAjaxParams += new AutoComplete.EnsureAjax(stdItemNumber_EnsureAjaxParams);

            stdItemNumber.OnGridLoad += new PickerGrid.GridLoad(stdItemNumber_OnGridLoad);
            stdItemNumber.OnItemSelected += new PickerGrid.SelectedItems(stdItemNumber_OnItemSelected);
            stdItemNumber.OnAllItemSelected += new PickerGrid.AllSelectedItems(stdItemNumber_OnAllItemSelected);
            base.OnInit(e);
        }

        private void InitScripts()
        {
            if (Page.IsCallback) return;
            string script = string.Format(&quot;function {0}_Parent(){{ {1} }}&quot;, this.ClientID, PreLaunchCall);
            this.Page.ClientScript.RegisterStartupScript(this.GetType(), this.ClientID + &quot;LS&quot;, script, true);
        }

        private void EnsureItemPickerParamsAreReady()
        {
            InitScripts();
            //if (null == InitItemPickerParams || _Initialized) return _Initialized;
            //if (InitItemPickerParams()) _Initialized = true;
            //return _Initialized;
        }

        private void InitUI()
        {
            if (ReadOnly)
            {
                selectedText.Attributes.Add(&quot;readonly&quot;, &quot;readonly&quot;);
                hrefFilter.Style.Add(&quot;display&quot;, &quot;none&quot;);
            }
            if (HideAll)
            {
                if (null == selectedText.Style[&quot;display&quot;]) selectedText.Style.Add(&quot;display&quot;, &quot;none&quot;);
                else selectedText.Style[&quot;display&quot;] = &quot;none&quot;;
                if (null == mandatory.Style[&quot;display&quot;]) mandatory.Style.Add(&quot;display&quot;, &quot;none&quot;);
                else mandatory.Style[&quot;display&quot;] = &quot;none&quot;;
            }
            if (TextOnly || HideAll)
            {
                if (null == hrefFilter.Style[&quot;display&quot;]) hrefFilter.Style.Add(&quot;display&quot;, &quot;none&quot;);
                else hrefFilter.Style[&quot;display&quot;] = &quot;none&quot;;
                if (null == stdItemNumber.TriggerButton.Style[&quot;display&quot;])
                    stdItemNumber.TriggerButton.Style.Add(&quot;display&quot;, &quot;none&quot;);
                else stdItemNumber.TriggerButton.Style[&quot;display&quot;] = &quot;none&quot;;
            }
            hrefFilter.Attributes.Add(&quot;onclick&quot;, this.ClientID + &quot;_ShowHideFilter()&quot;);
            if (&quot;CONTMGT&quot; == ModuleID &amp;&amp; ddlFilterContainer.Items.Count == 0)
            {
                DataTable dtContainers = ItemManager.Instance.GetContainer(ModuleID, ParentInstanceID);
                if (dtContainers != null)
                {
                    ddlFilterContainer.DataSource = dtContainers;
                    ddlFilterContainer.DataTextField = &quot;ContainerName&quot;;
                    ddlFilterContainer.DataValueField = &quot;ContainerID&quot;;
                    ddlFilterContainer.DataBind();
                    ddlFilterContainer.SelectedIndex = -1;
                }
                ddlFilterContainer.Items.Insert(0, new ListItem(&quot;Select One&quot;, &quot;-1&quot;));
            }
            else
            {
                trFilterContainer.Style.Clear();
                trFilterContainer.Style.Add(&quot;display&quot;, &quot;none&quot;);
                ddlFilterContainer.SelectedIndex = -1;
            }
            if (&quot;LIBRARY&quot; == ModuleID)
            {
                if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX))
                {
                    if (ConfigurationManager.AppSettings[&quot;CompanyFilter&quot;] != null &amp;&amp;
                        ConfigurationManager.AppSettings[&quot;CompanyFilter&quot;].ToUpper2() == &quot;ON&quot;)
                        _AXCompany = Session[Constants.EIS_ADDITIONAL_INFO].ToString2();
                }
                int totalRows;
                DataSet ds = ItemPickerUtility.FilterForLibrary(_AXCompany, Guid.NewGuid().ToString(), &quot;&quot;,
                    ddlStdItmTbl.SelectedIndex &gt; -1 ? ddlStdItmTbl.Value : DefaultTableID, &quot;1&quot;,
                    stdItemNumber.PageSize.ToString(), out totalRows, null, null);
                if (null != ds.Tables[0].Rows &amp;&amp; null != ds.Tables[0].Rows)
                {
                    ddlStdItmTbl.DataSource = ds.Tables[0];
                    ddlStdItmTbl.DataTextField = &quot;Name&quot;;
                    ddlStdItmTbl.DataValueField = &quot;ID&quot;;
                    ddlStdItmTbl.DataBind();
                    ddlStdItmTbl.SelectedIndex = -1;
                }

                if (!string.IsNullOrEmpty(DefaultTableID))
                    ddlStdItmTbl.Value = DefaultTableID;
                else
                    ddlStdItmTbl.SelectedIndex = -1;
            }
            else
                ddlStdItmTbl.Visible = false;

            List&lt;string&gt; Checkcomponents =
                ModuleManagementBL.ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);
            if (Checkcomponents.Contains(&quot;ONGIgnoreContainersCheckbox&quot;))
                chkIgnoreContainer.Visible = DisplayIgnoreContainer;
            else
            {
                chkIgnoreContainer.Visible = false;
                tdSIT2.InnerText = &quot;Select a &quot; + LocalizationManager.GetString(&quot;StandardItemNo&quot;) + &quot; Table&quot;;
            }
            trStandardTables.Visible = &quot;LIBRARY&quot; == ModuleID;

            chkIgnoreContainer.Checked = FilterIgnoreContainerChecked;
            //Ignore Containers of Standard Items check box should be checked default
        }

        public List&lt;PickerColumnDetails&gt; GetGridColumns()
        {
            List&lt;string&gt; ModuleComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);

            List&lt;PickerColumnDetails&gt; gridColumns = new List&lt;PickerColumnDetails&gt;();

            this.Currency = Aurigo.AMP3.Resources.TerminologyResources.LocalizationManager.GetModuleCurrency(&quot;LIBRARY&quot;,
                null, Session[Constants.EIS_ADDITIONAL_INFO].ToString());
            List&lt;PickerColumnDetails&gt; lstDefaultToShow = new List&lt;PickerColumnDetails&gt;(new PickerColumnDetails[]
            {
                new PickerColumnDetails { ColumnName = &quot;ItemID&quot;, Hidden = true, Type = &quot;number&quot; },
                new PickerColumnDetails
                {
                    ColumnName = &quot;LineNo&quot;,
                    Caption =
                        Aurigo.AMP3.Resources.TerminologyResources.LocalizationManager.GetString(
                            Aurigo.AMP3.Resources.TerminologyResources.KeyConstants.LineNo),
                    Type = &quot;number&quot;,
                    Width = 80
                },
                new PickerColumnDetails
                {
                    ColumnName = &quot;StandardItemNo&quot;,
                    Caption =
                        Aurigo.AMP3.Resources.TerminologyResources.LocalizationManager.GetString(
                            Aurigo.AMP3.Resources.TerminologyResources.KeyConstants.LOC_PAY_ITEM_NO),
                    Type = &quot;string&quot;
                },
                new PickerColumnDetails
                {
                    ColumnName = &quot;ContainerName&quot;,
                    Caption = Aurigo.AMP3.Resources.TerminologyResources.LocalizationManager.GetString(&quot;Container&quot;),
                    Type = &quot;string&quot;,
                    Width = 80
                },
                new PickerColumnDetails { ColumnName = &quot;Description&quot;, Type = &quot;string&quot;, Width = 140 },
                new PickerColumnDetails
                {
                    ColumnName = &quot;AccountingCode&quot;,
                    Caption = &quot;Accounting Code&quot;,
                    Type = &quot;string&quot;,
                    Width = 120
                },
                new PickerColumnDetails
                {
                    ColumnName = &quot;Quantity&quot;,
                    Format =
                        (ModuleComponents.Contains(&quot;UnitQuantityModel&quot;)
                            ? AMP3ApplicationSettings.Instance.FORMAT_AMOUNT
                            : AMP3ApplicationSettings.Instance.FORMAT_QUANTITY),
                    Type = &quot;number&quot;,
                    Caption = (ModuleComponents.Contains(&quot;UnitQuantityModel&quot;) ? &quot;Amount&quot; : &quot;Quantity&quot;),
                    Width = 70
                }
            });

            if (!ModuleComponents.Contains(&quot;UnitQuantityModel&quot;))
            {
                lstDefaultToShow.Add(new PickerColumnDetails
                {
                    ColumnName = &quot;Unit&quot;,
                    Caption = Aurigo.AMP3.Resources.TerminologyResources.LocalizationManager.GetString(&quot;Unit&quot;),
                    Type = &quot;string&quot;,
                    Width = 70
                });
                //lstDefaultToShow.Add(new PickerColumnDetails
                //{
                //    ColumnName = &quot;Amount&quot;,
                //    Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT,
                //    Caption = string.IsNullOrEmpty(this.Currency) ?
                //              Aurigo.AMP3.Resources.TerminologyResources.LocalizationManager.GetString(Aurigo.AMP3.Resources.TerminologyResources.KeyConstants.LOC_AMOUNT) :
                //              &quot;Amount in &quot; + this.Currency,
                //    Type = &quot;number&quot;,
                //    Width = 90
                //});

                lstDefaultToShow.Add(new PickerColumnDetails
                {
                    ColumnName = &quot;BaseUnitCost&quot;,
                    Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE,
                    Caption = string.IsNullOrEmpty(this.Currency)
                        ? Aurigo.AMP3.Resources.TerminologyResources.LocalizationManager.GetString(
                            Aurigo.AMP3.Resources.TerminologyResources.KeyConstants.LOC_BASE_UNIT_COST)
                        : &quot;Base Unit Cost In &quot; + this.Currency,
                    Type = &quot;number&quot;,
                    Width = 90
                });

                if (IsContractView.HasValue &amp;&amp; IsContractView.Value)
                    lstDefaultToShow.Add(
                        new PickerColumnDetails
                        {
                            ColumnName = &quot;UnitPrice&quot;,
                            Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE,
                            Caption = string.IsNullOrEmpty(this.Currency)
                                ? Aurigo.AMP3.Resources.TerminologyResources.LocalizationManager.GetString(
                                    Aurigo.AMP3.Resources.TerminologyResources.KeyConstants.LOC_UNIT_PRICE)
                                : &quot;Unit Price In &quot; + this.Currency
                            ,
                            Type = &quot;number&quot;,
                            Width = 90
                        });
                lstDefaultToShow.Add(new PickerColumnDetails
                {
                    ColumnName = &quot;Amount&quot;,
                    Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT,
                    Caption = string.IsNullOrEmpty(this.Currency)
                        ? Aurigo.AMP3.Resources.TerminologyResources.LocalizationManager.GetString(
                            Aurigo.AMP3.Resources.TerminologyResources.KeyConstants.LOC_AMOUNT)
                        : &quot;Amount in &quot; + this.Currency,
                    Type = &quot;number&quot;,
                    Width = 90
                });
            }

            lstDefaultToShow.Insert(0,
                new PickerColumnDetails { ColumnName = &quot;Multi&quot;, Type = &quot;bool&quot;, Hidden = !EnableMultipleSelect });
            //if (dt.Columns.Contains(&quot;ContainerName&quot;)) 
            //lstDefaultToShow.Add(new PickerColumnDetails { ColumnName = &quot;ContainerName&quot;, Caption = Aurigo.AMP3.Resources.TerminologyResources.LocalizationManager.GetString(&quot;Container&quot;), Type = &quot;string&quot; });           
            if (DisplayUnitCost)
            {
                lstDefaultToShow.Add(new PickerColumnDetails
                {
                    ColumnName = &quot;UnitCost&quot;,
                    Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE,
                    Caption = string.IsNullOrEmpty(this.Currency)
                        ? Aurigo.AMP3.Resources.TerminologyResources.LocalizationManager.GetString(
                            Aurigo.AMP3.Resources.TerminologyResources.KeyConstants.LOC_UNIT_COST)
                        : &quot;Unit Cost In &quot; + this.Currency,
                    Type = &quot;number&quot;,
                    Width = 90
                });
            }

            if (DisplayOverheadCost)
            {
                lstDefaultToShow.Add(new PickerColumnDetails
                {
                    ColumnName = &quot;OverheadCost&quot;,
                    Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE,
                    Caption = &quot;Overhead Cost&quot;,
                    Type = &quot;number&quot;
                });
            }

            foreach (PickerColumnDetails sCol in lstDefaultToShow)
            {
                //if (!dt.Columns.Contains(sCol.ColumnName)) continue;
                if (sCol.ColumnName == &quot;UnitCost&quot; &amp;&amp; CurrentModuleID != null &amp;&amp; &quot;WORKORD&quot; != CurrentModuleID) continue;
                if (!(ModuleComponents.Contains(&quot;ItemMargin&quot;) &amp;&amp; ModuleComponents.Contains(&quot;ItemDiscount&quot;)) &amp;&amp;
                    sCol.ColumnName == &quot;BaseUnitCost&quot;)
                    sCol.Caption = LocalizationManager.GetString(&quot;UnitPrice&quot;);
                gridColumns.Add(sCol);
            }
            if (null != CustomizeGridColumns)
                CustomizeGridColumns(ref gridColumns);

            return gridColumns;
        }
    }

    public class ItemPickerData
    {
        public string axCompany;

        public string moduleId;

        public int parentInstanceId;

        public bool hasDWRID;

        public string MinimumQuantity;

        public string MinimumBaseCost;

        public bool? IsNonContract;

        public bool? IsContractView;

        public bool? IsAmountFromCost;

        public string CurrentModuleID;

        public string ReferenceItemType;

        public int? ContainerID;

        public string GridItems;
    }

    [DataContract]
    public class ItemPickerParams
    {
        [DataMember]
        public string desc;
        [DataMember]
        public string stdItemNo;
        [DataMember]
        public string stdItemTable;
        [DataMember]
        public bool ignoreContainer;
        [DataMember]
        public string filterContainer;
    }

    [Authorize]
    public class ItemPickerDataController : ApiController
    {
        [HttpGet]
        public HttpResponseMessage Get(HttpRequestMessage requestMessage)
        {
            DataSourceRequest request = JsonConvert.DeserializeObject&lt;DataSourceRequest&gt;(
                requestMessage.RequestUri.ParseQueryString().GetKey(0)
                );

            KendoDataSource jf = GetData(request);

            JObject jObject = JObject.FromObject(jf);
            var dffd = Request.CreateResponse&lt;JObject&gt;(HttpStatusCode.Created, jObject);
            return dffd;
        }
        [HttpPost]
        public HttpResponseMessage Post(HttpRequestMessage requestMessage)
        {
            string value = requestMessage.Content.ReadAsStringAsync().Result;
            DataSourceRequest request = JsonConvert.DeserializeObject&lt;DataSourceRequest&gt;(
                value
                );
            KendoDataSource jf = GetData(request);
            JObject jObject = JObject.FromObject(jf);
            var dffd = Request.CreateResponse&lt;JObject&gt;(HttpStatusCode.Created, jObject);
            return dffd;
        }
        public KendoDataSource GetData(DataSourceRequest request)
        {
            ItemPickerData parameters =
                JsonConvert.DeserializeObject&lt;ItemPickerData&gt;(request.additionalParameters.ToString());
            ItemPickerParams pickerfilter =
                JsonConvert.DeserializeObject&lt;ItemPickerParams&gt;(request.additionalInfo.ToString());

            string filter = null;
            string axCompany = null;
            string moduleId = string.Empty;
            if (parameters != null)
            {
                moduleId = parameters.moduleId;
            }
            if (pickerfilter != null)
            {
                filter = pickerfilter.desc;
            }
            string getPage = request.Page.ToString();
            string pageSize = request.PageSize.ToString();
            bool isPaginated = request.isPaginated;

            IEnumerable&lt;KendoSort&gt; qsort = request.Sort;

            string sort = null;
            if (request.Sort != null &amp;&amp; qsort.Count() &gt; 0)
                sort = request.Sort.ToQuery();
            string filterQ = null;
            if (request.Filter != null)
                filterQ = request.Filter.ToQuery();

            if (!string.IsNullOrEmpty(filterQ) &amp;&amp; filterQ.Contains(&quot;[LineNo]&quot;))
                filterQ = filterQ.Replace(&quot;[LineNo]&quot;, &quot;CONVERT(DECIMAL(18, 4), [LineNo])&quot;);

            int totalRows = 0;

            DataTable dt = null;
            if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX))
            {
                if (ConfigurationManager.AppSettings[&quot;CompanyFilter&quot;] != null &amp;&amp;
                    ConfigurationManager.AppSettings[&quot;CompanyFilter&quot;].ToUpper2() == &quot;ON&quot;)
                    axCompany = parameters.axCompany;
            }
            if (&quot;CHNGORD&quot; == moduleId)
            {
                DataSet ds = ItemPickerUtility.FilterForChangeOrder(axCompany, filter,
                    null == pickerfilter ? &quot;&quot; : pickerfilter.stdItemNo, getPage, pageSize, out totalRows, parameters,
                    sort, filterQ);
                dt = ItemPickerUtility.GetContainerName(ds.Tables[1], ds.Tables[0]);
                ItemPickerUtility.ChangeDatatable(dt, moduleId, parameters.hasDWRID);
            }
            else if (&quot;BDGTREV&quot; == moduleId)
            {
                DataSet ds = ItemPickerUtility.FilterForBudgetRevision(axCompany, filter,
                    null == pickerfilter ? &quot;&quot; : pickerfilter.stdItemNo, getPage, pageSize, out totalRows, parameters,
                    sort, filterQ);
                dt = ItemPickerUtility.GetContainerName(ds.Tables[1], ds.Tables[0]);
                ItemPickerUtility.ChangeDatatable(dt, moduleId, parameters.hasDWRID);
            }

            else if (&quot;LIBRARY&quot; == moduleId)
            {
                DataSet ds = ItemPickerUtility.FilterForLibrary(axCompany, filter,
                    null == pickerfilter ? &quot;&quot; : pickerfilter.stdItemNo, pickerfilter.stdItemTable, getPage, pageSize,
                    out totalRows, sort, filterQ);
                dt = ItemPickerUtility.GetContainerName(ds.Tables[1], ds.Tables[2]);
                ItemPickerUtility.ChangeDatatable(dt, moduleId, parameters.hasDWRID);
            }
            else if (&quot;ITMPOST&quot; == moduleId)
            {
                parameters.GridItems = &quot;&quot;;
                DataSet ds1 = ItemPickerUtility.FilterGeneral(axCompany, filter,
                   null == pickerfilter ? &quot;&quot; : pickerfilter.stdItemNo,
                   null == parameters ? &quot;&quot; : pickerfilter.filterContainer, getPage, isPaginated, pageSize, out totalRows, parameters,
                   sort, filterQ);
                dt = ItemPickerUtility.GetContainerName(ds1.Tables[1], ds1.Tables[0]);
                ItemPickerUtility.ChangeDatatable(dt, moduleId, parameters.hasDWRID);
            }
            else
            {
                DataSet ds1 = ItemPickerUtility.FilterGeneral(axCompany, filter,
                    null == pickerfilter ? &quot;&quot; : pickerfilter.stdItemNo,
                    null == parameters ? &quot;&quot; : pickerfilter.filterContainer, getPage, isPaginated, pageSize, out totalRows, parameters,
                    sort, filterQ);
                dt = ItemPickerUtility.GetContainerName(ds1.Tables[1], ds1.Tables[0]);
                ItemPickerUtility.ChangeDatatable(dt, moduleId, parameters.hasDWRID);
            }
            return new KendoDataSource
            {
                Data = dt.GetKendoDataSource(),
                Total = totalRows
            };
        }
    }

    public static class ItemPickerUtility
    {
        public static string GetFilterText(string stdDesc, string stdItemNo)
        {
            string filter = string.Empty;
            using (StringWriter sWr = new StringWriter(CultureInfo.CurrentCulture))
            {
                using (XmlTextWriter xWr = new XmlTextWriter(sWr))
                {
                    xWr.WriteStartElement(&quot;XMLRoot&quot;);
                    if (!string.IsNullOrEmpty(stdItemNo))
                        xWr.WriteElementString(&quot;StandardItemNo&quot;, stdItemNo);
                    xWr.WriteElementString(&quot;Description&quot;, stdDesc);
                    xWr.WriteEndElement();
                    xWr.Flush();
                }
                filter = (!string.IsNullOrEmpty(sWr.ToString2())) ? sWr.ToString2() : null;
            }
            return filter;
        }

        public static DataTable GetContainerName(DataTable items, DataTable containerDetails)
        {
            int index1, index2;

            if (items.Columns.Contains(&quot;Container&quot;)) items.Columns[&quot;Container&quot;].ColumnName = &quot;ContainerName&quot;;

            string container = &quot;ContainerName&quot;;


            foreach (DataRow dr in items.Select())
            {
                if (!string.IsNullOrEmpty(dr[&quot;ContainerID&quot;].ToString2()) &amp;&amp;
                    int.Parse(dr[&quot;ContainerID&quot;].ToString2(), CultureInfo.CurrentCulture) != 0)
                {
                    if (containerDetails.Rows.Count &gt; 0)
                    {
                        index1 = GetIndex(dr[&quot;ContainerID&quot;].ToString2(), containerDetails);
                        if (containerDetails.Rows.Count &gt; index1)
                        {
                            while (!string.IsNullOrEmpty(containerDetails.Rows[index1][&quot;ParentContainerID&quot;].ToString2())
                                   &amp;&amp;
                                   int.Parse(containerDetails.Rows[index1][&quot;ParentContainerID&quot;].ToString2(),
                                       CultureInfo.CurrentCulture) != 0)
                            {
                                index2 = GetIndex(containerDetails.Rows[index1][&quot;ParentContainerID&quot;].ToString2(),
                                    containerDetails);
                                dr[container] = containerDetails.Rows[index2][&quot;ContainerName&quot;] + @&quot; / &quot; + dr[container];
                                index1 = index2;
                            }
                        }
                        else
                            dr[container] = &quot;Root&quot;;
                    }
                }
                else
                    dr[container] = &quot;Root&quot;;
            }
            return items;
        }

        public static int GetIndex(string value, DataTable dt)
        {
            int index = 0;
            foreach (DataRow dr in dt.Select())
            {
                if (dr[&quot;ContainerID&quot;].ToString2() == value)
                {
                    break;
                }
                index++;
            }
            return index;
        }

        public static void ChangeDatatable(DataTable dt, String ModuleID, bool hasDWRID)
        {
            if (ModuleID == &quot;ITMPOST&quot;)
            {
                if (!ShowPrices(hasDWRID))
                {
                    if (dt.Columns.Contains(&quot;UnitCost&quot;)) dt.Columns.Remove(&quot;UnitCost&quot;);
                    if (dt.Columns.Contains(&quot;BaseUnitCost&quot;)) dt.Columns.Remove(&quot;BaseUnitCost&quot;);
                    if (dt.Columns.Contains(&quot;UnitPrice&quot;)) dt.Columns.Remove(&quot;UnitPrice&quot;);
                    if (dt.Columns.Contains(&quot;Amount&quot;)) dt.Columns.Remove(&quot;Amount&quot;);
                    dt.AcceptChanges();
                }
            }
            else if (ModuleID == &quot;LIBRARY&quot;)
            {
                if (dt.Columns.Contains(&quot;UnitPrice&quot;)) dt.Columns.Remove(&quot;UnitPrice&quot;);
                if (dt.Columns.Contains(&quot;Quantity&quot;)) dt.Columns.Remove(&quot;Quantity&quot;);
                if (dt.Columns.Contains(&quot;Amount&quot;)) dt.Columns.Remove(&quot;Amount&quot;);
                dt.AcceptChanges();
            }
        }

        public static bool ShowPrices(bool hasDWRID)
        {
            List&lt;string&gt; permissions = null;
            if (hasDWRID)
            {
                permissions = ModuleManager.Instance.GetPermissionByUserOrRole(Constants.MODID_CONTDWR,
                    UserDetail.GetCurrentUserDetail().UID,
                    UserDetail.GetCurrentUserDetail().RID, 0);
            }

            return (permissions == null) ? true : ((permissions.Contains(&quot;ShowPrices&quot;)) ? true : false);
        }

        public static DataSet FilterGeneral(string AXCompany, string stdItemDesc, string stdItemNo, string containerId,
            string getPage, bool isPaginated, string pageSize,
            out int totalRows, ItemPickerData pParams, string sort, string filterQ)
        {
            DataSet ds;
            string filter = null;
            int pagecount;
            if (!string.IsNullOrEmpty(pParams.MinimumQuantity) || !string.IsNullOrEmpty(pParams.MinimumBaseCost) ||
                pParams.IsNonContract.HasValue ||
                !string.IsNullOrEmpty(stdItemNo) || !string.IsNullOrEmpty(stdItemDesc) ||
                !string.IsNullOrEmpty(containerId) || !string.IsNullOrEmpty(pParams.GridItems))
            {
                using (StringWriter sWr = new StringWriter(CultureInfo.CurrentCulture))
                {
                    using (XmlTextWriter xWr = new XmlTextWriter(sWr))
                    {
                        xWr.WriteStartElement(&quot;XMLRoot&quot;);
                        if (!string.IsNullOrEmpty(pParams.MinimumQuantity))
                            xWr.WriteElementString(&quot;MinimumQuantity&quot;, pParams.MinimumQuantity);
                        if (!string.IsNullOrEmpty(pParams.MinimumBaseCost))
                            xWr.WriteElementString(&quot;MinimumBaseCost&quot;, pParams.MinimumBaseCost);
                        if (pParams.IsNonContract.HasValue)
                            xWr.WriteElementString(&quot;IsNonContract&quot;, pParams.IsNonContract.ToString2());
                        if (!string.IsNullOrEmpty(stdItemNo))
                            xWr.WriteElementString(&quot;StandardItemNo&quot;, stdItemNo);
                        if (!string.IsNullOrEmpty(stdItemDesc))
                            xWr.WriteElementString(&quot;Description&quot;, stdItemDesc);
                        if (!string.IsNullOrEmpty(containerId))
                            xWr.WriteElementString(&quot;ContainerID&quot;, containerId);
                        if (pParams.IsContractView.HasValue)
                            xWr.WriteElementString(&quot;IsContractView&quot;, pParams.IsContractView.ToString2());
                        if (pParams.IsAmountFromCost.HasValue)
                            xWr.WriteElementString(&quot;IsAmountFromCost&quot;, (pParams.IsAmountFromCost.ToString2()));
                        if (!string.IsNullOrEmpty(pParams.GridItems))
                            xWr.WriteElementString(&quot;RemoveItemIDs&quot;, (pParams.GridItems.Replace(&quot;_&quot;, &quot;,&quot;).ToString2()));

                        xWr.WriteEndElement();
                        xWr.Flush();
                    }
                    filter = (!string.IsNullOrEmpty(sWr.ToString2())) ? sWr.ToString2() : null;
                }
            }

            int PageSize = string.IsNullOrEmpty(pageSize) ? 1 : int.Parse(pageSize);
            int pageno = string.IsNullOrEmpty(getPage) ? 1 : int.Parse(getPage);
            ds = ItemManager.Instance.GetItemPickerData(pParams.moduleId, pParams.parentInstanceId, null, null, filter,
                sort, pParams.CurrentModuleID, null, isPaginated, PageSize, ref pageno, out pagecount, AXCompany, out totalRows,
                filterQ);
            return ds;
        }

        public static DataSet FilterForLibrary(string AXCompany, string stdItemDesc, string stdItemNo, string stdTableId,
            string getPage, string pageSize, out int totalRows, string sort, string filterQuery)
        {
            List&lt;string&gt; ModuleComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);
            DataSet ds;
            string filter = null;
            int pagecount;
            filter = GetFilterText(stdItemDesc, stdItemNo);
            int stdTblId = (!string.IsNullOrEmpty(stdTableId)) ? int.Parse(stdTableId, CultureInfo.CurrentCulture) : 0;
            int pageno = string.IsNullOrEmpty(getPage) ? 1 : int.Parse(getPage);
            int PageSize = string.IsNullOrEmpty(pageSize) ? 1 : int.Parse(pageSize);

            ds = ItemManager.Instance.GetItemPickerData(PageSize, sort, stdTblId, filter, ref pageno, out pagecount,
                AXCompany, filterQuery, out totalRows);
            if (!ModuleComponents.Contains(&quot;ItemUnitCost&quot;))
                if (ds.Tables[1].Columns.Contains(&quot;UnitCost&quot;)) ds.Tables[1].Columns.Remove(&quot;UnitCost&quot;);
            if (!ModuleComponents.Contains(&quot;ItemOverheadCost&quot;))
                if (ds.Tables[1].Columns.Contains(&quot;OverheadCost&quot;)) ds.Tables[1].Columns.Remove(&quot;OverheadCost&quot;);
            return ds;
        }

        public static DataSet FilterForChangeOrder(string AXCompany, string stdItemDesc, string stdItemNo,
            string getPage, string pageSize,
            out int totalRows, ItemPickerData pParams, string sort, string filter)
        {
            List&lt;string&gt; ModuleComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);
            DataSet ds;
            int pagecount;
            StringWriter sWr = new StringWriter(CultureInfo.CurrentCulture);
            XmlTextWriter xWr = new XmlTextWriter(sWr);

            xWr.WriteStartElement(&quot;XMLRoot&quot;);
            xWr.WriteElementString(&quot;IsNonContract&quot;, (&quot;C&quot; == pParams.ReferenceItemType).ToString2());
            if (pParams.ReferenceItemType != &quot;C&quot;)
            {
                if (!string.IsNullOrEmpty(stdItemDesc))
                    xWr.WriteElementString(&quot;Description&quot;, stdItemDesc);
                if (!string.IsNullOrEmpty(stdItemNo))
                    xWr.WriteElementString(&quot;StandardItemNo&quot;, stdItemNo);
                if (pParams.IsContractView.HasValue)
                    xWr.WriteElementString(&quot;IsContractView&quot;, pParams.IsContractView.ToString2());
            }
            if (pParams.ReferenceItemType == &quot;M&quot; &amp;&amp; pParams.ContainerID != null &amp;&amp; pParams.ContainerID &gt; 0)
                xWr.WriteElementString(&quot;ContainerID&quot;, pParams.ContainerID.ToString());
            xWr.WriteEndElement();
            xWr.Flush();

            int pageno = string.IsNullOrEmpty(getPage) ? 1 : int.Parse(getPage);
            int PageSize = string.IsNullOrEmpty(pageSize) ? 1 : int.Parse(pageSize);
            ds = ItemManager.Instance.GetItemPickerData(pParams.moduleId, pParams.parentInstanceId, null, true,
                sWr.ToString2(), sort, null, null, true, PageSize, ref pageno, out pagecount, AXCompany, out totalRows,
                filter);
            if (pParams.IsContractView.HasValue &amp;&amp; (bool)pParams.IsContractView)
            {
                if (ds.Tables[1].Columns.Contains(&quot;UnitCost&quot;)) ds.Tables[1].Columns.Remove(&quot;UnitCost&quot;);
                if (ds.Tables[1].Columns.Contains(&quot;BaseUnitCost&quot;)) ds.Tables[1].Columns.Remove(&quot;BaseUnitCost&quot;);
            }
            if (!ModuleComponents.Contains(&quot;ItemUnitCost&quot;))
                if (ds.Tables[1].Columns.Contains(&quot;UnitCost&quot;)) ds.Tables[1].Columns.Remove(&quot;UnitCost&quot;);
            if (!ModuleComponents.Contains(&quot;ItemOverheadCost&quot;))
                if (ds.Tables[1].Columns.Contains(&quot;OverheadCost&quot;)) ds.Tables[1].Columns.Remove(&quot;OverheadCost&quot;);
            return ds;
        }

        public static DataSet FilterForBudgetRevision(string AXCompany, string stdItemDesc, string stdItemNo,
            string getPage, string pageSize,
            out int totalRows, ItemPickerData pParams, string sort, string filter)
        {
            List&lt;string&gt; ModuleComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);
            DataSet ds;
            int pagecount;
            StringWriter sWr = new StringWriter(CultureInfo.CurrentCulture);
            XmlTextWriter xWr = new XmlTextWriter(sWr);

            xWr.WriteStartElement(&quot;XMLRoot&quot;);
            xWr.WriteElementString(&quot;IsNonContract&quot;, (&quot;C&quot; == pParams.ReferenceItemType).ToString2());
            if (pParams.ReferenceItemType != &quot;C&quot;)
            {
                if (!string.IsNullOrEmpty(stdItemDesc))
                    xWr.WriteElementString(&quot;Description&quot;, stdItemDesc);
                //if (!string.IsNullOrEmpty(stdItemNo))
                //xWr.WriteElementString(&quot;StandardItemNo&quot;, stdItemNo);
                if (pParams.IsContractView.HasValue)
                    xWr.WriteElementString(&quot;IsContractView&quot;, pParams.IsContractView.ToString2());
            }
            if (pParams.ReferenceItemType == &quot;M&quot; &amp;&amp; pParams.ContainerID != null &amp;&amp; pParams.ContainerID &gt; 0)
                xWr.WriteElementString(&quot;ContainerID&quot;, pParams.ContainerID.ToString());
            xWr.WriteEndElement();
            xWr.Flush();

            int pageno = string.IsNullOrEmpty(getPage) ? 1 : int.Parse(getPage);
            int PageSize = string.IsNullOrEmpty(pageSize) ? 1 : int.Parse(pageSize);
            ds = ItemManager.Instance.GetItemPickerData(pParams.moduleId, pParams.parentInstanceId, null, true,
                sWr.ToString2(), sort, null, null, true, PageSize, ref pageno, out pagecount, AXCompany, out totalRows,
                filter);
            if (pParams.IsContractView.HasValue &amp;&amp; (bool)pParams.IsContractView)
            {
                if (ds.Tables[1].Columns.Contains(&quot;UnitCost&quot;)) ds.Tables[1].Columns.Remove(&quot;UnitCost&quot;);
                if (ds.Tables[1].Columns.Contains(&quot;BaseUnitCost&quot;)) ds.Tables[1].Columns.Remove(&quot;BaseUnitCost&quot;);
            }
            if (!ModuleComponents.Contains(&quot;ItemUnitCost&quot;))
                if (ds.Tables[1].Columns.Contains(&quot;UnitCost&quot;)) ds.Tables[1].Columns.Remove(&quot;UnitCost&quot;);
            if (!ModuleComponents.Contains(&quot;ItemOverheadCost&quot;))
                if (ds.Tables[1].Columns.Contains(&quot;OverheadCost&quot;)) ds.Tables[1].Columns.Remove(&quot;OverheadCost&quot;);
            return ds;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[38,9,38,32,1],[44,34,44,38,0],[44,39,44,43,0],[53,44,53,48,1],[53,49,53,53,1],[54,40,54,44,1],[54,45,54,49,1],[55,42,55,46,0],[55,47,55,51,0],[56,46,56,50,1],[56,51,56,55,1],[57,34,57,38,1],[57,39,57,43,1],[58,41,58,45,1],[58,46,58,50,0],[59,41,59,45,1],[59,46,59,50,0],[60,41,60,45,1],[60,46,60,50,0],[61,38,61,42,1],[61,43,61,47,0],[62,35,62,39,0],[62,40,62,44,0],[63,41,63,45,1],[63,46,63,50,0],[64,39,64,43,1],[64,44,64,48,1],[65,32,65,36,1],[65,37,65,41,1],[66,32,66,36,1],[66,37,66,41,1],[67,31,67,35,1],[67,36,67,40,1],[68,39,68,43,1],[68,44,68,48,1],[69,42,69,46,0],[69,47,69,51,1],[70,43,70,47,1],[70,48,70,52,1],[71,46,71,50,1],[71,51,71,55,1],[72,45,72,49,1],[72,50,72,54,1],[74,38,74,42,1],[74,43,74,47,1],[77,17,77,18,1],[77,19,77,99,1],[77,100,77,101,1],[78,17,78,18,1],[78,19,78,44,1],[78,45,78,46,1],[84,17,84,18,1],[84,19,84,39,1],[84,40,84,41,1],[89,17,89,18,1],[89,19,89,44,1],[89,45,89,46,1],[90,17,90,18,1],[90,19,90,45,1],[90,46,90,47,1],[95,17,95,18,0],[95,19,95,45,0],[95,46,95,47,0],[96,17,96,18,0],[96,19,96,46,0],[96,47,96,48,0],[101,17,101,18,0],[101,19,101,46,0],[101,47,101,48,0],[102,17,102,18,0],[102,19,102,47,0],[102,48,102,49,0],[107,17,107,18,1],[107,19,107,39,1],[107,40,107,41,1],[112,17,112,18,1],[112,19,112,40,1],[112,41,112,42,1],[117,17,117,18,1],[117,19,117,54,1],[117,55,117,56,1],[122,17,122,18,0],[122,19,122,46,0],[122,47,122,48,0],[127,17,127,18,0],[127,19,127,45,0],[127,46,127,47,0],[132,17,132,18,0],[132,19,132,51,0],[132,52,132,53,0],[137,17,137,18,1],[137,19,137,53,1],[137,54,137,55,1],[140,52,140,56,1],[140,57,140,61,1],[141,38,141,42,0],[141,43,141,47,0],[142,9,142,44,1],[143,9,143,48,1],[145,45,145,49,1],[145,50,145,54,1],[146,36,146,40,1],[146,41,146,45,1],[147,37,147,41,1],[147,42,147,46,1],[148,38,148,42,0],[148,43,148,47,0],[149,36,149,40,1],[149,41,149,45,0],[151,9,151,44,1],[153,34,153,38,1],[153,39,153,43,1],[159,17,159,18,1],[159,19,159,61,1],[159,62,159,63,1],[160,17,160,18,1],[160,19,160,33,1],[160,34,160,35,1],[163,44,163,48,0],[163,49,163,53,0],[164,40,164,44,0],[164,45,164,49,0],[165,39,165,43,1],[165,44,165,48,0],[167,46,167,50,1],[167,51,167,55,1],[169,9,169,52,1],[176,9,176,10,1],[177,13,177,46,1],[178,13,178,61,1],[179,13,179,71,1],[180,13,180,87,1],[181,9,181,10,1],[184,9,184,10,1],[185,13,185,31,1],[186,13,186,103,1],[187,13,187,60,1],[188,13,188,72,1],[189,13,189,78,1],[190,13,190,74,1],[191,13,191,74,1],[192,13,192,70,1],[193,13,193,14,1],[194,13,194,72,1],[195,13,195,76,1],[196,13,196,74,1],[197,13,197,78,1],[198,13,198,98,1],[199,13,199,108,1],[201,13,201,25,1],[202,13,202,52,1],[203,13,203,92,1],[204,9,204,10,1],[207,9,207,10,0],[208,13,208,76,0],[209,13,209,65,0],[210,13,210,41,0],[211,13,211,73,0],[212,13,212,65,0],[213,13,213,105,0],[214,13,214,73,0],[215,13,215,52,0],[216,17,216,137,0],[217,13,217,56,0],[218,13,218,54,0],[219,13,219,52,0],[221,13,221,132,0],[222,13,222,26,0],[223,9,223,10,0],[226,9,226,10,1],[227,13,227,93,1],[228,13,228,20,1],[228,22,228,52,1],[228,53,228,55,1],[228,56,228,68,1],[229,13,229,14,1],[230,17,230,84,1],[231,17,231,24,1],[231,26,231,59,1],[231,60,231,62,1],[231,63,231,66,1],[232,17,232,18,1],[233,21,233,71,1],[234,17,234,18,1],[235,17,235,33,1],[236,13,236,14,1],[238,13,238,35,1],[239,13,239,50,1],[240,13,240,38,1],[241,13,241,14,1],[242,17,242,58,1],[242,59,242,100,1],[243,13,243,14,1],[245,13,245,14,1],[246,17,246,50,1],[247,17,247,18,1],[248,21,248,49,1],[249,25,249,84,1],[250,21,250,54,1],[251,17,251,18,1],[252,13,252,14,1],[253,9,253,10,1],[256,9,256,10,1],[257,13,257,57,1],[258,13,258,39,1],[258,40,258,52,0],[259,13,259,20,1],[259,22,259,52,1],[259,53,259,55,1],[259,56,259,69,1],[260,13,260,14,1],[261,17,261,66,1],[262,17,262,37,1],[262,38,262,69,1],[263,17,263,44,1],[264,13,264,14,1],[265,13,265,34,1],[266,9,266,10,1],[269,9,269,10,1],[270,13,270,39,1],[270,40,270,52,0],[271,13,271,39,1],[272,13,272,56,1],[273,13,273,50,1],[274,13,274,33,1],[275,13,275,14,1],[276,17,276,24,1],[276,26,276,56,1],[276,57,276,59,1],[276,60,276,73,1],[277,17,277,18,1],[278,21,278,52,1],[279,21,279,27,1],[281,13,281,14,1],[282,13,282,28,1],[283,9,283,10,1],[286,9,286,10,1],[287,13,287,33,1],[289,13,289,14,1],[290,17,290,71,1],[291,17,291,32,1],[291,33,291,45,1],[292,17,292,65,0],[293,17,293,38,0],[293,39,293,51,0],[294,17,294,38,0],[295,17,295,83,0],[296,13,296,14,0],[297,13,297,30,0],[298,13,298,14,0],[299,13,299,14,0],[300,13,300,28,0],[301,9,301,10,1],[304,9,304,10,1],[305,13,305,39,1],[306,13,306,43,1],[308,17,308,18,1],[309,21,309,63,1],[310,17,310,18,1],[311,17,311,37,0],[312,17,312,18,0],[313,21,313,119,0],[314,17,314,18,0],[315,13,315,51,1],[317,17,317,18,1],[318,21,318,68,1],[319,17,319,18,1],[320,17,320,37,0],[321,17,321,18,0],[322,21,322,119,0],[323,17,323,18,0],[324,13,324,50,1],[326,17,326,18,0],[327,21,327,77,0],[328,17,328,18,0],[329,17,329,37,0],[330,17,330,18,0],[331,21,331,119,0],[332,17,332,18,0],[333,13,333,48,1],[335,17,335,18,1],[336,21,336,73,1],[337,17,337,18,0],[338,17,338,37,1],[339,17,339,18,1],[340,21,340,119,1],[341,17,341,18,1],[342,13,342,49,1],[344,17,344,18,1],[345,21,345,79,1],[346,17,346,18,1],[347,17,347,37,0],[348,17,348,18,0],[349,21,349,119,0],[350,17,350,18,0],[351,13,351,48,1],[353,17,353,18,1],[354,21,354,73,1],[355,17,355,18,1],[356,17,356,37,0],[357,17,357,18,0],[358,21,358,119,0],[359,17,359,18,0],[360,13,360,50,1],[362,17,362,18,1],[363,21,363,66,1],[364,17,364,18,1],[365,17,365,37,0],[366,17,366,18,0],[367,21,367,119,0],[368,17,368,18,0],[369,13,369,46,1],[371,17,371,18,1],[372,21,372,69,1],[373,17,373,18,1],[374,17,374,37,0],[375,17,375,18,0],[376,21,376,119,0],[377,17,377,18,0],[378,13,378,46,1],[380,17,380,18,1],[381,21,381,73,1],[382,17,382,18,1],[383,17,383,37,0],[384,17,384,18,0],[385,21,385,119,0],[386,17,386,18,0],[387,13,387,48,1],[389,17,389,18,1],[390,21,390,62,1],[391,17,391,18,1],[392,17,392,37,0],[393,17,393,18,0],[394,21,394,119,0],[395,17,395,18,0],[396,13,396,49,1],[398,17,398,18,0],[399,21,399,79,0],[400,17,400,18,0],[401,17,401,37,0],[402,17,402,18,0],[403,21,403,119,0],[404,17,404,18,0],[405,13,405,45,1],[407,17,407,18,1],[408,21,408,71,1],[409,17,409,18,1],[410,17,410,37,0],[411,17,411,18,0],[412,21,412,119,0],[413,17,413,18,0],[414,13,414,44,1],[416,17,416,18,1],[417,21,417,65,1],[418,17,418,18,1],[419,17,419,37,0],[420,17,420,18,0],[421,21,421,119,0],[422,17,422,18,0],[423,13,423,46,1],[425,17,425,18,1],[426,21,426,58,1],[427,17,427,18,1],[428,17,428,37,0],[429,17,429,18,0],[430,21,430,119,0],[431,17,431,18,0],[432,13,432,47,1],[434,17,434,18,1],[435,21,435,72,1],[436,17,436,18,1],[437,17,437,37,0],[438,17,438,18,0],[439,21,439,119,0],[440,17,440,18,0],[441,13,441,46,1],[443,17,443,18,1],[444,21,444,70,1],[445,17,445,18,1],[446,17,446,37,0],[447,17,447,18,0],[448,21,448,119,0],[449,17,449,18,0],[450,13,450,50,1],[452,17,452,18,1],[453,21,453,78,1],[454,17,454,18,1],[455,17,455,37,0],[456,17,456,18,0],[457,21,457,119,0],[458,17,458,18,0],[459,13,459,45,1],[461,17,461,18,1],[462,21,462,68,1],[463,17,463,18,1],[464,17,464,37,0],[465,17,465,18,0],[466,21,466,119,0],[467,17,467,18,0],[468,13,468,50,1],[470,17,470,18,1],[471,21,471,77,1],[472,17,472,18,0],[473,17,473,37,1],[474,17,474,18,1],[475,21,475,119,1],[476,17,476,18,1],[477,13,477,50,1],[479,17,479,18,1],[480,21,480,81,1],[481,17,481,18,1],[482,17,482,37,0],[483,17,483,18,0],[484,21,484,119,0],[485,17,485,18,0],[486,13,486,43,1],[488,17,488,18,1],[489,21,489,63,1],[490,17,490,18,1],[491,17,491,37,0],[492,17,492,18,0],[493,21,493,119,0],[494,17,494,18,0],[495,13,495,43,1],[497,17,497,18,1],[498,21,498,67,1],[499,17,499,18,1],[500,17,500,37,0],[501,17,501,18,0],[502,21,502,119,0],[503,17,503,18,0],[504,13,504,45,1],[506,17,506,18,1],[507,21,507,56,1],[508,17,508,18,1],[509,17,509,37,0],[510,17,510,18,0],[511,21,511,119,0],[512,17,512,18,0],[513,13,513,49,1],[515,17,515,18,1],[516,21,516,79,1],[517,17,517,18,1],[518,17,518,37,0],[519,17,519,18,0],[520,21,520,119,0],[521,17,521,18,0],[522,13,522,45,1],[524,17,524,18,0],[525,21,525,67,0],[526,17,526,18,0],[527,17,527,37,0],[528,17,528,18,0],[529,21,529,119,0],[530,17,530,18,0],[531,13,531,53,1],[533,17,533,18,1],[534,21,534,83,1],[535,17,535,18,1],[536,17,536,37,0],[537,17,537,18,0],[538,21,538,119,0],[539,17,539,18,0],[540,13,540,41,1],[542,17,542,18,1],[543,21,543,48,1],[544,17,544,18,1],[545,17,545,37,0],[546,17,546,18,0],[547,21,547,119,0],[548,17,548,18,0],[549,13,549,45,1],[551,17,551,18,1],[552,21,552,71,1],[553,17,553,18,1],[554,17,554,37,1],[555,17,555,18,1],[556,21,556,119,1],[557,17,557,18,1],[558,13,558,52,1],[560,17,560,18,1],[561,21,561,81,1],[562,17,562,18,1],[563,17,563,37,1],[564,17,564,18,1],[565,21,565,119,1],[566,17,566,18,1],[567,13,567,54,1],[569,17,569,18,1],[570,21,570,74,1],[571,17,571,18,1],[572,17,572,37,0],[573,17,573,18,0],[574,21,574,119,0],[575,17,575,18,0],[576,13,576,51,1],[578,17,578,18,1],[579,21,579,68,1],[580,17,580,18,1],[581,17,581,37,0],[582,17,582,18,0],[583,21,583,119,0],[584,17,584,18,0],[585,13,585,41,1],[587,17,587,18,1],[588,21,588,48,1],[589,17,589,18,1],[590,17,590,37,0],[591,17,591,18,0],[592,21,592,119,0],[593,17,593,18,0],[594,13,594,45,1],[596,17,596,18,1],[597,21,597,71,1],[598,17,598,18,1],[599,17,599,37,0],[600,17,600,18,0],[601,21,601,119,0],[602,17,602,18,0],[603,13,603,43,1],[605,17,605,18,1],[606,21,606,63,1],[607,17,607,18,1],[608,17,608,37,0],[609,17,609,18,0],[610,21,610,119,0],[611,17,611,18,0],[612,13,612,46,1],[614,17,614,18,1],[615,21,615,73,1],[616,17,616,18,1],[617,17,617,37,0],[618,17,618,18,0],[619,21,619,119,0],[620,17,620,18,0],[621,13,621,45,1],[623,17,623,18,1],[624,21,624,56,1],[625,17,625,18,1],[626,17,626,37,0],[627,17,627,18,0],[628,21,628,119,0],[629,17,629,18,0],[630,13,630,53,1],[632,17,632,18,1],[633,21,633,83,1],[634,17,634,18,0],[635,17,635,37,1],[636,17,636,18,1],[637,21,637,119,1],[638,17,638,18,1],[639,13,639,57,1],[641,17,641,18,1],[642,21,642,80,1],[643,17,643,18,1],[644,17,644,37,0],[645,17,645,18,0],[646,21,646,119,0],[647,17,647,18,0],[650,13,650,56,1],[652,17,652,18,1],[653,21,653,97,1],[654,17,654,18,1],[655,17,655,37,1],[656,17,656,18,1],[657,21,657,119,1],[658,17,658,18,1],[659,13,659,46,1],[661,17,661,18,1],[662,21,662,77,1],[663,17,663,18,1],[664,17,664,37,0],[665,17,665,18,0],[666,21,666,119,0],[667,17,667,18,0],[668,13,668,59,1],[670,17,670,18,1],[671,21,671,104,1],[672,17,672,18,0],[673,17,673,37,1],[674,17,674,18,1],[675,21,675,119,1],[676,17,676,18,1],[677,13,677,52,1],[679,17,679,18,1],[680,21,680,87,1],[681,17,681,18,1],[682,17,682,37,0],[683,17,683,18,0],[684,21,684,119,0],[685,17,685,18,0],[686,13,686,54,1],[688,17,688,18,1],[689,21,689,74,1],[690,17,690,18,1],[691,17,691,37,0],[692,17,692,18,0],[693,21,693,119,0],[694,17,694,18,0],[697,13,697,28,1],[698,9,698,10,1],[703,9,703,10,1],[704,13,704,68,1],[706,13,706,95,1],[707,13,707,46,1],[710,13,710,41,1],[711,13,711,14,1],[712,17,712,88,1],[713,21,713,41,1],[715,21,715,42,1],[716,13,716,14,1],[717,13,717,39,1],[718,17,718,43,1],[720,13,720,55,1],[722,13,722,73,1],[723,13,723,14,1],[724,17,724,75,1],[725,17,725,37,1],[726,17,726,65,1],[727,17,727,32,1],[728,17,728,55,1],[729,17,729,92,1],[730,17,730,59,1],[731,13,731,14,1],[733,13,733,61,1],[735,13,735,52,1],[735,53,735,60,1],[736,13,736,22,1],[737,9,737,10,1],[740,9,740,10,1],[741,13,741,42,1],[742,13,742,30,1],[743,13,743,95,1],[750,13,750,91,1],[751,13,751,104,1],[752,13,752,113,1],[753,13,753,28,1],[754,9,754,10,1],[757,9,757,10,1],[758,13,758,33,1],[758,34,758,41,1],[759,13,759,107,1],[760,13,760,110,1],[761,9,761,10,1],[764,9,764,10,1],[765,13,765,27,1],[769,9,769,10,1],[772,9,772,10,1],[773,13,773,26,1],[774,13,774,14,1],[775,17,775,69,1],[776,17,776,57,1],[777,13,777,14,1],[778,13,778,25,1],[779,13,779,14,1],[780,17,780,59,1],[780,60,780,102,1],[781,22,781,61,0],[782,17,782,56,1],[782,57,782,96,1],[783,22,783,58,0],[784,13,784,14,1],[785,13,785,37,1],[786,13,786,14,1],[787,17,787,57,1],[787,58,787,98,1],[788,22,788,59,1],[789,17,789,74,1],[790,21,790,78,1],[791,22,791,76,0],[792,13,792,14,1],[793,13,793,87,1],[794,13,794,78,1],[795,13,795,14,0],[796,17,796,104,0],[797,17,797,42,0],[798,17,798,18,0],[799,21,799,66,0],[800,21,800,72,0],[801,21,801,71,0],[802,21,802,51,0],[803,21,803,59,0],[804,17,804,18,0],[805,17,805,86,0],[806,13,806,14,0],[808,13,808,14,1],[809,17,809,49,1],[810,17,810,64,1],[811,17,811,55,1],[812,13,812,14,1],[813,13,813,39,1],[814,13,814,14,1],[815,17,815,107,1],[816,17,816,18,0],[817,21,818,94,0],[819,25,819,89,0],[820,17,820,18,0],[822,17,824,83,1],[825,17,825,76,1],[826,17,826,18,1],[827,21,827,60,1],[828,21,828,57,1],[829,21,829,56,1],[830,21,830,45,1],[831,21,831,53,1],[832,17,832,18,1],[834,17,834,59,1],[835,21,835,57,1],[837,21,837,53,1],[838,13,838,14,1],[840,17,840,46,1],[842,13,843,102,1],[844,13,844,73,1],[845,17,845,69,1],[847,13,847,14,0],[848,17,848,52,0],[849,17,849,109,0],[850,13,850,14,0],[851,13,851,62,1],[853,13,853,71,1],[855,9,855,10,1],[858,9,858,10,1],[859,13,859,111,1],[861,13,861,85,1],[863,13,864,74,1],[865,13,911,16,1],[913,13,913,65,1],[914,13,914,14,1],[915,17,921,20,1],[933,17,943,20,1],[945,17,945,69,1],[946,21,958,28,0],[959,17,969,20,1],[970,13,970,14,1],[972,13,973,114,1],[976,13,976,33,1],[977,13,977,14,1],[978,17,988,20,1],[989,13,989,14,1],[991,13,991,37,1],[992,13,992,14,1],[993,17,999,20,1],[1000,13,1000,14,1],[1002,13,1002,20,1],[1002,22,1002,46,1],[1002,47,1002,49,1],[1002,50,1002,66,1],[1003,13,1003,14,1],[1005,17,1005,110,1],[1005,111,1005,120,0],[1006,17,1007,55,1],[1008,21,1008,79,1],[1009,17,1009,39,1],[1010,13,1010,14,1],[1011,13,1011,46,1],[1012,17,1012,55,1],[1014,13,1014,32,1],[1015,9,1015,10,1],[1067,9,1067,10,0],[1068,13,1070,19,0],[1072,13,1072,51,0],[1074,13,1074,54,0],[1075,13,1075,89,0],[1076,13,1076,25,0],[1077,9,1077,10,0],[1080,9,1080,10,1],[1081,13,1081,78,1],[1082,13,1084,19,1],[1085,13,1085,51,1],[1086,13,1086,54,1],[1087,13,1087,89,1],[1088,13,1088,25,1],[1089,9,1089,10,1],[1091,9,1091,10,1],[1092,13,1093,104,1],[1094,13,1095,100,1],[1097,13,1097,34,1],[1098,13,1098,37,1],[1099,13,1099,44,1],[1100,13,1100,36,1],[1101,13,1101,14,1],[1102,17,1102,48,1],[1103,13,1103,14,1],[1104,13,1104,38,1],[1105,13,1105,14,1],[1106,17,1106,44,1],[1107,13,1107,14,1],[1108,13,1108,54,1],[1109,13,1109,59,1],[1110,13,1110,52,1],[1112,13,1112,57,1],[1114,13,1114,32,1],[1115,13,1115,59,1],[1116,17,1116,47,0],[1117,13,1117,35,1],[1118,13,1118,40,1],[1119,17,1119,52,0],[1121,13,1121,80,1],[1122,17,1122,92,0],[1124,13,1124,31,1],[1126,13,1126,33,1],[1127,13,1127,103,1],[1128,13,1128,14,0],[1129,17,1130,90,0],[1131,21,1131,54,0],[1132,13,1132,14,0],[1133,13,1133,39,1],[1134,13,1134,14,1],[1135,17,1137,36,1],[1138,17,1138,85,1],[1139,17,1139,86,1],[1140,13,1140,14,1],[1141,18,1141,44,1],[1142,13,1142,14,1],[1143,17,1145,36,1],[1146,17,1146,85,1],[1147,17,1147,86,1],[1148,13,1148,14,1],[1150,18,1150,44,1],[1151,13,1151,14,1],[1152,17,1154,51,1],[1155,17,1155,85,1],[1156,17,1156,86,1],[1157,13,1157,14,1],[1158,18,1158,44,1],[1159,13,1159,14,1],[1160,17,1160,43,1],[1161,17,1164,35,1],[1165,17,1165,87,1],[1166,17,1166,86,1],[1167,13,1167,14,1],[1169,13,1169,14,0],[1170,17,1173,36,0],[1174,17,1174,87,0],[1175,17,1175,86,0],[1176,13,1176,14,0],[1177,13,1181,15,1],[1182,9,1182,10,1],[1188,9,1188,10,1],[1189,13,1189,42,1],[1190,20,1190,83,1],[1191,13,1191,14,1],[1192,24,1192,66,1],[1193,17,1193,18,1],[1194,21,1194,54,1],[1195,21,1195,58,1],[1196,25,1196,77,0],[1197,21,1197,68,1],[1198,21,1198,43,1],[1199,21,1199,33,1],[1200,17,1200,18,1],[1201,17,1201,92,1],[1202,13,1202,14,1],[1203,13,1203,27,1],[1204,9,1204,10,1],[1207,9,1207,10,1],[1210,13,1210,53,1],[1210,54,1210,110,1],[1212,13,1212,48,1],[1215,13,1215,20,1],[1215,22,1215,32,1],[1215,33,1215,35,1],[1215,36,1215,50,1],[1216,13,1216,14,1],[1217,17,1218,95,1],[1219,17,1219,18,1],[1220,21,1220,57,1],[1221,21,1221,22,1],[1222,25,1222,92,1],[1223,25,1223,66,1],[1224,25,1224,26,1],[1225,29,1228,73,1],[1229,29,1229,30,0],[1230,33,1231,55,0],[1232,33,1232,121,0],[1233,33,1233,49,0],[1234,29,1234,30,0],[1235,25,1235,26,1],[1237,29,1237,52,0],[1238,21,1238,22,1],[1239,17,1239,18,1],[1241,21,1241,44,1],[1242,13,1242,14,1],[1243,13,1243,26,1],[1244,9,1244,10,1],[1247,9,1247,10,1],[1248,13,1248,27,1],[1249,13,1249,20,1],[1249,22,1249,32,1],[1249,33,1249,35,1],[1249,36,1249,47,1],[1250,13,1250,14,1],[1251,17,1251,60,1],[1252,17,1252,18,1],[1253,21,1253,27,1],[1255,17,1255,25,1],[1256,13,1256,14,1],[1257,13,1257,26,1],[1258,9,1258,10,1],[1261,9,1261,10,1],[1262,13,1262,39,1],[1263,13,1263,14,1],[1264,17,1264,43,1],[1265,17,1265,18,0],[1266,21,1266,57,0],[1266,58,1266,88,0],[1267,21,1267,61,0],[1267,62,1267,96,0],[1268,21,1268,58,0],[1268,59,1268,90,0],[1269,21,1269,55,0],[1269,56,1269,84,0],[1270,21,1270,40,0],[1271,17,1271,18,0],[1272,13,1272,14,1],[1273,18,1273,44,1],[1274,13,1274,14,1],[1275,17,1275,54,1],[1275,55,1275,86,1],[1276,17,1276,53,1],[1276,54,1276,84,0],[1277,17,1277,51,1],[1277,52,1277,80,0],[1278,17,1278,36,1],[1279,13,1279,14,1],[1280,9,1280,10,1],[1283,9,1283,10,1],[1284,13,1284,45,1],[1285,13,1285,26,1],[1286,13,1286,14,1],[1287,17,1289,63,1],[1290,13,1290,14,1],[1292,13,1292,105,1],[1293,9,1293,10,1],[1298,9,1298,10,1],[1300,13,1300,34,1],[1302,13,1305,96,1],[1306,13,1306,14,0],[1307,24,1307,87,0],[1308,17,1308,18,0],[1309,28,1309,70,0],[1310,21,1310,22,0],[1311,25,1311,58,0],[1312,25,1312,76,0],[1313,29,1313,96,0],[1314,25,1314,76,0],[1315,29,1315,96,0],[1316,25,1316,60,0],[1317,29,1317,104,0],[1318,25,1318,62,0],[1319,29,1319,81,0],[1320,25,1320,64,0],[1321,29,1321,80,0],[1322,25,1322,64,0],[1323,29,1323,80,0],[1324,25,1324,61,0],[1325,29,1325,106,0],[1326,25,1326,63,0],[1327,29,1327,112,0],[1328,25,1328,70,0],[1329,29,1329,120,0],[1331,25,1331,47,0],[1332,25,1332,37,0],[1333,21,1333,22,0],[1334,21,1334,96,0],[1335,17,1335,18,0],[1336,13,1336,14,0],[1338,13,1338,85,1],[1339,13,1339,81,1],[1340,13,1342,26,1],[1343,13,1343,23,1],[1344,9,1344,10,1],[1348,9,1348,10,1],[1349,13,1349,111,1],[1351,13,1351,34,1],[1353,13,1353,60,1],[1354,13,1354,120,1],[1355,13,1355,81,1],[1356,13,1356,85,1],[1358,13,1359,56,1],[1360,13,1360,60,1],[1361,17,1361,63,1],[1361,64,1361,104,1],[1362,13,1362,64,1],[1363,17,1363,67,1],[1363,68,1363,112,0],[1364,13,1364,23,1],[1365,9,1365,10,1],[1370,9,1370,10,1],[1371,13,1371,111,1],[1374,13,1374,77,1],[1375,13,1375,56,1],[1377,13,1377,46,1],[1378,13,1378,101,1],[1379,13,1379,50,1],[1380,13,1380,14,1],[1381,17,1381,56,1],[1382,21,1382,72,0],[1383,17,1383,54,1],[1384,21,1384,73,0],[1385,17,1385,53,1],[1386,21,1386,98,1],[1387,13,1387,14,1],[1388,13,1388,108,1],[1389,17,1389,87,0],[1390,13,1390,35,1],[1391,13,1391,25,1],[1393,13,1393,81,1],[1394,13,1394,85,1],[1395,13,1397,25,1],[1398,13,1398,81,1],[1399,13,1399,14,0],[1400,17,1400,63,0],[1400,64,1400,104,0],[1401,17,1401,67,0],[1401,68,1401,112,0],[1402,13,1402,14,0],[1403,13,1403,60,1],[1404,17,1404,63,1],[1404,64,1404,104,1],[1405,13,1405,64,1],[1406,17,1406,67,1],[1406,68,1406,112,1],[1407,13,1407,23,1],[1408,9,1408,10,1],[1413,9,1413,10,1],[1414,13,1414,111,1],[1417,13,1417,77,1],[1418,13,1418,56,1],[1420,13,1420,46,1],[1421,13,1421,101,1],[1422,13,1422,50,1],[1423,13,1423,14,1],[1424,17,1424,56,1],[1425,21,1425,72,0],[1428,17,1428,53,1],[1429,21,1429,98,1],[1430,13,1430,14,1],[1431,13,1431,108,1],[1432,17,1432,87,0],[1433,13,1433,35,1],[1434,13,1434,25,1],[1436,13,1436,81,1],[1437,13,1437,85,1],[1438,13,1440,25,1],[1441,13,1441,81,1],[1442,13,1442,14,0],[1443,17,1443,63,0],[1443,64,1443,104,0],[1444,17,1444,67,0],[1444,68,1444,112,0],[1445,13,1445,14,0],[1446,13,1446,60,1],[1447,17,1447,63,1],[1447,64,1447,104,1],[1448,13,1448,64,1],[1449,17,1449,67,1],[1449,68,1449,112,1],[1450,13,1450,23,1],[1451,9,1451,10,1]]);
    </script>
  </body>
</html>