<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Business Layer\Controller\API Controllers\ModuleController.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core.AbstractModels;
using Aurigo.AMP3.Core.BusinessLayer.DTO;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.AMP3.DocumentManagementBL;
using Aurigo.AMP3.EnterpriseBL;
using Aurigo.AMP3.LinksBL;
using Aurigo.AMP3.LinksDTO;
using Aurigo.AMP3.Logging;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.AMP3.ProjectBL;
using Aurigo.AMP3.ProjectDAC;
using Aurigo.AMP3.UserManagementBL;
using Aurigo.Brix.Platform.BusinessLayer.AbstractModels;
using Aurigo.Brix.Platform.BusinessLayer.BL;
using Aurigo.Brix.Platform.BusinessLayer.DataAccessHelper;
using Aurigo.Brix.Platform.BusinessLayer.DataResouces;
using Aurigo.Brix.Platform.BusinessLayer.DTO;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Aurigo.Brix.Platform.BusinessLayer.XMLForm;
using Aurigo.Brix.Platform.BusinessLayer.XmlForm_Framework;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.Common;
using Aurigo.Workflow;
using Newtonsoft.Json;
using Newtonsoft.Json.Linq;
using System;
using System.Collections;
using System.Collections.Generic;
using System.Configuration;
using System.Data;
using System.Globalization;
using System.IO;
using System.Json;
using System.Linq;
using System.Net;
using System.Net.Http;
using System.Net.Http.Headers;
using System.Runtime.Serialization.Json;
using System.Text;
using System.Threading;
using System.Threading.Tasks;
using System.Web;
using System.Web.Http;
using System.Web.Script.Serialization;
using System.Xml;
using System.Xml.Serialization;

namespace Aurigo.Brix.Platform.BusinessLayer.Controller
{
    [MWAuthentication]
    public class ModuleController : ApiController
    {
        BrixFormModel model;

        [HttpGet]
        public HttpResponseMessage Instances(string moduleId, string jsonParameters)
        {
            bool returnjson = false;
            DataTable dt = null;
            List&lt;Dictionary&lt;string, object&gt;&gt; rtn = null;
            string errorMessage = string.Empty;

            Instance(moduleId, jsonParameters, out returnjson, out dt, out rtn, out errorMessage);
            if (dt != null &amp;&amp; dt.Rows.Count &gt; 0)
            {
                if (returnjson)
                    return Request.CreateResponse&lt;List&lt;Dictionary&lt;string, object&gt;&gt;&gt;(HttpStatusCode.OK, rtn);
                else
                    return Request.CreateResponse&lt;DataTable&gt;(HttpStatusCode.OK, dt);
            }

            return Request.CreateResponse&lt;string&gt;(HttpStatusCode.OK, null);
        }

        public bool Instance(string moduleId, string jsonParameters, out bool returnjson, out DataTable dt,
            out List&lt;Dictionary&lt;string, object&gt;&gt; rtn, out string errorMessage, string type = &quot;&quot;)
        {
            bool response = false;
            returnjson = false;
            dt = null;
            rtn = null;
            errorMessage = string.Empty;

            UserDetail ud = CurrentUser.CurrentUserDetail;

            JavaScriptSerializer js = new JavaScriptSerializer();
            Dictionary&lt;string, object&gt; filters = string.IsNullOrEmpty(jsonParameters)
                ? new Dictionary&lt;string, object&gt;(StringComparer.OrdinalIgnoreCase)
                : new Dictionary&lt;string, object&gt;(js.Deserialize&lt;Dictionary&lt;string, object&gt;&gt;(jsonParameters),
                    StringComparer.OrdinalIgnoreCase);

            CultureInfo ci = new CultureInfo(AMP3ApplicationSettings.Instance.Culture);
            Thread.CurrentThread.CurrentCulture = ci;
            Thread.CurrentThread.CurrentUICulture = ci;

            model = new BrixFormModel(XMLForms.GetXMLFormModuleID(moduleId), moduleId + &quot;.xml&quot;, XMLType.Form, null, null);

            Dictionary&lt;string, object&gt; formParams = filters.ContainsKey(moduleId)
                ? filters[moduleId] as Dictionary&lt;string, object&gt;
                : new Dictionary&lt;string, object&gt;();
            Dictionary&lt;string, object&gt; filterFields = filters.ContainsKey(&quot;filters&quot;)
                ? filters[&quot;filters&quot;] as Dictionary&lt;string, object&gt;
                : new Dictionary&lt;string, object&gt;();

            if (!filters.ContainsKey(&quot;pid&quot;) &amp;&amp; formParams.ContainsKey(&quot;pid&quot;)) filters.Add(&quot;pid&quot;, formParams[&quot;pid&quot;]);
            if (!filters.ContainsKey(&quot;parentid&quot;) &amp;&amp; formParams.ContainsKey(&quot;parentid&quot;))
                filters.Add(&quot;parentid&quot;, formParams[&quot;parentid&quot;]);
            if (!filters.ContainsKey(&quot;parentmodule&quot;)) filters.Add(&quot;parentmodule&quot;, model.form.ParentModuleID);
            filters.Add(&quot;context&quot;, model.form.Name);

            List&lt;string&gt; permissions =
                ModuleManager.Instance.GetPermissionByUserOrRole(
                    string.IsNullOrEmpty(model.form.AssociatedModuleID) ? moduleId : model.form.AssociatedModuleID,
                    ud.UID, ud.RID, (filters.ContainsKey(&quot;pid&quot;) ? filters[&quot;pid&quot;].ToInt32_2() : 0));

            if (permissions == null || (!permissions.Contains(&quot;View&quot;) || !permissions.Contains(&quot;Visibility&quot;)))
            {
                response = false;
                errorMessage = &quot;The user does not have permissions.&quot;;
                return response;
            }

            int pageSize = 500;
            if (filters.ContainsKey(&quot;pagesize&quot;) &amp;&amp; null != filters[&quot;pagesize&quot;])
                Int32.TryParse(filters[&quot;pagesize&quot;].ToString(), out pageSize);

            int pageToGet = 1;
            if (filters.ContainsKey(&quot;pagetoget&quot;) &amp;&amp; null != filters[&quot;pagetoget&quot;])
                Int32.TryParse(filters[&quot;pagetoget&quot;].ToString(), out pageToGet);

            bool isStringDataTable = false;
            if (filters.ContainsKey(&quot;stringtypes&quot;) &amp;&amp; null != filters[&quot;stringtypes&quot;])
                Boolean.TryParse(filters[&quot;stringtypes&quot;].ToString(), out isStringDataTable);

            if (filters.ContainsKey(&quot;returnjson&quot;) &amp;&amp; null != filters[&quot;returnjson&quot;])
                Boolean.TryParse(filters[&quot;returnjson&quot;].ToString(), out returnjson);

            int pageCount = 0;
            ListModel listModel = ListModel.GetXMLInstance(null, null, &quot;&quot;, moduleId, filters);
            XMLRenderingEngine engine = null;
            ArrayList cols = null;
            if (listModel != null)
            {
                engine = new XMLRenderingEngine(null, listModel.xmlModel, null);
                engine.Initialize();
            }
            DataSet ds;
            if (type == &quot;Offline&quot; || moduleId.ToUpper() != &quot;XPROJCT&quot;)
            {
                ds = GetDataSet(listModel, ref pageToGet, null, filterFields, pageSize, false, out cols,
                    out pageCount);
            }
            else
            {
                ds = new DataSet(); if (!ModuleManager.Instance.GetModuleList().ContainsKey(Constants.MODID_PLANING))
                {
                    ds.Merge(ProjectManager.Instance.GetProjectsWithFeaturePermission(ud.UID, ud.RID,
                        Constants.MODFEAT_VISIBILITY, &quot;PROJECT&quot;, 0, int.MaxValue, &quot;[ProjectId] ASC&quot;, &quot;&quot;, &quot;&quot;));
                }
                else
                {
                    ds.Merge(ProjectManager.Instance.GetPlanningProjectsWithFeaturePermission(ud.UID, ud.RID,
                  Constants.MODFEAT_VISIBILITY, &quot;PROJECT&quot;, 0, int.MaxValue, &quot;[ProjectId] ASC&quot;, &quot;&quot;, &quot;&quot;, 0));
                }


            }

            if (ds.Tables.Count &gt; 0)
            {
                dt = ModifyResultDataSet(errorMessage, ref response, isStringDataTable, pageCount, ds);
                if (returnjson)
                {
                    //Formatting data from table to list of dictionary (key value pair) and returning that
                    rtn = new List&lt;Dictionary&lt;string, object&gt;&gt;();
                    foreach (DataRow dr in dt.Rows)
                    {
                        Dictionary&lt;string, object&gt; rows = new Dictionary&lt;string, object&gt;();
                        foreach (DataColumn col in dt.Columns)
                            rows.Add(col.ColumnName, dr[col.ColumnName]);
                        rtn.Add(rows);
                    }
                }
            }
            return response;
        }

        /// &lt;summary&gt;
        /// If there is no data, add &quot;No records to display&quot; row.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;errorMessage&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;hasRows&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;isStringDataTable&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;pageCount&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;ds&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private static DataTable ModifyResultDataSet(string errorMessage, ref bool hasRows, bool isStringDataTable,
            int pageCount, DataSet ds)
        {
            ds.Tables[0].TableName = &quot;Rowdata&quot;;
            DataColumn dc = new DataColumn(&quot;PageCount&quot;, Type.GetType(&quot;System.Int32&quot;));
            dc.DefaultValue = pageCount;
            ds.Tables[0].Columns.Add(dc);
            ds.Tables[0].Columns.Add(&quot;NoRecMsgStyle&quot;);

            ds.Tables[0].AcceptChanges();

            DataTable dt = !isStringDataTable ? ds.Tables[0] : ApiControllerHelper.GetStringDataTable(ds.Tables[0]);

            hasRows = true;
            if (dt.Rows.Count == 0)
            {
                DataRow row = dt.NewRow();

                row[&quot;NoRecMsgStyle&quot;] = string.IsNullOrEmpty(errorMessage) ? &quot;No records to display&quot; : errorMessage;
                ds.Tables[0].Rows.Add(row);

                hasRows = false;
            }
            return dt;
        }

        [HttpGet]
        public HttpResponseMessage GetProjectModules(string moduleId, string projectId, string contractId,
            string modulesTemplate, string lastSyncedAt = &quot;&quot;)
        {
            string startDate = DateTime.UtcNow.ToDateTimeString_InvariantCulture();

            bool returnjson = false;
            DataTable dt = null;
            List&lt;Dictionary&lt;string, object&gt;&gt; rtn = null;
            string errorMsg = string.Empty;

            string jsonParameters = &quot;{\&quot;pid\&quot; : \&quot;&quot; + projectId +
                                    &quot;\&quot;, \&quot;returnjson\&quot; : true, \&quot;filters\&quot; : {\&quot;andfilters\&quot; : {\&quot;projectId\&quot; : \&quot;&quot; +
                                    projectId + &quot;\&quot;}}}&quot;;
            if (Instance(moduleId, jsonParameters, out returnjson, out dt, out rtn, out errorMsg, &quot;&quot;))
            {
                if (dt != null &amp;&amp; dt.Rows.Count &gt; 0)
                {
                    string projectListDetails = &quot;{}&quot;;
                    if (returnjson)
                    {
                        JavaScriptSerializer serializer = new JavaScriptSerializer();
                        projectListDetails = serializer.Serialize(rtn);

                        List&lt;string&gt; modules = new List&lt;string&gt;();
                        string modulesToRemove = string.Empty;
                        if (!string.IsNullOrEmpty(modulesTemplate))
                        {
                            modules = modulesTemplate.Split(&#39;,&#39;).ToList();
                            modules = modules.Select(m =&gt; &quot;text() = &#39;&quot; + m + &quot;&#39;&quot;).ToList&lt;string&gt;();
                            modulesToRemove = string.Join(&quot; or &quot;, modules);
                        }

                        XmlDocument doc = null;

                        MobileCacheData cacheManager = new MobileCacheData();
                        cacheManager.PID = projectId.ToInt32_2();
                        cacheManager.ParentID = contractId.ToInt32_2();
                        cacheManager.ModuleID = moduleId;
                        cacheManager.TemplateType = MobileCacheTemplateType.DrawerTemplate.ToString();

                        UserDetail ud = CurrentUser.CurrentUserDetail;

                        string drawerTemplate = MobileCacheManager.Instance.GetMobileCacheData(cacheManager, ud.UID,
                            ud.RID, null);
                        if (drawerTemplate != &quot;&quot; &amp;&amp; drawerTemplate != &quot;{}&quot;)
                        {
                            doc = JsonConvert.DeserializeXmlNode(drawerTemplate, &quot;root&quot;);
                            modules = new List&lt;string&gt;();
                            XmlNodeList nodes = null;

                            if (string.IsNullOrEmpty(modulesToRemove))
                                nodes = doc.SelectNodes(&quot;//Modules/Row/ModuleID&quot;);
                            else
                                nodes = doc.SelectNodes(&quot;//Modules/Row/ModuleID[not(&quot; + modulesToRemove + &quot;)]&quot;);

                            foreach (XmlNode node in nodes)
                            {
                                modules.Add(node.InnerText);
                            }
                        }

                        string listTemplate = &quot;[]&quot;;
                        string formTemplate = &quot;[]&quot;;
                        if (modules.Count &gt; 0)
                        {
                            cacheManager.TemplateType = MobileCacheTemplateType.ListTemplate.ToString();
                            cacheManager.LastSyncedAt = lastSyncedAt;

                            object[] additionalParameters = new object[2];
                            additionalParameters[0] = modules;
                            additionalParameters[1] = jsonParameters;

                            listTemplate = MobileCacheManager.Instance.GetMobileCacheData(cacheManager, ud.UID, ud.RID,
                                additionalParameters);

                            cacheManager.TemplateType = MobileCacheTemplateType.FormTemplate.ToString();
                            cacheManager.LastSyncedAt = lastSyncedAt;

                            additionalParameters = new object[2];
                            additionalParameters[0] = modules;
                            additionalParameters[1] = &quot;{\&quot;pid\&quot;:\&quot;&quot; + projectId + &quot;\&quot;,\&quot;parentid\&quot;:\&quot;&quot; + contractId +
                                                      &quot;\&quot;}&quot;;
                            formTemplate = MobileCacheManager.Instance.GetMobileCacheData(cacheManager, ud.UID, ud.RID,
                                additionalParameters);
                        }

                        string responseS = &quot;{\&quot;listDetails\&quot; : &quot; + projectListDetails + &quot;,\&quot;drawerTemplate\&quot; : &quot; +
                                           drawerTemplate
                                           + &quot;,\&quot;listTemplates\&quot; : &quot; + listTemplate + &quot;,\&quot;formTemplates\&quot; : &quot; +
                                           formTemplate + &quot;}&quot;;

                        var response = this.Request.CreateResponse(HttpStatusCode.OK);
                        response.Content = new StringContent(responseS, Encoding.UTF8, &quot;application/json&quot;);
                        response.Headers.Add(&quot;Request-Start&quot;, startDate);

                        return response;
                    }
                }
            }

            var emptyResponse = this.Request.CreateResponse(HttpStatusCode.OK);
            emptyResponse.Content =
                new StringContent(
                    &quot;{\&quot;listDetails\&quot;: {}, \&quot;drawerTemplate\&quot;: {}, \&quot;listTemplates\&quot;: [], \&quot;formTemplates\&quot;: []}&quot;,
                    Encoding.UTF8, &quot;application/json&quot;);
            emptyResponse.Headers.Add(&quot;Request-Start&quot;, startDate);

            return emptyResponse;
        }

        [HttpGet]
        public HttpResponseMessage InstanceDetails(string moduleId, string Id, string jsonParameters,
            string lastSyncedAt = &quot;&quot;)
        {
            XmlDocument doc = null;

            if (InstanceDetails(moduleId, Id, jsonParameters, out doc, lastSyncedAt))
            {
                if (moduleId.ToUpper() == &quot;XPROJCT&quot;)
                    //TZ converstion for project dates for detials page 
                    try
                    {
                        var StartDateInnerText_MWDateTimeString = (doc.DocumentElement[&quot;StartDate&quot;].InnerText).ToMWDateTimeString_FormatDateTime();
                        var EndDateInnerText_MWDateTimeString = (doc.DocumentElement[&quot;EndDate&quot;].InnerText).ToMWDateTimeString_FormatDateTime();
                        var CreatedDateInnerText_MWDateTimeString = (doc.DocumentElement[&quot;CreateDate&quot;].InnerText).ToMWDateTimeString_FormatDateTime();

                        doc.DocumentElement[&quot;StartDate&quot;].InnerText = StartDateInnerText_MWDateTimeString;
                        doc.DocumentElement[&quot;StartDate&quot;].InnerXml = StartDateInnerText_MWDateTimeString;
                        doc.DocumentElement[&quot;EndDate&quot;].InnerText = EndDateInnerText_MWDateTimeString;
                        doc.DocumentElement[&quot;EndDate&quot;].InnerXml = EndDateInnerText_MWDateTimeString;
                        doc.DocumentElement[&quot;CreateDate&quot;].InnerText = CreatedDateInnerText_MWDateTimeString;
                        doc.DocumentElement[&quot;CreateDate&quot;].InnerXml = CreatedDateInnerText_MWDateTimeString;
                    }
                    catch { }
                return Request.CreateResponse&lt;XmlElement&gt;(HttpStatusCode.Created, doc.DocumentElement);
            }

            else
                return Request.CreateResponse&lt;XmlElement&gt;(HttpStatusCode.BadRequest, doc.DocumentElement);
        }

        [HttpGet]
        public HttpResponseMessage GetMapEnabledForms(string projectId, string jsonParameters)
        {
            var mapEnabledForms = ModuleManager.Instance.GetMapEnabledFormsForProject(projectId);
            if (mapEnabledForms.Count != 0)

                return Request.CreateResponse&lt;List&lt;Dictionary&lt;string, object&gt;&gt;&gt;(HttpStatusCode.Created, mapEnabledForms);
            else
                return Request.CreateResponse&lt;List&lt;Dictionary&lt;string, object&gt;&gt;&gt;(HttpStatusCode.BadRequest,
                    mapEnabledForms);
        }

        [HttpGet]
        public HttpResponseMessage GetAllMapEnabledForms(string projectId, string jsonParameters)
        {
            var mapEnabledForms = ModuleManager.Instance.GetAllMapEnabledFormsForProject(projectId);
            if (mapEnabledForms.Count != 0)

                return Request.CreateResponse&lt;List&lt;Dictionary&lt;string, object&gt;&gt;&gt;(HttpStatusCode.OK, mapEnabledForms);
            else
                return Request.CreateResponse&lt;List&lt;Dictionary&lt;string, object&gt;&gt;&gt;(HttpStatusCode.OK, mapEnabledForms);
        }

        [HttpGet]
        public HttpResponseMessage GetAllEsriMapDetails(string moduleIds, int pid, int parentId, string mapExtent)
        {
            string[] modules = moduleIds.Split(new string[] { &quot;,&quot; }, StringSplitOptions.RemoveEmptyEntries);
            DataTable dtEsriDetails = new DataTable();
            dtEsriDetails.Columns.AddRange(new DataColumn[]
            {
                new DataColumn(&quot;ModuleID&quot;),
                new DataColumn(&quot;PID&quot;),
                new DataColumn(&quot;ParentID&quot;),
                new DataColumn(&quot;MapOptions&quot;),
                new DataColumn(&quot;MapData&quot;)
            });
            foreach (string moduleId in modules)
            {
                List&lt;string&gt; mapDetails = GetEsriMapDetails(moduleId, pid, parentId, mapExtent);
                if (mapDetails.Count == 2)
                {
                    DataRow row = dtEsriDetails.NewRow();
                    row[&quot;ModuleID&quot;] = moduleId;
                    row[&quot;PID&quot;] = pid;
                    row[&quot;ParentID&quot;] = parentId;
                    row[&quot;MapOptions&quot;] = mapDetails[0];
                    row[&quot;MapData&quot;] = mapDetails[1];
                    dtEsriDetails.Rows.Add(row);
                }
            }
            return Request.CreateResponse&lt;DataTable&gt;(HttpStatusCode.OK, dtEsriDetails);
        }

        [HttpGet]
        public List&lt;string&gt; GetEsriMapDetails(string context, int pid, int parentId, string mapExtent)
        {
            Dictionary&lt;string, object&gt; requestParams = new Dictionary&lt;string, object&gt;();
            requestParams.Add(&quot;PID&quot;, pid);
            requestParams.Add(&quot;ParentID&quot;, parentId);
            requestParams.Add(&quot;context&quot;, context);
            ListModel listModel = ListModel.GetXMLInstance(null, null, &quot;&quot;, context,
                new Dictionary&lt;string, object&gt;(requestParams, StringComparer.OrdinalIgnoreCase));
            listModel.OnInit();
            string filter = string.Empty;
            List&lt;string&gt; mapDetails = new List&lt;string&gt;();
            var xmlModel = listModel.xmlModel;
            if (xmlModel.form.ShowMapView)
            {
                xControl mapControl = null;
                xControl filterControl = null;
                bool findFilterControl = !string.IsNullOrEmpty(xmlModel.form.MapFilterKey)
                                         &amp;&amp; xmlModel.form.MapFilterKey != &quot;WorkflowStatus&quot;;
                xmlModel.form.ProcessAllControlsDeeply
                    (xc =&gt;
                    {
                        if (xc.Type == Brix.Platform.BusinessLayer.XMLForm.ControlType.Map)
                        {
                            mapControl = xc;
                        }
                        if (findFilterControl)
                            if (xc.Name == xmlModel.form.MapFilterKey)
                                filterControl = xc;
                    });

                if (mapControl != null)
                {
                    string query = &quot;select &quot; + mapControl.Name + &quot; from &quot; + xmlModel.form.TableName;

                    if (xmlModel.form.MapFilterKey == &quot;WorkflowStatus&quot;)
                    {
                        query = @&quot;select &quot; + xmlModel.form.TableName +
                                @&quot;.*,ISNULL(WF.CurrentStatus,&#39;&#39;) as WorkflowStatus
                        from &quot; + xmlModel.form.TableName + @&quot; left outer join WorkflowFormMapping WF on &quot; +
                                xmlModel.form.TableName + @&quot;.&quot; + xmlModel.form.PrimaryKeyName + @&quot; = WF.FormInstanceID 
                        and WF.FormID = &#39;&quot; + xmlModel.form.Name + @&quot;&#39; where 1=1 &quot;;
                        string whrCond = xmlModel.form.BuildForeignKeyFilter();
                        if (!string.IsNullOrEmpty(whrCond))
                            query += whrCond.Replace(&quot;where&quot;, &quot; and &quot;);
                        if (!string.IsNullOrEmpty(filter))
                            query += &quot; and WF.CurrentStatus in (&quot; + filter + &quot;)&quot;;
                    }
                    else //TODO: Need to fix this
                        query += (string.IsNullOrEmpty(filter) ? &quot;&quot; : (&quot; where  &quot; + filter));

                    DataSet ds = ComponentHelper.Instance.ExecuteDataSet(query);

                    JsonArray optionObject = new JsonArray();
                    JsonArray graphicsArray = new JsonArray();

                    if (ds != null &amp;&amp; ds.Tables.Count &gt; 0)
                    {
                        JsonObject mapJson = JsonObject.Parse(mapExtent).ToJsonObject();
                        GeoAPI.Geometries.Envelope mapEnvelope =
                            new GeoAPI.Geometries.Envelope(mapJson[&quot;xmin&quot;].ToString().ToDouble2(),
                                mapJson[&quot;xmax&quot;].ToString().ToDouble2(),
                                mapJson[&quot;ymin&quot;].ToString().ToDouble2(),
                                mapJson[&quot;ymax&quot;].ToString().ToDouble2());

                        foreach (DataRow dr in ds.Tables[0].Rows)
                        {
                            string vals = dr[mapControl.Name].ToString();
                            if (!string.IsNullOrEmpty(vals) &amp;&amp; vals.Contains(&quot;~~&quot;))
                            {
                                string[] values = vals.Split(new string[] { &quot;~~&quot; },
                                    StringSplitOptions.RemoveEmptyEntries);
                                if (values.Length == 2 &amp;&amp; values[1].Contains(&quot;graphicsFullExtent&quot;))
                                {
                                    JsonObject graphicsFullExtentJson =
                                        JsonObject.Parse(values[1]).ToJsonObject()[&quot;graphicsFullExtent&quot;].ToJsonObject();
                                    GeoAPI.Geometries.Envelope graphicsFullExtent = null;

                                    if (graphicsFullExtentJson.Keys.Contains(&quot;xmin&quot;))
                                    {
                                        graphicsFullExtent =
                                            new GeoAPI.Geometries.Envelope(
                                                graphicsFullExtentJson[&quot;xmin&quot;].ToString().ToDouble2(),
                                                graphicsFullExtentJson[&quot;xmax&quot;].ToString().ToDouble2(),
                                                graphicsFullExtentJson[&quot;ymin&quot;].ToString().ToDouble2(),
                                                graphicsFullExtentJson[&quot;ymax&quot;].ToString().ToDouble2());
                                    }

                                    if (graphicsFullExtent != null &amp;&amp; mapEnvelope.Intersects(graphicsFullExtent))
                                    {
                                        optionObject.Add(JsonObject.Parse(values[1]).ToJsonObject());

                                        JsonObject graphicsObject = JsonObject.Parse(values[0]).ToJsonObject();
                                        string primaryKeyVal = string.Empty;
                                        //Add Attributes Json Object to graphics object
                                        JsonObject attrObject = new JsonObject();

                                        foreach (DataColumn column in ds.Tables[0].Columns)
                                        {
                                            string columnName = column.ColumnName;
                                            if (string.IsNullOrEmpty(primaryKeyVal))
                                            {
                                                primaryKeyVal = dr[xmlModel.form.PrimaryKeyName].ToString();
                                            }
                                            xControl ctrl = xmlModel.form.GetControl(columnName);
                                            if (columnName != mapControl.Name &amp;&amp; ctrl != null &amp;&amp; ctrl.IsListVisible)
                                            {
                                                string columnValue = dr[column.ColumnName].ToString();
                                                if (ctrl.Type ==
                                                    Brix.Platform.BusinessLayer.XMLForm.ControlType.DropDownList)
                                                {
                                                    columnValue = &quot;&quot;;
                                                }
                                                attrObject.Add(
                                                    (string.IsNullOrEmpty(ctrl.Caption)
                                                        ? ctrl.Name
                                                        : ctrl.ParseDynamicString(ctrl.Caption)).Replace(&quot;:&quot;, &quot;&quot;).Trim(),
                                                    columnValue);
                                            }
                                        }

                                        string url = string.Empty;
                                        url = &quot;#views/formPageView.html?pid=&quot; + pid + &quot;&amp;parentId=&quot; + parentId +
                                              &quot;&amp;context=&quot; + context + &quot;&amp;instanceId=&quot; + primaryKeyVal +
                                              &quot;&amp;offId=0&amp;dataMode=on&quot;;
                                        attrObject.Add(&quot;InfoWindowTitle&quot;,
                                            xmlModel.form.ParseDynamicString(xmlModel.form.Header) + &quot; Details&quot;);
                                        attrObject.Add(&quot;ViewDetailsURL&quot;, url.Format2(&quot;View&quot;));


                                        for (int i = 0; i &lt; ((JsonArray)graphicsObject[&quot;graphics&quot;]).Count; i++)
                                        {
                                            JsonObject obj = ((JsonArray)graphicsObject[&quot;graphics&quot;])[i].ToJsonObject();

                                            if (obj.ContainsKey(&quot;attributes&quot;))
                                                ((JsonArray)graphicsObject[&quot;graphics&quot;])[i][&quot;attributes&quot;] = attrObject;
                                            else
                                                ((JsonObject)((JsonArray)graphicsObject[&quot;graphics&quot;])[i]).Add(
                                                    &quot;attributes&quot;, attrObject);
                                        }

                                        graphicsArray.Add(graphicsObject);
                                    }
                                }
                            }
                        }
                    }

                    mapDetails.Add(optionObject.ToString());
                    mapDetails.Add(graphicsArray.ToString());
                }
            }
            return mapDetails;
        }

        [HttpGet]
        public HttpResponseMessage GetMobileConfig()
        {
            DataSet ds = new DataSet();

            ds = ComponentHelper.Instance.ExecuteDataSet(&quot;select  *  FROM   MobileConfig &quot;);

            return Request.CreateResponse&lt;DataSet&gt;(HttpStatusCode.OK, ds);
        }

        //If moduleid is CONMODS, then it returns custom xml for project tree
        private bool InstanceDetails(string moduleId, string Id, string jsonParameters, out XmlDocument doc,
            string lastSyncedAt = &quot;&quot;)
        {
            doc = null;
            try
            {
                UserDetail ud = CurrentUser.CurrentUserDetail;

                JavaScriptSerializer js = new JavaScriptSerializer();
                Dictionary&lt;string, object&gt; filters = string.IsNullOrEmpty(jsonParameters)
                    ? new Dictionary&lt;string, object&gt;()
                    : js.Deserialize&lt;Dictionary&lt;string, object&gt;&gt;(jsonParameters);

                CultureInfo ci = new CultureInfo(AMP3ApplicationSettings.Instance.Culture);
                Thread.CurrentThread.CurrentCulture = ci;
                Thread.CurrentThread.CurrentUICulture = ci;

                XmlDocument root;
                try
                {
                    model = new BrixFormModel(XMLForms.GetXMLFormModuleID(moduleId), moduleId + &quot;.xml&quot;, XMLType.Form,
                        null, null);
                }
                catch (Exception ex)
                {
                    //If conmod is not uploaded, we are forming the xml here and returning the modules
                    if (moduleId.ToLower2() == &quot;conmods&quot;)
                    {
                        DataTable dtModules = new DataTable();
                        if (!string.IsNullOrEmpty(lastSyncedAt))
                            dtModules = ModuleManager.Instance.GetModules();

                        List&lt;XmlNode&gt; nodesListPrj = new List&lt;XmlNode&gt;();
                        DataSet dtProjects = ProjectComponent.Instance.GetProjectForTree(Id.ToInt32_2(), ud.UID, ud.RID);
                        if (dtProjects.Tables.Count &gt;= 1 &amp;&amp; dtProjects.Tables[1].Rows.Count &gt; 0)
                        {
                            string docs = &quot;&lt;CONMODS&gt;&lt;ProjectID&gt;&quot; + Id + &quot;&lt;/ProjectID&gt;&lt;ID&gt;&quot; + Id + &quot;&lt;/ID&gt;&lt;Modules&gt;&quot;;

                            foreach (DataRow dr in dtProjects.Tables[1].Rows)
                            {
                                if ((dr[&quot;NavigateURL&quot;].ToString() == &quot;xmlform&quot; &amp;&amp;
                                     checkOfflineEnabled(dr[&quot;ModuleID&quot;].ToString(), Id)))
                                {
                                    bool getModule = true;
                                    if (!string.IsNullOrEmpty(lastSyncedAt))
                                    {
                                        try
                                        {
                                            DataRow[] rows =
                                                dtModules.Select(&quot;ModuleID=&#39;&quot; + dr[&quot;ModuleID&quot;].ToString() +
                                                                 &quot;&#39; and UploadedDate &gt; &#39;&quot; + lastSyncedAt + &quot;&#39;&quot;);
                                            getModule = !(rows.Length == 0);
                                        }
                                        catch
                                        {
                                            //Error filtering the datatable, get the module details
                                        }
                                    }
                                    if (getModule)
                                    {
                                        var row = &quot;&lt;Row&gt;&lt;ID&gt;&lt;/ID&gt;&lt;ProjectID&gt;&quot; + Id + &quot;&lt;/ProjectID&gt;&lt;ContractID&gt;&quot; + Id +
                                                  &quot;&lt;/ContractID&gt;&lt;ModuleName&gt;&quot; + dr[&quot;ModuleName&quot;] +
                                                  &quot;&lt;/ModuleName&gt;&lt;ModuleID&gt;&quot; + dr[&quot;ModuleID&quot;] +
                                                  &quot;&lt;/ModuleID&gt;&lt;URL&gt;&lt;/URL&gt;&lt;/Row&gt;&quot;;
                                        docs += row;
                                    }
                                }
                            }
                            docs += &quot;&lt;/Modules&gt;&lt;/CONMODS&gt;&quot;;
                            XmlDocument xmlDoc = new XmlDocument();
                            xmlDoc.LoadXml(docs);

                            doc = xmlDoc;
                            return true;
                        }
                        else
                        {
                            XmlDocument xmlDoc = new XmlDocument();
                            xmlDoc.LoadXml(&quot;&lt;Error&gt;&quot; + ex.Message + &quot;&lt;/Error&gt;&quot;);
                            doc = xmlDoc;
                            return false;
                        }
                    }
                }
                //model.form.RequestParameters = requestParams;
                model.form.GetHostValue += new GetVal(form_GetHostValue);
                model.form.GetHostGridValue += new GetValFromGrid(form_GetHostGridValue);
                model.form.SetHostValue += new SetVal(form_SetHostValue);
                model.form.SetHostGridValue += new SetValInGrid(form_SetHostGridValue);

                List&lt;string&gt; permissions =
                    ModuleManager.Instance.GetPermissionByUserOrRole(
                        string.IsNullOrEmpty(model.form.AssociatedModuleID) ? moduleId : model.form.AssociatedModuleID,
                        ud.UID, ud.RID, (!string.IsNullOrEmpty(Id) ? Id.ToInt32_2() : 0));

                if (permissions == null) throw new Exception(&quot;The user does not have permissions.&quot;);
                if (!permissions.Contains(&quot;View&quot;)) throw new Exception(&quot;The user does not have permissions.&quot;);


                var engine = new XMLRenderingEngine(null, model, null);
                model.form.instanceID = Id;
                engine.Render(RenderFormat.RenderXml);
                root = (model.form.Renderer as XmlRenderer).MasterDoc;

                if (moduleId.ToLower2() == &quot;conmods&quot;)
                {
                    // DataSet dt = ComponentHelper.Instance.ExecuteDataSet(&quot;select top 1 id  FROM   contmgtmaster  where projectid  = &quot; + Id);
                    DataSet dtProjects = ProjectComponent.Instance.GetProjectForTree(Id.ToInt32_2(), ud.UID, ud.RID);

                    var cont = Id;
                    List&lt;XmlNode&gt; nodesListPrj = new List&lt;XmlNode&gt;();
                    if (dtProjects.Tables.Count &gt;= 1 &amp;&amp; dtProjects.Tables[1].Rows.Count &gt; 0)
                    {
                        foreach (DataRow dr in dtProjects.Tables[1].Rows)
                        {
                            if ((dr[&quot;NavigateURL&quot;].ToString() == &quot;xmlform&quot;) &amp;&amp;
                                checkOfflineEnabled(dr[&quot;ModuleID&quot;].ToString(), Id))
                            {
                                var row = &quot;&lt;Row&gt;&lt;ID&gt;&lt;/ID&gt;&lt;ProjectID&gt;&quot; + Id + &quot;&lt;/ProjectID&gt;&lt;ContractID&gt;&quot; +
                                          cont.ToString() + &quot;&lt;/ContractID&gt;&lt;ModuleName&gt;&quot; + dr[&quot;ModuleName&quot;] +
                                          &quot;&lt;/ModuleName&gt;&lt;ModuleID&gt;&quot; + dr[&quot;ModuleID&quot;] + &quot;&lt;/ModuleID&gt;&lt;URL&gt;&lt;/URL&gt;&lt;/Row&gt;&quot;;

                                XmlDocument docr = new XmlDocument();
                                docr.LoadXml(row);
                                XmlNode newNode = docr.DocumentElement;

                                nodesListPrj.Add(newNode);
                            }
                        }
                    }

                    List&lt;XmlNode&gt; nodesList = new List&lt;XmlNode&gt;();
                    var xmlList = root.DocumentElement.GetElementsByTagName(&quot;Modules&quot;);
                    foreach (var mod in xmlList)
                    {
                        var rows = ((System.Xml.XmlElement)(mod)).GetElementsByTagName(&quot;Row&quot;);
                        int i = 0;
                        foreach (var rowElememt in rows)
                        {
                            string ModuleID =
                                ((System.Xml.XmlElement)(rowElememt)).GetElementsByTagName(&quot;ModuleID&quot;)[0].InnerText;
                            List&lt;string&gt; Modulepermissions = ModuleManager.Instance.GetPermissionByUserOrRole(ModuleID,
                                ud.UID, ud.RID,
                                (!string.IsNullOrEmpty(Id) ? Id.ToInt32_2() : 0));

                            if (Modulepermissions == null ||
                                (!Modulepermissions.Contains(&quot;View&quot;) || !Modulepermissions.Contains(&quot;Visibility&quot;)))
                            {
                                nodesList.Add(rows[i]);
                                var a = rows[i];
                            }
                            i++;
                        }
                    }


                    foreach (var node in nodesList)
                    {
                        (xmlList)[0].RemoveChild(node);
                    }
                    foreach (var node in nodesListPrj)
                    {
                        XmlNode importNode = (xmlList)[0].OwnerDocument.ImportNode(node, true);

                        (xmlList)[0].AppendChild(importNode);
                    }
                }

                doc = root;
                return true;
            }
            catch (Exception ex)
            {
                XmlDocument xmlDoc = new XmlDocument();
                xmlDoc.LoadXml(&quot;&lt;Error&gt;&quot; + ex.Message + &quot;&lt;/Error&gt;&quot;);
                doc = xmlDoc;
                return false;
            }
        }

        private bool checkOfflineEnabled(string moduleId, string projectId = &quot;&quot;)
        {
            //if (moduleId == &quot;DBINSRT&quot; || moduleId == &quot;DBCANIN&quot;)
            //{
            //    return true;
            //}
            //else
            //{
            //    return false;
            //}
            object objContId =
                ComponentHelper.Instance.ExecuteScalar(&quot;select top 1 moduleId from PROJECTProjectModule where  ProjectId= {0} and  moduleId = {1} and PlatformKey={2}&quot;, projectId.ToInt32_2(), moduleId, &quot;Client&quot;);
            if (objContId != null)
                return true;
            else
                return false;
        }

        [HttpGet]
        public bool GetDocVisibility(string projectID)
        {
            string moduleID = &quot;CONTMGT&quot;;
            string folderId = &quot;0&quot;;
            int contractID = 0;
            object objContId = ComponentHelper.Instance.ExecuteScalar(StoredProcedure.usp_CONTMGTGetTopContract, null,
                projectID);
            if (objContId != null)
                contractID = objContId.ToInt32_2();

            int tempInt;
            if (!int.TryParse(folderId, out tempInt) || string.IsNullOrEmpty(folderId) || int.Parse(folderId) == 0)
            {
                Aurigo.AMP3.DocumentManagementDTO.Folder rootFolder =
                    DocumentManager.Instance.GetInstanceRootFolder(contractID, moduleID);
                folderId = rootFolder.FolderId.ToString();
            }


            List&lt;string&gt; permissions =
                Aurigo.AMP3.DocumentManagementBL.DocumentManager.Instance.GetPermissions(int.Parse(projectID),
                    int.Parse(folderId));
            if (!permissions.Contains(&quot;Visibility&quot;))
                return false;
            else
            {
                return true;
            }
        }

        object form_GetHostValue(string ctrlName, string fieldName, out string datatype, out string errors)
        {
            datatype = null;
            errors = null;
            object val = null;
            xControl ctl = model.form.GetControl(ctrlName);
            if (null != ctl &amp;&amp; ctl.ControlReference.Count &gt; 0) val = ctl.ControlReference[0];
            else
            {
                ControlContainer cnt = model.form.GetContainer(ctrlName);
                if (null != cnt &amp;&amp; cnt.ControlReference.Count &gt; 0) val = cnt.ControlReference[0];
            }
            return val;
        }

        object form_GetHostGridValue(string gridName, string fieldName, string instance, string pid, string parentid,
            string parentmodule, out string datatype, out string errors)
        {
            datatype = null;
            errors = null;
            object val = null;
            if (string.IsNullOrEmpty(gridName)) return null;
            ControlContainer ctl = model.form.GetContainer(gridName);
            XmlElement x = null;
            if (null != ctl &amp;&amp; ctl.ControlReference.Count &gt; 0) x = ctl.ControlReference[0] as XmlElement;
            if (null == x || x.ChildNodes.Count &lt; 1) return val;

            DynamicGrid dg = ctl as DynamicGrid;

            XmlNodeList nl = (&quot;0&quot; == instance)
                ? x.SelectNodes(&quot;Row&quot;)
                : x.SelectNodes(&quot;Row[&quot; + dg.PrimaryKeyName + &quot;=&quot; + instance + &quot;]&quot;);
            if (null == nl || nl.Count &lt; 1) return val;

            XmlNode nd = nl[0].SelectSingleNode(fieldName);
            if (null == nd) return val;

            val = nd.InnerXml;
            return val;
        }

        bool form_SetHostValue(string gridName, string fieldName, string datatype, object val, out string errors)
        {
            errors = null;
            bool bIsSet = false;
            string error = &quot;&quot;;
            SetControlValue(model, gridName, val, ref error);
            bIsSet = string.IsNullOrEmpty(error);
            return bIsSet;
        }

        bool form_SetHostGridValue(string gridName, string fieldName, string instance, string pid, string parentid,
            string parentmodule, string datatype, object val, out string errors)
        {
            errors = null;
            bool bIsSet = false;
            DynamicGrid dg = (model.form.GetContainer(gridName) as DynamicGrid);
            if (null == dg || !(dg is DynamicGrid) || dg.ControlReference == null || dg.ControlReference.Count &lt; 1)
            {
                errors += (&quot;Grid not found to set value: Grid=&quot; + gridName + &quot;,Field=&quot; + fieldName + &quot;,Instance=&quot; +
                           instance + &quot;,Pid=&quot; + pid + &quot;,Parent=&quot; + parentid + &quot;,ParentMod=&quot; + parentmodule);
                return false;
            }
            XmlElement allrows = (dg.ControlReference[0] as XmlElement);
            if (null == allrows)
            {
                errors += (&quot;Grid not found to set value: Grid=&quot; + gridName + &quot;,Field=&quot; + fieldName + &quot;,Instance=&quot; +
                           instance + &quot;,Pid=&quot; + pid + &quot;,Parent=&quot; + parentid + &quot;,ParentMod=&quot; + parentmodule);
                return false;
            }
            if (string.IsNullOrEmpty(instance))
            {
                errors += (&quot;Cannot set value for an null instance row: Grid=&quot; + gridName + &quot;,Field=&quot; + fieldName +
                           &quot;,Instance=&quot; + instance + &quot;,Pid=&quot; + pid + &quot;,Parent=&quot; + parentid + &quot;,ParentMod=&quot; +
                           parentmodule);
                return false;
            }
            XmlElement parentRow = null;
            if (&quot;0&quot; == instance)
            {
                XmlNodeList nl = allrows.SelectNodes(&quot;Row&quot;);
                parentRow = null == nl || nl.Count &lt; 1 ? null : (nl[0] as XmlElement);
            }
            else
            {
                XmlNode ndToUpdate = null;
                ndToUpdate = allrows.SelectSingleNode(&quot;Row[&quot; + dg.PrimaryKeyName + &quot; = &quot; + instance + &quot;]&quot;);
                parentRow = null == ndToUpdate ? null : ndToUpdate as XmlElement;
            }
            XmlNode cell = parentRow.SelectSingleNode(fieldName);
            if (null == cell)
                errors += (&quot;Error updating grid - cell not found: Grid=&quot; + gridName + &quot;,Field=&quot; + fieldName +
                           &quot;,Instance=&quot; + instance + &quot;,Pid=&quot; + pid + &quot;,Parent=&quot; + parentid + &quot;,ParentMod=&quot; +
                           parentmodule);
            else
                cell.InnerText = null == val ? &quot;&quot; : val.ToString();
            return bIsSet;
        }

        [HttpPost] //ASHISH
        public HttpResponseMessage GetFormTemplate(string moduleId, [FromBody] string jsonParameters)
        {
            UserDetail ud = CurrentUser.CurrentUserDetail;
            JObject result = MobileCacheManager.Instance.GetFormTemplate(moduleId, ud.UID, ud.RID, jsonParameters);
            if (result != null)
            {
                var response = this.Request.CreateResponse(HttpStatusCode.OK);
                response.Content = new StringContent(result.ToString(), Encoding.UTF8, &quot;application/json&quot;);
                return response;
            }
            else
                return this.Request.CreateResponse&lt;string&gt;(HttpStatusCode.BadRequest,
                    &quot;The user does not have permissions.&quot;);
        }

        [HttpGet] //ASHISH
        public HttpResponseMessage GetFormPickerData(string requestmessage, string jsonParameters)
        {
            GenericXMLPickerController pCont = new GenericXMLPickerController();
            JObject jObject = JObject.FromObject(pCont.GetFormPickerData(requestmessage));
            return Request.CreateResponse&lt;JObject&gt;(HttpStatusCode.Created, jObject);
        }

        [HttpPost]
        public HttpResponseMessage GetControlTemplate(string moduleId, [FromBody] string jsonParameters)
        {
            JsonObject result = new JsonObject();

            if (GetXMLControlTemplate(moduleId, jsonParameters, out result))
            {
                var response = this.Request.CreateResponse(HttpStatusCode.OK);
                response.Content = new StringContent(result.ToString(), Encoding.UTF8, &quot;application/json&quot;);
                return response;
            }
            else
                return this.Request.CreateResponse&lt;string&gt;(HttpStatusCode.BadRequest,
                    &quot;The user does not have permissions.&quot;);
        }

        private Dictionary&lt;string, string&gt; GetHelpFilesLink(JsonObject o)
        {
            Dictionary&lt;string, string&gt; links = new Dictionary&lt;string, string&gt;();
            //dynamic dyn = JsonConvert.DeserializeObject(o.ReadAs&lt;string&gt;());
            //foreach (var data in dyn.data)
            //{
            //    Console.WriteLine(&quot;{0} - {1}&quot;,
            //            data.filter,
            //            data.images.standard_resolution.url);
            //}
            return links;
        }

        private bool GetXMLControlTemplate(string moduleId, string jsonParameters, out JsonObject result)
        {
            result = new JsonObject();
            int projectID = 0;
            string fileName = &quot;&quot;;
            BrixFormModel model;
            JavaScriptSerializer js = new JavaScriptSerializer();
            Dictionary&lt;string, object&gt; jsonParams = string.IsNullOrEmpty(jsonParameters)
                ? new Dictionary&lt;string, object&gt;()
                : js.Deserialize&lt;Dictionary&lt;string, object&gt;&gt;(jsonParameters);
            projectID = Convert.ToInt32(jsonParams.ContainsKey(&quot;projectid&quot;) ? jsonParams[&quot;projectid&quot;].ToString() : &quot;0&quot;);
            if (moduleId == &quot;PROJECT&quot;)
            {
                projectID =
                    Convert.ToInt32(jsonParams.ContainsKey(&quot;projectid&quot;) ? jsonParams[&quot;projectid&quot;].ToString() : &quot;0&quot;);
                fileName = &quot;PRJ&quot; + projectID.ToString(&quot;D4&quot;) + &quot;.xml&quot;;
            }
            model = new BrixFormModel(moduleId, fileName, BusinessLayer.XmlForm_Framework.XMLType.Control);
            if (model != null &amp;&amp; model.form != null)
            {
                XMLRenderingEngine engine = new XMLRenderingEngine(null, model, null);
                engine.Render(RenderFormat.RenderMetaDataJSON);

                result = (model.form.Renderer as MetaDataJSONRenderer).MasterDoc;
            }
            return true;
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;moduleId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;pid&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;parentId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;jsonParameters&quot;&gt;this will contain any optional parammeter. If called from mobile then  isCalledFromMobile:true must be set as one of the param&lt;/param&gt;
        /// &lt;param name=&quot;lastSyncedAt&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;getCountOnly&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        [HttpGet] //ASHISH
        public HttpResponseMessage GetAllInstanceDetails(string moduleId, string pid, string parentId,
            string jsonParameters = &quot;&quot;, string lastSyncedAt = &quot;&quot;, bool getCountOnly = false, bool excludeFinalStage = true)
        {
            string startDate = DateTime.UtcNow.ToDateTimeString_InvariantCulture();
            BrixFormModel model = new BrixFormModel(moduleId, moduleId + &quot;.xml&quot;,
                BusinessLayer.XmlForm_Framework.XMLType.Form);
            JsonObject allInstanceDetails = new JsonObject();
            UserDetail ud = CurrentUser.CurrentUserDetail;

            var features = new List&lt;string&gt;();
            features.Add(&quot;View&quot;);

            if (model != null)
            {
                JavaScriptSerializer js = new JavaScriptSerializer();

                Dictionary&lt;string, object&gt; jsonParams = string.IsNullOrEmpty(jsonParameters)
                    ? new Dictionary&lt;string, object&gt;()
                    : js.Deserialize&lt;Dictionary&lt;string, object&gt;&gt;(jsonParameters);

                bool isCalledFromMobile = ((jsonParams.ContainsKey(&quot;isCalledFromMobile&quot;) &amp;&amp; jsonParams[&quot;isCalledFromMobile&quot;].ToString().ToUpper() == &quot;TRUE&quot; || !string.IsNullOrEmpty(lastSyncedAt)));
                string annotationForModuleLastSyncedAt = jsonParams.ContainsKey(&quot;annotationForModuleLastSyncedAt&quot;) ? jsonParams[&quot;annotationForModuleLastSyncedAt&quot;].ToString() : lastSyncedAt;
                int syncListPageSizeForMobile = int.MaxValue;
                if (isCalledFromMobile &amp;&amp; jsonParams.ContainsKey(&quot;syncListPageSize&quot;))
                {
                    syncListPageSizeForMobile = Convert.ToInt32(jsonParams[&quot;syncListPageSize&quot;]);
                }

                Dictionary&lt;string, object&gt; req = new Dictionary&lt;string, object&gt;(StringComparer.OrdinalIgnoreCase);
                req.Add(&quot;pid&quot;, pid);
                req.Add(&quot;parentid&quot;, parentId);
                req.Add(&quot;parentmodule&quot;, model.form.ParentModuleID);
                req.Add(&quot;iswebapi&quot;, &quot;true&quot;);
                req.Add(&quot;context&quot;, model.form.Name);
                req.Add(&quot;annotationformodulelastsyncedat&quot;, string.IsNullOrEmpty(annotationForModuleLastSyncedAt) ? &quot;EMPTY&quot; : annotationForModuleLastSyncedAt);

                model.form.RequestParameters = new Dictionary&lt;string, object&gt;(req, StringComparer.OrdinalIgnoreCase);

                var viewName = APIHelper.GetViewName(model);
                var whereCondition = APIHelper.BuildWhereCondition(model, viewName, req, null);

                allInstanceDetails = APIModuleHelper.GetListPageData(model.form.Name, model.form.ModuleID, model.form.AssociatedModuleID,
                    model.form.Header, model.form.PrimaryKeyName,
                    pid, viewName, whereCondition, req, lastSyncedAt, getCountOnly, model, isCalledFromMobile, syncListPageSizeForMobile, excludeFinalStage: excludeFinalStage );
            }
            var response = this.Request.CreateResponse(HttpStatusCode.OK);
            response.Content = new StringContent(allInstanceDetails.ToString(), Encoding.UTF8, &quot;application/json&quot;);
            response.Headers.Add(&quot;Request-Start&quot;, startDate);
            return response;
        }


        [HttpGet] //ASHISH
        public HttpResponseMessage GetInstanceDetails(string moduleId, string Id, string jsonParameters = &quot;&quot;,
            string lastSyncedAt = &quot;&quot;)
        {
            BrixFormModel model = new BrixFormModel(moduleId, moduleId + &quot;.xml&quot;,
                BusinessLayer.XmlForm_Framework.XMLType.Form);
            model.form.instanceID = Id;

            JsonObject j = APIModuleHelper.GetDetails(moduleId, Id, jsonParameters, model);

            var response = this.Request.CreateResponse(HttpStatusCode.OK);
            response.Content = new StringContent(j.ToString(), Encoding.UTF8, &quot;application/json&quot;);
            return response;
        }

        /// &lt;summary&gt;
        /// Gets multiple instance details
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;moduleId&quot;&gt;Module ID&lt;/param&gt;
        /// &lt;param name=&quot;Id&quot;&gt;Comma Separated Ids&lt;/param&gt;
        /// &lt;param name=&quot;jsonParameters&quot;&gt;JSON Request Params&lt;/param&gt;
        /// &lt;param name=&quot;lastSyncedAt&quot;&gt;Last Synced Date &amp; Time&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        [HttpPost]
        public HttpResponseMessage GetMultipleInstanceDetails([FromBody]string ids, string moduleId, string jsonParameters = &quot;&quot;)
        {
            BrixFormModel model = new BrixFormModel(moduleId, moduleId + &quot;.xml&quot;,
                BusinessLayer.XmlForm_Framework.XMLType.Form);

            Dictionary&lt;int, string&gt; instanceDetails = new Dictionary&lt;int, string&gt;();
            string[] instanceIds = ids.Split(new string[] { &quot;,&quot; }, StringSplitOptions.RemoveEmptyEntries);
            int instId = 0;
            foreach (string instanceId in instanceIds)
            {
                if (int.TryParse(instanceId, out instId) &amp;&amp; !instanceDetails.ContainsKey(instId))
                {
                    model.form.instanceID = instanceId;
                    JsonObject jInstanceDetails = APIModuleHelper.GetDetails(moduleId, instanceId, jsonParameters, model);
                    instanceDetails.Add(instId, jInstanceDetails.ToString());
                }
            }

            return this.Request.CreateResponse&lt;Dictionary&lt;int, string&gt;&gt;(HttpStatusCode.OK, instanceDetails);
        }




        [HttpPost] // ASHISH
        public HttpResponseMessage CreateOrUpdateInstance(string moduleId, string jsonReqParams,
            [FromBody] string jsonParameters)
        {
            string deletedAttchmentLinkIds = &quot;&quot;;
            try
            {
                var xdoc = new JsonObject();
                xdoc = (JsonObject)JsonValue.Parse(jsonParameters);
                xdoc[&quot;AUR_ModifiedOn&quot;] = DateTime.UtcNow.ToString(&quot;yyyy-MM-dd hh:mm:ss tt&quot;);
                jsonParameters = xdoc.ToString();
                var deletedAttachments = new JsonObject();
                if (xdoc.ContainsKey(&quot;deletedAttachment&quot;))
                {
                    deletedAttachments = (JsonObject)xdoc[&quot;deletedAttachment&quot;];
                    if (xdoc.ContainsKey(&quot;deletedAttachment&quot;))
                    {
                        deletedAttchmentLinkIds = deletedAttachments[&quot;LinkIds&quot;].ReadAs&lt;string&gt;();
                    }
                }
            }
            catch (Exception)
            {
            }
            BrixFormModel model = new BrixFormModel(moduleId, moduleId + &quot;.xml&quot;,
                BusinessLayer.XmlForm_Framework.XMLType.Form);

            UserDetail ud = CurrentUser.CurrentUserDetail;
            var XmlFormArgs = new XmlFormArgs();

            if (model != null)
            {
                JavaScriptSerializer js = new JavaScriptSerializer();
                object reqParams = js.DeserializeObject(jsonReqParams);
                Dictionary&lt;string, object&gt; dicReqParams = string.IsNullOrEmpty(jsonReqParams)
                    ? new Dictionary&lt;string, object&gt;(StringComparer.OrdinalIgnoreCase)
                    : new Dictionary&lt;string, object&gt;((reqParams as Dictionary&lt;string, object&gt;),
                        StringComparer.OrdinalIgnoreCase);
                model.form.RequestParameters = new Dictionary&lt;string, object&gt;(dicReqParams,
                    StringComparer.OrdinalIgnoreCase);


                //If the request params - jsonReqParams (dicReqParams) has instance id and the model&#39;s primary key column is 0 
                //Then update the model&#39;s primary key control with the correct instance id

                //This happens when the sync fails while creating a record and we sync again.

                string pid = dicReqParams.ContainsKey(&quot;pid&quot;) ? dicReqParams[&quot;pid&quot;].ToString() : &quot;0&quot;;
                string parentId = dicReqParams.ContainsKey(&quot;parentid&quot;)
                    ? dicReqParams[&quot;parentid&quot;].ToString()
                    : dicReqParams.ContainsKey(&quot;contractid&quot;) ? dicReqParams[&quot;contractid&quot;].ToString() : &quot;0&quot;;



                //check if contractid belongs to same project id
                object objContId = ComponentHelper.Instance.ExecuteScalar(StoredProcedure.usp_CONTMGTGetTopContract, null, pid);
                if (objContId != null &amp;&amp; objContId.ToString() != parentId) { throw new Exception(&quot;Contract doesn&#39;t belong to this project.&quot;); }

                if (dicReqParams.ContainsKey(&quot;instanceid&quot;))
                {
                    xControl xcPkColumn = model.form.GetControl(model.form.PrimaryKeyName);
                    string pkValue = xcPkColumn.GetServerValue();
                    if (xcPkColumn != null &amp;&amp; (string.IsNullOrEmpty(pkValue) || pkValue == &quot;0&quot;))
                        xcPkColumn.SetServerValue(dicReqParams[&quot;instanceid&quot;]);
                    model.form.instanceID = dicReqParams[&quot;instanceid&quot;].ToString();
                }

                XMLRenderingEngine engine = new XMLRenderingEngine(null, model, null);
                engine.Render(RenderFormat.RenderJSON);
                model.form.Renderer.DataSource = jsonParameters;

                try
                {
                    XMLFormManagerModel managerModel =
                        AMP3InterfaceFactory.GetInstance&lt;XMLFormManagerModel&gt;(model.form.ManagerDLL,
                            model.form.FormManagerClass);

                    if (managerModel != null)
                    {
                        managerModel.OnPreInit(model, XmlFormArgs);
                        managerModel.OnPageLoad(model, XmlFormArgs);
                        managerModel.BeforeSave(model, XmlFormArgs);

                        engine.ApplyChanges(RenderFormat.RenderMetaDataJSON);
                    }
                }
                catch
                {
                }


                if (!string.IsNullOrEmpty(XmlFormArgs.ErrorMessage))
                {
                    throw new Exception(XmlFormArgs.ErrorMessage);
                }



                string id = dicReqParams.ContainsKey(&quot;instanceid&quot;) ? dicReqParams[&quot;instanceid&quot;].ToString() : &quot;&quot;;
                bool IsCreate = string.IsNullOrEmpty(id) || id == &quot;0&quot;;


                IsCreate = getCreatePermissions(model, moduleId, ud, id, pid, IsCreate);

                engine.SaveData(model.form.Renderer.DataSource.ToString(), RenderFormat.RenderJSON);

                #region WORKFLOW

                string instanceId = model.form.instanceID;
                //below is the code to associate new workflow instance in case of new form instance
                //string refInfo = &quot;Referenced/Created from: &quot; + moduleId + &quot;, PID: &quot; + pid + &quot;, ParentId: &quot; + parentId + &quot;, CUD Instance: &quot; + instanceId;
                List&lt;Guid&gt; _WorkflowsInitiated = null;

                //Getting formkey

                var formKey = getFormKey(model);


                if (IsCreate &amp;&amp; !string.IsNullOrEmpty(instanceId))
                {
                    _WorkflowsInitiated = BrixWorkflowManager.Instance.TriggerWorkflow(TriggerPoint.TriggerActions[0],
                        model.form.Name, pid, parentId, &quot;&quot;, instanceId, formKey);

                    //No need to add the notes, the default notes is added by the workflow initializer.

                    //if (null != _WorkflowsInitiated &amp;&amp; _WorkflowsInitiated.Count &gt; 0)
                    //{
                    //string userInfo = &quot;Created By: &quot;;
                    //userInfo += ud.UserName;
                    //int uid = ud.UID;
                    //refInfo += userInfo;
                    //BrixWorkflowManager.Instance.CreateWorkflowNotes(0, string.Empty,
                    //    IsCreate ? &quot;Created New Form Resource&quot; : &quot;Updated Resource&quot;,
                    //    uid, null, _WorkflowsInitiated[0].ToString(), DateTime.UtcNow);
                    //}
                }
                BrixWorkflowManager.Instance.UpdateReferences(null, IsCreate ? &quot;Created&quot; : &quot;Updated&quot;,
                    moduleId, instanceId, pid, parentId, model.form.Name, instanceId, pid, parentId,
                    DateTime.UtcNow, &quot;&quot;,
                    null != _WorkflowsInitiated &amp;&amp; _WorkflowsInitiated.Count &gt; 0
                        ? _WorkflowsInitiated[0].ToString()
                        : &quot;&quot;,
                    IsCreate ? &quot;Creates&quot; : &quot;Update&quot;);

                #endregion

                XmlFormArgs XmlFormArgsAfterSave = new XmlFormArgs();

                if (!string.IsNullOrEmpty(model.form.ManagerDLL) &amp;&amp; !string.IsNullOrEmpty(model.form.FormManagerClass))
                {
                    try
                    {
                        XMLFormManagerModel managerModel =
                            AMP3InterfaceFactory.GetInstance&lt;XMLFormManagerModel&gt;(model.form.ManagerDLL,
                                model.form.FormManagerClass);

                        if (managerModel != null)
                        {
                            managerModel.AfterSave(model, XmlFormArgsAfterSave);
                        }
                    }
                    catch
                    {
                    }
                }
                //delete all deleted attachment
                List&lt;int&gt; list = new List&lt;int&gt;();

                foreach (string s in deletedAttchmentLinkIds.Split(&quot;,&quot;.ToArray(), StringSplitOptions.RemoveEmptyEntries)
                    )
                {
                    list.Add(s.ToInt32_2());
                }

                LinksManager.Instance.RemoveLinks(list);

                if (!string.IsNullOrEmpty(XmlFormArgsAfterSave.ErrorMessage))
                {
                    throw new Exception(XmlFormArgsAfterSave.ErrorMessage);
                }

                return Request.CreateResponse&lt;string&gt;(HttpStatusCode.Created, model.form.instanceID);
            }
            else
                throw new Exception(&quot;Error while creating XmlForm model&quot;);
        }

        private string getFormKey(BrixFormModel model)
        {
            try
            {
                XMLFormManagerModel managerModel =
                    AMP3InterfaceFactory.GetInstance&lt;XMLFormManagerModel&gt;(model.form.ManagerDLL,
                        model.form.FormManagerClass);

                if (!string.IsNullOrEmpty(model.form.FormKey))
                {
                    string key = string.Empty;

                    string strFormKey = model.form.FormKey;
                    string[] parts = strFormKey.Split(&#39;,&#39;);

                    foreach (string ctrl in parts)
                    {
                        xControl xc = model.form.GetControl(ctrl);
                        if (xc != null)
                        {
                            string value = xc.GetServerValue();
                            if (xc.Type == Aurigo.Brix.Platform.BusinessLayer.XMLForm.ControlType.Date &amp;&amp;
                                !string.IsNullOrEmpty(value))
                            {
                                //TO get the proper date time format before adding it to the formkey
                                string format = xc.Format;
                                if (format.ToLower() == &quot;datetime&quot;)
                                    format = AMP3ApplicationSettings.Instance.FORMAT_DATETIME;
                                else if (format.ToLower() == &quot;date&quot;)
                                    format = AMP3ApplicationSettings.Instance.FORMAT_DATE;

                                try
                                {
                                    DateTime tempDateTime;

                                    if (DateTime.TryParse(value, out tempDateTime))
                                    {
                                        value = tempDateTime.ToString(format);
                                    }
                                }
                                catch
                                {
                                }
                            }
                            key += ((string.IsNullOrEmpty(xc.Caption)
                                ? xc.Name
                                : (!string.IsNullOrEmpty(xc.ParseDynamicString(xc.Caption))
                                    ? xc.ParseDynamicString(xc.Caption).Replace(&quot;:&quot;, &quot;&quot;)
                                    : &quot;&quot;))
                                    + &quot; : &quot; + value ?? &quot;&quot;) + &quot;,&quot;;
                        }
                    }

                    return (string.IsNullOrEmpty(key)
                        ? string.IsNullOrEmpty(model.form.instanceID) ? &quot;-1&quot; : model.form.instanceID
                        : key.TrimEnd(&#39;,&#39;));
                }
                else if (managerModel != null &amp;&amp; !string.IsNullOrEmpty(managerModel.GetFormKey(model)))
                {
                    return managerModel.GetFormKey(model);
                }
                else
                    return model.form.instanceID;
            }
            catch (Exception)
            {
                return &quot;&quot;;
            }
        }

        [HttpPost]
        public HttpResponseMessage EvaluateFormulae(string moduleId, [FromBody] string jsonData)
        {
            BrixFormModel model = new BrixFormModel(moduleId, moduleId + &quot;.xml&quot;,
                BusinessLayer.XmlForm_Framework.XMLType.Form);
            var jsonSerialiser = new DataContractJsonSerializer(typeof(ajaxData));
            var stream1 = new MemoryStream();
            stream1.Write(Encoding.Unicode.GetBytes(jsonData), 0, Encoding.Unicode.GetBytes(jsonData).Length);
            stream1.Position = 0;
            var jsonParams = (ajaxData)jsonSerialiser.ReadObject(stream1);
            var result = xControl.EvaluateFormulae(jsonParams, model.form);

            return Request.CreateResponse&lt;string&gt;(HttpStatusCode.Created, result.ToString());
        }

        [HttpPost]
        public HttpResponseMessage NewOrUpdateInstance(string moduleId, [FromBody] string jsonParameters)
        {
            try
            {
                UserDetail ud = CurrentUser.CurrentUserDetail;

                CultureInfo ci = new CultureInfo(AMP3ApplicationSettings.Instance.Culture);
                Thread.CurrentThread.CurrentCulture = ci;
                Thread.CurrentThread.CurrentUICulture = ci;

                model = new BrixFormModel(XMLForms.GetXMLFormModuleID(moduleId), moduleId + &quot;.xml&quot;, XMLType.Form, null,
                    null);
                model.form.GetHostValue += new GetVal(form_GetHostValue);
                model.form.GetHostGridValue += new GetValFromGrid(form_GetHostGridValue);
                model.form.SetHostValue += new SetVal(form_SetHostValue);
                model.form.SetHostGridValue += new SetValInGrid(form_SetHostGridValue);

                JavaScriptSerializer js = new JavaScriptSerializer();
                Dictionary&lt;string, object&gt; jsonParams = string.IsNullOrEmpty(jsonParameters)
                    ? new Dictionary&lt;string, object&gt;()
                    : js.Deserialize&lt;Dictionary&lt;string, object&gt;&gt;(jsonParameters);
                Dictionary&lt;string, object&gt; formParams = jsonParams[moduleId] as Dictionary&lt;string, object&gt;;
                string id = null != formParams &amp;&amp; formParams.ContainsKey(model.form.PrimaryKeyName)
                    ? formParams[model.form.PrimaryKeyName].ToString()
                    : null;

                string sPid = formParams.ContainsKey(&quot;pid&quot;)
                    ? formParams[&quot;pid&quot;].ToString()
                    : (jsonParams.ContainsKey(&quot;pid&quot;) ? jsonParams[&quot;pid&quot;].ToString() : &quot;0&quot;);
                string sParentId = formParams.ContainsKey(&quot;parentid&quot;)
                    ? formParams[&quot;parentid&quot;].ToString()
                    : (jsonParams.ContainsKey(&quot;parentid&quot;) ? jsonParams[&quot;parentid&quot;].ToString() : &quot;0&quot;);
                string sParentMod = formParams.ContainsKey(&quot;parentmodule&quot;)
                    ? formParams[&quot;parentmodule&quot;].ToString()
                    : model.form.ParentModuleID;
                string sTriggerPid = jsonParams.ContainsKey(&quot;triggerpid&quot;) ? formParams[&quot;triggerpid&quot;].ToString() : sPid;
                string sTriggerParentId = jsonParams.ContainsKey(&quot;triggerparent&quot;)
                    ? formParams[&quot;triggerparent&quot;].ToString()
                    : sParentId;
                string sTriggerParentModule = jsonParams.ContainsKey(&quot;triggerparentmodule&quot;)
                    ? formParams[&quot;triggerparentmodule&quot;].ToString()
                    : sParentMod;
                string sTriggerModule = jsonParams.ContainsKey(&quot;triggermodule&quot;)
                    ? formParams[&quot;triggermodule&quot;].ToString()
                    : model.form.ModuleID;
                bool IsCreate = string.IsNullOrEmpty(id);
                IsCreate = getCreatePermissions(model, moduleId, ud, id, sPid, IsCreate);

                Dictionary&lt;string, object&gt; req = new Dictionary&lt;string, object&gt;();
                req.Add(&quot;pid&quot;, sPid);
                req.Add(&quot;parentid&quot;, sParentId);
                req.Add(&quot;parentmodule&quot;, sParentMod);
                req.Add(&quot;iswebapi&quot;, &quot;true&quot;);
                req.Add(&quot;context&quot;, model.form.Name);

                model.form.RequestParameters = new Dictionary&lt;string, object&gt;(req, StringComparer.OrdinalIgnoreCase);
                //see if the user is a stakeholder of the stage
                if (!IsCreate)
                {
                    bool bCanSave = AllowSave(moduleId, id, sPid, sParentId, IsCreate);
                    if (!bCanSave)
                        throw new Exception(&quot;The logged on user is not authorised to update this record at this stage.&quot;);
                }

                XmlElement root;
                var engine = new XMLRenderingEngine(null, model, null);
                if (!IsCreate) model.form.instanceID = id;
                engine.Render(RenderFormat.RenderXml);
                root = (model.form.Renderer as XmlRenderer).MasterDoc.DocumentElement;
                string err = &quot;&quot;;
                SetValuesFromJson(formParams, model, ref err);
                model.form.Renderer.DataSource = root.OuterXml;

                XMLFormManagerModel managerModel =
                    AMP3InterfaceFactory.GetInstance&lt;XMLFormManagerModel&gt;(model.form.ManagerDLL,
                        model.form.FormManagerClass);
                var formEvent = new XmlFormArgs();
                string sSavedInstanceToken = &quot;&quot;;
                if (managerModel != null)
                {
                    // &amp;&amp; managerModel is IFormManagerNonUI){
                    managerModel.BeforeSave(model, formEvent);
                }
                if (managerModel == null || (managerModel != null &amp;&amp; formEvent.IsValid))
                {
                    try
                    {
                        engine.SaveData(((model.form.Renderer as XmlRenderer).MasterDoc.OuterXml),
                            RenderFormat.RenderXml);
                        sSavedInstanceToken = model.form.instanceID;
                        if (IsCreate)
                        {
                            XmlNode nd = root.SelectSingleNode(&quot;/&quot; + moduleId + &quot;/&quot; + model.form.PrimaryKeyName);
                            if (null != nd) nd.InnerText = sSavedInstanceToken;
                        }
                    }
                    catch (Exception ex)
                    {
                        string sErrors = ex.Message.Replace(&quot;&#39;&quot;, &quot;&quot;).Replace(&quot;\n&quot;, &quot;&quot;).Replace(&quot;\r&quot;, &quot;&quot;);
                        if (sErrors.ToLower().Contains(&quot;violation of unique key constraint&quot;))
                            throw new Exception(&quot;This record already exists.&quot;);
                        else
                            throw new Exception(sErrors);
                    }
                }
                else if (!string.IsNullOrEmpty(formEvent.ErrorMessage))
                    throw new Exception(formEvent.ErrorMessage);
                else
                    throw new Exception(&quot;Cannot save the data.&quot;);

                try
                {
                    if (managerModel != null)
                    {
                        // &amp;&amp; managerModel is IFormManagerNonUI) {
                        managerModel.AfterSave(model, new XmlFormArgs());
                    }
                }
                catch (Exception)
                {
                }
                string sTriggerInstance = formParams.ContainsKey(&quot;triggerinstance&quot;)
                    ? formParams[&quot;triggerinstance&quot;].ToString()
                    : sSavedInstanceToken;

                //below is the code to associate new workflow instance in case of new form instance
                string refInfo = &quot;Referenced/Created from: &quot; + sTriggerModule + &quot;, PID: &quot; + sTriggerPid + &quot;, ParentId: &quot; +
                                 sTriggerParentId + &quot;, CUD Instance: &quot; + sSavedInstanceToken;
                List&lt;Guid&gt; _WorkflowsInitiated = null;
                if (IsCreate &amp;&amp; !string.IsNullOrEmpty(sSavedInstanceToken))
                {
                    _WorkflowsInitiated = BrixWorkflowManager.Instance.TriggerWorkflow(TriggerPoint.TriggerActions[0],
                        model.form.Name, sPid, sParentId, &quot;&quot;, sSavedInstanceToken);

                    //No need to add the notes, the default notes is added by the workflow initializer.

                    //if (null != _WorkflowsInitiated &amp;&amp; _WorkflowsInitiated.Count &gt; 0)
                    //{
                    //    string userInfo = &quot;Created By: &quot;;
                    //    userInfo += ud.UserName;
                    //    int uid = ud.UID;
                    //    refInfo += userInfo;
                    //    BrixWorkflowManager.Instance.CreateWorkflowNotes(0, refInfo,
                    //        IsCreate ? &quot;Created New Form Resource&quot; : &quot;Updated Resource&quot;,
                    //        uid, null, _WorkflowsInitiated[0].ToString(), DateTime.UtcNow);
                    //}
                }
                BrixWorkflowManager.Instance.UpdateReferences(null, IsCreate ? &quot;Created&quot; : &quot;Updated&quot;,
                    sTriggerModule, sTriggerInstance, sTriggerPid, sTriggerParentId, model.form.Name,
                    sSavedInstanceToken, sPid, sParentId,
                    DateTime.UtcNow, &quot;&quot;,
                    null != _WorkflowsInitiated &amp;&amp; _WorkflowsInitiated.Count &gt; 0
                        ? _WorkflowsInitiated[0].ToString()
                        : &quot;&quot;,
                    IsCreate ? &quot;Creates&quot; : &quot;Update&quot;);

                return Request.CreateResponse&lt;XmlElement&gt;(HttpStatusCode.Created, root);
            }
            catch (Exception ex)
            {
                XmlDocument xmlDoc = new XmlDocument();
                xmlDoc.LoadXml(&quot;&lt;Error&gt;&quot; + ex.Message + &quot;&lt;/Error&gt;&quot;);
                return Request.CreateResponse&lt;XmlElement&gt;(HttpStatusCode.BadRequest, xmlDoc.DocumentElement);
            }
        }

        private bool getCreatePermissions(BrixFormModel model, string moduleId, UserDetail ud, string id, string sPid,
            bool IsCreate)
        {
            List&lt;string&gt; permissions =
                ModuleManager.Instance.GetPermissionByUserOrRole(
                    string.IsNullOrEmpty(model.form.AssociatedModuleID) ? moduleId : model.form.AssociatedModuleID,
                    ud.UID, ud.RID, sPid.ToInt32_2());


            if (permissions == null) throw new Exception(&quot;The user does not have permissions.&quot;);
            if (IsCreate &amp;&amp; !permissions.Contains(&quot;Create&quot;)) throw new Exception(&quot;The user does not have permissions.&quot;);
            if (!IsCreate &amp;&amp; !permissions.Contains(&quot;Edit&quot;)) throw new Exception(&quot;The user does not have permissions.&quot;);
            return IsCreate;
        }

        [HttpPost]
        public HttpResponseMessage DeleteInstance(string moduleId, string ids, [FromBody] string jsonParameters)
        {
            try
            {
                UserDetail ud = CurrentUser.CurrentUserDetail;

                CultureInfo ci = new CultureInfo(AMP3ApplicationSettings.Instance.Culture);
                Thread.CurrentThread.CurrentCulture = ci;
                Thread.CurrentThread.CurrentUICulture = ci;

                model = new BrixFormModel(XMLForms.GetXMLFormModuleID(moduleId), moduleId + &quot;.xml&quot;, XMLType.Form, null,
                    null);
                model.form.GetHostValue += new GetVal(form_GetHostValue);
                model.form.GetHostGridValue += new GetValFromGrid(form_GetHostGridValue);
                model.form.SetHostValue += new SetVal(form_SetHostValue);
                model.form.SetHostGridValue += new SetValInGrid(form_SetHostGridValue);

                JavaScriptSerializer js = new JavaScriptSerializer();
                Dictionary&lt;string, object&gt; jsonParams = string.IsNullOrEmpty(jsonParameters)
                    ? new Dictionary&lt;string, object&gt;()
                    : js.Deserialize&lt;Dictionary&lt;string, object&gt;&gt;(jsonParameters);

                string sPid = jsonParams.ContainsKey(&quot;pid&quot;) ? jsonParams[&quot;pid&quot;].ToString() : &quot;0&quot;;
                string sParentId = jsonParams.ContainsKey(&quot;parentid&quot;) ? jsonParams[&quot;parentid&quot;].ToString() : &quot;0&quot;;
                string sParentMod = jsonParams.ContainsKey(&quot;parentmodule&quot;)
                    ? jsonParams[&quot;parentmodule&quot;].ToString()
                    : model.form.ParentModuleID;

                List&lt;string&gt; permissions =
                    ModuleManager.Instance.GetPermissionByUserOrRole(
                        string.IsNullOrEmpty(model.form.AssociatedModuleID) ? moduleId : model.form.AssociatedModuleID,
                        ud.UID, ud.RID, sPid.ToInt32_2());

                if (permissions == null) throw new Exception(&quot;The user does not have permissions.&quot;);
                if (!permissions.Contains(&quot;Delete&quot;)) throw new Exception(&quot;The user does not have permissions.&quot;);

                Dictionary&lt;string, object&gt; req = new Dictionary&lt;string, object&gt;();
                req.Add(&quot;pid&quot;, sPid);
                req.Add(&quot;parentid&quot;, sParentId);
                req.Add(&quot;parentmodule&quot;, sParentMod);
                req.Add(&quot;iswebapi&quot;, &quot;true&quot;);
                req.Add(&quot;context&quot;, model.form.Name);

                model.form.RequestParameters = new Dictionary&lt;string, object&gt;(req, StringComparer.OrdinalIgnoreCase);

                string errors;
                HandleDelete(model, ids, moduleId, sPid, sParentId, out errors);

                XmlDocument xmlDoc = new XmlDocument();
                if (!string.IsNullOrEmpty(errors)) xmlDoc.LoadXml(&quot;&lt;Result&gt;&quot; + errors + &quot;&lt;/Result&gt;&quot;);
                else xmlDoc.LoadXml(&quot;&lt;Result&gt;Delete succeeded with no errors&lt;/Result&gt;&quot;);

                return Request.CreateResponse&lt;XmlDocument&gt;(HttpStatusCode.Accepted, xmlDoc);
            }
            catch (Exception ex)
            {
                XmlDocument xmlDoc = new XmlDocument();
                xmlDoc.LoadXml(&quot;&lt;Error&gt;&quot; + ex.Message + &quot;&lt;/Error&gt;&quot;);
                return Request.CreateResponse&lt;XmlElement&gt;(HttpStatusCode.BadRequest, xmlDoc.DocumentElement);
            }
        }


        [HttpGet] //ASHISH
        public HttpResponseMessage GetModifySyncDataParams(string moduleId, string addParams,
            [FromBody] string jsonParameters)
        {
            BrixFormModel model = new BrixFormModel(moduleId, moduleId + &quot;.xml&quot;,
                BusinessLayer.XmlForm_Framework.XMLType.Form);
            if (jsonParameters == null || jsonParameters == &quot;&quot;)
            {
                jsonParameters = addParams;
            }
            JavaScriptSerializer js = new JavaScriptSerializer();
            Dictionary&lt;string, object&gt; jsonParams = string.IsNullOrEmpty(jsonParameters)
                ? new Dictionary&lt;string, object&gt;(StringComparer.OrdinalIgnoreCase)
                : js.Deserialize&lt;Dictionary&lt;string, object&gt;&gt;(jsonParameters);
            model.form.RequestParameters = new Dictionary&lt;string, object&gt;(jsonParams, StringComparer.OrdinalIgnoreCase);
            DataSet ds = new DataSet();
            if (moduleId == &quot;DBINSRT&quot; || moduleId == &quot;DBCANIN&quot;)
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(&quot;exec usp_MCPMSTCGetDailyBendingInspectionGridRollingNumber {0}&quot;,
                        model.form.RequestParameters[&quot;pid&quot;].ToInt32_2());
            }

            return Request.CreateResponse&lt;DataSet&gt;(HttpStatusCode.OK, ds);
        }

        public static void HandleDelete(BrixFormModel xmlModel, string selectedIds, string ModuleId, string pid,
            string parentid, out string errors)
        {
            errors = &quot;&quot;;
            selectedIds = ListModel.FilterIdsToDeleteBasedOnWFDefinitions(ModuleId, pid, parentid, selectedIds);

            string toBeDeleted = string.Empty;
            if (null == ConfigurationManager.AppSettings[&quot;DonotDeleteFormsInWorkflow&quot;])
                toBeDeleted = selectedIds;
            else
            {
                string[] allIds = selectedIds.Trim(&#39;,&#39;).Split(&#39;,&#39;);
                DataTable dt = BrixWorkflowManager.Instance.GetWorkflowMappingDetails(selectedIds, ModuleId);
                DataRow[] dRows = dt.Select(&quot;IsCompleted=False&quot;);
                string notToBeDeleted = &quot;,&quot;;
                foreach (DataRow dr in dRows)
                {
                    if (null != dr[&quot;FormInstanceID&quot;]) notToBeDeleted += dr[&quot;FormInstanceID&quot;] + &quot;,&quot;;
                }

                foreach (string id in allIds)
                {
                    if (!notToBeDeleted.Contains(&quot;,&quot; + id + &quot;,&quot;)) toBeDeleted += id + &quot;,&quot;;
                }

                if (!string.IsNullOrEmpty(notToBeDeleted.Trim(&#39;,&#39;)))
                    errors = &quot;Instances running under workflow can not be deleted.&quot;;
            }
            foreach (ControlContainer c in xmlModel.form.Containers)
            {
                DeleteChildTableRows(toBeDeleted, c);
            }

            if (xmlModel.form.AllowAttachments)
            {
                string[] ids = toBeDeleted.Trim(&#39;,&#39;).Split(new[] { &#39;,&#39; });
                foreach (string id in ids)
                    ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                        StoredProcedure.usp_LINKMODDeleteALink, null, id, xmlModel.form.Name, 1);
            }

            string[] toBedeletedIds = toBeDeleted.Split(&#39;,&#39;);
            foreach (string id in toBedeletedIds)
            {
                DataTable checkInstanceId =
                    CoreDatabaseHelper.GenericLibraryGetData(xmlModel.form.ActualTableNameInDatabase, xmlModel.form.PrimaryKeyName, id.ToInt32_2());
                if (checkInstanceId.Rows.Count == 0)
                    throw new Exception(&quot;Invalid instance id &quot; + id + &quot; for ModuleId &quot; + ModuleId);
            }
            int iDeleted =
                CoreDatabaseHelper.GenericLibraryDelete(xmlModel.form.ActualTableNameInDatabase, xmlModel.form.PrimaryKeyName, toBeDeleted.Trim(&#39;,&#39;));
            ListModel.ForceDeleteWorkflowsForThisForm(toBeDeleted, ModuleId);
        }

        public static void DeleteChildTableRows(string toBeDeleted, ControlContainer c)
        {
            if (c.GetType().IsSubclassOf(typeof(DataBaseContainer)))
                DeleteRows(toBeDeleted, c);
            else
                foreach (ControlContainer cc in c.Containers) DeleteChildTableRows(toBeDeleted, cc);
        }

        public static void DeleteRows(string toBeDeleted, ControlContainer c)
        {
            var dc = c as DataBaseContainer;
            List&lt;xControl&gt; fks = dc.GetForeignKeyControls();
            string foriegnKey = string.Empty;

            if (fks != null)
                foreach (xControl xc in fks)
                {
                    if (xc.Type == Brix.Platform.BusinessLayer.XMLForm.ControlType.Hidden &amp;&amp; xc.ForeignKey)
                    {
                        foriegnKey = xc.Name;
                        break;
                    }
                }
            if (!string.IsNullOrEmpty(foriegnKey))
                CoreDatabaseHelper.GenericLibraryDelete(dc.TableName, foriegnKey, toBeDeleted.Trim(&#39;,&#39;));
        }

        private void SetValuesFromJson(Dictionary&lt;string, object&gt; instance, BrixFormModel model, ref string err)
        {
            foreach (string element in instance.Keys)
            {
                object obj = instance[element];
                if (obj == null) continue;
                if (obj.GetType().IsGenericType)
                {
                    DynamicGrid dg = (model.form.GetContainer(element) as DynamicGrid);
                    if (null != dg &amp;&amp; dg is DynamicGrid)
                    {
                        XmlElement allrows = (dg.ControlReference[0] as XmlElement);
                        //dg.ControlReference.Count &lt;1 ? new XmlElement() :
                        if (instance[element] is List&lt;object&gt;)
                        {
                            List&lt;object&gt; rowsToBeUpdated1 = instance[element] as List&lt;object&gt;;
                            foreach (object row in rowsToBeUpdated1)
                                UpdateRow(dg, allrows, row);
                        }
                        else
                        {
                            Dictionary&lt;string, object&gt; rowsToBeUpdated2 =
                                instance[element] as Dictionary&lt;string, object&gt;;
                            foreach (string rowKey in rowsToBeUpdated2.Keys)
                            {
                                if (rowsToBeUpdated2[rowKey] is ArrayList)
                                {
                                    ArrayList al = rowsToBeUpdated2[rowKey] as ArrayList;
                                    foreach (object rw in al) UpdateRow(dg, allrows, rw);
                                }
                                else
                                    UpdateRow(dg, allrows, rowsToBeUpdated2[rowKey]);
                            }
                        }
                        XmlNodeList nl = null == allrows ? null : allrows.SelectNodes(&quot;Row&quot;);
                        if (null != nl &amp;&amp; nl.Count &gt; 0)
                        {
                            List&lt;string&gt; primariesToRemove = new List&lt;string&gt;();
                            foreach (XmlNode nd in nl)
                            {
                                XmlNode pr = nd.SelectSingleNode(dg.PrimaryKeyName);
                                if (null == pr) continue;

                                string primaryKeyVal = pr.InnerText;
                                bool bRemove = true;
                                Dictionary&lt;string, object&gt; dRow = null;
                                if (instance[element] is List&lt;object&gt;)
                                {
                                    List&lt;object&gt; rowsToBeUpdated1 = instance[element] as List&lt;object&gt;;
                                    foreach (object row in rowsToBeUpdated1)
                                    {
                                        dRow = row as Dictionary&lt;string, object&gt;;
                                        if (primaryKeyVal.Equals(dRow[dg.PrimaryKeyName] as string,
                                            StringComparison.CurrentCultureIgnoreCase))
                                        {
                                            bRemove = false;
                                            break;
                                        }
                                    }
                                    if (bRemove) primariesToRemove.Add(primaryKeyVal);
                                    break;
                                }
                                else
                                {
                                    Dictionary&lt;string, object&gt; rowsToBeUpdated2 =
                                        instance[element] as Dictionary&lt;string, object&gt;;
                                    foreach (string rowKey in rowsToBeUpdated2.Keys)
                                    {
                                        if (rowsToBeUpdated2[rowKey] is ArrayList)
                                        {
                                            ArrayList al = rowsToBeUpdated2[rowKey] as ArrayList;
                                            foreach (object rw in al)
                                            {
                                                dRow = rw as Dictionary&lt;string, object&gt;;
                                                if (primaryKeyVal.Equals(dRow[dg.PrimaryKeyName] as string,
                                                    StringComparison.CurrentCultureIgnoreCase))
                                                {
                                                    bRemove = false;
                                                    break;
                                                }
                                            }
                                            if (bRemove) primariesToRemove.Add(primaryKeyVal);
                                            break;
                                        }
                                        else
                                        {
                                            dRow = rowsToBeUpdated2[rowKey] as Dictionary&lt;string, object&gt;;
                                            if (primaryKeyVal.Equals(dRow[dg.PrimaryKeyName] as string,
                                                StringComparison.CurrentCultureIgnoreCase))
                                                bRemove = false;
                                            if (bRemove) primariesToRemove.Add(primaryKeyVal);
                                        }
                                    }
                                }
                            }
                            foreach (string toRemove in primariesToRemove)
                            {
                                XmlNode nd =
                                    allrows.SelectSingleNode(&quot;Row[&quot; + dg.PrimaryKeyName + &quot; = &quot; + toRemove + &quot;]&quot;);
                                if (null != nd) allrows.RemoveChild(nd);
                            }
                        }
                    }
                    else
                        SetValuesFromJson(instance[element] as Dictionary&lt;string, object&gt;, model, ref err);
                }
                else
                {
                    SetControlValue(model, element, obj, ref err);
                }
            }
        }

        private static void SetControlValue(BrixFormModel model, string element, object obj, ref string err)
        {
            ControlContainer ct = model.form.GetControl(element);
            XmlElement ele = null == ct || null == ct.ControlReference || ct.ControlReference.Count &lt; 1
                ? null
                : (ct.ControlReference[0] as XmlElement);
            if (null == ele) err += &quot;element &#39;&quot; + element + &quot;&#39; not found&quot;;
            else ele.InnerText = obj.ToString();
        }

        private static void UpdateRow(DynamicGrid dg, XmlElement allrows, object row)
        {
            Dictionary&lt;string, object&gt; rowDic = row as Dictionary&lt;string, object&gt;;
            object pkToBeUpdated = rowDic.ContainsKey(dg.PrimaryKeyName) ? rowDic[dg.PrimaryKeyName] : null;
            bool bCreateNew = false;
            if (null != pkToBeUpdated &amp;&amp; !string.IsNullOrEmpty(pkToBeUpdated.ToString()))
            {
                XmlNode rowToUpdate =
                    allrows.SelectSingleNode(&quot;Row[&quot; + dg.PrimaryKeyName + &quot; = &quot; + pkToBeUpdated.ToString() + &quot;]&quot;);
                if (null == rowToUpdate) bCreateNew = true;
                else
                    foreach (string colKey in rowDic.Keys)
                    {
                        XmlNode cell = rowToUpdate.SelectSingleNode(colKey);
                        if (null != rowDic[colKey]) cell.InnerText = rowDic[colKey].ToString();
                    }
            }
            else bCreateNew = true;
            if (bCreateNew)
            {
                XmlElement rowToUpdate = allrows.OwnerDocument.CreateElement(&quot;Row&quot;);
                foreach (string colKey in rowDic.Keys)
                {
                    XmlNode cell = allrows.OwnerDocument.CreateElement(colKey);
                    if (null != rowDic[colKey]) cell.InnerText = rowDic[colKey].ToString();
                    rowToUpdate.AppendChild(cell);
                }
                allrows.AppendChild(rowToUpdate);
            }
        }

        public static DataSet GetDataSet(ListModel lm, ref int pageno, string SortKey,
            Dictionary&lt;string, object&gt; FilterCriterion, int PageSize, bool sortAsc, out ArrayList columns,
            out int pagecount)
        {
            if (!String.IsNullOrEmpty(SortKey) &amp;&amp;
                (SortKey.Contains(&quot;WF_Status&quot;) || SortKey.Contains(&quot;WF_PendingOnRole&quot;)))
            {
                SortKey = &quot;&quot;;
            }

            string filter = GetFilterString(lm, FilterCriterion);

            string sortOrder = string.IsNullOrEmpty(SortKey)
                ? &quot;&quot;
                : ((SortKey.Contains(&quot;[&quot;) ? SortKey : (&quot; [&quot; + SortKey + &quot;]&quot;)) + (sortAsc ? &quot; ASC &quot; : &quot; DESC &quot;));
            DataSet dtSet = lm.GetList(PageSize, sortOrder, filter, ref pageno, out pagecount);
            if (dtSet == null)
                dtSet = (DataSet)lm.GetList(PageSize, sortOrder, filter, ref pageno, out pagecount, true);

            columns = null;
            if (dtSet != null &amp;&amp; dtSet.Tables.Count &gt; 0)
            {
                ArrayList dataBaseColumns = new ArrayList();
                foreach (DataColumn dc in dtSet.Tables[0].Columns)
                    dataBaseColumns.Add(dc.ColumnName);
                columns = dataBaseColumns;
            }
            return dtSet;
        }

        public static string GetFilterString(ListModel lm, Dictionary&lt;string, object&gt; dFilter)
        {
            StringBuilder filter = new StringBuilder();
            Dictionary&lt;string, object&gt; andFilters = dFilter.ContainsKey(&quot;andfilters&quot;)
                ? dFilter[&quot;andfilters&quot;] as Dictionary&lt;string, object&gt;
                : new Dictionary&lt;string, object&gt;();
            Dictionary&lt;string, object&gt; orFilters = dFilter.ContainsKey(&quot;orfilters&quot;)
                ? dFilter[&quot;orfilters&quot;] as Dictionary&lt;string, object&gt;
                : new Dictionary&lt;string, object&gt;();
            filter.Append(&quot;&lt;XMLRoot&gt;&quot;);
            foreach (string flStr in andFilters.Keys)
            {
                BrixFilter f1 = new BrixFilter();
                f1.Name = flStr;
                lm.CreateFilterXml(filter, f1, andFilters[flStr] as string, &quot;txt&quot;);
            }

            filter.Append(&quot;&lt;/XMLRoot&gt;&quot;);

            return CoreDatabaseHelper.FormatFilterText(filter.ToString());
        }

        public static bool AllowSave(string formName, string instancid, string pid, string parentid, bool bIsCreate)
        {
            if (string.IsNullOrEmpty(formName)) return false;

            if (string.IsNullOrEmpty(instancid) || instancid == &quot;-1&quot; || bIsCreate)
            {
                //For New Case we need to show the save button only if user has create permission
                bool bHasPerm = false;
                try
                {
                    ///we need a better solution here - the form value will return 
                    ///xcontext while permissions are defined on legacy context
                    //List&lt;string&gt; perms = ModuleManager.Instance.GetPermissionByRole(form, CurrentUser.CurrentUserDetail.RID);
                    //if (null != perms &amp;&amp; perms.Contains(&quot;Create&quot;)) bHasPerm = true;
                    bHasPerm = true;
                }
                catch
                {
                }
                return bHasPerm;
            }

            bool bIsWorkflowAssociatedatFormLevel = BrixWorkflowManager.Instance.IsWorkflowAssociated(formName, pid,
                parentid);
            if (!bIsWorkflowAssociatedatFormLevel)
            {
                //If workflow is not attach then we need to show the save button
                return true;
            }

            //CurrentUser.CurrentUserDetail.RoleName
            DataTable dt = BrixWorkflowManager.Instance.GetWorkflowMappingDetails(instancid, formName);
            List&lt;string&gt; stakeHolders = new List&lt;string&gt;();
            if (dt.Rows.Count &gt; 0)
                for (int i = 0; i &lt; dt.Rows.Count; i++)
                {
                    bool bIsComplete = DBNull.Value == dt.Rows[i][&quot;IsCompleted&quot;]
                        ? false
                        : dt.Rows[i][&quot;IsCompleted&quot;].ToString() == &quot;True&quot;;
                    if (bIsComplete) continue;
                    string[] roles = DBNull.Value == dt.Rows[i][&quot;CurrentRole&quot;]
                        ? null
                        : dt.Rows[i][&quot;CurrentRole&quot;].ToString().Split(&#39;,&#39;);
                    if (null == roles) continue;
                    stakeHolders.AddRange(roles);
                }

            Dictionary&lt;string, bool?&gt; dicHasRoleToPlay = new Dictionary&lt;string, bool?&gt;();
            bool _CanAddSaveButton = false;

            foreach (string stakeHolderRole in stakeHolders)
            {
                if (string.IsNullOrEmpty(stakeHolderRole)) continue;
                if (dicHasRoleToPlay.ContainsKey(stakeHolderRole.ToLower()))
                {
                    if (dicHasRoleToPlay[stakeHolderRole.ToLower()] == true)
                        _CanAddSaveButton = true;
                    continue;
                }

                bool bHasRoleToPlay = UserManager.Instance.IsUserRole(CurrentUser.CurrentUserDetail.UID,
                    UserManager.Instance.GetUsersRoleId(stakeHolderRole));
                dicHasRoleToPlay.Add(stakeHolderRole.ToLower(), bHasRoleToPlay);
                if (bHasRoleToPlay) _CanAddSaveButton = true;
            }
            return _CanAddSaveButton;
        }

        [HttpGet]
        public HttpResponseMessage GetModuleTableCreationScript(string formName)
        {
            model = new BrixFormModel(XMLForms.GetXMLFormModuleID(formName), formName + &quot;.xml&quot;, XMLType.Form, null, null);
            if (model != null)
            {
                string script = model.CreateScript() + &quot; GO &quot;;
                if (!string.IsNullOrEmpty(script))
                {
                    var resp = Request.CreateResponse&lt;string&gt;(HttpStatusCode.OK, script);
                    return resp;
                }
                else
                    return null;
            }
            else
                return null;
        }

        [HttpGet]
        public HttpResponseMessage GetModuleViewCreationScript(string formName)
        {
            model = new BrixFormModel(XMLForms.GetXMLFormModuleID(formName), formName + &quot;.xml&quot;, XMLType.Form, null, null);
            if (model != null)
            {
                string script = model.form.DropViewQuery() + &quot; GO &quot; + model.form.CreateViewQuery() + &quot; GO &quot;;
                if (!string.IsNullOrEmpty(script))
                {
                    var resp = Request.CreateResponse&lt;string&gt;(HttpStatusCode.OK, script);
                    return resp;
                }
                else
                    return null;
            }
            else
                return null;
        }

        [HttpPost]
        public Task&lt;HttpResponseMessage&gt; GetModuleTableCreationScript()
        {
            var folderName = &quot;tempUploads&quot;;
            var PATH = HttpContext.Current.Server.MapPath(&quot;~/&quot; + folderName);
            if (!Directory.Exists(PATH))
                Directory.CreateDirectory(PATH);
            var streamProvider = new MultipartFormDataStreamProvider(PATH);
            var task = Request.Content.ReadAsMultipartAsync(streamProvider).ContinueWith&lt;HttpResponseMessage&gt;(t =&gt;
            {
                MultipartFileData fileData = streamProvider.FileData.First();

                if (fileData != null)
                {
                    var info = new FileInfo(fileData.LocalFileName);
                    while (IsFileLocked(info))
                    {
                        Thread.Sleep(1000);
                    }
                    byte[] byts = File.ReadAllBytes(fileData.LocalFileName);
                    try
                    {
                        model = new BrixFormModel(new MemoryStream(byts), XMLType.Form, null, null);
                        if (model != null &amp;&amp; model.form.InstantiateTable)
                        {
                            string script = model.CreateScript() + &quot;\r\nGO\r\n&quot;;
                            if (!string.IsNullOrEmpty(script))
                            {
                                var resp = Request.CreateResponse&lt;string&gt;(HttpStatusCode.OK, script);
                                return resp;
                            }
                            else
                                return Request.CreateResponse&lt;string&gt;(HttpStatusCode.OK, null);
                        }
                        else
                            return Request.CreateResponse&lt;string&gt;(HttpStatusCode.OK, null);
                    }
                    catch (Exception)
                    {
                        return Request.CreateResponse&lt;string&gt;(HttpStatusCode.OK, null);
                        ;
                    }
                }
                else
                    return Request.CreateResponse&lt;string&gt;(HttpStatusCode.OK, null);
            });
            return task;
        }

        [HttpPost]
        public Task&lt;HttpResponseMessage&gt; GetModuleViewCreationScript()
        {
            var folderName = &quot;tempUploads&quot;;
            var PATH = HttpContext.Current.Server.MapPath(&quot;~/&quot; + folderName);
            if (!Directory.Exists(PATH))
                Directory.CreateDirectory(PATH);
            var streamProvider = new MultipartFormDataStreamProvider(PATH);
            var task = Request.Content.ReadAsMultipartAsync(streamProvider).ContinueWith&lt;HttpResponseMessage&gt;(t =&gt;
            {
                MultipartFileData fileData = streamProvider.FileData.First();

                if (fileData != null)
                {
                    var info = new FileInfo(fileData.LocalFileName);
                    while (IsFileLocked(info))
                    {
                        Thread.Sleep(1000);
                    }
                    byte[] byts = File.ReadAllBytes(fileData.LocalFileName);
                    try
                    {
                        model = new BrixFormModel(new MemoryStream(byts), XMLType.Form, null, null);
                        if (model != null &amp;&amp; model.form.InstantiateTable)
                        {
                            string script = model.form.DropViewQuery() + &quot; \r\nGO\r\n &quot; + model.form.CreateViewQuery() +
                                            &quot; \r\nGO\r\n &quot;;
                            if (!string.IsNullOrEmpty(script))
                            {
                                var resp = Request.CreateResponse&lt;string&gt;(HttpStatusCode.OK, script);
                                return resp;
                            }
                            else
                                return Request.CreateResponse&lt;string&gt;(HttpStatusCode.OK, null);
                        }
                        else
                            return Request.CreateResponse&lt;string&gt;(HttpStatusCode.OK, null);
                    }
                    catch (Exception)
                    {
                        return Request.CreateResponse&lt;string&gt;(HttpStatusCode.OK, null);
                    }
                }
                else
                    return Request.CreateResponse&lt;string&gt;(HttpStatusCode.OK, null);
            });
            return task;
        }

        protected bool IsFileLocked(FileInfo file)
        {
            FileStream stream = null;

            try
            {
                stream = file.Open(FileMode.Open, FileAccess.ReadWrite, FileShare.None);
            }
            catch (IOException)
            {
                //the file is unavailable because it is:
                //still being written to
                //or being processed by another thread
                //or does not exist (has already been processed)
                return true;
            }
            finally
            {
                if (stream != null)
                    stream.Close();
            }

            //file is not locked
            return false;
        }

        [HttpGet]
        public HttpResponseMessage GetProjectDetails(string lastSyncedAt = &quot;&quot;, bool calledFromEstimate = false, string projectIds = &quot;&quot;)
        {
            string startDate = DateTime.UtcNow.ToDateTimeString_InvariantCulture();
            UserDetail ud = CurrentUser.CurrentUserDetail;

            #region UserUsage

            if (!calledFromEstimate)
            {
                UserUsage userUsage = new UserUsage();
                userUsage.UserID = ud.UID;
                userUsage.UserName = ud.UserName;
                userUsage.Url = HttpContext.Current.Request.RawUrl;
                userUsage.IP = HttpContext.Current.Request.ServerVariables[&quot;REMOTE_ADDR&quot;];
                userUsage.TimeDt = DateTime.UtcNow.ToDateTime_MWCulture();
                userUsage.Comment = &quot;Getting Project Details&quot;;
                userUsage.SessionID = HttpContext.Current.Session.SessionID;
                userUsage.Module = &quot;MOBILE&quot;;
                userUsage.Role = ud.RoleName;
                userUsage.CompanyCode = ConnectionHelper.GetCurrentCompany();
                userUsage.UserEmail = ud.Email;
                userUsage.MobileSyncRequestGuid = Request.Headers.Contains(&quot;SyncRequestGuid&quot;) ?
                    Request.Headers.GetValues(&quot;SyncRequestGuid&quot;).First() :
                    string.Empty;

                EnterpriseManager.Instance.CreateUpdateUserUsage(userUsage);
            }

            #endregion

            bool hasPlanning = ModuleManager.Instance.GetModuleList().ContainsKey(Constants.MODID_PLANING);

            string filter = !hasPlanning ? &quot;&lt;XMLRoot&gt;&quot; : string.Empty;
            if (!string.IsNullOrEmpty(lastSyncedAt))
            {
                if (!hasPlanning)
                {
                    filter += &quot;&lt;ModifiedOn&gt;&quot; + lastSyncedAt + &quot;&lt;/ModifiedOn&gt;&quot;;
                }
                else
                {
                    //We need to check if the project has been modified or users/roles has been modifed
                    //Which ever is greatest get that value and compare against the last synced date
                    filter = &quot;( 1=1 and CONVERT(datetime,(case when Cast(ISNULL(AUR_ModifiedOn,CreateDate) as datetime) &gt; Cast(PU_AUR_ModifiedOn as datetime) then  Cast(ISNULL(AUR_ModifiedOn,CreateDate)as VARCHAR(100)) else  Cast(PU_AUR_ModifiedOn as VARCHAR(100)) end),121) &gt; &#39;&quot; + lastSyncedAt + &quot;&#39;)&quot;;
                }
            }


            //If the comma seperated project ids are passed to the method, then this is a paginated estimate for sync and for server version &gt;= 3
            if (!string.IsNullOrEmpty(projectIds))
            {
                if (!hasPlanning)
                    filter += &quot;&lt;FilterProjectByIds&gt;&quot; + projectIds + &quot;&lt;/FilterProjectByIds&gt;&quot;;
                else
                    filter += (string.IsNullOrEmpty(filter) ? string.Empty : &quot; and &quot;) + &quot;( ProjectId IN (select ID from dbo.fnSplitToInt(&#39;&quot; + projectIds + &quot;&#39;)) )&quot;;
            }

            if (!hasPlanning)
                filter += &quot;&lt;/XMLRoot&gt;&quot;;

            DataSet ds = new DataSet();
            //check if Planning module is enabled if not get all projects elese get planned projects.
            if (!hasPlanning)
            {
                ds.Merge(ProjectManager.Instance.GetProjectsWithFeaturePermission(ud.UID, ud.RID,
                Constants.MODFEAT_VISIBILITY, &quot;PROJECT&quot;, 0, int.MaxValue, &quot;[ProjectId] ASC&quot;, filter, &quot;&quot;));
            }
            else
            {
                ds.Merge(ProjectManager.Instance.GetPlanningProjectsWithFeaturePermission(ud.UID, ud.RID,
                Constants.MODFEAT_VISIBILITY, &quot;PROJECT&quot;, 0, int.MaxValue, &quot;[ProjectId] ASC&quot;, filter, &quot;&quot;, 0));
            }

            bool hasRows = true;
            DataTable dt = ModifyResultDataSet(null, ref hasRows, false, 0, ds);


            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0)
            {
                if (!dt.Columns.Contains(&quot;DetailsData&quot;))
                    dt.Columns.Add(&quot;DetailsData&quot;);
                foreach (DataRow row in dt.Rows)
                {
                    HttpResponseMessage projDetails = InstanceDetails(&quot;XPROJCT&quot;, row[&quot;ProjectId&quot;].ToString(), &quot;{}&quot;,
                        lastSyncedAt);


                    string details = projDetails.Content.ReadAsStringAsync().Result;
                    row[&quot;DetailsData&quot;] = details;
                }
            }

            DataSet dsInstances = new DataSet();

            dsInstances.Tables.Add(dt.Copy());

            if (!calledFromEstimate)
            {
                DataSet dsInstancesIds = new DataSet();

                //check if Planning module is enabled if not get all projects else get planned projects.
                if (!hasPlanning)
                {
                    dsInstancesIds.Merge(ProjectManager.Instance.GetProjectsWithFeaturePermission(ud.UID, ud.RID,
                        Constants.MODFEAT_VISIBILITY, &quot;PROJECT&quot;, 0, int.MaxValue, &quot;[ProjectId] ASC&quot;, &quot;&quot;, &quot;&quot;));
                }
                else
                {
                    dsInstancesIds.Merge(ProjectManager.Instance.GetPlanningProjectsWithFeaturePermission(ud.UID, ud.RID,
                  Constants.MODFEAT_VISIBILITY, &quot;PROJECT&quot;, 0, int.MaxValue, &quot;[ProjectId] ASC&quot;, &quot;&quot;, &quot;&quot;, 0));
                }

                if (dsInstancesIds != null &amp;&amp; dsInstancesIds.Tables.Count &gt; 0)
                {
                    DataTable dtIDs = new DataTable();
                    dtIDs.TableName = &quot;InstanceIDS&quot;;
                    dtIDs.Columns.Add(&quot;InstanceId&quot;);
                    foreach (DataRow row in dsInstancesIds.Tables[0].Rows)
                    {
                        DataRow dr = dtIDs.NewRow();
                        dr[&quot;InstanceId&quot;] = row[&quot;ProjectId&quot;].ToString();
                        dtIDs.Rows.Add(dr);
                    }

                    dsInstances.Tables.Add(dtIDs);
                }
            }

            var response = Request.CreateResponse&lt;DataSet&gt;(HttpStatusCode.OK, dsInstances);
            response.Headers.Add(&quot;Request-Start&quot;, startDate);
            return response;

            //if (!calledFromEstimate)
            //{
            //    if (ds != null &amp;&amp; ds.Tables.Count &gt; 0)
            //    {
            //        DataTable dtIDs = new DataTable();
            //        dtIDs.TableName = &quot;InstanceIDS&quot;;
            //        dtIDs.Columns.Add(&quot;InstanceId&quot;);
            //        foreach (DataRow row in ds.Tables[0].Rows)
            //        {
            //            DataRow dr = dtIDs.NewRow();
            //            dr[&quot;InstanceId&quot;] = row[&quot;ProjectId&quot;].ToString();
            //            dtIDs.Rows.Add(dr);
            //        }

            //        dsInstances.Tables.Add(dtIDs);
            //    }
            //}
            //var response = Request.CreateResponse&lt;DataSet&gt;(HttpStatusCode.OK, dsInstances);
            //response.Headers.Add(&quot;Request-Start&quot;, startDate);
            //return response;
        }

        //Wrapper function for  GetEstimatedDownloadSize with POST
        [HttpPost]
        public HttpResponseMessage GetEstimatedDownloadSizePost(string userName, string lastSynchedAt,
            [FromBody] string jsonParameters, string projectIds = &quot;&quot;)
        {
            return GetEstimatedDownloadSize(userName, lastSynchedAt, jsonParameters, projectIds);
        }


        [HttpGet]
        public HttpResponseMessage GetEstimatedDownloadSize(string userName = &quot;&quot;, string lastSynchedAt = &quot;&quot;,
            string moduleSyncTime = &quot;&quot;, string projectIds = &quot;&quot;)
        {
            string startDate = DateTime.UtcNow.ToDateTimeString_InvariantCulture();
            UserDetail ud = CurrentUser.CurrentUserDetail;

            #region UserUsage

            UserUsage userUsage = new UserUsage();
            userUsage.UserID = ud.UID;
            userUsage.UserName = ud.UserName;
            userUsage.Url = HttpContext.Current.Request.RawUrl;
            userUsage.IP = HttpContext.Current.Request.ServerVariables[&quot;REMOTE_ADDR&quot;];
            userUsage.TimeDt = DateTime.UtcNow.ToDateTime_MWCulture();
            userUsage.Comment = &quot;Getting Estimates&quot;;
            userUsage.SessionID = HttpContext.Current.Session.SessionID;
            userUsage.Module = &quot;MOBILE&quot;;
            userUsage.Role = ud.RoleName;
            userUsage.CompanyCode = ConnectionHelper.GetCurrentCompany();
            userUsage.UserEmail = ud.Email;

            EnterpriseManager.Instance.CreateUpdateUserUsage(userUsage);

            #endregion

            DataSet dsEstimate = APIModuleHelper.GetEstimateEmptyDataSet();

            JavaScriptSerializer js = new JavaScriptSerializer();
            Dictionary&lt;string, string&gt; moduleSyncDic = (string.IsNullOrEmpty(moduleSyncTime) || moduleSyncTime == &quot;{}&quot;)
                ? new Dictionary&lt;string, string&gt;()
                : js.Deserialize&lt;Dictionary&lt;string, string&gt;&gt;(moduleSyncTime);


            HttpResponseMessage response = GetProjectDetails(null, true, projectIds);
            var result = response.Content.ReadAsAsync&lt;DataSet&gt;();
            DataSet dsProjects = result.Result; //First table has details and second table has instanceids

            string annotationDetails = &quot;&quot;;
            if (moduleSyncDic.ContainsKey(&quot;AnnotationDetails&quot;))
            {
                annotationDetails = moduleSyncDic[&quot;AnnotationDetails&quot;];
            }

            if (dsProjects.Tables.Count &gt; 0)
            {
                var dtProjectDetails = dsProjects.Tables[0];
                EstimateDetails estimateCounts = new EstimateDetails();


                //Dictionary&lt;string, BrixFormModel&gt; dicXmlModels = new Dictionary&lt;string, BrixFormModel&gt;();
                IProvider _provider = AppProviderManager.Instance.GetProvider(&quot;BRIXProvider&quot;,
                    ConnectionHelper.GetCurrentCompany());

                DataTable dtEstimateSummary = dsEstimate.Tables[&quot;Summary&quot;];
                DataTable dtEstimateTotalRecordsSummary = dsEstimate.Tables[&quot;TotalRecordsSummary&quot;];

                foreach (DataRow row in dtProjectDetails.Rows) //for each project 
                {
                    var detailsData = row[&quot;DetailsData&quot;];
                    if (detailsData != null &amp;&amp; !string.IsNullOrEmpty(detailsData.ToString()))
                    {
                        object objProjectId = row[&quot;ProjectID&quot;];
                        if (objProjectId != null &amp;&amp; objProjectId != DBNull.Value)
                        {
                            int projectId = row[&quot;ProjectID&quot;].ToInt32_2();
                            int contractId = projectId;

                            //If contract  module is there, then we need to get the contract id

                            #region Get Contract ID - Not tested

                            try
                            {
                                JObject objDetails = JObject.Parse(detailsData.ToString());
                                JObject objPrj = JObject.Parse(objDetails[&quot;XPROJCT&quot;].ToString());

                                object objCont = objPrj[&quot;Contracts&quot;];

                                if (objCont != null &amp;&amp; objCont.ToString() != &quot;&quot;)
                                {
                                    if ((objCont as JObject)[&quot;Row&quot;] is JArray)
                                    {
                                        var contractRow = ((objCont as JObject)[&quot;Row&quot;] as JArray)[0];
                                        contractId = (contractRow[&quot;ID&quot;] as JValue).ToString2().ToInt32_2();
                                    }
                                    else if ((objCont as JObject)[&quot;Row&quot;] is JObject)
                                    {
                                        contractId = (((objCont as JObject)[&quot;Row&quot;] as JObject)[&quot;ID&quot;] as JValue).ToString2().ToInt32_2();
                                    }
                                }
                            }
                            catch (Exception ex)
                            {
                                return Request.CreateResponse&lt;string&gt;(HttpStatusCode.InternalServerError, ex.Message);
                            }

                            #endregion

                            //To Get the drawer template

                            #region Get Drawer Template

                            MobileCacheData cacheManager = new MobileCacheData();
                            cacheManager.PID = projectId;
                            cacheManager.ParentID = contractId;
                            cacheManager.ModuleID = &quot;xprojct&quot;;
                            cacheManager.TemplateType = MobileCacheTemplateType.DrawerTemplate.ToString();


                            string drawerTemplate = MobileCacheManager.Instance.GetMobileCacheData(cacheManager, ud.UID,
                                ud.RID, null);

                            #endregion

                            //Get all Modules based on the drawer template

                            #region Get Modules List

                            JObject objTemplate = JObject.Parse(drawerTemplate);
                            JObject objConmods = JObject.Parse(objTemplate[&quot;CONMODS&quot;].ToString());
                            JObject objModules = JObject.Parse(objConmods[&quot;Modules&quot;].ToString());
                            object objRow = objModules[&quot;Row&quot;];

                            List&lt;string&gt; moduleList = new List&lt;string&gt;();

                            if (objRow is JArray) //Multiple rows 
                            {
                                JArray modules = (objRow as JArray);
                                for (int i = 0; i &lt; modules.Count; i++)
                                {
                                    moduleList.Add(modules[i][&quot;ModuleID&quot;].ToString());
                                }
                            }
                            else if (objRow is JObject) //Only one row
                            {
                                if ((objRow as JObject)[&quot;ModuleID&quot;] != null)
                                {
                                    moduleList.Add((objRow as JObject)[&quot;ModuleID&quot;].ToString());
                                }
                            }

                            #endregion

                            //For each module, get the number of records

                            #region Get Record Count and Size

                            foreach (string module in moduleList)
                            {
                                if (_provider != null &amp;&amp; module != &quot;DOCMGMT&quot;)
                                    APIModuleHelper.GetModuleDetails(lastSynchedAt, moduleSyncDic, estimateCounts, _provider, dtEstimateSummary, dtEstimateTotalRecordsSummary, objProjectId, projectId, contractId, module, annotationDetails);
                            }

                            #endregion
                        }
                    }
                }

                //Build the final JSON and send it to client

                #region Build Final JSON

                APIModuleHelper.GetEstimateSummaryDetails(dsEstimate, estimateCounts);

                //IF the project ids are being passed, then its the server API version 3 and above
                //If its 3 and above then the request guid is passed in the GetEstimatedDownloadSizeProjectList API
                //Hence no need to send it here

                if (string.IsNullOrEmpty(projectIds))
                {
                    DataTable dtRequestDetails = new DataTable(&quot;RequestGuid&quot;);
                    dtRequestDetails.Columns.Add(new DataColumn(&quot;SyncRequestGuid&quot;));
                    DataRow rowRequestDetails = dtRequestDetails.NewRow();
                    rowRequestDetails[&quot;SyncRequestGuid&quot;] = Guid.NewGuid().ToString();
                    dtRequestDetails.Rows.Add(rowRequestDetails);
                    dsEstimate.Tables.Add(dtRequestDetails);
                }

                #endregion
            }

            var downloadResponse = Request.CreateResponse&lt;DataSet&gt;(HttpStatusCode.OK, dsEstimate);
            downloadResponse.Headers.Add(&quot;Request-Start&quot;, startDate);
            return downloadResponse;
        }


        [HttpGet]
        public HttpResponseMessage GetEstimatedDownloadSizeProjectList(string userName)
        {
            UserDetail ud = CurrentUser.CurrentUserDetail;
            string startDate = DateTime.UtcNow.ToDateTimeString_InvariantCulture();
            string filter = string.Empty;

            DataSet ds = new DataSet();
            //check if Planning module is enabled if not get all projects elese get planned projects.
            if (!ModuleManager.Instance.GetModuleList().ContainsKey(Constants.MODID_PLANING))
            {
                ds.Merge(ProjectManager.Instance.GetProjectsWithFeaturePermission(ud.UID, ud.RID,
                Constants.MODFEAT_VISIBILITY, &quot;PROJECT&quot;, 0, int.MaxValue, &quot;[ProjectId] ASC&quot;, filter, &quot;&quot;));
            }
            else
            {
                ds.Merge(ProjectManager.Instance.GetPlanningProjectsWithFeaturePermission(ud.UID, ud.RID,
                Constants.MODFEAT_VISIBILITY, &quot;PROJECT&quot;, 0, int.MaxValue, &quot;[ProjectId] ASC&quot;, filter, &quot;&quot;, 0));
            }

            JsonObject projDetails = new JsonObject();
            JsonArray projectIds = new JsonArray();
            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0 &amp;&amp; ds.Tables[0].Columns.Contains(&quot;ProjectId&quot;))
            {
                foreach (DataRow row in ds.Tables[0].Rows)
                {
                    projectIds.Add(row[&quot;ProjectId&quot;].ToInt32_2());
                }
            }

            projDetails.Add(&quot;ProjectIds&quot;, projectIds);
            projDetails.Add(&quot;SyncRequestGuid&quot;, Guid.NewGuid().ToString());

            var projectListResponse = Request.CreateResponse(HttpStatusCode.OK, projDetails.ToString());

            return projectListResponse;
        }

        [HttpGet]
        public HttpResponseMessage Return1KBFile()
        {
            //DownloadSpeed
            var filePath = HttpContext.Current.Server.MapPath(&quot;/images/DownloadSpeed.png&quot;);
            HttpResponseMessage result = new HttpResponseMessage(HttpStatusCode.OK);
            var stream = new FileStream(filePath, FileMode.Open);
            stream.Position = 0;
            result.Content = new StreamContent(stream);
            result.Content.Headers.ContentType =
                new MediaTypeHeaderValue(&quot;application/octet-stream&quot;);
            return result;
        }

        [HttpGet]
        public HttpResponseMessage Return20KBFile()
        {
            //DownloadSpeed
            var filePath = HttpContext.Current.Server.MapPath(&quot;/images/DownloadSpeed20.png&quot;);
            HttpResponseMessage result = new HttpResponseMessage(HttpStatusCode.OK);
            var stream = new FileStream(filePath, FileMode.Open);
            stream.Position = 0;
            result.Content = new StreamContent(stream);
            result.Content.Headers.ContentType =
                new MediaTypeHeaderValue(&quot;application/octet-stream&quot;);
            return result;
        }

        [HttpGet]
        public HttpResponseMessage Return40KBFile()
        {
            //DownloadSpeed
            var filePath = HttpContext.Current.Server.MapPath(&quot;/images/DownloadSpeed40.png&quot;);
            HttpResponseMessage result = new HttpResponseMessage(HttpStatusCode.OK);
            var stream = new FileStream(filePath, FileMode.Open);
            stream.Position = 0;
            result.Content = new StreamContent(stream);
            result.Content.Headers.ContentType =
                new MediaTypeHeaderValue(&quot;application/octet-stream&quot;);
            return result;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[58,9,58,10,0],[59,13,59,37,0],[60,13,60,33,0],[61,13,61,57,0],[62,13,62,48,0],[64,13,64,99,0],[65,13,65,49,0],[66,13,66,14,0],[67,17,67,32,0],[68,21,68,109,0],[70,21,70,85,0],[73,13,73,76,0],[74,9,74,10,0],[78,9,78,10,1],[79,13,79,35,1],[80,13,80,32,1],[81,13,81,23,1],[82,13,82,24,1],[83,13,83,41,1],[85,13,85,59,1],[87,13,87,66,1],[88,13,91,55,1],[93,13,93,88,1],[94,13,94,54,1],[95,13,95,56,1],[97,13,97,123,1],[99,13,101,52,1],[102,13,104,52,1],[106,13,106,78,1],[106,79,106,117,0],[107,13,107,88,1],[108,17,108,65,0],[109,13,109,54,1],[109,55,109,110,1],[110,13,110,53,1],[112,13,115,100,1],[117,13,117,111,1],[118,13,118,14,0],[119,17,119,34,0],[120,17,120,70,0],[121,17,121,33,0],[124,13,124,32,1],[125,13,125,80,1],[126,17,126,78,0],[128,13,128,31,1],[129,13,129,82,1],[130,17,130,80,0],[132,13,132,44,1],[133,13,133,86,1],[134,17,134,92,0],[136,13,136,84,1],[137,17,137,84,1],[139,13,139,31,1],[140,13,140,95,1],[141,13,141,46,1],[142,13,142,35,1],[143,13,143,35,1],[144,13,144,14,1],[145,17,145,81,1],[146,17,146,37,1],[147,13,147,14,1],[149,13,149,70,1],[150,13,150,14,0],[151,17,152,36,0],[153,13,153,14,0],[155,13,155,14,1],[156,17,156,36,1],[156,37,156,118,1],[157,17,157,18,0],[158,21,159,111,0],[160,17,160,18,0],[162,17,162,18,1],[163,21,164,108,1],[165,17,165,18,1],[168,13,168,14,1],[170,13,170,37,1],[171,13,171,14,1],[172,17,172,104,1],[173,17,173,32,1],[174,17,174,18,1],[176,21,176,66,1],[177,21,177,28,1],[177,30,177,40,1],[177,41,177,43,1],[177,44,177,51,1],[178,21,178,22,1],[179,25,179,92,1],[180,25,180,32,1],[180,34,180,48,1],[180,49,180,51,1],[180,52,180,62,1],[181,29,181,74,1],[182,25,182,39,1],[183,21,183,22,1],[184,17,184,18,1],[185,13,185,14,1],[186,13,186,29,1],[187,9,187,10,1],[200,9,200,10,1],[201,13,201,48,1],[202,13,202,87,1],[203,13,203,41,1],[204,13,204,42,1],[205,13,205,55,1],[207,13,207,42,1],[209,13,209,117,1],[211,13,211,28,1],[212,13,212,36,1],[213,13,213,14,0],[214,17,214,43,0],[216,17,216,116,0],[217,17,217,44,0],[219,17,219,33,0],[220,13,220,14,0],[221,13,221,23,1],[222,9,222,10,1],[227,9,227,10,1],[228,13,228,84,1],[230,13,230,37,1],[231,13,231,33,1],[232,13,232,57,1],[233,13,233,44,1],[235,13,237,57,1],[238,13,238,103,1],[239,13,239,14,1],[240,17,240,53,1],[241,17,241,18,1],[242,21,242,54,1],[243,21,243,36,1],[244,21,244,22,1],[245,25,245,86,1],[246,25,246,72,1],[248,25,248,67,1],[249,25,249,63,1],[250,25,250,68,1],[251,25,251,26,0],[252,29,252,75,0],[253,29,253,59,0],[253,59,253,81,0],[253,81,253,100,0],[253,29,253,100,0],[254,29,254,76,0],[255,25,255,26,0],[257,25,257,48,1],[259,25,259,78,1],[260,25,260,66,1],[261,25,261,72,1],[262,25,262,58,1],[263,25,263,103,1],[265,25,265,71,1],[267,25,268,43,1],[269,25,269,76,1],[270,25,270,26,1],[271,29,271,90,1],[272,29,272,58,1],[273,29,273,54,1],[275,29,275,71,1],[276,33,276,83,1],[278,33,278,113,0],[280,29,280,36,1],[280,38,280,50,0],[280,51,280,53,1],[280,54,280,59,1],[281,29,281,30,0],[282,33,282,61,0],[283,29,283,30,0],[284,25,284,26,1],[286,25,286,52,1],[287,25,287,52,1],[288,25,288,47,1],[289,25,289,26,0],[290,29,290,105,0],[291,29,291,70,0],[293,29,293,75,0],[294,29,294,63,0],[295,29,295,70,0],[297,29,298,55,0],[300,29,300,105,0],[301,29,301,70,0],[303,29,303,66,0],[304,29,304,63,0],[305,29,306,61,0],[307,29,308,55,0],[309,25,309,26,0],[311,25,314,63,1],[316,25,316,87,1],[317,25,317,108,1],[318,25,318,74,1],[320,25,320,41,1],[322,17,322,18,0],[323,13,323,14,0],[325,13,325,80,0],[326,13,329,56,0],[330,13,330,67,0],[332,13,332,34,0],[333,9,333,10,1],[338,9,338,10,1],[339,13,339,36,1],[341,13,341,86,1],[342,13,342,14,1],[343,17,343,53,1],[346,21,346,22,1],[347,25,347,148,1],[348,25,348,144,1],[349,25,349,151,1],[351,25,351,106,1],[352,25,352,105,1],[353,25,353,102,1],[354,25,354,101,1],[355,25,355,109,1],[356,25,356,108,1],[357,21,357,22,1],[358,21,358,26,0],[358,27,358,28,0],[358,29,358,30,0],[359,17,359,104,1],[363,17,363,107,0],[364,9,364,10,1],[368,9,368,10,0],[369,13,369,98,0],[370,13,370,44,0],[372,17,372,122,0],[374,17,375,38,0],[376,9,376,10,0],[380,9,380,10,0],[381,13,381,101,0],[382,13,382,44,0],[384,17,384,117,0],[386,17,386,117,0],[387,9,387,10,0],[391,9,391,10,0],[392,13,392,109,0],[393,13,393,55,0],[394,13,401,16,0],[402,13,402,20,0],[402,22,402,37,0],[402,38,402,40,0],[402,41,402,48,0],[403,13,403,14,0],[404,17,404,97,0],[405,17,405,43,0],[406,17,406,18,0],[407,21,407,58,0],[408,21,408,48,0],[409,21,409,38,0],[410,21,410,48,0],[411,21,411,55,0],[412,21,412,52,0],[413,21,413,49,0],[414,17,414,18,0],[415,13,415,14,0],[416,13,416,88,0],[417,9,417,10,0],[421,9,421,10,0],[422,13,422,89,0],[423,13,423,43,0],[424,13,424,53,0],[425,13,425,51,0],[426,13,427,98,0],[428,13,428,32,0],[429,13,429,42,0],[430,13,430,58,0],[431,13,431,47,0],[432,13,432,43,0],[433,13,433,14,0],[434,17,434,44,0],[435,17,435,47,0],[436,17,437,92,0],[438,17,440,21,0],[440,21,440,22,0],[440,22,441,25,0],[441,25,441,92,0],[441,92,442,25,0],[442,25,442,26,0],[442,26,443,29,0],[443,29,443,45,0],[443,45,444,25,0],[444,25,444,26,0],[444,26,445,25,0],[445,25,445,47,0],[445,47,446,29,0],[446,29,446,71,0],[446,71,447,33,0],[447,33,447,52,0],[447,52,448,21,0],[448,21,448,22,0],[448,22,448,24,0],[438,17,448,24,0],[450,17,450,40,0],[451,17,451,18,0],[452,21,452,101,0],[454,21,454,72,0],[455,21,455,22,0],[456,25,460,83,0],[461,25,461,80,0],[462,25,462,60,0],[463,29,463,72,0],[464,25,464,59,0],[465,29,465,82,0],[466,21,466,22,0],[468,25,468,94,0],[470,21,470,81,0],[472,21,472,62,0],[473,21,473,63,0],[475,21,475,59,0],[476,21,476,22,0],[477,25,477,89,0],[478,25,482,73,0],[484,25,484,32,0],[484,34,484,44,0],[484,45,484,47,0],[484,48,484,65,0],[485,25,485,26,0],[486,29,486,74,0],[487,29,487,84,0],[488,29,488,30,0],[489,33,490,76,0],[491,33,491,100,0],[492,33,492,34,0],[493,37,494,121,0],[495,37,495,90,0],[497,37,497,86,0],[498,37,498,38,0],[499,41,504,104,0],[505,37,505,38,0],[507,37,507,114,0],[508,37,508,38,0],[509,41,509,102,0],[511,41,511,112,0],[512,41,512,77,0],[514,41,514,82,0],[516,41,516,48,0],[516,50,516,67,0],[516,68,516,70,0],[516,71,516,91,0],[517,41,517,42,0],[518,45,518,83,0],[519,45,519,85,0],[520,45,520,46,0],[521,49,521,109,0],[522,45,522,46,0],[523,45,523,98,0],[524,45,524,117,0],[525,45,525,46,0],[526,49,526,103,0],[527,49,528,114,0],[529,49,529,50,0],[530,53,530,70,0],[531,49,531,50,0],[532,49,536,66,0],[537,45,537,46,0],[538,41,538,42,0],[540,41,540,67,0],[541,41,543,70,0],[544,41,545,114,0],[546,41,546,95,0],[549,46,549,55,0],[549,57,549,106,0],[549,108,549,111,0],[550,41,550,42,0],[551,45,551,120,0],[553,45,553,79,0],[554,49,554,119,0],[556,49,557,79,0],[558,41,558,42,0],[560,41,560,75,0],[561,37,561,38,0],[562,33,562,34,0],[563,29,563,30,0],[564,25,564,26,0],[565,21,565,22,0],[567,21,567,61,0],[568,21,568,62,0],[569,17,569,18,0],[570,13,570,14,0],[571,13,571,31,0],[572,9,572,10,0],[576,9,576,10,0],[577,13,577,40,0],[579,13,579,93,0],[581,13,581,75,0],[582,9,582,10,0],[587,9,587,10,1],[588,13,588,24,1],[590,13,590,14,1],[591,17,591,63,1],[593,17,593,70,1],[594,17,596,82,1],[598,17,598,92,1],[599,17,599,58,1],[600,17,600,60,1],[604,17,604,18,1],[605,21,606,37,1],[607,17,607,18,1],[608,17,608,37,0],[609,17,609,18,0],[611,21,611,58,0],[612,21,612,22,0],[613,25,613,63,0],[614,25,614,65,0],[615,29,615,77,0],[617,25,617,74,0],[618,25,618,122,0],[619,25,619,97,0],[620,25,620,26,0],[621,29,621,116,0],[623,29,623,36,0],[623,38,623,48,0],[623,49,623,51,0],[623,52,623,77,0],[624,29,624,30,0],[625,33,626,90,0],[627,33,627,34,0],[628,37,628,59,0],[629,37,629,77,0],[630,37,630,38,0],[632,41,632,42,0],[633,45,635,113,0],[636,45,636,77,0],[637,41,637,42,0],[638,41,638,46,0],[639,41,639,42,0],[641,41,641,42,0],[642,37,642,38,0],[643,37,643,51,0],[644,37,644,38,0],[645,41,648,82,0],[649,41,649,53,0],[650,37,650,38,0],[651,33,651,34,0],[652,29,652,30,0],[653,29,653,60,0],[654,29,654,68,0],[655,29,655,50,0],[657,29,657,42,0],[658,29,658,41,0],[661,25,661,26,0],[662,29,662,68,0],[663,29,663,81,0],[664,29,664,42,0],[665,29,665,42,0],[668,17,668,18,0],[670,17,670,74,1],[671,17,671,90,1],[672,17,672,74,1],[673,17,673,88,1],[675,17,678,91,1],[680,17,680,41,1],[680,42,680,101,0],[681,17,681,51,1],[681,52,681,111,0],[684,17,684,72,1],[685,17,685,44,1],[686,17,686,55,1],[687,17,687,71,1],[689,17,689,54,1],[690,17,690,18,0],[692,21,692,118,0],[694,21,694,35,0],[695,21,695,70,0],[696,21,696,93,0],[697,21,697,22,0],[698,25,698,32,0],[698,34,698,44,0],[698,45,698,47,0],[698,48,698,73,0],[699,25,699,26,0],[700,29,701,84,0],[702,29,702,30,0],[703,33,705,119,0],[707,33,707,70,0],[708,33,708,51,0],[709,33,709,72,0],[711,33,711,59,0],[712,29,712,30,0],[713,25,713,26,0],[714,21,714,22,0],[716,21,716,67,0],[717,21,717,88,0],[718,21,718,28,0],[718,30,718,37,0],[718,38,718,40,0],[718,41,718,48,0],[719,21,719,22,0],[720,25,720,95,0],[721,25,721,35,0],[722,25,722,32,0],[722,34,722,48,0],[722,49,722,51,0],[722,52,722,56,0],[723,25,723,26,0],[724,29,725,117,0],[726,29,728,83,0],[730,29,731,116,0],[732,29,732,30,0],[733,33,733,56,0],[734,33,734,49,0],[735,29,735,30,0],[736,29,736,33,0],[737,25,737,26,0],[738,21,738,22,0],[741,21,741,28,0],[741,30,741,38,0],[741,39,741,41,0],[741,42,741,51,0],[742,21,742,22,0],[743,25,743,56,0],[744,21,744,22,0],[745,21,745,28,0],[745,30,745,38,0],[745,39,745,41,0],[745,42,745,54,0],[746,21,746,22,0],[747,25,747,96,0],[749,25,749,62,0],[750,21,750,22,0],[751,17,751,18,0],[753,17,753,28,1],[754,17,754,29,1],[756,13,756,33,0],[757,13,757,14,0],[758,17,758,56,0],[759,17,759,69,0],[760,17,760,30,0],[761,17,761,30,0],[763,9,763,10,1],[766,9,766,10,0],[775,13,776,212,0],[777,13,777,35,0],[778,17,778,29,0],[780,17,780,30,0],[781,9,781,10,0],[785,9,785,10,0],[786,13,786,41,0],[787,13,787,35,0],[788,13,788,32,0],[789,13,790,28,0],[791,13,791,35,0],[792,17,792,52,0],[795,13,795,116,0],[796,13,796,14,0],[797,17,798,90,0],[799,17,799,59,0],[800,13,800,14,0],[803,13,805,42,0],[806,13,806,53,0],[807,17,807,30,0],[809,13,809,14,0],[810,17,810,29,0],[812,9,812,10,0],[815,9,815,10,0],[816,13,816,29,0],[817,13,817,27,0],[818,13,818,31,0],[819,13,819,60,0],[820,13,820,63,0],[820,64,820,94,0],[822,13,822,14,0],[823,17,823,74,0],[824,17,824,67,0],[824,68,824,98,0],[825,13,825,14,0],[826,13,826,24,0],[827,9,827,10,0],[831,9,831,10,0],[832,13,832,29,0],[833,13,833,27,0],[834,13,834,31,0],[835,13,835,48,0],[835,49,835,61,0],[836,13,836,70,0],[837,13,837,33,0],[838,13,838,63,0],[838,64,838,106,0],[839,13,839,53,0],[839,54,839,65,0],[841,13,841,49,0],[843,13,845,84,0],[846,13,846,44,0],[846,45,846,56,0],[848,13,848,60,0],[849,13,849,28,0],[849,29,849,40,0],[851,13,851,31,0],[852,13,852,24,0],[853,9,853,10,0],[856,9,856,10,0],[857,13,857,27,0],[858,13,858,33,0],[859,13,859,31,0],[860,13,860,62,0],[861,13,861,50,0],[862,13,862,27,0],[863,9,863,10,0],[867,9,867,10,0],[868,13,868,27,0],[869,13,869,33,0],[870,13,870,81,0],[871,13,871,116,0],[872,13,872,14,0],[873,17,874,109,0],[875,17,875,30,0],[877,13,877,73,0],[878,13,878,33,0],[879,13,879,14,0],[880,17,881,109,0],[882,17,882,30,0],[884,13,884,48,0],[885,13,885,14,0],[886,17,888,42,0],[889,17,889,30,0],[891,13,891,41,0],[892,13,892,33,0],[893,13,893,14,0],[894,17,894,61,0],[895,17,895,87,0],[896,13,896,14,0],[898,13,898,14,0],[899,17,899,43,0],[900,17,900,108,0],[901,17,901,82,0],[902,13,902,14,0],[903,13,903,66,0],[904,13,904,30,0],[905,17,907,42,0],[909,17,909,68,0],[910,13,910,27,0],[911,9,911,10,0],[915,9,915,10,0],[916,13,916,59,0],[917,13,917,116,0],[918,13,918,32,0],[919,13,919,14,0],[920,17,920,79,0],[921,17,921,108,0],[922,17,922,33,0],[925,17,926,60,0],[927,9,927,10,0],[931,9,931,10,0],[932,13,932,81,0],[933,13,933,91,0],[934,13,934,85,0],[935,9,935,10,0],[939,9,939,10,0],[940,13,940,50,0],[942,13,942,77,0],[943,13,943,14,0],[944,17,944,79,0],[945,17,945,108,0],[946,17,946,33,0],[949,17,950,60,0],[951,9,951,10,0],[954,9,954,10,0],[955,13,955,81,0],[963,13,963,26,0],[964,9,964,10,0],[967,9,967,10,0],[968,13,968,39,0],[969,13,969,31,0],[970,13,970,34,0],[972,13,972,66,0],[973,13,975,78,0],[976,13,976,121,0],[977,13,977,39,0],[978,13,978,14,0],[979,17,980,117,0],[981,17,981,70,0],[982,13,982,14,0],[983,13,983,108,0],[984,13,984,53,0],[985,13,985,14,0],[986,17,986,87,0],[987,17,987,64,0],[989,17,989,82,0],[990,13,990,14,0],[991,13,991,25,0],[992,9,992,10,0],[1007,9,1007,10,1],[1008,13,1008,84,1],[1009,13,1010,63,1],[1011,13,1011,62,1],[1012,13,1012,59,1],[1014,13,1014,47,1],[1015,13,1015,34,1],[1017,13,1017,31,1],[1018,13,1018,14,1],[1019,17,1019,70,1],[1021,17,1023,82,1],[1025,17,1025,198,1],[1026,17,1026,190,1],[1027,17,1027,62,1],[1028,17,1028,86,1],[1029,17,1029,18,0],[1030,21,1030,97,0],[1031,17,1031,18,0],[1033,17,1033,115,1],[1034,17,1034,37,1],[1035,17,1035,47,1],[1036,17,1036,68,1],[1037,17,1037,45,1],[1038,17,1038,53,1],[1039,17,1039,159,1],[1041,17,1041,118,1],[1043,17,1043,61,1],[1044,17,1044,96,1],[1046,17,1048,178,1],[1049,13,1049,14,1],[1050,13,1050,75,1],[1051,13,1051,116,1],[1052,13,1052,62,1],[1053,13,1053,29,1],[1054,9,1054,10,1],[1060,9,1060,10,1],[1061,13,1062,63,1],[1063,13,1063,40,1],[1065,13,1065,92,1],[1067,13,1067,75,1],[1068,13,1068,99,1],[1069,13,1069,29,1],[1070,9,1070,10,1],[1082,9,1082,10,0],[1083,13,1084,63,0],[1086,13,1086,85,0],[1087,13,1087,107,0],[1088,13,1088,28,0],[1089,13,1089,20,0],[1089,22,1089,39,0],[1089,40,1089,42,0],[1089,43,1089,54,0],[1090,13,1090,14,0],[1091,17,1091,98,0],[1092,17,1092,18,0],[1093,21,1093,56,0],[1094,21,1094,123,0],[1095,21,1095,78,0],[1096,17,1096,18,0],[1097,13,1097,14,0],[1099,13,1099,109,0],[1100,9,1100,10,0],[1108,9,1108,10,1],[1109,13,1109,49,1],[1111,13,1111,14,1],[1112,17,1112,45,1],[1113,17,1113,68,1],[1114,17,1114,93,1],[1115,17,1115,50,1],[1116,17,1116,59,1],[1117,17,1117,59,1],[1118,17,1118,18,0],[1119,21,1119,80,0],[1120,21,1120,63,0],[1121,21,1121,22,0],[1122,25,1122,98,0],[1123,21,1123,22,0],[1124,17,1124,18,0],[1125,13,1125,14,1],[1126,13,1126,30,0],[1127,13,1127,14,0],[1128,13,1128,14,0],[1129,13,1130,63,1],[1132,13,1132,59,1],[1133,13,1133,49,1],[1135,13,1135,31,1],[1136,13,1136,14,1],[1137,17,1137,70,1],[1138,17,1138,72,1],[1139,17,1142,59,1],[1143,17,1144,55,1],[1152,17,1152,101,1],[1153,17,1155,108,1],[1160,17,1160,129,1],[1161,17,1161,75,1],[1161,76,1161,77,1],[1161,78,1161,142,1],[1163,17,1163,60,1],[1164,17,1164,18,1],[1165,21,1165,92,1],[1166,21,1166,66,1],[1167,21,1167,97,1],[1168,25,1168,79,1],[1169,21,1169,83,1],[1170,17,1170,18,1],[1172,17,1172,87,1],[1173,17,1173,56,1],[1174,17,1174,65,1],[1177,17,1177,18,1],[1178,21,1180,58,1],[1182,21,1182,46,1],[1183,21,1183,22,1],[1184,25,1184,68,1],[1185,25,1185,69,1],[1186,25,1186,69,1],[1188,25,1188,78,1],[1189,21,1189,22,1],[1190,17,1190,18,1],[1191,17,1191,22,1],[1192,17,1192,18,1],[1193,17,1193,18,1],[1196,17,1196,69,1],[1197,17,1197,18,0],[1198,21,1198,67,0],[1203,17,1203,113,1],[1204,17,1204,71,1],[1207,17,1207,89,1],[1209,17,1209,101,1],[1213,17,1213,59,1],[1216,17,1216,55,1],[1220,17,1220,49,1],[1223,17,1223,67,1],[1224,17,1224,18,1],[1225,21,1226,82,1],[1240,17,1240,18,1],[1241,17,1247,54,1],[1251,17,1251,70,1],[1253,17,1253,120,1],[1254,17,1254,18,1],[1256,21,1256,22,1],[1257,25,1259,62,1],[1261,25,1261,50,1],[1262,25,1262,26,1],[1263,29,1263,81,1],[1264,25,1264,26,1],[1265,21,1265,22,1],[1266,21,1266,26,1],[1267,21,1267,22,1],[1268,21,1268,22,1],[1269,17,1269,18,1],[1271,17,1271,50,1],[1273,17,1273,24,1],[1273,26,1273,34,0],[1273,35,1273,37,1],[1273,38,1273,121,1],[1275,17,1275,18,0],[1276,21,1276,45,0],[1277,17,1277,18,0],[1279,17,1279,57,1],[1281,17,1281,78,1],[1282,17,1282,18,0],[1283,21,1283,76,0],[1286,17,1286,102,1],[1289,17,1289,75,0],[1290,9,1290,10,1],[1293,9,1293,10,1],[1295,13,1295,14,1],[1296,17,1298,54,1],[1300,17,1300,63,1],[1301,17,1301,18,1],[1302,21,1302,47,1],[1304,21,1304,60,1],[1305,21,1305,60,1],[1307,21,1307,28,1],[1307,30,1307,41,1],[1307,42,1307,44,1],[1307,45,1307,50,1],[1308,21,1308,22,1],[1309,25,1309,67,1],[1310,25,1310,40,1],[1311,25,1311,26,1],[1312,29,1312,64,1],[1313,29,1314,62,1],[1315,29,1315,30,1],[1317,33,1317,59,1],[1318,33,1318,68,1],[1319,37,1319,95,0],[1320,38,1320,69,1],[1321,37,1321,91,1],[1324,33,1324,34,1],[1327,37,1327,84,1],[1328,37,1328,38,1],[1329,41,1329,79,1],[1330,37,1330,38,1],[1331,33,1331,34,1],[1332,33,1332,38,0],[1333,33,1333,34,0],[1334,33,1334,34,0],[1335,29,1335,30,1],[1336,29,1341,66,1],[1342,25,1342,26,1],[1343,21,1343,22,1],[1345,21,1347,45,1],[1349,22,1349,104,1],[1350,17,1350,18,0],[1351,21,1351,59,0],[1354,21,1354,50,1],[1356,13,1356,30,0],[1357,13,1357,14,0],[1358,17,1358,27,0],[1360,9,1360,10,1],[1364,9,1364,10,0],[1365,13,1366,63,0],[1367,13,1367,83,0],[1368,13,1368,46,0],[1369,13,1369,111,0],[1370,13,1370,34,0],[1371,13,1371,75,0],[1372,13,1372,76,0],[1374,13,1374,94,0],[1375,9,1375,10,0],[1379,9,1379,10,0],[1381,13,1381,14,0],[1382,17,1382,63,0],[1384,17,1384,92,0],[1385,17,1385,58,0],[1386,17,1386,60,0],[1388,17,1389,27,0],[1390,17,1390,74,0],[1391,17,1391,90,0],[1392,17,1392,74,0],[1393,17,1393,88,0],[1395,17,1395,70,0],[1396,17,1398,82,0],[1399,17,1399,108,0],[1400,17,1402,28,0],[1404,17,1406,92,0],[1407,17,1409,102,0],[1410,17,1412,49,0],[1413,17,1413,120,0],[1414,17,1416,33,0],[1417,17,1419,34,0],[1420,17,1422,43,0],[1423,17,1423,58,0],[1424,17,1424,90,0],[1426,17,1426,83,0],[1427,17,1427,38,0],[1428,17,1428,48,0],[1429,17,1429,53,0],[1430,17,1430,45,0],[1431,17,1431,53,0],[1433,17,1433,118,0],[1435,17,1435,31,0],[1436,17,1436,18,0],[1437,21,1437,88,0],[1438,21,1438,35,0],[1439,25,1439,122,0],[1440,17,1440,18,0],[1443,17,1443,72,0],[1444,17,1444,31,0],[1444,32,1444,59,0],[1445,17,1445,55,0],[1446,17,1446,87,0],[1447,17,1447,33,0],[1448,17,1448,63,0],[1449,17,1449,64,0],[1451,17,1453,54,0],[1454,17,1454,51,0],[1455,17,1455,49,0],[1456,17,1456,42,0],[1457,17,1457,18,0],[1459,21,1459,63,0],[1460,17,1460,18,0],[1461,17,1461,89,0],[1462,17,1462,18,0],[1464,21,1464,22,0],[1465,25,1466,53,0],[1467,25,1467,69,0],[1468,25,1468,38,0],[1469,25,1469,26,0],[1470,29,1470,114,0],[1471,29,1471,44,0],[1471,45,1471,80,0],[1472,25,1472,26,0],[1473,21,1473,22,0],[1474,21,1474,41,0],[1475,21,1475,22,0],[1476,25,1476,106,0],[1477,25,1477,94,0],[1478,29,1478,80,0],[1480,29,1480,58,0],[1482,17,1482,18,0],[1483,22,1483,72,0],[1484,21,1484,65,0],[1486,21,1486,66,0],[1489,17,1489,18,0],[1490,21,1490,46,0],[1491,21,1491,22,0],[1493,25,1493,74,0],[1494,21,1494,22,0],[1495,17,1495,18,0],[1496,17,1496,34,0],[1497,17,1497,18,0],[1498,17,1498,18,0],[1499,17,1501,43,0],[1504,17,1505,94,0],[1506,17,1506,55,0],[1507,17,1507,76,0],[1508,17,1508,18,0],[1509,21,1510,84,0],[1524,17,1524,18,0],[1525,17,1532,54,0],[1534,17,1534,89,0],[1536,13,1536,33,0],[1537,13,1537,14,0],[1538,17,1538,56,0],[1539,17,1539,69,0],[1540,17,1540,110,0],[1542,9,1542,10,0],[1546,9,1546,10,1],[1547,13,1550,55,1],[1553,13,1553,37,1],[1553,38,1553,97,0],[1554,13,1554,61,1],[1554,62,1554,121,0],[1555,13,1555,60,1],[1555,61,1555,120,0],[1556,13,1556,29,1],[1557,9,1557,10,1],[1561,9,1561,10,1],[1563,13,1563,14,1],[1564,17,1564,63,1],[1566,17,1566,92,1],[1567,17,1567,58,1],[1568,17,1568,60,1],[1570,17,1571,27,1],[1572,17,1572,74,1],[1573,17,1573,90,1],[1574,17,1574,74,1],[1575,17,1575,88,1],[1577,17,1577,70,1],[1578,17,1580,82,1],[1582,17,1582,98,1],[1583,17,1583,113,1],[1584,17,1586,49,1],[1588,17,1591,59,1],[1593,17,1593,41,1],[1593,42,1593,101,0],[1594,17,1594,53,1],[1594,54,1594,113,0],[1596,17,1596,83,1],[1597,17,1597,38,1],[1598,17,1598,48,1],[1599,17,1599,53,1],[1600,17,1600,45,1],[1601,17,1601,53,1],[1603,17,1603,118,1],[1606,17,1606,81,1],[1608,17,1608,56,1],[1609,17,1609,51,1],[1609,52,1609,102,0],[1610,22,1610,89,1],[1612,17,1612,93,1],[1614,13,1614,33,1],[1615,13,1615,14,1],[1616,17,1616,56,1],[1617,17,1617,69,1],[1618,17,1618,110,1],[1620,9,1620,10,1],[1626,9,1626,10,0],[1627,13,1628,63,0],[1629,13,1629,64,0],[1630,13,1630,14,0],[1631,17,1631,44,0],[1632,13,1632,14,0],[1633,13,1633,66,0],[1634,13,1636,78,0],[1637,13,1637,121,0],[1638,13,1638,40,0],[1639,13,1639,64,0],[1640,13,1640,14,0],[1641,17,1642,74,0],[1643,13,1643,14,0],[1645,13,1645,75,0],[1646,9,1646,10,0],[1650,9,1650,10,1],[1651,13,1651,25,1],[1652,13,1652,113,1],[1654,13,1654,47,1],[1655,13,1655,88,1],[1656,17,1656,43,1],[1658,13,1658,14,0],[1659,17,1659,68,0],[1660,17,1660,110,0],[1661,17,1661,66,0],[1662,17,1662,45,0],[1663,17,1663,24,0],[1663,26,1663,36,0],[1663,37,1663,39,0],[1663,40,1663,45,0],[1664,17,1664,18,0],[1665,21,1665,54,0],[1665,55,1665,100,0],[1666,17,1666,18,0],[1668,17,1668,24,0],[1668,26,1668,35,0],[1668,36,1668,38,0],[1668,39,1668,45,0],[1669,17,1669,18,0],[1670,21,1670,66,0],[1670,67,1670,91,0],[1671,17,1671,18,0],[1673,17,1673,69,0],[1674,21,1674,85,0],[1675,13,1675,14,0],[1676,13,1676,20,1],[1676,22,1676,40,1],[1676,41,1676,43,1],[1676,44,1676,68,1],[1677,13,1677,14,1],[1678,17,1678,54,1],[1679,13,1679,14,1],[1681,13,1681,48,1],[1682,13,1682,14,1],[1683,17,1683,75,1],[1684,17,1684,24,1],[1684,26,1684,35,1],[1684,36,1684,38,1],[1684,39,1684,42,1],[1685,21,1686,98,1],[1687,13,1687,14,1],[1689,13,1689,62,1],[1690,13,1690,20,1],[1690,22,1690,31,1],[1690,32,1690,34,1],[1690,35,1690,49,1],[1691,13,1691,14,1],[1692,17,1693,149,1],[1694,17,1694,53,1],[1695,21,1695,100,1],[1696,13,1696,14,1],[1697,13,1698,151,1],[1699,13,1699,78,1],[1700,9,1700,10,1],[1703,9,1703,10,1],[1704,13,1704,69,1],[1705,17,1705,44,1],[1707,17,1707,24,1],[1707,26,1707,45,1],[1707,46,1707,48,1],[1707,49,1707,61,1],[1707,63,1707,101,1],[1708,9,1708,10,1],[1711,9,1711,10,1],[1712,13,1712,45,1],[1713,13,1713,61,1],[1714,13,1714,46,1],[1716,13,1716,29,1],[1717,17,1717,24,1],[1717,26,1717,37,1],[1717,38,1717,40,1],[1717,41,1717,44,1],[1718,17,1718,18,1],[1719,21,1719,108,1],[1720,21,1720,22,1],[1721,25,1721,46,1],[1722,25,1722,31,1],[1724,17,1724,18,0],[1725,13,1725,51,1],[1726,17,1726,106,1],[1727,9,1727,10,1],[1730,9,1730,10,0],[1731,13,1731,20,0],[1731,22,1731,36,0],[1731,37,1731,39,0],[1731,40,1731,53,0],[1732,13,1732,14,0],[1733,17,1733,48,0],[1734,17,1734,33,0],[1734,34,1734,43,0],[1735,17,1735,49,0],[1736,17,1736,18,0],[1737,21,1737,88,0],[1738,21,1738,57,0],[1739,21,1739,22,0],[1740,25,1740,85,0],[1742,25,1742,63,0],[1743,25,1743,26,0],[1744,29,1744,95,0],[1745,29,1745,36,0],[1745,38,1745,48,0],[1745,49,1745,51,0],[1745,52,1745,68,0],[1746,33,1746,61,0],[1747,25,1747,26,0],[1749,25,1749,26,0],[1750,29,1751,81,0],[1752,29,1752,36,0],[1752,38,1752,51,0],[1752,52,1752,54,0],[1752,55,1752,76,0],[1753,29,1753,30,0],[1754,33,1754,75,0],[1755,33,1755,34,0],[1756,37,1756,90,0],[1757,37,1757,44,0],[1757,46,1757,55,0],[1757,56,1757,58,0],[1757,59,1757,61,0],[1757,63,1757,90,0],[1758,33,1758,34,0],[1760,37,1760,86,0],[1761,29,1761,30,0],[1762,25,1762,26,0],[1763,25,1763,94,0],[1764,25,1764,56,0],[1765,25,1765,26,0],[1766,29,1766,81,0],[1767,29,1767,36,0],[1767,38,1767,48,0],[1767,49,1767,51,0],[1767,52,1767,54,0],[1768,29,1768,30,0],[1769,33,1769,85,0],[1770,33,1770,48,0],[1770,49,1770,58,0],[1772,33,1772,69,0],[1773,33,1773,53,0],[1774,33,1774,72,0],[1775,33,1775,71,0],[1776,33,1776,34,0],[1777,37,1777,103,0],[1778,37,1778,44,0],[1778,46,1778,56,0],[1778,57,1778,59,0],[1778,60,1778,76,0],[1779,37,1779,38,0],[1780,41,1780,82,0],[1781,41,1782,88,0],[1783,41,1783,42,0],[1784,45,1784,61,0],[1785,45,1785,51,0],[1787,37,1787,38,0],[1788,37,1788,49,0],[1788,50,1788,87,0],[1789,37,1789,43,0],[1792,33,1792,34,0],[1793,37,1794,89,0],[1795,37,1795,44,0],[1795,46,1795,59,0],[1795,60,1795,62,0],[1795,63,1795,84,0],[1796,37,1796,38,0],[1797,41,1797,83,0],[1798,41,1798,42,0],[1799,45,1799,98,0],[1800,45,1800,52,0],[1800,54,1800,63,0],[1800,64,1800,66,0],[1800,67,1800,69,0],[1801,45,1801,46,0],[1802,49,1802,89,0],[1803,49,1804,96,0],[1805,49,1805,50,0],[1806,53,1806,69,0],[1807,53,1807,59,0],[1809,45,1809,46,0],[1810,45,1810,57,0],[1810,58,1810,95,0],[1811,45,1811,51,0],[1814,41,1814,42,0],[1815,45,1815,107,0],[1816,45,1817,92,0],[1818,49,1818,65,0],[1819,45,1819,57,0],[1819,58,1819,95,0],[1820,41,1820,42,0],[1821,37,1821,38,0],[1822,33,1822,34,0],[1823,29,1823,30,0],[1824,29,1824,36,0],[1824,38,1824,53,0],[1824,54,1824,56,0],[1824,57,1824,74,0],[1825,29,1825,30,0],[1826,33,1827,115,0],[1828,33,1828,48,0],[1828,49,1828,73,0],[1829,29,1829,30,0],[1830,25,1830,26,0],[1831,21,1831,22,0],[1833,25,1833,108,0],[1834,17,1834,18,0],[1836,17,1836,18,0],[1837,21,1837,67,0],[1838,17,1838,18,0],[1839,13,1839,14,0],[1840,9,1840,10,0],[1843,9,1843,10,0],[1844,13,1844,66,0],[1845,13,1847,58,0],[1848,13,1848,29,0],[1848,30,1848,75,0],[1849,18,1849,49,0],[1850,9,1850,10,0],[1853,9,1853,10,0],[1854,13,1854,83,0],[1855,13,1855,109,0],[1856,13,1856,37,0],[1857,13,1857,90,0],[1858,13,1858,14,0],[1859,17,1860,115,0],[1861,17,1861,41,0],[1861,42,1861,60,0],[1863,21,1863,28,0],[1863,30,1863,43,0],[1863,44,1863,46,0],[1863,47,1863,58,0],[1864,21,1864,22,0],[1865,25,1865,77,0],[1866,25,1866,52,0],[1866,53,1866,96,0],[1867,21,1867,22,0],[1868,13,1868,14,0],[1869,18,1869,36,0],[1870,13,1870,28,0],[1871,13,1871,14,0],[1872,17,1872,85,0],[1873,17,1873,24,0],[1873,26,1873,39,0],[1873,40,1873,42,0],[1873,43,1873,54,0],[1874,17,1874,18,0],[1875,21,1875,80,0],[1876,21,1876,48,0],[1876,49,1876,92,0],[1877,21,1877,51,0],[1878,17,1878,18,0],[1879,17,1879,50,0],[1880,13,1880,14,0],[1881,9,1881,10,0],[1886,9,1886,10,0],[1887,13,1888,89,0],[1889,13,1889,14,0],[1890,17,1890,30,0],[1891,13,1891,14,0],[1893,13,1893,66,0],[1895,13,1897,113,0],[1898,13,1898,96,0],[1899,13,1899,31,0],[1900,17,1900,107,0],[1902,13,1902,28,0],[1903,13,1903,57,0],[1904,13,1904,14,0],[1905,17,1905,61,0],[1906,17,1906,24,0],[1906,26,1906,39,0],[1906,40,1906,42,0],[1906,43,1906,66,0],[1907,21,1907,56,0],[1908,17,1908,43,0],[1909,13,1909,14,0],[1910,13,1910,26,0],[1911,9,1911,10,0],[1914,9,1914,10,0],[1915,13,1915,56,0],[1916,13,1918,52,0],[1919,13,1921,52,0],[1922,13,1922,40,0],[1923,13,1923,20,0],[1923,22,1923,34,0],[1923,35,1923,37,0],[1923,38,1923,53,0],[1924,13,1924,14,0],[1925,17,1925,50,0],[1926,17,1926,33,0],[1927,17,1927,84,0],[1928,13,1928,14,0],[1930,13,1930,41,0],[1932,13,1932,75,0],[1933,9,1933,10,0],[1936,9,1936,10,0],[1937,13,1937,48,0],[1937,49,1937,62,0],[1939,13,1939,83,0],[1940,13,1940,14,0],[1942,17,1942,39,0],[1944,17,1944,18,0],[1949,21,1949,37,0],[1950,17,1950,18,0],[1951,17,1951,22,0],[1952,17,1952,18,0],[1953,17,1953,18,0],[1954,17,1954,33,0],[1957,13,1958,27,0],[1959,13,1959,51,0],[1960,13,1960,14,0],[1962,17,1962,29,0],[1966,13,1966,104,0],[1967,13,1967,60,0],[1968,13,1968,35,0],[1969,22,1969,31,0],[1969,33,1969,50,0],[1969,52,1969,55,0],[1970,17,1970,18,0],[1971,21,1973,74,0],[1974,21,1974,37,0],[1974,38,1974,47,0],[1975,21,1977,75,0],[1978,21,1978,39,0],[1978,40,1978,49,0],[1979,21,1979,50,0],[1980,17,1980,18,0],[1982,13,1982,90,0],[1983,13,1983,44,0],[1985,13,1985,20,0],[1985,22,1985,44,0],[1985,45,1985,47,0],[1985,48,1985,60,0],[1986,13,1986,14,0],[1987,17,1987,59,0],[1987,60,1987,69,0],[1988,17,1988,77,0],[1989,17,1989,18,0],[1990,21,1990,77,0],[1991,25,1991,50,0],[1992,21,1992,30,0],[1995,17,1996,75,0],[1997,17,1997,81,0],[1998,17,1998,36,0],[1998,37,1998,62,0],[1999,13,1999,14,0],[2000,13,2000,38,0],[2001,9,2001,10,0],[2005,9,2005,10,0],[2006,13,2006,123,0],[2007,13,2007,31,0],[2008,13,2008,14,0],[2009,17,2009,63,0],[2010,17,2010,51,0],[2011,17,2011,18,0],[2012,21,2012,90,0],[2013,21,2013,33,0],[2016,21,2016,33,0],[2019,17,2019,29,0],[2020,9,2020,10,0],[2024,9,2024,10,0],[2025,13,2025,123,0],[2026,13,2026,31,0],[2027,13,2027,14,0],[2028,17,2028,109,0],[2029,17,2029,51,0],[2030,17,2030,18,0],[2031,21,2031,90,0],[2032,21,2032,33,0],[2035,21,2035,33,0],[2038,17,2038,29,0],[2039,9,2039,10,0],[2043,9,2043,10,0],[2044,13,2044,44,0],[2045,13,2045,78,0],[2046,13,2046,41,0],[2047,17,2047,49,0],[2048,13,2048,76,0],[2049,13,2050,13,0],[2050,13,2050,14,0],[2050,14,2051,17,0],[2051,17,2051,78,0],[2051,78,2053,17,0],[2053,17,2053,38,0],[2053,38,2054,17,0],[2054,17,2054,18,0],[2054,18,2055,21,0],[2055,21,2055,69,0],[2055,69,2056,21,0],[2056,21,2056,47,0],[2056,47,2057,21,0],[2057,21,2057,22,0],[2057,22,2058,25,0],[2058,25,2058,44,0],[2058,44,2059,21,0],[2059,21,2059,22,0],[2059,22,2060,21,0],[2060,21,2060,77,0],[2060,77,2062,21,0],[2062,21,2062,22,0],[2062,22,2063,25,0],[2063,25,2063,101,0],[2063,101,2064,25,0],[2064,25,2064,74,0],[2064,74,2065,25,0],[2065,25,2065,26,0],[2065,26,2066,29,0],[2066,29,2066,81,0],[2066,81,2067,29,0],[2067,29,2067,63,0],[2067,63,2068,29,0],[2068,29,2068,30,0],[2068,30,2069,33,0],[2069,33,2069,102,0],[2069,102,2070,33,0],[2070,33,2070,45,0],[2070,45,2073,33,0],[2073,33,2073,96,0],[2073,96,2076,29,0],[2076,29,2076,92,0],[2076,92,2078,21,0],[2078,21,2078,38,0],[2078,38,2079,21,0],[2079,21,2079,22,0],[2079,22,2080,25,0],[2080,25,2080,88,0],[2080,88,2085,21,0],[2085,21,2085,84,0],[2085,84,2086,13,0],[2086,13,2086,14,0],[2086,14,2086,16,0],[2049,13,2086,16,0],[2087,13,2087,25,0],[2088,9,2088,10,0],[2092,9,2092,10,0],[2093,13,2093,44,0],[2094,13,2094,78,0],[2095,13,2095,41,0],[2096,17,2096,49,0],[2097,13,2097,76,0],[2098,13,2099,13,0],[2099,13,2099,14,0],[2099,14,2100,17,0],[2100,17,2100,78,0],[2100,78,2102,17,0],[2102,17,2102,38,0],[2102,38,2103,17,0],[2103,17,2103,18,0],[2103,18,2104,21,0],[2104,21,2104,69,0],[2104,69,2105,21,0],[2105,21,2105,47,0],[2105,47,2106,21,0],[2106,21,2106,22,0],[2106,22,2107,25,0],[2107,25,2107,44,0],[2107,44,2108,21,0],[2108,21,2108,22,0],[2108,22,2109,21,0],[2109,21,2109,77,0],[2109,77,2111,21,0],[2111,21,2111,22,0],[2111,22,2112,25,0],[2112,25,2112,101,0],[2112,101,2113,25,0],[2113,25,2113,74,0],[2113,74,2114,25,0],[2114,25,2114,26,0],[2114,26,2115,29,0],[2115,29,2116,60,0],[2116,60,2117,29,0],[2117,29,2117,63,0],[2117,63,2118,29,0],[2118,29,2118,30,0],[2118,30,2119,33,0],[2119,33,2119,102,0],[2119,102,2120,33,0],[2120,33,2120,45,0],[2120,45,2123,33,0],[2123,33,2123,96,0],[2123,96,2126,29,0],[2126,29,2126,92,0],[2126,92,2128,21,0],[2128,21,2128,38,0],[2128,38,2129,21,0],[2129,21,2129,22,0],[2129,22,2130,25,0],[2130,25,2130,88,0],[2130,88,2134,21,0],[2134,21,2134,84,0],[2134,84,2135,13,0],[2135,13,2135,14,0],[2135,14,2135,16,0],[2098,13,2135,16,0],[2136,13,2136,25,0],[2137,9,2137,10,0],[2140,9,2140,10,0],[2141,13,2141,38,0],[2144,13,2144,14,0],[2145,17,2145,89,0],[2146,13,2146,14,0],[2147,13,2147,32,0],[2148,13,2148,14,0],[2153,17,2153,29,0],[2156,13,2156,14,0],[2157,17,2157,36,0],[2158,21,2158,36,0],[2159,13,2159,14,0],[2162,13,2162,26,0],[2163,9,2163,10,0],[2167,9,2167,10,1],[2168,13,2168,84,1],[2169,13,2169,59,1],[2173,13,2173,37,1],[2174,13,2174,14,1],[2175,17,2175,55,1],[2176,17,2176,43,1],[2177,17,2177,50,1],[2178,17,2178,68,1],[2179,17,2179,91,1],[2180,17,2180,75,1],[2181,17,2181,63,1],[2182,17,2182,77,1],[2183,17,2183,45,1],[2184,17,2184,46,1],[2185,17,2185,78,1],[2186,17,2186,48,1],[2187,17,2189,34,1],[2191,17,2191,77,1],[2192,13,2192,14,1],[2196,13,2196,108,1],[2198,13,2198,71,1],[2199,13,2199,53,1],[2200,13,2200,14,0],[2201,17,2201,34,0],[2202,17,2202,18,0],[2203,21,2203,79,0],[2204,17,2204,18,0],[2206,17,2206,18,0],[2209,21,2209,303,0],[2210,17,2210,18,0],[2211,13,2211,14,0],[2215,13,2215,51,1],[2216,13,2216,14,0],[2217,17,2217,34,0],[2218,21,2218,93,0],[2220,21,2220,164,0],[2221,13,2221,14,0],[2223,13,2223,30,1],[2224,17,2224,40,0],[2226,13,2226,40,1],[2228,13,2228,30,1],[2229,13,2229,14,0],[2230,17,2231,107,0],[2232,13,2232,14,0],[2234,13,2234,14,1],[2235,17,2236,110,1],[2237,13,2237,14,1],[2239,13,2239,33,1],[2240,13,2240,81,1],[2243,13,2243,51,1],[2244,13,2244,14,1],[2245,17,2245,57,1],[2246,21,2246,51,1],[2247,17,2247,24,1],[2247,26,2247,37,1],[2247,38,2247,40,1],[2247,41,2247,48,1],[2248,17,2248,18,1],[2249,21,2250,39,1],[2253,21,2253,85,1],[2254,21,2254,50,1],[2255,17,2255,18,1],[2256,13,2256,14,1],[2258,13,2258,49,1],[2260,13,2260,47,1],[2262,13,2262,37,1],[2263,13,2263,14,1],[2264,17,2264,56,1],[2267,17,2267,34,1],[2268,17,2268,18,0],[2269,21,2270,111,0],[2271,17,2271,18,0],[2273,17,2273,18,1],[2274,21,2275,108,1],[2276,17,2276,18,1],[2278,17,2278,79,1],[2279,17,2279,18,1],[2280,21,2280,55,1],[2281,21,2281,53,1],[2282,21,2282,53,1],[2283,21,2283,28,1],[2283,30,2283,41,1],[2283,42,2283,44,1],[2283,45,2283,74,1],[2284,21,2284,22,1],[2285,25,2285,53,1],[2286,25,2286,72,1],[2287,25,2287,44,1],[2288,21,2288,22,1],[2290,21,2290,51,1],[2291,17,2291,18,1],[2292,13,2292,14,1],[2294,13,2294,92,1],[2295,13,2295,62,1],[2296,13,2296,29,1],[2318,9,2318,10,1],[2324,9,2324,10,0],[2325,13,2325,98,0],[2326,9,2326,10,0],[2332,9,2332,10,0],[2333,13,2333,84,0],[2334,13,2334,59,0],[2338,13,2338,51,0],[2339,13,2339,39,0],[2340,13,2340,46,0],[2341,13,2341,64,0],[2342,13,2342,87,0],[2343,13,2343,71,0],[2344,13,2344,53,0],[2345,13,2345,73,0],[2346,13,2346,41,0],[2347,13,2347,42,0],[2348,13,2348,74,0],[2349,13,2349,44,0],[2351,13,2351,73,0],[2355,13,2355,76,0],[2357,13,2357,66,0],[2358,13,2360,78,0],[2363,13,2363,86,0],[2364,13,2364,66,0],[2365,13,2365,48,0],[2367,13,2367,43,0],[2368,13,2368,64,0],[2369,13,2369,14,0],[2370,17,2370,72,0],[2371,13,2371,14,0],[2373,13,2373,45,0],[2374,13,2374,14,0],[2375,17,2375,61,0],[2376,17,2376,72,0],[2380,17,2381,59,0],[2383,17,2383,76,0],[2384,17,2384,100,0],[2386,17,2386,24,0],[2386,26,2386,37,0],[2386,38,2386,40,0],[2386,41,2386,62,0],[2387,17,2387,18,0],[2388,21,2388,58,0],[2389,21,2389,94,0],[2390,21,2390,22,0],[2391,25,2391,64,0],[2392,25,2392,82,0],[2393,25,2393,26,0],[2394,29,2394,74,0],[2395,29,2395,56,0],[2402,29,2402,30,0],[2403,33,2403,92,0],[2404,33,2404,98,0],[2406,33,2406,70,0],[2408,33,2408,81,0],[2409,33,2409,34,0],[2410,37,2410,79,0],[2411,37,2411,38,0],[2412,41,2412,102,0],[2413,41,2413,108,0],[2414,37,2414,38,0],[2415,42,2415,85,0],[2416,37,2416,38,0],[2417,41,2417,137,0],[2418,37,2418,38,0],[2419,33,2419,34,0],[2420,29,2420,30,0],[2421,29,2421,49,0],[2422,29,2422,30,0],[2423,33,2423,119,0],[2432,29,2432,82,0],[2433,29,2433,58,0],[2434,29,2434,64,0],[2435,29,2435,63,0],[2436,29,2436,107,0],[2439,29,2440,47,0],[2448,29,2448,81,0],[2449,29,2449,99,0],[2450,29,2450,98,0],[2451,29,2451,63,0],[2453,29,2453,74,0],[2455,29,2455,50,0],[2456,29,2456,30,0],[2457,33,2457,69,0],[2458,38,2458,47,0],[2458,49,2458,66,0],[2458,68,2458,71,0],[2459,33,2459,34,0],[2460,37,2460,87,0],[2461,33,2461,34,0],[2462,29,2462,30,0],[2463,34,2463,56,0],[2464,29,2464,30,0],[2465,33,2465,77,0],[2466,33,2466,34,0],[2467,37,2467,96,0],[2468,33,2468,34,0],[2469,29,2469,30,0],[2477,29,2477,36,0],[2477,38,2477,51,0],[2477,52,2477,54,0],[2477,55,2477,65,0],[2478,29,2478,30,0],[2479,33,2479,78,0],[2480,37,2480,241,0],[2481,29,2481,30,0],[2484,25,2484,26,0],[2485,21,2485,22,0],[2486,17,2486,18,0],[2492,17,2492,87,0],[2498,17,2498,54,0],[2499,17,2499,18,0],[2500,21,2500,79,0],[2501,21,2501,85,0],[2502,21,2502,75,0],[2503,21,2503,86,0],[2504,21,2504,66,0],[2505,21,2505,61,0],[2506,17,2506,18,0],[2509,13,2509,14,0],[2511,13,2511,99,0],[2512,13,2512,70,0],[2513,13,2513,37,0],[2514,9,2514,10,0],[2519,9,2519,10,0],[2520,13,2520,59,0],[2521,13,2521,84,0],[2522,13,2522,42,0],[2524,13,2524,40,0],[2526,13,2526,94,0],[2527,13,2527,14,0],[2528,17,2529,107,0],[2530,13,2530,14,0],[2532,13,2532,14,0],[2533,17,2534,110,0],[2535,13,2535,14,0],[2537,13,2537,55,0],[2538,13,2538,52,0],[2539,13,2539,97,0],[2540,13,2540,14,0],[2541,17,2541,24,0],[2541,26,2541,37,0],[2541,38,2541,40,0],[2541,41,2541,58,0],[2542,17,2542,18,0],[2543,21,2543,66,0],[2544,17,2544,18,0],[2545,13,2545,14,0],[2547,13,2547,55,0],[2548,13,2548,75,0],[2550,13,2550,105,0],[2552,13,2552,40,0],[2553,9,2553,10,0],[2557,9,2557,10,0],[2559,13,2559,92,0],[2560,13,2560,85,0],[2561,13,2561,66,0],[2562,13,2562,33,0],[2563,13,2563,56,0],[2564,13,2565,70,0],[2566,13,2566,27,0],[2567,9,2567,10,0],[2571,9,2571,10,0],[2573,13,2573,94,0],[2574,13,2574,85,0],[2575,13,2575,66,0],[2576,13,2576,33,0],[2577,13,2577,56,0],[2578,13,2579,70,0],[2580,13,2580,27,0],[2581,9,2581,10,0],[2585,9,2585,10,0],[2587,13,2587,94,0],[2588,13,2588,85,0],[2589,13,2589,66,0],[2590,13,2590,33,0],[2591,13,2591,56,0],[2592,13,2593,70,0],[2594,13,2594,27,0],[2595,9,2595,10,0]]);
    </script>
  </body>
</html>