<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Construction Vertical\Main Modules\Contract Manager\Business Layer\ConcreateModels\ContractItemListModel.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Globalization;
using System.Linq;
using System.Web;
using System.Web.UI;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.ContmgtDTO;
using Aurigo.AMP3.ContractManager.BusinessLayer;
using Aurigo.AMP3.Core.AbstractModels;
using Aurigo.AMP3.Core.BusinessLayer.BL;
using Aurigo.AMP3.Core.IntegrationConnector;
using Aurigo.AMP3.Core.UserControls;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.AMP3.Resources.MessageResources;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.Brix.Construction.BusinessLogic;
using Aurigo.Brix.Core.WebUiHelper;
using Aurigo.Brix.Platform.BusinessLayer.DataAccessHelper;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.Brix.Platform.BusinessLayer.BL;
using Aurigo.Brix.Platform.BusinessLayer.AbstractModels;
using Aurigo.Brix.Construction.ContractManager.BusinessLayer.BL;
using Aurigo.AMP3.ProjectDTO;
using Aurigo.AMP3.ProjectBL;
using Aurigo.AMP3.ExceptionManagement;
using Aurigo.AMP3.LibraryDTO;
using Operations = Aurigo.AMP3.ContmgtDTO.Operations;
using Aurigo.Common.Utility;

namespace Aurigo.AMP3.ContmgtUI
{
    [ItemListModelContext(Name = Constants.MODID_CONTMGT)]
    [ContextElement(Name = &quot;Contract Item List&quot;)]
    public class ContractItemListModel : ItemListModel
    {
        /// &lt;summary&gt;
        /// Checks whether the Cost Revision module is added in the contract.
        /// &lt;/summary&gt;
        private bool? _IsCRAttached;
        private bool? _IsLocked;
        private bool? _IsSubmited;
        private bool? _isWorkflowAssociated;
        private int? _CalendarID;
        private List&lt;string&gt; _coreModuleComponents = null;

        public ContractItemListModel()
        {
            RollUpColumnName = &quot;Amount&quot;;
        }
        private List&lt;string&gt; CoreModuleComponents
        {
            get
            {
                if (_coreModuleComponents == null)
                    _coreModuleComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);

                return _coreModuleComponents;
            }
        }

        public override void OnInit()
        {
            RegisterClientScriptInclude(&quot;~/Modules/CONTMGT/Scripts/ContractItemList.js&quot;);
        }

        public bool IsLocked
        {
            get
            {
                if (!_IsLocked.HasValue)
                    _IsLocked = BL.Instance.GetLockAndSubmitStatus(ParentID).Item1;
                return _IsLocked.Value;
            }
        }

        public virtual bool CanAssociateFund
        {
            get
            {
                return !IsLocked;
            }
        }

        private bool IsWorkflow
        {
            get
            {
                if (!_isWorkflowAssociated.HasValue)
                {
                    _isWorkflowAssociated = false;
                    if (HttpContext.Current.CurrentHandler is BrixPageBase)
                    {
                        BrixPageBase pb = HttpContext.Current.CurrentHandler as BrixPageBase;
                        if (pb.IsWorkflowAssociated(WorkflowModuleID))
                        {
                            DataTable mappingDetails = BrixWorkflowManager.Instance.GetWorkflowMappingDetails(parentID.ToString(), WorkflowModuleID);
                            _isWorkflowAssociated = (mappingDetails.Rows.Count &gt; 0 &amp;&amp; !mappingDetails.Rows[0][&quot;WorkflowInstanceGuid&quot;].Equals(DBNull.Value));
                        }
                    }
                }
                return _isWorkflowAssociated.Value;
            }
        }

        private bool IsSubmit
        {
            get
            {
                //return BL.Instance.GetLockStatus(ParentID); 
                if (!_IsSubmited.HasValue)
                    _IsSubmited = BL.Instance.GetLockAndSubmitStatus(ParentID).Item2;
                return _IsSubmited.Value;
            }
        }

        /// &lt;summary&gt;
        /// Says whether the current view is Contract view or not.
        /// &lt;/summary&gt;
        public virtual bool IsCV
        {
            get
            {
                if ((!String.IsNullOrEmpty(Request[&quot;IsCV&quot;]) &amp;&amp; Request[&quot;IsCV&quot;] == &quot;Y&quot; &amp;&amp; IsCRAttached) || !IsCRAttached)
                    return true;
                else
                    return false;
            }
        }

        /// &lt;summary&gt;
        /// Returns the string that needs to be added to the query string, if page is to be loaded in the Contract view.
        /// &lt;/summary&gt;
        protected string CVString
        {
            get { return IsCV ? &quot;&amp;IsCV=Y&quot; : string.Empty; }
        }

        public virtual bool IsCRAttached
        {
            get
            {
                if (!_IsCRAttached.HasValue)
                {
                    DTO dto = BL.Instance.GetContract(ParentID, FetchSet.Modules);
                    _IsCRAttached = dto.ContainsModule(&quot;COSTVER&quot;);
                }
                return _IsCRAttached.Value;
            }
        }

        private bool? _IsModulebeEnabled = null;
        protected bool IsModulebeEnabled
        {
            get
            {
                if (!_IsModulebeEnabled.HasValue)
                    _IsModulebeEnabled = BL.Instance.ShouldModulebeEnabled(ParentID);
                return _IsModulebeEnabled.Value;
            }
        }

        protected int CalendarID
        {
            get
            {
                if (!_CalendarID.HasValue)
                {
                    DTO dto = BL.Instance.GetContract(ParentID, FetchSet.Time);
                    _CalendarID = (dto.CalendarID.HasValue) ? dto.CalendarID : 0;
                }
                return _CalendarID.Value;
            }
        }

        public override string Header
        {
            get
            {
                if (!IsLocked || !IsCRAttached)
                    return base.Header;
                else if (!String.IsNullOrEmpty(Request[&quot;IsCV&quot;]) &amp;&amp; Request[&quot;IsCV&quot;] == &quot;Y&quot;)
                    return &quot;Contract &quot; + ItemNameAbbr + &quot; List&quot;;
                else
                    return &quot;Execution &quot; + ItemNameAbbr + &quot; List&quot;;
            }
        }

        public override string ModuleId
        {
            get { return Constants.MODID_CONTMGT; }
        }

        public override string QueryStringName
        {
            get { return &quot;ContractID&quot;; }
        }

        public override string SkinID
        {
            get { return string.Empty; }
        }

        public override OtherAction[] OtherActions
        {
            get
            {
                var list = new List&lt;OtherAction&gt;();

                var action = new OtherAction();
                action.ID = &quot;lnkExcelImport&quot;;
                action.Name = &quot;Excel Import&quot;;
                action.Link = &quot;~/Common/Import.aspx?&quot; + Request.QueryString;
                action.ImagePath = &quot;Icn_importxl.gif&quot;;
                list.Add(action);

                action = new OtherAction();
                action.ID = &quot;lnkExcelExport&quot;;
                action.Name = &quot;Excel Export (xls)&quot;;
                action.ImagePath = &quot;Icn_exportxl.gif&quot;;
                list.Add(action);

                action = new OtherAction();
                action.ID = &quot;lnkExcelExportXlsx&quot;;
                action.Name = &quot;Excel Export (xlsx)&quot;;
                action.ImagePath = &quot;Icn_exportxl.gif&quot;;
                list.Add(action);

                action = new OtherAction();
                action.ID = &quot;lnkTemplateImport&quot;;
                action.Name = &quot;Excel Template Import&quot;;
                action.ImagePath = &quot;Icn_importxlt.gif&quot;;
                list.Add(action);


                action = new OtherAction();
                action.ID = &quot;lnkAddMulti&quot;;
                action.Name = &quot;Add Multiple&quot;;
                action.ImagePath = &quot;Icn_addmultiple.gif&quot;;
                action.RequireSelection = true;
                list.Add(action);

                return list.ToArray();
                //}
            }
        }

        public override List&lt;MenuGroup&gt; MenuGroups
        {
            get
            {
                List&lt;MenuGroup&gt; menuGroups = base.MenuGroups;

                MenuGroup itemDetailGroup = menuGroups.Find(mg =&gt; mg.Title == GlobalizationUtility.SetResource(&quot;Item&quot;, false) + &quot; Details&quot;);
                if (itemDetailGroup == null)
                {
                    itemDetailGroup = new MenuGroup(GlobalizationUtility.SetResource(&quot;Item&quot;, false) + &quot; Details&quot;);
                    menuGroups.Add(itemDetailGroup);
                }
                else
                {
                    if (!IsLocked)
                        itemDetailGroup.AddMenu(new TextIcon(&quot;lnkRefLineNo&quot;, &quot;Refresh Line Number&quot;, &quot;Icn_MSPSync_16.png&quot;));
                }
                if (!IsWorkflow)
                {
                    if (displayUnlock) itemDetailGroup.AddMenu(new LargeButton(&quot;lnkUnlock&quot;, &quot;Unlock&quot;, &quot;Icn_Unlock.png&quot;));
                    if (displayLock) itemDetailGroup.AddMenu(new LargeButton(&quot;lnkLock&quot;, &quot;Lock&quot;, &quot;Icn_Lock.png&quot;));
                }

                List&lt;string&gt; components = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);
                DTO contractDto = BL.Instance.GetContract(parentID, FetchSet.Modules);

                if (displayUnlock || components.Contains(&quot;ForecastBeforeLock&quot;))
                {
                    ScheduleUpdationModel model = ScheduleUpdationModel.GetInstance(&quot;QTYPLAN&quot;);
                    if (model != null &amp;&amp; components.Contains(&quot;Forecast&quot;)) itemDetailGroup.AddMenu(new LargeButton(&quot;lnkForecast1&quot;, &quot;Forecast&quot;, &quot;Icn_Forecast_32.png&quot;));
                }
                if ((contractDto.ContainsModule(&quot;MSTRPLN&quot;) || contractDto.ContainsModule(&quot;PROGRAM&quot;))
                    &amp;&amp; components.Contains(&quot;GanttView&quot;))
                {
                    MenuButton menu = (MenuButton)itemDetailGroup.Menus.Find(m =&gt; m.ID == &quot;lnkItemDetails&quot;);
                    if (menu != null)
                        menu.AddSubMenu(new TextIcon(&quot;lnkGanttView&quot;, &quot;Scheduling - Gantt View&quot;, &quot;Icn_Scheduling_16.png&quot;));
                    else
                        itemDetailGroup.AddMenu(new TextIcon(&quot;lnkGanttView&quot;, &quot;Scheduling - Gantt View&quot;, &quot;Icn_Scheduling_16.png&quot;));
                }

                MenuGroup OthersGroup = menuGroups.Find(mg =&gt; mg.Title == &quot;Others&quot;);
                if (OthersGroup != null)
                {
                    OthersGroup.AddMenu(new TextIcon(&quot;lnkGroups&quot;, &quot;Groups&quot;, &quot;Icn_Inherit_16.png&quot;));
                    #region AssociateFund
                    List&lt;string&gt; ModuleComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_FNDMGMT);
                    if (ModuleComponents != null &amp;&amp; ModuleComponents.Contains(&quot;FUND&quot; + Request[&quot;Context&quot;]) &amp;&amp; CanAssociateFund)
                    {
                        List&lt;TextIcon&gt; lstRules = new List&lt;TextIcon&gt;();
                        DataSet ds = ItemManager.Instance.GetFundRule(Request[&quot;PID&quot;].ToInt32_2());
                        foreach (DataRow dr in ds.Tables[0].Rows)
                            lstRules.Add(new TextIcon(&quot;lnkApplyFundRule&quot; + dr[&quot;ID&quot;].ToString2(), dr[&quot;RuleName&quot;].ToString2(), &quot;Icn_Addexistingrecord_16.png&quot;, tag: &quot;RuleID-&quot; + dr[&quot;ID&quot;].ToString2()));

                        if (lstRules.Count &gt; 1)
                        {
                            MenuButton menuImpExp = new MenuButton(&quot;lnkFundRules&quot;, &quot;Associate Fund&quot;, &quot;Icn_Addexistingrecord_16.png&quot;);
                            menuImpExp.ButtonSize = ButtonSize.Medium;
                            lstRules.ForEach(mnu =&gt; { menuImpExp.AddSubMenu(mnu); });
                            OthersGroup.AddMenu(menuImpExp);
                        }
                        else
                            lstRules.ForEach(mnu =&gt;
                            {
                                mnu.Text = &quot;Associate Fund - &quot; + mnu.Text;
                                OthersGroup.AddMenu(mnu);
                            });
                    }
                    #endregion

                    #region Primavera Sync
                    if (components.Contains(&quot;PrimaveraSync&quot;))
                    {
                        OthersGroup.AddMenu(new TextIcon(&quot;lnkSyncWithP6&quot;, &quot;Sync With P6&quot;, &quot;Icn_Inherit_16.png&quot;));
                        OthersGroup.AddMenu(new TextIcon(&quot;lnkFetchSchedule&quot;, &quot;Fetch Schedule (P6)&quot;, &quot;Icn_Inherit_16.png&quot;));
                    }
                    #endregion
                }
                MenuButton btnReports = (MenuButton)OthersGroup.Menus.Find(m =&gt; m.ID == MENU_REPORTS_ID);
                if (btnReports == null)
                {
                    btnReports = new MenuButton(MENU_REPORTS_ID, MENU_REPORTS, &quot;Icn_Reports.png&quot;);
                    btnReports.AddSubMenu(new TextIcon(&quot;lnkContractItemListReport&quot;, &quot;Contract Item List Report&quot;, &quot;Icn_Pdf_16.png&quot;));
                    OthersGroup.AddMenu(btnReports);
                }
                return menuGroups;
            }
        }

        public override void SetUIDetails()
        {
            SetUIDetails(this);


        }

        public override void SetUIDetails(ItemListModel itemListModel)
        {
            itemListModel.DisplayWorkFlowHistory = itemListModel.DisplayWorkFlowStatus = IsWorkflow;
            displayBudgetItemAssociatePicker = true;
            itemListModel.DisplayApplyFilter =
                itemListModel.DisplayEdit = itemListModel.DisplayNew = itemListModel.DisplayNewContainer =
                itemListModel.DisplaySubItems = itemListModel.DisplayRateAnalysis = itemListModel.DisplayExport =
                itemListModel.DisplayTemplateExport = true;

            if (IsSubmit &amp;&amp; !IsLocked)
                itemListModel.DisplayEdit = itemListModel.DisplayNew = itemListModel.DisplayNewContainer =
                itemListModel.EnableDelete = itemListModel.EnableAddMulti = itemListModel.DisplayAddMultiple =
                itemListModel.DisplayItemCopyPaste = itemListModel.DisplaySubItemCopyPaste =
                itemListModel.DisplaySubItems = itemListModel.DisplayRateAnalysis = false;

            if (itemListModel.ParentID != 0)
            {
                itemListModel.DisplayLock = !(itemListModel.DisplayUnlock = IsLocked);
                if (IsLocked &amp;&amp; IsCRAttached)
                {
                    itemListModel.DisplayContractView = !(itemListModel.DisplayExecutionView = IsCV);
                }
            }
            itemListModel.Header = GlobalizationUtility.SetResource(&quot;Item&quot;, false) + &quot; List&quot;;

            DisplayReorder = !itemListModel.DisplayUnlock;

            // OTHER ACTIONS 
            SetItemListDisplayOptions(itemListModel);
            //itemListModel.DisplayImport =
            //    itemListModel.DisplayAddMultiple =
            //    itemListModel.DisplaySubItemCopyPaste = itemListModel.DisplayItemCopyPaste = itemListModel.DisplayLock &amp;&amp; !IsSubmit;

            itemListModel.ShowFlatList = true;
            itemListModel.EnableSave = false;
            if (!IsLocked)
                AllowGridEdit = true;
            else
                AllowGridEdit = false;


        }

        private void SetItemListDisplayOptions(ItemListModel itemListModel)
        {
            itemListModel.DisplayOverheadExpenses =
               IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX) &amp;&amp;
               itemListModel.DisplayUnlock;

            List&lt;string&gt; Checkcomponents = ModuleManagementBL.ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);
            if (IsCRAttached)
            {
                if (Checkcomponents.Contains(&quot;ItemNCItem&quot;))
                {
                    itemListModel.DisplayImport = itemListModel.DisplayAddMultiple =
                    itemListModel.DisplaySubItemCopyPaste = (itemListModel.DisplayItemCopyPaste = !DisplayLock) ? false : true;
                }
                else//--In BOQ, we are allowed to add NC items - we don�t need this for oil and gas 
                {
                    itemListModel.DisplayImport = itemListModel.DisplayAddMultiple =
                    itemListModel.DisplaySubItemCopyPaste = itemListModel.DisplayItemCopyPaste = IsSubmit;
                }
            }
            else
            {
                itemListModel.DisplayImport = itemListModel.DisplayAddMultiple =
                itemListModel.DisplaySubItemCopyPaste = itemListModel.DisplayItemCopyPaste = (!Checkcomponents.Contains(&quot;ItemNCItem&quot;) &amp;&amp; IsSubmit) ? false : true;
            }

            if (ItemManager.Instance.GetGroupType(itemListModel.ParentID, Constants.MODID_CONTMGT) == &#39;G&#39;)
                itemListModel.DisplayGlobalGroups = true;

            if (IsCRAttached &amp;&amp; IsLocked &amp;&amp; IsCV)
            {
                itemListModel.DisplayRateAnalysis = itemListModel.DisplaySubItems = false;
            }
        }

        protected override void SetModuleLevelPermissions(List&lt;string&gt; permissions)
        {
            base.SetModuleLevelPermissions(permissions);
            if (displayOverheadExpenses &amp;&amp; !(permissions.Contains(&quot;OHDPOSTView&quot;))) displayOverheadExpenses = false;

            if (IsLocked &amp;&amp; IsCRAttached)
            {
                if (!permissions.Contains(&quot;ContractView&quot;) &amp;&amp; !permissions.Contains(&quot;ExecutionView&quot;))
                {
                    UIHelper.RedirectURL(
                        MessageResourceManager.GetString(&quot;E_USRMGMT_NO_PERMISSIONS_TO_VIEW_PAGE&quot;,
                                                         Enumerations.MessageType.ErrorMessage),
                        Constants.URL_ENTERPRISE, null, HttpContext.Current);
                }
                else if (!permissions.Contains(&quot;ContractView&quot;))
                {
                    DisplayExecutionView = DisplayContractView = false;
                    if (IsCV)
                        Response.Redirect(
                             Request.Url.ToString2().Remove(Request.QueryString.ToString2().IndexOf(&quot;&amp;IsCV&quot;), 7), true);
                }
                else if (!permissions.Contains(&quot;ExecutionView&quot;))
                {
                    DisplayExecutionView = DisplayContractView = false;
                    if (!IsCV) Response.Redirect(Request.Url.ToString2() + &quot;&amp;IsCV=Y&quot;, true);
                }
            }

            List&lt;string&gt; components = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CONTMGT);

            if (components.Contains(&quot;CostViewDetails&quot;) &amp;&amp; permissions.Contains(&quot;CMDETLS&quot;))
                DisplayCostManager = true;
        }

        public override BrixFilter[] GetApplyFilterLabels()
        {
            var filters = new BrixFilter[4];
            filters[0] = new BrixFilter();
            filters[0].Name = &quot;StandardItemNo&quot;;
            filters[0].Title = GlobalizationUtility.SetResource(&quot;Pay Item No&quot;, false);
            filters[0].FilterType = BrixFilter.Type.Text;

            filters[1] = new BrixFilter();
            filters[1].Title = filters[1].Name = &quot;Description&quot;;
            filters[1].FilterType = BrixFilter.Type.Text;

            filters[2] = new BrixFilter();
            filters[2].Name = &quot;IsComplete&quot;;
            filters[2].Title = &quot;Complete&quot;;
            filters[2].FilterType = BrixFilter.Type.Radio;
            filters[2].Values = new Dictionary&lt;string, string&gt;();
            filters[2].Values.Add(&quot;Yes&quot;, &quot;1&quot;);
            filters[2].Values.Add(&quot;No&quot;, &quot;0&quot;);

            filters[3] = new BrixFilter();
            filters[3].Name = &quot;IsNonContract&quot;;
            filters[3].Title = GlobalizationUtility.SetResource(&quot;Item&quot;, false) + &quot; Type&quot;;
            filters[3].FilterType = BrixFilter.Type.Radio;
            filters[3].Values = new Dictionary&lt;string, string&gt;();
            filters[3].Values.Add(&quot;Contract&quot;, &quot;0&quot;);
            filters[3].Values.Add(&quot;Non-Contract&quot;, &quot;1&quot;);

            return filters;
        }

        public override int HandleUnlock()
        {
            Dictionary&lt;string, Type&gt; dicObj = AfterSaveRecordModel.GetModelObjects();
            //Before unlock 
            foreach (KeyValuePair&lt;string, Type&gt; kvp in dicObj)
            {
                var Savemodel = AfterSaveRecordModel.GetInstance(kvp.Key);
                if (Savemodel != null)
                    Savemodel.SaveDetails(parentID, null, &quot;Lock&quot;, &quot;BEFORE_CONTRACT_UNLOCK&quot;);
            }

            int lockStatus = BL.Instance.UpdateLockStatus(Request[Constants.QRY_PROJECTID].ToInt32_2(), parentID, Operations.UnLock);
            _IsLocked = _IsSubmited = null;
            displayUnlock = !(displayLock = !IsLocked);
            displayItemCopyPaste = displaySubItemCopyPaste = displayLock;
            if (displayLock &amp;&amp; IsCRAttached)
                DisplayExecutionView = DisplayContractView = false;
            displayOverheadExpenses = IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX) &amp;&amp; displayUnlock;

            if (HttpContext.Current != null &amp;&amp; HttpContext.Current.Handler != null)
                (HttpContext.Current.Handler as BrixPageBase).UpdateTree = true;
            //Deleting the Commitment if the contract is unlocked
            ProcurementCommitments.Instance.DeleteCommitmentAndItems(null, &quot;CONTMGT&quot;, parentID);

            if (!IsLocked &amp;&amp; hGrid != null)
                hGrid.IsReadOnly = hGrid.IsCompleteReadOnly = false;

            if (IsCV)
            {
                string queryString = Request.QueryString.ToString2();
                if (Request.QueryString.ToString2().Contains(&quot;&amp;IsCV&quot;))
                    queryString = Request.QueryString.ToString2().Remove(Request.QueryString.ToString2().IndexOf(&quot;&amp;IsCV&quot;), 7);
                //string queryString = Request.QueryString.ToString2().Remove(Request.QueryString.ToString2().IndexOf(&quot;&amp;IsCV&quot;), 7);
                Response.Redirect(string.Format(CultureInfo.InvariantCulture, &quot;~/Common/BrixItemListPage.aspx?{0}&quot;, queryString), false);
            }
            SetUIDetails();

            //Before unlock 
            foreach (KeyValuePair&lt;string, Type&gt; kvp in dicObj)
            {
                var Savemodel = AfterSaveRecordModel.GetInstance(kvp.Key);
                if (Savemodel != null)
                    Savemodel.SaveDetails(parentID, null, &quot;Lock&quot;, &quot;AFTER_CONTRACT_UNLOCK&quot;);
            }

            return lockStatus;
        }

        public override int HandleLock()
        {
            List&lt;string&gt; BDGMGMTCheckcomponents = ModuleManagementBL.ModuleManager.Instance.GetModuleComponenets(Constants.MODID_BDGMGMT);

            if (BDGMGMTCheckcomponents.Contains(&quot;ValidateAgainstCB&quot;))
            {
                //Validate against Current Budget before Contract Lock
                if (!BL.Instance.ValidateBeforeApproval(parentID))
                {
                    throw new Exception(&quot;Cannot lock this construction contract as the total commitment amount and the current contract amount exceeds the current budget amount. Request denied.&quot;);
                }
            }

            Dictionary&lt;string, Type&gt; dicObj = AfterSaveRecordModel.GetModelObjects();
            //Before lock 
            foreach (KeyValuePair&lt;string, Type&gt; kvp in dicObj)
            {
                var Savemodel = AfterSaveRecordModel.GetInstance(kvp.Key);
                if (Savemodel != null)
                    Savemodel.SaveDetails(parentID, null, &quot;Lock&quot;, &quot;BEFORE_CONTRACT_LOCK&quot;);
            }

            List&lt;string&gt; Checkcomponents = ModuleManagementBL.ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CONTMGT);
            if (Checkcomponents.Contains(&quot;ValidateContractDates&quot;))
            {
                // if (Convert.IsDBNull(ComponentHelper.Instance.ExecuteScalar(&quot;SELECT NPD from CONTMGTKeyDates where ContractID=&quot; + parentID)))
                if (Convert.IsDBNull(ComponentHelper.Instance.ExecuteScalar(ContractManagerStoredProcedure.usp_CONTMGTGetNPDfromKeyDates, null, parentID)))
                    throw new Exception(&quot;To Lock the Contract, Notice to Proceed date must be filled in.&quot;);
                int ValidateContractStartDateWithNoticeToProceedDate = BL.Instance.ValidateContractStartDateWithNoticeToProceedDate(parentID);
                if (ValidateContractStartDateWithNoticeToProceedDate == -1)
                    throw new Exception(&quot;Notice to proceed date can not be greater than the Contract Start Date.&quot;);
            }

            int lockStatus = BL.Instance.UpdateLockStatus(Request[Constants.QRY_PROJECTID].ToInt32_2(), parentID, Operations.Lock);
            _IsLocked = _IsSubmited = null;
            if (IsLocked)
            {
                displayItemCopyPaste = displaySubItemCopyPaste = displayLock = !(displayUnlock = true);
                displayOverheadExpenses = IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX) &amp;&amp; displayUnlock;
                if (IsCRAttached)
                    DisplayExecutionView = !(DisplayContractView = displayUnlock);

                if (IsCRAttached)
                    hGrid.IsCompleteReadOnly = true;
            }

            if (HttpContext.Current != null &amp;&amp; HttpContext.Current.Handler != null)
                (HttpContext.Current.Handler as BrixPageBase).UpdateTree = true;
            SetUIDetails();

            BL.Instance.CreateCommitments(parentID);

            //After lock 
            foreach (KeyValuePair&lt;string, Type&gt; kvp in dicObj)
            {
                var Savemodel = AfterSaveRecordModel.GetInstance(kvp.Key);
                if (Savemodel != null)
                    Savemodel.SaveDetails(parentID, null, &quot;Lock&quot;, &quot;AFTER_CONTRACT_LOCK&quot;);
            }


            return lockStatus;
        }

        public override void ApplyToolBarCustomisation(ToolBar toolBarArg)
        {
            base.ApplyToolBarCustomisation(toolBarArg);
            List&lt;string&gt; Checkcomponents = ModuleManagementBL.ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);
            if (IsCRAttached)
            {
                if (toolBarArg.GetMenuReference(&quot;lnkAddNew&quot;) != null)
                {
                    if (Checkcomponents.Contains(&quot;ItemNCItem&quot;))
                    {
                        if (toolBarArg.GetMenuReference(&quot;lnkNew&quot;) != null)
                        {
                            toolBarArg.GetMenuReference(&quot;lnkNew&quot;).Enabled = DisplayLock;
                            if (!DisplayLock)
                            {
                                toolBarArg.DisableMenu(&quot;lnkAddNew&quot;);
                                toolBarArg.GetMenuReference(&quot;lnkAddNew&quot;).OnClientClick = &quot;return false;&quot;;
                                toolBarArg.DisableMenu(&quot;lnkNew&quot;);
                                toolBarArg.GetMenuReference(&quot;lnkNew&quot;).OnClientClick = &quot;return false;&quot;;

                            }
                        }
                        if (toolBarArg.GetMenuReference(&quot;lnkAddMulti&quot;) != null)
                        {
                            toolBarArg.GetMenuReference(&quot;lnkAddMulti&quot;).Enabled = DisplayLock;
                            if (!DisplayLock)
                            {
                                toolBarArg.DisableMenu(&quot;lnkAddMulti&quot;);
                                toolBarArg.GetMenuReference(&quot;lnkAddMulti&quot;).OnClientClick = &quot;return false;&quot;;
                            }
                        }
                        if (toolBarArg.GetMenuReference(&quot;lnkNewContainer&quot;) != null)
                        {
                            toolBarArg.GetMenuReference(&quot;lnkNewContainer&quot;).Enabled = DisplayLock;
                            if (!DisplayLock)
                            {
                                toolBarArg.DisableMenu(&quot;lnkNewContainer&quot;);
                                toolBarArg.GetMenuReference(&quot;lnkNewContainer&quot;).OnClientClick = &quot;return false;&quot;;
                            }
                        }
                    }
                    else//--In BOQ, we are allowed to add NC items - we don�t need this for oil and gas 
                    {
                        if (toolBarArg.GetMenuReference(&quot;lnkAddNew&quot;) != null &amp;&amp; IsSubmit)
                        {
                            toolBarArg.GetMenuReference(&quot;lnkAddNew&quot;).Enabled = false;
                            toolBarArg.DisableMenu(&quot;lnkAddNew&quot;);
                            toolBarArg.GetMenuReference(&quot;lnkAddNew&quot;).OnClientClick = &quot;return false;&quot;;
                        }
                        if (toolBarArg.GetMenuReference(&quot;lnkNew&quot;) != null &amp;&amp; IsSubmit)
                        {
                            toolBarArg.GetMenuReference(&quot;lnkNew&quot;).Enabled = false;
                            toolBarArg.DisableMenu(&quot;lnkNew&quot;);
                            toolBarArg.GetMenuReference(&quot;lnkNew&quot;).OnClientClick = &quot;return false;&quot;;
                        }
                        if (toolBarArg.GetMenuReference(&quot;lnkAddMulti&quot;) != null &amp;&amp; IsSubmit)
                        {
                            toolBarArg.GetMenuReference(&quot;lnkAddMulti&quot;).Enabled = false;
                            toolBarArg.DisableMenu(&quot;lnkAddMulti&quot;);
                            toolBarArg.GetMenuReference(&quot;lnkAddMulti&quot;).OnClientClick = &quot;return false;&quot;;
                        }
                        if (toolBarArg.GetMenuReference(&quot;lnkNewContainer&quot;) != null &amp;&amp; IsSubmit)
                        {
                            toolBarArg.GetMenuReference(&quot;lnkNewContainer&quot;).Enabled = IsSubmit;
                            toolBarArg.DisableMenu(&quot;lnkNewContainer&quot;);
                            toolBarArg.GetMenuReference(&quot;lnkNewContainer&quot;).OnClientClick = &quot;return false;&quot;;
                        }
                    }
                }

                if (toolBarArg.GetMenuReference(&quot;lnkDelete&quot;) != null)
                {
                    toolBarArg.GetMenuReference(&quot;lnkDelete&quot;).Enabled = DisplayLock;
                    if (!DisplayLock)
                    {
                        toolBarArg.DisableMenu(&quot;lnkDelete&quot;);
                        toolBarArg.GetMenuReference(&quot;lnkDelete&quot;).OnClientClick = &quot;return false;&quot;;
                    }

                    if (!Checkcomponents.Contains(&quot;ItemNCItem&quot;) &amp;&amp; IsSubmit)
                    {
                        toolBarArg.DisableMenu(&quot;lnkDelete&quot;);
                        toolBarArg.GetMenuReference(&quot;lnkDelete&quot;).Enabled = false;
                        toolBarArg.GetMenuReference(&quot;lnkDelete&quot;).OnClientClick = &quot;return false;&quot;;
                    }
                }

                if (toolBarArg.GetMenuReference(&quot;lnkExcelImport&quot;) != null)
                    toolBarArg.GetMenuReference(&quot;lnkExcelImport&quot;).Enabled = DisplayLock;
                if (toolBarArg.GetMenuReference(&quot;lnkItemCopyPaste&quot;) != null)
                    toolBarArg.GetMenuReference(&quot;lnkItemCopyPaste&quot;).Enabled = DisplayLock;
                if (toolBarArg.GetMenuReference(&quot;lnkSubItemCopyPaste&quot;) != null)
                    toolBarArg.GetMenuReference(&quot;lnkSubItemCopyPaste&quot;).Enabled = DisplayLock;
            }
            else
            {
                if (!Checkcomponents.Contains(&quot;ItemNCItem&quot;) &amp;&amp; IsSubmit)
                {
                    if (toolBarArg.GetMenuReference(&quot;lnkAddNew&quot;) != null &amp;&amp; IsSubmit)//--In BOQ, we are allowed to add NC items - we don�t need this for oil and gas
                    {
                        toolBarArg.GetMenuReference(&quot;lnkAddNew&quot;).Enabled = false;
                        toolBarArg.DisableMenu(&quot;lnkAddNew&quot;);
                        toolBarArg.GetMenuReference(&quot;lnkAddNew&quot;).OnClientClick = &quot;return false;&quot;;
                    }
                    if (toolBarArg.GetMenuReference(&quot;lnkNew&quot;) != null &amp;&amp; IsSubmit)
                    {
                        toolBarArg.GetMenuReference(&quot;lnkNew&quot;).Enabled = false;
                        toolBarArg.DisableMenu(&quot;lnkNew&quot;);
                        toolBarArg.GetMenuReference(&quot;lnkNew&quot;).OnClientClick = &quot;return false;&quot;;
                    }
                    if (toolBarArg.GetMenuReference(&quot;lnkAddMulti&quot;) != null &amp;&amp; IsSubmit)
                    {
                        toolBarArg.GetMenuReference(&quot;lnkAddMulti&quot;).Enabled = false;
                        toolBarArg.DisableMenu(&quot;lnkAddMulti&quot;);
                        toolBarArg.GetMenuReference(&quot;lnkAddMulti&quot;).OnClientClick = &quot;return false;&quot;;
                    }
                    if (toolBarArg.GetMenuReference(&quot;lnkNewContainer&quot;) != null &amp;&amp; IsSubmit)
                    {
                        toolBarArg.GetMenuReference(&quot;lnkNewContainer&quot;).Enabled = false;
                        toolBarArg.DisableMenu(&quot;lnkNewContainer&quot;);
                        toolBarArg.GetMenuReference(&quot;lnkNewContainer&quot;).OnClientClick = &quot;return false;&quot;;
                    }
                    if (toolBarArg.GetMenuReference(&quot;lnkDelete&quot;) != null)
                    {
                        toolBarArg.DisableMenu(&quot;lnkDelete&quot;);
                        toolBarArg.GetMenuReference(&quot;lnkDelete&quot;).Enabled = false;
                        toolBarArg.GetMenuReference(&quot;lnkDelete&quot;).OnClientClick = &quot;return false;&quot;;
                    }
                    if (toolBarArg.GetMenuReference(&quot;lnkEdit&quot;) != null)
                    {
                        toolBarArg.DisableMenu(&quot;lnkEdit&quot;);
                        toolBarArg.GetMenuReference(&quot;lnkEdit&quot;).Enabled = false;
                        toolBarArg.GetMenuReference(&quot;lnkEdit&quot;).OnClientClick = &quot;return false;&quot;;
                    }
                }
            }
            if (toolBarArg.GetMenuReference(&quot;lnkLock&quot;) != null)
            {
                toolBarArg.GetMenuReference(&quot;lnkLock&quot;).OnClientClick = &quot;return ValidateLockItems();&quot;;
            }

            if (this.displayUnlock)
                toolBarArg.DisableMenu(&quot;lnkListSave&quot;);
        }

        public override int UpdateItems(string xmlArgument)
        {
            int rtn = base.UpdateItems(xmlArgument);

            return rtn;
        }

        public override void HandleDelete(ItemTypes type, string ids)
        {
            if (type == ItemTypes.Item)
            {
                ItemManager.Instance.DeleteItemDetails(ids, null);
            }
            else
            {
                if (DisplayLock)
                    ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                        StoredProcedure.usp_CORITEMDeleteContainer, null, ids);
                else
                    throw new Exception(&quot;Cannot delete containers after locking the contract.Request Denied.&quot;);
            }
        }

        public override int HandleDelete()
        {
            return 0;
        }

        public override string HandleMenuItem(string eventString)
        {
            switch (eventString)
            {
                case &quot;NewContainer&quot;:
                    Response.Redirect(string.Format(CultureInfo.InvariantCulture,
                                                     &quot;~/Common/BrixItemContainer.aspx?Context={0}&amp;Mode={1}&amp;ParentID={2}&amp;PID={3}{4}&quot;,
                                                     ModuleId, ModeTypes.New.ToInt32_2(), ParentID, Request[&quot;PID&quot;],
                                                     CVString));
                    break;
                case &quot;Global Groups&quot;:
                    Response.Redirect(string.Format(CultureInfo.InvariantCulture,
                                                     &quot;~/Common/BrixListPage.aspx?Context=GLOBALGROUP{0}&amp;LockMode={1}&amp;ParentInstanceID={2}&amp;PID={3}&amp;ModuleID={0}&quot;,
                                                     ModuleId,
                                                     DisplayUnlock
                                                         ? ModeTypes.View.ToInt32_2()
                                                         : ModeTypes.Edit.ToInt32_2(), ParentID,
                                                     Request[Constants.QRY_PROJECTID]));
                    break;
                case &quot;Overhead Expenses&quot;:
                    Response.Redirect(string.Format(CultureInfo.InvariantCulture,
                                                     &quot;~/Common/BrixListPage.aspx?Context={0}&amp;ContractID={1}&amp;PID={2}{3}&amp;ParentID={1}&quot;,
                                                     &quot;OHDPOST&quot;, ParentID, Request[&quot;PID&quot;], CVString));
                    break;
                case &quot;Execution View&quot;:
                    string queryString =
                        Request.QueryString.ToString2().Remove(Request.QueryString.ToString2().IndexOf(&quot;&amp;IsCV&quot;), 7);
                    Response.Redirect(string.Format(CultureInfo.InvariantCulture, &quot;~/Common/BrixItemListPage.aspx?{0}&quot;,
                                                     queryString));
                    break;
                case &quot;Contract View&quot;:
                    Response.Redirect(string.Format(CultureInfo.InvariantCulture,
                                                     &quot;~/Common/BrixItemListPage.aspx?{0}&amp;{1}&quot;, Request.QueryString,
                                                     &quot;IsCV=Y&quot;));
                    break;
                case &quot;Cost Sheet&quot;:
                    Response.Redirect(
                         string.Format(&quot;~/Common/BrixItemListPage.aspx?Context={0}&amp;PID={1}&amp;ContractId={2}&amp;ParentId={2}{3}&quot;, &quot;CMDETLS&quot;,
                                       Request[Constants.QRY_PROJECTID], parentID, CVString));
                    break;
                case &quot;Forecast&quot;:
                    string msg = string.Empty;
                    //Create Schedule
                    ScheduleUpdationModel model = ScheduleUpdationModel.GetInstance(&quot;CONTMGT&quot;);
                    if (model != null)
                    {
                        if (model.CreateForecast(parentID, Request[Constants.QRY_PROJECTID].ToInt32_2(), UserDetail.GetCurrentUserDetail().UID))
                        {
                            EnableSave = false; throw new AMP3SuccessMessage(&quot;Forecast created successfully.&quot;);
                        }
                        else
                        {
                            EnableSave = false; throw new Exception(&quot;An unexpected error has occurred. Forecast is not created.&quot;);
                        }
                    }
                    EnableSave = false;
                    return msg;
                case &quot;Flat List&quot;:
                    string url = &quot;~/Common/BrixListPage.aspx?&quot; + Request.QueryString;
                    url = url.ToLower().Replace(&quot;context=contmgt&quot;, &quot;Context=FLATCNT&quot;).Replace(&quot;mode=edit&quot;, &quot;mode=Edit&quot;);
                    Response.Redirect(url);
                    break;
                case &quot;Groups&quot;:
                    Response.Redirect(
                        string.Format(&quot;~/Modules/CONTMGT/Groups.aspx?Context=CONTMGT&amp;PID={0}&amp;ContractId={1}&amp;ParentId={1}&quot;,
                                     Request[Constants.QRY_PROJECTID], parentID));
                    break;
                case &quot;Refresh Line Number&quot;:
                    ItemManager.Instance.RefreshLineNumbers(&quot;CONTMGT&quot;, ParentID);
                    EnableSave = false;
                    break;
                //case &quot;Contract Item List Report&quot;:
                //    Response.Redirect(String.Format(CultureInfo.CurrentCulture,
                //        &quot;~/Common/BrixListReportPage.aspx?Context=CONTMIL&amp;ParentID={0}&amp;ModelType=ItemList&amp;ModuleID=CONTMGT&amp;ParentModuleID=CONTMGT&amp;PID={1}&quot;,
                //        Request[&quot;ParentID&quot;], Request[&quot;PID&quot;]), true);
                //    isMenuClickHandled = true;
                //    break;
                case &quot;Sync With P6&quot;:
                    PrimaveraManager pvm = new PrimaveraManager();

                    Project project = ProjectManager.Instance.GetProjectDetails(int.Parse(Request[Constants.QRY_PROJECTID]));
                    DataSet ds = ComponentHelper.Instance.ExecuteDataSet(StoredProcedure.usp_CORITEMGetItemDetails, null,
                                                                 &quot;CONTMGT&quot;, parentID, null, null, &quot;&quot;, null,
                                                                 String.Empty, null, false, null, null, null);

                    DataTable containers = ds.Tables[0];
                    DataTable items = ds.Tables[1];

                    pvm.ProjectID = project.ProjectCode;
                    pvm.ProjectName = project.ProjectName;
                    pvm.WBS = containers;
                    pvm.Activities = items;

                    bool syncSuccessful = pvm.SyncWithPrimavera();

                    if (syncSuccessful)
                        throw new Exception(&quot;Synchronization was completed successfully.&quot;);
                    else
                        throw new Exception(&quot;Could not synchronize data.&quot;);

                case &quot;Fetch Schedule (P6)&quot;:
                    PrimaveraManager pvm1 = new PrimaveraManager();
                    Project project1 = ProjectManager.Instance.GetProjectDetails(int.Parse(Request[Constants.QRY_PROJECTID]));

                    pvm1.ContractID = parentID;
                    pvm1.ProjectID = project1.ProjectCode;

                    bool syncScheduleSuccessful = pvm1.SyncScheduleFromPrimavera();

                    if (syncScheduleSuccessful)
                        throw new Exception(&quot;Schedule synchronization completed successfully.&quot;);
                    else
                        throw new Exception(&quot;Could not synchronize data.&quot;);
                default:
                    return HandleContractMenuItem(eventString);
            }

            return string.Empty;
        }

        private string HandleContractMenuItem(string eventString)
        {
            if (eventString.Equals(ItemNameAbbr + &quot; List Report&quot;) &amp;&amp; IsLocked &amp;&amp; IsCRAttached)
            {
                SetHierarchicalGridState();
                Response.Redirect(string.Format(CultureInfo.CurrentCulture,
                                                &quot;~/Common/BrixReportPage.aspx?Context=CONTMGTITMLIST&amp;Code={0}&amp;ParentID={1}&amp;PID={2}&amp;MODID=ITMLIST{3}&amp;ParentModuleId={4}&quot;,
                                                ModuleId, ParentID, Request[&quot;PID&quot;], CVString, ModuleId));
                return string.Empty;
            }
            else if (eventString.Equals(&quot;Scheduling - Gantt View&quot;))
            {
                SetHierarchicalGridState();
                string backUrl = Request.Url.PathAndQuery;
                Response.Redirect(string.Format(CultureInfo.CurrentCulture,
                    &quot;~/ItemGanttView.aspx?Context=CONTMGT&amp;ParentID={0}&amp;PID={1}&amp;C={2}&amp;UID={3}&amp;BackURL={4}&quot;,
                    ParentID, Request[&quot;PID&quot;], CalendarID, UserDetail.GetCurrentUserDetail().UID,
                    HttpContext.Current.Server.UrlEncode(SecurityHelpers.Encrypt_Simple(backUrl))));
                return string.Empty;
            }
            else if (eventString.Equals(&quot;Contract Item List Report&quot;, StringComparison.CurrentCultureIgnoreCase))
            {
                Response.Redirect(String.Format(CultureInfo.CurrentCulture,
                       &quot;~/Common/BrixListReportPage.aspx?Context=CONTMIL&amp;ParentID={0}&amp;ModelType=ItemList&amp;ModuleID=CONTMGT&amp;ParentModuleID=CONTMGT&amp;ParentContext=CONTMGT&amp;PID={1}&quot;,
                       Request[&quot;ParentID&quot;], Request[&quot;PID&quot;]), true);
                isMenuClickHandled = true;
                return string.Empty;
            }
            else
                return base.HandleMenuItem(eventString);
        }

        public override DataSet GetSchema()
        {
            var ici = new ImportContractItems();
            return ici.GetSchema(&quot;AXCompany&quot;);
        }

        protected override void GetExportListData(DataSet ds)
        {
            if (ds.Tables.Contains(LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR)))
            {
                if (ds.Tables[LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR)].Columns.Contains(&quot;AltCode&quot;))
                    ds.Tables[LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR)].Columns.Remove(&quot;AltCode&quot;);
                if (ds.Tables[LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR)].Columns.Contains(&quot;IsMustBid&quot;))
                    ds.Tables[LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR)].Columns.Remove(&quot;IsMustBid&quot;);
            }
        }

        public override DataSet GetList(int pageSize, string sortOrder, string filter, ref int currentPage,
                                        out int count)
        {
            count = 1;
            filter = GetFilter(IsLocked, IsCRAttached, IsCV, filter);
            DataSet ds = GetItemDataSet(ModuleId, ParentID, filter);
            return ds;
        }

        public static string GetFilter(bool locked, bool hasCR, bool isCV, string filter)
        {
            if (hasCR &amp;&amp; locked)
            {
                if (!string.IsNullOrEmpty(filter))
                    filter = filter.Insert(filter.IndexOf(&quot;&lt;/XMLRoot&gt;&quot;),
                                           &quot;&lt;IsContractView&gt;&quot; + isCV + &quot;&lt;/IsContractView&gt;&lt;IsAmountFromCost&gt;&quot; + !isCV +
                                           &quot;&lt;/IsAmountFromCost&gt;&quot;);
                else
                    filter = &quot;&lt;XMLRoot&gt;&lt;IsContractView&gt;&quot; + isCV + &quot;&lt;/IsContractView&gt;&lt;IsAmountFromCost&gt;&quot; + !isCV +
                             &quot;&lt;/IsAmountFromCost&gt;&lt;/XMLRoot&gt;&quot;;
            }
            return filter;
        }

        public static DataSet GetItemDataSet(string moduleId, int parentId, string filter)
        {
            DataSet ds = ComponentHelper.Instance.ExecuteDataSet(StoredProcedure.usp_CORITEMGetItemDetails, null,
                                                                 moduleId, parentId, null, null, filter, null,
                                                                 String.Empty, null, false, null, null, null);
            switch (ds.Tables.Count)
            {
                case 1:
                    break;
                default:
                    ds.Tables[0].TableName = &quot;Container&quot;;
                    ds.Tables[1].TableName = &quot;Items&quot;;
                    ds.Tables[2].TableName = &quot;ItemSummary&quot;;
                    ds.Tables[4].TableName = &quot;ActivityDates&quot;;
                    if (ds.Tables.Count &gt; 5)
                        ds.Tables[5].TableName = &quot;ExpenseSummary&quot;;
                    if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX))
                    {
                        foreach (DataRow dr in ds.Tables[&quot;Items&quot;].Rows)
                        {
                            DataTable dtEISLookUp =
                                IntegrationConnectorManager.Instance.GetEISLookUpInfo(
                                    Convert.ToInt32(dr[&quot;UnitID&quot;], CultureInfo.CurrentCulture), RegisteredEIS.AX,
                                    EISObjectType.Unit);
                            if (dtEISLookUp.Rows.Count &gt; 0)
                                dr[&quot;Unit&quot;] = dtEISLookUp.Rows[0][&quot;ERPId&quot;].ToString();
                        }
                    }
                    break;
            }
            return ds;
        }

        public override HierarchicalGridColumns HGridColumns()
        {
            HierarchicalGridColumns cols = base.HGridColumns();

            if (IsLocked &amp;&amp; IsCRAttached)
            {
                hGrid.IsCompleteReadOnly = true;
                if (cols.Contains(&quot;Quantity&quot;))
                {
                    HierarchicalGridColumn quantityColumn = cols.FindByColumnName(&quot;Quantity&quot;);
                    quantityColumn.Caption = IsCV ? &quot;Contract Quantity&quot; : &quot;Execution Quantity&quot;;
                }
                if (IsCV)
                {
                    if (cols.Contains(&quot;Number&quot;)) cols.Remove(cols.FindByColumnName(&quot;Number&quot;));
                    if (cols.Contains(&quot;Dimension1&quot;))
                        cols.Remove(cols.FindByColumnName(&quot;Dimension1&quot;));
                    if (cols.Contains(&quot;Dimension2&quot;))
                        cols.Remove(cols.FindByColumnName(&quot;Dimension2&quot;));
                    if (cols.Contains(&quot;Dimension3&quot;))
                        cols.Remove(cols.FindByColumnName(&quot;Dimension3&quot;));
                    if (cols.Contains(&quot;UnitCost&quot;)) cols.Remove(cols.FindByColumnName(&quot;UnitCost&quot;));
                    if (cols.Contains(&quot;BaseUnitCost&quot;))
                        cols.Remove(cols.FindByColumnName(&quot;BaseUnitCost&quot;));
                }
                else
                {
                    if (cols.Contains(&quot;UnitPrice&quot;))
                        cols.Remove(cols.FindByColumnName(&quot;UnitPrice&quot;));
                    cols.Add(new HierarchicalGridColumn(&quot;ContractQuantity&quot;, 125, true, AMP3ApplicationSettings.Instance.FORMAT_QUANTITY,
                                                               true, &quot;Contract Quantity&quot;));
                }
            }

            if (CoreModuleComponents.IsNotNullAndHasItems() &amp;&amp; CoreModuleComponents.Contains(Constants.ModuleComponent.EnableResourceManagement))
            {
                cols.Add(new HierarchicalGridColumn(&quot;Resources&quot;, 200, false));
            }

            return cols;
        }

        public override HierarchicalGridColumns HGridItemSummaryDetails()
        {
            HierarchicalGridColumns baseItemSummaryDetails = base.HGridItemSummaryDetails();
            List&lt;string&gt; Corecomponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);
            if (IsLocked &amp;&amp; IsCRAttached)
            {
                if (IsCV)
                {
                    List&lt;string&gt; components = ModuleManagementBL.ModuleManager.Instance.GetModuleComponenets(Constants.MODID_PROJECT);
                    if (!components.Contains(&quot;TotalCostValue&quot;))//Hide the Total Cost in Project Works
                    {
                        if (baseItemSummaryDetails.Contains(&quot;Total Cost&quot;))
                            baseItemSummaryDetails.Remove(baseItemSummaryDetails.FindByColumnName(&quot;Total Cost&quot;));
                    }

                    if (baseItemSummaryDetails.Contains(&quot;Total Margin&quot;))
                        baseItemSummaryDetails.Remove(baseItemSummaryDetails.FindByColumnName(&quot;Total Margin&quot;));

                    if (Corecomponents.Contains(&quot;ONGItemTotalAmount&quot;))//Hide the Total Amount in ONG
                    {
                        HierarchicalGridColumn TotalAmount = baseItemSummaryDetails.FindByColumnName(&quot;Total Amount&quot;);
                        TotalAmount.Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                        TotalAmount.Caption = &quot;Total Amount in &quot; +
                                              LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL);
                    }
                }
                else
                {
                    if (baseItemSummaryDetails.Contains(&quot;Total Amount&quot;))
                        baseItemSummaryDetails.Remove(baseItemSummaryDetails.FindByColumnName(&quot;Total Amount&quot;));

                    if (baseItemSummaryDetails.Contains(&quot;Total Margin&quot;))
                        baseItemSummaryDetails.Remove(baseItemSummaryDetails.FindByColumnName(&quot;Total Margin&quot;));

                    List&lt;string&gt; components = ModuleManagementBL.ModuleManager.Instance.GetModuleComponenets(Constants.MODID_PROJECT);
                    if (!components.Contains(&quot;TotalCostValue&quot;))//Hide the Total Cost in Project Works
                    {
                        HierarchicalGridColumn TotalCost = baseItemSummaryDetails.FindByColumnName(&quot;Total Cost&quot;);
                        TotalCost.Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                        TotalCost.Caption = &quot;Total Cost in &quot; +
                                            LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL);
                    }
                }
            }
            if (!Corecomponents.Contains(&quot;ONGItemTotalAmount&quot;))//Hide the Total Amount in ONG
            {
                if (baseItemSummaryDetails.Contains(&quot;Total Amount&quot;))
                    baseItemSummaryDetails.Remove(baseItemSummaryDetails.FindByColumnName(&quot;Total Amount&quot;));
            }
            return baseItemSummaryDetails;
        }

        public override void HandleNew(int id)
        {
            Response.Redirect(string.Format(CultureInfo.CurrentCulture,
                                            &quot;BrixItemPage.aspx?Context={0}&amp;ParentID={1}&amp;PID={2}&amp;ContainerID={3}{4}&quot;,
                                            ModuleId, parentID, Request[&quot;PID&quot;], id, CVString));
        }

        public override void HandleEdit(ItemTypes type, int id)
        {
            bool isBeforeLock = (!DisplayUnlock &amp;&amp; !IsSubmit);//Checking whether Contract is not locked
            if (type == ItemTypes.Item)//Condition for the ITEM
            {
                var DTO = ItemManager.Instance.GetItemDetails(ModuleId, parentID, id);
                bool? isNCItem = DTO.IsNonContract;//Checking whether Item is NC Item or Not        

                List&lt;string&gt; components = ModuleManagementBL.ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CONTMGT);

                //If Item is NC and Cost Revision is not attached OR Before lock then we can Edit the Item or EditItemCompleteAfterLock is enabled
                if ((isNCItem.ToBoolean2() &amp;&amp; !IsCRAttached) || isBeforeLock || components.Contains(&quot;EditItemCompleteAfterLock&quot;))
                {
                    Response.Redirect(string.Format(CultureInfo.CurrentCulture,
                                                     &quot;BrixItemPage.aspx?Context={0}&amp;ItemID={1}&amp;Mode={2}&amp;ParentID={3}&amp;PID={4}{5}&quot;,
                                                     ModuleId, id, ModeTypes.Edit.ToInt32_2(), parentID, Request[&quot;PID&quot;],
                                                     CVString));
                }
                else
                {
                    throw new Exception(&quot;Contract &quot; + LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR) + &quot;(s) can not be edited after lock.&quot;);
                }
            }
            else//Condition for the Container
            {

                Response.Redirect(string.Format(CultureInfo.CurrentCulture,
                                                 &quot;BrixItemContainer.aspx?Context={0}&amp;ContainerID={1}&amp;Mode={2}&amp;ParentID={3}&amp;PID={4}{5}{6}&quot;,
                                                 ModuleId, id, ModeTypes.Edit.ToInt32_2(), parentID, Request[&quot;PID&quot;],
                                                 CVString, !isBeforeLock ? &quot;&amp;IsPE=1&quot; : string.Empty));
            }
        }

        public override void HandleView(ItemTypes type, int id)
        {
            if (type == ItemTypes.Item)
                Response.Redirect(string.Format(CultureInfo.CurrentCulture,
                                                 &quot;BrixItemPage.aspx?Context={0}&amp;ItemID={1}&amp;Mode={2}&amp;ParentID={3}&amp;PID={4}{5}&quot;,
                                                 ModuleId, id,
                                                 Convert.ToInt32(ModeTypes.View, CultureInfo.CurrentCulture), parentID,
                                                 Request[&quot;PID&quot;], CVString));
            else
                Response.Redirect(string.Format(CultureInfo.CurrentCulture,
                                                 &quot;BrixItemContainer.aspx?Context={0}&amp;ContainerID={1}&amp;Mode={2}&amp;ParentID={3}&amp;PID={4}{5}&quot;,
                                                 ModuleId, id,
                                                 Convert.ToInt32(ModeTypes.View, CultureInfo.CurrentCulture), parentID,
                                                 Request[&quot;PID&quot;], CVString));
        }

        public override void FetchActivities(HierarchicalGrid sender, int itemID)
        {
            if (!IsCRAttached || !IsCV)
                sender.ActivityTable =
                    ItemManager.Instance.GetItemActivities(ModuleId, ParentID, itemID, &quot;N&quot;, !IsCRAttached).Tables[0];
            else
                sender.ActivityTable = new DataTable();
        }

        public override void FetchSubItems(HierarchicalGrid sender, int itemID)
        {
            if (!IsCRAttached || !IsCV)
                sender.SubItemTable =
                    ItemManager.Instance.GetSubItemData(ModuleId, ParentID, itemID, !IsCRAttached).Tables[0];
            else
                sender.SubItemTable = new DataTable();
        }

        public override string GetRedirectUrlForSubItemControl(int itemId, string referenceItemType)
        {
            string redirectUrl =
                &quot;~/Common/BrixItemPage.aspx?Context={0}&amp;ItemID={1}&amp;ParentID={2}&amp;PID={3}&amp;DisplayType=SI&amp;Mode={4}{5}&quot;.
                    Format2(ModuleId, itemId, ParentID, Request[&quot;PID&quot;], (int)ModeTypes.Edit, CVString);
            if (!string.IsNullOrEmpty(Request[&quot;ContractID&quot;]))
                redirectUrl = &quot;{0}&amp;ContractID={1}&amp;ParentID={1}&quot;.Format2(redirectUrl, Request[&quot;ContractID&quot;]);
            return redirectUrl;
        }

        public override string GetRedirectUrlForRateAnalysisControl(int itemId, string referenceItemType)
        {
            string redirectUrl =
                &quot;~/Common/BrixItemPage.aspx?Context={0}&amp;ItemID={1}&amp;ParentID={2}&amp;PID={3}&amp;DisplayType=RA&amp;Mode={4}{5}&quot;.
                    Format2(ModuleId, itemId, ParentID, Request[&quot;PID&quot;], (int)ModeTypes.Edit, CVString);
            if (!string.IsNullOrEmpty(Request[&quot;ContractID&quot;]))
                redirectUrl = &quot;{0}&amp;ContractID={1}&amp;ParentID={1}&quot;.Format2(redirectUrl, Request[&quot;ContractID&quot;]);
            return redirectUrl;
        }

        public override void HandleAddMultiple(int id)
        {
            Response.Redirect(
                 string.Format(CultureInfo.CurrentCulture,
                               &quot;~/Common/AddStandardItems.aspx?Context={0}&amp;PID={1}&amp;ParentID={2}&amp;ContainerID={3}{4}&quot;,
                               Request[&quot;context&quot;], Request[&quot;PID&quot;], Request[&quot;ParentID&quot;], id, CVString), false);
        }

        public override void HandleNewContainer(int id)
        {
            Response.Redirect(string.Format(CultureInfo.CurrentCulture,
                                             &quot;BrixItemContainer.aspx?Context={0}&amp;Mode={1}&amp;ParentID={2}&amp;PID={3}&amp;ContainerID={4}{5}&quot;,
                                             ModuleId, ModeTypes.New.ToInt32_2(), parentID, Request[&quot;PID&quot;],
                                             (id == 0 ? -1 : id), CVString), false);
        }

        public override object GetExportList(string ExportContext)
        {
            if (ExportContext.Equals(&quot;Excel&quot;) &amp;&amp; IsLocked &amp;&amp; IsCRAttached)
            {
                string exportContex = IsCV ? &quot;ContractViewExcel&quot; : ExportContext;
                StoredProcedure sp = StoredProcedure.usp_CORITEMGetDetailsForExport;
                DataSet ds = ComponentHelper.Instance.ExecuteDataSet(sp, null,
                                                                     ModuleId, ParentID, null, exportContex, null);
                if (String.IsNullOrEmpty(ExportContext) || ExportContext.Equals(&quot;Excel&quot;))
                {
                    List&lt;string&gt; coreComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);
                    ds.Tables[0].TableName = &quot;Container&quot;;
                    ds.Tables[1].TableName = LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR);
                    ds.Tables[1].Columns[&quot;ScheduledGroup&quot;].ColumnName = LocalizationManager.GetString(KeyConstants.Group);
                    ds.Tables[1].Columns[&quot;Standard Item No&quot;].ColumnName =
                        LocalizationManager.GetString(KeyConstants.LOC_STDPAYITEM);

                    int tableNo = 2;
                    if (coreComponents.Contains(&quot;SubItems&quot;)) ds.Tables[tableNo++].TableName = &quot;SubItems&quot;;
                    if (coreComponents.Contains(&quot;Activities&quot;)) ds.Tables[tableNo++].TableName = &quot;Activities&quot;;
                    if (coreComponents.Contains(&quot;Components&quot;)) ds.Tables[tableNo++].TableName = &quot;Components&quot;;
                    if (!IsCV)
                    {
                        if (coreComponents.Contains(&quot;RateAnalysis&quot;))
                        {
                            ds.Tables[tableNo++].TableName = LocalizationManager.GetString(KeyConstants.LOC_ICA_EQUIPMENT);
                            ds.Tables[tableNo++].TableName = LocalizationManager.GetString(KeyConstants.LOC_ICA_MANPOWER);
                            ds.Tables[tableNo++].TableName = LocalizationManager.GetString(KeyConstants.LOC_ICA_MATERIALS);
                            ds.Tables[tableNo++].TableName = LocalizationManager.GetString(KeyConstants.LOC_ICA_MISC);
                            ds.Tables[tableNo++].TableName = &quot;SubContract&quot;;
                        }
                    }
                    else
                    {
                        if (coreComponents.Contains(&quot;SubItems&quot;)) ds.Tables.Remove(&quot;SubItems&quot;);
                        if (coreComponents.Contains(&quot;Activities&quot;)) ds.Tables.Remove(&quot;Activities&quot;);
                    }

                    GetExportListData(ds);
                }

                return ds;
            }
            return base.GetExportList(ExportContext);
        }

        public override string WorkflowModuleID
        {
            get
            {
                return &quot;XCNTBGT&quot;;
            }
        }

        public override void CustomizeContextMenu(List&lt;BrixContextMenu&gt; cMenu)
        {
            base.CustomizeContextMenu(cMenu);
            List&lt;string&gt; ModuleComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_FNDMGMT);
            if (ModuleComponents != null &amp;&amp; ModuleComponents.Contains(&quot;FUND&quot; + Request[&quot;Context&quot;]) &amp;&amp; CanAssociateFund)
            {
                DataSet ds = ItemManager.Instance.GetFundRule(Request[&quot;PID&quot;].ToInt32_2());
                foreach (DataRow dr in ds.Tables[0].Rows)
                    cMenu.Add(new BrixContextMenu(&quot;Associate Fund Rule&quot;, &quot;Associate Fund - &quot; + dr[&quot;RuleName&quot;].ToString2(), string.Empty, ContextMenuActionType.Code, &quot;return true;&quot;, tag: &quot;RuleID-&quot; + dr[&quot;ID&quot;].ToString2()));
            }
        }

        public override void HandleMenuItems(string eventString, Infragistics.WebUI.UltraWebGrid.ExcelExport.UltraWebGridExcelExporter expGrid, string ids)
        {
            if (eventString.Contains(&quot;-RuleID-&quot;) &amp;&amp; CanAssociateFund)
            {
                if (!string.IsNullOrEmpty(hGrid.CheckedItems) || !string.IsNullOrEmpty(hGrid.CheckedContainers) || ((hGrid.SelectedRowType == &quot;ITR&quot; || hGrid.SelectedRowType == &quot;CTR&quot;) &amp;&amp; !string.IsNullOrEmpty(hGrid.SelectedRowID)))
                {
                    string fundRuleName = eventString.Replace(&quot;Associate Fund - &quot;, &quot;&quot;).Replace(&quot;-RuleID&quot;, &quot;&quot;);
                    string[] rules = fundRuleName.Split(&#39;-&#39;);
                    string RuleId = rules[rules.Length - 1];
                    //Apply Fund Rule
                    string itemids = string.Empty;
                    if (hGrid.SelectedRowType == &quot;ITR&quot; &amp;&amp; !string.IsNullOrEmpty(hGrid.SelectedRowID))
                        itemids = hGrid.SelectedRowID;
                    if (!string.IsNullOrEmpty(hGrid.CheckedItems))
                        itemids = string.IsNullOrEmpty(itemids) ? hGrid.CheckedItems.Trim(&#39;,&#39;) : itemids + &quot;,&quot; + hGrid.CheckedItems.Trim(&#39;,&#39;);

                    string containerids = string.Empty;
                    if (hGrid.SelectedRowType == &quot;CTR&quot; &amp;&amp; !string.IsNullOrEmpty(hGrid.SelectedRowID))
                        containerids = hGrid.SelectedRowID;
                    if (!string.IsNullOrEmpty(hGrid.CheckedContainers))
                    {
                        if (string.IsNullOrEmpty(containerids))
                            containerids = hGrid.CheckedContainers.Trim(&#39;,&#39;);
                        else
                        {
                            containerids += &quot;,&quot; + BL.Instance.GetSubContainers(hGrid.CheckedContainers.Trim(&#39;,&#39;));
                        }
                                    
                    }


                    if (!string.IsNullOrEmpty(itemids))
                    {
                        string selectedIDs = itemids.Trim(&#39;,&#39;);
                        selectedIDs = &quot;&lt;items&gt;&lt;item&gt;&quot; + selectedIDs.Replace(&quot;,&quot;, &quot;&lt;/item&gt;&lt;item&gt;&quot;) + &quot;&lt;/item&gt;&lt;/items&gt;&quot;;
                        ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(StoredProcedure.usp_UpdateCORITEMItemDetailsItem, null, &quot;CONTMGT&quot;, RuleId, ParentID, selectedIDs);
                    }
                    if (!string.IsNullOrEmpty(containerids))
                    {
                        string selectedIDs = containerids.Trim(&#39;,&#39;);
                        selectedIDs = &quot;&lt;items&gt;&lt;item&gt;&quot; + selectedIDs.Replace(&quot;,&quot;, &quot;&lt;/item&gt;&lt;item&gt;&quot;) + &quot;&lt;/item&gt;&lt;/items&gt;&quot;;
                        ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(StoredProcedure.usp_UpdateCORITEMItemDetailsContainer, null, &quot;CONTMGT&quot;, RuleId, ParentID, selectedIDs);
                    }

                }
                else
                {
                    isMenuClickHandled = false;
                    throw new Exception(&quot;Select atleast one item or container&quot;);
                }

                HttpContext.Current.Server.Transfer(&quot;BrixItemListPage.aspx?Context={0}&amp;ParentID={1}&amp;PID={2}&quot;.Format2(ModuleId, Request[&quot;ParentID&quot;], Request[&quot;PID&quot;]));
            }
            else
            {
                base.HandleMenuItems(eventString, expGrid, ids);
            }
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[47,9,47,59,0],[49,9,49,39,0],[50,9,50,10,0],[51,13,51,41,0],[52,9,52,10,0],[56,13,56,14,1],[57,17,57,51,1],[58,21,58,111,1],[60,17,60,46,1],[61,13,61,14,1],[65,9,65,10,1],[66,13,66,90,1],[67,9,67,10,1],[72,13,72,14,1],[73,17,73,41,1],[74,21,74,84,1],[75,17,75,40,1],[76,13,76,14,1],[82,13,82,14,1],[83,17,83,34,1],[84,13,84,14,1],[90,13,90,14,1],[91,17,91,53,1],[92,17,92,18,1],[93,21,93,51,1],[94,21,94,76,1],[95,21,95,22,1],[96,25,96,94,1],[97,25,97,71,1],[98,25,98,26,0],[99,29,99,150,0],[100,29,100,157,0],[101,25,101,26,0],[102,21,102,22,1],[103,17,103,18,1],[104,17,104,52,1],[105,13,105,14,1],[111,13,111,14,1],[113,17,113,43,1],[114,21,114,86,1],[115,17,115,42,1],[116,13,116,14,1],[125,13,125,14,1],[126,17,126,121,1],[127,21,127,33,1],[129,21,129,34,0],[130,13,130,14,1],[138,17,138,18,1],[138,19,138,58,1],[138,59,138,60,1],[144,13,144,14,1],[145,17,145,45,1],[146,17,146,18,1],[147,21,147,83,1],[148,21,148,67,1],[149,17,149,18,1],[150,17,150,44,1],[151,13,151,14,1],[154,9,154,49,0],[158,13,158,14,0],[159,17,159,50,0],[160,21,160,86,0],[161,17,161,49,0],[162,13,162,14,0],[168,13,168,14,0],[169,17,169,43,0],[170,17,170,18,0],[171,21,171,80,0],[172,21,172,82,0],[173,17,173,18,0],[174,17,174,42,0],[175,13,175,14,0],[181,13,181,14,1],[182,17,182,48,1],[183,21,183,40,1],[184,22,184,91,0],[185,21,185,65,0],[187,21,187,66,0],[188,13,188,14,1],[193,17,193,18,1],[193,19,193,50,1],[193,51,193,52,1],[198,17,198,18,1],[198,19,198,39,1],[198,40,198,41,1],[203,17,203,18,0],[203,19,203,39,0],[203,40,203,41,0],[209,13,209,14,0],[210,17,210,52,0],[212,17,212,48,0],[213,17,213,46,0],[214,17,214,46,0],[215,17,215,77,0],[216,17,216,55,0],[217,17,217,34,0],[219,17,219,44,0],[220,17,220,46,0],[221,17,221,52,0],[222,17,222,55,0],[223,17,223,34,0],[225,17,225,44,0],[226,17,226,50,0],[227,17,227,53,0],[228,17,228,55,0],[229,17,229,34,0],[231,17,231,44,0],[232,17,232,49,0],[233,17,233,55,0],[234,17,234,56,0],[235,17,235,34,0],[238,17,238,44,0],[239,17,239,43,0],[240,17,240,46,0],[241,17,241,58,0],[242,17,242,48,0],[243,17,243,34,0],[245,17,245,39,0],[247,13,247,14,0],[253,13,253,14,1],[254,17,254,62,1],[256,17,256,67,1],[256,67,256,139,0],[256,139,256,141,1],[256,17,256,141,1],[257,17,257,45,1],[258,17,258,18,0],[259,21,259,115,0],[260,21,260,53,0],[261,17,261,18,0],[263,17,263,18,1],[264,21,264,35,1],[265,25,265,124,1],[266,17,266,18,1],[267,17,267,33,1],[268,17,268,18,1],[269,21,269,39,1],[269,40,269,122,1],[270,21,270,37,1],[270,38,270,114,1],[271,17,271,18,1],[273,17,273,109,1],[274,17,274,87,1],[276,17,276,80,1],[277,17,277,18,1],[278,21,278,96,1],[279,21,279,74,1],[279,75,279,167,1],[280,17,280,18,1],[281,17,282,57,1],[283,17,283,18,0],[284,21,284,83,0],[284,83,284,107,0],[284,107,284,109,0],[284,21,284,109,0],[285,21,285,38,0],[286,25,286,123,0],[288,25,288,131,0],[289,17,289,18,0],[291,17,291,63,1],[291,63,291,83,0],[291,83,291,85,1],[291,17,291,85,1],[292,17,292,41,1],[293,17,293,18,1],[294,21,294,100,1],[296,21,296,122,1],[297,21,297,128,1],[298,21,298,22,1],[299,25,299,72,1],[300,25,300,99,1],[301,25,301,32,1],[301,34,301,44,1],[301,45,301,47,1],[301,48,301,65,1],[302,29,302,198,1],[304,25,304,48,1],[305,25,305,26,0],[306,29,306,134,0],[307,29,307,71,0],[308,29,308,53,0],[308,53,308,54,0],[308,54,308,55,0],[308,55,308,82,0],[308,82,308,83,0],[308,83,308,84,0],[308,84,308,86,0],[308,29,308,86,0],[309,29,309,61,0],[310,25,310,26,0],[312,29,313,29,1],[313,29,313,30,0],[313,30,314,33,1],[314,33,314,75,0],[314,75,315,33,1],[315,33,315,58,0],[315,58,316,29,1],[316,29,316,30,0],[316,30,316,32,1],[312,29,316,32,1],[317,21,317,22,1],[321,21,321,62,1],[322,21,322,22,0],[323,25,323,114,0],[324,25,324,124,0],[325,21,325,22,0],[327,17,327,18,1],[328,17,328,81,1],[328,81,328,104,0],[328,104,328,106,1],[328,17,328,106,1],[329,17,329,40,1],[330,17,330,18,1],[331,21,331,99,1],[332,21,332,133,1],[333,21,333,53,1],[334,17,334,18,1],[335,17,335,35,1],[336,13,336,14,1],[340,9,340,10,1],[341,13,341,32,1],[344,9,344,10,1],[347,9,347,10,1],[348,13,348,101,1],[349,13,349,53,1],[350,13,353,60,1],[355,13,355,39,1],[356,17,359,91,0],[361,13,361,45,1],[362,13,362,14,1],[363,17,363,87,1],[364,17,364,46,1],[365,17,365,18,0],[366,21,366,102,0],[367,17,367,18,0],[368,13,368,14,1],[369,13,369,94,1],[371,13,371,59,1],[374,13,374,54,1],[379,13,379,47,1],[380,13,380,46,1],[381,13,381,27,1],[382,17,382,38,1],[384,17,384,39,1],[387,9,387,10,1],[390,9,390,10,1],[391,13,393,44,1],[395,13,395,129,1],[396,13,396,30,1],[397,13,397,14,0],[398,17,398,60,0],[399,17,399,18,0],[400,21,401,128,0],[402,17,402,18,0],[404,17,404,18,0],[405,21,406,107,0],[407,17,407,18,0],[408,13,408,14,0],[410,13,410,14,1],[411,17,412,163,1],[413,13,413,14,1],[415,13,415,107,1],[416,17,416,58,0],[418,13,418,50,1],[419,13,419,14,0],[420,17,420,91,0],[421,13,421,14,0],[422,9,422,10,1],[425,9,425,10,1],[426,13,426,57,1],[427,13,427,83,1],[427,84,427,116,0],[429,13,429,42,1],[430,13,430,14,0],[431,17,431,101,0],[432,17,432,18,0],[433,21,436,78,0],[437,17,437,18,0],[438,22,438,64,0],[439,17,439,18,0],[440,21,440,72,0],[441,21,441,30,0],[442,25,443,121,0],[444,17,444,18,0],[445,22,445,65,0],[446,17,446,18,0],[447,21,447,72,0],[448,21,448,31,0],[448,32,448,93,0],[449,17,449,18,0],[450,13,450,14,0],[452,13,452,108,1],[454,13,454,91,1],[455,17,455,43,0],[456,9,456,10,1],[459,9,459,10,1],[460,13,460,45,1],[461,13,461,43,1],[462,13,462,48,1],[463,13,463,87,1],[464,13,464,58,1],[466,13,466,43,1],[467,13,467,64,1],[468,13,468,58,1],[470,13,470,43,1],[471,13,471,44,1],[472,13,472,43,1],[473,13,473,59,1],[474,13,474,66,1],[475,13,475,47,1],[476,13,476,46,1],[478,13,478,43,1],[479,13,479,47,1],[480,13,480,90,1],[481,13,481,59,1],[482,13,482,66,1],[483,13,483,52,1],[484,13,484,56,1],[486,13,486,28,1],[487,9,487,10,1],[490,9,490,10,1],[491,13,491,86,1],[493,13,493,20,1],[493,22,493,52,1],[493,53,493,55,1],[493,56,493,62,1],[494,13,494,14,1],[495,17,495,75,1],[496,17,496,39,1],[497,21,497,93,1],[498,13,498,14,1],[500,13,500,134,1],[501,13,501,44,1],[502,13,502,56,1],[503,13,503,74,1],[504,13,504,45,1],[505,17,505,68,0],[506,13,506,142,1],[508,13,508,84,1],[509,17,509,81,1],[511,13,511,97,1],[513,13,513,44,1],[514,17,514,69,1],[516,13,516,22,1],[517,13,517,14,1],[518,17,518,70,1],[519,17,519,71,1],[520,21,520,127,0],[522,17,522,138,1],[523,13,523,14,1],[524,13,524,28,1],[527,13,527,20,1],[527,22,527,52,1],[527,53,527,55,1],[527,56,527,62,1],[528,13,528,14,1],[529,17,529,75,1],[530,17,530,39,1],[531,21,531,92,1],[532,13,532,14,1],[534,13,534,31,1],[535,9,535,10,1],[538,9,538,10,1],[539,13,539,139,1],[541,13,541,70,1],[542,13,542,14,0],[544,17,544,67,0],[545,17,545,18,0],[546,21,546,197,0],[548,13,548,14,0],[550,13,550,86,1],[552,13,552,20,1],[552,22,552,52,1],[552,53,552,55,1],[552,56,552,62,1],[553,13,553,14,1],[554,17,554,75,1],[555,17,555,39,1],[556,21,556,91,1],[557,13,557,14,1],[559,13,559,132,1],[560,13,560,67,1],[561,13,561,14,0],[563,17,563,156,0],[564,21,564,108,0],[565,17,565,143,0],[566,17,566,76,0],[567,21,567,116,0],[568,13,568,14,0],[570,13,570,132,1],[571,13,571,44,1],[572,13,572,26,1],[573,13,573,14,1],[574,17,574,104,1],[575,17,575,146,1],[576,17,576,34,1],[577,21,577,83,0],[579,17,579,34,1],[580,21,580,53,0],[581,13,581,14,1],[583,13,583,84,1],[584,17,584,81,1],[585,13,585,28,1],[587,13,587,53,1],[590,13,590,20,1],[590,22,590,52,1],[590,53,590,55,1],[590,56,590,62,1],[591,13,591,14,1],[592,17,592,75,1],[593,17,593,39,1],[594,21,594,90,1],[595,13,595,14,1],[598,13,598,31,1],[599,9,599,10,1],[602,9,602,10,1],[603,13,603,56,1],[604,13,604,129,1],[605,13,605,30,1],[606,13,606,14,0],[607,17,607,70,0],[608,17,608,18,0],[609,21,609,64,0],[610,21,610,22,0],[611,25,611,75,0],[612,25,612,26,0],[613,29,613,89,0],[614,29,614,46,0],[615,29,615,30,0],[616,33,616,69,0],[617,33,617,106,0],[618,33,618,66,0],[619,33,619,103,0],[621,29,621,30,0],[622,25,622,26,0],[623,25,623,80,0],[624,25,624,26,0],[625,29,625,94,0],[626,29,626,46,0],[627,29,627,30,0],[628,33,628,71,0],[629,33,629,108,0],[630,29,630,30,0],[631,25,631,26,0],[632,25,632,84,0],[633,25,633,26,0],[634,29,634,98,0],[635,29,635,46,0],[636,29,636,30,0],[637,33,637,75,0],[638,33,638,112,0],[639,29,639,30,0],[640,25,640,26,0],[641,21,641,22,0],[643,21,643,22,0],[644,25,644,90,0],[645,25,645,26,0],[646,29,646,86,0],[647,29,647,65,0],[648,29,648,102,0],[649,25,649,26,0],[650,25,650,87,0],[651,25,651,26,0],[652,29,652,83,0],[653,29,653,62,0],[654,29,654,99,0],[655,25,655,26,0],[656,25,656,92,0],[657,25,657,26,0],[658,29,658,88,0],[659,29,659,67,0],[660,29,660,104,0],[661,25,661,26,0],[662,25,662,96,0],[663,25,663,26,0],[664,29,664,95,0],[665,29,665,71,0],[666,29,666,108,0],[667,25,667,26,0],[668,21,668,22,0],[669,17,669,18,0],[671,17,671,70,0],[672,17,672,18,0],[673,21,673,84,0],[674,21,674,38,0],[675,21,675,22,0],[676,25,676,61,0],[677,25,677,98,0],[678,21,678,22,0],[680,21,680,77,0],[681,21,681,22,0],[682,25,682,61,0],[683,25,683,82,0],[684,25,684,98,0],[685,21,685,22,0],[686,17,686,18,0],[688,17,688,75,0],[689,21,689,89,0],[690,17,690,77,0],[691,21,691,91,0],[692,17,692,80,0],[693,21,693,94,0],[694,13,694,14,0],[696,13,696,14,1],[697,17,697,73,1],[698,17,698,18,0],[699,21,699,86,0],[700,21,700,22,0],[701,25,701,82,0],[702,25,702,61,0],[703,25,703,98,0],[704,21,704,22,0],[705,21,705,83,0],[706,21,706,22,0],[707,25,707,79,0],[708,25,708,58,0],[709,25,709,95,0],[710,21,710,22,0],[711,21,711,88,0],[712,21,712,22,0],[713,25,713,84,0],[714,25,714,63,0],[715,25,715,100,0],[716,21,716,22,0],[717,21,717,92,0],[718,21,718,22,0],[719,25,719,88,0],[720,25,720,67,0],[721,25,721,104,0],[722,21,722,22,0],[723,21,723,74,0],[724,21,724,22,0],[725,25,725,61,0],[726,25,726,82,0],[727,25,727,98,0],[728,21,728,22,0],[729,21,729,72,0],[730,21,730,22,0],[731,25,731,59,0],[732,25,732,80,0],[733,25,733,96,0],[734,21,734,22,0],[735,17,735,18,0],[736,13,736,14,1],[737,13,737,64,1],[738,13,738,14,1],[739,17,739,102,1],[740,13,740,14,1],[742,13,742,36,1],[743,17,743,55,1],[744,9,744,10,1],[747,9,747,10,0],[748,13,748,53,0],[750,13,750,24,0],[751,9,751,10,0],[754,9,754,10,1],[755,13,755,40,1],[756,13,756,14,1],[757,17,757,67,1],[758,13,758,14,1],[760,13,760,14,1],[761,17,761,33,1],[762,21,763,80,1],[765,21,765,112,0],[766,13,766,14,1],[767,9,767,10,1],[770,9,770,10,0],[771,13,771,22,0],[772,9,772,10,0],[775,9,775,10,1],[776,13,776,33,1],[779,21,782,65,0],[783,21,783,27,0],[785,21,791,89,0],[792,21,792,27,0],[794,21,796,102,0],[797,21,797,27,0],[799,21,800,117,0],[801,21,802,68,0],[803,21,803,27,0],[805,21,807,65,0],[808,21,808,27,0],[810,21,812,95,0],[813,21,813,27,0],[815,21,815,47,1],[817,21,817,96,1],[818,21,818,39,1],[819,21,819,22,1],[820,25,820,145,1],[821,25,821,26,1],[822,29,822,48,1],[822,49,822,112,1],[825,25,825,26,0],[826,29,826,48,0],[826,49,826,131,0],[829,21,829,40,0],[830,21,830,32,0],[832,21,832,86,1],[833,21,833,121,1],[834,21,834,44,1],[835,21,835,27,0],[837,21,839,83,0],[840,21,840,27,0],[842,21,842,82,0],[843,21,843,40,0],[844,21,844,27,0],[852,21,852,67,0],[854,21,854,126,0],[855,21,857,111,0],[859,21,859,57,0],[860,21,860,52,0],[862,21,862,57,0],[863,21,863,59,0],[864,21,864,42,0],[865,21,865,44,0],[867,21,867,67,0],[869,21,869,40,0],[870,25,870,92,0],[872,25,872,76,0],[875,21,875,68,0],[876,21,876,127,0],[878,21,878,48,0],[879,21,879,59,0],[881,21,881,84,0],[883,21,883,48,0],[884,25,884,97,0],[886,25,886,76,0],[888,21,888,64,1],[891,13,891,33,0],[892,9,892,10,1],[895,9,895,10,1],[896,13,896,95,1],[897,13,897,14,0],[898,17,898,44,0],[899,17,901,106,0],[902,17,902,37,0],[904,18,904,68,1],[905,13,905,14,0],[906,17,906,44,0],[907,17,907,59,0],[908,17,911,101,0],[912,17,912,37,0],[914,18,914,113,1],[915,13,915,14,0],[916,17,918,68,0],[919,17,919,43,0],[920,17,920,37,0],[923,17,923,57,1],[924,9,924,10,1],[927,9,927,10,0],[928,13,928,49,0],[929,13,929,47,0],[930,9,930,10,0],[933,9,933,10,0],[934,13,934,95,0],[935,13,935,14,0],[936,17,936,118,0],[937,21,937,116,0],[938,17,938,120,0],[939,21,939,118,0],[940,13,940,14,0],[941,9,941,10,0],[945,9,945,10,1],[946,13,946,23,1],[947,13,947,70,1],[948,13,948,69,1],[949,13,949,23,1],[950,9,950,10,1],[953,9,953,10,1],[954,13,954,33,1],[955,13,955,14,0],[956,17,956,51,0],[957,21,959,67,0],[961,21,962,62,0],[963,13,963,14,0],[964,13,964,27,1],[965,9,965,10,1],[968,9,968,10,1],[969,13,971,111,1],[972,13,972,37,1],[975,21,975,27,0],[977,21,977,58,1],[978,21,978,54,1],[979,21,979,60,1],[980,21,980,62,1],[981,21,981,45,1],[982,25,982,67,0],[983,21,983,111,1],[984,21,984,22,0],[985,25,985,32,0],[985,34,985,44,0],[985,45,985,47,0],[985,48,985,71,0],[986,25,986,26,0],[987,29,990,57,0],[991,29,991,60,0],[992,33,992,86,0],[993,25,993,26,0],[994,21,994,22,0],[995,21,995,27,1],[997,13,997,23,1],[998,9,998,10,1],[1001,9,1001,10,1],[1002,13,1002,64,1],[1004,13,1004,42,1],[1005,13,1005,14,0],[1006,17,1006,49,0],[1007,17,1007,47,0],[1008,17,1008,18,0],[1009,21,1009,95,0],[1010,21,1010,96,0],[1011,17,1011,18,0],[1012,17,1012,26,0],[1013,17,1013,18,0],[1014,21,1014,49,0],[1014,50,1014,95,0],[1015,21,1015,53,0],[1016,25,1016,74,0],[1017,21,1017,53,0],[1018,25,1018,74,0],[1019,21,1019,53,0],[1020,25,1020,74,0],[1021,21,1021,51,0],[1021,52,1021,99,0],[1022,21,1022,55,0],[1023,25,1023,76,0],[1024,17,1024,18,0],[1026,17,1026,18,0],[1027,21,1027,52,0],[1028,25,1028,73,0],[1029,21,1030,92,0],[1031,17,1031,18,0],[1032,13,1032,14,0],[1034,13,1034,146,1],[1035,13,1035,14,1],[1036,17,1036,79,1],[1037,13,1037,14,1],[1039,13,1039,25,1],[1040,9,1040,10,1],[1043,9,1043,10,1],[1044,13,1044,93,1],[1045,13,1045,109,1],[1046,13,1046,42,1],[1047,13,1047,14,0],[1048,17,1048,26,0],[1049,17,1049,18,0],[1050,21,1050,135,0],[1051,21,1051,64,0],[1052,21,1052,22,0],[1053,25,1053,75,0],[1054,29,1054,114,0],[1055,21,1055,22,0],[1057,21,1057,73,0],[1058,25,1058,112,0],[1060,21,1060,71,0],[1061,21,1061,22,0],[1062,25,1062,118,0],[1063,25,1063,93,0],[1064,25,1065,111,0],[1066,21,1066,22,0],[1067,17,1067,18,0],[1069,17,1069,18,0],[1070,21,1070,73,0],[1071,25,1071,112,0],[1073,21,1073,73,0],[1074,25,1074,112,0],[1076,21,1076,135,0],[1077,21,1077,64,0],[1078,21,1078,22,0],[1079,25,1079,114,0],[1080,25,1080,91,0],[1081,25,1082,109,0],[1083,21,1083,22,0],[1084,17,1084,18,0],[1085,13,1085,14,0],[1086,13,1086,64,1],[1087,13,1087,14,0],[1088,17,1088,69,0],[1089,21,1089,108,0],[1090,13,1090,14,0],[1091,13,1091,43,1],[1092,9,1092,10,1],[1095,9,1095,10,1],[1096,13,1098,96,1],[1099,9,1099,10,0],[1102,9,1102,10,1],[1103,13,1103,63,1],[1104,13,1104,40,1],[1105,13,1105,14,1],[1106,17,1106,87,1],[1107,17,1107,52,1],[1109,17,1109,131,1],[1112,17,1112,130,1],[1113,17,1113,18,1],[1114,21,1117,65,1],[1118,17,1118,18,0],[1120,17,1120,18,0],[1121,21,1121,152,0],[1123,13,1123,14,0],[1125,13,1125,14,0],[1127,17,1130,103,0],[1131,13,1131,14,0],[1132,9,1132,10,0],[1135,9,1135,10,1],[1136,13,1136,40,1],[1137,17,1141,77,1],[1143,17,1147,77,0],[1148,9,1148,10,0],[1151,9,1151,10,0],[1152,13,1152,40,0],[1153,17,1154,118,0],[1156,17,1156,56,0],[1157,9,1157,10,0],[1160,9,1160,10,0],[1161,13,1161,40,0],[1162,17,1163,110,0],[1165,17,1165,55,0],[1166,9,1166,10,0],[1169,9,1169,10,0],[1170,13,1172,104,0],[1173,13,1173,62,0],[1174,17,1174,109,0],[1175,13,1175,32,0],[1176,9,1176,10,0],[1179,9,1179,10,0],[1180,13,1182,104,0],[1183,13,1183,62,0],[1184,17,1184,109,0],[1185,13,1185,32,0],[1186,9,1186,10,0],[1189,9,1189,10,1],[1190,13,1193,111,1],[1194,9,1194,10,1],[1197,9,1197,10,1],[1198,13,1201,85,1],[1202,9,1202,10,1],[1205,9,1205,10,0],[1206,13,1206,75,0],[1207,13,1207,14,0],[1208,17,1208,82,0],[1209,17,1209,85,0],[1210,17,1211,116,0],[1212,17,1212,90,0],[1213,17,1213,18,0],[1214,21,1214,117,0],[1215,21,1215,58,0],[1216,21,1216,104,0],[1217,21,1217,123,0],[1218,21,1219,84,0],[1221,21,1221,37,0],[1222,21,1222,61,0],[1222,62,1222,106,0],[1223,21,1223,63,0],[1223,64,1223,110,0],[1224,21,1224,63,0],[1224,64,1224,110,0],[1225,21,1225,31,0],[1226,21,1226,22,0],[1227,25,1227,69,0],[1228,25,1228,26,0],[1229,29,1229,124,0],[1230,29,1230,123,0],[1231,29,1231,124,0],[1232,29,1232,119,0],[1233,29,1233,76,0],[1234,25,1234,26,0],[1235,21,1235,22,0],[1237,21,1237,22,0],[1238,25,1238,65,0],[1238,66,1238,95,0],[1239,25,1239,67,0],[1239,68,1239,99,0],[1240,21,1240,22,0],[1242,21,1242,43,0],[1243,17,1243,18,0],[1245,17,1245,27,0],[1247,13,1247,54,0],[1248,9,1248,10,0],[1253,13,1253,14,1],[1254,17,1254,34,1],[1255,13,1255,14,1],[1259,9,1259,10,1],[1260,13,1260,46,1],[1261,13,1261,114,1],[1262,13,1262,120,1],[1263,13,1263,14,1],[1264,17,1264,91,1],[1265,17,1265,24,1],[1265,26,1265,36,1],[1265,37,1265,39,1],[1265,40,1265,57,1],[1266,21,1266,222,1],[1267,13,1267,14,1],[1268,9,1268,10,1],[1271,9,1271,10,0],[1272,13,1272,70,0],[1273,13,1273,14,0],[1274,17,1274,231,0],[1275,17,1275,18,0],[1276,21,1276,111,0],[1277,21,1277,62,0],[1278,21,1278,61,0],[1280,21,1280,51,0],[1281,21,1281,102,0],[1282,25,1282,55,0],[1283,21,1283,67,0],[1284,25,1284,143,0],[1286,21,1286,56,0],[1287,21,1287,102,0],[1288,25,1288,60,0],[1289,21,1289,72,0],[1290,21,1290,22,0],[1291,25,1291,64,0],[1292,29,1292,78,0],[1294,25,1294,26,0],[1295,29,1295,115,0],[1296,25,1296,26,0],[1298,21,1298,22,0],[1301,21,1301,56,0],[1302,21,1302,22,0],[1303,25,1303,64,0],[1304,25,1304,119,0],[1305,25,1305,186,0],[1306,21,1306,22,0],[1307,21,1307,61,0],[1308,21,1308,22,0],[1309,25,1309,69,0],[1310,25,1310,119,0],[1311,25,1311,191,0],[1312,21,1312,22,0],[1314,17,1314,18,0],[1316,17,1316,18,0],[1317,21,1317,48,0],[1318,21,1318,81,0],[1321,17,1321,166,0],[1322,13,1322,14,0],[1324,13,1324,14,0],[1325,17,1325,65,0],[1326,13,1326,14,0],[1327,9,1327,10,0]]);
    </script>
  </body>
</html>