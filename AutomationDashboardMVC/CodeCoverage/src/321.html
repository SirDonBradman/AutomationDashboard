<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Construction Vertical\Main Modules\Contract Manager\UI\CreateContract.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Globalization;
using System.IO;
using System.Reflection;
using System.Text;
using System.Text.RegularExpressions;
using System.Web;
using System.Web.Configuration;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Xml;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.ContmgtDTO;
using Aurigo.AMP3.ContractManager.BusinessLayer;
using Aurigo.AMP3.Core;
using Aurigo.AMP3.Core.BusinessLayer.BL;
using Aurigo.AMP3.Core.IntegrationConnector;
using Aurigo.AMP3.Core.IntegrationConnector.DTO;
using Aurigo.AMP3.Core.UserControls;
using Aurigo.AMP3.DocumentManagementBL;
using Aurigo.AMP3.LibraryBL;
using Aurigo.AMP3.LibraryDTO;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.AMP3.ProjectBL;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.AMP3.TabInjectionDAC;
using Aurigo.Brix.Core.WebUiHelper;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.Common;
using Infragistics.WebUI.UltraWebGrid;
using Attribute = Aurigo.AMP3.ContmgtDTO.Attribute;
using Group = Aurigo.AMP3.ContmgtDTO.Group;
using Module = Aurigo.AMP3.ContmgtDTO.Module;
using Operations = Aurigo.AMP3.ContmgtDTO.Operations;
using Platform = Aurigo.AMP3.ContmgtDTO.Platform;
using Project = Aurigo.AMP3.ProjectDTO.Project;
using Aurigo.AMP3.DocumentManagementDTO;
using Aurigo.Brix.Platform.BusinessLayer.BL;
using Aurigo.AMP3.DataAccess.Core;
using Infragistics.WebUI.WebSchedule;
using Aurigo.DataBinding;
using Infragistics.WebUI.WebDataInput;
using Aurigo.AMP3.Core.AbstractModels;
using Aurigo.Brix.Construction.ContractManager.BusinessLayer;
using System.Configuration;
using Aurigo.Brix.Platform.BusinessLayer.AbstractModels;
using Aurigo.Brix.Construction.ContractManager.BusinessLayer.ConcreateModels;
using Aurigo.Brix.Platform.BusinessLayer.DataAccessHelper;
using System.Web.Script.Serialization;
using Aurigo.Brix.Platform.BusinessLayer.UserControls;
using Aurigo.AMP3.Logging;
using Telerik.Web.UI;
using Aurigo.Brix.Construction.ContractManager.BusinessLayer.BL;

namespace Aurigo.AMP3.ContmgtUI
{
    public class GenericFunctions
    {
        public static void SetAJAXFocus(UpdatePanel panel, Control control)
        {
            ScriptManager.RegisterClientScriptBlock(panel, panel.GetType(), &quot;AJAX_ERR&quot;,
                                                    &quot;document.getElementById(&#39;&quot; + control.ClientID + &quot;&#39;).focus();&quot;, true);
        }

        public static void RegsiterAJAXScript(UpdatePanel panel, string script)
        {
            ScriptManager.RegisterClientScriptBlock(panel, panel.GetType(), &quot;AJAX_SCRIPT&quot;,
                                                    script, true);
        }
    }

    public partial class CreateContract : BrixPageBase, IWorkflowEnabled, IXMLControl
    {

        #region Private Fields
        private readonly List&lt;Platform&gt; modulePlatformList;
        private CalendarCalculationsModel _contractCalendarModel = CalendarCalculationsModel.GetInstance(&quot;CONTMGT&quot;);
        private int _contractCalendarID = 0;
        private CalendarDetails _calendar = null;
        #endregion

        protected ModalPopupExtender PopupExtender;
        protected ModalPopupExtender PopupExtender1;
        private DataTable dt;
        private string viewState;
        private string viewStateAttList;
        private string viewStatePlatform;
        private BrixFormModel model;
        private XMLFormManagerModel managerModel;
        private List&lt;ProjectDTO.Platform&gt; _selectedProjectModules;
        public const string CONST_Dropdown_MakeSelectText = &quot;Select One&quot;;
        private string LoadPicker { get; set; }

        protected string LocalizedContract = LocalizationManager.GetString(&quot;Contract&quot;);

        /// &lt;summary&gt;
        /// Gets the Project Mode : I-Integration, L-Live
        /// &lt;/summary&gt;
        private string ProjectMode
        {
            get { return (CacheManager.Instance.IsIntegrated(PID) ? &quot;I&quot; : &quot;L&quot;); }
        }

        /// &lt;summary&gt;
        /// Gets the Integration Cutoff Date
        /// &lt;/summary&gt;
        private DateTime IntegrationCutoffDate
        {
            get { return (DateTime)Session[Constants.APP_IntegrationCutoffDate]; }
        }

        /// &lt;summary&gt;
        /// Gets the Default Record Date
        /// &lt;/summary&gt;
        private DateTime DefaultRecordDate
        {
            get { return (DateTime)Session[Constants.APP_DefaultRecordDate]; }
        }

        #region IWorkflowEnabled Members

        public void CancelHandler(object sender, bool bAfterSave, out string sRedirectTo)
        {
            throw new NotImplementedException();
        }

        public string FormInstanceId
        {
            get
            {
                int id = String.IsNullOrEmpty(Request.QueryString[&quot;ContractID&quot;])
                             ? -1
                             : int.TryParse(Request.QueryString[&quot;ContractID&quot;], out id) ? id : -1;
                return id.ToString();
            }
        }

        public string FormKey { get { return FormInstanceId; } }

        public string ClientValidationFunction
        {
            get { return string.Empty; }
        }

        public string FormName
        {
            get { return &quot;XCNTMGT&quot;; }
        }

        public bool IsOldWorkflow
        {
            get { return true; }
        }

        public int PID
        {
            get { return Request.QueryString[&quot;PID&quot;].ToInt32_2(); }
        }

        public int ParentModuleId
        {
            get
            {
                int id = String.IsNullOrEmpty(Request.QueryString[&quot;PID&quot;])
                             ? -1
                             : int.TryParse(Request.QueryString[&quot;PID&quot;], out id) ? id : -1;
                return id;
            }
        }

        public string PostCancelRedirectUrl
        {
            get
            {
                if (!AMP3ApplicationSettings.Instance.IsSingleProjectMode)
                    return String.Format(CultureInfo.CurrentCulture, &quot;~/Common/BrixListPage.aspx?Context=CONTMGT&amp;PID={0}&amp;nt=1&quot;, PID);
                else
                {
                    //return Request.Url.ToString2();
                    //Redirect it in View Mode. 
                    return String.Format(CultureInfo.CurrentCulture, &quot;~/Modules/CONTMGT/CreateContract.aspx?Mode=View&amp;PID={0}&amp;ContractID={1}{2}&amp;nt=1&quot;,
                        Request[Constants.QRY_PROJECTID], Request[&quot;CONTRACTID&quot;], (Request[&quot;PARENTID&quot;] != null ? &quot;&amp;ParentID=&quot; + Request[&quot;PARENTID&quot;] : &quot;&quot;));
                }
            }
        }

        public string PostSaveRedirectUrl(string sSavedToken = &quot;&quot;)
        {
            return PostCancelRedirectUrl;
        }

        public bool SaveHandler(object sender, out string sSavedInstanceToken, out string sErrors, out string sRedirectTo)
        {
            sErrors = &quot;&quot;;
            sRedirectTo = &quot;&quot;;

            int contractID = 0;

            if (SaveContract(out contractID, false))
            {
                sSavedInstanceToken = contractID.ToString2();
                return true;
            }
            sSavedInstanceToken = &quot;-1&quot;;
            return false;
        }

        #endregion

        protected override void OnPreInit(EventArgs e)
        {
            var objMasterPage = (base.Master as BrixTabMasterPage);
            objMasterPage.Mode = string.IsNullOrEmpty(Request[&quot;Mode&quot;])
                                     ? PageMode.Edit
                                     : (Request[&quot;Mode&quot;].ToLower2().Equals(&quot;view&quot;)) ? PageMode.View : PageMode.Edit;
            objMasterPage.AMP3PageName = TabEnabledPages.CreateContract;
            objMasterPage.AMP3ParentObjectId = (Request[Constants.QRY_PROJECTID]);
            objMasterPage.AMP3ParentObjectType = AMP3Object.PROJECT;
            objMasterPage.ERPPageData = GetPageData();
            if (!string.IsNullOrEmpty(Request[&quot;ContractID&quot;]))
                objMasterPage.AMP3ObjectId = Request[&quot;ContractID&quot;].ToInt32_2();
            objMasterPage.AMP3ObjectType = AMP3Object.CONTMGT;
            base.OnPreInit(e);
            SetManagerModel();
            if (managerModel != null)
                managerModel.OnPreInit(model, new XmlFormArgs());

            _selectedProjectModules = ProjectManager.Instance.GetProjectModules(PID);
        }


        private void SetManagerModel()
        {
            model = BrixFormModel.GetInstance(&quot;XCNTMGT&quot;, &quot;XCNTMGT&quot;, Request, Response);

            if (!string.IsNullOrEmpty(model.form.ManagerDLL) &amp;&amp; !string.IsNullOrEmpty(model.form.FormManagerClass))
            {
                managerModel = AMP3InterfaceFactory.GetInstance&lt;XMLFormManagerModel&gt;(model.form.ManagerDLL,
                                                                                 model.form.FormManagerClass);
                // managerModel.PageViewState = ViewState;
            }
        }
        protected override void OnInit(EventArgs e)
        {
            // set the list of permissions to be checked.
            PermissionsToCheck.Add(Constants.MODFEAT_VISIBILITY);

            string mode = Request.QueryString[&quot;Mode&quot;];

            if (!string.IsNullOrEmpty(mode))
            {
                if (mode.Equals(&quot;EDIT&quot;, StringComparison.CurrentCultureIgnoreCase))
                    PermissionsToCheck.Add(Constants.MODFEAT_EDIT);
                else if (mode.Equals(&quot;View&quot;, StringComparison.CurrentCultureIgnoreCase))
                    PermissionsToCheck.Add(Constants.MODFEAT_VIEW);
                else
                    PermissionsToCheck.Add(Constants.MODFEAT_CREATE);
            }
            else
                PermissionsToCheck.Add(Constants.MODFEAT_CREATE);

            //ModalPopupExtender PopupExtender = (ModalPopupExtender)this.Master.Master.FindControl(&quot;filterExtender&quot;);
            PopupExtender.Visible = true;
            //PopupExtender.Title = &quot;BRIX 2009&quot;;
            PopupExtender.AddNewPopup(aspPnlEst.ClientID, btnImpAwdItemsGhost.ClientID, btnCncl.ClientID, 220, 300, &quot;Estimate&quot;);
            //ModalPopupExtender PopupExtender1 = (ModalPopupExtender)this.Master.Master.FindControl(&quot;filterExtender&quot;);
            PopupExtender1.Visible = true;
            //PopupExtender1.Title = &quot;BRIX 2009&quot;;
            UseApplyGridWidthStyle = false;
            XmlFormArgs args = new XmlFormArgs();
            if (managerModel != null)
                managerModel.OnInit(model, args);
            ShowRedirectConfirm = true;
            base.OnInit(e);

        }

        protected void Page_Load(object sender, EventArgs e)
        {
            wneContractDays.ReadOnly = true;

            viewState = &quot;CONTMGTDTO&quot;;
            viewStateAttList = &quot;ATTLIST&quot;;
            viewStatePlatform = &quot;PLATFORMLIST&quot;;

            SetPageTitle();

            //Disable Role Selection
            UIHelper.DisableRoleSelection(Page);

            // Hide Attributes Tab

            List&lt;string&gt; contCompts = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CONTMGT);
            if (!contCompts.Contains(&quot;ShowAttributes&quot;))
            {
                liAttributes.Style.Add(&quot;display&quot;, &quot;none&quot;);
            }

            List&lt;string&gt; contMain = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CONTMGT);
            if (!contMain.Contains(&quot;ShowMainTab&quot;))
            {
                liMain.Style.Add(&quot;display&quot;, &quot;none&quot;);
                tabMain.Style.Add(&quot;display&quot;, &quot;none&quot;);
                if (!contCompts.Contains(&quot;ShowAttributes&quot;))
                {
                    ScriptManager.RegisterStartupScript(Page, Page.GetType(), &quot;Removetab&quot;, &quot;$(document).ready(function() { showPane(document.getElementById(&#39;tab4&#39;));});&quot;, true);
                }
            }

            if (String.IsNullOrEmpty(Request[Constants.QRY_PROJECTID]))
                Response.Redirect(&quot;~/Common/BrixListPage.aspx?context=PROJECT&quot;, true);

            lblGroupTypeTitle.Style[&quot;display&quot;] =
                ddlGroupType.Style[&quot;display&quot;] =
                lblGroupType.Style[&quot;display&quot;] =
                ((AMP3ApplicationSettings.Instance.BOQGroupType.StartsWith(&quot;G&quot;, StringComparison.OrdinalIgnoreCase))
                     ? &quot;block&quot;
                     : &quot;none&quot;);

            btnBack.Visible = (WebConfigurationManager.AppSettings[&quot;EPSModeMultiple&quot;] == &quot;ON&quot;);

            if (!String.IsNullOrEmpty(Request[&quot;Mode&quot;]) &amp;&amp; (Request[&quot;Mode&quot;] == &quot;View&quot; || Request[&quot;Mode&quot;] == &quot;Edit&quot;) &amp;&amp;
                String.IsNullOrEmpty(Request[&quot;ContractID&quot;]))
                Response.Redirect(&quot;~/Common/BrixListPage.aspx?context=CONTMGT&amp;PID=&quot; + Request[Constants.QRY_PROJECTID],
                                  true);
            else if (String.IsNullOrEmpty(Request[&quot;Mode&quot;]))
                if (WebConfigurationManager.AppSettings[&quot;EPSModeMultiple&quot;] != &quot;ON&quot;)
                {
                    DataTable dt = BL.Instance.GetContracts(UserDetail.GetCurrentUserDetail().UID,
                                                            UserDetail.GetCurrentUserDetail().RID,
                                                            Constants.MODFEAT_VISIBILITY,
                                                            CMConstans.MODID_CONTRCT,
                                                            Request[Constants.QRY_PROJECTID].ToInt32_2(), 1, 1, null,
                                                            null);

                    if (dt.Rows.Count != 0)
                        Response.Redirect(string.Format(&quot;CreateContract.aspx?Mode=View&amp;PID={0}&amp;ContractID={1}&amp;Tab={2}&amp;ParentID={1}&amp;nt=1&quot;,
                            Request[Constants.QRY_PROJECTID], dt.Rows[0][&quot;ContractID&quot;], (!String.IsNullOrEmpty(hdnTab.Value) ? hdnTab.Value : &quot;tab1&quot;)), true);
                }

            txtDescription.Attributes.Add(&quot;maxLength&quot;, &quot;300&quot;);

            /* Check Module Permissions for User*/
            var featurelist = (List&lt;string&gt;)Context.Items[Constants.MODULE_PERMISSIONS];

            if (!String.IsNullOrEmpty(Request[&quot;ContractID&quot;]))
            {
                if (!featurelist.Contains(CMConstans.MODFEAT_VIEW))
                {
                    UIHelper.RedirectURL(
                        &quot;The current role does not have the required permissions to view this page.&quot;,
                        ResolveUrl(&quot;~/Common/BrixListPage.aspx?context=PROJECT&quot;), null, Context);
                }
            }
            else
            {
                if (!featurelist.Contains(CMConstans.MODFEAT_CREATE))
                {
                    UIHelper.RedirectURL(
                        &quot;The current role does not have the required permissions to create &quot; + LocalizedContract + &quot;.&quot;,
                        ResolveUrl(&quot;~/Common/BrixListPage.aspx?context=PROJECT&quot;), null, Context);
                }
            }
            btnSubmitMaster.Enabled = featurelist.Contains(CMConstans.MODFEAT_CREATE) ||
                                      featurelist.Contains(CMConstans.MODFEAT_EDIT);
            btnEdit.Enabled = featurelist.Contains(CMConstans.MODFEAT_EDIT);



            if (!IsPostBack)
            {
                //if (uwgGroupDetails.Columns.Exists(&quot;OTPPercentage&quot;))
                //    uwgGroupDetails.Columns.FromKey(&quot;OTPPercentage&quot;).Format = Constants.FORMAT_AMOUNT;
                //if (uwgGroupDetails.Columns.Exists(&quot;Discount&quot;))
                //    uwgGroupDetails.Columns.FromKey(&quot;Discount&quot;).Format = Constants.FORMAT_AMOUNT;
                ddlversion.Items.Insert(0, new ListItem(&quot;Select One&quot;, &quot;0&quot;));

                //Restricting the Minimum date of the Calendar controls
                wdcKDNPD.MinDate =
                    wdcKDCSD.MinDate =
                    wdcKDCWD.MinDate =
                    wdcKDNPD.MinDate =
                    wdcKDOTD.MinDate =
                    dtClosureDt.MinDate =
                    dtEndDate.MinDate =
                    dtStartDate.MinDate =
                    dtBeginDate.MinDate =
                    wdcDateCreated.MinDate = new DateTime(1753, 1, 1);
                dtBeginDate.Value = dtStartDate.Value = MWDateTimeHelper.MWNow;

                if (ProjectMode == &quot;I&quot;)
                {
                    dtBeginDate.MaxDate = dtStartDate.MaxDate = (IntegrationCutoffDate.AddDays(-1)).ToMWDateTime();
                    dtStartDate.Value = DefaultRecordDate.ToMWDateTime();
                    wdcDateCreated.MaxDate = (IntegrationCutoffDate.AddDays(-1)).ToMWDateTime();
                    wdcDateCreated.Value = DefaultRecordDate.ToMWDateTime();
                    wdcDateCreated.Enabled = true;
                }
                else if (ProjectMode == &quot;L&quot;)
                {
                    dtBeginDate.MaxDate = dtStartDate.MaxDate = DateTime.MaxValue.ToMWDateTime();
                    dtStartDate.Value = MWDateTimeHelper.MWNow;
                    wdcDateCreated.MaxDate = DateTime.MaxValue.ToMWDateTime();
                    wdcDateCreated.Value = MWDateTimeHelper.MWNow;
                    wdcDateCreated.Enabled = false;
                }

                wdcKDCCD.Value = wdcKDCSD.Value = wdcKDCWD.Value = wdcKDNPD.Value = wdcKDOTD.Value = dtClosureDt.Value = dtEndDate.Value = null;
                if (IsNew)
                {
                    dtEndDate.Value = dtEndDate.Value ?? MWDateTimeHelper.MWNow;
                    BindCalendar();
                }
                PopulateStatus();
                PopulateMeasSys();
                PopulateEstimates();
                PopulateDocumentTemplates();

                Project project = ProjectManager.Instance.GetProjectDetails(Request[Constants.QRY_PROJECTID].ToInt32_2());
                lblProjectID.Text = project.ProjectCode.BrixHTMLEncode();
                lblProjectName.Text = project.ProjectName.BrixHTMLEncode();

                if (IsView || IsEdit)
                {
                    btnBack.Text = IsView ? &quot;Back&quot; : &quot;Cancel&quot;;
                    DTO dto = null;
                    try
                    {
                        ViewState[viewState] = dto = BL.Instance.GetContract(Request[&quot;ContractID&quot;].ToInt32_2(), FetchSet.All);
                    }
                    catch
                    {
                        Response.Redirect(&quot;~/Common/BrixListPage.aspx?context=CONTMGT&amp;PID=&quot; + Request[Constants.QRY_PROJECTID], true);
                    }

                    if (IsEdit &amp;&amp; dto.IsDeleted == &quot;Y&quot;)
                        Response.Redirect(string.Format(&quot;CreateContract.aspx?Mode=View&amp;PID={0}&amp;ContractID={1}&amp;Tab={2}&amp;ParentID={1}&quot;,
                            Request[Constants.QRY_PROJECTID], Request[&quot;ContractID&quot;], (!String.IsNullOrEmpty(hdnTab.Value) ? hdnTab.Value : &quot;tab1&quot;)), true);

                    btnImpAwdItems.Visible = ((String.IsNullOrEmpty(Request[&quot;Mode&quot;]) || IsEdit) &amp;&amp; dto.Locked == &quot;N&quot;);

                    btnEditGrp.Enabled = (dto.Locked == &quot;N&quot;);
                    btnEdit.Visible = !(dto.IsDeleted == &quot;Y&quot;);
                    if (dto.CalendarID.HasValue)
                        _contractCalendarID = dto.CalendarID.Value;

                    //TimeType
                    if (AMP3ApplicationSettings.Instance.IsSingleProjectMode)
                        rblContractTime.Enabled = false;
                    rblContractTime.SelectedValue = dto.TimeType;
                    lblContractTime.Text = (!string.IsNullOrEmpty(dto.TimeType) ? rblContractTime.SelectedItem.Text : &quot;None&quot;).BrixHTMLEncode();
                    try
                    {
                        wneContractDays.Value = dto.Days.HasValue ? dto.Days.ToInt32_2() : wneContractDays.MinValue;
                        lblContractDays.Text =  dto.Days.HasValue ? dto.Days.ToInt32_2().ToString2() : &quot;None&quot;;
                    }
                    catch
                    {
                        wneContractDays.Value = wneContractDays.MinValue;
                        lblContractDays.Text = &quot;None&quot;;
                    }

                    //Calendar
                    //ddlCalendar.SelectedIndex = -1;
                    //ListItem item = null;
                    //if (dto.CalendarID.HasValue)
                    //    item = ddlCalendar.Items.FindByValue(dto.CalendarID.Value.ToString2());
                    //if (item != null)
                    //{
                    //    item.Selected = true;
                    //    lblCalendar.Text = item.Text;
                    //}
                    //else
                    //    lblCalendar.Text = &quot;None&quot;;
                    CalendarDetails calendar = GetCalendar(Request[&quot;ContractID&quot;].ToInt32_2());
                    lblCalendar.Text = ((calendar != null &amp;&amp; calendar.ID &gt; 0) ? calendar.Name : &quot;None&quot;).BrixHTMLEncode();

                    if (!IsPostBack)
                    {
                        if (dto.CalendarID.HasValue &amp;&amp; dto.CalendarID.Value &gt; 0)
                            BindCalendar(dto.CalendarID.Value);
                        else
                            BindCalendar();
                    }

                    //BeginDate
                    dtBeginDate.Value = dto.BeginDt.ToMWDateTime();
                    lblBeginDt.Text = dto.BeginDt.HasValue ? dto.BeginDt.ToMWDateTimeString_FormatDate() : &quot;None&quot;;
                    //EndDate
                    dtEndDate.Value = dto.CompletionDt.ToMWDateTime();
                    lblEndDt.Text = dto.CompletionDt.HasValue ? dto.CompletionDt.ToMWDateTimeString_FormatDate() : &quot;None&quot;;

                    SetContractTimeLabels();

                    txtContractCode.Text = dto.Code;
                    lblContractCode.Text = dto.Code.BrixHTMLEncode();

                    txtContractName.Text = dto.Name;
                    lblContractName.Text = dto.Name.BrixHTMLEncode();

                    txtDescription.Text = dto.Desc;
                    lblDesc.Text = dto.Desc.BrixHTMLEncode();
                    if (ddlGroupType.Items.FindByValue(dto.GroupType.ToString()) != null)
                    {
                        ddlGroupType.Items.FindByValue(dto.GroupType.ToString()).Selected = true;
                    }
                    lblGroupType.Text = ddlGroupType.SelectedItem.Text.BrixHTMLEncode();
                    //ddlGroupType.Enabled = (dto.Locked == &quot;N&quot;);
                    //lblIsActive.Text = (chkIsActive.Checked = (dto.Active == &quot;Y&quot; ? true : false)) ? &quot;Yes&quot; : &quot;No&quot;;
                    ddlStatus.SelectedValue = dto.StatusID.ToString();
                    ddlMSys.SelectedValue = dto.MeasSysID.ToString();
                    decimal bonusPercentage;
                    txtBonusPercentage.ValueDecimal = decimal.TryParse(dto.EarlyCompletionBonus.ToString2(), out bonusPercentage)
                                                          ? bonusPercentage : 0;
                    lblBonus.Text = dto.EarlyCompletionBonus.ToString().BrixHTMLEncode();
                    dto.AreaOffice = dto.AreaOffice.BrixHTMLEncode();
                    lblArea.Text = dto.AreaOffice;
                    txtAreaOffice.Text = dto.AreaOffice.BrixHTMLDecode();
                    if (Request[&quot;Mode&quot;] == &quot;Edit&quot; &amp;&amp;
                        BL.Instance.GetContractItemsCount(Request[&quot;ContractID&quot;].ToInt32_2(), null) &gt; 0)
                        ddlMSys.Enabled = false;

                    //chkTemplates.Checked = dto.TemplateID.HasValue ? true : false;
                    lblStartDate.Text = (dtStartDate.Value = dto.StartDt.ToMWDateTime()).ToMWDateTimeString_FormatDate();
                    lblDateCreated.Text = (wdcDateCreated.Value = dto.CreatedOn.ToMWDateTime()).ToMWDateTimeString_FormatDate();
                    dtClosureDt.Value = dto.ClosureDt;
                    lblClosureDt.Text = dto.ClosureDt.HasValue ? dto.ClosureDt.ToMWDateTimeString_FormatDate() : &quot;None&quot;;
                    lblMSys.Text = ddlMSys.SelectedItem.Text.BrixHTMLEncode();
                    lblStatus.Text = ddlStatus.SelectedItem.Text.BrixHTMLEncode();

                    //chkTemplates_CheckedChanged(sender, e);

                    List&lt;Attribute&gt; attrBakup = dto.Attributes;

                    if (project.DocumentTemplateID.HasValue &amp;&amp; ddlDocumentTemplate.Items.FindByValue(project.DocumentTemplateID.ToString2()) != null)
                        ddlDocumentTemplate.Items.FindByValue(project.DocumentTemplateID.ToString2()).Selected = true;

                    if (Request[&quot;Mode&quot;] == &quot;View&quot;)
                        lblDocTemplate.Text = ((String.IsNullOrEmpty(ddlDocumentTemplate.SelectedValue) || ddlDocumentTemplate.SelectedValue == &quot;0&quot;)
                                                ? &quot;None&quot; : ddlDocumentTemplate.SelectedItem.Text).BrixHTMLEncode();

                    PopulateModulesGrid();
                    PopulateAttributes();

                    dto.Attributes = attrBakup;

                    if (Request[&quot;Mode&quot;] == &quot;View&quot;)
                    {
                        ddlAttributes.Items.Clear();
                        tdAttName.Visible = false;

                        for (int i = 0; i &lt; dto.Attributes.Count; i++)
                        {
                            ddlAttributes.Items.Add(new ListItem(dto.Attributes[i].Name, dto.Attributes[i].ID));
                        }

                        ddlAttributes.Items.Insert(0, new ListItem(&quot;Select&quot;, &quot;-1&quot;));
                        ddlAttributes.SelectedIndex = 0;
                    }

                    for (int i = 0; i &lt; dto.Groups.Count; i++)
                    {
                        uwgGroupDetails.Rows.Add(new UltraGridRow(new object[]
                                                                      {
                                                                          dto.Groups[i].Name, dto.Groups[i].Desc,
                                                                          //dto.Groups[i].OTPPercentage, dto.Groups[i].Discount,
                                                                          dto.Groups[i].ID
                                                                          //uwgGroupDetails.Rows.Count + 1
                                                                      }));
                    }

                    foreach (var rowItem in gridModulePlatforms.Items)
                    {
                        if (rowItem is GridDataItem)
                        {
                            GridDataItem item = rowItem as GridDataItem;

                            var mod = new Module();
                            mod.ModID = item[&quot;ModuleID&quot;].Text;
                            mod.Key = &quot;W_W_WEB&quot;;

                            if (dto.Modules.Contains(mod) &amp;&amp; Request[&quot;Mode&quot;] != &quot;View&quot;)
                                item.Selected = true;
                            else if (!dto.Modules.Contains(mod) &amp;&amp; Request[&quot;Mode&quot;] == &quot;View&quot;)
                                item.Display = false;
                        }
                    }

                    lblNoAtt.Visible =
                        !(ddlAttributes.Visible = (Request[&quot;Mode&quot;] == &quot;View&quot; &amp;&amp; ddlAttributes.Items.Count &gt; 1) ||
                                                  Request[&quot;Mode&quot;] != &quot;View&quot;);

                    if (Request[&quot;Mode&quot;] == &quot;View&quot;)
                        ddlAttributes.Visible = false;
                    else
                        ddlAttributes.Visible = true;
                    ShowAttributesTable();

                    /* Key Dates */
                    wdcKDCCD.Value = dto.KeyDates.ContractClosedDate;
                    lblKDCCD.Text = dto.KeyDates.ContractClosedDate.HasValue
                                        ? dto.KeyDates.ContractClosedDate.Value.ToString(AMP3ApplicationSettings.Instance.FORMAT_DATE, CultureInfo.CurrentCulture) : &quot;None&quot;;

                    wdcKDCSD.Value = dto.KeyDates.ConstructionStartedDate;
                    lblKDCSD.Text = dto.KeyDates.ConstructionStartedDate.HasValue
                                        ? dto.KeyDates.ConstructionStartedDate.Value.ToString(AMP3ApplicationSettings.Instance.FORMAT_DATE, CultureInfo.CurrentCulture) : &quot;None&quot;;

                    wdcKDNPD.Value = dto.KeyDates.NoticeToProceedDate;
                    lblKDNPD.Text = dto.KeyDates.NoticeToProceedDate.HasValue
                                        ? dto.KeyDates.NoticeToProceedDate.Value.ToString(AMP3ApplicationSettings.Instance.FORMAT_DATE, CultureInfo.CurrentCulture)
                                        : &quot;None&quot;;

                    wdcKDOTD.Value = dto.KeyDates.OpenToTrafficDate;
                    lblKDOTD.Text = dto.KeyDates.OpenToTrafficDate.HasValue
                                        ? dto.KeyDates.OpenToTrafficDate.Value.ToString(AMP3ApplicationSettings.Instance.FORMAT_DATE, CultureInfo.CurrentCulture)
                                        : &quot;None&quot;;

                    wdcKDCWD.Value = dto.KeyDates.ContractWorkCompleteDate;
                    lblKDCWD.Text = dto.KeyDates.ContractWorkCompleteDate.HasValue
                                        ? dto.KeyDates.ContractWorkCompleteDate.Value.ToString(AMP3ApplicationSettings.Instance.FORMAT_DATE, CultureInfo.CurrentCulture)
                                        : &quot;None&quot;;
                    /* Key Dates End */

                    /* Key Contacts */
                    txtKCCA.Text = dto.KeyContacts.ContractAdministrator;
                    lblKCCA.Text = dto.KeyContacts.ContractAdministrator.BrixHTMLEncode();

                    txtKCPE.Text = dto.KeyContacts.ProjectEngineer;
                    lblKCPE.Text = dto.KeyContacts.ProjectEngineer.BrixHTMLEncode();

                    txtKCRE.Text = dto.KeyContacts.ResidentEngineer;
                    lblKCRE.Text = dto.KeyContacts.ResidentEngineer.BrixHTMLEncode();

                    if (string.IsNullOrEmpty(dto.KeyContacts.ContractAdministrator))
                        lblKCCA.Text = &quot;None&quot;;
                    if (string.IsNullOrEmpty(dto.KeyContacts.ProjectEngineer))
                        lblKCPE.Text = &quot;None&quot;;
                    if (string.IsNullOrEmpty(dto.KeyContacts.ResidentEngineer))
                        lblKCRE.Text = &quot;None&quot;;
                    /* Key Contacts End */
                }
                else
                {
                    PopulateModulesGrid();
                    PopulateAttributes();
                }
                tdCC.InnerText = LocalizedContract + &quot; Code :&quot;;
                tdCN.InnerText = LocalizedContract + &quot; Name :&quot;;
                List&lt;string&gt; components = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);
                if (!components.Contains(&quot;EarlyCompletionBonus&quot;))
                {
                    lblBonusForCompletion.Visible = false;
                    txtBonusPercentage.Visible = false;
                    lblBonus.Visible = false;
                    lblBonusPercentage.Visible = false;
                    tdBonusForCompletion.Style[HtmlTextWriterStyle.Display] = tdBonusPercentage.Style[HtmlTextWriterStyle.Display] = &quot;none&quot;;
                }

                if (AMP3ApplicationSettings.Instance.IsSingleProjectMode &amp;&amp; components.Contains(&quot;SyncContractDatesFromProjectDates&quot;))
                    tdContractTime.Style.Add(&quot;display&quot;, &quot;none&quot;);
            }
            else
            {
                DTO contractDto = ViewState[viewState] as DTO;

                if (contractDto != null &amp;&amp; contractDto.CalendarID.HasValue)
                {
                    _contractCalendarID = contractDto.CalendarID.Value;
                }

                ShowAttributesTable();
            }
            SetLocalizedStrings();

            bool isView = !string.IsNullOrEmpty(Request[&quot;Mode&quot;]) &amp;&amp; Request[&quot;Mode&quot;].ToLower2().Equals(&quot;view&quot;);
            ShowControlsForViewPage(isView);
            ShowTimeControlsForViewPage(isView || IsLocked);

            //bool hideProjectTree = ConfigurationManager.AppSettings[&quot;HideProjectTree&quot;] == null ? false : ConfigurationManager.AppSettings[&quot;HideProjectTree&quot;].ToBoolean2();
            //if (hideProjectTree)
            //    trContractNameCode.Style.Add(&quot;display&quot;, &quot;none&quot;);
            XmlFormArgs args = new XmlFormArgs();
            if (managerModel != null)
                managerModel.OnPageLoad(model, args);

        }

        private void SetPageTitle()
        {
            String Title = LocalizedContract;
            if (AMP3ApplicationSettings.Instance.IsSingleProjectMode)
                PageTitle = &quot;Contract Setup&quot;;

            else
            {
                if (String.IsNullOrEmpty(Request[&quot;Mode&quot;]))
                    PageTitle = &quot;New &quot; + LocalizedContract;
                else if (Request[&quot;Mode&quot;] == &quot;Edit&quot;)
                    PageTitle = &quot;Edit &quot; + LocalizedContract;
                else if (Request[&quot;Mode&quot;] == &quot;View&quot;)
                    PageTitle = &quot;View &quot; + LocalizedContract;
            }
        }

        private void SetLocalizedStrings()
        {
            hdnItem.Value = ItemName;

            btnImpAwdItems.Text = &quot;Import Estimate Items&quot;;
            tab3.Attributes.Add(&quot;targetid&quot;, tabSG.ClientID);
        }

        private void PopulateMeasSys()
        {
            ddlMSys.DataSource = BL.Instance.GetMeasSys(Session[Constants.EIS_ADDITIONAL_INFO].ToString(), null);
            ddlMSys.DataTextField = &quot;Name&quot;;
            ddlMSys.DataValueField = &quot;ID&quot;;
            ddlMSys.DataBind();
            ddlMSys.Items.Insert(0, new ListItem(&quot;Select&quot;, &quot;-1&quot;));
            if (ddlMSys.Items.Count &gt; 1)
                ddlMSys.SelectedIndex = 1;
        }

        private void PopulateDocumentTemplates()
        {
            DataTable dt = DocumentManager.Instance.GetDocumentTemplates();

            if (dt != null)
            {
                ddlDocumentTemplate.DataSource = dt;
                ddlDocumentTemplate.DataTextField = &quot;DocTemplateName&quot;;
                ddlDocumentTemplate.DataValueField = &quot;DocTemplateID&quot;;
                ddlDocumentTemplate.DataBind();

                ddlDocumentTemplate.Items.Insert(0, new ListItem(&quot;Select One&quot;, &quot;0&quot;));
            }
        }

        private void PopulateStatus()
        {
            ddlStatus.DataSource = BL.Instance.GetStatus(null);
            ddlStatus.DataTextField = &quot;Name&quot;;
            ddlStatus.DataValueField = &quot;ID&quot;;
            ddlStatus.DataBind();
            //ddlStatus.Items.Insert(0, new ListItem(&quot;Select&quot;, &quot;-1&quot;));
        }

        protected void btnEditContract_Click(object sender, EventArgs e)
        {
            Response.Redirect(&quot;CreateContract.aspx?Mode=Edit&amp;PID=&quot; + Request[Constants.QRY_PROJECTID] + &quot;&amp;ContractID=&quot; +
                              Request[&quot;ContractID&quot;] + &quot;&amp;ParentID=&quot; + Request[&quot;ContractID&quot;] + &quot;&amp;Tab=&quot; + (!String.IsNullOrEmpty(hdnTab.Value)
                                                                     ? hdnTab.Value
                                                                     : &quot;tab1&quot;));
        }

        protected void btnAudit_Click(object sender, EventArgs e)
        {
            string backurl = &quot;~/Modules/CONTMGT/CreateContract.aspx?Mode=View&amp;PID=&quot; + Request[Constants.QRY_PROJECTID] + &quot;&amp;ContractID=&quot; +
                               Request[&quot;ContractID&quot;];
            backurl = HttpUtility.UrlEncode(backurl);
            Response.Redirect(string.Format(&quot;~/Common/Auditlog.aspx?&quot; + &quot;Context={0}&quot; + &quot;&amp;backUrl={1}&quot;, &quot;CONTMGT&quot;, backurl));
        }

        #region &quot;Save Cancel Destroy&quot;

        protected void btnSubmitMaster_Click(object sender, EventArgs e)
        {
            if (!string.IsNullOrEmpty(ConnectionHelper.GetCurrentCompany())
                &amp;&amp; BL.Instance.GetAllSubProjectCount(Request[Constants.QRY_PROJECTID].ToInt32_2()) &gt;= CompanyManager.Instance.GetCurrentCompanyDetails().ProjectLimit
                &amp;&amp; (string.IsNullOrEmpty(Request[&quot;Mode&quot;]) || Request[&quot;Mode&quot;] == &quot;New&quot;))
                ScriptManager.RegisterStartupScript(this, GetType(), &quot;5&quot;, @&quot;ShowError(&#39;Please upgrade to create more sub-projects&#39;);&quot;, true);
            else
                WorkflowEnabledSaveHandler();
        }

        private bool IsLocked
        {
            get
            {
                return ViewState[viewState] != null ? (ViewState[viewState] as DTO).Locked == &quot;Y&quot; : false;
            }
        }

        protected override bool IsNew
        {
            get
            {
                return string.IsNullOrEmpty(Request[&quot;Mode&quot;]);
            }
        }

        protected override bool IsEdit
        {
            get
            {
                return !string.IsNullOrEmpty(Request[&quot;Mode&quot;]) &amp;&amp; Request[&quot;Mode&quot;].ToLower2() == &quot;edit&quot;;
            }
        }

        protected override bool IsView
        {
            get
            {
                return !string.IsNullOrEmpty(Request[&quot;Mode&quot;]) &amp;&amp; Request[&quot;Mode&quot;].ToLower2() == &quot;view&quot;;
            }
        }

        private bool SaveContract(out int contractID, bool IsRedirect = false)
        {
            int ContractID = 0;
            try
            {
                var objTabMaster = base.Master as BrixTabMasterPage;

                if (ValidateContract())
                {

                    if (uwgGroupDetails.Rows.Count == 0)
                        uwgGroupDetails.Rows.Add(new UltraGridRow(new object[] { &quot;Default&quot;, &quot;Default Group&quot;, null, null, -1 }));

                    DTO dto;

                    if ((dto = ViewState[viewState] as DTO) == null)
                        dto = new DTO();

                    dto.Name = txtContractName.Text.Trim();
                    dto.Code = txtContractCode.Text.Trim();

                    dto.StatusID = ddlStatus.Text.ToInt32_2();
                    //if (!chkTemplates.Checked || ddlTemplates.SelectedValue == &quot;-1&quot;)
                    //	dto.TemplateID = null;
                    //else
                    //	dto.TemplateID = BrixDatatypeHelper.ToInt32_2(ddlTemplates.SelectedValue);

                    dto.MeasSysID = ddlMSys.SelectedValue.ToInt32_2();
                    //dto.Groups = new List&lt;Group&gt;();
                    //Group gp = new Group();

                    //for (int i = 0; i &lt; uwgGroupDetails.Rows.Count; i++)
                    //{
                    //    CellsCollection coll = uwgGroupDetails.Rows[i].Cells;
                    //    gp.Name = coll.FromKey(&quot;GroupName&quot;).Text;
                    //    gp.Desc = coll.FromKey(&quot;GroupDesc&quot;).Text;
                    //    gp.OTPPercentage = (coll.FromKey(&quot;OTPPercentage&quot;).Value != null) ? (decimal?)BrixDatatypeHelper.ToDecimal2(coll.FromKey(&quot;OTPPercentage&quot;).Value) : null;
                    //    gp.Discount = (coll.FromKey(&quot;Discount&quot;).Value != null) ? (decimal?)BrixDatatypeHelper.ToDecimal2(coll.FromKey(&quot;Discount&quot;).Value) : null;
                    //    gp.ID = BrixDatatypeHelper.ToInt32_2(coll.FromKey(&quot;RowID&quot;).Value);

                    //    dto.Groups.Add(gp);
                    //}
                    //if (dto.Groups.Count == 0)
                    //{
                    //    gp.Name = &quot;Default&quot;;
                    //    gp.Desc = &quot;Default Group&quot;;
                    //    gp.OTPPercentage = gp.Discount = null;
                    //    gp.ID = -1;
                    //    dto.Groups.Add(gp);
                    //}

                    dto = GetCommonContractData(dto);
                    dto.ProjectCode = lblProjectID.Text.BrixHTMLDecode();
                    dto.CreatedOn = wdcDateCreated.Value.ToMWUtcDateTime();
                    dto.ModifiedBy = (UserDetail.GetCurrentUserDetail().UserName != null) ? UserDetail.GetCurrentUserDetail().UserName : String.Empty;
                    dto.ModifiedOn = DateTime.UtcNow;
                    dto.DocTemplateID = (ddlDocumentTemplate.SelectedIndex &gt; 0) ? ddlDocumentTemplate.SelectedValue.ToInt32_2() : (int?)null;

                    objTabMaster.PreSaveCheck();
                    //dto.Sections = new List&lt;Section&gt;();
                    bool isNewContract = !(!String.IsNullOrEmpty(Request[&quot;Mode&quot;]) &amp;&amp; Request[&quot;Mode&quot;] == &quot;Edit&quot;);
                    ContractID = BL.Instance.CUDContract(PID, !isNewContract ? Operations.Update : Operations.Create, dto);

                    if (ContractID == -999)
                        ContractID = Request[&quot;ContractID&quot;].ToInt32_2();

                    //Update Contact Time
                    if (String.IsNullOrEmpty(Request[&quot;Mode&quot;]) &amp;&amp; dto.IDs.Count == 0)
                        dto.IDs.Add(ContractID);
                    if (dto.Locked != &quot;Y&quot;)
                        SaveContractTime(dto, ContractID);

                    //Create Contract level document folders
                    Folder projFolder = DocumentManager.Instance.GetInstanceRootFolder(PID, &quot;PROJECT&quot;);

                    DocumentManager.Instance.AddFolder(new Folder()
                    {
                        ParentId = 0,
                        FolderName = &quot;{0}-{1}&quot;.Format2(dto.Name, dto.Code),
                        FolderDesc = &quot;Contract Documents&quot;,
                        ModuleId = &quot;CONTMGT&quot;,
                        InstanceId = ContractID.ToString(),
                        ListID = projFolder.ListID,
                        ListPath = &quot;{0}-{1}&quot;.Format2(dto.Name, dto.Code),
                        ParentModuleId = &quot;PROJECT&quot;,
                        ParentInstanceId = PID
                    });

                    Folder ContractFolder = DocumentManager.Instance.GetInstanceRootFolder(ContractID, &quot;CONTMGT&quot;);
                    if (!isNewContract)
                    {
                        ContractFolder.RootModuleFolderId = projFolder.FolderId;
                        ContractFolder.FolderName = ContractFolder.ListPath = &quot;{0}-{1}&quot;.Format2(dto.Name, dto.Code);
                        DocumentManager.Instance.ModifyFolder(ContractFolder);
                    }
                    else // new contract
                    {
                        BrixWorkflowManager.Instance.TriggerWorkflow(TriggerPoint.TriggerActions[0], &quot;XCNTBGT&quot;, PID.ToString(), ContractID.ToString(), &quot;&quot;, ContractID.ToString());
                    }

                    // if the contract was created successfully then instantiate the document tree for the contract based
                    // on the selected document template
                    if (ddlDocumentTemplate.SelectedIndex &gt; 0)
                    {
                        int DocTemplateID;
                        if (int.TryParse(ddlDocumentTemplate.Items[ddlDocumentTemplate.SelectedIndex].Value, out DocTemplateID))
                            if (DocTemplateID &gt; 0)
                                DocumentManager.Instance.InstantiateDocumentTemplate(ContractFolder, DocTemplateID);
                    }
                    foreach (Module mod in dto.Modules)
                        DocumentManagementBL.DocumentManager.Instance.CreateFolderForModule(mod.ModID, &quot;CONTMGT&quot;, ContractID);
                    DocumentManagementBL.DocumentManager.Instance.CreateFolderForModule(&quot;SUBMTAL&quot;, &quot;CONTMGT&quot;, ContractID);

                    DocumentManager.Instance.AddFolder(new Folder()
                    {

                        ModuleId = &quot;CONTERM&quot;,
                        InstanceId = &quot;0&quot;,
                        ParentInstanceId = ContractID,
                        FolderName = &quot;Contractual Terms and Conditions&quot;,
                        FolderDesc = &quot;Contractual Terms and Conditions&quot;,
                        ParentId = ContractFolder.FolderId,
                        ParentModuleId = &quot;CONTMGT&quot;,
                        ListID = ContractFolder.ListID,
                        ListPath = &quot;{0}{1}&quot;.Format2(!string.IsNullOrEmpty(ContractFolder.ListPath) ? &quot;{0}{1}&quot;.Format2(ContractFolder.ListPath, &quot;/&quot;) : string.Empty, &quot;Contractual Terms and Conditions&quot;)

                    });


                    objTabMaster.AMP3ObjectId = ContractID;
                    objTabMaster.MasterSave(GetPageData());
                    if (objTabMaster.ERPTabPageData != null &amp;&amp; objTabMaster.ERPTabPageData.Count &gt; 0 &amp;&amp;
                        IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX))
                    {
                        string currency = objTabMaster.ERPTabPageData[1].Value.ToString2();
                        if (!currency.Equals(LocalizationManager.GetModuleCurrency(&quot;PROJECT&quot;, Request[&quot;PID&quot;],
                            Session[Constants.EIS_ADDITIONAL_INFO].ToString2())))
                        {
                            if (String.IsNullOrEmpty(Request[&quot;Mode&quot;]) &amp;&amp; dto.IDs.Count == 0)
                                dto.IDs.Add(ContractID);
                            dto.ERPCurrency = currency;
                            ContractID = BL.Instance.CUDContract(PID, Operations.Update, dto);
                        }
                    }
                    if (!string.IsNullOrEmpty(dto.PC.Company) &amp;&amp; !chkEngEstimate.Checked)
                    {
                        var ConBrixInfo = new List&lt;ConnectionBrixInfo&gt;();
                        ConBrixInfo.Add(new ConnectionBrixInfo(AMP3Object.CONTMGT, ContractID.ToString2(),
                                                               AMP3Object.UNKNOWN, null));
                        ConBrixInfo.Add(new ConnectionBrixInfo(AMP3Object.CONTRACTOR, dto.PC.Company,
                                                               AMP3Object.CONTMGT, ContractID.ToString2()));
                        var dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
                        dictAdditionalInfo.Add(RegisteredEIS.AX,
                                               (new EISAdditionalInfo(RegisteredEIS.AX)).AddInfo(
                                                   Constants.EIS_ADDITIONAL_INFO,
                                                   Session[Constants.EIS_ADDITIONAL_INFO].ToString()));
                        var connectorParameters =
                            new ConnectorParameters(dictAdditionalInfo, MethodBase.GetCurrentMethod(),
                                                    AMP3ObjectType.Unknown, EISObjectType.Contractor, null, ConBrixInfo);
                        IntegrationConnectorManager.HandleMap(connectorParameters);
                    }
                    // string updateTree = (!string.IsNullOrEmpty(Request[&quot;Mode&quot;]) &amp;&amp; Request[&quot;Mode&quot;] == &quot;Edit&quot;) ? &quot;&amp;nt=1&quot; : string.Empty;

                    //Response.Redirect(&quot;CreateContract.aspx?Mode=View&amp;PID=&quot; + Request[Constants.QRY_PROJECTID] +
                    //                  &quot;&amp;ContractID=&quot; + Request[&quot;ContractID&quot;]
                    //                  + &quot;&amp;Tab=&quot; + (!String.IsNullOrEmpty(hdnTab.Value)
                    //                                   ? hdnTab.Value
                    //                                   : &quot;tab1&quot;), true);
                    //btnBack_Click(sender, e);

                    Dictionary&lt;string, Type&gt; dicObj = AfterSaveRecordModel.GetModelObjects();
                    foreach (KeyValuePair&lt;string, Type&gt; kvp in dicObj)
                    {
                        var model = AfterSaveRecordModel.GetInstance(kvp.Key);
                        if (model != null)
                            model.SaveDetails(dto, this.Page, isNewContract ? &quot;New&quot; : &quot;Edit&quot;, &quot;SAVE_CONTRACT&quot;);
                    }

                    if (isNewContract)
                    {
                        BL.Instance.InviteProjectUsersToContract(PID, ContractID);
                    }

                    contractID = ContractID;
                    return true;
                }
                else
                {
                    contractID = -1;
                    return false;
                }
            }
            catch (Exception ex)
            {
                string msg = &quot;ShowError(&#39;&quot; + ex.Message.Replace(&quot;&#39;&quot;, &quot;\\&#39;&quot;) + &quot;&#39;);&quot;;
                msg = msg.Replace(Environment.NewLine, &quot;&quot;).Replace(&quot;\n&quot;, &quot;&quot;);
                ScriptManager.RegisterStartupScript(this, GetType(), &quot;Err&quot;, msg, true);
                contractID = -1;
                return false;
            }
        }

        private bool ValidateContract()
        {
            if (String.IsNullOrEmpty(txtContractCode.Text.Trim()))
            // || !Regex.IsMatch(txtContractCode.Text, @&quot;[a-zA-Z0-9\&#39;_]+&quot;))
            {
                txtContractCode.Focus();
                //throw new Exception(@&quot;Contract Code is mandatory.&quot;);
                // and can contain only alphanumeric,underscore(_),apostrophe(&#39;)&quot;);
                ScriptManager.RegisterStartupScript(this, GetType(), &quot;7&quot;, @&quot;ShowError(&#39;&quot; + LocalizedContract + &quot; Code is mandatory.&#39;);&quot;,
                                                    true);
                return false;
            }
            //Space can be allowed in contract code if AX is not there
            //This restriction might have been put in the application while integrating with AX.
            //Anyhow for Lincoln and other US customers, the existing data has got space in Contract code and we need to allow this
            //So for now we are preventing the entry of space based on whether the application is connected to AX or not.
            if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX))
            {
                if (!String.IsNullOrEmpty(txtContractCode.Text.Trim()))
                {
                    if (!Regex.IsMatch(txtContractCode.Text.Trim(), @&quot;^[^\s]+$&quot;))
                    {
                        txtContractCode.Focus();
                        ScriptManager.RegisterStartupScript(this, GetType(), &quot;CCode&quot;, @&quot;ShowError(&#39;Space is not allowed in &quot; + LocalizedContract + &quot; Code.&#39;);&quot;,
                                                            true);
                        return false;
                    }
                }
            }
            if (Regex.IsMatch(txtContractCode.Text.Trim(), @&quot;[\^|]&quot;))
            {
                ScriptManager.RegisterStartupScript(this, GetType(), &quot;6&quot;,
                                                    @&quot;ShowError(&#39;&quot; + LocalizedContract + &quot; Code cannot contain the following characters: ^ |&#39;);&quot;,
                                                    true);
                return false;
            }

            if (String.IsNullOrEmpty(txtContractName.Text.Trim()))
            // || Regex.IsMatch(txtContractName.Text, @&quot;[^\\^\/^&gt;^&lt;^|^\^]+&quot;))
            {
                txtContractName.Focus();
                //throw new Exception(@&quot;Contract Name is mandatory.&quot;);
                ScriptManager.RegisterStartupScript(this, GetType(), &quot;25&quot;, @&quot;ShowError(&#39;&quot; + LocalizedContract + &quot; Name is mandatory.&#39;);&quot;,
                                                    true);
                // and cannot contain the following characters: / \ &lt; &gt; | ^&quot;);
                return false;
            }
            else if (Regex.IsMatch(txtContractName.Text.Trim(), @&quot;[\^|]&quot;))
            {
                ScriptManager.RegisterStartupScript(this, GetType(), &quot;6&quot;,
                                                    @&quot;ShowError(&#39;&quot; + LocalizedContract + &quot; Name cannot contain the following characters: ^ |&#39;);&quot;,
                                                    true);
                return false;
            }

            if (!IsLocked &amp;&amp; rblContractTime.SelectedIndex == -1)
            {
                rblContractTime.Focus();
                ScriptManager.RegisterStartupScript(this, GetType(), &quot;9&quot;, @&quot;ShowError(&#39;Time Type is mandatory.&#39;);&quot;, true);
                return false;
            }

            try
            {
                if (!IsLocked)
                    dtBeginDate.Value.ToString().ToDateTime_MWCulture().ToMWDateTime();
            }
            catch
            {
                dtBeginDate.Focus();
                //throw new Exception(@&quot;Contract Start Date is mandatory and can contain only Dates.&quot;);
                ScriptManager.RegisterStartupScript(this, GetType(), &quot;8&quot;,
                    @&quot;ShowError(&#39;&quot; + LocalizedContract + &quot; Start Date is mandatory and can contain only Dates.&#39;);&quot;, true);
                return false;
            }

            if (!IsLocked &amp;&amp; wneContractDays.ValueInt == 0)
            {
                wneContractDays.Focus();
                ScriptManager.RegisterStartupScript(this, GetType(), &quot;26&quot;,
                    @&quot;ShowError(&#39;{0} must be greater than zero.&#39;,&#39;Error&#39;);&quot;.Format2(txtDays.Text), true);
                return false;
            }

            try
            {
                if (!IsLocked &amp;&amp; dtEndDate.Value != null)
                {
                    if (dtBeginDate.Value.ToString().ToDateTime_MWCulture().Date.CompareTo(dtEndDate.Value.ToString().ToDateTime_MWCulture().Date) == 1)
                    {
                        //throw new Exception(@&quot;Contract Closure must be greater than or equal to Contract Start Date.&quot;);
                        ScriptManager.RegisterStartupScript(this, GetType(), &quot;27&quot;,
                            @&quot;ShowError(&#39;&quot; + LocalizedContract + &quot; Closure must be greater than or equal to &quot; + LocalizedContract + &quot; Start Date.&#39;);&quot;, true);
                        return false;
                    }
                }
            }
            catch
            {
                dtEndDate.Focus();
                //throw new Exception(@&quot;Contract Closure Date can contain only Dates and must not be earlier than the Contract Start Date.&quot;);
                ScriptManager.RegisterStartupScript(this, GetType(), &quot;10&quot;,
                    @&quot;ShowError(&#39;&quot; + LocalizedContract + &quot; Closure Date can contain only Dates and must not be earlier than the &quot; + LocalizedContract + &quot; Start Date.&#39;);&quot;, true);
                return false;
            }

            if (ddlStatus.SelectedValue == &quot;-1&quot;)
            {
                ddlStatus.Focus();
                //throw new Exception(@&quot;Contract Status is mandatory.&quot;);
                ScriptManager.RegisterStartupScript(this, GetType(), &quot;11&quot;, @&quot;ShowError(&#39;&quot; + LocalizedContract + &quot; Status is mandatory.&#39;);&quot;, true);
                return false;
            }

            if (ddlMSys.SelectedValue == &quot;-1&quot;)
            {
                ddlMSys.Focus();
                //throw new Exception(@&quot;Measurement System is mandatory.&quot;);
                ScriptManager.RegisterStartupScript(this, GetType(), &quot;12&quot;, @&quot;ShowError(&#39;Measurement System is mandatory.&#39;);&quot;, true);
                return false;
            }
            return true;
        }

        private DTO GetCommonContractData(DTO dto)
        {
            dto.Modules.Clear();

            DateTime startDate = GetValidDateTime(dtBeginDate.Value);
            DateTime endDate = GetValidDateTime(dtEndDate.Value);

            dto.StartDt = startDate.Date.ToUtc();
            dto.CreatedBy = UserDetail.GetCurrentUserDetail().UID;
            dto.Desc = txtDescription.Text;
            dto.GroupType = Convert.ToChar(ddlGroupType.SelectedValue, CultureInfo.InvariantCulture);
            //dto.Active = chkIsActive.Checked ? &quot;Y&quot; : &quot;N&quot;;
            dto.AreaOffice = HttpUtility.HtmlEncode(txtAreaOffice.Text);
            dto.EarlyCompletionBonus = txtBonusPercentage.ValueDecimal;

            if (dtEndDate.Value != null)
                dto.ClosureDt = endDate.Date.ToUtc();
            else
                dto.ClosureDt = null;

            foreach (var rowItem in gridModulePlatforms.SelectedItems)
            {
                if (rowItem is GridDataItem)
                {
                    GridDataItem item = rowItem as GridDataItem;

                    if (ViewState[viewStatePlatform] == null)
                        ViewState[viewStatePlatform] = BL.Instance.GetPlatformList();

                    CheckBox ch = (CheckBox)item[&quot;SelectModules&quot;].Controls[0];
                    if (ch.Checked)
                    {
                        CheckBox wch = (CheckBox)item[&quot;Web&quot;].Controls[0];
                        if (wch.Checked)
                        {
                            var mod = new Module();
                            mod.ModID = item[&quot;ModuleID&quot;].Text;
                            mod.Key = &quot;W_W_WEB&quot;;
                            dto.Modules.Add(mod);
                        }
                        if ((gridModulePlatforms.MasterTableView.GetColumnSafe(Constants.XPCLNT_PLT_NAME) != null) &amp;&amp;
                            ((CheckBox)item[Constants.XPCLNT_PLT_NAME].Controls[0]).Checked)
                        {
                            var mod = new Module();
                            mod.ModID = item[&quot;ModuleID&quot;].Text;
                            mod.Key = Constants.XPCLNT_PLT;
                            dto.Modules.Add(mod);
                        }
                        if ((gridModulePlatforms.MasterTableView.GetColumnSafe(Constants.OFFLINE_PLT_NAME) != null) &amp;&amp;
                            ((CheckBox)item[Constants.OFFLINE_PLT_NAME].Controls[0]).Checked)
                        {
                            var mod = new Module();
                            mod.ModID = item[&quot;ModuleID&quot;].Text;
                            mod.Key = Constants.OFFLINE_PLT;
                            dto.Modules.Add(mod);
                        }
                    }
                }
            }

            /* Key Dates */
            dto.KeyDates.ContractClosedDate = wdcKDCCD.Value == null ? (DateTime?)null : wdcKDCCD.Value.ToUtc();
            dto.KeyDates.ConstructionStartedDate = wdcKDCSD.Value == null
                                                       ? (DateTime?)null
                                                       : wdcKDCSD.Value.ToUtc();
            dto.KeyDates.NoticeToProceedDate = wdcKDNPD.Value == null ? (DateTime?)null : wdcKDNPD.Value.ToUtc();
            dto.KeyDates.OpenToTrafficDate = wdcKDOTD.Value == null ? (DateTime?)null : wdcKDOTD.Value.ToUtc();
            dto.KeyDates.ContractWorkCompleteDate = wdcKDCWD.Value == null
                                                        ? (DateTime?)null
                                                        : wdcKDCWD.Value.ToUtc();
            /* Key Dates End */

            /* Key Contacts */
            dto.KeyContacts.ContractAdministrator = String.IsNullOrEmpty(txtKCCA.Text) ? null : txtKCCA.Text;
            dto.KeyContacts.ProjectEngineer = String.IsNullOrEmpty(txtKCPE.Text) ? null : txtKCPE.Text;
            dto.KeyContacts.ResidentEngineer = String.IsNullOrEmpty(txtKCRE.Text) ? null : txtKCRE.Text;
            /* Key Contacts End*/

            dto.Groups = new List&lt;Group&gt;();
            var gp = new Group();

            for (int i = 0; i &lt; uwgGroupDetails.Rows.Count; i++)
            {
                CellsCollection coll = uwgGroupDetails.Rows[i].Cells;
                gp.Name = coll.FromKey(&quot;GroupName&quot;).Text;
                gp.Desc = coll.FromKey(&quot;GroupDesc&quot;).Text;
                gp.ID = coll.FromKey(&quot;RowID&quot;).Value.ToInt32_2();

                dto.Groups.Add(gp);
            }
            if (dto.Groups.Count == 0)
            {
                gp.Name = &quot;Default&quot;;
                gp.Desc = &quot;Default Group&quot;;
                gp.ID = -1;
                dto.Groups.Add(gp);
            }

            return dto;
        }

        protected void btnBack_Click(object sender, EventArgs e)
        {
            Response.Redirect(&quot;~/Common/BrixListPage.aspx?context=CONTMGT&amp;PID=&quot; + Request[Constants.QRY_PROJECTID],
                              false);
        }

        //private void CheckContract()
        //{
        //    if (String.IsNullOrEmpty(txtContractCode.Text))
        //    {
        //        txtContractCode.Focus();
        //        throw new Exception(@&quot;&quot; + LocalizedContract + &quot; Code is mandatory.&quot;);
        //        //ScriptManager.RegisterStartupScript(this, GetType(), &quot;14&quot;, @&quot;alert(&#39;&quot; + LocalizedContract + &quot; Code is mandatory.&#39;);&quot;,
        //        //                                    true);
        //        //return;
        //    }

        //    if (String.IsNullOrEmpty(txtContractName.Text))
        //    {
        //        txtContractName.Focus();
        //        throw new Exception(@&quot;&quot; + LocalizedContract + &quot; Name is mandatory.&quot;);
        //        //ScriptManager.RegisterStartupScript(this, GetType(), &quot;13&quot;, @&quot;alert(&#39;&quot; + LocalizedContract + &quot; Name is mandatory.&#39;);&quot;,
        //        //                                    true);
        //        //return;
        //    }
        //    else if (Regex.IsMatch(txtContractName.Text.Trim(), @&quot;[\^|]&quot;))
        //    {
        //        txtContractName.Focus();
        //        throw new Exception(@&quot;&quot; + LocalizedContract + &quot; Name cannot contain the following characters: ^ |&quot;);
        //        //ScriptManager.RegisterStartupScript(this, GetType(), &quot;15&quot;,
        //        //                                    @&quot;alert(&#39;&quot; + LocalizedContract + &quot; Name cannot contain the following characters: ^ |&#39;);&quot;,
        //        //                                    true);
        //        //return;
        //    }

        //    try
        //    {
        //        dtStartDate.Value.ToString().ToDateTime_MWCulture();
        //    }
        //    catch
        //    {
        //        dtStartDate.Focus();
        //        throw new Exception(@&quot;&quot; + LocalizedContract + &quot; Start Date is mandatory and can contain only Dates.&quot;);
        //        //ScriptManager.RegisterStartupScript(this, GetType(), &quot;16&quot;,
        //        //                                    @&quot;alert(&#39;&quot; + LocalizedContract + &quot; Start Date is mandatory and can contain only Dates.&#39;);&quot;,
        //        //                                    true);
        //        //return;
        //    }

        //    try
        //    {
        //        if (dtClosureDt.Value != null)
        //        {
        //            if (
        //                dtStartDate.Value.ToString().ToDateTime_MWCulture().Date.CompareTo(
        //                    dtClosureDt.Value.ToString().ToDateTime_MWCulture().Date) == 1)
        //            {
        //                throw new Exception(@&quot;&quot; + LocalizedContract + &quot; Closure must be greater than or equal to Contract Start Date.&quot;);
        //                //ScriptManager.RegisterStartupScript(this, GetType(), &quot;17&quot;,
        //                //                                    @&quot;alert(&#39;&quot; + LocalizedContract + &quot; Closure must be greater than or equal to Contract Start Date.&#39;);&quot;,
        //                //                                    true);
        //                //return;
        //            }
        //        }
        //    }
        //    catch
        //    {
        //        dtClosureDt.Focus();
        //        throw new Exception(@&quot;&quot; + LocalizedContract + &quot; Closure Date can contain only Dates and must not be earlier than the Contract Start Date.&quot;);
        //        //ScriptManager.RegisterStartupScript(this, GetType(), &quot;18&quot;,
        //        //                                    @&quot;alert(&#39;&quot; + LocalizedContract + &quot; Closure Date can contain only Dates and must not be earlier than the Contract Start Date.&#39;);&quot;,
        //        //                                    true);
        //        //return;
        //    }

        //    if (ddlStatus.SelectedValue == &quot;-1&quot;)
        //    {
        //        ddlStatus.Focus();
        //        throw new Exception(@&quot;&quot; + LocalizedContract + &quot; Status is mandatory.&quot;);
        //        //ScriptManager.RegisterStartupScript(this, GetType(), &quot;19&quot;, @&quot;alert(&#39;&quot; + LocalizedContract + &quot; Status is mandatory.&#39;);&quot;,
        //        //                                    true);
        //        //return;
        //    }
        //    if (!chkEngEstimate.Checked &amp;&amp; ddlAwarded.SelectedValue == &quot;0&quot;)
        //    {
        //        throw new Exception(&quot;Bid is not yet awarded.&quot;);
        //        //ScriptManager.RegisterStartupScript(this, GetType(), &quot;20&quot;, @&quot;alert(&#39;Bid is not yet awarded.&#39;);&quot;, true);                
        //        //return;
        //    }
        //    if (!IsLocked &amp;&amp; rblContractTime.SelectedIndex == -1)
        //    {
        //        rblContractTime.Focus();
        //        throw new Exception(&quot;Time Type is mandatory.&quot;);
        //        //ScriptManager.RegisterStartupScript(this, GetType(), &quot;9&quot;, @&quot;alert(&#39;Time Type is mandatory.&#39;);&quot;, true);
        //        //return;
        //    }
        //}

        private void CreateItems(XmlNodeList list, DTO dtoC, Group gp, int ContractID)
        {
            var items = new List&lt;DTOItems&gt;();
            int uid = UserDetail.GetCurrentUserDetail().UID;

            //Fetch the Units
            DataTable dtUnits = BL.Instance.GetMeasSys(Session[Constants.EIS_ADDITIONAL_INFO].ToString(), dtoC.MeasSysID);

            for (int i = 0; i &lt; list.Count; i++)
            {
                var item = new DTOItems();
                item.GroupingID = UIHelper.RevertXMLCharEntities(list[i].SelectNodes(&quot;ID&quot;)[0].InnerText);
                item.Desc = UIHelper.RevertXMLCharEntities(list[i].SelectNodes(&quot;Desc&quot;)[0].InnerText);
                //item.SectionID = ((Section)SectionExists(dtoC, list[i].SelectNodes(&quot;SectionName&quot;)[0].InnerText)).ID;

                if (!ItemExists(items, ref item))
                {
                    item.CreatedBy = uid;
                    item.ContractID = ContractID;
                    item.Complete = list[i].SelectNodes(&quot;IsComplete&quot;)[0].InnerText;
                    item.ItemType = &quot;O&quot;;
                    item.LineNo = UIHelper.RevertXMLCharEntities(list[i].SelectNodes(&quot;LineNo&quot;)[0].InnerText);
                    item.NonCon = list[i].SelectNodes(&quot;IsNC&quot;)[0].InnerText;
                    item.AccountingCode = UIHelper.RevertXMLCharEntities(list[i].SelectNodes(&quot;AccCode&quot;)[0].InnerText);
                    item.Notes = UIHelper.RevertXMLCharEntities(list[i].SelectNodes(&quot;Notes&quot;)[0].InnerText);
                    item.StdItemID = UIHelper.RevertXMLCharEntities(list[i].SelectNodes(&quot;StdItemID&quot;)[0].InnerText);
                    item.UnitID =
                        dtUnits.Select(&quot;Unit=&#39;&quot; +
                                       list[i].SelectNodes(&quot;UnitID&quot;)[0].InnerText.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) +
                                       &quot;&#39;&quot;)[0][&quot;ID&quot;].ToString().ToInt32_2();
                    item.UnitPrice = list[i].SelectNodes(&quot;UnitPrice&quot;)[0].InnerText.ToDecimal2();
                    item.ID = list[i].SelectNodes(&quot;ID&quot;)[0].InnerText.ToInt32_2();
                    //item.ByDimension = BrixDatatypeHelper.ToBoolean2(list[i].SelectNodes(&quot;ByDimension&quot;)[0].InnerText);
                    //if (BrixDatatypeHelper.ToBoolean2(list[i].SelectNodes(&quot;ByDimension&quot;)[0].InnerText))
                    //    item.DimensionID = BrixDatatypeHelper.ToInt32_2(list[i].SelectNodes(&quot;DimensionID&quot;)[0].InnerText);
                    //else
                    //    item.DimensionID = 0;
                    items.Add(item);
                }

                item.Qty = (item.Qty.HasValue ? item.Qty : 0) +
                           list[i].SelectNodes(&quot;Qty&quot;)[0].InnerText.ToDecimal2();

                gp = new Group();
                gp.Name = gp.Desc = UIHelper.RevertXMLCharEntities(list[i].SelectNodes(&quot;Group/GroupName&quot;)[0].InnerText);
                gp.ID = ((Group)GroupExists(dtoC, list[i].SelectNodes(&quot;Group/GroupName&quot;)[0].InnerText)).ID;
                gp.Qty = list[i].SelectNodes(&quot;Qty&quot;)[0].InnerText.ToDecimal2();

                if (item.Groups.IndexOf(gp) &lt; 0)
                    item.Groups.Add(gp);
            }

            BL.Instance.CUDContractItems(ContractID, Operations.ImportAwardedEstimate, items);
        }

        private void CreateContractors(StringBuilder contract, DTO dtoC, XmlDocument masterDoc)
        {
            XmlNode nodePrmCnt = masterDoc.SelectSingleNode(&quot;XMLROOT/Contracts/PC&quot;);

            dtoC.PC.CID = ContmgtDTO.GenericFunctions.ToString(nodePrmCnt.SelectSingleNode(&quot;PID&quot;));
            dtoC.PC.ID = dtoC.PC.CID;
            dtoC.PC.Company = dtoC.PC.CID;
            dtoC.PC.Contact = ContmgtDTO.GenericFunctions.ToString(nodePrmCnt.SelectSingleNode(&quot;Contact&quot;));
            dtoC.PC.Address = ContmgtDTO.GenericFunctions.ToString(nodePrmCnt.SelectSingleNode(&quot;Address&quot;));
            dtoC.PC.Address2 = ContmgtDTO.GenericFunctions.ToString(nodePrmCnt.SelectSingleNode(&quot;Address1&quot;));
            dtoC.PC.Address3 = ContmgtDTO.GenericFunctions.ToString(nodePrmCnt.SelectSingleNode(&quot;Address2&quot;));
            dtoC.PC.City = ContmgtDTO.GenericFunctions.ToString(nodePrmCnt.SelectSingleNode(&quot;City&quot;));
            dtoC.PC.State = ContmgtDTO.GenericFunctions.ToString(nodePrmCnt.SelectSingleNode(&quot;State&quot;));
            dtoC.PC.ZipCode = ContmgtDTO.GenericFunctions.ToString(nodePrmCnt.SelectSingleNode(&quot;Zip&quot;));
            dtoC.PC.Phone = ContmgtDTO.GenericFunctions.ToString(nodePrmCnt.SelectSingleNode(&quot;Phone&quot;));
            dtoC.PC.Fax = ContmgtDTO.GenericFunctions.ToString(nodePrmCnt.SelectSingleNode(&quot;Fax&quot;));
            dtoC.PC.Email = ContmgtDTO.GenericFunctions.ToString(nodePrmCnt.SelectSingleNode(&quot;Email&quot;));

            BL.Instance.CUDContractContractors(dtoC);
        }

        private bool ItemExists(List&lt;DTOItems&gt; items, ref DTOItems item)
        {
            for (int i = 0; i &lt; items.Count; i++)
            {
                if (string.Equals(items[i].Desc.Trim(), item.Desc.Trim(), StringComparison.OrdinalIgnoreCase)
                    //&amp;&amp; items[i].SectionID == item.SectionID 
                    &amp;&amp; items[i].GroupingID == item.GroupingID)
                {
                    item = items[i];
                    return true;
                }
            }
            return false;
        }

        private object GroupExists(DTO dto, string item)
        {
            for (int i = 0; i &lt; dto.Groups.Count; i++)
            {
                if (string.Equals(dto.Groups[i].Name.Trim(), item.Trim(), StringComparison.OrdinalIgnoreCase))
                    return dto.Groups[i];
            }
            return null;
        }

        #endregion

        #region &quot;Attributes&quot;

        private void PopulateAttributes()
        {
            DataTable dtAttribs = BL.Instance.GetAttributes();

            /*if (ViewState[viewState] != null)
            {
                Aurigo.AMP3.ContmgtDTO.DTO dto = ViewState[viewState] as Aurigo.AMP3.ContmgtDTO.DTO;
                for (int i = 0; i &lt; dto.Attributes.Count; i++)
                {
                    foreach (DataRow dr in dtAttribs.Select(&quot;Name=&#39;&quot; + dto.Attributes[i].Name + &quot;&#39;&quot;))
                    {
                        dr[&quot;ID&quot;] = dto.Attributes[i].ID;
                    }
                }
            }*/

            ViewState[viewStateAttList] = dtAttribs;

            ddlAttributes.DataSource = ViewState[viewStateAttList];
            ddlAttributes.DataValueField = &quot;ID&quot;;
            ddlAttributes.DataTextField = &quot;Name&quot;;

            if ((ViewState[viewStateAttList] as DataTable).Rows.Count &gt; 0)
            {
                lblNoAtt.Visible = false;
                //tdAttName.Visible = true;
                ddlAttributes.Visible = true;
            }
            else
            {
                lblNoAtt.Visible = true;
                ddlAttributes.Visible = false;
                //tdAttName.Visible = false;
            }
            ddlAttributes.DataBind();
            ddlAttributes.Items.Insert(0, new ListItem(&quot;Select an Attribute&quot;, &quot;-1&quot;));

            libCatGrid.Columns.Clear();
            libCatGrid.DisplayLayout.NoDataMessage = &quot;No Data To Display&quot;;
            btnLibCatSave.Visible = false;
            btnHideGrid.Visible = false;
            libCatGrid.Visible = false;
            lblCatName.Visible = false;
        }

        protected void ddlAttributes_SelectedIndexChanged(object sender, EventArgs e)
        {
            string selValue = ddlAttributes.SelectedValue;
            txtAttrValue.Text = &quot;&quot;;

            if (hdnLibID.Value != selValue)
                hdnLibID.Value = selValue;

            var dt = ViewState[viewStateAttList] as DataTable;
            if (selValue == &quot;-1&quot; || dt == null || dt.Select(&quot;ID=&quot; + selValue).Length != 1)
            {
                libCatGrid.Columns.Clear();
                libCatGrid.DisplayLayout.NoDataMessage = &quot;No Data To Display&quot;;
                btnLibCatSave.Visible = false;
                btnHideGrid.Visible = false;
                libCatGrid.Visible = false;
                lblCatName.Visible = false;
                tdAttValue.Style.Add(&quot;display&quot;, &quot;none&quot;);
            }
            else
            {
                if (String.IsNullOrEmpty(dt.Select(&quot;ID=&quot; + selValue)[0][&quot;CatalogName&quot;].ToString()))
                {
                    libCatGrid.Columns.Clear();
                    libCatGrid.DisplayLayout.NoDataMessage = &quot;No Data To Display&quot;;
                    btnLibCatSave.Visible = false;
                    btnHideGrid.Visible = false;
                    libCatGrid.Visible = false;
                    lblCatName.Visible = false;
                    if (Request[&quot;Mode&quot;] != &quot;View&quot;)
                        tdAttValue.Style.Add(&quot;display&quot;, &quot;table&quot;);

                    //ScriptManager.RegisterStartupScript(updPnlFormValidate, typeof (Page), &quot;ADD_FORM&quot;,
                    //                                    &quot;AttachEventHandlerToControl(&#39;&quot; + btnAddAttributes.ClientID +
                    //                                    &quot;&#39;, &#39;Button&#39;);&quot;, true);
                }
                else
                {
                    tdAttValue.Style.Add(&quot;display&quot;, &quot;none&quot;);
                    libCatGrid.Visible = true;
                    lblCatName.Visible = true;
                    libCatGrid.Clear();

                    btnHideGrid.Visible = true;

                    string catalogName = dt.Select(&quot;ID=&quot; + selValue)[0][&quot;CatalogName&quot;].ToString();

                    DataTable cat = QueryInterface.Instance.GetLibraryDataSet(
                        new LibCatalogs(catalogName)
                        ).Tables[catalogName];

                    if (cat.Rows.Count &gt; 0)
                    {
                        btnLibCatSave.Visible = true;
                        libCatGrid.DataSource = cat;
                        libCatGrid.DataBind();
                        libCatGrid.Columns.FromKey(&quot;RecordID&quot;).Hidden = true;

                        if (Request[&quot;Mode&quot;] == &quot;View&quot;)
                            libCatGrid.Columns[0].Hidden = true;
                        else
                            libCatGrid.Columns.FromKey(&quot;To&quot;).AllowUpdate = AllowUpdate.Yes;

                        foreach (UltraGridColumn col in libCatGrid.Columns)
                        {
                            col.HTMLEncodeContent = true;
                        }

                    }
                    else
                    {
                        libCatGrid.DisplayLayout.NoDataMessage = &quot;No Data To Display&quot;;
                        btnLibCatSave.Visible = false;
                    }
                }
            }
            ShowAttributesTable();
        }

        protected void btnLibCatSave_Click(object sender, EventArgs e)
        {
            if (Request[&quot;Mode&quot;] == &quot;View&quot;)
                return;

            DTO dto;
            if ((dto = ViewState[viewState] as DTO) == null)
                dto = new DTO();

            int i = 0;

            for (; i &lt; dto.Attributes.Count; i++)
            {
                if (dto.Attributes[i].ID == hdnLibID.Value &amp;&amp; dto.Attributes[i].Type == &quot;LibraryCatalog&quot;)
                    break;
            }

            Attribute attrib;

            attrib.ID = ddlAttributes.SelectedValue;
            attrib.Name = ddlAttributes.SelectedItem.Text;
            attrib.Type = (ViewState[viewStateAttList] as DataTable).Select(&quot;ID=&quot; + attrib.ID)[0][&quot;Type&quot;].ToString();

            attrib.Values = new List&lt;string&gt;();

            for (int n = 0; n &lt; libCatGrid.Rows.Count; n++)
            {
                if (bool.Parse(libCatGrid.Rows[n].Cells.FromKey(&quot;To&quot;).Value.ToString()))
                    attrib.Values.Add(libCatGrid.Rows[n].Cells.FromKey(&quot;RecordID&quot;).Value.ToString());
            }

            btnLibCatSave.Visible = false;
            btnHideGrid.Visible = false;
            libCatGrid.Visible = false;
            lblCatName.Visible = false;

            if (i != dto.Attributes.Count &amp;&amp; dto.Attributes.Count &gt; 0)
                dto.Attributes[i] = attrib;
            else
                dto.Attributes.Add(attrib);

            ViewState[viewState] = dto;
            ddlAttributes.SelectedIndex = 0;
            ShowAttributesTable();

            hdnLibID.Value = &quot;-1&quot;;
        }

        protected void libCatGrid_InitializeRow(object sender, RowEventArgs e)
        {
            var dto = ViewState[viewState] as DTO;

            if (dto == null)
                return;

            for (int i = 0; i &lt; dto.Attributes.Count; i++)
            {
                if (dto.Attributes[i].Type == &quot;LibraryCatalog&quot; &amp;&amp; dto.Attributes[i].ID == ddlAttributes.SelectedValue)
                {
                    if (Request[&quot;Mode&quot;] != &quot;View&quot;)
                    {
                        if (dto.Attributes[i].Values.Contains(e.Row.Cells.FromKey(&quot;RecordID&quot;).Value.ToString()))
                            e.Row.Cells.FromKey(&quot;To&quot;).Value = true;
                    }
                    else
                    {
                        if (!dto.Attributes[i].Values.Contains(e.Row.Cells.FromKey(&quot;RecordID&quot;).Value.ToString()))
                            e.Row.Hidden = true;
                    }
                }
            }
        }

        protected void btnAddAttributes_ServerClick(object sender, EventArgs e)
        {
            if (Request[&quot;Mode&quot;] == &quot;View&quot;)
                return;

            DTO dto;
            if ((dto = ViewState[viewState] as DTO) == null)
                dto = new DTO();

            var attrib = new Attribute();
            attrib.ID = ddlAttributes.SelectedValue;
            attrib.Name = ddlAttributes.SelectedItem.Text;
            attrib.Type = (ViewState[viewStateAttList] as DataTable).Select(&quot;ID=&quot; + attrib.ID)[0][&quot;Type&quot;].ToString();

            try
            {
                switch (attrib.Type.ToUpper2())
                {
                    case &quot;INTEGER&quot;:
                        txtAttrValue.Text.ToInt32_2();
                        break;
                    case &quot;FLOAT&quot;:
                        txtAttrValue.Text.ToDouble2();
                        break;
                    case &quot;DATE&quot;:
                        txtAttrValue.Text.ToMWDateTime();
                        break;
                    case &quot;TEXT&quot;:
                        break;
                    case &quot;CURRENCY&quot;:
                        txtAttrValue.Text = txtAttrValue.Text.ToDouble2().ToString(&quot;###,###,##0.0000&quot;,
                                                                                   CultureInfo.InvariantCulture);
                        ;
                        break;
                    default:
                        attrib.Type = &quot;Unknown&quot;;
                        break;
                }
            }
            catch
            {
                txtAttrValue.Focus();
                string message =
                    (&quot;ShowError(&#39;Please enter a valid &quot; + attrib.Type + &quot; {0}&#39;);&quot;).Format2(attrib.Type.ToUpper2() == &quot;DATE&quot;
                                                                                           ? &quot;Format &quot;
                                                                                           : &quot;Value&quot;);
                ScriptManager.RegisterStartupScript(this, GetType(), &quot;21&quot;, message, true);
                return;
            }

            attrib.Values = new List&lt;string&gt;();

            attrib.Values.Add(txtAttrValue.Text);

            divAttributeTable.Visible = true;

            dto.Attributes.Add(attrib);

            ViewState[viewState] = dto;
            ddlAttributes.SelectedIndex = 0;
            tdAttValue.Style.Add(&quot;display&quot;, &quot;none&quot;);
            ShowAttributesTable();

            hdnLibID.Value = &quot;-1&quot;;
        }

        protected void delGhost_Click(object sender, EventArgs e)
        {
            if (Request[&quot;Mode&quot;] == &quot;View&quot;)
                return;

            DTO dto;

            if ((dto = ViewState[viewState] as DTO) == null)
                return;

            int i = 0;

            for (; i &lt; dto.Attributes.Count; i++)
            {
                if (dto.Attributes[i].ID == hdnDelID.Value)
                    break;
            }

            if (i == dto.Attributes.Count)
                return;

            dto.Attributes.RemoveAt(i);

            ViewState[viewState] = dto;

            libCatGrid.Columns.Clear();
            libCatGrid.DisplayLayout.NoDataMessage = &quot;No Data To Display&quot;;
            btnLibCatSave.Visible = false;
            btnHideGrid.Visible = false;
            libCatGrid.Visible = false;
            lblCatName.Visible = false;
            tdAttValue.Style.Add(&quot;display&quot;, &quot;none&quot;);

            ShowAttributesTable();
            hdnLibID.Value = &quot;-1&quot;;
        }

        protected void btnEditGhost_Click(object sender, EventArgs e)
        {
            /*if (Request[&quot;Mode&quot;] == &quot;View&quot;)
                return;*/

            //btnLibCatSave_Click(sender, e);
            ddlAttributes.SelectedValue = hdnLibID.Value;
            ddlAttributes_SelectedIndexChanged(sender, e);
        }

        protected void btnSEditGhost_Click(object sender, EventArgs e)
        {
            if (Request[&quot;Mode&quot;] == &quot;View&quot;)
                return;

            ddlAttributes.SelectedValue = hdnLibID.Value;
            var dto = ViewState[viewState] as DTO;

            int i = 0;

            for (; i &lt; dto.Attributes.Count; i++)
            {
                if (dto.Attributes[i].ID == hdnLibID.Value)
                    break;
            }
            if (i == dto.Attributes.Count)
                return;

            Attribute attrib = dto.Attributes[i];
            attrib.Values.Clear();
            //attrib.Values.Add(Request.Form[&quot;ctl00$C1$tcell&quot; + attrib.ID]);
            attrib.Values.Add(hdnAttributeValue.Value);

            ViewState[viewState] = dto;
            ShowAttributesTable();
            hdnLibID.Value = &quot;-1&quot;;
            //        ScriptManager.RegisterStartupScript(updPnlFormValidate, typeof(Page),
            //&quot;ADD_FORM&quot;, &quot;__hdnObjID.value = false;document.getElementById(&#39;&quot; + __hdnFormValidate.ClientID + &quot;&#39;).value = false;&quot;, true);
        }

        private void ShowAttributesTable()
        {
            DTO dto;
            if ((dto = ViewState[viewState] as DTO) == null)
            {
                divAttributeTable.Style.Value = &quot;display:none&quot;;
                return;
            }

            tblProjectAttributes.Rows.Clear();
            if (dto.Attributes.Count &gt; 0)
            {
                HtmlTableRow tr;
                HtmlTableCell td;

                //creating headers
                tr = new HtmlTableRow();

                td = new HtmlTableCell();
                td.InnerText = &quot;Attribute&quot;;
                tr.Cells.Add(td);

                td = new HtmlTableCell();
                td.InnerText = &quot;Value&quot;;
                td.ColSpan = 3;
                tr.Cells.Add(td);

                tblProjectAttributes.Rows.Add(tr);

                foreach (Attribute attr in dto.Attributes)
                {
                    string atId = attr.ID;
                    string atype = attr.Type;

                    tr = new HtmlTableRow();
                    //attributeName

                    tr.ID = atId;

                    td = new HtmlTableCell();
                    td.InnerText = attr.Name;
                    tr.Cells.Add(td);


                    //attributeValue

                    td = new HtmlTableCell();
                    if (attr.Type == &quot;LibraryCatalog&quot;)
                    {
                        td.InnerHtml = &quot;&lt;a class=\&quot;loginLinks\&quot; href=\&quot;javascript:LibEdit(&#39;&quot; + atId + &quot;&#39;);\&quot;&gt;&quot; +
                                       attr.Name + &quot;&lt;/a&gt;&quot;;

                        tr.Cells.Add(td);

                        if (Request[&quot;Mode&quot;] != &quot;View&quot;)
                        {
                            var td1 = new HtmlTableCell();

                            td1.InnerHtml = &quot;&lt;a class=\&quot;loginLinks\&quot; href=\&quot;javascript:LibEdit(&#39;&quot; + atId +
                                            &quot;&#39;);\&quot;&gt;Edit&lt;/a&gt;&quot;;
                            tr.Cells.Add(td1);
                        }
                    }
                    else
                    {
                        var inputText = new HtmlInputText();
                        if (Request[&quot;Mode&quot;] != &quot;View&quot;)
                        {
                            inputText.Value = attr.Values[0];
                            inputText.Disabled = true;
                            inputText.ID = &quot;tcell&quot; + atId;
                            inputText.Attributes.Add(&quot;onblur&quot;,
                                                     &quot;javascript:ValidateValue(this,&#39;&quot; + atype + &quot;&#39;,&#39;&quot; + atId + &quot;&#39;);&quot;);
                            inputText.Attributes.Add(&quot;class&quot;, &quot;tbC&quot;);
                            inputText.Size = 40;
                            td.Controls.Add(inputText);
                        }
                        else
                        {
                            var gc = new HtmlGenericControl(&quot;div&quot;);
                            gc.InnerHtml = attr.Values[0];
                            td.Controls.Add(gc);
                        }
                        tr.Cells.Add(td);

                        //Edit link
                        if (atype.ToLower2() != &quot;librarycatalog&quot;)
                        {
                            if (Request[&quot;Mode&quot;] != &quot;View&quot;)
                            {
                                td = new HtmlTableCell();
                                td.InnerHtml = &quot;&amp;nbsp;&quot;;

                                td.InnerHtml = &quot;&lt;a class=\&quot;loginLinks\&quot; href=\&quot;javascript:editSAtt(&#39;&quot; +
                                               inputText.ClientID + &quot;&#39;);\&quot;&gt;Edit&lt;/a&gt;&quot;;

                                tr.Cells.Add(td);
                            }
                        }
                    }
                    //Delete link
                    if (Request[&quot;Mode&quot;] != &quot;View&quot;)
                    {
                        td = new HtmlTableCell();

                        td.InnerHtml = &quot;&lt;a class=\&quot;loginLinks\&quot; href=\&quot;#\&quot; onclick=\&quot;return deleteSAtt(&#39;&quot; + attr.ID +
                                       &quot;&#39;);\&quot;&gt;Delete&lt;/a&gt;&quot;;
                        tr.Cells.Add(td);

                        td = new HtmlTableCell();
                        td.InnerText = attr.ID;
                        td.Style.Value = &quot;display:None&quot;;
                        tr.Cells.Add(td);
                    }
                    tblProjectAttributes.Rows.Add(tr);
                }
                divAttributeTable.Style.Value = &quot;overflow: auto; height: 150px;&quot;;
            }
            else
            {
                divAttributeTable.Style.Value = &quot;display:none&quot;;
            }
        }

        #endregion

        #region &quot;Modules&quot;

        private void PopulateModulesGrid()
        {
            dt = new BrixDataTable();

            dt.Columns.Add(&quot;ModuleID&quot;);
            dt.Columns.Add(&quot;Module Name&quot;);

            string xmlstr = ModuleManager.Instance.GetModulePlatforms(&quot;CONTMGT&quot;);
            var xDoc = new XmlDocument();
            xDoc.LoadXml(xmlstr);

            foreach (XmlNode xModule in xDoc.SelectNodes(&quot;modules/module&quot;))
            {
                foreach (XmlNode xPlatform in xModule.ChildNodes)
                {
                    string platform = xPlatform.InnerText;
                    if (dt.Columns.IndexOf(platform) == -1)
                    {
                        var colAvlbl = new DataColumn(platform);
                        colAvlbl.DataType = typeof(bool);
                        colAvlbl.DefaultValue = null;
                        dt.Columns.Add(colAvlbl);
                    }
                }
            }

            //if (temp == null)
            //{
            int present = 0;

            foreach (XmlNode xModule in xDoc.SelectNodes(&quot;modules/module&quot;))
            {
                var values = new object[dt.Columns.Count];

                values[0] = xModule.Attributes[&quot;key&quot;].Value;
                values[1] = LocalizationManager.GetString(xModule.Attributes[&quot;name&quot;].Value);

                foreach (XmlNode xPlatform in xModule.ChildNodes)
                {
                    string platform = xPlatform.InnerText;
                    int index = dt.Columns.IndexOf(platform);
                    //edit
                    if (ViewState[viewState] != null)
                    {
                        if (platform == &quot;Web&quot;)
                            values[index] = true;
                        else
                        {
                            foreach (Module mod in (ViewState[viewState] as DTO).Modules)
                            {
                                if (mod.ModID == values[0].ToString())
                                {
                                    if (mod.Key == xPlatform.Attributes[&quot;key&quot;].Value)
                                    {
                                        values[index] = true;
                                        present = 1;
                                    }
                                }
                            }

                            if (present == 0)
                                values[index] = false;
                            else
                                present = 0;
                        }
                    }
                    else
                    {
                        if (platform == &quot;Web&quot;)
                            values[index] = true;
                        else
                            values[index] = false;
                    }
                }
                dt.Rows.Add(values);
            }
            //}
            //else
            //{
            //    dt.Rows.Clear();

            //    List&lt;Platform&gt; iModuleList = temp.TemplateModules;
            //    Dictionary&lt;string, string&gt; moduleList = BL.Instance.GetModuleList();

            //    if (iModuleList != null &amp;&amp; iModuleList.Count &gt; 0)
            //    {
            //        Dictionary&lt;string, string&gt; platformList =
            //            (ViewState[viewStatePlatform] = BL.Instance.GetPlatformList()) as Dictionary&lt;string, string&gt;;

            //        int added = 0;
            //        foreach (KeyValuePair&lt;string, string&gt; iaKey in moduleList)
            //        {
            //            object[] values = new object[dt.Columns.Count];

            //            if (iModuleList.Count &gt; 0)
            //            {
            //                foreach (Platform imPlt in iModuleList)
            //                {
            //                    if (imPlt.ModuleId == iaKey.Key)
            //                    {
            //                        values[0] = iaKey.Key.ToString();
            //                        values[1] = iaKey.Value.ToString();
            //                        string Platformname;
            //                        platformList.TryGetValue(imPlt.PlatformKey, out Platformname);
            //                        int index = dt.Columns.IndexOf(Platformname);
            //                        if (index != -1)
            //                        {
            //                            values[index] = true;
            //                            added = 1;
            //                        }
            //                    }
            //                }
            //            }
            //            if (added == 1)
            //            {
            //                dt.Rows.Add(values);
            //                added = 0;
            //            }
            //        }
            //    }
            //}

            // new code for telerik RadGrid
            gridModulePlatforms.DataSource = dt;
            gridModulePlatforms.DataBind();
            gridModulePlatforms.MasterTableView.GetColumnSafe(&quot;ModuleId&quot;).Visible = false;

            if (Request[&quot;Mode&quot;] == &quot;View&quot;)
            {
                gridModulePlatforms.MasterTableView.GetColumnSafe(&quot;SelectModules&quot;).Visible = false;
            }
        }

        #endregion

        #region &quot;Sections and Groups&quot;

        protected void btnSaveGrp_Click(object sender, EventArgs e)
        {
            string schdGrp = GlobalizationUtility.SetResource(&quot;Group&quot;, false);
            if (String.IsNullOrEmpty(txtGroupName.Text.Trim()))
            {
                //throw new Exception(&quot;Please enter the &quot; + schdGrp + &quot; Name.&quot;);
                ScriptManager.RegisterStartupScript(this, GetType(), &quot;22&quot;,
                                                    &quot;ShowError(&#39;Please enter the &quot; + schdGrp + &quot; Name.&#39;);&quot;, true);
                return;
            }
            if (String.IsNullOrEmpty(txtGroupDescription.Text.Trim()))
            {
                //throw new Exception(&quot;Please enter the Description.&quot;);
                ScriptManager.RegisterStartupScript(this, GetType(), &quot;23&quot;, &quot;ShowError(&#39;Please enter the Description.&#39;);&quot;,
                                                    true);
                return;
            }
            // Checking if the user has permission to provide discount
            var list = (List&lt;string&gt;)Context.Items[Constants.MODULE_PERMISSIONS];

            //if (wneDiscount.ValueDecimal &gt; 0 &amp;&amp; !list.Contains(&quot;Discount&quot;))
            //{
            //    //throw new Exception(&quot;Cannot provide discount. You do not have the required permission.&quot;);
            //    ScriptManager.RegisterStartupScript(this, this.GetType(), &quot;23&quot;, &quot;alert(&#39;Cannot provide discount. You do not have the required permission.&#39;);&quot;, true);
            //    return;
            //}
            // End of Checking if the user has permission to provide discount

            UltraGridRow row;
            if (hdnSave.Value == &quot;-999&quot;)
            {
                if (validateDupGroup(-1))
                {
                    row = new UltraGridRow(new object[]
                                               {
                                                   txtGroupName.Text.Trim(), txtGroupDescription.Text.Trim(),
                                                   //(string.IsNullOrEmpty(wneOTPPercentage.Text)) ? null : wneOTPPercentage.Value,
                                                   //(string.IsNullOrEmpty(wneDiscount.Text)) ? null : wneDiscount.Value, 
                                                   uwgGroupDetails.Rows.Count*-1
                                               });
                    uwgGroupDetails.Rows.Add(row);
                }
            }
            else if (!String.IsNullOrEmpty(hdnSave.Value) &amp;&amp;
                     (row = uwgGroupDetails.Rows[hdnSave.Value.ToInt32_2()]) != null
                     &amp;&amp; uwgGroupDetails.Rows.Count &gt;= hdnSave.Value.ToInt32_2())
            {
                if (validateDupGroup(hdnSave.Value.ToInt32_2()))
                {
                    row.Cells[0].Value = txtGroupName.Text.Trim();
                    row.Cells[1].Value = txtGroupDescription.Text.Trim();
                    //row.Cells[2].Value = (string.IsNullOrEmpty(wneOTPPercentage.Text)) ? null : wneOTPPercentage.Value;
                    //row.Cells[3].Value = (string.IsNullOrEmpty(wneDiscount.Text)) ? null : wneDiscount.Value;
                }
            }
        }

        protected bool validateDupGroup(int ignoreIdx)
        {
            string schdGrp = GlobalizationUtility.SetResource(&quot;Group&quot;, false);
            for (int i = 0; i &lt; uwgGroupDetails.Rows.Count; i++)
            {
                if (i == ignoreIdx) continue;
                if (
                    txtGroupName.Text.Trim().Equals(uwgGroupDetails.Rows[i].Cells[0].Value.ToString(),
                                                    StringComparison.OrdinalIgnoreCase))
                {
                    txtGroupName.Focus();
                    {
                        //throw new Exception(&quot;A &quot; + schdGrp + &quot; with the same Name already exists.&quot;);
                        ScriptManager.RegisterStartupScript(this, GetType(), &quot;24&quot;,
                                                            &quot;ShowError(&#39;A &quot; + schdGrp +
                                                            &quot; with the same Name already exists.&#39;,&#39;Error&#39;);&quot;, true);
                        return false;
                    }
                }
            }
            return true;
        }

        protected void btnRemoveGrp_Click(object sender, EventArgs e)
        {
            UltraGridRow row;
            if (String.IsNullOrEmpty(hdnSave.Value) || uwgGroupDetails.Rows.Count &lt; hdnSave.Value.ToInt32_2() ||
                (row = uwgGroupDetails.Rows[hdnSave.Value.ToInt32_2()]) == null)
                return;
            int returnValue = BL.Instance.GetGroupInfo(Request.QueryString[&quot;ContractID&quot;].ToInt32_2(), &quot;CONTMGT&quot;, &quot;&quot;, &quot;&quot;,
                                                       0, 0, row.Cells.FromKey(&quot;RowID&quot;).Value.ToInt32_2(), &quot;D&quot;,
                                                       String.Empty);
            if (returnValue == -2)
                return;

            row.Delete();
        }

        protected void btnSecSave_Click(object sender, EventArgs e)
        {
        }

        protected void btnRemoveSec_Click(object sender, EventArgs e)
        {
        }

        #endregion

        #region Tab Related Code. Do Not MODIFY

        private List&lt;TabData&gt; GetPageData()
        {
            var lst = new List&lt;TabData&gt;();
            string code = txtContractCode == null ? &quot;&quot; : txtContractCode.Text;
            string name = txtContractName == null ? &quot;&quot; : txtContractName.Text;
            string isLock = &quot;&quot;, currency = &quot;&quot;;
            DTO dto = null;
            bool itemsCreated = false;
            string isNEWContract = string.IsNullOrEmpty(Request[&quot;ContractID&quot;]) ? &quot;&quot; : Request[&quot;ContractID&quot;];
            if (!string.IsNullOrEmpty(isNEWContract))
            {
                dto = BL.Instance.GetContract(Request[&quot;ContractID&quot;].ToInt32_2(), FetchSet.All);
                currency = LocalizationManager.GetModuleCurrency(&quot;CONTMGT&quot;, Request[&quot;ContractID&quot;],
                                                                 Convert.ToString(Session[Constants.EIS_ADDITIONAL_INFO]));

                DataSet ds = ItemManager.Instance.GetItemPickerData(&quot;CONTMGT&quot;, isNEWContract.ToInt32_2(), null, null);
                if (ds.Tables.Count &gt; 0 &amp;&amp; ds.Tables[1].Rows.Count &gt; 0)
                    itemsCreated = true;
                else
                    itemsCreated = false;
            }
            if (dto != null)
                isLock = dto.Locked;
            lst.Add(new TabData(SubProject.MandatoryFields.Code, code));
            lst.Add(new TabData(SubProject.MandatoryFields.Name, name));
            lst.Add(new TabData(&quot;ContractLocked&quot;, isLock));
            lst.Add(new TabData(&quot;IsNewContract&quot;, isNEWContract));
            lst.Add(new TabData(&quot;ContractItems&quot;, itemsCreated));
            lst.Add(new TabData(&quot;ContractCurrency&quot;, currency));
            return lst;
        }

        #endregion

        #region &quot;Import Awarded Items&quot;

        protected void rbVersion_Changed(object sender, EventArgs e)
        {
            ClearDropDowns();
        }

        protected void rbEstimate_Changed(object sender, EventArgs e)
        {
            ClearDropDowns();
        }

        protected void chkEngEstimate_CheckedChanged(object sender, EventArgs e)
        {
            ddlAwarded.Enabled = chkEngEstimate.Checked ? false : true;
        }

        private void ClearDropDowns()
        {
            ddlAwarded.Items.Clear();
            ddlAwarded.Items.Insert(0, new ListItem(&quot;Select One&quot;, &quot;0&quot;));

            ddlversion.Items.Clear();
            ddlversion.Items.Insert(0, new ListItem(&quot;Select One&quot;, &quot;0&quot;));
        }

        protected void ddlEstimate_SelectedIndexChanged(object sender, EventArgs e)
        {
            if (rbEstimate.Checked)
                PopulateEstimateBidders(ddlEstimate.SelectedValue.ToInt32_2());
            else
                PopulateVersions(ddlEstimate.SelectedValue.ToInt32_2());
        }

        protected void ddlversion_SelectedIndexChanged(object sender, EventArgs e)
        {
            PopulateEstimateBidders(ddlversion.SelectedValue.ToInt32_2());
        }

        private void PopulateVersions(int projectEstimateID)
        {
            ddlversion.Items.Clear();

            DataTable dt = BL.Instance.GetVersions(projectEstimateID);

            if (dt != null &amp;&amp; dt.Rows.Count &gt; 0)
            {
                ddlversion.DataSource = dt;
                ddlversion.DataTextField = &quot;EstimateName&quot;;
                ddlversion.DataValueField = &quot;ProjectEstimateID&quot;;
                ddlversion.DataBind();
            }

            ddlversion.Items.Insert(0, new ListItem(&quot;Select One&quot;, &quot;0&quot;));
        }


        private static readonly object _oSync = new object();

        protected void btnImpAwdItems_Click(object sender, EventArgs e)
        {
            lock (_oSync)
            {
                try
                {
                    //CheckContract();
                    if (ValidateContract())
                    {
                        bool isEditMode = false;
                        string contractCurrency = &quot;&quot;, estimateCurrency = &quot;&quot;;

                        //Check for Contract edit mode . 
                        if (!String.IsNullOrEmpty(Request[&quot;Mode&quot;]) &amp;&amp; Request[&quot;Mode&quot;] == &quot;Edit&quot;)
                            isEditMode = true;

                        //Contract and Estimate Currency
                        int estimateID = rbEstimate.Checked
                                             ? ddlEstimate.SelectedValue.ToInt32_2()
                                             : ddlversion.SelectedValue.ToInt32_2();
                        estimateCurrency = LocalizationManager.GetModuleCurrency(&quot;ESTMATE&quot;, estimateID.ToString2(),
                                                                                 Session[Constants.EIS_ADDITIONAL_INFO].
                                                                                     ToString2());
                        if (isEditMode)
                            contractCurrency = LocalizationManager.GetModuleCurrency(&quot;CONTMGT&quot;, Request[&quot;ContractID&quot;],
                                                                                     Session[Constants.EIS_ADDITIONAL_INFO].
                                                                                         ToString2());
                        else
                            contractCurrency = estimateCurrency;

                        //Check for ERP currency from ERP mapping
                        var objTabMaster = base.Master as BrixTabMasterPage;
                        objTabMaster.PreSaveCheck();
                        if (objTabMaster.ERPTabPageData != null &amp;&amp; objTabMaster.ERPTabPageData.Count &gt; 0)
                            contractCurrency = objTabMaster.ERPTabPageData[1].Value.ToString2();

                        if (contractCurrency.Equals(estimateCurrency))
                        {
                            Assembly asseblyInfo =
                                Assembly.LoadFrom(HttpRuntime.BinDirectory +
                                                  &quot;/Aurigo.Brix.Construction.Estimator.BusinessLayer.dll&quot;);
                            foreach (Type tt in asseblyInfo.GetTypes())
                            {
                                if (tt.GetMethod(&quot;ExportToContract&quot;) != null)
                                {
                                    var stridItems = new string[2];

                                    try
                                    {
                                        stridItems =
                                            (string[])tt.GetMethod(&quot;ExportToContract&quot;).Invoke(Activator.CreateInstance(tt),
                                                                                               new object[]
                                                                                           {
                                                                                               ddlAwarded.SelectedValue.
                                                                                                   ToInt32_2(),
                                                                                               rbEstimate.Checked
                                                                                                   ? ddlEstimate.
                                                                                                         SelectedValue.
                                                                                                         ToInt32_2()
                                                                                                   : ddlversion.
                                                                                                         SelectedValue.
                                                                                                         ToInt32_2(),
                                                                                               Request[
                                                                                                   Constants.
                                                                                                       QRY_PROJECTID].
                                                                                                   ToInt32_2()
                                                                                           });
                                    }
                                    catch (Exception ex)
                                    {
                                        if (ex.Message == &quot;Bid is not yet awarded.&quot;)
                                            ScriptManager.RegisterStartupScript(this, GetType(), &quot;1&quot;,
                                                                                &quot;ShowError(&#39;&quot; + ex.Message + &quot;&#39;);&quot;, true);
                                        else
                                            ScriptManager.RegisterStartupScript(this, GetType(), &quot;2&quot;,
                                                                                &quot;ShowError(&#39;Cannot import awarded &quot; + UIHelper.JavascriptEncode(ItemsName)
                                                                                +
                                                                                &quot;.\n Please check whether the estimate bid(s) have been awarded.&#39;);&quot;,
                                                                                true);

                                        return;
                                    }

                                    var contract = new StringBuilder(stridItems[0]);

                                    var xml = new StringBuilder();

                                    if (!String.IsNullOrEmpty(Request[&quot;Mode&quot;]) &amp;&amp; Request[&quot;Mode&quot;] == &quot;Edit&quot;)
                                        xml.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;IDs&gt;&lt;ID value=\&quot;{0}\&quot;&gt;&lt;/ID&gt;&lt;/IDs&gt;\n&quot;,
                                                         Request[&quot;ContractID&quot;]);

                                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;OPN&gt;{0}&lt;/OPN&gt;&quot;,
                                                     Request[&quot;Mode&quot;] == &quot;Edit&quot; ? &quot;U&quot; : &quot;C&quot;);
                                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;EPSModeMultiple&gt;{0}&lt;/EPSModeMultiple&gt;&quot;,
                                                     WebConfigurationManager.AppSettings[&quot;EPSModeMultiple&quot;]);
                                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;CreatedBy&gt;{0}&lt;/CreatedBy&gt;\n&quot;,
                                                     UserDetail.GetCurrentUserDetail().UID);
                                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;CreatedOn&gt;{0}&lt;/CreatedOn&gt;\n&quot;,
                                                     &quot;{0:MM-dd-yyyy}&quot;.Format2(wdcDateCreated.Value.ToUtc()));
                                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;Name&gt;{0}&lt;/Name&gt;\n&quot;,
                                                     UIHelper.ReplaceXMLCharEntities(txtContractName.Text));
                                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;Code&gt;{0}&lt;/Code&gt;\n&quot;,
                                                     UIHelper.ReplaceXMLCharEntities(txtContractCode.Text));
                                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;StartDt&gt;{0}&lt;/StartDt&gt;\n&quot;, &quot;{0:MM-dd-yyyy}&quot;.Format2(dtStartDate.Value));
                                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;StatusID&gt;{0}&lt;/StatusID&gt;\n&quot;,
                                                     UIHelper.ReplaceXMLCharEntities(ddlStatus.SelectedValue));
                                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;GroupType&gt;{0}&lt;/GroupType&gt;\n&quot;,
                                                     ddlGroupType.SelectedItem.Value);
                                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;EstimateID&gt;{0}&lt;/EstimateID&gt;\n&quot;,
                                                     rbEstimate.Checked ? ddlEstimate.SelectedValue : ddlversion.SelectedValue);
                                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;BidderID&gt;{0}&lt;/BidderID&gt;\n&quot;,
                                                     (chkEngEstimate.Checked) ? &quot;0&quot; : ddlAwarded.SelectedValue);
                                    xml.Append(&quot;&lt;Locked&gt;N&lt;/Locked&gt;\n&quot;);

                                    contract.Replace(&quot;&lt;/MeasSysID&gt;&quot;, &quot;&lt;/MeasSysID&gt;&quot; + xml);

                                    if (Request[&quot;Mode&quot;] != null &amp;&amp; Request[&quot;Mode&quot;] == &quot;Edit&quot;)
                                    {
                                        xml = new StringBuilder();
                                        xml.Append(&quot;&lt;Groups&gt;\n&quot;);

                                        CellsCollection coll;

                                        for (int i = 0; i &lt; uwgGroupDetails.Rows.Count; i++)
                                        {
                                            coll = uwgGroupDetails.Rows[i].Cells;

                                            xml.AppendFormat(CultureInfo.CurrentCulture,
                                                             &quot;&lt;Group&gt;\n&lt;Name&gt;{0}&lt;/Name&gt;\n&lt;Desc&gt;{1}&lt;/Desc&gt;\n&lt;OTPPercentage&gt;{2}&lt;/OTPPercentage&gt;\n&lt;Discount&gt;{3}&lt;/Discount&gt;\n&lt;ID&gt;{4}&lt;/ID&gt;&lt;/Group&gt;&quot;,
                                                             UIHelper.ReplaceXMLCharEntities(coll.FromKey(&quot;GroupName&quot;).Text).
                                                                 Trim(),
                                                             UIHelper.ReplaceXMLCharEntities(coll.FromKey(&quot;GroupDesc&quot;).Text).
                                                                 Trim(),
                                                             null,
                                                             null,
                                                             coll.FromKey(&quot;RowID&quot;).Value.ToInt32_2());
                                        }

                                        xml.Append(&quot;&lt;/Groups&gt;\n&quot;);

                                        if (ViewState[viewState] != null)
                                        {
                                            Aurigo.AMP3.ContmgtDTO.DTO dto = ViewState[viewState] as Aurigo.AMP3.ContmgtDTO.DTO;
                                            xml.Append(&quot;&lt;Attributes&gt;\n&quot;);

                                            for (int i = 0; i &lt; dto.Attributes.Count; i++)
                                            {
                                                xml.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;Attribute&gt;\n&lt;ID&gt;{0}&lt;/ID&gt;\n&lt;Values&gt;\n&quot;,
                                                                 dto.Attributes[i].ID);

                                                for (int j = 0; j &lt; dto.Attributes[i].Values.Count; j++)
                                                {
                                                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;Value text=\&quot;{0}\&quot; /&gt;\n&quot;,
                                                                     UIHelper.ReplaceXMLCharEntities(dto.Attributes[i].Values[j]).Trim());
                                                }

                                                xml.Append(&quot;&lt;/Values&gt;\n&lt;/Attribute&gt;\n&quot;);
                                            }

                                            xml.Append(&quot;&lt;/Attributes&gt;\n&quot;);
                                        }

                                        contract.Replace(&quot;&lt;/MeasSysID&gt;&quot;, &quot;&lt;/MeasSysID&gt;&quot; + xml);
                                    }

                                    BL.Instance.CUDContract(contract);

                                    int newContractID =
                                        BL.Instance.GetContractByCode(Request[Constants.QRY_PROJECTID].ToInt32_2(),
                                                                      txtContractCode.Text);

                                    if (newContractID &lt;= 0)
                                    {
                                        ScriptManager.RegisterStartupScript(this, GetType(), &quot;3&quot;, &quot;ShowError(&#39;Invalid ContractID&#39;);&quot;, true);
                                        return;
                                    }
                                    DTO dtoC = BL.Instance.GetContract(newContractID, FetchSet.All);

                                    var masterDoc = new XmlDocument();
                                    masterDoc.LoadXml(contract.ToString());


                                    if (!chkEngEstimate.Checked &amp;&amp; !ddlAwarded.SelectedValue.Equals(&quot;0&quot;))
                                        //(String.IsNullOrEmpty(Request[&quot;Mode&quot;]))
                                        CreateContractors(contract, dtoC, masterDoc);

                                    dtoC.CreatedBy = UserDetail.GetCurrentUserDetail().UID;

                                    if (String.IsNullOrEmpty(Request[&quot;Mode&quot;]) ||
                                        (!String.IsNullOrEmpty(Request[&quot;Mode&quot;]) &amp;&amp; Request[&quot;Mode&quot;] == &quot;Edit&quot;))
                                        dtoC = GetCommonContractData(dtoC);

                                    BL.Instance.CUDContract(Request[Constants.QRY_PROJECTID].ToInt32_2(),
                                                            Operations.Update,
                                                            dtoC);
                                    //Update Contact Time
                                    if (String.IsNullOrEmpty(Request[&quot;Mode&quot;]) &amp;&amp; dtoC.IDs.Count == 0)
                                        dtoC.IDs.Add(newContractID);
                                    if (dtoC.Locked != &quot;Y&quot;)
                                        SaveContractTime(dtoC, newContractID);

                                    bool NewContract = !(!String.IsNullOrEmpty(Request[&quot;Mode&quot;]) &amp;&amp; Request[&quot;Mode&quot;] == &quot;Edit&quot;);
                                    //Create Contract level document folders
                                    Folder projFolder = DocumentManager.Instance.GetInstanceRootFolder(PID, &quot;PROJECT&quot;);
                                    DocumentManager.Instance.AddFolder(new Folder()
                                    {
                                        ParentId = 0,
                                        FolderName = &quot;{0}-{1}&quot;.Format2(dtoC.Name, dtoC.Code),
                                        FolderDesc = &quot;Contract Documents&quot;,
                                        ModuleId = &quot;CONTMGT&quot;,
                                        InstanceId = newContractID.ToString(),
                                        ListID = projFolder.ListID,
                                        ListPath = &quot;{0}-{1}&quot;.Format2(dtoC.Name, dtoC.Code),
                                        ParentModuleId = &quot;PROJECT&quot;,
                                        ParentInstanceId = PID
                                    });
                                    Folder ContractFolder = DocumentManager.Instance.GetInstanceRootFolder(newContractID, &quot;CONTMGT&quot;);
                                    if (!NewContract)
                                    {
                                        ContractFolder.RootModuleFolderId = projFolder.FolderId;
                                        ContractFolder.FolderName = ContractFolder.ListPath = &quot;{0}-{1}&quot;.Format2(dtoC.Name, dtoC.Code);
                                        DocumentManager.Instance.ModifyFolder(ContractFolder);
                                    }
                                    else // new contract
                                    {
                                        BrixWorkflowManager.Instance.TriggerWorkflow(TriggerPoint.TriggerActions[0], &quot;XCNTBGT&quot;, PID.ToString(), newContractID.ToString(), &quot;&quot;, newContractID.ToString());
                                    }
                                    // if the contract was created successfully then instantiate the document tree for the contract based
                                    // on the selected document template
                                    if (ddlDocumentTemplate.SelectedIndex &gt; 0)
                                    {
                                        int DocTemplateID;
                                        if (int.TryParse(ddlDocumentTemplate.Items[ddlDocumentTemplate.SelectedIndex].Value, out DocTemplateID))
                                            if (DocTemplateID &gt; 0)
                                                DocumentManager.Instance.InstantiateDocumentTemplate(ContractFolder, DocTemplateID);
                                    }
                                    foreach (Module mod in dtoC.Modules)
                                        DocumentManagementBL.DocumentManager.Instance.CreateFolderForModule(mod.ModID, &quot;CONTMGT&quot;, newContractID);
                                    DocumentManagementBL.DocumentManager.Instance.CreateFolderForModule(&quot;SUBMTAL&quot;, &quot;CONTMGT&quot;, newContractID);

                                    BL.Instance.CopyEstimateItemstoContract(
                                        rbEstimate.Checked
                                            ? ddlEstimate.SelectedValue.ToInt32_2()
                                            : ddlversion.SelectedValue.ToInt32_2(),
                                        chkEngEstimate.Checked ? 0 : ddlAwarded.SelectedValue.ToInt32_2(), newContractID,
                                        &quot;ESTMATE&quot;, &quot;CONTMGT&quot;);

                                    objTabMaster = base.Master as BrixTabMasterPage;
                                    objTabMaster.AMP3ObjectId = newContractID;
                                    objTabMaster.MasterSave(GetPageData());

                                    if (!chkEngEstimate.Checked &amp;&amp; !ddlAwarded.SelectedValue.Equals(&quot;0&quot;))
                                    {
                                        var conBrixInfo = new List&lt;ConnectionBrixInfo&gt;();
                                        conBrixInfo.Add(new ConnectionBrixInfo(AMP3Object.CONTMGT, newContractID.ToString2(),
                                                                               AMP3Object.UNKNOWN, null));
                                        conBrixInfo.Add(new ConnectionBrixInfo(AMP3Object.CONTRACTOR, dtoC.PC.Company,
                                                                               AMP3Object.CONTMGT, newContractID.ToString2()));
                                        var dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
                                        dictAdditionalInfo.Add(RegisteredEIS.AX,
                                                               (new EISAdditionalInfo(RegisteredEIS.AX)).AddInfo(
                                                                   Constants.EIS_ADDITIONAL_INFO,
                                                                   Session[Constants.EIS_ADDITIONAL_INFO].ToString()));
                                        var connectorParameters =
                                            new ConnectorParameters(dictAdditionalInfo, MethodBase.GetCurrentMethod(),
                                                                    AMP3ObjectType.Unknown, EISObjectType.Contractor, null,
                                                                    conBrixInfo);
                                        IntegrationConnectorManager.HandleMap(connectorParameters);
                                    }

                                    Response.Redirect(&quot;CreateContract.aspx?Mode=View&amp;PID=&quot; + Request[Constants.QRY_PROJECTID]
                                                      + &quot;&amp;ContractID=&quot; + newContractID.ToString2()
                                                      + &quot;&amp;ParentID=&quot; + newContractID.ToString2()
                                                      + &quot;&amp;Tab=&quot; + (!String.IsNullOrEmpty(hdnTab.Value)
                                                                       ? hdnTab.Value
                                                                       : &quot;tab1&quot;) + &quot;&amp;nt=1&quot;, true); //dt.Rows[0][&quot;ContractID&quot;].ToString()
                                    break;
                                }
                            }
                        }
                        else
                        {
                            string message = &quot;ShowError(&#39;Contract is in &quot; + contractCurrency + &quot;. Estimate Items are in &quot; +
                                             estimateCurrency + &quot;. Items cannot be imported&#39;);&quot;;
                            ScriptManager.RegisterStartupScript(this, GetType(), &quot;4&quot;, message, true);
                        }
                    }
                }
                catch (FileNotFoundException)
                {
                    ScriptManager.RegisterStartupScript(this, GetType(), &quot;28&quot;, &quot;ShowError(&#39;Estimator Module Not found.&#39;);&quot;, true);
                }
                catch (Exception ex)
                {
                    string msg = &quot;ShowError(&#39;&quot; + ex.Message.Replace(&quot;&#39;&quot;, &quot;\\&#39;&quot;) + &quot;&#39;);&quot;;
                    msg = msg.Replace(Environment.NewLine, &quot;&quot;).Replace(&quot;\n&quot;, &quot;&quot;);
                    ScriptManager.RegisterStartupScript(this, GetType(), &quot;Err&quot;, msg, true);
                }
            }
        }

        private void PopulateEstimates()
        {
            try
            {
                bool hasEstimateModule = _selectedProjectModules.Exists(x =&gt; x.ModuleId == Constants.MODID_ESTMATE);

                if (!hasEstimateModule) return;

                ddlEstimate.DataSource = BL.Instance.GetEstimates(Request[&quot;PID&quot;].ToInt32_2());
                ddlEstimate.DataTextField = &quot;EstimateName&quot;;
                ddlEstimate.DataValueField = &quot;ProjectEstimateID&quot;;
                ddlEstimate.DataBind();

                if (ddlEstimate.Items.Count == 0)
                {
                    ddlEstimate.Items.Add(new ListItem(&quot;No Items To Display&quot;, &quot;0&quot;));
                    ddlAwarded.Items.Add(new ListItem(&quot;No Items To Display&quot;, &quot;0&quot;));
                    ddlEstimate.Enabled = ddlAwarded.Enabled = false;
                }
                else
                {
                    ddlEstimate.Items.Insert(0, new ListItem(&quot;Select One&quot;, &quot;0&quot;));
                    ddlEstimate.Enabled = ddlAwarded.Enabled = true;
                    PopulateEstimateBidders(ddlEstimate.Items[0].Value.ToInt32_2());
                }
            }
            catch (Exception e)
            {
                Logger.Log(Resources.MessageResources.Enumerations.LogType.Error, e.Message + e.StackTrace, Constants.MODID_CONTMGT);
            }
        }

        private void PopulateEstimateBidders(int? ProjectEstimateID)
        {
            try
            {
                ddlAwarded.DataSource = BL.Instance.GetEstimateBidders(Request[&quot;PID&quot;].ToInt32_2(), ProjectEstimateID);
                ddlAwarded.DataTextField = &quot;ContractorName&quot;;
                ddlAwarded.DataValueField = &quot;BidID&quot;;
                ddlAwarded.DataBind();

                if (ddlAwarded.Items.Count == 0)
                {
                    ddlAwarded.Items.Add(new ListItem(&quot;Estimate Not Awarded&quot;, &quot;0&quot;));
                    ddlAwarded.Enabled = false;
                }
                else
                {
                    ddlAwarded.Enabled = true;
                }
            }
            catch (Exception)
            {
            }
        }

#endregion

        #region ToolBar

        protected override void CreateChildControls()
        {
            List&lt;string&gt; components = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CONTMGT);

            var menus = new MenuArray();
            AddSaveButton(menus);
            menus.Add(new BrixMenu(&quot;lnkEdit&quot;, &quot;Edit&quot;, &quot;Icn_Edit.png&quot;, 55));
            #region Audit Log

            bool isAuditLogEnabledForTable =
            ComponentHelper.Instance.ExecuteScalar(StoredProcedure.usp_CORITEMIsAuditLogEnabledInDB, null,
                ConnectionHelper.GetCurrentDBDetails().DBName, &quot;CONTMGTMaster&quot;).ToBoolean2();
            bool hasAuditLogPermission = false;
            List&lt;string&gt; perms =
                ModuleManager.Instance.GetPermissionByUserOrRole(Constants.MODID_CORE,
                    UserDetail.GetCurrentUserDetail().UID, UserDetail.GetCurrentUserDetail().RID,
                    (string.IsNullOrEmpty(Request.QueryString[&quot;PID&quot;]) ? 0 : Request.QueryString[&quot;PID&quot;].ToInt32_2()));
            hasAuditLogPermission = perms.Contains(&quot;AuditLog&quot;);

            if (isAuditLogEnabledForTable &amp;&amp; hasAuditLogPermission)
                menus.Add(new BrixMenu(&quot;lnkAudit&quot;, &quot;Audit Log&quot;, &quot;Icn_Pdf_16.png&quot;));


            #endregion

            if ((WebConfigurationManager.AppSettings[&quot;EPSModeMultiple&quot;] == &quot;ON&quot;))
                menus.Add(new BrixMenu(&quot;lnkCancel&quot;, &quot;Cancel&quot;, &quot;Icn_Cancel.png&quot;, 55));

            bool hasEstimateModule = _selectedProjectModules.Exists(x =&gt; x.ModuleId == Constants.MODID_ESTMATE);

            if (components.Contains(&quot;ImportEst&quot;) &amp;&amp; hasEstimateModule)
                menus.Add(new BrixMenu(&quot;lnkImport&quot;, &quot;Import&quot;, &quot;Icn_importxl.png&quot;, 55));
            CreateToolBarMenu(menus, null);
            base.CreateChildControls();
        }

        protected override void CustomizeToolBar()
        {
            if (HasSaveButton)
            {
                Aurigo.AMP3.Core.UserControls.Menu lnkSave = GetSaveButton();
                if (null != lnkSave)
                {
                    lnkSave.Click += btnSubmitMaster_Click;
                    lnkSave.ValidationGroup = &quot;Master&quot;;
                }
            }

            Core.UserControls.Menu lnkEdit = MainToolBar.GetMenuReference(&quot;lnkEdit&quot;);
            if (lnkEdit != null)
            {
                lnkEdit.Click += btnEditContract_Click;
                lnkEdit.CausesValidation = false;
            }

            if (MainToolBar.GetMenuReference(&quot;lnkAudit&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkAudit&quot;).Click += btnAudit_Click;
                MainToolBar.GetMenuReference(&quot;lnkAudit&quot;).CausesValidation = false;
            }

            if (MainToolBar.GetMenuReference(&quot;lnkCancel&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkCancel&quot;).Click += btnBack_Click;
                MainToolBar.GetMenuReference(&quot;lnkCancel&quot;).CausesValidation = false;
            }

            Core.UserControls.Menu lnkImport = MainToolBar.GetMenuReference(&quot;lnkImport&quot;);
            if (lnkImport != null)
            {
                lnkImport.OnClientClick = &quot;ImportItems();return false;&quot;;
                lnkImport.ToolTip = &quot;Import Estimate Items&quot;;
                lnkImport.CausesValidation = false;
            }

            XmlFormArgs args = new XmlFormArgs();
            if (managerModel != null)
                managerModel.AfterCustomizeToolbar(model, MainToolBar, args);
        }

        protected override void OnPreRender(EventArgs e)
        {
            if (!String.IsNullOrEmpty(Request[&quot;Mode&quot;]) &amp;&amp; Request[&quot;Mode&quot;] == &quot;View&quot;)
            {
                if (HasSaveButton)
                {
                    Aurigo.AMP3.Core.UserControls.Menu lnkSave = GetSaveButton();
                    if (null != lnkSave)
                    {
                        MainToolBar.HideMenu(&quot;lnkSave&quot;);
                    }
                }
            }

            if (String.IsNullOrEmpty(Request[&quot;Mode&quot;]) ||
                (!String.IsNullOrEmpty(Request[&quot;Mode&quot;]) &amp;&amp; Request[&quot;Mode&quot;] != &quot;View&quot;))
            {
                if (MainToolBar.GetMenuReference(&quot;lnkEdit&quot;) != null)
                    MainToolBar.HideMenu(&quot;lnkEdit&quot;);
                if (MainToolBar.GetMenuReference(&quot;lnkAudit&quot;) != null)
                    MainToolBar.HideMenu(&quot;lnkAudit&quot;);
            }
            if (!btnImpAwdItems.Visible)
                MainToolBar.HideMenu(&quot;lnkImport&quot;);

            base.OnPreRender(e);

            /* Check Module Permissions for User*/
            var featurelist = (List&lt;string&gt;)Context.Items[Constants.MODULE_PERMISSIONS];
            if (!(featurelist.Contains(CMConstans.MODFEAT_CREATE) || featurelist.Contains(CMConstans.MODFEAT_EDIT)))
                MainToolBar.HideMenu(&quot;lnkSave&quot;);
            if (!featurelist.Contains(CMConstans.MODFEAT_EDIT))
                MainToolBar.HideMenu(&quot;lnkEdit&quot;);

            XmlFormArgs args = new XmlFormArgs();
            if (managerModel != null)
                managerModel.OnPreRender(model, args);
        }

        #endregion

        private void ShowControlsForViewPage(bool isView)
        {
            txtContractCode.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            spanContractCode.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            lblContractCode.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);
            txtContractName.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            spanContractName.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            lblContractName.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);

            dtStartDate.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            lblStartDate.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);

            dtClosureDt.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            lblClosureDt.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);

            ddlMSys.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            spanMSys.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            lblMSys.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);

            ddlStatus.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            spanStatus.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            lblStatus.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);

            txtDescription.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            divDesc.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);

            txtAreaOffice.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            lblArea.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);

            txtBonusPercentage.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            lblBonus.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);

            if ((AMP3ApplicationSettings.Instance.BOQGroupType.StartsWith(&quot;G&quot;, StringComparison.OrdinalIgnoreCase)))
            {
                ddlGroupType.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
                lblGroupType.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);
            }

            ddlDocumentTemplate.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            lblDocTemplate.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);

            //this is commented back as the document template is hidden in edit mode.
            //ddlDocumentTemplate.Style.Add(HtmlTextWriterStyle.Display, &quot;none&quot;);// Always Hide dropdown
            //lblDocTemplate.Style.Add(HtmlTextWriterStyle.Display, &quot;block&quot;);//// Always show lable

            wdcDateCreated.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            lblDateCreated.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);

            txtKCPE.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            lblKCPE.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);

            txtKCRE.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            lblKCRE.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);

            txtKCCA.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            lblKCCA.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);

            wdcKDNPD.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            lblKDNPD.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);

            wdcKDCSD.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            lblKDCSD.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);

            wdcKDOTD.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            lblKDOTD.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);

            wdcKDCWD.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            lblKDCWD.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);

            wdcKDCCD.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            lblKDCCD.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);

            btnLibCatSave.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            btnHideGrid.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);

            btnAddGrp.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            btnEditGrp.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            btnRemoveGrp.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            //dvGrpDetails.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);

            btnSubmitMaster.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            btnEdit.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);
            btnDestroy.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);
        }

        private void ShowTimeControlsForViewPage(bool isView)
        {
            ddlCalendar.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            lblCalendar.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);
            dtBeginDate.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            lblBeginDt.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);

            wneContractDays.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            lblContractDays.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);

            rblContractTime.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            lblContractTime.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);

            dtEndDate.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;none&quot; : &quot;block&quot;);
            lblEndDt.Style.Add(HtmlTextWriterStyle.Display, isView ? &quot;block&quot; : &quot;none&quot;);
        }

        private void BindCalendar(int calendarID = 0)
        {
            DataSet ds = _contractCalendarModel.GetLibraryCalendarList();

            if (ds.Tables.Count == 0 || ds.Tables[0].Rows.Count == 0)
                return;

            UIHelper.BindDropDownData(ddlCalendar, ds.Tables[0], &quot;Name&quot;, &quot;ID&quot;);
            if (ddlCalendar.Items.Count == 0)
                trCalendar.Style.Add(&quot;display&quot;, &quot;none&quot;);
            else
            {
                ddlCalendar.Items.Insert(0, new ListItem(CONST_Dropdown_MakeSelectText, &quot;&quot;)); //when no calendar is selected for project

                if (calendarID &gt; 0)
                {
                    ListItem selectedItem = ddlCalendar.Items.FindByValue(calendarID.ToString());
                    if (selectedItem != null)
                        selectedItem.Selected = true;
                }
            }
        }

        private void SetContractTimeLabels()
        {
            if (ddlCalendar.SelectedIndex &gt; 0)
            {
                txtDays.Text = &quot;Working Days&quot;;
                rblContractTime.SelectedValue = &quot;W&quot;;
            }
            else
            {
                txtDays.Text = &quot;Calendar Days&quot;;
                rblContractTime.SelectedValue = &quot;C&quot;;
            }

            if (ddlCalendar.Items.Count &gt; 0)
                trCalendar.Style.Add(&quot;display&quot;, &quot;table-row&quot;);
        }

        protected void rblContractTime_SelectedIndexChanged(object sender, EventArgs e)
        {
            SetContractTimeLabels();
            ChangeEndDate(0);
        }

        protected void ddlCalendar_SelectedIndexChanged(object sender, EventArgs e)
        {
            _calendar = null;
            ChangeEndDate(0);
            SetContractTimeLabels();
        }

        protected void dtBeginDate_ValueChanged(object sender, WebDateChooser.WebDateChooserEventArgs e)
        {
            ChangeEndDate(0);
        }

        protected void wneContractDays_ValueChange(object sender, ValueChangeEventArgs e)
        {
            if (Request.Form[&quot;__EVENTTARGET&quot;].EndsWith(&quot;wneContractDays&quot;))
                ChangeEndDate(1);
        }

        protected void dtEndDate_ValueChanged(object sender, WebDateChooser.WebDateChooserEventArgs e)
        {
            ChangeEndDate(2);
        }


        bool? _IsLibraryCalendar = null;
        private bool IsLibraryCalendar
        {
            get
            {
                if (!_IsLibraryCalendar.HasValue)
                    GetCalendar(Request[&quot;ContractID&quot;].ToInt32_2());
                return _IsLibraryCalendar.HasValue ? _IsLibraryCalendar.Value : true;
            }
        }


        private CalendarDetails GetCalendar(int ContractID)
        {
            bool hasCalendarChanged = true;

            if (ddlCalendar.Items.Count &gt; 0 &amp;&amp; ddlCalendar.SelectedIndex &gt;= 0 &amp;&amp; !string.IsNullOrEmpty(ddlCalendar.SelectedValue))
                hasCalendarChanged = ddlCalendar.SelectedValue.ToInt32_2() != _contractCalendarID;

            if (_calendar == null || hasCalendarChanged)
            {
                if (IsEdit || IsView)
                {
                    _calendar = _contractCalendarModel.GetCalendarDetails(ContractID);

                    _calendar.ProjectStartDate = Convert.ToDateTime(dtBeginDate.Value);
                    _calendar.ProjectEndDate = Convert.ToDateTime(dtEndDate.Value);
                    _calendar.Days = wneContractDays.Value.ToInt32_2();

                    _IsLibraryCalendar = (_calendar.ID == 0);
                }

                if ((IsNew || (_calendar != null &amp;&amp; _calendar.ID == 0) || hasCalendarChanged) &amp;&amp; ddlCalendar.SelectedIndex &gt; 0)
                {
                    _calendar = _contractCalendarModel.GetLibraryCalendarDetails(ddlCalendar.SelectedValue == &quot;&quot; ? 0 : ddlCalendar.SelectedValue.ToInt32_2());
                    _IsLibraryCalendar = true;
                }
            }
            return _calendar;
        }

        private void ChangeEndDate(int ChangeType)  //0-BeginDate, 1-Days, 2-EndDate
        {
            DateTime startDate, endDate;

            startDate = GetValidDateTime(dtBeginDate.Value);
            endDate = GetValidDateTime(dtEndDate.Value);

            if (IsValidDate(startDate))
                dtEndDate.MinDate = startDate.ToDateTime_MWCulture();

            if (ddlCalendar.SelectedIndex &gt; 0)
            {
                CalendarDetails calendar = GetCalendar(Request[&quot;ContractID&quot;].ToInt32_2());

                if (ChangeType == 1 &amp;&amp; IsValidDate(startDate))
                    dtEndDate.Value = _contractCalendarModel.GetEndDate(startDate.Date.ToDateTime_MWCulture(), wneContractDays.ValueInt, calendar).ToMWDateTime();
                if ((ChangeType == 0 || ChangeType == 2) &amp;&amp; IsValidDate(startDate) &amp;&amp; IsValidDate(endDate))
                    wneContractDays.Value = _contractCalendarModel.GetWorkingDaysCount(startDate.Date.ToDateTime_MWCulture(), endDate.Date.ToDateTime_MWCulture(), calendar);
            }
            else
            {
                if (ChangeType == 1 &amp;&amp; IsValidDate(startDate))
                    dtEndDate.Value = startDate.Date.ToDateTime_MWCulture().AddDays(wneContractDays.ValueInt - 1).ToMWDateTime();
                if ((ChangeType == 0 || ChangeType == 2) &amp;&amp; IsValidDate(startDate) &amp;&amp; IsValidDate(endDate))
                    wneContractDays.Value = (new TimeSpan(endDate.Date.ToDateTime_MWCulture().Date.Ticks - startDate.Date.ToDateTime_MWCulture().Date.Ticks).Days + 1);
            }
        }

        private DateTime GetValidDateTime(object date)
        {
            DateTime validDate = DateTime.MinValue;

            if (date is DateTime || date is DateTime? || date is string)
            {
                DateTime.TryParse(date.ToString(), out validDate);
            }

            return validDate;

        }

        private void SaveContractTime(DTO dto, int ContractID)
        {
            dto.TimeType = ddlCalendar.SelectedIndex &lt;= 0 ? &quot;C&quot; : &quot;W&quot;;
            if (dto.TimeType != null)
            {
                if (ddlCalendar.SelectedIndex &gt; 0 &amp;&amp; (IsNew || (IsEdit &amp;&amp; IsLibraryCalendar)))
                    BL.Instance.CopyCalendarFromLibrary(ContractID, ddlCalendar.SelectedValue.ToInt32_2());

                DateTime startDate = GetValidDateTime(dtBeginDate.Value);

                dto.Days = wneContractDays.ValueDecimal;
                dto.BeginDt = startDate.Date.ToUtc();

                if (ddlCalendar.SelectedIndex &gt; 0)
                    dto.CalendarID = ddlCalendar.SelectedValue.ToInt32_2();

                if (!IsValidDate(dtEndDate.Value))
                    ChangeEndDate(1);

                dto.CompletionDt = dtEndDate.Value.ToUtc();
                BL.Instance.CUDContractTime(dto);
            }
        }

        private bool IsValidDate(object dtValue)
        {
            try
            {
                dtValue.ToString().ToDateTime_MWCulture();
            }
            catch
            {
                return false;
            }
            return true;
        }

        public override int GetProjectIdFromInstanceId()
        {
            string mode = Request.QueryString[&quot;Mode&quot;];
            if (!string.IsNullOrEmpty(mode) &amp;&amp;
               (mode.Equals(&quot;Edit&quot;, StringComparison.CurrentCultureIgnoreCase) ||
               mode.Equals(&quot;View&quot;, StringComparison.CurrentCultureIgnoreCase)))
            {
                if (!string.IsNullOrEmpty(Request[&quot;ContractID&quot;]))
                    return BL.Instance.GetPIDFromContractId(Request[&quot;ContractID&quot;].ToInt32_2());
                else
                    return -1;
            }
            else //Its new mode, just pass the same PID
                return base.GetProjectIdFromInstanceId();
        }

        #region IXMLControl Members

        public object[] ParentFormInstanceID
        {
            get { return new object[] { Request[&quot;ContractID&quot;] == null ? &quot;0&quot; : Request[&quot;ContractID&quot;].ToString() }; }
        }

        public HtmlGenericControl XMLContainterDiv
        {
            get
            {
                return divExtension;
            }
            set
            { }
        }

        public void HandleInjectionSaveException(object model, Exception ex, string parentFormInstanceId)
        { }

        public void HandleInjectionAfterSave(object model, string parentFormInstanceId) { }

        public bool SkipDefaultXMLInjectionSave { get; set; }

        #endregion

        #region RadGrid

        protected void gridModulePlatforms_ColumnCreated(object sender, Telerik.Web.UI.GridColumnCreatedEventArgs e)
        {
            Telerik.Web.UI.GridBoundColumn boundColumn = e.Column as Telerik.Web.UI.GridBoundColumn;
            if (boundColumn != null)
            {
                boundColumn.HtmlEncode = true;
                if (boundColumn.DataField == &quot;Web&quot;)
                {
                    (e.Column as GridBoundColumn).ReadOnly = true;
                }
            }
        }

        protected void gridModulePlatforms_ItemDataBound(object sender, GridItemEventArgs e)
        {
            if (e.Item is GridDataItem)
            {
                GridDataItem item = e.Item as GridDataItem;
                int rowID = item.RowIndex / 2;

                if (String.IsNullOrEmpty(Request[&quot;Mode&quot;]))
                {
                    item.Selected = true;
                }

                if (item[&quot;Module Name&quot;] != null)
                    if (item[&quot;ModuleID&quot;].Text.ToString() == &quot;PAYESTM&quot;)
                        item[&quot;Module Name&quot;].Text = PayEstimatesName;


                if ((gridModulePlatforms.MasterTableView.GetColumnSafe(Constants.XPCLNT_PLT_NAME) != null) &amp;&amp; dt.Rows[rowID - 1][Constants.OFFLINE_PLT_NAME].ToString() != &quot;&quot; &amp;&amp; Request[&quot;Mode&quot;] != &quot;View&quot;)
                {
                    ((CheckBox)item[Constants.XPCLNT_PLT_NAME].Controls[0]).Enabled = true;
                }

                if ((gridModulePlatforms.MasterTableView.GetColumnSafe(Constants.OFFLINE_PLT_NAME) != null) &amp;&amp; dt.Rows[rowID - 1][Constants.OFFLINE_PLT_NAME].ToString() != &quot;&quot; &amp;&amp; Request[&quot;Mode&quot;] != &quot;View&quot;)
                {
                    ((CheckBox)item[Constants.OFFLINE_PLT_NAME].Controls[0]).Enabled = true;
                }
            }
        }
        #endregion
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[64,9,64,10,0],[65,13,66,123,0],[67,9,67,10,0],[70,9,70,10,0],[71,13,72,67,0],[73,9,73,10,0],[81,9,81,117,1],[82,9,82,45,1],[83,9,83,50,1],[96,37,96,41,0],[96,42,96,46,0],[98,9,98,88,1],[105,17,105,18,1],[105,19,105,80,1],[105,81,105,82,1],[113,17,113,18,0],[113,19,113,81,0],[113,82,113,83,0],[121,17,121,18,0],[121,19,121,77,0],[121,78,121,79,0],[127,9,127,10,0],[128,13,128,49,0],[134,13,134,14,1],[135,17,137,98,1],[138,17,138,38,1],[139,13,139,14,1],[142,37,142,38,1],[142,39,142,61,1],[142,62,142,63,1],[146,17,146,18,0],[146,19,146,39,0],[146,40,146,41,0],[151,17,151,18,1],[151,19,151,36,1],[151,37,151,38,1],[156,17,156,18,0],[156,19,156,31,0],[156,32,156,33,0],[161,17,161,18,1],[161,19,161,65,1],[161,66,161,67,1],[167,13,167,14,1],[168,17,170,91,1],[171,17,171,27,1],[172,13,172,14,1],[178,13,178,14,1],[179,17,179,75,1],[180,21,180,134,0],[182,17,182,18,1],[185,21,186,155,1],[188,13,188,14,1],[192,9,192,10,1],[193,13,193,42,1],[194,9,194,10,1],[197,9,197,10,1],[198,13,198,26,1],[199,13,199,30,1],[201,13,201,32,1],[203,13,203,53,1],[204,13,204,14,1],[205,17,205,62,1],[206,17,206,29,1],[208,13,208,40,0],[209,13,209,26,0],[210,9,210,10,1],[215,9,215,10,1],[216,13,216,68,1],[217,13,219,116,1],[220,13,220,73,1],[221,13,221,83,1],[222,13,222,69,1],[223,13,223,55,1],[224,13,224,62,1],[225,17,225,80,1],[226,13,226,63,1],[227,13,227,31,1],[228,13,228,31,1],[229,13,229,38,1],[230,17,230,66,0],[232,13,232,86,1],[233,9,233,10,1],[237,9,237,10,1],[238,13,238,88,1],[240,13,240,116,1],[241,13,241,14,0],[242,17,243,111,0],[245,13,245,14,0],[246,9,246,10,1],[248,9,248,10,1],[250,13,250,66,1],[252,13,252,55,1],[254,13,254,45,1],[255,13,255,14,1],[256,17,256,84,1],[257,21,257,68,1],[258,22,258,89,1],[259,21,259,68,1],[261,21,261,70,0],[262,13,262,14,1],[264,17,264,66,0],[267,13,267,42,1],[269,13,269,129,1],[271,13,271,43,1],[273,13,273,44,1],[274,13,274,50,1],[275,13,275,38,1],[276,17,276,50,0],[277,13,277,40,1],[278,13,278,28,1],[280,9,280,10,1],[283,9,283,10,0],[284,13,284,45,0],[286,13,286,38,0],[287,13,287,42,0],[288,13,288,48,0],[290,13,290,28,0],[293,13,293,49,0],[297,13,297,108,0],[298,13,298,56,0],[299,13,299,14,0],[300,17,300,59,0],[301,13,301,14,0],[303,13,303,106,0],[304,13,304,51,0],[305,13,305,14,0],[306,17,306,53,0],[307,17,307,54,0],[308,17,308,60,0],[309,17,309,18,0],[310,21,310,178,0],[311,17,311,18,0],[312,13,312,14,0],[314,13,314,72,0],[315,17,315,87,0],[317,13,322,32,0],[324,13,324,96,0],[326,13,327,61,0],[328,17,329,41,0],[330,18,330,60,0],[331,17,331,84,0],[332,17,332,18,0],[333,21,338,67,0],[340,21,340,44,0],[341,25,342,159,0],[343,17,343,18,0],[345,13,345,63,0],[348,13,348,89,0],[350,13,350,62,0],[351,13,351,14,0],[352,17,352,68,0],[353,17,353,18,0],[354,21,356,98,0],[357,17,357,18,0],[358,13,358,14,0],[360,13,360,14,0],[361,17,361,70,0],[362,17,362,18,0],[363,21,365,98,0],[366,17,366,18,0],[367,13,367,14,0],[368,13,369,85,0],[370,13,370,77,0],[374,13,374,29,0],[375,13,375,14,0],[380,17,380,77,0],[383,17,392,71,0],[393,17,393,80,0],[395,17,395,40,0],[396,17,396,18,0],[397,21,397,116,0],[398,21,398,74,0],[399,21,399,97,0],[400,21,400,77,0],[401,21,401,51,0],[402,17,402,18,0],[403,22,403,45,0],[404,17,404,18,0],[405,21,405,98,0],[406,21,406,64,0],[407,21,407,79,0],[408,21,408,67,0],[409,21,409,52,0],[410,17,410,18,0],[412,17,412,145,0],[413,17,413,27,0],[414,17,414,18,0],[415,21,415,81,0],[416,21,416,36,0],[417,17,417,18,0],[418,17,418,34,0],[419,17,419,35,0],[420,17,420,37,0],[421,17,421,45,0],[423,17,423,123,0],[424,17,424,74,0],[425,17,425,76,0],[427,17,427,38,0],[428,17,428,18,0],[429,21,429,63,0],[430,21,430,36,0],[432,21,432,22,0],[433,25,433,127,0],[434,21,434,22,0],[435,21,435,26,0],[436,21,436,22,0],[437,25,437,135,0],[438,21,438,22,0],[440,21,440,56,0],[441,25,442,156,0],[444,21,444,119,0],[446,21,446,62,0],[447,21,447,63,0],[448,21,448,49,0],[449,25,449,68,0],[452,21,452,78,0],[453,25,453,57,0],[454,21,454,66,0],[455,21,455,144,0],[457,21,457,22,0],[458,25,458,117,0],[459,25,459,111,0],[460,21,460,22,0],[461,21,461,26,0],[462,21,462,22,0],[463,25,463,74,0],[464,25,464,55,0],[465,21,465,22,0],[479,21,479,95,0],[480,21,480,122,0],[482,21,482,37,0],[483,21,483,22,0],[484,25,484,81,0],[485,29,485,64,0],[487,29,487,44,0],[488,21,488,22,0],[491,21,491,68,0],[492,21,492,115,0],[494,21,494,71,0],[495,21,495,123,0],[497,21,497,45,0],[499,21,499,53,0],[500,21,500,70,0],[502,21,502,53,0],[503,21,503,70,0],[505,21,505,52,0],[506,21,506,62,0],[507,21,507,90,0],[508,21,508,22,0],[509,25,509,98,0],[510,21,510,22,0],[511,21,511,89,0],[514,21,514,71,0],[515,21,515,70,0],[517,21,518,81,0],[519,21,519,90,0],[520,21,520,70,0],[521,21,521,51,0],[522,21,522,74,0],[523,21,524,104,0],[525,25,525,49,0],[528,21,528,122,0],[529,21,529,129,0],[530,21,530,55,0],[531,21,531,121,0],[532,21,532,79,0],[533,21,533,83,0],[537,21,537,64,0],[539,21,539,150,0],[540,25,540,119,0],[542,21,542,51,0],[543,25,544,116,0],[546,21,546,43,0],[547,21,547,42,0],[549,21,549,48,0],[551,21,551,51,0],[552,21,552,22,0],[553,25,553,53,0],[554,25,554,51,0],[556,30,556,39,0],[556,41,556,65,0],[556,67,556,70,0],[557,25,557,26,0],[558,29,558,113,0],[559,25,559,26,0],[561,25,561,85,0],[562,25,562,57,0],[563,21,563,22,0],[565,26,565,35,0],[565,37,565,57,0],[565,59,565,62,0],[566,21,566,22,0],[567,25,573,75,0],[574,21,574,22,0],[576,21,576,28,0],[576,30,576,41,0],[576,42,576,44,0],[576,45,576,70,0],[577,21,577,22,0],[578,25,578,53,0],[579,25,579,26,0],[580,29,580,73,0],[582,29,582,52,0],[583,29,583,63,0],[584,29,584,49,0],[586,29,586,88,0],[587,33,587,54,0],[588,34,588,94,0],[589,33,589,54,0],[590,25,590,26,0],[591,21,591,22,0],[593,21,595,78,0],[597,21,597,51,0],[598,25,598,55,0],[600,25,600,54,0],[601,21,601,43,0],[604,21,604,70,0],[605,21,606,173,0],[608,21,608,75,0],[609,21,610,178,0],[612,21,612,71,0],[613,21,615,50,0],[617,21,617,69,0],[618,21,620,50,0],[622,21,622,76,0],[623,21,625,50,0],[629,21,629,74,0],[630,21,630,91,0],[632,21,632,68,0],[633,21,633,85,0],[635,21,635,69,0],[636,21,636,86,0],[638,21,638,85,0],[639,25,639,47,0],[640,21,640,79,0],[641,25,641,47,0],[642,21,642,80,0],[643,25,643,47,0],[645,17,645,18,0],[647,17,647,18,0],[648,21,648,43,0],[649,21,649,42,0],[650,17,650,18,0],[651,17,651,64,0],[652,17,652,64,0],[653,17,653,109,0],[654,17,654,66,0],[655,17,655,18,0],[656,21,656,59,0],[657,21,657,56,0],[658,21,658,46,0],[659,21,659,56,0],[660,21,660,141,0],[661,17,661,18,0],[663,17,663,134,0],[664,21,664,65,0],[665,13,665,14,0],[667,13,667,14,0],[668,17,668,63,0],[670,17,670,76,0],[671,17,671,18,0],[672,21,672,72,0],[673,17,673,18,0],[675,17,675,39,0],[676,13,676,14,0],[677,13,677,35,0],[679,13,679,111,0],[680,13,680,45,0],[681,13,681,61,0],[686,13,686,50,0],[687,13,687,38,0],[688,17,688,54,0],[690,9,690,10,0],[693,9,693,10,1],[694,13,694,46,1],[695,13,695,70,1],[696,17,696,46,1],[699,13,699,14,0],[700,17,700,59,0],[701,21,701,60,0],[702,22,702,52,0],[703,21,703,61,0],[704,22,704,52,0],[705,21,705,61,0],[706,13,706,14,0],[707,9,707,10,1],[710,9,710,10,1],[711,13,711,38,1],[713,13,713,59,1],[714,13,714,61,1],[715,9,715,10,1],[718,9,718,10,1],[719,13,719,114,1],[720,13,720,44,1],[721,13,721,43,1],[722,13,722,32,1],[723,13,723,67,1],[724,13,724,41,1],[725,17,725,43,1],[726,9,726,10,1],[729,9,729,10,1],[730,13,730,76,1],[732,13,732,28,1],[733,13,733,14,1],[734,17,734,53,1],[735,17,735,71,1],[736,17,736,70,1],[737,17,737,48,1],[739,17,739,86,1],[740,13,740,14,1],[741,9,741,10,1],[744,9,744,10,1],[745,13,745,64,1],[746,13,746,46,1],[747,13,747,45,1],[748,13,748,34,1],[750,9,750,10,1],[753,9,753,10,1],[754,13,757,81,1],[758,9,758,10,0],[761,9,761,10,0],[762,13,763,54,0],[764,13,764,54,0],[765,13,765,126,0],[766,9,766,10,0],[771,9,771,10,1],[772,13,774,88,1],[775,17,775,142,0],[777,17,777,46,1],[778,9,778,10,0],[783,13,783,14,1],[784,17,784,107,1],[785,13,785,14,1],[791,13,791,14,1],[792,17,792,62,1],[793,13,793,14,1],[799,13,799,14,1],[800,17,800,103,1],[801,13,801,14,1],[807,13,807,14,1],[808,17,808,103,1],[809,13,809,14,1],[813,9,813,10,1],[814,13,814,32,1],[816,13,816,14,1],[817,17,817,69,1],[819,17,819,40,1],[820,17,820,18,1],[822,21,822,57,1],[823,25,823,129,0],[827,21,827,69,1],[828,25,828,41,0],[830,21,830,60,1],[831,21,831,60,1],[833,21,833,63,1],[839,21,839,71,1],[863,21,863,54,1],[864,21,864,74,1],[865,21,865,76,1],[866,21,866,151,1],[867,21,867,54,1],[868,21,868,142,1],[870,21,870,49,1],[872,21,872,113,1],[873,21,873,124,1],[875,21,875,44,1],[876,25,876,72,1],[879,21,879,85,1],[880,25,880,49,0],[881,21,881,43,1],[882,25,882,59,1],[885,21,885,104,1],[887,21,898,24,1],[900,21,900,115,1],[901,21,901,40,1],[902,21,902,22,1],[903,25,903,81,1],[904,25,904,117,1],[905,25,905,79,1],[906,21,906,22,1],[908,21,908,22,0],[909,25,909,179,0],[910,21,910,22,0],[914,21,914,63,1],[915,21,915,22,1],[917,25,917,129,1],[918,29,918,51,1],[919,33,919,117,1],[920,21,920,22,1],[921,21,921,28,1],[921,30,921,40,1],[921,41,921,43,1],[921,44,921,55,1],[922,25,922,127,1],[923,21,923,123,1],[925,21,938,24,1],[941,21,941,60,1],[942,21,942,60,1],[943,21,944,111,1],[945,21,945,22,0],[946,25,946,92,0],[947,25,948,82,0],[949,25,949,26,0],[950,29,950,93,0],[951,33,951,57,0],[952,29,952,56,0],[953,29,953,95,0],[954,25,954,26,0],[955,21,955,22,0],[956,21,956,90,1],[957,21,957,22,0],[958,25,958,74,0],[959,25,960,91,0],[961,25,962,109,0],[963,25,963,101,0],[964,25,967,104,0],[968,25,970,122,0],[971,25,971,84,0],[972,21,972,22,0],[982,21,982,94,1],[983,21,983,28,1],[983,30,983,60,1],[983,61,983,63,1],[983,64,983,70,1],[984,21,984,22,1],[985,25,985,79,1],[986,25,986,43,1],[987,29,987,112,1],[988,21,988,22,1],[990,21,990,39,1],[991,21,991,22,0],[992,25,992,83,0],[993,21,993,22,0],[995,21,995,45,1],[996,21,996,33,1],[999,17,999,18,0],[1000,21,1000,37,0],[1001,21,1001,34,0],[1004,13,1004,33,0],[1005,13,1005,14,0],[1006,17,1006,85,0],[1007,17,1007,78,0],[1008,17,1008,88,0],[1009,17,1009,33,0],[1010,17,1010,30,0],[1012,9,1012,10,1],[1015,9,1015,10,1],[1016,13,1016,67,1],[1018,13,1018,14,0],[1019,17,1019,41,0],[1022,17,1023,59,0],[1024,17,1024,30,0],[1030,13,1030,103,1],[1031,13,1031,14,0],[1032,17,1032,72,0],[1033,17,1033,18,0],[1034,21,1034,82,0],[1035,21,1035,22,0],[1036,25,1036,49,0],[1037,25,1038,67,0],[1039,25,1039,38,0],[1041,17,1041,18,0],[1042,13,1042,14,0],[1043,13,1043,70,1],[1044,13,1044,14,0],[1045,17,1047,59,0],[1048,17,1048,30,0],[1051,13,1051,67,1],[1053,13,1053,14,0],[1054,17,1054,41,0],[1056,17,1057,59,0],[1059,17,1059,30,0],[1061,18,1061,75,1],[1062,13,1062,14,0],[1063,17,1065,59,0],[1066,17,1066,30,0],[1069,13,1069,66,1],[1070,13,1070,14,0],[1071,17,1071,41,0],[1072,17,1072,123,0],[1073,17,1073,30,0],[1077,13,1077,14,1],[1078,17,1078,31,1],[1079,21,1079,88,1],[1080,13,1080,14,1],[1081,13,1081,18,0],[1082,13,1082,14,0],[1083,17,1083,37,0],[1085,17,1086,123,0],[1087,17,1087,30,0],[1090,13,1090,60,1],[1091,13,1091,14,0],[1092,17,1092,41,0],[1093,17,1094,106,0],[1095,17,1095,30,0],[1099,13,1099,14,1],[1100,17,1100,58,1],[1101,17,1101,18,1],[1102,21,1102,153,1],[1103,21,1103,22,0],[1105,25,1106,158,0],[1107,25,1107,38,0],[1109,17,1109,18,1],[1110,13,1110,14,1],[1111,13,1111,18,0],[1112,13,1112,14,0],[1113,17,1113,35,0],[1115,17,1116,178,0],[1117,17,1117,30,0],[1120,13,1120,49,1],[1121,13,1121,14,0],[1122,17,1122,35,0],[1124,17,1124,147,0],[1125,17,1125,30,0],[1128,13,1128,47,1],[1129,13,1129,14,0],[1130,17,1130,33,0],[1132,17,1132,133,0],[1133,17,1133,30,0],[1135,13,1135,25,1],[1136,9,1136,10,1],[1139,9,1139,10,1],[1140,13,1140,33,1],[1142,13,1142,70,1],[1143,13,1143,66,1],[1145,13,1145,50,1],[1146,13,1146,67,1],[1147,13,1147,44,1],[1148,13,1148,102,1],[1150,13,1150,73,1],[1151,13,1151,72,1],[1153,13,1153,41,1],[1154,17,1154,54,1],[1156,17,1156,38,0],[1158,13,1158,20,1],[1158,22,1158,33,1],[1158,34,1158,36,1],[1158,37,1158,70,1],[1159,13,1159,14,1],[1160,17,1160,45,1],[1161,17,1161,18,1],[1162,21,1162,65,1],[1164,21,1164,62,1],[1165,25,1165,86,1],[1167,21,1167,79,1],[1168,21,1168,36,1],[1169,21,1169,22,1],[1170,25,1170,74,1],[1171,25,1171,41,1],[1172,25,1172,26,1],[1173,29,1173,52,1],[1174,29,1174,63,1],[1175,29,1175,49,1],[1176,29,1176,50,1],[1177,25,1177,26,1],[1178,25,1179,93,1],[1180,25,1180,26,0],[1181,29,1181,52,0],[1182,29,1182,63,0],[1183,29,1183,60,0],[1184,29,1184,50,0],[1185,25,1185,26,0],[1186,25,1187,94,1],[1188,25,1188,26,0],[1189,29,1189,52,0],[1190,29,1190,63,0],[1191,29,1191,61,0],[1192,29,1192,50,0],[1193,25,1193,26,0],[1194,21,1194,22,1],[1195,17,1195,18,1],[1196,13,1196,14,1],[1199,13,1199,113,1],[1200,13,1202,81,1],[1203,13,1203,114,1],[1204,13,1204,112,1],[1205,13,1207,82,1],[1211,13,1211,110,1],[1212,13,1212,104,1],[1213,13,1213,105,1],[1216,13,1216,44,1],[1217,13,1217,34,1],[1219,18,1219,27,1],[1219,29,1219,59,1],[1219,61,1219,64,1],[1220,13,1220,14,1],[1221,17,1221,70,1],[1222,17,1222,58,1],[1223,17,1223,58,1],[1224,17,1224,65,1],[1226,17,1226,36,1],[1227,13,1227,14,1],[1228,13,1228,39,1],[1229,13,1229,14,0],[1230,17,1230,37,0],[1231,17,1231,43,0],[1232,17,1232,28,0],[1233,17,1233,36,0],[1234,13,1234,14,0],[1236,13,1236,24,1],[1237,9,1237,10,1],[1240,9,1240,10,0],[1241,13,1242,38,0],[1243,9,1243,10,0],[1338,9,1338,10,0],[1339,13,1339,46,0],[1340,13,1340,61,0],[1343,13,1343,123,0],[1345,18,1345,27,0],[1345,29,1345,43,0],[1345,45,1345,48,0],[1346,13,1346,14,0],[1347,17,1347,43,0],[1348,17,1348,106,0],[1349,17,1349,102,0],[1352,17,1352,50,0],[1353,17,1353,18,0],[1354,21,1354,42,0],[1355,21,1355,50,0],[1356,21,1356,84,0],[1357,21,1357,41,0],[1358,21,1358,110,0],[1359,21,1359,76,0],[1360,21,1360,119,0],[1361,21,1361,108,0],[1362,21,1362,116,0],[1363,21,1366,77,0],[1367,21,1367,97,0],[1368,21,1368,82,0],[1374,21,1374,37,0],[1375,17,1375,18,0],[1377,17,1378,81,0],[1380,17,1380,34,0],[1381,17,1381,121,0],[1382,17,1382,108,0],[1383,17,1383,79,0],[1385,17,1385,49,0],[1386,21,1386,41,0],[1387,13,1387,14,0],[1389,13,1389,95,0],[1390,9,1390,10,0],[1393,9,1393,10,0],[1394,13,1394,85,0],[1396,13,1396,100,0],[1397,13,1397,38,0],[1398,13,1398,43,0],[1399,13,1399,108,0],[1400,13,1400,108,0],[1401,13,1401,110,0],[1402,13,1402,110,0],[1403,13,1403,102,0],[1404,13,1404,104,0],[1405,13,1405,104,0],[1406,13,1406,104,0],[1407,13,1407,100,0],[1408,13,1408,104,0],[1410,13,1410,54,0],[1411,9,1411,10,0],[1414,9,1414,10,0],[1415,18,1415,27,0],[1415,29,1415,44,0],[1415,46,1415,49,0],[1416,13,1416,14,0],[1417,17,1419,63,0],[1420,17,1420,18,0],[1421,21,1421,37,0],[1422,21,1422,33,0],[1424,13,1424,14,0],[1425,13,1425,26,0],[1426,9,1426,10,0],[1429,9,1429,10,0],[1430,18,1430,27,0],[1430,29,1430,49,0],[1430,51,1430,54,0],[1431,13,1431,14,0],[1432,17,1432,111,0],[1433,21,1433,42,0],[1434,13,1434,14,0],[1435,13,1435,25,0],[1436,9,1436,10,0],[1443,9,1443,10,1],[1444,13,1444,63,1],[1458,13,1458,53,1],[1460,13,1460,68,1],[1461,13,1461,49,1],[1462,13,1462,50,1],[1464,13,1464,75,1],[1465,13,1465,14,0],[1466,17,1466,42,0],[1468,17,1468,46,0],[1469,13,1469,14,0],[1471,13,1471,14,1],[1472,17,1472,41,1],[1473,17,1473,47,1],[1475,13,1475,14,1],[1476,13,1476,38,1],[1477,13,1477,86,1],[1479,13,1479,40,1],[1480,13,1480,75,1],[1481,13,1481,43,1],[1482,13,1482,41,1],[1483,13,1483,40,1],[1484,13,1484,40,1],[1485,9,1485,10,1],[1488,9,1488,10,0],[1489,13,1489,59,0],[1490,13,1490,36,0],[1492,13,1492,44,0],[1493,17,1493,43,0],[1495,13,1495,63,0],[1496,13,1496,91,0],[1497,13,1497,14,0],[1498,17,1498,44,0],[1499,17,1499,79,0],[1500,17,1500,47,0],[1501,17,1501,45,0],[1502,17,1502,44,0],[1503,17,1503,44,0],[1504,17,1504,57,0],[1505,13,1505,14,0],[1507,13,1507,14,0],[1508,17,1508,100,0],[1509,17,1509,18,0],[1510,21,1510,48,0],[1511,21,1511,83,0],[1512,21,1512,51,0],[1513,21,1513,49,0],[1514,21,1514,48,0],[1515,21,1515,48,0],[1516,21,1516,51,0],[1517,25,1517,66,0],[1522,17,1522,18,0],[1524,17,1524,18,0],[1525,21,1525,61,0],[1526,21,1526,47,0],[1527,21,1527,47,0],[1528,21,1528,40,0],[1530,21,1530,48,0],[1532,21,1532,99,0],[1534,21,1536,47,0],[1538,21,1538,44,0],[1539,21,1539,22,0],[1540,25,1540,54,0],[1541,25,1541,53,0],[1542,25,1542,47,0],[1543,25,1543,78,0],[1545,25,1545,55,0],[1546,29,1546,65,0],[1548,29,1548,92,0],[1550,25,1550,32,0],[1550,34,1550,53,0],[1550,54,1550,56,0],[1550,57,1550,75,0],[1551,25,1551,26,0],[1552,29,1552,58,0],[1553,25,1553,26,0],[1555,21,1555,22,0],[1557,21,1557,22,0],[1558,25,1558,87,0],[1559,25,1559,55,0],[1560,21,1560,22,0],[1561,17,1561,18,0],[1562,13,1562,14,0],[1563,13,1563,35,0],[1564,9,1564,10,0],[1567,9,1567,10,0],[1568,13,1568,43,0],[1569,17,1569,24,0],[1572,13,1572,61,0],[1573,17,1573,33,0],[1575,13,1575,23,0],[1577,20,1577,44,0],[1577,46,1577,49,0],[1578,13,1578,14,0],[1579,17,1579,106,0],[1580,21,1580,27,0],[1581,13,1581,14,0],[1585,13,1585,53,0],[1586,13,1586,59,0],[1587,13,1587,118,0],[1589,13,1589,48,0],[1591,18,1591,27,0],[1591,29,1591,54,0],[1591,56,1591,59,0],[1592,13,1592,14,0],[1593,17,1593,89,0],[1594,21,1594,102,0],[1595,13,1595,14,0],[1597,13,1597,43,0],[1598,13,1598,41,0],[1599,13,1599,40,0],[1600,13,1600,40,0],[1602,13,1602,71,0],[1603,17,1603,44,0],[1605,17,1605,44,0],[1607,13,1607,40,0],[1608,13,1608,45,0],[1609,13,1609,35,0],[1611,13,1611,35,0],[1612,9,1612,10,0],[1615,9,1615,10,0],[1616,13,1616,51,0],[1618,13,1618,29,0],[1619,17,1619,24,0],[1621,18,1621,27,0],[1621,29,1621,53,0],[1621,55,1621,58,0],[1622,13,1622,14,0],[1623,17,1623,119,0],[1624,17,1624,18,0],[1625,21,1625,51,0],[1626,21,1626,22,0],[1627,25,1627,113,0],[1628,29,1628,68,0],[1629,21,1629,22,0],[1631,21,1631,22,0],[1632,25,1632,114,0],[1633,29,1633,49,0],[1634,21,1634,22,0],[1635,17,1635,18,0],[1636,13,1636,14,0],[1637,9,1637,10,0],[1640,9,1640,10,0],[1641,13,1641,43,0],[1642,17,1642,24,0],[1645,13,1645,61,0],[1646,17,1646,33,0],[1648,13,1648,42,0],[1649,13,1649,53,0],[1650,13,1650,59,0],[1651,13,1651,118,0],[1654,13,1654,14,0],[1655,17,1655,48,0],[1658,25,1658,55,0],[1659,25,1659,31,0],[1661,25,1661,55,0],[1662,25,1662,31,0],[1664,25,1664,58,0],[1665,25,1665,31,0],[1667,25,1667,31,0],[1669,25,1670,114,0],[1671,25,1671,26,0],[1672,25,1672,31,0],[1674,25,1674,49,0],[1675,25,1675,31,0],[1677,13,1677,14,0],[1678,13,1678,18,0],[1679,13,1679,14,0],[1680,17,1680,38,0],[1681,17,1684,103,0],[1685,17,1685,91,0],[1686,17,1686,24,0],[1689,13,1689,48,0],[1691,13,1691,50,0],[1693,13,1693,46,0],[1695,13,1695,40,0],[1697,13,1697,40,0],[1698,13,1698,45,0],[1699,13,1699,53,0],[1700,13,1700,35,0],[1702,13,1702,35,0],[1703,9,1703,10,0],[1706,9,1706,10,0],[1707,13,1707,43,0],[1708,17,1708,24,0],[1712,13,1712,61,0],[1713,17,1713,24,0],[1715,13,1715,23,0],[1717,20,1717,44,0],[1717,46,1717,49,0],[1718,13,1718,14,0],[1719,17,1719,60,0],[1720,21,1720,27,0],[1721,13,1721,14,0],[1723,13,1723,43,0],[1724,17,1724,24,0],[1726,13,1726,40,0],[1728,13,1728,40,0],[1730,13,1730,40,0],[1731,13,1731,75,0],[1732,13,1732,43,0],[1733,13,1733,41,0],[1734,13,1734,40,0],[1735,13,1735,40,0],[1736,13,1736,53,0],[1738,13,1738,35,0],[1739,13,1739,35,0],[1740,9,1740,10,0],[1743,9,1743,10,0],[1748,13,1748,58,0],[1749,13,1749,59,0],[1750,9,1750,10,0],[1753,9,1753,10,0],[1754,13,1754,43,0],[1755,17,1755,24,0],[1757,13,1757,58,0],[1758,13,1758,51,0],[1760,13,1760,23,0],[1762,20,1762,44,0],[1762,46,1762,49,0],[1763,13,1763,14,0],[1764,17,1764,60,0],[1765,21,1765,27,0],[1766,13,1766,14,0],[1767,13,1767,43,0],[1768,17,1768,24,0],[1770,13,1770,50,0],[1771,13,1771,35,0],[1773,13,1773,56,0],[1775,13,1775,40,0],[1776,13,1776,35,0],[1777,13,1777,35,0],[1780,9,1780,10,0],[1783,9,1783,10,1],[1785,13,1785,61,1],[1786,13,1786,14,0],[1787,17,1787,64,0],[1788,17,1788,24,0],[1791,13,1791,47,1],[1792,13,1792,42,1],[1793,13,1793,14,0],[1798,17,1798,41,0],[1800,17,1800,42,0],[1801,17,1801,44,0],[1802,17,1802,34,0],[1804,17,1804,42,0],[1805,17,1805,40,0],[1806,17,1806,32,0],[1807,17,1807,34,0],[1809,17,1809,51,0],[1811,17,1811,24,0],[1811,26,1811,40,0],[1811,41,1811,43,0],[1811,44,1811,58,0],[1812,17,1812,18,0],[1813,21,1813,43,0],[1814,21,1814,46,0],[1816,21,1816,45,0],[1819,21,1819,34,0],[1821,21,1821,46,0],[1822,21,1822,46,0],[1823,21,1823,38,0],[1828,21,1828,46,0],[1829,21,1829,55,0],[1830,21,1830,22,0],[1831,25,1832,59,0],[1834,25,1834,42,0],[1836,25,1836,55,0],[1837,25,1837,26,0],[1838,29,1838,59,0],[1840,29,1841,62,0],[1842,29,1842,47,0],[1843,25,1843,26,0],[1844,21,1844,22,0],[1846,21,1846,22,0],[1847,25,1847,61,0],[1848,25,1848,55,0],[1849,25,1849,26,0],[1850,29,1850,62,0],[1851,29,1851,55,0],[1852,29,1852,59,0],[1853,29,1854,120,0],[1855,29,1855,70,0],[1856,29,1856,49,0],[1857,29,1857,56,0],[1858,25,1858,26,0],[1860,25,1860,26,0],[1861,29,1861,68,0],[1862,29,1862,59,0],[1863,29,1863,49,0],[1864,25,1864,26,0],[1865,25,1865,42,0],[1868,25,1868,66,0],[1869,25,1869,26,0],[1870,29,1870,59,0],[1871,29,1871,30,0],[1872,33,1872,58,0],[1873,33,1873,57,0],[1875,33,1876,86,0],[1878,33,1878,50,0],[1879,29,1879,30,0],[1880,25,1880,26,0],[1881,21,1881,22,0],[1883,21,1883,51,0],[1884,21,1884,22,0],[1885,25,1885,50,0],[1887,25,1888,59,0],[1889,25,1889,42,0],[1891,25,1891,50,0],[1892,25,1892,48,0],[1893,25,1893,57,0],[1894,25,1894,42,0],[1895,21,1895,22,0],[1896,21,1896,55,0],[1897,17,1897,18,0],[1898,17,1898,82,0],[1899,13,1899,14,0],[1901,13,1901,14,1],[1902,17,1902,64,1],[1903,13,1903,14,1],[1904,9,1904,10,1],[1911,9,1911,10,1],[1912,13,1912,38,1],[1914,13,1914,40,1],[1915,13,1915,43,1],[1917,13,1917,82,1],[1918,13,1918,42,1],[1919,13,1919,34,1],[1921,13,1921,20,1],[1921,22,1921,37,1],[1921,38,1921,40,1],[1921,41,1921,75,1],[1922,13,1922,14,1],[1923,17,1923,24,1],[1923,26,1923,43,1],[1923,44,1923,46,1],[1923,47,1923,65,1],[1924,17,1924,18,1],[1925,21,1925,59,1],[1926,21,1926,60,1],[1927,21,1927,22,1],[1928,25,1928,65,1],[1929,25,1929,58,1],[1930,25,1930,54,1],[1931,25,1931,50,1],[1932,21,1932,22,1],[1933,17,1933,18,1],[1934,13,1934,14,1],[1938,13,1938,29,1],[1940,13,1940,20,1],[1940,22,1940,37,1],[1940,38,1940,40,1],[1940,41,1940,75,1],[1941,13,1941,14,1],[1942,17,1942,59,1],[1944,17,1944,61,1],[1945,17,1945,93,1],[1947,17,1947,24,1],[1947,26,1947,43,1],[1947,44,1947,46,1],[1947,47,1947,65,1],[1948,17,1948,18,1],[1949,21,1949,59,1],[1950,21,1950,62,1],[1952,21,1952,54,1],[1953,21,1953,22,1],[1954,25,1954,47,1],[1955,29,1955,50,1],[1957,25,1957,26,1],[1958,29,1958,36,1],[1958,38,1958,48,1],[1958,49,1958,51,1],[1958,52,1958,89,1],[1959,29,1959,30,1],[1960,33,1960,71,1],[1961,33,1961,34,1],[1962,37,1962,86,1],[1963,37,1963,38,0],[1964,41,1964,62,0],[1965,41,1965,53,0],[1966,37,1966,38,0],[1967,33,1967,34,1],[1968,29,1968,30,1],[1970,29,1970,46,1],[1971,33,1971,55,1],[1973,33,1973,45,0],[1974,25,1974,26,1],[1975,21,1975,22,1],[1977,21,1977,22,0],[1978,25,1978,47,0],[1979,29,1979,50,0],[1981,29,1981,51,0],[1982,21,1982,22,0],[1983,17,1983,18,1],[1984,17,1984,37,1],[1985,13,1985,14,1],[2033,13,2033,49,1],[2034,13,2034,44,1],[2035,13,2035,91,1],[2037,13,2037,43,1],[2038,13,2038,14,1],[2039,17,2039,100,1],[2040,13,2040,14,1],[2041,9,2041,10,1],[2048,9,2048,10,0],[2049,13,2049,79,0],[2050,13,2050,64,0],[2051,13,2051,14,0],[2053,17,2054,115,0],[2055,17,2055,24,0],[2057,13,2057,71,0],[2058,13,2058,14,0],[2060,17,2061,59,0],[2062,17,2062,24,0],[2065,13,2065,82,0],[2076,13,2076,41,0],[2077,13,2077,14,0],[2078,17,2078,42,0],[2079,17,2079,18,0],[2080,21,2086,51,0],[2087,21,2087,51,0],[2088,17,2088,18,0],[2089,13,2089,14,0],[2090,18,2092,81,0],[2093,13,2093,14,0],[2094,17,2094,65,0],[2095,17,2095,18,0],[2096,21,2096,67,0],[2097,21,2097,74,0],[2100,17,2100,18,0],[2101,13,2101,14,0],[2102,9,2102,10,0],[2105,9,2105,10,0],[2106,13,2106,79,0],[2107,18,2107,27,0],[2107,29,2107,59,0],[2107,61,2107,64,0],[2108,13,2108,14,0],[2109,17,2109,36,0],[2109,37,2109,46,0],[2110,17,2112,89,0],[2113,17,2113,18,0],[2114,21,2114,42,0],[2115,21,2115,22,0],[2117,25,2119,117,0],[2120,25,2120,38,0],[2123,13,2123,14,0],[2124,13,2124,25,0],[2125,9,2125,10,0],[2128,9,2128,10,0],[2130,13,2131,81,0],[2132,17,2132,24,0],[2133,13,2135,70,0],[2136,13,2136,35,0],[2137,17,2137,24,0],[2139,13,2139,26,0],[2140,9,2140,10,0],[2143,9,2143,10,0],[2144,9,2144,10,0],[2147,9,2147,10,0],[2148,9,2148,10,0],[2155,9,2155,10,1],[2156,13,2156,43,1],[2157,13,2157,79,1],[2158,13,2158,79,1],[2159,13,2159,31,1],[2159,33,2159,46,1],[2160,13,2160,28,1],[2161,13,2161,39,1],[2162,13,2162,109,1],[2163,13,2163,54,1],[2164,13,2164,14,1],[2165,17,2165,96,1],[2166,17,2167,124,1],[2169,17,2169,119,1],[2170,17,2170,72,1],[2171,21,2171,41,1],[2173,21,2173,42,1],[2174,13,2174,14,1],[2175,13,2175,29,1],[2176,17,2176,37,1],[2177,13,2177,73,1],[2178,13,2178,73,1],[2179,13,2179,60,1],[2180,13,2180,66,1],[2181,13,2181,65,1],[2182,13,2182,64,1],[2183,13,2183,24,1],[2184,9,2184,10,1],[2191,9,2191,10,0],[2192,13,2192,30,0],[2193,9,2193,10,0],[2196,9,2196,10,0],[2197,13,2197,30,0],[2198,9,2198,10,0],[2201,9,2201,10,1],[2202,13,2202,72,1],[2203,9,2203,10,1],[2206,9,2206,10,0],[2207,13,2207,38,0],[2208,13,2208,73,0],[2210,13,2210,38,0],[2211,13,2211,73,0],[2212,9,2212,10,0],[2215,9,2215,10,1],[2216,13,2216,36,1],[2217,17,2217,80,1],[2219,17,2219,73,0],[2220,9,2220,10,1],[2223,9,2223,10,0],[2224,13,2224,75,0],[2225,9,2225,10,0],[2228,9,2228,10,0],[2229,13,2229,38,0],[2231,13,2231,71,0],[2233,13,2233,49,0],[2234,13,2234,14,0],[2235,17,2235,44,0],[2236,17,2236,59,0],[2237,17,2237,65,0],[2238,17,2238,39,0],[2239,13,2239,14,0],[2241,13,2241,73,0],[2242,9,2242,10,0],[2245,9,2245,62,1],[2248,9,2248,10,1],[2249,13,2249,26,1],[2250,13,2250,14,1],[2252,17,2252,18,1],[2254,21,2254,44,1],[2255,21,2255,22,1],[2256,25,2256,49,1],[2257,25,2257,53,1],[2257,55,2257,76,1],[2260,25,2260,97,1],[2261,29,2261,47,1],[2264,25,2266,85,1],[2267,25,2269,99,1],[2270,25,2270,40,1],[2271,29,2273,103,1],[2275,29,2275,65,0],[2278,25,2278,77,1],[2279,25,2279,53,1],[2280,25,2280,106,1],[2281,29,2281,97,0],[2283,25,2283,71,1],[2284,25,2284,26,1],[2285,29,2287,108,1],[2288,29,2288,36,1],[2288,38,2288,45,1],[2288,46,2288,48,1],[2288,49,2288,71,1],[2289,29,2289,30,1],[2290,33,2290,78,1],[2291,33,2291,34,1],[2292,37,2292,68,1],[2295,37,2295,38,1],[2296,41,2313,95,1],[2314,37,2314,38,1],[2315,37,2315,57,0],[2316,37,2316,38,0],[2317,41,2317,85,0],[2318,45,2319,123,0],[2321,45,2325,87,0],[2327,41,2327,48,0],[2330,37,2330,85,1],[2332,37,2332,67,1],[2334,37,2334,109,1],[2335,41,2336,81,1],[2338,37,2339,93,1],[2340,37,2341,110,1],[2342,37,2343,93,1],[2344,37,2345,110,1],[2346,37,2347,109,1],[2348,37,2349,109,1],[2350,37,2350,155,1],[2351,37,2352,112,1],[2353,37,2354,87,1],[2355,37,2356,129,1],[2357,37,2358,113,1],[2359,37,2359,72,1],[2361,37,2361,92,1],[2363,37,2363,94,1],[2364,37,2364,38,1],[2365,41,2365,67,1],[2366,41,2366,66,1],[2370,46,2370,55,1],[2370,57,2370,87,1],[2370,89,2370,92,1],[2371,41,2371,42,1],[2372,45,2372,82,1],[2374,45,2382,103,1],[2383,41,2383,42,1],[2385,41,2385,67,1],[2387,41,2387,74,1],[2388,41,2388,42,1],[2389,45,2389,129,1],[2390,45,2390,74,1],[2392,50,2392,59,1],[2392,61,2392,85,1],[2392,87,2392,90,0],[2393,45,2393,46,0],[2394,49,2395,88,0],[2397,54,2397,63,0],[2397,65,2397,99,0],[2397,101,2397,104,0],[2398,49,2398,50,0],[2399,53,2400,139,0],[2401,49,2401,50,0],[2403,49,2403,89,0],[2404,45,2404,46,0],[2406,45,2406,75,1],[2407,41,2407,42,1],[2409,41,2409,96,1],[2410,37,2410,38,1],[2412,37,2412,71,1],[2414,37,2416,93,1],[2418,37,2418,60,1],[2419,37,2419,38,0],[2420,41,2420,141,0],[2421,41,2421,48,0],[2423,37,2423,101,1],[2425,37,2425,71,1],[2426,37,2426,76,1],[2429,37,2429,106,1],[2431,41,2431,86,0],[2433,37,2433,92,1],[2435,37,2436,111,1],[2437,41,2437,76,1],[2439,37,2441,67,1],[2443,37,2443,102,1],[2444,41,2444,69,0],[2445,37,2445,60,1],[2446,41,2446,79,1],[2448,37,2448,127,1],[2450,37,2450,120,1],[2451,37,2462,40,1],[2463,37,2463,134,1],[2464,37,2464,54,1],[2465,37,2465,38,1],[2466,41,2466,97,1],[2467,41,2467,135,1],[2468,41,2468,95,1],[2469,37,2469,38,1],[2471,37,2471,38,0],[2472,41,2472,201,0],[2473,37,2473,38,0],[2476,37,2476,79,1],[2477,37,2477,38,1],[2479,41,2479,145,1],[2480,45,2480,67,1],[2481,49,2481,133,1],[2482,37,2482,38,1],[2483,37,2483,44,1],[2483,46,2483,56,1],[2483,57,2483,59,1],[2483,60,2483,72,1],[2484,41,2484,146,1],[2485,37,2485,142,1],[2487,37,2492,63,1],[2494,37,2494,85,1],[2495,37,2495,79,1],[2496,37,2496,76,1],[2498,37,2498,106,1],[2499,37,2499,38,0],[2500,41,2500,90,0],[2501,41,2502,107,0],[2503,41,2504,128,0],[2505,41,2505,117,0],[2506,41,2509,120,0],[2510,41,2513,82,0],[2514,41,2514,100,0],[2515,37,2515,38,0],[2517,37,2522,99,1],[2523,37,2523,43,0],[2525,29,2525,30,1],[2526,25,2526,26,0],[2528,25,2528,26,0],[2529,29,2530,97,0],[2531,29,2531,102,0],[2532,25,2532,26,0],[2533,21,2533,22,0],[2534,17,2534,18,0],[2535,17,2535,46,0],[2536,17,2536,18,0],[2537,21,2537,131,0],[2538,17,2538,18,0],[2539,17,2539,37,1],[2540,17,2540,18,1],[2541,21,2541,89,1],[2542,21,2542,82,1],[2543,21,2543,92,1],[2544,17,2544,18,1],[2545,13,2545,14,1],[2546,9,2546,10,0],[2549,9,2549,10,1],[2551,13,2551,14,1],[2552,17,2552,78,1],[2552,78,2552,115,1],[2552,115,2552,117,1],[2552,17,2552,117,1],[2554,17,2554,40,1],[2554,41,2554,48,0],[2556,17,2556,95,1],[2557,17,2557,60,1],[2558,17,2558,66,1],[2559,17,2559,40,1],[2561,17,2561,50,1],[2562,17,2562,18,0],[2563,21,2563,85,0],[2564,21,2564,84,0],[2565,21,2565,70,0],[2566,17,2566,18,0],[2568,17,2568,18,1],[2569,21,2569,82,1],[2570,21,2570,69,1],[2571,21,2571,85,1],[2572,17,2572,18,1],[2573,13,2573,14,1],[2574,13,2574,32,0],[2575,13,2575,14,0],[2576,17,2576,134,0],[2577,13,2577,14,0],[2578,9,2578,10,1],[2581,9,2581,10,1],[2583,13,2583,14,1],[2584,17,2584,119,1],[2585,17,2585,61,1],[2586,17,2586,53,1],[2587,17,2587,39,1],[2589,17,2589,49,1],[2590,17,2590,18,1],[2591,21,2591,85,1],[2592,21,2592,48,1],[2593,17,2593,18,1],[2595,17,2595,18,0],[2596,21,2596,47,0],[2597,17,2597,18,0],[2598,13,2598,14,1],[2599,13,2599,30,0],[2600,13,2600,14,0],[2601,13,2601,14,0],[2602,9,2602,10,1],[2609,9,2609,10,1],[2610,13,2610,108,1],[2612,13,2612,41,1],[2613,13,2613,34,1],[2614,13,2614,76,1],[2617,13,2619,94,1],[2620,13,2620,48,1],[2621,13,2624,118,1],[2625,13,2625,64,1],[2627,13,2627,68,1],[2628,17,2628,84,0],[2633,13,2633,82,1],[2634,17,2634,86,0],[2636,13,2636,74,1],[2636,74,2636,111,1],[2636,111,2636,113,1],[2636,13,2636,113,1],[2638,13,2638,71,1],[2639,17,2639,88,1],[2640,13,2640,44,1],[2641,13,2641,40,1],[2642,9,2642,10,1],[2645,9,2645,10,1],[2646,13,2646,31,1],[2647,13,2647,14,1],[2648,17,2648,78,1],[2649,17,2649,37,1],[2650,17,2650,18,1],[2651,21,2651,60,1],[2652,21,2652,56,1],[2653,17,2653,18,1],[2654,13,2654,14,1],[2656,13,2656,86,1],[2657,13,2657,33,1],[2658,13,2658,14,1],[2659,17,2659,56,1],[2660,17,2660,50,1],[2661,13,2661,14,1],[2663,13,2663,66,1],[2664,13,2664,14,0],[2665,17,2665,82,0],[2666,17,2666,83,0],[2667,13,2667,14,0],[2669,13,2669,67,1],[2670,13,2670,14,0],[2671,17,2671,82,0],[2672,17,2672,84,0],[2673,13,2673,14,0],[2675,13,2675,90,1],[2676,13,2676,35,1],[2677,13,2677,14,1],[2678,17,2678,73,1],[2679,17,2679,61,1],[2680,17,2680,52,1],[2681,13,2681,14,1],[2683,13,2683,50,1],[2684,13,2684,38,1],[2685,17,2685,78,0],[2686,9,2686,10,1],[2689,9,2689,10,1],[2690,13,2690,85,1],[2691,13,2691,14,1],[2692,17,2692,35,1],[2693,17,2693,18,1],[2694,21,2694,82,1],[2695,21,2695,41,1],[2696,21,2696,22,1],[2697,25,2697,57,1],[2698,21,2698,22,1],[2699,17,2699,18,1],[2700,13,2700,14,1],[2702,13,2703,87,1],[2704,13,2704,14,1],[2705,17,2705,69,1],[2706,21,2706,53,1],[2707,17,2707,70,1],[2708,21,2708,54,0],[2709,13,2709,14,1],[2710,13,2710,41,1],[2711,17,2711,51,1],[2713,13,2713,33,1],[2716,13,2716,89,1],[2717,13,2717,117,1],[2718,17,2718,49,0],[2719,13,2719,64,1],[2720,17,2720,49,0],[2722,13,2722,50,1],[2723,13,2723,38,1],[2724,17,2724,55,0],[2725,9,2725,10,1],[2730,9,2730,10,1],[2731,13,2731,95,1],[2732,13,2732,96,1],[2733,13,2733,95,1],[2734,13,2734,95,1],[2735,13,2735,96,1],[2736,13,2736,95,1],[2738,13,2738,91,1],[2739,13,2739,92,1],[2741,13,2741,91,1],[2742,13,2742,92,1],[2744,13,2744,87,1],[2745,13,2745,88,1],[2746,13,2746,87,1],[2748,13,2748,89,1],[2749,13,2749,90,1],[2750,13,2750,89,1],[2752,13,2752,94,1],[2753,13,2753,87,1],[2755,13,2755,93,1],[2756,13,2756,87,1],[2758,13,2758,98,1],[2759,13,2759,88,1],[2761,13,2761,117,1],[2762,13,2762,14,0],[2763,17,2763,96,0],[2764,17,2764,96,0],[2765,13,2765,14,0],[2767,13,2767,99,1],[2768,13,2768,94,1],[2774,13,2774,94,1],[2775,13,2775,94,1],[2777,13,2777,87,1],[2778,13,2778,87,1],[2780,13,2780,87,1],[2781,13,2781,87,1],[2783,13,2783,87,1],[2784,13,2784,87,1],[2786,13,2786,88,1],[2787,13,2787,88,1],[2789,13,2789,88,1],[2790,13,2790,88,1],[2792,13,2792,88,1],[2793,13,2793,88,1],[2795,13,2795,88,1],[2796,13,2796,88,1],[2798,13,2798,88,1],[2799,13,2799,88,1],[2801,13,2801,93,1],[2802,13,2802,91,1],[2804,13,2804,89,1],[2805,13,2805,90,1],[2806,13,2806,92,1],[2809,13,2809,95,1],[2810,13,2810,87,1],[2811,13,2811,90,1],[2812,9,2812,10,1],[2815,9,2815,10,1],[2816,13,2816,91,1],[2817,13,2817,91,1],[2818,13,2818,91,1],[2819,13,2819,90,1],[2821,13,2821,95,1],[2822,13,2822,95,1],[2824,13,2824,95,1],[2825,13,2825,95,1],[2827,13,2827,89,1],[2828,13,2828,88,1],[2829,9,2829,10,1],[2832,9,2832,10,1],[2833,13,2833,74,1],[2835,13,2835,70,1],[2836,17,2836,24,0],[2838,13,2838,80,1],[2839,13,2839,46,1],[2840,17,2840,57,0],[2842,13,2842,14,1],[2843,17,2843,94,1],[2845,17,2845,36,1],[2846,17,2846,18,0],[2847,21,2847,98,0],[2848,21,2848,46,0],[2849,25,2849,54,0],[2850,17,2850,18,0],[2851,13,2851,14,1],[2852,9,2852,10,1],[2855,9,2855,10,1],[2856,13,2856,47,1],[2857,13,2857,14,0],[2858,17,2858,47,0],[2859,17,2859,53,0],[2860,13,2860,14,0],[2862,13,2862,14,1],[2863,17,2863,48,1],[2864,17,2864,53,1],[2865,13,2865,14,1],[2867,13,2867,45,1],[2868,17,2868,62,1],[2869,9,2869,10,1],[2872,9,2872,10,0],[2873,13,2873,37,0],[2874,13,2874,30,0],[2875,9,2875,10,0],[2878,9,2878,10,0],[2879,13,2879,30,0],[2880,13,2880,30,0],[2881,13,2881,37,0],[2882,9,2882,10,0],[2885,9,2885,10,0],[2886,13,2886,30,0],[2887,9,2887,10,0],[2890,9,2890,10,0],[2891,13,2891,75,0],[2892,17,2892,34,0],[2893,9,2893,10,0],[2896,9,2896,10,1],[2897,13,2897,30,1],[2898,9,2898,10,1],[2901,9,2901,41,1],[2905,13,2905,14,0],[2906,17,2906,50,0],[2907,21,2907,68,0],[2908,17,2908,86,0],[2909,13,2909,14,0],[2914,9,2914,10,1],[2915,13,2915,44,1],[2917,13,2917,131,1],[2918,17,2918,99,0],[2920,13,2920,57,1],[2921,13,2921,14,1],[2922,17,2922,38,1],[2923,17,2923,18,1],[2924,21,2924,87,1],[2926,21,2926,88,1],[2927,21,2927,84,1],[2928,21,2928,72,1],[2930,21,2930,62,1],[2931,17,2931,18,1],[2933,17,2933,128,1],[2934,17,2934,18,0],[2935,21,2935,159,0],[2936,21,2936,47,0],[2937,17,2937,18,0],[2938,13,2938,14,1],[2939,13,2939,30,1],[2940,9,2940,10,1],[2943,9,2943,10,1],[2946,13,2946,61,1],[2947,13,2947,57,1],[2949,13,2949,40,1],[2950,17,2950,70,1],[2952,13,2952,47,1],[2953,13,2953,14,0],[2954,17,2954,91,0],[2956,17,2956,63,0],[2957,21,2957,163,0],[2958,17,2958,108,0],[2959,21,2959,174,0],[2960,13,2960,14,0],[2962,13,2962,14,1],[2963,17,2963,63,1],[2964,21,2964,130,0],[2965,17,2965,108,1],[2966,21,2966,168,1],[2967,13,2967,14,1],[2968,9,2968,10,1],[2971,9,2971,10,1],[2972,13,2972,52,1],[2974,13,2974,73,1],[2975,13,2975,14,1],[2976,17,2976,67,1],[2977,13,2977,14,1],[2979,13,2979,30,1],[2981,9,2981,10,1],[2984,9,2984,10,1],[2985,13,2985,71,1],[2986,13,2986,38,1],[2987,13,2987,14,1],[2988,17,2988,95,1],[2989,21,2989,108,0],[2991,17,2991,74,1],[2993,17,2993,57,1],[2994,17,2994,54,1],[2996,17,2996,51,1],[2997,21,2997,76,0],[2999,17,2999,51,1],[3000,21,3000,38,0],[3002,17,3002,60,1],[3003,17,3003,50,1],[3004,13,3004,14,1],[3005,9,3005,10,1],[3008,9,3008,10,1],[3010,13,3010,14,1],[3011,17,3011,59,1],[3012,13,3012,14,1],[3013,13,3013,18,0],[3014,13,3014,14,0],[3015,17,3015,30,0],[3017,13,3017,25,1],[3018,9,3018,10,1],[3021,9,3021,10,1],[3022,13,3022,55,1],[3023,13,3025,80,1],[3026,13,3026,14,1],[3027,17,3027,66,1],[3028,21,3028,96,1],[3030,21,3030,31,0],[3033,17,3033,58,0],[3034,9,3034,10,1],[3040,17,3040,18,1],[3040,19,3040,114,1],[3040,115,3040,116,1],[3046,13,3046,14,0],[3047,17,3047,37,0],[3048,13,3048,14,0],[3050,13,3050,14,0],[3050,15,3050,16,0],[3054,9,3054,10,0],[3054,11,3054,12,0],[3056,89,3056,90,0],[3056,91,3056,92,0],[3058,51,3058,55,0],[3058,56,3058,60,0],[3065,9,3065,10,1],[3066,13,3066,101,1],[3067,13,3067,37,1],[3068,13,3068,14,1],[3069,17,3069,47,1],[3070,17,3070,52,1],[3071,17,3071,18,0],[3072,21,3072,67,0],[3073,17,3073,18,0],[3074,13,3074,14,1],[3075,9,3075,10,1],[3078,9,3078,10,1],[3079,13,3079,40,1],[3080,13,3080,14,1],[3081,17,3081,60,1],[3082,17,3082,47,1],[3084,17,3084,59,1],[3085,17,3085,18,0],[3086,21,3086,42,0],[3087,17,3087,18,0],[3089,17,3089,49,1],[3090,21,3090,71,1],[3091,25,3091,69,1],[3094,17,3094,204,1],[3095,17,3095,18,0],[3096,21,3096,92,0],[3097,17,3097,18,0],[3099,17,3099,205,1],[3100,17,3100,18,1],[3101,21,3101,93,1],[3102,17,3102,18,1],[3103,13,3103,14,1],[3104,9,3104,10,1]]);
    </script>
  </body>
</html>