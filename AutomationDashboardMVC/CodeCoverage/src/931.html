<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Business Layer\XmlForm Framework\FormComponents\Form.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Aurigo.AMP3.Common;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.Brix.Platform.BusinessLayer.DTO;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Linq;
using System.Text;
using System.Text.RegularExpressions;
using System.Xml.Serialization;

namespace Aurigo.Brix.Platform.BusinessLayer.XMLForm
{
    public class MWConcurrencyException : Exception
    {
        public MWConcurrencyException(string message) : base(message)
        { }
    }

    /// &lt;summary&gt;
    ///  The form is the master container of controls.  It follows all of the rules of any other DataBaseContainer.  The save method 
    ///  of the form saves the data for all of the sections contained in the master table for the form.
    /// &lt;/summary&gt;
    public class Form : DataBaseContainer
    {

        internal const string TIMESTAMP_COLUMN_NAME = &quot;AUR_Timestamp&quot;;

        /// &lt;summary&gt;
        /// defaults to false.  If true an attachment control will be added to the bottom of the form.
        /// &lt;/summary&gt;
        [XmlAttribute(&quot;AllowAttachments&quot;), DefaultValue(false)]
        public bool AllowAttachments;

        /// &lt;summary&gt;
        /// Attribute to decide whether the attachments are collapsible and the default view 
        /// &lt;/summary&gt;
        [XmlAttribute(&quot;AttachmentsVisibility&quot;), DefaultValue(ControlVisibility.None)]
        public ControlVisibility
            AttachmentsVisibility;

        /// &lt;summary&gt;
        /// Attribute to decide whether the attchments are collaspible
        /// &lt;/summary&gt;
        [XmlAttribute(&quot;CollapsibleAttachments&quot;), DefaultValue(false)]
        public bool CollapsibleAttachments;

        /// &lt;summary&gt;
        /// Attribute to specify minimum number of attachments required
        /// &lt;/summary&gt;
        [XmlAttribute(&quot;MinimumNumberOfAttachments&quot;), DefaultValue(0)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public int MinimumNumberOfAttachments;

        /// &lt;summary&gt;
        /// Attribute to specify in which stage the attachments should be validated
        /// &lt;/summary&gt;
        [XmlAttribute(&quot;ValidateAttachmentOnAction&quot;), DefaultValue(&quot;&quot;)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public string ValidateAttachmentOnAction;

        [XmlAttribute(&quot;AssociatedContext&quot;), DefaultValue(&quot;&quot;)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public string AssociatedContext;
        [XmlAttribute(&quot;AssociatedModuleID&quot;), DefaultValue(&quot;&quot;)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public string AssociatedModuleID;

        /// &lt;summary&gt;
        /// this will override the default caption format for all captions on the form
        /// &lt;/summary&gt;
        [XmlAttribute(&quot;CaptionStyle&quot;), DefaultValue(&quot;&quot;)]
        public string CaptionStyle;


        [XmlAttribute(&quot;DropIfExists&quot;), DefaultValue(false)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public bool DropIfExists;


        [XmlAttribute(&quot;EISDataSource&quot;), DefaultValue(&quot;&quot;)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public string EISDataSource;

        [XmlAttribute(&quot;Folder&quot;), DefaultValue(&quot;&quot;)]
        public string Folder;
        [XmlAttribute(&quot;GetDataFromERP&quot;), DefaultValue(false)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public bool GetDataFromERP;
        [XmlAttribute(&quot;Header&quot;), DefaultValue(&quot;&quot;)]
        public string Header;
        [XmlAttribute(&quot;Description&quot;), DefaultValue(&quot;&quot;)]
        public string Description;
        [XmlAttribute(&quot;InstantiateTable&quot;), DefaultValue(true)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public bool InstantiateTable = true;

        [XmlAttribute(&quot;IsActive&quot;), DefaultValue(true)]
        public bool IsActive = true;

        [XmlAttribute(&quot;IsSearchable&quot;), DefaultValue(false)]
        public bool IsSearchable;

        [XmlAttribute(&quot;IsTemplate&quot;), DefaultValue(false)]
        public bool IsTemplate;

        /// &lt;summary&gt;
        /// holds the column names that should be crated in the list model for this form.
        /// &lt;/summary&gt;
        [XmlElement(&quot;ListColumns&quot;)]
        public ListColumns ListColumns = new ListColumns();

        /// &lt;summary&gt;
        /// holds the QR codes.
        /// &lt;/summary&gt;
        [XmlElement(&quot;QRGenerator&quot;)]
        public QRGenerator QRGenerator = new QRGenerator();

        /// &lt;summary&gt;
        /// Holds the list of columns to be displayed in the LinkedInstancesGrid
        /// &lt;/summary&gt;
        [XmlElement(&quot;ReferenceModuleColumns&quot;)]
        public ReferenceModuleColumns ReferenceModuleColumns =
            new ReferenceModuleColumns();

        [XmlAttribute(&quot;FormManagerClass&quot;), DefaultValue(&quot;&quot;)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public string FormManagerClass;
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        [XmlAttribute(&quot;ListManagerClass&quot;), DefaultValue(&quot;&quot;)]
        public string ListManagerClass;
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        [XmlAttribute(&quot;ManagerDLL&quot;), DefaultValue(&quot;&quot;)]
        public string ManagerDLL;

        /// &lt;summary&gt;
        /// The ModuleID of the form
        /// &lt;/summary&gt;
        [XmlAttribute(&quot;ModuleID&quot;), DefaultValue(&quot;&quot;)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public string ModuleID;

        [XmlAttribute(&quot;ModuleType&quot;), DefaultValue(&quot;&quot;)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public string ModuleType;

        //To specify the folder name under which the link should be placed.
        [XmlAttribute(&quot;ParentFolderPath&quot;), DefaultValue(&quot;&quot;)]
        public string ParentFolderPath;

        /// &lt;summary&gt;
        /// the parent ModuleID of this form.  This can be LIBRARY, CNTMGNT, etc.
        /// &lt;/summary&gt;
        [XmlAttribute(&quot;ParentModuleID&quot;), DefaultValue(&quot;&quot;)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public string ParentModuleID;

        /// &lt;summary&gt;
        /// The platform this form is supported on WWW_WEB, Mobile
        /// &lt;/summary&gt;
        [XmlAttribute(&quot;Platform&quot;), DefaultValue(&quot;&quot;)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public string Platform;

        [XmlIgnore]
        public Renderer Renderer = new Renderer();

        [XmlIgnore]
        public bool ProceedSave = true;

        /// &lt;summary&gt;
        /// defaults to false.  If true the report caption and data of each field is surrounded with
        /// a boprder of 1px height.
        /// &lt;/summary&gt;
        [XmlAttribute(&quot;ReportBoxedFields&quot;), DefaultValue(&quot;&quot;)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public string ReportBoxedFields;

        /// &lt;summary&gt;
        /// defaults to true.  If false the default Aurigo BRIX report header is not printed
        /// &lt;/summary&gt;
        [XmlAttribute(&quot;ReportHeader&quot;), DefaultValue(&quot;&quot;)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public string ReportHeader;

        [XmlIgnore]
        public List&lt;ReportDetails&gt; Reports = new List&lt;ReportDetails&gt;();

        /// &lt;summary&gt;
        /// dont know why this is here
        /// &lt;/summary&gt;
        [XmlAttribute(&quot;ReturnURL&quot;), DefaultValue(&quot;&quot;)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public string ReturnURL;

        /// &lt;summary&gt;
        /// ShowInStages is the basis for integrating the form into workflow.  If ShowInStages is true then
        /// Sections can be disabled based on the approval stage a form is in.
        /// &lt;/summary&gt;
        [XmlAttribute(&quot;ShowInStages&quot;), DefaultValue(false)]
        public bool ShowInStages;

        [XmlAttribute(&quot;GroupBy&quot;), DefaultValue(&quot;&quot;)]
        public string GroupBy;

        [XmlAttribute(&quot;DisplayNew&quot;), DefaultValue(true)]
        public bool DisplayNew = true;

        [XmlAttribute(&quot;DisplayEdit&quot;), DefaultValue(true)]
        public bool DisplayEdit = true;

        [XmlAttribute(&quot;DisplayView&quot;), DefaultValue(true)]
        public bool DisplayView = true;

        [XmlAttribute(&quot;DisplayDelete&quot;), DefaultValue(true)]
        public bool DisplayDelete = true;

        [XmlAttribute(&quot;AllowExcelExport&quot;), DefaultValue(true)]
        public bool AllowExcelExport = true;

        [XmlAttribute(&quot;AllowExcelImport&quot;), DefaultValue(false)]
        public bool AllowExcelImport = false;
        //Hiding this feature as its incomplete

        [XmlAttribute(&quot;ShowDetailsReport&quot;), DefaultValue(true)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public bool ShowDetailsReport = true;

        [XmlAttribute(&quot;ShowListPageReport&quot;), DefaultValue(true)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public bool ShowListPageReport = true;

        [XmlAttribute(&quot;ControlCaptionWidth&quot;), DefaultValue(&quot;150px&quot;)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public string ControlCaptionWidth = &quot;150px&quot;;

        [XmlAttribute(&quot;FormKey&quot;), DefaultValue(&quot;&quot;)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public string FormKey;

        [XmlAttribute(&quot;ShowValidationSummary&quot;), DefaultValue(false)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public bool ShowValidationSummary = false;

        [XmlAttribute(&quot;Width&quot;), DefaultValue(&quot;100%&quot;)]
        public new string Width = &quot;100%&quot;;

        /// &lt;summary&gt;
        /// Comma seperated script file for Mobile
        /// &lt;/summary&gt;
        [XmlAttribute(&quot;ClientScriptPath&quot;), DefaultValue(&quot;&quot;)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public string ClientScriptPath;

        /// &lt;summary&gt;
        /// Comma seperated script file for Web
        /// &lt;/summary&gt;
        [XmlAttribute(&quot;IncludeScriptFiles&quot;), DefaultValue(&quot;&quot;)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public string IncludeScriptFiles;

        /// &lt;summary&gt;
        /// Comma separated script file for Mobile List page
        /// &lt;/summary&gt;
        [XmlAttribute(&quot;ListScriptPath&quot;), DefaultValue(&quot;&quot;)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public string ListScriptPath;

        /// &lt;summary&gt;
        /// Comma separated script file for Web List page
        /// &lt;/summary&gt;
        [XmlAttribute(&quot;ListPageScriptFiles&quot;), DefaultValue(&quot;&quot;)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public string ListPageScriptFiles;

        //[XmlAttribute(&quot;ClientScriptKey&quot;), DefaultValue(&quot;&quot;)]
        //public string ClientScriptKey;

        [XmlAttribute(&quot;AllowOffline&quot;), DefaultValue(&quot;true&quot;)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public string AllowOffline;

        [XmlIgnore]
        public bool DesignMode
        {
            get { return this.engine.IsDesignMode; }
        }

        [XmlAttribute(&quot;SingleInstance&quot;), DefaultValue(false)]
        public bool SingleInstance = false;

        [XmlAttribute(&quot;InstanceURL&quot;), DefaultValue(&quot;&quot;)]
        public string InstanceURL { get; set; }

        [XmlElement(&quot;GroupMenus&quot;)]
        public List&lt;GroupMenus&gt; GroupMenus = new List&lt;GroupMenus&gt;();

        [XmlIgnore]
        public string IsInjectionType = &quot;&quot;;

        /// &lt;summary&gt;
        /// This is to Specify all the tables which are dependant on the Current Form. 
        /// Syntax :  DependantTables Name=&quot;Table1.[Column]:[Description],Table2.[Column]:[Description],Table3.[Column]:[Description]&quot; /&gt;
        /// &lt;/summary&gt;
        [XmlElement(&quot;DependantTables&quot;)]
        public DependantTables DependantTables = new DependantTables();

        [XmlElement(&quot;ListPageTemplate&quot;)]
        public ListPageTemplate ListPageTemplate { get; set; }

        [XmlElement(&quot;OfflineListPageTemplate&quot;)]
        public ListPageTemplate OfflineListPageTemplate { get; set; }

        public event GetVal GetHostValue;

        public event SetVal SetHostValue;

        public event GetValFromGrid GetHostGridValue;

        public event SetValInGrid SetHostGridValue;

        [XmlAttribute(&quot;ShowMapView&quot;), DefaultValue(false)]
        public bool ShowMapView = false;

        [XmlAttribute(&quot;MapFilterKey&quot;), DefaultValue(&quot;&quot;)]
        public string MapFilterKey;

        [XmlAttribute(&quot;ReportPageOrientation&quot;), DefaultValue(0)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public ReportPageOrientation ReportPageOrientation;

        [XmlAttribute(&quot;ReportPageSize&quot;), DefaultValue(0)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public ReportPageSize ReportPageSize;

        [XmlAttribute(&quot;ExportReportFileName&quot;), DefaultValue(&quot;&quot;)]
        [FormDesignerAttribute(AttributeType = AttributeType.Advanced)]
        public string ExportReportFileName;

        [XmlIgnore]
        public Dictionary&lt;string, object&gt; SessionParameters = new Dictionary&lt;string, object&gt;(StringComparer.OrdinalIgnoreCase);

        /// &lt;summary&gt;
        /// Returns whether the form is inside an Embedded Form control
        /// &lt;/summary&gt;
        [XmlIgnore]
        public bool IsInsideEmbeddedForm = false;

        [XmlIgnore]
        public string Timestamp = string.Empty; // it may be Guid as string or an empty string

        [XmlIgnore]
        public bool CheckConcurrency = true;

        #region Form public Methods

        public override void GetInstanceData(bool isUTC_to_MWDateTime_ConversionRequired)
        {
            Table = ComponentHelper.Instance.ExecuteDataSet(&quot;select * from &quot; + this.ActualTableNameInDatabase + &quot; where &quot; + PrimaryKeyName + &quot;={0}&quot;, instanceID).Tables[0];
            if (isUTC_to_MWDateTime_ConversionRequired)
                Table = MWDateTimeHelper.ToMWDateTime(Table);

            if (Table != null &amp;&amp; Table.Rows.Count &gt; 0 &amp;&amp; Table.Columns.Contains(TIMESTAMP_COLUMN_NAME))
                Timestamp = Table.Rows[0][TIMESTAMP_COLUMN_NAME] != null ? Table.Rows[0][TIMESTAMP_COLUMN_NAME].ToString() : string.Empty;
        }

        internal override void CreateTable(StringBuilder sb, bool dropIfExists)
        {
            bool hasAtleastOneColumnToAlter = false;

            sb.Append(SQLHelper_Get_Comment(&quot;START Form&quot;));
            if (dropIfExists)
            {
                sb.AppendFormat(SQLHelper_DDL_Table_DropTableIfExist(ActualTableNameInDatabase, TemporalTableNameInDatabase));
                sb.AppendFormat(&quot;\r\n DELETE FROM WorkflowFormMapping WHERE FormID=&#39;{0}&#39;&quot;, Name);
                // Deleting the old workflow records...
            }

            sb.AppendFormat(SQLHelper_DDL_Table_START_CreateTableIfNotExist(ActualTableNameInDatabase));

            StringBuilder sbr_DDL_Query_ColumnAlter = new StringBuilder();

            ProcessControlsForDBContainer(this,
                ctrl =&gt;
                {
                    sb.Append(&quot;\r\n\t [&quot; + ctrl.Name + &quot;] &quot; + (ctrl.DBType.Equals(&quot;date&quot;, StringComparison.CurrentCultureIgnoreCase) ? &quot;datetime&quot; : ctrl.DBType) + &quot;,&quot;);

                    if (!ctrl.PrimaryKey &amp;&amp; !string.IsNullOrWhiteSpace(ctrl.DBType))
                    {
                        hasAtleastOneColumnToAlter = true;
                        sbr_DDL_Query_ColumnAlter.Append(&quot;\t&quot;);
                        sbr_DDL_Query_ColumnAlter.AppendLine(SQLHelper_DDL_Table_AddNewColumn(this.ActualTableNameInDatabase, ctrl.Name, ctrl.DBType, isNullableColumn: true));
                    }
                }
                , true);

            // Adding Timestamp column
            sb.Append(&quot;\r\n\t [&quot; + TIMESTAMP_COLUMN_NAME + &quot;] UNIQUEIDENTIFIER DEFAULT NEWID() NOT NULL,&quot;);

            hasAtleastOneColumnToAlter = true;
            sbr_DDL_Query_ColumnAlter.Append(&quot;\t&quot;);
            sbr_DDL_Query_ColumnAlter.AppendLine(SQLHelper_DDL_Table_AddNewColumn(this.ActualTableNameInDatabase, TIMESTAMP_COLUMN_NAME, &quot;UNIQUEIDENTIFIER DEFAULT NEWID()&quot;, false));

            // Containers.OfType&lt;Section&gt;().ForEach(sec =&gt; sb.Append(GetMasterColumnsFromSection(sec)));
            sb.Append(SQLHelper_DDL_Table_END_CreateTableIfNotExist(ActualTableNameInDatabase, PrimaryKeyName));

            sb.Append(&quot;\r\n\t&quot;);
            sb.AppendLine(&quot; END &quot;);

            if (!dropIfExists &amp;&amp; hasAtleastOneColumnToAlter)
            {
                sb.AppendLine(&quot; ELSE &quot;);
                sb.AppendLine(&quot; BEGIN &quot;);
                //this will create new columns if it does not already exists
                sb.AppendLine(sbr_DDL_Query_ColumnAlter.ToString());
                sb.AppendLine(&quot; END &quot;);
            }

            foreach (QRCodeControl item in this.QRGenerator.QRControl)
            {
                sb.AppendLine(SQLHelper_DDL_Table_AddNewColumn(this.ActualTableNameInDatabase, this.QRGenerator.Prefix + item.Name, &quot;UNIQUEIDENTIFIER&quot;));
            }
            sb.AppendLine(&quot;;&quot;);

            if (form.EnableAuditLog)
            {
                if (CheckForAuditLogColumns(this))
                {
                    if (AMP3ApplicationSettings.Instance.AuditLogType.Equals(AuditLogType.CDC.ToString()))
                        EnableCDC(sb, false, ActualTableNameInDatabase);
                    else if (AMP3ApplicationSettings.Instance.AuditLogType.Equals(AuditLogType.TemporalTable.ToString()))
                        EnableTemporalTable(sb, ActualTableNameInDatabase, TemporalTableNameInDatabase, PrimaryKeyName);
                }
            }
            else
            {
                if (AMP3ApplicationSettings.Instance.AuditLogType.Equals(AuditLogType.CDC.ToString()))
                    DisableCDC(sb, ActualTableNameInDatabase);
                else if (AMP3ApplicationSettings.Instance.AuditLogType.Equals(AuditLogType.TemporalTable.ToString()))
                    DisableTemporalTable(sb, ActualTableNameInDatabase);
            }

            // AFTER CREATING THE TABLE CREATE THE SYSTEM VIEW FOR THE TABLE INCLUDIG ALL THE REFERENCES TABLES
            // CHECK FOR ALL LIST COLUMNS AND UPDATE SELECT COLUMNS INSIDE FORM.REFERENCES

            sb.Append(SQLHelper_Get_Comment(&quot;END Form&quot;));
        }

        public string DropViewQuery()
        {
            //UpdateForeignKeyReferences();
            string dropDefintion = @&quot;IF EXISTS (SELECT * FROM sysobjects WHERE type = N&#39;V&#39; AND name = N&#39;{0}&#39;)
                                    DROP VIEW [{0}];&quot;;
            dropDefintion = dropDefintion.Format2((&quot;vw_&quot; + ActualTableNameInDatabase + &quot;_Auto&quot;));
            return dropDefintion;
        }

        internal string DropQRViewQuery()
        {
            //UpdateForeignKeyReferences();
            string dropDefintion = @&quot;IF EXISTS (SELECT * FROM sysobjects WHERE type = N&#39;V&#39; AND name = N&#39;{0}&#39;)
                                    DROP VIEW [{0}];&quot;;
            dropDefintion = dropDefintion.Format2((&quot;vw_&quot; + ActualTableNameInDatabase + &quot;_AutoQR&quot;));
            return dropDefintion;
        }

        internal string DropSeacrhViewQuery()
        {
            //UpdateForeignKeyReferences();
            string dropDefintion = @&quot;IF EXISTS (SELECT * FROM sysobjects WHERE type = N&#39;V&#39; AND name = N&#39;{0}&#39;)
                                    DROP VIEW [{0}];&quot;;
            dropDefintion = dropDefintion.Format2((&quot;vw_&quot; + ActualTableNameInDatabase + &quot;_Search_Auto&quot;));
            return dropDefintion;
        }

        internal string DropDynamicGridSearchViewQuery(string gridTableName)
        {
            string dropDefintion = @&quot;IF EXISTS (SELECT * FROM sysobjects WHERE type = N&#39;V&#39; AND name = N&#39;{0}&#39;)
                                  DROP VIEW [{0}];&quot;;
            dropDefintion = dropDefintion.Format2((&quot;vw_&quot; + gridTableName + &quot;_DG_Search_Auto&quot;));
            return dropDefintion;
        }


        public string CreateViewQuery()
        {
            //UpdateForeignKeyReferences();

            string viewDefinition = CreateAutoViewQuery(&quot;_Auto&quot;, References);
            return viewDefinition;
        }

        internal string CreateQRViewQuery()
        {
            string viewDefinition = CreateAutoViewQuery(&quot;_AutoQR&quot;, QRReferences);
            return viewDefinition;
        }

        private string CreateAutoViewQuery(string viewSuffix, Dictionary&lt;string, ForeignKeyReference&gt; references)
        {
            string viewDefinition = @&quot;CREATE VIEW dbo.[{0}] AS 
                                    SELECT {1}
                                    FROM {2} 
                                    {3}&quot;;

            string selectColumns = ActualTableNameInDatabase + &quot;.*,&quot;;
            // build select columns

            string joinQuery = string.Empty;

            foreach (KeyValuePair&lt;string, ForeignKeyReference&gt; kvp in references)
            {
                // create iner join and also build the select columns
                ForeignKeyReference fkr = kvp.Value;
                if (fkr.RequiredColumns.Count &gt; 0)
                {
                    joinQuery += &quot;left outer join [{0}] on [{0}].[{1}] = [{2}].[{3}]&quot;.Format2(
                        fkr.ReferenceTable, fkr.ReferenceColumn, ActualTableNameInDatabase, fkr.ReferedBy.Name);

                    foreach (ReferenceColumnDetails col in fkr.RequiredColumns)
                    {
                        //Take care of square brackets only if required
                        selectColumns += &quot;{0},&quot;.Format2(col.OriginalFieldText_WithAlias);
                    }
                }
            }

            selectColumns = selectColumns.TrimEnd(&#39;,&#39;);
            viewDefinition = viewDefinition.Format2((&quot;vw_&quot; + ActualTableNameInDatabase + viewSuffix), selectColumns, ActualTableNameInDatabase,
                joinQuery);

            return viewDefinition;
        }


        /// &lt;summary&gt;
        /// Create Search View 
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        internal string CreateSearchableViewQuery()
        {
            StringBuilder joinQuery = new StringBuilder();
            string[] arrDropdownColumnProp;
            string DropdownTableName = string.Empty;
            string DropdownTableColumn = string.Empty;
            string DropdownTableColumnValue = string.Empty;
            int tableidx = 2;
            string selectColumns = string.Empty;
            StringBuilder sb = new StringBuilder();
            string viewDefinition = @&quot;CREATE VIEW dbo.[{0}] AS 
                                    SELECT {1}
                                    FROM {2} t1 
                                    {3}&quot;;

            // build select columns
            if (string.IsNullOrEmpty(form.BaseTableName) &amp;&amp; form.InstantiateTable == true)
            {
                ProcessControlsForDBContainer(this,
                 ctrl =&gt;
                 {
                     //If Datasource is not there for column
                     if (!string.IsNullOrEmpty(ctrl.DataSource) &amp;&amp; ctrl.Type == ControlType.DropDownList &amp;&amp; (ctrl.DataSource.ToLower().Contains(&quot;_request&quot;) || ctrl.DataSource.ToLower().Contains(&quot;$&quot;)))
                     {
                         // create iner join and also build the select columns
                         arrDropdownColumnProp = ctrl.DataSource.Split(&#39;;&#39;);
                         DropdownTableName = arrDropdownColumnProp[0];
                         DropdownTableColumn = arrDropdownColumnProp[1];
                         DropdownTableColumnValue = arrDropdownColumnProp[2];
                         sb.Append(&quot;\r\n\t t&quot; + tableidx + &quot;.[&quot; + DropdownTableColumn + &quot;]&quot; + &quot; as [&quot; + ctrl.Name + &quot;],&quot;);
                         if (DropdownTableColumnValue != DropdownTableColumn)
                             joinQuery.Append(&quot;left outer join (Select distinct [{1}],[{5}] FROM [{0}]) t{4} on [t{4}].[{1}] = [{2}].[{3}]&quot;.Format2(DropdownTableName, DropdownTableColumnValue, &quot;t1&quot;, ctrl.Name, tableidx, DropdownTableColumn));
                         else
                             joinQuery.Append(&quot;left outer join (Select distinct [{1}] FROM [{0}]) t{4} on [t{4}].[{1}] = [{2}].[{3}]&quot;.Format2(DropdownTableName, DropdownTableColumnValue, &quot;t1&quot;, ctrl.Name, tableidx));
                         tableidx++;
                     }
                     else  //If Datasource is there for column
                     {
                         sb.Append(&quot;\r\n\t t1.[&quot; + ctrl.Name + &quot;]&quot; + &quot; as [&quot; + ctrl.Name + &quot;],&quot;);
                     }
                 }
                 , true);

                foreach (KeyValuePair&lt;string, ForeignKeyReference&gt; kvp in References)
                {
                    // create iner join and also build the select columns
                    ForeignKeyReference fkr = kvp.Value;
                    if (fkr.RequiredColumns.Count &gt; 0)
                    {
                        foreach (ReferenceColumnDetails col in fkr.RequiredColumns)
                        {
                            joinQuery.Append(&quot;left outer join [{0}] t{4} on [t{4}].[{1}] = [{2}].[{3}]&quot;.Format2(fkr.ReferenceTable, fkr.ReferenceColumn, &quot;t1&quot;, fkr.ReferedBy.Name, tableidx));
                            //Take care of square brackets only if required
                            sb.Append(&quot;\r\n\t t&quot; + tableidx + &quot;.[&quot; + col.FieldName + &quot;]&quot; + &quot; as [&quot; + col.AliasText + &quot;],&quot;);
                            tableidx++;
                        }
                    }
                }
                selectColumns = sb.ToString().TrimEnd(&#39;,&#39;);
                viewDefinition = viewDefinition.Format2((&quot;vw_&quot; + ActualTableNameInDatabase + &quot;_Search_Auto&quot;), selectColumns, ActualTableNameInDatabase,
                joinQuery.ToString());
            }
            return viewDefinition;
        }

        /// &lt;summary&gt;
        /// Create View For Dynamic Grid
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;gridTableName&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        internal string CreateDynamicGridSearchViewQuery(string gridTableName)
        {
            StringBuilder joinQuery = new StringBuilder();
            int tableidx = 2;
            string selectColumns = string.Empty;
            string[] arrDropdownColumnProp;
            string DropdownTableName = string.Empty;
            string DropdownTableColumn = string.Empty;
            string DropdownTableColumnValue = string.Empty;
            string dropDefintion = string.Empty;
            string viewSchema = string.Empty;
            StringBuilder sb = new StringBuilder();
            string viewDefinition = @&quot;CREATE VIEW dbo.[{0}] AS 
                                        SELECT {1}
                                        FROM {2} t1 
                                        {3}&quot;;

            //Dynamic Section
            form.ProcessAllContainersDeeply(
            cc =&gt;
            {
                if ((cc is DynamicGrid || cc is StaticGrid) &amp;&amp; !string.IsNullOrEmpty(((DataBaseContainer)cc).TableName) &amp;&amp; ((DataBaseContainer)cc).TableName == gridTableName)
                {
                    if (((cc is StaticGrid) &amp;&amp; cc.Containers[0].GetType() == typeof(Header)) || cc is DynamicGrid)
                    {
                        sb = new StringBuilder();
                        foreach (xControl xctrl in
                                (cc is StaticGrid) ? cc.Containers[0].Controls : cc.Controls)
                        {
                            if (!string.IsNullOrEmpty(xctrl.DataSource) &amp;&amp; xctrl.Type == ControlType.DropDownList &amp;&amp; (xctrl.DataSource.ToLower().Contains(&quot;_request&quot;) || xctrl.DataSource.ToLower().Contains(&quot;$&quot;)) &amp;&amp; xctrl.Type != ControlType.Hidden)
                            {
                                // create iner join and also build the select columns
                                arrDropdownColumnProp = xctrl.DataSource.Split(&#39;;&#39;);
                                DropdownTableName = arrDropdownColumnProp[0];
                                DropdownTableColumn = arrDropdownColumnProp[1];
                                DropdownTableColumnValue = arrDropdownColumnProp[2];
                                sb.Append(&quot;\r\n\t t&quot; + tableidx + &quot;.[&quot; + DropdownTableColumn + &quot;]&quot; + &quot; as [&quot; + xctrl.Name + &quot;],&quot;);
                                if (DropdownTableColumnValue != DropdownTableColumn)
                                    joinQuery.Append(&quot;left outer join (Select distinct [{1}],[{5}] FROM [{0}]) t{4} on [t{4}].[{1}] = [{2}].[{3}]&quot;.Format2(DropdownTableName, DropdownTableColumnValue, &quot;t1&quot;, xctrl.Name, tableidx, DropdownTableColumn));
                                else
                                    joinQuery.Append(&quot;left outer join (Select distinct [{1}] FROM [{0}]) t{4} on [t{4}].[{1}] = [{2}].[{3}]&quot;.Format2(DropdownTableName, DropdownTableColumnValue, &quot;t1&quot;, xctrl.Name, tableidx));
                                tableidx++;
                            }
                            else if (!(xctrl.Type == ControlType.AttachmentControl) &amp;&amp; (xctrl.Type != ControlType.PickerTrigger) &amp;&amp; (xctrl.Type != ControlType.Hidden || xctrl.ForeignKey))
                            {
                                if (!xctrl.ForeignKey)
                                    sb.Append(&quot;\r\n\t t1.[&quot; + xctrl.Name + &quot;]&quot; + &quot; as [&quot; + xctrl.Name + &quot;],&quot;);
                                else
                                    sb.Append(&quot;\r\n\t t1.[&quot; + xctrl.Name + &quot;]&quot; + &quot; as [ForeignKey],&quot;);
                            }
                        }

                        selectColumns = sb.ToString().TrimEnd(&#39;,&#39;);
                        viewSchema = viewDefinition.Format2((&quot;vw_&quot; + ((DataBaseContainer)cc).TableName + &quot;_DG_Search_Auto&quot;), selectColumns, ((DataBaseContainer)cc).TableName,
                        joinQuery.ToString());
                    }
                }
            });
            return viewSchema;
        }


        public override void ModifyTable(StringBuilder sb)
        {
            CreateTable(sb, false);
        }

        private string GetMasterColumnsFromSection(Section sec)
        {
            var sb = new StringBuilder();
            foreach (xControl xc in sec.Controls)
            {
                if (xc.Controls.Count &gt; 0)
                {
                    xc.Controls.FindAll(innerXc =&gt; !string.IsNullOrEmpty(innerXc.DBType)).ForEach(
                        innerXc =&gt; sb.Append(&quot;\r\n\t [&quot; + innerXc.Name + &quot;] &quot; + innerXc.DBType + &quot;,&quot;));
                }
                else if (!string.IsNullOrEmpty(xc.DBType))
                {
                    sb.Append(&quot;\r\n\t [&quot; + xc.Name + &quot;] &quot; + xc.DBType + &quot;,&quot;);
                }
            }

            // Process all the sections inside the given section
            sec.Containers.OfType&lt;Section&gt;().ForEach(innerSec =&gt; sb.Append(GetMasterColumnsFromSection(innerSec)));

            return sb.ToString();
        }

        internal void GetControlNameValueInSection(ref List&lt;String&gt; columns, ref List&lt;String&gt; values, Section sec,
            RenderFormat format, bool isCreate)
        {
            // IF NOT THE CURRENT STAGE SIMPLY RETURN
            if (!Renderer.IsCurrentStage(sec))
                return;

            //Get all the _VCRef controls added for the AutoIncrement  controls in the form.
            var AutoIncrementVCRefCtrl = new List&lt;string&gt;();
            var AutoIncrementCtrl = sec.Controls.Where(x =&gt; x.Type == ControlType.AutoIncrement);
            if (AutoIncrementCtrl.Count() &gt; 0)
            {
                AutoIncrementCtrl.ForEach(
                    xc =&gt;
                        AutoIncrementVCRefCtrl =
                            AutoIncrementVCRefCtrl.Union(new List&lt;string&gt;() { xc.Name + &quot;_VCRef&quot; }).ToList());
            }


            foreach (xControl xctrl in sec.Controls)
            {
                if ((xctrl.Type != ControlType.AttachmentControl) &amp;&amp; xctrl.Controls.Count &gt; 0)
                {
                    //Get all the _VCRef controls added for the AutoIncrement  controls in the form.
                    var Child_AutoIncrementVCRefCtrl = new List&lt;string&gt;();
                    var Child_AutoIncrementCtrl = xctrl.Controls.Where(x =&gt; x.Type == ControlType.AutoIncrement);
                    if (Child_AutoIncrementCtrl.Count() &gt; 0)
                    {
                        Child_AutoIncrementCtrl.ForEach(
                            xc =&gt;
                                Child_AutoIncrementVCRefCtrl =
                                    Child_AutoIncrementVCRefCtrl.Union(new List&lt;String&gt;() { xc.Name + &quot;_VCRef&quot; })
                                        .ToList());
                    }

                    foreach (xControl xctrlinner in xctrl.Controls)
                    {
                        //Do not add AutoIncrement or the corresponding _VCRef control in Update mode
                        //To-Do Need  to find a way to pass IsNewMode to the form Engine from the calling page itself.
                        //This is explicitly done for Documents, but should be working for others also as we never need to update the AutoIncrement field.
                        //in Docs page we can upload multiple files in which one or more files may be for version upgrade,
                        //in which case it is difficult now to find out the upload is a new file or an upgrade.

                        if (
                            !(xctrl.Type == ControlType.AutoIncrement ||
                              Child_AutoIncrementVCRefCtrl.Contains((xctrl.Name)) ||
                              xctrl.Type == ControlType.AttachmentControl) || isCreate)
                        {
                            string serverVal = xctrlinner.GetServerValue();
                            string value = serverVal == null ? string.Empty : xctrlinner.GetServerValue();

                            if (string.IsNullOrEmpty(xctrlinner.DBType) || xctrlinner.IsIdentity)
                            {
                                value = value.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;);
                            }
                            else
                            {
                                value = CheckForDateAndSetFormat(xctrlinner, value);

                                value = TrimTextAreaContent(xctrlinner, value);

                                if (xctrlinner.ValidationTypes.Contains(ValidationType.Unique) &amp;&amp;
                                    !value.Equals(string.Empty))
                                {
                                    if (!_uniqueColumns.ContainsKey(xctrlinner.Name))
                                    {
                                        if (xctrlinner.ValidationTypes.Contains(ValidationType.UniqueSingle))
                                        {
                                            _uniqueColumns.Add(xctrlinner.Name,
                                                new List&lt;string&gt;
                                                {
                                                    value,
                                                    xctrlinner.Type.GetType().Name,
                                                    ValidationType.UniqueSingle.ToString()
                                                });
                                        }
                                        else
                                            _uniqueColumns.Add(xctrlinner.Name,
                                                new List&lt;string&gt; { value, xctrlinner.Type.GetType().Name });
                                    }
                                }
                                columns.Add(&quot;[&quot; + xctrlinner.Name + &quot;]&quot;);
                                values.Add(&quot;&#39;&quot; + value + &quot;&#39;&quot;);

                            }
                        }
                    }
                }
                else if (!string.IsNullOrEmpty(xctrl.DBType) &amp;&amp; !xctrl.IsIdentity)
                {
                    //Do not add AutoIncrement or the corresponding _VCRef control in Update mode
                    //To-Do Need  to find a way to pass IsNewMode to the form Engine from the calling page itself.
                    //This is explicitly done for Documents, but should be working for others also as we never need to update the AutoIncrement field.
                    //in Docs page we can upload multiple files in which one or more files may be for version upgrade,
                    //in which case it is difficult &quot;now&quot; to find out the upload is a new file or an upgrade.
                    if (
                        !(xctrl.Type == ControlType.AutoIncrement || AutoIncrementVCRefCtrl.Contains(xctrl.Name) ||
                          xctrl.Type == ControlType.AttachmentControl) || isCreate)
                    {
                        string value = &quot;&quot;;
                        string serverVal = xctrl.GetServerValue();
                        if (xctrl.ForeignKey)
                            serverVal = xctrl.EvaluateControlValue();
                        if (serverVal != null &amp;&amp; serverVal != &quot;_DBNULL_&quot;)
                        {
                            //value = serverVal.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;).Trim();
                            // Note: Replace not required here. Since, else part has &#39;CheckForDateAndSetFormat&#39; call which does replace.
                            // And causing double replace of &quot;&#39;&quot;(Bug ID: 90664).
                            // Hence, Doing replace call in if part
                            value = serverVal;
                        }
                        else
                        {
                            value = &quot;_DBNULL_&quot;;
                        }

                        if (xctrl.ValidationTypes.Contains(ValidationType.Unique) &amp;&amp; !value.Equals(string.Empty))
                        {
                            value = value.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;);// Replace must be here. For else part &#39;CheckForDateAndSetFormat&#39; fn takes care.
                            columns.Add(&quot;[&quot; + xctrl.Name + &quot;]&quot;);
                            values.Add(&quot;&#39;&quot; + value + &quot;&#39;&quot;);
                            if (!_uniqueColumns.ContainsKey(xctrl.Name))
                            {
                                if (xctrl.ValidationTypes.Contains(ValidationType.UniqueSingle))
                                {
                                    _uniqueColumns.Add(xctrl.Name,
                                            new List&lt;string&gt;
                                            {
                                            value,
                                            xctrl.Type.ToString(),
                                            ValidationType.UniqueSingle.ToString()
                                            });
                                }
                                else
                                {
                                    _uniqueColumns.Add(xctrl.Name, new List&lt;string&gt; { value, xctrl.Type.ToString() });
                                }
                            }
                        }
                        else
                        {
                            if (xctrl.Type != ControlType.AttachmentControl)
                            {
                                //if(xctrl.IsTimezoneApplicable &amp;&amp; xctrl.ReEvaluate &amp;&amp; !string.IsNullOrEmpty(value) )
                                //{
                                //    value = MWDateTimeHelper.ToUtc(value).ToString();
                                //}
                                value = CheckForDateAndSetFormat(xctrl, value);

                                value = TrimTextAreaContent(xctrl, value);
                                if (!(xctrl.Type.Equals(ControlType.Password) &amp;&amp; !string.IsNullOrEmpty(value) &amp;&amp; value.All(p =&gt; p == &#39;*&#39;)))
                                {
                                    columns.Add(&quot;[&quot; + xctrl.Name + &quot;]&quot;);
                                    values.Add(&quot;&#39;&quot; + value + &quot;&#39;&quot;);
                                }
                            }
                        }
                    }
                }
            }
        }

        private string TrimTextAreaContent(xControl xctrlinner, string value)
        {
            if (value == null)
                return null;

            if (xctrlinner.Type == ControlType.TextArea)
            {
                value = value.Replace(&quot;\r\n&quot;, &quot;\n&quot;);
            }
            return value;
        }

        public void CheckConcurrencyBeforeUpdate()
        {
            if (form != null &amp;&amp; !string.IsNullOrEmpty(form.Timestamp) &amp;&amp; !form.IsInsideEmbeddedForm)
            {
                int count = 0;
                int.TryParse(
                    ComponentHelper.Instance.ExecuteScalar(&quot;select count(*) from &quot; + ActualTableNameInDatabase + &quot; where &quot; + PrimaryKeyName + &quot; ={0} and &quot; + TIMESTAMP_COLUMN_NAME + &quot;={1}&quot;,
                    form.instanceID, form.Timestamp).ToString(),
                    out count);
                if (count &lt; 1)
                    throw new MWConcurrencyException(&quot;Your changes cannot be saved since another user has saved changes to this page after it is opened. Kindly reload the page.&quot;);
            }
        }

        public override void Save(RenderFormat format)
        {
            List&lt;String&gt; columns = new List&lt;string&gt;(),
                values = new List&lt;string&gt;();

            bool isCreate = string.IsNullOrEmpty(instanceID) || instanceID == &quot;0&quot;;

            if (!string.IsNullOrEmpty(instanceID) &amp;&amp; string.IsNullOrEmpty(form.IdentityColumnName))
            {
                // ths is a non identity table so find out if the row exist for given instanceid
                int count = 0;
                int.TryParse(
                    ComponentHelper.Instance.ExecuteScalar(&quot;select count(*) from &quot; + ActualTableNameInDatabase + &quot; where &quot; + PrimaryKeyName + &quot; ={0}&quot;, instanceID).ToString(),
                    out count);
                if (count &gt; 0)
                    isCreate = false;
                else
                    isCreate = true;
            }

            // Find out all the sections deeply, get the name value pair from all of them and save into DB
            //Pass isCreate so that in edit mode do not add &#39;AutoIncrement&#39; to columns.
            foreach (ControlContainer cntr in form.Containers)
            {
                if (cntr is EmbeddedForm) continue;
                GetNameValueFromSectionsInAContainer(cntr, format, ref columns, ref values, isCreate);
            }

            if (columns.Count == 0 || values.Count == 0)
                return;

            if (_uniqueColumns.Count &gt; 0)
            {
                CheckForUniqueColumns();
                CheckForSingleUniqueColumns();
            }

            // fix up the value strings
            for (int i = 0; i &lt; values.Count; i++)
                if (values[i] == &quot;&#39;_DBNULL_&#39;&quot;)
                    values[i] = &quot;NULL&quot;;

            // add Timestamp column
            string newTimestamp = Guid.NewGuid().ToString();
            if (!columns.Contains(TIMESTAMP_COLUMN_NAME))
            {
                columns.Add(TIMESTAMP_COLUMN_NAME);
                values.Add(&quot;&#39;&quot; + newTimestamp + &quot;&#39;&quot;);
            }

            if (isCreate)
            {
                String query = form.BuildInsertQuery(columns, values);
                if (!string.IsNullOrEmpty(IdentityColumnName))
                {
                    query += &quot;; select scope_identity();&quot;;
                    form.instanceID = ComponentHelper.Instance.ExecuteScalar(query).ToString();
                }
                else
                    ComponentHelper.Instance.ExecuteNonQuery(query);
            }
            else
            {
                if (CheckConcurrency)
                    CheckConcurrencyBeforeUpdate();

                String query = form.BuildUpdateQuery(columns, values, form.PrimaryKeyName, form.instanceID);
                ComponentHelper.Instance.ExecuteNonQuery(query);
            }

            // Updating Timestamp
            form.Timestamp = newTimestamp;

            //Save all attachment controls seperately after the form is saved as we need the instance id
            SaveAttachmentControls();
        }

        private void SaveAttachmentControls()
        {
            ProcessAllControlsDeeply(ctrl =&gt;
            {
                //If the control is of type attachmentControl and its parent object is DatabaseContainer, then is should be form, no other DBContainer parentObject this process should happen
                if (ctrl.Type == ControlType.AttachmentControl &amp;&amp;
                    (!(ctrl.ParentObject is DataBaseContainer) || (ctrl.ParentObject is Form)))
                {
                    ctrl.GetServerValue();
                }
            });
        }

        public override void GetLinkedInstanceDetails(RenderFormat format, LinkedInstanceDetails linkedInstanceDetails)
        {
            linkedInstanceDetails.SourceInstanceId = instanceID;
            linkedInstanceDetails.SourceData = GetReferenceModuleColumnValues();
            linkedInstanceDetails.SourceModuleID = form.ModuleID;
            linkedInstanceDetails.LinkedDestinationInstances = form.LinkedInstances;
            linkedInstanceDetails.InstanceType = LinkedInstanceType.Referred;
            linkedInstanceDetails.SourceUrl = &quot;BrixForm.aspx?Context=&quot; + form.ModuleID + &quot;&amp;PID=&quot; + FromRequest(&quot;PID&quot;)
                                              + &quot;&amp;ParentID=&quot; + FromRequest(&quot;ParentID&quot;) + &quot;&amp;Mode=View&amp;InstanceID=&quot; +
                                              instanceID;

            foreach (LinkedInstance li in linkedInstanceDetails.LinkedDestinationInstances)
            {
                if (li.ReferencedBy.ParentObject is Section || li.ReferencedBy.ParentObject is xControl)
                {
                    string serverValue = li.ReferencedBy.GetServerValue();
                    if (!string.IsNullOrEmpty(serverValue) &amp;&amp; serverValue != &quot;_DBNULL_&quot;)
                        li.DestinationInstanceIds.Add(serverValue);
                }
            }
        }

        public string GetReferenceModuleColumnValues()
        {
            var valuesHolder = new List&lt;ReferenceModuleColumnData&gt;();
            string[] columns;
            if (!string.IsNullOrEmpty(ReferenceModuleColumns.Columns))
                columns = ReferenceModuleColumns.Columns.Split(&#39;,&#39;);
            else
                columns = ListColumns.Columns.Split(&#39;,&#39;);
            foreach (string column in columns)
            {
                xControl xc = form.GetControl(column);
                if (xc != null)
                {
                    string caption = xc.Caption == null
                        ? xc.Name
                        : xc.ParseDynamicString(xc.Caption).Replace(&quot;:&quot;, &quot;&quot;).Trim();
                    string value = xc.GetServerValue();
                    if (xc.Type == ControlType.DropDownList || xc.Type == ControlType.RadioButtonList ||
                        xc.Type == ControlType.Listbox)
                    {
                        var ddlItems = xc.GetFormList();
                        var listItem = ddlItems.Find(li =&gt; li.value == value);
                        if (listItem != null)
                            value = listItem.display;
                    }
                    if (xc.Type == ControlType.Date)
                    {
                        if (!string.IsNullOrEmpty(value) &amp;&amp; value != &quot;_DBNULL_&quot; &amp;&amp; value != &quot;None&quot;)
                            value = value.ToMWUtcDateTime().ToString(&quot;yyyy-mm-dd hh:MM:ss tt&quot;);
                    }
                    valuesHolder.Add(new ReferenceModuleColumnData() { ColumnName = caption, ColumnValue = value });
                }
            }

            return valuesHolder.SerializeDTO();
        }

        internal void CheckForSingleUniqueColumns()
        {
            // Added a new Validation Type UniqueSingle
            //This function is created to ensure 
            //IF more than one feild is specified as unique and form has to treat all feild as unique 
            //and not as a combination, separate query is run for each such feild to check for its uniqueness
            //However a composite query is created if PID,ProjectID or any 
            //other hidden feilds are specified as unique to ensure uniqueness is in project level


            string uniqueSingleQuery = &quot;select count(*) from &quot; + ActualTableNameInDatabase + &quot; where &quot;;
            string alertMsg = &quot;&quot;;
            string wherecond = &quot;&quot;;
            Boolean flag = true;
            foreach (string key in _uniqueColumns.Keys)
            {
                if (_uniqueColumns[key][1] == &quot;Hidden&quot;)
                    wherecond += &quot;and &quot; + key + &quot; = &#39;&quot; + _uniqueColumns[key][0] + &quot;&#39; and &quot;;
            }

            if (!string.IsNullOrEmpty(wherecond))
                wherecond = wherecond.TrimEnd(&quot;and &quot;.ToCharArray());

            foreach (string key in _uniqueColumns.Keys)
            {
                var query = uniqueSingleQuery;
                if (_uniqueColumns[key].Count &gt; 2 &amp;&amp;
                    _uniqueColumns[key][2].Equals(ValidationType.UniqueSingle.ToString()))
                {
                    query += key + &quot; = &#39;&quot; + _uniqueColumns[key][0] + &quot;&#39; &quot;;

                    if (!string.IsNullOrEmpty(wherecond))
                        query += wherecond;
                    query += string.IsNullOrEmpty(instanceID)
                        ? &quot;&quot;
                        : &quot; and &quot; + PrimaryKeyName + &quot; &lt;&gt; &#39;&quot; + instanceID + &quot;&#39;&quot;;
                    int count = 0;
                    int.TryParse(ComponentHelper.Instance.ExecuteScalar(query).ToString2(), out count);
                    if (count &gt; 0)
                    {
                        if (_uniqueColumns[key][1] != &quot;Hidden&quot;)
                        {
                            //Find the control of this key and get the caption and show it in the alert message
                            string keyCaption = key;
                            xControl uCtrl = form.GetControl(key);
                            if (uCtrl != null)
                            {
                                keyCaption = uCtrl.Caption == null
                                    ? uCtrl.Name
                                    : uCtrl.ParseDynamicString(uCtrl.Caption).Replace(&quot;:&quot;, &quot;&quot;);
                            }
                            alertMsg += keyCaption + &quot; ,&quot;;
                            flag = false;
                        }
                    }
                }
            }
            if (!flag)
            {
                alertMsg = alertMsg.TrimEnd(&#39;,&#39;) + &quot; already exists&quot;;
                throw new Exception(alertMsg);
            }
        }


        internal void CheckForUniqueColumns()
        {
            string uniqueQuery = &quot;select count(*) from &quot; + ActualTableNameInDatabase + &quot; where &quot;;
            Boolean execute = false;
            foreach (string key in _uniqueColumns.Keys)
            {
                if (_uniqueColumns[key].Count &lt; 3)
                {
                    uniqueQuery += key + &quot; = &#39;&quot; + _uniqueColumns[key][0] + &quot;&#39; and &quot;;
                    if (_uniqueColumns[key][1] != &quot;Hidden&quot;)
                    {
                        execute = true;
                    }
                }
            }
            if (execute)
            {
                uniqueQuery = uniqueQuery.TrimEnd(&quot;and &quot;.ToCharArray());

                uniqueQuery += string.IsNullOrEmpty(instanceID)
                    ? &quot;&quot;
                    : &quot; and &quot; + PrimaryKeyName + &quot; &lt;&gt; &#39;&quot; + instanceID + &quot;&#39;&quot;;
                int count = 0;
                int.TryParse(ComponentHelper.Instance.ExecuteScalar(uniqueQuery).ToString2(), out count);

                if (count &gt; 0)
                {
                    string alertMsg = &quot;&quot;;

                    foreach (string key in _uniqueColumns.Keys)
                    {
                        if (_uniqueColumns[key][1] != &quot;Hidden&quot;)
                        {
                            //Find the control of this key and get the caption and show it in the alert message
                            string keyCaption = key;
                            xControl uCtrl = form.GetControl(key);
                            if (uCtrl != null)
                            {
                                keyCaption = uCtrl.Caption == null
                                    ? uCtrl.Name
                                    : uCtrl.ParseDynamicString(uCtrl.Caption).Replace(&quot;:&quot;, &quot;&quot;);
                            }
                            alertMsg += keyCaption + &quot; ,&quot;;
                        }
                    }
                    alertMsg = alertMsg.TrimEnd(&#39;,&#39;) + &quot; already exists&quot;;

                    throw new Exception(alertMsg);
                }
            }
        }

        private void GetNameValueFromSectionsInAContainer(ControlContainer container, RenderFormat format,
            ref List&lt;String&gt; columns, ref List&lt;String&gt; values, bool isCreate)
        {
            if (container is Section)
                form.GetControlNameValueInSection(ref columns, ref values, container as Section, format, isCreate);

            foreach (ControlContainer c in container.Containers)
            {
                //if (c.GetType() == typeof(Section))
                //    form.GetControlNameValueInSection(ref columns, ref values, c as Section, format);
                //else
                GetNameValueFromSectionsInAContainer(c, format, ref columns, ref values, isCreate);
            }
        }

        public object GetHostVal(string ctrlName, string fieldName, out string datatype, out string errors)
        {
            datatype = null;
            errors = null;
            object val = null;
            if (null != GetHostValue) val = GetHostValue(ctrlName, fieldName, out datatype, out errors);
            return val;
        }

        public object GetHostGridVal(string gridName, string fieldName, string instance, string pid, string parentid,
            string parentmodule, out string datatype, out string errors)
        {
            datatype = null;
            errors = null;
            object val = null;
            if (null != GetHostGridValue)
                val = GetHostGridValue(gridName, fieldName, instance, pid, parentid, parentmodule, out datatype,
                    out errors);
            return val;
        }

        public bool SetHostVal(string gridName, string fieldName, string datatype, object val, out string errors)
        {
            errors = null;
            bool bIsSet = false;
            if (null != SetHostValue) bIsSet = SetHostValue(gridName, fieldName, datatype, val, out errors);
            return bIsSet;
        }

        public bool SetHostGridVal(string gridName, string fieldName, string instance, string pid, string parentid,
            string parentmodule, string datatype, object val, out string errors)
        {
            errors = null;
            bool bIsSet = false;
            if (null != SetHostGridValue)
                bIsSet = SetHostGridValue(gridName, fieldName, instance, pid, parentid, parentmodule, datatype, val,
                    out errors);
            return bIsSet;
        }

        #endregion

        #region Form properties

        [XmlIgnore]
        public XMLRenderingEngine theengine { get; set; }

        [XmlIgnore]
        public System.Web.UI.Page thepage { get; set; }

        //[XmlIgnore]
        //public bool IsViewMode { get; set; }

        //[XmlIgnore]
        //public  bool IsEditMode { get; set; }

        #endregion

        public Form()
        {
            theengine = null;
            thepage = null;

            //Controls.OnChildItemAdd += new EventHandler(Controls_OnChildItemAdd);
            //Controls.OnChildItemRemove += new EventHandler(Controls_OnChildItemRemove);
            //OnAfterAddedToParent += new EventHandler(Controls_OnChildItemAdd);
        }

        //public void Controls_OnChildItemAdd(object sender, EventArgs e)
        //{
        //    if (!(sender is xControl)) return;
        //    // on each control add check if this control is a reference column and update the related property - References
        //    xControl refCol = (xControl)sender;

        //    if (!string.IsNullOrEmpty(refCol.ReferenceColumn) &amp;&amp; refCol.ReferenceColumn.Split(&#39;.&#39;).Length == 2)
        //    {
        //        string foreignTable = refCol.ReferenceColumn.Split(&#39;.&#39;)[0];
        //        string foreignColumn = refCol.ReferenceColumn.Split(&#39;.&#39;)[1];

        //        if (!References.ContainsKey(foreignTable))
        //        {
        //            ForeignKeyReference obj = new ForeignKeyReference();
        //            obj.ReferedBy = refCol;
        //            obj.ReferenceColumn = foreignColumn;
        //            obj.ReferenceTable = foreignTable;
        //            References.Add(foreignTable, obj);
        //        }
        //    }
        //}

        //public void Controls_OnChildItemRemove(object sender, EventArgs e)
        //{
        //    // on each control remove check if this control is a reference column and update the related property - References

        //}

        internal bool ValidateData()
        {
            bool isValid = true;
            // Iterate through all the controls 
            return isValid;
        }

        public object EvaluateExpression(string expressionName, Dictionary&lt;string, string&gt; parameters)
        {
            return null;
        }

        public string GetSheetName(string sheetName)
        {
            string invalidCharsRegex = @&quot;[/\\*&#39;?[\]:]+&quot;;
            int maxLength = 31;

            sheetName = Regex.Replace(sheetName, invalidCharsRegex, &quot; &quot;)
                .Trim();

            if (string.IsNullOrEmpty(sheetName))
            {
                sheetName = &quot;Default&quot;; // cannot be empty
            }
            if (sheetName.Length &gt; maxLength)
            {
                sheetName = sheetName.Substring(0, maxLength);
            }
            return sheetName;
        }

        public DataSet GetSchema(bool excludeAttachmentControl = false)
        {
            DataSet schema = new DataSet();
            string sheetName = GetSheetName(form.ParseDynamicString(form.Header));

            DataTable dt = new DataTable(sheetName);
            schema.Tables.Add(dt);
            dt.Columns.Add(new DataColumn(&quot;RecordID&quot;));
            string table = form.ActualTableNameInDatabase;

            form.ProcessAllControlsDeeply(
                xc =&gt;
                {
                    if (
                            !xc.Type.IsEqualToAny(ControlType.Hidden, ControlType.Link, ControlType.Display, ControlType.Set, ControlType.PickerTrigger)
                            &amp;&amp; (xc.ParentObject is Section || xc.ParentObject is xControl)
                            &amp;&amp; !(excludeAttachmentControl &amp;&amp; xc.Type == ControlType.AttachmentControl)
                            &amp;&amp; (!xc.ReadOnly || (xc.ReadOnly &amp;&amp; xc.Value != null &amp;&amp; xc.Value.Contains(&quot;_Picker&quot;)))
                       )
                    {
                        string colName = string.IsNullOrEmpty(xc.Caption) ? xc.Name : xc.ParseDynamicString(xc.Caption);
                        if (dt.Columns.Contains(colName))
                        {
                            bool uniqueName = false;
                            int counter = 1;
                            while (!uniqueName)
                            {
                                if (!dt.Columns.Contains(colName + &quot;-&quot; + counter))
                                {
                                    uniqueName = true;
                                    colName = colName + &quot;-&quot; + counter;
                                    break;
                                }
                                else
                                    counter++;
                            }
                        }
                        dt.Columns.Add(new DataColumn(colName));
                    }
                });

            form.ProcessAllContainersDeeply(
                cc =&gt;
                {
                    if (cc is DynamicGrid || cc is StaticGrid)
                    {
                        if (((cc is StaticGrid) &amp;&amp; cc.Containers[0].GetType() == typeof(Header)) || cc is DynamicGrid)
                        {
                            sheetName =
                                GetSheetName(
                                    form.ParseDynamicString((cc is StaticGrid)
                                        ? (cc as StaticGrid).Caption
                                        : (cc as DynamicGrid).Caption));
                            if (schema.Tables.Contains(sheetName))
                            {
                                bool uniqueName = false;
                                int counter = 1;
                                while (!uniqueName)
                                {
                                    if (!schema.Tables.Contains(sheetName + &quot;-&quot; + counter))
                                    {
                                        uniqueName = true;
                                        sheetName = sheetName + &quot;-&quot; + counter;
                                        break;
                                    }
                                    else
                                        counter++;
                                }
                            }
                            DataTable dataTable = new DataTable(sheetName);
                            schema.Tables.Add(dataTable);
                            foreach (xControl xctrl in
                                (cc is StaticGrid) ? cc.Containers[0].Controls : cc.Controls)
                            {
                                if (!(excludeAttachmentControl &amp;&amp; xctrl.Type == ControlType.AttachmentControl) &amp;&amp;
                                    (xctrl.Type != Aurigo.Brix.Platform.BusinessLayer.XMLForm.ControlType.Hidden ||
                                     xctrl.ForeignKey)
                                     &amp;&amp; (!xctrl.ReadOnly || (xctrl.ReadOnly &amp;&amp; xctrl.Value != null &amp;&amp; xctrl.Value.Contains(&quot;_Picker&quot;)))
                                     )
                                {
                                    if (!xctrl.ForeignKey)
                                        dataTable.Columns.Add(
                                            new DataColumn(string.IsNullOrEmpty(xctrl.Caption)
                                                ? xctrl.Name
                                                : xctrl.ParseDynamicString(xctrl.Caption)));
                                    else
                                        dataTable.Columns.Add(new DataColumn(&quot;RecordID&quot;));
                                }
                            }
                        }
                    }
                });

            return schema;
        }

        public Dictionary&lt;string, string&gt; GetStagePermissions()
        {
            Dictionary&lt;string, string&gt; permissions = new Dictionary&lt;string, string&gt;();

            form.ProcessAllContainersDeeply(
                cc =&gt;
                {
                    if ((cc is Stage) &amp;&amp; (cc as Stage).SetPermission)
                    {
                        string stageName = cc.Name;
                        permissions.Add(&quot;Edit&quot; + stageName, &quot;Edit stage &quot; + stageName);
                        permissions.Add(&quot;View&quot; + stageName, &quot;View stage &quot; + stageName);
                    }
                });

            return permissions;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[19,57,19,70,0],[20,9,20,10,0],[20,11,20,12,0],[99,9,99,45,1],[102,9,102,37,1],[114,9,114,60,1],[120,9,120,60,1],[126,9,127,42,1],[169,9,169,51,1],[172,9,172,40,1],[190,9,190,72,1],[210,9,210,39,1],[213,9,213,40,1],[216,9,216,40,1],[219,9,219,42,1],[222,9,222,45,1],[225,9,225,46,1],[230,9,230,46,1],[234,9,234,47,1],[238,9,238,53,1],[246,9,246,51,1],[249,9,249,42,1],[289,17,289,18,1],[289,19,289,51,1],[289,52,289,53,1],[293,9,293,44,1],[296,37,296,41,1],[296,42,296,46,0],[299,9,299,69,1],[302,9,302,44,1],[309,9,309,72,1],[312,52,312,56,0],[312,57,312,61,0],[315,59,315,63,0],[315,64,315,68,0],[326,9,326,41,1],[344,9,344,128,1],[350,9,350,50,1],[353,9,353,48,1],[356,9,356,45,1],[361,9,361,10,1],[362,13,362,172,1],[363,13,363,56,1],[364,17,364,62,1],[366,13,366,104,1],[367,17,367,139,1],[368,9,368,10,1],[371,9,371,10,1],[372,13,372,53,1],[374,13,374,60,1],[375,13,375,30,1],[376,13,376,14,1],[377,17,377,127,1],[378,17,378,98,1],[380,13,380,14,1],[382,13,382,105,1],[384,13,384,75,1],[386,13,388,17,1],[388,17,388,18,1],[388,18,389,21,1],[389,21,389,169,1],[389,169,391,21,1],[391,21,391,85,1],[391,85,392,21,1],[392,21,392,22,1],[392,22,393,25,1],[393,25,393,59,1],[393,59,394,25,1],[394,25,394,64,1],[394,64,395,25,1],[395,25,395,176,1],[395,176,396,21,1],[396,21,396,22,1],[396,22,397,17,1],[397,17,397,18,1],[397,18,398,25,1],[386,13,398,25,1],[401,13,401,108,1],[403,13,403,47,1],[404,13,404,52,1],[405,13,405,182,1],[408,13,408,113,1],[410,13,410,33,1],[411,13,411,36,1],[413,13,413,61,1],[414,13,414,14,1],[415,17,415,41,1],[416,17,416,42,1],[418,17,418,69,1],[419,17,419,40,1],[420,13,420,14,1],[422,13,422,20,1],[422,22,422,40,0],[422,41,422,43,1],[422,44,422,70,1],[423,13,423,14,0],[424,17,424,154,0],[425,13,425,14,0],[426,13,426,32,1],[428,13,428,37,1],[429,13,429,14,1],[430,17,430,51,1],[431,17,431,18,1],[432,21,432,107,1],[433,25,433,73,1],[434,26,434,122,0],[435,25,435,121,0],[436,17,436,18,1],[437,13,437,14,1],[439,13,439,14,1],[440,17,440,103,1],[441,21,441,63,1],[442,22,442,118,0],[443,21,443,73,0],[444,13,444,14,1],[449,13,449,58,1],[450,9,450,10,1],[453,9,453,10,1],[455,13,456,55,1],[457,13,457,98,1],[458,13,458,34,1],[459,9,459,10,1],[462,9,462,10,0],[464,13,465,55,0],[466,13,466,100,0],[467,13,467,34,0],[468,9,468,10,0],[471,9,471,10,1],[473,13,474,55,1],[475,13,475,105,1],[476,13,476,34,1],[477,9,477,10,1],[480,9,480,10,1],[481,13,482,53,1],[483,13,483,96,1],[484,13,484,34,1],[485,9,485,10,1],[489,9,489,10,1],[492,13,492,78,1],[493,13,493,35,1],[494,9,494,10,1],[497,9,497,10,0],[498,13,498,82,0],[499,13,499,35,0],[500,9,500,10,0],[503,9,503,10,1],[504,13,507,42,1],[509,13,509,70,1],[512,13,512,45,1],[514,13,514,20,1],[514,22,514,67,1],[514,68,514,70,1],[514,71,514,81,1],[515,13,515,14,1],[517,17,517,53,1],[518,17,518,51,1],[519,17,519,18,1],[520,21,521,113,1],[523,21,523,28,1],[523,30,523,56,1],[523,57,523,59,1],[523,60,523,79,1],[524,21,524,22,1],[526,25,526,90,1],[527,21,527,22,1],[528,17,528,18,1],[529,13,529,14,1],[531,13,531,56,1],[532,13,533,28,1],[535,13,535,35,1],[536,9,536,10,1],[544,9,544,10,1],[545,13,545,59,1],[547,13,547,53,1],[548,13,548,55,1],[549,13,549,60,1],[550,13,550,30,1],[551,13,551,49,1],[552,13,552,52,1],[553,13,556,42,1],[559,13,559,91,1],[560,13,560,14,1],[561,17,563,18,1],[563,18,563,19,1],[563,19,565,22,1],[565,22,565,201,1],[565,201,566,22,1],[566,22,566,23,0],[566,23,568,26,1],[568,26,568,77,0],[568,77,569,26,1],[569,26,569,71,0],[569,71,570,26,1],[570,26,570,73,0],[570,73,571,26,1],[571,26,571,78,0],[571,78,572,26,1],[572,26,572,123,0],[572,123,573,26,1],[573,26,573,78,0],[573,78,574,30,1],[574,30,574,243,0],[574,243,576,30,1],[576,30,576,216,0],[576,216,577,26,1],[577,26,577,37,0],[577,37,578,22,1],[578,22,578,23,0],[578,23,580,22,1],[580,22,580,23,1],[580,23,581,26,1],[581,26,581,98,1],[581,98,582,22,1],[582,22,582,23,1],[582,23,583,18,1],[583,18,583,19,1],[583,19,584,26,1],[561,17,584,26,1],[586,17,586,24,1],[586,26,586,71,0],[586,72,586,74,1],[586,75,586,85,1],[587,17,587,18,0],[589,21,589,57,0],[590,21,590,55,0],[591,21,591,22,0],[592,25,592,32,0],[592,34,592,60,0],[592,61,592,63,0],[592,64,592,83,0],[593,25,593,26,0],[594,29,594,191,0],[596,29,596,124,0],[597,29,597,40,0],[598,25,598,26,0],[599,21,599,22,0],[600,17,600,18,0],[601,17,601,60,1],[602,17,603,39,1],[604,13,604,14,1],[605,13,605,35,1],[606,9,606,10,1],[614,9,614,10,1],[615,13,615,59,1],[616,13,616,30,1],[617,13,617,49,1],[619,13,619,53,1],[620,13,620,55,1],[621,13,621,60,1],[622,13,622,49,1],[623,13,623,46,1],[624,13,624,52,1],[625,13,628,46,1],[631,13,633,13,1],[633,13,633,14,1],[633,14,634,17,1],[634,17,634,175,1],[634,175,635,17,1],[635,17,635,18,1],[635,18,636,21,1],[636,21,636,115,1],[636,115,637,21,1],[637,21,637,22,1],[637,22,638,25,1],[638,25,638,50,1],[638,50,639,25,1],[639,25,639,32,1],[639,32,639,34,1],[639,34,639,48,1],[639,48,639,49,1],[639,49,639,51,1],[639,51,640,33,1],[640,33,640,93,1],[640,93,641,25,1],[641,25,641,26,1],[641,26,642,29,1],[642,29,642,248,1],[642,248,643,29,1],[643,29,643,30,0],[643,30,645,33,1],[645,33,645,85,0],[645,85,646,33,1],[646,33,646,78,0],[646,78,647,33,1],[647,33,647,80,0],[647,80,648,33,1],[648,33,648,85,0],[648,85,649,33,1],[649,33,649,131,0],[649,131,650,33,1],[650,33,650,85,0],[650,85,651,37,1],[651,37,651,251,0],[651,251,653,37,1],[653,37,653,224,0],[653,224,654,33,1],[654,33,654,44,0],[654,44,655,29,1],[655,29,655,30,0],[655,30,656,34,1],[656,34,656,188,1],[656,188,657,29,1],[657,29,657,30,1],[657,30,658,33,1],[658,33,658,55,1],[658,55,659,37,1],[659,37,659,111,1],[659,111,661,37,1],[661,37,661,103,1],[661,103,662,29,1],[662,29,662,30,1],[662,30,663,25,1],[663,25,663,26,1],[663,26,665,25,1],[665,25,665,68,1],[665,68,666,25,1],[666,25,667,47,1],[667,47,668,21,1],[668,21,668,22,1],[668,22,669,17,1],[669,17,669,18,1],[669,18,670,13,1],[670,13,670,14,1],[670,14,670,16,1],[631,13,670,16,1],[671,13,671,31,1],[672,9,672,10,1],[676,9,676,10,0],[677,13,677,36,0],[678,9,678,10,0],[681,9,681,10,0],[682,13,682,42,0],[683,13,683,20,0],[683,22,683,33,0],[683,34,683,36,0],[683,37,683,49,0],[684,13,684,14,0],[685,17,685,43,0],[686,17,686,18,0],[687,21,687,52,0],[687,52,687,89,0],[687,89,688,36,0],[688,36,688,102,0],[688,102,688,104,0],[687,21,688,104,0],[689,17,689,18,0],[690,22,690,59,0],[691,17,691,18,0],[692,21,692,78,0],[693,17,693,18,0],[694,13,694,14,0],[697,13,697,66,0],[697,66,697,114,0],[697,114,697,116,0],[697,13,697,116,0],[699,13,699,34,0],[700,9,700,10,0],[704,9,704,10,1],[706,13,706,47,1],[707,17,707,24,0],[710,13,710,61,1],[711,13,711,61,1],[711,61,711,96,1],[711,96,711,98,1],[711,13,711,98,1],[712,13,712,47,1],[713,13,713,14,1],[714,17,716,25,1],[716,25,717,109,1],[717,109,717,111,1],[714,17,717,111,1],[718,13,718,14,1],[721,13,721,20,1],[721,22,721,36,1],[721,37,721,39,1],[721,40,721,52,1],[722,13,722,14,1],[723,17,723,95,1],[724,17,724,18,1],[726,21,726,75,1],[727,21,727,77,1],[727,77,727,112,1],[727,112,727,114,1],[727,21,727,114,1],[728,21,728,61,1],[729,21,729,22,0],[730,25,732,33,0],[732,33,734,50,0],[734,50,734,52,0],[730,25,734,52,0],[735,21,735,22,0],[737,21,737,28,1],[737,30,737,49,1],[737,50,737,52,1],[737,53,737,67,1],[738,21,738,22,1],[745,25,748,88,1],[749,25,749,26,1],[750,29,750,76,1],[751,29,751,107,1],[753,29,753,98,1],[754,29,754,30,1],[755,33,755,66,1],[756,29,756,30,1],[758,29,758,30,1],[759,33,759,85,1],[761,33,761,80,1],[763,33,764,65,1],[765,33,765,34,0],[766,37,766,86,0],[767,37,767,38,0],[768,41,768,110,0],[769,41,769,42,0],[770,45,776,52,0],[777,41,777,42,0],[779,45,780,109,0],[781,37,781,38,0],[782,33,782,34,0],[783,33,783,74,1],[784,33,784,63,1],[786,29,786,30,1],[787,25,787,26,1],[788,21,788,22,1],[789,17,789,18,1],[790,22,790,83,1],[791,17,791,18,1],[797,21,799,84,1],[800,21,800,22,1],[801,25,801,43,1],[802,25,802,67,1],[803,25,803,46,1],[804,29,804,70,1],[805,25,805,74,1],[806,25,806,26,1],[811,29,811,47,1],[812,25,812,26,1],[814,25,814,26,1],[815,29,815,48,1],[816,25,816,26,1],[818,25,818,114,1],[819,25,819,26,1],[820,29,820,62,1],[821,29,821,65,1],[822,29,822,59,1],[823,29,823,73,1],[824,29,824,30,1],[825,33,825,97,1],[826,33,826,34,1],[827,37,833,48,1],[834,33,834,34,1],[836,33,836,34,1],[837,37,837,119,1],[838,33,838,34,1],[839,29,839,30,1],[840,25,840,26,1],[842,25,842,26,1],[843,29,843,77,1],[844,29,844,30,1],[849,33,849,80,1],[851,33,851,75,1],[852,33,852,129,1],[852,129,852,137,0],[852,137,852,140,1],[852,33,852,140,1],[853,33,853,34,1],[854,37,854,73,1],[855,37,855,67,1],[856,33,856,34,1],[857,29,857,30,1],[858,25,858,26,1],[859,21,859,22,1],[860,17,860,18,1],[861,13,861,14,1],[862,9,862,10,1],[865,9,865,10,1],[866,13,866,31,1],[867,17,867,29,0],[869,13,869,57,1],[870,13,870,14,1],[871,17,871,53,1],[872,13,872,14,1],[873,13,873,26,1],[874,9,874,10,1],[877,9,877,10,1],[878,13,878,101,1],[879,13,879,14,1],[880,17,880,31,1],[881,17,884,32,1],[885,17,885,31,1],[886,21,886,180,0],[887,13,887,14,1],[888,9,888,10,1],[891,9,891,10,1],[892,13,892,54,1],[893,17,893,44,1],[895,13,895,83,1],[897,13,897,100,1],[898,13,898,14,0],[900,17,900,31,0],[901,17,903,32,0],[904,17,904,31,0],[905,21,905,38,0],[907,21,907,37,0],[908,13,908,14,0],[912,13,912,20,1],[912,22,912,43,1],[912,44,912,46,1],[912,47,912,62,1],[913,13,913,14,1],[914,17,914,42,1],[914,43,914,52,0],[915,17,915,103,1],[916,13,916,14,1],[918,13,918,57,1],[919,17,919,24,0],[921,13,921,42,1],[922,13,922,14,1],[923,17,923,41,1],[924,17,924,47,1],[925,13,925,14,1],[928,18,928,27,1],[928,29,928,45,1],[928,47,928,50,1],[929,17,929,47,1],[930,21,930,40,1],[933,13,933,61,1],[934,13,934,58,1],[935,13,935,14,1],[936,17,936,52,1],[937,17,937,54,1],[938,13,938,14,1],[940,13,940,26,1],[941,13,941,14,1],[942,17,942,71,1],[943,17,943,63,1],[944,17,944,18,1],[945,21,945,59,1],[946,21,946,96,1],[947,17,947,18,1],[949,21,949,69,0],[950,13,950,14,1],[952,13,952,14,1],[953,17,953,38,1],[954,21,954,52,1],[956,17,956,109,1],[957,17,957,65,1],[958,13,958,14,1],[961,13,961,43,1],[964,13,964,38,1],[965,9,965,10,1],[968,9,968,10,1],[969,13,970,13,1],[970,13,970,14,1],[970,14,972,17,1],[972,17,973,96,1],[973,96,974,17,1],[974,17,974,18,0],[974,18,975,21,1],[975,21,975,43,0],[975,43,976,17,1],[976,17,976,18,0],[976,18,977,13,1],[977,13,977,14,1],[977,14,977,16,1],[969,13,977,16,1],[978,9,978,10,1],[981,9,981,10,0],[982,13,982,65,0],[983,13,983,81,0],[984,13,984,66,0],[985,13,985,85,0],[986,13,986,78,0],[987,13,989,58,0],[991,13,991,20,0],[991,22,991,39,0],[991,40,991,42,0],[991,43,991,91,0],[992,13,992,14,0],[993,17,993,105,0],[994,17,994,18,0],[995,21,995,75,0],[996,21,996,89,0],[997,25,997,68,0],[998,17,998,18,0],[999,13,999,14,0],[1000,9,1000,10,0],[1003,9,1003,10,0],[1004,13,1004,70,0],[1006,13,1006,71,0],[1007,17,1007,69,0],[1009,17,1009,58,0],[1010,13,1010,20,0],[1010,22,1010,35,0],[1010,36,1010,38,0],[1010,39,1010,46,0],[1011,13,1011,14,0],[1012,17,1012,55,0],[1013,17,1013,32,0],[1014,17,1014,18,0],[1015,21,1017,85,0],[1018,21,1018,56,0],[1019,21,1020,56,0],[1021,21,1021,22,0],[1022,25,1022,57,0],[1023,25,1023,60,0],[1023,60,1023,77,0],[1023,77,1023,79,0],[1023,25,1023,79,0],[1024,25,1024,46,0],[1025,29,1025,54,0],[1026,21,1026,22,0],[1027,21,1027,53,0],[1028,21,1028,22,0],[1029,25,1029,100,0],[1030,29,1030,96,0],[1031,21,1031,22,0],[1032,21,1032,117,0],[1033,17,1033,18,0],[1034,13,1034,14,0],[1036,13,1036,48,0],[1037,9,1037,10,0],[1040,9,1040,10,1],[1049,13,1049,104,1],[1050,13,1050,34,1],[1051,13,1051,35,1],[1052,13,1052,33,1],[1053,13,1053,20,1],[1053,22,1053,32,1],[1053,33,1053,35,1],[1053,36,1053,55,1],[1054,13,1054,14,1],[1055,17,1055,56,1],[1056,21,1056,92,1],[1057,13,1057,14,1],[1059,13,1059,50,1],[1060,17,1060,69,1],[1062,13,1062,20,1],[1062,22,1062,32,1],[1062,33,1062,35,1],[1062,36,1062,55,1],[1063,13,1063,14,1],[1064,17,1064,47,1],[1065,17,1066,91,1],[1067,17,1067,18,1],[1068,21,1068,75,1],[1070,21,1070,58,1],[1071,25,1071,44,0],[1072,21,1074,81,1],[1075,21,1075,35,1],[1076,21,1076,104,1],[1077,21,1077,35,1],[1078,21,1078,22,0],[1079,25,1079,64,0],[1080,25,1080,26,0],[1082,29,1082,53,0],[1083,29,1083,67,0],[1084,29,1084,47,0],[1085,29,1085,30,0],[1086,33,1088,96,0],[1089,29,1089,30,0],[1090,29,1090,59,0],[1091,29,1091,42,0],[1092,25,1092,26,0],[1093,21,1093,22,0],[1094,17,1094,18,1],[1095,13,1095,14,1],[1096,13,1096,23,1],[1097,13,1097,14,0],[1098,17,1098,70,0],[1099,17,1099,47,0],[1101,9,1101,10,1],[1105,9,1105,10,1],[1106,13,1106,98,1],[1107,13,1107,37,1],[1108,13,1108,20,1],[1108,22,1108,32,1],[1108,33,1108,35,1],[1108,36,1108,55,1],[1109,13,1109,14,1],[1110,17,1110,51,1],[1111,17,1111,18,1],[1112,21,1112,85,1],[1113,21,1113,60,1],[1114,21,1114,22,1],[1115,25,1115,40,1],[1116,21,1116,22,1],[1117,17,1117,18,1],[1118,13,1118,14,1],[1119,13,1119,25,1],[1120,13,1120,14,1],[1121,17,1121,73,1],[1123,17,1125,77,1],[1126,17,1126,31,1],[1127,17,1127,106,1],[1129,17,1129,31,1],[1130,17,1130,18,1],[1131,21,1131,42,1],[1133,21,1133,28,1],[1133,30,1133,40,1],[1133,41,1133,43,1],[1133,44,1133,63,1],[1134,21,1134,22,1],[1135,25,1135,64,1],[1136,25,1136,26,1],[1138,29,1138,53,1],[1139,29,1139,67,1],[1140,29,1140,47,1],[1141,29,1141,30,1],[1142,33,1144,96,1],[1145,29,1145,30,1],[1146,29,1146,59,1],[1147,25,1147,26,1],[1148,21,1148,22,1],[1149,21,1149,74,1],[1151,21,1151,51,1],[1153,13,1153,14,1],[1154,9,1154,10,1],[1158,9,1158,10,1],[1159,13,1159,38,1],[1160,17,1160,116,1],[1162,13,1162,20,1],[1162,22,1162,40,1],[1162,41,1162,43,1],[1162,44,1162,64,1],[1163,13,1163,14,1],[1167,17,1167,100,1],[1168,13,1168,14,1],[1169,9,1169,10,1],[1172,9,1172,10,0],[1173,13,1173,29,0],[1174,13,1174,27,0],[1175,13,1175,31,0],[1176,13,1176,38,0],[1176,39,1176,105,0],[1177,13,1177,24,0],[1178,9,1178,10,0],[1182,9,1182,10,0],[1183,13,1183,29,0],[1184,13,1184,27,0],[1185,13,1185,31,0],[1186,13,1186,42,0],[1187,17,1188,33,0],[1189,13,1189,24,0],[1190,9,1190,10,0],[1193,9,1193,10,0],[1194,13,1194,27,0],[1195,13,1195,33,0],[1196,13,1196,38,0],[1196,39,1196,109,0],[1197,13,1197,27,0],[1198,9,1198,10,0],[1202,9,1202,10,0],[1203,13,1203,27,0],[1204,13,1204,33,0],[1205,13,1205,42,0],[1206,17,1207,33,0],[1208,13,1208,27,0],[1209,9,1209,10,0],[1216,47,1216,51,1],[1216,52,1216,56,1],[1219,45,1219,49,1],[1219,50,1219,54,1],[1229,9,1229,22,1],[1230,9,1230,10,1],[1231,13,1231,30,1],[1232,13,1232,28,1],[1237,9,1237,10,1],[1268,9,1268,10,1],[1269,13,1269,33,1],[1271,13,1271,28,1],[1272,9,1272,10,1],[1275,9,1275,10,0],[1276,13,1276,25,0],[1277,9,1277,10,0],[1280,9,1280,10,1],[1281,13,1281,57,1],[1282,13,1282,32,1],[1284,13,1285,25,1],[1287,13,1287,49,1],[1288,13,1288,14,0],[1289,17,1289,39,0],[1290,13,1290,14,0],[1291,13,1291,46,1],[1292,13,1292,14,0],[1293,17,1293,63,0],[1294,13,1294,14,0],[1295,13,1295,30,1],[1296,9,1296,10,1],[1299,9,1299,10,1],[1300,13,1300,44,1],[1301,13,1301,83,1],[1303,13,1303,53,1],[1304,13,1304,35,1],[1305,13,1305,56,1],[1306,13,1306,59,1],[1308,13,1310,17,1],[1310,17,1310,18,1],[1310,18,1311,21,1],[1311,21,1316,25,1],[1316,25,1317,21,1],[1317,21,1317,22,1],[1317,22,1318,25,1],[1318,25,1318,121,1],[1318,121,1319,25,1],[1319,25,1319,58,1],[1319,58,1320,25,1],[1320,25,1320,26,0],[1320,26,1321,29,1],[1321,29,1321,53,0],[1321,53,1322,29,1],[1322,29,1322,45,0],[1322,45,1323,29,1],[1323,29,1323,48,0],[1323,48,1324,29,1],[1324,29,1324,30,0],[1324,30,1325,33,1],[1325,33,1325,83,0],[1325,83,1326,33,1],[1326,33,1326,34,0],[1326,34,1327,37,1],[1327,37,1327,55,0],[1327,55,1328,37,1],[1328,37,1328,71,0],[1328,71,1329,37,1],[1329,37,1329,43,0],[1329,43,1332,37,1],[1332,37,1332,47,0],[1332,47,1333,29,1],[1333,29,1333,30,0],[1333,30,1334,25,1],[1334,25,1334,26,0],[1334,26,1335,25,1],[1335,25,1335,65,1],[1335,65,1336,21,1],[1336,21,1336,22,1],[1336,22,1337,17,1],[1337,17,1337,18,1],[1337,18,1337,20,1],[1308,13,1337,20,1],[1339,13,1341,17,1],[1341,17,1341,18,1],[1341,18,1342,21,1],[1342,21,1342,63,1],[1342,63,1343,21,1],[1343,21,1343,22,0],[1343,22,1344,25,1],[1344,25,1344,119,0],[1344,119,1345,25,1],[1345,25,1345,26,0],[1345,26,1346,29,1],[1346,29,1350,73,0],[1350,73,1351,29,1],[1351,29,1351,67,0],[1351,67,1352,29,1],[1352,29,1352,30,0],[1352,30,1353,33,1],[1353,33,1353,57,0],[1353,57,1354,33,1],[1354,33,1354,49,0],[1354,49,1355,33,1],[1355,33,1355,52,0],[1355,52,1356,33,1],[1356,33,1356,34,0],[1356,34,1357,37,1],[1357,37,1357,92,0],[1357,92,1358,37,1],[1358,37,1358,38,0],[1358,38,1359,41,1],[1359,41,1359,59,0],[1359,59,1360,41,1],[1360,41,1360,79,0],[1360,79,1361,41,1],[1361,41,1361,47,0],[1361,47,1364,41,1],[1364,41,1364,51,0],[1364,51,1365,33,1],[1365,33,1365,34,0],[1365,34,1366,29,1],[1366,29,1366,30,0],[1366,30,1367,29,1],[1367,29,1367,76,0],[1367,76,1368,29,1],[1368,29,1368,58,0],[1368,58,1369,29,1],[1369,29,1369,36,0],[1369,36,1369,38,1],[1369,38,1369,52,0],[1369,52,1369,53,1],[1369,53,1369,55,0],[1369,55,1370,33,1],[1370,33,1370,93,0],[1370,93,1371,29,1],[1371,29,1371,30,0],[1371,30,1372,33,1],[1372,33,1376,39,0],[1376,39,1377,33,1],[1377,33,1377,34,0],[1377,34,1378,37,1],[1378,37,1378,59,0],[1378,59,1379,41,1],[1379,41,1382,93,0],[1382,93,1384,41,1],[1384,41,1384,91,0],[1384,91,1385,33,1],[1385,33,1385,34,0],[1385,34,1386,29,1],[1386,29,1386,30,0],[1386,30,1387,25,1],[1387,25,1387,26,0],[1387,26,1388,21,1],[1388,21,1388,22,0],[1388,22,1389,17,1],[1389,17,1389,18,1],[1389,18,1389,20,1],[1339,13,1389,20,1],[1391,13,1391,27,1],[1392,9,1392,10,1],[1395,9,1395,10,1],[1396,13,1396,87,1],[1398,13,1400,17,1],[1400,17,1400,18,1],[1400,18,1401,21,1],[1401,21,1401,70,1],[1401,70,1402,21,1],[1402,21,1402,22,0],[1402,22,1403,25,1],[1403,25,1403,52,0],[1403,52,1404,25,1],[1404,25,1404,88,0],[1404,88,1405,25,1],[1405,25,1405,88,0],[1405,88,1406,21,1],[1406,21,1406,22,0],[1406,22,1407,17,1],[1407,17,1407,18,1],[1407,18,1407,20,1],[1398,13,1407,20,1],[1409,13,1409,32,1],[1410,9,1410,10,1]]);
    </script>
  </body>
</html>