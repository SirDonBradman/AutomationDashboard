<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Construction Vertical\Main Modules\Estimator\UI\BidLetting.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Text.RegularExpressions;
using System.Web.UI;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core.UserControls;
using Aurigo.AMP3.EstimatorBL;
using Aurigo.AMP3.Logging;
using Aurigo.AMP3.ProjectBL;
using Aurigo.AMP3.ProjectDTO;
using Aurigo.AMP3.Resources.MessageResources;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.Brix.Core.WebUiHelper;
using Aurigo.Brix.Platform.BusinessLayer.UserControls;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Estimator = Aurigo.AMP3.EstimatorDTO;
using System.Web.UI.WebControls;
using Aurigo.Brix.Platform.BusinessLayer.AbstractModels;
using Aurigo.AMP3.DataAccess.Core;
using System.Configuration;
using Aurigo.AMP3.Core.BusinessLayer.BL;
using Aurigo.Brix.Platform.BusinessLayer.Utility;

namespace Aurigo.AMP3.EstimatorUI
{
    //SCREEN TO ENTER BIDLETTING DETAILS
    public partial class BidLetting : BrixPageBase, IXMLControl
    {
        private string isCreateLetting = &quot;N&quot;;
        private int projectID;
        protected int projectEstimateID;
        protected bool approveStatus;
        protected bool lockStatus;

        protected int ContrOrItemCount
        {
            get { return Convert.ToInt32(ViewState[&quot;ContrOrItemCount&quot;]); }
        }

        protected override void OnInit(EventArgs e)
        {
            int permCount = PermissionsToCheck.Count;

            string typeOfEdit = Request.QueryString[&quot;Type&quot;];
            string isAdd = Request.QueryString[&quot;Add&quot;];

            if (typeOfEdit == &quot;E&quot; &amp;&amp; isAdd == &quot;Y&quot;)
                PermissionsToCheck.Add(&quot;AddendumEdit&quot;);
            else if (typeOfEdit == &quot;E&quot; &amp;&amp; isAdd == &quot;N&quot;)
                PermissionsToCheck.Add(Constants.MODFEAT_EDIT);
            else if (typeOfEdit == &quot;A&quot; &amp;&amp; isAdd == &quot;Y&quot;)
                PermissionsToCheck.Add(&quot;AddendumCreate&quot;);
            else if (typeOfEdit == &quot;A&quot; &amp;&amp; isAdd == &quot;N&quot;)
                PermissionsToCheck.Add(Constants.MODFEAT_CREATE);

            if (permCount + 1 == PermissionsToCheck.Count)
                PermissionsToCheck.Add(Constants.MODFEAT_VISIBILITY);

            var menus = new MenuArray();
            AddSaveButton(menus);
            menus.Add(new BrixMenu(&quot;lnkCancel&quot;, &quot;Cancel&quot;, &quot;Icn_Cancel.png&quot;, 55));
            CreateToolBarMenu(menus, null);
            base.OnInit(e);
        }

        protected override void CustomizeToolBar()
        {
            if (HasSaveButton)
            {
                Aurigo.AMP3.Core.UserControls.Menu lnkSave = GetSaveButton();
                if (null != lnkSave)
                {
                    lnkSave.Click += new EventHandler(btnSave_Click);
                    lnkSave.OnClientClick = &quot;return Validate();&quot;;
                }
            }
            MainToolBar.GetMenuReference(&quot;lnkCancel&quot;).Click += new EventHandler(btnCancel_Click);
            base.CustomizeToolBar();
        }

        protected virtual void Page_Load(object sender, EventArgs e)
        {
            try
            {
                UIHelper.DisableRoleSelection(Page);

                lblError.Text = String.Empty;
                LocalizePageLabels();

                // Getting the projectID from the querystring
                if (String.IsNullOrEmpty(Request.QueryString.Get(EstimatorConstants.PID)) ||
                    !int.TryParse(Request.QueryString.Get(EstimatorConstants.PID), out projectID))
                {
                    UIHelper.RedirectURL(&quot;Error loading the requested page.&quot;, ResolveUrl(Constants.URL_PROJECTS),
                                         null, Context);
                }

                var featurelist = (List&lt;string&gt;)Context.Items[Constants.MODULE_PERMISSIONS];


                int.TryParse(Request.QueryString.Get(&quot;ProjectEstimateID&quot;), out projectEstimateID);


                if (!String.IsNullOrEmpty(Request.QueryString.Get(&quot;Add&quot;)) &amp;&amp;
                    !String.IsNullOrEmpty(Request.QueryString.Get(&quot;Type&quot;)))
                //&amp;&amp; (Request.QueryString.Get(&quot;Type&quot;) == &quot;A&quot;
                //       &amp;&amp; Request.QueryString.Get(&quot;Add&quot;) == &quot;N&quot;))
                {
                    isCreateLetting = &quot;Y&quot;;
                    {
                        PageTitle = (Request.QueryString.Get(&quot;Type&quot;) == &quot;E&quot; &amp;&amp;
                                     Request.QueryString.Get(&quot;Add&quot;) == &quot;Y&quot;)
                                        ? &quot;Edit Addendum Details&quot;
                                        : (Request.QueryString.Get(&quot;Type&quot;) == &quot;E&quot; &amp;&amp;
                                           Request.QueryString.Get(&quot;Add&quot;) == &quot;N&quot;)
                                              ? LocalizationManager.GetString(&quot;Edit Bid Letting Details&quot;)
                                              : (Request.QueryString.Get(&quot;Type&quot;) == &quot;A&quot; &amp;&amp;
                                                 Request.QueryString.Get(&quot;Add&quot;) == &quot;N&quot;)
                                                    ? LocalizationManager.GetString(&quot;Create New Bid Letting&quot;)
                                                    : (Request.QueryString.Get(&quot;Type&quot;) == &quot;A&quot; &amp;&amp;
                                                       Request.QueryString.Get(&quot;Add&quot;) == &quot;Y&quot;)
                                                          ? &quot;Create New Addendum&quot;
                                                          : &quot;&quot;;
                    }
                }

                if (!Page.IsPostBack)
                {
                    string errDocuSign = string.Empty;
                    if (Session[&quot;DocuSignErr&quot;] != null)
                        errDocuSign = Session[&quot;DocuSignErr&quot;].ToString();

                    if (!string.IsNullOrEmpty(errDocuSign))
                    {
                        ShowError(errDocuSign);
                        Session.Remove(&quot;DocuSignErr&quot;);
                    }

                    SetLabel();

                    //DEFAULT SETTINGS
                    Form.DefaultButton = btnSave.UniqueID;
                    wdcDateIssue.Value = MWDateTimeHelper.MWToday;
                    wdcDatePub.Value = MWDateTimeHelper.MWToday;
                    wdcAddendumIssueDate.Value = MWDateTimeHelper.MWToday;
                    wdcDateMeeting.Value = MWDateTimeHelper.MWToday;
                    //wdcAddendumIssueDate.Value = null;
                    //wdcDateMeeting.Value = null;

                    radbidOpnTime.SelectedDate = MWDateTimeHelper.MWToday;
                    radbidOpnTime.Culture = DateFormatCulture.GetDateFormatCulture();
                    radbidOpnTime.DateInput.DateFormat = AMP3ApplicationSettings.Instance.FORMAT_DATETIME;
                    radbidOpnTime.DateInput.DisplayDateFormat = AMP3ApplicationSettings.Instance.FORMAT_DATETIME;

                    radbidDueTime.DateInput.DateFormat = AMP3ApplicationSettings.Instance.FORMAT_TIME;
                    radbidDueTime.DateInput.DisplayDateFormat = AMP3ApplicationSettings.Instance.FORMAT_TIME;

                    // Populates the user and the status drop down lists.
                    UserAndStatus();

                    //GETTING THE PROJECTID AND PROJECTNAME 
                    Project dtoProj = ProjectManager.Instance.GetProjectDetails(projectID);
                    lblProjectestimateID.Text = (dtoProj.ProjectCode + &quot;,&quot; + dtoProj.ProjectName).BrixHTMLEncode();

                    if (!String.IsNullOrEmpty(Request.QueryString.Get(&quot;Add&quot;)) &amp;&amp;
                                         Request.QueryString.Get(&quot;Add&quot;) == &quot;Y&quot;)
                    {
                        //Get count of items added to addendum
                        if (!String.IsNullOrEmpty(Request[&quot;BID&quot;]))
                            ViewState[&quot;ContrOrItemCount&quot;] = EstimateManager.Instance.GetAddendumItemsCount(Request[&quot;BID&quot;].ToInt32_2());
                    }
                    else
                    {
                        //Get count of contractor records added in bid Management
                        ViewState[&quot;ContrOrItemCount&quot;] = EstimateManager.Instance.GetBidListCount(projectEstimateID);
                    }

                    txtDescription.Attributes.Add(&quot;maxLength&quot;, &quot;100&quot;);
                    txtAddress.Attributes.Add(&quot;maxLength&quot;, &quot;100&quot;);
                    txtAddDescription.Attributes.Add(&quot;maxLength&quot;, &quot;100&quot;);

                    trAddDescription.Style.Add(HtmlTextWriterStyle.Display,
                                               (!String.IsNullOrEmpty(Request.QueryString.Get(&quot;Add&quot;)) &amp;&amp;
                                                Request.QueryString.Get(&quot;Add&quot;) != &quot;Y&quot;)
                                                   ? &quot;none&quot;
                                                   : &quot;table-row&quot;);
                    trAddress.Style.Add(HtmlTextWriterStyle.Display,
                                        (!String.IsNullOrEmpty(Request.QueryString.Get(&quot;Add&quot;)) &amp;&amp;
                                         Request.QueryString.Get(&quot;Add&quot;) == &quot;Y&quot;)
                                            ? &quot;none&quot;
                                            : &quot;table-row&quot;);
                    trNotes.Style.Add(HtmlTextWriterStyle.Display,
                                      (!String.IsNullOrEmpty(Request.QueryString.Get(&quot;Add&quot;)) &amp;&amp;
                                       Request.QueryString.Get(&quot;Add&quot;) == &quot;Y&quot;)
                                          ? &quot;none&quot;
                                          : &quot;table-row&quot;);

                    trBidLettingDesc.Style.Add(HtmlTextWriterStyle.Display,
                                              (!String.IsNullOrEmpty(Request.QueryString.Get(&quot;Add&quot;)) &amp;&amp;
                                               Request.QueryString.Get(&quot;Add&quot;) == &quot;Y&quot;)
                                                  ? &quot;none&quot;
                                                  : &quot;table-row&quot;);

                    //only visible for addendum
                    trAddendumIssueDate.Style.Add(HtmlTextWriterStyle.Display,
                                             (!String.IsNullOrEmpty(Request.QueryString.Get(&quot;Add&quot;)) &amp;&amp;
                                              Request.QueryString.Get(&quot;Add&quot;) == &quot;N&quot;)
                                                 ? &quot;none&quot;
                                                 : &quot;table-row&quot;);

                    if (!String.IsNullOrEmpty(Request.QueryString.Get(&quot;Add&quot;)) &amp;&amp; Request.QueryString.Get(&quot;Add&quot;) == &quot;Y&quot; &amp;&amp;
                        string.IsNullOrEmpty(Request[&quot;BID&quot;]))
                    {
                        trNotes.Style.Add(HtmlTextWriterStyle.Display, &quot;none&quot;);
                        trAddress.Style.Add(HtmlTextWriterStyle.Display, &quot;none&quot;);

                        DataTable dtBidLetDetails =
                            EstimateManager.Instance.GetBidLetDetail(-1,
                                                       Request[EstimatorConstants.PROJECT_ESTIMATE_ID].ToInt32_2());

                        DataRow dr = dtBidLetDetails.Rows[0];

                        if (dr[&quot;BidDueDateTime&quot;] != DBNull.Value)
                            radbidDueTime.SelectedDate = dr[&quot;BidDueDateTime&quot;].ToMWDateTime();

                        if (dr[&quot;DatePublished&quot;] != DBNull.Value)
                            wdcDatePub.Value = dr[&quot;DatePublished&quot;].ToDateTime_MWCulture().ToMWDateTime();
                        if (dr[&quot;LettingDate&quot;] != DBNull.Value)
                            radbidOpnTime.SelectedDate = dr[&quot;LettingDate&quot;].ToMWDateTime();
                        if (dr[&quot;IssueDate&quot;] != DBNull.Value)
                            wdcDateIssue.Value = dr[&quot;IssueDate&quot;].ToDateTime_MWCulture().ToMWDateTime();

                        if ((DBNull.Value.Equals(dr[&quot;PreBidMeetingDate&quot;])))
                        {
                            wdcDateMeeting.Value = null;
                        }
                        else
                        {
                            wdcDateMeeting.Value = dr[&quot;PreBidMeetingDate&quot;].ToDateTime_MWCulture().ToMWDateTime();
                        }
                        if ((DBNull.Value.Equals(dr[&quot;AddendumIssueDate&quot;])))
                        {
                            wdcAddendumIssueDate.Value = DateTime.UtcNow;
                        }
                        else
                        {
                            wdcAddendumIssueDate.Value = dr[&quot;AddendumIssueDate&quot;].ToDateTime_MWCulture().ToMWDateTime();
                        }

                    }


                    if (!String.IsNullOrEmpty(Request.QueryString.Get(&quot;BID&quot;)))
                    {
                        ViewState[&quot;ID&quot;] = Request.QueryString.Get(&quot;BID&quot;);

                        DataTable dtBidLetDetails =
                            EstimateManager.Instance.GetBidLetDetail(Request.QueryString.Get(&quot;BID&quot;).ToInt32_2(),
                                                       Request[EstimatorConstants.PROJECT_ESTIMATE_ID].ToInt32_2());


                        if (dtBidLetDetails.Rows.Count == 0)
                        {
                            ShowNotificationMessage(&quot;The record you are trying to edit does not exists in the system.&quot;, NotificationType.Error);
                            return;
                        }

                        DataRow dr = dtBidLetDetails.Rows[0];

                        wdcDatePub.Value = dr[&quot;DatePublished&quot;].ToDateTime_MWCulture().ToMWDateTime();
                        if (dr[&quot;LettingDate&quot;] != DBNull.Value)
                            radbidOpnTime.SelectedDate = dr[&quot;LettingDate&quot;].ToDateTime_MWCulture().ToMWDateTime();
                        if ((DBNull.Value.Equals(dr[&quot;IssueDate&quot;])))
                        {
                            wdcDateIssue.Value = null;
                            wdcDateIssue.NullDateLabel = &quot;None&quot;;
                            wdcDateIssue.NullValueRepresentation = Infragistics.WebUI.WebSchedule.NullValueRepresentation.DBNull;
                        }
                        else
                        {
                            wdcDateIssue.Value = dr[&quot;IssueDate&quot;].ToDateTime_MWCulture().ToMWDateTime();
                        }

                        if ((DBNull.Value.Equals(dr[&quot;PreBidMeetingDate&quot;])))
                        {
                            wdcDateMeeting.Value = null;
                        }
                        else
                        {
                            wdcDateMeeting.Value = dr[&quot;PreBidMeetingDate&quot;].ToDateTime_MWCulture().ToMWDateTime();
                        }

                        if ((DBNull.Value.Equals(dr[&quot;AddendumIssueDate&quot;])))
                        {
                            wdcAddendumIssueDate.Value = DateTime.UtcNow;
                        }
                        else
                        {
                            wdcAddendumIssueDate.Value = dr[&quot;AddendumIssueDate&quot;].ToDateTime_MWCulture().ToMWDateTime();
                        }


                        txtBidLettingDesc.Text = dr[&quot;LettingDesc&quot;].ToString2();

                        if (dr[&quot;Type&quot;].ToString2() == &quot;Letting&quot;)
                            txtDescription.Text = dr[&quot;Description&quot;].ToString2();
                        else
                            txtAddDescription.Text = dr[&quot;Description&quot;].ToString2();

                        txtAddress.Text = dr[&quot;Address&quot;].ToString2();
                        txtID.Text = dr[&quot;BidID&quot;].ToString2();

                        radbidDueTime.SelectedDate = dr[&quot;BidDueDateTime&quot;].ToMWDateTimeNullable();

                        if (ddlProjUsers.Items.FindByText(dr[&quot;BallInCourt&quot;].ToString2()) != null)
                        {
                            if (ddlProjUsers.Items.FindByValue(ddlProjUsers.SelectedItem.Value) != null)
                                ddlProjUsers.Items.FindByValue(ddlProjUsers.SelectedItem.Value).Selected = false;
                            ddlProjUsers.Items.FindByText(dr[&quot;BallInCourt&quot;].ToString2()).Selected = true;
                        }

                        bool canRedraft = true;
                        if (dr[&quot;Status&quot;].ToString2() == &quot;Issued&quot; || dr[&quot;Status&quot;].ToString2() == &quot;Cancelled&quot; || dr[&quot;Status&quot;].ToString2() == &quot;Awarded&quot;)
                        {
                            ViewState[&quot;IsRecordIssued&quot;] = &quot;1&quot;;
                            ddlProjUsers.Enabled =
                                wdcDateMeeting.Enabled =
                                wdcDatePub.Enabled =
                                radbidOpnTime.Enabled =
                                radbidDueTime.Enabled =
                                wdcAddendumIssueDate.Enabled =
                                wdcDateIssue.Enabled = false;



                            // If addendum exists or if the bid letting is cancelled, redraft is not allowed for bid letting.
                            canRedraft = (Request.QueryString.Get(&quot;Add&quot;) == &quot;N&quot;) ? !(EstimateManager.Instance.isExistsAddendum(projectEstimateID)) &amp;&amp; dr[&quot;Status&quot;].ToString2() != &quot;Cancelled&quot; : true;


                            //If Request.QueryString.Get(&quot;Add&quot;) == &#39;Y&#39; means addendum, check if itemcount is greater than zero, then hide the save button,
                            //If it is Bid, then check the contractorCount in bid management is greater than zero, then hide the save button
                            if (MainToolBar.GetMenuReference(&quot;lnkSave&quot;) != null
                                    &amp;&amp; (!canRedraft || ContrOrItemCount &gt; 0))
                                MainToolBar.HideMenu(&quot;lnkSave&quot;);

                            txtID.ReadOnly =
                                txtDescription.ReadOnly =
                                txtAddress.ReadOnly =
                                txtAddDescription.ReadOnly =
                                txtBidLettingDesc.ReadOnly =
                                (attachments as AttachmentsControl).ReadOnly = true;
                        }

                        if (ddlStatus.Items.FindByText(dr[&quot;Status&quot;].ToString2()) != null)
                        {
                            if (dr[&quot;Status&quot;].ToString2() == &quot;Draft&quot;)
                            {
                                ddlStatus.Items.Remove(ddlStatus.Items.FindByText(&quot;Cancelled&quot;));
                            }
                            else
                            {
                                //If are no contractor records added in bid mngmnt for Bid letting or no items are added to addedeum, drop down is enabled and items to be listed is ReDraft and Issued
                                if (canRedraft &amp;&amp; ContrOrItemCount == 0)
                                {
                                    ddlStatus.Items.Remove(ddlStatus.Items.FindByText(&quot;Cancelled&quot;));
                                }
                                else
                                {
                                    //else disable drop down
                                    ddlStatus.Enabled = false;
                                }
                            }

                            if (ddlStatus.Items.FindByValue(ddlStatus.SelectedItem.Value) != null)
                                ddlStatus.Items.FindByValue(ddlStatus.SelectedItem.Value).Selected = false;

                            ddlStatus.Items.FindByText(dr[&quot;Status&quot;].ToString2()).Selected = true;
                        }

                        lblIsApproved.Text = dr[&quot;ApprovedBY&quot;].ToString2().BrixHTMLEncode();

                        (attachments as AttachmentsControl).InstanceID = ViewState[&quot;ID&quot;].ToString2();
                        (attachments as AttachmentsControl).SrcType = &quot;BIDLTDL&quot;;
                        LinksUserControl.SetInstanceAndType(ViewState[&quot;ID&quot;].ToString2(), &quot;BIDLTDL&quot;);
                    }
                    tdBallInCourt.InnerText = LocalizationManager.GetString(&quot;BallInCourt&quot;) + &quot; :&quot;;
                }

                // Permission check.
                int awardStatus =
                    EstimateManager.Instance.GetBidAwardStatus(Request[EstimatorConstants.PROJECT_ESTIMATE_ID].ToInt32_2());

                if (!String.IsNullOrEmpty(Request.QueryString.Get(&quot;BID&quot;)))
                    btnSave.Enabled = ((awardStatus == EstimatorConstants.AWARDED) ? false : true)
                                      &amp;&amp; (featurelist.Contains(&quot;AddendumEdit&quot;) || featurelist.Contains(&quot;AddendumIssue&quot;));
                else if (!String.IsNullOrEmpty(Request.QueryString.Get(&quot;Add&quot;)))
                    btnSave.Enabled = ((awardStatus == EstimatorConstants.AWARDED) ? false : true) &amp;&amp;
                                      featurelist.Contains(&quot;AddendumCreate&quot;);
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, EstimatorConstants.ESTIMATOR);
            }

            lblbidDueTimeGMT.Text = string.IsNullOrEmpty(AMP3ApplicationSettings.Instance.CurrentTimeZone) ? TimeZoneInfo.Local.ToString() : TimeZoneInfo.FindSystemTimeZoneById(AMP3ApplicationSettings.Instance.CurrentTimeZone).ToString2();
            lblbidOpnTimeGMT.Text = string.IsNullOrEmpty(AMP3ApplicationSettings.Instance.CurrentTimeZone) ? TimeZoneInfo.Local.ToString() : TimeZoneInfo.FindSystemTimeZoneById(AMP3ApplicationSettings.Instance.CurrentTimeZone).ToString2();
        }

        private void LocalizePageLabels()
        {
            lblBidAdvertiseDate.Text = (LocalizationManager.GetString(&quot;Bid Advertisement Date&quot;) + &quot; :&quot;).BrixHTMLEncode();
            lblBidIssueDate.Text = (LocalizationManager.GetString(&quot;Bid Issue Date&quot;) + &quot; :&quot;).BrixHTMLEncode();
            lblPreBidMeetingDate.Text = (LocalizationManager.GetString(&quot;Pre Bid Meeting Date&quot;) + &quot; :&quot;).BrixHTMLEncode();
            lblBidOpeningDateTime.Text = (LocalizationManager.GetString(&quot;Bid Opening Date and Time&quot;) + &quot; :&quot;).BrixHTMLEncode();
            lblBidDueTime.Text = (LocalizationManager.GetString(&quot;Bid Due Time&quot;) + &quot; :&quot;).BrixHTMLEncode();
        }

        private void SetLabel()
        {
            // Setting the header of the page based on the querystring passed
            if (!String.IsNullOrEmpty(Request.QueryString.Get(&quot;Add&quot;)) &amp;&amp;
                !String.IsNullOrEmpty(Request.QueryString.Get(&quot;Type&quot;)))
            {
                PageTitle = (Request.QueryString.Get(&quot;Type&quot;) == &quot;E&quot; &amp;&amp;
                             Request.QueryString.Get(&quot;Add&quot;) == &quot;Y&quot;)
                                ? &quot;Edit Addendum Details&quot;
                                : (Request.QueryString.Get(&quot;Type&quot;) == &quot;E&quot; &amp;&amp;
                                   Request.QueryString.Get(&quot;Add&quot;) == &quot;N&quot;)
                                      ? LocalizationManager.GetString(&quot;Edit Bid Letting Details&quot;)
                                      : (Request.QueryString.Get(&quot;Type&quot;) == &quot;A&quot; &amp;&amp;
                                         Request.QueryString.Get(&quot;Add&quot;) == &quot;N&quot;)
                                            ? LocalizationManager.GetString(&quot;Create New Bid Letting&quot;)
                                            : (Request.QueryString.Get(&quot;Type&quot;) == &quot;A&quot; &amp;&amp;
                                               Request.QueryString.Get(&quot;Add&quot;) == &quot;Y&quot;)
                                                  ? &quot;Create New Addendum&quot;
                                                  : &quot;&quot;;
            }

            lblLettingID.Text = ((!String.IsNullOrEmpty(Request.QueryString.Get(&quot;Add&quot;))) &amp;&amp;
                                 Request.QueryString.Get(&quot;Add&quot;) == &quot;Y&quot;)
                                    ? &quot;Addendum ID :&quot;
                                    : &quot;Letting ID :&quot;;
        }

        private void UserAndStatus()
        {
            string uidList = String.Empty;

            List&lt;int&gt; roles = EstimateManager.Instance.GetRolesForFeatureList(&quot;ESTMATE&quot;, &quot;AddendumIssue&quot;);
            DataTable dtProjUsers = EstimateManager.Instance.GetProjectUsers(Request[EstimatorConstants.PID].ToInt32_2());
            foreach (DataRow row in dtProjUsers.Rows)
            {
                if (roles.Contains(row[&quot;RoleID&quot;].ToInt32_2()))
                    uidList += row[&quot;UserID&quot;].ToString() + &quot;,&quot;;
            }
            uidList = Regex.Replace(uidList, &quot;,$&quot;, &quot;&quot;);
            DataTable dtUserDetails = EstimateManager.Instance.GetUserInformation(uidList);

            if (dtUserDetails.Rows.Count &gt; 0)
            {
                ddlProjUsers.DataSource = dtUserDetails;
                ddlProjUsers.DataTextField = &quot;FullName&quot;;
                ddlProjUsers.DataValueField = &quot;UserId&quot;;
                ddlProjUsers.DataBind();
            }

            DataTable dtStatusList = EstimateManager.Instance.GetBLStatusList();

            if (dtStatusList.Rows.Count &gt; 0)
            {
                ddlStatus.DataSource = dtStatusList;
                ddlStatus.DataTextField = ddlStatus.DataValueField = &quot;Status&quot;;
                ddlStatus.DataBind();

                //Remove cancelled if it is a new bid letting
                if (Request.QueryString.Get(&quot;Type&quot;) == &quot;A&quot; &amp;&amp; Request.QueryString.Get(&quot;Add&quot;) == &quot;N&quot; ||
                    Request.QueryString.Get(&quot;Type&quot;) == &quot;A&quot; &amp;&amp; Request.QueryString.Get(&quot;Add&quot;) == &quot;Y&quot;)
                {
                    ddlStatus.Items.Remove(ddlStatus.Items.FindByText(&quot;Cancelled&quot;));
                }
            }
        }

        List&lt;string&gt; _components = null;

        private List&lt;string&gt; ModuleComponents
        {
            get
            {
                if (_components == null)
                    _components = ModuleManagementBL.ModuleManager.Instance.GetModuleComponenets(Constants.MODID_ESTMATE);
                return _components;
            }
        }

        //SAVE BIDLETTING ENTRY
        protected void btnSave_Click(object sender, EventArgs e)
        {
            try
            {
                if (btnSave.Enabled)
                {

                    lockStatus = EstimateManager.Instance.GetLockStatus(projectEstimateID);
                    approveStatus = EstimateManager.Instance.GetApprovedStatus(projectEstimateID);

                    if (!ModuleComponents.Contains(&quot;HideApprove&quot;))
                    {
                        if (Request.QueryString.Get(&quot;Add&quot;) == &quot;N&quot;)//Bid letting
                        {
                            if (!(lockStatus &amp;&amp; approveStatus) &amp;&amp; ddlStatus.SelectedItem.Text == &quot;Issued&quot;)
                            {
                                ShowNotificationMessage(ItemNameAbbr + &quot;(s) are not approved. Cannot Issue letting.&quot;, NotificationType.Error);
                                return;
                            }
                        }
                    }
                    else
                    {
                        if ((Request.QueryString.Get(&quot;Add&quot;) == &quot;N&quot;))//Bid letting
                        {
                            if (!(lockStatus) &amp;&amp; ddlStatus.SelectedItem.Text == &quot;Issued&quot;)
                            {
                                ShowNotificationMessage(ItemNameAbbr + &quot;(s) are not locked. Cannot Issue letting.&quot;, NotificationType.Error);
                                return;
                            }
                        }
                        else // Addendum
                        {
                            //I
                        }
                    }


                    if (wdcDatePub.Value.ToDateTime_MWCulture() &gt; radbidOpnTime.SelectedDate.ToDateTime_MWCulture())
                    {
                        ShowNotificationMessage(LocalizationManager.GetString(&quot;Bid&quot;) + &quot; Opening Date must be later than the Advertisement Date.&quot;, NotificationType.Error);
                        return;
                    }

                    var dtoObj = new EstimatorDTO.Estimator();
                    dtoObj.BidLettingDescription = (txtDescription.Text.Trim() != &quot;&quot;)
                                                       ? txtDescription.Text.Trim()
                                                       : txtAddDescription.Text;
                    dtoObj.BidLettingID = txtID.Text.Trim();
                    dtoObj.Address = txtAddress.Text;
                    if (radbidOpnTime.SelectedDate != null)
                    {
                        dtoObj.LettingDate = radbidOpnTime.SelectedDate.ToMWUtcDateTime();
                    }
                    dtoObj.DatePublished = wdcDatePub.Value.ToDateTime_MWCulture().ToMWUtcDateTime();
                    dtoObj.ProjectEstimateId = Request[EstimatorConstants.PROJECT_ESTIMATE_ID].ToInt32_2();
                    dtoObj.BallInCourt = (ddlProjUsers.SelectedItem != null &amp;&amp;
                                          ddlProjUsers.SelectedItem.Text != &quot;Select One&quot;)
                                             ? ddlProjUsers.SelectedItem.Text
                                             : &quot;&quot;;
                    dtoObj.AddendumID = (ViewState[&quot;ID&quot;] != null) ? ViewState[&quot;ID&quot;].ToInt32_2() : 0;
                    dtoObj.Status = ddlStatus.SelectedItem.Text;
                    if (radbidDueTime.SelectedTime != null)
                    {
                        dtoObj.BidDueDateTime = radbidOpnTime.SelectedDate.ToDateTime_MWCulture().Date.Add(radbidDueTime.SelectedTime.Value).ToUtc();
                    }
                    else
                    {
                        dtoObj.BidDueDateTime = null;
                    }
                    dtoObj.IsCreateLetting = isCreateLetting;

                    dtoObj.LettingDesc = txtBidLettingDesc.Text;


                    if ((DBNull.Value.Equals(wdcDateIssue.Value)))
                    {
                        dtoObj.IssueDate = null;
                    }
                    else
                    {
                        dtoObj.IssueDate = wdcDateIssue.Value.ToDateTime_MWCulture().ToMWUtcDateTime();
                    }

                    if (wdcDateMeeting.Value == null)
                    {
                        dtoObj.PreBidMeetingDate = null;
                    }
                    else
                    {
                        dtoObj.PreBidMeetingDate = wdcDateMeeting.Value.ToDateTime_MWCulture().ToMWUtcDateTime();
                    }
                    if (wdcAddendumIssueDate.Value == null)
                    {
                        dtoObj.AddendumIssueDate = null;
                    }
                    else
                    {
                        dtoObj.AddendumIssueDate = wdcAddendumIssueDate.Value.ToDateTime_MWCulture().ToMWUtcDateTime();
                    }

                    UserDetail ud = UserDetail.GetCurrentUserDetail();
                    dtoObj.ApprovedBy = ud.UserName;
                    Dictionary&lt;string, Type&gt; dicObj = AfterSaveRecordModel.GetModelObjects();
                    try
                    {
                        foreach (KeyValuePair&lt;string, Type&gt; kvp in dicObj)
                        {
                            var Savemodel = AfterSaveRecordModel.GetInstance(kvp.Key);
                            if (Savemodel != null)
                                Savemodel.SaveDetails(dtoObj, this.Page, (ViewState[&quot;ID&quot;] == null) ? &quot;New&quot; : &quot;Edit&quot;, &quot;BEFORE_SAVE_BIDLETTING&quot;);

                        }
                    }
                    catch (Exception ex)
                    {
                        ShowNotificationMessage(ex.Message, NotificationType.Error);
                        return;
                    }
                    if (!string.IsNullOrEmpty(Request[&quot;Add&quot;]) &amp;&amp; Request[&quot;Add&quot;].ToString() == &quot;Y&quot;)
                    {
                        // Send Email to All Contractors saying the addendum has been issued.
                        if (ddlStatus.SelectedItem.Text == &quot;Issued&quot; &amp;&amp; ModuleComponents.Contains(&quot;NotifyAddendumIssued&quot;) &amp;&amp; EstimateManager.Instance.GetEstimateBidSettings(Request[EstimatorConstants.PROJECT_ESTIMATE_ID].ToInt32_2(), EstimateManager.SendAddIssuedEmail))
                        {
                            SendAddendumIssuedMail(Request[EstimatorConstants.PROJECT_ESTIMATE_ID].ToInt32_2());
                        }
                    }
                    //ADD A NEW BIDLETTING ENTRY
                    if (ViewState[&quot;ID&quot;] == null)
                    {
                        dtoObj.CreatedBy = ud.UserName;
                        int returnValue = EstimateManager.Instance.AddBidLetInfo(dtoObj);

                        if (returnValue &lt; 0)
                        {

                            String errMsg = (returnValue == -1)
                                                ? &quot;Error Saving the data&quot;
                                                : (returnValue == -10)
                                                      ? &quot;ID already exists. Cannot create the record.&quot;
                                                : (returnValue == -9)
                                                    ? &quot;A previous addendum exists with &#39;Draft&#39; status. Cannot create the record with status &#39;Issued&#39;.&quot;
                                                      : &quot;Letting is already created.&quot;;
                            ShowNotificationMessage(errMsg, NotificationType.Error);
                            if (returnValue == -3) btnSave.Enabled = false;
                            return;
                        }
                        ((AttachmentsControl)attachments).ParentInstanceID = dtoObj.ProjectEstimateId;
                        ((AttachmentsControl)attachments).ParentModuleID = Constants.MODID_ESTMATE;
                        bool bUploadAttch = ((AttachmentsControl)attachments).SaveAttachments(returnValue.ToString2(),
                            &quot;BIDLTDL&quot;, ud.UID, ud.UserName, LocalizationManager.GetString(&quot;Bid Letting Attachments&quot;));

                        if (bUploadAttch)
                        {
                            Response.Redirect(
                                &quot;~/Common/BrixListPage.aspx?context=BIDLTDL&amp;&quot; + EstimatorConstants.PID + &quot;=&quot; +
                                projectID.ToString2() + &quot;&amp;ProjectEstimateID=&quot; + Request[&quot;ProjectEstimateID&quot;], false);
                        }
                        else
                        {
                            Page.ClientScript.RegisterStartupScript(GetType(), &quot;Error_in_Attachments&quot;,
                                                                    &quot;&lt;script&gt;ShowError(&#39;&quot; +
                                                                    ResourceFactory.Instance.GetString(
                                                                        &quot;Error in uploading attachments. Addendum created successfully.&quot;) +
                                                                    &quot;&#39;); document.location=&#39;~/Common/BrixListPage.aspx?context=BIDLTDL&amp;&quot; +
                                                                    EstimatorConstants.PID + &quot;=&quot; +
                                                                    UIHelper.UrlEncode(projectID.ToString2()) + &quot;&amp;ProjectEstimateID=&quot; +
                                                                    UIHelper.UrlEncode(Request[&quot;ProjectEstimateID&quot;]) + &quot;&#39;;&lt;/script&gt;&quot;);
                        }
                    }
                    else
                    {
                        bool hasPermission = true;
                        if (ViewState[&quot;IsRecordIssued&quot;].ToString2() == &quot;1&quot; &amp;&amp; dtoObj.Status.Equals(&quot;Draft&quot;))
                        {
                            if (!ModuleManagementBL.ModuleManager.Instance.GetPermissionByUserOrRole(Constants.MODID_ESTMATE,
                                UserDetail.GetCurrentUserDetail().UID, UserDetail.GetCurrentUserDetail().RID, Request.QueryString[&quot;PID&quot;].ToInt32_2()).
                                Contains(&quot;AddendumRevert&quot;))
                                hasPermission = false;
                        }
                        int returnValue = hasPermission ? EstimateManager.Instance.UpdateBidLetInfo(dtoObj) : 4;

                        if (returnValue &gt; 0)
                        {
                            string errorMsg = string.Empty;
                            switch (returnValue)
                            {
                                case 4:
                                    errorMsg = &quot;The current user role doesn&#39;t have permission to revert an issued record.&quot;;
                                    break;
                                case 5:
                                    errorMsg = &quot;The record you are trying to edit does not exist in the system.&quot;;
                                    break;
                                case 6:
                                    errorMsg = &quot;Approved record could not be unapproved.&quot;;
                                    break;
                                case 7:
                                    errorMsg = &quot;ID already exists. Cannot update.&quot;;
                                    PageTitle = &quot;Edit Addendum Details&quot;;
                                    break;
                                case 8:
                                    errorMsg = &quot;Only the last approved record can be unapproved.&quot;;
                                    break;
                                case 9:
                                    errorMsg = &quot;There exists draft addendum(s). The record can be unapproved only if it is the last approved record and there exist no draft records.&quot;;
                                    break;
                                case 10:
                                    errorMsg = &quot;Older approved records cannot be unapproved.&quot;;
                                    break;
                                case 11:
                                    errorMsg = &quot;The record can be unapproved only if it is the last approved record.&quot;;
                                    break;
                                case 12:
                                    errorMsg = &quot;The record can be approved only if all other previous records are approved.&quot;;
                                    break;
                                case 13:
                                    errorMsg = &quot;One or more items in this addendum is already deleted. Please remove those items to approve this record.&quot;;
                                    break;
                                default:
                                    errorMsg = &quot;Unkown error has occured.&quot;;
                                    break;
                            }

                            ShowNotificationMessage(errorMsg, NotificationType.Error);
                            return;
                        }

                        if (returnValue == -1)
                        {
                            ShowNotificationMessage(&quot;Unkown error has occured.&quot;, NotificationType.Error);
                            return;
                        }

                        try
                        {
                            ((AttachmentsControl)attachments).ParentInstanceID = dtoObj.ProjectEstimateId;
                            ((AttachmentsControl)attachments).ParentModuleID = Constants.MODID_ESTMATE;
                            bool bUploadAttch = ((AttachmentsControl)attachments).SaveAttachments(ViewState[&quot;ID&quot;].ToString2(),
                                &quot;BIDLTDL&quot;, ud.UID, ud.UserName, LocalizationManager.GetString(&quot;Bid Letting Attachments&quot;));

                            if (bUploadAttch)
                                Response.Redirect(string.Format(&quot;~/Common/BrixListPage.aspx?context=BIDLTDL&amp;{0}={1}&amp;ProjectEstimateID={2}&amp;ParentID={2}&quot;, EstimatorConstants.PID, projectID, Request[&quot;ProjectEstimateID&quot;]), false);
                            else
                            {
                                Page.ClientScript.RegisterStartupScript(GetType(), &quot;Error_in_Attachments&quot;,
                                                                        &quot;&lt;script&gt;ShowError(&#39;&quot; +
                                                                        ResourceFactory.Instance.GetString(
                                                                            &quot;Error in uploading attachments. Addendum updated successfully.&quot;) +
                                                                        &quot;&#39;); document.location=&#39;~/Common/BrixListPage.aspx?context=BIDLTDL&amp;&quot; +
                                                                        EstimatorConstants.PID + &quot;=&quot; +
                                                                        UIHelper.UrlEncode(projectID.ToString2()) + &quot;&amp;ProjectEstimateID=&quot; +
                                                                        UIHelper.UrlEncode(Request[&quot;ProjectEstimateID&quot;]) + &quot;&#39;;&lt;/script&gt;&quot;);
                            }
                        }
                        catch (Exception)
                        {
                            Page.ClientScript.RegisterStartupScript(GetType(), &quot;Error_in_Attachments&quot;,
                                                                    &quot;&lt;script&gt;ShowError(&#39;&quot; +
                                                                    ResourceFactory.Instance.GetString(
                                                                        &quot;Error in uploading attachments. Addendum updated successfully.&quot;) +
                                                                    &quot;&#39;); document.location=&#39;~/Common/BrixListPage.aspx?context=BIDLTDL&amp;&quot; +
                                                                    EstimatorConstants.PID + &quot;=&quot; +
                                                                    UIHelper.UrlEncode(projectID.ToString2()) + &quot;&amp;ProjectEstimateID=&quot; +
                                                                    UIHelper.UrlEncode(Request[&quot;ProjectEstimateID&quot;]) + &quot;&amp;ParentID=&quot; +
                                                                    UIHelper.UrlEncode(Request[&quot;ProjectEstimateID&quot;]) + &quot;&#39;;&lt;/script&gt;&quot;);
                        }
                    }

                    //If the code reaches here it means the addendum status is updated
                    if (ViewState[&quot;ID&quot;] != null &amp;&amp; (Request.QueryString.Get(&quot;Add&quot;) == &quot;Y&quot;) &amp;&amp; ddlStatus.SelectedItem.Text == &quot;Issued&quot;)//Edit Addendum and status == issued
                    {
                        //Remove record where itemid = referenceItemid and move to corItemDeletedItemDetails.
                        //Pass addendum Id to SP, SP should table all the deleted items in this addendum and do the above task.
                        int Error = 0;
                        int rows = EstimateManager.Instance.DeleteCORITEMDetail(dtoObj.AddendumID, Constants.MODID_ESTMADD, Error);
                        /*
                         //refresh line number. //Pass estmate as moduleid and projectEstimateID of addendum, which is stored as parentId in corItemDetails
                         if (rows &gt; 0 &amp;&amp; Error == 0)
                       {
                           ItemManager.Instance.RefreshLineNumbers(Constants.MODID_ESTMATE, dtoObj.ProjectEstimateId);
                       }
                         */

                        //Refresh linenumbers for new/modify/delete
                        ItemManager.Instance.RefreshLineNumbers(Constants.MODID_ESTMATE, dtoObj.ProjectEstimateId);
                    }


                    foreach (KeyValuePair&lt;string, Type&gt; kvp in dicObj)
                    {
                        var Savemodel = AfterSaveRecordModel.GetInstance(kvp.Key);
                        if (Savemodel != null)
                            Savemodel.SaveDetails(dtoObj, this.Page, (ViewState[&quot;ID&quot;] == null) ? &quot;New&quot; : &quot;Edit&quot;, &quot;SAVE_BIDLETTING&quot;);
                    }


                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, EstimatorConstants.ESTIMATOR);
            }
        }

        protected void btnCancel_Click(object sender, EventArgs e)
        {
            // Response.Redirect(string.Format(&quot;~/Common/BrixListPage.aspx?context=BIDLTDL&amp;{0}={1}&amp;ProjectEstimateID={2}&amp;ParentID={2}&quot;, EstimatorConstants.PID, projectID, Request[&quot;ProjectEstimateID&quot;]), false);
            Response.Redirect(
                                 &quot;~/Common/BrixListPage.aspx?context=BIDLTDL&amp;&quot; + EstimatorConstants.PID + &quot;=&quot; +
                                 projectID.ToString2() + &quot;&amp;ProjectEstimateID=&quot; + Request[&quot;ProjectEstimateID&quot;] + &quot;&amp;ParentID=&quot; + Request[&quot;ProjectEstimateID&quot;], false);
        }


        private void SendAddendumIssuedMail(int projectEstimateId)
        {
            //            DataSet dsDetails = ComponentHelper.Instance.ExecuteDataSet(string.Format(@&quot;SELECT pm.ProjectCode,pm.ProjectName FROM ESTMATEInfo ei
            //                                                                                        INNER JOIN PROJECTProjectMain pm on ei.ProjectID = pm.ProjectId
            //                                                                                        where ei.ProjectEstimateID = {0};
            //                                                                                        SELECT ud.FirstName,ud.LastName,ud.Email FROM ESTMATEBidInfo eb
            //                                                                                        INNER JOIN LIBRARYContractors lc ON eb.ContractorId = lc.ID
            //                                                                                        INNER JOIN USRMGMTUserDetails ud ON lc.ContractorLoginID = ud.UserId
            //                                                                                        WHERE eb.ProjectEstimateId = {1};
            //                                                                                        SELECT TemplateName,[Subject],Body FROM APPMGMTEmailNotifications WHERE TemplateName =  &#39;{2}&#39;&quot;, projectEstimateId, projectEstimateId, &quot;AddendumIssued&quot;));
            DataSet dsDetails = EstimateManager.Instance.GetAddendumIssuedMail(projectEstimateId);
            if (dsDetails != null &amp;&amp; dsDetails.Tables.Count == 3)
            {
                if (dsDetails.Tables[0] != null &amp;&amp; dsDetails.Tables[0].Rows.Count == 1 &amp;&amp; dsDetails.Tables[1] != null &amp;&amp; dsDetails.Tables[1].Rows.Count &gt; 0 &amp;&amp; dsDetails.Tables[2] != null &amp;&amp; dsDetails.Tables[2].Rows.Count == 1)
                {
                    string appPath = ConfigurationManager.AppSettings[&quot;SiteRoot&quot;];
                    string body = dsDetails.Tables[2].Rows[0][&quot;Body&quot;].ToString2();
                    //string body = dsDetails.Tables[2].Rows[0][&quot;Body&quot;].ToString2().Format2(dsDetails.Tables[1].Rows[0][&quot;Name&quot;].ToString2(), dsDetails.Tables[0].Rows[0][&quot;ProjectCode&quot;].ToString2(), dsDetails.Tables[0].Rows[0][&quot;ProjectName&quot;].ToString2(), appPath);
                    string subject = dsDetails.Tables[2].Rows[0][&quot;Subject&quot;].ToString2().Format2(dsDetails.Tables[0].Rows[0][&quot;ProjectName&quot;].ToString2());
                    string toEmail = string.Empty;
                    string lname = string.Empty;
                    foreach (DataRow dr in dsDetails.Tables[1].Rows)
                    {
                        lname = dr[&quot;LastName&quot;].Equals(DBNull.Value) ? string.Empty : dr[&quot;LastName&quot;].ToString2();
                        body = dsDetails.Tables[2].Rows[0][&quot;Body&quot;].ToString2();
                        body = body.Format2(dr[&quot;FirstName&quot;].ToString2(), lname, dsDetails.Tables[0].Rows[0][&quot;ProjectCode&quot;].ToString2(), dsDetails.Tables[0].Rows[0][&quot;ProjectName&quot;].ToString2(), appPath);
                        toEmail = dr[&quot;Email&quot;].Equals(DBNull.Value) ? string.Empty : dr[&quot;Email&quot;].ToString2();
                        if (!string.IsNullOrEmpty(toEmail))
                            Mailer.SendEmail(to: toEmail, subject: subject, body: body);
                    }

                }
            }
        }

        #region IXMLControl

        public void HandleInjectionAfterSave(object model, string parentFormInstanceId)
        {

        }

        public void HandleInjectionSaveException(object model, Exception ex, string parentFormInstanceId)
        {

        }

        public object[] ParentFormInstanceID
        {
            get
            {
                return new object[] { !string.IsNullOrEmpty(Request.QueryString[&quot;BID&quot;]) ? Request.QueryString[&quot;BID&quot;] : &quot;-1&quot; };
            }
        }

        public System.Web.UI.HtmlControls.HtmlGenericControl XMLContainterDiv
        {
            get
            {
                return divInjection;
            }
            set
            {

            }
        }

        public bool SkipDefaultXMLInjectionSave { get; set; }

        #endregion IXMLControl

        public override int GetProjectIdFromInstanceId()
        {
            if (!string.IsNullOrEmpty(Request[&quot;ProjectEstimateID&quot;]))
                return EstimateManager.Instance.GetPIDFromEstimateId(Request[&quot;ProjectEstimateID&quot;].ToInt32_2());
            else
                return -1;
        }

    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[30,9,30,46,1],[38,17,38,18,1],[38,19,38,73,1],[38,74,38,75,1],[42,9,42,10,1],[43,13,43,54,1],[45,13,45,61,1],[46,13,46,55,1],[48,13,48,51,1],[49,17,49,56,0],[50,18,50,56,1],[51,17,51,64,1],[52,18,52,56,1],[53,17,53,58,1],[54,18,54,56,1],[55,17,55,66,1],[57,13,57,59,1],[58,17,58,70,1],[60,13,60,41,1],[61,13,61,34,1],[62,13,62,82,1],[63,13,63,44,1],[64,13,64,28,1],[65,9,65,10,1],[68,9,68,10,1],[69,13,69,31,1],[70,13,70,14,1],[71,17,71,78,1],[72,17,72,37,1],[73,17,73,18,1],[74,21,74,70,1],[75,21,75,66,1],[76,17,76,18,1],[77,13,77,14,1],[78,13,78,98,1],[79,13,79,37,1],[80,9,80,10,1],[83,9,83,10,1],[85,13,85,14,1],[86,17,86,53,1],[88,17,88,46,1],[89,17,89,38,1],[92,17,93,99,1],[94,17,94,18,0],[95,21,96,57,0],[97,17,97,18,0],[99,17,99,93,1],[102,17,102,99,1],[105,17,106,76,1],[109,17,109,18,1],[110,21,110,43,1],[111,21,111,22,1],[112,25,124,64,1],[125,21,125,22,1],[126,17,126,18,1],[128,17,128,38,1],[129,17,129,18,1],[130,21,130,55,1],[131,21,131,56,1],[132,25,132,73,0],[134,21,134,60,1],[135,21,135,22,0],[136,25,136,48,0],[137,25,137,55,0],[138,21,138,22,0],[140,21,140,32,1],[143,21,143,59,1],[144,21,144,67,1],[145,21,145,65,1],[146,21,146,75,1],[147,21,147,69,1],[151,21,151,75,1],[152,21,152,86,1],[153,21,153,107,1],[154,21,154,114,1],[156,21,156,103,1],[157,21,157,110,1],[160,21,160,37,1],[163,21,163,92,1],[164,21,164,116,1],[166,21,167,80,1],[168,21,168,22,1],[170,25,170,67,1],[171,29,171,136,0],[172,21,172,22,1],[174,21,174,22,1],[176,25,176,117,1],[177,21,177,22,1],[179,21,179,71,1],[180,21,180,67,1],[181,21,181,74,1],[183,21,187,67,1],[188,21,192,60,1],[193,21,197,58,1],[199,21,203,66,1],[206,21,210,65,1],[212,21,213,62,1],[214,21,214,22,1],[215,25,215,80,1],[216,25,216,82,1],[218,25,220,117,1],[222,25,222,62,1],[224,25,224,66,1],[225,29,225,94,0],[227,25,227,65,1],[228,29,228,106,1],[229,25,229,63,1],[230,29,230,91,1],[231,25,231,61,1],[232,29,232,104,1],[234,25,234,76,1],[235,25,235,26,0],[236,29,236,57,0],[237,25,237,26,0],[239,25,239,26,1],[240,29,240,114,1],[241,25,241,26,1],[242,25,242,76,1],[243,25,243,26,0],[244,29,244,74,0],[245,25,245,26,0],[247,25,247,26,1],[248,29,248,120,1],[249,25,249,26,1],[251,21,251,22,1],[254,21,254,79,1],[255,21,255,22,1],[256,25,256,74,1],[258,25,260,117,1],[263,25,263,61,1],[264,25,264,26,0],[265,29,265,145,0],[266,29,266,36,0],[269,25,269,62,1],[271,25,271,102,1],[272,25,272,63,1],[273,29,273,114,1],[274,25,274,68,1],[275,25,275,26,0],[276,29,276,55,0],[277,29,277,65,0],[278,29,278,130,0],[279,25,279,26,0],[281,25,281,26,1],[282,29,282,104,1],[283,25,283,26,1],[285,25,285,76,1],[286,25,286,26,0],[287,29,287,57,0],[288,25,288,26,0],[290,25,290,26,1],[291,29,291,114,1],[292,25,292,26,1],[294,25,294,76,1],[295,25,295,26,0],[296,29,296,74,0],[297,25,297,26,0],[299,25,299,26,1],[300,29,300,120,1],[301,25,301,26,1],[304,25,304,80,1],[306,25,306,65,1],[307,29,307,81,1],[309,29,309,84,0],[311,25,311,69,1],[312,25,312,62,1],[314,25,314,98,1],[316,25,316,98,1],[317,25,317,26,1],[318,29,318,105,1],[319,33,319,114,1],[320,29,320,106,1],[321,25,321,26,1],[323,25,323,48,1],[324,25,324,150,1],[325,25,325,26,0],[326,29,326,63,0],[327,29,333,62,0],[338,29,338,198,0],[343,29,344,78,0],[345,33,345,65,0],[347,29,352,85,0],[353,25,353,26,0],[355,25,355,90,1],[356,25,356,26,1],[357,29,357,69,1],[358,29,358,30,1],[359,33,359,97,1],[360,29,360,30,1],[362,29,362,30,0],[364,33,364,73,0],[365,33,365,34,0],[366,37,366,101,0],[367,33,367,34,0],[369,33,369,34,0],[371,37,371,63,0],[372,33,372,34,0],[373,29,373,30,0],[375,29,375,99,1],[376,33,376,108,1],[378,29,378,98,1],[379,25,379,26,1],[381,25,381,92,1],[383,25,383,102,1],[384,25,384,81,1],[385,25,385,101,1],[386,21,386,22,1],[387,21,387,99,1],[388,17,388,18,1],[391,17,392,125,1],[394,17,394,75,1],[395,21,396,122,1],[397,22,397,80,1],[398,21,399,78,1],[400,13,400,14,1],[401,13,401,33,0],[402,13,402,14,0],[403,17,403,98,0],[404,13,404,14,0],[406,13,406,240,1],[407,13,407,240,1],[408,9,408,10,1],[411,9,411,10,1],[412,13,412,122,1],[413,13,413,110,1],[414,13,414,121,1],[415,13,415,127,1],[416,13,416,106,1],[417,9,417,10,1],[420,9,420,10,1],[422,13,423,72,1],[424,13,424,14,1],[425,17,437,56,1],[438,13,438,14,1],[440,13,443,54,1],[444,9,444,10,1],[447,9,447,10,1],[448,13,448,43,1],[450,13,450,107,1],[451,13,451,123,1],[452,13,452,20,1],[452,22,452,33,1],[452,34,452,36,1],[452,37,452,53,1],[453,13,453,14,1],[454,17,454,63,1],[455,21,455,63,1],[456,13,456,14,1],[457,13,457,56,1],[458,13,458,92,1],[460,13,460,46,1],[461,13,461,14,1],[462,17,462,57,1],[463,17,463,57,1],[464,17,464,56,1],[465,17,465,41,1],[466,13,466,14,1],[468,13,468,81,1],[470,13,470,45,1],[471,13,471,14,1],[472,17,472,53,1],[473,17,473,79,1],[474,17,474,38,1],[477,17,478,101,1],[479,17,479,18,1],[480,21,480,85,1],[481,17,481,18,1],[482,13,482,14,1],[483,9,483,10,1],[485,9,485,41,1],[490,13,490,14,1],[491,17,491,41,1],[492,21,492,123,1],[493,17,493,36,1],[494,13,494,14,1],[499,9,499,10,1],[501,13,501,14,1],[502,17,502,37,1],[503,17,503,18,1],[505,21,505,92,1],[506,21,506,99,1],[508,21,508,67,1],[509,21,509,22,1],[510,25,510,67,1],[511,25,511,26,1],[512,29,512,107,1],[513,29,513,30,0],[514,33,514,143,0],[515,33,515,40,0],[517,25,517,26,1],[518,21,518,22,1],[520,21,520,22,0],[521,25,521,69,0],[522,25,522,26,0],[523,29,523,90,0],[524,29,524,30,0],[525,33,525,141,0],[526,33,526,40,0],[528,25,528,26,0],[530,25,530,26,0],[532,25,532,26,0],[533,21,533,22,0],[536,21,536,117,1],[537,21,537,22,0],[538,25,538,172,0],[539,25,539,32,0],[542,21,542,63,1],[543,21,545,81,1],[546,21,546,61,1],[547,21,547,54,1],[548,21,548,60,1],[549,21,549,22,1],[550,25,550,91,1],[551,21,551,22,1],[552,21,552,102,1],[553,21,553,108,1],[554,21,557,51,1],[558,21,558,101,1],[559,21,559,65,1],[560,21,560,60,1],[561,21,561,22,0],[562,25,562,150,0],[563,21,563,22,0],[565,21,565,22,1],[566,25,566,54,1],[567,21,567,22,1],[568,21,568,62,1],[570,21,570,65,1],[573,21,573,67,1],[574,21,574,22,0],[575,25,575,49,0],[576,21,576,22,0],[578,21,578,22,1],[579,25,579,104,1],[580,21,580,22,1],[582,21,582,54,1],[583,21,583,22,0],[584,25,584,57,0],[585,21,585,22,0],[587,21,587,22,1],[588,25,588,114,1],[589,21,589,22,1],[590,21,590,60,1],[591,21,591,22,0],[592,25,592,57,0],[593,21,593,22,0],[595,21,595,22,1],[596,25,596,120,1],[597,21,597,22,1],[599,21,599,71,1],[600,21,600,53,1],[601,21,601,94,1],[603,21,603,22,1],[604,25,604,32,1],[604,34,604,64,1],[604,65,604,67,1],[604,68,604,74,1],[605,25,605,26,1],[606,29,606,87,1],[607,29,607,51,1],[608,33,608,144,1],[610,25,610,26,1],[611,21,611,22,1],[612,21,612,41,0],[613,21,613,22,0],[614,25,614,85,0],[615,25,615,32,0],[617,21,617,99,1],[618,21,618,22,1],[620,25,620,270,1],[621,25,621,26,0],[622,29,622,113,0],[623,25,623,26,0],[624,21,624,22,1],[626,21,626,49,1],[627,21,627,22,1],[628,25,628,56,1],[629,25,629,90,1],[631,25,631,45,1],[632,25,632,26,0],[634,29,640,87,0],[641,29,641,85,0],[642,29,642,51,0],[642,52,642,76,0],[643,29,643,36,0],[645,25,645,103,1],[646,25,646,100,1],[647,25,648,119,1],[650,25,650,42,1],[651,25,651,26,1],[652,29,654,118,1],[655,25,655,26,1],[657,25,657,26,0],[658,29,665,135,0],[666,25,666,26,0],[667,21,667,22,1],[669,21,669,22,1],[670,25,670,51,1],[671,25,671,109,1],[672,25,672,26,0],[673,29,675,60,0],[676,33,676,55,0],[677,25,677,26,0],[678,25,678,113,1],[680,25,680,45,1],[681,25,681,26,0],[682,29,682,60,0],[683,29,683,49,0],[686,37,686,124,0],[687,37,687,43,0],[689,37,689,114,0],[690,37,690,43,0],[692,37,692,91,0],[693,37,693,43,0],[695,37,695,84,0],[696,37,696,73,0],[697,37,697,43,0],[699,37,699,99,0],[700,37,700,43,0],[702,37,702,184,0],[703,37,703,43,0],[705,37,705,95,0],[706,37,706,43,0],[708,37,708,119,0],[709,37,709,43,0],[711,37,711,126,0],[712,37,712,43,0],[714,37,714,155,0],[715,37,715,43,0],[717,37,717,76,0],[718,37,718,43,0],[721,29,721,87,0],[722,29,722,36,0],[725,25,725,47,1],[726,25,726,26,0],[727,29,727,106,0],[728,29,728,36,0],[732,25,732,26,1],[733,29,733,107,1],[734,29,734,104,1],[735,29,736,123,1],[738,29,738,46,1],[739,33,739,227,1],[741,29,741,30,0],[742,33,749,139,0],[750,29,750,30,0],[751,25,751,26,1],[752,25,752,42,0],[753,25,753,26,0],[754,29,762,135,0],[763,25,763,26,0],[764,21,764,22,1],[767,21,767,135,1],[768,21,768,22,0],[771,25,771,39,0],[772,25,772,132,0],[782,25,782,116,0],[783,21,783,22,0],[786,21,786,28,1],[786,30,786,60,1],[786,61,786,63,1],[786,64,786,70,1],[787,21,787,22,1],[788,25,788,83,1],[789,25,789,47,1],[790,29,790,133,1],[791,21,791,22,1],[794,17,794,18,1],[795,13,795,14,1],[796,13,796,33,0],[797,13,797,14,0],[798,17,798,98,0],[799,13,799,14,0],[800,9,800,10,1],[803,9,803,10,1],[805,13,807,165,1],[808,9,808,10,1],[812,9,812,10,0],[821,13,821,99,0],[822,13,822,66,0],[823,13,823,14,0],[824,17,824,227,0],[825,17,825,18,0],[826,21,826,83,0],[827,21,827,83,0],[829,21,829,153,0],[830,21,830,51,0],[831,21,831,49,0],[832,21,832,28,0],[832,30,832,40,0],[832,41,832,43,0],[832,44,832,68,0],[833,21,833,22,0],[834,25,834,113,0],[835,25,835,80,0],[836,25,836,202,0],[837,25,837,109,0],[838,25,838,60,0],[839,29,839,89,0],[840,21,840,22,0],[842,17,842,18,0],[843,13,843,14,0],[844,9,844,10,0],[849,9,849,10,0],[851,9,851,10,0],[854,9,854,10,0],[856,9,856,10,0],[861,13,861,14,1],[862,17,862,127,1],[863,13,863,14,1],[869,13,869,14,0],[870,17,870,37,0],[871,13,871,14,0],[873,13,873,14,0],[875,13,875,14,0],[878,51,878,55,0],[878,56,878,60,0],[883,9,883,10,1],[884,13,884,69,1],[885,17,885,112,1],[887,17,887,27,0],[888,9,888,10,1]]);
    </script>
  </body>
</html>