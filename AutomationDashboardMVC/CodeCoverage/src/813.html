<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Business Layer\AbstractModels\ImportItems.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Globalization;
using System.IO;
using System.Reflection;
using System.Text;
using System.Xml;
using System.Xml.Serialization;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core.IntegrationConnector;
using Aurigo.AMP3.LibraryBL;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.AMP3.ProjectDAC;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using System.Data.OleDb;
using Aurigo.AMP3.ProjectBL;
using Aurigo.Brix.Platform.BusinessLayer.BL;
using Aurigo.AMP3.Core.AbstractModels;
using System.Web;
using Aurigo.Brix.Platform.BusinessLayer.DTO;
using Aurigo.AMP3.Core.UserControls;
using Aurigo.Brix.Platform.BusinessLayer.DataAccessHelper;
using Aurigo.Brix.Platform.BusinessLayer.AbstractModels;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.Brix.Platform.BusinessLayer.XMLForm;

namespace Aurigo.AMP3.Core.BusinessLayer.BL
{
    public static class ItemsDBColumns
    {
        public static readonly string LINE_NO = &quot;LineNo&quot;;
        public static readonly string DESCRIPTION = &quot;Description&quot;;
        public static readonly string ALT_CODE = &quot;AlternateCode&quot;;
        public static readonly string GROUP_NAME = &quot;GroupName&quot;;
        public static readonly string UNIT = &quot;Unit&quot;;
        public static readonly string QUANTITY = &quot;Quantity&quot;;
        public static readonly string BASE_UNIT_COST = &quot;BaseUnitCost&quot;;
        public static readonly string RULE_NAME = &quot;RuleName&quot;;
        public static readonly string LINKED_BUDGET_ITEM_NAME = &quot;LinkedBudgetItemName&quot;;
        public static readonly string ACCOUNTING_CODE = &quot;AccountingCode&quot;;
        public static readonly string STANDARD_ITEM_NO = &quot;StandardItemNo&quot;;
        public static readonly string NOTES = &quot;Notes&quot;;
        public static readonly string FORCE_UNIT_PRICE =  &quot;Force Unit Price&quot;;
        public static readonly string DISCOUNT = &quot;Discount&quot;;
        public static readonly string MARGIN = &quot;Margin&quot;;
        public static readonly string IS_NON_CONTRACT = &quot;IsNonContract&quot;;
        public static readonly string IS_COMPLETE = &quot;IsComplete&quot;;
        public static readonly string RULENAME = &quot;RuleName&quot;;
        //Declared Inflation related columns for export to excel
        public static readonly string INFLATION = &quot;Inflation&quot;;
        public static readonly string INFLATION_RULENAME = &quot;InflationRuleName&quot;;
        public static readonly string ANNUAL_INFLATIONRATE = &quot;AnnualInflationRate&quot;; 
        public static readonly string INFLATION_EFFECTIVEFROM = &quot;InflationEffectiveFrom&quot;;
        public static readonly string GRANT_RULENAME = &quot;GrantRuleName&quot;;

    }

    public abstract class ImportItems : ImportBase
    {
        public const string INDENT_LEVEL_COL_NAME = &quot;Indent Level&quot;;
        public const string ITEM_TYPE_COL_NAME = &quot;Type&quot;;
        public const string RESOURCE_TYPE_COL_NAME = &quot;Type&quot;;
        public const string CONTAINER_TYPE = &quot;Container&quot;;
        public const string ITEM_TYPE = &quot;Item&quot;;
        public const string SUB_ITEM_TYPE = &quot;SubItem&quot;;
        public const string ACTIVITY_TYPE = &quot;Activity&quot;;
        public const string MATERIAL_TYPE = &quot;Material&quot;;

        public const string PARENT_COL_NAME = &quot;ParentContainerLineNo&quot;;
        public const string ROW_NUM_COL_NAME = &quot;ContainerLineNo&quot;;
        public const string PATH_COL_NAME = &quot;Path&quot;;
        public const string RECORD_ID_COL_NAME = &quot;RecordID&quot;;

        public const string SHEET_NAME = &quot;Item&quot;;

        private static Dictionary&lt;string, string&gt; _LocalToGeneralDic = null;

        private static Dictionary&lt;string, string&gt; _GeneralToLocalDic = null;

        private static Dictionary&lt;string, string&gt; GeneralToLocalDic
        {
            get
            {
                if (_GeneralToLocalDic == null)
                {
                    _GeneralToLocalDic = new Dictionary&lt;string, string&gt;();

                    _GeneralToLocalDic.Add(&quot;item&quot;, LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR));
                    _GeneralToLocalDic.Add(&quot;manpower&quot;, LocalizationManager.GetString(KeyConstants.LOC_ICA_MANPOWER));
                    _GeneralToLocalDic.Add(&quot;equipment&quot;, LocalizationManager.GetString(KeyConstants.LOC_ICA_EQUIPMENT));
                    _GeneralToLocalDic.Add(&quot;material&quot;, LocalizationManager.GetString(KeyConstants.LOC_ICA_MATERIALS));
                    _GeneralToLocalDic.Add(&quot;misc&quot;, LocalizationManager.GetString(KeyConstants.LOC_ICA_MISC));
                }
                return _GeneralToLocalDic;
            }
        }

        private static Dictionary&lt;string, string&gt; LocalToGeneralDic
        {
            get
            {
                if (_LocalToGeneralDic == null)
                {
                    _LocalToGeneralDic = new Dictionary&lt;string, string&gt;();

                    _LocalToGeneralDic.Add(LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR), &quot;Item&quot;);
                    _LocalToGeneralDic.Add(LocalizationManager.GetString(KeyConstants.LOC_ICA_MANPOWER), &quot;Manpower&quot;);
                    _LocalToGeneralDic.Add(LocalizationManager.GetString(KeyConstants.LOC_ICA_EQUIPMENT), &quot;Equipment&quot;);
                    _LocalToGeneralDic.Add(LocalizationManager.GetString(KeyConstants.LOC_ICA_MATERIALS), &quot;Material&quot;);
                    _LocalToGeneralDic.Add(LocalizationManager.GetString(KeyConstants.LOC_ICA_MISC), &quot;Misc&quot;);
                }
                return _LocalToGeneralDic;
            }
        }


        private static List&lt;string&gt; _ItemTypes = null;
        string errorColumnName = &quot;Error&quot;;
        public static List&lt;string&gt; ItemTypes
        {
            get
            {

                if (_ItemTypes == null)
                {
                    List&lt;string&gt; coreComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);
                    _ItemTypes = new List&lt;string&gt;();
                    _ItemTypes.Add(&quot;Container&quot;);
                    _ItemTypes.Add(LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR));

                    if (coreComponents.Contains(&quot;SubItems&quot;))
                    {
                        _ItemTypes.Add(&quot;SubItem&quot;);
                    }

                    if (coreComponents.Contains(&quot;Activities&quot;))
                    {
                        _ItemTypes.Add(&quot;Activities&quot;);
                    }

                    //if (coreComponents.Contains(&quot;Components&quot;))
                    //{
                    //    _ItemTypes.Add(&quot;Components&quot;);
                    //}

                    if (coreComponents.Contains(&quot;RateAnalysis&quot;))
                    {
                        _ItemTypes.Add(LocalizationManager.GetString(KeyConstants.LOC_ICA_MANPOWER));
                        _ItemTypes.Add(LocalizationManager.GetString(KeyConstants.LOC_ICA_EQUIPMENT));
                        _ItemTypes.Add(LocalizationManager.GetString(KeyConstants.LOC_ICA_MATERIALS));
                        _ItemTypes.Add(LocalizationManager.GetString(KeyConstants.LOC_ICA_MISC));
                    }
                }
                return _ItemTypes;
            }
        }

        protected int PID
        {
            get
            {
                try
                {
                    if (!string.IsNullOrEmpty(HttpContext.Current.Request.QueryString[&quot;PID&quot;]))
                        return Int32.Parse(HttpContext.Current.Request.QueryString[&quot;PID&quot;], CultureInfo.CurrentCulture);
                    else
                        return 0;
                }
                catch { }
                return 0;
            }
        }

        public static string GetLocalResourceName(string resourceName)
        {
            string resourceNameToLower = resourceName.ToLower2();
            if (GeneralToLocalDic.ContainsKey(resourceNameToLower))
                return GeneralToLocalDic[resourceNameToLower];

            return resourceName;
        }

        public static string GetGeneralResourceName(string resourceName)
        {
            if (LocalToGeneralDic.ContainsKey(resourceName))
                return LocalToGeneralDic[resourceName];

            return resourceName;
        }

        private List&lt;string&gt; _coreComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);

        public List&lt;string&gt; CoreComponents { get { return _coreComponents; } }
        #region &quot;Public methods&quot;

        public override string NameSheet(DataTable schema)
        {
            throw new Exception(&quot;The method or operation is not implemented.&quot;);
        }

        private void AddColumns(DataTable dt, DataColumn[] columns, bool alwaysUpdateCaption = false)
        {
            if (dt != null &amp;&amp; columns != null)
            {
                foreach (DataColumn col in columns)
                {
                    if (!dt.Columns.Contains(col.ColumnName))
                    {
                        dt.Columns.Add(col);
                    }
                    else if (alwaysUpdateCaption &amp;&amp; !string.IsNullOrEmpty(col.Caption))
                    {
                        dt.Columns[col.ColumnName].Caption = col.Caption;
                    }
                }
            }
        }

        protected override bool ValidateUnitColumn(OleDbDataAdapter xlsData, DataTable xlsTable, DataTable xlsErrorReportingTable)
        {
            bool isValid = true;
            DataTable dt = ProjectManager.Instance.GetMeasurementUnits();
            var units = new List&lt;string&gt;();
            foreach (DataRow dr in dt.Rows)
                units.Add(dr[&quot;Unit&quot;].ToString2());

            foreach (DataRow resourceDR in xlsTable.Rows)
            {
                if (SchemaDic[resourceDR[RESOURCE_TYPE_COL_NAME].ToString2().ToLower2()].Columns.Contains(&quot;Unit&quot;) &amp;&amp; !(units.Contains(resourceDR[&quot;Unit&quot;].ToString2())))
                {
                    xlsErrorReportingTable.Rows[xlsTable.Rows.IndexOf(resourceDR)][&quot;Unit&quot;] =
                        ErrorIndicator + resourceDR[&quot;Unit&quot;] + &quot; - unit does not exist in the system.&quot;;
                    isValid = isValid &amp;&amp; false;
                }
            }
            return isValid;
        }

        public ImportItems()
        {
            xmlInjectionForm = GetXmlInjection();
        }

        private DataSet dsSchema = null;

        public override DataSet GetSchema(string strAdditionalInfo)
        {
            if (dsSchema == null)
            {
                DataTable ctTab = new BrixDataTable();
                dsSchema = new BrixDataSet();

                ctTab = dsSchema.Tables.Add(SHEET_NAME);
                AddColumns(ctTab, ContainersSchema());

                // Add Items schema
                AddColumns(ctTab, ItemsSchema(), true);

                // Add SubItems schema
                if ((ModuleId != &quot;BDGTEMP&quot; &amp;&amp; !this.ModuleId.Equals(Constants.MODID_LIBRARY)) &amp;&amp; CoreComponents.Contains(&quot;SubItems&quot;))
                {
                    AddColumns(ctTab, SubItemsSchema());
                }

                //ctTab.Rows.Add(ctTab.NewRow());

                //ctTab = dsitems.Tables.Add(LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR));
                //ctTab.Columns.AddRange(ItemsSchema());
                //ctTab.Rows.Add(ctTab.NewRow());

                //if (CoreComponents.Contains(&quot;SubItems&quot;))
                //    ctTab = SetSubItemInformationForGetSchema(ctTab, dsitems);

                //if (CoreComponents.Contains(&quot;Activities&quot;))
                //{
                //    ctTab = dsitems.Tables.Add(&quot;Activities&quot;);
                //    ctTab.Columns.AddRange(ActivitiesSchema());
                //    ctTab.Rows.Add(ctTab.NewRow());
                //}

                //if (CoreComponents.Contains(&quot;Components&quot;))
                //{
                //    ctTab = dsitems.Tables.Add(&quot;Components&quot;);
                //    ctTab.Columns.AddRange(ComponentsSchema());
                //    ctTab.Rows.Add(ctTab.NewRow());
                //}


                // Adding table to Resources
                // ctTab = dsitems.Tables.Add(&quot;Resource&quot;);

                // Adding Activities schema
                if (CoreComponents.Contains(&quot;Activities&quot;))
                {
                    AddColumns(ctTab, ActivitiesSchema());
                }

                //if (ModuleId != &quot;BDGTEMP&quot; &amp;&amp; CoreComponents.Contains(&quot;Components&quot;))
                //{
                //    AddColumns(ctTab, ComponentsSchema());
                //}

                if (CoreComponents.Contains(&quot;RateAnalysis&quot;))
                {
                    AddColumns(ctTab, ResourcesSchema());
                    AddColumns(ctTab, MaterialSchema());
                }

               
                // Add XML Injection Fields
                _XMLInjectionColumnsNameVsDisplay = new Dictionary&lt;string, string&gt;();
                _XMLInjectionDisplayVsColumnsName = new Dictionary&lt;string, string&gt;();

                foreach (DataColumn c in XmlInjectionItemsSchema())
                {
                    string temp = string.Empty;
                    if (ctTab.Columns.Contains(c.ColumnName))
                    {
                        int i = 0;
                        while (ctTab.Columns.Contains(c.ColumnName + temp))
                        {
                            i++;
                            temp = &quot;(&quot; + i.ToString() + &quot;)&quot;;
                        }
                    }
                    _XMLInjectionColumnsNameVsDisplay.Add(c.ColumnName, c.ColumnName + temp);
                    _XMLInjectionDisplayVsColumnsName.Add(c.ColumnName + temp, c.ColumnName);
                    DataColumn newCol = new DataColumn(c.ColumnName + temp, c.DataType);
                    ctTab.Columns.Add(newCol);
                }

                ctTab.Rows.Add(ctTab.NewRow());
            }

            return dsSchema;
        }

        public override DataTable GetData(string additionalInfo)
        {
            throw new Exception(&quot;The method or operation is not implemented.&quot;);
        }

        public override string GetId()
        {
            return &quot;ContainerLineNo&quot;;
        }

        public override DataTable GetTable(string additionalInfo)
        {
            DataTable temp = new BrixDataTable();
            temp.Columns.Add(&quot;ContainerLineNo&quot;);
            temp.AcceptChanges();
            return temp;
        }


        private Dictionary&lt;string, ColumnDetails&gt; _ItemListColumns = null;

        private Dictionary&lt;string, string&gt; _XMLInjectionColumnsNameVsDisplay = null;

        private Dictionary&lt;string, string&gt; _XMLInjectionDisplayVsColumnsName = null;

        private Dictionary&lt;string, string&gt; XMLInjectionColumnsNameVsDisplay
        {
            get
            {
                if (_XMLInjectionColumnsNameVsDisplay == null)
                    GetSchema(&quot;&quot;);
                return _XMLInjectionColumnsNameVsDisplay;
            }
        }

        private Dictionary&lt;string, string&gt; XMLInjectionDisplayVsColumnsName
        {
            get
            {
                if (_XMLInjectionDisplayVsColumnsName == null)
                    GetSchema(&quot;&quot;);
                return _XMLInjectionDisplayVsColumnsName;
            }
        }

        public virtual Dictionary&lt;string, ColumnDetails&gt; ItemListColumnsWithCaption
        {
            get
            {
                if (_ItemListColumns == null)
                {
                    ItemListModel listModel = ItemListModel.GetInstance(HttpContext.Current.Request, HttpContext.Current.Response,
                            HttpContext.Current.Session[Constants.EIS_ADDITIONAL_INFO] == null
                                ? string.Empty
                                : HttpContext.Current.Session[Constants.EIS_ADDITIONAL_INFO].ToString2());

                    if (listModel == null)
                        listModel = ItemListModel.GetInstance(ModuleId, ParentInstanceID, HttpContext.Current.Request, HttpContext.Current.Response, string.Empty);

                    if (listModel != null)
                    {
                        HierarchicalGridColumns hCols = listModel.HGridColumns();
                        if(listModel.DisplayAmountColumn)
                            hCols.Add(listModel.AmountColumn);
                        foreach (HierarchicalGridColumn column in hCols)
                            column.Caption = Aurigo.Brix.Core.WebUiHelper.GlobalizationUtility.SetResource(column.Caption, false);

                        string scope = &quot;User&quot;;
                        _ItemListColumns =
                               ColumnSettingManager.Instance.GetColumnSettings(ModuleId + &quot;_ItemList&quot;,
                                   UserDetail.GetCurrentUserDetail().UID,
                                   UserDetail.GetCurrentUserDetail().RID, ref scope);
                        //ColumnSettings.Scope = scope;
                        int idx = _ItemListColumns.Count + 1;
                        foreach (HierarchicalGridColumn c in hCols)
                            if (!_ItemListColumns.ContainsKey(c.ColumnName))
                                _ItemListColumns.Add(c.ColumnName,
                                    new ColumnDetails
                                    {
                                        ColumnCaption = c.Caption,
                                        IsVisible = true,
                                        Scope = scope,
                                        Order = idx++
                                    });
                        //IsVisible = !c.Hidden
                        //ArrangeGridColumns(cols);
                        // ColumnSettings.AllColumns = cols;
                    }
                    else
                    {
                        _ItemListColumns = new Dictionary&lt;string, ColumnDetails&gt;();
                    }
                }
                return _ItemListColumns;
            }
        }

        public override DataSet GetResult(string additionalInfo, DataSet ds, int ParentInstanceID, ImportMode mode,
          out ImportStatus status)
        {

            return GetResultInternal(additionalInfo, StagingData == null ? ds : StagingData, ParentInstanceID, mode, out status);
        }

        private DataSet CheckDuplicateRecrodsInDB(DataTable table, int ParentInstanceID)
        {
            foreach (DataColumn dc in table.Columns)
                dc.ColumnName = dc.ColumnName.Replace(&quot; &quot;, &quot;&quot;);
            var list = new List&lt;ContainerDTO&gt;();
            var nextlist = new List&lt;ContainerDTO&gt;();

            DataSet dsResults = GetResultsSchema();

            #region Containers

            int ContainerCount = 0;
            int ItemCount = 0;
            string internalIDName = INTERNAL_ID_COl_NAME.Replace(&quot; &quot;, string.Empty);
            foreach (DataRow dr in table.Rows)
            {
                DataRow[] drCount =
                    table.Select(&quot;Name = &#39;&quot; + dr[&quot;Name&quot;].ToString2().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;).Trim() + &quot;&#39; and &quot; +
                                 &quot;ParentContainerLineNo =&#39;&quot; + dr[&quot;ParentContainerLineNo&quot;].ToString2() + &quot;&#39;&quot;);

                if (!dr[&quot;ContainerLineNo&quot;].Equals(DBNull.Value) &amp;&amp; drCount.Length == 1)
                {
                    var dto = new ContainerDTO();

                    if (dr[internalIDName] != null &amp;&amp; !string.IsNullOrEmpty(dr[internalIDName].ToString2()))
                        dto.InternalID = Convert.ToInt32(dr[internalIDName], CultureInfo.CurrentCulture);

                    dto.ParentContainerLineNo = Convert.ToInt32(dr[&quot;ParentContainerLineNo&quot;],
                        CultureInfo.CurrentCulture);
                    dto.Name = dr[&quot;Name&quot;].ToString2().Trim();
                    dto.Description = dr[&quot;Description&quot;].ToString2();
                    dto.Notes = dr[&quot;Notes&quot;].ToString2();
                    dto.ContainerLineNo = Convert.ToInt32(dr[&quot;ContainerLineNo&quot;], CultureInfo.CurrentCulture);
                    if (!dto.Name.Equals(String.Empty))
                    {
                        nextlist.Add(dto);
                        ContainerCount++;
                    }
                }
                else
                {
                    dsResults.Tables[1].Rows.Add(dr[&quot;ParentContainerLineNo&quot;].ToString2(),
                        dr[&quot;Name&quot;].ToString2(),
                        drCount.Length == 1
                            ? &quot;Required Entry Not Filled&quot;
                            : &quot;Duplicate Container under a parent Container&quot;,
                        drCount.Length == 1
                            ? &quot;Add Value&quot;
                            : &quot;Eliminate Duplicate container&quot;);
                }
            }

            string containersXml = SerializeList(nextlist);

            #endregion

            if (table.Columns.Contains(&quot;ContainerID&quot;))
                table.Columns.Remove(&quot;ContainerID&quot;);

            table.Columns[&quot;ParentContainerLineNo&quot;].ColumnName = &quot;ParentID&quot;;

            if (table.Columns.Contains(&quot;LineNo&quot;))
                table.Columns.Remove(&quot;LineNo&quot;);

            table.Columns[&quot;ContainerLineNo&quot;].ColumnName = &quot;LineNo&quot;;

            DataSet ItemsSet = new BrixDataSet();

            DataTable itemTable = table.Clone();
            itemTable.TableName = ITEM_TYPE;
            ItemsSet.Tables.Add(itemTable);

            //DataTable compTable = table.Clone();
            //compTable.TableName = COMPONENT_TYPE;
            //ItemsSet.Tables.Add(compTable);

            DataTable subItemTable = table.Clone();
            subItemTable.TableName = SUB_ITEM_TYPE;
            ItemsSet.Tables.Add(subItemTable);

            DataTable equipmentTable = table.Clone();
            equipmentTable.TableName = &quot;Equipment&quot;;
            ItemsSet.Tables.Add(equipmentTable);

            DataTable labourTable = table.Clone();
            labourTable.TableName = &quot;Labour&quot;;
            ItemsSet.Tables.Add(labourTable);

            DataTable materialTable = table.Clone();
            materialTable.TableName = &quot;Material&quot;;
            ItemsSet.Tables.Add(materialTable);

            DataTable miscTable = table.Clone();
            miscTable.TableName = &quot;Misc&quot;;
            ItemsSet.Tables.Add(miscTable);

            DataTable subContractTable = table.Clone();
            subContractTable.TableName = &quot;SubContract&quot;;
            ItemsSet.Tables.Add(subContractTable);

            foreach (DataRow row in table.Rows)
            {
                string type = row[RESOURCE_TYPE_COL_NAME].ToString2().ToLower();

                if (type == &quot;item&quot;)
                    itemTable.ImportRow(row);
                //else if (type == &quot;component&quot;)
                //    compTable.ImportRow(row);
                if (type == &quot;subitem&quot;)
                    subItemTable.ImportRow(row);
                if (type == &quot;equipment&quot;)
                    equipmentTable.ImportRow(row);
                if (type == &quot;manpower&quot;)
                    labourTable.ImportRow(row);
                if (type == &quot;material&quot;)
                    materialTable.ImportRow(row);
                if (type == &quot;misc&quot;)
                    miscTable.ImportRow(row);
                if (type == &quot;subcontract&quot;)
                    subContractTable.ImportRow(row);
            }

            string group = LocalizationManager.GetString(KeyConstants.Group).Replace(&quot; &quot;, &quot;&quot;);
            if (itemTable.Columns.Contains(group))
                itemTable.Columns[group].ColumnName = &quot;ScheduledGroup&quot;;

            string unit = LocalizationManager.GetString(&quot;Unit&quot;).Replace(&quot; &quot;, &quot;&quot;);
            if (itemTable.Columns.Contains(unit))
                itemTable.Columns[unit].ColumnName = &quot;Unit&quot;;

            string stdItemNo = LocalizationManager.GetString(KeyConstants.LOC_STDPAYITEM).Replace(&quot; &quot;, &quot;&quot;);
            if (itemTable.Columns.Contains(stdItemNo))
                itemTable.Columns[stdItemNo].ColumnName = &quot;StandardItemNo&quot;;


            ItemCount = itemTable.Rows.Count;

            foreach (DataTable d in ItemsSet.Tables)
                foreach (DataColumn dc in d.Columns)
                    dc.ColumnName = dc.ColumnName.Replace(&quot; &quot;, &quot;&quot;);

            var memstrm = new MemoryStream();
            ItemsSet.WriteXml(memstrm);
            memstrm.Position = 0;
            string itemsXml = new StreamReader(memstrm).ReadToEnd();
            DataSet spResults;

            spResults = ItemManager.Instance.CheckDuplicateItemsBeforeImport(PID, ModuleId, ParentInstanceID, containersXml, itemsXml);

            return spResults;
        }

        private DataSet GetResultInternal(string additionalInfo, DataSet ds, int ParentInstanceID, ImportMode mode,
            out ImportStatus status)
        {
            DataTable table = ds.Tables[SHEET_NAME];

            foreach (DataColumn dc in table.Columns)
                dc.ColumnName = dc.ColumnName.Replace(&quot; &quot;, &quot;&quot;);
            var list = new List&lt;ContainerDTO&gt;();
            var nextlist = new List&lt;ContainerDTO&gt;();

            DataSet dsResults = GetResultsSchema();

            //List&lt;string&gt; CoreComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);

            try
            {
                #region Import Containers

                int ContainerCount = 0;
                int ItemCount = 0;
                string internalIDName = INTERNAL_ID_COl_NAME.Replace(&quot; &quot;, string.Empty);
                foreach (DataRow dr in table.Rows)
                {
                    if (dr[RESOURCE_TYPE_COL_NAME].ToString2().Trim() == CONTAINER_TYPE)
                    {
                        DataRow[] drCount =
                            table.Select(RESOURCE_TYPE_COL_NAME + &quot;=&#39;&quot; + CONTAINER_TYPE + &quot;&#39; and Name = &#39;&quot; + dr[&quot;Name&quot;].ToString2().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;).Trim() + &quot;&#39; and &quot; +
                                         &quot;ParentContainerLineNo =&#39;&quot; + dr[&quot;ParentContainerLineNo&quot;].ToString2() + &quot;&#39;&quot;);

                        if (!dr[&quot;ContainerLineNo&quot;].Equals(DBNull.Value) &amp;&amp; drCount.Length == 1)
                        {
                            var dto = new ContainerDTO();

                            if (dr[internalIDName] != null &amp;&amp; !string.IsNullOrEmpty(dr[internalIDName].ToString2()))
                                dto.InternalID = Convert.ToInt32(dr[internalIDName], CultureInfo.CurrentCulture);

                            dto.ParentContainerLineNo = Convert.ToInt32(dr[&quot;ParentContainerLineNo&quot;],
                                CultureInfo.CurrentCulture);
                            dto.Name = dr[&quot;Name&quot;].ToString2().Trim();
                            dto.Description = dr[&quot;Description&quot;].ToString2();
                            dto.Notes = dr[&quot;Notes&quot;].ToString2();
                            dto.ContainerLineNo = Convert.ToInt32(dr[&quot;ContainerLineNo&quot;], CultureInfo.CurrentCulture);
                            if (!dto.Name.Equals(String.Empty))
                            {
                                nextlist.Add(dto);
                                ContainerCount++;
                            }
                        }
                        else
                        {
                            dsResults.Tables[1].Rows.Add(dr[&quot;ParentContainerLineNo&quot;].ToString2(),
                                dr[&quot;Name&quot;].ToString2(),
                                drCount.Length == 1
                                    ? &quot;Required Entry Not Filled&quot;
                                    : &quot;Duplicate Container under a parent Container&quot;,
                                drCount.Length == 1
                                    ? &quot;Add Value&quot;
                                    : &quot;Eliminate Duplicate container&quot;);
                        }
                    }
                }
                bool ClearExcel = true;
                HandleModuleSpecificLogicForGetResult(ParentInstanceID, table, list, nextlist, dsResults,
                    ref ContainerCount, ref ClearExcel);

                #endregion

                #region Import Items

                if (table.Columns.Contains(&quot;ContainerID&quot;))
                    table.Columns.Remove(&quot;ContainerID&quot;);

                table.Columns[&quot;ParentContainerLineNo&quot;].ColumnName = &quot;ParentID&quot;;


                if (table.Columns.Contains(&quot;LineNo&quot;))
                    table.Columns.Remove(&quot;LineNo&quot;);

                table.Columns[&quot;ContainerLineNo&quot;].ColumnName = &quot;LineNo&quot;;

                DataSet ItemsSet = new BrixDataSet();
                //for (int i = 0; i &lt; ds.Tables.Count; i++)
                //{
                //    if (!ds.Tables[i].TableName.Equals(&quot;Container&quot;))
                //        ItemsSet.Tables.Add(ds.Tables[i].Copy());
                //}

                DataTable itemTable = table.Clone();
                itemTable.TableName = ITEM_TYPE;
                ItemsSet.Tables.Add(itemTable);

                //DataTable compTable = table.Clone();
                //compTable.TableName = COMPONENT_TYPE;
                //ItemsSet.Tables.Add(compTable);

                DataTable subItemTable = table.Clone();
                subItemTable.TableName = SUB_ITEM_TYPE;
                ItemsSet.Tables.Add(subItemTable);

                DataTable equipmentTable = table.Clone();
                equipmentTable.TableName = &quot;Equipment&quot;;
                ItemsSet.Tables.Add(equipmentTable);

                DataTable labourTable = table.Clone();
                labourTable.TableName = &quot;Labour&quot;;
                ItemsSet.Tables.Add(labourTable);

                DataTable materialTable = table.Clone();
                materialTable.TableName = &quot;Material&quot;;
                ItemsSet.Tables.Add(materialTable);

                DataTable miscTable = table.Clone();
                miscTable.TableName = &quot;Misc&quot;;
                ItemsSet.Tables.Add(miscTable);

                DataTable subContractTable = table.Clone();
                subContractTable.TableName = &quot;SubContract&quot;;
                ItemsSet.Tables.Add(subContractTable);

                DataSet schemaSet = GetSchema(string.Empty);
                foreach (DataRow row in ds.Tables[SHEET_NAME].Rows)
                {
                    string type = row[RESOURCE_TYPE_COL_NAME].ToString2().ToLower();

                    // setting default value to 0 for numbers beofor sending as xml to sp
                    // removing formatting char &#39;,&#39; from number
                    foreach (DataColumn c in schemaSet.Tables[SHEET_NAME].Columns)
                    {
                        if (c.ColumnName != INTERNAL_ID_COl_NAME)
                        {
                            string columnName = c.ColumnName.Replace(&quot; &quot;, &quot;&quot;);
                            if (ds.Tables[SHEET_NAME].Columns.Contains(columnName) &amp;&amp;
                                (c.DataType == typeof(Decimal) || c.DataType == typeof(int) || c.DataType == typeof(Int32) || c.DataType == typeof(Int64)))
                            {
                                if ((row[columnName] == null || string.IsNullOrEmpty(row[columnName].ToString())))
                                {
                                    row[columnName] = &quot;0&quot;;
                                }
                                else if (row[columnName].ToString2().Contains(&quot;,&quot;))
                                {
                                    row[columnName] = row[columnName].ToString2().Replace(&quot;,&quot;, string.Empty);
                                }
                            }
                        }
                    }

                    if (type == &quot;item&quot;)
                        itemTable.ImportRow(row);
                    //else if (type == &quot;component&quot;)
                    //    compTable.ImportRow(row);
                    if (type == &quot;subitem&quot;)
                        subItemTable.ImportRow(row);
                    if (type == &quot;equipment&quot;)
                        equipmentTable.ImportRow(row);
                    if (type == &quot;manpower&quot;)
                        labourTable.ImportRow(row);
                    if (type == &quot;material&quot;)
                        materialTable.ImportRow(row);
                    if (type == &quot;misc&quot;)
                        miscTable.ImportRow(row);
                    if (type == &quot;subcontract&quot;)
                        subContractTable.ImportRow(row);
                }

                string group = LocalizationManager.GetString(KeyConstants.Group).Replace(&quot; &quot;, &quot;&quot;);
                if (itemTable.Columns.Contains(group))
                    itemTable.Columns[group].ColumnName = &quot;ScheduledGroup&quot;;

                string unit = LocalizationManager.GetString(&quot;Unit&quot;).Replace(&quot; &quot;, &quot;&quot;);
                if (itemTable.Columns.Contains(unit))
                    itemTable.Columns[unit].ColumnName = &quot;Unit&quot;;

                string stdItemNo = LocalizationManager.GetString(KeyConstants.LOC_STDPAYITEM).Replace(&quot; &quot;, &quot;&quot;);
                if (itemTable.Columns.Contains(stdItemNo))
                    itemTable.Columns[stdItemNo].ColumnName = &quot;StandardItemNo&quot;;

                ItemCount = itemTable.Rows.Count;

                foreach (DataTable d in ItemsSet.Tables)
                    foreach (DataColumn dc in d.Columns)
                        dc.ColumnName = dc.ColumnName.Replace(&quot; &quot;, &quot;&quot;);

                var memstrm = new MemoryStream();
                ItemsSet.WriteXml(memstrm);
                memstrm.Position = 0;
                string ItemsXml = new StreamReader(memstrm).ReadToEnd();
                DataSet spResults;
                string xmlInjectionQuery = string.Empty;
                if (HasXMLInjectionFields &amp;&amp; StagingXMLInjectionData != null)
                {
                    GenericXMLInjectionItemImport injectionImport = new GenericXMLInjectionItemImport(XmlInjectionForm, ModuleId, ParentInstanceID);
                    StringBuilder sb = new StringBuilder();
                    injectionImport.BuildQuery(sb, StagingXMLInjectionData);
                    xmlInjectionQuery = sb.ToString();
                }

                spResults = ItemManager.Instance.ImportItems(PID, ModuleId, ParentInstanceID, ItemsXml, xmlInjectionQuery);
                
                #endregion

                foreach (DataTable dt in dsResults.Tables)
                {
                    if (dt.Rows.Count &lt; 1)
                    {
                        dt.Rows.Clear();
                        dt.Rows.Add(1, &quot;All Records Added Successfully&quot;);
                    }
                }

                status.Status = true;

                status.Message = &quot;Successfully imported &quot; + table.Rows.Count.ToString() + (table.Rows.Count &gt; 1 ? &quot; records.&quot; : &quot; record.&quot;);
            }
            catch (Exception ex)
            {
                status.Status = false;
                status.Message = ex.Message;
            }
            return dsResults;
        }

        protected void ValidateUnitsAndGroups(DataTable xlsTable, DataTable xlsErrorReportingTable, List&lt;string&gt; errorTables)
        {
            bool isValid = true;
            DataTable dtUnits = ProjectManager.Instance.GetMeasurementUnitsForImportItems(ModuleId, ParentInstanceID);
            var units = new List&lt;string&gt;();
            foreach (DataRow dr in dtUnits.Rows)
                units.Add(dr[&quot;Unit&quot;].ToString2());

            DataTable dtGroups = ItemManager.Instance.GetGroupDetails(ParentInstanceID, ModuleId);
            var groups = new List&lt;string&gt;();
            foreach (DataRow dr in dtGroups.Rows)
                groups.Add(dr[&quot;GroupName&quot;].ToString2());

            foreach (DataRow resourceDR in xlsTable.Rows)
            {
                if (SchemaDic[resourceDR[RESOURCE_TYPE_COL_NAME].ToString2().ToLower2()].Columns.Contains(ItemsDBColumns.UNIT) &amp;&amp; !(units.Contains(resourceDR[ItemsDBColumns.UNIT].ToString2())))
                {
                    xlsErrorReportingTable.Rows[xlsTable.Rows.IndexOf(resourceDR)][ItemsDBColumns.UNIT] =
                        ErrorIndicator + resourceDR[ItemsDBColumns.UNIT] + &quot; - unit does not exist in the system.&quot;;
                    isValid = isValid &amp;&amp; false;
                }

                if (SchemaDic[resourceDR[RESOURCE_TYPE_COL_NAME].ToString2().ToLower2()].Columns.Contains(ItemsDBColumns.GROUP_NAME) &amp;&amp; !(groups.Contains(resourceDR[ItemsDBColumns.GROUP_NAME].ToString2())))
                {
                    xlsErrorReportingTable.Rows[xlsTable.Rows.IndexOf(resourceDR)][ItemsDBColumns.GROUP_NAME] =
                        ErrorIndicator + resourceDR[ItemsDBColumns.GROUP_NAME] + &quot; - group does not exist in the system.&quot;;
                    isValid = isValid &amp;&amp; false;
                }
            }

            if (!isValid &amp;&amp; !errorTables.Contains(SHEET_NAME))
                errorTables.Add(SHEET_NAME);
        }

        protected virtual void ValidateModuleSpecificData(DataTable xlsTable, DataTable xlsErrorReportingTable, List&lt;string&gt; errorTables)
        {
        }

        protected override void ValidateData(string additionalInfo, DataSet dsOriginal, DataSet dsValidate,
            List&lt;String&gt; ErrorTables)
        {
            // ValidateSelfReferencingRecords(dsValidate, ErrorTables);
            ValidateUnitsAndGroups(dsOriginal.Tables[SHEET_NAME], dsValidate.Tables[SHEET_NAME], ErrorTables);
            ValidateModuleSpecificData(dsOriginal.Tables[SHEET_NAME], dsValidate.Tables[SHEET_NAME], ErrorTables);
            ValidateDuplicateData(dsValidate, ErrorTables);
            ValidateResourceAndUnits(additionalInfo, dsOriginal, dsValidate, ErrorTables);
            ValidateDataIntegerity(additionalInfo, dsValidate, ErrorTables);
            LocalizeResourceTypes(dsOriginal.Tables[SHEET_NAME]);

            if (HasXMLInjectionFields)
                ValidateXmlInjectionData(additionalInfo, dsOriginal, dsValidate, ErrorTables);
        }

        public virtual bool HasXMLInjectionFields
        {
            get
            {
                return XmlInjectionForm != null ? true : false;
            }
        }

        private DataTable ExtractXMLInjectionData(DataTable excelImportTable, ref List&lt;int&gt; indexMap)
        {
            DataTable dt = null;
            if (HasXMLInjectionFields)
            {
                dt = excelImportTable.Clone();
                foreach (DataRow row in excelImportTable.Select(&quot;[&quot; + RESOURCE_TYPE_COL_NAME + &quot;] = &#39;Item&#39;&quot;))
                {
                    indexMap.Add(excelImportTable.Rows.IndexOf(row));
                    dt.ImportRow(row);
                }

                foreach (DataColumn c in excelImportTable.Columns)
                {
                    if (c.ColumnName == INTERNAL_ID_COl_NAME)
                        continue;
                    else if (c.ColumnName != INTERNAL_ID_COl_NAME &amp;&amp; !XMLInjectionDisplayVsColumnsName.ContainsKey(c.ColumnName))
                        dt.Columns.Remove(c.ColumnName);
                    else
                        dt.Columns[c.ColumnName].ColumnName = XMLInjectionDisplayVsColumnsName[c.ColumnName];
                }
            }
            dt.Columns[INTERNAL_ID_COl_NAME].ColumnName = RECORD_ID_COL_NAME;
            int index = 0;
            foreach(DataRow row in dt.Rows)
            {
                row[RECORD_ID_COL_NAME] = (indexMap[index] + 1).ToString();
                index++;
            }

            return dt;
        }

        protected virtual void ValidateXmlInjectionData(string additionalInfo, DataSet dsOriginal, DataSet dsValidate, List&lt;String&gt; ErrorTables)
        {
            if (HasXMLInjectionFields)
            {
                GenericXMLInjectionItemImport injectionImport = new GenericXMLInjectionItemImport(XmlInjectionForm, ModuleId, ParentInstanceID);

                List&lt;int&gt; indexMap = new List&lt;int&gt;();
                DataTable dt = ExtractXMLInjectionData(dsOriginal.Tables[SHEET_NAME], ref indexMap);
                dt.TableName = injectionImport.NameSheet(null);
                DataSet dsInjection = new DataSet();
                dsInjection.Tables.Add(dt);
                DataSet dsInjectionValidate = dsInjection.Copy();
                injectionImport.ValidateInjectionData(additionalInfo, dsInjection, dsInjectionValidate, ErrorTables);
                injectionImport.ValidateInjectionListData(additionalInfo, dsInjection, dsInjectionValidate, ErrorTables);
                StagingXMLInjectionData = dsInjection;
                MergeInjectionValidationResultToMainDS(dsValidate, dsInjectionValidate, indexMap);
            }
        }

        private void MergeInjectionValidationResultToMainDS(DataSet mainValidateDS, DataSet injecitionValidateDS, List&lt;int&gt; indexMap)
        {
            DataTable dt = injecitionValidateDS.Tables[0];

            for(int i = 0; i &lt; indexMap.Count; i++)
            {
                DataRow row = mainValidateDS.Tables[SHEET_NAME].Rows[indexMap[i]];

                DataRow r = dt.Rows[i];
                foreach (DataColumn c in dt.Columns)
                {
                    if (c.ColumnName != RECORD_ID_COL_NAME)
                        row[XMLInjectionColumnsNameVsDisplay[c.ColumnName]] = r[c.ColumnName];
                }
            }
        }

        private void ValidateDataIntegerity(string additionalInfo, DataSet ds, List&lt;string&gt; ErrorTables)
        {
            //For activities table the total weightage should be 100%.
            if (ds.Tables.Contains(&quot;Activities&quot;))
                ValidateAcitvityTableDataIntegerity(ds.Tables[&quot;Activities&quot;], ErrorTables);
        }

        private void ValidateAcitvityTableDataIntegerity(DataTable dtActivity, List&lt;string&gt; ErrorTables)
        {
            if (dtActivity == null || dtActivity.Rows.Count == 0)
                return;
            bool IsTableValid = true;

            // CHECK FOR UNIQUE NAME AND DESCRIPTION FOR THE ACTIVITITES
            decimal Weightage = 0;
            int CurrentLineNo = 0, PreviousLineNo = 0;


            foreach (DataRow dr in dtActivity.Rows)
            {
                CurrentLineNo = int.Parse(Convert.ToString(dr[&quot;Line No&quot;], CultureInfo.CurrentCulture),
                    CultureInfo.CurrentCulture);

                if (CurrentLineNo != PreviousLineNo)
                {
                    PreviousLineNo = CurrentLineNo;
                    Weightage = 0;
                    bool HasError = false;
                    DataRow[] rows = dtActivity.Select(&quot;[Line No] = &#39;&quot; + dr[&quot;Line No&quot;] + &quot;&#39;&quot;);
                    foreach (DataRow row in rows)
                    {
                        if (Convert.ToString(row[&quot;Weightage&quot;], CultureInfo.CurrentCulture).Contains(ErrorIndicator))
                        {
                            HasError = true;
                            IsTableValid = false;
                            break;
                        }
                        else
                        {
                            Weightage += Convert.ToDecimal(row[&quot;Weightage&quot;], CultureInfo.CurrentCulture);
                        }
                    }
                    if (Weightage != 100 &amp;&amp; !HasError)
                    {
                        IsTableValid = false;
                        rows[rows.Length - 1][&quot;Weightage&quot;] = ErrorIndicator + &quot;Weightage cumulative should be 100 %. &quot; +
                                                             Convert.ToString(rows[rows.Length - 1][&quot;Weightage&quot;],
                                                                 CultureInfo.CurrentCulture);
                    }
                }
            }

            if (!IsTableValid &amp;&amp; !ErrorTables.Contains(dtActivity.TableName))
            {
                ErrorTables.Add(dtActivity.TableName);
            }
        }

        protected virtual void ValidateResourceAndUnits(string additionalInfo, DataSet dsOriginal, DataSet dsValidation,
            List&lt;String&gt; ErrorTables)
        {
            # region Dynamics AX Units And Resources Validation

            bool HasError = false;
            if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX))
            {
                DataSet dsData = new BrixDataSet();
                int count = 0;
                var dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
                dictAdditionalInfo.Add(RegisteredEIS.AX,
                    new EISAdditionalInfo(RegisteredEIS.AX).AddInfo(&quot;AXCompany&quot;, additionalInfo));
                var conParameters =
                    new ConnectorParameters(dictAdditionalInfo, MethodBase.GetCurrentMethod(), AMP3ObjectType.Unknown,
                        null, null);
                bool isSuccess = IntegrationConnectorManager.HandleIntegration(conParameters, ref count, ref dsData,
                    true);
                DataTable dtResources = null;
                if (isSuccess)
                {
                    dtResources = (dsData.Tables.Count &gt; 0) ? dsData.Tables[0] : new BrixDataTable();
                    for (int i = 0; i &lt; dsValidation.Tables.Count; i++)
                    {
                        DataTable dtItemsSet = dsValidation.Tables[i];
                        if (dtItemsSet.TableName.Equals(LocalizationManager.GetString(KeyConstants.LOC_ICA_MANPOWER)))
                            dtResources.DefaultView.RowFilter = &quot;[Resource type] = 2&quot;;
                        else if (
                            dtItemsSet.TableName.Equals(LocalizationManager.GetString(KeyConstants.LOC_ICA_MATERIALS)))
                            dtResources.DefaultView.RowFilter =
                                &quot;[Resource type] = 0 AND [Resource Group] &lt;&gt; &#39;Equipment&#39; AND [Resource Group] &lt;&gt; &#39;SpareParts&#39;&quot;;
                        else if (dtItemsSet.TableName.Equals(&quot;SubContract&quot;))
                            dtResources.DefaultView.RowFilter =
                                &quot;[Resource type] = 2 AND [Resource Group] = &#39;SubCont&#39;&quot;;


                        if (dsValidation.Tables[i].TableName != LocalizationManager.GetString(KeyConstants.LOC_ICA_MISC) &amp;&amp;
                            dsValidation.Tables[i].TableName !=
                            LocalizationManager.GetString(KeyConstants.LOC_ICA_EQUIPMENT))
                        {
                            //TO CHECK IF THE RESOURCE ID EXISTS IN AX
                            GetValidAXResources(dsOriginal.Tables[dtItemsSet.TableName], dtItemsSet,
                                dtResources.DefaultView.ToTable(), &quot;ParentResItemID&quot;, &quot;Resource ID&quot;,
                                out HasError, additionalInfo);
                            if (HasError &amp;&amp; !ErrorTables.Contains(dsValidation.Tables[i].TableName))
                                ErrorTables.Add(dsValidation.Tables[i].TableName);

                            //TO CHECK IF THE MATERIAL HIERARCHY IS VALID IN AX
                            GetValidAXResources(dsOriginal.Tables[dtItemsSet.TableName], dtItemsSet,
                                dtResources.DefaultView.ToTable(), &quot;Size&quot;, &quot;Size&quot;, out HasError,
                                additionalInfo);
                            if (HasError &amp;&amp; !ErrorTables.Contains(dsValidation.Tables[i].TableName))
                                ErrorTables.Add(dsValidation.Tables[i].TableName);
                        }
                    }
                }

                # region Equipments Fixed Assets Validation

                conParameters =
                    new ConnectorParameters(dictAdditionalInfo, MethodBase.GetCurrentMethod().DeclaringType.ToString2(),
                        MethodBase.GetCurrentMethod().Name + &quot;_FA&quot;, AMP3ObjectType.Unknown,
                        null, null);
                isSuccess = IntegrationConnectorManager.HandleIntegration(conParameters, ref count, ref dsData, true);
                if (isSuccess)
                {
                    dtResources = (dsData.Tables.Count &gt; 0) ? dsData.Tables[0] : new BrixDataTable();
                    DataTable dtEquipments =
                        dsValidation.Tables[LocalizationManager.GetString(KeyConstants.LOC_ICA_EQUIPMENT)];
                    GetValidAXResources(dsOriginal.Tables[dtEquipments.TableName], dtEquipments, dtResources,
                        &quot;ParentResItemID&quot;, &quot;Resource ID&quot;, out HasError, additionalInfo);
                    if (HasError &amp;&amp;
                        !ErrorTables.Contains(
                            dsValidation.Tables[LocalizationManager.GetString(KeyConstants.LOC_ICA_EQUIPMENT)].TableName))
                        ErrorTables.Add(
                            dsValidation.Tables[LocalizationManager.GetString(KeyConstants.LOC_ICA_EQUIPMENT)].TableName);
                }

                # endregion

                DataTable dtUnit = ProjectComponent.Instance.GetMeasurementUnitsForSystem(additionalInfo, 0);
                for (int i = 0; i &lt; dsValidation.Tables.Count; i++)
                {
                    DataTable dtItemsSet = dsValidation.Tables[i];
                    if ((dtItemsSet.TableName == &quot;SubItems&quot;) &amp;&amp; dtItemsSet.Rows.Count &gt; 0)
                    {
                        ValidateDimensionTables(dsOriginal.Tables[i], dtItemsSet, dtUnit, out HasError);
                    }
                    else
                    {
                        GetValidAXResources(dsOriginal.Tables[dtItemsSet.TableName], dtItemsSet, dtUnit, &quot;Unit&quot;, &quot;Unit&quot;,
                            out HasError, additionalInfo);
                    }
                    if (HasError &amp;&amp; !ErrorTables.Contains(dsValidation.Tables[i].TableName))
                        ErrorTables.Add(dsValidation.Tables[i].TableName);
                }
            }
            #endregion
            #region Library Resources Validation

            else
            {
                bool isValid = true;
                //foreach (DataTable dt in dsValidation.Tables)
                //{
                //string resType = string.Empty;
                //if (dt.TableName == LocalizationManager.GetString(KeyConstants.LOC_ICA_EQUIPMENT))
                //    resType = &quot;E&quot;;
                //else if (dt.TableName == LocalizationManager.GetString(KeyConstants.LOC_ICA_MANPOWER))
                //    resType = &quot;L&quot;;
                //else if (dt.TableName == LocalizationManager.GetString(KeyConstants.LOC_ICA_MATERIALS))
                //    resType = &quot;M&quot;;
                //else if (dt.TableName == LocalizationManager.GetString(KeyConstants.LOC_ICA_SUBCONTRACT))
                //    resType = &quot;S&quot;;
                //DataTable dtResources = LibraryInterface.Instance.GetLibraryResources(resType);

                DataTable dt = dsValidation.Tables[SHEET_NAME];
                Dictionary&lt;string, string&gt; types = new Dictionary&lt;string, string&gt;();
                types.Add(&quot;E&quot;, LocalizationManager.GetString(KeyConstants.LOC_ICA_EQUIPMENT));
                types.Add(&quot;L&quot;, LocalizationManager.GetString(KeyConstants.LOC_ICA_MANPOWER));
                types.Add(&quot;S&quot;, &quot;SubContract&quot;);
                types.Add(&quot;M&quot;, LocalizationManager.GetString(KeyConstants.LOC_ICA_MATERIALS));

                foreach (string resType in types.Keys)
                {
                    DataTable dtResources = LibraryInterface.Instance.GetLibraryResources(resType);

                    string filter = string.Empty;
                    string filteQuery = string.Format(&quot;[Type]=&#39;{0}&#39;&quot;, types[resType]);
                    if (resType == &quot;E&quot; || resType == &quot;L&quot; || resType == &quot;S&quot;)
                    {
                        foreach (DataRow dr in dt.Select(filteQuery))
                        {
                            filter = string.Format(&quot;ResItemID=&#39;{0}&#39; and Description=&#39;{1}&#39; and Unit=&#39;{2}&#39;&quot;,
                                dr[&quot;Resource ID&quot;].ToString().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;),
                                dr[&quot;Description&quot;].ToString().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;),
                                dr[&quot;Unit&quot;].ToString().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;));
                            isValid = ValidateResourceInEachRecord(ErrorTables, isValid, dt, dtResources, dr, filter);
                        }
                    }
                    else if (resType == &quot;M&quot;)
                    {
                        foreach (DataRow dr in dt.Select(filteQuery))
                        {
                            filter =
                                string.Format(
                                    @&quot;ResItemID=&#39;{0}&#39; and Description=&#39;{1}&#39; and Unit=&#39;{2}&#39; 
                                    and (Size IS NULL OR Size=&#39;{3}&#39;) and (Color IS NULL OR Color=&#39;{4}&#39;) 
                                    and (Configuration IS NULL OR Configuration=&#39;{5}&#39;)&quot;,
                                    dr[&quot;Resource ID&quot;].ToString().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;),
                                    dr[&quot;Description&quot;].ToString().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;),
                                    dr[&quot;Unit&quot;].ToString().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;),
                                    dr[&quot;Size&quot;].ToString().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;),
                                    dr[&quot;Color&quot;].ToString().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;),
                                    dr[&quot;Configuration&quot;].ToString().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;));
                            isValid = ValidateResourceInEachRecord(ErrorTables, isValid, dt, dtResources, dr, filter);
                        }
                    }
                }
            }

            #endregion
        }

        private bool ValidateResourceInEachRecord(List&lt;String&gt; ErrorTables, bool isValid, DataTable dt,
            DataTable dtResources, DataRow dr, string filter)
        {
            DataRow[] drs = dtResources.Select(filter);
            if (drs.Length &lt;= 0)
            {
                isValid = isValid &amp;&amp; false;
                if (!dt.Columns.Contains(&quot;ErrorMessage&quot;))
                    dt.Columns.Add(&quot;ErrorMessage&quot;);
                dr[&quot;ErrorMessage&quot;] = ErrorIndicator + &quot; This is not a valid resource&quot;;
                if (!ErrorTables.Contains(dt.TableName))
                    ErrorTables.Add(dt.TableName);
            }
            return isValid;
        }

        protected virtual void ValidateDimensionTables(DataTable dtOriginal, DataTable dtValidation, DataTable dtUnit,
            out bool HasError)
        {
            //Get BOQ Line No List...
            HasError = false;
            int PrevLineNo = int.Parse(Convert.ToString(dtValidation.Rows[0][&quot;Line No&quot;], CultureInfo.CurrentCulture),
                CultureInfo.CurrentCulture);
            bool Dim1, Dim2, Dim3;
            Dim1 =
                (!String.IsNullOrEmpty(Convert.ToString(dtValidation.Rows[0][&quot;Dimension 1&quot;], CultureInfo.CurrentCulture)) &amp;&amp;
                 !String.IsNullOrEmpty(Convert.ToString(dtValidation.Rows[0][&quot;Dimension 1 Unit&quot;],
                     CultureInfo.CurrentCulture)));
            Dim2 =
                (!String.IsNullOrEmpty(Convert.ToString(dtValidation.Rows[0][&quot;Dimension 2&quot;], CultureInfo.CurrentCulture)) &amp;&amp;
                 !String.IsNullOrEmpty(Convert.ToString(dtValidation.Rows[0][&quot;Dimension 2 Unit&quot;],
                     CultureInfo.CurrentCulture)));
            Dim3 =
                (!String.IsNullOrEmpty(Convert.ToString(dtValidation.Rows[0][&quot;Dimension 3&quot;], CultureInfo.CurrentCulture)) &amp;&amp;
                 !String.IsNullOrEmpty(Convert.ToString(dtValidation.Rows[0][&quot;Dimension 3 Unit&quot;],
                     CultureInfo.CurrentCulture)));
            for (int i = 0; i &lt; dtValidation.Rows.Count; i++)
            {
                int LineNo = int.Parse(Convert.ToString(dtValidation.Rows[i][&quot;Line No&quot;], CultureInfo.CurrentCulture),
                    CultureInfo.CurrentCulture);
                if (PrevLineNo != LineNo)
                {
                    PrevLineNo = LineNo;
                    Dim1 =
                        (!String.IsNullOrEmpty(Convert.ToString(dtValidation.Rows[i][&quot;Dimension 1&quot;],
                            CultureInfo.CurrentCulture)) &amp;&amp;
                         !String.IsNullOrEmpty(Convert.ToString(dtValidation.Rows[i][&quot;Dimension 1 Unit&quot;],
                             CultureInfo.CurrentCulture)));
                    Dim2 =
                        (!String.IsNullOrEmpty(Convert.ToString(dtValidation.Rows[i][&quot;Dimension 2&quot;],
                            CultureInfo.CurrentCulture)) &amp;&amp;
                         !String.IsNullOrEmpty(Convert.ToString(dtValidation.Rows[i][&quot;Dimension 2 Unit&quot;],
                             CultureInfo.CurrentCulture)));
                    Dim3 =
                        (!String.IsNullOrEmpty(Convert.ToString(dtValidation.Rows[i][&quot;Dimension 3&quot;],
                            CultureInfo.CurrentCulture)) &amp;&amp;
                         !String.IsNullOrEmpty(Convert.ToString(dtValidation.Rows[i][&quot;Dimension 3 Unit&quot;],
                             CultureInfo.CurrentCulture)));
                }

                if (Dim1 || Dim2 || Dim3)
                {
                    CheckForEmptyCellsInRow(dtValidation.Rows[i], &quot;Number&quot;, ref HasError);
                }
                if (Dim1)
                {
                    CheckForEmptyCellsInRow(dtValidation.Rows[i], &quot;Dimension 1&quot;, ref HasError);
                    GetValidAXResourcesInRow(dtOriginal.Rows[i], dtUnit, &quot;Unit&quot;, &quot;Dimension 1 Unit&quot;, ref HasError);
                    GetValidAXResourcesInRow(dtValidation.Rows[i], dtUnit, &quot;Unit&quot;, &quot;Dimension 1 Unit&quot;, ref HasError);
                }
                else
                {
                    dtValidation.Rows[i][&quot;Dimension 1&quot;] = dtValidation.Rows[i][&quot;Dimension 1 Unit&quot;] = String.Empty;
                    dtOriginal.Rows[i][&quot;Dimension 1&quot;] = dtOriginal.Rows[i][&quot;Dimension 1 Unit&quot;] = String.Empty;
                }

                if (Dim2)
                {
                    CheckForEmptyCellsInRow(dtValidation.Rows[i], &quot;Dimension 2&quot;, ref HasError);
                    GetValidAXResourcesInRow(dtOriginal.Rows[i], dtUnit, &quot;Unit&quot;, &quot;Dimension 2 Unit&quot;, ref HasError);
                    GetValidAXResourcesInRow(dtValidation.Rows[i], dtUnit, &quot;Unit&quot;, &quot;Dimension 2 Unit&quot;, ref HasError);
                }
                else
                {
                    dtValidation.Rows[i][&quot;Dimension 2 Unit&quot;] = dtValidation.Rows[i][&quot;Dimension 2&quot;] = String.Empty;
                    dtOriginal.Rows[i][&quot;Dimension 2 Unit&quot;] = dtOriginal.Rows[i][&quot;Dimension 2&quot;] = String.Empty;
                }

                if (Dim3)
                {
                    CheckForEmptyCellsInRow(dtValidation.Rows[i], &quot;Dimension 3&quot;, ref HasError);
                    GetValidAXResourcesInRow(dtOriginal.Rows[i], dtUnit, &quot;Unit&quot;, &quot;Dimension 3 Unit&quot;, ref HasError);
                    GetValidAXResourcesInRow(dtValidation.Rows[i], dtUnit, &quot;Unit&quot;, &quot;Dimension 3 Unit&quot;, ref HasError);
                }
                else
                {
                    dtValidation.Rows[i][&quot;Dimension 3&quot;] = dtValidation.Rows[i][&quot;Dimension 3 Unit&quot;] = String.Empty;
                    dtOriginal.Rows[i][&quot;Dimension 3&quot;] = dtOriginal.Rows[i][&quot;Dimension 3 Unit&quot;] = String.Empty;
                }
            }
        }

        private int GetParentID(DataTable dt, DataRow row, int rowNum)
        {
            string type = row[RESOURCE_TYPE_COL_NAME].ToString();
            int indentLevel = row[INDENT_LEVEL_COL_NAME].ToInt32_2();

            type = type.ToLower();
            if (indentLevel == 0)
            {
                if (type == &quot;container&quot; || type == &quot;item&quot;)
                    return 0;
                else
                    return -1; // error
            }

            string parentType = (type == &quot;container&quot; || type == &quot;item&quot;) ? CONTAINER_TYPE : ITEM_TYPE;


            string filter = &quot;[Indent Level] = &quot; + (indentLevel - 1)
                + &quot; AND Type = &#39;&quot; + parentType
                + &quot;&#39; AND &quot; + ROW_NUM_COL_NAME + &quot; &lt; &quot; + rowNum
                + &quot; AND &quot; + PARENT_COL_NAME + &quot;&lt;&gt; &#39;&#39;&quot;;

            DataRow[] rows = dt.Select(filter);

            if (rows == null || rows.Length == 0)
                return -1;

            int result = -1;

            if (type == &quot;container&quot;)
            {
                row[PATH_COL_NAME] = string.IsNullOrEmpty(rows[rows.Length - 1][PATH_COL_NAME].ToString()) ?
                    row[&quot;Name&quot;] : rows[rows.Length - 1][PATH_COL_NAME].ToString() + &quot;/&quot; + row[&quot;Name&quot;];
            }
            else if (type == &quot;item&quot;)
            {
                row[PATH_COL_NAME] = rows[rows.Length - 1][PATH_COL_NAME].ToString();
            }

            Int32.TryParse(rows[rows.Length - 1][ROW_NUM_COL_NAME].ToString(), out result);

            return result;
        }

        protected bool SetParentIDs(DataSet ds, List&lt;String&gt; ErrorTables, DataTable validationTable)
        {
            bool hasError = false;

            DataTable dt = ds.Tables[0];

            dt.Columns.Add(ROW_NUM_COL_NAME, typeof(int));
            dt.Columns.Add(PARENT_COL_NAME, typeof(String));
            dt.Columns.Add(PATH_COL_NAME, typeof(String));

            int rowNum = 1;
            foreach (DataRow row in dt.Rows)
            {
                row[ROW_NUM_COL_NAME] = rowNum;
                int pID = GetParentID(dt, row, rowNum);
                if (pID &lt; 0)
                {
                    hasError = true;
                    SetValidationErrorMsg(validationTable.Rows[rowNum - 1], errorColumnName, &quot;Parent not found.&quot;);
                    ErrorTables.Add(SHEET_NAME);
                    //break;
                }
                else
                {
                    row[PARENT_COL_NAME] = pID;
                }
                rowNum++;
            }
            return hasError;
        }

        private string GetDuplicateFilterQuery(DataRow row)
        {
            string itemType = row[RESOURCE_TYPE_COL_NAME].ToString();

            string id = row[INTERNAL_ID_COl_NAME].ToString();
            switch (itemType.ToLower2())
            {
                case &quot;container&quot;:
                    return string.Format(&quot;([&quot; + INTERNAL_ID_COl_NAME + &quot;] &lt;&gt; &#39;&#39; AND Type = &#39;{0}&#39; AND[&quot; + INTERNAL_ID_COl_NAME + &quot;] = &#39;{1}&#39;) OR (Type = &#39;{0}&#39; AND &quot; + PARENT_COL_NAME + &quot; = {1} AND Name = &#39;{2}&#39;)&quot;, itemType.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;), row[PARENT_COL_NAME].ToInt32_2(), row[&quot;name&quot;].ToString().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;));
                case &quot;item&quot;:
                    return string.Format(&quot;[&quot; + INTERNAL_ID_COl_NAME + &quot;] &lt;&gt; &#39;&#39; AND Type = &#39;{0}&#39; AND [&quot; + INTERNAL_ID_COl_NAME + &quot;] = &#39;{1}&#39;&quot;,
                        itemType.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;), id.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;));
                case &quot;subitem&quot;:
                    return string.Format(&quot;([&quot; + INTERNAL_ID_COl_NAME + &quot;] &lt;&gt; &#39;&#39; AND Type = &#39;{0}&#39; AND[&quot; + INTERNAL_ID_COl_NAME + &quot;] = &#39;{1}&#39;) OR (Type = &#39;{0}&#39; AND [&quot; + INTERNAL_ID_COl_NAME + &quot;] = &#39;{1}&#39; AND &quot; + PARENT_COL_NAME + &quot; = {2} AND [Description] = &#39;{3}&#39;)&quot;,
                        itemType.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;), id.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;), row[PARENT_COL_NAME].ToInt32_2(), row[&quot;Description&quot;].ToString().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;));
                //case &quot;component&quot;:
                //    return string.Format(&quot;Type = &#39;{0}&#39;  AND [&quot; + INTERNAL_ID_COl_NAME + &quot;] = &#39;{1}&#39; AND &quot; + PARENT_COL_NAME + &quot; = {2} AND [Component Name] = &#39;{3}&#39;&quot;,
                //    itemType.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;), id.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;), row[PARENT_COL_NAME].ToInt32_2(), row[&quot;Component Name&quot;].ToString().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;));
                case &quot;equipment&quot;:
                case &quot;manpower&quot;:
                case &quot;material&quot;:
                case &quot;misc&quot;:
                case &quot;subcontract&quot;:
                    return string.Format(&quot;([&quot; + INTERNAL_ID_COl_NAME + &quot;] &lt;&gt; &#39;&#39; AND Type = &#39;{0}&#39; AND[&quot; + INTERNAL_ID_COl_NAME + &quot;] = &#39;{1}&#39;) OR (Type = &#39;{0}&#39; AND [&quot; + INTERNAL_ID_COl_NAME + &quot;] = &#39;{1}&#39; AND &quot; + PARENT_COL_NAME + &quot; = {2} AND [Resource ID] = &#39;{3}&#39;)&quot;,
                     itemType.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;), id.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;), row[PARENT_COL_NAME].ToInt32_2(), row[&quot;Resource ID&quot;].ToString().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;));
                default:
                    return &quot;1= 0&quot;;
            }
        }

        private void LocalizeResourceTypes(DataTable dt)
        {
            foreach (DataRow dr in dt.Rows)
            {
                if ((dr[ITEM_TYPE_COL_NAME] != DBNull.Value) ||
                    !string.IsNullOrEmpty(Convert.ToString(dr[ITEM_TYPE_COL_NAME], CultureInfo.CurrentCulture)))
                {
                    dr[ITEM_TYPE_COL_NAME] = GetLocalResourceName(dr[ITEM_TYPE_COL_NAME].ToString());
                }
            }
        }

        private void SetValidationErrorMsg(DataRow row, string errorColumnName, string errorMsg, bool overrideMsg = false)
        {
            if (!overrideMsg &amp;&amp; row[errorColumnName] != null &amp;&amp; !string.IsNullOrEmpty(row[errorColumnName].ToString()))
            {
                if (!row[errorColumnName].ToString().Contains(errorMsg))
                    row[errorColumnName] = row[errorColumnName].ToString() + &quot; &quot; + errorMsg;
            }
            else
            {
                row[errorColumnName] = ErrorIndicator + &quot; &quot; + errorMsg; ;
            }
        }
      
        protected virtual void ValidateDuplicateData(DataSet ds, List&lt;String&gt; ErrorTables)
        {
            DataTable validationDT = ds.Tables[0];

            if (!validationDT.Columns.Contains(errorColumnName))
            {
                validationDT.Columns.Add(errorColumnName);
            }

            StagingData = ds.Copy();

            bool hasError = SetParentIDs(StagingData, ErrorTables, validationDT);

            if (!hasError)
            {
                DataTable dt = StagingData.Tables[0];

                foreach (DataRow dr in dt.Rows)
                {
                    if ((dr[ITEM_TYPE_COL_NAME] != DBNull.Value) ||
                        !string.IsNullOrEmpty(Convert.ToString(dr[ITEM_TYPE_COL_NAME], CultureInfo.CurrentCulture)))
                    {
                        dr[ITEM_TYPE_COL_NAME] = GetGeneralResourceName(dr[ITEM_TYPE_COL_NAME].ToString());
                    }
                }

                bool hasDuplicate = false;
                int index = 0;

                // Check duplicate within Excel only
                foreach (DataRow row in dt.Rows)
                {
                    if (dt.Select(GetDuplicateFilterQuery(row)).Length &gt; 1)
                    {
                        validationDT.Rows[index][errorColumnName] = ErrorIndicator + &quot; Duplicate Record.&quot;;
                        hasDuplicate = true;
                    }
                    index++;
                }

                //  to do: Check duplicate reocrds in DB and Excel
                DataSet resultDS = CheckDuplicateRecrodsInDB(dt.Copy(), ParentInstanceID);
                if (resultDS != null &amp;&amp; resultDS.Tables.Count == 4)
                {
                    for (int i = 0; i &lt; 4; i++)
                    {
                        DataTable duplicateRecords = resultDS.Tables[i];
                        if (duplicateRecords != null &amp;&amp; duplicateRecords.Rows.Count &gt; 0)
                        {
                            hasDuplicate = true;
                            foreach (DataRow dr in duplicateRecords.Rows)
                            {
                                SetValidationErrorMsg(validationDT.Rows[(int)dr[&quot;LineNo&quot;] - 1], (i == 0 || i == 1) ? errorColumnName : (i == 2 ? ItemsDBColumns.RULE_NAME : ItemsDBColumns.LINKED_BUDGET_ITEM_NAME),
                                    i == 0 ? &quot;Duplicate Record.&quot; : (i == 1 ? &quot;Record belongs to different parent.&quot; : (i == 2 ? &quot;Invalid Rule Name.&quot; : &quot;Invalid Budget Item.&quot;)), i &lt; 2 ? false : true);
                            }
                        }
                    }
                }

                if (hasDuplicate &amp;&amp; !ErrorTables.Contains(SHEET_NAME))
                    ErrorTables.Add(SHEET_NAME);
            }
        }

        private void CheckForDuplicateWithinBOQ(DataTable dt, List&lt;String&gt; ErrorTables, List&lt;string&gt; list)
        {
            int CurrentLineNo = 0, PrevLineNo = 0;
            string currActivity = string.Empty, prevActivity = string.Empty;
            foreach (DataRow dr in dt.Rows)
            {
                CurrentLineNo = int.Parse(Convert.ToString(dr[&quot;Line No&quot;], CultureInfo.CurrentCulture),
                    CultureInfo.CurrentCulture);
                if (dt.TableName.Equals(&quot;Activities&quot;))
                    currActivity = dr[&quot;Name&quot;].ToString2();
                if (CurrentLineNo != PrevLineNo &amp;&amp; (!dt.TableName.Equals(&quot;Activities&quot;) || currActivity != prevActivity))
                {
                    PrevLineNo = CurrentLineNo;
                    string filter = &quot;[Line No] = &#39;&quot; + CurrentLineNo + &quot;&#39;&quot;;
                    if (dt.TableName.Equals(&quot;Activities&quot;))
                    {
                        filter += &quot; AND Name = &#39;&quot; + currActivity + &quot;&#39;&quot;;
                        prevActivity = currActivity;
                    }
                    if (CheckDuplicate(dt, list, filter))
                    {
                        if (!ErrorTables.Contains(dt.TableName))
                            ErrorTables.Add(dt.TableName);
                    }
                }
            }
        }

        #endregion

        #region &quot;Protected methods&quot;

        protected virtual DataTable SetSubItemInformationForGetSchema(DataTable ctTab, DataSet dsitems)
        {
            ctTab = dsitems.Tables.Add(&quot;SubItems&quot;);
            ctTab.Columns.AddRange(SubItemsSchema());
            ctTab.Rows.Add(ctTab.NewRow());
            return ctTab;
        }

        protected virtual DataSet GetResultsSchema()
        {
            DataTable ctTab = new BrixDataTable();
            DataSet dsitems = new BrixDataSet();

            ctTab = dsitems.Tables.Add(&quot;Container&quot;);
            ctTab.Columns.AddRange(new[]
            {
                new DataColumn(&quot;ContainerLineNo&quot;, typeof (Int32)),
                new DataColumn(&quot;Name&quot;, typeof (String)),
                new DataColumn(&quot;Unit&quot;, typeof (String)),
                new DataColumn(&quot;Error&quot;, typeof (String)),
                new DataColumn(&quot;Solution&quot;, typeof (String))
            });

            ctTab = dsitems.Tables.Add(LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR));
            ctTab.Columns.AddRange(new[]
            {
                new DataColumn(&quot;LineNo&quot;, typeof (Int32)),
                new DataColumn(&quot;BOQDescription&quot;, typeof (String)),
                new DataColumn(&quot;Unit&quot;, typeof (String)),
                new DataColumn(&quot;Error&quot;, typeof (String)),
                new DataColumn(&quot;Solution&quot;, typeof (String))
            });

            HandleMuduleSpecificLogicForGetResultsSchema(ctTab, dsitems);

            ctTab = dsitems.Tables.Add(&quot;Activities&quot;);
            ctTab.Columns.AddRange(new[]
            {
                new DataColumn(&quot;LineNo&quot;, typeof (Int32)),
                new DataColumn(&quot;Name&quot;, typeof (String)),
                new DataColumn(&quot;Unit&quot;, typeof (String)),
                new DataColumn(&quot;Error&quot;, typeof (String)),
                new DataColumn(&quot;Solution&quot;, typeof (String))
            });

            ctTab = dsitems.Tables.Add(&quot;Components&quot;);
            ctTab.Columns.AddRange(new[]
            {
                new DataColumn(&quot;LineNo&quot;, typeof (Int32)),
                new DataColumn(&quot;Description&quot;, typeof (String)),
                new DataColumn(&quot;Unit&quot;, typeof (String)),
                new DataColumn(&quot;Error&quot;, typeof (String)),
                new DataColumn(&quot;Solution&quot;, typeof (String))
            });

            ctTab = dsitems.Tables.Add(LocalizationManager.GetString(KeyConstants.LOC_ICA_MANPOWER));
            ctTab.Columns.AddRange(new[]
            {
                new DataColumn(&quot;LineNo&quot;, typeof (Int32)),
                new DataColumn(&quot;Description&quot;, typeof (String)),
                new DataColumn(&quot;Unit&quot;, typeof (String)),
                new DataColumn(&quot;Error&quot;, typeof (String)),
                new DataColumn(&quot;Solution&quot;, typeof (String))
            });

            ctTab = dsitems.Tables.Add(LocalizationManager.GetString(KeyConstants.LOC_ICA_EQUIPMENT));
            ctTab.Columns.AddRange(new[]
            {
                new DataColumn(&quot;LineNo&quot;, typeof (Int32)),
                new DataColumn(&quot;Description&quot;, typeof (String)),
                new DataColumn(&quot;Unit&quot;, typeof (String)),
                new DataColumn(&quot;Error&quot;, typeof (String)),
                new DataColumn(&quot;Solution&quot;, typeof (String))
            });

            ctTab = dsitems.Tables.Add(LocalizationManager.GetString(KeyConstants.LOC_ICA_MATERIALS));
            ctTab.Columns.AddRange(new[]
            {
                new DataColumn(&quot;LineNo&quot;, typeof (Int32)),
                new DataColumn(&quot;Description&quot;, typeof (String)),
                new DataColumn(&quot;Unit&quot;, typeof (String)),
                new DataColumn(&quot;Error&quot;, typeof (String)),
                new DataColumn(&quot;Solution&quot;, typeof (String))
            });

            ctTab = dsitems.Tables.Add(LocalizationManager.GetString(KeyConstants.LOC_ICA_MISC));
            ctTab.Columns.AddRange(new[]
            {
                new DataColumn(&quot;LineNo&quot;, typeof (Int32)),
                new DataColumn(&quot;Description&quot;, typeof (String)),
                new DataColumn(&quot;Unit&quot;, typeof (String)),
                new DataColumn(&quot;Error&quot;, typeof (String)),
                new DataColumn(&quot;Solution&quot;, typeof (String))
            });

            ctTab = dsitems.Tables.Add(&quot;SubContract&quot;);
            ctTab.Columns.AddRange(new[]
            {
                new DataColumn(&quot;LineNo&quot;, typeof (Int32)),
                new DataColumn(&quot;Description&quot;, typeof (String)),
                new DataColumn(&quot;Unit&quot;, typeof (String)),
                new DataColumn(&quot;Error&quot;, typeof (String)),
                new DataColumn(&quot;Solution&quot;, typeof (String))
            });

            return dsitems;
        }

        protected virtual void HandleMuduleSpecificLogicForGetResultsSchema(DataTable ctTab, DataSet dsitems)
        {
            ctTab = dsitems.Tables.Add(&quot;SubItems&quot;);
            ctTab.Columns.AddRange(new[]
            {
                //new DataColumn(&quot;LineNo&quot;, typeof (Int32)),
                new DataColumn(&quot;Description&quot;, typeof (String)),
                new DataColumn(&quot;SubItemID&quot;, typeof (String)),
                new DataColumn(&quot;Error&quot;, typeof (String)),
                new DataColumn(&quot;Solution&quot;, typeof (String))
            });
        }

        protected virtual DataColumn[] ItemsSchema()
        {
            return null;
        }

        protected void SetCaptionToItemsColumn(List&lt;DataColumn&gt; itemColumns)
        {
            if (itemColumns != null &amp;&amp; ItemListColumnsWithCaption != null)
            {
                foreach (DataColumn c in itemColumns)
                {
                    if (ItemListColumnsWithCaption.ContainsKey(c.ColumnName))
                    {
                        ColumnDetails cd = ItemListColumnsWithCaption[c.ColumnName];
                        c.Caption = string.IsNullOrEmpty(cd.ColumnCaption) ? c.ColumnName : cd.ColumnCaption;
                    }
                }
            }
        }

        protected virtual DataColumn[] ActivitiesSchema()
        {
            var cols = new[]
            {
                new DataColumn(INTERNAL_ID_COl_NAME, typeof (Int32)) { AllowDBNull = true, DefaultValue = 0 },
                new DataColumn(RESOURCE_TYPE_COL_NAME, typeof (String)) { AllowDBNull = false, DefaultValue = ACTIVITY_TYPE },
               // new DataColumn(&quot;Line No&quot;, typeof (Int32)) { AllowDBNull = true, DefaultValue = 0 },
                new DataColumn(&quot;Name&quot;, typeof (String))
                { AllowDBNull = false, DefaultValue = String.Empty },
                new DataColumn(&quot;Description&quot;, typeof (String)),
                new DataColumn(&quot;Unit&quot;, typeof (String))
                { AllowDBNull = false, DefaultValue = String.Empty },
                new DataColumn(&quot;Weightage&quot;, typeof (Decimal)) { AllowDBNull = false, DefaultValue = 0 },
                new DataColumn(&quot;Number&quot;, typeof (Decimal)) { DefaultValue = 0 },
                new DataColumn(&quot;Dimension 1&quot;, typeof (Decimal)) { DefaultValue = 0 },
                new DataColumn(&quot;Dimension 1 Unit&quot;, typeof (String)),
                new DataColumn(&quot;Dimension 2&quot;, typeof (Decimal)) { DefaultValue = 0 },
                new DataColumn(&quot;Dimension 2 Unit&quot;, typeof (String)),
                new DataColumn(&quot;Dimension 3&quot;, typeof (Decimal)) { DefaultValue = 0 },
                new DataColumn(&quot;Dimension 3 Unit&quot;, typeof (String)),
                new DataColumn(&quot;Quantity&quot;, typeof (Decimal)),
            };
            return cols;
        }

        //private DataColumn[] ComponentsSchema()
        //{
        //    var cols = new[]
        //    {
        //        new DataColumn(INTERNAL_ID_COl_NAME, typeof (Int32)) { AllowDBNull = true, DefaultValue = 0 },
        //        new DataColumn(RESOURCE_TYPE_COL_NAME, typeof (String)) { AllowDBNull = false, DefaultValue = COMPONENT_TYPE },
        //        new DataColumn(INDENT_LEVEL_COL_NAME, typeof (Int32)) { AllowDBNull = false, DefaultValue = 2 },
        //       // new DataColumn(&quot;Line No&quot;, typeof (Int32)) { AllowDBNull = true, DefaultValue = 0 },
        //        new DataColumn(&quot;Component Name&quot;, typeof (String))
        //        { AllowDBNull = false, DefaultValue = String.Empty },
        //        new DataColumn(&quot;Component Description&quot;, typeof (String))
        //        { AllowDBNull = false, DefaultValue = String.Empty },
        //    };
        //    return cols;
        //}

        protected DataColumn[] ResourcesSchema()
        {
            var cols = new[]
            {
                new DataColumn(INTERNAL_ID_COl_NAME, typeof (Int32)) { AllowDBNull = true, DefaultValue = 0 },
                new DataColumn(RESOURCE_TYPE_COL_NAME, typeof (String)) { AllowDBNull = false, DefaultValue = String.Empty },
                new DataColumn(INDENT_LEVEL_COL_NAME, typeof (Int32)) { AllowDBNull = false, DefaultValue = 2 },
               // new DataColumn(&quot;Line No&quot;, typeof (Int32)) { AllowDBNull = true, DefaultValue = 0 },
                new DataColumn(&quot;Description&quot;, typeof (String))
                { AllowDBNull = false, DefaultValue = String.Empty },
                new DataColumn(&quot;Unit&quot;, typeof (String))
                { AllowDBNull = false, DefaultValue = String.Empty },
                new DataColumn(&quot;Rate Per Unit&quot;, typeof (Decimal)) { AllowDBNull = false, DefaultValue = 0 }
                ,
                new DataColumn(&quot;Quantity&quot;, typeof (Decimal)) { AllowDBNull = false, DefaultValue = 0 },
                new DataColumn(&quot;Wastage Percent&quot;, typeof (Decimal))
                { AllowDBNull = false, DefaultValue = 0 },
                new DataColumn(&quot;Notes&quot;, typeof (String)),
                new DataColumn(&quot;IsCritical&quot;, typeof (String))
                { AllowDBNull = false, DefaultValue = &quot;N&quot; },
                new DataColumn(&quot;Resource ID&quot;, typeof (String))
                { AllowDBNull = false, DefaultValue = String.Empty },
            };
            return cols;
        }

        protected DataColumn[] MaterialSchema()
        {
            var cols = new[]
            {
                new DataColumn(INTERNAL_ID_COl_NAME, typeof (Int32)) { AllowDBNull = true, DefaultValue = 0 },
                new DataColumn(RESOURCE_TYPE_COL_NAME, typeof (String)) { AllowDBNull = false, DefaultValue = MATERIAL_TYPE },
                new DataColumn(INDENT_LEVEL_COL_NAME, typeof (Int32)) { AllowDBNull = false, DefaultValue = 2 },
               // new DataColumn(&quot;Line No&quot;, typeof (Int32)) { AllowDBNull = true, DefaultValue = 0 },
                new DataColumn(&quot;Description&quot;, typeof (String))
                { AllowDBNull = false, DefaultValue = String.Empty },
                new DataColumn(&quot;Unit&quot;, typeof (String))
                { AllowDBNull = false, DefaultValue = String.Empty },
                new DataColumn(&quot;Rate Per Unit&quot;, typeof (Decimal)) { AllowDBNull = false, DefaultValue = 0 }
                ,
                new DataColumn(&quot;Quantity&quot;, typeof (Decimal)) { AllowDBNull = false, DefaultValue = 0 },
                new DataColumn(&quot;Wastage Percent&quot;, typeof (Decimal))
                { AllowDBNull = false, DefaultValue = 0 },
                new DataColumn(&quot;Notes&quot;, typeof (String)),
                new DataColumn(&quot;IsCritical&quot;, typeof (String))
                { AllowDBNull = false, DefaultValue = &quot;N&quot; },
                new DataColumn(&quot;Resource ID&quot;, typeof (String))
                { AllowDBNull = false, DefaultValue = String.Empty },
                new DataColumn(&quot;Size&quot;, typeof (String))
                { AllowDBNull = true, DefaultValue = String.Empty },
                new DataColumn(&quot;Color&quot;, typeof (String))
                { AllowDBNull = true, DefaultValue = String.Empty },
                new DataColumn(&quot;Configuration&quot;, typeof (String))
                { AllowDBNull = true, DefaultValue = String.Empty }
            };
            return cols;
        }

        //protected DataColumn[] MiscSchema()
        //{
        //    var cols = new[]
        //    {
        //        new DataColumn(&quot;Line No&quot;, typeof (Int32)) { AllowDBNull = false, DefaultValue = 0 },
        //        new DataColumn(&quot;Description&quot;, typeof (String))
        //        { AllowDBNull = false, DefaultValue = String.Empty },
        //        new DataColumn(&quot;Unit&quot;, typeof (String))
        //        { AllowDBNull = false, DefaultValue = String.Empty },
        //        new DataColumn(&quot;Rate Per Unit&quot;, typeof (Decimal)) { AllowDBNull = false, DefaultValue = 0 }
        //        ,
        //        new DataColumn(&quot;Quantity&quot;, typeof (Decimal)) { AllowDBNull = false, DefaultValue = 0 },
        //        new DataColumn(&quot;Notes&quot;, typeof (String)),
        //        new DataColumn(&quot;IsCritical&quot;, typeof (String))
        //        { AllowDBNull = false, DefaultValue = String.Empty },
        //        new DataColumn(&quot;Resource ID&quot;, typeof (String))
        //        { AllowDBNull = false, DefaultValue = String.Empty },
        //    };
        //    return cols;
        //}

        public virtual DataColumn[] ContainersSchema()
        {
            var cols = new[]
            {
                new DataColumn(INTERNAL_ID_COl_NAME, typeof (Int32))
                { AllowDBNull = true, DefaultValue = 0 },
                  new DataColumn(ITEM_TYPE_COL_NAME, typeof (String))
                { AllowDBNull = false, DefaultValue =  String.Empty },
                   new DataColumn(INDENT_LEVEL_COL_NAME, typeof (Int32))
                { AllowDBNull = false, DefaultValue = 0 },
                //new DataColumn(&quot;Line No&quot;, typeof (Int32))
                //{ AllowDBNull = true},
                new DataColumn(&quot;Name&quot;, typeof (String))
                { AllowDBNull = false, DefaultValue = String.Empty },
                new DataColumn(&quot;Description&quot;, typeof (String))
                { AllowDBNull = true, DefaultValue = String.Empty },
                new DataColumn(&quot;Notes&quot;, typeof (String))
                { AllowDBNull = true, DefaultValue = String.Empty }
            };
            return cols;
        }

        private DataTable GetExpectedSchema(string type)
        {
            type = type.ToLower();
            if (SchemaDic.ContainsKey(type))
                return SchemaDic[type];
            else
                return null;
        }

        Dictionary&lt;string, DataTable&gt; schemaDic = null;

        private void LoadSchemas()
        {
            if (schemaDic == null)
            {
                schemaDic = new Dictionary&lt;string, DataTable&gt;();
                DataTable dt1 = new DataTable(&quot;container&quot;);
                dt1.Columns.AddRange(ContainersSchema());
                schemaDic.Add(dt1.TableName, dt1);

                DataTable dt2 = new DataTable(&quot;item&quot;);
                dt2.Columns.AddRange(ItemsSchema());
                schemaDic.Add(dt2.TableName, dt2);

                DataTable dt3 = new DataTable(&quot;subitem&quot;);
                dt3.Columns.AddRange(SubItemsSchema());
                schemaDic.Add(dt3.TableName, dt3);

                //DataTable dt4 = new DataTable(&quot;component&quot;);
                //dt4.Columns.AddRange(ComponentsSchema());
                //schemaDic.Add(dt4.TableName, dt4);

                DataTable dt5 = new DataTable(&quot;activity&quot;);
                dt5.Columns.AddRange(ActivitiesSchema());
                schemaDic.Add(dt5.TableName, dt5);

                DataTable dt6 = new DataTable(&quot;equipment&quot;);
                dt6.Columns.AddRange(MaterialSchema());
                // AddColumns(dt6, MaterialSchema());
                schemaDic.Add(dt6.TableName, dt6);

                DataTable dt7 = new DataTable(&quot;manpower&quot;);
                dt7.Columns.AddRange(ResourcesSchema());
                schemaDic.Add(dt7.TableName, dt7);

                DataTable dt8 = dt7.Clone();
                dt8.TableName = &quot;material&quot;;
                schemaDic.Add(dt8.TableName, dt8);

                DataTable dt9 = dt7.Clone();
                dt9.TableName = &quot;misc&quot;;
                schemaDic.Add(dt9.TableName, dt9);

                DataTable dt10 = dt7.Clone();
                dt10.TableName = &quot;subcontract&quot;;
                schemaDic.Add(dt10.TableName, dt10);

            }
        }


        public override void LocalizedImportDataColumns(ref DataSet ds)
        {
            DataSet importExportSchema = GetSchema(string.Empty);

            if (ds != null &amp;&amp; ds != null &amp;&amp; ds.Tables.Contains(SHEET_NAME)
                 &amp;&amp; importExportSchema != null &amp;&amp; importExportSchema.Tables.Contains(SHEET_NAME))
            {
                foreach (DataColumn c in ds.Tables[SHEET_NAME].Columns)
                {
                    if (importExportSchema.Tables[SHEET_NAME].Columns.Contains(c.ColumnName))
                    {
                        DataColumn col = importExportSchema.Tables[SHEET_NAME].Columns[c.ColumnName];
                        if (!string.IsNullOrEmpty(col.Caption) &amp;&amp; col.Caption != c.ColumnName)
                        {
                            string temp = string.Empty;
                            if (ds.Tables[SHEET_NAME].Columns.Contains(col.Caption))
                            {
                                int i = 0;
                                while (ds.Tables[SHEET_NAME].Columns.Contains(col.Caption + temp))
                                {
                                    i++;
                                    temp = &quot;(&quot; + i.ToString() + &quot;)&quot;;
                                }
                            }
                            c.ColumnName = col.Caption + temp;
                        }
                    }
                }
            }
        }


        protected Dictionary&lt;string, DataTable&gt; SchemaDic
        {
            get
            {
                if (schemaDic == null)
                    LoadSchemas();
                return schemaDic;
            }
        }

        protected override bool ValidateDataType(DataTable xlsTable, DataTable dtExpected, DataTable xlsErrorReportingTable)
        {
            bool IsValid = true;

            foreach (DataRow dr in xlsTable.Rows)
            {

                if ((dr[ITEM_TYPE_COL_NAME] == DBNull.Value) ||
                    string.IsNullOrEmpty(Convert.ToString(dr[ITEM_TYPE_COL_NAME], CultureInfo.CurrentCulture)))
                {
                    IsValid = false;
                    xlsErrorReportingTable.Rows[xlsTable.Rows.IndexOf(dr)][ITEM_TYPE_COL_NAME]
                        = ErrorIndicator + &quot; Please Enter Value&quot;;
                    continue;
                }
                else
                {
                    dr[ITEM_TYPE_COL_NAME] = GetGeneralResourceName(dr[ITEM_TYPE_COL_NAME].ToString());

                    DataTable expectedSchema = GetExpectedSchema(dr[ITEM_TYPE_COL_NAME].ToString());

                    if (expectedSchema == null)
                    {
                        IsValid = false;
                        xlsErrorReportingTable.Rows[xlsTable.Rows.IndexOf(dr)][ITEM_TYPE_COL_NAME]
                            = ErrorIndicator + &quot; Invalid Value&quot;;
                        continue;
                    }

                    foreach (DataColumn dc in expectedSchema.Columns)
                    {
                        //Note:The validation order shouldn&#39;t be changed.
                        try
                        {
                            //This is valid entry
                            if (dc.AllowDBNull &amp;&amp;
                                ((dr[dc.ColumnName] == DBNull.Value) ||
                                 string.IsNullOrEmpty(Convert.ToString(dr[dc.ColumnName], CultureInfo.CurrentCulture))))
                            {
                                continue;
                            }

                            //Check for null or empty string.
                            if (!dc.AllowDBNull &amp;&amp;
                                ((dr[dc.ColumnName] == DBNull.Value) ||
                                 string.IsNullOrEmpty(Convert.ToString(dr[dc.ColumnName], CultureInfo.CurrentCulture))))
                            {
                                throw new ArgumentNullException();
                            }

                            //Already error is reported.
                            if (dr[dc.ColumnName].ToString2().Contains(ErrorIndicator))
                            {
                                IsValid = false;
                                continue;
                            }
                            //Check datatype
                            Convert.ChangeType(dr[dc.ColumnName], dc.DataType, CultureInfo.CurrentCulture);
                        }
                        catch (InvalidCastException)
                        {
                            IsValid = false;
                            xlsErrorReportingTable.Rows[xlsTable.Rows.IndexOf(dr)][dc.ColumnName]
                                = ErrorIndicator + dr[dc.ColumnName].ToString2() +
                                  &quot; - is an invalid data. Please enter proper value.&quot;;
                        }
                        catch (ArgumentNullException)
                        {
                            IsValid = false;
                            xlsErrorReportingTable.Rows[xlsTable.Rows.IndexOf(dr)][dc.ColumnName]
                                = ErrorIndicator + &quot; Please Enter Value&quot;;
                        }
                        catch
                        {
                            IsValid = false;
                            xlsErrorReportingTable.Rows[xlsTable.Rows.IndexOf(dr)][dc.ColumnName]
                                = ErrorIndicator + dr[dc.ColumnName].ToString2() +
                                  &quot; - is an invalid data. Please enter proper value.&quot;;
                        }
                    }
                }
            }

            return IsValid;
        }

        public override void StandardizedImportData(string sheetName, ref DataTable dt)
        {
            DataTable importExportSchema = GetSchema(string.Empty).Tables[sheetName];

            DataTable stdDt = importExportSchema.Copy();

            Dictionary&lt;string, string&gt; dic = new Dictionary&lt;string, string&gt;();
            foreach (DataColumn c in stdDt.Columns)
            {
                if (importExportSchema.Columns.Contains(c.ColumnName))
                {
                    DataColumn col = importExportSchema.Columns[c.ColumnName];
                    if (!string.IsNullOrEmpty(col.Caption) &amp;&amp; col.Caption != c.ColumnName)
                    {
                        string temp = string.Empty;
                        if (stdDt.Columns.Contains(col.Caption))
                        {
                            int i = 0;
                            while (stdDt.Columns.Contains(col.Caption + temp))
                            {
                                i++;
                                temp = &quot;(&quot; + i.ToString() + &quot;)&quot;;
                            }
                        }
                        dic.Add(col.Caption + temp, c.ColumnName);
                        c.ColumnName = col.Caption + temp;
                    }
                    else
                    {
                        dic.Add(c.ColumnName, c.ColumnName);
                    }
                }
            }

            foreach (DataColumn c in dt.Columns)
            {
                if (dic.ContainsKey(c.ColumnName))
                    c.ColumnName = dic[c.ColumnName];
            }
        }

        /// &lt;summary&gt;
        /// Convert the source datatype to destination datatype while copying.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;source&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;destination&quot;&gt;&lt;/param&gt;
        protected override void CopyData(DataTable source, ref DataTable destination)
        {
            DataTable injectionDT = null;
            if (HasXMLInjectionFields)
            {
                injectionDT = new DataTable();
                foreach (DataColumn c in XmlInjectionItemsSchema())
                {
                    DataColumn newCol = new DataColumn(c.ColumnName, c.DataType);
                    newCol.Caption = c.Caption;
                    injectionDT.Columns.Add(newCol);
                }
            }

            for (int row = 0; row &lt; source.Rows.Count; row++)
            {
                DataRow dr = destination.NewRow();
                foreach (DataColumn dc in destination.Columns)
                {

                    if (GetExpectedSchema(source.Rows[row][RESOURCE_TYPE_COL_NAME].ToString()).Columns.Contains(dc.ColumnName))
                    {
                        // Let&#39;s not encode the data while saving to database.
                        // we should take the raw data to database as is and this should be handled while rendering on screen only when required in certain places. 
                        dr[dc.ColumnName] = Convert.ChangeType(source.Rows[row][dc.ColumnName],
                        destination.Columns[dc.ColumnName].DataType, CultureInfo.CurrentCulture);
                    }
                    else if (injectionDT != null &amp;&amp; (source.Rows[row][RESOURCE_TYPE_COL_NAME].ToString().ToLower() == &quot;item&quot;)
                        &amp;&amp; XMLInjectionDisplayVsColumnsName.ContainsKey(dc.ColumnName)
                        &amp;&amp; injectionDT.Columns.Contains(XMLInjectionDisplayVsColumnsName[dc.ColumnName]))
                    {
                        dr[dc.ColumnName] = Convert.ChangeType(source.Rows[row][dc.ColumnName],
                          destination.Columns[dc.ColumnName].DataType, CultureInfo.CurrentCulture);

                    }
                }
                destination.Rows.Add(dr);
            }
        }

        protected virtual DataColumn[] SubItemsSchema()
        {
            List&lt;DataColumn&gt; cols = new List&lt;DataColumn&gt;
            {

                new DataColumn(INTERNAL_ID_COl_NAME, typeof (Int32)) { AllowDBNull = true, DefaultValue = 0 },
                new DataColumn(ITEM_TYPE_COL_NAME, typeof (String)) { AllowDBNull = false, DefaultValue = string.Empty },
                new DataColumn(INDENT_LEVEL_COL_NAME, typeof (Int32)) { AllowDBNull = false, DefaultValue = 2 },
                //new DataColumn(&quot;Line No&quot;, typeof (Int32)) { AllowDBNull = true, DefaultValue = 0 },
                new DataColumn(&quot;Description&quot;, typeof (String)){ AllowDBNull = false },
                new DataColumn(&quot;Attribute Value&quot;, typeof (String)){ Caption = &quot;Attribute&quot;},
            };

            //List&lt;string&gt; CoreComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);

            if (CoreComponents.Contains(&quot;ItemNumber&quot;))
                cols.Add(new DataColumn(&quot;Number&quot;, typeof(Decimal)) { DefaultValue = 0 });

            if (CoreComponents.Contains(&quot;ItemDimension1&quot;))
                cols.Add(new DataColumn(&quot;Dimension 1&quot;, typeof(Decimal)) { DefaultValue = 0 });

            if (CoreComponents.Contains(&quot;ItemDimension1&quot;))
                cols.Add(new DataColumn(&quot;Dimension 1 Unit&quot;, typeof(String)));

            if (CoreComponents.Contains(&quot;ItemDimension2&quot;))
                cols.Add(new DataColumn(&quot;Dimension 2&quot;, typeof(Decimal)) { DefaultValue = 0 });

            if (CoreComponents.Contains(&quot;ItemDimension2&quot;))
                cols.Add(new DataColumn(&quot;Dimension 2 Unit&quot;, typeof(String)));

            if (CoreComponents.Contains(&quot;ItemDimension3&quot;))
                cols.Add(new DataColumn(&quot;Dimension 3&quot;, typeof(Decimal)) { DefaultValue = 0 });

            if (CoreComponents.Contains(&quot;ItemDimension3&quot;))
                cols.Add(new DataColumn(&quot;Dimension 3 Unit&quot;, typeof(String)));

            cols.Add(new DataColumn(&quot;Quantity&quot;, typeof(Decimal)) { DefaultValue = 0 });
            cols.Add(new DataColumn(&quot;Notes&quot;, typeof(String)));

            return cols.ToArray();
        }

        protected string SerializeList(List&lt;ContainerDTO&gt; list)
        {
            try
            {
                var memStrm = new MemoryStream();
                var xmlSink = new XmlTextWriter(memStrm, Encoding.Unicode);
                var xmlSer = new XmlSerializer(list.GetType());
                xmlSer.Serialize(xmlSink, list);
                memStrm.Position = 0;
                var sRead = new StreamReader(memStrm);
                return sRead.ReadToEnd();
            }
            catch (Exception ex)
            {
                throw ex;
            }
        }

        protected virtual void SetSubItemInformation(DataSet dsResults, DataSet spResults)
        {
            foreach (DataRow dr in spResults.Tables[6].Rows)
            {
                dsResults.Tables[&quot;SubItems&quot;].Rows.Add(Convert.ToInt32(dr[0], CultureInfo.CurrentCulture),
                    dr[1].ToString2(), dr[2].ToString2(), dr[3].ToString2(),
                    dr[4].ToString2());
            }
        }

        protected virtual void HandleModuleSpecificLogicForGetResult(int ParentInstanceID, DataTable Table,
            List&lt;ContainerDTO&gt; list,
            List&lt;ContainerDTO&gt; nextlist, DataSet dsResults,
            ref int ContainerCount, ref bool ClearExcel)
        {
            //Need not loop at different levels and import, instead the entire container xml is sent to database
            //and is imported.
            ItemManager.Instance.ImportContainers(ClearExcel, ModuleId, ParentInstanceID, SerializeList(nextlist));
            list.Clear();
        }

        #endregion

        #region Private methods&quot;

        private void GetValidAXResources(DataTable dtItemsSet, DataTable dtAXItems, DataTable dtResults,
            string columnName, string excelColumnName)
        {
            try
            {
                int nRowCount = dtItemsSet.Rows.Count;
                if (dtItemsSet.Columns.Contains(excelColumnName))
                {
                    for (int iLC = 0; iLC &lt; nRowCount; iLC++)
                    {
                        if (!string.IsNullOrEmpty(dtItemsSet.Rows[iLC][&quot;Line No&quot;].ToString2()))
                        {
                            DataRow[] drAXItems =
                                dtAXItems.Select(columnName + &quot;=&#39;&quot; + dtItemsSet.Rows[iLC][excelColumnName] + &quot;&#39;&quot;);
                            if (drAXItems.Length == 0)
                            {
                                dtResults.Rows.Add(
                                    Convert.ToInt32(dtItemsSet.Rows[iLC][&quot;Line No&quot;], CultureInfo.CurrentCulture),
                                    dtItemsSet.Rows[iLC][&quot;Description&quot;].ToString2(),
                                    dtItemsSet.Rows[iLC][excelColumnName].ToString2(), &quot;This is not an AX &quot; + columnName,
                                    &quot;Use a valid AX &quot; + columnName + &quot; or add this &quot; + columnName + &quot; to AX &quot;);
                                dtItemsSet.Rows.RemoveAt(iLC);
                                nRowCount--;
                                iLC--;
                            }
                            else
                            {
                                if (columnName.Equals(&quot;ParentResItemID&quot;))
                                {
                                    dtItemsSet.Rows[iLC][&quot;Unit&quot;] = drAXItems[0][&quot;Unit&quot;];
                                    dtItemsSet.Rows[iLC][&quot;Description&quot;] = drAXItems[0][&quot;Description&quot;];
                                }
                                if (columnName.Equals(&quot;Unit&quot;))
                                {
                                    dtItemsSet.Rows[iLC][excelColumnName] = drAXItems[0][columnName];
                                }
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
        }

        private void GetValidAXResources(DataTable dtOriginal, DataTable dtValidate, DataTable dtAXItems,
            string columnName, string excelColumnName, out bool HasError,
            string additionalInfo)
        {
            HasError = false;
            var dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
            dictAdditionalInfo.Add(RegisteredEIS.AX,
                new EISAdditionalInfo(RegisteredEIS.AX).AddInfo(&quot;AXCompany&quot;, additionalInfo));
            ConnectorParameters conParameters = null;
            int count = 0;
            var dsData = new DataSet();
            string errorMessageFromAX = &quot;&quot;;
            bool status = false;
            try
            {
                int nRowCount = dtValidate.Rows.Count;
                if (dtValidate.Columns.Contains(excelColumnName))
                {
                    for (int iLC = 0; iLC &lt; nRowCount; iLC++)
                    {
                        if (!string.IsNullOrEmpty(dtValidate.Rows[iLC][&quot;Line No&quot;].ToString2()))
                        {
                            if (!columnName.Equals(&quot;Size&quot;))
                            {
                                DataRow[] drAXItems =
                                    dtAXItems.Select(columnName + &quot;=&#39;&quot; + dtValidate.Rows[iLC][excelColumnName] + &quot;&#39;&quot;);
                                if (drAXItems.Length == 0)
                                {
                                    HasError = true;
                                    if (
                                        !Convert.ToString(dtValidate.Rows[iLC][excelColumnName],
                                            CultureInfo.CurrentCulture).Contains(ErrorIndicator))
                                        dtValidate.Rows[iLC][excelColumnName] = ErrorIndicator +
                                                                                dtValidate.Rows[iLC][excelColumnName] +
                                                                                &quot; - This is not an AX &quot; + columnName +
                                                                                &quot;Use a valid AX &quot; + columnName +
                                                                                &quot; or add this &quot; + columnName + &quot; to AX &quot;;
                                }
                                else
                                {
                                    if (columnName.Equals(&quot;ParentResItemID&quot;))
                                    {
                                        if (
                                            !Convert.ToString(dtValidate.Rows[iLC][&quot;Unit&quot;], CultureInfo.CurrentCulture).
                                                Contains(ErrorIndicator))
                                            dtOriginal.Rows[iLC][&quot;Unit&quot;] =
                                                dtValidate.Rows[iLC][&quot;Unit&quot;] = drAXItems[0][&quot;Unit&quot;];
                                        if (
                                            !Convert.ToString(dtValidate.Rows[iLC][&quot;Description&quot;],
                                                CultureInfo.CurrentCulture).Contains(ErrorIndicator))
                                            dtOriginal.Rows[iLC][&quot;Description&quot;] =
                                                dtValidate.Rows[iLC][&quot;Description&quot;] = drAXItems[0][&quot;Description&quot;];
                                        if (
                                            !Convert.ToString(dtValidate.Rows[iLC][&quot;Resource ID&quot;],
                                                CultureInfo.CurrentCulture).Contains(ErrorIndicator))
                                            dtOriginal.Rows[iLC][&quot;Resource ID&quot;] =
                                                dtValidate.Rows[iLC][&quot;Resource ID&quot;] = drAXItems[0][&quot;ParentResItemID&quot;];
                                    }
                                    if (columnName.Equals(&quot;Unit&quot;))
                                    {
                                        if (
                                            !Convert.ToString(dtValidate.Rows[iLC][excelColumnName],
                                                CultureInfo.CurrentCulture).Contains(ErrorIndicator))
                                            dtOriginal.Rows[iLC][excelColumnName] =
                                                dtValidate.Rows[iLC][excelColumnName] = drAXItems[0][columnName];
                                    }
                                }
                            }
                            else
                            {
                                ////TO CHECK IF THE MATERIAL HIERARCHY IS VALID IN AX
                                if (
                                    !(string.IsNullOrEmpty(dtOriginal.Rows[iLC][&quot;Size&quot;].ToString()) &amp;&amp;
                                      string.IsNullOrEmpty(dtOriginal.Rows[iLC][&quot;Color&quot;].ToString()) &amp;&amp;
                                      string.IsNullOrEmpty(dtOriginal.Rows[iLC][&quot;Configuration&quot;].ToString())))
                                {
                                    string xmlFilter =
                                        String.Format(
                                            &quot;&lt;XMLRoot&gt;&lt;ItemId type=&#39;txt&#39;&gt;{0}&lt;/ItemId&gt;&lt;Size type=&#39;txt&#39;&gt;{1}&lt;/Size&gt;&lt;Color type=&#39;txt&#39;&gt;{2}&lt;/Color&gt;&lt;Configuration type=&#39;txt&#39;&gt;{3}&lt;/Configuration&gt;&lt;/XMLRoot&gt;&quot;,
                                            dtOriginal.Rows[iLC][&quot;Resource ID&quot;], dtOriginal.Rows[iLC][&quot;Size&quot;],
                                            dtOriginal.Rows[iLC][&quot;Color&quot;], dtOriginal.Rows[iLC][&quot;Configuration&quot;]);
                                    conParameters = new ConnectorParameters(dictAdditionalInfo,
                                        MethodBase.GetCurrentMethod(),
                                        AMP3ObjectType.Unknown,
                                        new ConnectionFilter(xmlFilter, null, null,
                                            null, null), null);

                                    bool isSuccess = IntegrationConnectorManager.HandleIntegration(conParameters,
                                        ref count, ref dsData,
                                        true);

                                    if (isSuccess &amp;&amp; dsData.Tables.Count &gt; 0 &amp;&amp; dsData.Tables[0].Rows.Count &gt; 0)
                                    {
                                        status = Convert.ToBoolean(dsData.Tables[0].Rows[0][&quot;Status&quot;]);
                                        errorMessageFromAX = dsData.Tables[0].Rows[0][&quot;ErrorMessage&quot;].ToString();
                                    }
                                    if (!status &amp;&amp;
                                        !Convert.ToString(dtValidate.Rows[iLC][&quot;Size&quot;], CultureInfo.CurrentCulture).
                                            Contains(ErrorIndicator))
                                    {
                                        HasError = true;
                                        dtValidate.Rows[iLC][excelColumnName] = ErrorIndicator + errorMessageFromAX;
                                    }
                                }
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
        }

        private void GetValidAXResourcesInRow(DataRow dr, DataTable dtAXItems, string columnName, string excelColumnName,
            ref bool HasError)
        {
            try
            {
                if (!string.IsNullOrEmpty(dr[&quot;Line No&quot;].ToString2()))
                {
                    DataRow[] drAXItems = dtAXItems.Select(columnName + &quot;=&#39;&quot; + dr[excelColumnName] + &quot;&#39;&quot;);
                    if (drAXItems.Length == 0)
                    {
                        HasError = true;
                        if (!Convert.ToString(dr[excelColumnName], CultureInfo.CurrentCulture).Contains(ErrorIndicator))
                            dr[excelColumnName] = ErrorIndicator + dr[excelColumnName] + &quot; - This is not an AX &quot; +
                                                  columnName + &quot;Use a valid AX &quot; + columnName + &quot; or add this &quot; +
                                                  columnName + &quot; to AX &quot;;
                    }
                    else
                    {
                        if (columnName.Equals(&quot;ParentResItemID&quot;))
                        {
                            if (!Convert.ToString(dr[&quot;Unit&quot;], CultureInfo.CurrentCulture).Contains(ErrorIndicator))
                                dr[&quot;Unit&quot;] = drAXItems[0][&quot;Unit&quot;];
                            if (
                                !Convert.ToString(dr[&quot;Description&quot;], CultureInfo.CurrentCulture)
                                    .Contains(ErrorIndicator))
                                dr[&quot;Description&quot;] = drAXItems[0][&quot;Description&quot;];
                        }
                        if (columnName.Equals(&quot;Unit&quot;))
                        {
                            if (
                                !Convert.ToString(dr[excelColumnName], CultureInfo.CurrentCulture).Contains(
                                    ErrorIndicator))
                                dr[excelColumnName] = drAXItems[0][columnName];
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
        }

        #endregion

        #region &quot;Methods to support XML Injection for Items Import&quot;

        private BrixFormModel xmlInjectionForm = null;

        public BrixFormModel XmlInjectionForm
        {
            get
            {
                return xmlInjectionForm;
            }
        }        

        public virtual string ParentPageURL
        {
            get
            {
                return &quot;/Common/BrixItemPage.aspx&quot;;
            }
        }

        protected virtual BrixFormModel GetXmlInjection()
        {
            BrixFormModel xmlInjection = null;
            DataSet ds = ComponentHelper.Instance.ExecuteDataSet(StoredProcedure.usp_MODMGMTGetXmlControls, null, ParentPageURL);

            string xmlName = string.Empty;
            foreach (DataRow dr in ds.Tables[0].Rows)
            {
                if (dr[&quot;ParentPageURl&quot;].ToString().Contains(ParentPageURL))
                {
                    xmlName = dr[&quot;Name&quot;].ToString();
                    xmlInjection = BrixFormModel.GetInstance(xmlName, xmlName, HttpContext.Current.Request, HttpContext.Current.Response, &quot;Control&quot;);
                    if (xmlInjection.form != null &amp;&amp; xmlInjection.form.GetType() == typeof(XMLControl) &amp;&amp; xmlInjection.form.ParentModuleID == ModuleId)  // TO support multiple Xml Controls
                        break;
                    else
                        xmlInjection = null;
                }
            }


            return xmlInjection;
        }

        List&lt;DataColumn&gt; _XmlInjectionItemsSchema = null;

        protected virtual DataColumn[] XmlInjectionItemsSchema()
        {
            if (_XmlInjectionItemsSchema == null)
            {
                _XmlInjectionItemsSchema = new List&lt;DataColumn&gt;();
                if (XmlInjectionForm != null)
                {
                    DataSet ds = XmlInjectionForm.form.GetSchema(true);
                    if (ds != null &amp;&amp; ds.Tables.Count &gt; 0)
                    {
                        foreach (DataColumn c in ds.Tables[0].Columns)
                        {
                            if (c.ColumnName.ToLower2() != &quot;recordid&quot;)
                                _XmlInjectionItemsSchema.Add(new DataColumn(c.ColumnName, c.DataType) { AllowDBNull = c.AllowDBNull, Caption = c.Caption, DefaultValue = c.DefaultValue });
                        }
                    }
                }
            }

            return _XmlInjectionItemsSchema.ToArray();
        }

        public virtual DataTable GetXMLInjectionExportListData(string jointColumn)
        {
            if (!HasXMLInjectionFields)
                return null;

            int count = 0;
            Dictionary&lt;string, string&gt; dicFilters = null;

            List&lt;xControl&gt; filters = XmlInjectionForm.form.GetForeignKeyControls();
            if (filters.Count &gt; 0)
            {
                dicFilters = new Dictionary&lt;string, string&gt;();
                foreach (xControl filterControl in filters)
                    dicFilters.Add(filterControl.Name, filterControl.EvaluateControlValue());
            }
            UserDetail ud = UserDetail.GetCurrentUserDetail();

           
            DataSet ds = new DataSet();
            string sortBy = XmlInjectionForm.form.PrimaryKeyName + &quot; DESC &quot;;
            
            int currentPage = 0;
            string tableName = XmlInjectionForm.form.TableName;

                ds = CoreDatabaseHelper.GetODSData(XmlInjectionForm.form.TableName, 0, sortBy, string.Empty,false,
                    ref currentPage, out count, dicFilters, ud.RID, ud.UID, null,
                    false, XmlInjectionForm.form.Name, XmlInjectionForm.form.PrimaryKeyName, null,
                    (XmlInjectionForm.form.RequestParameters.ContainsKey(&quot;pid&quot;) ? XmlInjectionForm.form.RequestParameters[&quot;pid&quot;].ToInt32_2() : 0));
           
            ds = GenericXMLListModel.ManageDropDownListItems(ds, XmlInjectionForm);


            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0 &amp;&amp; !string.IsNullOrEmpty(((XMLControl)XmlInjectionForm.form).ForeignKeyColumnName))
            {
                DataTable dt = ds.Tables[0];
                List&lt;string&gt; colsToRemove = new List&lt;string&gt;();
                string fkName = ((XMLControl)XmlInjectionForm.form).ForeignKeyColumnName;
               foreach (DataColumn c in dt.Columns)
                {
                    if (c.ColumnName == fkName)
                        continue;
                    else
                    {
                       xControl ctrl= XmlInjectionForm.form.GetControl(c.ColumnName);
                        if (ctrl != null &amp;&amp; XMLInjectionColumnsNameVsDisplay.ContainsKey(ctrl.Caption))
                                c.ColumnName = c.Caption = XMLInjectionColumnsNameVsDisplay[ctrl.Caption];
                        else
                            colsToRemove.Add(c.ColumnName);
                    }
                }

                foreach (string colName in colsToRemove)
                    dt.Columns.Remove(colName);

                if (dt.Columns.Contains(fkName))
                {
                    dt.Columns[fkName].ColumnName = jointColumn;
                }
                return dt;
            }

            return null;
        }
      
        #endregion
    }

    [Serializable]
    public class ContainerDTO
    {
        private int _ParentContainerLineNo;
        private int _containerLineNo;
        private string _containerName;
        private int _internalID;

        public int InternalID
        {
            get { return _internalID; }
            set { _internalID = value; }
        } 
        public int ParentContainerLineNo
        {
            get { return _ParentContainerLineNo; }
            set { _ParentContainerLineNo = value; }
        }

        public int ContainerLineNo
        {
            get { return _containerLineNo; }
            set { _containerLineNo = value; }
        }

        public string Name
        {
            get { return _containerName; }
            set { _containerName = value; }
        }

        public string Description { get; set; }
        public string Notes { get; set; }
        public string AdditiveNo { get; set; }

    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[33,9,33,58,1],[34,9,34,67,1],[35,9,35,66,1],[36,9,36,64,1],[37,9,37,53,1],[38,9,38,61,1],[39,9,39,71,1],[40,9,40,62,1],[41,9,41,88,1],[42,9,42,74,1],[43,9,43,75,1],[44,9,44,55,1],[45,9,45,78,1],[46,9,46,61,1],[47,9,47,57,1],[48,9,48,73,1],[49,9,49,66,1],[50,9,50,61,1],[52,9,52,63,1],[53,9,53,80,1],[54,9,54,84,1],[55,9,55,90,1],[56,9,56,72,1],[78,9,78,77,1],[80,9,80,77,1],[85,13,85,14,1],[86,17,86,48,1],[87,17,87,18,1],[88,21,88,75,1],[90,21,90,111,1],[91,21,91,118,1],[92,21,92,120,1],[93,21,93,119,1],[94,21,94,110,1],[95,17,95,18,1],[96,17,96,43,1],[97,13,97,14,1],[103,13,103,14,0],[104,17,104,48,0],[105,17,105,18,0],[106,21,106,75,0],[108,21,108,111,0],[109,21,109,118,0],[110,21,110,120,0],[111,21,111,119,0],[112,21,112,110,0],[113,17,113,18,0],[114,17,114,43,0],[115,13,115,14,0],[119,9,119,55,1],[120,9,120,42,1],[124,13,124,14,1],[126,17,126,40,1],[127,17,127,18,1],[128,21,128,117,1],[129,21,129,53,1],[130,21,130,49,1],[131,21,131,95,1],[133,21,133,61,1],[134,21,134,22,1],[135,25,135,51,1],[136,21,136,22,1],[138,21,138,63,1],[139,21,139,22,0],[140,25,140,54,0],[141,21,141,22,0],[148,21,148,65,1],[149,21,149,22,0],[150,25,150,102,0],[151,25,151,103,0],[152,25,152,103,0],[153,25,153,98,0],[154,21,154,22,0],[155,17,155,18,1],[156,17,156,35,1],[157,13,157,14,1],[163,13,163,14,0],[165,17,165,18,0],[166,21,166,95,0],[167,25,167,120,0],[169,25,169,34,0],[171,17,171,22,0],[171,23,171,24,0],[171,25,171,26,0],[172,17,172,26,0],[173,13,173,14,0],[177,9,177,10,1],[178,13,178,66,1],[179,13,179,68,1],[180,17,180,63,1],[182,13,182,33,1],[183,9,183,10,1],[186,9,186,10,0],[187,13,187,61,0],[188,17,188,56,0],[190,13,190,33,0],[191,9,191,10,0],[193,9,193,114,1],[195,50,195,51,1],[195,52,195,75,1],[195,76,195,77,1],[199,9,199,10,0],[200,13,200,80,0],[204,9,204,10,1],[205,13,205,47,1],[206,13,206,14,1],[207,17,207,24,1],[207,26,207,40,1],[207,41,207,43,1],[207,44,207,51,1],[208,17,208,18,1],[209,21,209,62,1],[210,21,210,22,1],[211,25,211,45,1],[212,21,212,22,1],[213,26,213,88,1],[214,21,214,22,1],[215,25,215,74,1],[216,21,216,22,1],[217,17,217,18,1],[218,13,218,14,1],[219,9,219,10,1],[222,9,222,10,0],[223,13,223,33,0],[224,13,224,74,0],[225,13,225,44,0],[226,13,226,20,0],[226,22,226,32,0],[226,33,226,35,0],[226,36,226,43,0],[227,17,227,51,0],[229,13,229,20,0],[229,22,229,40,0],[229,41,229,43,0],[229,44,229,57,0],[230,13,230,14,0],[231,17,231,168,0],[232,17,232,18,0],[233,21,234,103,0],[235,21,235,48,0],[236,17,236,18,0],[237,13,237,14,0],[238,13,238,28,0],[239,9,239,10,0],[241,9,241,29,1],[242,9,242,10,1],[243,13,243,50,1],[244,9,244,10,1],[246,9,246,41,1],[249,9,249,10,1],[250,13,250,34,1],[251,13,251,14,1],[252,17,252,55,1],[253,17,253,46,1],[255,17,255,57,1],[256,17,256,55,1],[259,17,259,56,1],[262,17,262,134,1],[263,17,263,18,1],[264,21,264,57,1],[265,17,265,18,1],[295,17,295,59,1],[296,17,296,18,0],[297,21,297,59,0],[298,17,298,18,0],[305,17,305,61,1],[306,17,306,18,0],[307,21,307,58,0],[308,21,308,57,0],[309,17,309,18,0],[313,17,313,86,1],[314,17,314,86,1],[316,17,316,24,1],[316,26,316,38,0],[316,39,316,41,1],[316,42,316,67,1],[317,17,317,18,0],[318,21,318,48,0],[319,21,319,62,0],[320,21,320,22,0],[321,25,321,35,0],[322,25,322,76,0],[323,25,323,26,0],[324,29,324,33,0],[325,29,325,61,0],[326,25,326,26,0],[327,21,327,22,0],[328,21,328,94,0],[329,21,329,94,0],[330,21,330,89,0],[331,21,331,47,0],[332,17,332,18,0],[334,17,334,48,1],[335,13,335,14,1],[337,13,337,29,1],[338,9,338,10,1],[341,9,341,10,0],[342,13,342,80,0],[346,9,346,10,0],[347,13,347,38,0],[348,9,348,10,0],[351,9,351,10,0],[352,13,352,50,0],[353,13,353,49,0],[354,13,354,34,0],[355,13,355,25,0],[356,9,356,10,0],[359,9,359,75,1],[361,9,361,85,1],[363,9,363,85,1],[368,13,368,14,0],[369,17,369,63,0],[370,21,370,35,0],[371,17,371,58,0],[372,13,372,14,0],[378,13,378,14,0],[379,17,379,63,0],[380,21,380,35,0],[381,17,381,58,0],[382,13,382,14,0],[388,13,388,14,0],[389,17,389,46,0],[390,17,390,18,0],[391,21,394,107,0],[396,21,396,43,0],[397,25,397,164,0],[399,21,399,43,0],[400,21,400,22,0],[401,25,401,82,0],[402,25,402,58,0],[403,29,403,63,0],[404,25,404,32,0],[404,34,404,63,0],[404,64,404,66,0],[404,67,404,72,0],[405,29,405,131,0],[407,25,407,47,0],[408,25,411,86,0],[413,25,413,62,0],[414,25,414,32,0],[414,34,414,58,0],[414,59,414,61,0],[414,62,414,67,0],[415,29,415,77,0],[416,33,423,40,0],[427,21,427,22,0],[429,21,429,22,0],[430,25,430,84,0],[431,21,431,22,0],[432,17,432,18,0],[433,17,433,41,0],[434,13,434,14,0],[439,9,439,10,0],[441,13,441,130,0],[442,9,442,10,0],[445,9,445,10,0],[446,13,446,20,0],[446,22,446,35,0],[446,36,446,38,0],[446,39,446,52,0],[447,17,447,64,0],[448,13,448,49,0],[449,13,449,53,0],[451,13,451,52,0],[455,13,455,36,0],[456,13,456,31,0],[457,13,457,85,0],[458,13,458,20,0],[458,22,458,32,0],[458,33,458,35,0],[458,36,458,46,0],[459,13,459,14,0],[460,17,462,110,0],[464,17,464,88,0],[465,17,465,18,0],[466,21,466,50,0],[468,21,468,109,0],[469,25,469,106,0],[471,21,472,53,0],[473,21,473,62,0],[474,21,474,69,0],[475,21,475,57,0],[476,21,476,110,0],[477,21,477,56,0],[478,21,478,22,0],[479,25,479,43,0],[480,25,480,42,0],[481,21,481,22,0],[482,17,482,18,0],[484,17,484,18,0],[485,21,492,64,0],[493,17,493,18,0],[494,13,494,14,0],[496,13,496,60,0],[500,13,500,55,0],[501,17,501,53,0],[503,13,503,76,0],[505,13,505,50,0],[506,17,506,48,0],[508,13,508,68,0],[510,13,510,50,0],[512,13,512,49,0],[513,13,513,45,0],[514,13,514,44,0],[520,13,520,52,0],[521,13,521,52,0],[522,13,522,47,0],[524,13,524,54,0],[525,13,525,52,0],[526,13,526,49,0],[528,13,528,51,0],[529,13,529,46,0],[530,13,530,46,0],[532,13,532,53,0],[533,13,533,50,0],[534,13,534,48,0],[536,13,536,49,0],[537,13,537,42,0],[538,13,538,44,0],[540,13,540,56,0],[541,13,541,56,0],[542,13,542,51,0],[544,13,544,20,0],[544,22,544,33,0],[544,34,544,36,0],[544,37,544,47,0],[545,13,545,14,0],[546,17,546,81,0],[548,17,548,36,0],[549,21,549,46,0],[552,17,552,39,0],[553,21,553,49,0],[554,17,554,41,0],[555,21,555,51,0],[556,17,556,40,0],[557,21,557,48,0],[558,17,558,40,0],[559,21,559,50,0],[560,17,560,36,0],[561,21,561,46,0],[562,17,562,43,0],[563,21,563,53,0],[564,13,564,14,0],[566,13,566,95,0],[567,13,567,51,0],[568,17,568,72,0],[570,13,570,82,0],[571,13,571,50,0],[572,17,572,61,0],[574,13,574,108,0],[575,13,575,55,0],[576,17,576,76,0],[579,13,579,46,0],[581,13,581,20,0],[581,22,581,33,0],[581,34,581,36,0],[581,37,581,52,0],[582,17,582,24,0],[582,26,582,39,0],[582,40,582,42,0],[582,43,582,52,0],[583,21,583,68,0],[585,13,585,46,0],[586,13,586,40,0],[587,13,587,34,0],[588,13,588,69,0],[591,13,591,136,0],[593,13,593,30,0],[594,9,594,10,0],[598,9,598,10,0],[599,13,599,53,0],[601,13,601,20,0],[601,22,601,35,0],[601,36,601,38,0],[601,39,601,52,0],[602,17,602,64,0],[603,13,603,49,0],[604,13,604,53,0],[606,13,606,52,0],[611,13,611,14,0],[614,17,614,40,0],[615,17,615,35,0],[616,17,616,89,0],[617,17,617,24,0],[617,26,617,36,0],[617,37,617,39,0],[617,40,617,50,0],[618,17,618,18,0],[619,21,619,89,0],[620,21,620,22,0],[621,25,623,118,0],[625,25,625,96,0],[626,25,626,26,0],[627,29,627,58,0],[629,29,629,117,0],[630,33,630,114,0],[632,29,633,61,0],[634,29,634,70,0],[635,29,635,77,0],[636,29,636,65,0],[637,29,637,118,0],[638,29,638,64,0],[639,29,639,30,0],[640,33,640,51,0],[641,33,641,50,0],[642,29,642,30,0],[643,25,643,26,0],[645,25,645,26,0],[646,29,653,72,0],[654,25,654,26,0],[655,21,655,22,0],[656,17,656,18,0],[657,17,657,40,0],[658,17,659,57,0],[665,17,665,59,0],[666,21,666,57,0],[668,17,668,80,0],[671,17,671,54,0],[672,21,672,52,0],[674,17,674,72,0],[676,17,676,54,0],[683,17,683,53,0],[684,17,684,49,0],[685,17,685,48,0],[691,17,691,56,0],[692,17,692,56,0],[693,17,693,51,0],[695,17,695,58,0],[696,17,696,56,0],[697,17,697,53,0],[699,17,699,55,0],[700,17,700,50,0],[701,17,701,50,0],[703,17,703,57,0],[704,17,704,54,0],[705,17,705,52,0],[707,17,707,53,0],[708,17,708,46,0],[709,17,709,48,0],[711,17,711,60,0],[712,17,712,60,0],[713,17,713,55,0],[715,17,715,61,0],[716,17,716,24,0],[716,26,716,37,0],[716,38,716,40,0],[716,41,716,67,0],[717,17,717,18,0],[718,21,718,85,0],[722,21,722,28,0],[722,30,722,42,0],[722,43,722,45,0],[722,46,722,82,0],[723,21,723,22,0],[724,25,724,66,0],[725,25,725,26,0],[726,29,726,79,0],[727,29,728,156,0],[729,29,729,30,0],[730,33,730,115,0],[731,33,731,34,0],[732,37,732,59,0],[733,33,733,34,0],[734,38,734,84,0],[735,33,735,34,0],[736,37,736,110,0],[737,33,737,34,0],[738,29,738,30,0],[739,25,739,26,0],[740,21,740,22,0],[742,21,742,40,0],[743,25,743,50,0],[746,21,746,43,0],[747,25,747,53,0],[748,21,748,45,0],[749,25,749,55,0],[750,21,750,44,0],[751,25,751,52,0],[752,21,752,44,0],[753,25,753,54,0],[754,21,754,40,0],[755,25,755,50,0],[756,21,756,47,0],[757,25,757,57,0],[758,17,758,18,0],[760,17,760,99,0],[761,17,761,55,0],[762,21,762,76,0],[764,17,764,86,0],[765,17,765,54,0],[766,21,766,65,0],[768,17,768,112,0],[769,17,769,59,0],[770,21,770,80,0],[772,17,772,50,0],[774,17,774,24,0],[774,26,774,37,0],[774,38,774,40,0],[774,41,774,56,0],[775,21,775,28,0],[775,30,775,43,0],[775,44,775,46,0],[775,47,775,56,0],[776,25,776,72,0],[778,17,778,50,0],[779,17,779,44,0],[780,17,780,38,0],[781,17,781,73,0],[783,17,783,57,0],[784,17,784,78,0],[785,17,785,18,0],[786,21,786,149,0],[787,21,787,60,0],[788,21,788,77,0],[789,21,789,55,0],[790,17,790,18,0],[792,17,792,124,0],[796,17,796,24,0],[796,26,796,38,0],[796,39,796,41,0],[796,42,796,58,0],[797,17,797,18,0],[798,21,798,43,0],[799,21,799,22,0],[800,25,800,41,0],[801,25,801,74,0],[802,21,802,22,0],[803,17,803,18,0],[805,17,805,38,0],[807,17,807,141,0],[808,13,808,14,0],[809,13,809,33,0],[810,13,810,14,0],[811,17,811,39,0],[812,17,812,45,0],[813,13,813,14,0],[814,13,814,30,0],[815,9,815,10,0],[818,9,818,10,0],[819,13,819,33,0],[820,13,820,119,0],[821,13,821,44,0],[822,13,822,20,0],[822,22,822,32,0],[822,33,822,35,0],[822,36,822,48,0],[823,17,823,51,0],[825,13,825,99,0],[826,13,826,45,0],[827,13,827,20,0],[827,22,827,32,0],[827,33,827,35,0],[827,36,827,49,0],[828,17,828,57,0],[830,13,830,20,0],[830,22,830,40,0],[830,41,830,43,0],[830,44,830,57,0],[831,13,831,14,0],[832,17,832,194,0],[833,17,833,18,0],[834,21,835,116,0],[836,21,836,48,0],[837,17,837,18,0],[839,17,839,207,0],[840,17,840,18,0],[841,21,842,123,0],[843,21,843,48,0],[844,17,844,18,0],[845,13,845,14,0],[847,13,847,63,0],[848,17,848,45,0],[849,9,849,10,0],[852,9,852,10,0],[853,9,853,10,0],[857,9,857,10,0],[859,13,859,111,0],[860,13,860,115,0],[861,13,861,60,0],[862,13,862,91,0],[863,13,863,77,0],[864,13,864,66,0],[866,13,866,39,0],[867,17,867,95,0],[868,9,868,10,0],[873,13,873,14,1],[874,17,874,64,1],[875,13,875,14,1],[879,9,879,10,0],[880,13,880,33,0],[881,13,881,39,0],[882,13,882,14,0],[883,17,883,47,0],[884,17,884,24,0],[884,26,884,37,0],[884,38,884,40,0],[884,41,884,109,0],[885,17,885,18,0],[886,21,886,70,0],[887,21,887,39,0],[888,17,888,18,0],[890,17,890,24,0],[890,26,890,38,0],[890,39,890,41,0],[890,42,890,66,0],[891,17,891,18,0],[892,21,892,62,0],[893,25,893,34,0],[894,26,894,130,0],[895,25,895,57,0],[897,25,897,110,0],[898,17,898,18,0],[899,13,899,14,0],[900,13,900,78,0],[901,13,901,27,0],[902,13,902,20,0],[902,21,902,32,0],[902,33,902,35,0],[902,36,902,43,0],[903,13,903,14,0],[904,17,904,76,0],[905,17,905,25,0],[906,13,906,14,0],[908,13,908,23,0],[909,9,909,10,0],[912,9,912,10,0],[913,13,913,39,0],[914,13,914,14,0],[915,17,915,145,0],[917,17,917,54,0],[918,17,918,101,0],[919,17,919,64,0],[920,17,920,53,0],[921,17,921,44,0],[922,17,922,66,0],[923,17,923,118,0],[924,17,924,122,0],[925,17,925,55,0],[926,17,926,99,0],[927,13,927,14,0],[928,9,928,10,0],[931,9,931,10,0],[932,13,932,59,0],[934,17,934,26,0],[934,28,934,46,0],[934,48,934,51,0],[935,13,935,14,0],[936,17,936,83,0],[938,17,938,40,0],[939,17,939,24,0],[939,26,939,38,0],[939,39,939,41,0],[939,42,939,52,0],[940,17,940,18,0],[941,21,941,60,0],[942,25,942,95,0],[943,17,943,18,0],[944,13,944,14,0],[945,9,945,10,0],[948,9,948,10,0],[950,13,950,50,0],[951,17,951,91,0],[952,9,952,10,0],[955,9,955,10,0],[956,13,956,66,0],[957,17,957,24,0],[958,13,958,38,0],[961,13,961,35,0],[962,13,962,34,0],[962,36,962,54,0],[965,13,965,20,0],[965,22,965,32,0],[965,33,965,35,0],[965,36,965,51,0],[966,13,966,14,0],[967,17,968,49,0],[970,17,970,53,0],[971,17,971,18,0],[972,21,972,52,0],[973,21,973,35,0],[974,21,974,43,0],[975,21,975,95,0],[976,21,976,28,0],[976,30,976,41,0],[976,42,976,44,0],[976,45,976,49,0],[977,21,977,22,0],[978,25,978,117,0],[979,25,979,26,0],[980,29,980,45,0],[981,29,981,50,0],[982,29,982,35,0],[985,25,985,26,0],[986,29,986,106,0],[987,25,987,26,0],[988,21,988,22,0],[989,21,989,55,0],[990,21,990,22,0],[991,25,991,46,0],[992,25,994,94,0],[995,21,995,22,0],[996,17,996,18,0],[997,13,997,14,0],[999,13,999,78,0],[1000,13,1000,14,0],[1001,17,1001,55,0],[1002,13,1002,14,0],[1003,9,1003,10,0],[1007,9,1007,10,0],[1010,13,1010,35,0],[1011,13,1011,103,0],[1012,13,1012,14,0],[1013,17,1013,52,0],[1014,17,1014,31,0],[1015,17,1015,93,0],[1016,17,1017,99,0],[1018,17,1020,37,0],[1021,17,1022,27,0],[1023,17,1023,46,0],[1024,17,1024,31,0],[1025,17,1025,18,0],[1026,21,1026,102,0],[1027,26,1027,35,0],[1027,37,1027,66,0],[1027,68,1027,71,0],[1028,21,1028,22,0],[1029,25,1029,71,0],[1030,25,1030,119,0],[1031,29,1031,87,0],[1032,30,1033,120,0],[1034,29,1035,128,0],[1036,30,1036,77,0],[1037,29,1038,88,0],[1041,25,1043,91,0],[1044,25,1044,26,0],[1046,29,1048,63,0],[1049,29,1049,101,0],[1050,33,1050,83,0],[1053,29,1055,49,0],[1056,29,1056,101,0],[1057,33,1057,83,0],[1058,25,1058,26,0],[1059,21,1059,22,0],[1060,17,1060,18,0],[1064,17,1067,37,0],[1068,17,1068,119,0],[1069,17,1069,31,0],[1070,17,1070,18,0],[1071,21,1071,102,0],[1072,21,1073,108,0],[1074,21,1075,89,0],[1076,21,1078,123,0],[1079,25,1080,123,0],[1081,17,1081,18,0],[1085,17,1085,110,0],[1086,22,1086,31,0],[1086,33,1086,62,0],[1086,64,1086,67,0],[1087,17,1087,18,0],[1088,21,1088,67,0],[1089,21,1089,91,0],[1090,21,1090,22,0],[1091,25,1091,105,0],[1092,21,1092,22,0],[1094,21,1094,22,0],[1095,25,1096,59,0],[1097,21,1097,22,0],[1098,21,1098,93,0],[1099,25,1099,75,0],[1100,17,1100,18,0],[1101,13,1101,14,0],[1106,13,1106,14,0],[1107,17,1107,37,0],[1121,17,1121,64,0],[1122,17,1122,85,0],[1123,17,1123,95,0],[1124,17,1124,94,0],[1125,17,1125,47,0],[1126,17,1126,95,0],[1128,17,1128,24,0],[1128,26,1128,40,0],[1128,41,1128,43,0],[1128,44,1128,54,0],[1129,17,1129,18,0],[1130,21,1130,100,0],[1132,21,1132,50,0],[1133,21,1133,87,0],[1134,21,1134,76,0],[1135,21,1135,22,0],[1136,25,1136,32,0],[1136,34,1136,44,0],[1136,45,1136,47,0],[1136,48,1136,69,0],[1137,25,1137,26,0],[1138,29,1141,75,0],[1142,29,1142,119,0],[1143,25,1143,26,0],[1144,21,1144,22,0],[1145,26,1145,45,0],[1146,21,1146,22,0],[1147,25,1147,32,0],[1147,34,1147,44,0],[1147,45,1147,47,0],[1147,48,1147,69,0],[1148,25,1148,26,0],[1149,29,1159,88,0],[1160,29,1160,119,0],[1161,25,1161,26,0],[1162,21,1162,22,0],[1163,17,1163,18,0],[1164,13,1164,14,0],[1167,9,1167,10,0],[1171,9,1171,10,0],[1172,13,1172,56,0],[1173,13,1173,33,0],[1174,13,1174,14,0],[1175,17,1175,44,0],[1176,17,1176,58,0],[1177,21,1177,52,0],[1178,17,1178,87,0],[1179,17,1179,57,0],[1180,21,1180,51,0],[1181,13,1181,14,0],[1182,13,1182,28,0],[1183,9,1183,10,0],[1187,9,1187,10,0],[1189,13,1189,30,0],[1190,13,1191,45,0],[1193,13,1196,52,0],[1197,13,1200,52,0],[1201,13,1204,52,0],[1205,18,1205,27,0],[1205,29,1205,56,0],[1205,58,1205,61,0],[1206,13,1206,14,0],[1207,17,1208,49,0],[1209,17,1209,42,0],[1210,17,1210,18,0],[1211,21,1211,41,0],[1212,21,1216,60,0],[1217,21,1221,60,0],[1222,21,1226,60,0],[1227,17,1227,18,0],[1229,17,1229,42,0],[1230,17,1230,18,0],[1231,21,1231,91,0],[1232,17,1232,18,0],[1233,17,1233,26,0],[1234,17,1234,18,0],[1235,21,1235,96,0],[1236,21,1236,116,0],[1237,21,1237,118,0],[1238,17,1238,18,0],[1240,17,1240,18,0],[1241,21,1241,115,0],[1242,21,1242,111,0],[1243,17,1243,18,0],[1245,17,1245,26,0],[1246,17,1246,18,0],[1247,21,1247,96,0],[1248,21,1248,116,0],[1249,21,1249,118,0],[1250,17,1250,18,0],[1252,17,1252,18,0],[1253,21,1253,115,0],[1254,21,1254,111,0],[1255,17,1255,18,0],[1257,17,1257,26,0],[1258,17,1258,18,0],[1259,21,1259,96,0],[1260,21,1260,116,0],[1261,21,1261,118,0],[1262,17,1262,18,0],[1264,17,1264,18,0],[1265,21,1265,115,0],[1266,21,1266,111,0],[1267,17,1267,18,0],[1268,13,1268,14,0],[1269,9,1269,10,0],[1272,9,1272,10,0],[1273,13,1273,66,0],[1274,13,1274,70,0],[1276,13,1276,35,0],[1277,13,1277,34,0],[1278,13,1278,14,0],[1279,17,1279,59,0],[1280,21,1280,30,0],[1282,21,1282,31,0],[1285,13,1285,102,0],[1288,13,1291,55,0],[1293,13,1293,48,0],[1295,13,1295,50,0],[1296,17,1296,27,0],[1298,13,1298,29,0],[1300,13,1300,37,0],[1301,13,1301,14,0],[1302,17,1303,103,0],[1304,13,1304,14,0],[1305,18,1305,37,0],[1306,13,1306,14,0],[1307,17,1307,86,0],[1308,13,1308,14,0],[1310,13,1310,92,0],[1312,13,1312,27,0],[1313,9,1313,10,0],[1316,9,1316,10,0],[1317,13,1317,35,0],[1319,13,1319,41,0],[1321,13,1321,59,0],[1322,13,1322,61,0],[1323,13,1323,59,0],[1325,13,1325,28,0],[1326,13,1326,20,0],[1326,22,1326,33,0],[1326,34,1326,36,0],[1326,37,1326,44,0],[1327,13,1327,14,0],[1328,17,1328,48,0],[1329,17,1329,56,0],[1330,17,1330,29,0],[1331,17,1331,18,0],[1332,21,1332,37,0],[1333,21,1333,115,0],[1334,21,1334,49,0],[1336,17,1336,18,0],[1338,17,1338,18,0],[1339,21,1339,48,0],[1340,17,1340,18,0],[1341,17,1341,26,0],[1342,13,1342,14,0],[1343,13,1343,29,0],[1344,9,1344,10,0],[1347,9,1347,10,0],[1348,13,1348,70,0],[1350,13,1350,62,0],[1351,13,1351,41,0],[1354,21,1354,318,0],[1356,21,1357,77,0],[1359,21,1360,161,0],[1369,21,1370,158,0],[1372,21,1372,35,0],[1374,9,1374,10,0],[1377,9,1377,10,0],[1378,13,1378,20,0],[1378,22,1378,32,0],[1378,33,1378,35,0],[1378,36,1378,43,0],[1379,13,1379,14,0],[1380,17,1381,113,0],[1382,17,1382,18,0],[1383,21,1383,102,0],[1384,17,1384,18,0],[1385,13,1385,14,0],[1386,9,1386,10,0],[1389,9,1389,10,0],[1390,13,1390,120,0],[1391,13,1391,14,0],[1392,17,1392,73,0],[1393,21,1393,93,0],[1394,13,1394,14,0],[1396,13,1396,14,0],[1397,17,1397,72,0],[1397,73,1397,74,0],[1398,13,1398,14,0],[1399,9,1399,10,0],[1402,9,1402,10,0],[1403,13,1403,51,0],[1405,13,1405,65,0],[1406,13,1406,14,0],[1407,17,1407,59,0],[1408,13,1408,14,0],[1410,13,1410,37,0],[1412,13,1412,82,0],[1414,13,1414,27,0],[1415,13,1415,14,0],[1416,17,1416,54,0],[1418,17,1418,24,0],[1418,26,1418,36,0],[1418,37,1418,39,0],[1418,40,1418,47,0],[1419,17,1419,18,0],[1420,21,1421,117,0],[1422,21,1422,22,0],[1423,25,1423,108,0],[1424,21,1424,22,0],[1425,17,1425,18,0],[1427,17,1427,43,0],[1428,17,1428,31,0],[1431,17,1431,24,0],[1431,26,1431,37,0],[1431,38,1431,40,0],[1431,41,1431,48,0],[1432,17,1432,18,0],[1433,21,1433,76,0],[1434,21,1434,22,0],[1435,25,1435,107,0],[1436,25,1436,45,0],[1437,21,1437,22,0],[1438,21,1438,29,0],[1439,17,1439,18,0],[1442,17,1442,91,0],[1443,17,1443,68,0],[1444,17,1444,18,0],[1445,26,1445,35,0],[1445,37,1445,42,0],[1445,44,1445,47,0],[1446,21,1446,22,0],[1447,25,1447,73,0],[1448,25,1448,89,0],[1449,25,1449,26,0],[1450,29,1450,49,0],[1451,29,1451,36,0],[1451,38,1451,48,0],[1451,49,1451,51,0],[1451,52,1451,73,0],[1452,29,1452,30,0],[1453,33,1454,199,0],[1455,29,1455,30,0],[1456,25,1456,26,0],[1457,21,1457,22,0],[1458,17,1458,18,0],[1460,17,1460,71,0],[1461,21,1461,49,0],[1462,13,1462,14,0],[1463,9,1463,10,0],[1466,9,1466,10,0],[1467,13,1467,34,0],[1467,36,1467,50,0],[1468,13,1468,47,0],[1468,49,1468,76,0],[1469,13,1469,20,0],[1469,22,1469,32,0],[1469,33,1469,35,0],[1469,36,1469,43,0],[1470,13,1470,14,0],[1471,17,1472,49,0],[1473,17,1473,55,0],[1474,21,1474,59,0],[1475,17,1475,121,0],[1476,17,1476,18,0],[1477,21,1477,48,0],[1478,21,1478,75,0],[1479,21,1479,59,0],[1480,21,1480,22,0],[1481,25,1481,72,0],[1482,25,1482,53,0],[1483,21,1483,22,0],[1484,21,1484,58,0],[1485,21,1485,22,0],[1486,25,1486,65,0],[1487,29,1487,59,0],[1488,21,1488,22,0],[1489,17,1489,18,0],[1490,13,1490,14,0],[1491,9,1491,10,0],[1498,9,1498,10,0],[1499,13,1499,52,0],[1500,13,1500,54,0],[1501,13,1501,44,0],[1502,13,1502,26,0],[1503,9,1503,10,0],[1506,9,1506,10,0],[1507,13,1507,51,0],[1508,13,1508,49,0],[1510,13,1510,53,0],[1511,13,1518,16,0],[1520,13,1520,99,0],[1521,13,1528,16,0],[1530,13,1530,74,0],[1532,13,1532,54,0],[1533,13,1540,16,0],[1542,13,1542,54,0],[1543,13,1550,16,0],[1552,13,1552,102,0],[1553,13,1560,16,0],[1562,13,1562,103,0],[1563,13,1570,16,0],[1572,13,1572,103,0],[1573,13,1580,16,0],[1582,13,1582,98,0],[1583,13,1590,16,0],[1592,13,1592,55,0],[1593,13,1600,16,0],[1602,13,1602,28,0],[1603,9,1603,10,0],[1606,9,1606,10,0],[1607,13,1607,52,0],[1608,13,1615,16,0],[1616,9,1616,10,0],[1619,9,1619,10,0],[1620,13,1620,25,0],[1621,9,1621,10,0],[1624,9,1624,10,1],[1625,13,1625,75,1],[1626,13,1626,14,1],[1627,17,1627,24,1],[1627,26,1627,38,1],[1627,39,1627,41,1],[1627,42,1627,53,1],[1628,17,1628,18,1],[1629,21,1629,78,1],[1630,21,1630,22,1],[1631,25,1631,85,1],[1632,25,1632,110,1],[1633,21,1633,22,1],[1634,17,1634,18,1],[1635,13,1635,14,1],[1636,9,1636,10,1],[1639,9,1639,10,0],[1640,13,1659,15,0],[1660,13,1660,25,0],[1661,9,1661,10,0],[1680,9,1680,10,0],[1681,13,1701,15,0],[1702,13,1702,25,0],[1703,9,1703,10,0],[1706,9,1706,10,0],[1707,13,1733,15,0],[1734,13,1734,25,0],[1735,9,1735,10,0],[1759,9,1759,10,1],[1760,13,1776,15,1],[1777,13,1777,25,1],[1778,9,1778,10,1],[1781,9,1781,10,0],[1782,13,1782,35,0],[1783,13,1783,45,0],[1784,17,1784,40,0],[1786,17,1786,29,0],[1787,9,1787,10,0],[1789,9,1789,56,1],[1792,9,1792,10,0],[1793,13,1793,35,0],[1794,13,1794,14,0],[1795,17,1795,65,0],[1796,17,1796,60,0],[1797,17,1797,58,0],[1798,17,1798,51,0],[1800,17,1800,55,0],[1801,17,1801,53,0],[1802,17,1802,51,0],[1804,17,1804,58,0],[1805,17,1805,56,0],[1806,17,1806,51,0],[1812,17,1812,59,0],[1813,17,1813,58,0],[1814,17,1814,51,0],[1816,17,1816,60,0],[1817,17,1817,56,0],[1819,17,1819,51,0],[1821,17,1821,59,0],[1822,17,1822,57,0],[1823,17,1823,51,0],[1825,17,1825,45,0],[1826,17,1826,44,0],[1827,17,1827,51,0],[1829,17,1829,45,0],[1830,17,1830,40,0],[1831,17,1831,51,0],[1833,17,1833,46,0],[1834,17,1834,48,0],[1835,17,1835,53,0],[1837,13,1837,14,0],[1838,9,1838,10,0],[1842,9,1842,10,0],[1843,13,1843,66,0],[1845,13,1846,98,0],[1847,13,1847,14,0],[1848,17,1848,24,0],[1848,26,1848,38,0],[1848,39,1848,41,0],[1848,42,1848,71,0],[1849,17,1849,18,0],[1850,21,1850,94,0],[1851,21,1851,22,0],[1852,25,1852,102,0],[1853,25,1853,95,0],[1854,25,1854,26,0],[1855,29,1855,56,0],[1856,29,1856,85,0],[1857,29,1857,30,0],[1858,33,1858,43,0],[1859,33,1859,99,0],[1860,33,1860,34,0],[1861,37,1861,41,0],[1862,37,1862,69,0],[1863,33,1863,34,0],[1864,29,1864,30,0],[1865,29,1865,63,0],[1866,25,1866,26,0],[1867,21,1867,22,0],[1868,17,1868,18,0],[1869,13,1869,14,0],[1870,9,1870,10,0],[1876,13,1876,14,0],[1877,17,1877,39,0],[1878,21,1878,35,0],[1879,17,1879,34,0],[1880,13,1880,14,0],[1884,9,1884,10,0],[1885,13,1885,33,0],[1887,13,1887,20,0],[1887,22,1887,32,0],[1887,33,1887,35,0],[1887,36,1887,49,0],[1888,13,1888,14,0],[1890,17,1891,112,0],[1892,17,1892,18,0],[1893,21,1893,37,0],[1894,21,1895,66,0],[1896,21,1896,30,0],[1899,17,1899,18,0],[1900,21,1900,104,0],[1902,21,1902,101,0],[1904,21,1904,48,0],[1905,21,1905,22,0],[1906,25,1906,41,0],[1907,25,1908,65,0],[1909,25,1909,34,0],[1912,21,1912,28,0],[1912,30,1912,43,0],[1912,44,1912,46,0],[1912,47,1912,69,0],[1913,21,1913,22,0],[1916,25,1916,26,0],[1918,29,1920,121,0],[1921,29,1921,30,0],[1922,33,1922,42,0],[1926,29,1928,121,0],[1929,29,1929,30,0],[1930,33,1930,67,0],[1934,29,1934,88,0],[1935,29,1935,30,0],[1936,33,1936,49,0],[1937,33,1937,42,0],[1940,29,1940,108,0],[1941,25,1941,26,0],[1942,25,1942,53,0],[1943,25,1943,26,0],[1944,29,1944,45,0],[1945,29,1947,87,0],[1948,25,1948,26,0],[1949,25,1949,54,0],[1950,25,1950,26,0],[1951,29,1951,45,0],[1952,29,1953,74,0],[1954,25,1954,26,0],[1955,25,1955,30,0],[1956,25,1956,26,0],[1957,29,1957,45,0],[1958,29,1960,87,0],[1961,25,1961,26,0],[1962,21,1962,22,0],[1963,17,1963,18,0],[1964,13,1964,14,0],[1966,13,1966,28,0],[1967,9,1967,10,0],[1970,9,1970,10,0],[1971,13,1971,86,0],[1973,13,1973,57,0],[1975,13,1975,79,0],[1976,13,1976,20,0],[1976,22,1976,34,0],[1976,35,1976,37,0],[1976,38,1976,51,0],[1977,13,1977,14,0],[1978,17,1978,71,0],[1979,17,1979,18,0],[1980,21,1980,79,0],[1981,21,1981,91,0],[1982,21,1982,22,0],[1983,25,1983,52,0],[1984,25,1984,65,0],[1985,25,1985,26,0],[1986,29,1986,39,0],[1987,29,1987,79,0],[1988,29,1988,30,0],[1989,33,1989,37,0],[1990,33,1990,65,0],[1991,29,1991,30,0],[1992,25,1992,26,0],[1993,25,1993,67,0],[1994,25,1994,59,0],[1995,21,1995,22,0],[1997,21,1997,22,0],[1998,25,1998,61,0],[1999,21,1999,22,0],[2000,17,2000,18,0],[2001,13,2001,14,0],[2003,13,2003,20,0],[2003,22,2003,34,0],[2003,35,2003,37,0],[2003,38,2003,48,0],[2004,13,2004,14,0],[2005,17,2005,51,0],[2006,21,2006,54,0],[2007,13,2007,14,0],[2008,9,2008,10,0],[2016,9,2016,10,0],[2017,13,2017,42,0],[2018,13,2018,39,0],[2019,13,2019,14,0],[2020,17,2020,47,0],[2021,17,2021,24,0],[2021,26,2021,38,0],[2021,39,2021,41,0],[2021,42,2021,67,0],[2022,17,2022,18,0],[2023,21,2023,82,0],[2024,21,2024,48,0],[2025,21,2025,53,0],[2026,17,2026,18,0],[2027,13,2027,14,0],[2029,18,2029,29,0],[2029,31,2029,54,0],[2029,56,2029,61,0],[2030,13,2030,14,0],[2031,17,2031,51,0],[2032,17,2032,24,0],[2032,26,2032,39,0],[2032,40,2032,42,0],[2032,43,2032,62,0],[2033,17,2033,18,0],[2035,21,2035,128,0],[2036,21,2036,22,0],[2039,25,2040,98,0],[2041,21,2041,22,0],[2042,26,2044,106,0],[2045,21,2045,22,0],[2046,25,2047,100,0],[2049,21,2049,22,0],[2050,17,2050,18,0],[2051,17,2051,42,0],[2052,13,2052,14,0],[2053,9,2053,10,0],[2056,9,2056,10,1],[2057,13,2066,15,1],[2070,13,2070,55,1],[2071,17,2071,90,0],[2073,13,2073,59,1],[2074,17,2074,95,0],[2076,13,2076,59,1],[2077,17,2077,78,0],[2079,13,2079,59,1],[2080,17,2080,95,0],[2082,13,2082,59,1],[2083,17,2083,78,0],[2085,13,2085,59,1],[2086,17,2086,95,0],[2088,13,2088,59,1],[2089,17,2089,78,0],[2091,13,2091,88,1],[2092,13,2092,63,1],[2094,13,2094,35,1],[2095,9,2095,10,1],[2098,9,2098,10,0],[2100,13,2100,14,0],[2101,17,2101,50,0],[2102,17,2102,76,0],[2103,17,2103,64,0],[2104,17,2104,49,0],[2105,17,2105,38,0],[2106,17,2106,55,0],[2107,17,2107,42,0],[2109,13,2109,33,0],[2110,13,2110,14,0],[2111,17,2111,26,0],[2113,9,2113,10,0],[2116,9,2116,10,0],[2117,13,2117,20,0],[2117,22,2117,32,0],[2117,33,2117,35,0],[2117,36,2117,60,0],[2118,13,2118,14,0],[2119,17,2121,40,0],[2122,13,2122,14,0],[2123,9,2123,10,0],[2129,9,2129,10,0],[2132,13,2132,116,0],[2133,13,2133,26,0],[2134,9,2134,10,0],[2142,9,2142,10,0],[2144,13,2144,14,0],[2145,17,2145,55,0],[2146,17,2146,66,0],[2147,17,2147,18,0],[2148,26,2148,37,0],[2148,39,2148,54,0],[2148,56,2148,61,0],[2149,21,2149,22,0],[2150,25,2150,96,0],[2151,25,2151,26,0],[2152,29,2153,115,0],[2154,29,2154,55,0],[2155,29,2155,30,0],[2156,33,2160,112,0],[2161,33,2161,63,0],[2162,33,2162,45,0],[2163,33,2163,39,0],[2164,29,2164,30,0],[2166,29,2166,30,0],[2167,33,2167,74,0],[2168,33,2168,34,0],[2169,37,2169,89,0],[2170,37,2170,103,0],[2171,33,2171,34,0],[2172,33,2172,63,0],[2173,33,2173,34,0],[2174,37,2174,102,0],[2175,33,2175,34,0],[2176,29,2176,30,0],[2177,25,2177,26,0],[2178,21,2178,22,0],[2179,17,2179,18,0],[2180,13,2180,14,0],[2181,13,2181,33,0],[2182,13,2182,14,0],[2183,17,2183,26,0],[2185,9,2185,10,0],[2190,9,2190,10,0],[2191,13,2191,30,0],[2192,13,2192,89,0],[2193,13,2194,95,0],[2195,13,2195,54,0],[2196,13,2196,27,0],[2197,13,2197,40,0],[2198,13,2198,44,0],[2199,13,2199,33,0],[2201,13,2201,14,0],[2202,17,2202,55,0],[2203,17,2203,66,0],[2204,17,2204,18,0],[2205,26,2205,37,0],[2205,39,2205,54,0],[2205,56,2205,61,0],[2206,21,2206,22,0],[2207,25,2207,96,0],[2208,25,2208,26,0],[2209,29,2209,60,0],[2210,29,2210,30,0],[2211,33,2212,119,0],[2213,33,2213,59,0],[2214,33,2214,34,0],[2215,37,2215,53,0],[2216,37,2218,98,0],[2219,41,2223,122,0],[2224,33,2224,34,0],[2226,33,2226,34,0],[2227,37,2227,78,0],[2228,37,2228,38,0],[2229,41,2231,74,0],[2232,45,2233,101,0],[2234,41,2236,102,0],[2237,45,2238,115,0],[2239,41,2241,102,0],[2242,45,2243,119,0],[2244,37,2244,38,0],[2245,37,2245,67,0],[2246,37,2246,38,0],[2247,41,2249,102,0],[2250,45,2251,114,0],[2252,37,2252,38,0],[2253,33,2253,34,0],[2254,29,2254,30,0],[2256,29,2256,30,0],[2258,33,2261,111,0],[2262,33,2262,34,0],[2263,37,2267,115,0],[2268,37,2272,64,0],[2274,37,2276,47,0],[2278,37,2278,113,0],[2279,37,2279,38,0],[2280,41,2280,104,0],[2281,41,2281,114,0],[2282,37,2282,38,0],[2283,37,2285,70,0],[2286,37,2286,38,0],[2287,41,2287,57,0],[2288,41,2288,117,0],[2289,37,2289,38,0],[2290,33,2290,34,0],[2291,29,2291,30,0],[2292,25,2292,26,0],[2293,21,2293,22,0],[2294,17,2294,18,0],[2295,13,2295,14,0],[2296,13,2296,33,0],[2297,13,2297,14,0],[2298,17,2298,26,0],[2300,9,2300,10,0],[2304,9,2304,10,0],[2306,13,2306,14,0],[2307,17,2307,70,0],[2308,17,2308,18,0],[2309,21,2309,107,0],[2310,21,2310,47,0],[2311,21,2311,22,0],[2312,25,2312,41,0],[2313,25,2313,121,0],[2314,29,2316,74,0],[2317,21,2317,22,0],[2319,21,2319,22,0],[2320,25,2320,66,0],[2321,25,2321,26,0],[2322,29,2322,116,0],[2323,33,2323,67,0],[2324,29,2326,63,0],[2327,33,2327,81,0],[2328,25,2328,26,0],[2329,25,2329,55,0],[2330,25,2330,26,0],[2331,29,2333,53,0],[2334,33,2334,80,0],[2335,25,2335,26,0],[2336,21,2336,22,0],[2337,17,2337,18,0],[2338,13,2338,14,0],[2339,13,2339,33,0],[2340,13,2340,14,0],[2341,17,2341,26,0],[2343,9,2343,10,0],[2349,9,2349,55,1],[2354,13,2354,14,1],[2355,17,2355,41,1],[2356,13,2356,14,1],[2362,13,2362,14,1],[2363,17,2363,52,1],[2364,13,2364,14,1],[2368,9,2368,10,1],[2369,13,2369,47,1],[2370,13,2370,130,1],[2372,13,2372,43,1],[2373,13,2373,20,1],[2373,22,2373,32,0],[2373,33,2373,35,1],[2373,36,2373,53,1],[2374,13,2374,14,0],[2375,17,2375,76,0],[2376,17,2376,18,0],[2377,21,2377,53,0],[2378,21,2378,150,0],[2379,21,2379,152,0],[2380,25,2380,31,0],[2382,25,2382,45,0],[2383,17,2383,18,0],[2384,13,2384,14,0],[2387,13,2387,33,1],[2388,9,2388,10,1],[2390,9,2390,58,1],[2393,9,2393,10,1],[2394,13,2394,50,1],[2395,13,2395,14,1],[2396,17,2396,67,1],[2397,17,2397,46,1],[2398,17,2398,18,0],[2399,21,2399,72,0],[2400,21,2400,59,0],[2401,21,2401,22,0],[2402,25,2402,32,0],[2402,34,2402,46,0],[2402,47,2402,49,0],[2402,50,2402,70,0],[2403,25,2403,26,0],[2404,29,2404,71,0],[2405,33,2405,188,0],[2406,25,2406,26,0],[2407,21,2407,22,0],[2408,17,2408,18,0],[2409,13,2409,14,1],[2411,13,2411,55,1],[2412,9,2412,10,1],[2415,9,2415,10,0],[2416,13,2416,40,0],[2417,17,2417,29,0],[2419,13,2419,27,0],[2420,13,2420,58,0],[2422,13,2422,84,0],[2423,13,2423,35,0],[2424,13,2424,14,0],[2425,17,2425,63,0],[2426,17,2426,24,0],[2426,26,2426,48,0],[2426,49,2426,51,0],[2426,52,2426,59,0],[2427,21,2427,94,0],[2428,13,2428,14,0],[2429,13,2429,63,0],[2432,13,2432,40,0],[2433,13,2433,77,0],[2435,13,2435,33,0],[2436,13,2436,64,0],[2438,17,2441,148,0],[2443,13,2443,84,0],[2446,13,2446,134,0],[2447,13,2447,14,0],[2448,17,2448,45,0],[2449,17,2449,64,0],[2450,17,2450,90,0],[2451,16,2451,23,0],[2451,25,2451,37,0],[2451,38,2451,40,0],[2451,41,2451,51,0],[2452,17,2452,18,0],[2453,21,2453,48,0],[2454,25,2454,34,0],[2456,21,2456,22,0],[2457,24,2457,86,0],[2458,25,2458,104,0],[2459,33,2459,107,0],[2461,29,2461,60,0],[2462,21,2462,22,0],[2463,17,2463,18,0],[2465,17,2465,24,0],[2465,26,2465,40,0],[2465,41,2465,43,0],[2465,44,2465,56,0],[2466,21,2466,48,0],[2468,17,2468,49,0],[2469,17,2469,18,0],[2470,21,2470,65,0],[2471,17,2471,18,0],[2472,17,2472,27,0],[2475,13,2475,25,0],[2476,9,2476,10,0],[2491,17,2491,18,0],[2491,19,2491,38,0],[2491,39,2491,40,0],[2492,17,2492,18,0],[2492,19,2492,39,0],[2492,40,2492,41,0],[2496,17,2496,18,0],[2496,19,2496,49,0],[2496,50,2496,51,0],[2497,17,2497,18,0],[2497,19,2497,50,0],[2497,51,2497,52,0],[2502,17,2502,18,0],[2502,19,2502,43,0],[2502,44,2502,45,0],[2503,17,2503,18,0],[2503,19,2503,44,0],[2503,45,2503,46,0],[2508,17,2508,18,0],[2508,19,2508,41,0],[2508,42,2508,43,0],[2509,17,2509,18,0],[2509,19,2509,42,0],[2509,43,2509,44,0],[2512,37,2512,41,0],[2512,42,2512,46,0],[2513,31,2513,35,0],[2513,36,2513,40,0],[2514,36,2514,40,0],[2514,41,2514,45,0]]);
    </script>
  </body>
</html>