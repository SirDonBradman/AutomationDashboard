<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Construction Vertical\Addon Modules\Contract Manager\Work Order\NewWorkOrder.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Configuration;
using System.Data;
using System.Data.OleDb;
using System.Drawing;
using System.Globalization;
using System.IO;
using System.Reflection;
using System.Text;
using System.Threading;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.HtmlControls;
using System.Xml;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.ContractManager.BusinessLayer;
using Aurigo.AMP3.Core.BusinessLayer.BL;
using Aurigo.AMP3.Core.BusinessLayer.DTO;
using Aurigo.AMP3.Core.IntegrationConnector;
using Aurigo.AMP3.Core.UserControls;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.AMP3.Resources.MessageResources;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.AMP3.WORKORDBL;
using Aurigo.AMP3.WORKORDDTO;
using Aurigo.Brix.Construction.ContractManager.BusinessLayer.BL;
using Aurigo.Brix.Core.WebUiHelper;
using Aurigo.Brix.Platform.BusinessLayer.BL;
using Aurigo.Brix.Platform.BusinessLayer.UserControls;
using Aurigo.Brix.Platform.BusinessLayer.DataResouces;
using Aurigo.Brix.Platform.BusinessLayer.DTO;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Infragistics.Documents.Excel;
using Infragistics.WebUI.UltraWebGrid;
using Infragistics.WebUI.UltraWebGrid.ExcelExport;
using Infragistics.WebUI.WebDataInput;
using Aurigo.Common;
using System.Web.Script.Serialization;
namespace Aurigo.AMP3.WORKORDUI
{
    public partial class NewWorkOrder : BrixPageBase, ICallbackEventHandler, IWorkflowEnabled
    {
        #region Class Properties and Variables

        public enum ItemDivEnums
        {
            ItemPicker = 1,
            CreateWO = 2,
            PrepaymentPicker = 3,
            RetentionPicker = 4
        }

        List&lt;string&gt; permissions;

        private const string MSG_INVALID_FILE = &quot;Please upload a valid Excel file&quot;;

        #region Declaring UI Controls

        protected global::Infragistics.WebUI.UltraWebGrid.UltraWebGrid uwgQuotItems;
        protected global::Infragistics.WebUI.UltraWebGrid.UltraWebGrid uwgWOItems;
        protected global::Infragistics.WebUI.UltraWebGrid.UltraWebGrid uwgPrepaymentTypes;
        protected global::Infragistics.WebUI.UltraWebGrid.UltraWebGrid uwgQuotations;

        protected global::Infragistics.WebUI.WebSchedule.WebDateChooser dtWODate;
        protected global::Infragistics.WebUI.WebSchedule.WebDateChooser dtEndDate;
        protected global::Infragistics.WebUI.WebSchedule.WebDateChooser dtStartDate;
        protected global::Infragistics.WebUI.WebSchedule.WebDateChooser wdcCreatedOn;
        protected global::Infragistics.WebUI.WebSchedule.WebDateChooser wbcDate;

        protected global::Infragistics.WebUI.WebDataInput.WebNumericEdit wneUnitCostHidden;
        protected global::Infragistics.WebUI.WebDataInput.WebNumericEdit wneQuantityHidden;
        protected global::Infragistics.WebUI.WebDataInput.WebNumericEdit wneTotal;
        protected global::Infragistics.WebUI.WebDataInput.WebNumericEdit wneRetentionPercentage;
        protected global::Infragistics.WebUI.WebDataInput.WebNumericEdit wneMaxPercentage;
        protected global::Infragistics.WebUI.WebDataInput.WebNumericEdit wneMaxAmount;
        protected global::Infragistics.WebUI.WebDataInput.WebNumericEdit wneRetentionCeiling;
        protected global::Infragistics.WebUI.WebDataInput.WebNumericEdit wneNumber;
        protected global::Infragistics.WebUI.WebDataInput.WebNumericEdit wneDuration;
        protected global::Infragistics.WebUI.WebDataInput.WebNumericEdit wneEquipmentQuantity;
        protected global::Infragistics.WebUI.WebDataInput.WebNumericEdit wneEquipmentAmount;
        protected global::Infragistics.WebUI.WebDataInput.WebNumericEdit wneUnitCost;

        protected global::Aurigo.AMP3.Core.UserControls.ItemPickerControl ucItemPicker;

        #endregion

        private string CallBackResult;
        private string VersionNo;
        private bool IsNewInstance = true;
        public int _ContractID;
        public int _ProjectID;
        private int _WorkOrderID;

        private DataTable dtPrepayment;
        private DataTable dtRecovery;
        private DataTable dtRetention;
        private bool editRecoveryDetails = true;
        private bool editRetentionDetails = true;
        public bool isEditVersion;
        private bool isOldWONo;
        public bool isVersion;
        private ItemPickerControl itemPicker;
        protected ModalPopupExtender popupExtender;
        private GenericPickerControl prepaymentPicker;
        private GenericPickerControl retentionPicker;
        protected UltraWebGridExcelExporter uwgExcelExporter;
        private string WorkOrderType { get; set; }
        private bool IsCopyWO { get; set; }

        /// &lt;summary&gt;
        /// Gets the Integration Cutoff Date
        /// &lt;/summary&gt;
        private DateTime IntegrationCutoffDate
        {
            get { return ((DateTime)Session[Constants.APP_IntegrationCutoffDate]).AddDays(-1); }
        }

        private bool OnlyCustomerWONo
        {
            get
            {
                if (ViewState[&quot;OnlyCustomerWONo&quot;] == null)
                    ViewState[&quot;OnlyCustomerWONo&quot;] = (ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CONTMGT).Contains(&quot;OnlyCustomerWONo&quot;));
                return ViewState[&quot;OnlyCustomerWONo&quot;].ToBoolean2();
            }
        }

        /// &lt;summary&gt;
        /// Gets the Default Record Date
        /// &lt;/summary&gt;
        private DateTime DefaultRecordDate
        {
            get { return (DateTime)Session[Constants.APP_DefaultRecordDate]; }
        }

        private bool HideContractorFilter
        {
            get
            {
                return (!IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX) ||
                        (AMP3ApplicationSettings.Instance.appSettings.ContainsKey(&quot;ContactorFilter&quot;) &amp;&amp;
                        AMP3ApplicationSettings.Instance.appSettings[&quot;ContactorFilter&quot;].ToUpper2().Equals(&quot;OFF&quot;)));
            }
        }

        private string ProjectMode
        {
            get
            {
                return (CacheManager.Instance.IsIntegrated(Request.QueryString[Constants.QRY_PROJECTID].ToInt32_2())
                            ? &quot;I&quot;
                            : &quot;L&quot;);
            }
        }

        //need to assign this after fetching from the contract settings
        public bool AllowZeroQuantity
        {
            get { return hdnAllowZeroQty.Value.Equals(&quot;1&quot;); }
            set { hdnAllowZeroQty.Value = value ? &quot;1&quot; : &quot;0&quot;; }
        }

        protected DataColumn[] QuotationsItemsSchema()
        {
            if (WorkOrderType.Equals(&quot;E&quot;))
            {
                return new[]
                           {
                               //new DataColumn(&quot;EquipmentID&quot;,System.Type.GetType(&quot;System.Int32&quot;)),
                               new DataColumn(&quot;Name&quot;, Type.GetType(&quot;System.String&quot;)),
                               new DataColumn(&quot;Description&quot;, Type.GetType(&quot;System.String&quot;)),
                               new DataColumn(&quot;Unit&quot;, Type.GetType(&quot;System.String&quot;)),
                               new DataColumn(&quot;Number&quot;, Type.GetType(&quot;System.Int32&quot;)),
                               new DataColumn(&quot;Duration&quot;, Type.GetType(&quot;System.Double&quot;)),
                               new DataColumn(&quot;Rate&quot;, Type.GetType(&quot;System.Double&quot;)),
                               //new DataColumn(&quot;Amount&quot;,Type.GetType(&quot;System.Double&quot;))
                           };
            }
            else
            {
                return new[]
                           {
                               new DataColumn(&quot;LineNo&quot;, Type.GetType(&quot;System.Int32&quot;)),
                               new DataColumn(&quot;ItemId&quot;, Type.GetType(&quot;System.Int32&quot;)),
                               new DataColumn(&quot;Description&quot;, Type.GetType(&quot;System.String&quot;)),
                               new DataColumn(&quot;Unit&quot;, Type.GetType(&quot;System.String&quot;)),
                               new DataColumn(&quot;Quantity&quot;, Type.GetType(&quot;System.Double&quot;)),
                               new DataColumn(&quot;Rate&quot;, Type.GetType(&quot;System.Double&quot;)),
                               //new DataColumn(&quot;Amount&quot;,Type.GetType(&quot;System.Double&quot;))
                           };
            }
        }

        #endregion

        #region Page Events

        protected override void OnPreInit(EventArgs e)
        {
            base.OnPreInit(e);
        }

        bool itemPicker_InitItemPickerParams()
        {
            itemPicker.ModuleID = Constants.MODID_CONTMGT;
            itemPicker.IsComplete = false;
            itemPicker.CurrentModuleID = &quot;WORKORD&quot;;
            itemPicker.EnableMultipleSelect = true;
            itemPicker.DisplayUnitCost = itemPicker.DisplayOverheadCost = false;

            itemPicker.ParentInstanceID = Request[&quot;ContractID&quot;].ToInt32_2();

            itemPicker.PickerText.Style.Add(&quot;display&quot;, &quot;none&quot;);
            return true;
        }
        protected override void OnInit(EventArgs e)
        {

            GetPermissions();

            WorkOrderType = string.IsNullOrEmpty(Request[&quot;WOType&quot;]) ? &quot;W&quot; : Request[&quot;WOType&quot;];
            IsCopyWO = string.IsNullOrEmpty(Request[&quot;IsCopy&quot;]) ? false : Convert.ToBoolean(Request[&quot;IsCopy&quot;]);
            hdnWorkOrderType.Value = WorkOrderType;
            itemPicker = (ucItemPicker as ItemPickerControl);
            itemPicker.PickerButton.Width = new Unit(&quot;40px&quot;);
            itemPicker_InitItemPickerParams();
            //itemPicker.InitItemPickerParams += new ItemPickerControl.InitParams(itemPicker_InitItemPickerParams);
            itemPicker.MultipleSelectedIndexChanged += itemPicker_MultipleSelectedIndexChanged;

            if (hdnWorkOrderType.Value.Equals(&quot;W&quot;))
            {
                rbDirect.Attributes.Add(&quot;onclick&quot;, &quot;IssueModeChanged();&quot;);
                rbQuotation.Attributes.Add(&quot;onclick&quot;, &quot;IssueModeChanged();&quot;);
            }
            else
            {
                SetIssueMode(IssueMode.WithQuotation);
                trIssueMode.Style.Value = &quot;display:none&quot;;
            }

            if (!WorkOrderType.Equals(&quot;E&quot;))
            {
                chkWithEquipment.CheckedChanged += OnCheckedChanged_Click;
                chkWithLabour.CheckedChanged += OnCheckedChanged_Click;
                chkWithMaterial.CheckedChanged += OnCheckedChanged_Click;
                chkWithMaterial.AutoPostBack = chkWithLabour.AutoPostBack = chkWithEquipment.AutoPostBack = true;
                //btnEditEquipments.Visible = false;
                MainToolBar.HideMenu(&quot;lnkEdit&quot;);
            }
            else
            {
                chkWithMaterial.AutoPostBack = chkWithLabour.AutoPostBack = chkWithEquipment.AutoPostBack = false;
                trWithEquipment.Style.Value = trWithLabour.Style.Value = trWithMaterial.Style.Value = &quot;display:none&quot;;

                #region Short close Quantity editor

                //ModalPopupExtender popupExtender = (ModalPopupExtender)this.Master.FindControl(&quot;filterExtender&quot;);
                popupExtender.AddNewPopup(pnlShortCloseQuantity.ClientID, btnShortCloseGhost.ClientID,
                                          btnCancel.ClientID, 300, 400, &quot;Short Close Quantity&quot;);

                #endregion
            }

            List&lt;string&gt; coreComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);
            if (!coreComponents.Contains(&quot;RateAnalysis&quot;))
            {
                trWithEquipment.Style.Value = trWithLabour.Style.Value = trWithMaterial.Style.Value = &quot;display:none&quot;;
            }

            #region Initializing prepayment picker

            prepaymentPicker = (ucPrepaymentPicker as GenericPickerControl);
            prepaymentPicker.IsFilterXml = true;
            prepaymentPicker.DisplayFilter = true;
            prepaymentPicker.BackClicked += prepaymentRulePicker_BackClicked;
            prepaymentPicker.ItemSelected += prepaymentRulePicker_SelectedIndexChanged;
            prepaymentPicker.BindData += prepaymentRulePicker_BindData;
            prepaymentPicker.DataSourceCommandType = DataSourceType.StoredProcedure;
            prepaymentPicker.StateMgmtContext = &quot;prepayment&quot;;
            prepaymentPicker.Filters = GetPrepaymentFilters();

            prepaymentPicker.ModifyColumnProperties(&quot;RecoveryId&quot;, true, null, null, null, false);
            prepaymentPicker.ModifyColumnProperties(&quot;ModuleID&quot;, true, null, null, null, false);
            prepaymentPicker.ModifyColumnProperties(&quot;ParentInstanceID&quot;, true, null, null, null, false);
            prepaymentPicker.ModifyColumnProperties(&quot;Prepaymentmode&quot;, true, null, null, null, false);
            prepaymentPicker.ModifyColumnProperties(&quot;Value&quot;, true, null, null, null, false);
            prepaymentPicker.ModifyColumnProperties(&quot;Notes&quot;, true, null, null, null, false);
            prepaymentPicker.ModifyColumnProperties(&quot;IsActive&quot;, true, null, null, null, false);

            prepaymentPicker.ModifyColumnProperties(&quot;RecoveryRuleName&quot;, false, null, null, null, false,
                                                    &quot;Pre-payment Rule&quot;);
            prepaymentPicker.ModifyColumnProperties(&quot;PrepayValue&quot;, false, null, null, null, false, &quot;Pre-payment Value&quot;);

            #endregion

            #region Initializing retention picker

            retentionPicker = (ucRetentionPicker as GenericPickerControl);
            retentionPicker.IsFilterXml = true;
            retentionPicker.DisplayFilter = true;
            retentionPicker.BackClicked += retentionRulePicker_BackClicked;
            retentionPicker.ItemSelected += retentionRulePicker_SelectedIndexChanged;
            retentionPicker.BindData += retentionRulePicker_BindData;
            retentionPicker.DataSourceCommandType = DataSourceType.StoredProcedure;
            retentionPicker.StateMgmtContext = &quot;retention&quot;;
            retentionPicker.Filters = GetRetentionFilters();

            retentionPicker.ModifyColumnProperties(&quot;RetentionID&quot;, true, null, null, null, false);
            retentionPicker.ModifyColumnProperties(&quot;ModuleID&quot;, true, null, null, null, false);
            retentionPicker.ModifyColumnProperties(&quot;ParentInstanceID&quot;, true, null, null, null, false);
            retentionPicker.ModifyColumnProperties(&quot;RetentionCeilingMode&quot;, true, null, null, null, false);
            retentionPicker.ModifyColumnProperties(&quot;RetentionCeilingValue&quot;, true, null, null, null, false);
            retentionPicker.ModifyColumnProperties(&quot;Notes&quot;, true, null, null, null, false);
            retentionPicker.ModifyColumnProperties(&quot;IsActive&quot;, true, null, null, null, false);

            retentionPicker.ModifyColumnProperties(&quot;RetentionRuleName&quot;, false, null, null, null, false,
                                                   &quot;Retention Rule Name&quot;);
            retentionPicker.ModifyColumnProperties(&quot;RetentionPercentage&quot;, false, null, null, null, false,
                                                   &quot;Retention Percentage&quot;);
            retentionPicker.ModifyColumnProperties(&quot;RetentnValue&quot;, false, null, null, null, false,
                                                   &quot;Retention Ceiling Value&quot;);

            #endregion

            uwgQuotItems.DisplayLayout.AllowSortingDefault = AllowSorting.OnClient;
            uwgQuotItems.DisplayLayout.FrameStyle.Height = new Unit(&quot;110px&quot;, CultureInfo.CurrentCulture);
            uwgQuotItems.DisplayLayout.StationaryMargins = StationaryMargins.No;

            hdnAmountDigits.Value = CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT).ToString2();
            hdnUnitPriceDigits.Value = CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE).ToString2();
            hdnPercentageDigits.Value =
                CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE).ToString2();
            hdnQuantityDigits.Value = CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY).ToString2();

            base.OnInit(e);
        }

        private void GetPermissions()
        {
            permissions = ModuleManager.Instance.GetPermissionByUserOrRole(&quot;WORKORD&quot;, UserDetail.GetCurrentUserDetail().UID,
                            UserDetail.GetCurrentUserDetail().RID, Request.QueryString[&quot;PID&quot;].ToInt32_2());
        }

        private void Page_PreRender(object sender, EventArgs e)
        {
            string mode = string.Empty;
            if (uwgWOItems.Rows.Count != 0)
            {
                mode = WOConstants.MODE_NEITHER;
            }
            if (txtPrepaymentRule.Text != string.Empty)
            {
                try
                {
                    DataTable dt =
                        dtRecovery.Select(&quot;RecoveryRuleName=&#39;&quot; + txtPrepaymentRule.Text.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) + &quot;&#39;&quot;).CopyToDataTable();
                    DataRow row = dt.Rows[0];
                    mode = ((row[&quot;Prepaymentmode&quot;].ToString2().ToLower2() == &quot;false&quot; ||
                             row[&quot;Prepaymentmode&quot;].ToString2() == &quot;0&quot;)
                                ? WOConstants.MODE_AMOUNT
                                : WOConstants.MODE_PERCENTAGE);
                }
                catch
                {
                    mode = WOConstants.MODE_NEITHER;
                }
            }
            HideShowTB(mode);
        }

        protected void Page_Load(object sender, EventArgs e)
        {
            //TODO: need to implement separate permission features for WORKORD and EQUPHIR
            if (!permissions.Contains(&quot;Create&quot;) &amp;&amp; !permissions.Contains(&quot;CreateEHO&quot;))
            {
                UIHelper.RedirectURL(
                    MessageResourceManager.GetString(&quot;E_USRMGMT_NO_PERMISSIONS_TO_VIEW_PAGE&quot;,
                                                     Enumerations.MessageType.ErrorMessage),
                    ResolveUrl(Constants.URL_ENTERPRISE), null, Context);
            }
            if (!permissions.Contains(&quot;RecoveryRule&quot;))
            {
                editRecoveryDetails = false;
            }
            if (!permissions.Contains(&quot;RetentionRule&quot;))
            {
                editRetentionDetails = false;
            }
            if (!isVersion)
                wneQuantityHidden.Visible = false;

            EnsureChildControls();
            RegisterCallBackScript();
            UIHelper.DisableRoleSelection(Page);
            if (String.IsNullOrEmpty(Request[WOConstants.QRY_CONTRACTID]) ||
                String.IsNullOrEmpty(Request[Constants.QRY_PROJECTID]))
                Response.Redirect(
                    &quot;~/Modules/CONTMGT/Contracts.aspx?PID=&quot; + Request[Constants.QRY_PROJECTID] ?? String.Empty, true);
            _ContractID = Request.QueryString[WOConstants.QRY_CONTRACTID].ToInt32_2();
            _ProjectID = Request.QueryString[WOConstants.QRY_PROJECTID].ToInt32_2();
            lblErr.Text = &quot;&quot;;
            txtWONo.ReadOnly = true;
            IsNewInstance = (String.IsNullOrEmpty(Request[WOConstants.QRY_WORKORDERID]));
            if (!IsNewInstance)
                _WorkOrderID = Request.QueryString[WOConstants.QRY_WORKORDERID].ToInt32_2();

            isVersion = (!String.IsNullOrEmpty(Request.QueryString[&quot;Version&quot;]) &amp;&amp;
                         (Request.QueryString[&quot;Version&quot;].Equals(&quot;true&quot;)));
            isEditVersion = (!String.IsNullOrEmpty(Request.QueryString[&quot;IsEditVersion&quot;]) &amp;&amp;
                             (Request.QueryString[&quot;IsEditVersion&quot;].Equals(&quot;true&quot;)));
            tdEquipmentUnitCost.InnerText = (isVersion ? &quot;Work Order Unit Cost in &quot; : &quot;Estimated Unit Cost in &quot;) +
                                            LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) + &quot; :&quot;;
            tdSummary.InnerText = WorkOrderType.Equals(&quot;E&quot;) ? &quot;Summary of Equipments :&quot; : &quot;Summary of Quantities :&quot;;

            PopulateDataTables();
            if (!IsPostBack)
            {
                wdcCreatedOn.CalendarLayout.Culture = DateFormatCulture.GetDateFormatCulture();
                if (ProjectMode.Equals(&quot;I&quot;) || (IsNewInstance || IsCopyWO))
                {
                    wdcCreatedOn.MinDate = ProjectMode.Equals(&quot;L&quot;) ? DateTime.UtcNow : DefaultRecordDate;
                    wdcCreatedOn.MaxDate = ProjectMode.Equals(&quot;L&quot;) ? DateTime.UtcNow : IntegrationCutoffDate;
                }
                if (ProjectMode.Equals(&quot;I&quot;))
                {
                    dtStartDate.MinDate = dtEndDate.MinDate = dtWODate.MinDate = DefaultRecordDate;
                    dtStartDate.MaxDate = dtEndDate.MaxDate = dtWODate.MaxDate = IntegrationCutoffDate;
                    dtStartDate.Value = dtEndDate.Value = dtWODate.Value = DefaultRecordDate;
                }
                if (WorkOrderType.Equals(&quot;E&quot;))
                {
                    DataSet dsModuleData = ItemManager.Instance.GetModuleData(Constants.MODID_CONTMGT, _ContractID,
                                                                              Session[Constants.EIS_ADDITIONAL_INFO] ==
                                                                              null
                                                                                  ? string.Empty
                                                                                  : Session[
                                                                                      Constants.EIS_ADDITIONAL_INFO].
                                                                                        ToString2());
                    if (dsModuleData.Tables.Count &gt; 2)
                    {
                        UIHelper.BindDropDownData(ddlEquipmentUnit, dsModuleData.Tables[2], &quot;Unit&quot;, &quot;UnitID&quot;);
                    }
                }

                if (IsNewInstance || IsCopyWO)
                {
                    //New Record Creation
                    SetPreReqData();
                    hdnWorkOrderID.Value = &quot;&quot;;
                    PageTitle = WorkOrderType.Equals(&quot;E&quot;) ? &quot;New Equipment Hire Order&quot; : &quot;New Work Order&quot;;
                    chkWithMaterial.Checked = chkWithEquipment.Checked = chkWithLabour.Checked = true;
                    wdcCreatedOn.Value = ProjectMode.Equals(&quot;L&quot;) ? DateTime.UtcNow : DefaultRecordDate; //Fix for R19-21753
                    DataTable dtContractSettings = BL.Instance.GetOwnerDetails(_ContractID);
                    hdnValidateWOQty.Value = bool.Parse(dtContractSettings.Rows[0][&quot;ValidateWOQty&quot;].ToString()) ? &quot;1&quot; : &quot;0&quot;;
                    if (IsCopyWO)
                    {
                        LoadWorkOrderInstanceDetails();
                    }
                }
                else
                {
                    //editing here
                    LoadWorkOrderInstanceDetails();
                    (attachments as AttachmentsControl).InstanceID = _WorkOrderID.ToString2();
                    (attachments as AttachmentsControl).SrcType = WOConstants.MODULE_NAME;
                    LinksUserControl.SetInstanceAndType(_WorkOrderID.ToString2(), WOConstants.MODULE_NAME);
                    PageTitle = WorkOrderType.Equals(&quot;E&quot;) ? &quot;Edit Equipment Hire Order&quot; : &quot;Edit Work Order&quot;;
                }

                if (hdnStage.Value != &quot;1&quot; &amp;&amp; !(IsNewInstance || IsCopyWO))
                {
                    chkWithEquipment.Enabled =
                        chkWithLabour.Enabled =
                        chkWithMaterial.Enabled =
                        dtStartDate.Enabled =
                        dtEndDate.Enabled =
                        dtWODate.Enabled =
                        txtExtReference.Enabled = false;
                    if (MainToolBar.GetMenuReference(&quot;lnkEdit&quot;) != null)
                        MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).Enabled = false;
                    if (!isVersion)
                    {
                        if (!WorkOrderType.Equals(&quot;E&quot;))
                        {
                            uwgWOItems.Columns.FromKey(&quot;WOQuantity&quot;).AllowUpdate = AllowUpdate.No;
                            uwgWOItems.Columns.FromKey(&quot;WOQuantity&quot;).CellStyle.BackColor = Color.Transparent;
                        }
                    }
                    else if (WorkOrderType.Equals(&quot;E&quot;))
                    {
                        MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).Enabled =
                            MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).Enabled = true;
                    }
                }

                hdnWoQuantityDefault.Value = &quot;0&quot;;
                hdnVisibleTab.Value = WOConstants.TAB_WO;
                if (!string.IsNullOrEmpty(Request[&quot;Tab&quot;]) &amp;&amp; Request[&quot;Tab&quot;] == WOConstants.TAB_QUOT)
                {
                    hdnVisibleTab.Value = WOConstants.TAB_QUOT;
                    Page.ClientScript.RegisterStartupScript(GetType(), &quot;S&quot;,
                                                            @&quot;showPane(document.getElementById(document.getElementById(&#39;&quot; +
                                                            hdnVisibleTab.ClientID + &quot;&#39;).value), true);&quot;, true);
                }
                wdcCreatedOn.Enabled = !ProjectMode.Equals(&quot;L&quot;); //Fix for R19-21753
            }
            else
                SetIssueMode(rbQuotation.Checked ? IssueMode.WithQuotation : IssueMode.Direct);

            //Make visible only if the WO Type = W and WO status is DRAFT
            if ((!string.IsNullOrEmpty(WorkOrderType) &amp;&amp; (WorkOrderType == &quot;W&quot;)) &amp;&amp; (!isVersion) &amp;&amp; (string.IsNullOrEmpty(hdnStage.Value) || hdnStage.Value == WOConstants.WO_STAGE_DRAFT.ToString2()))
            {
                divSetWOQuantity.Visible = true;
                if (hdnWoQuantityDefault.Value == &quot;0&quot;)
                {
                    rbSetEditQtyToZero.Checked = true;
                    rbSetEditQtyToAvail.Checked = false;
                }
                else
                {
                    rbSetEditQtyToZero.Checked = false;
                    rbSetEditQtyToAvail.Checked = true;
                }
            }
            else
                divSetWOQuantity.Visible = false;

            //if (hdnVisibleTab.Value == WOConstants.TAB_WO)
            //{
            //    MainToolBar.HideMenu(&quot;lnkNew&quot;);
            //    MainToolBar.HideMenu(&quot;lnkEdit&quot;);
            //    MainToolBar.HideMenu(&quot;lnkDelete&quot;);
            //    MainToolBar.HideMenu(&quot;lnkShortClose&quot;);
            //    MainToolBar.HideMenu(&quot;lnkActions&quot;);
            //}
            SetLabelsBasedOnWOType();
            lblQuotError.Style.Add(&quot;display&quot;, &quot;none&quot;);


            if (hdnStage.Value == WOConstants.WO_STAGE_APPROVED.ToString2())
            {
                MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).Enabled =
                    MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).Enabled = true;
            }
            else
            {
                if (!WorkOrderType.Equals(&quot;E&quot;))
                {
                    //if (isVersion)
                    //    MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).Text =
                    //        MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).Text.Replace(&quot;Edit&quot;, &quot;View&quot;);
                    MainToolBar.DisableMenu(&quot;lnkEdit&quot;);
                }
            }

            if (IsAwarded())
            {
                hdnIsAwarded.Value = &quot;1&quot;;
                if (hdnVisibleTab.Value == WOConstants.TAB_QUOT)
                    MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).Enabled =
                        MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).Enabled = false;
            }
            litCurrency.Text = LocalizationManager.GetModuleCurrency(Constants.MODID_CONTMGT, _ContractID.ToString2());

            if (HideContractorFilter)
            {
                trSegment.Style.Value =
                    trCategory.Style.Value =
                    trCertification.Style.Value = trContractorFilterButton.Style.Value = &quot;display:none&quot;;
            }

            if ((hdnStage.Value == WOConstants.STAGE_APPROVE_AMENDMENT.ToString2()) ||
                (hdnStage.Value == WOConstants.STAGE_ISSUED.ToString2()))
            {
                SetGeneralTabReadOnly(true);
                SetSOQTabReadOnly(true);
                SetQuotationsTabReadOnly(true);
                if (MainToolBar.GetMenuReference(&quot;lnkDelete&quot;) != null)
                    MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).Enabled = false;
            }

            if (!(IsNewInstance || IsCopyWO))
                PageTitle = WorkOrderType.Equals(&quot;E&quot;) ? &quot;Edit Equipment Hire Order&quot; : &quot;Edit Work Order&quot;;

            if (prepaymentPicker.Visible != false)
            {
                PageTitle = &quot;select pre-payment rule&quot;;
            }

            if (retentionPicker.Visible != false)
            {
                PageTitle = &quot;Select Retention Rule&quot;;
            }

            List&lt;string&gt; WOModuleComponent = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_WORKORD);
            if (WOModuleComponent.Contains(&quot;WOExternalReferenceEditable&quot;))
            {
                trExtReference.Style.Add(&quot;display&quot;, &quot;block&quot;);//Customer WO No. should not be editable if component &quot;WOExternalReferenceEditable&quot; is not there in build 
            }
            else
            {
                trExtReference.Style.Add(&quot;display&quot;, &quot;none&quot;);
            }

        }

        #endregion

        #region Event handlers

        private void itemPicker_MultipleSelectedIndexChanged(object sender, ClickEventArgs e)
        {
            List&lt;Item&gt; Items = itemPicker.GetMultipleDTOFromHTTP();
            itemPicker.PickerText.Text = &quot;&quot;;
            decimal TotAmt = 0.0M;
            TotAmt = 0.0M;
            foreach (Item conItem in Items)
            {
                RowsCollection rows = uwgWOItems.Rows;
                for (int i = 0; i &lt; rows.Count; i++)
                {
                    if (rows[i].Cells.FromKey(&quot;ItemID&quot;).Value.ToInt32_2() == (conItem.ItemID ?? 0))
                    {
                        ShowDiv(ItemDivEnums.CreateWO);
                        hdnVisibleTab.Value = WOConstants.TAB_BOQ;

                        Page.ClientScript.RegisterClientScriptBlock(GetType(), &quot;Item already added.&quot;,
                                                                    &quot;&lt;script&gt; alert(&#39;The selected &quot; + UIHelper.JavascriptEncode(ItemNameAbbr) +
                                                                    &quot; has already been added to the work order.&#39;);&lt;/script&gt;&quot;);
                        return;
                    }
                    if (conItem.Description.Contains(&quot;Complete item&quot;) ||
                        conItem.Description.Contains(&quot;Noncontract item&quot;))
                    {
                    }
                    TotAmt += rows[i].Cells.FromKey(&quot;UnitPrice&quot;).Value.ToDecimal2() *
                              rows[i].Cells.FromKey(&quot;WOQuantity&quot;).Value.ToDecimal2();
                    rows[i].Cells.FromKey(&quot;Amount&quot;).Value = rows[i].Cells.FromKey(&quot;UnitPrice&quot;).Value.ToDecimal2() *
                                                            rows[i].Cells.FromKey(&quot;WOQuantity&quot;).Value.ToDecimal2();
                }
                uwgWOItems.Rows.Add();

                UltraGridRow row = uwgWOItems.Rows[uwgWOItems.Rows.Count - 1];
                row.Cells.FromKey(&quot;ItemID&quot;).Value = conItem.ItemID;
                row.Cells.FromKey(&quot;LineNo&quot;).Value = conItem.LineNo;
                row.Cells.FromKey(&quot;StandardItemNo.&quot;).Value = conItem.StandardItemNo;
                row.Cells.FromKey(&quot;Description&quot;).Value = conItem.Description;
                row.Cells.FromKey(&quot;Unit&quot;).Value = conItem.Unit;
                row.Cells.FromKey(&quot;AvailableQuantity&quot;).Value = GetAvailableQuantity(conItem.ItemID.Value,
                                                                                    ((IsNewInstance || IsCopyWO)
                                                                                         ? 0
                                                                                         : Request.QueryString[
                                                                                             WOConstants.QRY_WORKORDERID
                                                                                               ].ToInt32_2()));
                //to be calculated
                row.Cells.FromKey(&quot;ContractUnitPrice&quot;).Value = GetUnitPrice(conItem.ItemID.Value);
                row.Cells.FromKey(&quot;UnitPrice&quot;).Value = conItem.UnitPrice;
                //row.Cells.FromKey(&quot;WOQuantity&quot;).Value = 0.0;
                //row.Cells.FromKey(&quot;WOQuantity&quot;).Value =  hdnWoQuantityDefault.Value.ToString() == &quot;0&quot; ? 0.0 : row.Cells.FromKey(&quot;AvailableQuantity&quot;).Value;

                if (hdnWoQuantityDefault.Value.ToString() == &quot;0&quot;)
                {
                    row.Cells.FromKey(&quot;WOQuantity&quot;).Value = 0.0;
                }
                else
                {
                    row.Cells.FromKey(&quot;WOQuantity&quot;).Value = row.Cells.FromKey(&quot;AvailableQuantity&quot;).Value.ToInt32_2() &lt; 0 ? 0 : row.Cells.FromKey(&quot;AvailableQuantity&quot;).Value;
                }
                row.Cells.FromKey(&quot;Amount&quot;).Value = 0.0;
            }
            hdnTotalAmt.Value = TotAmt.ToString2();
            ShowDiv(ItemDivEnums.CreateWO);
            hdnVisibleTab.Value = WOConstants.TAB_BOQ;
        }

        protected void OnCheckedChanged_Click(object sender, EventArgs e)
        {
            if (!WorkOrderType.Equals(&quot;E&quot;))
            {
                int count = uwgWOItems.Rows.Count;
                if (count == 0)
                    return;
                else
                {
                    decimal total = 0.0M;

                    for (int i = 0; i &lt; count; i++)
                    {
                        int ItemID = uwgWOItems.Rows[i].Cells.FromKey(&quot;ItemID&quot;).Value.ToInt32_2();
                        uwgWOItems.Rows[i].Cells.FromKey(&quot;ContractUnitPrice&quot;).Value = GetUnitPrice(ItemID);

                        uwgWOItems.Rows[i].Cells.FromKey(&quot;Amount&quot;).Value =
                            uwgWOItems.Rows[i].Cells.FromKey(&quot;ContractUnitPrice&quot;).Value.ToDecimal2() *
                            uwgWOItems.Rows[i].Cells.FromKey(&quot;WOQuantity&quot;).Value.ToDecimal2();

                        total += uwgWOItems.Rows[i].Cells.FromKey(&quot;Amount&quot;).Value.ToDecimal2();
                    }


                    lblWOAmount.Text = total.ToString(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture);
                    hdnTotalAmt.Value = total.ToString2();
                }
            }
        }

        protected void BtnCancelItemPicker_Click(object sender, EventArgs e)
        {
            ShowDiv(ItemDivEnums.CreateWO);
            hdnVisibleTab.Value = WOConstants.TAB_WO;
        }

        protected void btnSave_Click(object sender, EventArgs e)
        {
            WorkflowEnabledSaveHandler();
            //SaveWorkOrder();
        }

        protected void Cncl_Click(object sender, EventArgs e)
        {
            Response.Redirect(
                &quot;~/Common/BrixListPage.aspx?context=WORKORD&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&quot;.Format2(
                    Request[WOConstants.QRY_PROJECTID], Request[WOConstants.QRY_CONTRACTID]), false);
        }

        protected void btnFetchContractor_Click(object sender, EventArgs e)
        {
            if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX))
            {
                int count = 0;
                DataSet ds = null;
                string mappedCompany = String.Empty;
                string filterCriteria = &quot;&quot;;
                DataTable SubContracotrs = WORKORDManager.Instance.GetSubContractorsList(_ContractID);
                DataTable dtMainSubContractors = SubContracotrs.Clone();
                string contractorList = &quot;&quot;;
                foreach (DataRow dr in SubContracotrs.Rows)
                    contractorList += dr[&quot;ContractorID&quot;] + &quot;;&quot;;
                contractorList = contractorList.Substring(0, (contractorList.Length - 1));
                DataTable dtMap = IntegrationConnectorManager.Instance.GetERPObjectMapInfo(Request[&quot;ContractID&quot;],
                                                                                           AMP3Object.CONTMGT, null,
                                                                                           AMP3Object.UNKNOWN,
                                                                                           RegisteredEIS.AX);
                if (dtMap == null || dtMap.Rows.Count &lt;= 0)
                {
                    Page.ClientScript.RegisterClientScriptBlock(GetType(), &quot;Error&quot;,
                                                                &quot;&lt;script&gt;alert(&lt;%= Aurigo.AMP3.Resources.TerminologyResources.ResourceFactory.Instance.GetString(&#39;Contract is not mapped to AX Sub project.&#39;) %&gt;); &lt;/script&gt;&quot;);
                }
                else
                    mappedCompany = dtMap.Rows[0][&quot;ERPCompany&quot;].ToString();


                var confilter = new ConnectionFilter(filterCriteria, null, null, null, null);
                var objAdditionalInfo = new EISAdditionalInfo(RegisteredEIS.AX);
                objAdditionalInfo.AddInfo(Constants.EIS_ADDITIONAL_INFO, mappedCompany);
                objAdditionalInfo.AddInfo(&quot;Condition&quot;, contractorList);
                if (ddlCategory.SelectedValue.Equals(&quot;--Select One--&quot;))
                    objAdditionalInfo.AddInfo(&quot;CategoryId&quot;, &quot;&quot;);
                else
                    objAdditionalInfo.AddInfo(&quot;CategoryId&quot;, ddlCategory.SelectedValue);

                if (ddlSegment.SelectedValue.Equals(&quot;--Select One--&quot;))
                    objAdditionalInfo.AddInfo(&quot;SegmentId&quot;, &quot;&quot;);
                else
                    objAdditionalInfo.AddInfo(&quot;SegmentId&quot;, ddlSegment.SelectedValue);

                if (ddlCertification.SelectedValue.Equals(&quot;--Select One--&quot;))
                    objAdditionalInfo.AddInfo(&quot;CertificationId&quot;, &quot;&quot;);
                else

                    objAdditionalInfo.AddInfo(&quot;CertificationId&quot;, ddlCertification.SelectedValue);

                var dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
                dictAdditionalInfo.Add(RegisteredEIS.AX, objAdditionalInfo);

                var ConBrixInfo = new List&lt;ConnectionBrixInfo&gt;();

                var connectorParameter = new ConnectorParameters(dictAdditionalInfo, MethodBase.GetCurrentMethod(),
                                                                 AMP3ObjectType.Unknown, confilter, null);

                if (IntegrationConnectorManager.HandleIntegration(connectorParameter, ref count, ref ds, true))
                {
                    if (ds != null &amp;&amp; ds.Tables.Count != 0 &amp;&amp; ds.Tables[0].Rows.Count &gt; 0)
                    {
                        foreach (DataRow drN in ds.Tables[0].Rows)
                        {
                            if (drN != null &amp;&amp; drN[&quot;ContractorID&quot;] != null)
                            {
                                DataRow drMain = dtMainSubContractors.NewRow();
                                drMain = SubContracotrs.Select(&quot;ContractorID = &#39;&quot; + drN[&quot;ContractorID&quot;] + &quot;&#39;&quot;)[0];
                                dtMainSubContractors.ImportRow(drMain);
                            }
                        }
                    }
                    if (dtMainSubContractors.Rows.Count == 0)
                    {
                        DataRow drM = dtMainSubContractors.NewRow();
                        dtMainSubContractors.Rows.Add(drM);
                        dtMainSubContractors.Rows[0][0] = &quot;No Data&quot;;
                        dtMainSubContractors.Rows[0][1] = &quot;No Data&quot;;
                    }
                    ddlContractors.DataSource = dtMainSubContractors;
                    ddlContractors.DataTextField = &quot;Contact&quot;;
                    ddlContractors.DataValueField = &quot;ContractorID&quot;;
                    ddlContractors.DataBind();
                }
            }
            trQuotTemplate.Style.Add(&quot;display&quot;, &quot;table-row&quot;);
        }

        protected void btnSaveQuot_Click(object sender, EventArgs e)
        {
            //WorkOrderDTO WODTO = WORKORDManager.Instance.GetWorkOrderDetails(_WorkOrderID);
            if (ddlContractors.SelectedValue == &quot;No Data&quot;)
            {
                string alertMsg = &quot;Please select a contractor&quot;;
                Page.ClientScript.RegisterStartupScript(GetType(), &quot;alerT&quot;, &quot;alert(&#39;&quot; + alertMsg + &quot;&#39;);&quot;, true);
                return;
            }
            DateTime quotationDate = ((DateTime)wbcDate.Value).Date;
            if (dtStartDate.Value.ToDateTime_MWCulture().Date &lt; quotationDate)
            {
                SetErrorMessage(&quot;Start Date cannot be less than the Quotation Date&quot;);
                hdnVisibleTab.Value = WOConstants.TAB_QUOT;
                trQuotTemplate.Style.Add(&quot;display&quot;, &quot;table-row&quot;);
                return;
            }
            if (quotationDate &lt; dtWODate.Value.ToDateTime_MWCulture().Date)
            {
                SetErrorMessage(&quot;Quotation Date cannot be less than the Work Order Date&quot;);
                hdnVisibleTab.Value = WOConstants.TAB_QUOT;
                trQuotTemplate.Style.Add(&quot;display&quot;, &quot;table-row&quot;);
                return;
            }
            if (quotationDate &lt; Convert.ToDateTime(tdApprovedOn.InnerText, DateFormatCulture.GetDateFormatCulture()))
            {
                SetErrorMessage(&quot;Quotation Date cannot be less than the Approval Date&quot;);
                hdnVisibleTab.Value = WOConstants.TAB_QUOT;
                trQuotTemplate.Style.Add(&quot;display&quot;, &quot;table-row&quot;);
                return;
            }
            decimal total = 0.0M;
            int ContractorID = 0;
            int qid = 0;
            string Contractor = ddlContractors.Items[ddlContractors.SelectedIndex].Value;
            string ContractorName = ddlContractors.Items[ddlContractors.SelectedIndex].Text;
            DataSet ds = new BrixDataSet();
            DataTable Items = ds.Tables.Add(&quot;Item&quot;);
            int i;
            DataRow Item;
            string ItemXML = string.Empty;

            if (!string.IsNullOrEmpty(Contractor))
            {
                string[] strContr = Contractor.Split(&#39;,&#39;);

                ContractorID = strContr[0].ToInt32_2();
            }

            Items.Columns.Add(&quot;ItemID&quot;, Type.GetType(&quot;System.Int32&quot;));
            Items.Columns.Add(&quot;UnitPrice&quot;, Type.GetType(&quot;System.Double&quot;));

            for (i = 0; i &lt; uwgQuotItems.Rows.Count; i++)
            {
                Item = Items.NewRow();
                string itemIdCol = WorkOrderType.Equals(&quot;E&quot;) ? &quot;EquipmentID&quot; : &quot;ItemID&quot;;
                Item[&quot;ItemID&quot;] = uwgQuotItems.Rows[i].Cells.FromKey(itemIdCol).Text.ToInt32_2();
                Item[&quot;UnitPrice&quot;] = uwgQuotItems.Rows[i].Cells.FromKey(&quot;Rate&quot;).Text.ToDouble2();
                total += uwgQuotItems.Rows[i].Cells.FromKey(&quot;Rate&quot;).Text.ToDecimal2() *
                         uwgQuotItems.Rows[i].Cells.FromKey(&quot;Quantity&quot;).Text.ToDecimal2();
                Items.Rows.Add(Item);
            }

            ItemXML = ds.GetXml();
            WORKORDManager.Instance.CreateWorkOrderQuotations(
                ((!String.IsNullOrEmpty(hdnQuotationID.Value)) ? hdnQuotationID.Value.ToInt32_2() : 0), _WorkOrderID,
                ContractorID, ContractorName, wbcDate.Value.ToDateTime_MWCulture(), txtQNotes.Text, total,
                WOConstants.QUOTATION_STAGE_RECIEVED, ItemXML, qid);
            BindQuotationData();
            trQuotTemplate.Style.Add(&quot;display&quot;, &quot;none&quot;);
            wneTotal.ValueDecimal = 0;
            hdnVisibleTab.Value = WOConstants.TAB_QUOT;

            if (rbDirect.Checked)
            {
                ListItem li = ddlWOContractor.Items.FindByValue(ContractorID.ToString2());
                if (li != null)
                {
                    ddlWOContractor.SelectedItem.Selected = false;
                    li.Selected = true;
                }
            }
        }

        protected void uwgQuotations_InitializeRow(object sender, RowEventArgs e)
        {
            int status = e.Row.Cells.FromKey(&quot;Status&quot;).Value.ToInt32_2();
            e.Row.Cells.FromKey(&quot;Status&quot;).Style.BackgroundImage = (status == WOConstants.QUOTATION_STAGE_REJECTED)
                                                                      ? &quot;../../Images/toolbar/IcnUnapprove.gif&quot;
                                                                      : (status == WOConstants.QUOTATION_STAGE_AWARDED)
                                                                            ? &quot;../../Images/toolbar/IcnAward.gif&quot;
                                                                            : null;

            e.Row.Cells.FromKey(&quot;Status&quot;).Style.Padding.Left = new Unit(&quot;16px&quot;, CultureInfo.CurrentCulture);
            e.Row.Cells.FromKey(&quot;Status&quot;).Style.CustomRules = &quot;background-repeat: no-repeat&quot;;
            e.Row.Cells.FromKey(&quot;Status&quot;).Value = (status == WOConstants.QUOTATION_STAGE_REJECTED)
                                                      ? &quot;Rejected&quot;
                                                      : (status == WOConstants.QUOTATION_STAGE_AWARDED)
                                                            ? &quot;Awarded&quot;
                                                            : &quot;Received&quot;;
            e.Row.Cells.FromKey(&quot;Notes&quot;).Title = e.Row.Cells.FromKey(&quot;Notes&quot;).Text;
        }

        protected void uwgWOItems_InitializeRow(object sender, RowEventArgs e)
        {
            string workOrderRateCol = WorkOrderType.Equals(&quot;E&quot;) ? &quot;ActualUnitCost&quot; : &quot;UnitPrice&quot;;
            if (e.Row.Cells.Exists(&quot;IsShortClose&quot;) &amp;&amp; e.Row.Cells.FromKey(&quot;IsShortClose&quot;).Value.ToBoolean2())
            {
                e.Row.Style.BackColor = Color.LightGray;
                if (e.Row.Cells.Exists(&quot;WOQuantity&quot;)) e.Row.Cells.FromKey(&quot;WOQuantity&quot;).AllowEditing = AllowEditing.No;
                e.Row.Cells.FromKey(workOrderRateCol).AllowEditing = AllowEditing.No;
            }
            else if (e.Row.Cells.Exists(&quot;CertifiedQuantity&quot;) &amp;&amp;
                     e.Row.Cells.FromKey(&quot;CertifiedQuantity&quot;).Value.ToDecimal2() != 0)
            {
                e.Row.Cells.FromKey(workOrderRateCol).AllowEditing = AllowEditing.No;
                e.Row.Cells.FromKey(workOrderRateCol).Style.BackColor = Color.Transparent;
            }
            if (IsCopyWO &amp;&amp; e.Row.Cells.Exists(&quot;WOQuantity&quot;))
            {
                if (e.Row.Cells.Exists(&quot;AvailableQuantity&quot;))
                    e.Row.Cells.FromKey(&quot;AvailableQuantity&quot;).Value =
                        e.Row.Cells.FromKey(&quot;AvailableQuantity&quot;).Value.ToDecimal2() - e.Row.Cells.FromKey(&quot;WOQuantity&quot;).Value.ToDecimal2();
                e.Row.Cells.FromKey(&quot;WOQuantity&quot;).Value = 0;
            }
        }

        protected void btnCancelQuot_Click(object sender, EventArgs e)
        {
            ddlContractors.ClearSelection();
            wbcDate.Value = MWDateTimeHelper.MWToday;
            hdnVisibleTab.Value = WOConstants.TAB_QUOT;
        }

        protected void btnExport_Click(object sender, EventArgs e)
        {
            //For Equipment Hire Order
            if (WorkOrderType == &quot;E&quot;)
            {
                uwgExcelExporter.WorksheetName = &quot;Equipment Hire Order Equipments&quot;;
                uwgExcelExporter.DownloadName = txtWONo.Text + &quot;_Equipments.XLS&quot;;
                if (uwgWOItems.Columns.Exists(&quot;EstimatedUnitCost&quot;))
                    uwgWOItems.Columns.FromKey(&quot;EstimatedUnitCost&quot;).Hidden = true;
                if (uwgWOItems.Columns.Exists(&quot;EstimatedAmount&quot;))
                    uwgWOItems.Columns.FromKey(&quot;EstimatedAmount&quot;).Hidden = true;
            }
            else
            {
                uwgExcelExporter.WorksheetName = &quot;Work Order &quot; +
                                                 LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR) + &quot;s&quot;;
                uwgExcelExporter.DownloadName = txtWONo.Text + &quot;_&quot; +
                                                LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR) + &quot;s.XLS&quot;;
            }

            var book = new Workbook();
            //bool colExists = true;
            //
            if ((uwgWOItems.Columns.FromKey(&quot;UnitPrice&quot;) == null) || (uwgWOItems.Columns.FromKey(&quot;UnitPrice&quot;).Hidden))
            {
                //colExists = false;
                if (!uwgWOItems.Columns.Exists(&quot;Rate&quot;))
                    uwgWOItems.Columns.Add(new UltraGridColumn(&quot;Rate&quot;, &quot;Rate&quot;, ColumnType.NotSet, &quot;0.0000&quot;), true);
                uwgWOItems.Columns.FromKey(&quot;Rate&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;
                uwgWOItems.Columns.FromKey(&quot;Rate&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                uwgWOItems.Columns.FromKey(&quot;Rate&quot;).CellStyle.BackColor = Color.Yellow;
            }
            if (uwgWOItems.Columns.Exists(&quot;CompletedQuantity&quot;))
                uwgWOItems.Columns.FromKey(&quot;CompletedQuantity&quot;).Hidden = true;
            //uwgWOItems.Columns.FromKey(&quot;UnitPrice&quot;).Format = Constants.FORMAT_UNIT_PRICE;
            //uwgWOItems.Columns.FromKey(&quot;UnitPrice&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
            //uwgWOItems.Columns.FromKey(&quot;UnitPrice&quot;).CellStyle.BackColor = System.Drawing.Color.Yellow;

            if (uwgWOItems.Columns.Exists(&quot;WOQuantity&quot;))
            {
                uwgWOItems.Columns.FromKey(&quot;WOQuantity&quot;).CellStyle.BackColor = Color.White;
                uwgWOItems.Columns.FromKey(&quot;WOQuantity&quot;).Header.Caption = &quot;WOQuantity&quot;;
            }
            if (uwgWOItems.Columns.Exists(&quot;StandardItemNo.&quot;))
            {
                uwgWOItems.Columns.FromKey(&quot;StandardItemNo.&quot;).Header.Caption = &quot;StandardItemNo.&quot;;
            }
            if (uwgWOItems.Columns.Exists(&quot;ContractorID&quot;))
                uwgWOItems.Columns.FromKey(&quot;ContractorID&quot;).Hidden = false;

            if (uwgWOItems.Columns.Exists(&quot;LineNo&quot;))
                uwgWOItems.Columns.FromKey(&quot;LineNo&quot;).Header.Caption = &quot;LineNo&quot;;

            if (uwgWOItems.Columns.Exists(&quot;EstimatedUnitCost&quot;))
            {
                uwgWOItems.Columns.FromKey(&quot;EstimatedUnitCost&quot;).CellStyle.BackColor = Color.White;
            }

            uwgWOItems.Columns[0].Hidden = true;
            //

            book = uwgExcelExporter.Export(uwgWOItems);
            string sheetName = &quot;Work Order &quot; + LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR) + &quot;s&quot;;

            //book.Worksheets[0].Name = sheetName;
            //uwgExcelExporter.Export(uwgWOItems
            uwgExcelExporter.Export(uwgWOItems); //, book.Worksheets[sheetName]);

            //
            if (uwgWOItems.Columns.FromKey(&quot;Rate&quot;) != null)
            {
                uwgWOItems.Columns.Remove(uwgWOItems.Columns.FromKey(&quot;Rate&quot;));
            }
            if (uwgWOItems.Columns.Exists(&quot;WOQuantity&quot;))
            {
                uwgWOItems.Columns.FromKey(&quot;WOQuantity&quot;).Header.Caption = &quot;WO Quantity&quot;;
                uwgWOItems.Columns.FromKey(&quot;WOQuantity&quot;).CellStyle.BackColor = Color.Yellow;
            }
            if (uwgWOItems.Columns.Exists(&quot;StandardItemNo.&quot;))
            {
                uwgWOItems.Columns.FromKey(&quot;StandardItemNo.&quot;).Header.Caption = &quot;Standard Item No.&quot;;
            }
            if (uwgWOItems.Columns.Exists(&quot;LineNo.&quot;))
                uwgWOItems.Columns.FromKey(&quot;LineNo&quot;).Header.Caption = &quot;Line No&quot;;

            if (uwgQuotations.Columns.Exists(&quot;StandardItemNo.&quot;))
                uwgQuotations.Columns.FromKey(&quot;ContractorID&quot;).Hidden = true;

            uwgWOItems.Columns[0].Hidden = false;

            //
        }

        protected void lnkReject_Click(object sender, EventArgs e)
        {
            string rej = hdnMulti.Value;
            hdnMulti.Value = &quot;&quot;;
            if (rej.LastIndexOf(&#39;,&#39;) &gt; 0)
                rej = rej.Substring(0, rej.LastIndexOf(&#39;,&#39;));
            if (rej == &quot;&quot;)
                return;

            WORKORDManager.Instance.SetQuotationStatus(rej, WOConstants.QUOTATION_STAGE_REJECTED);
            BindQuotationData();
            hdnVisibleTab.Value = WOConstants.TAB_QUOT;
        }

        protected void lnkRevert_Click(object sender, EventArgs e)
        {
            string rev = hdnMulti.Value;
            hdnMulti.Value = &quot;&quot;;
            if (rev.LastIndexOf(&#39;,&#39;) &gt; 0)
                rev = rev.Substring(0, rev.LastIndexOf(&#39;,&#39;));
            if (rev == &quot;&quot;)
                return;

            WORKORDManager.Instance.SetQuotationStatus(rev, WOConstants.QUOTATION_STAGE_RECIEVED);
            BindQuotationData();

            hdnVisibleTab.Value = WOConstants.TAB_QUOT;
        }

        protected void uwgQuotItems_InitializeRow(object sender, RowEventArgs e)
        {
            if (e.Row.HasCells)
                e.Row.Cells.FromKey(&quot;Rate&quot;).Style.BackColor = Color.Yellow;
        }

        protected void lnkEdit_Click(object sender, EventArgs e)
        {
            switch (hdnVisibleTab.Value)
            {
                case WOConstants.TAB_QUOT:
                    if (hdnQuotationID == null || string.IsNullOrEmpty(hdnQuotationID.Value))
                        return;

                    DataSet ds = WORKORDManager.Instance.GetQuotation(hdnQuotationID.Value.ToInt32_2(), _WorkOrderID);
                    ListItem li = null;
                    string contractorId = rbDirect.Checked ? ddlWOContractor.SelectedValue : ds.Tables[0].Rows[0][&quot;ContractorID&quot;].ToString2();
                    string contractor = rbDirect.Checked ? ddlWOContractor.SelectedItem.Text : ds.Tables[0].Rows[0][&quot;Contractor&quot;].ToString2();
                    if ((li = ddlContractors.Items.FindByValue(contractorId)) == null)
                    {
                        li = new ListItem(contractorId, contractor);
                        ddlContractors.Items.Add(li);
                    }
                    ddlContractors.SelectedItem.Selected = false;
                    li.Selected = true;

                    wbcDate.Value = ds.Tables[0].Rows[0][&quot;Date&quot;];
                    txtQNotes.Text = ds.Tables[0].Rows[0][&quot;Notes&quot;].ToString2();
                    wneTotal.Value = ds.Tables[0].Rows[0][&quot;TotalAmount&quot;];

                    uwgQuotItems.DataSource = ds.Tables[1];
                    uwgQuotItems.DataBind();
                    SetQuotationItemsGridColumns();
                    trQuotTemplate.Style.Add(&quot;display&quot;, &quot;table-row&quot;);

                    hdnVisibleTab.Value = WOConstants.TAB_QUOT;
                    break;
            }
        }

        protected void lnkDelete_Click(object sender, EventArgs e)
        {
            switch (hdnVisibleTab.Value)
            {
                case WOConstants.TAB_QUOT:
                    string del = hdnMulti.Value;
                    hdnMulti.Value = &quot;&quot;;
                    if (del.LastIndexOf(&#39;,&#39;) &gt; 0)
                        del = del.Substring(0, del.LastIndexOf(&#39;,&#39;));
                    if (del == &quot;&quot;)
                        return;

                    WORKORDManager.Instance.DeleteQuotation(del);
                    //LoadWorkOrderInstanceDetails();
                    BindQuotationData();
                    hdnVisibleTab.Value = WOConstants.TAB_QUOT;
                    break;
                case WOConstants.TAB_BOQ:
                    if (WorkOrderType == &quot;W&quot;)
                    {
                        int exists = 0;
                        bool hasCertifiedQty = false;
                        var rowID = new List&lt;int&gt;();

                        for (int i = 0; i &lt; uwgWOItems.Rows.Count; i++)
                        {
                            if (uwgWOItems.Rows[i].Cells.FromKey(&quot;To&quot;).Value.ToString2() == &quot;true&quot; ||
                                uwgWOItems.Rows[i].Cells.FromKey(&quot;To&quot;).Value.ToString2() == &quot;1&quot;)
                            {
                                int itemId = 0;
                                int retVal = 0;
                                itemId = uwgWOItems.Rows[i].Cells.FromKey(&quot;ItemID&quot;).Value.ToInt32_2();
                                retVal = WORKORDManager.Instance.ValidateBOQDelete(_WorkOrderID, itemId);
                                exists += retVal;
                                if (isVersion)
                                    hasCertifiedQty = (uwgWOItems.Rows[i].Cells.FromKey(&quot;CertifiedQuantity&quot;).Value.ToDecimal2() &gt; 0);

                                if (retVal == 0 &amp;&amp; !hasCertifiedQty)
                                    rowID.Add(i);
                                else
                                    break;
                            }
                        }
                        if (exists &gt; 0)
                        {
                            Page.ClientScript.RegisterStartupScript(GetType(), &quot;Deleted.&quot;,
                                                                    &quot;alert (&#39;Could not delete one or more &quot; +
                                                                     UIHelper.JavascriptEncode(ItemNameAbbr) +
                                                                    &quot;s as they are part of one or more Material Issues or Purchase Indents.&#39;);&quot;,
                                                                    true);
                        }
                        else if (hasCertifiedQty)
                        {
                            Page.ClientScript.RegisterStartupScript(GetType(), &quot;Deleted.&quot;,
                                                        &quot;alert (&#39;Could not delete one or more &quot; + UIHelper.JavascriptEncode(ItemNameAbbr) + &quot;s as there exist certified quantity for them.&#39;);&quot;, true);
                        }
                        else
                        {
                            int count = 0;
                            decimal totalAmt = hdnTotalAmt.Value.ToDecimal2();
                            foreach (int i in rowID)
                            {
                                totalAmt -= uwgWOItems.Rows[i - count].Cells.FromKey(&quot;Amount&quot;).Value.ToDecimal2();
                                uwgWOItems.Rows[i - count].Delete();
                                count++;
                            }
                            hdnTotalAmt.Value = totalAmt.ToString2();
                            lblWOAmount.Text = totalAmt.ToString(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT);
                        }
                    }
                    break;
            }
        }

        protected void lnkAward_Click(object sender, EventArgs e)
        {
            try
            {
                if (hdnQuotationID == null || string.IsNullOrEmpty(hdnQuotationID.Value))
                {
                    return;
                }
                switch (
                    WORKORDManager.Instance.SetQuotationStatus(hdnQuotationID.Value, WOConstants.QUOTATION_STAGE_AWARDED)
                    )
                {
                    case -2:
                        throw new Exception(
                            &quot;Either the quotaion is already awarded or there exist another quotation which is awarded. Request denied.&quot;);
                    case -3:
                        // Issue : NCC-19930, Description : Quotation Validation messge has to be rephrashed for the BOQ
                        throw new Exception(&quot;One or more &quot; + ItemNameAbbr +
                                            &quot;s have been quoted more than the estimated rate. Request denied.&quot;);
                }
            }
            catch (Exception ex)
            {
                base.ShowError(ex.Message);
            }
            finally
            {
                //Update WorkOrderItems Table with new unit prices and update Contractor
                //LoadWorkOrderInstanceDetails();
                BindQuotationData();
                hdnVisibleTab.Value = WOConstants.TAB_QUOT;
            }
        }

        //TODO: Modify Excel import and export to work for Equipment Hire Order
        protected void btnUpload_Click(object sender, EventArgs e)
        {
            if (FileUpload1.HasFile)
            {
                string FileName = FileUpload1.PostedFile.FileName;
                string FileGuid = Guid.NewGuid().ToString2();
                string Extension = Path.GetExtension(FileUpload1.FileName);
                if (Extension.Equals(&quot;.xls&quot;, StringComparison.CurrentCultureIgnoreCase))
                {
                    if (hdnStage.Value.ToInt32_2() == 2)
                    {
                        string filePath = FileGuid + &quot;.xls&quot;;
                        FileUpload1.SaveAs(Server.MapPath(filePath));

                        DataSet obj;

                        bool status = ImportExcel(HttpContext.Current.Server.MapPath(filePath), out obj);
                        if (status)
                        {
                            SetStatusMessage(status);
                        }

                        if (obj != null
                            &amp;&amp; status)
                        {
                            ViewState[&quot;ImportData&quot;] = obj;
                        }
                        try
                        {
                            File.Delete(Server.MapPath(filePath));
                        }
                        catch
                        {
                        }

                        trQuotTemplate.Style.Add(&quot;display&quot;, &quot;table-row&quot;);
                    }
                }
                else
                {
                    SetErrorMessage(MSG_INVALID_FILE);
                }
            }
            else
            {
                SetErrorMessage(MSG_INVALID_FILE);
            }

            hdnVisibleTab.Value = WOConstants.TAB_QUOT;
        }

        protected void lnkShortClose_Click(object sender, EventArgs e)
        {
        }

        #endregion

        #region Custom Function

        private void SetLabelsBasedOnWOType()
        {
            string WOType = (Request[&quot;WOType&quot;].ToString2() == &quot;E&quot; ? &quot;Hire&quot; : &quot;Work&quot;);
            lblUserWONo.Text = lblOrderNo.Text = WOType + &quot; Order Number : &quot;;
            lblReqBy.Text = WOType + &quot; Order Requested By : &quot;;
            lblDate.Text = WOType + &quot; Order Date : &quot;;
            if (OnlyCustomerWONo)
            {
                trWorkOrderNo.Style.Add(HtmlTextWriterStyle.Display, &quot;none&quot;);
                trUserWONo.Style.Add(HtmlTextWriterStyle.Display, &quot;table-row&quot;);
                hdnValidateUserWONo.Value = &quot;1&quot;;
                if (isVersion)
                    txtUserWONo.ReadOnly = true;
            }
        }

        private void LoadWorkOrderInstanceDetails()
        {
            WorkOrderDTO WODTO = WORKORDManager.Instance.GetWorkOrderDetails(_WorkOrderID);
            if (WODTO == null)
            {
                Page.ClientScript.RegisterClientScriptBlock(GetType(), &quot;Instance deleted.&quot;,
                                                            &quot;&lt;script&gt; alert(&#39;&lt;%= Aurigo.AMP3.Resources.TerminologyResources.ResourceFactory.Instance.GetString(&#39;The Work Order instance has been deleted.&#39;) %&gt;&#39;); document.location=&#39;&quot; +
                                                            &quot;~/Common/BrixListPage.aspx?context=WORKORD&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&quot;
                                                                .Format2(UIHelper.JavascriptEncode(Request[WOConstants.QRY_PROJECTID]),
                                                                          UIHelper.JavascriptEncode(_ContractID.ToString2())) + &quot;&#39;;&lt;/script&gt;&quot;);
                return;
            }
            if (!IsCopyWO)
            {
                txtWONo.Text = WODTO.SystemWONo;
                dtStartDate.Value = WODTO.StartDate;
                dtWODate.Value = WODTO.WorkOrderDate;
                dtEndDate.Value = WODTO.EndDate;
                tdCreatedBy2.InnerText = WODTO.CreatedBy;
                wdcCreatedOn.Value = WODTO.CreatedOn;
                hdnStage.Value = WODTO.Status.ToString2();
                txtExtReference.Text = WODTO.ExtReference;
                txtUserWONo.Text = WODTO.WorkOrderNo;
                BindQuotationData();
            }
            else
            {
                txtWONo.Enabled = true;
                txtExtReference.Enabled = true;
                dtStartDate.Enabled = true;
                dtWODate.Enabled = true;
                dtEndDate.Enabled = true;
                txtUserWONo.Enabled = true;
                hdnStage.Value = WOConstants.STAGE_DRAFT.ToString2();
                WODTO.Status = WOConstants.STAGE_DRAFT;
            }
            txtTaxPayerID.Text = WODTO.TaxPayerID;
            txtLicenseState.Text = WODTO.LicenseState;
            txtLicenseCity.Text = WODTO.LicenseCity;
            txtInsurance.Text = WODTO.Insurance;
            txtWOReqBy.Text = WODTO.WorkOrderRequestedBy;
            isOldWONo = (WODTO.IsNew == null) ? true : false;
            lblContractor.Text = WODTO.Contractor;
            txtDesc.Text = WODTO.Description;
            txtNotes.Text = WODTO.Notes;
            txtScope.Text = WODTO.ScopeOfWork;
            chkWithMaterial.Checked = WODTO.WithMaterial;
            chkWithLabour.Checked = WODTO.WithLabour;
            chkWithEquipment.Checked = WODTO.WithEquipment;

            //tdCreatedOn.InnerText = WODTO.CreatedOn.ToString(Constants.FORMAT_DATE, CultureInfo.CurrentCulture);
            //remove the above after adding the attribute in td

            //Loading Item details here
            DataTable dtWOItems = WODTO.WorkOrderItems.Tables[0];
            if ((IsCopyWO) &amp;&amp; dtWOItems.Rows.Count &gt; 0)
                dtWOItems = dtWOItems.Select(&quot;IsShortClose = 0&quot;).CopyToDataTable();

            uwgWOItems.DataSource = dtWOItems;
            uwgWOItems.DataBind();
            SetWOGridColumns(WODTO);

            hdnWorkOrderID.Value = WODTO.WorkOrderID.ToString2();
            LoadContractors();

            //Set Issue mode and contractor selection
            if (hdnWorkOrderType.Value.Equals(&quot;W&quot;))
            {
                SetIssueMode(WODTO.IssueMode);
                if (ddlWOContractor.Items.Contains(ddlWOContractor.Items.FindByValue(WODTO.ContractorID.ToString2())))
                {
                    ddlWOContractor.SelectedItem.Selected = false;
                    //ddlWOContractor.Items.FindByValue(WODTO.ContractorID.ToString2()).Selected = true;
                    ddlWOContractor.SelectedIndex = ddlWOContractor.Items.IndexOf(ddlWOContractor.Items.FindByValue(WODTO.ContractorID.ToString2()));
                }
            }

            hdnTotalAmt.Value =
                (WODTO.TotalAmount == 0 ? hdnTotalAmt.Value.ToDecimal2() : WODTO.TotalAmount).ToString2();
            hdnValidateWOQty.Value = WODTO.ValidateWOQty.ToString();

            #region Loading Prepayment Rule, Prepayment Types and Retention details

            DataSet dsRRDetails = WORKORDManager.Instance.GetRecoveryRetentionDetails(&quot;WORKORD&quot;, _WorkOrderID);
            //Table[0] - Recovery Details
            //Table[1] - Associated Prepayment Types
            //Table[2] - Retention Details

            string mode = string.Empty;
            if (dsRRDetails.Tables[0].Rows.Count != 0 &amp;&amp; dsRRDetails.Tables[1].Rows.Count != 0)
            {
                #region Loading Prepayment Rule

                mode = string.Empty;
                DataRow row = dsRRDetails.Tables[0].Rows[0];
                mode = ((row[&quot;Prepaymentmode&quot;].ToString2().ToLower2() == &quot;false&quot; ||
                         row[&quot;Prepaymentmode&quot;].ToString2() == &quot;0&quot;)
                            ? WOConstants.MODE_AMOUNT
                            : WOConstants.MODE_PERCENTAGE);
                wneMaxPercentage.Value =
                    ((row[&quot;Prepaymentmode&quot;].ToString2().ToLower2() == &quot;true&quot; || row[&quot;Prepaymentmode&quot;].ToString2() == &quot;1&quot;)
                         ? row[&quot;Value&quot;].ToString2()
                         : &quot;0&quot;).ToDecimal2().ToString(AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE, CultureInfo.CurrentCulture);
                wneMaxAmount.Value =
                    ((row[&quot;Prepaymentmode&quot;].ToString2().ToLower2() == &quot;false&quot; ||
                      row[&quot;Prepaymentmode&quot;].ToString2() == &quot;0&quot;)
                         ? row[&quot;Value&quot;].ToString2()
                         : &quot;0&quot;).ToDecimal2().ToString(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture);

                txtPrepaymentRule.Text = row[&quot;RecoveryRuleName&quot;].ToString2();

                hdnRecoveryID.Value = row[&quot;RecoveryID&quot;].ToString2();

                #endregion

                #region Loading Prepayment Types

                DataTable dtTypes = dsRRDetails.Tables[1];
                dtTypes.Columns.Add(WOConstants.HEADING_RV_IN_RAB);
                string format = (mode == WOConstants.MODE_PERCENTAGE
                                     ? AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE
                                     : AMP3ApplicationSettings.Instance.FORMAT_AMOUNT);
                foreach (DataRow rw in dtTypes.Rows)
                {
                    rw[WOConstants.HEADING_RV_IN_RAB] =
                        CalculateRecoveryValueInEachRAB(rw[&quot;RecoveryValue&quot;].ToString2(),
                                                        rw[&quot;PrepaymentValue&quot;].ToString2(), mode).ToDecimal2().ToString(
                                                            AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture);
                    ;
                    rw[WOConstants.HEADING_AMOUNT_PAID] =
                        rw[WOConstants.HEADING_AMOUNT_PAID].ToDecimal2().ToString(format, CultureInfo.CurrentCulture).
                            ToDecimal2();
                    rw[WOConstants.HEADING_RECOVERED_AMOUNT] =
                        rw[WOConstants.HEADING_RECOVERED_AMOUNT].ToDecimal2().ToString(format,
                                                                                       CultureInfo.CurrentCulture).
                            ToDecimal2();
                }
                dtTypes.AcceptChanges();
                uwgPrepaymentTypes.DataSource = dtTypes;
                uwgPrepaymentTypes.DataBind();

                FormatPrepaymentTypesGrid(mode);

                CalculateAmountOrPercentage(mode);

                HideShowTB(mode);

                #endregion
            }
            if (dsRRDetails.Tables[2].Rows.Count != 0)
            {
                #region Loading Retention Details

                DataRow row1 = dsRRDetails.Tables[2].Rows[0];
                mode = ((row1[&quot;RetentionCeilingMode&quot;].ToString2().ToLower2() == &quot;false&quot; ||
                         row1[&quot;RetentionCeilingMode&quot;].ToString2() == &quot;0&quot;)
                            ? WOConstants.MODE_AMOUNT
                            : WOConstants.MODE_PERCENTAGE);
                lblRetentionCeiling.Text = (mode == WOConstants.MODE_PERCENTAGE
                                                ? &quot;Retention Ceiling Percentage :&quot;
                                                : &quot;Retention Ceiling Amount in &quot; +
                                                  LocalizationManager.GetModuleCurrency(Constants.MODID_CONTMGT,
                                                                                        _ContractID.ToString2()) + &quot; :&quot;);
                wneRetentionPercentage.Value =
                    (row1[&quot;RetentionPercentage&quot;].ToString2() == &quot;&quot; ? &quot;0&quot; : row1[&quot;RetentionPercentage&quot;]).ToDecimal2().
                        ToString(AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE, CultureInfo.CurrentCulture);
                wneRetentionCeiling.Value =
                    (row1[&quot;RetentionCeilingValue&quot;].ToString2() == &quot;&quot; ? &quot;0&quot; : row1[&quot;RetentionCeilingValue&quot;]).ToDecimal2()
                        .ToString(
                            mode == WOConstants.MODE_PERCENTAGE ? AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE : AMP3ApplicationSettings.Instance.FORMAT_AMOUNT,
                            CultureInfo.CurrentCulture);

                txtRetentionRule.Text = row1[&quot;RetentionRuleName&quot;].ToString2();

                hdnRetentionID.Value = row1[&quot;RetentionID&quot;].ToString2();

                #endregion
            }

            #endregion

            if (isVersion)
            {
                //Version being created.
                txtWONo.ReadOnly = true;
                rbDirect.Enabled = rbQuotation.Enabled = false;
                ddlWOContractor.Enabled = false;
            }
            if (WODTO.Status &gt;= WOConstants.STAGE_APPROVED)
            {
                //disable issue mode selection if the record is approved.
                rbDirect.Enabled = rbQuotation.Enabled = false;
                ddlWOContractor.Enabled = false;
                if (WODTO.Status != WOConstants.STAGE_DRAFT_AMENDMENT)
                {
                    tdApprovedBy.InnerText = WODTO.ApprovedBy;
                    tdApprovedOn.InnerText = WODTO.ApprovedOn.ToString(AMP3ApplicationSettings.Instance.FORMAT_DATE, CultureInfo.CurrentCulture);
                    tdCreatedBy.Visible = true;
                    if (WODTO.Status &gt;= WOConstants.STAGE_ISSUED &amp;&amp; WODTO.Status != WOConstants.STAGE_APPROVE_AMENDMENT)
                    {
                        trIssuedBy.Visible = true;
                        tdIssuedBy2.InnerText = WODTO.IssuedBy;
                        tdIssuedOn2.InnerText = WODTO.IssuedOn.ToString(AMP3ApplicationSettings.Instance.FORMAT_DATE, CultureInfo.CurrentCulture);
                    }
                    else
                    {
                        trIssuedBy.Visible = false;
                    }

                    chkWithEquipment.Enabled =
                        chkWithLabour.Enabled =
                        chkWithMaterial.Enabled =
                        dtStartDate.Enabled =
                        dtEndDate.Enabled =
                        dtWODate.Enabled =
                        btnPrepaymentRulePicker.Enabled =
                        btnRetentionRulePicker.Enabled =
                        txtExtReference.Enabled = false;
                    if (!isVersion)
                    {
                        wneMaxAmount.Enabled =
                            wneMaxPercentage.Enabled =
                            wneRetentionCeiling.Enabled =
                            wneRetentionPercentage.Enabled = false;
                    }
                    else
                    {
                        btnPrepaymentRulePicker.Enabled =
                            btnRetentionRulePicker.Enabled = true;
                    }
                }
            }
            else
            {
                trApprovedBy.Visible = false;
                trIssuedBy.Visible = false;
            }

            if ((WODTO.Status &gt;= WOConstants.STAGE_ISSUED) &amp;&amp; !IsCopyWO)
            {
                MainToolBar.DisableMenu(&quot;lnkAward&quot;);
                MainToolBar.DisableMenu(&quot;lnkReject&quot;);
                MainToolBar.DisableMenu(&quot;lnkRevert&quot;);
                MainToolBar.GetMenuReference(&quot;lnkAward&quot;).OnClientClick = &quot;javascript:return false;&quot;;
                MainToolBar.GetMenuReference(&quot;lnkReject&quot;).OnClientClick = &quot;javascript:return false;&quot;;
                MainToolBar.GetMenuReference(&quot;lnkRevert&quot;).OnClientClick = &quot;javascript:return false;&quot;;
                ucItemPicker.PickerButton.Attributes.Add(&quot;disabled&quot;, &quot;True&quot;);
                //if (!WorkOrderType.Equals(&quot;E&quot;))
                //    MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).Text =
                //        MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).Text.Replace(&quot;Edit&quot;, &quot;View&quot;);

                if (WODTO.Status == WOConstants.STAGE_APPROVE_AMENDMENT)
                    MainToolBar.HideMenu(&quot;lnkSave&quot;);
                btnSaveQuot.Style.Add(&quot;display&quot;, &quot;none&quot;);
            }

        }

        private void SetIssueMode(IssueMode issueMode)
        {
            if (issueMode.Equals(IssueMode.Direct))
            {
                hdnIssueMode.Value = &quot;1&quot;;
                rbDirect.Checked = true;
                lblContractor.Style.Value = &quot;display:none&quot;;
                ddlWOContractor.Style.Value = &quot;display:block&quot;;
            }
            else
            {
                hdnIssueMode.Value = &quot;0&quot;;
                rbQuotation.Checked = true;
                ddlWOContractor.Style.Value = &quot;display:none&quot;;
                lblContractor.Style.Value = &quot;display:block&quot;;
            }
        }

        private void SetPreReqData()
        {
            //bind Schema to WOItemsGrid
            uwgWOItems.DataSource = GetWOItemsSchema();
            uwgWOItems.DataBind();
            SetWOGridColumns(null);

            //Set Issue mode
            // if New creation and Is Copy is false
            if (hdnWorkOrderType.Value.Equals(&quot;W&quot;) &amp;&amp; !IsCopyWO)
                SetIssueMode(ModuleManager.Instance.GetModuleComponenets(Constants.MODID_WORKORD).Contains(&quot;DefaultDirectWOIssue&quot;) ? IssueMode.Direct : IssueMode.WithQuotation);

            //Load WorkOrderNumber
            txtWONo.Text = ((IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX)))
                               ? WORKORDManager.Instance.GetWONumber(_ContractID, _ProjectID, false,
                                                       Session[Constants.EIS_ADDITIONAL_INFO].ToString2())
                               : WORKORDManager.Instance.GetWONumber(_ContractID, _ProjectID, false, String.Empty);


            //Load Sub-Contractors list
            LoadContractors();
            dtEndDate.Value =
                dtStartDate.Value =
                dtWODate.Value = DateTime.UtcNow;

            trApprovedBy.Visible =
                trIssuedBy.Visible = false;
            tdCreatedBy2.InnerText = UserDetail.GetCurrentUserDetail().UserName;
        }

        private DataTable LoadVendorInfoFromAX(string info)
        {
            if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX) &amp;&amp;
                (AMP3ApplicationSettings.Instance.appSettings.ContainsKey(&quot;ContactorFilter&quot;) &amp;&amp;
                 AMP3ApplicationSettings.Instance.appSettings[&quot;ContactorFilter&quot;].ToUpper2().Equals(&quot;ON&quot;)))
            {
                int count = 0;
                DataSet ds = null;
                string mappedCompany = String.Empty;
                DataTable dtMap = IntegrationConnectorManager.Instance.GetERPObjectMapInfo(Request[&quot;ContractID&quot;],
                                                                                           AMP3Object.CONTMGT, null,
                                                                                           AMP3Object.UNKNOWN,
                                                                                           RegisteredEIS.AX);
                if (dtMap == null || dtMap.Rows.Count &lt;= 0)
                {
                    Page.ClientScript.RegisterClientScriptBlock(GetType(), &quot;Error&quot;,
                                                                &quot;&lt;script&gt;alert(&lt;%= Aurigo.AMP3.Resources.TerminologyResources.ResourceFactory.Instance.GetString(&#39;Contract is not mapped to AX Sub project.&#39;) %&gt;); &lt;/script&gt;&quot;);
                }
                else
                    mappedCompany = dtMap.Rows[0][&quot;ERPCompany&quot;].ToString();


                var objAdditionalInfo = new EISAdditionalInfo(RegisteredEIS.AX);
                objAdditionalInfo.AddInfo(Constants.EIS_ADDITIONAL_INFO, mappedCompany);
                var dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
                dictAdditionalInfo.Add(RegisteredEIS.AX, objAdditionalInfo);
                var ConBrixInfo = new List&lt;ConnectionBrixInfo&gt;();

                var connectorParameter = new ConnectorParameters(dictAdditionalInfo,
                                                                 MethodBase.GetCurrentMethod().DeclaringType.ToString(),
                                                                 MethodBase.GetCurrentMethod().Name + &quot;_&quot; + info,
                                                                 AMP3ObjectType.Unknown, null, null);

                if (IntegrationConnectorManager.HandleIntegration(connectorParameter, ref count, ref ds, true))
                {
                    if (ds.Tables[0].Rows.Count &gt; 0 &amp;&amp; ds != null)
                        return ds.Tables[0];
                    else
                        return null;
                }
                return ds.Tables[0];
            }
            return null;
        }

        private void LoadContractors()
        {
            DataTable SubContracotrs = WORKORDManager.Instance.GetSubContractorsList(_ContractID);
            ddlContractors.DataSource = SubContracotrs;
            ddlContractors.DataTextField = &quot;Contact&quot;;
            ddlContractors.DataValueField = &quot;ContractorID&quot;;
            ddlContractors.DataBind();
            var li = new ListItem(&quot;--Select One--&quot;, &quot;--Select One--&quot;);
            ddlContractors.Items.Insert(0, li);

            ddlWOContractor.DataSource = SubContracotrs;
            ddlWOContractor.DataTextField = &quot;Contact&quot;;
            ddlWOContractor.DataValueField = &quot;ContractorID&quot;;
            ddlWOContractor.DataBind();
            var li2 = new ListItem(&quot;--Select One--&quot;, &quot;--Select One--&quot;);
            ddlWOContractor.Items.Insert(0, li2);

            wbcDate.Value = MWDateTimeHelper.MWToday;
        }

        private void SetQuotationItemsGridColumns()
        {
            uwgQuotItems.DisplayLayout.AllowSortingDefault = AllowSorting.OnClient;
            uwgQuotItems.DisplayLayout.NoDataMessage = &quot;No items to display&quot;;

            if (WorkOrderType.Equals(&quot;E&quot;))
            {
                uwgQuotItems.Columns.FromKey(&quot;EquipmentID&quot;).Hidden = true;

                uwgQuotItems.Columns.FromKey(&quot;Duration&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                uwgQuotItems.Columns.FromKey(&quot;Duration&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                uwgQuotItems.Columns.FromKey(&quot;Duration&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;

                uwgQuotItems.Columns.FromKey(&quot;Number&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                uwgQuotItems.Columns.FromKey(&quot;Number&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                uwgQuotItems.Columns.FromKey(&quot;Number&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                uwgQuotItems.Columns.FromKey(&quot;Number&quot;).Header.Caption = &quot;No. of Equipments Required&quot;;
            }
            else
            {
                uwgQuotItems.Columns.FromKey(&quot;ItemID&quot;).Hidden = true;
                if (uwgQuotItems.Columns.Exists(&quot;WOQuantity&quot;))
                {
                    uwgQuotItems.Columns.FromKey(&quot;Quantity&quot;).CopyFrom(uwgQuotItems.Columns.FromKey(&quot;WOQuantity&quot;));
                }
            }

            uwgQuotItems.Columns.FromKey(&quot;Quantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
            uwgQuotItems.Columns.FromKey(&quot;Quantity&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
            uwgQuotItems.Columns.FromKey(&quot;Quantity&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;

            uwgQuotItems.Columns.FromKey(&quot;Amount&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
            uwgQuotItems.Columns.FromKey(&quot;Amount&quot;).FieldLen = 14;
            uwgQuotItems.Columns.FromKey(&quot;Amount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
            uwgQuotItems.Columns.FromKey(&quot;Amount&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;

            uwgQuotItems.Columns.FromKey(&quot;Rate&quot;).AllowUpdate = AllowUpdate.Yes;
            uwgQuotItems.Columns.FromKey(&quot;Rate&quot;).CellStyle.BackColor = Color.Yellow;
            uwgQuotItems.Columns.FromKey(&quot;Rate&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
            uwgQuotItems.Columns.FromKey(&quot;Rate&quot;).FieldLen = 14;
            uwgQuotItems.Columns.FromKey(&quot;Rate&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;
            uwgQuotItems.Columns.FromKey(&quot;Rate&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
        }

        private void SetWOGridColumns(WorkOrderDTO WODTO)
        {
            string currency = LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL);
            ColumnsCollection cols = uwgWOItems.Columns;
            RowsCollection rows = uwgWOItems.Rows;
            decimal TotAmt = 0.0M;
            if (WorkOrderType.Equals(&quot;E&quot;))
            {
                if (cols.Exists(&quot;EquipmentID&quot;))
                    cols.FromKey(&quot;EquipmentID&quot;).Hidden = true;

                if (cols.Exists(&quot;UnitID&quot;))
                    cols.FromKey(&quot;UnitID&quot;).Hidden = true;

                if (cols.Exists(&quot;Number&quot;))
                {
                    cols.FromKey(&quot;Number&quot;).Header.Caption = &quot;No. of Equipments Required&quot;;
                    cols.FromKey(&quot;Number&quot;).Format =
                        CoreDatabaseHelper.GetNumberFormat(
                            CoreDatabaseHelper.GetDigitsGrouping(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT), 0);
                    cols.FromKey(&quot;Number&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                }

                if (cols.Exists(&quot;Duration&quot;))
                {
                    cols.FromKey(&quot;Duration&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                    cols.FromKey(&quot;Duration&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                }
                if (cols.Exists(&quot;EstimatedUnitCost&quot;))
                {
                    cols.FromKey(&quot;EstimatedUnitCost&quot;).Header.Caption = &quot;Estimated Rate (&quot; + currency + &quot;)&quot;;
                    cols.FromKey(&quot;EstimatedUnitCost&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;
                    cols.FromKey(&quot;EstimatedUnitCost&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                    cols.FromKey(&quot;EstimatedUnitCost&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                    if ((IsNewInstance || IsCopyWO) ||
                        (!string.IsNullOrEmpty(hdnStage.Value) &amp;&amp; hdnStage.Value.ToInt32_2() == WOConstants.STAGE_DRAFT))
                    {
                        cols.FromKey(&quot;EstimatedUnitCost&quot;).AllowUpdate = AllowUpdate.Yes;
                        cols.FromKey(&quot;EstimatedUnitCost&quot;).CellStyle.BackColor = Color.Yellow;
                        cols.FromKey(&quot;EstimatedUnitCost&quot;).EditorControlID = &quot;wneUnitCostHidden&quot;;
                        cols.FromKey(&quot;EstimatedUnitCost&quot;).Type = ColumnType.Custom;
                        wneUnitCostHidden.DataMode = NumericDataMode.Decimal;
                    }
                }
                if (cols.Exists(&quot;EstimatedAmount&quot;))
                {
                    cols.FromKey(&quot;EstimatedAmount&quot;).Header.Caption = &quot;Estimated Amount in &quot; + currency;
                    cols.FromKey(&quot;EstimatedAmount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                    cols.FromKey(&quot;EstimatedAmount&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                    cols.FromKey(&quot;EstimatedAmount&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                }
                if (cols.Exists(&quot;ActualUnitCost&quot;))
                {
                    cols.FromKey(&quot;ActualUnitCost&quot;).Header.Caption = &quot;Work Order Rate (&quot; + currency + &quot;)&quot;;
                    cols.FromKey(&quot;ActualUnitCost&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;
                    cols.FromKey(&quot;ActualUnitCost&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                    cols.FromKey(&quot;ActualUnitCost&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                    if (isVersion)
                    {
                        cols.FromKey(&quot;ActualUnitCost&quot;).AllowUpdate = AllowUpdate.Yes;
                        cols.FromKey(&quot;ActualUnitCost&quot;).CellStyle.BackColor = Color.Yellow;
                        cols.FromKey(&quot;ActualUnitCost&quot;).EditorControlID = &quot;wneUnitCostHidden&quot;;
                        cols.FromKey(&quot;ActualUnitCost&quot;).Type = ColumnType.Custom;
                        wneUnitCostHidden.DataMode = NumericDataMode.Decimal;
                    }
                }
                if (cols.Exists(&quot;WorkOrderAmount&quot;))
                {
                    cols.FromKey(&quot;WorkOrderAmount&quot;).Header.Caption = &quot;Work Order Amount in &quot; + currency;
                    cols.FromKey(&quot;WorkOrderAmount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                    cols.FromKey(&quot;WorkOrderAmount&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                    cols.FromKey(&quot;WorkOrderAmount&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                }
                if (cols.Exists(&quot;Quantity&quot;))
                {
                    cols.FromKey(&quot;Quantity&quot;).Header.Caption = &quot;Quantity&quot;;
                    cols.FromKey(&quot;Quantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                    cols.FromKey(&quot;Quantity&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                    cols.FromKey(&quot;Quantity&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                    //the qty should not be editable in the case of EHO, instead its auto calculated as the
                    //product of Duration and No. of Equipments.
                }
                if (!isVersion)
                {
                    if (cols.Exists(&quot;WorkOrderAmount&quot;)) cols.FromKey(&quot;WorkOrderAmount&quot;).Hidden = true;
                    if (cols.Exists(&quot;ActualUnitCost&quot;)) cols.FromKey(&quot;ActualUnitCost&quot;).Hidden = true;
                }
            }
            else
            {
                cols.FromKey(&quot;ItemID&quot;).Hidden = true;
                if (cols.Exists(&quot;CompletedQuantity&quot;))
                    cols.FromKey(&quot;CompletedQuantity&quot;).Hidden = true;
                cols.FromKey(&quot;LineNo&quot;).Header.Caption = &quot;Line No.&quot;;
                cols.FromKey(&quot;LineNo&quot;).Width = 75;

                if (cols.Exists(&quot;WOQuantity&quot;))
                {
                    cols.FromKey(&quot;WOQuantity&quot;).Header.Caption = &quot;WO Quantity&quot;;
                    if ((IsNewInstance || IsCopyWO) ||
                        (!string.IsNullOrEmpty(hdnStage.Value) &amp;&amp; hdnStage.Value.ToInt32_2() == WOConstants.STAGE_DRAFT)
                        || (isVersion &amp;&amp; !string.IsNullOrEmpty(hdnStage.Value) &amp;&amp; hdnStage.Value.ToInt32_2() != WOConstants.STAGE_APPROVE_AMENDMENT))
                    {
                        cols.FromKey(&quot;WOQuantity&quot;).AllowUpdate = AllowUpdate.Yes;
                        cols.FromKey(&quot;WOQuantity&quot;).CellStyle.BackColor = Color.Yellow;
                    }
                    else
                    {
                        cols.FromKey(&quot;WOQuantity&quot;).AllowUpdate = AllowUpdate.No;
                        cols.FromKey(&quot;WOQuantity&quot;).CellStyle.BackColor = Color.White;
                    }

                    cols.FromKey(&quot;WOQuantity&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                    cols.FromKey(&quot;WOQuantity&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;

                    cols.FromKey(&quot;WOQuantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                    cols.FromKey(&quot;AvailableQuantity&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;

                    cols.FromKey(&quot;WOQuantity&quot;).Width = 100;
                }
                if (cols.Exists(&quot;StandardItemNo.&quot;))
                {
                    cols.FromKey(&quot;StandardItemNo.&quot;).Header.Caption = &quot;Standard Item No.&quot;;
                    cols.FromKey(&quot;StandardItemNo.&quot;).Width = 100;
                }
                if (cols.Exists(&quot;Description&quot;))
                    cols.FromKey(&quot;Description&quot;).Width = 100;
                if (cols.Exists(&quot;Unit&quot;))
                    cols.FromKey(&quot;Unit&quot;).Width = 75;
                if (cols.Exists(&quot;AvailableQuantity&quot;))
                {
                    cols.FromKey(&quot;AvailableQuantity&quot;).Header.Caption = &quot;Available Quantity for Issue&quot;;
                    cols.FromKey(&quot;AvailableQuantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                    cols.FromKey(&quot;AvailableQuantity&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                    cols.FromKey(&quot;AvailableQuantity&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                    cols.FromKey(&quot;AvailableQuantity&quot;).Width = 100;
                }
                if (cols.Exists(&quot;ContractUnitPrice&quot;))
                {
                    cols.FromKey(&quot;ContractUnitPrice&quot;).Header.Caption = &quot;Estimated Rate (&quot; + currency + &quot;)&quot;;
                    cols.FromKey(&quot;ContractUnitPrice&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;
                    cols.FromKey(&quot;ContractUnitPrice&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                    cols.FromKey(&quot;ContractUnitPrice&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                    cols.FromKey(&quot;ContractUnitPrice&quot;).Width = 100;
                }
                if (cols.Exists(&quot;Amount&quot;))
                {
                    cols.FromKey(&quot;Amount&quot;).Header.Caption = &quot;Amount&quot;;
                    cols.FromKey(&quot;Amount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                    cols.FromKey(&quot;Amount&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                    cols.FromKey(&quot;Amount&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                    cols.FromKey(&quot;Amount&quot;).Width = 100;
                }
            }

            if (!isVersion)
            {
                if (cols.Exists(&quot;Posted Quantity/MBook Quantity&quot;))
                    cols.FromKey(&quot;Posted Quantity/MBook Quantity&quot;).Hidden = true;
                if (cols.Exists(&quot;BilledQuantity&quot;)) cols.FromKey(&quot;BilledQuantity&quot;).Hidden = true;
                if (cols.Exists(&quot;CertifiedQuantity&quot;)) cols.FromKey(&quot;CertifiedQuantity&quot;).Hidden = true;
            }
            else
            {
                if (cols.Exists(&quot;Posted Quantity/MBook Quantity&quot;))
                {
                    cols.FromKey(&quot;Posted Quantity/MBook Quantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                    cols.FromKey(&quot;Posted Quantity/MBook Quantity&quot;).Width = 100;
                }
                if (cols.Exists(&quot;BilledQuantity&quot;))
                {
                    cols.FromKey(&quot;BilledQuantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                    cols.FromKey(&quot;BilledQuantity&quot;).Header.Caption = &quot;Total Billed Quantity&quot;;
                    cols.FromKey(&quot;BilledQuantity&quot;).Width = 100;
                }
                if (cols.Exists(&quot;CertifiedQuantity&quot;))
                {
                    cols.FromKey(&quot;CertifiedQuantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                    cols.FromKey(&quot;CertifiedQuantity&quot;).Header.Caption = &quot;Total Certified Quantity&quot;;
                    cols.FromKey(&quot;CertifiedQuantity&quot;).Width = 100;
                }
            }

            if (cols.Exists(&quot;IsShortClose&quot;)) cols.FromKey(&quot;IsShortClose&quot;).Hidden = true;

            if (WODTO != null &amp;&amp; WODTO.Status &gt;= WOConstants.STAGE_ISSUED &amp;&amp; !(IsNewInstance || IsCopyWO))
            {
                string workOrderRateCol = WorkOrderType.Equals(&quot;E&quot;) ? &quot;ActualUnitCost&quot; : &quot;UnitPrice&quot;;
                cols.FromKey(workOrderRateCol).Hidden = false;
                cols.FromKey(workOrderRateCol).Header.Caption = &quot;WO Rate (&quot; + currency + &quot;)&quot;;
                cols.FromKey(workOrderRateCol).Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;

                if (WODTO.Status != WOConstants.STAGE_APPROVE_AMENDMENT &amp;&amp; isVersion)
                {
                    cols.FromKey(workOrderRateCol).AllowUpdate = AllowUpdate.Yes;
                    cols.FromKey(workOrderRateCol).CellStyle.BackColor = Color.Yellow;
                }
                cols.FromKey(workOrderRateCol).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(workOrderRateCol).Width = 100;

                TotAmt = WODTO.TotalAmount;
            }
            else if (!WorkOrderType.Equals(&quot;E&quot;))
            {
                for (int i = 0; i &lt; rows.Count; i++)
                {
                    TotAmt += rows[i].Cells.FromKey(&quot;ContractUnitPrice&quot;).Value.ToDecimal2() *
                              rows[i].Cells.FromKey(&quot;WOQuantity&quot;).Value.ToDecimal2();
                    rows[i].Cells.FromKey(&quot;Amount&quot;).Value =
                        rows[i].Cells.FromKey(&quot;ContractUnitPrice&quot;).Value.ToDecimal2() *
                        rows[i].Cells.FromKey(&quot;WOQuantity&quot;).Value.ToDecimal2();
                }

                cols.FromKey(&quot;UnitPrice&quot;).Hidden = true;
            }
            lblWOAmount.Text = TotAmt.ToString(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture);
            hdnTotalAmt.Value = TotAmt.ToString2();
            lblWOAmount.Visible = true;
            tdTotalLbl.Visible = true;

            uwgWOItems.Height = Unit.Pixel(175);
        }

        private DataTable GetWOItemsSchema()
        {
            DataTable dtWOItems = new BrixDataTable(&quot;Items&quot;);
            if (WorkOrderType.Equals(&quot;E&quot;))
            {
                dtWOItems.Columns.AddRange(new[]
                                               {
                                                   new DataColumn(&quot;EquipmentID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                                                   new DataColumn(&quot;Name&quot;),
                                                   new DataColumn(&quot;Description&quot;),
                                                   new DataColumn(&quot;Unit&quot;),
                                                   new DataColumn(&quot;UnitID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                                                   new DataColumn(&quot;Duration&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                   new DataColumn(&quot;Number&quot;, Type.GetType(&quot;System.Int32&quot;)),
                                                   new DataColumn(&quot;Quantity&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                   new DataColumn(&quot;EstimatedUnitCost&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                   new DataColumn(&quot;EstimatedAmount&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                   new DataColumn(&quot;IsShortClose&quot;, Type.GetType(&quot;System.Boolean&quot;)),
                                                   new DataColumn(&quot;BilledQuantity&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                   new DataColumn(&quot;CertifiedQuantity&quot;, Type.GetType(&quot;System.Double&quot;))
                                               });
                if (isVersion)
                {
                    dtWOItems.Columns.Add(&quot;ActualUnitCost&quot;, Type.GetType(&quot;System.Double&quot;));
                    dtWOItems.Columns.Add(&quot;WorkOrderAmount&quot;, Type.GetType(&quot;System.Double&quot;));
                }
                dtWOItems.Columns.Add(&quot;Notes&quot;);
            }
            else
            {
                dtWOItems.Columns.AddRange(new[]
                                               {
                                                   new DataColumn(&quot;ItemID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                                                   new DataColumn(&quot;LineNo&quot;),
                                                   new DataColumn(&quot;StandardItemNo.&quot;),
                                                   new DataColumn(&quot;Description&quot;),
                                                   new DataColumn(&quot;Unit&quot;),
                                                   new DataColumn(&quot;AvailableQuantity&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                   new DataColumn(&quot;UnitPrice&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                   new DataColumn(&quot;WOQuantity&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                   new DataColumn(&quot;ContractUnitPrice&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                   new DataColumn(&quot;Amount&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                   new DataColumn(&quot;IsShortClose&quot;, Type.GetType(&quot;System.Boolean&quot;)),
                                                   new DataColumn(&quot;BilledQuantity&quot;, Type.GetType(&quot;System.Double&quot;)),
                                                   new DataColumn(&quot;CertifiedQuantity&quot;, Type.GetType(&quot;System.Double&quot;))
                                               });
            }
            return dtWOItems;
        }

        /// &lt;summary&gt;
        /// Calculates the Qty Available for allocation for a particular item
        /// = contractQty - (posted quantity + quantity alloted to other Work Orders)
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;ItemID&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;ContractQty&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private decimal GetAvailableQuantity(int ItemID, int WorkOrderID)
        {
            return WORKORDManager.Instance.GetAvailableQuantityForItem(ItemID, WorkOrderID);
        }

        private decimal GetUnitPrice(int ItemID)
        {
            decimal UnitPrice = WORKORDManager.Instance.GetUnitPrice(ItemID, Constants.MODID_CONTMGT, chkWithMaterial.Checked,
                                                       chkWithLabour.Checked, chkWithEquipment.Checked);
            return UnitPrice;
        }

        private decimal GetAppPostedQty(int ItemID, int WorkOrderID)
        {
            decimal qtyPosted = WORKORDManager.Instance.GetAppPostedQty(ItemID, WorkOrderID);
            return (qtyPosted &gt; 0) ? qtyPosted : 0;
        }

        private void ShowDiv(ItemDivEnums divType)
        {
            bool prepaymentPicker = (ItemDivEnums.PrepaymentPicker == divType);
            bool retentionPicker = (ItemDivEnums.RetentionPicker == divType);
            bool woPicker = (ItemDivEnums.CreateWO == divType);

            DivWO.Visible = woPicker;
            DivPrepaymentPicker.Visible = prepaymentPicker;
            DivRetentionPicker.Visible = retentionPicker;
            string heading = string.Empty;
            if (prepaymentPicker) heading = &quot;Select Pre-payment Rule&quot;;
            if (retentionPicker) heading = &quot;Select Retention Rule&quot;;
            PageTitle = prepaymentPicker || retentionPicker ? heading : ((IsNewInstance || IsCopyWO) ? &quot;New Work Order&quot; : &quot;Edit Work Order&quot;);

            switch (divType)
            {
                case ItemDivEnums.PrepaymentPicker:
                case ItemDivEnums.RetentionPicker:
                    MainToolBar.Visible = false;
                    break;
                default:
                    MainToolBar.Visible = true;
                    break;
            }
        }

        protected void SaveWorkOrder(out string sErrors, out string sSavedInstanceToken, bool wfBtn)
        {
            sErrors = sSavedInstanceToken = string.Empty;
            var WODTO = new WorkOrderDTO();
            if (IsNewInstance || IsCopyWO)
                WODTO.WorkOrderID = null;
            else
                WODTO.WorkOrderID = Request.QueryString[WOConstants.QRY_WORKORDERID].ToInt32_2();

            if (OnlyCustomerWONo &amp;&amp; !txtUserWONo.ReadOnly)
            {
                //Validate WO No (Should be Unique with in Contract)
                string wono = txtUserWONo.Text.Trim();
                if (string.IsNullOrEmpty(wono))
                {
                    sErrors = lblErr.Text = &quot;Please enter &quot; + lblOrderNo.Text.Replace(&quot; : &quot;, &quot;.&quot;);
                    sSavedInstanceToken = &quot;-1&quot;;
                    return;
                }
                DataSet ds = ComponentHelper.Instance.ExecuteDataSet(
                    &quot;SELECT WorkOrderNo FROM WORKORDMain WHERE ContractID = {0} and WorkOrderNo = &#39;{1}&#39; {2}&quot;.Format2(
                    _ContractID, wono.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;), (WODTO.WorkOrderID == null) ? &quot;&quot; : &quot; and WorkOrderID != &quot; + WODTO.WorkOrderID));
                if (ds.Tables[0].Rows.Count &gt;= 1)
                {
                    sErrors = lblErr.Text = &quot;Please enter unique &quot; + lblOrderNo.Text.Replace(&quot; : &quot;, &quot;.&quot;);
                    sSavedInstanceToken = &quot;-1&quot;;
                    return;
                }
            }
            //The check for the uniqueness of Work Order No is not required as the field is autogenerated now.
            if (ddlContractors.SelectedValue == &quot;No Data&quot;)
            {
                sErrors = &quot;Please select a contractor&quot;;
                sSavedInstanceToken = &quot;-1&quot;;
                //Page.ClientScript.RegisterStartupScript(this.GetType(), &quot;alerT&quot;, &quot;alert(&#39;&quot; + alertMsg + &quot;&#39;);&quot;, true);
                return;
            }

            DateTime startDate = ((DateTime)dtStartDate.Value).Date;
            if (startDate &lt; ((DateTime)dtWODate.Value).Date &amp;&amp; !isVersion)
            {
                sErrors = lblErr.Text = &quot;Start Date should not be less than the Work Order Date.&quot;;
                sSavedInstanceToken = &quot;-1&quot;;
                return;
            }

            //if (startDate &lt; ((DateTime)dtIssued.Value).Date &amp;&amp; !isVersion)
            //{
            //    lblErr.Text = &quot;Start Date should not be less than the Creation/Approval/Issual Date.&quot;;
            //    return;
            //}
            if (WODTO.WorkOrderID != null &amp;&amp; !isVersion)
            {
                if (WODTO.IssuedOn != null &amp;&amp; startDate &lt; WODTO.IssuedOn.Date)
                {
                    sErrors = lblErr.Text = &quot;Start Date should not be less than the Issued Date.&quot;;
                    sSavedInstanceToken = &quot;-1&quot;;
                    return;
                }
                else if (WODTO.ApprovedOn != null &amp;&amp; startDate &lt; WODTO.ApprovedOn.Date)
                {
                    sErrors = lblErr.Text = &quot;Start Date should not be less than the Approved Date.&quot;;
                    sSavedInstanceToken = &quot;-1&quot;;
                    return;
                }
                else if (WODTO.CreatedOn != null &amp;&amp; startDate &lt; WODTO.CreatedOn.Date)
                {
                    sErrors = lblErr.Text = &quot;Start Date should not be less than the Created Date.&quot;;
                    sSavedInstanceToken = &quot;-1&quot;;
                    return;
                }
            }
            if (wfBtn)
            {
                if (uwgWOItems.Rows.Count == 0)
                {
                    sErrors = (WODTO.WorkOrderType == &quot;E&quot;
                                   ? &quot;Hire order has no Equipments. Request Denied.&quot;
                                   : &quot;Work order has no Items. Request Denied.&quot;);
                    sSavedInstanceToken = &quot;-1&quot;;
                    //Page.ClientScript.RegisterStartupScript(this.GetType(), &quot;alerT&quot;, &quot;alert(&#39;&quot; + alertMsg + &quot;&#39;);&quot;, true);
                    return;
                }
            }

            foreach (UltraGridRow ugr in uwgQuotations.Rows)
            {
                if (((DateTime)dtWODate.Value).Date &gt; ((DateTime)ugr.Cells.FromKey(&quot;Date&quot;).Value).Date &amp;&amp; !isVersion)
                {
                    sErrors = lblErr.Text = &quot;Work Order Date is greater than one or more of the Quotation Date.&quot;;
                    sSavedInstanceToken = &quot;-1&quot;;
                    hdnVisibleTab.Value = WOConstants.TAB_WO;
                    return;
                }
                if (startDate &lt; ((DateTime)ugr.Cells.FromKey(&quot;Date&quot;).Value).Date &amp;&amp; !isVersion)
                {
                    sErrors = lblErr.Text = &quot;One or more of the Quotation Date is greater than the Start Date.&quot;;
                    sSavedInstanceToken = &quot;-1&quot;;
                    hdnVisibleTab.Value = WOConstants.TAB_WO;
                    return;
                }
            }

            WODTO.ContractID = _ContractID;

            WODTO.SystemWONo = WODTO.WorkOrderNo = txtWONo.Text.Trim();
            WODTO.ExtReference = txtExtReference.Text.Trim();
            if (OnlyCustomerWONo)
                WODTO.WorkOrderNo = txtUserWONo.Text.Trim();
            WODTO.WorkOrderRequestedBy = txtWOReqBy.Text;
            WODTO.WorkOrderDate = (DateTime)dtWODate.Value;
            WODTO.Description = txtDesc.Text;
            WODTO.Notes = txtNotes.Text;
            WODTO.ScopeOfWork = txtScope.Text;
            WODTO.WithMaterial = chkWithMaterial.Checked;
            WODTO.WithEquipment = chkWithEquipment.Checked;
            WODTO.WithLabour = chkWithLabour.Checked;
            WODTO.StartDate = (DateTime)dtStartDate.Value;
            WODTO.EndDate = (DateTime)dtEndDate.Value;
            if (isVersion)
                WODTO.Status = WOConstants.STAGE_DRAFT_AMENDMENT;
            else if (!(IsNewInstance || IsCopyWO))
                WODTO.Status = hdnStage.Value.ToInt32_2();
            else
                WODTO.Status = WOConstants.STAGE_DRAFT;
            WODTO.ModifiedBy = UserDetail.GetCurrentUserDetail().UserName;
            WODTO.ModifiedByID = UserDetail.GetCurrentUserDetail().UID;
            if (isOldWONo)
                WODTO.IsNew = null;
            else
            {
                string[] strArr = WODTO.SystemWONo.Split(&#39;/&#39;);
                WODTO.IsNew = (WODTO.SystemWONo.Contains(&quot;/&quot;)) ? strArr[strArr.Length - 1].ToInt32_2() : WODTO.SystemWONo.ToInt32_2();
            }

            WODTO.ModifiedOn = (wdcCreatedOn.Value.ToDateTime_MWCulture());

            //Save the Issue mode and Contractor
            WODTO.IssueMode = rbDirect.Checked ? IssueMode.Direct : IssueMode.WithQuotation;
            if (rbDirect.Checked &amp;&amp; ddlWOContractor.SelectedValue != &quot;--Select One--&quot;)
            {
                WODTO.ContractorID = ddlWOContractor.SelectedValue.ToInt32_2();
                WODTO.Contractor = ddlWOContractor.SelectedItem.Text;
            }

            DataSet dsWOITems = new BrixDataSet();
            dsWOITems.Tables.Add(GetWOItemsSchema());
            DataTable dtItems = dsWOITems.Tables[0];
            Decimal WOAmt = 0.0M, WOQty = 0.0M; //, postedQty

            for (int i = 0; i &lt; uwgWOItems.Rows.Count; i++)
            {
                WOQty = 0.0M;
                DataRow dr = dtItems.NewRow();
                if (WorkOrderType.Equals(&quot;E&quot;))
                {
                    WOQty = uwgWOItems.Rows[i].Cells.FromKey(&quot;Number&quot;).Value.ToDecimal2() *
                            uwgWOItems.Rows[i].Cells.FromKey(&quot;Duration&quot;).Value.ToDecimal2();
                    if (uwgWOItems.Rows[i].Cells.FromKey(&quot;EquipmentID&quot;).Value != null)
                        dr[&quot;EquipmentID&quot;] = uwgWOItems.Rows[i].Cells.FromKey(&quot;EquipmentID&quot;).Value;
                    dr[&quot;Name&quot;] = uwgWOItems.Rows[i].Cells.FromKey(&quot;Name&quot;).Value;
                    dr[&quot;Description&quot;] = uwgWOItems.Rows[i].Cells.FromKey(&quot;Description&quot;).Value;
                    dr[&quot;UnitID&quot;] = uwgWOItems.Rows[i].Cells.FromKey(&quot;UnitID&quot;).Value;
                    dr[&quot;Unit&quot;] = uwgWOItems.Rows[i].Cells.FromKey(&quot;Unit&quot;).Value;
                    dr[&quot;Number&quot;] = uwgWOItems.Rows[i].Cells.FromKey(&quot;Number&quot;).Value;
                    dr[&quot;Duration&quot;] = uwgWOItems.Rows[i].Cells.FromKey(&quot;Duration&quot;).Value;
                    dr[&quot;EstimatedUnitCost&quot;] = uwgWOItems.Rows[i].Cells.FromKey(&quot;EstimatedUnitCost&quot;).Value;
                    dr[&quot;Notes&quot;] = uwgWOItems.Rows[i].Cells.FromKey(&quot;Notes&quot;).Value;
                    if (uwgWOItems.Rows[i].Cells.Exists(&quot;ActualUnitCost&quot;) &amp;&amp;
                        uwgWOItems.Rows[i].Cells.FromKey(&quot;ActualUnitCost&quot;).Value != null &amp;&amp;
                        dr.Table.Columns.Contains(&quot;ActualUnitCost&quot;))
                        dr[&quot;ActualUnitCost&quot;] = uwgWOItems.Rows[i].Cells.FromKey(&quot;ActualUnitCost&quot;).Value;
                    dr[&quot;IsShortClose&quot;] = uwgWOItems.Rows[i].Cells.FromKey(&quot;IsShortClose&quot;).Value.ToBoolean2();
                    dr[&quot;BilledQuantity&quot;] = isVersion
                                               ? uwgWOItems.Rows[i].Cells.FromKey(&quot;BilledQuantity&quot;).Value.ToDecimal2()
                                               : 0;
                    dr[&quot;CertifiedQuantity&quot;] = isVersion
                                                  ? uwgWOItems.Rows[i].Cells.FromKey(&quot;CertifiedQuantity&quot;).Value.
                                                        ToDecimal2()
                                                  : 0;

                    if (isVersion)
                    {
                        WOAmt += WOQty * uwgWOItems.Rows[i].Cells.FromKey(&quot;ActualUnitCost&quot;).Value.ToDecimal2();
                    }
                }
                else
                {
                    dr[&quot;ItemID&quot;] = uwgWOItems.Rows[i].Cells.FromKey(&quot;ItemID&quot;).Value;
                    WOQty = Math.Round(uwgWOItems.Rows[i].Cells.FromKey(&quot;WOQuantity&quot;).Value.ToDecimal2(),
                                       CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY).ToInt32_2());
                    if ((WODTO.Status == WOConstants.STAGE_ISSUED) &amp;&amp; hdnValidateWOQty.Value == &quot;1&quot; &amp;&amp;
                        (!ValidateWOQuantityOnIssue(WOQty,
                                                    uwgWOItems.Rows[i].Cells.FromKey(&quot;ItemID&quot;).Value.ToString2().
                                                        ToInt32_2())))
                    {
                        sErrors =
                            lblErr.Text =
                            &quot;The Work Order quantity cannot exceed the available quantity of the &quot; +
                            LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR) + &quot;.&quot;;
                        sSavedInstanceToken = &quot;-1&quot;;
                        return;
                    }

                    //if (isVersion &amp;&amp; !(uwgWOItems.Rows[i].Cells.Exists(&quot;IsShortClose&quot;) &amp;&amp; uwgWOItems.Rows[i].Cells.FromKey(&quot;IsShortClose&quot;).Value.ToBoolean2()))
                    //{
                    //    postedQty = GetAppPostedQty(BrixDatatypeHelper.ToInt32_2(uwgWOItems.Rows[i].Cells.FromKey(&quot;ItemID&quot;).Value.ToString2()), _WorkOrderID);
                    //    if (WOQty &lt; postedQty)
                    //    {
                    //        lblErr.Text = &quot;The Work Order &quot; + ItemNameAbbr + &quot; quantity cannot be reduced to a value less than already posted.&lt;br/&gt;&quot; + ItemNameAbbr + &quot; with Line No. &quot; + uwgWOItems.Rows[i].Cells.FromKey(&quot;LineNo&quot;).Value.ToString2() + &quot; has an approved &quot; + LocalizationManager.GetString(KeyConstants.LOC_ITEM_POSTING) + &quot; with quantity &quot; + postedQty.ToString(Constants.FORMAT_QUANTITY, CultureInfo.InvariantCulture) + &quot;.&quot;;
                    //        return;
                    //    }
                    //}
                    WOAmt += WOQty * uwgWOItems.Rows[i].Cells.FromKey(&quot;UnitPrice&quot;).Value.ToDecimal2();
                    dr[&quot;WOQuantity&quot;] = WOQty;
                    dr[&quot;UnitPrice&quot;] = uwgWOItems.Rows[i].Cells.FromKey(&quot;UnitPrice&quot;).Value.ToDecimal2();
                    dr[&quot;ContractUnitPrice&quot;] = uwgWOItems.Rows[i].Cells.FromKey(&quot;ContractUnitPrice&quot;).Value.ToDecimal2();
                    dr[&quot;IsShortClose&quot;] = uwgWOItems.Rows[i].Cells.FromKey(&quot;IsShortClose&quot;).Value.ToBoolean2();
                    dr[&quot;BilledQuantity&quot;] = isVersion
                                               ? uwgWOItems.Rows[i].Cells.FromKey(&quot;BilledQuantity&quot;).Value.ToDecimal2()
                                               : 0;
                    dr[&quot;CertifiedQuantity&quot;] = isVersion
                                                  ? uwgWOItems.Rows[i].Cells.FromKey(&quot;CertifiedQuantity&quot;).Value.
                                                        ToDecimal2()
                                                  : 0;
                }
                dtItems.Rows.Add(dr);
            }

            decimal mohAmount = WORKORDManager.Instance.GetMOHStatus(txtWONo.Text.Trim(), _ContractID);

            if (!(IsNewInstance || IsCopyWO) &amp;&amp; WOAmt &lt; mohAmount &amp;&amp; mohAmount &gt; 0)
            {
                sErrors =
                    &quot;The Work Order is associated with an approved Pre-Payment and cannot have Work Order Amount different from the Pre-Payment Amount.&quot;;
                sSavedInstanceToken = &quot;-1&quot;;
                return;
            }
            if (dtPrepayment.Columns.Contains(WOConstants.HEADING_AMOUNT_PAID) &amp;&amp; dtPrepayment.Columns.Count &gt; 0)
            {
                decimal amount = 0.0M;
                foreach (DataRow dr in dtPrepayment.Rows)
                {
                    amount += dr[WOConstants.HEADING_AMOUNT_PAID].ToDecimal2();
                }
                if (Convert.ToDecimal(wneMaxAmount.Value) &lt; amount)
                {
                    sErrors = &quot;The maximum prepayment recovery value cannot be less than the total recovered value.&quot;;
                    sSavedInstanceToken = &quot;-1&quot;;
                    return;
                }
            }

            WODTO.WorkOrderItems = dsWOITems;
            WODTO.IsVersion = isVersion;
            WODTO.VersionNo = string.Empty;
            WODTO.TaxPayerID = txtTaxPayerID.Text;
            WODTO.LicenseCity = txtLicenseCity.Text;
            WODTO.LicenseState = txtLicenseState.Text;
            WODTO.Insurance = txtInsurance.Text;
            if (WorkOrderType.Equals(&quot;E&quot;))
                WODTO.WorkOrderType = &quot;E&quot;;

            #region Storing Prepayment,recovery and retention information

            int rowCount = uwgPrepaymentTypes.Rows.Count;
            int incrmentor = 0;
            int InstanceID = _WorkOrderID;
            var dtoRecoveryItems = new PrepaymentRecoveryRulesItems[rowCount];


            if (rowCount &gt; 0)
            {
                DataRow[] dr = dtPrepayment.Select(&quot;RecoveryId=&quot; + hdnRecoveryID.Value);
                foreach (UltraGridRow row in uwgPrepaymentTypes.DisplayLayout.Rows)
                {
                    dtoRecoveryItems[incrmentor] = new PrepaymentRecoveryRulesItems();
                    int TypeId =
                        Int32.Parse(dr != null &amp;&amp; dr.Length &gt; 0 &amp;&amp; dr[incrmentor][&quot;PrepaymentTypeID&quot;] != null
                                        ? dr[incrmentor][&quot;PrepaymentTypeID&quot;].ToString2()
                                        : row.Cells.FromKey(&quot;PrepaymentTypeID&quot;).ToString2());
                    dtoRecoveryItems[incrmentor].PrepaymentTypeID = TypeId;
                    dtoRecoveryItems[incrmentor].RecoveryID = int.Parse((IsNewInstance || IsCopyWO) ? &quot;0&quot; : hdnRecoveryID.Value);

                    dtoRecoveryItems[incrmentor].PrepaymentValue =
                        decimal.Parse(row.Cells.FromKey(&quot;PrepaymentValue&quot;).ToString2());
                    dtoRecoveryItems[incrmentor].RABillNumber = int.Parse(row.Cells.FromKey(&quot;RABillNumber&quot;).ToString2());
                    dtoRecoveryItems[incrmentor].RecoveryValue =
                        decimal.Parse(row.Cells.FromKey(&quot;RecoveryValue&quot;).ToString2());

                    incrmentor++;
                }


                WODTO.xmlPrepaymentItemList =
                    PrepaymentRecoveryrulesBL.Instance.SerializeDTO(dtoRecoveryItems).Replace(&quot;encoding=\&quot;utf-8\&quot;&quot;,
                                                                                              String.Empty);
                var dtoGeneral = new PrepaymentRecovery();
                dtoGeneral.RecoveryID = int.Parse((IsNewInstance || IsCopyWO) ? &quot;0&quot; : hdnRecoveryID.Value);

                if (dtRecovery.Rows.Count != 0)
                {
                    DataRow[] rowRecovery = dtRecovery.Select(&quot;RecoveryRuleName=&#39;&quot; + txtPrepaymentRule.Text.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) + &quot;&#39;&quot;);
                    if (rowRecovery.Length != 0)
                    {
                        dtoGeneral.RecoveryRuleName = rowRecovery[0][&quot;RecoveryRuleName&quot;].ToString2();
                        dtoGeneral.Description = rowRecovery[0][&quot;Description&quot;].ToString2();
                        dtoGeneral.Value = ((rowRecovery[0][&quot;Prepaymentmode&quot;].ToString2() == &quot;True&quot; ||
                                             rowRecovery[0][&quot;Prepaymentmode&quot;].ToString2() == &quot;1&quot;)
                                                ? wneMaxPercentage.ValueDecimal
                                                : wneMaxAmount.ValueDecimal);
                        dtoGeneral.Prepaymentmode = ((rowRecovery[0][&quot;Prepaymentmode&quot;].ToString2() == &quot;True&quot; ||
                                                      rowRecovery[0][&quot;Prepaymentmode&quot;].ToString2() == &quot;1&quot;)
                                                         ? true
                                                         : false);
                    }
                    WODTO.xmlGeneralDetails =
                        PrepaymentRecoveryrulesBL.Instance.SerializeDTO(dtoGeneral).Replace(&quot;encoding=\&quot;utf-8\&quot;&quot;,
                                                                                            String.Empty);
                }
            }
            var dtoRetention = new RetentionRuleItems();

            if (dtRetention.Rows.Count != 0)
            {
                DataRow[] drRetention = dtRetention.Select(&quot;RetentionRuleName=&#39;&quot; + txtRetentionRule.Text.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) + &quot;&#39;&quot;);

                if (drRetention.Length != 0)
                {
                    dtoRetention.RetentionID = (IsNewInstance || IsCopyWO)
                                                   ? 0
                                                   : Convert.ToInt32(hdnRetentionID.Value);
                    dtoRetention.RetentionRuleName = drRetention[0][&quot;RetentionRuleName&quot;].ToString2();
                    dtoRetention.Description = drRetention[0][&quot;Description&quot;].ToString2();
                    dtoRetention.RetentionCeilingValue = wneRetentionCeiling.ValueDecimal;
                    dtoRetention.RetentionCeilingMode = ((drRetention[0][&quot;RetentionCeilingMode&quot;].ToString2().ToLower2() == &quot;true&quot; ||
                                                          drRetention[0][&quot;RetentionCeilingMode&quot;].ToString2() == &quot;1&quot;)
                                                             ? true
                                                             : false);
                    dtoRetention.RetentionPercentage = wneRetentionPercentage.ValueDecimal;
                    WODTO.xmlRetentionItemList =
                        RetentionRuleBL.Instance.SerializeDTO(dtoRetention).Replace(&quot;encoding=\&quot;utf-8\&quot;&quot;, String.Empty);
                }
            }

            WODTO.Mode = ((IsNewInstance || IsCopyWO) ? &quot;N&quot; : &quot;E&quot;);

            #endregion

            if ((_WorkOrderID = WORKORDManager.Instance.CUWorkOrder(WODTO)) &gt; 0)
            {
                //save attachments here
                if (
                    !SaveAttachments(_WorkOrderID, UserDetail.GetCurrentUserDetail(),
                                     (isVersion &amp;&amp; _WorkOrderID != WODTO.WorkOrderID)))
                {
                    ClientScript.RegisterClientScriptBlock(GetType(), &quot;Error_in_Attachments&quot;,
                                                           &quot;&lt;script&gt;alert(&quot; +
                                                           ResourceFactory.Instance.GetString(
                                                               &quot;Error in uploading attachments. Work Order created successfully.&quot;) +
                                                           &quot;); &lt;/script&gt;&quot;);
                }

                sSavedInstanceToken = hdnWorkOrderID.Value = _WorkOrderID.ToString2();

                #region

                //if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX) &amp;&amp; isVersion == true)
                //{

                //    string mappedCompany = String.Empty;
                //    string selWorkOrderID = WODTO.WorkOrderID.ToString();
                //    WorkOrderDTO WODTOObject = Aurigo.AMP3.WORKORDBL.WOManager.Instance.GetWorkOrderDetails(Convert.ToInt32(selWorkOrderID));
                //    //Check for Brix-ERP Subproject mapping if the ERP supports Contract Mapping
                //    DataTable dtMap = IntegrationConnectorManager.Instance.GetERPObjectMapInfo(WODTO.ContractID.ToString(), AMP3Object.CONTMGT, null, AMP3Object.UNKNOWN, RegisteredEIS.AX);
                //    if (dtMap == null || dtMap.Rows.Count &lt;= 0)
                //    {
                //        Page.ClientScript.RegisterClientScriptBlock(GetType(), &quot;Error&quot;,
                //                                                &quot;&lt;script&gt;alert(&lt;%= Aurigo.AMP3.Resources.TerminologyResources.ResourceFactory.Instance.GetString(&#39;Contract is not mapped to AX Sub project . So Purchase Order is not pushed to AX.&#39;) %&gt;); &lt;/script&gt;&quot;);
                //    }
                //    else
                //        mappedCompany = dtMap.Rows[0][&quot;ERPCompany&quot;].ToString();


                //    EISAdditionalInfo objAdditionalInfo = new EISAdditionalInfo(RegisteredEIS.AX);
                //    objAdditionalInfo.AddInfo(Constants.EIS_ADDITIONAL_INFO, mappedCompany);
                //    Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt; dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
                //    dictAdditionalInfo.Add(RegisteredEIS.AX, objAdditionalInfo);
                //    List&lt;ConnectionBrixInfo&gt; ConBrixInfo = new List&lt;ConnectionBrixInfo&gt;();
                //    ConBrixInfo.Add(new ConnectionBrixInfo(AMP3Object.CONTMGT, WODTO.ContractID.ToString(), AMP3Object.UNKNOWN, &quot;0&quot;));
                //    ConnectorParameters connectorParameter = new ConnectorParameters(dictAdditionalInfo, MethodInfo.GetCurrentMethod(), AMP3ObjectType.Unknown, null, ConBrixInfo);

                //    string purchId = &quot;&quot;;
                //    DataTable dtPurchInfo = IntegrationConnectorManager.Instance.GetERPObjectMapInfo(WODTO.WorkOrderID.ToString(), AMP3Object.WORKORD, WODTO.ContractID.ToString(), AMP3Object.CONTMGT, RegisteredEIS.AX);
                //    if (dtPurchInfo.Rows.Count &gt; 0)
                //        purchId = dtPurchInfo.Rows[0][&quot;ERPId&quot;].ToString();
                //    DataSet dsPO = new DataSet();
                //    DataTable dt = new DataTable();

                //    dt.Columns.Add(&quot;PurchId&quot;, typeof(System.String));
                //    dt.Columns.Add(&quot;Qty&quot;, typeof(System.String));
                //    dt.Columns.Add(&quot;WorkOrderId&quot;, typeof(System.String));
                //    dt.Columns.Add(&quot;ContractId&quot;, typeof(System.String));
                //    dt.Columns.Add(&quot;OrderAccount&quot;, typeof(System.String));
                //    DataRow dr = dt.NewRow();
                //    dr[&quot;PurchId&quot;] = purchId;
                //    dr[&quot;Qty&quot;] = WOAmt.ToString();
                //    dr[&quot;WorkOrderId&quot;] = _WorkOrderID.ToString2();
                //    dr[&quot;ContractId&quot;] = WODTO.ContractID.ToString();
                //    dr[&quot;OrderAccount&quot;] = WODTOObject.ContractorID.ToString();

                //    dt.Rows.Add(dr);
                //    dsPO.Tables.Add(dt);
                //    int count = 0;
                //    Dictionary&lt;string, object&gt; dict = new Dictionary&lt;string, object&gt;();
                //    dict.Add(&quot;ObjectId&quot;, purchId);
                //    dict.Add(&quot;AXCompany&quot;, mappedCompany);
                //    dict.Add(&quot;ObjectType&quot;, EISObjectType.WOVersion);

                //    IntegrationConnectorManager.Instance.AddERPMapInfo(_WorkOrderID.ToString2(), AMP3Object.WORKORD, WODTO.ContractID.ToString(), AMP3Object.CONTMGT, dict, RegisteredEIS.AX);

                //    if (IntegrationConnectorManager.HandleIntegration(connectorParameter, ref count, ref dsPO, false))
                //    {

                //    }
                //}

                #endregion

                //Response.Redirect(BrixDatatypeHelper.Format2(&quot;~/Common/BrixListPage.aspx?context=WORKORD&amp;PID={0}&amp;ContractID={1}&amp;&quot; + Constants.QRY_PROJECTMODE + &quot;={2}&quot;, Request[WOConstants.QRY_PROJECTID], Request[WOConstants.QRY_CONTRACTID], PMode), false);
            }
        }

        private bool ValidateWOQuantityOnIssue(decimal WOQty, int ItemID)
        {
            return !(WOQty &gt; GetAvailableQuantity(ItemID, _WorkOrderID));
        }

        private void BindQuotationData()
        {
            DataSet dsQuotations = WORKORDManager.Instance.GetQuotations(_WorkOrderID);

            uwgQuotations.DisplayLayout.NoDataMessage = &quot;No items to display&quot;;

            uwgQuotations.Height = Unit.Pixel(100);
            uwgQuotations.DataSource = dsQuotations.Tables[0];
            uwgQuotations.DataBind();

            uwgQuotations.Columns.FromKey(&quot;QuotationID&quot;).Hidden = true;
            uwgQuotations.Columns.FromKey(&quot;ContractorID&quot;).Hidden = true;

            uwgQuotations.Columns.FromKey(&quot;Date&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_DATE;
            uwgQuotations.Columns.FromKey(&quot;TotalAmount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
            uwgQuotations.Columns.FromKey(&quot;TotalAmount&quot;).Header.Caption = &quot;Total&quot;;
            uwgQuotations.Columns.FromKey(&quot;TotalAmount&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
            uwgQuotations.Columns.FromKey(&quot;TotalAmount&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;

            uwgQuotations.Columns.FromKey(&quot;% Over Low Bid&quot;).Format =
                uwgQuotations.Columns.FromKey(&quot;% Over Contract&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE;

            uwgQuotations.Columns.FromKey(&quot;% Over Low Bid&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
            uwgQuotations.Columns.FromKey(&quot;% Over Low Bid&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;

            uwgQuotations.Columns.FromKey(&quot;% Over Contract&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
            uwgQuotations.Columns.FromKey(&quot;% Over Contract&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;

            //Load Items for the Quotations template
            DataTable dtItems = dsQuotations.Tables[1];
            uwgQuotItems.DataSource = dtItems;
            uwgQuotItems.DataBind();
            SetQuotationItemsGridColumns();

            if (!(dsQuotations.Tables[0].Select(&quot;Status = 3&quot;).Length == 0))
            {
                MainToolBar.DisableMenu(&quot;lnkEdit&quot;);
                //MainToolBar.DisableMenu(&quot;lnkDelete&quot;);
                MainToolBar.DisableMenu(&quot;lnkAward&quot;);
                hdnIsAwarded.Value = &quot;1&quot;;
            }
            else
            {
                hdnIsAwarded.Value = &quot;0&quot;;
                MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).Enabled =
                    MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).Enabled =
                    MainToolBar.GetMenuReference(&quot;lnkAward&quot;).Enabled = true;
            }
            if (isVersion)
                MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).Enabled = true;

            if (!HideContractorFilter)
            {
                ddlSegment.DataSource = LoadVendorInfoFromAX(&quot;Segment&quot;);
                ddlSegment.DataTextField = &quot;SegmentId&quot;;
                ddlSegment.DataValueField = &quot;SegmentId&quot;;
                ddlSegment.DataBind();
                var li = new ListItem(&quot;--Select One--&quot;, &quot;--Select One--&quot;);
                ddlSegment.Items.Insert(0, li);

                ddlCategory.DataSource = LoadVendorInfoFromAX(&quot;Category&quot;);
                ddlCategory.DataTextField = &quot;CategoryName&quot;;
                ddlCategory.DataValueField = &quot;CategoryName&quot;;
                ddlCategory.DataBind();
                var li1 = new ListItem(&quot;--Select One--&quot;, &quot;--Select One--&quot;);
                ddlCategory.Items.Insert(0, li1);

                ddlCertification.DataSource = LoadVendorInfoFromAX(&quot;Certification&quot;);
                ddlCertification.DataTextField = &quot;CertificationNo&quot;;
                ddlCertification.DataValueField = &quot;CertificationNo&quot;;
                ddlCertification.DataBind();
                var li2 = new ListItem(&quot;--Select One--&quot;, &quot;--Select One--&quot;);
                ddlCertification.Items.Insert(0, li2);
            }
        }

        private bool IsAwarded()
        {
            for (int i = 0; i &lt; uwgQuotations.Rows.Count; i++)
            {
                if (uwgQuotations.Rows[i].Cells.FromKey(&quot;Status&quot;).Value.ToString2() == &quot;Awarded&quot;)
                    return true;
            }
            return false;
        }

        private void SetStatusMessage(bool status)
        {
            lblQuotError.Style.Add(&quot;display&quot;, &quot;block&quot;);
            lblQuotError.CssClass = (status) ? &quot;lblCOk&quot; : &quot;lblCErr&quot;;
            lblQuotError.Text = &quot;Import Succeeded&quot;;
        }

        private void SetErrorMessage(string errMessage)
        {
            lblQuotError.Style.Add(&quot;display&quot;, &quot;block&quot;);
            lblQuotError.Visible = true;
            lblQuotError.Text = errMessage;
            lblQuotError.CssClass = &quot;lblCErr&quot;;
        }

        protected bool ImportExcel(string FileName, out DataSet xslData)
        {
            DataTable xlsDataTable;
            bool status = true;
            xslData = null;
            int TableNumber = 0;
            try
            {
                string strConn = &quot;Provider=Microsoft.Jet.OLEDB.4.0;Data Source=&quot; +
                                 FileName +
                                 &quot;;Extended Properties=&#39;Excel 8.0;HDR=Yes;IMEX=1&#39;&quot;;
                string sheetName = null;


                // Extract list of tables from Excel sheet.
                var objConn = new OleDbConnection(strConn);
                objConn.Open(); // Open connection with the database.

                #region If multiple sheets are present in the Excel choose

                DataTable dtXLSSchema = objConn.GetOleDbSchemaTable((OleDbSchemaGuid.Tables), null);
                DataSet tblSchemaSet = new BrixDataSet();
                tblSchemaSet = GetSchema();
                // Get the data table containg the schema guid.
                if ((dtXLSSchema == null) || (dtXLSSchema.Rows.Count &lt; 1))
                {
                    status = false;
                    SetErrorMessage(&quot;Import Failed.&quot;);
                    //retStatus.Message = &quot;Import Failed.&quot;;
                    return status;
                }
                else if ((dtXLSSchema.Rows.Count) != (tblSchemaSet.Tables.Count))
                {
                    status = false;
                    SetErrorMessage(
                        &quot;Import Failed. Number of tables in Excel file does not match the required number of tables&quot;);
                    //retStatus.Message = &quot;Import Failed. Number of tables in Excel file does not match the required number of tables&quot;;
                    return status;
                }
                do
                {
                    sheetName = dtXLSSchema.Rows[TableNumber][&quot;TABLE_NAME&quot;].ToString2();

                    #endregion

                    #region Column Schema validation...

                    DataTable xlsSchemaTable;
                    var xlsData = new OleDbDataAdapter(&quot;SELECT top 1 * FROM [&quot; + sheetName + &quot;]&quot;, objConn);
                    xlsSchemaTable = new BrixDataTable();
                    xlsData.Fill(xlsSchemaTable);

                    #region check whether all columns in table are present in the excel sheet..

                    // For Equipment Hire Order
                    if (WorkOrderType == &quot;E&quot;)
                    {
                        foreach (DataColumn dc in tblSchemaSet.Tables[TableNumber].Columns)
                        {
                            string colName = dc.ColumnName;
                            if (colName.Contains(&quot;Number&quot;))
                                colName = &quot;No# of Equipments Required&quot;;
                            if (!xlsSchemaTable.Columns.Contains(colName))
                            {
                                status = false;
                                SetErrorMessage(&quot;Import failed. The column \&quot;&quot; + colName +
                                                &quot;\&quot; is missing in the Excel file. &quot;);
                                return status;
                            }
                        }
                    }
                    else
                    {
                        foreach (DataColumn dc in tblSchemaSet.Tables[TableNumber].Columns)
                        {
                            string colName = dc.ColumnName;
                            if (colName.Contains(&quot;ItemId&quot;))
                                colName = &quot;StandardItemNo#&quot;;
                            //else if (colName.Contains(&quot;LineNo&quot;))
                            //    colName = &quot;LineNo#&quot;;
                            else if (colName.Contains(&quot;Quantity&quot;))
                                colName = &quot;WOQuantity&quot;;
                            if (!xlsSchemaTable.Columns.Contains(colName))
                            {
                                status = false;
                                SetErrorMessage(&quot;Import failed. The column \&quot;&quot; + colName +
                                                &quot;\&quot; is missing in the Excel file. &quot;);
                                //retStatus.Message = &quot;Import failed. The column \&quot;&quot; + dc.ColumnName + &quot;\&quot; is missing in the Excel file. &quot;;
                                return status;
                            }
                        }
                    }

                    #endregion

                    #endregion

                    #region Load Data..

                    xlsDataTable = new BrixDataTable();

                    foreach (DataColumn dc in tblSchemaSet.Tables[TableNumber].Columns)
                    {
                        var col = new DataColumn();
                        col.ColumnName = dc.ColumnName;
                        switch (dc.DataType.Name.ToString2().ToUpper2())
                        {
                            case &quot;INT32&quot;:
                                col.DataType = Type.GetType(&quot;System.Int32&quot;);
                                col.DefaultValue = 0;
                                break;
                            case &quot;DECIMAL&quot;:
                                col.DataType = Type.GetType(&quot;System.Decimal&quot;);
                                col.DefaultValue = 0.0;
                                break;
                            case &quot;DATETIME&quot;:
                                col.DataType = Type.GetType(&quot;System.DateTime&quot;);
                                col.DefaultValue = MWDateTimeHelper.MWToday.Date.ToShortDateString();
                                break;
                            case &quot;DOUBLE&quot;:
                                col.DataType = Type.GetType(&quot;System.Double&quot;);
                                col.DefaultValue = 0.0;
                                break;
                            default:
                                col.DataType = Type.GetType(&quot;System.String&quot;);
                                col.DefaultValue = &quot;NA&quot;;
                                break;
                        }
                        col.AllowDBNull = dc.AllowDBNull;

                        xlsDataTable.Columns.Add(col);
                    }


                    string selectQuery = &quot;SELECT &quot;;
                    string testQuery = &quot;SELECT * FROM [&quot; + sheetName + &quot;]&quot;;
                    ;
                    DataTable temp = new BrixDataTable();
                    foreach (DataColumn dc in tblSchemaSet.Tables[TableNumber].Columns)
                    {
                        if (dc.ColumnName == &quot;ItemId&quot;)
                            selectQuery = selectQuery + &quot;[StandardItemNo#],&quot;;
                        else if (dc.ColumnName == &quot;Quantity&quot;)
                            selectQuery = selectQuery + &quot;[WOQuantity],&quot;;
                        else if (dc.ColumnName == &quot;LineNo&quot;)
                            selectQuery = selectQuery + &quot;[LineNo#],&quot;;
                        else
                            selectQuery = selectQuery + &quot;[&quot; + dc.ColumnName + &quot;],&quot;;
                    }
                    selectQuery = selectQuery.Substring(0, selectQuery.Length - 1);
                    selectQuery = selectQuery + &quot; FROM [&quot; + sheetName + &quot;]&quot;;

                    xlsData = new OleDbDataAdapter(testQuery, objConn);
                    xlsData.Fill(xlsDataTable);

                    //if (xlsDataTable != null &amp;&amp; xlsDataTable.Rows.Count == 0)
                    //{
                    //    //retStatus.Status = false;
                    //    //retStatus.Message = &quot;No Records found for upload.&quot;;
                    //    status = false;
                    //    SetErrorMessage(&quot;No Records found for upload.&quot;);
                    //    return status;
                    //}

                    if (xslData == null)
                        xslData = new BrixDataSet();
                    xslData.Tables.Add(xlsDataTable);
                    TableNumber++;
                } while (TableNumber &lt; dtXLSSchema.Rows.Count - 1);

                //Verify if the list of items in the excel matches the one in the grid.
                DataTable dtXlItems = xslData.Tables[0];
                int xlRowCnt = dtXlItems.Rows.Count;
                if (xlRowCnt != uwgQuotItems.Rows.Count)
                {
                    SetErrorMessage(&quot;The number of rows in the Excel file do not match the number of &quot; +
                                    LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR) +
                                    &quot;s that are part of this Work Order&quot;);
                    return false;
                }

                RowsCollection rows = uwgQuotItems.Rows;
                decimal totalAmount = 0;

                if (WorkOrderType == &quot;E&quot;)
                {
                    for (int i = 0; i &lt; rows.Count; i++)
                    {
                        string name = rows[i].Cells.FromKey(&quot;Name&quot;).Text;
                        DataRow[] dtEquipments = dtXlItems.Select(&quot;Name = &#39;&quot; + name + &quot;&#39;&quot;);
                        if (dtEquipments.Length == 0)
                        {
                            SetErrorMessage(&quot;Equipment Name is missing in the Excel file.&quot;);
                            ResetQuotationItemsRate();
                            return false;
                        }
                        else
                        {
                            string ratetxt = dtEquipments[0][&quot;Rate&quot;].ToString2();
                            decimal rate = 0;
                            if (string.IsNullOrEmpty(ratetxt) || !decimal.TryParse(ratetxt, out rate))
                            {
                                SetErrorMessage(&quot;Equipment with Name : &quot; + name +
                                                &quot;does not have a valid entry for rate.&quot;);
                                ResetQuotationItemsRate();
                                return false;
                            }
                            rows[i].Cells.FromKey(&quot;Rate&quot;).Value = rate;
                            rows[i].Cells.FromKey(&quot;Amount&quot;).Value = rate *
                                                                    rows[i].Cells.FromKey(&quot;Quantity&quot;).Value.ToDecimal2();
                            totalAmount += rate * rows[i].Cells.FromKey(&quot;Quantity&quot;).Value.ToDecimal2();
                        }
                    }
                }
                else
                {
                    for (int i = 0; i &lt; rows.Count; i++)
                    {
                        string lineNo = rows[i].Cells.FromKey(&quot;LineNo&quot;).Text;
                        DataRow[] dtRows = dtXlItems.Select(&quot;LineNo = &#39;&quot; + lineNo + &quot;&#39;&quot;);
                        if (dtRows.Length == 0)
                        {
                            SetErrorMessage(LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR) +
                                            &quot; with Line No. : &quot; + lineNo + &quot;is missing in the Excel file.&quot;);
                            ResetQuotationItemsRate();
                            return false;
                        }
                        else
                        {
                            string ratetxt = dtRows[0][&quot;Rate&quot;].ToString2();
                            decimal rate = 0;
                            if (string.IsNullOrEmpty(ratetxt) || !decimal.TryParse(ratetxt, out rate))
                            {
                                SetErrorMessage(LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR) +
                                                &quot; with Line No. : &quot; + lineNo + &quot;does not have a valid entry for rate.&quot;);
                                ResetQuotationItemsRate();
                                return false;
                            }
                            rows[i].Cells.FromKey(&quot;Rate&quot;).Value = rate;
                            rows[i].Cells.FromKey(&quot;Amount&quot;).Value = rate *
                                                                    rows[i].Cells.FromKey(&quot;Quantity&quot;).Value.ToDecimal2();
                            totalAmount += rate * rows[i].Cells.FromKey(&quot;Quantity&quot;).Value.ToDecimal2();
                        }
                    }
                }

                wneTotal.Value = totalAmount;

                return status;
            }
            catch (Exception ex)
            {
                SetErrorMessage(ex.Message);
                //retStatus.Message = ex.Message;
                return false;
            }

            #endregion
        }

        private void ResetQuotationItemsRate()
        {
            RowsCollection rows = uwgQuotItems.Rows;
            for (int i = 0; i &lt; rows.Count; i++)
            {
                rows[i].Cells.FromKey(&quot;Rate&quot;).Value = 0;
            }
        }

        protected bool PersistExcelData(DataSet xlsData)
        {
            bool status = true;
            string ID = &quot;ID&quot;;
            DataTable dtdatafromtable = new BrixDataTable();
            DataSet ds = WORKORDManager.Instance.GetQuotations(_WorkOrderID);
            dtdatafromtable = ds.Tables[1];
            DataRow[] dx;

            DataTable xlsDataTable1 = xlsData.Tables[0];

            xlsDataTable1.Columns.Add(&quot;MustDelete&quot;, typeof(string));
            xlsDataTable1.Columns[&quot;MustDelete&quot;].DefaultValue = &quot;N&quot;;
            foreach (DataRow dr in xlsDataTable1.Select(ID + &quot;=&#39;&#39;&quot;))
            {
                //xlsDataTable.Rows.Remove(dr);
                dr[ID] = 0;
                dr[&quot;MustDelete&quot;] = &quot;Y&quot;;
            }

            foreach (DataRow dr in xlsDataTable1.Rows)
            {
                dx = dtdatafromtable.Select(ID + &quot;=&#39;&quot; + dr[ID] + &quot;&#39;&quot;);
                if (dx.Length &gt; 0)
                    dr[&quot;MustDelete&quot;] = &quot;Y&quot;;
                DataRow[] duplicateRowsExcel = xlsDataTable1.Select(ID + &quot;=&#39;&quot;
                                                                    + dr[ID].ToString2().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) + &quot;&#39;&quot;);
                if (duplicateRowsExcel.Length &gt; 1)
                {
                    dr[&quot;MustDelete&quot;] = &quot;Y&quot;;
                    continue;
                }
            }

            foreach (DataRow dr in xlsDataTable1.Select(&quot;MustDelete=&#39;Y&#39;&quot;))
            {
                dr.Delete();
            }
            xlsDataTable1.Columns.Remove(&quot;MustDelete&quot;);

            xlsDataTable1.AcceptChanges();
            //if (xlsDataTable1.Rows.Count == 0)
            //{
            //    status.Status = false;
            //    status.Message = &quot;No data was Imported.&quot;;
            //    return status;
            //}

            uwgQuotItems.DataSource = xlsDataTable1;

            status = (uwgQuotItems.Rows.Count == 0) ? false : true;
            //GetResult(xlsData, ParentInstanceID);
            return status;
        }

        protected DataSet GetSchema()
        {
            DataTable ItemTab = new BrixDataTable();
            DataSet dsitems = new BrixDataSet();
            ItemTab = dsitems.Tables.Add(&quot;WorkOrderItems&quot;);
            ItemTab.Columns.AddRange(QuotationsItemsSchema());
            ItemTab.Rows.Add(new object[] { null, null, null });

            return dsitems;
        }

        private bool SaveAttachments(int WorkOrderID, UserDetail user, bool IsVersion)
        {
            try
            {
                ((AttachmentsControl)attachments).ParentModuleID = Constants.MODID_CONTMGT;
                ((AttachmentsControl)attachments).ParentInstanceID = Request[WOConstants.QRY_CONTRACTID].ToInt32_2();
                return ((IsVersion)
                            ? ((AttachmentsControl)attachments).CreateAttachmentsForVersions(WorkOrderID.ToString2(),
                                                                                              WOConstants.MODULE_NAME,
                                                                                              user.UID, user.UserName,
                                                                                              &quot;Work Order Attachments&quot;)
                            : ((AttachmentsControl)attachments).SaveAttachments(WorkOrderID.ToString2(),
                                                                                 WOConstants.MODULE_NAME, user.UID,
                                                                                 user.UserName, &quot;Work Order Attachments&quot;));
            }
            catch
            {
                return false;
            }
        }

        protected override void CreateChildControls()
        {
            //var menus = new MenuArray();
            //menus.Add(new BrixMenu(&quot;lnkNew&quot;, &quot;New&quot;, &quot;Icn_New.png&quot;, 55));
            //menus.Add(new BrixMenu(&quot;lnkEdit&quot;, &quot;Edit&quot;, &quot;IcnEdit.png&quot;, 55));
            //menus.Add(new BrixMenu(&quot;lnkDelete&quot;, &quot;Delete&quot;, &quot;Icn_Delete.png&quot;, 55));
            //menus.Add(new BrixMenu(&quot;lnkShortClose&quot;, &quot;Short Close&quot;, &quot;Icn_Version.png&quot;, 55));
            ////The menus Award,Reject and Revert are changed as sub menus under Actions menu.
            //var actionsMenu = new BrixMenu(&quot;lnkActions&quot;, &quot;Actions&quot;, &quot;IcnOthers.png&quot;, 70, 170);
            //actionsMenu.subMenus.Add(new BrixMenu(&quot;lnkAward&quot;, &quot;Award&quot;, &quot;Icn_Award16.png&quot;, 15));
            //actionsMenu.subMenus.Add(new BrixMenu(&quot;lnkReject&quot;, &quot;Reject&quot;, &quot;Icn_Reject16.png&quot;, 15));
            //actionsMenu.subMenus.Add(new BrixMenu(&quot;lnkRevert&quot;, &quot;Revert&quot;, &quot;Icn_Unapprove16.png&quot;, 15));
            //menus.Add(actionsMenu);
            //if (AllowSave)
            //    menus.Add(new BrixMenu(&quot;lnkSave&quot;, &quot;Save&quot;, &quot;Icn_Save.png&quot;, 55));
            //menus.Add(new BrixMenu(&quot;lnkImport&quot;, &quot;Export To Excel&quot;, &quot;Icn_Add.png&quot;, 55));
            //menus.Add(new BrixMenu(&quot;lnkCancel&quot;, &quot;Cancel&quot;, &quot;Icn_Cancel.png&quot;, 55));
            //CreateToolBarMenu(menus, null);

            var menuGroups = new List&lt;MenuGroup&gt;();
            MenuGroup generalGroup = new MenuGroup(&quot;General&quot;);
            if (AllowSave)
                generalGroup.AddMenu(new LargeButton(&quot;lnkSave&quot;, &quot;Save&quot;, &quot;Icn_Save.png&quot;));
            generalGroup.AddMenu(new LargeButton(&quot;lnkImport&quot;, &quot;Export&quot;, &quot;Icn_export.png&quot;));
            generalGroup.AddMenu(new LargeButton(&quot;lnkCancel&quot;, &quot;Cancel&quot;, &quot;Icn_Cancel.png&quot;));


            generalGroup.AddMenu(new TextIcon(&quot;lnkNew&quot;, &quot;New&quot;, &quot;Icn_New_16.png&quot;));
            generalGroup.AddMenu(new TextIcon(&quot;lnkEdit&quot;, &quot;Edit&quot;, &quot;Icn_Edit_16.png&quot;));
            generalGroup.AddMenu(new TextIcon(&quot;lnkDelete&quot;, &quot;Delete&quot;, &quot;Icn_Delete_16.png&quot;));
            generalGroup.AddMenu(new TextIcon(&quot;lnkShortClose&quot;, &quot;Short Close&quot;, &quot;Icn_ShortClose_16.png&quot;));

            LargeButton actionButton = new LargeButton(&quot;lnkActions&quot;, &quot;Actions&quot;, &quot;Icn_Others.png&quot;);
            actionButton.AddSubMenu(new LargeButton(&quot;lnkAward&quot;, &quot;Award&quot;, &quot;Icn_Award_16.png&quot;));
            actionButton.AddSubMenu(new LargeButton(&quot;lnkReject&quot;, &quot;Reject&quot;, &quot;Icn_Reject_16.png&quot;));
            actionButton.AddSubMenu(new LargeButton(&quot;lnkRevert&quot;, &quot;Revert&quot;, &quot;Icn_Revert_16.png&quot;));
            generalGroup.AddMenu(actionButton);
            menuGroups.Add(generalGroup);

            CreateToolBarMenu(menuGroups, null);

            base.CreateChildControls();

            //if (Request[&quot;Type&quot;] == &quot;E&quot; &amp;&amp; Request[&quot;Version&quot;] != &quot;true&quot;)
            //{
            //    DataSet ds = ComponentHelper.Instance.ExecuteDataSet(WOStoredProcedure.WORKORDGetWO, null, BrixDatatypeHelper.ToInt32_2(Request[&quot;WOID&quot;]));

            //    if (BrixDatatypeHelper.ToInt32_2(ds.Tables[0].Rows[0][&quot;Status&quot;].ToString()) &gt; 2)
            //    {
            //        MainToolBar.HideMenu(&quot;lnkSave&quot;);
            //    }
            //}
        }

        protected void btnAddItem_Click(object sender, EventArgs e)
        {
            if (hdnVisibleTab.Value != &quot;tab2&quot; &amp;&amp; !WorkOrderType.Equals(&quot;E&quot;))
            {
                btnItemPicker_Click(sender, e);
            }
            else
            {
                trQuotTemplate.Style.Value = &quot;display:block&quot;;
                ddlContractors.SelectedIndex = 0;
                txtQNotes.Text = string.Empty;
                wbcDate.Value = MWDateTimeHelper.MWToday.Date;
                foreach (UltraGridRow ugr in uwgQuotItems.Rows)
                {
                    ugr.Cells.FromKey(&quot;Rate&quot;).Value = 0;
                    ugr.Cells.FromKey(&quot;Amount&quot;).Value = 0;
                }
            }
        }

        protected void btnItemPicker_Click(object sender, EventArgs e)
        {
            ShowDiv(ItemDivEnums.ItemPicker);
        }

        protected override void CustomizeToolBar()
        {
            if (permissions == null)
            {
                GetPermissions();
            }
            if (MainToolBar.GetMenuReference(&quot;lnkNew&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkNew&quot;).Click += btnAddItem_Click;
                MainToolBar.GetMenuReference(&quot;lnkNew&quot;).OnClientClick = &quot;javascript:return HandleNew();&quot;;
            }

            if (MainToolBar.GetMenuReference(&quot;lnkEdit&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).Click += lnkEdit_Click;
                MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).OnClientClick = &quot;javascript:return HandleEdit();&quot;;
            }
            if (MainToolBar.GetMenuReference(&quot;lnkDelete&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).Click += lnkDelete_Click;
                MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).OnClientClick = &quot;javascript:return HandleDelete();&quot;;
            }
            //If the user has enough permission then only can do award,reject,revert
            if (MainToolBar.GetMenuReference(&quot;lnkAward&quot;) != null)
            {
                if (permissions.Contains(&quot;AwardQtn&quot;))
                {
                    MainToolBar.GetMenuReference(&quot;lnkAward&quot;).Click += lnkAward_Click;
                    MainToolBar.GetMenuReference(&quot;lnkAward&quot;).OnClientClick = &quot;javascript:return AwardQuotation();&quot;;
                }
                else
                {
                    MainToolBar.DisableMenu(&quot;lnkAward&quot;);
                    MainToolBar.GetMenuReference(&quot;lnkAward&quot;).OnClientClick = &quot;javascript:return false;&quot;;
                }
            }
            if (MainToolBar.GetMenuReference(&quot;lnkReject&quot;) != null &amp;&amp; permissions.Contains(&quot;RejectQtn&quot;))
            {
                MainToolBar.GetMenuReference(&quot;lnkReject&quot;).Click += lnkReject_Click;
                MainToolBar.GetMenuReference(&quot;lnkReject&quot;).OnClientClick =
                    &quot;javascript:return MultiOpsQuotations(&#39;reject&#39;);&quot;;
            }
            else
            {
                MainToolBar.DisableMenu(&quot;lnkReject&quot;);
            }
            if (MainToolBar.GetMenuReference(&quot;lnkRevert&quot;) != null &amp;&amp; permissions.Contains(&quot;RevertQtn&quot;))
            {
                MainToolBar.GetMenuReference(&quot;lnkRevert&quot;).Click += lnkRevert_Click;
                MainToolBar.GetMenuReference(&quot;lnkRevert&quot;).OnClientClick =
                    &quot;javascript:return MultiOpsQuotations(&#39;revert&#39;);&quot;;
            }
            else
            {
                MainToolBar.DisableMenu(&quot;lnkRevert&quot;);
            }
            if (MainToolBar.GetMenuReference(&quot;lnkShortClose&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkShortClose&quot;).Click += lnkShortClose_Click;
                MainToolBar.GetMenuReference(&quot;lnkShortClose&quot;).OnClientClick = &quot;javascript:return PreShortClose();&quot;;
            }
            if (MainToolBar.GetMenuReference(&quot;lnkSave&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkSave&quot;).Click += btnSave_Click;
                MainToolBar.GetMenuReference(&quot;lnkSave&quot;).OnClientClick = &quot;javascript:return Validate();&quot;;
            }
            if (MainToolBar.GetMenuReference(&quot;lnkImport&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkImport&quot;).Click += btnExport_Click;
                MainToolBar.GetMenuReference(&quot;lnkImport&quot;).OnClientClick = &quot;javascript:return ValidateExport();&quot;;
            }
            if (MainToolBar.GetMenuReference(&quot;lnkCancel&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkCancel&quot;).Click += Cncl_Click;
            }
        }

        protected override void OnPreRender(EventArgs e)
        {
            if (!String.IsNullOrEmpty(Request[&quot;Mode&quot;]) &amp;&amp; Request[&quot;Mode&quot;] == &quot;View&quot; &amp;&amp;
                MainToolBar.GetMenuReference(&quot;lnkSave&quot;) != null)
                MainToolBar.HideMenu(&quot;lnkSave&quot;);

            base.OnPreRender(e);
        }

        #endregion

        //This region is used for checking the validations while editing or deleting equipments in equipment hire order version screen.

        public string FormInstanceId
        {
            get
            {
                int id = -1;
                if (
                    string.IsNullOrEmpty(Request.QueryString[&quot;Version&quot;]) ||
                    (!string.IsNullOrEmpty(Request.QueryString[&quot;Version&quot;]) &amp;&amp; !string.IsNullOrEmpty(Request.QueryString[&quot;IsEditVersion&quot;])) ||
                    string.IsNullOrEmpty(hdnWorkOrderID.Value))
                {
                    id = (string.IsNullOrEmpty(Request.QueryString[&quot;WOID&quot;]) || !string.IsNullOrEmpty(Request.QueryString[&quot;IsCopy&quot;]))
                             ? -1
                             : int.TryParse(Request.QueryString[&quot;WOID&quot;], out id) ? id : -1;
                }
                else
                {
                    id = hdnWorkOrderID.Value.ToInt32_2();
                }
                return id.ToString();
            }
        }

        string FormKeyWOVersion
        {
            get
            {
                return Convert.ToString(ComponentHelper.Instance.ExecuteScalar(&quot;SELECT VersionNo from WORKORDMain where WorkOrderID = {0}&quot;, _WorkOrderID));
            }
        }

        public string FormKey { get { return string.Format(&quot;Work Order Number : {0} {1}&quot;, txtUserWONo.Text, FormKeyWOVersion); } }

        public string FormName
        {
            get { return &quot;XWRKORD&quot;; }
        }

        public string ClientValidationFunction
        {
            get { return &quot;Validate()&quot;; }
        }

        public bool IsOldWorkflow
        {
            get { return true; }
        }

        public int PID
        {
            get { return Request.QueryString[&quot;PID&quot;].ToInt32_2(); }
        }

        public int ParentModuleId
        {
            get
            {
                int id = String.IsNullOrEmpty(Request.QueryString[&quot;ContractID&quot;])
                             ? -1
                             : int.TryParse(Request.QueryString[&quot;ContractID&quot;], out id) ? id : -1;
                return id;
            }
        }

        public string PostCancelRedirectUrl
        {
            get
            {
                return String.Format(CultureInfo.CurrentCulture,
                                     &quot;~/Common/BrixListPage.aspx?context=WORKORD&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&quot;, PID,
                                     ParentModuleId);
            }
        }

        #region ICallbackEventHandler Members

        public override string GetCallbackResult()
        {
            return CallBackResult;
        }

        public override void RaiseCallbackEvent(string eventArgument)
        {
            String[] parameters = eventArgument.Split(&quot;;&quot;.ToCharArray());
            string EquipmentID = parameters[0];
            int ActualEquipmentID = 0;
            decimal Quantity = Convert.ToDecimal(parameters[1], CultureInfo.CurrentCulture);
            string ModeType = parameters[2];

            try
            {
                DataSet dsValidateVersion = WOManager.Instance.ValidateEquipmentHireOrderVersion(EquipmentID,
                                                                                                 ActualEquipmentID,
                                                                                                 Quantity, ModeType);
                CallBackResult += dsValidateVersion.Tables[0].Rows[0][&quot;retVal&quot;] + &quot;;&quot; +
                                  dsValidateVersion.Tables[0].Rows[0][&quot;UsedQuantity&quot;].ToInt32_2();
            }
            catch (Exception ex)
            {
                CallBackResult = &quot;Error: &quot; + ex.Message;
            }
        }

        #endregion

        private void RegisterCallBackScript()
        {
            var sb = new StringBuilder();
            sb.Append(&quot;&lt;script language=\&quot;javascript\&quot; type=\&quot;text/javascript\&quot;&gt;&quot;);
            sb.Append(&quot;function SendValidateQuantityRequest(arguments,context){&quot;);
            sb.Append(Page.ClientScript.GetCallbackEventReference(this, &quot;arguments&quot;, &quot;HandleValidateQuantityResponse&quot;,
                                                                  &quot;context&quot;, true));
            sb.Append(&quot;}&quot;);
            sb.Append(&quot;&lt;/script&gt;&quot;);
            Page.ClientScript.RegisterStartupScript(GetType(), &quot;HEOCallBackScript&quot;, sb.ToString2());
        }

        private void SetGeneralTabReadOnly(bool readOnly)
        {
            txtWONo.ReadOnly =
                txtWOReqBy.ReadOnly =
                dtWODate.ReadOnly =
                txtDesc.ReadOnly =
                txtNotes.ReadOnly =
                txtScope.ReadOnly =
                txtTaxPayerID.ReadOnly =
                txtLicenseCity.ReadOnly =
                txtLicenseState.ReadOnly =
                txtInsurance.ReadOnly =
                dtStartDate.ReadOnly =
                dtEndDate.ReadOnly =
                txtPrepaymentRule.ReadOnly =
                wneMaxAmount.ReadOnly =
                wneMaxPercentage.ReadOnly =
                txtRetentionRule.ReadOnly =
                wneRetentionPercentage.ReadOnly =
                wneRetentionCeiling.ReadOnly =
                readOnly;

            if (OnlyCustomerWONo)
                txtUserWONo.ReadOnly = readOnly;

            chkWithMaterial.Enabled =
                chkWithEquipment.Enabled =
                chkWithLabour.Enabled =
                btnPrepaymentRulePicker.Enabled =
                btnRetentionRulePicker.Enabled =
                !readOnly;

        }

        private void SetSOQTabReadOnly(bool readOnly)
        {
            txtEquipmentName.ReadOnly =
                txtEquipmentDescription.ReadOnly =
                wneNumber.ReadOnly =
                wneDuration.ReadOnly =
                wneEquipmentQuantity.ReadOnly =
                wneUnitCost.ReadOnly =
                wneEquipmentAmount.ReadOnly =
                txtEquipmentNotes.ReadOnly =
                readOnly;

            ddlEquipmentUnit.Enabled =
                btnEquipmentSave.Enabled =
                !readOnly;
        }

        private void SetQuotationsTabReadOnly(bool readOnly)
        {
            wbcDate.ReadOnly =
                txtQNotes.ReadOnly =
                wneTotal.ReadOnly =
                readOnly;

            ddlSegment.Enabled =
                ddlCategory.Enabled =
                ddlCertification.Enabled =
                btnFetchContractor.Enabled =
                ddlContractors.Enabled =
                btnImport.Enabled =
                FileUpload1.Enabled =
                btnUpload.Enabled =
                btnSave1.Enabled =
                btnSaveQuot.Enabled =
                btnCancelQuot.Enabled =
                !readOnly;
        }

        public void CancelHandler(object sender, bool bAfterSave, out string sRedirectTo)
        {
            throw new NotImplementedException();
        }

        public string PostSaveRedirectUrl(string sSavedToken = &quot;&quot;)
        {
            if (!string.IsNullOrEmpty(Request[&quot;Mode&quot;]))
                return &quot;NewWorkOrder.aspx?ContractID={0}&amp;PID={1}&amp;ParentID={0}&amp;ParentContext=CONTMGT&quot;.Format2(Request[&quot;ContractID&quot;],
                                                                                                Request[&quot;PID&quot;]);
            return String.Format(CultureInfo.CurrentCulture,
                                 &quot;~/Common/BrixListPage.aspx?Context=WORKORD&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&quot;, PID,
                                 ParentModuleId);
        }

        public bool SaveHandler(object sender, out string sSavedInstanceToken, out string sErrors,
                                out string sRedirectTo)
        {
            sSavedInstanceToken = &quot;&quot;;
            sErrors = &quot;&quot;;
            sRedirectTo = &quot;&quot;;
            bool wfBtn = false;
            if (sender.GetType().FullName.Contains(&quot;HiddenField&quot;))
                wfBtn = true;

            if (hdnStage.Value != WOConstants.STAGE_APPROVE_AMENDMENT.ToString2())
                SaveWorkOrder(out sErrors, out sSavedInstanceToken, wfBtn);
            else
                sSavedInstanceToken = hdnWorkOrderID.Value;
            //sSavedInstanceToken = hdnWorkOrderID.Value.ToString();
            VersionNo = ComponentHelper.Instance.ExecuteScalar(&quot;SELECT VersionNo from WORKORDMain where WorkOrderNo = {0}&quot;, txtWONo.Text).ToString2();

            if (string.IsNullOrEmpty(sErrors) &amp;&amp; !(string.IsNullOrEmpty(sSavedInstanceToken)) &amp;&amp;
                sSavedInstanceToken != &quot;-1&quot;)
                return true;
            else
            {
                if (!string.IsNullOrEmpty(sErrors))
                    sErrors = sErrors.Replace(&quot;Prepayment&quot;, &quot;Pre-Payment&quot;).Replace(&quot;BOQ&quot;, ItemNameAbbr);
                return false;
            }
        }

        protected override void SetModes()
        {
            _IsEdit = !string.IsNullOrEmpty(Request.QueryString[&quot;Type&quot;]) &amp;&amp; Request.QueryString[&quot;Type&quot;].ToLower() == &quot;e&quot;;
            _IsView = !string.IsNullOrEmpty(Request.QueryString[&quot;Type&quot;]) &amp;&amp; Request.QueryString[&quot;Type&quot;].ToLower() == &quot;v&quot;;
            _IsNew = (string.IsNullOrEmpty(Request.QueryString[&quot;Version&quot;])
                          ? (!string.IsNullOrEmpty(Request.QueryString[&quot;Type&quot;])
                                 ? Request.QueryString[&quot;Type&quot;].ToLower() == &quot;n&quot;
                                 : !IsEdit &amp;&amp; !IsView
                            )
                          : (Request.QueryString[&quot;Version&quot;] == &quot;true&quot; &amp;&amp;
                             string.IsNullOrEmpty(Request.QueryString[&quot;IsEditVersion&quot;]))
                     );
            _IsList = !string.IsNullOrEmpty(Request.QueryString[&quot;Type&quot;]) &amp;&amp;
                      Request.QueryString[&quot;Type&quot;].ToLower() == &quot;list&quot;;
        }

        #region Prepayment rule and retention rule association

        #region Event handlers

        public void prepaymentRulePicker_BindData(string Filter, string SortOrder, out DataSet DsResult,
                                                  ref int CurrentPage, int PageSize, out int PageCount)
        {
            DsResult = new DataSet();
            DataTable dtPrepaymentDetails = new BrixDataTable();
            if (!string.IsNullOrEmpty(Filter))
            {
                prepaymentPicker.Currency = LocalizationManager.GetModuleCurrency(&quot;WORKORD&quot;, _WorkOrderID.ToString2());
                var doc = new XmlDocument();
                doc.LoadXml(Filter);
                string prepaymentRule = ((doc).DocumentElement.SelectSingleNode(&quot;PrepaymentRuleName&quot;)) == null
                                            ? string.Empty
                                            : ((doc).DocumentElement.SelectSingleNode(&quot;PrepaymentRuleName&quot;)).InnerText.
                                                  ToString2();
                string description = ((doc).DocumentElement.SelectSingleNode(&quot;Description&quot;)) == null
                                         ? string.Empty
                                         : ((doc).DocumentElement.SelectSingleNode(&quot;Description&quot;)).InnerText.ToString2();
                try
                {
                    //Exception is thrown if the select query returns zero rows.
                    dtPrepaymentDetails =
                        dtRecovery.Copy().Select(&quot;RecoveryRuleName like &#39;%&quot; + prepaymentRule.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) +
                                                 &quot;%&#39; and Description like &#39;%&quot; + description.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) + &quot;%&#39;&quot;).CopyToDataTable();
                }
                catch
                {
                }
            }
            else
            {
                dtPrepaymentDetails = dtRecovery.Copy();
            }
            dtPrepaymentDetails.Columns.Add(&quot;PrepayValue&quot;, typeof(string));
            for (int i = 0; i &lt; dtPrepaymentDetails.Rows.Count; i++)
            {
                if (dtPrepaymentDetails.Rows[i][&quot;prepaymentmode&quot;].ToString2().ToLower2() == &quot;true&quot; ||
                    dtPrepaymentDetails.Rows[i][&quot;prepaymentmode&quot;].ToString2() == &quot;1&quot;)
                    dtPrepaymentDetails.Rows[i][&quot;PrepayValue&quot;] =
                        dtPrepaymentDetails.Rows[i][&quot;Value&quot;].ToDecimal2().ToString(AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE,
                                                                                   CultureInfo.CurrentCulture) + &quot; %&quot;;
                else
                    dtPrepaymentDetails.Rows[i][&quot;PrepayValue&quot;] =
                        dtPrepaymentDetails.Rows[i][&quot;Value&quot;].ToDecimal2().ToString(AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE,
                                                                                   CultureInfo.CurrentCulture) + &quot; in &quot; +
                        LocalizationManager.GetModuleCurrency(Constants.MODID_CONTMGT, _ContractID.ToString2());
            }
            dtPrepaymentDetails.AcceptChanges();
            DsResult.Tables.Add(dtPrepaymentDetails);
            PageCount = (int)Math.Ceiling(dtPrepaymentDetails.Rows.Count.ToDecimal2() / PageSize);
        }

        private void prepaymentRulePicker_BackClicked(object sender, EventArgs e)
        {
            ShowDiv(ItemDivEnums.CreateWO);
        }

        private void prepaymentRulePicker_SelectedIndexChanged(object sender, ItemSelectedEventArgs e)
        {
            string mode = string.Empty;
            string format = string.Empty;
            string recoveryID = e.SelectedItems.Rows[0][&quot;RecoveryID&quot;].ToString2();
            bool addPrepayment = false;

            if (isVersion)
            {
                int isValid = WORKORDManager.Instance.ValidatePrepaymentRule(_WorkOrderID, recoveryID.ToInt32_2());
                if (isValid == 0)
                    addPrepayment = true;
                else
                    addPrepayment = false;
            }
            else
                addPrepayment = true;

            if (addPrepayment)
            {
                DataRow[] dtRec = dtRecovery.Select(&quot;RecoveryId=&quot; + recoveryID);
                DataRow rowPrepaymentDetails = dtRec[0];
                mode = ((rowPrepaymentDetails[&quot;Prepaymentmode&quot;].ToString2() == &quot;False&quot; ||
                         rowPrepaymentDetails[&quot;Prepaymentmode&quot;].ToString2() == &quot;1&quot;)
                            ? WOConstants.MODE_AMOUNT
                            : WOConstants.MODE_PERCENTAGE);
                format = (mode == WOConstants.MODE_PERCENTAGE ? AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE : AMP3ApplicationSettings.Instance.FORMAT_AMOUNT);
                wneMaxPercentage.Value =
                    ((rowPrepaymentDetails[&quot;Prepaymentmode&quot;].ToString2() == &quot;True&quot; ||
                      rowPrepaymentDetails[&quot;Prepaymentmode&quot;].ToString2() == &quot;0&quot;)
                         ? rowPrepaymentDetails[&quot;Value&quot;].ToString2()
                         : &quot;0&quot;).ToDecimal2().ToString(AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE, CultureInfo.CurrentCulture);
                wneMaxAmount.Value =
                    ((rowPrepaymentDetails[&quot;Prepaymentmode&quot;].ToString2() == &quot;False&quot; ||
                      rowPrepaymentDetails[&quot;Prepaymentmode&quot;].ToString2() == &quot;1&quot;)
                         ? rowPrepaymentDetails[&quot;Value&quot;].ToString2()
                         : &quot;0&quot;).ToDecimal2().ToString(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture);
                txtPrepaymentRule.Text = e.SelectedItems.Rows[0][&quot;RecoveryRuleName&quot;].ToString2();

                CalculateAmountOrPercentage(mode);
                HideShowTB(mode);

                DataTable dtPrepaymentType = new BrixDataTable();
                var col = new DataColumn[] { };

                dtPrepaymentType.Columns.AddRange(new[]
                                                      {
                                                          new DataColumn(WOConstants.HEADING_SL_NO),
                                                          new DataColumn(WOConstants.HEADING_PREPAYMENTNAME),
                                                          new DataColumn(WOConstants.HEADING_PREPAYMENTVALUE),
                                                          new DataColumn(WOConstants.HEADING_RECOVERYVALUE),
                                                          new DataColumn(WOConstants.HEADING_RV_IN_RAB),
                                                          new DataColumn(WOConstants.HEADING_RABNO),
                                                          new DataColumn(WOConstants.HEADING_AMOUNT_PAID),
                                                          new DataColumn(WOConstants.HEADING_RECOVERED_AMOUNT)
                                                      });


                int i = 0;
                foreach (DataRow row in dtPrepayment.Rows)
                {
                    if (recoveryID == row[&quot;RecoveryID&quot;].ToString2())
                    {
                        i++;
                        DataRow r = dtPrepaymentType.NewRow();
                        r[WOConstants.HEADING_SL_NO] = i;
                        r[WOConstants.HEADING_PREPAYMENTNAME] = row[&quot;PrepaymentType&quot;];
                        r[WOConstants.HEADING_PREPAYMENTVALUE] =
                            (row[&quot;PrepaymentValue&quot;].ToString2() == &quot;&quot; ? &quot;0&quot; : row[&quot;PrepaymentValue&quot;]).ToDecimal2().
                                ToString(format, CultureInfo.CurrentCulture).ToDecimal2();
                        r[WOConstants.HEADING_RECOVERYVALUE] =
                            (row[&quot;RecoveryValue&quot;].ToString2() == &quot;&quot; ? &quot;0&quot; : row[&quot;RecoveryValue&quot;]).ToDecimal2().ToString(
                                format, CultureInfo.CurrentCulture).ToDecimal2();
                        r[WOConstants.HEADING_RV_IN_RAB] =
                            CalculateRecoveryValueInEachRAB(row[&quot;RecoveryValue&quot;].ToString2(),
                                                            row[&quot;PrepaymentValue&quot;].ToString2(), mode).ToDecimal2().
                                ToString(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture).ToDecimal2();
                        r[WOConstants.HEADING_RABNO] = row[&quot;RABillNumber&quot;];
                        r[WOConstants.HEADING_AMOUNT_PAID] =
                            row[WOConstants.HEADING_AMOUNT_PAID].ToDecimal2().ToString(format,
                                                                                       CultureInfo.CurrentCulture).
                                ToDecimal2();
                        r[WOConstants.HEADING_RECOVERED_AMOUNT] =
                            row[WOConstants.HEADING_RECOVERED_AMOUNT].ToDecimal2().ToString(format,
                                                                                            CultureInfo.CurrentCulture).
                                ToDecimal2();
                        dtPrepaymentType.Rows.Add(r);
                        dtPrepaymentType.AcceptChanges();
                    }
                }
                hdnRecoveryID.Value = recoveryID;
                uwgPrepaymentTypes.DataSource = dtPrepaymentType;
                uwgPrepaymentTypes.DataBind();


                FormatPrepaymentTypesGrid(mode);

                ShowDiv(ItemDivEnums.CreateWO);
            }
            else
                Page.ClientScript.RegisterStartupScript(GetType(), &quot;Prepayment&quot;,
                                                        &quot;alert(&#39;This Pre-payment Rule does not have all the pre-payment types for which the pre-payments have already been raised. Request denied.&#39;);&quot;,
                                                        true);
        }

        public void retentionRulePicker_BindData(string Filter, string SortOrder, out DataSet DsResult,
                                                 ref int CurrentPage, int PageSize, out int PageCount)
        {
            DsResult = new DataSet();

            prepaymentPicker.Currency = LocalizationManager.GetModuleCurrency(&quot;WORKORD&quot;, _WorkOrderID.ToString2());
            DataTable dtRetentionDetails = new BrixDataTable();
            if (Filter != null)
            {
                prepaymentPicker.Currency = LocalizationManager.GetModuleCurrency(&quot;WORKORD&quot;, _WorkOrderID.ToString2());
                var doc = new XmlDocument();
                doc.LoadXml(Filter);
                string prepaymentRule = ((doc).DocumentElement.SelectSingleNode(&quot;RetentionRuleName&quot;)) == null
                                            ? string.Empty
                                            : ((doc).DocumentElement.SelectSingleNode(&quot;RetentionRuleName&quot;)).InnerText.
                                                  ToString2();
                string description = ((doc).DocumentElement.SelectSingleNode(&quot;Description&quot;)) == null
                                         ? string.Empty
                                         : ((doc).DocumentElement.SelectSingleNode(&quot;Description&quot;)).InnerText.ToString2();
                try
                {
                    //Exception is thrown if the select queries returns zero rows.
                    dtRetentionDetails =
                        dtRetention.Copy().Select(&quot;RetentionRuleName like &#39;%&quot; + prepaymentRule.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) +
                                                  &quot;%&#39; and Description like &#39;%&quot; + description.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) + &quot;%&#39;&quot;).CopyToDataTable();
                }
                catch
                {
                }
            }
            else
            {
                dtRetentionDetails = dtRetention.Copy();
            }
            dtRetentionDetails.Columns.Add(&quot;RetentnValue&quot;, typeof(string));
            for (int i = 0; i &lt; dtRetentionDetails.Rows.Count; i++)
            {
                if (dtRetentionDetails.Rows[i][&quot;RetentionCeilingMode&quot;].ToString2().ToLower2() == &quot;true&quot; ||
                    dtRetentionDetails.Rows[i][&quot;RetentionCeilingMode&quot;].ToString2() == &quot;1&quot;)
                    dtRetentionDetails.Rows[i][&quot;RetentnValue&quot;] =
                        dtRetentionDetails.Rows[i][&quot;RetentionCeilingValue&quot;].ToDecimal2().ToString(
                            AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE, CultureInfo.CurrentCulture) + &quot; %&quot;;
                else
                    dtRetentionDetails.Rows[i][&quot;RetentnValue&quot;] =
                        dtRetentionDetails.Rows[i][&quot;RetentionCeilingValue&quot;].ToDecimal2().ToString(
                            AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture) + &quot; in &quot; +
                        LocalizationManager.GetModuleCurrency(Constants.MODID_CONTMGT, _ContractID.ToString2());
                dtRetentionDetails.Rows[i][&quot;RetentionPercentage&quot;] =
                    dtRetentionDetails.Rows[i][&quot;RetentionPercentage&quot;].ToDecimal2().ToString(
                        AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE, CultureInfo.CurrentCulture);
            }
            dtRetentionDetails.AcceptChanges();
            DsResult.Tables.Add(dtRetentionDetails);
            PageCount = (int)Math.Ceiling(dtRetentionDetails.Rows.Count.ToDecimal2() / PageSize);
        }

        private void retentionRulePicker_BackClicked(object sender, EventArgs e)
        {
            ShowDiv(ItemDivEnums.CreateWO);
        }

        private void retentionRulePicker_SelectedIndexChanged(object sender, ItemSelectedEventArgs e)
        {
            string mode = string.Empty;
            string retentionId = e.SelectedItems.Rows[0][&quot;RetentionID&quot;].ToString2();
            DataRow[] dtRet = dtRetention.Select(&quot;RetentionID=&quot; + retentionId);
            DataRow row = dtRet[0];

            mode = ((row[&quot;RetentionCeilingMode&quot;].ToString2().ToLower2() == &quot;false&quot; ||
                     row[&quot;RetentionCeilingMode&quot;].ToString2() == &quot;0&quot;)
                        ? WOConstants.MODE_AMOUNT
                        : WOConstants.MODE_PERCENTAGE);
            lblRetentionCeiling.Text = (mode == WOConstants.MODE_PERCENTAGE
                                            ? &quot;Retention Ceiling Percentage :&quot;
                                            : &quot;Retention Ceiling Amount in &quot; +
                                              LocalizationManager.GetModuleCurrency(Constants.MODID_CONTMGT,
                                                                                    _ContractID.ToString2()) + &quot; :&quot;);
            wneRetentionPercentage.Value = (row[&quot;RetentionPercentage&quot;].ToString2() == &quot;&quot;
                                                ? &quot;0&quot;
                                                : row[&quot;RetentionPercentage&quot;]).ToDecimal2().ToString(
                                                    AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE, CultureInfo.CurrentCulture);
            wneRetentionCeiling.Value = (row[&quot;RetentionCeilingValue&quot;].ToString2() == &quot;&quot;
                                             ? &quot;0&quot;
                                             : row[&quot;RetentionCeilingValue&quot;]).ToDecimal2().ToString(
                                                 mode == WOConstants.MODE_PERCENTAGE
                                                     ? AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE
                                                     : AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture);
            txtRetentionRule.Text = e.SelectedItems.Rows[0][&quot;RetentionRuleName&quot;].ToString2();

            hdnRetentionID.Value = retentionId;

            ShowDiv(ItemDivEnums.CreateWO);
        }

        protected void btnPrepaymentRulePicker_Click(object sender, EventArgs e)
        {
            ShowDiv(ItemDivEnums.PrepaymentPicker);
            prepaymentPicker.BindData += prepaymentRulePicker_BindData;
            prepaymentPicker.ChangeTableOrViewAndBind(&quot;prepayment&quot;);

        }

        protected void btnRetentionRulePicker_Click(object sender, EventArgs e)
        {
            ShowDiv(ItemDivEnums.RetentionPicker);
            retentionPicker.BindData += retentionRulePicker_BindData;
            retentionPicker.ChangeTableOrViewAndBind(&quot;retention&quot;);
        }

        #endregion

        #region Custom Functions

        private void FormatPrepaymentTypesGrid(string mode)
        {
            int stage = int.Parse(hdnStage.Value == &quot;&quot; ? &quot;0&quot; : hdnStage.Value);
            //stage 1 - Draft; 2 - Approve; 3 - Issued; 6 - Draft Amendment; 7 - Approved Amendment

            ColumnsCollection cols = uwgPrepaymentTypes.Columns;
            uwgPrepaymentTypes.Width = 500;

            if (cols.Exists(WOConstants.HEADING_SL_NO))
                cols.FromKey(WOConstants.HEADING_SL_NO).Width = 40;

            if (cols.Exists(WOConstants.HEADING_PREPAYMENTVALUE))
            {
                cols.FromKey(WOConstants.HEADING_PREPAYMENTVALUE).Header.Caption = (mode == WOConstants.MODE_AMOUNT
                                                                                        ? &quot;Pre-payment Amount&quot;
                                                                                        : &quot;Pre-payment Percentage&quot;);
                cols.FromKey(WOConstants.HEADING_PREPAYMENTVALUE).Width = 125;
                cols.FromKey(WOConstants.HEADING_PREPAYMENTVALUE).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(WOConstants.HEADING_PREPAYMENTVALUE).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(WOConstants.HEADING_PREPAYMENTVALUE).Header.Caption =
                    cols.FromKey(WOConstants.HEADING_PREPAYMENTVALUE).Header.Caption + &quot; &quot; +
                    (mode == WOConstants.MODE_PERCENTAGE
                         ? &quot;&quot;
                         : &quot; in &quot; +
                           LocalizationManager.GetModuleCurrency(Constants.MODID_CONTMGT, _ContractID.ToString2()));

                if (stage &lt; 2 || (isVersion &amp;&amp; stage != WOConstants.STAGE_APPROVE_AMENDMENT))
                {
                    cols.FromKey(WOConstants.HEADING_PREPAYMENTVALUE).AllowUpdate = editRecoveryDetails
                                                                                        ? AllowUpdate.Yes
                                                                                        : AllowUpdate.No;
                    cols.FromKey(WOConstants.HEADING_PREPAYMENTVALUE).CellStyle.BackColor = editRecoveryDetails
                                                                                                ? Color.Yellow
                                                                                                : Color.Transparent;
                }
            }
            if (cols.Exists(WOConstants.HEADING_RECOVERYVALUE))
            {
                cols.FromKey(WOConstants.HEADING_RECOVERYVALUE).Header.Caption = (mode == WOConstants.MODE_AMOUNT
                                                                                      ? &quot;Recovery Amount&quot;
                                                                                      : &quot;Recovery Percentage&quot;);
                cols.FromKey(WOConstants.HEADING_RECOVERYVALUE).Width = 125;
                cols.FromKey(WOConstants.HEADING_RECOVERYVALUE).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(WOConstants.HEADING_RECOVERYVALUE).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(WOConstants.HEADING_RECOVERYVALUE).Header.Caption =
                    cols.FromKey(WOConstants.HEADING_RECOVERYVALUE).Header.Caption + &quot; &quot; +
                    (mode == WOConstants.MODE_PERCENTAGE
                         ? &quot;&quot;
                         : &quot; in &quot; +
                           LocalizationManager.GetModuleCurrency(Constants.MODID_CONTMGT, _ContractID.ToString2()));

                if (stage &lt; 2 || (isVersion &amp;&amp; stage != WOConstants.STAGE_APPROVE_AMENDMENT))
                {
                    cols.FromKey(WOConstants.HEADING_RECOVERYVALUE).AllowUpdate = editRecoveryDetails
                                                                                      ? AllowUpdate.Yes
                                                                                      : AllowUpdate.No;
                    cols.FromKey(WOConstants.HEADING_RECOVERYVALUE).CellStyle.BackColor = editRecoveryDetails
                                                                                              ? Color.Yellow
                                                                                              : Color.Transparent;
                }
            }
            if (cols.Exists(WOConstants.HEADING_RABNO))
            {
                cols.FromKey(WOConstants.HEADING_RABNO).Hidden = true;
                cols.FromKey(WOConstants.HEADING_RABNO).Header.Caption = &quot;Start Recovery from &quot; +
                                                                         LocalizationManager.GetString(&quot;RAB&quot;) + &quot; No&quot;;
                cols.FromKey(WOConstants.HEADING_RABNO).Width = 100;
                if (stage &lt; 2 || (isVersion &amp;&amp; stage != WOConstants.STAGE_APPROVE_AMENDMENT))
                {
                    cols.FromKey(WOConstants.HEADING_RABNO).AllowUpdate = editRecoveryDetails
                                                                              ? AllowUpdate.Yes
                                                                              : AllowUpdate.No;
                    cols.FromKey(WOConstants.HEADING_RABNO).CellStyle.BackColor = editRecoveryDetails
                                                                                      ? Color.Yellow
                                                                                      : Color.Transparent;
                }
            }
            if (cols.Exists(WOConstants.HEADING_RV_IN_RAB))
            {
                cols.FromKey(WOConstants.HEADING_RV_IN_RAB).Width = 125;
                cols.FromKey(WOConstants.HEADING_RV_IN_RAB).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(WOConstants.HEADING_RV_IN_RAB).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(WOConstants.HEADING_RV_IN_RAB).Header.Caption =
                    cols.FromKey(WOConstants.HEADING_RV_IN_RAB).Header.Caption + &quot; &quot; + &quot; in &quot; +
                    LocalizationManager.GetModuleCurrency(Constants.MODID_CONTMGT, _ContractID.ToString2());
            }

            if (cols.Exists(WOConstants.HEADING_AMOUNT_PAID))
            {
                cols.FromKey(WOConstants.HEADING_AMOUNT_PAID).Width = 100;
                cols.FromKey(WOConstants.HEADING_AMOUNT_PAID).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(WOConstants.HEADING_AMOUNT_PAID).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(WOConstants.HEADING_AMOUNT_PAID).Header.Caption =
                    cols.FromKey(WOConstants.HEADING_AMOUNT_PAID).Header.Caption + &quot; &quot; + &quot; in &quot; +
                    LocalizationManager.GetModuleCurrency(Constants.MODID_CONTMGT, _ContractID.ToString2());
            }

            if (cols.Exists(WOConstants.HEADING_RECOVERED_AMOUNT))
            {
                cols.FromKey(WOConstants.HEADING_RECOVERED_AMOUNT).Width = 100;
                cols.FromKey(WOConstants.HEADING_RECOVERED_AMOUNT).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(WOConstants.HEADING_RECOVERED_AMOUNT).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(WOConstants.HEADING_RECOVERED_AMOUNT).Header.Caption =
                    cols.FromKey(WOConstants.HEADING_RECOVERED_AMOUNT).Header.Caption + &quot; &quot; + &quot; in &quot; +
                    LocalizationManager.GetModuleCurrency(Constants.MODID_CONTMGT, _ContractID.ToString2());
            }


            if (cols.Exists(&quot;PrepaymentTypeID&quot;))
            {
                cols.FromKey(&quot;PrepaymentTypeID&quot;).Hidden = true;
                if (cols.Exists(WOConstants.HEADING_RV_IN_RAB))
                    cols.FromKey(WOConstants.HEADING_RV_IN_RAB).Move(5);
            }
            else if (cols.Exists(WOConstants.HEADING_RV_IN_RAB))
                cols.FromKey(WOConstants.HEADING_RV_IN_RAB).Move(4);

            if (cols.Exists(&quot;PrepaymentType&quot;))
            {
                cols.FromKey(&quot;PrepaymentType&quot;).Header.Caption = WOConstants.HEADING_PREPAYMENTNAME;
                cols.FromKey(&quot;PrepaymentType&quot;).Width = 125;
            }

            if (cols.Exists(WOConstants.HEADING_PREPAYMENTNAME))
            {
                cols.FromKey(WOConstants.HEADING_PREPAYMENTNAME).Header.Caption = WOConstants.HEADING_PREPAYMENTNAME;
                cols.FromKey(WOConstants.HEADING_PREPAYMENTNAME).Width = 125;
            }

            if (mode == WOConstants.MODE_PERCENTAGE)
            {
                //Percentage Based Prepayment rule
                if (cols.Exists(WOConstants.HEADING_RV_IN_RAB))
                {
                    cols.FromKey(WOConstants.HEADING_RV_IN_RAB).Hidden = false;
                    cols.FromKey(WOConstants.HEADING_RV_IN_RAB).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                }

                if (cols.Exists(WOConstants.HEADING_PREPAYMENTVALUE))
                    cols.FromKey(WOConstants.HEADING_PREPAYMENTVALUE).Format = AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE;

                if (cols.Exists(WOConstants.HEADING_RECOVERYVALUE))
                    cols.FromKey(WOConstants.HEADING_RECOVERYVALUE).Format = AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE;
            }
            else if (mode == WOConstants.MODE_AMOUNT)
            {
                //Amount Based Prepayment rule
                if (cols.Exists(WOConstants.HEADING_RV_IN_RAB))
                    cols.FromKey(WOConstants.HEADING_RV_IN_RAB).Hidden = true;

                if (cols.Exists(WOConstants.HEADING_PREPAYMENTVALUE))
                    cols.FromKey(WOConstants.HEADING_PREPAYMENTVALUE).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;

                if (cols.Exists(WOConstants.HEADING_RECOVERYVALUE))
                    cols.FromKey(WOConstants.HEADING_RECOVERYVALUE).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
            }
            uwgPrepaymentTypes.DisplayLayout.AllowSortingDefault = AllowSorting.OnClient;

            #region Enabling or disabling controls based on permission

            if (editRecoveryDetails)
            {
                if (mode == WOConstants.MODE_AMOUNT)
                {
                    if (mode == WOConstants.MODE_AMOUNT) wneMaxAmount.Enabled = true;
                    wneMaxPercentage.Enabled = false;
                }
                else if (mode == WOConstants.MODE_PERCENTAGE)
                {
                    if (mode == WOConstants.MODE_PERCENTAGE) wneMaxPercentage.Enabled = true;
                    wneMaxAmount.Enabled = false;
                }
            }
            else
            {
                wneMaxPercentage.Enabled = false;
                wneMaxAmount.Enabled = false;
            }

            if (editRetentionDetails)
            {
                if (txtRetentionRule.Text != string.Empty) wneRetentionPercentage.Enabled = true;
                if (txtRetentionRule.Text != string.Empty) wneRetentionCeiling.Enabled = true;
            }
            else
            {
                wneRetentionCeiling.Enabled = false;
                wneRetentionPercentage.Enabled = false;
            }

            #endregion
        }

        private decimal CalculateRecoveryValueInEachRAB(string RecoveryValue, string prepaymentValue, string mode)
        {
            string woAmt = hdnTotalAmt.Value;
            decimal rabRecoveryValue = 0;

            if (mode == WOConstants.MODE_PERCENTAGE)
            {
                decimal prepaymentAmt = decimal.Parse(prepaymentValue) / 100 * decimal.Parse(woAmt);
                rabRecoveryValue = (decimal.Parse(RecoveryValue) / 100 * prepaymentAmt);
            }
            return rabRecoveryValue;
        }

        private void PopulateDataTables()
        {
            string moduleId = isVersion ? &quot;WORKVER&quot; : Constants.MODID_CONTMGT;
            int instanceId = isVersion ? _WorkOrderID : _ContractID;
            DataSet dsPrepaymentRecovery = WOManager.Instance.GetPrepaymentRecoveryRules(moduleId, instanceId);
            try
            {
                dtRecovery = dsPrepaymentRecovery.Tables[0].Select(&quot;isActive=1&quot;).CopyToDataTable();
            }
            catch
            {
                dtRecovery = new BrixDataTable();
            }
            ;
            try
            {
                dtPrepayment = dsPrepaymentRecovery.Tables[1];
            }
            catch
            {
                dtPrepayment = new BrixDataTable();
            }
            ;
            try
            {
                dtRetention =
                    WOManager.Instance.GetRetentionRules(Constants.MODID_CONTMGT, _ContractID).Tables[0].Select(
                        &quot;isActive=1&quot;).CopyToDataTable();
            }
            catch
            {
                dtRetention = new BrixDataTable();
            }
            ;
        }

        private void CalculateAmountOrPercentage(string mode)
        {
            try
            {
                if (uwgWOItems.Rows.Count &gt; 0 &amp;&amp; txtPrepaymentRule.Text != &quot;&quot;)
                {
                    if (mode == WOConstants.MODE_PERCENTAGE)
                        wneMaxAmount.Value =
                            (wneMaxPercentage.ValueDecimal / 100 * decimal.Parse(hdnTotalAmt.Value)).ToDecimal2().ToString(
                                AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE, CultureInfo.CurrentCulture);
                    else
                        wneMaxPercentage.Value =
                            (wneMaxAmount.ValueDecimal / decimal.Parse(hdnTotalAmt.Value) * 100).ToDecimal2().ToString(
                                AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture);
                }
            }
            catch
            {
            }
        }

        private void HideShowTB(string mode)
        {
            if (uwgWOItems.Rows.Count == 0)
                mode = (mode == &quot;&quot; ? WOConstants.MODE_NEITHER : mode);
            else
                mode = WOConstants.MODE_NEITHER;

            ScriptManager.RegisterStartupScript(this, typeof(Page), &quot;HideShow&quot;, &quot;HideShowTB(&#39;&quot; + UIHelper.JavascriptEncode(mode) + &quot;&#39;);&quot;, true);
        }

        private BrixFilter[] GetRetentionFilters()
        {
            var filters = new BrixFilter[2];

            filters[0] = new BrixFilter();
            filters[0].Title = &quot;Retention Rule Name :&quot;;
            filters[0].Name = &quot;RetentionRuleName&quot;;
            filters[0].FilterType = BrixFilter.Type.Text;

            filters[1] = new BrixFilter();
            filters[1].Title = &quot;Description :&quot;;
            filters[1].Name = &quot;Description&quot;;
            filters[1].FilterType = BrixFilter.Type.Text;

            return filters;
        }

        private BrixFilter[] GetPrepaymentFilters()
        {
            var filters = new BrixFilter[2];

            filters[0] = new BrixFilter();
            filters[0].Title = &quot;Pre-payment Rule Name :&quot;;
            filters[0].Name = &quot;PrepaymentRuleName&quot;;
            filters[0].FilterType = BrixFilter.Type.Text;

            filters[1] = new BrixFilter();
            filters[1].Title = &quot;Description :&quot;;
            filters[1].Name = &quot;Description&quot;;
            filters[1].FilterType = BrixFilter.Type.Text;

            return filters;
        }

        #endregion

        #endregion
    }

    [CustomResourceType(&quot;Forms&quot;, &quot;XWRKORD&quot;)]
    public class PerformWOOperation : FormsCustomResource
    {
        public PerformWOOperation()
        {
            _Namespace = &quot;Forms&quot;;
            _Path = &quot;Forms.Contract.WO&quot;;
            _Name = &quot;PerformWOOperation&quot;;
            _Desc = &quot;Perform Work Order Operations&quot;;

            _InParameters = new[] { &quot;Operation,System.String&quot; };
            _OutParameters = new[] { &quot;CanApprove,System.Boolean&quot;, &quot;ApproveReason,System.String&quot; };
        }

        private bool IsERPConnected
        {
            get { return IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX); }
        }

        public override void ExecuteDerived()
        {
            string operation = GetInputParam(&quot;Operation&quot;).ToString();
            string company = GetInputParam(&quot;Company&quot;).ToString();
            string culture = GetInputParam(&quot;Culture&quot;).ToString();
            string uiCulture = GetInputParam(&quot;UICulture&quot;).ToString();
            Thread.CurrentThread.CurrentCulture = new CultureInfo(culture);
            Thread.CurrentThread.CurrentUICulture = new CultureInfo(uiCulture);
            try
            {
                switch (operation.ToUpper())
                {
                    case &quot;APPROVE&quot;:
                        ApproveWO();
                        break;
                    case &quot;UNAPPROVE&quot;:
                        UnapproveWO();
                        break;
                    case &quot;VALIDATEISSUE&quot;:
                        ValidateIssueWO(company);
                        break;
                    case &quot;ISSUE&quot;:
                        IssueWO(company);
                        break;
                    case &quot;UNISSUE&quot;:
                        UndoIssueWO(company);
                        break;
                    case &quot;VALIDATECLOSEOUTWO&quot;:
                        ValidateCLoseOutWO();
                        break;
                    case &quot;CLOSEOUTWO&quot;:
                        CLoseOutWO();
                        break;
                }
            }
            catch (Exception ex)
            {
                SetOutParam(&quot;CanApprove&quot;, false, &quot;System.Boolean&quot;);
                SetOutParam(&quot;ApproveReason&quot;, ex.Message, &quot;System.String&quot;);
                throw ex;
            }
        }

        string ErrLocalized(string strErr)
        {
            if (strErr.Contains(&quot;LOC_ITEM_POSTING&quot;))
                strErr = strErr.Replace(&quot;LOC_ITEM_POSTING&quot;, LocalizationManager.GetString(&quot;LOC_ITEM_POSTING&quot;));
            if (strErr.Contains(&quot;LOC_MeasurementBook&quot;))
                strErr = strErr.Replace(&quot;LOC_MeasurementBook&quot;, LocalizationManager.GetString(&quot;LOC_MeasurementBook&quot;));
            if (strErr.Contains(&quot;LOC_ICA_EQUIPMENT&quot;))
                strErr = strErr.Replace(&quot;LOC_ICA_EQUIPMENT&quot;, LocalizationManager.GetString(&quot;LOC_ICA_EQUIPMENT&quot;));
            if (strErr.Contains(&quot;LOC_DailyProgressReport&quot;))
                strErr = strErr.Replace(&quot;LOC_DailyProgressReport&quot;, LocalizationManager.GetString(&quot;LOC_DailyProgressReport&quot;));
            if (strErr.Contains(&quot;PAYESTM&quot;))
                strErr = strErr.Replace(&quot;PAYESTM&quot;, LocalizationManager.GetString(&quot;PAYESTM&quot;));
            return strErr;
        }

        string ValidateUndoIssueWO(int Status, string WorkOrderID, string ContractID, string WorkorderNO)
        {
            if (Status != WOConstants.STAGE_ISSUED)
            {
                return &quot;Only issued records can be unissued. Request Denied.&quot;;
            }
            DataSet dsError = WORKORDManager.Instance.ValidateUndoIssueWO(WorkOrderID, ContractID, WorkorderNO);
            if (dsError.Tables.Count &gt; 0)
            {
                string MaxWOIds = Convert.ToString(dsError.Tables[0].Rows[0][0]);
                if (MaxWOIds != WorkOrderID)
                {
                    return &quot;Only latest version can be unissued. Request Denied.&quot;;
                }
                if (dsError.Tables[1].Rows.Count &gt; 0)
                    return ErrLocalized(dsError.Tables[1].Rows[0][0].ToString2());
                else
                    return &quot;&quot;;
            }
            else
                return &quot;&quot;;
        }

        private void UndoIssueWO(string company)
        {
            if (!String.IsNullOrEmpty(InstanceId))
            {
                int currentuserid = GetInputParam(&quot;_currentuserid&quot;).ToInt32_2();
                WorkOrderDTO w = WORKORDManager.Instance.GetWorkOrderDetails(InstanceId.ToInt32_2());
                string strErrMsg = ValidateUndoIssueWO(w.Status, w.WorkOrderID.ToString(), w.ContractID.ToString(), w.WorkOrderNo);
                if (string.IsNullOrEmpty(strErrMsg))
                {
                    string selWOID = InstanceId;
                    int WOID = 0;
                    int.TryParse(selWOID, out WOID);
                    WorkOrderDTO wDTO = WORKORDManager.Instance.GetWorkOrderDetails(WOID);
                    var ds = new DataSet();
                    if (wDTO.WorkOrderType == &quot;A&quot;)
                        ds = WORKORDManager.Instance.GetQuotations(WOID);
                    else
                        ds = WOManager.Instance.GetQuotations(WOID);
                    if ((ds.Tables.Count &gt; 0 &amp;&amp; ds.Tables[0].Select(&quot;Status=3&quot;).Length &gt; 0) ||
                        (wDTO.IssueMode.Equals(IssueMode.Direct) &amp;&amp; wDTO.WorkOrderType == &quot;W&quot;))
                    {
                        string userFullName = GetInputParam(&quot;_CurrentUser&quot;).ToString();
                        wDTO.IsVersion = !((wDTO.ParentID ?? 0) == 0);
                        wDTO.ModifiedBy = userFullName;
                        wDTO.ModifiedByID = currentuserid;
                        wDTO.ModifiedOn = wDTO.IssueMode.Equals(IssueMode.Direct) ? wDTO.StartDate : DateTime.UtcNow;
                        int issueWO = WORKORDManager.Instance.UndoIssueWO(wDTO);
                        if (issueWO &gt; 0)
                        {
                            SetOutParam(&quot;CanApprove&quot;, true, &quot;System.Boolean&quot;);
                        }
                        else
                            throw new Exception(&quot;Error in DB Script Execution&quot;);
                    }
                    //ProcurementCommitments.Instance.DeleteCommitmentAndItems(null, &quot;WORKORD&quot;, WOID);
                    WORKORDManager.Instance.UndoIssueAmmendment(WOID);
                    SetOutParam(&quot;CanApprove&quot;, true, &quot;System.Boolean&quot;);
                }
                else
                {
                    SetOutParam(&quot;CanApprove&quot;, false, &quot;System.Boolean&quot;);
                    throw new Exception(strErrMsg);
                }
            }
            else
            {
                SetOutParam(&quot;CanApprove&quot;, false, &quot;System.Boolean&quot;);
                throw new Exception(&quot;Select Atleast One Record.&quot;);
            }
        }

        private void ApproveWO()
        {
            if (!String.IsNullOrEmpty(InstanceId))
            {
                int currentuserid = GetInputParam(&quot;_currentuserid&quot;).ToInt32_2();
                WorkOrderDTO w = WORKORDManager.Instance.GetWorkOrderDetails(InstanceId.ToInt32_2());
                if (w.Status &lt; WOConstants.STAGE_APPROVED || w.Status == WOConstants.STAGE_DRAFT_AMENDMENT || w.Status == WOConstants.STAGE_ISSUED)
                {
                    //UserDetail ud = UserDetail.GetCurrentUserDetail();
                    //TODO: Current date is used instead on SubmitionDate. Should be correted when we are takin approved date.
                    if (w.IssueMode.Equals(IssueMode.Direct) &amp;&amp; string.IsNullOrEmpty(w.Contractor))
                        throw new Exception(&quot;Please select a contractor to approve the Workorder.&quot;);
                    DataTable dt =
                        WOManager.Instance.ApproveWorkOrder(InstanceId.ToInt32_2(), (w.IssueMode.Equals(IssueMode.Direct) &amp;&amp; (DateTime.UtcNow &gt; w.StartDate)) ? w.StartDate : DateTime.UtcNow, currentuserid, true,
                                                            w.WorkOrderType).Tables[0];
                    if (dt.Rows.Count &gt; 0)
                        throw new Exception(dt.Rows[0][0].ToString2());
                    if (w.WorkOrderType.Equals(&quot;W&quot;) &amp;&amp; w.IssueMode.Equals(IssueMode.Direct) &amp;&amp; w.Status &lt; WOConstants.STAGE_APPROVED)
                    {
                        try
                        {
                            CreateDefaultQuotation(w);
                        }
                        catch (Exception ex)
                        {
                            throw ex;
                        }
                    }
                    SetOutParam(&quot;CanApprove&quot;, true, &quot;System.Boolean&quot;);
                }
                else
                {
                    throw new Exception(&quot;Selected Record is Already Approved&quot;);
                }
            }
            else
                throw new Exception(&quot;Select Atleast One Record.&quot;);
        }

        private void CreateDefaultQuotation(WorkOrderDTO w)
        {
            decimal total = 0.0M;
            int qid = 0;
            int ContractorID = w.ContractorID;
            string ContractorName = w.Contractor;

            DataSet ds = new BrixDataSet();
            DataTable Items = ds.Tables.Add(&quot;Item&quot;);
            int i;
            DataRow Item;
            string ItemXML = string.Empty;


            Items.Columns.Add(&quot;ItemID&quot;, Type.GetType(&quot;System.Int32&quot;));
            Items.Columns.Add(&quot;UnitPrice&quot;, Type.GetType(&quot;System.Double&quot;));

            for (i = 0; i &lt; w.WorkOrderItems.Tables[0].Rows.Count; i++)
            {
                Item = Items.NewRow();
                string itemIdCol = &quot;ItemID&quot;;
                Item[&quot;ItemID&quot;] = w.WorkOrderItems.Tables[0].Rows[i][itemIdCol].ToInt32_2();
                Item[&quot;UnitPrice&quot;] = w.WorkOrderItems.Tables[0].Rows[i][&quot;ContractUnitPrice&quot;].ToDouble2();
                total += w.WorkOrderItems.Tables[0].Rows[i][&quot;ContractUnitPrice&quot;].ToDecimal2() *
                         w.WorkOrderItems.Tables[0].Rows[i][&quot;WOQuantity&quot;].ToDecimal2();
                Items.Rows.Add(Item);
            }

            ItemXML = ds.GetXml();
            WORKORDManager.Instance.CreateWorkOrderQuotations(
                0, w.WorkOrderID.ToInt32_2(), ContractorID, ContractorName, w.IssueMode.Equals(IssueMode.Direct) ? w.StartDate : DateTime.UtcNow, &quot;System generated quotation&quot;, total,
                WOConstants.QUOTATION_STAGE_RECIEVED, ItemXML, qid);
        }

        private void UnapproveWO()
        {
            //int WOID = BrixDatatypeHelper.ToInt32_2(InstanceId);
            //int currentuserid = GetInputParam(&quot;_currentuserid&quot;).ToInt32_2();
            //DataSet ds = ComponentHelper.Instance.ExecuteDataSet(WOStoredProcedure.WORKORDGetWO, null, WOID);

            //if (ds.Tables[0].Rows[0][&quot;Status&quot;].ToString() == &quot;2&quot;)
            //{
            //    string selWorkOrderID = InstanceId;

            //    string WorkOrderType = ds.Tables[0].Rows[0][&quot;WorkOrderType&quot;].ToString();

            //    DataSet dsWO = ComponentHelper.Instance.ExecuteDataSet(WOStoredProcedure.WORKORDGetWOQ, null, WOID);

            //    if (dsWO.Tables[0].Rows.Count == 0)
            //    {
            //        ComponentHelper.Instance.ExecuteDataSet(WOStoredProcedure.usp_WORKORDApproveWO, null, selWorkOrderID.ToInt32_2(), currentuserid, 0, WorkOrderType);
            //        SetOutParam(&quot;CanApprove&quot;, true, &quot;System.Boolean&quot;);
            //    }
            //    else
            //        throw new Exception(&quot;This workorder cannot be unapproved as it has awarded quotation.&quot;);
            //}
            //else
            //    throw new Exception(&quot;Only approved workorders can be unapproved.&quot;);
            int currentuserid = GetInputParam(&quot;_currentuserid&quot;).ToInt32_2();
            WorkOrderDTO w = WORKORDManager.Instance.GetWorkOrderDetails(InstanceId.ToInt32_2());
            if (!String.IsNullOrEmpty(InstanceId))
            {
                DataTable dt =
                    WOManager.Instance.ApproveWorkOrder(InstanceId.ToInt32_2(), DateTime.UtcNow, currentuserid, false,
                                                        w.WorkOrderType).Tables[0];
                if (dt.Rows.Count &gt; 0)
                    throw new Exception(dt.Rows[0][0].ToString2());
                SetOutParam(&quot;CanApprove&quot;, true, &quot;System.Boolean&quot;);
            }
            else
                throw new Exception(&quot;Select Atleast One Record.&quot;);
        }

        private void ValidateIssueWO(string company)
        {
            string selWOID = InstanceId;
            int WOID = 0;
            int.TryParse(selWOID, out WOID);
            WorkOrderDTO wDTO = WORKORDManager.Instance.GetWorkOrderDetails(WOID);
            bool IsIssueEnabled = BL.Instance.VerifyModuleSettings(wDTO.ContractID, Constants.MODID_WORKORD);
            var ds = new DataSet();

            if (wDTO.WorkOrderType == &quot;A&quot;)
                ds = WORKORDManager.Instance.GetQuotations(WOID);
            else
                ds = WOManager.Instance.GetQuotations(WOID);

            if ((ds.Tables.Count &gt; 0 &amp;&amp; ds.Tables[0].Select(&quot;Status=3&quot;).Length &gt; 0) ||
                (wDTO.IssueMode.Equals(IssueMode.Direct) &amp;&amp; wDTO.WorkOrderType == &quot;W&quot;))
            {
                if (IsIssueEnabled)
                {
                    int currentuserid = GetInputParam(&quot;_currentuserid&quot;).ToInt32_2();
                    string userFullName = GetInputParam(&quot;_CurrentUser&quot;).ToString();
                    wDTO.IsVersion = (wDTO.Status == WOConstants.STAGE_APPROVE_AMENDMENT) ? true : false;
                    wDTO.ModifiedBy = userFullName;
                    wDTO.ModifiedByID = currentuserid;
                    wDTO.ModifiedOn = (wDTO.IssueMode.Equals(IssueMode.Direct) &amp;&amp; (DateTime.UtcNow &gt; wDTO.StartDate)) ? wDTO.StartDate : DateTime.UtcNow;
                    int issueWO = WORKORDManager.Instance.ValidateIssueWO(wDTO);
                    if (issueWO &gt; 0)
                    {
                        SetOutParam(&quot;CanApprove&quot;, true, &quot;System.Boolean&quot;);
                    }
                    else if (issueWO == -2)
                    {
                        throw new Exception(&quot;One or more checklists are not completed. Request denied&quot;);
                    }
                    else
                    {
                        throw new Exception(&quot;Error in DB Script Execution&quot;);
                    }
                }
                else
                {
                    throw new Exception(&quot;Quantity Planning should be approved in order to issue this &quot; +
                                        (wDTO.WorkOrderType == &quot;E&quot; ? &quot;Hire &quot; : &quot;Work &quot;) + &quot;Order&quot;);
                }
            }
            else
            {
                throw new Exception(&quot;A Quotation should be awarded to Issue the &quot; +
                                    (wDTO.WorkOrderType == &quot;E&quot; ? &quot;Hire&quot; : &quot;Work&quot;) + &quot; Order.&quot;);
            }
        }

        private void IssueWO(string company)
        {
            string selWOID = InstanceId;
            int WOID = 0;
            int.TryParse(selWOID, out WOID);
            WorkOrderDTO wDTO = WORKORDManager.Instance.GetWorkOrderDetails(WOID);
            bool IsIssueEnabled = BL.Instance.VerifyModuleSettings(wDTO.ContractID, Constants.MODID_WORKORD);
            var ds = new DataSet();

            if (wDTO.WorkOrderType == &quot;A&quot;)
                ds = WORKORDManager.Instance.GetQuotations(WOID);
            else
                ds = WOManager.Instance.GetQuotations(WOID);

            if ((ds.Tables.Count &gt; 0 &amp;&amp; ds.Tables[0].Select(&quot;Status=3&quot;).Length &gt; 0) ||
                (wDTO.IssueMode.Equals(IssueMode.Direct) &amp;&amp; wDTO.WorkOrderType == &quot;W&quot;))
            {
                if (IsIssueEnabled)
                {
                    int currentuserid = GetInputParam(&quot;_currentuserid&quot;).ToInt32_2();
                    string userFullName = GetInputParam(&quot;_CurrentUser&quot;).ToString();
                    wDTO.IsVersion = (wDTO.Status == WOConstants.STAGE_APPROVE_AMENDMENT) ? true : false;
                    wDTO.ModifiedBy = userFullName;
                    wDTO.ModifiedByID = currentuserid;
                    wDTO.ModifiedOn = wDTO.IssueMode.Equals(IssueMode.Direct) ? wDTO.StartDate : DateTime.UtcNow;
                    int issueWO = WORKORDManager.Instance.IssueWO(wDTO);

                    if (issueWO &gt; 0)
                    {
                        if (IsERPConnected)
                        {
                            var listMod = new EISWorkOrderListModel();
                            listMod.AXCompany = company;
                            listMod.WOID = InstanceId;
                            listMod.WOStatus = wDTO.Status;
                            int projectId =
                                ComponentHelper.Instance.ExecuteScalar(&quot;SELECT ProjectID from CONTMGTMaster where ID = {0}&quot;, wDTO.ContractID).ToInt32_2();
                            listMod.ProjectID = projectId;
                            listMod.HandleApprove();
                        }
                        //Create Commitments 
                        WORKORDManager.Instance.SaveCommitmentsAndItems(WOID, null);

                        SetOutParam(&quot;CanApprove&quot;, true, &quot;System.Boolean&quot;);
                    }
                    else if (issueWO == -2)
                        throw new Exception(&quot;One or more checklists are not completed. Request denied&quot;);
                    else
                        throw new Exception(&quot;Error in DB Script Execution&quot;);
                }
                else
                {
                    throw new Exception(&quot;Quantity Planning should be approved in order to issue this &quot; +
                                        (wDTO.WorkOrderType == &quot;E&quot; ? &quot;Hire &quot; : &quot;Work &quot;) + &quot;Order&quot;);
                }
            }
            else
                throw new Exception(&quot;A Quotation should be awarded to Issue the &quot; +
                                    (wDTO.WorkOrderType == &quot;E&quot; ? &quot;Hire&quot; : &quot;Work&quot;) + &quot;Order.&quot;);
        }

        private void ValidateCLoseOutWO()
        {
            int WOID = InstanceId.ToInt32_2();
            DataSet ds = ComponentHelper.Instance.ExecuteDataSet(WOStoredProcedure.WORKORDGetWO, null, WOID);
            int currentuserid = GetInputParam(&quot;_currentuserid&quot;).ToInt32_2();
            string currentuser = GetInputParam(&quot;_currentuser&quot;).ToString();

            if (!String.IsNullOrEmpty(InstanceId))
            {
                #region Validation

                if (ds.Tables[0].Rows.Count &gt; 0)
                {
                    if (ds.Tables[0].Rows[0][&quot;Status&quot;].ToString() != &quot;3&quot;) // issued work order
                    {
                        throw new Exception(&quot;Only an Issued Work Order Instance can be closed.&quot;);
                    }
                    if (!bool.Parse(ds.Tables[0].Rows[0][&quot;IsLatest&quot;].ToString()))
                    {
                        throw new Exception(&quot;This is a readonly Work Order Instance and cannot be closed.&quot;);
                    }
                }

                #endregion

                int retValue = 0;

                if (ds.Tables[0].Rows[0][&quot;WorkOrderType&quot;].ToString() != &quot;A&quot;)
                    retValue = WORKORDManager.Instance.ValidateCloseWorkOrder(WOID, currentuserid, currentuser, DateTime.UtcNow,
                                                                      &quot;Closed&quot;);
                else
                    retValue = WOManager.Instance.ValidateCloseWorkOrder(WOID, currentuserid, currentuser, DateTime.UtcNow,
                                                                 &quot;Closed&quot;);

                SetOutParam(&quot;CanApprove&quot;, true, &quot;System.Boolean&quot;);

                if (retValue == -2)
                {
                    throw new Exception(
                        &quot;There are approved Item Postings against this Work Order instance for which PayEstimate have not been generated. You cannot close out this instance.&quot;);
                }
                else if (retValue == -3)
                {
                    throw new Exception(
                        &quot;There are open Prepayments/MOH against this Work Order instance. You cannot close out this instance.&quot;);
                }
            }
        }

        private void CLoseOutWO()
        {
            int WOID = InstanceId.ToInt32_2();
            DataSet ds = ComponentHelper.Instance.ExecuteDataSet(WOStoredProcedure.WORKORDGetWO, null, WOID);
            int currentuserid = GetInputParam(&quot;_currentuserid&quot;).ToInt32_2();
            string currentuser = GetInputParam(&quot;_currentuser&quot;).ToString();

            if (!String.IsNullOrEmpty(InstanceId))
            {
                #region Validation

                if (ds.Tables[0].Rows.Count &gt; 0)
                {
                    if (ds.Tables[0].Rows[0][&quot;Status&quot;].ToString() != &quot;3&quot;) // issued work order
                    {
                        throw new Exception(&quot;Only an Issued Work Order Instance can be closed.&quot;);
                    }
                    if (!bool.Parse(ds.Tables[0].Rows[0][&quot;IsLatest&quot;].ToString()))
                    {
                        throw new Exception(&quot;This is a readonly Work Order Instance and cannot be closed.&quot;);
                    }
                }

                #endregion

                int retValue = 0;

                if (ds.Tables[0].Rows[0][&quot;WorkOrderType&quot;].ToString() != &quot;A&quot;)
                    retValue = WORKORDManager.Instance.CloseWorkOrder(WOID, currentuserid, currentuser, DateTime.UtcNow,
                                                                      &quot;Closed&quot;);
                else
                    retValue = WOManager.Instance.CloseWorkOrder(WOID, currentuserid, currentuser, DateTime.UtcNow,
                                                                 &quot;Closed&quot;);

                SetOutParam(&quot;CanApprove&quot;, true, &quot;System.Boolean&quot;);

                if (retValue == -2)
                    throw new Exception(
                        &quot;There are approved Item Postings against this Work Order instance for which PayEstimate have not been generated. You cannot close out this instance.&quot;);
                else if (retValue == -3)
                    throw new Exception(
                        &quot;There are open Prepayments/MOH against this Work Order instance. You cannot close out this instance.&quot;);
            }
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[93,9,93,43,0],[101,9,101,49,0],[102,9,102,50,0],[111,40,111,44,0],[111,45,111,49,0],[112,33,112,37,0],[112,38,112,42,0],[119,17,119,18,0],[119,19,119,95,0],[119,96,119,97,0],[125,13,125,14,0],[126,17,126,59,0],[127,21,127,153,0],[128,17,128,67,0],[129,13,129,14,0],[137,17,137,18,0],[137,19,137,77,0],[137,78,137,79,0],[143,13,143,14,0],[144,17,146,116,0],[147,13,147,14,0],[153,13,153,14,0],[154,17,156,36,0],[157,13,157,14,0],[163,17,163,18,0],[163,19,163,60,0],[163,61,163,62,0],[164,17,164,18,0],[164,19,164,61,0],[164,62,164,63,0],[168,9,168,10,0],[169,13,169,43,0],[170,13,170,14,0],[171,17,181,30,0],[184,13,184,14,0],[185,17,194,30,0],[196,9,196,10,0],[203,9,203,10,0],[204,13,204,31,0],[205,9,205,10,0],[208,9,208,10,0],[209,13,209,59,0],[210,13,210,43,0],[211,13,211,52,0],[212,13,212,52,0],[213,13,213,81,0],[215,13,215,77,0],[217,13,217,64,0],[218,13,218,25,0],[219,9,219,10,0],[221,9,221,10,0],[223,13,223,30,0],[225,13,225,95,0],[226,13,226,111,0],[227,13,227,52,0],[228,13,228,62,0],[229,13,229,62,0],[230,13,230,47,0],[232,13,232,96,0],[234,13,234,52,0],[235,13,235,14,0],[236,17,236,75,0],[237,17,237,78,0],[238,13,238,14,0],[240,13,240,14,0],[241,17,241,55,0],[242,17,242,58,0],[243,13,243,14,0],[245,13,245,44,0],[246,13,246,14,0],[247,17,247,75,0],[248,17,248,72,0],[249,17,249,74,0],[250,17,250,114,0],[252,17,252,49,0],[253,13,253,14,0],[255,13,255,14,0],[256,17,256,115,0],[257,17,257,118,0],[262,17,263,97,0],[266,13,266,14,0],[268,13,268,109,0],[269,13,269,58,0],[270,13,270,14,0],[271,17,271,118,0],[272,13,272,14,0],[276,13,276,77,0],[277,13,277,49,0],[278,13,278,51,0],[279,13,279,78,0],[280,13,280,88,0],[281,13,281,72,0],[282,13,282,85,0],[283,13,283,62,0],[284,13,284,63,0],[286,13,286,98,0],[287,13,287,96,0],[288,13,288,104,0],[289,13,289,102,0],[290,13,290,93,0],[291,13,291,93,0],[292,13,292,96,0],[294,13,295,73,0],[296,13,296,121,0],[302,13,302,75,0],[303,13,303,48,0],[304,13,304,50,0],[305,13,305,76,0],[306,13,306,86,0],[307,13,307,70,0],[308,13,308,84,0],[309,13,309,60,0],[310,13,310,61,0],[312,13,312,98,0],[313,13,313,95,0],[314,13,314,103,0],[315,13,315,107,0],[316,13,316,108,0],[317,13,317,92,0],[318,13,318,95,0],[320,13,321,75,0],[322,13,323,76,0],[324,13,325,79,0],[329,13,329,84,0],[330,13,330,106,0],[331,13,331,81,0],[333,13,333,138,0],[334,13,334,145,0],[335,13,336,122,0],[337,13,337,142,0],[339,13,339,28,0],[340,9,340,10,0],[343,9,343,10,0],[344,13,345,108,0],[346,9,346,10,0],[349,9,349,10,0],[350,13,350,40,0],[351,13,351,44,0],[352,13,352,14,0],[353,17,353,49,0],[354,13,354,14,0],[355,13,355,56,0],[356,13,356,14,0],[358,17,358,18,0],[359,21,360,133,0],[361,21,361,46,0],[362,21,365,64,0],[366,17,366,18,0],[367,17,367,22,0],[368,17,368,18,0],[369,21,369,53,0],[370,17,370,18,0],[371,13,371,14,0],[372,13,372,30,0],[373,9,373,10,0],[376,9,376,10,0],[378,13,378,87,0],[379,13,379,14,0],[380,17,383,74,0],[384,13,384,14,0],[385,13,385,55,0],[386,13,386,14,0],[387,17,387,45,0],[388,13,388,14,0],[389,13,389,56,0],[390,13,390,14,0],[391,17,391,46,0],[392,13,392,14,0],[393,13,393,28,0],[394,17,394,51,0],[396,13,396,35,0],[397,13,397,38,0],[398,13,398,49,0],[399,13,400,72,0],[401,17,402,119,0],[403,13,403,87,0],[404,13,404,85,0],[405,13,405,30,0],[406,13,406,37,0],[407,13,407,90,0],[408,13,408,32,0],[409,17,409,93,0],[411,13,412,75,0],[413,13,414,85,0],[415,13,416,116,0],[417,13,417,117,0],[419,13,419,34,0],[420,13,420,29,0],[421,13,421,14,0],[422,17,422,96,0],[423,17,423,76,0],[424,17,424,18,0],[425,21,425,106,0],[426,21,426,110,0],[427,17,427,18,0],[428,17,428,45,0],[429,17,429,18,0],[430,21,430,100,0],[431,21,431,104,0],[432,21,432,94,0],[433,17,433,18,0],[434,17,434,47,0],[435,17,435,18,0],[436,21,442,102,0],[443,21,443,55,0],[444,21,444,22,0],[445,25,445,111,0],[446,21,446,22,0],[447,17,447,18,0],[449,17,449,47,0],[450,17,450,18,0],[452,21,452,37,0],[453,21,453,47,0],[454,21,454,107,0],[455,21,455,103,0],[456,21,456,104,0],[457,21,457,93,0],[458,21,458,125,0],[459,21,459,34,0],[460,21,460,22,0],[461,25,461,56,0],[462,21,462,22,0],[463,17,463,18,0],[465,17,465,18,0],[467,21,467,52,0],[468,21,468,95,0],[469,21,469,91,0],[470,21,470,108,0],[471,21,471,109,0],[472,17,472,18,0],[474,17,474,75,0],[475,17,475,18,0],[476,21,482,57,0],[483,21,483,73,0],[484,25,484,81,0],[485,21,485,36,0],[486,21,486,22,0],[487,25,487,56,0],[488,25,488,26,0],[489,29,489,99,0],[490,29,490,110,0],[491,25,491,26,0],[492,21,492,22,0],[493,26,493,56,0],[494,21,494,22,0],[495,25,496,86,0],[497,21,497,22,0],[498,17,498,18,0],[500,17,500,50,0],[501,17,501,58,0],[502,17,502,101,0],[503,17,503,18,0],[504,21,504,64,0],[505,21,507,113,0],[508,17,508,18,0],[509,17,509,65,0],[510,13,510,14,0],[512,17,512,96,0],[515,13,515,200,0],[516,13,516,14,0],[517,17,517,49,0],[518,17,518,55,0],[519,17,519,18,0],[520,21,520,55,0],[521,21,521,57,0],[522,17,522,18,0],[524,17,524,18,0],[525,21,525,56,0],[526,21,526,56,0],[527,17,527,18,0],[528,13,528,14,0],[530,17,530,50,0],[540,13,540,38,0],[541,13,541,55,0],[544,13,544,77,0],[545,13,545,14,0],[546,17,547,78,0],[548,13,548,14,0],[550,13,550,14,0],[551,17,551,48,0],[552,17,552,18,0],[556,21,556,56,0],[557,17,557,18,0],[558,13,558,14,0],[560,13,560,29,0],[561,13,561,14,0],[562,17,562,42,0],[563,17,563,65,0],[564,21,565,83,0],[566,13,566,14,0],[567,13,567,120,0],[569,13,569,38,0],[570,13,570,14,0],[571,17,573,105,0],[574,13,574,14,0],[576,13,577,74,0],[578,13,578,14,0],[579,17,579,45,0],[580,17,580,41,0],[581,17,581,48,0],[582,17,582,71,0],[583,21,583,79,0],[584,13,584,14,0],[586,13,586,46,0],[587,17,587,105,0],[589,13,589,51,0],[590,13,590,14,0],[591,17,591,55,0],[592,13,592,14,0],[594,13,594,50,0],[595,13,595,14,0],[596,17,596,53,0],[597,13,597,14,0],[599,13,599,115,0],[600,13,600,75,0],[601,13,601,14,0],[602,17,602,62,0],[603,13,603,14,0],[605,13,605,14,0],[606,17,606,61,0],[607,13,607,14,0],[609,9,609,10,0],[616,9,616,10,0],[617,13,617,68,0],[618,13,618,45,0],[619,13,619,35,0],[620,13,620,27,0],[621,13,621,20,0],[621,22,621,34,0],[621,35,621,37,0],[621,38,621,43,0],[622,13,622,14,0],[623,17,623,55,0],[624,22,624,31,0],[624,33,624,47,0],[624,49,624,52,0],[625,17,625,18,0],[626,21,626,100,0],[627,21,627,22,0],[628,25,628,56,0],[629,25,629,67,0],[631,25,633,127,0],[634,25,634,32,0],[636,21,637,74,0],[638,21,638,22,0],[639,21,639,22,0],[640,21,641,86,0],[642,21,643,116,0],[644,17,644,18,0],[645,17,645,39,0],[647,17,647,79,0],[648,17,648,68,0],[649,17,649,68,0],[650,17,650,85,0],[651,17,651,78,0],[652,17,652,64,0],[653,17,658,112,0],[660,17,660,99,0],[661,17,661,74,0],[665,17,665,66,0],[666,17,666,18,0],[667,21,667,65,0],[668,17,668,18,0],[670,17,670,18,0],[671,21,671,173,0],[672,17,672,18,0],[673,17,673,57,0],[674,13,674,14,0],[675,13,675,52,0],[676,13,676,44,0],[677,13,677,55,0],[678,9,678,10,0],[681,9,681,10,0],[682,13,682,44,0],[683,13,683,14,0],[684,17,684,51,0],[685,17,685,32,0],[686,21,686,28,0],[688,17,688,18,0],[689,21,689,42,0],[691,26,691,35,0],[691,37,691,46,0],[691,48,691,51,0],[692,21,692,22,0],[693,25,693,99,0],[694,25,694,108,0],[696,25,698,95,0],[700,25,700,96,0],[701,21,701,22,0],[704,21,704,131,0],[705,21,705,59,0],[706,17,706,18,0],[707,13,707,14,0],[708,9,708,10,0],[711,9,711,10,0],[712,13,712,44,0],[713,13,713,54,0],[714,9,714,10,0],[717,9,717,10,0],[718,13,718,42,0],[720,9,720,10,0],[723,9,723,10,0],[724,13,726,102,0],[727,9,727,10,0],[730,9,730,10,0],[731,13,731,103,0],[732,13,732,14,0],[733,17,733,31,0],[734,17,734,35,0],[735,17,735,53,0],[736,17,736,44,0],[737,17,737,103,0],[738,17,738,73,0],[739,17,739,44,0],[740,17,740,24,0],[740,26,740,36,0],[740,37,740,39,0],[740,40,740,59,0],[741,21,741,64,0],[742,17,742,91,0],[743,17,746,110,0],[747,17,747,60,0],[748,17,748,18,0],[749,21,750,224,0],[751,17,751,18,0],[753,21,753,76,0],[756,17,756,94,0],[757,17,757,81,0],[758,17,758,89,0],[759,17,759,72,0],[760,17,760,72,0],[761,21,761,65,0],[763,21,763,88,0],[765,17,765,71,0],[766,21,766,64,0],[768,21,768,86,0],[770,17,770,77,0],[771,21,771,70,0],[774,21,774,98,0],[776,17,776,93,0],[777,17,777,77,0],[779,17,779,66,0],[781,17,782,107,0],[784,17,784,112,0],[785,17,785,18,0],[786,21,786,91,0],[787,21,787,22,0],[788,25,788,32,0],[788,34,788,45,0],[788,46,788,48,0],[788,49,788,66,0],[789,25,789,26,0],[790,29,790,76,0],[791,29,791,30,0],[792,33,792,80,0],[793,33,793,115,0],[794,33,794,72,0],[795,29,795,30,0],[796,25,796,26,0],[797,21,797,22,0],[798,21,798,62,0],[799,21,799,22,0],[800,25,800,69,0],[801,25,801,60,0],[802,25,802,69,0],[803,25,803,69,0],[804,21,804,22,0],[805,21,805,70,0],[806,21,806,62,0],[807,21,807,68,0],[808,21,808,47,0],[809,17,809,18,0],[810,13,810,14,0],[811,13,811,62,0],[812,9,812,10,0],[815,9,815,10,0],[817,13,817,59,0],[818,13,818,14,0],[819,17,819,64,0],[820,17,820,113,0],[821,17,821,24,0],[823,13,823,69,0],[824,13,824,79,0],[825,13,825,14,0],[826,17,826,86,0],[827,17,827,60,0],[828,17,828,66,0],[829,17,829,24,0],[831,13,831,76,0],[832,13,832,14,0],[833,17,833,91,0],[834,17,834,60,0],[835,17,835,66,0],[836,17,836,24,0],[838,13,838,118,0],[839,13,839,14,0],[840,17,840,89,0],[841,17,841,60,0],[842,17,842,66,0],[843,17,843,24,0],[845,13,845,34,0],[846,13,846,34,0],[847,13,847,25,0],[848,13,848,90,0],[849,13,849,93,0],[850,13,850,44,0],[851,13,851,53,0],[854,13,854,43,0],[856,13,856,51,0],[857,13,857,14,0],[858,17,858,59,0],[860,17,860,56,0],[861,13,861,14,0],[863,13,863,71,0],[864,13,864,75,0],[866,18,866,23,0],[866,25,866,52,0],[866,54,866,57,0],[867,13,867,14,0],[868,17,868,39,0],[869,17,869,89,0],[870,17,870,97,0],[871,17,871,97,0],[872,17,873,91,0],[874,17,874,38,0],[875,13,875,14,0],[877,13,877,35,0],[878,13,881,69,0],[882,13,882,33,0],[883,13,883,57,0],[884,13,884,39,0],[885,13,885,56,0],[887,13,887,34,0],[888,13,888,14,0],[889,17,889,91,0],[890,17,890,32,0],[891,17,891,18,0],[892,21,892,67,0],[893,21,893,40,0],[894,17,894,18,0],[895,13,895,14,0],[896,9,896,10,0],[899,9,899,10,0],[900,13,900,74,0],[901,13,905,84,0],[907,13,907,109,0],[908,13,908,94,0],[909,13,913,74,0],[914,13,914,84,0],[915,9,915,10,0],[918,9,918,10,0],[919,13,919,98,0],[920,13,920,110,0],[921,13,921,14,0],[922,17,922,57,0],[923,17,923,54,0],[923,55,923,120,0],[924,17,924,86,0],[925,13,925,14,0],[926,18,927,87,0],[928,13,928,14,0],[929,17,929,86,0],[930,17,930,91,0],[931,13,931,14,0],[932,13,932,62,0],[933,13,933,14,0],[934,17,934,61,0],[935,21,936,140,0],[937,17,937,61,0],[938,13,938,14,0],[939,9,939,10,0],[942,9,942,10,0],[943,13,943,45,0],[944,13,944,54,0],[945,13,945,56,0],[946,9,946,10,0],[949,9,949,10,0],[951,13,951,38,0],[952,13,952,14,0],[953,17,953,84,0],[954,17,954,82,0],[955,17,955,68,0],[956,21,956,83,0],[957,17,957,66,0],[958,21,958,81,0],[959,13,959,14,0],[961,13,961,14,0],[962,17,963,114,0],[964,17,965,117,0],[966,13,966,14,0],[968,13,968,39,0],[971,13,971,119,0],[972,13,972,14,0],[974,17,974,56,0],[975,21,975,116,0],[976,17,976,112,0],[977,17,977,102,0],[978,17,978,87,0],[979,13,979,14,0],[980,13,980,64,0],[981,17,981,79,0],[986,13,986,57,0],[987,13,987,14,0],[988,17,988,92,0],[989,17,989,88,0],[990,13,990,14,0],[991,13,991,62,0],[992,13,992,14,0],[993,17,993,98,0],[994,13,994,14,0],[995,13,995,59,0],[996,17,996,75,0],[998,13,998,53,0],[999,17,999,80,0],[1001,13,1001,64,0],[1002,13,1002,14,0],[1003,17,1003,99,0],[1004,13,1004,14,0],[1006,13,1006,49,0],[1009,13,1009,56,0],[1010,13,1010,112,0],[1014,13,1014,49,0],[1017,13,1017,60,0],[1018,13,1018,14,0],[1019,17,1019,79,0],[1020,13,1020,14,0],[1021,13,1021,57,0],[1022,13,1022,14,0],[1023,17,1023,89,0],[1024,17,1024,93,0],[1025,13,1025,14,0],[1026,13,1026,62,0],[1027,13,1027,14,0],[1028,17,1028,100,0],[1029,13,1029,14,0],[1030,13,1030,54,0],[1031,17,1031,81,0],[1033,13,1033,65,0],[1034,17,1034,77,0],[1036,13,1036,50,0],[1039,9,1039,10,0],[1042,9,1042,10,0],[1043,13,1043,41,0],[1044,13,1044,33,0],[1045,13,1045,42,0],[1046,17,1046,62,0],[1047,13,1047,27,0],[1048,17,1048,24,0],[1050,13,1050,99,0],[1051,13,1051,33,0],[1052,13,1052,56,0],[1053,9,1053,10,0],[1056,9,1056,10,0],[1057,13,1057,41,0],[1058,13,1058,33,0],[1059,13,1059,42,0],[1060,17,1060,62,0],[1061,13,1061,27,0],[1062,17,1062,24,0],[1064,13,1064,99,0],[1065,13,1065,33,0],[1067,13,1067,56,0],[1068,9,1068,10,0],[1071,9,1071,10,0],[1072,13,1072,32,0],[1073,17,1073,76,0],[1074,9,1074,10,0],[1077,9,1077,10,0],[1078,13,1078,41,0],[1081,21,1081,94,0],[1082,25,1082,32,0],[1084,21,1084,119,0],[1085,21,1085,40,0],[1086,21,1086,143,0],[1087,21,1087,143,0],[1088,21,1088,87,0],[1089,21,1089,22,0],[1090,25,1090,69,0],[1091,25,1091,54,0],[1092,21,1092,22,0],[1093,21,1093,66,0],[1094,21,1094,40,0],[1096,21,1096,66,0],[1097,21,1097,80,0],[1098,21,1098,74,0],[1100,21,1100,60,0],[1101,21,1101,45,0],[1102,21,1102,52,0],[1103,21,1103,70,0],[1105,21,1105,64,0],[1106,21,1106,27,0],[1108,9,1108,10,0],[1111,9,1111,10,0],[1112,13,1112,41,0],[1115,21,1115,49,0],[1116,21,1116,41,0],[1117,21,1117,50,0],[1118,25,1118,70,0],[1119,21,1119,35,0],[1120,25,1120,32,0],[1122,21,1122,66,0],[1124,21,1124,41,0],[1125,21,1125,64,0],[1126,21,1126,27,0],[1128,21,1128,46,0],[1129,21,1129,22,0],[1130,25,1130,40,0],[1131,25,1131,54,0],[1132,25,1132,53,0],[1134,30,1134,39,0],[1134,41,1134,66,0],[1134,68,1134,71,0],[1135,25,1135,26,0],[1136,29,1137,97,0],[1138,29,1138,30,0],[1139,33,1139,48,0],[1140,33,1140,48,0],[1141,33,1141,103,0],[1142,33,1142,106,0],[1143,33,1143,50,0],[1144,33,1144,47,0],[1145,37,1145,134,0],[1147,33,1147,69,0],[1148,37,1148,50,0],[1150,37,1150,43,0],[1151,29,1151,30,0],[1152,25,1152,26,0],[1153,25,1153,40,0],[1154,25,1154,26,0],[1155,29,1159,75,0],[1160,25,1160,26,0],[1161,30,1161,50,0],[1162,25,1162,26,0],[1163,29,1164,199,0],[1165,25,1165,26,0],[1167,25,1167,26,0],[1168,29,1168,43,0],[1169,29,1169,79,0],[1170,29,1170,36,0],[1170,38,1170,43,0],[1170,44,1170,46,0],[1170,47,1170,52,0],[1171,29,1171,30,0],[1172,33,1172,115,0],[1173,33,1173,69,0],[1174,33,1174,41,0],[1175,29,1175,30,0],[1176,29,1176,70,0],[1177,29,1177,114,0],[1178,25,1178,26,0],[1179,21,1179,22,0],[1180,21,1180,27,0],[1182,9,1182,10,0],[1185,9,1185,10,0],[1187,13,1187,14,0],[1188,17,1188,90,0],[1189,17,1189,18,0],[1190,21,1190,28,0],[1192,17,1194,22,0],[1197,25,1198,138,0],[1201,25,1202,113,0],[1204,13,1204,14,0],[1205,13,1205,33,0],[1206,13,1206,14,0],[1207,17,1207,44,0],[1208,13,1208,14,0],[1210,13,1210,14,0],[1213,17,1213,37,0],[1214,17,1214,60,0],[1215,13,1215,14,0],[1216,9,1216,10,0],[1220,9,1220,10,0],[1221,13,1221,37,0],[1222,13,1222,14,0],[1223,17,1223,67,0],[1224,17,1224,62,0],[1225,17,1225,76,0],[1226,17,1226,89,0],[1227,17,1227,18,0],[1228,21,1228,57,0],[1229,21,1229,22,0],[1230,25,1230,61,0],[1231,25,1231,70,0],[1235,25,1235,106,0],[1236,25,1236,36,0],[1237,25,1237,26,0],[1238,29,1238,54,0],[1239,25,1239,26,0],[1241,25,1242,39,0],[1243,25,1243,26,0],[1244,29,1244,59,0],[1245,25,1245,26,0],[1247,25,1247,26,0],[1248,29,1248,67,0],[1249,25,1249,26,0],[1250,25,1250,30,0],[1251,25,1251,26,0],[1252,25,1252,26,0],[1254,25,1254,74,0],[1255,21,1255,22,0],[1256,17,1256,18,0],[1258,17,1258,18,0],[1259,21,1259,55,0],[1260,17,1260,18,0],[1261,13,1261,14,0],[1263,13,1263,14,0],[1264,17,1264,51,0],[1265,13,1265,14,0],[1267,13,1267,56,0],[1268,9,1268,10,0],[1271,9,1271,10,0],[1272,9,1272,10,0],[1279,9,1279,10,0],[1280,13,1280,86,0],[1281,13,1281,78,0],[1282,13,1282,63,0],[1283,13,1283,54,0],[1284,13,1284,34,0],[1285,13,1285,14,0],[1286,17,1286,78,0],[1287,17,1287,80,0],[1288,17,1288,49,0],[1289,17,1289,31,0],[1290,21,1290,49,0],[1291,13,1291,14,0],[1292,9,1292,10,0],[1295,9,1295,10,0],[1296,13,1296,92,0],[1297,13,1297,31,0],[1298,13,1298,14,0],[1299,17,1303,144,0],[1304,17,1304,24,0],[1306,13,1306,27,0],[1307,13,1307,14,0],[1308,17,1308,49,0],[1309,17,1309,53,0],[1310,17,1310,54,0],[1311,17,1311,49,0],[1312,17,1312,58,0],[1313,17,1313,54,0],[1314,17,1314,59,0],[1315,17,1315,59,0],[1316,17,1316,54,0],[1317,17,1317,37,0],[1318,13,1318,14,0],[1320,13,1320,14,0],[1321,17,1321,40,0],[1322,17,1322,48,0],[1323,17,1323,44,0],[1324,17,1324,41,0],[1325,17,1325,42,0],[1326,17,1326,44,0],[1327,17,1327,70,0],[1328,17,1328,56,0],[1329,13,1329,14,0],[1330,13,1330,51,0],[1331,13,1331,55,0],[1332,13,1332,53,0],[1333,13,1333,49,0],[1334,13,1334,58,0],[1335,13,1335,62,0],[1336,13,1336,51,0],[1337,13,1337,46,0],[1338,13,1338,41,0],[1339,13,1339,47,0],[1340,13,1340,58,0],[1341,13,1341,54,0],[1342,13,1342,60,0],[1348,13,1348,66,0],[1349,13,1349,56,0],[1350,17,1350,84,0],[1352,13,1352,47,0],[1353,13,1353,35,0],[1354,13,1354,37,0],[1356,13,1356,66,0],[1357,13,1357,31,0],[1360,13,1360,52,0],[1361,13,1361,14,0],[1362,17,1362,47,0],[1363,17,1363,119,0],[1364,17,1364,18,0],[1365,21,1365,67,0],[1367,21,1367,150,0],[1368,17,1368,18,0],[1369,13,1369,14,0],[1371,13,1372,107,0],[1373,13,1373,69,0],[1377,13,1377,112,0],[1382,13,1382,40,0],[1383,13,1383,96,0],[1384,13,1384,14,0],[1387,17,1387,37,0],[1388,17,1388,61,0],[1389,17,1392,60,0],[1393,17,1396,135,0],[1397,17,1401,131,0],[1403,17,1403,78,0],[1405,17,1405,69,0],[1411,17,1411,59,0],[1412,17,1412,68,0],[1413,17,1415,88,0],[1416,17,1416,24,0],[1416,26,1416,36,0],[1416,37,1416,39,0],[1416,40,1416,52,0],[1417,17,1417,18,0],[1418,21,1421,137,0],[1422,21,1422,22,0],[1423,21,1425,42,0],[1426,21,1429,42,0],[1430,17,1430,18,0],[1431,17,1431,41,0],[1432,17,1432,57,0],[1433,17,1433,47,0],[1435,17,1435,49,0],[1437,17,1437,51,0],[1439,17,1439,34,0],[1442,13,1442,14,0],[1443,13,1443,55,0],[1444,13,1444,14,0],[1447,17,1447,62,0],[1448,17,1451,60,0],[1452,17,1456,122,0],[1457,17,1459,114,0],[1460,17,1464,57,0],[1466,17,1466,79,0],[1468,17,1468,72,0],[1471,13,1471,14,0],[1475,13,1475,27,0],[1476,13,1476,14,0],[1478,17,1478,41,0],[1479,17,1479,64,0],[1480,17,1480,49,0],[1481,13,1481,14,0],[1482,13,1482,60,0],[1483,13,1483,14,0],[1485,17,1485,64,0],[1486,17,1486,49,0],[1487,17,1487,71,0],[1488,17,1488,18,0],[1489,21,1489,63,0],[1490,21,1490,146,0],[1491,21,1491,48,0],[1492,21,1492,121,0],[1493,21,1493,22,0],[1494,25,1494,51,0],[1495,25,1495,64,0],[1496,25,1496,147,0],[1497,21,1497,22,0],[1499,21,1499,22,0],[1500,25,1500,52,0],[1501,21,1501,22,0],[1503,21,1511,57,0],[1512,21,1512,36,0],[1513,21,1513,22,0],[1514,25,1517,68,0],[1518,21,1518,22,0],[1520,21,1520,22,0],[1521,25,1522,67,0],[1523,21,1523,22,0],[1524,17,1524,18,0],[1525,13,1525,14,0],[1527,13,1527,14,0],[1528,17,1528,46,0],[1529,17,1529,44,0],[1530,13,1530,14,0],[1532,13,1532,73,0],[1533,13,1533,14,0],[1534,17,1534,53,0],[1535,17,1535,54,0],[1536,17,1536,54,0],[1537,17,1537,101,0],[1538,17,1538,102,0],[1539,17,1539,102,0],[1540,17,1540,78,0],[1545,17,1545,73,0],[1546,21,1546,53,0],[1547,17,1547,58,0],[1548,13,1548,14,0],[1550,9,1550,10,0],[1553,9,1553,10,0],[1554,13,1554,52,0],[1555,13,1555,14,0],[1556,17,1556,42,0],[1557,17,1557,41,0],[1558,17,1558,60,0],[1559,17,1559,63,0],[1560,13,1560,14,0],[1562,13,1562,14,0],[1563,17,1563,42,0],[1564,17,1564,44,0],[1565,17,1565,62,0],[1566,17,1566,61,0],[1567,13,1567,14,0],[1568,9,1568,10,0],[1571,9,1571,10,0],[1573,13,1573,56,0],[1574,13,1574,35,0],[1575,13,1575,36,0],[1579,13,1579,65,0],[1580,17,1580,178,0],[1583,13,1586,116,0],[1590,13,1590,31,0],[1591,13,1593,50,0],[1595,13,1596,44,0],[1597,13,1597,81,0],[1598,9,1598,10,0],[1601,9,1601,10,0],[1602,13,1604,107,0],[1605,13,1605,14,0],[1606,17,1606,31,0],[1607,17,1607,35,0],[1608,17,1608,53,0],[1609,17,1612,110,0],[1613,17,1613,60,0],[1614,17,1614,18,0],[1615,21,1616,224,0],[1617,17,1617,18,0],[1619,21,1619,76,0],[1622,17,1622,81,0],[1623,17,1623,89,0],[1624,17,1624,93,0],[1625,17,1625,77,0],[1626,17,1626,66,0],[1628,17,1631,102,0],[1633,17,1633,112,0],[1634,17,1634,18,0],[1635,21,1635,67,0],[1636,25,1636,45,0],[1638,25,1638,37,0],[1640,17,1640,37,0],[1642,13,1642,25,0],[1643,9,1643,10,0],[1646,9,1646,10,0],[1647,13,1647,99,0],[1648,13,1648,56,0],[1649,13,1649,54,0],[1650,13,1650,60,0],[1651,13,1651,39,0],[1652,13,1652,71,0],[1653,13,1653,48,0],[1655,13,1655,57,0],[1656,13,1656,55,0],[1657,13,1657,61,0],[1658,13,1658,40,0],[1659,13,1659,72,0],[1660,13,1660,50,0],[1662,13,1662,54,0],[1663,9,1663,10,0],[1666,9,1666,10,0],[1667,13,1667,84,0],[1668,13,1668,78,0],[1670,13,1670,43,0],[1671,13,1671,14,0],[1672,17,1672,75,0],[1674,17,1674,108,0],[1675,17,1675,116,0],[1676,17,1676,111,0],[1678,17,1678,106,0],[1679,17,1679,114,0],[1680,17,1680,109,0],[1681,17,1681,102,0],[1682,13,1682,14,0],[1684,13,1684,14,0],[1685,17,1685,70,0],[1686,17,1686,63,0],[1687,17,1687,18,0],[1688,21,1688,115,0],[1689,17,1689,18,0],[1690,13,1690,14,0],[1692,13,1692,112,0],[1693,13,1693,104,0],[1694,13,1694,107,0],[1696,13,1696,102,0],[1697,13,1697,66,0],[1698,13,1698,108,0],[1699,13,1699,105,0],[1701,13,1701,80,0],[1702,13,1702,85,0],[1703,13,1703,100,0],[1704,13,1704,64,0],[1705,13,1705,110,0],[1706,13,1706,103,0],[1707,9,1707,10,0],[1710,9,1710,10,0],[1711,13,1711,95,0],[1712,13,1712,57,0],[1713,13,1713,51,0],[1714,13,1714,35,0],[1715,13,1715,43,0],[1716,13,1716,14,0],[1717,17,1717,48,0],[1718,21,1718,63,0],[1720,17,1720,43,0],[1721,21,1721,58,0],[1723,17,1723,43,0],[1724,17,1724,18,0],[1725,21,1725,90,0],[1726,21,1728,118,0],[1729,21,1729,94,0],[1730,17,1730,18,0],[1732,17,1732,45,0],[1733,17,1733,18,0],[1734,21,1734,104,0],[1735,21,1735,96,0],[1736,17,1736,18,0],[1737,17,1737,54,0],[1738,17,1738,18,0],[1739,21,1739,108,0],[1740,21,1740,115,0],[1741,21,1741,105,0],[1742,21,1742,108,0],[1743,21,1744,122,0],[1745,21,1745,22,0],[1746,25,1746,89,0],[1747,25,1747,94,0],[1748,25,1748,97,0],[1749,25,1749,84,0],[1750,25,1750,78,0],[1751,21,1751,22,0],[1752,17,1752,18,0],[1753,17,1753,52,0],[1754,17,1754,18,0],[1755,21,1755,104,0],[1756,21,1756,109,0],[1757,21,1757,103,0],[1758,21,1758,106,0],[1759,17,1759,18,0],[1760,17,1760,51,0],[1761,17,1761,18,0],[1762,21,1762,106,0],[1763,21,1763,112,0],[1764,21,1764,102,0],[1765,21,1765,105,0],[1766,21,1766,35,0],[1767,21,1767,22,0],[1768,25,1768,86,0],[1769,25,1769,91,0],[1770,25,1770,94,0],[1771,25,1771,81,0],[1772,25,1772,78,0],[1773,21,1773,22,0],[1774,17,1774,18,0],[1775,17,1775,52,0],[1776,17,1776,18,0],[1777,21,1777,105,0],[1778,21,1778,109,0],[1779,21,1779,103,0],[1780,21,1780,106,0],[1781,17,1781,18,0],[1782,17,1782,45,0],[1783,17,1783,18,0],[1784,21,1784,74,0],[1785,21,1785,104,0],[1786,21,1786,96,0],[1787,21,1787,99,0],[1790,17,1790,18,0],[1791,17,1791,32,0],[1792,17,1792,18,0],[1793,21,1793,56,0],[1793,57,1793,103,0],[1794,21,1794,55,0],[1794,56,1794,101,0],[1795,17,1795,18,0],[1796,13,1796,14,0],[1798,13,1798,14,0],[1799,17,1799,54,0],[1800,17,1800,54,0],[1801,21,1801,69,0],[1802,17,1802,68,0],[1803,17,1803,51,0],[1805,17,1805,47,0],[1806,17,1806,18,0],[1807,21,1807,79,0],[1808,21,1810,150,0],[1811,21,1811,22,0],[1812,25,1812,82,0],[1813,25,1813,87,0],[1814,21,1814,22,0],[1816,21,1816,22,0],[1817,25,1817,81,0],[1818,25,1818,86,0],[1819,21,1819,22,0],[1821,21,1821,98,0],[1822,21,1822,101,0],[1824,21,1824,106,0],[1825,21,1825,108,0],[1827,21,1827,60,0],[1828,17,1828,18,0],[1829,17,1829,52,0],[1830,17,1830,18,0],[1831,21,1831,90,0],[1832,21,1832,65,0],[1833,17,1833,18,0],[1834,17,1834,48,0],[1835,21,1835,61,0],[1836,17,1836,41,0],[1837,21,1837,53,0],[1838,17,1838,54,0],[1839,17,1839,18,0],[1840,21,1840,103,0],[1841,21,1841,113,0],[1842,21,1842,105,0],[1843,21,1843,108,0],[1844,21,1844,67,0],[1845,17,1845,18,0],[1846,17,1846,54,0],[1847,17,1847,18,0],[1848,21,1848,108,0],[1849,21,1849,115,0],[1850,21,1850,105,0],[1851,21,1851,108,0],[1852,21,1852,67,0],[1853,17,1853,18,0],[1854,17,1854,43,0],[1855,17,1855,18,0],[1856,21,1856,70,0],[1857,21,1857,100,0],[1858,21,1858,94,0],[1859,21,1859,97,0],[1860,21,1860,56,0],[1861,17,1861,18,0],[1862,13,1862,14,0],[1864,13,1864,28,0],[1865,13,1865,14,0],[1866,17,1866,67,0],[1867,21,1867,82,0],[1868,17,1868,51,0],[1868,52,1868,97,0],[1869,17,1869,54,0],[1869,55,1869,103,0],[1870,13,1870,14,0],[1872,13,1872,14,0],[1873,17,1873,67,0],[1874,17,1874,18,0],[1875,21,1875,126,0],[1876,21,1876,80,0],[1877,17,1877,18,0],[1878,17,1878,51,0],[1879,17,1879,18,0],[1880,21,1880,110,0],[1881,21,1881,93,0],[1882,21,1882,64,0],[1883,17,1883,18,0],[1884,17,1884,54,0],[1885,17,1885,18,0],[1886,21,1886,113,0],[1887,21,1887,99,0],[1888,21,1888,67,0],[1889,17,1889,18,0],[1890,13,1890,14,0],[1892,13,1892,45,0],[1892,46,1892,89,0],[1894,13,1894,107,0],[1895,13,1895,14,0],[1896,17,1896,102,0],[1897,17,1897,63,0],[1898,17,1898,94,0],[1899,17,1899,108,0],[1901,17,1901,86,0],[1902,17,1902,18,0],[1903,21,1903,82,0],[1904,21,1904,87,0],[1905,17,1905,18,0],[1906,17,1906,98,0],[1907,17,1907,60,0],[1909,17,1909,44,0],[1910,13,1910,14,0],[1911,18,1911,49,0],[1912,13,1912,14,0],[1913,22,1913,31,0],[1913,33,1913,47,0],[1913,49,1913,52,0],[1914,17,1914,18,0],[1915,21,1916,86,0],[1917,21,1919,80,0],[1920,17,1920,18,0],[1922,17,1922,57,0],[1923,13,1923,14,0],[1924,13,1924,124,0],[1925,13,1925,52,0],[1926,13,1926,40,0],[1927,13,1927,39,0],[1929,13,1929,49,0],[1930,9,1930,10,0],[1933,9,1933,10,0],[1934,13,1934,62,0],[1935,13,1935,43,0],[1936,13,1936,14,0],[1937,17,1952,51,0],[1953,17,1953,31,0],[1954,17,1954,18,0],[1955,21,1955,92,0],[1956,21,1956,93,0],[1957,17,1957,18,0],[1958,17,1958,48,0],[1959,13,1959,14,0],[1961,13,1961,14,0],[1962,17,1977,51,0],[1978,13,1978,14,0],[1979,13,1979,30,0],[1980,9,1980,10,0],[1990,9,1990,10,0],[1991,13,1991,93,0],[1992,9,1992,10,0],[1995,9,1995,10,0],[1996,13,1997,105,0],[1998,13,1998,30,0],[1999,9,1999,10,0],[2002,9,2002,10,0],[2003,13,2003,94,0],[2004,13,2004,52,0],[2005,9,2005,10,0],[2008,9,2008,10,0],[2009,13,2009,80,0],[2010,13,2010,78,0],[2011,13,2011,64,0],[2013,13,2013,38,0],[2014,13,2014,60,0],[2015,13,2015,58,0],[2016,13,2016,43,0],[2017,13,2017,34,0],[2017,35,2017,71,0],[2018,13,2018,33,0],[2018,34,2018,68,0],[2019,13,2019,142,0],[2021,13,2021,29,0],[2025,21,2025,49,0],[2026,21,2026,27,0],[2028,21,2028,48,0],[2029,21,2029,27,0],[2031,9,2031,10,0],[2034,9,2034,10,0],[2035,13,2035,58,0],[2036,13,2036,44,0],[2037,13,2037,43,0],[2038,17,2038,42,0],[2040,17,2040,98,0],[2042,13,2042,59,0],[2043,13,2043,14,0],[2045,17,2045,55,0],[2046,17,2046,48,0],[2047,17,2047,18,0],[2048,21,2048,99,0],[2049,21,2049,48,0],[2050,21,2050,28,0],[2052,17,2054,139,0],[2055,17,2055,50,0],[2056,17,2056,18,0],[2057,21,2057,106,0],[2058,21,2058,48,0],[2059,21,2059,28,0],[2061,13,2061,14,0],[2063,13,2063,59,0],[2064,13,2064,14,0],[2065,17,2065,56,0],[2066,17,2066,44,0],[2068,17,2068,24,0],[2071,13,2071,69,0],[2072,13,2072,75,0],[2073,13,2073,14,0],[2074,17,2074,99,0],[2075,17,2075,44,0],[2076,17,2076,24,0],[2084,13,2084,57,0],[2085,13,2085,14,0],[2086,17,2086,79,0],[2087,17,2087,18,0],[2088,21,2088,99,0],[2089,21,2089,48,0],[2090,21,2090,28,0],[2092,22,2092,88,0],[2093,17,2093,18,0],[2094,21,2094,101,0],[2095,21,2095,48,0],[2096,21,2096,28,0],[2098,22,2098,86,0],[2099,17,2099,18,0],[2100,21,2100,100,0],[2101,21,2101,48,0],[2102,21,2102,28,0],[2104,13,2104,14,0],[2105,13,2105,23,0],[2106,13,2106,14,0],[2107,17,2107,48,0],[2108,17,2108,18,0],[2109,21,2111,82,0],[2112,21,2112,48,0],[2114,21,2114,28,0],[2116,13,2116,14,0],[2118,13,2118,20,0],[2118,22,2118,38,0],[2118,39,2118,41,0],[2118,42,2118,60,0],[2119,13,2119,14,0],[2120,17,2120,118,0],[2121,17,2121,18,0],[2122,21,2122,114,0],[2123,21,2123,48,0],[2124,21,2124,62,0],[2125,21,2125,28,0],[2127,17,2127,96,0],[2128,17,2128,18,0],[2129,21,2129,113,0],[2130,21,2130,48,0],[2131,21,2131,62,0],[2132,21,2132,28,0],[2134,13,2134,14,0],[2136,13,2136,44,0],[2138,13,2138,72,0],[2139,13,2139,62,0],[2140,13,2140,34,0],[2141,17,2141,61,0],[2142,13,2142,58,0],[2143,13,2143,60,0],[2144,13,2144,46,0],[2145,13,2145,41,0],[2146,13,2146,47,0],[2147,13,2147,58,0],[2148,13,2148,60,0],[2149,13,2149,54,0],[2150,13,2150,59,0],[2151,13,2151,55,0],[2152,13,2152,27,0],[2153,17,2153,66,0],[2154,18,2154,51,0],[2155,17,2155,59,0],[2157,17,2157,56,0],[2158,13,2158,75,0],[2159,13,2159,72,0],[2160,13,2160,27,0],[2161,17,2161,36,0],[2163,13,2163,14,0],[2164,17,2164,63,0],[2165,17,2165,135,0],[2166,13,2166,14,0],[2168,13,2168,76,0],[2171,13,2171,93,0],[2172,13,2172,87,0],[2173,13,2173,14,0],[2174,17,2174,80,0],[2175,17,2175,70,0],[2176,13,2176,14,0],[2178,13,2178,51,0],[2179,13,2179,54,0],[2180,13,2180,53,0],[2181,13,2181,33,0],[2181,35,2181,47,0],[2183,18,2183,27,0],[2183,29,2183,54,0],[2183,56,2183,59,0],[2184,13,2184,14,0],[2185,17,2185,30,0],[2186,17,2186,47,0],[2187,17,2187,47,0],[2188,17,2188,18,0],[2189,21,2190,93,0],[2191,21,2191,87,0],[2192,25,2192,99,0],[2193,21,2193,81,0],[2194,21,2194,95,0],[2195,21,2195,85,0],[2196,21,2196,81,0],[2197,21,2197,85,0],[2198,21,2198,89,0],[2199,21,2199,107,0],[2200,21,2200,83,0],[2201,21,2203,69,0],[2204,25,2204,105,0],[2205,21,2205,110,0],[2206,21,2208,52,0],[2209,21,2212,55,0],[2214,21,2214,35,0],[2215,21,2215,22,0],[2216,25,2216,112,0],[2217,21,2217,22,0],[2218,17,2218,18,0],[2220,17,2220,18,0],[2221,21,2221,85,0],[2222,21,2223,144,0],[2224,21,2227,71,0],[2228,21,2228,22,0],[2229,25,2232,93,0],[2233,25,2233,52,0],[2234,25,2234,32,0],[2246,21,2246,103,0],[2247,21,2247,46,0],[2248,21,2248,104,0],[2249,21,2249,120,0],[2250,21,2250,110,0],[2251,21,2253,52,0],[2254,21,2257,55,0],[2258,17,2258,18,0],[2259,17,2259,38,0],[2260,13,2260,14,0],[2262,13,2262,104,0],[2264,13,2264,84,0],[2265,13,2265,14,0],[2266,17,2267,154,0],[2268,17,2268,44,0],[2269,17,2269,24,0],[2271,13,2271,114,0],[2272,13,2272,14,0],[2273,17,2273,39,0],[2274,17,2274,24,0],[2274,26,2274,36,0],[2274,37,2274,39,0],[2274,40,2274,57,0],[2275,17,2275,18,0],[2276,21,2276,80,0],[2277,17,2277,18,0],[2278,17,2278,68,0],[2279,17,2279,18,0],[2280,21,2280,118,0],[2281,21,2281,48,0],[2282,21,2282,28,0],[2284,13,2284,14,0],[2286,13,2286,46,0],[2287,13,2287,41,0],[2288,13,2288,44,0],[2289,13,2289,51,0],[2290,13,2290,53,0],[2291,13,2291,55,0],[2292,13,2292,49,0],[2293,13,2293,43,0],[2294,17,2294,43,0],[2298,13,2298,58,0],[2299,13,2299,32,0],[2300,13,2300,43,0],[2301,13,2301,79,0],[2304,13,2304,30,0],[2305,13,2305,14,0],[2306,17,2306,89,0],[2307,17,2307,24,0],[2307,26,2307,42,0],[2307,43,2307,45,0],[2307,46,2307,83,0],[2308,17,2308,18,0],[2309,21,2309,87,0],[2310,21,2313,94,0],[2314,21,2314,76,0],[2315,21,2315,130,0],[2317,21,2318,89,0],[2319,21,2319,122,0],[2320,21,2321,87,0],[2323,21,2323,34,0],[2324,17,2324,18,0],[2327,17,2329,109,0],[2330,17,2330,59,0],[2331,17,2331,108,0],[2333,17,2333,48,0],[2334,17,2334,18,0],[2335,21,2335,135,0],[2336,21,2336,49,0],[2337,21,2337,22,0],[2338,25,2338,102,0],[2339,25,2339,92,0],[2340,25,2343,78,0],[2344,25,2347,67,0],[2348,21,2348,22,0],[2349,21,2351,107,0],[2352,17,2352,18,0],[2353,13,2353,14,0],[2354,13,2354,57,0],[2356,13,2356,45,0],[2357,13,2357,14,0],[2358,17,2358,132,0],[2360,17,2360,45,0],[2361,17,2361,18,0],[2362,21,2364,92,0],[2365,21,2365,102,0],[2366,21,2366,90,0],[2367,21,2367,91,0],[2368,21,2371,71,0],[2372,21,2372,92,0],[2373,21,2374,121,0],[2375,17,2375,18,0],[2376,13,2376,14,0],[2378,13,2378,68,0],[2382,13,2382,81,0],[2383,13,2383,14,0],[2385,17,2387,88,0],[2388,17,2388,18,0],[2389,21,2393,76,0],[2394,17,2394,18,0],[2396,17,2396,87,0],[2463,13,2463,14,0],[2464,9,2464,10,0],[2467,9,2467,10,0],[2468,13,2468,74,0],[2469,9,2469,10,0],[2472,9,2472,10,0],[2473,13,2473,88,0],[2475,13,2475,79,0],[2477,13,2477,52,0],[2478,13,2478,63,0],[2479,13,2479,38,0],[2481,13,2481,72,0],[2482,13,2482,73,0],[2484,13,2484,105,0],[2485,13,2485,114,0],[2486,13,2486,83,0],[2487,13,2487,111,0],[2488,13,2488,108,0],[2490,13,2491,126,0],[2493,13,2493,114,0],[2494,13,2494,111,0],[2496,13,2496,115,0],[2497,13,2497,112,0],[2500,13,2500,56,0],[2501,13,2501,47,0],[2502,13,2502,37,0],[2503,13,2503,44,0],[2505,13,2505,76,0],[2506,13,2506,14,0],[2507,17,2507,52,0],[2509,17,2509,53,0],[2510,17,2510,42,0],[2511,13,2511,14,0],[2513,13,2513,14,0],[2514,17,2514,42,0],[2515,17,2517,77,0],[2518,13,2518,14,0],[2519,13,2519,27,0],[2520,17,2520,74,0],[2522,13,2522,39,0],[2523,13,2523,14,0],[2524,17,2524,73,0],[2525,17,2525,56,0],[2526,17,2526,57,0],[2527,17,2527,39,0],[2528,17,2528,75,0],[2529,17,2529,48,0],[2531,17,2531,75,0],[2532,17,2532,60,0],[2533,17,2533,61,0],[2534,17,2534,40,0],[2535,17,2535,76,0],[2536,17,2536,50,0],[2538,17,2538,85,0],[2539,17,2539,68,0],[2540,17,2540,69,0],[2541,17,2541,45,0],[2542,17,2542,76,0],[2543,17,2543,55,0],[2544,13,2544,14,0],[2545,9,2545,10,0],[2548,9,2548,10,0],[2549,18,2549,27,0],[2549,29,2549,57,0],[2549,59,2549,62,0],[2550,13,2550,14,0],[2551,17,2551,98,0],[2552,21,2552,33,0],[2553,13,2553,14,0],[2554,13,2554,26,0],[2555,9,2555,10,0],[2558,9,2558,10,0],[2559,13,2559,56,0],[2560,13,2560,69,0],[2561,13,2561,52,0],[2562,9,2562,10,0],[2565,9,2565,10,0],[2566,13,2566,56,0],[2567,13,2567,41,0],[2568,13,2568,44,0],[2569,13,2569,47,0],[2570,9,2570,10,0],[2573,9,2573,10,0],[2575,13,2575,32,0],[2576,13,2576,28,0],[2577,13,2577,33,0],[2579,13,2579,14,0],[2580,17,2582,84,0],[2583,17,2583,41,0],[2587,17,2587,60,0],[2588,17,2588,32,0],[2592,17,2592,101,0],[2593,17,2593,58,0],[2594,17,2594,44,0],[2596,17,2596,75,0],[2597,17,2597,18,0],[2598,21,2598,36,0],[2599,21,2599,55,0],[2601,21,2601,35,0],[2603,22,2603,82,0],[2604,17,2604,18,0],[2605,21,2605,36,0],[2606,21,2607,119,0],[2609,21,2609,35,0],[2612,17,2612,18,0],[2613,21,2613,89,0],[2620,21,2620,108,0],[2621,21,2621,58,0],[2622,21,2622,50,0],[2627,21,2627,46,0],[2628,21,2628,22,0],[2629,25,2629,32,0],[2629,34,2629,47,0],[2629,48,2629,50,0],[2629,51,2629,91,0],[2630,25,2630,26,0],[2631,29,2631,60,0],[2632,29,2632,60,0],[2633,33,2633,72,0],[2634,29,2634,75,0],[2635,29,2635,30,0],[2636,33,2636,48,0],[2637,33,2638,86,0],[2639,33,2639,47,0],[2641,25,2641,26,0],[2642,21,2642,22,0],[2644,21,2644,22,0],[2645,25,2645,32,0],[2645,34,2645,47,0],[2645,48,2645,50,0],[2645,51,2645,91,0],[2646,25,2646,26,0],[2647,29,2647,60,0],[2648,29,2648,60,0],[2649,33,2649,61,0],[2652,34,2652,67,0],[2653,33,2653,56,0],[2654,29,2654,75,0],[2655,29,2655,30,0],[2656,33,2656,48,0],[2657,33,2658,86,0],[2660,33,2660,47,0],[2662,25,2662,26,0],[2663,21,2663,22,0],[2671,21,2671,56,0],[2673,21,2673,28,0],[2673,30,2673,43,0],[2673,44,2673,46,0],[2673,47,2673,87,0],[2674,21,2674,22,0],[2675,25,2675,52,0],[2676,25,2676,56,0],[2677,25,2677,73,0],[2680,33,2680,77,0],[2681,33,2681,54,0],[2682,33,2682,39,0],[2684,33,2684,79,0],[2685,33,2685,56,0],[2686,33,2686,39,0],[2688,33,2688,80,0],[2689,33,2689,102,0],[2690,33,2690,39,0],[2692,33,2692,78,0],[2693,33,2693,56,0],[2694,33,2694,39,0],[2696,33,2696,78,0],[2697,33,2697,57,0],[2698,33,2698,39,0],[2700,25,2700,58,0],[2702,25,2702,55,0],[2703,21,2703,22,0],[2706,21,2706,52,0],[2707,21,2707,76,0],[2708,21,2708,22,0],[2709,21,2709,58,0],[2710,21,2710,28,0],[2710,30,2710,43,0],[2710,44,2710,46,0],[2710,47,2710,87,0],[2711,21,2711,22,0],[2712,25,2712,55,0],[2713,29,2713,78,0],[2714,30,2714,62,0],[2715,29,2715,73,0],[2716,30,2716,60,0],[2717,29,2717,70,0],[2719,29,2719,84,0],[2720,21,2720,22,0],[2721,21,2721,84,0],[2722,21,2722,77,0],[2724,21,2724,72,0],[2725,21,2725,48,0],[2736,21,2736,41,0],[2737,25,2737,53,0],[2738,21,2738,54,0],[2739,21,2739,35,0],[2740,17,2740,18,0],[2740,19,2740,68,0],[2743,17,2743,57,0],[2744,17,2744,53,0],[2745,17,2745,57,0],[2746,17,2746,18,0],[2747,21,2749,75,0],[2750,21,2750,34,0],[2753,17,2753,57,0],[2754,17,2754,41,0],[2756,17,2756,42,0],[2757,17,2757,18,0],[2758,26,2758,35,0],[2758,37,2758,51,0],[2758,53,2758,56,0],[2759,21,2759,22,0],[2760,25,2760,74,0],[2761,25,2761,92,0],[2762,25,2762,54,0],[2763,25,2763,26,0],[2764,29,2764,93,0],[2765,29,2765,55,0],[2766,29,2766,42,0],[2769,25,2769,26,0],[2770,29,2770,82,0],[2771,29,2771,46,0],[2772,29,2772,103,0],[2773,29,2773,30,0],[2774,33,2775,90,0],[2776,33,2776,59,0],[2777,33,2777,46,0],[2779,29,2779,72,0],[2780,29,2781,122,0],[2782,29,2782,104,0],[2783,25,2783,26,0],[2784,21,2784,22,0],[2785,17,2785,18,0],[2787,17,2787,18,0],[2788,26,2788,35,0],[2788,37,2788,51,0],[2788,53,2788,56,0],[2789,21,2789,22,0],[2790,25,2790,78,0],[2791,25,2791,90,0],[2792,25,2792,48,0],[2793,25,2793,26,0],[2794,29,2795,109,0],[2796,29,2796,55,0],[2797,29,2797,42,0],[2800,25,2800,26,0],[2801,29,2801,76,0],[2802,29,2802,46,0],[2803,29,2803,103,0],[2804,29,2804,30,0],[2805,33,2806,121,0],[2807,33,2807,59,0],[2808,33,2808,46,0],[2810,29,2810,72,0],[2811,29,2812,122,0],[2813,29,2813,104,0],[2814,25,2814,26,0],[2815,21,2815,22,0],[2816,17,2816,18,0],[2818,17,2818,46,0],[2820,17,2820,31,0],[2822,13,2822,33,0],[2823,13,2823,14,0],[2824,17,2824,45,0],[2826,17,2826,30,0],[2830,9,2830,10,0],[2833,9,2833,10,0],[2834,13,2834,53,0],[2835,18,2835,27,0],[2835,29,2835,43,0],[2835,45,2835,48,0],[2836,13,2836,14,0],[2837,17,2837,57,0],[2838,13,2838,14,0],[2839,9,2839,10,0],[2842,9,2842,10,0],[2843,13,2843,32,0],[2844,13,2844,30,0],[2845,13,2845,61,0],[2846,13,2846,78,0],[2847,13,2847,44,0],[2850,13,2850,57,0],[2852,13,2852,69,0],[2853,13,2853,68,0],[2854,13,2854,20,0],[2854,22,2854,32,0],[2854,33,2854,35,0],[2854,36,2854,68,0],[2855,13,2855,14,0],[2857,17,2857,28,0],[2858,17,2858,40,0],[2859,13,2859,14,0],[2861,13,2861,20,0],[2861,22,2861,32,0],[2861,33,2861,35,0],[2861,36,2861,54,0],[2862,13,2862,14,0],[2863,17,2863,71,0],[2864,17,2864,35,0],[2865,21,2865,44,0],[2866,17,2867,116,0],[2868,17,2868,51,0],[2869,17,2869,18,0],[2870,21,2870,44,0],[2871,21,2871,30,0],[2873,13,2873,14,0],[2875,13,2875,20,0],[2875,22,2875,32,0],[2875,33,2875,35,0],[2875,36,2875,74,0],[2876,13,2876,14,0],[2877,17,2877,29,0],[2878,13,2878,14,0],[2879,13,2879,56,0],[2881,13,2881,43,0],[2889,13,2889,53,0],[2891,13,2891,68,0],[2893,13,2893,27,0],[2894,9,2894,10,0],[2897,9,2897,10,0],[2898,13,2898,53,0],[2899,13,2899,49,0],[2900,13,2900,60,0],[2901,13,2901,63,0],[2902,13,2902,65,0],[2904,13,2904,28,0],[2905,9,2905,10,0],[2908,9,2908,10,0],[2910,13,2910,14,0],[2911,17,2911,92,0],[2912,17,2912,118,0],[2913,17,2920,124,0],[2922,13,2922,18,0],[2923,13,2923,14,0],[2924,17,2924,30,0],[2926,9,2926,10,0],[2929,9,2929,10,0],[2947,13,2947,52,0],[2948,13,2948,63,0],[2949,13,2949,27,0],[2950,17,2950,90,0],[2951,13,2951,92,0],[2952,13,2952,92,0],[2955,13,2955,83,0],[2956,13,2956,86,0],[2957,13,2957,92,0],[2958,13,2958,105,0],[2960,13,2960,99,0],[2961,13,2961,95,0],[2962,13,2962,98,0],[2963,13,2963,98,0],[2964,13,2964,48,0],[2965,13,2965,42,0],[2967,13,2967,49,0],[2969,13,2969,40,0],[2980,9,2980,10,0],[2983,9,2983,10,0],[2984,13,2984,77,0],[2985,13,2985,14,0],[2986,17,2986,48,0],[2987,13,2987,14,0],[2989,13,2989,14,0],[2990,17,2990,62,0],[2991,17,2991,50,0],[2992,17,2992,47,0],[2993,17,2993,63,0],[2994,17,2994,24,0],[2994,26,2994,42,0],[2994,43,2994,45,0],[2994,46,2994,63,0],[2995,17,2995,18,0],[2996,21,2996,57,0],[2997,21,2997,59,0],[2998,17,2998,18,0],[2999,13,2999,14,0],[3000,9,3000,10,0],[3003,9,3003,10,0],[3004,13,3004,46,0],[3005,9,3005,10,0],[3008,9,3008,10,0],[3009,13,3009,37,0],[3010,13,3010,14,0],[3011,17,3011,34,0],[3012,13,3012,14,0],[3013,13,3013,64,0],[3014,13,3014,14,0],[3015,17,3015,82,0],[3016,17,3016,105,0],[3017,13,3017,14,0],[3019,13,3019,65,0],[3020,13,3020,14,0],[3021,17,3021,80,0],[3022,17,3022,107,0],[3023,13,3023,14,0],[3024,13,3024,67,0],[3025,13,3025,14,0],[3026,17,3026,84,0],[3027,17,3027,111,0],[3028,13,3028,14,0],[3030,13,3030,66,0],[3031,13,3031,14,0],[3032,17,3032,54,0],[3033,17,3033,18,0],[3034,21,3034,86,0],[3035,21,3035,116,0],[3036,17,3036,18,0],[3038,17,3038,18,0],[3039,21,3039,57,0],[3040,21,3040,105,0],[3041,17,3041,18,0],[3042,13,3042,14,0],[3043,13,3043,104,0],[3044,13,3044,14,0],[3045,17,3045,84,0],[3046,17,3047,71,0],[3048,13,3048,14,0],[3050,13,3050,14,0],[3051,17,3051,54,0],[3052,13,3052,14,0],[3053,13,3053,104,0],[3054,13,3054,14,0],[3055,17,3055,84,0],[3056,17,3057,71,0],[3058,13,3058,14,0],[3060,13,3060,14,0],[3061,17,3061,54,0],[3062,13,3062,14,0],[3063,13,3063,71,0],[3064,13,3064,14,0],[3065,17,3065,92,0],[3066,17,3066,116,0],[3067,13,3067,14,0],[3068,13,3068,65,0],[3069,13,3069,14,0],[3070,17,3070,80,0],[3071,17,3071,105,0],[3072,13,3072,14,0],[3073,13,3073,67,0],[3074,13,3074,14,0],[3075,17,3075,84,0],[3076,17,3076,113,0],[3077,13,3077,14,0],[3078,13,3078,67,0],[3079,13,3079,14,0],[3080,17,3080,79,0],[3081,13,3081,14,0],[3082,9,3082,10,0],[3085,9,3085,10,0],[3086,13,3087,65,0],[3088,17,3088,49,0],[3090,13,3090,33,0],[3091,9,3091,10,0],[3100,13,3100,14,0],[3101,17,3101,29,0],[3102,17,3105,64,0],[3106,17,3106,18,0],[3107,21,3109,92,0],[3110,17,3110,18,0],[3112,17,3112,18,0],[3113,21,3113,59,0],[3114,17,3114,18,0],[3115,17,3115,38,0],[3116,13,3116,14,0],[3122,13,3122,14,0],[3123,17,3123,156,0],[3124,13,3124,14,0],[3127,37,3127,38,0],[3127,39,3127,127,0],[3127,128,3127,129,0],[3131,17,3131,18,0],[3131,19,3131,36,0],[3131,37,3131,38,0],[3136,17,3136,18,0],[3136,19,3136,39,0],[3136,40,3136,41,0],[3141,17,3141,18,0],[3141,19,3141,31,0],[3141,32,3141,33,0],[3146,17,3146,18,0],[3146,19,3146,65,0],[3146,66,3146,67,0],[3152,13,3152,14,0],[3153,17,3155,98,0],[3156,17,3156,27,0],[3157,13,3157,14,0],[3163,13,3163,14,0],[3164,17,3166,54,0],[3167,13,3167,14,0],[3173,9,3173,10,0],[3174,13,3174,35,0],[3175,9,3175,10,0],[3178,9,3178,10,0],[3179,13,3179,74,0],[3180,13,3180,48,0],[3181,13,3181,39,0],[3182,13,3182,93,0],[3183,13,3183,45,0],[3186,13,3186,14,0],[3187,17,3189,118,0],[3190,17,3191,99,0],[3192,13,3192,14,0],[3193,13,3193,33,0],[3194,13,3194,14,0],[3195,17,3195,57,0],[3196,13,3196,14,0],[3197,9,3197,10,0],[3202,9,3202,10,0],[3203,13,3203,42,0],[3204,13,3204,84,0],[3205,13,3205,83,0],[3206,13,3207,85,0],[3208,13,3208,28,0],[3209,13,3209,36,0],[3210,13,3210,101,0],[3211,9,3211,10,0],[3214,9,3214,10,0],[3215,13,3233,26,0],[3235,13,3235,34,0],[3236,17,3236,49,0],[3238,13,3243,27,0],[3245,9,3245,10,0],[3248,9,3248,10,0],[3249,13,3257,26,0],[3259,13,3261,27,0],[3262,9,3262,10,0],[3265,9,3265,10,0],[3266,13,3269,26,0],[3271,13,3282,27,0],[3283,9,3283,10,0],[3286,9,3286,10,0],[3287,13,3287,49,0],[3291,9,3291,10,0],[3292,13,3292,56,0],[3293,17,3294,113,0],[3295,13,3297,50,0],[3298,9,3298,10,0],[3302,9,3302,10,0],[3303,13,3303,38,0],[3304,13,3304,26,0],[3305,13,3305,30,0],[3306,13,3306,32,0],[3307,13,3307,67,0],[3308,17,3308,30,0],[3310,13,3310,83,0],[3311,17,3311,76,0],[3313,17,3313,60,0],[3315,13,3315,151,0],[3317,13,3318,45,0],[3319,17,3319,29,0],[3321,13,3321,14,0],[3322,17,3322,52,0],[3323,21,3323,105,0],[3324,17,3324,30,0],[3326,9,3326,10,0],[3329,9,3329,10,0],[3330,13,3330,122,0],[3331,13,3331,122,0],[3332,13,3339,24,0],[3340,13,3341,71,0],[3342,9,3342,10,0],[3350,9,3350,10,0],[3351,13,3351,38,0],[3352,13,3352,65,0],[3353,13,3353,47,0],[3354,13,3354,14,0],[3355,17,3355,120,0],[3356,17,3356,45,0],[3357,17,3357,37,0],[3358,17,3361,63,0],[3362,17,3364,122,0],[3366,17,3366,18,0],[3368,21,3370,138,0],[3371,17,3371,18,0],[3372,17,3372,22,0],[3373,17,3373,18,0],[3374,17,3374,18,0],[3375,13,3375,14,0],[3377,13,3377,14,0],[3378,17,3378,57,0],[3379,13,3379,14,0],[3380,13,3380,76,0],[3381,18,3381,27,0],[3381,29,3381,63,0],[3381,65,3381,68,0],[3382,13,3382,14,0],[3383,17,3384,86,0],[3385,21,3387,119,0],[3389,21,3392,113,0],[3393,13,3393,14,0],[3394,13,3394,49,0],[3395,13,3395,54,0],[3396,13,3396,99,0],[3397,9,3397,10,0],[3400,9,3400,10,0],[3401,13,3401,44,0],[3402,9,3402,10,0],[3405,9,3405,10,0],[3406,13,3406,40,0],[3407,13,3407,42,0],[3408,13,3408,83,0],[3409,13,3409,40,0],[3411,13,3411,27,0],[3412,13,3412,14,0],[3413,17,3413,116,0],[3414,17,3414,34,0],[3415,21,3415,42,0],[3417,21,3417,43,0],[3418,13,3418,14,0],[3420,17,3420,38,0],[3422,13,3422,31,0],[3423,13,3423,14,0],[3424,17,3424,81,0],[3425,17,3425,57,0],[3426,17,3429,60,0],[3430,17,3430,166,0],[3431,17,3435,135,0],[3436,17,3440,131,0],[3441,17,3441,98,0],[3443,17,3443,51,0],[3444,17,3444,34,0],[3446,17,3446,66,0],[3447,17,3447,48,0],[3449,17,3459,58,0],[3462,17,3462,27,0],[3463,17,3463,24,0],[3463,26,3463,37,0],[3463,38,3463,40,0],[3463,41,3463,58,0],[3464,17,3464,18,0],[3465,21,3465,69,0],[3466,21,3466,22,0],[3467,25,3467,29,0],[3468,25,3468,63,0],[3469,25,3469,58,0],[3470,25,3470,87,0],[3471,25,3473,91,0],[3474,25,3476,82,0],[3477,25,3480,131,0],[3481,25,3481,76,0],[3482,25,3485,46,0],[3486,25,3489,46,0],[3490,25,3490,54,0],[3491,25,3491,58,0],[3492,21,3492,22,0],[3493,17,3493,18,0],[3494,17,3494,50,0],[3495,17,3495,66,0],[3496,17,3496,47,0],[3499,17,3499,49,0],[3501,17,3501,48,0],[3502,13,3502,14,0],[3504,17,3506,63,0],[3507,9,3507,10,0],[3511,9,3511,10,0],[3512,13,3512,38,0],[3514,13,3514,116,0],[3515,13,3515,64,0],[3516,13,3516,32,0],[3517,13,3517,14,0],[3518,17,3518,120,0],[3519,17,3519,45,0],[3520,17,3520,37,0],[3521,17,3524,63,0],[3525,17,3527,122,0],[3529,17,3529,18,0],[3531,21,3533,139,0],[3534,17,3534,18,0],[3535,17,3535,22,0],[3536,17,3536,18,0],[3537,17,3537,18,0],[3538,13,3538,14,0],[3540,13,3540,14,0],[3541,17,3541,57,0],[3542,13,3542,14,0],[3543,13,3543,76,0],[3544,18,3544,27,0],[3544,29,3544,62,0],[3544,64,3544,67,0],[3545,13,3545,14,0],[3546,17,3547,91,0],[3548,21,3550,116,0],[3552,21,3555,113,0],[3556,17,3558,105,0],[3559,13,3559,14,0],[3560,13,3560,48,0],[3561,13,3561,53,0],[3562,13,3562,98,0],[3563,9,3563,10,0],[3566,9,3566,10,0],[3567,13,3567,44,0],[3568,9,3568,10,0],[3571,9,3571,10,0],[3572,13,3572,40,0],[3573,13,3573,85,0],[3574,13,3574,80,0],[3575,13,3575,36,0],[3577,13,3580,56,0],[3581,13,3585,118,0],[3586,13,3589,133,0],[3590,13,3595,132,0],[3596,13,3596,94,0],[3598,13,3598,48,0],[3600,13,3600,44,0],[3601,9,3601,10,0],[3604,9,3604,10,0],[3605,13,3605,52,0],[3606,13,3606,72,0],[3607,13,3607,69,0],[3609,9,3609,10,0],[3612,9,3612,10,0],[3613,13,3613,51,0],[3614,13,3614,70,0],[3615,13,3615,67,0],[3616,9,3616,10,0],[3623,9,3623,10,0],[3624,13,3624,80,0],[3627,13,3627,65,0],[3628,13,3628,44,0],[3630,13,3630,56,0],[3631,17,3631,68,0],[3633,13,3633,66,0],[3634,13,3634,14,0],[3635,17,3637,117,0],[3638,17,3638,79,0],[3639,17,3639,117,0],[3640,17,3640,120,0],[3641,17,3646,117,0],[3648,17,3648,94,0],[3649,17,3649,18,0],[3650,21,3652,106,0],[3653,21,3655,117,0],[3656,17,3656,18,0],[3657,13,3657,14,0],[3658,13,3658,64,0],[3659,13,3659,14,0],[3660,17,3662,112,0],[3663,17,3663,77,0],[3664,17,3664,115,0],[3665,17,3665,118,0],[3666,17,3671,117,0],[3673,17,3673,94,0],[3674,17,3674,18,0],[3675,21,3677,104,0],[3678,21,3680,115,0],[3681,17,3681,18,0],[3682,13,3682,14,0],[3683,13,3683,56,0],[3684,13,3684,14,0],[3685,17,3685,71,0],[3686,17,3687,119,0],[3688,17,3688,69,0],[3689,17,3689,94,0],[3690,17,3690,18,0],[3691,21,3693,96,0],[3694,21,3696,107,0],[3697,17,3697,18,0],[3698,13,3698,14,0],[3699,13,3699,60,0],[3700,13,3700,14,0],[3701,17,3701,73,0],[3702,17,3702,111,0],[3703,17,3703,114,0],[3704,17,3706,109,0],[3707,13,3707,14,0],[3709,13,3709,62,0],[3710,13,3710,14,0],[3711,17,3711,75,0],[3712,17,3712,113,0],[3713,17,3713,116,0],[3714,17,3716,109,0],[3717,13,3717,14,0],[3719,13,3719,67,0],[3720,13,3720,14,0],[3721,17,3721,80,0],[3722,17,3722,118,0],[3723,17,3723,121,0],[3724,17,3726,109,0],[3727,13,3727,14,0],[3730,13,3730,49,0],[3731,13,3731,14,0],[3732,17,3732,64,0],[3733,17,3733,64,0],[3734,21,3734,73,0],[3735,13,3735,14,0],[3736,18,3736,65,0],[3737,17,3737,69,0],[3739,13,3739,47,0],[3740,13,3740,14,0],[3741,17,3741,100,0],[3742,17,3742,60,0],[3743,13,3743,14,0],[3745,13,3745,65,0],[3746,13,3746,14,0],[3747,17,3747,118,0],[3748,17,3748,78,0],[3749,13,3749,14,0],[3751,13,3751,53,0],[3752,13,3752,14,0],[3754,17,3754,64,0],[3755,17,3755,18,0],[3756,21,3756,80,0],[3757,21,3757,121,0],[3758,17,3758,18,0],[3760,17,3760,70,0],[3761,21,3761,131,0],[3763,17,3763,68,0],[3764,21,3764,129,0],[3765,13,3765,14,0],[3766,18,3766,54,0],[3767,13,3767,14,0],[3769,17,3769,64,0],[3770,21,3770,79,0],[3772,17,3772,70,0],[3773,21,3773,127,0],[3775,17,3775,68,0],[3776,21,3776,125,0],[3777,13,3777,14,0],[3778,13,3778,90,0],[3782,13,3782,37,0],[3783,13,3783,14,0],[3784,17,3784,53,0],[3785,17,3785,18,0],[3786,21,3786,57,0],[3786,58,3786,86,0],[3787,21,3787,54,0],[3788,17,3788,18,0],[3789,22,3789,62,0],[3790,17,3790,18,0],[3791,21,3791,61,0],[3791,62,3791,94,0],[3792,21,3792,50,0],[3793,17,3793,18,0],[3794,13,3794,14,0],[3796,13,3796,14,0],[3797,17,3797,50,0],[3798,17,3798,46,0],[3799,13,3799,14,0],[3801,13,3801,38,0],[3802,13,3802,14,0],[3803,17,3803,59,0],[3803,60,3803,98,0],[3804,17,3804,59,0],[3804,60,3804,95,0],[3805,13,3805,14,0],[3807,13,3807,14,0],[3808,17,3808,53,0],[3809,17,3809,56,0],[3810,13,3810,14,0],[3813,9,3813,10,0],[3816,9,3816,10,0],[3817,13,3817,46,0],[3818,13,3818,42,0],[3820,13,3820,53,0],[3821,13,3821,14,0],[3822,17,3822,101,0],[3823,17,3823,89,0],[3824,13,3824,14,0],[3825,13,3825,37,0],[3826,9,3826,10,0],[3829,9,3829,10,0],[3830,13,3830,79,0],[3831,13,3831,69,0],[3832,13,3832,112,0],[3834,13,3834,14,0],[3835,17,3835,100,0],[3836,13,3836,14,0],[3837,13,3837,18,0],[3838,13,3838,14,0],[3839,17,3839,50,0],[3840,13,3840,14,0],[3841,13,3841,14,0],[3843,13,3843,14,0],[3844,17,3844,63,0],[3845,13,3845,14,0],[3846,13,3846,18,0],[3847,13,3847,14,0],[3848,17,3848,52,0],[3849,13,3849,14,0],[3850,13,3850,14,0],[3852,13,3852,14,0],[3853,17,3855,57,0],[3856,13,3856,14,0],[3857,13,3857,18,0],[3858,13,3858,14,0],[3859,17,3859,51,0],[3860,13,3860,14,0],[3861,13,3861,14,0],[3862,9,3862,10,0],[3865,9,3865,10,0],[3867,13,3867,14,0],[3868,17,3868,79,0],[3869,17,3869,18,0],[3870,21,3870,61,0],[3871,25,3873,113,0],[3875,25,3877,109,0],[3878,17,3878,18,0],[3879,13,3879,14,0],[3880,13,3880,18,0],[3881,13,3881,14,0],[3882,13,3882,14,0],[3883,9,3883,10,0],[3886,9,3886,10,0],[3887,13,3887,44,0],[3888,17,3888,71,0],[3890,17,3890,49,0],[3892,13,3892,145,0],[3893,9,3893,10,0],[3896,9,3896,10,0],[3897,13,3897,45,0],[3899,13,3899,43,0],[3900,13,3900,56,0],[3901,13,3901,51,0],[3902,13,3902,58,0],[3904,13,3904,43,0],[3905,13,3905,48,0],[3906,13,3906,45,0],[3907,13,3907,58,0],[3909,13,3909,28,0],[3910,9,3910,10,0],[3913,9,3913,10,0],[3914,13,3914,45,0],[3916,13,3916,43,0],[3917,13,3917,58,0],[3918,13,3918,52,0],[3919,13,3919,58,0],[3921,13,3921,43,0],[3922,13,3922,48,0],[3923,13,3923,45,0],[3924,13,3924,58,0],[3926,13,3926,28,0],[3927,9,3927,10,0],[3937,9,3937,36,0],[3938,9,3938,10,0],[3939,13,3939,34,0],[3940,13,3940,41,0],[3941,13,3941,42,0],[3942,13,3942,53,0],[3944,13,3944,65,0],[3945,13,3945,99,0],[3946,9,3946,10,0],[3950,17,3950,18,0],[3950,19,3950,112,0],[3950,113,3950,114,0],[3954,9,3954,10,0],[3955,13,3955,70,0],[3956,13,3956,66,0],[3957,13,3957,66,0],[3958,13,3958,70,0],[3959,13,3959,76,0],[3960,13,3960,80,0],[3962,13,3962,14,0],[3963,17,3963,45,0],[3966,25,3966,37,0],[3967,25,3967,31,0],[3969,25,3969,39,0],[3970,25,3970,31,0],[3972,25,3972,50,0],[3973,25,3973,31,0],[3975,25,3975,42,0],[3976,25,3976,31,0],[3978,25,3978,46,0],[3979,25,3979,31,0],[3981,25,3981,46,0],[3982,25,3982,31,0],[3984,25,3984,38,0],[3985,25,3985,31,0],[3987,13,3987,14,0],[3988,13,3988,33,0],[3989,13,3989,14,0],[3990,17,3990,68,0],[3991,17,3991,75,0],[3992,17,3992,26,0],[3994,9,3994,10,0],[3997,9,3997,10,0],[3998,13,3998,53,0],[3999,17,3999,112,0],[4000,13,4000,56,0],[4001,17,4001,118,0],[4002,13,4002,54,0],[4003,17,4003,114,0],[4004,13,4004,60,0],[4005,17,4005,126,0],[4006,13,4006,44,0],[4007,17,4007,94,0],[4008,13,4008,27,0],[4009,9,4009,10,0],[4012,9,4012,10,0],[4013,13,4013,52,0],[4014,13,4014,14,0],[4015,17,4015,79,0],[4017,13,4017,113,0],[4018,13,4018,42,0],[4019,13,4019,14,0],[4020,17,4020,82,0],[4021,17,4021,45,0],[4022,17,4022,18,0],[4023,21,4023,83,0],[4025,17,4025,54,0],[4026,21,4026,83,0],[4028,21,4028,31,0],[4031,17,4031,27,0],[4032,9,4032,10,0],[4035,9,4035,10,0],[4036,13,4036,51,0],[4037,13,4037,14,0],[4038,17,4038,81,0],[4039,17,4039,102,0],[4040,17,4040,132,0],[4041,17,4041,53,0],[4042,17,4042,18,0],[4043,21,4043,49,0],[4044,21,4044,34,0],[4045,21,4045,53,0],[4046,21,4046,91,0],[4047,21,4047,44,0],[4048,21,4048,51,0],[4049,25,4049,74,0],[4051,25,4051,69,0],[4052,21,4053,96,0],[4054,21,4054,22,0],[4055,25,4055,88,0],[4056,25,4056,71,0],[4057,25,4057,56,0],[4058,25,4058,59,0],[4059,25,4059,118,0],[4060,25,4060,81,0],[4061,25,4061,41,0],[4062,25,4062,26,0],[4063,29,4063,79,0],[4064,25,4064,26,0],[4066,29,4066,81,0],[4067,21,4067,22,0],[4069,21,4069,71,0],[4070,21,4070,71,0],[4071,17,4071,18,0],[4073,17,4073,18,0],[4074,21,4074,72,0],[4075,21,4075,52,0],[4077,13,4077,14,0],[4079,13,4079,14,0],[4080,17,4080,68,0],[4081,17,4081,67,0],[4083,9,4083,10,0],[4086,9,4086,10,0],[4087,13,4087,51,0],[4088,13,4088,14,0],[4089,17,4089,81,0],[4090,17,4090,102,0],[4091,17,4091,148,0],[4092,17,4092,18,0],[4095,21,4095,100,0],[4096,25,4096,101,0],[4097,21,4099,88,0],[4100,21,4100,43,0],[4101,25,4101,72,0],[4102,21,4102,134,0],[4103,21,4103,22,0],[4105,25,4105,26,0],[4106,29,4106,55,0],[4107,25,4107,26,0],[4108,25,4108,45,0],[4109,25,4109,26,0],[4110,29,4110,38,0],[4112,21,4112,22,0],[4113,21,4113,71,0],[4114,17,4114,18,0],[4116,17,4116,18,0],[4117,21,4117,80,0],[4119,13,4119,14,0],[4121,17,4121,67,0],[4122,9,4122,10,0],[4125,9,4125,10,0],[4126,13,4126,34,0],[4127,13,4127,25,0],[4128,13,4128,47,0],[4129,13,4129,50,0],[4131,13,4131,44,0],[4132,13,4132,53,0],[4135,13,4135,43,0],[4138,13,4138,71,0],[4139,13,4139,75,0],[4141,18,4141,23,0],[4141,25,4141,66,0],[4141,68,4141,71,0],[4142,13,4142,14,0],[4143,17,4143,39,0],[4144,17,4144,45,0],[4145,17,4145,92,0],[4146,17,4146,105,0],[4147,17,4148,88,0],[4149,17,4149,38,0],[4150,13,4150,14,0],[4152,13,4152,35,0],[4153,13,4155,69,0],[4156,9,4156,10,0],[4159,9,4159,10,0],[4182,13,4182,77,0],[4183,13,4183,98,0],[4184,13,4184,51,0],[4185,13,4185,14,0],[4186,17,4188,84,0],[4189,17,4189,39,0],[4190,21,4190,68,0],[4191,17,4191,67,0],[4192,13,4192,14,0],[4194,17,4194,67,0],[4195,9,4195,10,0],[4198,9,4198,10,0],[4199,13,4199,41,0],[4200,13,4200,26,0],[4201,13,4201,45,0],[4202,13,4202,83,0],[4203,13,4203,110,0],[4204,13,4204,36,0],[4206,13,4206,43,0],[4207,17,4207,66,0],[4209,17,4209,61,0],[4211,13,4212,88,0],[4213,13,4213,14,0],[4214,17,4214,36,0],[4215,17,4215,18,0],[4216,21,4216,85,0],[4217,21,4217,84,0],[4218,21,4218,106,0],[4219,21,4219,52,0],[4220,21,4220,55,0],[4221,21,4221,154,0],[4222,21,4222,81,0],[4223,21,4223,37,0],[4224,21,4224,22,0],[4225,25,4225,75,0],[4226,21,4226,22,0],[4227,26,4227,44,0],[4228,21,4228,22,0],[4229,25,4229,105,0],[4232,21,4232,22,0],[4233,25,4233,77,0],[4235,17,4235,18,0],[4237,17,4237,18,0],[4238,21,4239,100,0],[4241,13,4241,14,0],[4243,13,4243,14,0],[4244,17,4245,96,0],[4247,9,4247,10,0],[4250,9,4250,10,0],[4251,13,4251,41,0],[4252,13,4252,26,0],[4253,13,4253,45,0],[4254,13,4254,83,0],[4255,13,4255,110,0],[4256,13,4256,36,0],[4258,13,4258,43,0],[4259,17,4259,66,0],[4261,17,4261,61,0],[4263,13,4264,88,0],[4265,13,4265,14,0],[4266,17,4266,36,0],[4267,17,4267,18,0],[4268,21,4268,85,0],[4269,21,4269,84,0],[4270,21,4270,106,0],[4271,21,4271,52,0],[4272,21,4272,55,0],[4273,21,4273,114,0],[4274,21,4274,73,0],[4276,21,4276,37,0],[4277,21,4277,22,0],[4278,25,4278,44,0],[4279,25,4279,26,0],[4280,29,4280,71,0],[4281,29,4281,57,0],[4282,29,4282,55,0],[4283,29,4283,60,0],[4284,29,4285,155,0],[4286,29,4286,59,0],[4287,29,4287,53,0],[4288,25,4288,26,0],[4290,25,4290,85,0],[4292,25,4292,75,0],[4293,21,4293,22,0],[4294,26,4294,44,0],[4295,25,4295,105,0],[4297,25,4297,77,0],[4298,17,4298,18,0],[4300,17,4300,18,0],[4301,21,4302,100,0],[4304,13,4304,14,0],[4306,17,4307,95,0],[4308,9,4308,10,0],[4311,9,4311,10,0],[4312,13,4312,47,0],[4313,13,4313,110,0],[4314,13,4314,77,0],[4315,13,4315,75,0],[4317,13,4317,51,0],[4318,13,4318,14,0],[4321,17,4321,49,0],[4322,17,4322,18,0],[4323,21,4323,74,0],[4324,21,4324,22,0],[4325,25,4325,98,0],[4327,21,4327,82,0],[4328,21,4328,22,0],[4329,25,4329,109,0],[4331,17,4331,18,0],[4335,17,4335,34,0],[4337,17,4337,77,0],[4338,21,4339,81,0],[4341,21,4342,76,0],[4344,17,4344,67,0],[4346,17,4346,36,0],[4347,17,4347,18,0],[4348,21,4349,177,0],[4351,22,4351,41,0],[4352,17,4352,18,0],[4353,21,4354,129,0],[4356,13,4356,14,0],[4357,9,4357,10,0],[4360,9,4360,10,0],[4361,13,4361,47,0],[4362,13,4362,110,0],[4363,13,4363,77,0],[4364,13,4364,75,0],[4366,13,4366,51,0],[4367,13,4367,14,0],[4370,17,4370,49,0],[4371,17,4371,18,0],[4372,21,4372,74,0],[4373,21,4373,22,0],[4374,25,4374,98,0],[4376,21,4376,82,0],[4377,21,4377,22,0],[4378,25,4378,109,0],[4380,17,4380,18,0],[4384,17,4384,34,0],[4386,17,4386,77,0],[4387,21,4388,81,0],[4390,21,4391,76,0],[4393,17,4393,67,0],[4395,17,4395,36,0],[4396,21,4397,177,0],[4398,22,4398,41,0],[4399,21,4400,129,0],[4401,13,4401,14,0],[4402,9,4402,10,0]]);
    </script>
  </body>
</html>