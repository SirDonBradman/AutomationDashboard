<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Platform UI\Modules\Services\RenderService.asmx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Data.Common;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.Services;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Xml;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core.AbstractModels;
using Aurigo.AMP3.Core.BusinessLayer.BL;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.AMP3.DocumentManagementBL;
using Aurigo.AMP3.DocumentManagementDTO;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.AMP3.ProjectBL;
using Aurigo.AMP3.ProjectDTO;
using Aurigo.AMP3.UserManagementBL;
using Aurigo.Brix.Platform.BusinessLayer.AbstractModels;
using Aurigo.Brix.Platform.BusinessLayer.BL;
using Aurigo.Brix.Platform.BusinessLayer.DTO;
using Aurigo.Brix.Platform.BusinessLayer.XmlForm_Framework;
using Aurigo.Brix.Platform.BusinessLayer.XMLForm;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.Brix.ReportServerHelper;

namespace AurigoWebServer
{

    #region webservice data structures

    // ReSharper disable InconsistentNaming

    public class TaskInfo
    {
        public string ModuleName { get; set; }
        public string ProjectName { get; set; }
        public int MapID { get; set; }
        public int FormInstanceID { get; set; }
        public string WorkflowInstanceGuid { get; set; }
        public string FormID { get; set; }
        public string FormKey { get; set; }
        public bool IsCompleted { get; set; }
        public string CurrentStatus { get; set; }
        public string CurrentRole { get; set; }
        public DateTime Date { get; set; }
        public int PID { get; set; }
        public int ParentID { get; set; }
        public DateTime DueDate { get; set; }
        public string FormStatus { get; set; }
        public string RoutedTo { get; set; }
        public string AssociatedModuleID { get; set; }
        public string AssociatedContext { get; set; }
        public int RowNum { get; set; }
        public string EditPageUrl { get; set; }
    }

    public class ItemInfo
    {
        public string Name { get; set; }
        public int Id { get; set; }
        public string StandardItemNumber { get; set; }
        public float Quantity { get; set; }
        public string Unit { get; set; }
        public float UnitPrice { get; set; }

        public ItemInfo[] SubItems { get; set; }
    }

    public class ProjectInfo
    {
        public string Name { get; set; }
        public int Id { get; set; }
        public string Description { get; set; }
        public string Code { get; set; }
        public string Owner { get; set; }
        //public string Status { get; set; }
        public string Picture { get; set; }

        public ProjectInfo[] SubProjects { get; set; }
    }

    public class ContactInfo
    {
        public string Identifier { get; set; }
        public string Name { get; set; }
        public string Phone { get; set; }
    }

    public class DateInfo
    {
        public string Identifier { get; set; }
        public DateTime Date { get; set; }
    }

    public class ProjectDetails
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public string Code { get; set; }
        public string Description { get; set; }
        public string Status { get; set; }
        public string Owner { get; set; }
        public bool Active { get; set; }
        public string Picture { get; set; }
        public int RootFolderId { get; set; }
        public ContactInfo[] KeyContacts { get; set; }
        public DateInfo[] KeyDates { get; set; }
        public string DashboardPicture { get; set; }
    }

    public class DocumentInfo
    {
        public string Name { get; set; }
        public string Url { get; set; }
        public int Id { get; set; } // either folder id or docId
        public string DocStorageId { get; set; }
        public int ParentId { get; set; }
        public bool isDirectory { get; set; }
        public string mimetype { get; set; }
        public string description { get; set; }
        public DocumentInfo[] Items { get; set; }
        public string Permission { get; set; }
    }

    public class FormInfo
    {
        public string ModuleID { get; set; }
        public string Description { get; set; }
        public string UrlNew { get; set; }
    }

    public class RowInfo
    {
        public int primaryKey { get; set; }
        public string[] columnData { get; set; }
    }


    public class ColumnInfo
    {
        public string ColumnName { get; set; }
        public string Key { get; set; }
        public double PercentWidth { get; set; }
    }

    public class FormInstances
    {
        public string ModuleID { get; set; }
        public string Description { get; set; }
        public ColumnInfo[] Columns { get; set; }
        public RowInfo[] Rows { get; set; }
    }

    public class RoleInfo
    {
        public int Id { get; set; }
        public string Name { get; set; }

        public RoleInfo()
        {
        }

        public RoleInfo(int id, string name)
        {
            this.Id = id;
            this.Name = name;
        }
    }

    public class DocumentTypeInfo
    {
        public int Id { get; set; }
        public string Name { get; set; }

        public DocumentTypeInfo()
        {
        }

        public DocumentTypeInfo(int id, string name)
        {
            this.Id = id;
            this.Name = name;
        }
    }

    // ReSharper restore InconsistentNaming

    #endregion

    /// &lt;summary&gt;
    /// Summary description for Service1
    /// &lt;/summary&gt;
    [WebService(Namespace = &quot;http://tempuri.org/&quot;)]
    [WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]
    [ToolboxItem(false)]
    public class RenderService : WebService
    {
        #region private functions

        private readonly ProjectManager _blInstance = ProjectManager.Instance;


        private string[] ReturnErrorArray()
        {
            string[] error = new string[1];
            error[0] = &quot;The specified module doesn&#39;t exist&quot;;
            return error;
        }

        private DataSet ExecuteSqlCommand(string sql)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetSqlStringCommand(sql);
                DataSet ds = conn.DB.ExecuteDataSet(cmd);

                return ds;
            }
        }

        private void AddDate(List&lt;DateInfo&gt; localDates, string identifier, DateTime localDate)
        {
            DateInfo di = new DateInfo { Identifier = identifier, Date = localDate };

            localDates.Add(di);
        }

        private void AddContact(List&lt;ContactInfo&gt; localContacts, string identifier, string name, string phone)
        {
            ContactInfo ci = new ContactInfo { Identifier = identifier, Name = name, Phone = phone };

            localContacts.Add(ci);
        }


        private static string ToAbsoluteUrl(string relativeUrl)
        {
            if (string.IsNullOrEmpty(relativeUrl))
                return relativeUrl;
            if (HttpContext.Current == null)
                return relativeUrl;
            if (relativeUrl.StartsWith(&quot;/&quot;))
                relativeUrl = relativeUrl.Insert(0, &quot;~&quot;);
            if (!relativeUrl.StartsWith(&quot;~/&quot;))
                relativeUrl = relativeUrl.Insert(0, &quot;~/&quot;);

            var url = HttpContext.Current.Request.Url;
            var port = url.Port != 80 ? (&quot;:&quot; + url.Port) : String.Empty;
            return string.Format(&quot;{0}://{1}{2}{3}&quot;, url.Scheme, url.Host, port,
                VirtualPathUtility.ToAbsolute(relativeUrl));
        }

        private string GetPictureUrl(int id, string moduleId)
        {
            string xmlStr = new Album().GenerateDataXml(id, moduleId);
            if (string.IsNullOrWhiteSpace(xmlStr))
                return string.Empty;

            DataSet picturesset = new BrixDataSet();
            using (var sRd = new StringReader(xmlStr))
                picturesset.ReadXml(sRd);

            if (picturesset.Tables.Count &gt; 0 &amp;&amp; picturesset.Tables[0].Rows.Count &gt; 0)
            {
                DataRow dr = picturesset.Tables[0].Rows[0];
                string src = ToAbsoluteUrl(dr[&quot;ImageUrl&quot;].ToString());

                return src;
            }

            return string.Empty;
        }


        private string GetDashboardPicture(int id, int subId)
        {
            ReportHelper.Instance.Connect(ReportManager.Instance.GetSettings());

            string relativeFile = &quot;~/Modules/UploadedFiles/DashboardImage&quot; + Guid.NewGuid() + &quot;.tiff&quot;;
            string physFile = Context.Request.MapPath(relativeFile);

            Dictionary&lt;string, string&gt; parameters = new Dictionary&lt;string, string&gt;();
            parameters.Add(&quot;BRIX_PROJECT_ID&quot;, id.ToString());
            parameters.Add(&quot;PID&quot;, id.ToString());
            parameters.Add(&quot;BRIX_PROJECT_ID2&quot;, subId.ToString());
            parameters.Add(&quot;ContractID&quot;, subId.ToString());

            ReportHelper.Instance.RenderReportToJpeg(parameters, physFile);
            return (relativeFile);
        }

        private ProjectDetails GetContractDetails(int id, int subId)
        {
            ProjectDetails pd;

            Folder rootfolder = DocumentManager.Instance.GetInstanceRootFolder(subId, &quot;CONTMGT&quot;);

            string sql =
                &quot;select *, (select cs.Name from CONTMGTStatus cs where cm.StatusID = cs.ID) as StatusName from CONTMGTMaster cm &quot; +
                &quot; inner join CONTMGTKeyContacts kc on &quot; +
                &quot; kc.ContractID = cm.ID &quot; +
                &quot; inner join CONTMGTKeyDates KD on &quot; +
                &quot; KD.ContractID = cm.ID &quot; +
                &quot; where cm.ID = &quot; + subId;
            DataSet ds = ExecuteSqlCommand(sql);

            if (ds.Tables.Count == 1 &amp;&amp; ds.Tables[0].Rows.Count == 1)
            {
                DataRow dr = ds.Tables[0].Rows[0];
                pd = new ProjectDetails
                {
                    Name = dr[&quot;Name&quot;].ToString(),
                    Code = dr[&quot;Code&quot;].ToString(),
                    Description = dr[&quot;DESC&quot;].ToString(),
                    Status = dr[&quot;StatusName&quot;].ToString(),
                    Active = true,
                    Id = dr[&quot;ID&quot;].ToInt32_2(),
                    Owner = string.Empty,
                    RootFolderId = rootfolder == null ? 0 : rootfolder.FolderId
                };

                pd.DashboardPicture = ToAbsoluteUrl(GetDashboardPicture(id, subId));

                pd.Picture = GetPictureUrl(id, &quot;CONTMGT&quot;);

                // normalize the contact butllshit
                List&lt;ContactInfo&gt; localConctacts = new List&lt;ContactInfo&gt;();
                if (!string.IsNullOrWhiteSpace(dr[&quot;ProjectEngg&quot;].ToString()))
                    AddContact(localConctacts, &quot;Project Engineer&quot;, dr[&quot;ProjectEngg&quot;].ToString(), &quot;312 645-2132&quot;);
                if (!string.IsNullOrWhiteSpace(dr[&quot;ResidentEngg&quot;].ToString()))
                    AddContact(localConctacts, &quot;Resident Engineer&quot;, dr[&quot;ResidentEngg&quot;].ToString(), &quot;312 825-4433&quot;);
                if (!string.IsNullOrWhiteSpace(dr[&quot;ContAdmin&quot;].ToString()))
                    AddContact(localConctacts, &quot;Contract Admin&quot;, dr[&quot;ContAdmin&quot;].ToString(), &quot;312 645-3322&quot;);
                pd.KeyContacts = localConctacts.ToArray();

                // normalize all of the date bullshit
                DateTime localDate;
                List&lt;DateInfo&gt; localDates = new List&lt;DateInfo&gt;();
                if (DateTime.TryParse(dr[&quot;StartDt&quot;].ToString(), out localDate)) AddDate(localDates, &quot;Start&quot;, localDate);
                if (DateTime.TryParse(dr[&quot;ClosureDt&quot;].ToString(), out localDate)) AddDate(localDates, &quot;End&quot;, localDate);
                if (DateTime.TryParse(dr[&quot;NPD&quot;].ToString(), out localDate))
                    AddDate(localDates, &quot;Notice to Proceed&quot;, localDate);
                if (DateTime.TryParse(dr[&quot;CSD&quot;].ToString(), out localDate))
                    AddDate(localDates, &quot;Construction Start&quot;, localDate);
                if (DateTime.TryParse(dr[&quot;OTD&quot;].ToString(), out localDate))
                    AddDate(localDates, &quot;Open to Traffic&quot;, localDate);
                if (DateTime.TryParse(dr[&quot;CWD&quot;].ToString(), out localDate))
                    AddDate(localDates, &quot;Work Completed&quot;, localDate);
                if (DateTime.TryParse(dr[&quot;CCD&quot;].ToString(), out localDate))
                    AddDate(localDates, &quot;Closed (Final)&quot;, localDate);
                pd.KeyDates = localDates.ToArray();

                return pd;
            }

            return null;
        }

        private ProjectDetails GetProjectDetails(int id)
        {
            ProjectDetails pd;
            DateInfo di;

            Project proj = _blInstance.GetProjectDetails(id);

            pd = new ProjectDetails
            {
                Id = proj.ProjectID,
                Name = proj.ProjectName,
                Code = proj.ProjectCode,
                Description = proj.ProjectDescription,
                Status = proj.ProjectStatusName,
                Owner = proj.ProjectOwner,
                Active = proj.ProjectIsActive,
            };

            Folder rootfolder = null;

            //If the project is in the simple project mode then the root folder is the first contracts root folder
            if (AMP3ApplicationSettings.Instance.IsSingleProjectMode)
            {
                //Get the contract id
                object objContId =
                    ComponentHelper.Instance.ExecuteScalar(&quot;select top 1 ID from CONTMGTMaster where ProjectID = {0}&quot;, id);
                if (objContId != null)
                    rootfolder = DocumentManager.Instance.GetInstanceRootFolder(objContId.ToInt32_2(), &quot;CONTMGT&quot;);
            }
            else
                rootfolder = DocumentManager.Instance.GetInstanceRootFolder(id, &quot;PROJECT&quot;);

            pd.RootFolderId = rootfolder == null ? 0 : rootfolder.FolderId;

            pd.Picture = GetPictureUrl(id, &quot;PROJECT&quot;);

            pd.KeyDates = new DateInfo[2];
            di = new DateInfo();

            di.Identifier = &quot;Start&quot;;
            di.Date = proj.ProjectStartDate;
            pd.KeyDates[0] = di;

            di.Identifier = &quot;End&quot;;
            di.Date = proj.ProjectEndDate;
            pd.KeyDates[1] = di;

            return pd;
        }


        private void GetProjectDocumentsRecursive(int projectId, DocumentInfo parent, int folderId,
            List&lt;DocumentInfo&gt; items, bool showSystemFolders)
        {
            DataTable dt = DocumentManager.Instance.GetDocumentList(folderId, UserDetail.GetCurrentUserDetail().UID);
            if (dt != null)
            {
                foreach (DataRow dr in dt.Rows)
                {
                    DocumentInfo di = new DocumentInfo();
                    di.Name = dr[&quot;DocName&quot;].ToString();
                    di.Id = (int)dr[&quot;DocId&quot;];
                    di.DocStorageId = dr[&quot;StorageId&quot;].ToString();
                    di.isDirectory = false;
                    di.description = dr[&quot;DocDesc&quot;].ToString();
                    di.mimetype = DocumentManager.Instance.GetMIMEType((int)dr[&quot;TypeId&quot;]);
                    di.Url = ToAbsoluteUrl(&quot;~/Modules/LIBRARY/GenerateFile.aspx&quot;) + &quot;?DocID=&quot; + di.Id;
                    items.Add(di);
                }
            }

            Dictionary&lt;int, Folder&gt; FolderObj = DocumentManager.Instance.GetSubfolders(null, null, folderId);
            foreach (KeyValuePair&lt;int, Folder&gt; kvp in FolderObj)
            {
                Folder f = kvp.Value as Folder;
                if (f != null)
                {
                    if (showSystemFolders || (!showSystemFolders &amp;&amp; string.IsNullOrEmpty(f.ParentModuleId)))
                    {
                        var permissions =
                            Aurigo.AMP3.DocumentManagementBL.DocumentManager.Instance.GetPermissions(projectId,
                                f.FolderId);
                        DocumentInfo di = new DocumentInfo();
                        di.Name = f.FolderName;
                        di.Id = f.FolderId;
                        di.DocStorageId = f.FolderDesc;
                        di.isDirectory = true;
                        di.ParentId = f.ParentId;
                        di.description = f.FolderDesc;
                        di.Url = String.Empty;
                        if (permissions.Contains(&quot;Upload&quot;))
                        {
                            di.Permission = &quot;&lt;Info&gt;&lt;Permission&gt;Upload&lt;/Permission&gt;&lt;/Info&gt;&quot;;
                        }
                        if (permissions.Contains(&quot;Visibility&quot;))
                        {
                            items.Add(di);
                        }

                        List&lt;DocumentInfo&gt; subItems = new List&lt;DocumentInfo&gt;();
                        GetProjectDocumentsRecursive(projectId, di, di.Id, subItems, showSystemFolders);
                        di.Items = subItems.ToArray();
                    }
                }
            }
        }

        #endregion

        public string[] DataSourceFilters
        {
            get
            {
                var filter = new string[4];
                filter[0] = &quot;IsCompleted&quot;;
                filter[1] = &quot;PID&quot;;
                filter[2] = &quot;CurrentRole&quot;;
                filter[3] = &quot;ParentID&quot;;
                return filter;
            }
        }

        public DataTable GetTasks(int id, int subId)
        {
            string filter;
            int currentPage = 0;
            int count = 0;

            UserDetail ud = UserDetail.GetCurrentUserDetail();
            if (ud != null)
            {
                filter =
                    string.Format(
                        &quot; ShowInMyTasks = 1 AND (PID = 0 OR PID IN (SELECT P.ProjectId FROM PROJECTProjectUser P WHERE P.UserId = {0} and P.RoleId = {1} and P.IsPrimary=1)) &quot;,
                        ud.UID, ud.RID);

                Dictionary&lt;string, string&gt; filterswithvalues = new Dictionary&lt;string, string&gt;();
                filterswithvalues.Add(&quot;IsCompleted&quot;, &quot;0&quot;);
                filterswithvalues.Add(&quot;CurrentRole&quot;, ud.RoleName);
                if (subId != -1)
                    filterswithvalues.Add(&quot;ParentID&quot;, subId.ToString());
                else
                    filterswithvalues.Add(&quot;ParentID&quot;, &quot;&quot;);

                filterswithvalues.Add(&quot;PID&quot;, id.ToString());

                return CoreDatabaseHelper.GetODSData(&quot;vw_WorkflowFormMapping&quot;, 99999, &quot;MAPID&quot;, filter, false,
                    ref currentPage, out count, null, filterswithvalues).Tables[0];
            }

            return new DataTable();
        }

        [WebMethod(EnableSession = true)]
        public TaskInfo[] GetTaskList(int id, int subId)
        {
            List&lt;TaskInfo&gt; tasklist = new List&lt;TaskInfo&gt;();

            DataTable table = GetTasks(id, subId);

            foreach (DataRow dr in table.Rows)
            {
                TaskInfo ti = new TaskInfo();

                ti.ModuleName = (string)dr[&quot;ModuleName&quot;];
                ti.ProjectName = (string)dr[&quot;ProjectName&quot;];
                ti.MapID = (int)dr[&quot;MapID&quot;];
                ti.FormInstanceID = (int)dr[&quot;FormInstanceID&quot;];
                ti.WorkflowInstanceGuid = (string)dr[&quot;WorkflowInstanceGuid&quot;];
                ti.FormID = (string)dr[&quot;FormID&quot;];
                ti.FormKey = dr[&quot;FormKey&quot;].ToString();
                ti.IsCompleted = (bool)dr[&quot;IsCompleted&quot;];
                ti.CurrentStatus = (string)dr[&quot;CurrentStatus&quot;];
                ti.CurrentRole = (string)dr[&quot;CurrentRole&quot;];
                ti.Date = (DateTime)dr[&quot;Date&quot;];
                ti.PID = (int)dr[&quot;PID&quot;];
                ti.ParentID = (int)dr[&quot;ParentID&quot;];
                if (!string.IsNullOrWhiteSpace(dr[&quot;DueDate&quot;].ToString()))
                    ti.DueDate = (DateTime)dr[&quot;DueDate&quot;];
                if (!string.IsNullOrWhiteSpace(dr[&quot;FormStatus&quot;].ToString()))
                    ti.FormStatus = (string)dr[&quot;FormStatus&quot;];
                if (!string.IsNullOrWhiteSpace(dr[&quot;RoutedTo&quot;].ToString()))
                    ti.RoutedTo = (string)dr[&quot;RoutedTo&quot;];
                if (!string.IsNullOrWhiteSpace(dr[&quot;AssociatedModuleID&quot;].ToString()))
                    ti.AssociatedModuleID = (string)dr[&quot;AssociatedModuleID&quot;];
                if (!string.IsNullOrWhiteSpace(dr[&quot;AssociatedContext&quot;].ToString()))
                    ti.AssociatedContext = (string)dr[&quot;AssociatedContext&quot;];

                string moduleid;
                ListModel lstModel = null;

                try
                {
                    if (string.IsNullOrEmpty(ti.AssociatedContext))
                    {
                        moduleid = ti.FormID;
                        lstModel = ListModel.GetXMLInstance(moduleid, null, null, null);
                    }
                    else
                    {
                        moduleid = ti.AssociatedContext;
                        lstModel = ListModel.GetInstance(moduleid, null, null, null);
                    }
                }
                catch
                {
                    lstModel = null;
                    moduleid = null;
                }

                if (moduleid != null &amp; lstModel != null)
                {
                    Uri r = Context.Request.Url;
                    string strUrl =
                        lstModel.GetEditPageURL(ti.PID.ToString(), ti.ParentID.ToString(), ti.FormInstanceID.ToString(),
                            moduleid) + &quot;&amp;nt=1&quot;;
                    strUrl = strUrl.TrimStart(&#39;~&#39;);

                    UriBuilder response = new UriBuilder(r.Scheme, r.Host, r.Port, strUrl);
                    ti.EditPageUrl = response.ToString();
                    tasklist.Add(ti);
                }
            }

            return tasklist.ToArray();
        }

        [WebMethod(EnableSession = true)]
        public DocumentInfo[] GetProjectDocuments(int projectId, int folderId)
        {
            DocumentInfo root = new DocumentInfo();
            root.Id = folderId;
            root.Name = &quot;Documents&quot;;
            root.isDirectory = true;
            List&lt;DocumentInfo&gt; items = new List&lt;DocumentInfo&gt;();
            List&lt;string&gt; permissionList =
                Aurigo.AMP3.DocumentManagementBL.DocumentManager.Instance.GetPermissions(projectId, folderId);
            if (permissionList.Contains(&quot;Upload&quot;))
            {
                root.Permission = &quot;&lt;Info&gt;&lt;Permission&gt;Upload&lt;/Permission&gt;&lt;/Info&gt;&quot;;
            }

            bool showSystemFolders = true;
            List&lt;string&gt; ModuleComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);
            if (ModuleComponents.Contains(&quot;HideSystemFolderInTree&quot;))
                showSystemFolders = false;
            GetProjectDocumentsRecursive(projectId, root, folderId, items, showSystemFolders);
            root.Items = items.ToArray();

            return new[] { root };
        }

        [WebMethod(EnableSession = true)]
        public bool DeleteProjectDocument(int docId, string storageId)
        {
            DocumentManager.Instance.DeleteDocument(docId, storageId);
            return true;
        }

        [WebMethod(EnableSession = true)]
        public bool AddProjectDocument(int folderId, string fileName, byte[] fileData, string mimetype)
        {
            UserDetail ud = UserDetail.GetCurrentUserDetail();
            if (ud != null)
                DocumentManager.Instance.SaveDocument(folderId, fileName, fileData, ud.UID,
                    ud.FirstName + (string.IsNullOrEmpty(ud.MiddleName) ? &quot;&quot; : &quot; &quot; + ud.MiddleName) +
                    (string.IsNullOrEmpty(ud.LastName) ? &quot;&quot; : &quot; &quot; + ud.LastName), DateTime.UtcNow, string.Empty);

            return true;
        }


        [WebMethod(EnableSession = true)]
        public ProjectDetails GetProcjectDetails(int id, int subId)
        {
            if (subId &gt; 0)
                return GetContractDetails(id, subId);

            return GetProjectDetails(id);
        }


        private const string ContractInfoSQL = &quot;select &quot; +
                                               &quot; a.ID as ContractId &quot; +
                                               &quot;, a.Name as Contract &quot; +
                                               &quot;, a.Code &quot; +
                                               &quot;, (select b.Name from CONTMGTStatus b where a.StatusID = ID) as Status &quot; +
                                               &quot;, ISNULL(a.[Desc], &#39;&#39;) as Description &quot; +
                                               &quot;from CONTMGTMaster a &quot; +
                                               &quot;where ProjectID = {0}&quot;;

        DataTable GetContracts(int projectId)
        {
            //string sql = string.Format(ContractInfoSQL, projectId);
            try
            {
                DataSet ds = ComponentHelper.Instance.ExecuteDataSet(ContractInfoSQL, projectId);
                if (ds != null &amp;&amp; ds.Tables.Count &gt; 0)
                    return ds.Tables[0];
            }
            catch
            {
            }

            return null;
        }

        [WebMethod(EnableSession = true)]
        public ProjectInfo[] GetPermissionedProjects()
        {
            UserDetail ud = UserDetail.GetCurrentUserDetail();
            List&lt;ProjectInfo&gt; projectList = new List&lt;ProjectInfo&gt;();

            if (ud == null)
                return projectList.ToArray();

            DataTable projectDt = ProjectManager.Instance.GetProjectsWithFeaturePermission(ud.UID, ud.RID,
                Constants.MODFEAT_VISIBILITY,
                ProjectConstants.
                    MODID_PROJECT, 0, 99999,
                null, null, null);
            foreach (DataRow dr in projectDt.Rows)
            {
                ProjectInfo pi = new ProjectInfo();
                pi.Name = dr[&quot;ProjectName&quot;].ToString();
                pi.Code = dr[&quot;ProjectCode&quot;].ToString();
                pi.Id = dr[&quot;ProjectId&quot;].ToInt32_2();
                pi.Owner = dr[&quot;Owner&quot;].ToString();
                //pi.Status = dr[&quot;StatusName&quot;].ToString();

                pi.Picture = GetPictureUrl(pi.Id, &quot;PROJECT&quot;);

                ProjectDetails pd = GetProcjectDetails(pi.Id, 0);
                pi.Description = pd.Description;

                projectList.Add(pi);
            }

            foreach (ProjectInfo pi in projectList)
            {
                DataTable dTable = GetContracts(pi.Id);
                if (dTable != null)
                {
                    List&lt;ProjectInfo&gt; subProjects = new List&lt;ProjectInfo&gt;();

                    foreach (DataRow dr in dTable.Rows)
                    {
                        ProjectInfo subpi = new ProjectInfo();
                        subpi.Id = dr[&quot;ContractId&quot;].ToInt32_2();
                        subpi.Name = dr[&quot;Contract&quot;].ToString();
                        subpi.Code = dr[&quot;Code&quot;].ToString();
                        //subpi.Status = dr[&quot;Status&quot;].ToString();
                        subpi.Description = dr[&quot;Description&quot;].ToString();
                        subpi.Picture = GetPictureUrl(subpi.Id, &quot;CONTMGT&quot;);

                        subProjects.Add(subpi);
                    }

                    pi.SubProjects = subProjects.ToArray();
                }
            }

            return projectList.ToArray();
        }

        [WebMethod(EnableSession = true)]
        public ProjectInfo[] GetProjects(int roleId)
        {
            List&lt;ProjectInfo&gt; projectList = new List&lt;ProjectInfo&gt;();
            UserDetail ud = UserDetail.GetCurrentUserDetail();

            if (ud == null)
                return projectList.ToArray();

            DataTable dt = ProjectManager.Instance.GetProjectsWithContract(null, roleId, ud.UID);
            foreach (DataRow dr in dt.Rows)
            {
                ProjectInfo pi = new ProjectInfo();
                pi.Name = dr[&quot;ProjectName&quot;].ToString();
                pi.Code = dr[&quot;ProjectCode&quot;].ToString();
                pi.Id = dr[&quot;ProjectId&quot;].ToInt32_2();
                pi.Owner = dr[&quot;Owner&quot;].ToString();
                pi.Picture = GetPictureUrl(pi.Id, &quot;PROJECT&quot;);

                //ProjectDetails pd = GetProcjectDetails(pi.Id, 0);
                //pi.Description = pd.Description;

                List&lt;ProjectInfo&gt; subProjects = new List&lt;ProjectInfo&gt;();
                ProjectInfo subpi = new ProjectInfo();
                subpi.Id = dr[&quot;ContractId&quot;].ToInt32_2();
                subProjects.Add(subpi);
                pi.SubProjects = subProjects.ToArray();
                projectList.Add(pi);
            }

            return projectList.ToArray();
        }

        UserDetail BuildUserDetailHack(string userId)
        {
            Hashtable user = UserManager.Instance.GetUserHT(userId);
            var ud = new UserDetail();

            ud.FirstName = user[&quot;FirstName&quot;].ToString2();
            ud.MiddleName = user[&quot;MiddleName&quot;].ToString2();
            ud.LastName = user[&quot;LastName&quot;].ToString2();

            //create a hash table with all session values
            string fullname = user[&quot;FirstName&quot;].ToString2()
                              + ((!String.IsNullOrEmpty(user[&quot;MiddleName&quot;].ToString2()))
                                  ? &quot; &quot; + user[&quot;MiddleName&quot;].ToString2()
                                  : &quot;&quot;)
                              + ((!String.IsNullOrEmpty(user[&quot;LastName&quot;].ToString2()))
                                  ? &quot; &quot; + user[&quot;LastName&quot;].ToString2()
                                  : &quot;&quot;);

            ud.UID = Convert.ToInt32(user[&quot;UID&quot;], CultureInfo.CurrentCulture);
            ud.RID = Constants.USRMGMT_USER_RID;

            Dictionary&lt;int, string&gt; userRolesObj = UserManager.Instance.GetAssignedRolesOfUser(ud.UID);
            foreach (var role in userRolesObj)
            {
                ud.RID = role.Key;
                ud.RoleName = role.Value;
                break;
            }

            ud.UserName = fullname;
            ud.UserID = user[&quot;UserID&quot;].ToString2();
            ud.Email = user[&quot;Email&quot;].ToString2();
            ud.CertificateNo = user[&quot;CertNo&quot;].ToString2();

            return ud;
        }


        /// &lt;summary&gt;
        /// Authinticates user based on input Masterwork&#39;s UserName and Password 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;userName&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;password&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        [WebMethod(EnableSession = true)]
        public string Login(string userName, string password)
        {
            List&lt;string&gt; USRMGMTComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_USRMGMT);
            int ADAuthentication = (USRMGMTComponents.Contains(&quot;ADAuthentication&quot;)) ? 1 : 0;
            int status = UserManager.Instance.ValidateUser(userName, password.Trim(), ADAuthentication);
            if (status &gt; 0)
            {
                FormsAuthentication.SetAuthCookie(userName, true);
                UserDetail ud = BuildUserDetailHack(userName);
                string userInfo = &quot;&lt;user&gt;&lt;uid&gt;&quot; + ud.UID + &quot;&lt;/uid&gt;&quot; + &quot;&lt;name&gt;&quot; + ud.UserName + &quot;&lt;/name&gt;&lt;/user&gt;&quot;;

                byte[] toEncodeAsBytes = System.Text.Encoding.UTF8.GetBytes(userInfo);
                userInfo = System.Convert.ToBase64String(toEncodeAsBytes);

                Context.Response.SetCookie(new HttpCookie(UserDetail.USRMGMT_USERDETAIL, Server.HtmlEncode(userInfo)));

                // Setup Session Variables
                Session.Remove(&quot;LoginCount&quot;);
                Session.Remove(&quot;UID&quot;);
                Session.Add(UserDetail.USRMGMT_USERDETAIL, ud);

                return (userInfo);
            }

            return string.Empty;
        }

        private string GetString(byte[] bytes)
        {
            char[] chars = new char[bytes.Length / sizeof(char)];
            System.Buffer.BlockCopy(bytes, 0, chars, 0, bytes.Length);
            return new string(chars);
        }


        /// &lt;summary&gt;
        /// Get available roles based on input User-ID  
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;userName&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;password&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        [WebMethod(EnableSession = true)]
        public RoleInfo[] GetRoles()
        {
            List&lt;RoleInfo&gt; roleInfoList = new List&lt;RoleInfo&gt;();
            UserDetail ud = UserDetail.GetCurrentUserDetail();

            if (ud == null)
                roleInfoList.ToArray();

            Dictionary&lt;int, string&gt; roles = UserManager.Instance.GetAssignedRolesOfUser(ud.UID);
            if (roles != null)
            {
                roles.Keys.ForEach(x =&gt; roleInfoList.Add(new RoleInfo(x, roles[x])));
            }

            return roleInfoList.ToArray();
        }

        /// &lt;summary&gt;
        /// Get available roles based on input User-ID  
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;userName&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;password&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        [WebMethod(EnableSession = true)]
        public DocumentTypeInfo[] GetDocumentTypes()
        {
            List&lt;DocumentTypeInfo&gt; documentTypeInfoList = new List&lt;DocumentTypeInfo&gt;();
            UserDetail ud = UserDetail.GetCurrentUserDetail();

            if (ud == null)
                return documentTypeInfoList.ToArray();

            Dictionary&lt;int, string&gt; documentTypes = DocumentManager.Instance.GetDocumentTypes();
            if (documentTypes != null)
            {
                documentTypes.Keys.ForEach(x =&gt; documentTypeInfoList.Add(new DocumentTypeInfo(x, documentTypes[x])));
            }

            return documentTypeInfoList.ToArray();
        }


        [WebMethod(EnableSession = true)]
        public string GetFormNewPath(string moduleId)
        {
            Uri r = Context.Request.Url;

            UriBuilder response = new UriBuilder(r.Scheme, r.Host, r.Port,
                &quot;/Common/BrixForm.aspx?Context=&quot; + moduleId + &quot;&amp;PID=1&quot; + &quot;&amp;ParentID=1&amp;Mode=New&quot;);
            return response.ToString();
        }

        [WebMethod]
        public string[] GetRenderFormats()
        {
            string[] types = Enum.GetNames(typeof(RenderFormat));

            return types;
        }

        [WebMethod]
        public XmlDocument GetForms()
        {
            DataSet ds =
                ComponentHelper.Instance.ExecuteDataSet(RenderServiceProcedure.usp_MODMGMTModulesGetModuleDescription,
                    null);
            ds.DataSetName = &quot;Forms&quot;;
            if (ds.Tables.Count &gt; 0)
                ds.Tables[0].TableName = &quot;Form&quot;;

            ds.Tables[0].Columns.Add(&quot;FilePath&quot;);

            XmlDocument xmlDoc = new XmlDocument();
            xmlDoc.LoadXml(ds.GetXml());
            return xmlDoc;
        }

        [WebMethod]
        public FormInfo[] GetFormInformation()
        {
            List&lt;FormInfo&gt; forms = new List&lt;FormInfo&gt;();

            DataSet ds =
                ComponentHelper.Instance.ExecuteDataSet(RenderServiceProcedure.usp_MODMGMTModulesGetModuleDescription,
                    null);

            foreach (DataRow dr in ds.Tables[0].Rows)
            {
                FormInfo fi = new FormInfo();

                fi.Description = dr[&quot;ModuleDescription&quot;].ToString();
                fi.ModuleID = dr[&quot;ModuleID&quot;].ToString();


                fi.UrlNew = GetFormNewPath(fi.ModuleID);
                forms.Add(fi);
            }

            return forms.ToArray();
        }

        protected void ProcessUserColumnWidths(string moduleId, FormInstances instances)
        {
            UserDetail ud = UserDetail.GetCurrentUserDetail();
            if (ud == null)
                return;
            IEnumerable&lt;ColumnResizeSettings&gt; table = ColumnSettingManager.Instance.GetResizedColumns(moduleId, ud.RID,
                ud.UID); // overriden column widths
            if (table == null)
                return;

            ColumnResizeSettings crs = table.FirstOrDefault();
            if (crs == null)
                return;

            string[] settings = crs.Settings.Split(&#39;~&#39;);

            foreach (ColumnInfo column in instances.Columns)
            {
                string setting = Array.Find(settings, s =&gt; s.StartsWith(column.Key));
                if (setting == null)
                    continue;

                string[] keyvalue = setting.Split(&#39;=&#39;);
                if (keyvalue.Count() != 2)
                    continue;

                int width;
                if (!int.TryParse(keyvalue[1], out width))
                    continue;

                column.PercentWidth = width;
                // for now this is an absolute value.  I will respin through the loop and fix this up below
            }

            double totalwidth = instances.Columns.Sum(m =&gt; m.PercentWidth);
            instances.Columns.ForEach(m =&gt; m.PercentWidth = 100 / (totalwidth / m.PercentWidth));
        }


        [WebMethod(EnableSession = true)]
        public FormInstances GetFormInstancesAdvanced(string moduleId, int id, int subId)
        {
            try
            {
                ListModel lm = ListModel.GetXMLInstance(moduleId, null, null, null);
                BrixFormModel model = lm.xmlModel;

                const int pageSize = 10000000;
                int currentPage = 0;
                string sortOrder = model.form.PrimaryKeyName + &quot; DESC&quot;;

                // this probably will crash
                Dictionary&lt;string, string&gt; dicFilters = new Dictionary&lt;string, string&gt;();
                dicFilters.Add(&quot;PID&quot;, id.ToString());
                dicFilters.Add(&quot;ParentId&quot;, subId.ToString());

#if KK
                List&lt;xControl&gt; filters = GetForeignKeyControls(model.form);  // this is the right way to do things, however, these forms rely on Page and the corresponding
                                                                             // request structure to retrieve querystring values.  We have to break that dependancy since i dont
                                                                             // have that from a web service.  Therefore i am hardcoding it as it will mostly be PID and ParentId.
                if (filters.Count &gt; 0)
                {
                    dicFilters = new Dictionary&lt;string, string&gt;();
                    foreach (xControl filterControl in filters)
                        dicFilters.Add(filterControl.Name, filterControl.EvaluateControlValue());
                }
#endif

                int count = 0;
                DataSet ds = CoreDatabaseHelper.GetODSData(model.form.TableName, pageSize, sortOrder, null, true,
                    ref currentPage, out count, dicFilters, null, null, null);
                if (ds.Tables.Count &gt; 0)
                {
                    FormInstances instances = new FormInstances();
                    instances.ModuleID = moduleId;
                    instances.Description = model.form.Header;

                    // this is the hack implementation
                    //instances.Columns = (from DataColumn dc in ds.Tables[0].Columns where dc.ColumnName != &quot;ParentID&quot; &amp;&amp; dc.ColumnName != &quot;PID&quot; select dc.ColumnName).ToArray();

                    // build up the columns for the client and exclude Hidden Fields.
                    // this will work well.
                    DataRow[] visibleColumns = lm.ColumnInfo.Select(&quot;Hidden = &#39;False&#39;&quot;);
                    double totalWidths = visibleColumns.Sum(dr =&gt;
                    {
                        int val = 0;
                        int.TryParse(dr[&quot;ColumnWidth&quot;].ToString(), out val);
                        return val;
                    }); // for percent calculation below.
                    totalWidths = (totalWidths == 0.0) ? 100.0 * visibleColumns.Count() : totalWidths;

                    instances.Columns = new ColumnInfo[visibleColumns.Count()];
                    for (int i = 0; i &lt; visibleColumns.Count(); i++)
                    {
                        instances.Columns[i] = new ColumnInfo();
                        instances.Columns[i].ColumnName = visibleColumns[i][&quot;Caption&quot;].ToString();
                        instances.Columns[i].Key = visibleColumns[i][&quot;Key&quot;].ToString();

                        int val = 0;
                        if (!int.TryParse(visibleColumns[i][&quot;ColumnWidth&quot;].ToString(), out val))
                            val = 100;

                        instances.Columns[i].PercentWidth = 100.0 / (totalWidths / val);
                    }

                    ProcessUserColumnWidths(moduleId, instances);

                    // for each instance of the form build up the data to send back to the client
                    List&lt;RowInfo&gt; rows = new List&lt;RowInfo&gt;();
                    foreach (DataRow dr in ds.Tables[0].Rows)
                    {
                        RowInfo ri = new RowInfo();
                        ri.primaryKey = dr[model.form.PrimaryKeyName].ToInt32_2();

                        List&lt;string&gt; data = new List&lt;string&gt;();
                        for (int i = 0; i &lt; dr.ItemArray.Count(); i++)
                        {
                            if (!instances.Columns.Any(m =&gt; m.Key == ds.Tables[0].Columns[i].ColumnName))
                                continue;

                            object o = dr.ItemArray[i];
                            string s = o.ToString2();
                            data.Add(s);
                        }

                        ri.columnData = data.ToArray();
                        rows.Add(ri);
                    }
                    instances.Rows = rows.ToArray();

                    return instances;
                }
            }
            catch (Exception)
            {
            }

            return null;
        }

        [WebMethod]
        public string[] GetFormInstances(string moduleId)
        {
            //string filePath;
            //if (CheckIfFileExists(moduleId, out filePath))
            //{

            var model = new BrixFormModel(moduleId, moduleId + &quot;.xml&quot;, XMLType.Form, null, null);
            int count;
            const int pageSize = 10000000;
            int currentPage = 0;
            string sortOrder = model.form.PrimaryKeyName + &quot; DESC&quot;;
            DataSet ds = CoreDatabaseHelper.GetODSData(model.form.TableName, pageSize, sortOrder, null, true,
                ref currentPage, out count, null);
            ds.DataSetName = moduleId;
            if (ds.Tables.Count &gt; 0)
            {
                ds.Tables[0].TableName = model.form.TableName;
                string[] retvals = new string[ds.Tables[0].Rows.Count];
                for (int nRow = 0; nRow &lt; ds.Tables[0].Rows.Count; nRow++)
                {
                    DataRow r = ds.Tables[0].Rows[nRow];
                    retvals[nRow] = r[model.form.PrimaryKeyName].ToString();
                }
                return retvals;
            }

            //return ReturnErrorArray();
            //}

            return ReturnErrorArray();
        }


        [WebMethod]
        public XmlDocument GetFormInstanceXML(string moduleId, int primaryKey)
        {
            //string filePath;
            try
            {
                var model = new BrixFormModel(moduleId, moduleId + &quot;.xml&quot;, XMLType.Form, null, null);
                var engine = new XMLRenderingEngine(null, model, null);
                model.form.instanceID = primaryKey.ToString();
                bool isUTC_to_MWDateTime_ConversionRequired = false;
                model.GetFormInstanceData(isUTC_to_MWDateTime_ConversionRequired);
                engine.Render(RenderFormat.RenderXml);
                return (model.form.Renderer as XmlRenderer).MasterDoc;
            }
            catch (Exception ex)
            {
                XmlDocument xmlDoc = new XmlDocument();
                xmlDoc.LoadXml(&quot;&lt;Error&gt;The specified module doesn&#39;t exist&quot; + ex.Message + &quot;&lt;/Error&gt;&quot;);
                return xmlDoc;
            }
        }

        [WebMethod]
        public string GetFormHTML(string moduleId, int primaryKey)
        {
            //string filePath;
            try
            {
                var model = new BrixFormModel(moduleId, moduleId + &quot;.xml&quot;, XMLType.Form, null, null);
                var div = new HtmlGenericControl(&quot;Div&quot;);
                var engine = new XMLRenderingEngine(null, model, div);
                engine.Render(RenderFormat.RenderHtml);

                string result = String.Empty;

                using (StringWriter sw = new StringWriter())
                {
                    HtmlTextWriter tw = new HtmlTextWriter(sw);
                    div.RenderControl(tw);
                    result = sw.ToString();
                }

                return result;
            }
            catch (Exception ex)
            {
                return &quot;The specified module doesn&#39;t exist&quot; + ex.Message;
            }
        }
    }

    public class RenderServiceProcedure : Aurigo.Brix.Platform.BusinessLayer.DataAccessHelper.StoredProcedure
    {
        public static Aurigo.Brix.Platform.BusinessLayer.DataAccessHelper.StoredProcedure
            usp_MODMGMTModulesGetModuleDescription =
                new Aurigo.Brix.Platform.BusinessLayer.DataAccessHelper.StoredProcedure
                {
                    Name = &quot;usp_MODMGMTModulesGetModuleDescription&quot;
                };
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[43,36,43,40,0],[43,41,43,45,0],[44,37,44,41,0],[44,42,44,46,0],[45,28,45,32,0],[45,33,45,37,0],[46,37,46,41,0],[46,42,46,46,0],[47,46,47,50,0],[47,51,47,55,0],[48,32,48,36,0],[48,37,48,41,0],[49,33,49,37,0],[49,38,49,42,0],[50,35,50,39,0],[50,40,50,44,0],[51,39,51,43,0],[51,44,51,48,0],[52,37,52,41,0],[52,42,52,46,0],[53,32,53,36,0],[53,37,53,41,0],[54,26,54,30,0],[54,31,54,35,0],[55,31,55,35,0],[55,36,55,40,0],[56,35,56,39,0],[56,40,56,44,0],[57,36,57,40,0],[57,41,57,45,0],[58,34,58,38,0],[58,39,58,43,0],[59,44,59,48,0],[59,49,59,53,0],[60,43,60,47,0],[60,48,60,52,0],[61,29,61,33,0],[61,34,61,38,0],[62,37,62,41,0],[62,42,62,46,0],[67,30,67,34,0],[67,35,67,39,0],[68,25,68,29,0],[68,30,68,34,0],[69,44,69,48,0],[69,49,69,53,0],[70,33,70,37,0],[70,38,70,42,0],[71,30,71,34,0],[71,35,71,39,0],[72,34,72,38,0],[72,39,72,43,0],[74,38,74,42,0],[74,43,74,47,0],[79,30,79,34,0],[79,35,79,39,0],[80,25,80,29,0],[80,30,80,34,0],[81,37,81,41,0],[81,42,81,46,0],[82,30,82,34,0],[82,35,82,39,0],[83,31,83,35,0],[83,36,83,40,0],[85,33,85,37,0],[85,38,85,42,0],[87,44,87,48,0],[87,49,87,53,0],[92,36,92,40,0],[92,41,92,45,0],[93,30,93,34,0],[93,35,93,39,0],[94,31,94,35,0],[94,36,94,40,0],[99,36,99,40,0],[99,41,99,45,0],[100,32,100,36,0],[100,37,100,41,0],[105,25,105,29,0],[105,30,105,34,0],[106,30,106,34,0],[106,35,106,39,0],[107,30,107,34,0],[107,35,107,39,0],[108,37,108,41,0],[108,42,108,46,0],[109,32,109,36,0],[109,37,109,41,0],[110,31,110,35,0],[110,36,110,40,0],[111,30,111,34,0],[111,35,111,39,0],[112,33,112,37,0],[112,38,112,42,0],[113,35,113,39,0],[113,40,113,44,0],[114,44,114,48,0],[114,49,114,53,0],[115,38,115,42,0],[115,43,115,47,0],[116,42,116,46,0],[116,47,116,51,0],[121,30,121,34,0],[121,35,121,39,0],[122,29,122,33,0],[122,34,122,38,0],[123,25,123,29,0],[123,30,123,34,0],[124,38,124,42,0],[124,43,124,47,0],[125,31,125,35,0],[125,36,125,40,0],[126,35,126,39,0],[126,40,126,44,0],[127,34,127,38,0],[127,39,127,43,0],[128,37,128,41,0],[128,42,128,46,0],[129,39,129,43,0],[129,44,129,48,0],[130,36,130,40,0],[130,41,130,45,0],[135,34,135,38,0],[135,39,135,43,0],[136,37,136,41,0],[136,42,136,46,0],[137,32,137,36,0],[137,37,137,41,0],[142,33,142,37,0],[142,38,142,42,0],[143,38,143,42,0],[143,43,143,47,0],[149,36,149,40,0],[149,41,149,45,0],[150,29,150,33,0],[150,34,150,38,0],[151,38,151,42,0],[151,43,151,47,0],[156,34,156,38,0],[156,39,156,43,0],[157,37,157,41,0],[157,42,157,46,0],[158,39,158,43,0],[158,44,158,48,0],[159,33,159,37,0],[159,38,159,42,0],[164,25,164,29,0],[164,30,164,34,0],[165,30,165,34,0],[165,35,165,39,0],[167,9,167,26,0],[168,9,168,10,0],[169,9,169,10,0],[171,9,171,45,0],[172,9,172,10,0],[173,13,173,26,0],[174,13,174,30,0],[175,9,175,10,0],[180,25,180,29,0],[180,30,180,34,0],[181,30,181,34,0],[181,35,181,39,0],[183,9,183,34,0],[184,9,184,10,0],[185,9,185,10,0],[187,9,187,53,0],[188,9,188,10,0],[189,13,189,26,0],[190,13,190,30,0],[191,9,191,10,0],[208,9,208,79,0],[212,9,212,10,0],[213,13,213,44,0],[214,13,214,61,0],[215,13,215,26,0],[216,9,216,10,0],[219,9,219,10,0],[220,20,220,85,0],[221,13,221,14,0],[222,17,222,66,0],[223,17,223,58,0],[225,17,225,27,0],[227,9,227,10,0],[230,9,230,10,0],[231,13,231,86,0],[233,13,233,32,0],[234,9,234,10,0],[237,9,237,10,0],[238,13,238,102,0],[240,13,240,35,0],[241,9,241,10,0],[245,9,245,10,0],[246,13,246,51,0],[247,17,247,36,0],[248,13,248,45,0],[249,17,249,36,0],[250,13,250,45,0],[251,17,251,58,0],[252,13,252,47,0],[253,17,253,59,0],[255,13,255,55,0],[256,13,256,73,0],[257,13,258,61,0],[259,9,259,10,0],[262,9,262,10,0],[263,13,263,71,0],[264,13,264,51,0],[265,17,265,37,0],[267,13,267,53,0],[268,20,268,54,0],[269,17,269,42,0],[271,13,271,86,0],[272,13,272,14,0],[273,17,273,60,0],[274,17,274,71,0],[276,17,276,28,0],[279,13,279,33,0],[280,9,280,10,0],[284,9,284,10,0],[285,13,285,81,0],[287,13,287,103,0],[288,13,288,69,0],[290,13,290,86,0],[291,13,291,62,0],[292,13,292,50,0],[293,13,293,66,0],[294,13,294,60,0],[296,13,296,76,0],[297,13,297,35,0],[298,9,298,10,0],[301,9,301,10,0],[304,13,304,98,0],[306,13,312,43,0],[313,13,313,49,0],[315,13,315,70,0],[316,13,316,14,0],[317,17,317,51,0],[318,17,328,19,0],[330,17,330,85,0],[332,17,332,59,0],[335,17,335,76,0],[336,17,336,78,0],[337,21,337,114,0],[338,17,338,79,0],[339,21,339,116,0],[340,17,340,76,0],[341,21,341,110,0],[342,17,342,59,0],[346,17,346,66,0],[347,17,347,80,0],[347,81,347,121,0],[348,17,348,82,0],[348,83,348,121,0],[349,17,349,76,0],[350,21,350,73,0],[351,17,351,76,0],[352,21,352,74,0],[353,17,353,76,0],[354,21,354,71,0],[355,17,355,76,0],[356,21,356,70,0],[357,17,357,76,0],[358,21,358,70,0],[359,17,359,52,0],[361,17,361,27,0],[364,13,364,25,0],[365,9,365,10,0],[368,9,368,10,0],[372,13,372,62,0],[374,13,383,15,0],[385,13,385,38,0],[388,13,388,70,0],[389,13,389,14,0],[391,17,392,124,0],[393,17,393,39,0],[394,21,394,115,0],[395,13,395,14,0],[397,17,397,92,0],[399,13,399,76,0],[401,13,401,55,0],[403,13,403,43,0],[404,13,404,33,0],[406,13,406,37,0],[407,13,407,45,0],[408,13,408,33,0],[410,13,410,35,0],[411,13,411,43,0],[412,13,412,33,0],[414,13,414,23,0],[415,9,415,10,0],[420,9,420,10,0],[421,13,421,118,0],[422,13,422,28,0],[423,13,423,14,0],[424,17,424,24,0],[424,26,424,36,0],[424,37,424,39,0],[424,40,424,47,0],[425,17,425,18,0],[426,21,426,58,0],[427,21,427,56,0],[428,21,428,46,0],[429,21,429,66,0],[430,21,430,44,0],[431,21,431,63,0],[432,21,432,91,0],[433,21,433,103,0],[434,21,434,35,0],[435,17,435,18,0],[436,13,436,14,0],[438,13,438,110,0],[439,13,439,20,0],[439,22,439,51,0],[439,52,439,54,0],[439,55,439,64,0],[440,13,440,14,0],[441,17,441,48,0],[442,17,442,31,0],[443,17,443,18,0],[444,21,444,109,0],[445,21,445,22,0],[446,25,448,45,0],[449,25,449,62,0],[450,25,450,48,0],[451,25,451,44,0],[452,25,452,56,0],[453,25,453,47,0],[454,25,454,50,0],[455,25,455,55,0],[456,25,456,47,0],[457,25,457,60,0],[458,25,458,26,0],[459,29,459,92,0],[460,25,460,26,0],[461,25,461,64,0],[462,25,462,26,0],[463,29,463,43,0],[464,25,464,26,0],[466,25,466,80,0],[467,25,467,105,0],[468,25,468,55,0],[469,21,469,22,0],[470,17,470,18,0],[471,13,471,14,0],[472,9,472,10,0],[479,13,479,14,0],[480,17,480,44,0],[481,17,481,43,0],[482,17,482,35,0],[483,17,483,43,0],[484,17,484,40,0],[485,17,485,31,0],[486,13,486,14,0],[490,9,490,10,0],[492,13,492,33,0],[493,13,493,27,0],[495,13,495,63,0],[496,13,496,28,0],[497,13,497,14,0],[498,17,501,41,0],[503,17,503,97,0],[504,17,504,59,0],[505,17,505,67,0],[506,17,506,33,0],[507,21,507,73,0],[509,21,509,59,0],[511,17,511,61,0],[513,17,514,84,0],[517,13,517,36,0],[518,9,518,10,0],[522,9,522,10,0],[523,13,523,60,0],[525,13,525,51,0],[527,13,527,20,0],[527,22,527,32,0],[527,33,527,35,0],[527,36,527,46,0],[528,13,528,14,0],[529,17,529,46,0],[531,17,531,58,0],[532,17,532,60,0],[533,17,533,45,0],[534,17,534,63,0],[535,17,535,78,0],[536,17,536,50,0],[537,17,537,55,0],[538,17,538,58,0],[539,17,539,64,0],[540,17,540,60,0],[541,17,541,48,0],[542,17,542,41,0],[543,17,543,51,0],[544,17,544,74,0],[545,21,545,58,0],[546,17,546,77,0],[547,21,547,62,0],[548,17,548,75,0],[549,21,549,58,0],[550,17,550,85,0],[551,21,551,78,0],[552,17,552,84,0],[553,21,553,76,0],[556,17,556,43,0],[559,17,559,18,0],[560,21,560,68,0],[561,21,561,22,0],[562,25,562,46,0],[563,25,563,89,0],[564,21,564,22,0],[566,21,566,22,0],[567,25,567,57,0],[568,25,568,86,0],[569,21,569,22,0],[570,17,570,18,0],[571,17,571,22,0],[572,17,572,18,0],[573,21,573,37,0],[574,21,574,37,0],[575,17,575,18,0],[577,17,577,57,0],[578,17,578,18,0],[579,21,579,49,0],[580,21,582,49,0],[583,21,583,52,0],[585,21,585,92,0],[586,21,586,58,0],[587,21,587,38,0],[588,17,588,18,0],[589,13,589,14,0],[591,13,591,39,0],[592,9,592,10,0],[596,9,596,10,0],[597,13,597,52,0],[598,13,598,32,0],[599,13,599,37,0],[600,13,600,37,0],[601,13,601,65,0],[602,13,603,111,0],[604,13,604,51,0],[605,13,605,14,0],[606,17,606,82,0],[607,13,607,14,0],[609,13,609,43,0],[610,13,610,111,0],[611,13,611,69,0],[612,17,612,43,0],[613,13,613,95,0],[614,13,614,42,0],[616,13,616,35,0],[617,9,617,10,0],[621,9,621,10,0],[622,13,622,71,0],[623,13,623,25,0],[624,9,624,10,0],[628,9,628,10,0],[629,13,629,63,0],[630,13,630,28,0],[631,17,633,114,0],[635,13,635,25,0],[636,9,636,10,0],[641,9,641,10,0],[642,13,642,27,0],[643,17,643,54,0],[645,13,645,42,0],[646,9,646,10,0],[659,9,659,10,0],[662,13,662,14,0],[663,17,663,98,0],[664,17,664,55,0],[665,21,665,41,0],[666,13,666,14,0],[667,13,667,18,0],[668,13,668,14,0],[669,13,669,14,0],[671,13,671,25,0],[672,9,672,10,0],[676,9,676,10,0],[677,13,677,63,0],[678,13,678,69,0],[680,13,680,28,0],[681,17,681,46,0],[683,13,687,35,0],[688,13,688,20,0],[688,22,688,32,0],[688,33,688,35,0],[688,36,688,50,0],[689,13,689,14,0],[690,17,690,52,0],[691,17,691,56,0],[692,17,692,56,0],[693,17,693,53,0],[694,17,694,51,0],[697,17,697,62,0],[699,17,699,66,0],[700,17,700,49,0],[702,17,702,37,0],[703,13,703,14,0],[705,13,705,20,0],[705,22,705,36,0],[705,37,705,39,0],[705,40,705,51,0],[706,13,706,14,0],[707,17,707,56,0],[708,17,708,36,0],[709,17,709,18,0],[710,21,710,77,0],[712,21,712,28,0],[712,30,712,40,0],[712,41,712,43,0],[712,44,712,55,0],[713,21,713,22,0],[714,25,714,63,0],[715,25,715,65,0],[716,25,716,64,0],[717,25,717,60,0],[719,25,719,74,0],[720,25,720,76,0],[722,25,722,48,0],[723,21,723,22,0],[725,21,725,60,0],[726,17,726,18,0],[727,13,727,14,0],[729,13,729,42,0],[730,9,730,10,0],[734,9,734,10,0],[735,13,735,69,0],[736,13,736,63,0],[738,13,738,28,0],[739,17,739,46,0],[741,13,741,98,0],[742,13,742,20,0],[742,22,742,32,0],[742,33,742,35,0],[742,36,742,43,0],[743,13,743,14,0],[744,17,744,52,0],[745,17,745,56,0],[746,17,746,56,0],[747,17,747,53,0],[748,17,748,51,0],[749,17,749,62,0],[754,17,754,73,0],[755,17,755,55,0],[756,17,756,57,0],[757,17,757,40,0],[758,17,758,56,0],[759,17,759,37,0],[760,13,760,14,0],[762,13,762,42,0],[763,9,763,10,0],[766,9,766,10,0],[767,13,767,69,0],[768,13,768,39,0],[770,13,770,58,0],[771,13,771,60,0],[772,13,772,56,0],[775,13,781,41,0],[783,13,783,79,0],[784,13,784,49,0],[786,13,786,104,0],[787,13,787,20,0],[787,22,787,30,0],[787,31,787,33,0],[787,34,787,46,0],[788,13,788,14,0],[789,17,789,35,0],[790,17,790,42,0],[791,17,791,23,0],[794,13,794,36,0],[795,13,795,52,0],[796,13,796,50,0],[797,13,797,59,0],[799,13,799,23,0],[800,9,800,10,0],[811,9,811,10,0],[812,13,812,115,0],[813,13,813,93,0],[814,13,814,105,0],[815,13,815,28,0],[816,13,816,14,0],[817,17,817,67,0],[818,17,818,63,0],[819,17,819,113,0],[821,17,821,87,0],[822,17,822,75,0],[824,17,824,120,0],[827,17,827,46,0],[828,17,828,39,0],[829,17,829,64,0],[831,17,831,35,0],[834,13,834,33,0],[835,9,835,10,0],[838,9,838,10,0],[839,13,839,66,0],[840,13,840,71,0],[841,13,841,38,0],[842,9,842,10,0],[853,9,853,10,0],[854,13,854,64,0],[855,13,855,63,0],[857,13,857,28,0],[858,17,858,40,0],[860,13,860,97,0],[861,13,861,31,0],[862,13,862,14,0],[863,17,863,41,0],[863,41,863,84,0],[863,84,863,86,0],[863,17,863,86,0],[864,13,864,14,0],[866,13,866,43,0],[867,9,867,10,0],[877,9,877,10,0],[878,13,878,88,0],[879,13,879,63,0],[881,13,881,28,0],[882,17,882,55,0],[884,13,884,97,0],[885,13,885,39,0],[886,13,886,14,0],[887,17,887,49,0],[887,49,887,116,0],[887,116,887,118,0],[887,17,887,118,0],[888,13,888,14,0],[890,13,890,51,0],[891,9,891,10,0],[896,9,896,10,0],[897,13,897,41,0],[899,13,900,98,0],[901,13,901,40,0],[902,9,902,10,0],[906,9,906,10,0],[907,13,907,66,0],[909,13,909,26,0],[910,9,910,10,0],[914,9,914,10,0],[915,13,917,27,0],[918,13,918,38,0],[919,13,919,37,0],[920,17,920,49,0],[922,13,922,50,0],[924,13,924,52,0],[925,13,925,41,0],[926,13,926,27,0],[927,9,927,10,0],[931,9,931,10,0],[932,13,932,57,0],[934,13,936,27,0],[938,13,938,20,0],[938,22,938,32,0],[938,33,938,35,0],[938,36,938,53,0],[939,13,939,14,0],[940,17,940,46,0],[942,17,942,69,0],[943,17,943,57,0],[946,17,946,57,0],[947,17,947,31,0],[948,13,948,14,0],[950,13,950,36,0],[951,9,951,10,0],[954,9,954,10,0],[955,13,955,63,0],[956,13,956,28,0],[957,17,957,24,0],[958,13,959,25,0],[960,13,960,31,0],[961,17,961,24,0],[963,13,963,63,0],[964,13,964,29,0],[965,17,965,24,0],[967,13,967,57,0],[969,13,969,20,0],[969,22,969,39,0],[969,40,969,42,0],[969,43,969,60,0],[970,13,970,14,0],[971,17,971,60,0],[971,60,971,84,0],[971,84,971,86,0],[971,17,971,86,0],[972,17,972,37,0],[973,21,973,30,0],[975,17,975,56,0],[976,17,976,43,0],[977,21,977,30,0],[980,17,980,59,0],[981,21,981,30,0],[983,17,983,45,0],[985,13,985,14,0],[987,13,987,60,0],[987,60,987,74,0],[987,74,987,76,0],[987,13,987,76,0],[988,13,988,44,0],[988,44,988,96,0],[988,96,988,98,0],[988,13,988,98,0],[989,9,989,10,0],[994,9,994,10,0],[996,13,996,14,0],[997,17,997,85,0],[998,17,998,51,0],[1001,17,1001,37,0],[1002,17,1002,72,0],[1005,17,1005,90,0],[1006,17,1006,54,0],[1007,17,1007,62,0],[1021,17,1021,31,0],[1022,17,1023,79,0],[1024,17,1024,41,0],[1025,17,1025,18,0],[1026,21,1026,67,0],[1027,21,1027,51,0],[1028,21,1028,63,0],[1035,21,1035,89,0],[1036,21,1037,21,0],[1037,21,1037,22,0],[1037,22,1038,25,0],[1038,25,1038,37,0],[1038,37,1039,25,0],[1039,25,1039,77,0],[1039,77,1040,25,0],[1040,25,1040,36,0],[1040,36,1041,21,0],[1041,21,1041,22,0],[1041,22,1041,24,0],[1036,21,1041,24,0],[1042,21,1042,103,0],[1044,21,1044,80,0],[1045,26,1045,35,0],[1045,37,1045,63,0],[1045,65,1045,68,0],[1046,21,1046,22,0],[1047,25,1047,65,0],[1048,25,1048,99,0],[1049,25,1049,88,0],[1051,25,1051,37,0],[1052,25,1052,97,0],[1053,29,1053,39,0],[1055,25,1055,89,0],[1056,21,1056,22,0],[1058,21,1058,66,0],[1061,21,1061,62,0],[1062,21,1062,28,0],[1062,30,1062,40,0],[1062,41,1062,43,0],[1062,44,1062,61,0],[1063,21,1063,22,0],[1064,25,1064,52,0],[1065,25,1065,83,0],[1067,25,1067,64,0],[1068,30,1068,39,0],[1068,41,1068,65,0],[1068,67,1068,70,0],[1069,25,1069,26,0],[1070,29,1070,61,0],[1070,61,1070,104,0],[1070,104,1070,106,0],[1070,29,1070,106,0],[1071,33,1071,42,0],[1073,29,1073,56,0],[1074,29,1074,54,0],[1075,29,1075,41,0],[1076,25,1076,26,0],[1078,25,1078,56,0],[1079,25,1079,38,0],[1080,21,1080,22,0],[1081,21,1081,53,0],[1083,21,1083,38,0],[1085,13,1085,14,0],[1086,13,1086,30,0],[1087,13,1087,14,0],[1088,13,1088,14,0],[1090,13,1090,25,0],[1091,9,1091,10,0],[1095,9,1095,10,0],[1100,13,1100,98,0],[1103,13,1103,33,0],[1104,13,1104,68,0],[1105,13,1106,51,0],[1107,13,1107,39,0],[1108,13,1108,37,0],[1109,13,1109,14,0],[1110,17,1110,63,0],[1111,17,1111,72,0],[1112,22,1112,34,0],[1112,36,1112,66,0],[1112,68,1112,74,0],[1113,17,1113,18,0],[1114,21,1114,57,0],[1115,21,1115,77,0],[1116,17,1116,18,0],[1117,17,1117,32,0],[1123,13,1123,39,0],[1124,9,1124,10,0],[1129,9,1129,10,0],[1132,13,1132,14,0],[1133,17,1133,102,0],[1134,17,1134,72,0],[1135,17,1135,63,0],[1136,17,1136,69,0],[1137,17,1137,83,0],[1138,17,1138,55,0],[1139,17,1139,71,0],[1141,13,1141,33,0],[1142,13,1142,14,0],[1143,17,1143,56,0],[1144,17,1144,103,0],[1145,17,1145,31,0],[1147,9,1147,10,0],[1151,9,1151,10,0],[1154,13,1154,14,0],[1155,17,1155,102,0],[1156,17,1156,57,0],[1157,17,1157,71,0],[1158,17,1158,56,0],[1160,17,1160,46,0],[1162,24,1162,60,0],[1163,17,1163,18,0],[1164,21,1164,64,0],[1165,21,1165,43,0],[1166,21,1166,44,0],[1167,17,1167,18,0],[1169,17,1169,31,0],[1171,13,1171,33,0],[1172,13,1172,14,0],[1173,17,1173,74,0],[1175,9,1175,10,0],[1180,9,1185,19,0]]);
    </script>
  </body>
</html>