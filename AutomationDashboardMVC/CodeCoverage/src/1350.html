<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Platform UI\Common\BrixItemsTotal.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Drawing;
using System.Globalization;
using System.IO;
using System.Web;
using System.Web.UI.WebControls;
using System.Xml;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core.AbstractModels;
using Aurigo.AMP3.Core.BusinessLayer.BL;
using Aurigo.AMP3.Core.BusinessLayer.DTO;
using Aurigo.AMP3.Core.IntegrationConnector;
using Aurigo.AMP3.Core.UserControls;
using Aurigo.AMP3.LibraryDAC;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.Brix.Core.WebUiHelper;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Infragistics.WebUI.UltraWebGrid;

namespace Aurigo.AMP3.Core.UI.Common
{
    public partial class BrixitemsTotal : BrixPageBase
    {
        ValueList valListFromMonth = new ValueList();
        ValueList valListFromYear = new ValueList();
        ValueList valListToMonth = new ValueList();
        ValueList valListToYear = new ValueList();

        #region Distribution enum

        public enum Distribution
        {
            Auto = 1,
            BOQ = 2,
            Group = 3,
        }

        #endregion

        public const string ohDetailsID = &quot;ItemID&quot;; //In order to display the overhead details in a Hierarchical grid,

        public const string ohCategoryID = &quot;StandardItemNo&quot;;
        //the overhead details id and category had to be renamed as ItemID and StandardItemNo

        private DataTable dtoOverheadDetails
        {
            get { return (DataTable)Session[&quot;dtoOverheadDetails&quot;]; }
            set { Session[&quot;dtoOverheadDetails&quot;] = value; }
        }

        private string selectedNode
        {
            get { return (string)ViewState[&quot;selectedNode&quot;]; }
            set { ViewState[&quot;selectedNode&quot;] = value; }
        }

        private bool newRow
        {
            get { return (bool)ViewState[&quot;newRow&quot;]; }
            set { ViewState[&quot;newRow&quot;] = value; }
        }

        private bool containsDetails
        {
            get { return (bool)ViewState[&quot;containsDetails&quot;]; }
            set { ViewState[&quot;containsDetails&quot;] = value; }
        }

        private ItemPickerControl itemPicker;
        private ItemPickerControl itemPickerboq;
        private string moduleID = string.Empty;
        private int parentID;

        private bool IsERPConnected
        {
            get { return IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX); }
        }

        protected override void OnPreInit(EventArgs e)
        {
            ModuleId = moduleID = Request[&quot;Context&quot;];
            Int32.TryParse(Request[&quot;ParentID&quot;], out parentID);

            itemTotalModel = SetItemModel();

            base.OnPreInit(e);
        }

        private void InitItemPickers()
        {
            Init_boqItemPicker();
            Init_ucItemPicker();
            ucItemPicker.PickerText.Style.Add(&quot;display&quot;, &quot;none&quot;);
            ucItemPicker.PickerButton.Text = &quot;Add&quot;;
            boqItemPicker.PickerText.Style.Add(&quot;display&quot;, &quot;none&quot;);
            boqItemPicker.PickerParent = DivOTMain.ClientID;
            ucItemPicker.MultipleSelectedIndexChanged += itemPicker_SelectedIndexChanged;
            //ucItemPicker.InitItemPickerParams += new ItemPickerControl.InitParams(ucItemPicker_InitItemPickerParams);
            boqItemPicker.MultipleSelectedIndexChanged += itemPickerboq_SelectedIndexChanged;
            //boqItemPicker.InitItemPickerParams += new ItemPickerControl.InitParams(boqItemPicker_InitItemPickerParams);
        }

        bool Init_boqItemPicker()
        {
            itemPickerboq = (boqItemPicker);
            itemPickerboq.MultipleSelectedIndexChanged += itemPickerboq_SelectedIndexChanged;
            itemPickerboq.ModuleID = moduleID;
            itemPickerboq.ParentInstanceID = parentID;
            itemPickerboq.EnableMultipleSelect = true;
            itemPickerboq.IsContractView = false;
            itemPickerboq.IsAmountFromCost = true;
            itemPickerboq.MinimumQuantity = &quot;0&quot;;
            itemPickerboq.MinimumBaseCost = &quot;0&quot;;
            itemPickerboq.IsNonContract = false;
            itemPickerboq.PickerParent = DivOTMain.ClientID;
            itemPickerboq.PickerButton.Style[&quot;width&quot;] = btnOverheadBOQDel.Width.ToString();

            return true;
        }

        bool Init_ucItemPicker()
        {
            itemPicker = (ucItemPicker);
            itemPicker.ModuleID = moduleID;
            itemPicker.ParentInstanceID = parentID;
            itemPicker.EnableMultipleSelect = true;
            itemPicker.IsContractView = false;
            itemPicker.IsAmountFromCost = true;
            itemPicker.MinimumQuantity = &quot;0&quot;;
            itemPicker.MinimumBaseCost = &quot;0&quot;;
            itemPicker.PickerButton.Style[&quot;width&quot;] = btnProfitDiscountBOQDel.Width.ToString();

            return true;
        }

        protected override void OnInit(EventArgs e)
        {
            PermissionsToCheck.Add(Constants.MODFEAT_VISIBILITY);
            PermissionsToCheck.Add(&quot;ContractTotal&quot;);

            ContainerGrpTree.NodeClicked += ContainerGrpTree_NodeClicked;
            InitItemPickers();
            SetPopUpDetails();
            base.ContextElement = moduleID + &quot;_Total&quot;;
            base.ContextElementHGrid = hGridOverhead;
            base.OnInit(e);
        }

        protected override void CreateContextMenu()
        {
            List&lt;BrixContextMenu&gt; Menu = CMenu.CMenuArray;

            hGridOverhead.GetContextMenu(Menu);
        }

        bool IsProposedProject
        {
            get
            {
                return (HttpContext.Current.Request == null ||
                        string.IsNullOrEmpty(HttpContext.Current.Request.QueryString[&quot;PP&quot;])
                    ? false
                    : (HttpContext.Current.Request.QueryString[&quot;PP&quot;] == &quot;1&quot;) ? true : false);
            }
        }

        protected void Page_Load(object sender, EventArgs e)
        {
            UIHelper.DisableRoleSelection(Page);

            var list = (List&lt;string&gt;)Context.Items[Constants.MODULE_PERMISSIONS];
            if (!String.IsNullOrEmpty(Request[&quot;ParentID&quot;]))
            {
                if (!list.Contains(&quot;View&quot;))
                {
                    UIHelper.RedirectURL(
                        &quot;The current role does not have the required permissions to view this page.&quot;,
                        ResolveUrl((IsProposedProject)
                            ? &quot;~/Common/BrixListPage.aspx?context=PROJECT&amp;PP=1&quot;
                            : &quot;~/Common/BrixListPage.aspx?context=PROJECT&quot;), null, Context);
                }
            }

            // Checking if the user has permission to provide discount
            hdnDiscountAuthority.Value = (list.Contains(&quot;Discount&quot;)) ? &quot;true&quot; : &quot;false&quot;;

            #region Hiding Price Related fields according to the property

            tblPriceRelatedFields.Style.Clear();
            tblExpandModules.Style.Clear();
            tblSGLabels.Style.Clear();

            if (itemTotalModel.IsPriceRelatedFieldsHidden)
            {
                tblPriceRelatedFields.Style.Add(&quot;display&quot;, &quot;none&quot;);
                tblExpandModules.Style.Add(&quot;display&quot;, &quot;none&quot;);
                tblGroupsGrid.Style.Add(&quot;display&quot;, &quot;none&quot;);
                tblSGLabels.Style.Add(&quot;display&quot;, &quot;none&quot;);
                tblProfitDistribution.Style.Add(&quot;display&quot;, &quot;none&quot;);
            }
            else
            {
                tblPriceRelatedFields.Style.Add(&quot;display&quot;, &quot;table&quot;);
                tblExpandModules.Style.Add(&quot;display&quot;, &quot;table&quot;);
                tblSGLabels.Style.Add(&quot;display&quot;, &quot;table&quot;);
                tblProfitDistribution.Style.Add(&quot;display&quot;, &quot;table&quot;);
            }

            #endregion

            if (!string.IsNullOrEmpty(Request.QueryString[&quot;ParentID&quot;]))
                parentID = Convert.ToInt32(Request.QueryString[&quot;ParentID&quot;], CultureInfo.CurrentCulture);
            if (!string.IsNullOrEmpty(Request.QueryString[&quot;Context&quot;]))
                moduleID = Request.QueryString[&quot;Context&quot;];

            if (!Page.IsPostBack)
                DataInitialization();

            PageTitle = itemTotalModel.Header;
            lblError.Text = String.Empty;

            // Enable or diable the buttons based on the approved and lock/approved status of estimate/contract/cost version
            DisableOverheadButtons(false);
            DisableProfitDiscountButtons(false);
            wneProfitMargin.ReadOnly = true; //itemTotalModel.GetApprovalStatus(parentID, moduleID);
            wneDiscount.ReadOnly = true;
            //itemTotalModel.GetApprovalStatus(parentID, moduleID) || !list.Contains(&quot;Discount&quot;);
            wnePercentage.Style.Add(&quot;display&quot;, &quot;none&quot;);
            setLabels();

            if (rblDistributionType.Items.Count &gt;= 1)
                rblDistributionType.Items[1].Text = ItemNameAbbr + &quot; Distribution&quot;;
            if (rblProfitDistributionType.Items.Count &gt;= 1)
                rblProfitDistributionType.Items[1].Text = ItemNameAbbr + &quot; Distribution&quot;;
            // populating the groups tree
            if (!IsPostBack)
            {
                DataTable dto = LibraryComponent.Instance.GetOverheadGroups(0);
                ContainerGrpTree.DataBind(dto, &quot;0&quot;);
            }

            if (!IsPostBack)
            {
                rblType.SelectedIndex = 0;
                selectedNode = &quot;&quot;;
                txtGroup.Text = &quot;&quot;;
                //Page.ClientScript.RegisterStartupScript(this.GetType(), &quot;S&quot;, &quot;CategoryChange()&quot;, true);
                //SetOverheadType(rblType.SelectedValue.ToString2());
                //rblProfitDistributionType.SelectedIndex = 0;
                //SetProfitDistributionType(1);
                ProfitDiscountDataInitialisation();
            }
            hdnAmountDigits.Value =
                CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT).ToString2();
            hdnUnitCostDigits.Value =
                CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE).ToString2();
            hdnQuantityDigits.Value =
                CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY).ToString2();
        }

        public void BindOverheadGrid()
        {
            DataSet dsOverheadDetails = ItemManager.Instance.GetOverheadDetailsForHGrid(moduleID, parentID);
            DataTable dtContainer = dsOverheadDetails.Tables[0];
            DataTable dtItems = dsOverheadDetails.Tables[1];
            int contextId;
            string context = &quot;&quot;;
            hGridOverhead.ContainerTable = dtContainer;
            hGridOverhead.ItemTable = dtItems;
            if (!string.IsNullOrEmpty(moduleID))
            {
                if (moduleID.Equals(&quot;ESTMATE&quot;))
                    context = Constants.MODID_ESTMATE;
                else
                    context = Constants.MODID_CONTMGT;
            }
            if (!string.IsNullOrEmpty(Request[&quot;ContractId&quot;]))
                contextId = Convert.ToInt32(Request[&quot;ContractId&quot;]);
            else
                contextId = parentID;

            hGridOverhead.AmountColumn = new HierarchicalGridColumn(&quot;Amount&quot;, 100, false,
                AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, true,
                &quot;Amount in &quot; +
                LocalizationManager.GetModuleCurrency(context,
                    contextId.
                        ToString()));
            hGridOverhead.Columns = ItemManager.Instance.HGridOverheadColumns();

            hGridOverhead.ContainerIDColumn = &quot;ContainerID&quot;;
            hGridOverhead.ParentContainerIDColumn = &quot;ParentContainerID&quot;;
            hGridOverhead.ContainerNameColumn = &quot;ContainerName&quot;;
            hGridOverhead.ItemIDColumn = &quot;ItemID&quot;;
            hGridOverhead.ItemNameColumn = &quot;StandardItemNo&quot;;
            hGridOverhead.ItemContainerIDColumn = &quot;ContainerID&quot;;
            hGridOverhead.IsReadOnly = true;
            hGridOverhead.IsAmountColumnVisible = true;
            hGridOverhead.disableGridSaveButton = true;

            hGridOverhead.FetchActivities += FetchActivities;
            hGridOverhead.FetchSubItems += FetchSubItems;
            hGridOverhead.FindControl(&quot;ESI&quot;).EnableViewState = false;

            hGridOverhead.Bind();
        }

        private void FetchActivities(HierarchicalGrid sender, int itemID)
        {
            sender.ActivityTable = new DataTable();
        }

        private void FetchSubItems(HierarchicalGrid sender, int itemID)
        {
            sender.SubItemTable = new DataTable();
        }

        protected override void CreateChildControls()
        {
            try
            {
                BindOverheadGrid();
                base.CreateChildControls();
            }
            catch
            {
            }
        }

        #region &quot;Functions&quot;

        // Profit margin and discount functions start
        private ItemTotalModel itemTotalModel;

        private void ProfitDiscountDataInitialisation()
        {
            trProfitBOQDistribution.Style.Add(&quot;display&quot;, &quot;none&quot;);
            trProfitSGDistribution.Style.Add(&quot;display&quot;, &quot;none&quot;);
            trProfitBOQDistributionButtons.Style.Add(&quot;display&quot;, &quot;none&quot;);
            trProfitAutoDistribution.Style.Add(&quot;display&quot;, &quot;none&quot;);
            trProfitBOQDistributionButtons.Style.Add(&quot;display&quot;, &quot;none&quot;);
            trProfitDiscountSaveCancel.Style.Add(&quot;display&quot;, &quot;none&quot;);
            BindProfitDiscountDetails();
            BindProfitDiscountGroupDistributionGrid();
            rblProfitDistributionType.ClearSelection();
            wneProfitPercentage.Value = wneDiscountPercentage.Value = wneProAmount.Value = wneDisAmount.Value = null;
        }

        /// &lt;summary&gt;
        /// Creating the Grid schema with required field
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;moduleID&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;parentID&quot;&gt;&lt;/param&gt;
        private void BindProfitDiscountDetails()
        {
            hdnProfitDiscountDetailID.Value = string.Empty;
            ;
            var dtProDisGrid = new DataTable();
            LoadProfitDiscountSchema(dtProDisGrid);

            uwgProfitBOQs.DataSource = dtProDisGrid.ToMWDateTime();
            uwgProfitBOQs.DataBind();

            SetProfitDiscountGridCols();
        }

        /// &lt;summary&gt;
        /// Setting Schema for the Grid
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;dt&quot;&gt;&lt;/param&gt;
        private void LoadProfitDiscountSchema(DataTable dt)
        {
            dt.Columns.AddRange(
                new[]
                {
                    new DataColumn(&quot;LineNo&quot;, Type.GetType(&quot;System.Int32&quot;)),
                    new DataColumn(&quot;ItemID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                    new DataColumn(&quot;StandardItemNo&quot;, Type.GetType(&quot;System.String&quot;)),
                    new DataColumn(&quot;Description&quot;, Type.GetType(&quot;System.String&quot;)),
                    new DataColumn(&quot;UnitCost&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                    new DataColumn(&quot;Quantity&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                    new DataColumn(&quot;Amount&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                    new DataColumn(&quot;ProfitPercentage&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                    new DataColumn(&quot;ProfitAmount&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                    new DataColumn(&quot;DiscountPercentage&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                    new DataColumn(&quot;DiscountAmount&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                    new DataColumn(&quot;Type&quot;, Type.GetType(&quot;System.String&quot;)),
                    new DataColumn(&quot;Container&quot;, Type.GetType(&quot;System.String&quot;)),
                    new DataColumn(&quot;ContainerID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                }
                );
        }

        private void BindProfitDiscountGroupDistributionGrid()
        {
            DataTable dtProGroupItems = ItemManager.Instance.GetProfitDiscountGroupDistribution(moduleID, parentID);
            var dtProDisGroupGrid = new DataTable();

            LoadProfitDiscountGrpDistributionSchema(dtProDisGroupGrid);
            foreach (DataRow row in dtProGroupItems.Rows)
            {
                DataRow dr;
                dr = dtProDisGroupGrid.NewRow();
                dr[&quot;Name&quot;] = row[&quot;GroupName&quot;];
                dr[&quot;ScheduledGroupTotal&quot;] = row[&quot;GroupTotalUC&quot;];
                dr[&quot;GroupID&quot;] = row[&quot;GroupID&quot;];
                dr[&quot;ProfitPercentage&quot;] = row[&quot;ProfitValue&quot;];
                dr[&quot;DiscountPercentage&quot;] = row[&quot;DiscountValue&quot;];
                dr[&quot;ProfitAmount&quot;] = !(row[&quot;ProfitValue&quot;].ToDouble2() == 0)
                    ? row[&quot;GroupTotalUC&quot;].ToDouble2()*0.01*row[&quot;ProfitValue&quot;].ToDouble2()
                    : 0;
                dr[&quot;DiscountAmount&quot;] = !(row[&quot;DiscountValue&quot;].ToDouble2() == 0)
                    ? row[&quot;GroupTotalUC&quot;].ToDouble2()*0.01*row[&quot;DiscountValue&quot;].ToDouble2()
                    : 0;

                dtProDisGroupGrid.Rows.Add(dr);
            }

            uwgProfitSGs.DataSource = dtProDisGroupGrid.ToMWDateTime();
            uwgProfitSGs.DataBind();

            FormatProDisGroupsGrid();
        }

        /// &lt;summary&gt;
        /// Setting Schema for the Grid
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;dt&quot;&gt;&lt;/param&gt;
        private void LoadProfitDiscountGrpDistributionSchema(DataTable dt)
        {
            dt.Columns.AddRange(
                new[]
                {
                    new DataColumn(&quot;Name&quot;, Type.GetType(&quot;System.String&quot;)),
                    new DataColumn(&quot;ProfitPercentage&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                    new DataColumn(&quot;ProfitAmount&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                    new DataColumn(&quot;DiscountPercentage&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                    new DataColumn(&quot;DiscountAmount&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                    new DataColumn(&quot;ScheduledGroupTotal&quot;, Type.GetType(&quot;System.Decimal&quot;)),
                    new DataColumn(&quot;GroupID&quot;, Type.GetType(&quot;System.Decimal&quot;))
                }
                );
        }

        /// &lt;summary&gt;
        /// Formatting the Grid displayed on the screen.
        /// &lt;/summary&gt;
        private void FormatProDisGroupsGrid()
        {
            // to fix XSS attack
            foreach (UltraGridColumn col in uwgProfitSGs.Columns)
            {
                col.HTMLEncodeContent = true;
            }
            ColumnsCollection cols = uwgProfitSGs.Columns;

            cols.FromKey(&quot;Name&quot;).Header.Caption = &quot;Name&quot;;
            cols.FromKey(&quot;ScheduledGroupTotal&quot;).Header.Caption = &quot;Scheduled Group Total Cost&quot;;
            if (cols.FromKey(&quot;ProfitPercentage&quot;) != null)
            {
                cols.FromKey(&quot;ProfitPercentage&quot;).Header.Caption = &quot;Profit Percentage&quot;;
                cols.FromKey(&quot;ProfitPercentage&quot;).NullText = &quot;0&quot;;
                cols.FromKey(&quot;ProfitPercentage&quot;).AllowUpdate = AllowUpdate.Yes;
                cols.FromKey(&quot;ProfitPercentage&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE;
                cols.FromKey(&quot;ProfitPercentage&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;ProfitPercentage&quot;).CellStyle.BackColor = Color.Yellow;
            }
            if (cols.FromKey(&quot;ProfitAmount&quot;) != null)
            {
                cols.FromKey(&quot;ProfitAmount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                cols.FromKey(&quot;ProfitAmount&quot;).Header.Caption = &quot;Amount&quot;;
                cols.FromKey(&quot;ProfitAmount&quot;).AllowUpdate = AllowUpdate.Yes;
                cols.FromKey(&quot;ProfitAmount&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;ProfitAmount&quot;).CellStyle.BackColor = Color.Yellow;
            }
            if (cols.FromKey(&quot;DiscountPercentage&quot;) != null)
            {
                cols.FromKey(&quot;DiscountPercentage&quot;).Header.Caption = &quot;Discount Percentage&quot;;
                cols.FromKey(&quot;DiscountPercentage&quot;).AllowUpdate = AllowUpdate.Yes;
                cols.FromKey(&quot;DiscountPercentage&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;DiscountPercentage&quot;).CellStyle.BackColor = Color.Yellow;
            }
            if (cols.FromKey(&quot;DiscountAmount&quot;) != null)
            {
                cols.FromKey(&quot;DiscountAmount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                cols.FromKey(&quot;DiscountAmount&quot;).Header.Caption = &quot;Amount&quot;;
                cols.FromKey(&quot;DiscountAmount&quot;).AllowUpdate = AllowUpdate.Yes;
                cols.FromKey(&quot;DiscountAmount&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;DiscountAmount&quot;).CellStyle.BackColor = Color.Yellow;
            }

            cols.FromKey(&quot;ScheduledGroupTotal&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
            cols.FromKey(&quot;GroupID&quot;).Hidden = true;

            //cols.FromKey(&quot;Percentage&quot;).NullText = &quot;0&quot;;
            //cols.FromKey(&quot;Percentage&quot;).Format = Constants.FORMAT_PERCENTAGE;
            //cols.FromKey(&quot;Percentage&quot;).AllowUpdate = AllowUpdate.Yes;
            //cols.FromKey(&quot;Percentage&quot;).FieldLen = 10;
            //cols.FromKey(&quot;Percentage&quot;).CellStyle.BackColor = System.Drawing.Color.Yellow;
        }

        /// &lt;summary&gt;
        /// Formating the grid shown in the screen.
        /// &lt;/summary&gt;
        private void SetProfitDiscountGridCols()
        {
            #region Formatting the Item Distribution Grid

            // to fix XSS attack
            foreach (UltraGridColumn col in uwgProfitBOQs.Columns)
            {
                col.HTMLEncodeContent = true;
            }

            if (uwgProfitBOQs.Columns.FromKey(&quot;ProfitPercentage&quot;) != null)
            {
                uwgProfitBOQs.Columns.FromKey(&quot;ProfitPercentage&quot;).Header.Caption = &quot;Profit Percentage&quot;;
                uwgProfitBOQs.Columns.FromKey(&quot;ProfitPercentage&quot;).NullText = &quot;0&quot;;
                uwgProfitBOQs.Columns.FromKey(&quot;ProfitPercentage&quot;).AllowUpdate = AllowUpdate.Yes;
                uwgProfitBOQs.Columns.FromKey(&quot;ProfitPercentage&quot;).Format =
                    AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE;
                uwgProfitBOQs.Columns.FromKey(&quot;ProfitPercentage&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                uwgProfitBOQs.Columns.FromKey(&quot;ProfitPercentage&quot;).CellStyle.BackColor = Color.Yellow;
            }
            if (uwgProfitBOQs.Columns.FromKey(&quot;DiscountPercentage&quot;) != null)
            {
                uwgProfitBOQs.Columns.FromKey(&quot;DiscountPercentage&quot;).Header.Caption = &quot;Discount Percentage&quot;;
                uwgProfitBOQs.Columns.FromKey(&quot;DiscountPercentage&quot;).NullText = &quot;0&quot;;
                uwgProfitBOQs.Columns.FromKey(&quot;DiscountPercentage&quot;).AllowUpdate = AllowUpdate.Yes;
                uwgProfitBOQs.Columns.FromKey(&quot;DiscountPercentage&quot;).Format =
                    AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE;
                uwgProfitBOQs.Columns.FromKey(&quot;DiscountPercentage&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                uwgProfitBOQs.Columns.FromKey(&quot;DiscountPercentage&quot;).CellStyle.BackColor = Color.Yellow;
            }

            if (uwgProfitBOQs.Columns.FromKey(&quot;UnitCost&quot;) != null)
                uwgProfitBOQs.Columns.FromKey(&quot;UnitCost&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;
            if (uwgProfitBOQs.Columns.FromKey(&quot;ProfitAmount&quot;) != null)
            {
                uwgProfitBOQs.Columns.FromKey(&quot;ProfitAmount&quot;).Header.Caption = &quot;Profit Amount&quot;;
                uwgProfitBOQs.Columns.FromKey(&quot;ProfitAmount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                uwgProfitBOQs.Columns.FromKey(&quot;ProfitAmount&quot;).AllowUpdate = AllowUpdate.Yes;
                uwgProfitBOQs.Columns.FromKey(&quot;ProfitAmount&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                uwgProfitBOQs.Columns.FromKey(&quot;ProfitAmount&quot;).CellStyle.BackColor = Color.Yellow;
            }
            if (uwgProfitBOQs.Columns.FromKey(&quot;DiscountAmount&quot;) != null)
            {
                uwgProfitBOQs.Columns.FromKey(&quot;DiscountAmount&quot;).Header.Caption = &quot;Discount Amount&quot;;
                uwgProfitBOQs.Columns.FromKey(&quot;DiscountAmount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                uwgProfitBOQs.Columns.FromKey(&quot;DiscountAmount&quot;).AllowUpdate = AllowUpdate.Yes;
                uwgProfitBOQs.Columns.FromKey(&quot;DiscountAmount&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                uwgProfitBOQs.Columns.FromKey(&quot;DiscountAmount&quot;).CellStyle.BackColor = Color.Yellow;
            }
            if (uwgProfitBOQs.Columns.Exists(&quot;Amount&quot;))
                uwgProfitBOQs.Columns.FromKey(&quot;Amount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
            if (uwgProfitBOQs.Columns.Exists(&quot;Quantity&quot;))
                uwgProfitBOQs.Columns.FromKey(&quot;Quantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
            //if (uwgProfitBOQs.Columns.FromKey(&quot;Description&quot;) != null) uwgProfitBOQs.Columns.FromKey(&quot;Description&quot;).Hidden = true;
            if (uwgProfitBOQs.Columns.FromKey(&quot;ItemID&quot;) != null) uwgProfitBOQs.Columns.FromKey(&quot;ItemID&quot;).Hidden = true;
            if (uwgProfitBOQs.Columns.FromKey(&quot;Type&quot;) != null) uwgProfitBOQs.Columns.FromKey(&quot;Type&quot;).Hidden = true;
            if (uwgProfitBOQs.Columns.FromKey(&quot;ContainerID&quot;) != null)
                uwgProfitBOQs.Columns.FromKey(&quot;ContainerID&quot;).Hidden = true;
            if (uwgProfitBOQs.Columns.FromKey(&quot;LineNo&quot;) != null)
                uwgProfitBOQs.Columns.FromKey(&quot;LineNo&quot;).Header.Caption =
                    LocalizationManager.GetString(KeyConstants.LineNo);

            #endregion
        }

        // profit margin and discount functions end

        private void setLabels()
        {
            string Context = Request.QueryString[&quot;Context&quot;];
            LabelTotalContCost.Text = (Context == &quot;ESTMATE&quot;)
                ? &quot;Total Estimate Cost (BC+OH):&quot;
                : &quot;Total Contract Cost (BC+OH):&quot;;
            LabelContBOQCost.Text =
                string.Format(
                    (Context == &quot;ESTMATE&quot;)
                        ? &quot;Estimate Cost + {0} Net Profit: (BC+OH+PM-Disc):&quot;
                        : &quot;Contract Cost + {0} Net Profit: (BC+OH+PM-Disc):&quot;, ItemNameAbbr);
            LabelContDisc.Text = (Context == &quot;ESTMATE&quot;) ? &quot;Estimate Discount (CD):&quot; : &quot;Contract Discount (CD):&quot;;
            LabelContProfit.Text = (Context == &quot;ESTMATE&quot;)
                ? &quot;Estimate Profit Margin (PM) :&quot;
                : &quot; Contract Profit Margin (PM) :&quot;;
            LabelTotalContAmt.Text = (Context == &quot;ESTMATE&quot;)
                ? &quot;Total Estimate Amount: (Net Profit + Total Estimate Cost):&quot;
                : &quot;Total Contract Amount: (Net Profit + Total Contract Cost):&quot;;
        }

        private void RetainDisplay(int overheadDistributionType, int categorySelType)
        {
            trOverheadDetails.Style.Remove(&quot;display&quot;);
            trOverheadDetails.Style.Add(&quot;display&quot;, &quot;table-row&quot;);
            DisableOverheadButtons(true);
            SetDistributionType(overheadDistributionType);
            SetCategorySelType(categorySelType);
            SetOverheadType(rblType.SelectedValue.ToString2());
        }

        private void RetainProfitDiscountDisplay()
        {
            if (rblProfitDistributionType.SelectedIndex == 0)
            {
                trProfitAutoDistribution.Style.Add(&quot;display&quot;, &quot;table-row&quot;);
                trProfitBOQDistribution.Style.Add(&quot;display&quot;, &quot;none&quot;);
                trProfitSGDistribution.Style.Add(&quot;display&quot;, &quot;none&quot;);
                trProfitDiscountSaveCancel.Style.Add(&quot;display&quot;, &quot;table-row&quot;);
            }
            else if (rblProfitDistributionType.SelectedIndex == 1)
            {
                trProfitAutoDistribution.Style.Add(&quot;display&quot;, &quot;none&quot;);
                trProfitBOQDistribution.Style.Add(&quot;display&quot;, &quot;table-row&quot;);
                trProfitSGDistribution.Style.Add(&quot;display&quot;, &quot;none&quot;);
                trProfitDiscountSaveCancel.Style.Add(&quot;display&quot;, &quot;table-row&quot;);
                trProfitBOQDistributionButtons.Style.Add(&quot;display&quot;, &quot;table-row&quot;);
            }
            else if (rblProfitDistributionType.SelectedIndex == 2)
            {
                trProfitAutoDistribution.Style.Add(&quot;display&quot;, &quot;none&quot;);
                trProfitSGDistribution.Style.Add(&quot;display&quot;, &quot;table-row&quot;);
                trProfitBOQDistribution.Style.Add(&quot;display&quot;, &quot;none&quot;);
                trProfitDiscountSaveCancel.Style.Add(&quot;display&quot;, &quot;table-row&quot;);
            }
        }

        private void SetOverheadType(string overheadType)
        {
            if (overheadType == &quot;A&quot;)
            {
                rblType.SelectedIndex = 1;
                if (containsDetails)
                {
                    //rdAmount.Enabled = 
                    //    rdPercentage.Enabled = 
                    rblType.Enabled =
                        wneAmount.Enabled =
                            wnePercentage.Enabled =
                                wnePercentageDisp.Enabled = false;
                }
                else
                {
                    rblType.Enabled =
                        wneAmount.Enabled = true;
                    wnePercentage.Enabled = wnePercentageDisp.Enabled = false;
                }
            }
            else if (overheadType == &quot;P&quot; &amp;&amp; hdnMode.Value != &quot;View&quot;)
            {
                rblType.SelectedIndex = 0;
                wneAmount.Enabled = false;
                wnePercentage.Enabled = wnePercentageDisp.Enabled = true;
            }
        }

        private void AlertError(string errMessage)
        {
            errMessage = errMessage.Replace(&quot;\&#39;&quot;, &quot;\\&#39;&quot;).Replace(&quot;\n&quot;, &quot;\\n&quot;).Replace(&quot;|&quot;, &quot;\\n&quot;);
            ClientScript.RegisterStartupScript(GetType(), &quot;ShowAlert&quot;, &quot;ShowError(&#39;&quot; + errMessage + &quot;&#39;);&quot;, true);
        }

        private void DataInitialization()
        {
            try
            {
                DataSet dsTemp = ItemManager.Instance.GetTaxCalculatorDetails(moduleID, parentID);

                if (!Page.IsPostBack)
                {
                    ResetOverheadDetails();
                    BindProjectCategoryAndCategoryGroups();
                }

                #region Binding Overheads Table

                BindOverheadGrid();

                #endregion

                //decimal percentageTO = 0;
                //foreach (DataRow row in hGridOverhead.ItemTable.Rows)
                //{
                //    percentageTO += decimal.Parse(row[&quot;Percentage&quot;].ToString2(), CultureInfo.CurrentCulture);
                //}
                //

                if (dsTemp.Tables[1].Rows.Count &gt; 0)
                {
                    #region Getting and Setting Contract Details (BaseCost, Overheads, Local BOQ Profit and Discount)

                    DataRow dr = dsTemp.Tables[1].Rows[0];
                    decimal totalBaseCost =
                        Math.Round(Convert.ToDecimal(dr[&quot;TotalBaseCost&quot;].ToString2(), CultureInfo.CurrentCulture), 2);
                    decimal origBaseCost =
                        Math.Round(Convert.ToDecimal(dr[&quot;OrigBaseCost&quot;].ToString2(), CultureInfo.CurrentCulture), 2);
                    decimal totalOverheadCost =
                        Math.Round(Convert.ToDecimal(dr[&quot;TotalOverheadCost&quot;].ToString2(), CultureInfo.CurrentCulture), 2);
                    decimal totalBOQMargin =
                        Math.Round(Convert.ToDecimal(dr[&quot;TotalMargin&quot;].ToString2(), CultureInfo.CurrentCulture), 2);
                    decimal totalBOQDiscount =
                        Math.Round(Convert.ToDecimal(dr[&quot;TotalDiscount&quot;].ToString2(), CultureInfo.CurrentCulture), 2);
                    decimal percentageTO = (totalBaseCost == 0 ? 0 : totalOverheadCost/totalBaseCost*100);

                    wneOrigBaseCost.ValueDecimal = origBaseCost;
                    wneBaseCostChange.ValueDecimal = totalBaseCost - origBaseCost;
                    wneProjectEstimateTotal.ValueDecimal = totalBaseCost;
                    wneOverheadTotal.ValueDecimal = totalOverheadCost;
                    wneProjectCost.ValueDecimal = totalBaseCost + totalOverheadCost;
                    wneBOQProfit.ValueDecimal = totalBOQMargin;
                    wneBOQDiscount.ValueDecimal = totalBOQDiscount;
                    wneBOQNetProfit.ValueDecimal = totalBOQMargin - totalBOQDiscount;
                    wneCostWithBOQNetProfit.ValueDecimal = totalBaseCost + totalOverheadCost + totalBOQMargin -
                                                           totalBOQDiscount;
                    wneTaxTotal.ValueDecimal = percentageTO;

                    #endregion

                    #region Getting and Setting the Profit Margin and Discount (Contract Level)

                    decimal taxesAndOverheadPercentage = Page.IsPostBack
                        ? wneTaxTotal.ValueDecimal
                        : Math.Round(
                            Convert.ToDecimal(dr[&quot;OverHead&quot;].ToString2(),
                                CultureInfo.CurrentCulture), 2);
                    if (!Page.IsPostBack) wneTaxTotal.ValueDecimal = taxesAndOverheadPercentage;

                    decimal profitMarginPercentage = Page.IsPostBack
                        ? wneProfitMargin.ValueDecimal
                        : Math.Round(
                            Convert.ToDecimal(dr[&quot;Margin&quot;].ToString2(),
                                CultureInfo.CurrentCulture), 2);
                    decimal discountPercentage = Page.IsPostBack
                        ? wneDiscount.ValueDecimal
                        : Math.Round(
                            Convert.ToDecimal(dr[&quot;Discount&quot;].ToString2(),
                                CultureInfo.CurrentCulture), 2);

                    wneProfitMargin.ValueDecimal = (wneProjectCost.ValueDecimal != 0)
                        ? (totalBOQMargin/wneProjectCost.ValueDecimal)*100
                        : 0;
                    wneDiscount.ValueDecimal = (wneProjectCost.ValueDecimal != 0)
                        ? (totalBOQDiscount/(wneProjectCost.ValueDecimal + totalBOQMargin))*
                          100
                        : 0;
                    //wneProfitAmount.ValueDecimal = wneCostWithBOQNetProfit.ValueDecimal * profitMarginPercentage * (decimal)0.01;
                    //decimal tempAmount = wneCostWithBOQNetProfit.ValueDecimal + wneProfitAmount.ValueDecimal;
                    //wneDiscountAmount.ValueDecimal = tempAmount * discountPercentage * (decimal)0.01;

                    #endregion

                    #region Total Profit and Discount (Contract and BOQ Levels)

                    wneTotalProfit.ValueDecimal = totalBOQMargin + wneProfitAmount.ValueDecimal;
                    wneTotalDiscount.ValueDecimal = totalBOQDiscount + wneDiscountAmount.ValueDecimal;

                    #endregion

                    #region Total Net Profit and Final Revenue

                    wneNetProfit.ValueDecimal = Math.Round(
                        (wneTotalProfit.ValueDecimal - wneTotalDiscount.ValueDecimal), 2);
                    wneRevenue.ValueDecimal = wneNetProfit.ValueDecimal + wneProjectCost.ValueDecimal;

                    #endregion
                }

                #region Binding Groups Grid

                uwgGroups.DataSource = dsTemp.Tables[2].ToMWDateTime();
                uwgGroups.DataBind();
                FormatGroupsGrid();

                #endregion

                decimal groupTotal = CalculateGroupTotal(dsTemp.Tables[2]);
                lblScheduledGroupTotal.Text = groupTotal.ToString(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT,
                    CultureInfo.CurrentCulture);
                lblProjectedTotal.Text = wneRevenue.ValueDecimal.ToString(
                    AMP3ApplicationSettings.Instance.FORMAT_AMOUNT,
                    CultureInfo.CurrentCulture);
                lblDifference.Text =
                    (wneRevenue.ValueDecimal - groupTotal).ToString(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT,
                        CultureInfo.CurrentCulture);
            }
            catch (Exception ex)
            {
                AlertError(ex.Message);
            }
        }

        private void BindProjectCategoryAndCategoryGroups()
        {
            if (IsERPConnected)
            {
                DataSet dsOverheadCategoriesGroups =
                    ItemManager.Instance.GetProjectCategoryList(Session[Constants.EIS_ADDITIONAL_INFO].ToString2());

                if (dsOverheadCategoriesGroups != null &amp;&amp; dsOverheadCategoriesGroups.Tables.Count &gt; 0)
                {
                    DataTable dtProjectCategories = dsOverheadCategoriesGroups.Tables[0];

                    //Concatenating the Category Name and Category ID
                    if (!dtProjectCategories.Columns.Contains(&quot;NameConcat&quot;))
                        dtProjectCategories.Columns.Add(&quot;NameConcat&quot;, Type.GetType(&quot;System.String&quot;));
                    foreach (DataRow row in dtProjectCategories.Rows)
                        row[&quot;NameConcat&quot;] = row[&quot;Name&quot;].ToString2() + &quot; (&quot; + row[&quot;CategoryId&quot;].ToString2() + &quot;)&quot;;

                    DataRow rowSelect = dtProjectCategories.NewRow();
                    rowSelect[&quot;NameConcat&quot;] = &quot;Select&quot;;
                    rowSelect[&quot;CategoryId&quot;] = &quot;Select&quot;;


                    dtProjectCategories.Rows.InsertAt(rowSelect, 0);
                    ddlProjectCategory.DataSource = dtProjectCategories.ToMWDateTime();
                    ddlProjectCategory.DataTextField = &quot;NameConcat&quot;;
                    ddlProjectCategory.DataValueField = &quot;CategoryId&quot;;
                    ddlProjectCategory.DataBind();
                    if (ddlProjectCategory.Items.Count &gt; 0)
                        ddlProjectCategory.SelectedIndex = 0;
                    else
                        AlertError(&quot;Connection to ERP lost. Please refresh the page.&quot;);
                }

                if (dsOverheadCategoriesGroups != null &amp;&amp; dsOverheadCategoriesGroups.Tables.Count &gt; 1)
                {
                    ddlCategoryGroup.DataSource = dsOverheadCategoriesGroups.Tables[1].ToMWDateTime();
                    ddlCategoryGroup.DataTextField = &quot;Name&quot;;
                    ddlCategoryGroup.DataValueField = &quot;CategoryGroupId&quot;;
                    ddlCategoryGroup.DataBind();
                    if (ddlCategoryGroup.Items.Count &gt; 0)
                        ddlCategoryGroup.SelectedIndex = 0;
                    else
                        AlertError(&quot;Connection to ERP lost. Please refresh the page.&quot;);
                }
            }
            else
            {
                DataTable dt = ItemManager.Instance.GetLibraryCategories();
                if (!dt.Columns.Contains(&quot;NameConcat&quot;))
                    dt.Columns.Add(&quot;NameConcat&quot;, Type.GetType(&quot;System.String&quot;));
                foreach (DataRow row in dt.Rows)
                    row[&quot;NameConcat&quot;] = row[&quot;CategoryName&quot;].ToString2() + &quot; (&quot; + row[&quot;ID&quot;].ToString2() + &quot;)&quot;;

                DataRow rowSelect = dt.NewRow();
                rowSelect[&quot;NameConcat&quot;] = &quot;Select&quot;;
                rowSelect[&quot;ID&quot;] = -1;
                dt.Rows.InsertAt(rowSelect, 0);

                ddlProjectCategory.DataSource = dt.ToMWDateTime();
                ddlProjectCategory.DataTextField = &quot;NameConcat&quot;;
                ddlProjectCategory.DataValueField = &quot;ID&quot;;
                ddlProjectCategory.DataBind();
                if (ddlProjectCategory.Items.Count &gt; 0)
                    ddlProjectCategory.SelectedIndex = 0;
            }
        }

        private decimal CalculateGroupTotal(DataTable dtTemp)
        {
            decimal total = 0.0M;

            foreach (DataRow dr in dtTemp.Rows)
                total += Convert.ToDecimal(dr[&quot;GroupTotal&quot;].ToString2(), CultureInfo.CurrentCulture);

            return total;
        }

        private string ValidatePercentage(UltraWebGrid grid, string percentKey)
        {
            double totPercent = 0;
            foreach (UltraGridRow row in grid.Rows)
            {
                if (row.Cells.FromKey(percentKey) != null)
                {
                    if (row.Cells.FromKey(percentKey).Value.ToDouble2() &lt; 0)
                        return &quot;Negative Percentages not allowed.&quot;;
                    else
                        totPercent += row.Cells.FromKey(percentKey).Value.ToDouble2();
                }
            }
            if (totPercent != 100)
                return &quot;The sum of Percentages must be equal to 100.&quot;;

            return String.Empty;
        }

        private string GetOverHeadAndTaxesDetail()
        {
            string ohtXML = String.Empty;
            //using (StringWriter sWr = new StringWriter(CultureInfo.CurrentCulture))
            //{
            //    using (XmlTextWriter xWr = new XmlTextWriter(sWr))
            //    {
            //        xWr.WriteStartElement(&quot;OverHeadAndTaxes&quot;);
            //        foreach (UltraGridRow ugr in uwgOverhead.Rows)
            //        {
            //            xWr.WriteStartElement(&quot;OHT&quot;);
            //            xWr.WriteElementString(&quot;OHTID&quot;, &quot;0&quot;);
            //            xWr.WriteElementString(&quot;Description&quot;, ugr.Cells.FromKey(&quot;Description&quot;).Text);
            //            xWr.WriteElementString(&quot;Percentage&quot;, ugr.Cells.FromKey(&quot;Percentage&quot;).Text);
            //            xWr.WriteEndElement();
            //        }
            //        xWr.WriteEndElement();

            //        xWr.Flush();

            //        ohtXML = sWr.ToString2();
            //    }
            //}

            return ohtXML;
        }

        private string GetGroupXML()
        {
            string ohtXML = String.Empty;
            using (var sWr = new StringWriter(CultureInfo.CurrentCulture))
            {
                using (var xWr = new XmlTextWriter(sWr))
                {
                    xWr.WriteStartElement(&quot;GroupDetails&quot;);
                    foreach (UltraGridRow ugr in uwgGroups.Rows)
                    {
                        if (ugr.Cells.FromKey(&quot;GroupName&quot;).Text != String.Empty)
                        {
                            xWr.WriteStartElement(&quot;Groups&quot;);
                            xWr.WriteElementString(&quot;GroupName&quot;, ugr.Cells.FromKey(&quot;GroupName&quot;).Text);
                            xWr.WriteElementString(&quot;GroupID&quot;, ugr.Cells.FromKey(&quot;GroupID&quot;).Text);
                            xWr.WriteElementString(&quot;OTPPercentage&quot;,
                                (String.IsNullOrEmpty(ugr.Cells.FromKey(&quot;OTPPercentage&quot;).Text))
                                    ? &quot;0&quot;
                                    : ugr.Cells.FromKey(&quot;OTPPercentage&quot;).Text);
                            xWr.WriteElementString(&quot;Discount&quot;,
                                (String.IsNullOrEmpty(ugr.Cells.FromKey(&quot;Discount&quot;).Text))
                                    ? &quot;0&quot;
                                    : ugr.Cells.FromKey(&quot;Discount&quot;).Text);
                            xWr.WriteEndElement();
                        }
                    }
                    xWr.WriteEndElement();

                    xWr.Flush();

                    ohtXML = sWr.ToString2();
                }
            }

            return ohtXML;
        }

        private string GetOverheadItemDistributionXML()
        {
            string ohtXML = String.Empty;
            using (var sWr = new StringWriter(CultureInfo.CurrentCulture))
            {
                using (var xWr = new XmlTextWriter(sWr))
                {
                    xWr.WriteStartElement(&quot;OverHeadItems&quot;);
                    foreach (UltraGridRow ugr in uwgOverheadBOQs.Rows)
                    {
                        xWr.WriteStartElement(&quot;OHDItem&quot;);
                        xWr.WriteElementString(&quot;OverheadItemID&quot;, ugr.Cells.FromKey(&quot;OverheadItemID&quot;).Text);
                        xWr.WriteElementString(&quot;OverheadDetailID&quot;, ugr.Cells.FromKey(&quot;OverheadDetailID&quot;).Text);
                        xWr.WriteElementString(&quot;ItemID&quot;, ugr.Cells.FromKey(&quot;ItemID&quot;).Text);
                        xWr.WriteElementString(&quot;Percentage&quot;,
                            (String.IsNullOrEmpty(ugr.Cells.FromKey(&quot;Percentage&quot;).Text))
                                ? &quot;0.00&quot;
                                : ugr.Cells.FromKey(&quot;Percentage&quot;).Text);
                        xWr.WriteEndElement();
                    }
                    xWr.WriteEndElement();

                    xWr.Flush();

                    ohtXML = sWr.ToString2();
                }
            }

            return ohtXML;
        }

        private string GetOverheadGroupDistributionXML()
        {
            string ohtXML = String.Empty;
            using (var sWr = new StringWriter(CultureInfo.CurrentCulture))
            {
                using (var xWr = new XmlTextWriter(sWr))
                {
                    xWr.WriteStartElement(&quot;OverHeadGroups&quot;);
                    foreach (UltraGridRow ugr in uwgOverheadSGs.Rows)
                    {
                        xWr.WriteStartElement(&quot;OHDGroup&quot;);
                        xWr.WriteElementString(&quot;OverheadGroupID&quot;, ugr.Cells.FromKey(&quot;OverheadGroupID&quot;).Text);
                        xWr.WriteElementString(&quot;OverheadDetailID&quot;, ugr.Cells.FromKey(&quot;OverheadDetailID&quot;).Text);
                        xWr.WriteElementString(&quot;GroupID&quot;, ugr.Cells.FromKey(&quot;GroupID&quot;).Text);
                        xWr.WriteElementString(&quot;Percentage&quot;,
                            (String.IsNullOrEmpty(ugr.Cells.FromKey(&quot;Percentage&quot;).Text))
                                ? &quot;0.00&quot;
                                : ugr.Cells.FromKey(&quot;Percentage&quot;).Text);
                        xWr.WriteEndElement();
                    }
                    xWr.WriteEndElement();

                    xWr.Flush();

                    ohtXML = sWr.ToString2();
                }
            }

            return ohtXML;
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private string GetProfitDiscountItemDistributionXML()
        {
            string pdtXML = String.Empty;
            using (var sWr = new StringWriter(CultureInfo.CurrentCulture))
            {
                using (var xWr = new XmlTextWriter(sWr))
                {
                    xWr.WriteStartElement(&quot;ProfitDiscountItems&quot;);
                    foreach (UltraGridRow ugr in uwgProfitBOQs.Rows)
                    {
                        xWr.WriteStartElement(&quot;PDItem&quot;);
                        //xWr.WriteElementString(&quot;ProfitDiscountDetailID&quot;, ugr.Cells.FromKey(&quot;ProfitDiscountDetailID&quot;).Text);
                        xWr.WriteElementString(&quot;ItemID&quot;, ugr.Cells.FromKey(&quot;ItemID&quot;).Text);
                        xWr.WriteElementString(&quot;DiscountValue&quot;,
                            (String.IsNullOrEmpty(ugr.Cells.FromKey(&quot;DiscountPercentage&quot;).Text))
                                ? &quot;0.00&quot;
                                : ugr.Cells.FromKey(&quot;DiscountPercentage&quot;).Text);
                        xWr.WriteElementString(&quot;ProfitValue&quot;,
                            (String.IsNullOrEmpty(ugr.Cells.FromKey(&quot;ProfitPercentage&quot;).Text))
                                ? &quot;0.00&quot;
                                : ugr.Cells.FromKey(&quot;ProfitPercentage&quot;).Text);
                        //xWr.WriteElementString(&quot;Type&quot;, ugr.Cells.FromKey(&quot;Type&quot;).Text);
                        xWr.WriteEndElement();
                    }
                    xWr.WriteEndElement();

                    xWr.Flush();

                    pdtXML = sWr.ToString2();
                }
            }

            return pdtXML;
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private string GetProfitDiscountGroupDistributionXML()
        {
            string pdtXML = String.Empty;
            using (var sWr = new StringWriter(CultureInfo.CurrentCulture))
            {
                using (var xWr = new XmlTextWriter(sWr))
                {
                    xWr.WriteStartElement(&quot;ProfitDiscountGroups&quot;);
                    foreach (UltraGridRow ugr in uwgProfitSGs.Rows)
                    {
                        xWr.WriteStartElement(&quot;PDGroup&quot;);
                        //xWr.WriteElementString(&quot;ProfitDiscountDetailID&quot;, ugr.Cells.FromKey(&quot;ProfitDiscountDetailID&quot;).Text);
                        xWr.WriteElementString(&quot;GroupID&quot;, ugr.Cells.FromKey(&quot;GroupID&quot;).Text);
                        xWr.WriteElementString(&quot;DiscountValue&quot;,
                            (String.IsNullOrEmpty(ugr.Cells.FromKey(&quot;DiscountAmount&quot;).Text))
                                ? &quot;0.00&quot;
                                : ugr.Cells.FromKey(&quot;DiscountAmount&quot;).Text);
                        xWr.WriteElementString(&quot;ProfitValue&quot;,
                            (String.IsNullOrEmpty(ugr.Cells.FromKey(&quot;ProfitAmount&quot;).Text))
                                ? &quot;0.00&quot;
                                : ugr.Cells.FromKey(&quot;ProfitAmount&quot;).Text);
                        //xWr.WriteElementString(&quot;Type&quot;, ugr.Cells.FromKey(&quot;Type&quot;).Text);
                        xWr.WriteEndElement();
                    }
                    xWr.WriteEndElement();

                    xWr.Flush();

                    pdtXML = sWr.ToString2();
                }
            }

            return pdtXML;
        }

        private ItemTotalModel SetItemModel()
        {
            ItemTotalModel retModel = ItemTotalModel.GetInstance(Request, Response, null);
            return retModel;
        }

        private void BindItemDistributionGrid(int overheadDetailID)
        {
            DataTable dtOverheadItems = ItemManager.Instance.GetOverheadItemDistribution(overheadDetailID);

            if (dtOverheadItems.Columns.Contains(&quot;Percentage&quot;))
            {
                foreach (DataRow row in dtOverheadItems.Rows)
                    if (String.IsNullOrEmpty(row[&quot;Percentage&quot;].ToString2()))
                        row[&quot;Percentage&quot;] = 0;
            }

            double overheadAmount = wneAmount.ValueDouble;
            if (!dtOverheadItems.Columns.Contains(&quot;Amount&quot;))
            {
                dtOverheadItems.Columns.Add(&quot;Amount&quot;, Type.GetType(&quot;System.Double&quot;));
                foreach (DataRow row in dtOverheadItems.Rows)
                    row[&quot;Amount&quot;] = row[&quot;Percentage&quot;].ToDouble2()*0.01*overheadAmount;
            }

            uwgOverheadBOQs.DataSource = dtOverheadItems.ToMWDateTime();
            uwgOverheadBOQs.DataBind();

            SetOverheadItemGridCols();
        }

        private void BindGroupDistributionGrid(int selOverheadID)
        {
            DataTable dtOverheadItems = ItemManager.Instance.GetOverheadGroupDistribution(moduleID, parentID,
                selOverheadID);

            if (!dtOverheadItems.Columns.Contains(&quot;Amount&quot;))
            {
                dtOverheadItems.Columns.Add(&quot;Amount&quot;, Type.GetType(&quot;System.Double&quot;));
                foreach (DataRow row in dtOverheadItems.Rows)
                    row[&quot;Amount&quot;] = row[&quot;Percentage&quot;].ToDouble2()*0.01*wneAmount.ValueDouble;
            }

            uwgOverheadSGs.DataSource = dtOverheadItems.ToMWDateTime();
            uwgOverheadSGs.DataBind();

            FormatOverheadGroupsGrid();
        }

        private void SetDistributionType(int selOverheadDistributionType)
        {
            lblDistributionType.Text = ((selOverheadDistributionType == 1)
                ? &quot;Automatic Distribution&quot;
                : ((selOverheadDistributionType == 2)
                    ? string.Format(&quot;{0} Distribution&quot;, ItemNameAbbr)
                    : &quot;Scheduled Group Distribution&quot;)) + &quot; Mode&quot;;
            ClientScript.RegisterStartupScript(GetType(), &quot;ChangeDistributionType&quot;,
                &quot;document.getElementById(\&quot;&quot; + rblDistributionType.ClientID + &quot;_&quot; +
                (selOverheadDistributionType - 1).ToString2() + &quot;\&quot;).click();&quot;, true);
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;selProdisDistributionType&quot;&gt;&lt;/param&gt;
        private void SetProfitDistributionType(int selProdisDistributionType)
        {
            //lblProDisDistributionType.Text = ((selProdisDistributionType == 1) ? &quot;Automatic Distribution&quot; : ((selProdisDistributionType == 2) ? &quot;BOQ Distribution&quot; : &quot;Scheduled Group Distribution&quot;)) + &quot; Mode&quot;;
            ClientScript.RegisterStartupScript(GetType(), &quot;rbProfitDistributionTypeChange&quot;,
                &quot;document.getElementById(\&quot;&quot; + rblProfitDistributionType.ClientID + &quot;_&quot; +
                (selProdisDistributionType - 1).ToString2() + &quot;\&quot;).click();&quot;, true);
        }

        private void SetCategorySelType(int categorySelType)
        {
            trDdlCategory.Style.Clear();
            trCategoryID.Style.Clear();
            trCategoryName.Style.Clear();
            trDdlCategoryGroup.Style.Clear();

            if (categorySelType == 1)
            {
                rblCategorySelType.SelectedIndex = 0;
                trDdlCategory.Style.Add(&quot;display&quot;, &quot;table-row&quot;);
                trCategoryID.Style.Add(&quot;display&quot;, &quot;none&quot;);
                trCategoryName.Style.Add(&quot;display&quot;, &quot;none&quot;);
                trDdlCategoryGroup.Style.Add(&quot;display&quot;, &quot;none&quot;);
            }
            else if (categorySelType == 2)
            {
                rblCategorySelType.SelectedIndex = 1;
                trDdlCategory.Style.Add(&quot;display&quot;, &quot;none&quot;);
                trCategoryID.Style.Add(&quot;display&quot;, &quot;table-row&quot;);
                trCategoryName.Style.Add(&quot;display&quot;, &quot;table-row&quot;);
                trDdlCategoryGroup.Style.Add(&quot;display&quot;, &quot;table-row&quot;);
            }
            if (rblCategorySelType.Items.FindByValue(categorySelType.ToString2()) != null)
                rblCategorySelType.Items.FindByValue(categorySelType.ToString2()).Selected = true;
        }

        private void ResetOverheadDetails()
        {
            //Bind the Schedule Group Grid to an empty one for the next Add Overhead
            BindItemDistributionGrid(0);
            BindGroupDistributionGrid(0);

            trOverheadDetails.Style.Clear();
            trOverheadDetails.Style.Add(&quot;display&quot;, &quot;none&quot;);

            hdnOverheadDetailID.Value = String.Empty;
            hdnMode.Value = String.Empty;

            SetControlsForView(false);

            DisableOverheadButtons(false);

            SetCategorySelType(1);

            txtCategoryID.Text = txtCategoryName.Text = String.Empty;
            ddlCategoryGroup.SelectedIndex = 0;

            if (uwgOverheadDetails != null &amp;&amp; uwgOverheadDetails.Rows != null)
                uwgOverheadDetails.Rows.Clear();

            if (dtoOverheadDetails != null)
            {
                dtoOverheadDetails.Clear();
                dtoOverheadDetails = null;
            }

            containsDetails = false;
        }

        private void SetControlsForView(bool isView)
        {
            btnSaveOhd.Visible = rblCategorySelType.Enabled = ddlProjectCategory.Enabled
                = btnOverheadBOQDel.Enabled
                    = rblType.Enabled = !isView;
            ucItemPicker.PickerButton.Enabled = rblCategorySelType.Enabled;
            wnePercentage.Enabled = wnePercentageDisp.Enabled = wneAmount.Enabled =
                btnOverheadDetailsSubmit.Enabled =
                    btnGrpPicker.Enabled = !isView;

            if (isView)
            {
                trDistributionType.Style.Clear();
                lblDistributionType.Style.Clear();
                trDistributionType.Style.Add(&quot;display&quot;, &quot;none&quot;);
                lblDistributionType.Style.Add(&quot;display&quot;, &quot;block&quot;);
                tdTaxesOverhead.InnerText = &quot;View Overhead Details&quot;;

                if (uwgOverheadBOQs.Columns.FromKey(&quot;Percentage&quot;) != null)
                {
                    uwgOverheadBOQs.Columns.FromKey(&quot;Percentage&quot;).AllowUpdate = AllowUpdate.No;
                    uwgOverheadBOQs.Columns.FromKey(&quot;Percentage&quot;).CellStyle.BackColor = Color.White;
                }
                if (uwgOverheadSGs.Columns.FromKey(&quot;Percentage&quot;) != null)
                {
                    uwgOverheadSGs.Columns.FromKey(&quot;Percentage&quot;).AllowUpdate = AllowUpdate.No;
                    uwgOverheadSGs.Columns.FromKey(&quot;Percentage&quot;).CellStyle.BackColor = Color.White;
                }
            }
            else
            {
                lblDistributionType.Style.Clear();
                trDistributionType.Style.Clear();
                trDistributionType.Style.Add(&quot;display&quot;, &quot;table-row&quot;);
                lblDistributionType.Style.Add(&quot;display&quot;, &quot;none&quot;);

                FormatOverheadGroupsGrid();
                SetOverheadItemGridCols();
                tdTaxesOverhead.InnerText = &quot;New Overhead Details&quot;;

                btnOverheadDetailsSubmit.Enabled = true;
            }
        }

        private void DisableOverheadButtons(bool isDisabled)
        {
            btnAdd.Enabled =
                btnUpdate.Enabled =
                    btnApply.Enabled =
                        btnDelete.Enabled = !isDisabled &amp;&amp; !itemTotalModel.GetApprovalStatus(parentID, moduleID);
            btnView.Enabled = !isDisabled;
        }

        private void DisableProfitDiscountButtons(bool isDisabled)
        {
            btnSaveProfitDiscount.Enabled =
                btnCancelProDis.Enabled = !isDisabled &amp;&amp; !itemTotalModel.GetApprovalStatus(parentID, moduleID);
        }

        #endregion

        #region &quot;Formatting&quot;

        private void FormatGroupsGrid()
        {
            // to fix XSS attack
            foreach (UltraGridColumn col in uwgGroups.Columns)
            {
                col.HTMLEncodeContent = true;
            }

            ColumnsCollection cols = uwgGroups.Columns;

            cols.FromKey(&quot;GroupName&quot;).Header.Caption = &quot;Name&quot;;
            cols.FromKey(&quot;OTPPercentage&quot;).Header.Caption = &quot;Profit(%)&quot;;
            cols.FromKey(&quot;Discount&quot;).Header.Caption = &quot;Discount(%)&quot;;
            cols.FromKey(&quot;GroupTotal&quot;).Header.Caption = &quot;Scheduled Group Total&quot;;

            cols.FromKey(&quot;GroupTotalUC&quot;).Hidden = true;
            cols.FromKey(&quot;GroupID&quot;).Hidden = true;

            cols.FromKey(&quot;OTPPercentage&quot;).NullText = &quot;0.00&quot;;
            cols.FromKey(&quot;OTPPercentage&quot;).Format = &quot;###,###,##0.00&quot;;
            cols.FromKey(&quot;Discount&quot;).NullText = &quot;0.00&quot;;
            cols.FromKey(&quot;Discount&quot;).Format = &quot;###,###,##0.00&quot;;
            cols.FromKey(&quot;GroupTotal&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;

            cols.FromKey(&quot;OTPPercentage&quot;).AllowUpdate = AllowUpdate.Yes;

            if (hdnDiscountAuthority.Value == &quot;true&quot;)
                cols.FromKey(&quot;Discount&quot;).AllowUpdate = AllowUpdate.Yes;

            cols.FromKey(&quot;OTPPercentage&quot;).FieldLen = 10;
            cols.FromKey(&quot;Discount&quot;).FieldLen = 10;
        }

        private void FormatOverheadGroupsGrid()
        {
            // to fix XSS attack
            foreach (UltraGridColumn col in uwgOverheadSGs.Columns)
            {
                col.HTMLEncodeContent = true;
            }

            ColumnsCollection cols = uwgOverheadSGs.Columns;

            cols.FromKey(&quot;GroupName&quot;).Header.Caption = &quot;Name&quot;;
            cols.FromKey(&quot;GroupTotalUC&quot;).Header.Caption = &quot;Scheduled Group Total Cost&quot;;
            cols.FromKey(&quot;Amount&quot;).Header.Caption = &quot;Amount&quot;;

            cols.FromKey(&quot;GroupTotal&quot;).Hidden = true;
            cols.FromKey(&quot;GroupID&quot;).Hidden = true;
            cols.FromKey(&quot;OverheadGroupID&quot;).Hidden = true;
            cols.FromKey(&quot;OverheadDetailID&quot;).Hidden = true;

            cols.FromKey(&quot;GroupTotalUC&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
            cols.FromKey(&quot;Amount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;

            cols.FromKey(&quot;Percentage&quot;).NullText = &quot;0&quot;;
            cols.FromKey(&quot;Percentage&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE;
            cols.FromKey(&quot;Percentage&quot;).AllowUpdate = AllowUpdate.Yes;
            cols.FromKey(&quot;Percentage&quot;).FieldLen = 10;
            cols.FromKey(&quot;Percentage&quot;).CellStyle.BackColor = Color.Yellow;
        }

        protected void uwgOverhead_InitializeLayout(object sender, LayoutEventArgs e)
        {
            e.Layout.AllowAddNewDefault = AllowAddNew.Yes;
            e.Layout.AddNewBox.Hidden = true;
        }

        private void SetOverheadItemGridCols()
        {
            #region Formatting the Item Distribution Grid

            // to fix XSS attack
            foreach (UltraGridColumn col in uwgOverheadBOQs.Columns)
            {
                col.HTMLEncodeContent = true;
            }

            if (uwgOverheadBOQs.Columns.FromKey(&quot;Percentage&quot;) != null)
            {
                uwgOverheadBOQs.Columns.FromKey(&quot;Percentage&quot;).NullText = &quot;0&quot;;
                uwgOverheadBOQs.Columns.FromKey(&quot;Percentage&quot;).AllowUpdate = AllowUpdate.Yes;
                uwgOverheadBOQs.Columns.FromKey(&quot;Percentage&quot;).Format =
                    AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE;
                uwgOverheadBOQs.Columns.FromKey(&quot;Percentage&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                uwgOverheadBOQs.Columns.FromKey(&quot;Percentage&quot;).CellStyle.BackColor = Color.Yellow;
            }

            if (uwgOverheadBOQs.Columns.FromKey(&quot;BaseUnitCost&quot;) != null)
                uwgOverheadBOQs.Columns.FromKey(&quot;BaseUnitCost&quot;).Format =
                    AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;
            if (uwgOverheadBOQs.Columns.FromKey(&quot;Amount&quot;) != null)
                uwgOverheadBOQs.Columns.FromKey(&quot;Amount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
            if (uwgOverheadBOQs.Columns.FromKey(&quot;OverheadItemID&quot;) != null)
                uwgOverheadBOQs.Columns.FromKey(&quot;OverheadItemID&quot;).Hidden = true;
            if (uwgOverheadBOQs.Columns.FromKey(&quot;OverheadDetailID&quot;) != null)
                uwgOverheadBOQs.Columns.FromKey(&quot;OverheadDetailID&quot;).Hidden = true;
            if (uwgOverheadBOQs.Columns.FromKey(&quot;ItemID&quot;) != null)
                uwgOverheadBOQs.Columns.FromKey(&quot;ItemID&quot;).Hidden = true;

            #endregion
        }

        private void SetPopUpDetails()
        {
            //popupExtender = (ModalPopupExtender)this.Page.Master.FindControl(&quot;filterExtender&quot;);
            popupExtender.AddNewPopup(pnlDetails.ClientID, btn.ClientID, btnOverheadDetailsCancel.ClientID, 200, 600,
                &quot;Overhead details&quot;);
        }

        private void SetGridColumns(string Key, ValueList valList)
        {
            UltraGridColumn col = uwgOverheadDetails.Columns.FromKey(Key);
            col.Type = ColumnType.DropDownList;
            //col.EditorControlID = EditorControlID;
            col.ValueList = valList;
            col.ValueList.DisplayStyle = ValueListDisplayStyle.DisplayText;
            col.CellButtonDisplay = CellButtonDisplay.Always;
        }

        private void BindOverheadDescriptionGrid()
        {
            if (hdnMode.Value == &quot;New&quot;)
            {
                UltraGridRow row = uwgOverheadDetails.DisplayLayout.Rows[0];
                SetOverheadDescriptionGridDefaults();
                if (row == null)
                {
                    newRow = true;
                }
            }
            else if (hdnMode.Value == &quot;Update&quot; || hdnMode.Value == &quot;View&quot;)
            {
                DataTable dtDetails = ItemManager.Instance.GetOverheadDescription(int.Parse(hdnOverheadDetailID.Value));
                if (dtDetails.Rows.Count != 0)
                {
                    if (dtoOverheadDetails == null)
                    {
                        uwgOverheadDetails.DataSource = dtDetails.ToMWDateTime();
                        uwgOverheadDetails.DataBind();
                        newRow = false;
                    }
                }
                else
                {
                    UltraGridRow row = uwgOverheadDetails.DisplayLayout.Rows[0];
                    SetOverheadDescriptionGridDefaults();
                    if (row == null)
                    {
                        newRow = true;
                    }
                }
            }

            if (hdnMode.Value.ToString2().ToLower2() != &quot;view&quot;)
            {
                uwgOverheadDetails.Columns.FromKey(&quot;Quantity&quot;).AllowUpdate = AllowUpdate.Yes;
                uwgOverheadDetails.Columns.FromKey(&quot;FromMonth&quot;).AllowUpdate = AllowUpdate.Yes;
                uwgOverheadDetails.Columns.FromKey(&quot;FromYear&quot;).AllowUpdate = AllowUpdate.Yes;
                uwgOverheadDetails.Columns.FromKey(&quot;ToMonth&quot;).AllowUpdate = AllowUpdate.Yes;
                uwgOverheadDetails.Columns.FromKey(&quot;ToYear&quot;).AllowUpdate = AllowUpdate.Yes;
                uwgOverheadDetails.Columns.FromKey(&quot;Unit Cost&quot;).AllowUpdate = AllowUpdate.Yes;
            }
            uwgOverheadDetails.Columns.FromKey(&quot;Sl. No&quot;).Hidden = true;

            FormatOverheadDescriptionGrid();
        }

        private void FormatOverheadDescriptionGrid()
        {
            // to fix XSS attack
            foreach (UltraGridColumn col in uwgOverheadDetails.Columns)
            {
                col.HTMLEncodeContent = true;
            }
            ColumnsCollection cols = uwgOverheadDetails.Columns;
            if (cols.Exists(&quot;Quantity&quot;))
                cols.FromKey(&quot;Quantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
            if (cols.Exists(&quot;Unit Cost&quot;))
                cols.FromKey(&quot;Unit Cost&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;
            if (cols.Exists(&quot;Amount&quot;)) cols.FromKey(&quot;Amount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
        }

        private void SetOverheadDescriptionGridDefaults()
        {
            var dtDetails = new DataTable();

            dtDetails.Columns.Add(&quot;Sl. No&quot;); //0
            dtDetails.Columns.Add(&quot;Staff Overhead Detail&quot;); //1
            dtDetails.Columns.Add(&quot;Quantity&quot;); //2 
            dtDetails.Columns.Add(&quot;FromMonth&quot;); //3 
            dtDetails.Columns.Add(&quot;FromYear&quot;); //4
            dtDetails.Columns.Add(&quot;ToMonth&quot;); //5
            dtDetails.Columns.Add(&quot;ToYear&quot;); //6
            dtDetails.Columns.Add(&quot;Months&quot;); //7   
            dtDetails.Columns.Add(&quot;Unit Cost&quot;); //8
            dtDetails.Columns.Add(&quot;Amount&quot;); //9

            dtDetails.Rows.Add(new object[]
            {
                &quot;1&quot;, ddlProjectCategory.SelectedItem.ToString2(), &quot;&quot;,
                DateTimeFormatInfo.CurrentInfo.GetMonthName(MWDateTimeHelper.MWNow.Month), MWDateTimeHelper.MWNow.Year,
                DateTimeFormatInfo.CurrentInfo.GetMonthName(MWDateTimeHelper.MWNow.Month), MWDateTimeHelper.MWNow.Year,
                0, &quot;&quot;, &quot;&quot;
            });
            uwgOverheadDetails.DataSource = dtDetails;
            uwgOverheadDetails.DataBind();
        }

        private void ModifyOverheadDescriptionGridColumns()
        {
            var chFrom = new ColumnHeader(true);
            chFrom.Caption = &quot;From&quot;;
            chFrom.Style.HorizontalAlign = HorizontalAlign.Center;
            chFrom.RowLayoutColumnInfo.OriginY = 0;
            chFrom.RowLayoutColumnInfo.OriginX = 3;
            chFrom.RowLayoutColumnInfo.SpanX = 2;
            chFrom.RowLayoutColumnInfo.SpanY = 1;
            chFrom.Key = &quot;From&quot;;

            uwgOverheadDetails.DisplayLayout.Bands[0].HeaderLayout.Add(chFrom);

            var chTo = new ColumnHeader(true);
            chTo.Caption = &quot;To&quot;;
            chTo.Style.HorizontalAlign = HorizontalAlign.Center;
            chTo.RowLayoutColumnInfo.OriginY = 0;
            chTo.RowLayoutColumnInfo.OriginX = 5;
            chTo.RowLayoutColumnInfo.SpanX = 2;
            chTo.RowLayoutColumnInfo.SpanY = 1;
            chTo.Key = &quot;To&quot;;

            uwgOverheadDetails.DisplayLayout.Bands[0].HeaderLayout.Add(chTo);

            uwgOverheadDetails.Columns.FromKey(&quot;FromMonth&quot;).Header.RowLayoutColumnInfo.OriginY = 1;
            uwgOverheadDetails.Columns.FromKey(&quot;FromMonth&quot;).Header.Caption = &quot;Month&quot;;

            uwgOverheadDetails.Columns.FromKey(&quot;FromYear&quot;).Header.RowLayoutColumnInfo.OriginY = 1;
            uwgOverheadDetails.Columns.FromKey(&quot;FromYear&quot;).Header.Caption = &quot;Year&quot;;

            uwgOverheadDetails.Columns.FromKey(&quot;ToMonth&quot;).Header.RowLayoutColumnInfo.OriginY = 1;
            uwgOverheadDetails.Columns.FromKey(&quot;ToMonth&quot;).Header.Caption = &quot;Month&quot;;

            uwgOverheadDetails.Columns.FromKey(&quot;ToYear&quot;).Header.RowLayoutColumnInfo.OriginY = 1;
            uwgOverheadDetails.Columns.FromKey(&quot;ToYear&quot;).Header.Caption = &quot;Year&quot;;

            foreach (UltraGridColumn col in uwgOverheadDetails.Columns)
            {
                if (col.Key != &quot;From_G&quot; &amp;&amp; col.Key != &quot;To_G&quot; &amp;&amp; col.Key != &quot;FromMonth&quot; &amp;&amp; col.Key != &quot;FromYear&quot; &amp;&amp;
                    col.Key != &quot;ToMonth&quot; &amp;&amp; col.Key != &quot;ToYear&quot;)
                {
                    col.Header.RowLayoutColumnInfo.SpanY = 2;
                }
            }

            uwgOverheadDetails.DisplayLayout.AllowSortingDefault = AllowSorting.No;

            FormatOverheadDescriptionGrid();
        }

        private void SetWebComboDropDowns()
        {
            var dtMonths = new DataTable();
            dtMonths.Columns.Add(&quot;Month&quot;);
            dtMonths.Columns.Add(&quot;MonthNo&quot;);

            var months = new[]
            {
                &quot;January&quot;, &quot;February&quot;, &quot;March&quot;, &quot;April&quot;, &quot;May&quot;, &quot;June&quot;, &quot;July&quot;, &quot;August&quot;, &quot;September&quot;,
                &quot;October&quot;, &quot;November&quot;, &quot;December&quot;
            };

            int monthNo = 0;
            foreach (string month in months)
            {
                dtMonths.Rows.Add(new object[] { month, monthNo });
                monthNo++;
            }
            UIHelper.BindDropDownData(valListFromMonth, dtMonths, &quot;month&quot;, &quot;month&quot;);
            UIHelper.BindDropDownData(valListToMonth, dtMonths, &quot;month&quot;, &quot;month&quot;);

            var dtYears = new DataTable();
            dtYears.Columns.Add(&quot;Years&quot;);

            for (int i = 1984; i &lt; 2050; i++)
                dtYears.Rows.Add(i);

            UIHelper.BindDropDownData(valListFromYear, dtYears, &quot;Years&quot;, &quot;Years&quot;);
            UIHelper.BindDropDownData(valListToYear, dtYears, &quot;Years&quot;, &quot;Years&quot;);
            //wdcToMonth.SelectedIndex = wdcFromMonth.SelectedIndex = DateTime.UtcNow.Month;
            //wdcToYear.SelectedIndex = wdcFromYear.SelectedIndex = DateTime.UtcNow.Year;
        }

        #endregion

        #region &quot;Button Clicks&quot;

        protected void btnApply_Click(object sender, EventArgs e)
        {
            int result = ItemManager.Instance.CreateItemTotalDetails(parentID, moduleID,
                wneDiscount.ValueDecimal,
                wneProfitMargin.ValueDecimal,
                GetOverHeadAndTaxesDetail(), GetGroupXML());
            if (result &gt;= 0)
                DataInitialization();
        }

        protected void btnUpdate_Click(object sender, EventArgs e)
        {
            string selOverheadIDs = hdnItemIDList.Value;
            if (selOverheadIDs.Equals(&quot;,&quot;) || (selOverheadIDs.Substring(1, selOverheadIDs.LastIndexOf(&quot;,&quot;)).Length &lt;= 0))
            {
                string errMessage = &quot;Select category to edit.&quot;;
                ClientScript.RegisterStartupScript(GetType(), &quot;EditAlert&quot;, &quot;ShowError(&#39;&quot; + errMessage + &quot;&#39;);&quot;, true);
                return;
            }
            int selOverheadID = 0;
            Int32.TryParse(selOverheadIDs.Substring(1, selOverheadIDs.LastIndexOf(&quot;,&quot;) - 1), out selOverheadID);

            int selOverheadDistributionType = 1;
            int selOverheadType = 0; //0 - Percentage based, 1 - Amount based

            DataRow[] rows = hGridOverhead.ItemTable.Select(ohDetailsID + &quot;=&quot; + selOverheadID);
            DataRow selRow = rows[0];

            if (selRow != null)
            {
                selOverheadID = selRow[ohDetailsID].ToString2().ToInt32_2();
                Int32.TryParse(selRow[&quot;DistributionType&quot;].ToString2(), out selOverheadDistributionType);
                selOverheadType = (selRow[&quot;Type&quot;].ToString2().Equals(&quot;P&quot;)) ? 0 : 1;
            }

            rblType.SelectedIndex = selOverheadType;

            #region Setting form controls&#39; state based on Overhead Type

            if (selOverheadType == 0) //Percentage based
            {
                wneAmount.Enabled = false;
                wnePercentage.Enabled = true;
                wnePercentageDisp.Enabled = true;
            }
            else //Amount based
            {
                wneAmount.Enabled = true;
                wnePercentage.Enabled = false;
                wnePercentageDisp.Enabled = false;
            }

            #endregion

            #region If associated with details, disable all form controls

            if (selRow[&quot;Sl. No&quot;].ToString2() != &quot;&quot;)
            {
                rblType.Enabled =
                    wneAmount.Enabled =
                        wnePercentage.Enabled =
                            wnePercentageDisp.Enabled = false;

                containsDetails = true;
            }
            else
            {
                rblType.Enabled =
                    wneAmount.Enabled =
                        wnePercentage.Enabled =
                            wnePercentageDisp.Enabled = true;

                containsDetails = false;
            }

            #endregion

            //Loading the Values from the Grid for Edit
            hdnMode.Value = &quot;Update&quot;;
            tdTaxesOverhead.InnerText = &quot;Edit Overhead Details&quot;;

            foreach (ListItem li in ddlProjectCategory.Items)
                li.Selected = li.Value.Equals(selRow[ohCategoryID].ToString2());

            wnePercentage.ValueDouble = selRow[&quot;Percentage&quot;].ToDouble2();
            wnePercentageDisp.ValueDouble = selRow[&quot;Percentage&quot;].ToDouble2();
            wneAmount.ValueDouble = selRow[&quot;Amount&quot;].ToDouble2();
            hdnDistributionType.Value = selOverheadDistributionType.ToString2();
            txtGroup.Text = selRow[&quot;Parent Group&quot;].ToString2();

            #region If associated with details, disable all form controls

            if (selRow[&quot;Sl. No&quot;].ToString2() != &quot;&quot;)
            {
                containsDetails = true;
            }
            else
            {
                containsDetails = false;
            }

            #endregion

            //Page.ClientScript.RegisterStartupScript(this.GetType(), &quot;enable&quot;, &quot;enable(&#39;&quot; + selRow.Cells.FromKey(&quot;Type&quot;).Value.ToString2() + &quot;&#39;);&quot;, true);

            RetainDisplay(selOverheadDistributionType, 1);

            if (selOverheadDistributionType == 2)
            {
                //Binding Item Distribution Grid of the selected Overhead
                BindItemDistributionGrid(selOverheadID);
            }
            else if (selOverheadDistributionType == 3)
            {
                //Binding Group Distribution Grid of the selected Overhead
                BindGroupDistributionGrid(selOverheadID);
            }

            //Set the hidden field as OverheadDetailID
            hdnOverheadDetailID.Value = selOverheadID.ToString2();
            RetainProfitDiscountDisplay();
        }

        protected void btnView_Click(object sender, EventArgs e)
        {
            int selOverheadDistributionType = 1;
            int selOverheadType = 0; //0 - Percentage based, 1 - Amount based

            string selOverheadIDs = hdnItemIDList.Value;
            if (selOverheadIDs.Equals(&quot;,&quot;) || (selOverheadIDs.Substring(1, selOverheadIDs.LastIndexOf(&quot;,&quot;)).Length &lt;= 0))
            {
                string errMessage = &quot;Select category to view.&quot;;
                ClientScript.RegisterStartupScript(GetType(), &quot;ViewAlert&quot;, &quot;ShowError(&#39;&quot; + errMessage + &quot;&#39;);&quot;, true);
                return;
            }
            int selOverheadID = 0;
            Int32.TryParse(selOverheadIDs.Substring(1, selOverheadIDs.LastIndexOf(&quot;,&quot;) - 1), out selOverheadID);

            DataRow[] rows = hGridOverhead.ItemTable.Select(ohDetailsID + &quot;=&quot; + selOverheadID);
            DataRow selRow = rows[0];

            if (selRow != null)
            {
                selOverheadID = selRow[ohDetailsID].ToString2().ToInt32_2();
                Int32.TryParse(selRow[&quot;DistributionType&quot;].ToString2(), out selOverheadDistributionType);
                selOverheadType = (selRow[&quot;Type&quot;].ToString2().Equals(&quot;P&quot;)) ? 0 : 1;
            }

            rblType.SelectedIndex = selOverheadType;

            containsDetails = true;

            //Loading the Values from the Grid for Edit
            hdnMode.Value = &quot;View&quot;;

            foreach (ListItem li in ddlProjectCategory.Items)
                li.Selected = li.Value.Equals(selRow[ohCategoryID].ToString2());

            wnePercentage.ValueDouble = selRow[&quot;Percentage&quot;].ToDouble2();
            wnePercentageDisp.ValueDouble = selRow[&quot;Percentage&quot;].ToDouble2();
            wneAmount.ValueDouble = selRow[&quot;Amount&quot;].ToDouble2();
            hdnDistributionType.Value = selOverheadDistributionType.ToString2();
            txtGroup.Text = selRow[&quot;Parent Group&quot;].ToString2();

            RetainDisplay((selOverheadDistributionType == 1) ? 2 : selOverheadDistributionType, 1);
            if (selOverheadDistributionType == 1) lblDistributionType.Text = &quot;Automatic Distribution&quot;;

            if (selOverheadDistributionType == 1 || selOverheadDistributionType == 2)
            {
                //Binding Item Distribution Grid of the selected Overhead
                BindItemDistributionGrid(selOverheadID);
            }
            else if (selOverheadDistributionType == 3)
            {
                //Binding Group Distribution Grid of the selected Overhead
                BindGroupDistributionGrid(selOverheadID);
            }

            SetControlsForView(true);

            //Set the hidden field as OverheadDetailID
            hdnOverheadDetailID.Value = selOverheadID.ToString2();
            RetainProfitDiscountDisplay();
        }

        protected void btnSaveOhd_Click(object sender, EventArgs e)
        {
            int selOverheadDetailID = 0;
            Int32.TryParse(hdnOverheadDetailID.Value, out selOverheadDetailID);

            //Save All Information in the form
            btnApply_Click(sender, e);

            int selOverheadDistributionType = 0;
            Int32.TryParse(hdnDistributionType.Value, out selOverheadDistributionType);

            bool isNewCategory = (rblCategorySelType.SelectedItem.Value == &quot;2&quot;);
            string overheadDescription = String.Empty;
            string overheadCategoryID = String.Empty;


            string[] temp = txtGroup.Text.Split(&quot;/&quot;.ToCharArray());
            selectedNode = temp[temp.Length - 1];


            if (isNewCategory)
            {
                try
                {
                    #region Save New Category to AX

                    var dsNewCategory = new DataSet();
                    dsNewCategory.Tables.Add(new DataTable());
                    dsNewCategory.Tables[0].Columns.Add(&quot;CategoryId&quot;, Type.GetType(&quot;System.String&quot;));
                    dsNewCategory.Tables[0].Columns.Add(&quot;Name&quot;, Type.GetType(&quot;System.String&quot;));
                    dsNewCategory.Tables[0].Columns.Add(&quot;CategoryGroupId&quot;, Type.GetType(&quot;System.String&quot;));

                    DataRow catRow = dsNewCategory.Tables[0].NewRow();
                    catRow[&quot;CategoryId&quot;] = txtCategoryID.Text;
                    catRow[&quot;Name&quot;] = txtCategoryName.Text;
                    catRow[&quot;CategoryGroupId&quot;] = ddlCategoryGroup.SelectedItem.Value;
                    dsNewCategory.Tables[0].Rows.Add(catRow);

                    ItemManager.Instance.AddProjectCategory(Session[Constants.EIS_ADDITIONAL_INFO].ToString2(),
                        dsNewCategory);

                    #endregion

                    overheadCategoryID = txtCategoryID.Text;
                    overheadDescription = txtCategoryName.Text;
                }
                catch (Exception ex)
                {
                    AlertError(ex.Message);
                    RetainDisplay(selOverheadDistributionType, 2);
                    return;
                }
            }
            else
            {
                overheadCategoryID = (ddlProjectCategory.SelectedIndex &gt; 0)
                    ? ddlProjectCategory.SelectedItem.Value
                    : null;

                if (overheadCategoryID != null)
                {
                    DataTable dtProjectCategories = new DataTable();
                    if (IsERPConnected)
                    {
                        DataSet dsProjectCategories =
                            ItemManager.Instance.GetProjectCategoryList(
                                Session[Constants.EIS_ADDITIONAL_INFO].ToString2());
                        if (dsProjectCategories != null &amp;&amp; dsProjectCategories.Tables.Count &gt; 0)
                            dtProjectCategories = dsProjectCategories.Tables[0];
                    }
                    else
                    {
                        dtProjectCategories = ItemManager.Instance.GetLibraryCategories();

                        if (dtProjectCategories.Columns.Contains(&quot;ID&quot;))
                            dtProjectCategories.Columns[&quot;ID&quot;].ColumnName = &quot;CategoryId&quot;;
                        if (dtProjectCategories.Columns.Contains(&quot;CategoryName&quot;))
                            dtProjectCategories.Columns[&quot;CategoryName&quot;].ColumnName = &quot;Name&quot;;
                    }

                    if (dtProjectCategories != null)
                    {
                        DataRow[] selCategory = dtProjectCategories.Select(&quot;CategoryId=&#39;&quot; + overheadCategoryID + &quot;&#39;&quot;);
                        if (selCategory.Length &gt; 0)
                            overheadDescription = selCategory[0][&quot;Name&quot;].ToString2();
                        else
                            overheadDescription = ddlProjectCategory.SelectedItem.Text;
                    }
                    else
                        overheadDescription = ddlProjectCategory.SelectedItem.Text;
                }
                else
                {
                    AlertError(&quot;Please select a Category.&quot;);
                    RetainDisplay(selOverheadDistributionType, 1);
                    return;
                }
            }

            #region Unique ERPCategoryID Validation

            bool uniqueItem = true;

            foreach (DataRow row in hGridOverhead.ItemTable.Rows)
            {
                if (hdnMode.Value.Equals(&quot;Update&quot;))
                {
                    if (hdnMode.Value.Equals(&quot;Update&quot;) &amp;&amp; row[ohDetailsID] != null &amp;&amp;
                        row[ohDetailsID].ToString2().Equals(selOverheadDetailID.ToString2()))
                        continue;
                    if (row[ohCategoryID].ToString2().Equals(overheadCategoryID))
                    {
                        uniqueItem = false;
                        break;
                    }
                }
                else
                {
                    if (row[ohCategoryID].ToString2().Equals(ddlProjectCategory.SelectedItem.Value))
                    {
                        uniqueItem = false;
                        break;
                    }
                    else
                        continue;
                }
            }

            if (!uniqueItem)
            {
                AlertError(&quot;Please select a unique Category.&quot;);
                RetainDisplay(selOverheadDistributionType, 1);
                return;
            }

            string Opn = (hdnMode.Value.ToLower2().Trim() == &quot;new&quot; ? &quot;C&quot; : &quot;U&quot;);

            #endregion

            if (ItemManager.Instance.GetOverheadGroupDetails(selectedNode).Tables[0].Rows.Count &lt;= 0)
            {
                AlertError(&quot;Overhead group deleted by other user.&quot;);
                RetainDisplay(selOverheadDistributionType, 1);
                return;
            }
            if (selOverheadDistributionType == 1)
            {
                //Save Overhead Details - Mode from Hidden Field
                int numRows = ItemManager.Instance.CUDOverheadDetails(moduleID, parentID, 0, selOverheadDetailID,
                    overheadDescription,
                    overheadCategoryID,
                    (rblType.SelectedValue == &quot;P&quot;
                        ? wnePercentage.ValueDouble
                        : 0), &quot;&lt;OverHeadItems&gt;&lt;/OverHeadItems&gt;&quot;,
                    selOverheadDistributionType, selectedNode,
                    (rblType.SelectedValue == &quot;P&quot;
                        ? 0
                        : wneAmount.ValueDecimal),
                    rblType.SelectedValue, hdnMode.Value);
                if (dtoOverheadDetails != null &amp;&amp; dtoOverheadDetails.Rows.Count &gt; 0)
                {
                    DataRow dtRow = dtoOverheadDetails.Rows[0];
                    ItemManager.Instance.CUDOverheadDescription((newRow ? 0 : int.Parse(dtRow[&quot;ID&quot;].ToString2())),
                        ddlProjectCategory.SelectedValue, parentID, moduleID,
                        int.Parse(
                            decimal.Truncate(
                                decimal.Parse(dtRow[&quot;Quantity&quot;].ToString2())).
                                ToString2()), dtRow[&quot;FromMonth&quot;].ToString2(),
                        int.Parse(dtRow[&quot;FromYear&quot;].ToString2()),
                        dtRow[&quot;ToMonth&quot;].ToString2(),
                        int.Parse(dtRow[&quot;ToYear&quot;].ToString2()),
                        int.Parse(dtRow[&quot;Months&quot;].ToString2()),
                        decimal.Parse(dtRow[&quot;UnitCost&quot;].ToString2()),
                        decimal.Parse(dtRow[&quot;Amount&quot;].ToString2()), Opn);
                }
            }
            else if (selOverheadDistributionType == 2)
            {
                string validatePercentageResult = String.Empty;
                validatePercentageResult = ValidatePercentage(uwgOverheadBOQs, &quot;Percentage&quot;);
                if (!validatePercentageResult.Equals(String.Empty))
                {
                    AlertError(validatePercentageResult);
                    RetainDisplay(selOverheadDistributionType, 1);
                    return;
                }
                else
                {
                    //Save Overhead Details - Mode from Hidden Field
                    int numRows = ItemManager.Instance.CUDOverheadDetails(moduleID, parentID, 0, selOverheadDetailID,
                        overheadDescription,
                        overheadCategoryID,
                        (rblType.SelectedValue == &quot;P&quot;
                            ? wnePercentage.ValueDouble
                            : 0), GetOverheadItemDistributionXML(),
                        selOverheadDistributionType, selectedNode,
                        (rblType.SelectedValue == &quot;P&quot;
                            ? 0
                            : wneAmount.ValueDecimal),
                        rblType.SelectedValue, hdnMode.Value);
                    if (dtoOverheadDetails != null &amp;&amp; dtoOverheadDetails.Rows.Count &gt; 0)
                    {
                        DataRow dtRow = dtoOverheadDetails.Rows[0];
                        ItemManager.Instance.CUDOverheadDescription((newRow ? 0 : int.Parse(dtRow[&quot;ID&quot;].ToString2())),
                            ddlProjectCategory.SelectedValue, parentID, moduleID,
                            int.Parse(
                                decimal.Truncate(
                                    decimal.Parse(dtRow[&quot;Quantity&quot;].ToString2()))
                                    .ToString2()),
                            dtRow[&quot;FromMonth&quot;].ToString2(),
                            int.Parse(dtRow[&quot;FromYear&quot;].ToString2()),
                            dtRow[&quot;ToMonth&quot;].ToString2(),
                            int.Parse(dtRow[&quot;ToYear&quot;].ToString2()),
                            int.Parse(dtRow[&quot;Months&quot;].ToString2()),
                            decimal.Parse(dtRow[&quot;UnitCost&quot;].ToString2()),
                            decimal.Parse(dtRow[&quot;Amount&quot;].ToString2()), Opn);
                    }
                }
            }
            else if (selOverheadDistributionType == 3)
            {
                string validatePercentageResult = String.Empty;
                validatePercentageResult = ValidatePercentage(uwgOverheadSGs, &quot;Percentage&quot;);
                if (!validatePercentageResult.Equals(String.Empty))
                {
                    AlertError(validatePercentageResult);
                    RetainDisplay(selOverheadDistributionType, 1);
                    return;
                }
                else
                {
                    //Save Overhead Details - Mode from Hidden Field
                    int numRows = ItemManager.Instance.CUDOverheadDetails(moduleID, parentID, 0, selOverheadDetailID,
                        overheadDescription,
                        overheadCategoryID,
                        (rblType.SelectedValue == &quot;P&quot;
                            ? wnePercentage.ValueDouble
                            : 0), GetOverheadGroupDistributionXML(),
                        selOverheadDistributionType, selectedNode,
                        (rblType.SelectedValue == &quot;P&quot;
                            ? 0
                            : wneAmount.ValueDecimal),
                        rblType.SelectedValue, hdnMode.Value);
                    if (dtoOverheadDetails != null &amp;&amp; dtoOverheadDetails.Rows.Count &gt; 0)
                    {
                        DataRow dtRow = dtoOverheadDetails.Rows[0];
                        ItemManager.Instance.CUDOverheadDescription((newRow ? 0 : int.Parse(dtRow[&quot;ID&quot;].ToString2())),
                            ddlProjectCategory.SelectedValue, parentID, moduleID,
                            int.Parse(
                                decimal.Truncate(
                                    decimal.Parse(dtRow[&quot;Quantity&quot;].ToString2()))
                                    .ToString2()),
                            dtRow[&quot;FromMonth&quot;].ToString2(),
                            int.Parse(dtRow[&quot;FromYear&quot;].ToString2()),
                            dtRow[&quot;ToMonth&quot;].ToString2(),
                            int.Parse(dtRow[&quot;ToYear&quot;].ToString2()),
                            int.Parse(dtRow[&quot;Months&quot;].ToString2()),
                            decimal.Parse(dtRow[&quot;UnitCost&quot;].ToString2()),
                            decimal.Parse(dtRow[&quot;Amount&quot;].ToString2()), Opn);
                    }
                }
            }

            DataInitialization();
            BindOverheadGrid();

            ResetOverheadDetails();
            BindProjectCategoryAndCategoryGroups();
            BindProfitDiscountGroupDistributionGrid();
            if (!string.IsNullOrEmpty(rblProfitDistributionType.SelectedValue) &amp;&amp;
                (((Distribution)rblProfitDistributionType.SelectedValue.ToInt32_2()) == Distribution.BOQ))
            {
                BindProfitDiscountDetails();
            }
            //itemPickerboq.InitializeGrid();

            //rdAmt.Enabled =
            //rdPercentage.Enabled =

            rblType.Enabled =
                wnePercentageDisp.Enabled =
                    wnePercentage.Enabled =
                        wneAmount.Enabled = true;

            if (rblType.SelectedIndex &lt; 0)
            {
                rblType.SelectedIndex = (Convert.ToDecimal(wnePercentage.Text) &gt; 0) ? 0 : 1;
                wnePercentageDisp.Enabled = !(Convert.ToDecimal(wnePercentage.Text) &gt; 0);
                wnePercentage.Enabled = (Convert.ToDecimal(wnePercentageDisp.Text) &gt; 0);
            }

            if (uwgOverheadDetails != null &amp;&amp; uwgOverheadDetails.Rows != null)
                uwgOverheadDetails.Rows.Clear();

            if (dtoOverheadDetails != null)
            {
                dtoOverheadDetails.Clear();
                dtoOverheadDetails = null;
            }
            txtGroup.Text = &quot;&quot;;
            selectedNode = &quot;&quot;;
        }

        protected void btnDelete_Click(object sender, EventArgs e)
        {
            string selOverheadIDs = hdnItemIDList.Value;
            int selOverheadID = 0;
            string selOverheadGroupIds = hdnContainerIDList.Value;
            int selOverheadGroupId = 0;
            if (!String.IsNullOrEmpty(selOverheadIDs) &amp;&amp; !selOverheadIDs.Equals(&quot;,&quot;))
            {
                Int32.TryParse(selOverheadIDs.Substring(1, selOverheadIDs.LastIndexOf(&quot;,&quot;) - 1), out selOverheadID);

                DataRow[] rows = hGridOverhead.ItemTable.Select(ohDetailsID + &quot;=&quot; + selOverheadID);
                DataRow selRow = rows[0];

                if (selRow != null)
                    selOverheadID = selRow[ohDetailsID].ToString2().ToInt32_2();
            }
            if (!String.IsNullOrEmpty(selOverheadGroupIds) &amp;&amp; !selOverheadGroupIds.Equals(&quot;,&quot;))
            {
                Int32.TryParse(selOverheadGroupIds.Substring(1, selOverheadGroupIds.LastIndexOf(&quot;,&quot;) - 1),
                    out selOverheadGroupId);

                DataRow[] rows = hGridOverhead.ContainerTable.Select(&quot;ContainerID=&quot; + selOverheadGroupId);
                DataRow selRow = rows[0];

                if (selRow != null)
                    selOverheadGroupId = selRow[&quot;ContainerID&quot;].ToString2().ToInt32_2();
            }
            //Delete Overhead Details - Mode as Delete
            int numRows = ItemManager.Instance.CUDOverheadDetails(moduleID, parentID, selOverheadGroupId, selOverheadID,
                String.Empty, String.Empty,
                0, &quot;&lt;OverHeadItems&gt;&lt;/OverHeadItems&gt;&quot;, 0, &quot;&quot;, 0, &quot;&quot;,
                &quot;Delete&quot;);

            trOverheadDetails.Style.Remove(&quot;display&quot;);
            trOverheadDetails.Style.Add(&quot;display&quot;, &quot;none&quot;);
            BindProfitDiscountGroupDistributionGrid();
            DataInitialization();
            RetainProfitDiscountDisplay();
            hdnOverheadDetailID.Value = String.Empty;
        }

        protected void btnCancelOhd_Click(object sender, EventArgs e)
        {
            ResetOverheadDetails();
            SetDistributionType(1);
            RetainProfitDiscountDisplay();
        }

        protected void btnGrpPicker_Click(object sender, EventArgs e)
        {
            //RetainDisplay(rblDistributionType.SelectedIndex + 1, 1);

            DivOTMain.Visible = false;
            divQuot.Visible = false;
            DivGrpPicker.Visible = true;

            MainToolBar.Visible = true;
            MainToolBar.AddMenu(new BrixMenu(&quot;lnkCancel&quot;, &quot;Cancel&quot;, &quot;Icn_Cancel.png&quot;), MenuStyle.LargeButton);
            MainToolBar.GetMenuReference(&quot;lnkCancel&quot;).OnClientClick = &quot;return cancel();&quot;;
            MainToolBar.GetMenuReference(&quot;lnkCancel&quot;).Click += btnSelectCancel_Click;
            MainToolBar.Bind();
            RetainProfitDiscountDisplay();
        }

        protected void lnkDetails_Click(object sender, EventArgs e)
        {
            BindOverheadDescriptionGrid();

            SetWebComboDropDowns();

            ModifyOverheadDescriptionGridColumns();

            SetGridColumns(&quot;FromMonth&quot;, valListFromMonth);
            SetGridColumns(&quot;FromYear&quot;, valListFromYear);

            SetGridColumns(&quot;ToMonth&quot;, valListToMonth);
            SetGridColumns(&quot;ToYear&quot;, valListToYear);

            RetainDisplay(rblDistributionType.SelectedIndex + 1, 1);
            hdnDetailsPopup.Value = &quot;1&quot;;

            Page.ClientScript.RegisterStartupScript(this.GetType(), &quot;S&quot;,
                @&quot;document.getElementById(&quot; + &quot;&#39;&quot; + btn.ClientID + &quot;&#39;&quot; + &quot;).click();&quot;, true);
        }

        protected void btnSelectCancel_Click(object sender, EventArgs e)
        {
            DivOTMain.Visible = true;
            divQuot.Visible = false;
            DivGrpPicker.Visible = false;
            MainToolBar.Visible = false;
            txtGroup.Text = &quot;&quot;;
        }

        protected void btnOverheadDetailsSubmit_Click(object sender, EventArgs e)
        {
            RetainDisplay(rblDistributionType.SelectedIndex + 1, 1);
            hdnDetailsPopup.Value = &quot;0&quot;;
            UltraGridRow row = uwgOverheadDetails.DisplayLayout.Rows[0];

            if (row.Cells.FromKey(&quot;Amount&quot;).Value.ToString2() != &quot;&quot;)
            {
                dtoOverheadDetails = new DataTable();
                dtoOverheadDetails.Columns.Add(&quot;ID&quot;);
                dtoOverheadDetails.Columns.Add(&quot;OverheadDetailsID&quot;);
                dtoOverheadDetails.Columns.Add(&quot;Quantity&quot;);
                dtoOverheadDetails.Columns.Add(&quot;FromMonth&quot;);
                dtoOverheadDetails.Columns.Add(&quot;FromYear&quot;);
                dtoOverheadDetails.Columns.Add(&quot;ToMonth&quot;);
                dtoOverheadDetails.Columns.Add(&quot;ToYear&quot;);
                dtoOverheadDetails.Columns.Add(&quot;Months&quot;);
                dtoOverheadDetails.Columns.Add(&quot;UnitCost&quot;);
                dtoOverheadDetails.Columns.Add(&quot;Amount&quot;);

                dtoOverheadDetails.Rows.Add(new[]
                {
                    row.Cells.FromKey(&quot;Sl. No&quot;),
                    &quot;&quot;,
                    row.Cells.FromKey(&quot;Quantity&quot;).Value,
                    row.Cells.FromKey(&quot;FromMonth&quot;).Text,
                    row.Cells.FromKey(&quot;FromYear&quot;).Value,
                    row.Cells.FromKey(&quot;ToMonth&quot;).Text,
                    row.Cells.FromKey(&quot;ToYear&quot;).Value,
                    row.Cells.FromKey(&quot;Months&quot;).Value,
                    row.Cells.FromKey(&quot;Unit Cost&quot;).Value,
                    row.Cells.FromKey(&quot;Amount&quot;).Value
                });


                rblType.SelectedIndex = 1;

                rblType.Enabled =
                    wnePercentageDisp.Enabled =
                        wnePercentage.Enabled =
                            wneAmount.Enabled = false;

                try
                {
                    wnePercentageDisp.ValueDecimal =
                        wnePercentage.ValueDecimal =
                            (decimal.Parse(row.Cells.FromKey(&quot;Amount&quot;).Value.ToString2())/wneOrigBaseCost.ValueDecimal)*
                            100;
                }
                catch (Exception)
                {
                    wnePercentageDisp.ValueDecimal =
                        wnePercentage.ValueDecimal = 0;
                }

                wneAmount.ValueDecimal = decimal.Parse(row.Cells.FromKey(&quot;Amount&quot;).Value.ToString2());

                containsDetails = true;
            }
        }

        protected void btnCancelProDis_Click(object sender, EventArgs e)
        {
            ProfitDiscountDataInitialisation();
            rblProfitDistributionType.ClearSelection();
            //SetDistributionType(Distribution.Auto.ToInt32_2());
            if (uwgProfitBOQs != null &amp;&amp; uwgProfitBOQs.Rows != null)
                uwgProfitBOQs.Rows.Clear();
            wneProfitPercentage.Value = wneDiscountPercentage.Value = wneProAmount.Value = wneDisAmount.Value = null;
            if (rblDistributionType.SelectedIndex == 0)
                trOverheadDetails.Style.Add(&quot;display&quot;, &quot;none&quot;);
            else if (rblDistributionType.SelectedIndex == 1)
                RetainDisplay(2, 1);
            else if (rblDistributionType.SelectedIndex == 2)
                RetainDisplay(3, 1);
        }

        protected void btnSaveProfitDiscount_Click(object sender, EventArgs e)
        {
            try
            {
                decimal profitPer = (!string.IsNullOrEmpty(rblProfitDistributionType.SelectedValue) &amp;&amp;
                                     (((Distribution)(rblProfitDistributionType.SelectedValue.ToInt32_2()) ==
                                       Distribution.Auto)))
                    ? (double.IsNaN(wneProAmount.ValueDouble)
                        ? -1
                        : Convert.ToDecimal(wneProAmount.Value))
                    : 0;

                decimal disPer = (!string.IsNullOrEmpty(rblProfitDistributionType.SelectedValue) &amp;&amp;
                                  (((Distribution)rblProfitDistributionType.SelectedValue.ToInt32_2()) ==
                                   Distribution.Auto))
                    ? (double.IsNaN(wneDisAmount.ValueDouble)
                        ? -1
                        : Convert.ToDecimal(wneDisAmount.Value))
                    : 0;

                string xml = (!string.IsNullOrEmpty(rblProfitDistributionType.SelectedValue) &amp;&amp;
                              (((Distribution)(rblProfitDistributionType.SelectedValue.ToInt32_2()) ==
                                Distribution.Auto)))
                    ? &quot;&lt;ProfitDiscountItems&gt;&lt;/ProfitDiscountItems&gt;&quot;
                    : ((!string.IsNullOrEmpty(rblProfitDistributionType.SelectedValue) &amp;&amp;
                        (((Distribution)rblProfitDistributionType.SelectedValue.ToInt32_2()) ==
                         Distribution.BOQ))
                        ? GetProfitDiscountItemDistributionXML()
                        : GetProfitDiscountGroupDistributionXML());

                //Save Profit Discount  Details
                int numRows = ItemManager.Instance.CUDProfitDiscountDetails(moduleID, parentID,
                    Convert.ToInt32(
                        rblProfitDistributionType.SelectedValue),
                    profitPer,
                    disPer, xml);

                DataInitialization();
                ProfitDiscountDataInitialisation();
                rblProfitDistributionType.ClearSelection();
                //itemPickerboq.InitializeGrid();
            }
            catch (Exception ex)
            {
                AlertError(ex.Message);
                return;
            }
        }

        // End of profit margin and discount code

        #endregion

        #region &quot;Item Picker Events&quot;

        private void itemPicker_SelectedIndexChanged(object sender, ClickEventArgs e)
        {
            List&lt;Item&gt; selItems = itemPicker.GetMultipleDTOFromHTTP();
            RetainProfitDiscountDisplay();
            RetainDisplay(2, 1);

            int selOverheadID = 0;
            Int32.TryParse(hdnOverheadDetailID.Value, out selOverheadID);

            foreach (Item selItem in selItems)
            {
                bool foundInGrid = false;
                foreach (UltraGridRow ugr in uwgOverheadBOQs.Rows)
                {
                    if (ugr.Cells.FromKey(&quot;ItemID&quot;) != null &amp;&amp; ugr.Cells.FromKey(&quot;ItemID&quot;).Value.Equals(selItem.ItemID))
                    {
                        foundInGrid = true;
                        break;
                    }
                }
                if (!foundInGrid)
                {
                    var newRow = new UltraGridRow(true);
                    uwgOverheadBOQs.Rows.Add(newRow);

                    newRow.Cells.FromKey(&quot;OverheadItemID&quot;).Value = null;
                    newRow.Cells.FromKey(&quot;OverheadDetailID&quot;).Value = selOverheadID;
                    newRow.Cells.FromKey(&quot;ItemID&quot;).Value = selItem.ItemID.GetValueOrDefault();
                    newRow.Cells.FromKey(&quot;StandardItemNo&quot;).Value = selItem.StandardItemNo;
                    newRow.Cells.FromKey(&quot;Description&quot;).Value = selItem.Description;
                    newRow.Cells.FromKey(&quot;BaseUnitCost&quot;).Value = selItem.BaseUnitCost.GetValueOrDefault();
                    newRow.Cells.FromKey(&quot;Percentage&quot;).Value = 0.00;
                    newRow.Cells.FromKey(&quot;Percentage&quot;).Style.BackColor = Color.Yellow;
                    newRow.Cells.FromKey(&quot;Amount&quot;).Value = 0.00;
                }
            }
            itemPicker.PickerText.Text = &quot;&quot;;
        }

        private void ContainerGrpTree_NodeClicked(object sender, EventArgs e)
        {
            if (String.IsNullOrEmpty(hdnCancelClicked.Value) || hdnCancelClicked.Value == &quot;No&quot;)
            {
                txtGroup.Text = ContainerGrpTree.SelectedNodePath;
                selectedNode = ContainerGrpTree.SelectedNode.Text;
            }
            hdnCancelClicked.Value = &quot;No&quot;;
            DivOTMain.Visible = true;
            divQuot.Visible = false;
            DivGrpPicker.Visible = false;

            if (rblType.SelectedIndex &lt; 0)
            {
                rblType.SelectedIndex = (Convert.ToDecimal(wnePercentage.Text) &gt; 0) ? 0 : 1;
                wnePercentageDisp.Enabled = !(Convert.ToDecimal(wnePercentage.Text) &gt; 0);
                wnePercentage.Enabled = (Convert.ToDecimal(wnePercentageDisp.Text) &gt; 0);
            }

            RetainDisplay(rblDistributionType.SelectedIndex + 1, 1);
        }

        // Profit margin and discount code
        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;
        private void itemPickerboq_SelectedIndexChanged(object sender, ClickEventArgs e)
        {
            List&lt;Item&gt; selItems = itemPickerboq.GetMultipleDTOFromHTTP();
            if (rblDistributionType.SelectedIndex == 0)
                trOverheadDetails.Style.Add(&quot;display&quot;, &quot;none&quot;);
            else if (rblDistributionType.SelectedIndex == 1)
                RetainDisplay(2, 1);
            else if (rblDistributionType.SelectedIndex == 2)
                RetainDisplay(3, 1);
            // Define enum and try to eliminate this 2 over here
            SetProfitDistributionType(2);

            //Int32.TryParse(hdnOverheadDetailID.Value, out selOverheadID);

            foreach (Item selItem in selItems)
            {
                bool foundInGrid = false;
                foreach (UltraGridRow ugr in uwgProfitBOQs.Rows)
                {
                    if (ugr.Cells.FromKey(&quot;StandardItemNo&quot;) != null &amp;&amp;
                        ugr.Cells.FromKey(&quot;StandardItemNo&quot;).Value.Equals(selItem.StandardItemNo) &amp;&amp;
                        ugr.Cells.FromKey(&quot;ContainerID&quot;).Value.Equals(selItem.ContainerID))
                    {
                        foundInGrid = true;
                        break;
                    }
                }
                if (!foundInGrid)
                {
                    var newRow = new UltraGridRow(true);
                    uwgProfitBOQs.Rows.Add(newRow);

                    newRow.Cells.FromKey(&quot;LineNo&quot;).Value = selItem.LineNo;
                    newRow.Cells.FromKey(&quot;Type&quot;).Value = &quot;P&quot;;
                    newRow.Cells.FromKey(&quot;ItemID&quot;).Value = selItem.ItemID.GetValueOrDefault();
                    newRow.Cells.FromKey(&quot;StandardItemNo&quot;).Value = selItem.StandardItemNo;
                    newRow.Cells.FromKey(&quot;Description&quot;).Value = selItem.Description;
                    newRow.Cells.FromKey(&quot;UnitCost&quot;).Value = selItem.UnitCost.GetValueOrDefault();
                    newRow.Cells.FromKey(&quot;Quantity&quot;).Value = selItem.Quantity;
                    newRow.Cells.FromKey(&quot;Amount&quot;).Value = selItem.UnitCost.GetValueOrDefault()*selItem.Quantity;
                    newRow.Cells.FromKey(&quot;ProfitPercentage&quot;).Value = selItem.Margin;
                    newRow.Cells.FromKey(&quot;ProfitPercentage&quot;).Style.BackColor = Color.Yellow;
                    newRow.Cells.FromKey(&quot;ProfitAmount&quot;).Value = (selItem.Margin == 0)
                        ? 0
                        : (selItem.UnitCost.GetValueOrDefault()*
                           selItem.Quantity*selItem.Margin/100);
                    newRow.Cells.FromKey(&quot;ProfitAmount&quot;).Style.BackColor = Color.Yellow;
                    newRow.Cells.FromKey(&quot;DiscountPercentage&quot;).Value = selItem.Discount;
                    newRow.Cells.FromKey(&quot;DiscountPercentage&quot;).Style.BackColor = Color.Yellow;
                    newRow.Cells.FromKey(&quot;DiscountAmount&quot;).Value = (selItem.Discount == 0)
                        ? 0
                        : (selItem.UnitCost.GetValueOrDefault()*
                           selItem.Quantity*(1 + (selItem.Margin/100)))*
                          (selItem.Discount/100);
                    newRow.Cells.FromKey(&quot;DiscountAmount&quot;).Style.BackColor = Color.Yellow;
                    newRow.Cells.FromKey(&quot;Container&quot;).Value = selItem.ContainerName;
                    newRow.Cells.FromKey(&quot;ContainerID&quot;).Value = selItem.ContainerID;
                }
            }
            itemPickerboq.PickerText.Text = &quot;&quot;;
        }

        #endregion
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[27,9,27,54,0],[28,9,28,53,0],[29,9,29,52,0],[30,9,30,51,0],[50,17,50,18,0],[50,19,50,67,0],[50,68,50,69,0],[51,17,51,18,0],[51,19,51,57,0],[51,58,51,59,0],[56,17,56,18,0],[56,19,56,60,0],[56,61,56,62,0],[57,17,57,18,0],[57,19,57,53,0],[57,54,57,55,0],[62,17,62,18,0],[62,19,62,52,0],[62,53,62,54,0],[63,17,63,18,0],[63,19,63,47,0],[63,48,63,49,0],[68,17,68,18,0],[68,19,68,61,0],[68,62,68,63,0],[69,17,69,18,0],[69,19,69,56,0],[69,57,69,58,0],[74,9,74,48,0],[79,17,79,18,0],[79,19,79,112,0],[79,113,79,114,0],[83,9,83,10,0],[84,13,84,54,0],[85,13,85,63,0],[87,13,87,45,0],[89,13,89,31,0],[90,9,90,10,0],[93,9,93,10,0],[94,13,94,34,0],[95,13,95,33,0],[96,13,96,66,0],[97,13,97,52,0],[98,13,98,67,0],[99,13,99,61,0],[100,13,100,90,0],[102,13,102,94,0],[104,9,104,10,0],[107,9,107,10,0],[108,13,108,45,0],[109,13,109,94,0],[110,13,110,47,0],[111,13,111,55,0],[112,13,112,55,0],[113,13,113,50,0],[114,13,114,51,0],[115,13,115,49,0],[116,13,116,49,0],[117,13,117,49,0],[118,13,118,61,0],[119,13,119,92,0],[121,13,121,25,0],[122,9,122,10,0],[125,9,125,10,0],[126,13,126,41,0],[127,13,127,44,0],[128,13,128,52,0],[129,13,129,52,0],[130,13,130,47,0],[131,13,131,48,0],[132,13,132,46,0],[133,13,133,46,0],[134,13,134,95,0],[136,13,136,25,0],[137,9,137,10,0],[140,9,140,10,0],[141,13,141,66,0],[142,13,142,53,0],[144,13,144,74,0],[145,13,145,31,0],[146,13,146,31,0],[147,13,147,55,0],[148,13,148,54,0],[149,13,149,28,0],[150,9,150,10,0],[153,9,153,10,0],[154,13,154,59,0],[156,13,156,48,0],[157,9,157,10,0],[162,13,162,14,0],[163,17,166,94,0],[167,13,167,14,0],[171,9,171,10,0],[172,13,172,49,0],[174,13,174,82,0],[175,13,175,60,0],[176,13,176,14,0],[177,17,177,44,0],[178,17,178,18,0],[179,21,183,93,0],[184,17,184,18,0],[185,13,185,14,0],[188,13,188,89,0],[192,13,192,49,0],[193,13,193,44,0],[194,13,194,39,0],[196,13,196,59,0],[197,13,197,14,0],[198,17,198,68,0],[199,17,199,63,0],[200,17,200,60,0],[201,17,201,58,0],[202,17,202,68,0],[203,13,203,14,0],[205,13,205,14,0],[206,17,206,69,0],[207,17,207,64,0],[208,17,208,59,0],[209,17,209,69,0],[210,13,210,14,0],[214,13,214,72,0],[215,17,215,105,0],[216,13,216,71,0],[217,17,217,59,0],[219,13,219,34,0],[220,17,220,38,0],[222,13,222,47,0],[223,13,223,42,0],[226,13,226,43,0],[227,13,227,49,0],[228,13,228,45,0],[229,13,229,41,0],[231,13,231,56,0],[232,13,232,25,0],[234,13,234,54,0],[235,17,235,84,0],[236,13,236,60,0],[237,17,237,90,0],[239,13,239,29,0],[240,13,240,14,0],[241,17,241,80,0],[242,17,242,53,0],[243,13,243,14,0],[245,13,245,29,0],[246,13,246,14,0],[247,17,247,43,0],[248,17,248,35,0],[249,17,249,36,0],[254,17,254,52,0],[255,13,255,14,0],[256,13,257,118,0],[258,13,259,122,0],[260,13,261,120,0],[262,9,262,10,0],[265,9,265,10,0],[266,13,266,109,0],[267,13,267,65,0],[268,13,268,61,0],[270,13,270,33,0],[271,13,271,56,0],[272,13,272,47,0],[273,13,273,49,0],[274,13,274,14,0],[275,17,275,48,0],[276,21,276,55,0],[278,21,278,55,0],[279,13,279,14,0],[280,13,280,62,0],[281,17,281,68,0],[283,17,283,38,0],[285,13,290,38,0],[291,13,291,81,0],[293,13,293,61,0],[294,13,294,73,0],[295,13,295,65,0],[296,13,296,51,0],[297,13,297,61,0],[298,13,298,65,0],[299,13,299,45,0],[300,13,300,56,0],[301,13,301,56,0],[303,13,303,62,0],[304,13,304,58,0],[305,13,305,70,0],[307,13,307,34,0],[308,9,308,10,0],[311,9,311,10,0],[312,13,312,52,0],[313,9,313,10,0],[316,9,316,10,0],[317,13,317,51,0],[318,9,318,10,0],[321,9,321,10,0],[323,13,323,14,0],[324,17,324,36,0],[325,17,325,44,0],[326,13,326,14,0],[327,13,327,18,0],[328,13,328,14,0],[329,13,329,14,0],[330,9,330,10,0],[338,9,338,10,0],[339,13,339,66,0],[340,13,340,65,0],[341,13,341,73,0],[342,13,342,67,0],[343,13,343,73,0],[344,13,344,69,0],[345,13,345,41,0],[346,13,346,55,0],[347,13,347,56,0],[348,13,348,118,0],[349,9,349,10,0],[357,9,357,10,0],[358,13,358,60,0],[359,13,359,14,0],[360,13,360,48,0],[361,13,361,52,0],[363,13,363,68,0],[364,13,364,38,0],[366,13,366,41,0],[367,9,367,10,0],[374,9,374,10,0],[375,13,393,19,0],[394,9,394,10,0],[397,9,397,10,0],[398,13,398,117,0],[399,13,399,53,0],[401,13,401,72,0],[402,13,402,20,0],[402,22,402,33,0],[402,34,402,36,0],[402,37,402,57,0],[403,13,403,14,0],[405,17,405,49,0],[406,17,406,47,0],[407,17,407,65,0],[408,17,408,48,0],[409,17,409,61,0],[410,17,410,65,0],[411,17,413,25,0],[414,17,416,25,0],[418,17,418,48,0],[419,13,419,14,0],[421,13,421,72,0],[422,13,422,37,0],[424,13,424,38,0],[425,9,425,10,0],[432,9,432,10,0],[433,13,444,19,0],[445,9,445,10,0],[451,9,451,10,0],[453,13,453,20,0],[453,22,453,41,0],[453,42,453,44,0],[453,45,453,65,0],[454,13,454,14,0],[455,17,455,46,0],[456,13,456,14,0],[457,13,457,59,0],[459,13,459,58,0],[460,13,460,95,0],[461,13,461,58,0],[462,13,462,14,0],[463,17,463,87,0],[464,17,464,65,0],[465,17,465,80,0],[466,17,466,110,0],[467,17,467,100,0],[468,17,468,85,0],[469,13,469,14,0],[470,13,470,54,0],[471,13,471,14,0],[472,17,472,102,0],[473,17,473,72,0],[474,17,474,76,0],[475,17,475,96,0],[476,17,476,81,0],[477,13,477,14,0],[478,13,478,60,0],[479,13,479,14,0],[480,17,480,91,0],[481,17,481,82,0],[482,17,482,102,0],[483,17,483,87,0],[484,13,484,14,0],[485,13,485,56,0],[486,13,486,14,0],[487,17,487,104,0],[488,17,488,74,0],[489,17,489,78,0],[490,17,490,98,0],[491,17,491,83,0],[492,13,492,14,0],[494,13,494,105,0],[495,13,495,51,0],[502,9,502,10,0],[508,9,508,10,0],[512,13,512,20,0],[512,22,512,41,0],[512,42,512,44,0],[512,45,512,66,0],[513,13,513,14,0],[514,17,514,46,0],[515,13,515,14,0],[517,13,517,75,0],[518,13,518,14,0],[519,17,519,104,0],[520,17,520,82,0],[521,17,521,97,0],[522,17,523,72,0],[524,17,524,117,0],[525,17,525,102,0],[526,13,526,14,0],[527,13,527,77,0],[528,13,528,14,0],[529,17,529,108,0],[530,17,530,84,0],[531,17,531,99,0],[532,17,533,72,0],[534,17,534,119,0],[535,17,535,104,0],[536,13,536,14,0],[538,13,538,67,0],[539,17,539,119,0],[540,13,540,71,0],[541,13,541,14,0],[542,17,542,96,0],[543,17,543,119,0],[544,17,544,93,0],[545,17,545,113,0],[546,17,546,98,0],[547,13,547,14,0],[548,13,548,73,0],[549,13,549,14,0],[550,17,550,100,0],[551,17,551,121,0],[552,17,552,95,0],[553,17,553,115,0],[554,17,554,100,0],[555,13,555,14,0],[556,13,556,56,0],[557,17,557,113,0],[558,13,558,58,0],[559,17,559,117,0],[561,13,561,65,0],[561,66,561,120,0],[562,13,562,63,0],[562,64,562,116,0],[563,13,563,70,0],[564,17,564,76,0],[565,13,565,65,0],[566,17,567,72,0],[570,9,570,10,0],[575,9,575,10,0],[576,13,576,61,0],[577,13,579,50,0],[580,13,584,93,0],[585,13,585,113,0],[586,13,588,52,0],[589,13,591,80,0],[592,9,592,10,0],[595,9,595,10,0],[596,13,596,55,0],[597,13,597,65,0],[598,13,598,42,0],[599,13,599,59,0],[600,13,600,49,0],[601,13,601,64,0],[602,9,602,10,0],[605,9,605,10,0],[606,13,606,62,0],[607,13,607,14,0],[608,17,608,76,0],[609,17,609,70,0],[610,17,610,69,0],[611,17,611,78,0],[612,13,612,14,0],[613,18,613,67,0],[614,13,614,14,0],[615,17,615,71,0],[616,17,616,75,0],[617,17,617,69,0],[618,17,618,78,0],[619,17,619,82,0],[620,13,620,14,0],[621,18,621,67,0],[622,13,622,14,0],[623,17,623,71,0],[624,17,624,74,0],[625,17,625,70,0],[626,17,626,78,0],[627,13,627,14,0],[628,9,628,10,0],[631,9,631,10,0],[632,13,632,37,0],[633,13,633,14,0],[634,17,634,43,0],[635,17,635,37,0],[636,17,636,18,0],[639,21,642,67,0],[643,17,643,18,0],[645,17,645,18,0],[646,21,647,50,0],[648,21,648,79,0],[649,17,649,18,0],[650,13,650,14,0],[651,18,651,69,0],[652,13,652,14,0],[653,17,653,43,0],[654,17,654,43,0],[655,17,655,74,0],[656,13,656,14,0],[657,9,657,10,0],[660,9,660,10,0],[661,13,661,99,0],[662,13,662,114,0],[663,9,663,10,0],[666,9,666,10,0],[668,13,668,14,0],[669,17,669,99,0],[671,17,671,38,0],[672,17,672,18,0],[673,21,673,44,0],[674,21,674,60,0],[675,17,675,18,0],[679,17,679,36,0],[690,17,690,53,0],[691,17,691,18,0],[694,21,694,59,0],[695,21,696,119,0],[697,21,698,118,0],[699,21,700,123,0],[701,21,702,117,0],[703,21,704,119,0],[705,21,705,107,0],[707,21,707,65,0],[708,21,708,83,0],[709,21,709,74,0],[710,21,710,71,0],[711,21,711,85,0],[712,21,712,64,0],[713,21,713,68,0],[714,21,714,86,0],[715,21,716,77,0],[717,21,717,61,0],[723,21,727,65,0],[728,21,728,42,0],[728,43,728,97,0],[730,21,734,65,0],[735,21,739,65,0],[741,21,743,29,0],[744,21,747,29,0],[756,21,756,97,0],[757,21,757,103,0],[763,21,764,91,0],[765,21,765,103,0],[768,17,768,18,0],[772,17,772,72,0],[773,17,773,38,0],[774,17,774,36,0],[778,17,778,76,0],[779,17,780,49,0],[781,17,783,49,0],[784,17,786,53,0],[787,13,787,14,0],[788,13,788,33,0],[789,13,789,14,0],[790,17,790,40,0],[791,13,791,14,0],[792,9,792,10,0],[795,9,795,10,0],[796,13,796,32,0],[797,13,797,14,0],[798,17,799,117,0],[801,17,801,103,0],[802,17,802,18,0],[803,21,803,90,0],[806,21,806,77,0],[807,25,807,102,0],[808,21,808,28,0],[808,30,808,41,0],[808,42,808,44,0],[808,45,808,69,0],[809,25,809,114,0],[811,21,811,70,0],[812,21,812,56,0],[813,21,813,56,0],[816,21,816,69,0],[817,21,817,88,0],[818,21,818,69,0],[819,21,819,70,0],[820,21,820,51,0],[821,21,821,60,0],[822,25,822,62,0],[824,25,824,88,0],[825,17,825,18,0],[827,17,827,103,0],[828,17,828,18,0],[829,21,829,103,0],[830,21,830,61,0],[831,21,831,73,0],[832,21,832,49,0],[833,21,833,58,0],[834,25,834,60,0],[836,25,836,88,0],[837,17,837,18,0],[838,13,838,14,0],[840,13,840,14,0],[841,17,841,76,0],[842,17,842,56,0],[843,21,843,81,0],[844,17,844,24,0],[844,26,844,37,0],[844,38,844,40,0],[844,41,844,48,0],[845,21,845,110,0],[847,17,847,49,0],[848,17,848,52,0],[849,17,849,38,0],[850,17,850,48,0],[852,17,852,67,0],[853,17,853,65,0],[854,17,854,58,0],[855,17,855,47,0],[856,17,856,56,0],[857,21,857,58,0],[858,13,858,14,0],[859,9,859,10,0],[862,9,862,10,0],[863,13,863,34,0],[865,13,865,20,0],[865,22,865,32,0],[865,33,865,35,0],[865,36,865,47,0],[866,17,866,102,0],[868,13,868,26,0],[869,9,869,10,0],[872,9,872,10,0],[873,13,873,35,0],[874,13,874,20,0],[874,22,874,38,0],[874,39,874,41,0],[874,42,874,51,0],[875,13,875,14,0],[876,17,876,59,0],[877,17,877,18,0],[878,21,878,77,0],[879,25,879,68,0],[881,25,881,87,0],[882,17,882,18,0],[883,13,883,14,0],[884,13,884,35,0],[885,17,885,71,0],[887,13,887,33,0],[888,9,888,10,0],[891,9,891,10,0],[892,13,892,42,0],[914,13,914,27,0],[915,9,915,10,0],[918,9,918,10,0],[919,13,919,42,0],[920,20,920,74,0],[921,13,921,14,0],[922,24,922,56,0],[923,17,923,18,0],[924,21,924,59,0],[925,21,925,28,0],[925,30,925,46,0],[925,47,925,49,0],[925,50,925,64,0],[926,21,926,22,0],[927,25,927,81,0],[928,25,928,26,0],[929,29,929,61,0],[930,29,930,102,0],[931,29,931,98,0],[932,29,935,80,0],[936,29,939,75,0],[940,29,940,51,0],[941,25,941,26,0],[942,21,942,22,0],[943,21,943,43,0],[945,21,945,33,0],[947,21,947,46,0],[948,17,948,18,0],[949,13,949,14,0],[951,13,951,27,0],[952,9,952,10,0],[955,9,955,10,0],[956,13,956,42,0],[957,20,957,74,0],[958,13,958,14,0],[959,24,959,56,0],[960,17,960,18,0],[961,21,961,60,0],[962,21,962,28,0],[962,30,962,46,0],[962,47,962,49,0],[962,50,962,70,0],[963,21,963,22,0],[964,25,964,58,0],[965,25,965,108,0],[966,25,966,112,0],[967,25,967,92,0],[968,25,971,73,0],[972,25,972,47,0],[973,21,973,22,0],[974,21,974,43,0],[976,21,976,33,0],[978,21,978,46,0],[979,17,979,18,0],[980,13,980,14,0],[982,13,982,27,0],[983,9,983,10,0],[986,9,986,10,0],[987,13,987,42,0],[988,20,988,74,0],[989,13,989,14,0],[990,24,990,56,0],[991,17,991,18,0],[992,21,992,61,0],[993,21,993,28,0],[993,30,993,46,0],[993,47,993,49,0],[993,50,993,69,0],[994,21,994,22,0],[995,25,995,59,0],[996,25,996,110,0],[997,25,997,112,0],[998,25,998,94,0],[999,25,1002,73,0],[1003,25,1003,47,0],[1004,21,1004,22,0],[1005,21,1005,43,0],[1007,21,1007,33,0],[1009,21,1009,46,0],[1010,17,1010,18,0],[1011,13,1011,14,0],[1013,13,1013,27,0],[1014,9,1014,10,0],[1021,9,1021,10,0],[1022,13,1022,42,0],[1023,20,1023,74,0],[1024,13,1024,14,0],[1025,24,1025,56,0],[1026,17,1026,18,0],[1027,21,1027,66,0],[1028,21,1028,28,0],[1028,30,1028,46,0],[1028,47,1028,49,0],[1028,50,1028,68,0],[1029,21,1029,22,0],[1030,25,1030,57,0],[1032,25,1032,92,0],[1033,25,1036,81,0],[1037,25,1040,79,0],[1042,25,1042,47,0],[1043,21,1043,22,0],[1044,21,1044,43,0],[1046,21,1046,33,0],[1048,21,1048,46,0],[1049,17,1049,18,0],[1050,13,1050,14,0],[1052,13,1052,27,0],[1053,9,1053,10,0],[1060,9,1060,10,0],[1061,13,1061,42,0],[1062,20,1062,74,0],[1063,13,1063,14,0],[1064,24,1064,56,0],[1065,17,1065,18,0],[1066,21,1066,67,0],[1067,21,1067,28,0],[1067,30,1067,46,0],[1067,47,1067,49,0],[1067,50,1067,67,0],[1068,21,1068,22,0],[1069,25,1069,58,0],[1071,25,1071,94,0],[1072,25,1075,77,0],[1076,25,1079,75,0],[1081,25,1081,47,0],[1082,21,1082,22,0],[1083,21,1083,43,0],[1085,21,1085,33,0],[1087,21,1087,46,0],[1088,17,1088,18,0],[1089,13,1089,14,0],[1091,13,1091,27,0],[1092,9,1092,10,0],[1095,9,1095,10,0],[1096,13,1096,91,0],[1097,13,1097,29,0],[1098,9,1098,10,0],[1101,9,1101,10,0],[1102,13,1102,108,0],[1104,13,1104,64,0],[1105,13,1105,14,0],[1106,17,1106,24,0],[1106,26,1106,37,0],[1106,38,1106,40,0],[1106,41,1106,61,0],[1107,21,1107,77,0],[1108,25,1108,47,0],[1109,13,1109,14,0],[1111,13,1111,59,0],[1112,13,1112,61,0],[1113,13,1113,14,0],[1114,17,1114,86,0],[1115,17,1115,24,0],[1115,26,1115,37,0],[1115,38,1115,40,0],[1115,41,1115,61,0],[1116,21,1116,87,0],[1117,13,1117,14,0],[1119,13,1119,73,0],[1120,13,1120,40,0],[1122,13,1122,39,0],[1123,9,1123,10,0],[1126,9,1126,10,0],[1127,13,1128,32,0],[1130,13,1130,61,0],[1131,13,1131,14,0],[1132,17,1132,86,0],[1133,17,1133,24,0],[1133,26,1133,37,0],[1133,38,1133,40,0],[1133,41,1133,61,0],[1134,21,1134,94,0],[1135,13,1135,14,0],[1137,13,1137,72,0],[1138,13,1138,39,0],[1140,13,1140,40,0],[1141,9,1141,10,0],[1144,9,1144,10,0],[1145,13,1149,66,0],[1150,13,1152,87,0],[1153,9,1153,10,0],[1160,9,1160,10,0],[1162,13,1164,85,0],[1165,9,1165,10,0],[1168,9,1168,10,0],[1169,13,1169,41,0],[1170,13,1170,40,0],[1171,13,1171,42,0],[1172,13,1172,46,0],[1174,13,1174,38,0],[1175,13,1175,14,0],[1176,17,1176,54,0],[1177,17,1177,65,0],[1178,17,1178,59,0],[1179,17,1179,61,0],[1180,17,1180,65,0],[1181,13,1181,14,0],[1182,18,1182,43,0],[1183,13,1183,14,0],[1184,17,1184,54,0],[1185,17,1185,60,0],[1186,17,1186,64,0],[1187,17,1187,66,0],[1188,17,1188,70,0],[1189,13,1189,14,0],[1190,13,1190,91,0],[1191,17,1191,99,0],[1192,9,1192,10,0],[1195,9,1195,10,0],[1197,13,1197,41,0],[1198,13,1198,42,0],[1200,13,1200,45,0],[1201,13,1201,60,0],[1203,13,1203,54,0],[1204,13,1204,42,0],[1206,13,1206,39,0],[1208,13,1208,43,0],[1210,13,1210,35,0],[1212,13,1212,70,0],[1213,13,1213,48,0],[1215,13,1215,79,0],[1216,17,1216,49,0],[1218,13,1218,44,0],[1219,13,1219,14,0],[1220,17,1220,44,0],[1221,17,1221,43,0],[1222,13,1222,14,0],[1224,13,1224,37,0],[1225,9,1225,10,0],[1228,9,1228,10,0],[1229,13,1231,49,0],[1232,13,1232,76,0],[1233,13,1235,52,0],[1237,13,1237,24,0],[1238,13,1238,14,0],[1239,17,1239,50,0],[1240,17,1240,51,0],[1241,17,1241,65,0],[1242,17,1242,67,0],[1243,17,1243,69,0],[1245,17,1245,75,0],[1246,17,1246,18,0],[1247,21,1247,96,0],[1248,21,1248,101,0],[1249,17,1249,18,0],[1250,17,1250,74,0],[1251,17,1251,18,0],[1252,21,1252,95,0],[1253,21,1253,100,0],[1254,17,1254,18,0],[1255,13,1255,14,0],[1257,13,1257,14,0],[1258,17,1258,51,0],[1259,17,1259,50,0],[1260,17,1260,70,0],[1261,17,1261,66,0],[1263,17,1263,44,0],[1264,17,1264,43,0],[1265,17,1265,68,0],[1267,17,1267,57,0],[1268,13,1268,14,0],[1269,9,1269,10,0],[1272,9,1272,10,0],[1273,13,1276,114,0],[1277,13,1277,43,0],[1278,9,1278,10,0],[1281,9,1281,10,0],[1282,13,1283,112,0],[1284,9,1284,10,0],[1291,9,1291,10,0],[1293,13,1293,20,0],[1293,22,1293,41,0],[1293,42,1293,44,0],[1293,45,1293,62,0],[1294,13,1294,14,0],[1295,17,1295,46,0],[1296,13,1296,14,0],[1298,13,1298,56,0],[1300,13,1300,63,0],[1301,13,1301,72,0],[1302,13,1302,69,0],[1303,13,1303,81,0],[1305,13,1305,56,0],[1306,13,1306,51,0],[1308,13,1308,61,0],[1309,13,1309,69,0],[1310,13,1310,56,0],[1311,13,1311,64,0],[1312,13,1312,96,0],[1314,13,1314,73,0],[1316,13,1316,54,0],[1317,17,1317,72,0],[1319,13,1319,57,0],[1320,13,1320,52,0],[1321,9,1321,10,0],[1324,9,1324,10,0],[1326,13,1326,20,0],[1326,22,1326,41,0],[1326,42,1326,44,0],[1326,45,1326,67,0],[1327,13,1327,14,0],[1328,17,1328,46,0],[1329,13,1329,14,0],[1331,13,1331,61,0],[1333,13,1333,63,0],[1334,13,1334,88,0],[1335,13,1335,62,0],[1337,13,1337,54,0],[1338,13,1338,51,0],[1339,13,1339,59,0],[1340,13,1340,60,0],[1342,13,1342,98,0],[1343,13,1343,92,0],[1345,13,1345,55,0],[1346,13,1346,100,0],[1347,13,1347,70,0],[1348,13,1348,54,0],[1349,13,1349,75,0],[1350,9,1350,10,0],[1353,9,1353,10,0],[1354,13,1354,59,0],[1355,13,1355,46,0],[1356,9,1356,10,0],[1359,9,1359,10,0],[1363,13,1363,20,0],[1363,22,1363,41,0],[1363,42,1363,44,0],[1363,45,1363,68,0],[1364,13,1364,14,0],[1365,17,1365,46,0],[1366,13,1366,14,0],[1368,13,1368,71,0],[1369,13,1369,14,0],[1370,17,1370,78,0],[1371,17,1371,93,0],[1372,17,1373,72,0],[1374,17,1374,113,0],[1375,17,1375,98,0],[1376,13,1376,14,0],[1378,13,1378,73,0],[1379,17,1380,72,0],[1381,13,1381,67,0],[1382,17,1382,115,0],[1383,13,1383,75,0],[1384,17,1384,81,0],[1385,13,1385,77,0],[1386,17,1386,83,0],[1387,13,1387,67,0],[1388,17,1388,73,0],[1391,9,1391,10,0],[1394,9,1394,10,0],[1396,13,1397,37,0],[1398,9,1398,10,0],[1401,9,1401,10,0],[1402,13,1402,75,0],[1403,13,1403,48,0],[1405,13,1405,37,0],[1406,13,1406,76,0],[1407,13,1407,62,0],[1408,9,1408,10,0],[1411,9,1411,10,0],[1412,13,1412,40,0],[1413,13,1413,14,0],[1414,17,1414,77,0],[1415,17,1415,54,0],[1416,17,1416,33,0],[1417,17,1417,18,0],[1418,21,1418,35,0],[1419,17,1419,18,0],[1420,13,1420,14,0],[1421,18,1421,75,0],[1422,13,1422,14,0],[1423,17,1423,121,0],[1424,17,1424,47,0],[1425,17,1425,18,0],[1426,21,1426,52,0],[1427,21,1427,22,0],[1428,25,1428,82,0],[1429,25,1429,55,0],[1430,25,1430,40,0],[1431,21,1431,22,0],[1432,17,1432,18,0],[1434,17,1434,18,0],[1435,21,1435,81,0],[1436,21,1436,58,0],[1437,21,1437,37,0],[1438,21,1438,22,0],[1439,25,1439,39,0],[1440,21,1440,22,0],[1441,17,1441,18,0],[1442,13,1442,14,0],[1444,13,1444,64,0],[1445,13,1445,14,0],[1446,17,1446,94,0],[1447,17,1447,95,0],[1448,17,1448,94,0],[1449,17,1449,93,0],[1450,17,1450,92,0],[1451,17,1451,95,0],[1452,13,1452,14,0],[1453,13,1453,72,0],[1455,13,1455,45,0],[1456,9,1456,10,0],[1459,9,1459,10,0],[1461,13,1461,20,0],[1461,22,1461,41,0],[1461,42,1461,44,0],[1461,45,1461,71,0],[1462,13,1462,14,0],[1463,17,1463,46,0],[1464,13,1464,14,0],[1465,13,1465,65,0],[1466,13,1466,41,0],[1467,17,1467,100,0],[1468,13,1468,42,0],[1469,17,1469,103,0],[1470,13,1470,39,0],[1470,40,1470,119,0],[1471,9,1471,10,0],[1474,9,1474,10,0],[1475,13,1475,45,0],[1477,13,1477,45,0],[1478,13,1478,60,0],[1479,13,1479,47,0],[1480,13,1480,48,0],[1481,13,1481,47,0],[1482,13,1482,46,0],[1483,13,1483,45,0],[1484,13,1484,45,0],[1485,13,1485,48,0],[1486,13,1486,45,0],[1488,13,1494,16,0],[1495,13,1495,55,0],[1496,13,1496,43,0],[1497,9,1497,10,0],[1500,9,1500,10,0],[1501,13,1501,49,0],[1502,13,1502,37,0],[1503,13,1503,67,0],[1504,13,1504,52,0],[1505,13,1505,52,0],[1506,13,1506,50,0],[1507,13,1507,50,0],[1508,13,1508,33,0],[1510,13,1510,80,0],[1512,13,1512,47,0],[1513,13,1513,33,0],[1514,13,1514,65,0],[1515,13,1515,50,0],[1516,13,1516,50,0],[1517,13,1517,48,0],[1518,13,1518,48,0],[1519,13,1519,29,0],[1521,13,1521,78,0],[1523,13,1523,100,0],[1524,13,1524,86,0],[1526,13,1526,99,0],[1527,13,1527,84,0],[1529,13,1529,98,0],[1530,13,1530,84,0],[1532,13,1532,97,0],[1533,13,1533,82,0],[1535,13,1535,20,0],[1535,22,1535,41,0],[1535,42,1535,44,0],[1535,45,1535,71,0],[1536,13,1536,14,0],[1537,17,1538,65,0],[1539,17,1539,18,0],[1540,21,1540,62,0],[1541,17,1541,18,0],[1542,13,1542,14,0],[1544,13,1544,84,0],[1546,13,1546,45,0],[1547,9,1547,10,0],[1550,9,1550,10,0],[1551,13,1551,44,0],[1552,13,1552,43,0],[1553,13,1553,45,0],[1555,13,1559,15,0],[1561,13,1561,29,0],[1562,13,1562,20,0],[1562,22,1562,34,0],[1562,35,1562,37,0],[1562,38,1562,44,0],[1563,13,1563,14,0],[1564,17,1564,68,0],[1565,17,1565,27,0],[1566,13,1566,14,0],[1567,13,1567,85,0],[1568,13,1568,83,0],[1570,13,1570,43,0],[1571,13,1571,42,0],[1573,18,1573,30,0],[1573,32,1573,40,0],[1573,42,1573,45,0],[1574,17,1574,37,0],[1576,13,1576,83,0],[1577,13,1577,81,0],[1580,9,1580,10,0],[1587,9,1587,10,0],[1588,13,1591,61,0],[1592,13,1592,29,0],[1593,17,1593,38,0],[1594,9,1594,10,0],[1597,9,1597,10,0],[1598,13,1598,57,0],[1599,13,1599,122,0],[1600,13,1600,14,0],[1601,17,1601,64,0],[1602,17,1602,118,0],[1603,17,1603,24,0],[1605,13,1605,35,0],[1606,13,1606,113,0],[1608,13,1608,49,0],[1609,13,1609,37,0],[1611,13,1611,96,0],[1612,13,1612,38,0],[1614,13,1614,32,0],[1615,13,1615,14,0],[1616,17,1616,77,0],[1617,17,1617,105,0],[1618,17,1618,84,0],[1619,13,1619,14,0],[1621,13,1621,53,0],[1625,13,1625,38,0],[1626,13,1626,14,0],[1627,17,1627,43,0],[1628,17,1628,46,0],[1629,17,1629,50,0],[1630,13,1630,14,0],[1632,13,1632,14,0],[1633,17,1633,42,0],[1634,17,1634,47,0],[1635,17,1635,51,0],[1636,13,1636,14,0],[1642,13,1642,52,0],[1643,13,1643,14,0],[1644,17,1647,63,0],[1649,17,1649,40,0],[1650,13,1650,14,0],[1652,13,1652,14,0],[1653,17,1656,62,0],[1658,17,1658,41,0],[1659,13,1659,14,0],[1664,13,1664,38,0],[1665,13,1665,65,0],[1667,13,1667,20,0],[1667,22,1667,33,0],[1667,34,1667,36,0],[1667,37,1667,61,0],[1668,17,1668,81,0],[1670,13,1670,74,0],[1671,13,1671,78,0],[1672,13,1672,66,0],[1673,13,1673,81,0],[1674,13,1674,64,0],[1678,13,1678,52,0],[1679,13,1679,14,0],[1680,17,1680,40,0],[1681,13,1681,14,0],[1683,13,1683,14,0],[1684,17,1684,41,0],[1685,13,1685,14,0],[1691,13,1691,59,0],[1693,13,1693,50,0],[1694,13,1694,14,0],[1696,17,1696,57,0],[1697,13,1697,14,0],[1698,18,1698,55,0],[1699,13,1699,14,0],[1701,17,1701,58,0],[1702,13,1702,14,0],[1705,13,1705,67,0],[1706,13,1706,43,0],[1707,9,1707,10,0],[1710,9,1710,10,0],[1711,13,1711,49,0],[1712,13,1712,37,0],[1714,13,1714,57,0],[1715,13,1715,122,0],[1716,13,1716,14,0],[1717,17,1717,64,0],[1718,17,1718,118,0],[1719,17,1719,24,0],[1721,13,1721,35,0],[1722,13,1722,113,0],[1724,13,1724,96,0],[1725,13,1725,38,0],[1727,13,1727,32,0],[1728,13,1728,14,0],[1729,17,1729,77,0],[1730,17,1730,105,0],[1731,17,1731,84,0],[1732,13,1732,14,0],[1734,13,1734,53,0],[1736,13,1736,36,0],[1739,13,1739,36,0],[1741,13,1741,20,0],[1741,22,1741,33,0],[1741,34,1741,36,0],[1741,37,1741,61,0],[1742,17,1742,81,0],[1744,13,1744,74,0],[1745,13,1745,78,0],[1746,13,1746,66,0],[1747,13,1747,81,0],[1748,13,1748,64,0],[1750,13,1750,100,0],[1751,13,1751,50,0],[1751,51,1751,103,0],[1753,13,1753,86,0],[1754,13,1754,14,0],[1756,17,1756,57,0],[1757,13,1757,14,0],[1758,18,1758,55,0],[1759,13,1759,14,0],[1761,17,1761,58,0],[1762,13,1762,14,0],[1764,13,1764,38,0],[1767,13,1767,67,0],[1768,13,1768,43,0],[1769,9,1769,10,0],[1772,9,1772,10,0],[1773,13,1773,41,0],[1774,13,1774,80,0],[1777,13,1777,39,0],[1779,13,1779,49,0],[1780,13,1780,88,0],[1782,13,1782,81,0],[1783,13,1783,55,0],[1784,13,1784,54,0],[1787,13,1787,68,0],[1788,13,1788,50,0],[1791,13,1791,31,0],[1792,13,1792,14,0],[1794,17,1794,18,0],[1797,21,1797,55,0],[1798,21,1798,63,0],[1799,21,1799,102,0],[1800,21,1800,96,0],[1801,21,1801,107,0],[1803,21,1803,71,0],[1804,21,1804,63,0],[1805,21,1805,59,0],[1806,21,1806,85,0],[1807,21,1807,62,0],[1809,21,1810,40,0],[1814,21,1814,61,0],[1815,21,1815,64,0],[1816,17,1816,18,0],[1817,17,1817,37,0],[1818,17,1818,18,0],[1819,21,1819,44,0],[1820,21,1820,67,0],[1821,21,1821,28,0],[1823,13,1823,14,0],[1825,13,1825,14,0],[1826,17,1828,28,0],[1830,17,1830,48,0],[1831,17,1831,18,0],[1832,21,1832,69,0],[1833,21,1833,40,0],[1834,21,1834,22,0],[1835,25,1837,85,0],[1838,25,1838,97,0],[1839,29,1839,81,0],[1840,21,1840,22,0],[1842,21,1842,22,0],[1843,25,1843,91,0],[1845,25,1845,72,0],[1846,29,1846,89,0],[1847,25,1847,82,0],[1848,29,1848,93,0],[1849,21,1849,22,0],[1851,21,1851,53,0],[1852,21,1852,22,0],[1853,25,1853,119,0],[1854,25,1854,52,0],[1855,29,1855,86,0],[1857,29,1857,88,0],[1858,21,1858,22,0],[1860,25,1860,84,0],[1861,17,1861,18,0],[1863,17,1863,18,0],[1864,21,1864,61,0],[1865,21,1865,67,0],[1866,21,1866,28,0],[1868,13,1868,14,0],[1872,13,1872,36,0],[1874,13,1874,20,0],[1874,22,1874,33,0],[1874,34,1874,36,0],[1874,37,1874,65,0],[1875,13,1875,14,0],[1876,17,1876,52,0],[1877,17,1877,18,0],[1878,21,1879,94,0],[1880,25,1880,34,0],[1881,21,1881,82,0],[1882,21,1882,22,0],[1883,25,1883,44,0],[1884,25,1884,31,0],[1886,17,1886,18,0],[1888,17,1888,18,0],[1889,21,1889,101,0],[1890,21,1890,22,0],[1891,25,1891,44,0],[1892,25,1892,31,0],[1895,25,1895,34,0],[1897,13,1897,14,0],[1899,13,1899,29,0],[1900,13,1900,14,0],[1901,17,1901,64,0],[1902,17,1902,63,0],[1903,17,1903,24,0],[1906,13,1906,81,0],[1910,13,1910,102,0],[1911,13,1911,14,0],[1912,17,1912,69,0],[1913,17,1913,63,0],[1914,17,1914,24,0],[1916,13,1916,50,0],[1917,13,1917,14,0],[1919,17,1929,59,0],[1930,17,1930,85,0],[1931,17,1931,18,0],[1932,21,1932,64,0],[1933,21,1944,74,0],[1945,17,1945,18,0],[1946,13,1946,14,0],[1947,18,1947,55,0],[1948,13,1948,14,0],[1949,17,1949,64,0],[1950,17,1950,94,0],[1951,17,1951,68,0],[1952,17,1952,18,0],[1953,21,1953,58,0],[1954,21,1954,67,0],[1955,21,1955,28,0],[1958,17,1958,18,0],[1960,21,1970,63,0],[1971,21,1971,89,0],[1972,21,1972,22,0],[1973,25,1973,68,0],[1974,25,1986,78,0],[1987,21,1987,22,0],[1988,17,1988,18,0],[1989,13,1989,14,0],[1990,18,1990,55,0],[1991,13,1991,14,0],[1992,17,1992,64,0],[1993,17,1993,93,0],[1994,17,1994,68,0],[1995,17,1995,18,0],[1996,21,1996,58,0],[1997,21,1997,67,0],[1998,21,1998,28,0],[2001,17,2001,18,0],[2003,21,2013,63,0],[2014,21,2014,89,0],[2015,21,2015,22,0],[2016,25,2016,68,0],[2017,25,2029,78,0],[2030,21,2030,22,0],[2031,17,2031,18,0],[2032,13,2032,14,0],[2034,13,2034,34,0],[2035,13,2035,32,0],[2037,13,2037,36,0],[2038,13,2038,52,0],[2039,13,2039,55,0],[2040,13,2041,107,0],[2042,13,2042,14,0],[2043,17,2043,45,0],[2044,13,2044,14,0],[2050,13,2053,50,0],[2055,13,2055,43,0],[2056,13,2056,14,0],[2057,17,2057,93,0],[2058,17,2058,90,0],[2059,17,2059,89,0],[2060,13,2060,14,0],[2062,13,2062,79,0],[2063,17,2063,49,0],[2065,13,2065,44,0],[2066,13,2066,14,0],[2067,17,2067,44,0],[2068,17,2068,43,0],[2069,13,2069,14,0],[2070,13,2070,32,0],[2071,13,2071,31,0],[2072,9,2072,10,0],[2075,9,2075,10,0],[2076,13,2076,57,0],[2077,13,2077,35,0],[2078,13,2078,67,0],[2079,13,2079,40,0],[2080,13,2080,86,0],[2081,13,2081,14,0],[2082,17,2082,117,0],[2084,17,2084,100,0],[2085,17,2085,42,0],[2087,17,2087,36,0],[2088,21,2088,81,0],[2089,13,2089,14,0],[2090,13,2090,96,0],[2091,13,2091,14,0],[2092,17,2093,45,0],[2095,17,2095,107,0],[2096,17,2096,42,0],[2098,17,2098,36,0],[2099,21,2099,88,0],[2100,13,2100,14,0],[2102,13,2105,27,0],[2107,13,2107,55,0],[2108,13,2108,60,0],[2109,13,2109,55,0],[2110,13,2110,34,0],[2111,13,2111,43,0],[2112,13,2112,54,0],[2113,9,2113,10,0],[2116,9,2116,10,0],[2117,13,2117,36,0],[2118,13,2118,36,0],[2119,13,2119,43,0],[2120,9,2120,10,0],[2123,9,2123,10,0],[2126,13,2126,39,0],[2127,13,2127,37,0],[2128,13,2128,41,0],[2130,13,2130,40,0],[2131,13,2131,111,0],[2132,13,2132,90,0],[2133,13,2133,86,0],[2134,13,2134,32,0],[2135,13,2135,43,0],[2136,9,2136,10,0],[2139,9,2139,10,0],[2140,13,2140,43,0],[2142,13,2142,36,0],[2144,13,2144,52,0],[2146,13,2146,59,0],[2147,13,2147,57,0],[2149,13,2149,55,0],[2150,13,2150,53,0],[2152,13,2152,69,0],[2153,13,2153,41,0],[2155,13,2156,94,0],[2157,9,2157,10,0],[2160,9,2160,10,0],[2161,13,2161,38,0],[2162,13,2162,37,0],[2163,13,2163,42,0],[2164,13,2164,41,0],[2165,13,2165,32,0],[2166,9,2166,10,0],[2169,9,2169,10,0],[2170,13,2170,69,0],[2171,13,2171,41,0],[2172,13,2172,73,0],[2174,13,2174,69,0],[2175,13,2175,14,0],[2176,17,2176,54,0],[2177,17,2177,54,0],[2178,17,2178,69,0],[2179,17,2179,60,0],[2180,17,2180,61,0],[2181,17,2181,60,0],[2182,17,2182,59,0],[2183,17,2183,58,0],[2184,17,2184,58,0],[2185,17,2185,60,0],[2186,17,2186,58,0],[2188,17,2200,20,0],[2203,17,2203,43,0],[2205,17,2208,55,0],[2211,17,2211,18,0],[2212,21,2215,33,0],[2216,17,2216,18,0],[2217,17,2217,34,0],[2218,17,2218,18,0],[2219,21,2220,56,0],[2221,17,2221,18,0],[2223,17,2223,103,0],[2225,17,2225,40,0],[2226,13,2226,14,0],[2227,9,2227,10,0],[2230,9,2230,10,0],[2231,13,2231,48,0],[2232,13,2232,56,0],[2234,13,2234,69,0],[2235,17,2235,44,0],[2236,13,2236,118,0],[2237,13,2237,56,0],[2238,17,2238,64,0],[2239,18,2239,61,0],[2240,17,2240,37,0],[2241,18,2241,61,0],[2242,17,2242,37,0],[2243,9,2243,10,0],[2246,9,2246,10,0],[2248,13,2248,14,0],[2249,17,2255,25,0],[2257,17,2263,25,0],[2265,17,2273,68,0],[2276,17,2280,34,0],[2282,17,2282,38,0],[2283,17,2283,52,0],[2284,17,2284,60,0],[2286,13,2286,14,0],[2287,13,2287,33,0],[2288,13,2288,14,0],[2289,17,2289,40,0],[2290,17,2290,24,0],[2292,9,2292,10,0],[2301,9,2301,10,0],[2302,13,2302,71,0],[2303,13,2303,43,0],[2304,13,2304,33,0],[2306,13,2306,35,0],[2307,13,2307,74,0],[2309,13,2309,20,0],[2309,22,2309,34,0],[2309,35,2309,37,0],[2309,38,2309,46,0],[2310,13,2310,14,0],[2311,17,2311,42,0],[2312,17,2312,24,0],[2312,26,2312,42,0],[2312,43,2312,45,0],[2312,46,2312,66,0],[2313,17,2313,18,0],[2314,21,2314,121,0],[2315,21,2315,22,0],[2316,25,2316,44,0],[2317,25,2317,31,0],[2319,17,2319,18,0],[2320,17,2320,34,0],[2321,17,2321,18,0],[2322,21,2322,57,0],[2323,21,2323,54,0],[2325,21,2325,73,0],[2326,21,2326,84,0],[2327,21,2327,95,0],[2328,21,2328,91,0],[2329,21,2329,85,0],[2330,21,2330,107,0],[2331,21,2331,69,0],[2332,21,2332,87,0],[2333,21,2333,65,0],[2334,17,2334,18,0],[2335,13,2335,14,0],[2336,13,2336,45,0],[2337,9,2337,10,0],[2340,9,2340,10,0],[2341,13,2341,96,0],[2342,13,2342,14,0],[2343,17,2343,67,0],[2344,17,2344,67,0],[2345,13,2345,14,0],[2346,13,2346,43,0],[2347,13,2347,38,0],[2348,13,2348,37,0],[2349,13,2349,42,0],[2351,13,2351,43,0],[2352,13,2352,14,0],[2353,17,2353,93,0],[2354,17,2354,90,0],[2355,17,2355,89,0],[2356,13,2356,14,0],[2358,13,2358,69,0],[2359,9,2359,10,0],[2368,9,2368,10,0],[2369,13,2369,74,0],[2370,13,2370,56,0],[2371,17,2371,64,0],[2372,18,2372,61,0],[2373,17,2373,37,0],[2374,18,2374,61,0],[2375,17,2375,37,0],[2377,13,2377,42,0],[2381,13,2381,20,0],[2381,22,2381,34,0],[2381,35,2381,37,0],[2381,38,2381,46,0],[2382,13,2382,14,0],[2383,17,2383,42,0],[2384,17,2384,24,0],[2384,26,2384,42,0],[2384,43,2384,45,0],[2384,46,2384,64,0],[2385,17,2385,18,0],[2386,21,2388,92,0],[2389,21,2389,22,0],[2390,25,2390,44,0],[2391,25,2391,31,0],[2393,17,2393,18,0],[2394,17,2394,34,0],[2395,17,2395,18,0],[2396,21,2396,57,0],[2397,21,2397,52,0],[2399,21,2399,75,0],[2400,21,2400,62,0],[2401,21,2401,95,0],[2402,21,2402,91,0],[2403,21,2403,85,0],[2404,21,2404,99,0],[2405,21,2405,79,0],[2406,21,2406,114,0],[2407,21,2407,85,0],[2408,21,2408,93,0],[2409,21,2412,65,0],[2413,21,2413,89,0],[2414,21,2414,89,0],[2415,21,2415,95,0],[2416,21,2420,50,0],[2421,21,2421,91,0],[2422,21,2422,85,0],[2423,21,2423,85,0],[2424,17,2424,18,0],[2425,13,2425,14,0],[2426,13,2426,48,0],[2427,9,2427,10,0]]);
    </script>
  </body>
</html>