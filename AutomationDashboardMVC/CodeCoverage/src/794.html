<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Business Layer\UserControls\ItemActivityControl.ascx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Drawing;
using System.Globalization;
using System.Reflection;
using System.Text;
using System.Web.Script.Serialization;
using System.Web.UI;
using System.Web.UI.WebControls;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core.AbstractModels;
using Aurigo.AMP3.Core.BusinessLayer.BL;
using Aurigo.AMP3.Core.BusinessLayer.DTO;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Aurigo.AMP3.Core.IntegrationConnector;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Infragistics.WebUI.UltraWebGrid;
using Infragistics.WebUI.WebDataInput;

namespace Aurigo.AMP3.Core.UserControls
{
    public partial class ItemActivityControl : UserControl, ICallbackEventHandler
    {
        protected WebNumericEdit ActivityDimension1;
        protected WebNumericEdit ActivityDimension2;
        protected WebNumericEdit ActivityDimension3;
        protected WebNumericEdit ActivityNumber;
        protected WebNumericEdit ActivityQuantity;
        private ValueList valListUnits = new ValueList();
        protected global::Infragistics.WebUI.UltraWebGrid.UltraWebGrid gridActivity;

        protected string ItemNameAbbr = LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR);
        protected ToolBar MainToolBar;
        private string callbackResult;
        protected HiddenField hdnReferenceItemType;

        private ItemDetailModel parentItemModel;

        private GenericPickerControl resourcePicker;
        protected WebNumericEdit wneWeightage;

        public ItemDetailModel ParentItemModel
        {
            get { return parentItemModel; }
            set { parentItemModel = value; }
        }

        private bool isContractLocked
        {
            get
            {
                hdnIsLocked.Value = GetContractLockStatus().ToString2();
                return bool.Parse(hdnIsLocked.Value);
            }
        }

        public DataSet ActivityList
        {
            set { ViewState[&quot;ActivityList&quot;] = value; }
            get { return (DataSet)ViewState[&quot;ActivityList&quot;]; }
        }

        public bool ItemCompleted
        {
            get
            {
                int count = ActivityList.Tables[&quot;ActivityList&quot;].Rows.Count;
                foreach (DataRow dr in ActivityList.Tables[&quot;ActivityList&quot;].Rows)
                {
                    if (!dr[&quot;ReferenceCount&quot;].Equals(DBNull.Value) &amp;&amp; dr[&quot;ReferenceCount&quot;].ToInt32_2() == -1)
                        count -= 1;
                }
                return (count == 0);
            }
        }

        public string ModuleID
        {
            set
            {
                hdnModuleID.Value = value;
                DisplaySchedule =
                    (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.MSP) &amp;&amp;
                     ((value.Equals(Constants.MODID_CONTMGT) &amp;&amp; !string.IsNullOrEmpty(Request[&quot;Mode&quot;])) ||
                      value.Equals(&quot;ITMPOST&quot;)));
            }
            get { return hdnModuleID.Value; }
        }

        public int ParentInstanceID
        {
            set { hdnParentInstanceID.Value = value.ToString2(); }
            get
            {
                return (!string.IsNullOrEmpty(hdnParentInstanceID.Value))
                    ? hdnParentInstanceID.Value.ToInt32_2()
                    : 0;
            }
        }

        public bool ReadOnly
        {
            get { return hdnReadOnly.Value.ToBoolean2(); }
            set
            {
                hdnReadOnly.Value = value.ToString2();
                btnActivityAdd.Visible = btnActivityEdit.Visible = btnActivityDelete.Visible =
                    btnActivityAddFromLibrary.Visible = !value;
            }
        }

        public bool ValidateQty
        {
            get { return hdnValidateQty.Value.ToBoolean2(); }
            set { hdnValidateQty.Value = value.ToString2(); }
        }

        public int ItemID
        {
            get
            {
                return (!string.IsNullOrEmpty(txtItemID4Activity.Text))
                    ? txtItemID4Activity.Text.ToInt32_2()
                    : -1;
            }
            set { txtItemID4Activity.Text = value.ToString2(); }
        }

        public string ReferenceItemType
        {
            set
            {
                hdnReferenceItemType.Value = value;
                btnActivityAdd.Visible = btnActivityDelete.Visible = !value.Equals(&quot;M&quot;);
                if (value.Equals(&quot;M&quot;))
                {
                    if (MainToolBar.GetMenuReference(&quot;lnkNew&quot;) != null)
                        MainToolBar.HideMenu(&quot;lnkNew&quot;);
                    if (MainToolBar.GetMenuReference(&quot;lnkDelete&quot;) != null)
                        MainToolBar.HideMenu(&quot;lnkDelete&quot;);
                }
            }
            get { return hdnReferenceItemType.Value; }
        }

        public bool DisplayPicker
        {
            get { return btnActivityPicker.Visible; }
            set { btnActivityPicker.Visible = value; }
        }

        public bool DisplayActivityQuantity
        {
            get { return trQuantity.Visible; }
            set { trQuantity.Visible = value; }
        }

        public bool DisplayComplete
        {
            get { return trComplete.Visible; }
            set { trComplete.Visible = value; }
        }

        public bool DisplayNewQuantity { get; set; }

        public bool DisableNew
        {
            get { return !btnActivityAdd.Visible; }
            set
            {
                wneWeightage.ReadOnly =
                    txtActivityDescription.ReadOnly =
                        txtActivityName.ReadOnly = value;
                ddlUnitID.Enabled =
                    btnActivityPicker.Enabled =
                        btnActivityDelete.Visible =
                            btnSaveActivity.CausesValidation =
                                btnActivityAdd.Visible =
                                    Dimension1.Enabled =
                                        Dimension2.Enabled =
                                            Dimension3.Enabled =
                                                MBEnable.Enabled = !value;
            }
        }

        public bool DisplaySchedule
        {
            get { return btnActivitySchedule.Visible; }
            set { btnActivitySchedule.Visible = value; }
        }

        public int MeasSysID
        {
            set { hdnMeasSysID.Value = value.ToString2(); }
            get { return Convert.ToInt32(hdnMeasSysID.Value, CultureInfo.CurrentCulture); }
        }

        #region ICallbackEventHandler Members

        public string GetCallbackResult()
        {
            return callbackResult;
        }

        public void RaiseCallbackEvent(string eventArgument)
        {
            try
            {
                bool hasDates = true;
                DataTable dt = ItemManager.Instance.GetActivityDates(eventArgument.ToInt32_2());

                #region Disable Schedule button if Start and End Dates are not from MSP

                foreach (DataRow dr in dt.Rows)
                    if (dr.IsNull(&quot;StartDate&quot;) || dr.IsNull(&quot;EndDate&quot;))
                    {
                        hasDates = false;
                        break;
                    }

                #endregion

                if (hasDates)
                    callbackResult = RenderGrid(dt);
                else
                {
                    var sb = new StringBuilder();
                    sb.Append(&quot;&lt;table class=&#39;nodetable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;headeritem&#39;&gt;Error Message&lt;/td&gt;&lt;/tr&gt;&quot;);
                    sb.Append(
                        &quot;&lt;tr&gt;&lt;td&gt;No Schedule exists. Reason: Activity has not been Synchronized with MSP Or it is a Non-Contract &quot; +
                        LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR) + &quot;.&lt;/td&gt;&lt;/tr&gt;&quot;);
                    sb.Append(&quot;&lt;/table&gt;&quot;);

                    sb.Append(&quot;&lt;table&gt;&quot;);
                    sb.Append(&quot;&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);
                    sb.Append(
                        &quot;&lt;tr&gt;&lt;td&gt;&lt;input type=&#39;button&#39; onclick=&#39;ADClose()&#39; value=&#39;Close&#39; class=&#39;btnC&#39; style=&#39;width:80px;&#39; /&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);
                    sb.Append(&quot;&lt;/table&gt;&quot;);

                    callbackResult = sb.ToString2();
                }
            }
            catch (Exception)
            {
                callbackResult = &quot;&quot;;
            }
        }

        #endregion

        public event EventHandler BackClicked;

        protected virtual void OnBackClicked(EventArgs e)
        {
            if (BackClicked != null)
                BackClicked(this, e);
        }

        protected override void OnInit(EventArgs e)
        {
            resourcePicker = ucResourcePicker;
            resourcePicker.Visible = this.Visible;

            CreateToolBarMenu();

            #region Resource Picker

            resourcePicker.BackClicked += resourcePicker_BackClicked;
            resourcePicker.ItemSelected += resourcePicker_ItemSelected;

            #endregion

            //string viewName = &quot;vw_CORITEMLibraryActivities&quot;;
            //FILTERING ACTIVITIES BASED ON LOGGED IN COMPANY
            if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX))
            {
                string viewName = &quot;ERPMGMTITEMACTIVITY&quot;;
                string AXCompany = Session[Constants.EIS_ADDITIONAL_INFO] == null
                    ? string.Empty
                    : Session[Constants.EIS_ADDITIONAL_INFO].ToString2();
                var dictData = new Dictionary&lt;string, string&gt;();
                dictData.Add(&quot;ERPCompany&quot;, AXCompany);
                resourcePicker.DataSourceFilter = dictData;
                resourcePicker.ModifyColumnProperties(&quot;ActivityID&quot;, true, null, &quot;&quot;, &quot;&quot;, false);
                resourcePicker.ModifyColumnProperties(&quot;ERPCompany&quot;, true, null, &quot;&quot;, &quot;&quot;, false);
                resourcePicker.TableOrViewName = viewName;
            }
            else
            {
                resourcePicker.DataSourceCommandType = DataSourceType.StoredProcedure;
                resourcePicker.BindData += resourcePicker_BindData;
            }

            resourcePicker.StateMgmtContext = &quot;actiPick&quot;;
            resourcePicker.DefaultSortColumn = &quot;Name&quot;;
            resourcePicker.EnableMultipleSelect = true;
            resourcePicker.ModifyColumnProperties(&quot;RowNum&quot;, true, null, &quot;&quot;, &quot;&quot;, false);
            resourcePicker.ModifyColumnProperties(&quot;ParentInstanceID&quot;, true, null, &quot;&quot;, &quot;&quot;, false);
            resourcePicker.DisplayFilter = true;
            resourcePicker.IsFilterXml = true;
            resourcePicker.Filters = GetFilters();
            btnActivityAddFromLibrary.Click += btnActivityAddFromLibrary_Click;
            btnActivityDone.Click += btnDone_Click;
            gridActivity.InitializeRow += gridActivity_InitializeRow;

            hdnDecimalPlaces.Value =
                CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT).ToString2();

            base.OnInit(e);
        }

        private BrixFilter[] GetFilters()
        {
            var filters = new BrixFilter[2];

            filters[0] = new BrixFilter();
            filters[0].Title = &quot;Name :&quot;;
            filters[0].Name = &quot;Name&quot;;
            filters[0].FilterType = BrixFilter.Type.Text;

            filters[1] = new BrixFilter();
            filters[1].Title = &quot;Description :&quot;;
            filters[1].Name = &quot;Description&quot;;
            filters[1].FilterType = BrixFilter.Type.Text;

            return filters;
        }

        private void gridActivity_InitializeRow(object sender, RowEventArgs e)
        {
            if (!string.IsNullOrEmpty(e.Row.Cells.FromKey(&quot;AssociatedResourceID&quot;).Text))
            {
                e.Row.Style.BackColor = ColorTranslator.FromHtml(&quot;#edeffb&quot;);
                foreach (UltraGridCell cell in e.Row.Cells)
                    cell.AllowEditing = AllowEditing.No;
                e.Row.Cells.FromKey(&quot;Percentage&quot;).AllowEditing = AllowEditing.Yes;
            }
            if (isContractLocked)
            {
                if (e.Row.Cells.FromKey(&quot;IsAfterLock&quot;) == null ||
                    !bool.Parse(e.Row.Cells.FromKey(&quot;IsAfterLock&quot;).Value.ToString2()))
                {
                    foreach (UltraGridCell cell in e.Row.Cells)
                        cell.AllowEditing = AllowEditing.No;
                }
                else
                {
                    e.Row.Cells.FromKey(&quot;Percentage&quot;).Value = 0f;
                    e.Row.Cells.FromKey(&quot;Percentage&quot;).AllowEditing = AllowEditing.No;
                }
            }
            int activityId = 0;
            if (e.Row.Cells.FromKey(&quot;ActivityID&quot;) != null &amp;&amp;
                int.TryParse(e.Row.Cells.FromKey(&quot;ActivityID&quot;).Value.ToString2(), out activityId))
            {
                Activity activityDTO = ItemManager.Instance.GetActivity(ModuleID, ParentInstanceID, ItemID, activityId);
                if (parentItemModel != null &amp;&amp; !parentItemModel.ValidateActivityForGridEdit(activityDTO))
                {
                    var nonEditableColumns =
                        new List&lt;string&gt;((&quot;Description,Name,Unit,UnitDim1,UnitDim2,UnitDim3&quot;).Split(&#39;,&#39;));
                    foreach (UltraGridCell cell in e.Row.Cells)
                        if (nonEditableColumns.Contains(cell.Key))
                            cell.AllowEditing = AllowEditing.No;
                }
            }
        }

        private void resourcePicker_ItemSelected(object sender, ItemSelectedEventArgs e)
        {
            DataTable selectedActivities = e.SelectedItems;

            var uniqueKeys = new List&lt;string&gt;();
            foreach (UltraGridRow dr in gridActivity.Rows)
                uniqueKeys.Add(dr.Cells.FromKey(&quot;Name&quot;).ToString2());

            bool isDuplicate = false;
            foreach (DataRow dr in selectedActivities.Rows)
            {
                if (uniqueKeys != null &amp;&amp; uniqueKeys.Contains(dr[&quot;Name&quot;].ToString2()))
                {
                    isDuplicate = true;
                    continue;
                }

                UltraGridRow ugr = gridActivity.Rows.Band.AddNew();
                ugr.Cells.FromKey(&quot;Name&quot;).Value = dr[&quot;Name&quot;].ToString2();
                ugr.Cells.FromKey(&quot;Description&quot;).Value = dr[&quot;Description&quot;].ToString2();
                ugr.Cells.FromKey(&quot;Percentage&quot;).Value = 0;
                ugr.Cells.FromKey(&quot;Unit&quot;).Value = dr[&quot;Unit&quot;].ToString2();
                if (isContractLocked)
                {
                    foreach (UltraGridCell cell in ugr.Cells)
                        cell.AllowEditing = AllowEditing.Yes;
                    ugr.Cells.FromKey(&quot;IsAfterLock&quot;).Value = true;
                }
            }

            ShowDiv(ActivityDivEnums.Activities);
            (this.Page as Aurigo.Brix.Core.WebUiHelper.BrixPageBase).PageTitle =
                Aurigo.Brix.Core.WebUiHelper.GlobalizationUtility.SetResource(&quot;Item Activities&quot;, false);

            if (isDuplicate)
                Page.ClientScript.RegisterStartupScript(GetType(), &quot;AlertDuplicate&quot;,
                    @&quot;ShowError(&#39;Duplicate Activities Not Allowed.&#39;);&quot;, true);
        }

        private void btnDone_Click(object sender, EventArgs e)
        {
            string errMessage = String.Empty;

            if (!ReadOnly)
            {
                #region Validating all Activities before Deleting and Saving

                if (!string.IsNullOrEmpty(DeleteActivityId.Text.Trim(&#39;,&#39;)))
                {
                    string selDeleteActIDs = DeleteActivityId.Text.Replace(&quot;null&quot;, &quot;&quot;).Replace(&quot;,,&quot;, &quot;,&quot;).Trim(&#39;,&#39;);
                    foreach (string activityID in selDeleteActIDs.Split(&#39;,&#39;))
                    {
                        int activityIDInt = 0;
                        if (Int32.TryParse(activityID, out activityIDInt))
                        {
                            Activity activityDTO = ItemManager.Instance.GetActivity(ModuleID, ParentInstanceID, ItemID,
                                activityIDInt);

                            #region Validate Activity before Deleting

                            if (parentItemModel != null)
                            {
                                string resValidate = parentItemModel.ValidateActivityBeforeDelete(activityDTO);
                                if (!String.IsNullOrEmpty(resValidate))
                                    errMessage += resValidate + &quot;|&quot;;
                            }

                            #endregion
                        }
                    }
                }

                foreach (UltraGridRow ugr in gridActivity.Rows)
                {
                    Activity activityDTO = GetActivityDTO(ugr);

                    #region Validate Activity before Saving

                    if (parentItemModel != null)
                    {
                        string resValidate = parentItemModel.ValidateActivityBeforeSave(activityDTO);
                        if (!String.IsNullOrEmpty(resValidate))
                        {
                            errMessage += resValidate + &quot;|&quot;;
                            break;
                        }
                    }

                    #endregion
                }

                #endregion

                #region Persisting Activity Data to Database if no Validations have failed - ie: In the same state as visible in control

                if (String.IsNullOrEmpty(errMessage))
                {
                    if (!string.IsNullOrEmpty(DeleteActivityId.Text.Trim(&#39;,&#39;)))
                    {
                        string selDeleteActIDs = DeleteActivityId.Text.Replace(&quot;null&quot;, &quot;&quot;).Replace(&quot;,,&quot;, &quot;,&quot;).Trim(&#39;,&#39;);
                        foreach (string activityID in selDeleteActIDs.Split(&#39;,&#39;))
                            ItemManager.Instance.DeleteActivity(activityID);
                    }

                    foreach (UltraGridRow ugr in gridActivity.Rows)
                        ItemManager.Instance.SaveActivity(GetActivityDTO(ugr));
                }

                #endregion
            }

            if (!String.IsNullOrEmpty(errMessage))
            {
                AlertError(errMessage);
                //To retain the changes made by the user even though the validations have been failed.
                //ResetGrid(ModuleID, ParentInstanceID, ItemID, true);
                DeleteActivityId.Text = String.Empty;
            }
            else
                OnBackClicked(e);
        }

        private void AlertError(string errMessage)
        {
            // Sync with ChangeSet 34636 from production MTO
            JavaScriptSerializer JS = new JavaScriptSerializer();
            Page.ClientScript.RegisterStartupScript(GetType(), &quot;ShowAlert&quot;,
                &quot;ShowError(&quot; + JS.Serialize(errMessage.Replace(&quot;|&quot;, &quot;\\n&quot;)) + &quot;);&quot;, true);
        }

        private Activity GetActivityDTO(UltraGridRow ugr)
        {
            var dto = new Activity();
            if (ugr.Cells.FromKey(&quot;ActivityID&quot;).Value != null)
                dto.ActivityID = ugr.Cells.FromKey(&quot;ActivityID&quot;).Value.ToString2().ToInt32_2();
            if (ugr.Cells.FromKey(&quot;Description&quot;).Value != null)
                dto.Description = ugr.Cells.FromKey(&quot;Description&quot;).Value.ToString2();
            if (ugr.Cells.FromKey(&quot;Name&quot;).Value != null) dto.Name = ugr.Cells.FromKey(&quot;Name&quot;).Value.ToString2();

            int refActID = 0;
            Int32.TryParse(ugr.Cells.FromKey(&quot;ReferenceActivityID&quot;).Value.ToString2(), out refActID);
            if (ugr.Cells.FromKey(&quot;ReferenceActivityID&quot;).Value != null) dto.ReferenceActivityID = refActID;

            dto.ModuleID = ModuleID;
            dto.ParentInstanceID = ParentInstanceID;
            dto.ItemID = ItemID;
            if (ugr.Cells.FromKey(&quot;IsComplete&quot;).Value != null)
                dto.IsComplete = ugr.Cells.FromKey(&quot;IsComplete&quot;).Value.ToString2().ToBoolean2();
            decimal percentage;
            if (ugr.Cells.FromKey(&quot;Percentage&quot;).Value != null
                &amp;&amp; decimal.TryParse(ugr.Cells.FromKey(&quot;Percentage&quot;).Value.ToString2(), out percentage))
                dto.Percentage = percentage;
            else
                dto.Percentage = 0;

            if (ugr.Cells.FromKey(&quot;Number&quot;).Value != null)
            {
                decimal tempNumber = 0;
                decimal.TryParse(ugr.Cells.FromKey(&quot;Number&quot;).Value.ToString2(), out tempNumber);
                dto.Number = tempNumber;
            }

            Int32 tempUnitID = 0;

            if (ugr.Cells.FromKey(&quot;Unit&quot;).Value != null)
                if (Int32.TryParse(ugr.Cells.FromKey(&quot;Unit&quot;).Value.ToString2(), out tempUnitID))
                {
                    dto.UnitID = tempUnitID;
                    dto.Unit =
                        ActivityList.Tables[2].Select(&quot;UnitID=&#39;&quot; + tempUnitID.ToString2() + &quot;&#39;&quot;)[0][&quot;Unit&quot;].ToString2();
                }
                else
                {
                    if (ActivityList.Tables.Count &gt; 2 &amp;&amp;
                        ActivityList.Tables[2].Select(&quot;Unit=&#39;&quot; + ugr.Cells.FromKey(&quot;Unit&quot;).Text + &quot;&#39;&quot;).Length &gt; 0)
                        dto.UnitID =
                            ActivityList.Tables[2].Select(&quot;Unit=&#39;&quot; + ugr.Cells.FromKey(&quot;Unit&quot;).Text + &quot;&#39;&quot;)[0][&quot;UnitID&quot;].
                                ToInt32_2();
                    dto.Unit = ugr.Cells.FromKey(&quot;Unit&quot;).Text;
                }


            if (ugr.Cells.FromKey(&quot;Dimension1&quot;).Value != null)
            {
                decimal tempDim1 = 0;
                decimal.TryParse(ugr.Cells.FromKey(&quot;Dimension1&quot;).Value.ToString2(), out tempDim1);
                dto.Dimension1 = tempDim1;
                if (ugr.Cells.FromKey(&quot;UnitDim1&quot;).Value != null)
                {
                    dto.UnitIDDim1 = long.Parse(ugr.Cells.FromKey(&quot;UnitIDDim1&quot;).Text, CultureInfo.CurrentCulture);
                    dto.UnitDim1 = ugr.Cells.FromKey(&quot;UnitDim1&quot;).Text;
                    //if (Int32.TryParse(ugr.Cells.FromKey(&quot;UnitDim1&quot;).Value.ToString2(), out tempUnitID))
                    //{
                    //    dto.UnitIDDim1 = tempUnitID;
                    //    dto.UnitDim1 =
                    //        ActivityList.Tables[2].Select(&quot;UnitID=&#39;&quot; + ugr.Cells.FromKey(&quot;UnitDim1&quot;).Text.ToString2() +
                    //                                      &quot;&#39;&quot;)[0][&quot;Unit&quot;].ToString2();
                    //}
                    //else
                    //{
                    //    dto.UnitIDDim1 =
                    //        ActivityList.Tables[2].Select(&quot;Unit=&#39;&quot; + ugr.Cells.FromKey(&quot;UnitDim1&quot;).Value.ToString2() +
                    //                                      &quot;&#39;&quot;)[0][&quot;UnitID&quot;].ToInt32_2();
                    //    dto.UnitDim1 = ugr.Cells.FromKey(&quot;UnitDim1&quot;).Text;
                    //}
                }
            }

            if (ugr.Cells.FromKey(&quot;Dimension2&quot;).Value != null)
            {
                decimal tempDim2 = 0;
                decimal.TryParse(ugr.Cells.FromKey(&quot;Dimension2&quot;).Value.ToString2(), out tempDim2);
                dto.Dimension2 = tempDim2;
                if (ugr.Cells.FromKey(&quot;UnitDim2&quot;).Value != null)
                {
                    dto.UnitIDDim2 = long.Parse(ugr.Cells.FromKey(&quot;UnitIDDim2&quot;).Text, CultureInfo.CurrentCulture);
                    dto.UnitDim2 = ugr.Cells.FromKey(&quot;UnitDim2&quot;).Text;
                    //if (Int32.TryParse(ugr.Cells.FromKey(&quot;UnitDim2&quot;).Value.ToString2(), out tempUnitID))
                    //{
                    //    dto.UnitIDDim2 = tempUnitID;
                    //    dto.UnitDim2 =
                    //        ActivityList.Tables[2].Select(&quot;UnitID=&#39;&quot; + ugr.Cells.FromKey(&quot;UnitDim2&quot;).Text.ToString2() +
                    //                                      &quot;&#39;&quot;)[0][&quot;Unit&quot;].ToString2();
                    //}
                    //else
                    //{
                    //    dto.UnitIDDim2 =
                    //        ActivityList.Tables[2].Select(&quot;Unit=&#39;&quot; + ugr.Cells.FromKey(&quot;UnitDim2&quot;).Value.ToString2() +
                    //                                      &quot;&#39;&quot;)[0][&quot;UnitID&quot;].ToInt32_2();
                    //    dto.UnitDim2 = ugr.Cells.FromKey(&quot;UnitDim2&quot;).Text;
                    //}
                }
            }

            if (ugr.Cells.FromKey(&quot;Dimension3&quot;).Value != null)
            {
                decimal tempDim3 = 0;
                decimal.TryParse(ugr.Cells.FromKey(&quot;Dimension3&quot;).Value.ToString2(), out tempDim3);
                dto.Dimension3 = tempDim3;
                if (ugr.Cells.FromKey(&quot;UnitDim3&quot;).Value != null)
                {
                    dto.UnitIDDim3 = long.Parse(ugr.Cells.FromKey(&quot;UnitIDDim3&quot;).Text, CultureInfo.CurrentCulture);
                    dto.UnitDim3 = ugr.Cells.FromKey(&quot;UnitDim3&quot;).Text;
                    //if (Int32.TryParse(ugr.Cells.FromKey(&quot;UnitDim3&quot;).Value.ToString2(), out tempUnitID))
                    //{
                    //    dto.UnitIDDim3 = tempUnitID;
                    //    dto.UnitDim3 =
                    //        ActivityList.Tables[2].Select(&quot;UnitID=&#39;&quot; + ugr.Cells.FromKey(&quot;UnitDim3&quot;).Text.ToString2() +
                    //                                      &quot;&#39;&quot;)[0][&quot;Unit&quot;].ToString2();
                    //}
                    //else
                    //{
                    //    dto.UnitIDDim3 =
                    //        ActivityList.Tables[2].Select(&quot;Unit=&#39;&quot; + ugr.Cells.FromKey(&quot;UnitDim3&quot;).Value.ToString2() +
                    //                                      &quot;&#39;&quot;)[0][&quot;UnitID&quot;].ToInt32_2();
                    //    dto.UnitDim3 = ugr.Cells.FromKey(&quot;UnitDim3&quot;).Text;
                    //}
                }
            }

            dto.Quantity = ugr.Cells.FromKey(&quot;Quantity&quot;).Value.ToDecimal2();

            if (isContractLocked)
            {
                dto.IsAfterLock = (ugr.Cells.FromKey(&quot;IsAfterLock&quot;).Value != null)
                    ? bool.Parse(ugr.Cells.FromKey(&quot;IsAfterLock&quot;).Value.ToString2())
                    : isContractLocked;
            }
            else
                dto.IsAfterLock = false;
            return dto;
        }

        private void resourcePicker_BackClicked(object sender, EventArgs e)
        {
            ShowDiv(ActivityDivEnums.Activities);
            (this.Page as Aurigo.Brix.Core.WebUiHelper.BrixPageBase).PageTitle =
                Aurigo.Brix.Core.WebUiHelper.GlobalizationUtility.SetResource(&quot;Item Activities&quot;, false);
            ActivityForm.Style.Add(&quot;display&quot;, &quot;block&quot;);
        }

        private void btnActivityAddFromLibrary_Click(object sender, EventArgs e)
        {
            ShowDiv(ActivityDivEnums.ResourcePicker);
            //string viewName = &quot;vw_CORITEMLibraryActivities&quot;;
            //FILTERING ACTIVITIES BASED ON LOGGED IN COMPANY
            if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX))
            {
                string viewName = &quot;ERPMGMTITEMACTIVITY&quot;;
                string AXCompany = Session[Constants.EIS_ADDITIONAL_INFO] == null
                    ? string.Empty
                    : Session[Constants.EIS_ADDITIONAL_INFO].ToString2();
                var dictData = new Dictionary&lt;string, string&gt;();
                dictData.Add(&quot;ERPCompany&quot;, AXCompany);
                resourcePicker.DataSourceFilter = dictData;
                resourcePicker.ModifyColumnProperties(&quot;ActivityID&quot;, true, null, &quot;&quot;, &quot;&quot;, false);
                resourcePicker.ModifyColumnProperties(&quot;ERPCompany&quot;, true, null, &quot;&quot;, &quot;&quot;, false);
                resourcePicker.TableOrViewName = viewName;
            }
            else
            {
                resourcePicker.DataSourceCommandType = DataSourceType.StoredProcedure;
                resourcePicker.BindData += resourcePicker_BindData;
            }

            resourcePicker.ChangeTableOrViewAndBind(resourcePicker.TableOrViewName);
            (this.Page as Aurigo.Brix.Core.WebUiHelper.BrixPageBase).PageTitle = &quot;Activity Picker&quot;;
        }

        public void ResetGrid(string moduleID, int parentInstanceID, int itemID, bool isBindGrid)
        {
            ResetGrid(moduleID, parentInstanceID, itemID, isBindGrid, false);
        }

        public void ResetGrid(string moduleID, int parentInstanceID, int itemID, bool isBindGrid, bool isContractView)
        {
            ActivityList = ItemManager.Instance.GetItemActivities(moduleID, parentInstanceID, itemID, &quot;N&quot;,
                isContractView);
            if (ActivityList.Tables.Count &gt; 0)
            {
                ActivityList.Tables[0].TableName = &quot;ActivityList&quot;;
            }
            if (isBindGrid)
                BindActivityGrid(moduleID, parentInstanceID, itemID);
        }

        private void BindActivityGrid(string moduleID, int parentInstanceID, int itemID)
        {
            BindActivityGrid(moduleID, parentInstanceID, itemID, false);
        }

        private void BindActivityGrid(string moduleID, int parentInstanceID, int itemID, bool isContractView)
        {
            var CurrencyFormat = new NumberFormatInfo();
            CurrencyFormat.CurrencySymbol = LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL);

            //if (ActivityList == null)
            ResetGrid(moduleID, parentInstanceID, itemID, false, isContractView);
            if (ActivityList.Tables.Count &gt; 0)
            {
                gridActivity.DataSource = ActivityList.Tables[&quot;ActivityList&quot;];
                gridActivity.DataBind();

                gridActivity.DataKeyField = &quot;ActivityID&quot;;

                ColumnsCollection cols = gridActivity.Columns;

                if (cols.Exists(&quot;IsComplete&quot;))
                {
                    cols.FromKey(&quot;IsComplete&quot;).Type = ColumnType.CheckBox;
                    cols.FromKey(&quot;IsComplete&quot;).AllowUpdate = AllowUpdate.Yes;
                }

                // RIGHT ALLIGN AND SET THE FOOTER TO SHOW THE TOTAL
                string[] NumericColumns = { &quot;Percentage&quot;, &quot;Quantity&quot;, &quot;Original Quantity&quot; };
                foreach (string column in NumericColumns)
                    if (cols.Exists(column))
                    {
                        cols.FromKey(column).CellStyle.HorizontalAlign =
                            cols.FromKey(column).Header.Style.HorizontalAlign =
                                cols.FromKey(column).Footer.Style.HorizontalAlign = HorizontalAlign.Right;
                        cols.FromKey(column).Footer.Total = SummaryInfo.Sum;
                        cols.FromKey(column).Format = (column.Equals(&quot;Percentage&quot;))
                            ? &quot;##0.00&quot;
                            : AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                    }

                // ASSIGNING EDITOR CONTROL TO ALL UNIT COLUMNS
                string[] UnitColumns = { &quot;Unit&quot;, &quot;UnitDim1&quot;, &quot;UnitDim2&quot;, &quot;UnitDim3&quot; };
                foreach (string unitCol in UnitColumns)
                    if (cols.Exists(unitCol))
                    {
                        cols.FromKey(unitCol).ValueList = valListUnits;
                        cols.FromKey(unitCol).ValueList.DisplayStyle = ValueListDisplayStyle.DisplayText;
                        cols.FromKey(unitCol).Type = Infragistics.WebUI.UltraWebGrid.ColumnType.DropDownList;
                        cols.FromKey(unitCol).AllowUpdate = AllowUpdate.Yes;
                    }

                // SET THE FORMAT QUANTITY FOR NUMERIC FIELDS
                string[] formatColumns = { &quot;Number&quot;, &quot;Dimension1&quot;, &quot;Dimension2&quot;, &quot;Dimension3&quot; };
                foreach (string formatCol in UnitColumns)
                    if (cols.Exists(formatCol))
                        cols.FromKey(formatCol).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;


                // ADD ALL THE HIDDEN COLUMNS&#39; NAMES TO THE FOLLOWING LIST
                var HiddenColumns = new List&lt;string&gt;(new[]
                {
                    &quot;ActivityID&quot;, &quot;ItemID&quot;, &quot;UnitID&quot;, &quot;UnitIDDim1&quot;,
                    &quot;UnitIDDim2&quot;, &quot;UnitIDDim3&quot;, &quot;Complete&quot;, &quot;ModuleID&quot;,
                    &quot;ParentInstanceID&quot;, &quot;ReferenceActivityID&quot;, &quot;IsDefault&quot;,
                    &quot;ItemQuantity&quot;, &quot;ReferenceCount&quot;, &quot;OrgNumber&quot;,
                    &quot;IsAfterLock&quot;, &quot;AssociatedResourceID&quot;
                });

                if (!DisplayActivityQuantity)
                {
                    HiddenColumns.Add(&quot;Number&quot;);
                    HiddenColumns.Add(&quot;Dimension1&quot;);
                    HiddenColumns.Add(&quot;Dimension2&quot;);
                    HiddenColumns.Add(&quot;Dimension3&quot;);
                    HiddenColumns.Add(&quot;UnitDim1&quot;);
                    HiddenColumns.Add(&quot;UnitDim2&quot;);
                    HiddenColumns.Add(&quot;UnitDim3&quot;);
                    HiddenColumns.Add(&quot;Quantity&quot;);
                }

                if (!DisplayComplete)
                    HiddenColumns.Add(&quot;IsComplete&quot;);

                if (!DisplayNewQuantity)
                {
                    HiddenColumns.Add(&quot;New Quantity&quot;);
                    HiddenColumns.Add(&quot;Original Quantity&quot;);
                }

                if (moduleID == &quot;ITMPOST&quot;)
                {
                    HiddenColumns.Add(&quot;UnitDim1&quot;);
                    HiddenColumns.Add(&quot;UnitDim2&quot;);
                    HiddenColumns.Add(&quot;UnitDim3&quot;);
                }
                foreach (UltraGridColumn col in cols)
                {
                    col.Hidden = HiddenColumns.Contains(col.Key);

                    // to fix XSS attack
                    col.HTMLEncodeContent = true;
                }

                // CHANGE THE HEADERS OF THE COLUMNS IF REQUIRED
                cols.FromKey(&quot;Percentage&quot;).Header.Caption = &quot;Weightage&quot;;
                cols.FromKey(&quot;Number&quot;).Header.Caption = &quot;Nos/Qty&quot;;
                cols.FromKey(&quot;Quantity&quot;).Header.Caption = &quot;Total Qty&quot;;
                cols.FromKey(&quot;Quantity&quot;).NullText = &quot;0.00&quot;;
                cols.FromKey(&quot;Dimension1&quot;).Header.Caption = AMP3ApplicationSettings.Instance.Dim1Title;
                cols.FromKey(&quot;Dimension2&quot;).Header.Caption = AMP3ApplicationSettings.Instance.Dim2Title;
                cols.FromKey(&quot;Dimension3&quot;).Header.Caption = AMP3ApplicationSettings.Instance.Dim3Title;
                cols.FromKey(&quot;UnitDim1&quot;).Header.Caption = &quot;Unit &quot; + AMP3ApplicationSettings.Instance.Dim1Title;
                cols.FromKey(&quot;UnitDim2&quot;).Header.Caption = &quot;Unit &quot; + AMP3ApplicationSettings.Instance.Dim2Title;
                cols.FromKey(&quot;UnitDim3&quot;).Header.Caption = &quot;Unit &quot; + AMP3ApplicationSettings.Instance.Dim3Title;

                if (ActivityList.Tables.Count &gt; 1 &amp;&amp; ActivityList.Tables[1].Rows.Count &gt; 0)
                {
                    lblStdItemID.Text = ActivityList.Tables[1].Rows[0][&quot;StandardItemNo&quot;].ToString2();
                    lblItemDesc.Text = ActivityList.Tables[1].Rows[0][&quot;Description&quot;].ToString2();
                }

                /* To bind Units from Dynamics AX - ds.Tables[2] replaced by AX Units */
                if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX))
                {
                    var additionalInfo = new EISAdditionalInfo(RegisteredEIS.AX);
                    additionalInfo.AddInfo(Constants.EIS_ADDITIONAL_INFO,
                        Session[Constants.EIS_ADDITIONAL_INFO] == null
                            ? string.Empty
                            : Session[Constants.EIS_ADDITIONAL_INFO].ToString2());
                    var dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
                    dictAdditionalInfo.Add(RegisteredEIS.AX, additionalInfo);
                    var connectorParameter = new ConnectorParameters(dictAdditionalInfo, MethodBase.GetCurrentMethod(),
                        AMP3ObjectType.Unknown, null, null);
                    int count = 0;
                    DataSet dsUnits = new BrixDataSet();
                    if (IntegrationConnectorManager.HandleIntegration(connectorParameter, ref count, ref dsUnits, true))
                    {
                        DataTable dtUnit = dsUnits.Tables[1].Copy();
                        //TODO : Remove Indexing
                        ActivityList.Tables[2].Rows.Clear();
                        ActivityList.Tables[2].Columns.Clear();
                        ActivityList.Tables[2].Merge(dtUnit);
                    }
                }

                BindUnits(ActivityList.Tables[2], &quot;Unit&quot;, &quot;UnitID&quot;);
                DisableButton(true);
                // DisableButton(true);

                CurrencyFormat.NumberDecimalDigits =
                    CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY);
                ActivityDimension1.MinDecimalPlaces = MinDecimalPlaces.SameAsDecimalPlaces;
                ActivityDimension1.NumberFormat = CurrencyFormat;
                ActivityDimension2.MinDecimalPlaces = MinDecimalPlaces.SameAsDecimalPlaces;
                ActivityDimension2.NumberFormat = CurrencyFormat;
                ActivityDimension3.MinDecimalPlaces = MinDecimalPlaces.SameAsDecimalPlaces;
                ActivityDimension3.NumberFormat = CurrencyFormat;
                ActivityNumber.MinDecimalPlaces = MinDecimalPlaces.SameAsDecimalPlaces;
                ActivityNumber.NumberFormat = CurrencyFormat;
                ActivityQuantity.MinDecimalPlaces = MinDecimalPlaces.SameAsDecimalPlaces;
                ActivityQuantity.NumberFormat = CurrencyFormat;
            }
        }

        public void LoadItem(string moduleID, int parentInstanceID, int itemID)
        {
            LoadItem(moduleID, parentInstanceID, itemID, false);
        }

        public void LoadItem(string moduleID, int parentInstanceID, int itemID, bool isContractView)
        {
            if (Visible)
            {
                gridActivity.EnableViewState = true;
                UIHelper.SetGridLayout(gridActivity);
                ItemID = itemID;
                gridActivity.DisplayLayout.ColFootersVisibleDefault = ShowMarginInfo.Yes;

                if (itemID &gt; 0)
                    BindActivityGrid(moduleID, parentInstanceID, itemID, isContractView);

                if (!DisplayActivityQuantity)
                {
                    trMB.Style.Add(HtmlTextWriterStyle.Display, &quot;none&quot;);
                    trActivityNumber.Style.Add(HtmlTextWriterStyle.Display, &quot;none&quot;);
                    trActivityDimension1.Style.Add(HtmlTextWriterStyle.Display, &quot;none&quot;);
                    trActivityDimension2.Style.Add(HtmlTextWriterStyle.Display, &quot;none&quot;);
                    trActivityDimension3.Style.Add(HtmlTextWriterStyle.Display, &quot;none&quot;);
                }

                btnActivityDelete.Attributes.Add(&quot;onclick&quot;,
                    &quot;DeleteActivity(&#39;&quot; + gridActivity.ClientID + &quot;&#39;,&#39;&quot; +
                    DeleteActivityId.ClientID + &quot;&#39;, true)&quot;);
                DeleteActivityId.Attributes.Add(&quot;style&quot;, &quot;Display:none;&quot;);
                MBEnable.Attributes.Add(&quot;onClick&quot;,
                    &quot;MB_Click(); HideColumn(&#39;&quot; + MBEnable.ClientID + &quot;&#39;,&#39;&quot; + trActivityNumber.ClientID +
                    &quot;&#39;, true)&quot;);
                Dimension1.Attributes.Add(&quot;onClick&quot;,
                    &quot;HideColumn(&#39;&quot; + Dimension1.ClientID + &quot;&#39;,&#39;&quot; + trActivityDimension1.ClientID +
                    &quot;&#39;, true)&quot;);
                Dimension2.Attributes.Add(&quot;onClick&quot;,
                    &quot;HideColumn(&#39;&quot; + Dimension2.ClientID + &quot;&#39;,&#39;&quot; + trActivityDimension2.ClientID +
                    &quot;&#39;, true)&quot;);
                Dimension3.Attributes.Add(&quot;onClick&quot;,
                    &quot;HideColumn(&#39;&quot; + Dimension3.ClientID + &quot;&#39;,&#39;&quot; + trActivityDimension3.ClientID +
                    &quot;&#39;, true)&quot;);
            }
        }

        public void LoadItem(int itemID)
        {
            LoadItem(ModuleID, ParentInstanceID, itemID, false);
        }

        public void LoadItem(int itemID, bool isContractView)
        {
            LoadItem(ModuleID, ParentInstanceID, itemID, isContractView);
        }

        public void SetStdItemNoAndDescTemporarily(string StdItemNo, string description)
        {
            lblStdItemID.Text = StdItemNo;
            lblItemDesc.Text = description;
        }

        public void BindUnits(DataTable dataTable, string textFieldColumn, string valueFieldColumn)
        {
            if (ddlUnitID != null)
                UIHelper.BindDropDownData(ddlUnitID, dataTable, textFieldColumn, valueFieldColumn);
            if (ddlUnitIDDim1 != null)
                UIHelper.BindDropDownData(ddlUnitIDDim1, dataTable, textFieldColumn, valueFieldColumn);
            if (ddlUnitIDDim2 != null)
                UIHelper.BindDropDownData(ddlUnitIDDim2, dataTable, textFieldColumn, valueFieldColumn);
            if (ddlUnitIDDim3 != null)
                UIHelper.BindDropDownData(ddlUnitIDDim3, dataTable, textFieldColumn, valueFieldColumn);
            if (valListUnits != null)
                UIHelper.BindDropDownData(valListUnits, dataTable, textFieldColumn, valueFieldColumn);
        }

        private void ShowDiv(ActivityDivEnums divType)
        {
            DivActivities.Visible = (ActivityDivEnums.Activities == divType);
            ucResourcePicker.Visible = DivResourcePicker.Visible = (ActivityDivEnums.ResourcePicker == divType);
        }

        protected void Page_Load(object sender, EventArgs e)
        {
            gridActivity.DisplayLayout.AllowUpdateDefault = AllowUpdate.Yes;
            RegisterCallBackScript();
        }

        private void RegisterCallBackScript()
        {
            var sb = new StringBuilder();
            sb.Append(&quot;&lt;script language=\&quot;javascript\&quot; type=\&quot;text/javascript\&quot;&gt;&quot;);
            sb.Append(&quot;function SendServerRequest(arguments,context){&quot;);
            sb.Append(&quot;try{ ShowLoadingOnRequest(); }catch(ex){ }&quot;);
            sb.Append(Page.ClientScript.GetCallbackEventReference(this, &quot;arguments&quot;, &quot;HandleServerResponse&quot;, &quot;context&quot;,
                true));
            sb.Append(&quot;}&quot;);
            sb.Append(&quot;&lt;/script&gt;&quot;);
            Page.ClientScript.RegisterStartupScript(GetType(), &quot;CallBackScript&quot;, sb.ToString2());
        }

        protected override void OnPreRender(EventArgs e)
        {
            gridActivity.DisplayLayout.AllowAddNewDefault = AllowAddNew.Yes;
            gridActivity.DisplayLayout.ClientSideEvents.AfterExitEditModeHandler = &quot;UpdateGridData&quot;;

            ColumnsCollection cols = gridActivity.Columns;
            foreach (UltraGridColumn ugc in cols)
                ugc.AllowUpdate = AllowUpdate.No;
            // MAKE COLUMNS EDITABLE IN CASE OF ACTIVITY CREATION
            if (ModuleID != &quot;ITMPOST&quot;)
            {
                string[] editableColumns =
                {
                    &quot;Name&quot;, &quot;Description&quot;, &quot;Percentage&quot;, &quot;Unit&quot;, &quot;Number&quot;, &quot;Dimension1&quot;,
                    &quot;UnitDim1&quot;, &quot;Dimension2&quot;, &quot;UnitDim2&quot;, &quot;Dimension3&quot;, &quot;UnitDim3&quot;
                };
                foreach (string editablecol in editableColumns)
                    if (cols.Exists(editablecol)) cols.FromKey(editablecol).AllowUpdate = AllowUpdate.Yes;
            }
            else
            {
                string[] editableColumns =
                {
                    &quot;Number&quot;, &quot;Dimension1&quot;, &quot;UnitDim1&quot;, &quot;Dimension2&quot;, &quot;UnitDim2&quot;, &quot;Dimension3&quot;,
                    &quot;UnitDim3&quot;, &quot;IsComplete&quot;
                };
                foreach (string editablecol in editableColumns)
                    if (cols.Exists(editablecol)) cols.FromKey(editablecol).AllowUpdate = AllowUpdate.Yes;

                for (int i = 0; i &lt; gridActivity.Rows.Count; i++)
                {
                    if (gridActivity.Rows[i].Cells.FromKey(&quot;Dimension1&quot;).Value == null)
                        gridActivity.Rows[i].Cells.FromKey(&quot;Dimension1&quot;).AllowEditing = AllowEditing.No;
                    if (gridActivity.Rows[i].Cells.FromKey(&quot;Dimension2&quot;).Value == null)
                        gridActivity.Rows[i].Cells.FromKey(&quot;Dimension2&quot;).AllowEditing = AllowEditing.No;
                    if (gridActivity.Rows[i].Cells.FromKey(&quot;Dimension3&quot;).Value == null)
                        gridActivity.Rows[i].Cells.FromKey(&quot;Dimension3&quot;).AllowEditing = AllowEditing.No;
                }
            }

            if (ReadOnly)
                foreach (UltraGridColumn ugc in gridActivity.Columns)
                    ugc.AllowUpdate = AllowUpdate.No;

            if (Visible)
            {
                MasterPage obj = Page.Master;
                if (Page.Master.Master != null)
                    obj = Page.Master.Master;
                if (obj != null &amp;&amp; obj.FindControl(&quot;ToolbarRow&quot;) != null)
                    (obj.FindControl(&quot;ToolbarRow&quot;) as Literal).Text = &quot;&lt;tr style=&#39;display:none&#39;&gt;&quot;;
            }
            if (!btnActivityAdd.Visible &amp;&amp; MainToolBar.GetMenuReference(&quot;lnkNew&quot;) != null)
                MainToolBar.HideMenu(&quot;lnkNew&quot;);
            if (!btnActivityDelete.Visible &amp;&amp; MainToolBar.GetMenuReference(&quot;lnkDelete&quot;) != null)
                MainToolBar.HideMenu(&quot;lnkDelete&quot;);
            if (!btnActivitySchedule.Visible &amp;&amp; MainToolBar.GetMenuReference(&quot;lnkSchedule&quot;) != null)
                MainToolBar.HideMenu(&quot;lnkSchedule&quot;);
            if (!btnActivityDone.Visible &amp;&amp; MainToolBar.GetMenuReference(&quot;lnkDone&quot;) != null)
                MainToolBar.HideMenu(&quot;lnkDone&quot;);
            if (!btnActivityAddFromLibrary.Visible &amp;&amp; MainToolBar.GetMenuReference(&quot;lnkAddFromLibrary&quot;) != null)
                MainToolBar.HideMenu(&quot;lnkAddFromLibrary&quot;);

            base.OnPreRender(e);
        }

        private void DisableButton(bool value)
        {
            btnActivityAdd.Attributes.Add(&quot;onclick&quot;, &quot;ShowInputForm(0); return false;&quot;);
            if (MainToolBar.GetMenuReference(&quot;lnkNew&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkNew&quot;).OnClientClick = &quot;ShowInputForm(0); return false;&quot;;
                MainToolBar.GetMenuReference(&quot;lnkNew&quot;).CausesValidation = true;
                MainToolBar.GetMenuReference(&quot;lnkNew&quot;).ValidationGroup = &quot;Master&quot;;
            }
            btnActivityDelete.Attributes.Add(&quot;onclick&quot;, &quot;return DeleteActivity();&quot;);
            if (MainToolBar.GetMenuReference(&quot;lnkDelete&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).OnClientClick = &quot;return DeleteActivity();&quot;;
                MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).CausesValidation = true;
                MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).ValidationGroup = &quot;Master&quot;;
            }
            btnActivityEdit.Attributes.Add(&quot;onclick&quot;, &quot;ShowInputForm(1); return false;&quot;);
            btnActivitySchedule.Attributes.Add(&quot;onclick&quot;, &quot;ShowInputForm(2); return false;&quot;);
            if (MainToolBar.GetMenuReference(&quot;lnkSchedule&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkSchedule&quot;).OnClientClick = &quot;ShowInputForm(2); return false;&quot;;
                MainToolBar.GetMenuReference(&quot;lnkSchedule&quot;).CausesValidation = true;
                MainToolBar.GetMenuReference(&quot;lnkSchedule&quot;).ValidationGroup = &quot;Master&quot;;
            }
            if (btnActivityAdd != null &amp;&amp; DisableNew &amp;&amp; ModuleID == &quot;ITMPOST&quot;)
                btnActivityAdd.Visible = false;
            if (btnActivityDelete != null &amp;&amp; DisableNew &amp;&amp; ModuleID == &quot;ITMPOST&quot;)
                btnActivityDelete.Visible = false;
            if (btnActivityAddFromLibrary != null &amp;&amp; DisableNew &amp;&amp; ModuleID == &quot;ITMPOST&quot;)
                btnActivityAddFromLibrary.Visible = false;
        }

        private string RenderGrid(DataTable dt)
        {
            var sb = new StringBuilder();
            sb.Append(
                &quot;&lt;table class=&#39;nodetable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;headeritem&#39;&gt;Item&lt;/td&gt;&lt;td class=&#39;headerdate&#39;&gt;Start Date&lt;/td&gt;&lt;td class=&#39;headerdate&#39;&gt;End Date&lt;/td&gt;&lt;/tr&gt;&quot;);
            foreach (DataRow dr in dt.Rows)
            {
                if (!dr.IsNull(&quot;StartDate&quot;) &amp;&amp; !dr.IsNull(&quot;EndDate&quot;))
                    sb.AppendFormat(CultureInfo.CurrentCulture,
                        &quot;&lt;tr class=&#39;tritem&#39;&gt;&lt;td class=&#39;tditem&#39;&gt;{0}&lt;/td&gt;&lt;td class=&#39;tditem&#39;&gt;{1}&lt;/td&gt;&lt;td class=&#39;tditem&#39;&gt;{2}&lt;/td&gt;&lt;/tr&gt;&quot;,
                        Server.HtmlEncode(dr[&quot;SubItem&quot;].ToString2().Replace(&quot;[No Sub Item]&quot;,
                            lblItemDesc.Text)),
                        dr[&quot;StartDate&quot;].ToMWDateTimeString_FormatDateTime(),
                        dr[&quot;EndDate&quot;].ToMWDateTimeString_FormatDateTime());
            }
            sb.Append(&quot;&lt;/table&gt;&quot;);

            sb.Append(&quot;&lt;table&gt;&quot;);
            sb.Append(&quot;&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);
            sb.Append(
                &quot;&lt;tr&gt;&lt;td&gt;&lt;input type=&#39;button&#39; onclick=&#39;ADClose()&#39; value=&#39;Close&#39; class=&#39;btnC&#39; style=&#39;width:80px;&#39; /&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);
            sb.Append(&quot;&lt;/table&gt;&quot;);
            return sb.ToString2();
        }

        private bool GetContractLockStatus()
        {
            if (!ModuleID.Equals(Constants.MODID_CONTMGT)) return false;

            if (ItemID == -1) return false;

            Item currentItem = ItemManager.Instance.GetItemDetails(Constants.MODID_CONTMGT, Request[&quot;ParentID&quot;].Parse2(),
                ItemID);
            if (currentItem.IsNonContract != null &amp;&amp; bool.Parse(currentItem.IsNonContract.ToString2())) return false;

            Aurigo.Brix.Platform.BusinessLayer.DataAccessHelper.StoredProcedure usp_CONTMGTMasterGetLockedStatus =
                new Aurigo.Brix.Platform.BusinessLayer.DataAccessHelper.StoredProcedure
                {
                    Name = &quot;usp_CONTMGTMasterGetLockedStatus&quot;,
                    Input = &quot;ID&quot;
                };

            return
                bool.Parse(
                    ComponentHelper.Instance.ExecuteScalar(usp_CONTMGTMasterGetLockedStatus, null, Request[&quot;ParentID&quot;])
                        .ToString2());
        }

        #region ToolBar Menu

        protected void CreateToolBarMenu()
        {
            //var menus = new MenuArray();
            //menus.Add(new BrixMenu(&quot;lnkNew&quot;, &quot;New&quot;, &quot;Icn_New.png&quot;, 55));
            //menus.Add(new BrixMenu(&quot;lnkDelete&quot;, &quot;Delete&quot;, &quot;Icn_Delete.png&quot;, 55));
            //menus.Add(new BrixMenu(&quot;lnkAddFromLibrary&quot;, &quot;Library&quot;, &quot;Icn_New.png&quot;, 70));
            //menus.Add(new BrixMenu(&quot;lnkSchedule&quot;, &quot;Schedule&quot;, &quot;Calendar32.png&quot;, 55));
            //menus.Add(new BrixMenu(&quot;lnkDone&quot;, &quot;Done&quot;, &quot;Icn_Done.png&quot;, 55));
            //MainToolBar.CreateToolBar(menus);

            var menuGroups = new List&lt;MenuGroup&gt;();
            MenuGroup generalGroup = new MenuGroup(&quot;General&quot;);
            generalGroup.AddMenu(new TextIcon(&quot;lnkNew&quot;, &quot;New&quot;, &quot;Icn_New_16.png&quot;));
            generalGroup.AddMenu(new TextIcon(&quot;lnkDelete&quot;, &quot;Delete&quot;, &quot;Icn_Delete_16.png&quot;));
            generalGroup.AddMenu(new TextIcon(&quot;lnkAddFromLibrary&quot;, &quot;Add from Library&quot;, &quot;Icn_Library_16.png&quot;));
            generalGroup.AddMenu(new TextIcon(&quot;lnkSchedule&quot;, &quot;Schedule&quot;, &quot;Icn_Scheduling_16.png&quot;));
            generalGroup.AddMenu(new LargeButton(&quot;lnkDone&quot;, &quot;Done&quot;, &quot;Icn_Done.png&quot;));
            menuGroups.Add(generalGroup);
            MainToolBar.CreateToolBar(menuGroups);

            if (MainToolBar.GetMenuReference(&quot;lnkNew&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkNew&quot;).OnClientClick = &quot;AddGridRow(); return false;&quot;;
                MainToolBar.GetMenuReference(&quot;lnkNew&quot;).CausesValidation = true;
                MainToolBar.GetMenuReference(&quot;lnkNew&quot;).ValidationGroup = &quot;Master&quot;;
            }
            if (MainToolBar.GetMenuReference(&quot;lnkDelete&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).OnClientClick = &quot;return DeleteActivity();&quot;;
                MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).CausesValidation = true;
                MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).ValidationGroup = &quot;Master&quot;;
            }
            if (MainToolBar.GetMenuReference(&quot;lnkAddFromLibrary&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkAddFromLibrary&quot;).Click += btnActivityAddFromLibrary_Click;
                MainToolBar.GetMenuReference(&quot;lnkAddFromLibrary&quot;).CausesValidation = true;
                MainToolBar.GetMenuReference(&quot;lnkAddFromLibrary&quot;).ValidationGroup = &quot;Master&quot;;
            }
            if (MainToolBar.GetMenuReference(&quot;lnkSchedule&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkSchedule&quot;).OnClientClick = &quot;ShowInputForm(2); return false;&quot;;
                MainToolBar.GetMenuReference(&quot;lnkSchedule&quot;).CausesValidation = true;
                MainToolBar.GetMenuReference(&quot;lnkSchedule&quot;).ValidationGroup = &quot;Master&quot;;
            }
            if (MainToolBar.GetMenuReference(&quot;lnkDone&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkDone&quot;).Click += btnDone_Click;
                MainToolBar.GetMenuReference(&quot;lnkDone&quot;).OnClientClick = &quot;return CheckActivityPercentage();&quot;;
                MainToolBar.GetMenuReference(&quot;lnkDone&quot;).CausesValidation = true;
                MainToolBar.GetMenuReference(&quot;lnkDone&quot;).ValidationGroup = &quot;Master&quot;;
            }
        }

        private void resourcePicker_BindData(string Filter, string SortOrder, out DataSet DsResult, ref int CurrentPage,
            int PageSize, out int PageCount)
        {
            DsResult = LibraryBL.LibraryInterface.Instance.GetActivities(MeasSysID, ((CurrentPage - 1)*PageSize) + 1,
                PageSize, SortOrder, Filter);
            //PageCount = (int)Math.Ceiling((double)(DsResult.Tables[0].Rows.Count / PageSize));

            PageCount = DsResult.Tables[0].Rows.Count &gt; PageSize
                ? (int)Math.Ceiling((double)(DsResult.Tables[0].Rows.Count/PageSize))
                : (int)(DsResult.Tables[0].Rows.Count) &gt; 0 ? 1 : 1;
            //CurrentPage = PageCount &gt; 0 ? CurrentPage : 0;
        }

        #endregion
    }

    public enum ActivityDivEnums
    {
        Activities = 1,
        ResourcePicker = 2
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[32,9,32,58,1],[35,9,35,99,1],[47,17,47,18,0],[47,19,47,42,0],[47,43,47,44,0],[48,17,48,18,1],[48,19,48,43,1],[48,44,48,45,1],[54,13,54,14,1],[55,17,55,73,1],[56,17,56,54,1],[57,13,57,14,1],[62,17,62,18,1],[62,19,62,53,1],[62,54,62,55,1],[63,17,63,18,1],[63,19,63,61,1],[63,62,63,63,1],[69,13,69,14,0],[70,17,70,76,0],[71,17,71,24,0],[71,26,71,36,0],[71,37,71,39,0],[71,40,71,80,0],[72,17,72,18,0],[73,21,73,110,0],[74,25,74,36,0],[75,17,75,18,0],[76,17,76,37,0],[77,13,77,14,0],[83,13,83,14,1],[84,17,84,43,1],[85,17,88,49,1],[89,13,89,14,1],[90,17,90,18,1],[90,19,90,44,1],[90,45,90,46,1],[95,17,95,18,1],[95,19,95,65,1],[95,66,95,67,1],[97,13,97,14,1],[98,17,100,25,1],[101,13,101,14,1],[106,17,106,18,0],[106,19,106,57,0],[106,58,106,59,0],[108,13,108,14,1],[109,17,109,55,1],[110,17,111,64,1],[112,13,112,14,1],[117,17,117,18,0],[117,19,117,60,0],[117,61,117,62,0],[118,17,118,18,1],[118,19,118,60,1],[118,61,118,62,1],[124,13,124,14,1],[125,17,127,26,1],[128,13,128,14,1],[129,17,129,18,0],[129,19,129,63,0],[129,64,129,65,0],[135,13,135,14,0],[136,17,136,52,0],[137,17,137,89,0],[138,17,138,39,0],[139,17,139,18,0],[140,21,140,72,0],[141,25,141,56,0],[142,21,142,75,0],[143,25,143,59,0],[144,17,144,18,0],[145,13,145,14,0],[146,17,146,18,0],[146,19,146,53,0],[146,54,146,55,0],[151,17,151,18,0],[151,19,151,52,0],[151,53,151,54,0],[152,17,152,18,0],[152,19,152,53,0],[152,54,152,55,0],[157,17,157,18,1],[157,19,157,45,1],[157,46,157,47,1],[158,17,158,18,0],[158,19,158,46,0],[158,47,158,48,0],[163,17,163,18,1],[163,19,163,45,1],[163,46,163,47,1],[164,17,164,18,0],[164,19,164,46,0],[164,47,164,48,0],[167,42,167,46,1],[167,47,167,51,0],[171,17,171,18,1],[171,19,171,50,1],[171,51,171,52,1],[173,13,173,14,0],[174,17,176,58,0],[177,17,185,75,0],[186,13,186,14,0],[191,17,191,18,0],[191,19,191,54,0],[191,55,191,56,0],[192,17,192,18,1],[192,19,192,55,1],[192,56,192,57,1],[197,17,197,18,1],[197,19,197,58,1],[197,59,197,60,1],[198,17,198,18,0],[198,19,198,90,0],[198,91,198,92,0],[204,9,204,10,0],[205,13,205,35,0],[206,9,206,10,0],[209,9,209,10,0],[211,13,211,14,0],[212,17,212,38,0],[213,17,213,97,0],[217,17,217,24,0],[217,26,217,36,0],[217,37,217,39,0],[217,40,217,47,0],[218,21,218,72,0],[219,21,219,22,0],[220,25,220,42,0],[221,25,221,31,0],[226,17,226,30,0],[227,21,227,53,0],[229,17,229,18,0],[230,21,230,50,0],[231,21,231,110,0],[232,21,234,100,0],[235,21,235,43,0],[237,21,237,42,0],[238,21,238,53,0],[239,21,240,137,0],[241,21,241,43,0],[243,21,243,53,0],[244,17,244,18,0],[245,13,245,14,0],[246,13,246,30,0],[247,13,247,14,0],[248,17,248,37,0],[249,13,249,14,0],[250,9,250,10,0],[257,9,257,10,0],[258,13,258,37,0],[259,17,259,38,0],[260,9,260,10,0],[263,9,263,10,1],[264,13,264,47,1],[265,13,265,51,1],[267,13,267,33,1],[271,13,271,70,1],[272,13,272,72,1],[278,13,278,103,1],[279,13,279,14,0],[280,17,280,57,0],[281,17,283,74,0],[284,17,284,65,0],[285,17,285,55,0],[286,17,286,60,0],[287,17,287,96,0],[288,17,288,96,0],[289,17,289,59,0],[290,13,290,14,0],[292,13,292,14,1],[293,17,293,87,1],[294,17,294,68,1],[295,13,295,14,1],[297,13,297,58,1],[298,13,298,55,1],[299,13,299,56,1],[300,13,300,88,1],[301,13,301,98,1],[302,13,302,49,1],[303,13,303,47,1],[304,13,304,51,1],[305,13,305,80,1],[306,13,306,52,1],[307,13,307,70,1],[309,13,310,118,1],[312,13,312,28,1],[313,9,313,10,1],[316,9,316,10,1],[317,13,317,45,1],[319,13,319,43,1],[320,13,320,41,1],[321,13,321,38,1],[322,13,322,58,1],[324,13,324,43,1],[325,13,325,48,1],[326,13,326,45,1],[327,13,327,58,1],[329,13,329,28,1],[330,9,330,10,1],[333,9,333,10,1],[334,13,334,89,1],[335,13,335,14,0],[336,17,336,77,0],[337,17,337,24,0],[337,26,337,44,0],[337,45,337,47,0],[337,48,337,59,0],[338,21,338,57,0],[339,17,339,83,0],[340,13,340,14,0],[341,13,341,34,1],[342,13,342,14,0],[343,17,344,87,0],[345,17,345,18,0],[346,21,346,28,0],[346,30,346,48,0],[346,49,346,51,0],[346,52,346,63,0],[347,25,347,61,0],[348,17,348,18,0],[350,17,350,18,0],[351,21,351,66,0],[352,21,352,86,0],[353,17,353,18,0],[354,13,354,14,0],[355,13,355,32,1],[356,13,357,99,1],[358,13,358,14,1],[359,17,359,121,1],[360,17,360,106,1],[361,17,361,18,0],[362,21,363,107,0],[364,21,364,28,0],[364,30,364,48,0],[364,49,364,51,0],[364,52,364,63,0],[365,25,365,67,0],[366,29,366,65,0],[367,17,367,18,0],[368,13,368,14,1],[369,9,369,10,1],[372,9,372,10,0],[373,13,373,60,0],[375,13,375,49,0],[376,13,376,20,0],[376,22,376,37,0],[376,38,376,40,0],[376,41,376,58,0],[377,17,377,70,0],[379,13,379,38,0],[380,13,380,20,0],[380,22,380,32,0],[380,33,380,35,0],[380,36,380,59,0],[381,13,381,14,0],[382,17,382,87,0],[383,17,383,18,0],[384,21,384,40,0],[385,21,385,30,0],[388,17,388,68,0],[389,17,389,74,0],[390,17,390,88,0],[391,17,391,59,0],[392,17,392,74,0],[393,17,393,38,0],[394,17,394,18,0],[395,21,395,28,0],[395,30,395,48,0],[395,49,395,51,0],[395,52,395,61,0],[396,25,396,62,0],[397,21,397,67,0],[398,17,398,18,0],[399,13,399,14,0],[401,13,401,50,0],[402,13,403,105,0],[405,13,405,29,0],[406,17,407,79,0],[408,9,408,10,0],[411,9,411,10,0],[412,13,412,46,0],[414,13,414,27,0],[415,13,415,14,0],[418,17,418,76,0],[419,17,419,18,0],[420,21,420,117,0],[421,21,421,28,0],[421,30,421,47,0],[421,48,421,50,0],[421,51,421,77,0],[422,21,422,22,0],[423,25,423,47,0],[424,25,424,75,0],[425,25,425,26,0],[426,29,427,48,0],[431,29,431,57,0],[432,29,432,30,0],[433,33,433,112,0],[434,33,434,72,0],[435,37,435,69,0],[436,29,436,30,0],[439,25,439,26,0],[440,21,440,22,0],[441,17,441,18,0],[443,17,443,24,0],[443,26,443,42,0],[443,43,443,45,0],[443,46,443,63,0],[444,17,444,18,0],[445,21,445,64,0],[449,21,449,49,0],[450,21,450,22,0],[451,25,451,102,0],[452,25,452,64,0],[453,25,453,26,0],[454,29,454,61,0],[455,29,455,35,0],[457,21,457,22,0],[460,17,460,18,0],[466,17,466,54,0],[467,17,467,18,0],[468,21,468,80,0],[469,21,469,22,0],[470,25,470,121,0],[471,25,471,32,0],[471,34,471,51,0],[471,52,471,54,0],[471,55,471,81,0],[472,29,472,77,0],[473,21,473,22,0],[475,21,475,28,0],[475,30,475,46,0],[475,47,475,49,0],[475,50,475,67,0],[476,25,476,80,0],[477,17,477,18,0],[480,13,480,14,0],[482,13,482,51,0],[483,13,483,14,0],[484,17,484,40,0],[487,17,487,54,0],[488,13,488,14,0],[490,17,490,34,0],[491,9,491,10,0],[494,9,494,10,0],[496,13,496,66,0],[497,13,498,91,0],[499,9,499,10,0],[502,9,502,10,0],[503,13,503,38,0],[504,13,504,63,0],[505,17,505,96,0],[506,13,506,64,0],[507,17,507,86,0],[508,13,508,57,0],[508,58,508,113,0],[510,13,510,30,0],[511,13,511,102,0],[512,13,512,72,0],[512,73,512,108,0],[514,13,514,37,0],[515,13,515,53,0],[516,13,516,33,0],[517,13,517,63,0],[518,17,518,97,0],[520,13,521,104,0],[522,17,522,45,0],[524,17,524,36,0],[526,13,526,59,0],[527,13,527,14,0],[528,17,528,40,0],[529,17,529,97,0],[530,17,530,41,0],[531,13,531,14,0],[533,13,533,34,0],[535,13,535,57,0],[536,17,536,97,0],[537,17,537,18,0],[538,21,538,45,0],[539,21,540,121,0],[541,17,541,18,0],[543,17,543,18,0],[544,21,545,115,0],[546,25,548,45,0],[549,21,549,63,0],[550,17,550,18,0],[553,13,553,63,0],[554,13,554,14,0],[555,17,555,38,0],[556,17,556,99,0],[557,17,557,43,0],[558,17,558,65,0],[559,17,559,18,0],[560,21,560,115,0],[561,21,561,71,0],[576,17,576,18,0],[577,13,577,14,0],[579,13,579,63,0],[580,13,580,14,0],[581,17,581,38,0],[582,17,582,99,0],[583,17,583,43,0],[584,17,584,65,0],[585,17,585,18,0],[586,21,586,115,0],[587,21,587,71,0],[602,17,602,18,0],[603,13,603,14,0],[605,13,605,63,0],[606,13,606,14,0],[607,17,607,38,0],[608,17,608,99,0],[609,17,609,43,0],[610,17,610,65,0],[611,17,611,18,0],[612,21,612,115,0],[613,21,613,71,0],[628,17,628,18,0],[629,13,629,14,0],[631,13,631,77,0],[633,13,633,34,0],[634,13,634,14,0],[635,17,637,40,0],[638,13,638,14,0],[640,17,640,41,0],[641,13,641,24,0],[642,9,642,10,0],[645,9,645,10,0],[646,13,646,50,0],[647,13,648,105,0],[649,13,649,56,0],[650,9,650,10,0],[653,9,653,10,0],[654,13,654,54,0],[657,13,657,103,0],[658,13,658,14,0],[659,17,659,57,0],[660,17,662,74,0],[663,17,663,65,0],[664,17,664,55,0],[665,17,665,60,0],[666,17,666,96,0],[667,17,667,96,0],[668,17,668,59,0],[669,13,669,14,0],[671,13,671,14,0],[672,17,672,87,0],[673,17,673,68,0],[674,13,674,14,0],[676,13,676,85,0],[677,13,677,100,0],[678,9,678,10,0],[681,9,681,10,1],[682,13,682,78,1],[683,9,683,10,1],[686,9,686,10,1],[687,13,688,33,1],[689,13,689,47,1],[690,13,690,14,1],[691,17,691,67,1],[692,13,692,14,1],[693,13,693,28,1],[694,17,694,70,1],[695,9,695,10,1],[698,9,698,10,1],[699,13,699,73,1],[700,9,700,10,1],[703,9,703,10,1],[704,13,704,57,1],[705,13,705,109,1],[708,13,708,82,1],[709,13,709,47,1],[710,13,710,14,1],[711,17,711,79,1],[712,17,712,41,1],[714,17,714,58,1],[716,17,716,63,1],[718,17,718,47,1],[719,17,719,18,1],[720,21,720,75,1],[721,21,721,78,1],[722,17,722,18,1],[725,17,725,93,1],[726,17,726,24,1],[726,26,726,39,1],[726,40,726,42,1],[726,43,726,57,1],[727,21,727,45,1],[728,21,728,22,1],[729,25,731,107,1],[732,25,732,77,1],[733,25,735,80,1],[736,21,736,22,1],[739,17,739,87,1],[740,17,740,24,1],[740,26,740,40,1],[740,41,740,43,1],[740,44,740,55,1],[741,21,741,46,1],[742,21,742,22,1],[743,25,743,72,1],[744,25,744,106,1],[745,25,745,110,1],[746,25,746,77,1],[747,21,747,22,1],[750,17,750,97,1],[751,17,751,24,1],[751,26,751,42,1],[751,43,751,45,1],[751,46,751,57,1],[752,21,752,48,1],[753,25,753,107,1],[757,17,764,20,1],[766,17,766,46,1],[767,17,767,18,1],[768,21,768,49,1],[769,21,769,53,1],[770,21,770,53,1],[771,21,771,53,1],[772,21,772,51,1],[773,21,773,51,1],[774,21,774,51,1],[775,21,775,51,1],[776,17,776,18,1],[778,17,778,38,1],[779,21,779,53,1],[781,17,781,41,1],[782,17,782,18,1],[783,21,783,55,1],[784,21,784,60,1],[785,17,785,18,1],[787,17,787,43,1],[788,17,788,18,0],[789,21,789,51,0],[790,21,790,51,0],[791,21,791,51,0],[792,17,792,18,0],[793,17,793,24,1],[793,26,793,45,1],[793,46,793,48,1],[793,49,793,53,1],[794,17,794,18,1],[795,21,795,66,1],[798,21,798,50,1],[799,17,799,18,1],[802,17,802,73,1],[803,17,803,67,1],[804,17,804,71,1],[805,17,805,60,1],[806,17,806,104,1],[807,17,807,104,1],[808,17,808,104,1],[809,17,809,112,1],[810,17,810,112,1],[811,17,811,112,1],[813,17,813,92,1],[814,17,814,18,1],[815,21,815,102,1],[816,21,816,98,1],[817,17,817,18,1],[820,17,820,107,1],[821,17,821,18,0],[822,21,822,82,0],[823,21,826,83,0],[827,21,827,97,0],[828,21,828,78,0],[829,21,830,61,0],[831,21,831,35,0],[832,21,832,57,0],[833,21,833,121,0],[834,21,834,22,0],[835,25,835,69,0],[837,25,837,61,0],[838,25,838,64,0],[839,25,839,62,0],[840,21,840,22,0],[841,17,841,18,0],[843,17,843,69,1],[844,17,844,37,1],[847,17,848,112,1],[849,17,849,92,1],[850,17,850,66,1],[851,17,851,92,1],[852,17,852,66,1],[853,17,853,92,1],[854,17,854,66,1],[855,17,855,88,1],[856,17,856,62,1],[857,17,857,90,1],[858,17,858,64,1],[859,13,859,14,1],[860,9,860,10,1],[863,9,863,10,0],[864,13,864,65,0],[865,9,865,10,0],[868,9,868,10,0],[869,13,869,25,0],[870,13,870,14,0],[871,17,871,53,0],[872,17,872,54,0],[873,17,873,33,0],[874,17,874,90,0],[876,17,876,32,0],[877,21,877,90,0],[879,17,879,46,0],[880,17,880,18,0],[881,21,881,73,0],[882,21,882,85,0],[883,21,883,89,0],[884,21,884,89,0],[885,21,885,89,0],[886,17,886,18,0],[888,17,890,61,0],[891,17,891,75,0],[892,17,894,33,0],[895,17,897,33,0],[898,17,900,33,0],[901,17,903,33,0],[904,13,904,14,0],[905,9,905,10,0],[908,9,908,10,0],[909,13,909,65,0],[910,9,910,10,0],[913,9,913,10,0],[914,13,914,74,0],[915,9,915,10,0],[918,9,918,10,0],[919,13,919,43,0],[920,13,920,44,0],[921,9,921,10,0],[924,9,924,10,1],[925,13,925,35,1],[926,17,926,100,1],[927,13,927,39,1],[928,17,928,104,1],[929,13,929,39,1],[930,17,930,104,1],[931,13,931,39,1],[932,17,932,104,1],[933,13,933,38,1],[934,17,934,103,1],[935,9,935,10,1],[938,9,938,10,0],[939,13,939,78,0],[940,13,940,113,0],[941,9,941,10,0],[944,9,944,10,1],[945,13,945,77,1],[946,13,946,38,1],[947,9,947,10,1],[950,9,950,10,1],[951,13,951,42,1],[952,13,952,84,1],[953,13,953,73,1],[954,13,954,69,1],[955,13,956,24,1],[957,13,957,28,1],[958,13,958,36,1],[959,13,959,98,1],[960,9,960,10,1],[963,9,963,10,0],[964,13,964,77,0],[965,13,965,101,0],[967,13,967,59,0],[968,13,968,20,0],[968,22,968,41,0],[968,42,968,44,0],[968,45,968,49,0],[969,17,969,50,0],[971,13,971,39,0],[972,13,972,14,0],[973,17,977,19,0],[978,17,978,24,0],[978,26,978,44,0],[978,45,978,47,0],[978,48,978,63,0],[979,21,979,50,0],[979,51,979,107,0],[980,13,980,14,0],[982,13,982,14,0],[983,17,987,19,0],[988,17,988,24,0],[988,26,988,44,0],[988,45,988,47,0],[988,48,988,63,0],[989,21,989,50,0],[989,51,989,107,0],[991,22,991,31,0],[991,33,991,60,0],[991,62,991,65,0],[992,17,992,18,0],[993,21,993,88,0],[994,25,994,105,0],[995,21,995,88,0],[996,25,996,105,0],[997,21,997,88,0],[998,25,998,105,0],[999,17,999,18,0],[1000,13,1000,14,0],[1002,13,1002,26,0],[1003,17,1003,24,0],[1003,26,1003,45,0],[1003,46,1003,48,0],[1003,49,1003,69,0],[1004,21,1004,54,0],[1006,13,1006,25,0],[1007,13,1007,14,0],[1008,17,1008,46,0],[1009,17,1009,48,0],[1010,21,1010,46,0],[1011,17,1011,74,0],[1012,21,1012,99,0],[1013,13,1013,14,0],[1014,13,1014,91,0],[1015,17,1015,48,0],[1016,13,1016,97,0],[1017,17,1017,51,0],[1018,13,1018,101,0],[1019,17,1019,53,0],[1020,13,1020,93,0],[1021,17,1021,49,0],[1022,13,1022,113,0],[1023,17,1023,59,0],[1025,13,1025,33,0],[1026,9,1026,10,0],[1029,9,1029,10,1],[1030,13,1030,89,1],[1031,13,1031,64,1],[1032,13,1032,14,1],[1033,17,1033,106,1],[1034,17,1034,80,1],[1035,17,1035,83,1],[1036,13,1036,14,1],[1037,13,1037,85,1],[1038,13,1038,67,1],[1039,13,1039,14,1],[1040,17,1040,102,1],[1041,17,1041,83,1],[1042,17,1042,86,1],[1043,13,1043,14,1],[1044,13,1044,90,1],[1045,13,1045,94,1],[1046,13,1046,69,1],[1047,13,1047,14,1],[1048,17,1048,111,1],[1049,17,1049,85,1],[1050,17,1050,88,1],[1051,13,1051,14,1],[1052,13,1052,79,1],[1053,17,1053,48,0],[1054,13,1054,82,1],[1055,17,1055,51,0],[1056,13,1056,90,1],[1057,17,1057,59,0],[1058,9,1058,10,1],[1061,9,1061,10,0],[1062,13,1062,42,0],[1063,13,1064,161,0],[1065,13,1065,20,0],[1065,22,1065,32,0],[1065,33,1065,35,0],[1065,36,1065,43,0],[1066,13,1066,14,0],[1067,17,1067,70,0],[1068,21,1073,76,0],[1074,13,1074,14,0],[1075,13,1075,35,0],[1077,13,1077,34,0],[1078,13,1078,45,0],[1079,13,1080,129,0],[1081,13,1081,35,0],[1082,13,1082,35,0],[1083,9,1083,10,0],[1086,9,1086,10,1],[1087,13,1087,59,1],[1087,60,1087,73,1],[1089,13,1089,30,0],[1089,31,1089,44,0],[1091,13,1092,25,0],[1093,13,1093,104,0],[1093,105,1093,118,0],[1095,13,1100,19,0],[1102,13,1105,39,0],[1106,9,1106,10,1],[1111,9,1111,10,1],[1120,13,1120,52,1],[1121,13,1121,63,1],[1122,13,1122,83,1],[1123,13,1123,92,1],[1124,13,1124,111,1],[1125,13,1125,100,1],[1126,13,1126,86,1],[1127,13,1127,42,1],[1128,13,1128,51,1],[1130,13,1130,64,1],[1131,13,1131,14,1],[1132,17,1132,102,1],[1133,17,1133,80,1],[1134,17,1134,83,1],[1135,13,1135,14,1],[1136,13,1136,67,1],[1137,13,1137,14,1],[1138,17,1138,102,1],[1139,17,1139,83,1],[1140,17,1140,86,1],[1141,13,1141,14,1],[1142,13,1142,75,1],[1143,13,1143,14,1],[1144,17,1144,108,1],[1145,17,1145,91,1],[1146,17,1146,94,1],[1147,13,1147,14,1],[1148,13,1148,69,1],[1149,13,1149,14,1],[1150,17,1150,111,1],[1151,17,1151,85,1],[1152,17,1152,88,1],[1153,13,1153,14,1],[1154,13,1154,65,1],[1155,13,1155,14,1],[1156,17,1156,80,1],[1157,17,1157,109,1],[1158,17,1158,81,1],[1159,17,1159,84,1],[1160,13,1160,14,1],[1161,9,1161,10,1],[1165,9,1165,10,0],[1166,13,1167,46,0],[1170,13,1172,68,0],[1174,9,1174,10,0]]);
    </script>
  </body>
</html>