<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Construction Vertical\Addon Modules\Contract Manager\Material Issue\ConcreateModels\MIEditModel.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Drawing;
using System.Globalization;
using System.Reflection;
using System.Web;
using System.Web.SessionState;
using System.Web.UI;
using System.Web.UI.WebControls;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.CONTMGTMATRISSBL;
using Aurigo.AMP3.ContractManager.BusinessLayer;
using Aurigo.AMP3.Core.AbstractModels;
using Aurigo.AMP3.Core.BusinessLayer.BL;
using Aurigo.AMP3.Core.BusinessLayer.DTO;
using Aurigo.AMP3.Core.IntegrationConnector;
using Aurigo.AMP3.Core.UserControls;
using Aurigo.AMP3.LibraryBL;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.AMP3.WORKORDBL;
using Aurigo.Brix.Core.WebUiHelper;
using Aurigo.Brix.Platform.BusinessLayer.DataResouces;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.Common;
using Infragistics.WebUI.UltraWebGrid;
using Infragistics.WebUI.WebSchedule;
using Resource = Aurigo.AMP3.Core.BusinessLayer.DTO.Resource;
using X = Infragistics.WebUI.WebSchedule;

namespace Aurigo.AMP3.ContractManager.MATRISSUI
{
    public class MIEditModel : EditModel
    {
        private static DataTable dtFiltered;

        //public static int itemID = 0;
        public bool MIWithBOQ = true;
        protected DataRow MasterRow;
        private string status = &quot;Draft&quot;;
        //override properties

        /// &lt;summary&gt;
        /// Gets the Project Mode : I-Integration, L-Live
        /// &lt;/summary&gt;
        private string ProjectMode
        {
            get { return (CacheManager.Instance.IsIntegrated(Request[Constants.QRY_PROJECTID].ToInt32_2()) ? &quot;I&quot; : &quot;L&quot;); }
        }

        /// &lt;summary&gt;
        /// Gets the Integration Cutoff Date
        /// &lt;/summary&gt;
        private DateTime IntegrationCutoffDate
        {
            get
            {
                HttpSessionState session = HttpContext.Current.Session;
                return (DateTime) session[Constants.APP_IntegrationCutoffDate];
            }
        }

        /// &lt;summary&gt;
        /// Gets the Default Record Date
        /// &lt;/summary&gt;
        private DateTime DefaultRecordDate
        {
            get
            {
                HttpSessionState session = HttpContext.Current.Session;
                return (DateTime) session[Constants.APP_DefaultRecordDate];
            }
        }

        protected List&lt;String&gt; RelevantColumns
        {
            get
            {
                return
                    new List&lt;string&gt;(
                        (&quot;ResourceDetailID,ItemID,ResourceTypeID,Description,UnitID,Unit,Rate,Quantity,Cost,Notes,ResItemID,ParentResItemID,ResourceTypeName,IsCritical,EstQty,Size,Color,Configuration&quot;)
                            .Split(&#39;,&#39;));
            }
        }

        public override string ClientValidationFunction
        {
            get { return base.ClientValidationFunction; }
        }

        public override string FormInstanceId
        {
            get { return (InstanceID == 0 ? -1 : InstanceID).ToString2(); }
        }

        public override string FormName
        {
            get { return &quot;XMATISS&quot;; }
        }

        public override bool IsOldWorkflow
        {
            get { return base.IsOldWorkflow; }
        }

        public override int PID
        {
            get { return Request[&quot;PID&quot;].ToInt32_2(); }
        }

        public override int ParentModuleId
        {
            get { return ParentInstanceID; }
        }

        public override string PostCancelRedirectUrl
        {
            get { return ReturnUrl(); }
        }

        //override abstract methods
        public override string ReturnUrl()
        {
            return &quot;~/Common/BrixListPage.aspx?context=MATRISS&amp;PID=&quot; + Request[&quot;PID&quot;] + &quot;&amp;ContractID=&quot; +
                   ParentInstanceID.ToString2() + &quot;&amp;ParentID=&quot; + ParentInstanceID.ToString2();
        }

        public override void OnPreRender()
        {
            var pickItem = (DetailControls[&quot;PickItem&quot;].FormCtrl as Button);
            bool isEnabled = true;
            if (((DetailControls[&quot;ContractorType&quot;].FormCtrl as RadioButtonList).SelectedValue == &quot;Sub Contractor&quot;) &amp;&amp;
                ((DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).SelectedIndex == 0))
                isEnabled = false;
            pickItem.Enabled = isEnabled;

            DataTable dtTemp = BL.Instance.GetOwnerDetails(Request[&quot;ParentID&quot;].ToInt32_2());
            if (dtTemp.Rows[0][&quot;MIWithBOQ&quot;] != null)
                MIWithBOQ = bool.Parse(dtTemp.Rows[0][&quot;MIWithBOQ&quot;].ToString());

            if (!MIWithBOQ)
            {
                (ColumnGroups[&quot;Item&quot;].HtmlTblRow).Style.Value = &quot;display:none&quot;;
            }


            base.OnPreRender();
        }

        public override void SaveInstance(out string sSavedInstanceToken, out string sErrors, out string sRedirectTo)
        {
            sSavedInstanceToken =
                sErrors =
                sRedirectTo = string.Empty;

            if ((DetailControls[&quot;ResourceDetails&quot;].FormCtrl as UltraWebGrid).Rows.Count == 0)
            {
                sErrors = &quot;Please Select some Resources before saving.&quot;;
                throw new Exception(sErrors);
            }
            if ((DetailControls[&quot;ContractorType&quot;].FormCtrl as RadioButtonList).SelectedValue == &quot;Sub Contractor&quot;)
            {
                if ((DetailControls[&quot;Contractor&quot;].FormCtrl as DropDownList).SelectedItem.Text == &quot;--Select One--&quot;)
                {
                    sErrors = &quot;Select a Sub Contractor before saving the Material Issue&quot;;
                    throw new Exception(sErrors);
                }
                if ((DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).SelectedItem.Text == &quot;None&quot; ||
                    Request.Form[MasterControls[&quot;WorkOrderNo&quot;]] == null)
                {
                    sErrors = &quot;Select a Work Order Number before saving the Material Issue&quot;;
                    throw new Exception(sErrors);
                }
            }
            int AppFlag = 0;
            if (Request.Form[MasterControls[&quot;ReqdDate&quot;]] != &quot;None&quot; &amp;&amp;
                Convert.ToDateTime((DetailControls[&quot;ReqdDate&quot;].FormCtrl as WebDateChooser).Value,
                                   CultureInfo.CurrentCulture) &gt; DateTime.UtcNow)
            {
                sErrors = &quot;Requested Date cannot be a future date&quot;;
                throw new Exception(sErrors);
            }

            foreach (UltraGridRow row in (DetailControls[&quot;ResourceDetails&quot;].FormCtrl as UltraWebGrid).Rows)
            {
                string parentResItemID = row.Cells.FromKey(&quot;ParentResItemID&quot;).Value.ToString();
                string size = row.Cells.FromKey(&quot;Size&quot;).Value == null
                                  ? &quot;&quot;
                                  : row.Cells.FromKey(&quot;Size&quot;).Value.ToString().Trim();
                string color = row.Cells.FromKey(&quot;Color&quot;).Value == null
                                   ? &quot;&quot;
                                   : row.Cells.FromKey(&quot;Color&quot;).Value.ToString().Trim();
                string configuration = row.Cells.FromKey(&quot;Configuration&quot;).Value == null
                                           ? &quot;&quot;
                                           : row.Cells.FromKey(&quot;Configuration&quot;).Value.ToString().Trim();
                if (String.IsNullOrEmpty(row.Cells.FromKey(&quot;Quantity&quot;).Text))
                    row.Cells.FromKey(&quot;Quantity&quot;).Value = 0;
                double quantity = double.Parse(row.Cells.FromKey(&quot;Quantity&quot;).Value.ToString());

                //Only for returnable type of MI, the qty of the material should be allowed negative.
                if (Request.Form[MasterControls[&quot;MITypeName&quot;]].ToString2().ToLower2() == &quot;returnable&quot; &amp;&amp; quantity == 0)
                {
                    sErrors = &quot;Requested quantity cannot be zero.&quot;;
                    throw new Exception(sErrors);
                }
                else if (Request.Form[MasterControls[&quot;MITypeName&quot;]].ToString2().ToLower2() != &quot;returnable&quot; &amp;&amp;
                         quantity &lt;= 0)
                {
                    sErrors = &quot;Requested quantity cannot be less than or equal to zero.&quot;;
                    throw new Exception(sErrors);
                }

                if (string.IsNullOrEmpty(size) &amp;&amp; string.IsNullOrEmpty(color) &amp;&amp; string.IsNullOrEmpty(configuration))
                {
                    if (!ValidateResourceForAXDimensions(parentResItemID, size, color, configuration))
                    {
                        sErrors = &quot;Cannot create the Indent. Inventory Dimensions are mandatory for the Resource. &quot; +
                                  parentResItemID;
                        throw new Exception(sErrors);
                    }
                }
            }

            if (Mode == &quot;Approve&quot;)
            {
                foreach (UltraGridRow row in (DetailControls[&quot;ResourceDetails&quot;].FormCtrl as UltraWebGrid).Rows)
                {
                    if (String.IsNullOrEmpty(row.Cells.FromKey(&quot;Quantity&quot;).Text))
                    {
                        sErrors = &quot;Please enter Requested Quantity&quot;;
                        throw new Exception(sErrors);
                    }
                    if ((decimal.Parse(row.Cells.FromKey(&quot;Quantity&quot;).Text, CultureInfo.CurrentCulture)).Equals(0))
                    {
                        sErrors = &quot;Requested Quantity cannot be zero&quot;;
                        throw new Exception(sErrors);
                    }
                    if (!String.IsNullOrEmpty(row.Cells.FromKey(&quot;ApprovedQuantity&quot;).Text))
                    {
                        if (
                            decimal.Parse(row.Cells.FromKey(&quot;ApprovedQuantity&quot;).Text, CultureInfo.CurrentCulture).Equals
                                (0))
                        {
                            sErrors = &quot;Approved Quantity cannot be zero&quot;;
                            throw new Exception(sErrors);
                        }
                        if (decimal.Parse(row.Cells.FromKey(&quot;ApprovedQuantity&quot;).Text, CultureInfo.CurrentCulture) &gt;
                            decimal.Parse(row.Cells.FromKey(&quot;Quantity&quot;).Text, CultureInfo.CurrentCulture))
                        {
                            sErrors = &quot;Approved Quantity cannot be greater than Requested Quantity&quot;;
                            throw new Exception(sErrors);
                        }
                        AppFlag = 1;
                    }
                }
                if (AppFlag == 0)
                {
                    sErrors = &quot;Please enter Approved Quantities&quot;;
                    throw new Exception(sErrors);
                }
            }

            if ((DetailControls[&quot;ContractorType&quot;].FormCtrl as RadioButtonList).SelectedValue != &quot;Prime Contractor&quot;)
            {
                int miListId = (MasterRow == null) ? 0 : Convert.ToInt32(MasterRow[&quot;MIListID&quot;]);
                decimal actualWOAmt =
                    MATRISSBL.Instance.GetWorkOrderAmount(
                        Convert.ToInt32((DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).SelectedItem.Value),
                        miListId);

                var uwg = (DetailControls[&quot;ResourceDetails&quot;].FormCtrl as UltraWebGrid);
                decimal amt = 0;
                decimal qty = 0;
                foreach (UltraGridRow row in uwg.Rows)
                {
                    qty = (String.IsNullOrEmpty(row.Cells.FromKey(&quot;Quantity&quot;).Text))
                              ? 0
                              : Decimal.Parse(row.Cells.FromKey(&quot;Quantity&quot;).Text, CultureInfo.CurrentCulture);
                    amt = amt + (qty*decimal.Parse(row.Cells.FromKey(&quot;Rate&quot;).ToString2(), CultureInfo.CurrentCulture));
                }
                if (amt &gt; actualWOAmt)
                {
                    sErrors = &quot;Material Issue amount cannot exceed workorder amount&quot;;
                    throw new Exception(sErrors);
                }
            }

            DataTable dTable = BL.Instance.GetContractors(int.Parse(Request[&quot;ParentID&quot;], CultureInfo.CurrentCulture));
            DataRow[] contractorSelectedRows = dTable.Select(&quot;CType&lt;&gt;&#39;P&#39;&quot;);
            foreach (DataRow cRow in contractorSelectedRows)
            {
                dTable.Rows.Remove(cRow);
            }

            int itemID = 0;
            Int32.TryParse((DetailControls[&quot;ItemID&quot;].FormCtrl as TextBox).Text, out itemID);


            string contractor = dTable.Rows[0][&quot;Contact&quot;].ToString2();
            if (itemID == 0)
            {
                var dummyItem = new Item();
                dummyItem.ModuleID = &quot;MATRISS&quot;;
                dummyItem.ParentInstanceID = 0;
                dummyItem.LineNo = 0;
                dummyItem.UnitID = 1;
                dummyItem.Unit = &quot;&quot;;
                dummyItem.GroupName = &quot;DummyGroup&quot;;
                dummyItem.StandardItemNo = &quot;DummyItem&quot;;
                dummyItem.Description = &quot;DummyItem for Material Issue&quot;;
                dummyItem.UnitPrice = 0;
                dummyItem.UnitCost = 0;
                dummyItem.Quantity = 0;
                itemID = ItemManager.Instance.SaveItemDetails(dummyItem);
            }

            int hiredEquipmentId = 0;
            Int32.TryParse((DetailControls[&quot;HiredEquipmentID&quot;].FormCtrl as TextBox).Text, out hiredEquipmentId);
            int activityID = 0;
            Int32.TryParse((DetailControls[&quot;ActivityID&quot;].FormCtrl as TextBox).Text, out activityID);
            int IssueID = CreateMaterialIssue(InstanceID, itemID, contractor, hiredEquipmentId, activityID);
            //If there is some error, then the CreateMaterialIssue will return -1.
            if (IssueID == -1)
            {
                sErrors = &quot;Save Unsuccessful&quot;;
                throw new Exception(sErrors);
            }
            SaveResourceDetails(IssueID, itemID);
            sErrors = &quot;Save Successful&quot;;
            sSavedInstanceToken = IssueID.ToString2();
        }

        private int CreateMaterialIssue(int issueID, int dummyItemID, string contractor, int hiredEquipmentId,
                                        int activityID)
        {
            int id = MATRISSBL.Instance.CreateMaterialIssue(issueID,
                                                            Request.Form[MasterControls[&quot;ReqdDate&quot;]] == &quot;None&quot;
                                                                ? DateTime.UtcNow
                                                                : Convert.ToDateTime(
                                                                    (DetailControls[&quot;ReqdDate&quot;].FormCtrl as
                                                                     WebDateChooser).Value, CultureInfo.CurrentCulture),
                                                            Convert.ToInt32(ParentInstanceID, CultureInfo.CurrentCulture),
                                                            (DetailControls[&quot;ContractorType&quot;].FormCtrl as
                                                             RadioButtonList).SelectedValue == &quot;Prime Contractor&quot;
                                                                ? contractor
                                                                : (DetailControls[&quot;Contractor&quot;].FormCtrl as DropDownList)
                                                                      .SelectedItem.Text,
                                                            Request.Form[MasterControls[&quot;WorkOrderNo&quot;]] == &quot;0&quot; ||
                                                            Request.Form[MasterControls[&quot;WorkOrderNo&quot;]] == null
                                                                ? &quot;None&quot;
                                                                : (DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as
                                                                   DropDownList).SelectedItem.Text,
                                                            dummyItemID,
                                                            0,
                                                            Request.Form[MasterControls[&quot;MITypeName&quot;]],
                                                            status,
                                                            Request.Form[MasterControls[&quot;Comments&quot;]],
                                                            UserDetail.GetCurrentUserDetail().UID,
                                                            Request.Form[MasterControls[&quot;CreatedDate&quot;]] == &quot;None&quot;
                                                                ? DateTime.UtcNow
                                                                : Convert.ToDateTime(
                                                                    (DetailControls[&quot;CreatedDate&quot;].FormCtrl as
                                                                     WebDateChooser).Value),
                                                            hiredEquipmentId,
                                                            activityID
                );
            return id;
        }

        public override object GetMasterData()
        {
            DataSet ds = MATRISSBL.Instance.GetMaterialIssue(InstanceID);
            ds.Tables[0].Columns.Add(&quot;ContractorType&quot;);
            ds.Tables[0].Columns.Add(&quot;Equipment&quot;);
            ds.Tables[0].Columns.Add(&quot;IdentificationNo&quot;);
            ds.Tables[0].Columns.Add(&quot;HiredEquipmentID&quot;);
            ds.Tables[0].Columns.Add(&quot;Activity&quot;);
            ds.Tables[0].Columns.Add(&quot;ActivityID&quot;);
            if (ds.Tables[0].Rows.Count != 0)
            {
                if (ds.Tables.Count &gt; 1 &amp;&amp; ds.Tables[1].Rows.Count &gt; 0)
                {
                    ds.Tables[0].Rows[0][&quot;Equipment&quot;] = ds.Tables[1].Rows[0][&quot;Equipment&quot;];
                    ds.Tables[0].Rows[0][&quot;IdentificationNo&quot;] = ds.Tables[1].Rows[0][&quot;IdentificationNo&quot;];
                    ds.Tables[0].Rows[0][&quot;HiredEquipmentID&quot;] = ds.Tables[1].Rows[0][&quot;HiredEquipmentID&quot;];
                }
                if (ds.Tables.Count &gt; 2 &amp;&amp; ds.Tables[2].Rows.Count &gt; 0)
                {
                    ds.Tables[0].Rows[0][&quot;Activity&quot;] = ds.Tables[2].Rows[0][&quot;Activity&quot;];
                    ds.Tables[0].Rows[0][&quot;ActivityID&quot;] = ds.Tables[2].Rows[0][&quot;ActivityID&quot;];
                }
                DataTable dTable = BL.Instance.GetContractors(int.Parse(Request[&quot;ParentID&quot;], CultureInfo.CurrentCulture));
                DataRow[] contractorSelectedRows =
                    dTable.Select(&quot;Contact = &#39;&quot; + ds.Tables[0].Rows[0][&quot;Contractor&quot;].ToString2().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) +
                                  &quot;&#39;&quot;);
                ds.Tables[0].Rows[0][&quot;ContractorType&quot;] = contractorSelectedRows[0][&quot;CType&quot;].ToString2() == &quot;S&quot;
                                                             ? &quot;Sub Contractor&quot;
                                                             : &quot;Prime Contractor&quot;;
                MasterRow = ds.Tables[0].Rows[0];
                //if user has approve permission
                if (MasterRow[&quot;Status&quot;].ToString2() == &quot;Approved&quot; || MasterRow[&quot;Status&quot;].ToString2() == &quot;Issued&quot; ||
                    MasterRow[&quot;Status&quot;].ToString2() == &quot;Partially Recovered&quot; ||
                    MasterRow[&quot;Status&quot;].ToString2() == &quot;Fully Recovered&quot;)
                    Mode = &quot;View&quot;;
                else if (MasterRow[&quot;Status&quot;].ToString2() != &quot;Draft&quot; &amp;&amp; Mode == &quot;Edit&quot;)
                {
                    if (MasterRow[&quot;Status&quot;].ToString2() == &quot;Submission for Approval&quot;)
                        Mode = &quot;Approve&quot;;
                    //else
                    //{
                    //    List&lt;string&gt; permissions = ModuleManager.Instance.GetPermissionByRole(this.ModuleID, UserDetail.GetCurrentUserDetail().RID);
                    //    if (permissions.Contains(&quot;Approve&quot;))
                    //        this.Mode = &quot;Approve&quot;;
                    //}
                }
                // itemID = Convert.ToInt32(ds.Tables[0].Rows[0][&quot;ItemID&quot;], CultureInfo.CurrentCulture);
                status = MasterRow[&quot;Status&quot;].ToString2();
            }

            return ds.Tables[0];
        }

        public override object GetDetailData()
        {
            int itemID = 0;
            Int32.TryParse((DetailControls[&quot;ItemID&quot;].FormCtrl as TextBox).Text, out itemID);
            int tableNo = itemID == 0 ? 0 : 1;
            DataTable table1 = ItemManager.Instance.GetRateAnalysis(ModuleID, InstanceID, itemID).Tables[tableNo];
            for (int count = table1.Columns.Count - 1; count &gt;= 0; count--)
            {
                if (!(RelevantColumns.Contains(table1.Columns[count].ColumnName)))
                {
                    table1.Columns.Remove(table1.Columns[count]);
                }
            }
            var uwg = (DetailControls[&quot;ResourceDetails&quot;].FormCtrl as UltraWebGrid);

            if (MasterRow != null)
            {
                DataSet qtyDataSet = MATRISSBL.Instance.GetItemQuantity(int.Parse(MasterRow[&quot;ItemID&quot;].ToString()),
                                                                        Request.Form[MasterControls[&quot;WorkOrderNo&quot;]] != &quot;0&quot; &amp;&amp;
                                                                        Request.Form[MasterControls[&quot;WorkOrderNo&quot;]] != null &amp;&amp;
                                                                        Request.Form[MasterControls[&quot;WorkOrderNo&quot;]] != &quot;NA&quot;
                                                                            ? Int32.Parse(
                                                                                Request.Form[MasterControls[&quot;WorkOrderNo&quot;]])
                                                                            : 0);
                var eqdc = new DataColumn(&quot;EstimatedQuantity&quot;, typeof(decimal));
                table1.Columns.Add(eqdc);
                foreach (DataRow row in table1.Rows)
                {
                    DataRow[] selectedRows =
                        qtyDataSet.Tables[0].Select(&quot;ResourceID= &#39;&quot; + row[&quot;ResItemID&quot;].ToString().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) + &quot;&#39;&quot;);
                    if (selectedRows.Length &gt; 0)
                        row[&quot;EstimatedQuantity&quot;] = decimal.Parse(selectedRows[0][&quot;EstimatedQuantity&quot;].ToString());
                }

                if (MasterRow != null &amp;&amp; (Mode == &quot;Approve&quot; ||
                                          (MasterRow[&quot;Status&quot;].ToString2() == &quot;Approved&quot; ||
                                           MasterRow[&quot;Status&quot;].ToString2() == &quot;Issued&quot; ||
                                           MasterRow[&quot;Status&quot;].ToString2() == &quot;Partially Recovered&quot; ||
                                           MasterRow[&quot;Status&quot;].ToString2() == &quot;Fully Recovered&quot;)))
                {
                    DataTable Master = table1.Copy();
                    DataTable dt = MATRISSBL.Instance.GetMaterialIssuedQuantity(InstanceID).Tables[0];
                    int i = 0;
                    var dc = new DataColumn(&quot;ApprovedQuantity&quot;, typeof(decimal));
                    Master.Columns.Add(dc);
                    if (dt.Rows.Count != 0 &amp;&amp; Mode != &quot;Approve&quot;)
                    {
                        foreach (DataRow dr in table1.Select())
                        {
                            if ((dt.Select(&quot;ResourceDetailID=&quot; + table1.Rows[i][&quot;ResourceDetailID&quot;].ToString2())).Length &gt; 0)
                            {
                                if (Master.Rows[i][&quot;ResourceDetailID&quot;].ToString2() ==
                                    dt.Select(&quot;ResourceDetailID=&quot; + table1.Rows[i][&quot;ResourceDetailID&quot;].ToString2())[0][
                                        &quot;ResourceDetailID&quot;].ToString2())
                                {
                                    Master.Rows[i][&quot;ApprovedQuantity&quot;] =
                                        decimal.Parse(
                                            (dt.Select(&quot;ResourceDetailID=&quot; + table1.Rows[i][&quot;ResourceDetailID&quot;].ToString2())
                                                [0][&quot;ApprovedQuantity&quot;]).ToString2(), CultureInfo.CurrentCulture);
                                }
                                i++;
                            }
                        }
                    }
                    else if (Mode == &quot;Approve&quot;)
                        foreach (DataRow row in Master.Rows)
                            row[&quot;ApprovedQuantity&quot;] = row[&quot;Quantity&quot;].ToString2();
                    DataTable dtPE = MATRISSBL.Instance.GetPEMIDetails(InstanceID).Tables[0];
                    AppendPEDetails(Master, dtPE);
                    uwg.DataSource = Master;
                    uwg.DataBind();
                    if (Mode == &quot;Approve&quot;)
                    {
                        uwg.Columns.FromKey(&quot;Notes&quot;).AllowUpdate = AllowUpdate.Yes;
                        uwg.Columns.FromKey(&quot;Notes&quot;).CellStyle.BackColor = Color.Yellow;
                        uwg.Columns.FromKey(&quot;ApprovedQuantity&quot;).AllowUpdate = AllowUpdate.Yes;
                        uwg.Columns.FromKey(&quot;ApprovedQuantity&quot;).CellStyle.BackColor = Color.Yellow;
                        uwg.Columns.FromKey(&quot;ApprovedQuantity&quot;).Header.Caption = &quot;Approved Quantity&quot;;
                    }
                    uwg.Columns.FromKey(&quot;ApprovedQuantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                    if (uwg.Columns.Exists(&quot;Recovered Amount&quot;))
                    {
                        uwg.Columns.FromKey(&quot;Recovered Amount&quot;).CellStyle.BackColor = Color.LightGray;
                        uwg.Columns.FromKey(&quot;Recovered Amount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                    }
                    if (uwg.Columns.Exists(&quot;EstimatedQuantity&quot;))
                    {
                        uwg.Columns.FromKey(&quot;EstimatedQuantity&quot;).CellStyle.BackColor = Color.LightGray;
                        uwg.Columns.FromKey(&quot;EstimatedQuantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                        uwg.Columns.FromKey(&quot;EstimatedQuantity&quot;).Header.Caption = &quot;Estimated Quantity&quot;;
                    }
                    if (uwg.Columns.Exists(&quot;Recovered Qty&quot;))
                    {
                        uwg.Columns.FromKey(&quot;Recovered Qty&quot;).CellStyle.BackColor = Color.LightGray;
                        uwg.Columns.FromKey(&quot;Recovered Qty&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                    }
                }

                else
                {
                    if (MasterRow != null)
                    {
                        DataSet qtyDS = MATRISSBL.Instance.GetItemQuantity(int.Parse(MasterRow[&quot;ItemID&quot;].ToString()),
                                                                           Request.Form[MasterControls[&quot;WorkOrderNo&quot;]] !=
                                                                           &quot;0&quot; &amp;&amp;
                                                                           Request.Form[MasterControls[&quot;WorkOrderNo&quot;]] !=
                                                                           null &amp;&amp;
                                                                           Request.Form[MasterControls[&quot;WorkOrderNo&quot;]] !=
                                                                           &quot;NA&quot;
                                                                               ? Int32.Parse(
                                                                                   Request.Form[
                                                                                       MasterControls[&quot;WorkOrderNo&quot;]])

                                                  : 0);
                        if (!table1.Columns.Contains(&quot;EstimatedQuantity&quot;))
                        {
                            var eqDC = new DataColumn(&quot;EstimatedQuantity&quot;, typeof(decimal));
                            table1.Columns.Add(eqDC);
                        }
                        foreach (DataRow row in table1.Rows)
                        {
                            DataRow[] selectedRows =
                                qtyDS.Tables[0].Select(&quot;ResourceID= &#39;&quot; + row[&quot;ResItemID&quot;].ToString().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) +
                                                       &quot;&#39;&quot;);
                            if (selectedRows.Length &gt; 0)
                                row[&quot;EstimatedQuantity&quot;] = decimal.Parse(selectedRows[0][&quot;EstimatedQuantity&quot;].ToString());
                        }

                        uwg.DataSource = table1;
                        uwg.DataBind();
                        if (!uwg.Columns.Exists(&quot;Multi&quot;))
                        {
                            var ugc = new UltraGridColumn(&quot;Multi&quot;, &quot;Select&quot;, ColumnType.CheckBox, false);
                            uwg.Columns.Insert(0, ugc);
                            uwg.Columns.FromKey(&quot;Multi&quot;).AllowUpdate = AllowUpdate.Yes;
                            uwg.Columns.FromKey(&quot;Multi&quot;).Width = Unit.Percentage(6.5);
                        }
                        if (uwg.Columns.Exists(&quot;EstimatedQuantity&quot;))
                        {
                            uwg.Columns.FromKey(&quot;EstimatedQuantity&quot;).CellStyle.BackColor = Color.LightGray;
                            uwg.Columns.FromKey(&quot;EstimatedQuantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                            uwg.Columns.FromKey(&quot;EstimatedQuantity&quot;).Header.Caption = &quot;Estimated Quantity&quot;;
                        }
                    }
                }
                if (Mode.Equals(&quot;Edit&quot;) || Mode.Equals(&quot;Approve&quot;))
                {
                    uwg.Columns.FromKey(&quot;Notes&quot;).AllowUpdate = AllowUpdate.Yes;
                    uwg.Columns.FromKey(&quot;Notes&quot;).CellStyle.BackColor = Color.Yellow;
                    uwg.Columns.FromKey(&quot;Quantity&quot;).AllowUpdate = AllowUpdate.Yes;
                    uwg.Columns.FromKey(&quot;Quantity&quot;).CellStyle.BackColor = Color.Yellow;
                }
                HideGridColumns(
                    new[]
                    {
                        &quot;ResourceDetailID&quot;, &quot;ItemID&quot;, &quot;ResourceTypeID&quot;, &quot;UnitID&quot;, &quot;ResourceTypeName&quot;, &quot;ResItemID&quot;,
                        &quot;ParentResItemID&quot;, &quot;MaterialIssueNo&quot;, &quot;WastagePercent&quot;, &quot;WastageQty&quot;, &quot;ReworkQty&quot;, &quot;RegularQty&quot;,
                        &quot;WasteInitialQty&quot;, &quot;WasteAmt&quot;
                    }, uwg);
                uwg.Columns.FromKey(&quot;Quantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                uwg.Columns.FromKey(&quot;Quantity&quot;).Header.Caption = &quot;Requested Quantity&quot;;
                uwg.Columns.FromKey(&quot;Cost&quot;).Format = LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) +
                                                     AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                uwg.Columns.FromKey(&quot;Rate&quot;).Format = LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) +
                                                     AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                if (uwg.Columns.FromKey(&quot;IsCritical&quot;) != null)
                    uwg.Columns.FromKey(&quot;IsCritical&quot;).Header.Caption = &quot;Is Critical&quot;;
                if (uwg.Columns.FromKey(&quot;ParentResItemID&quot;) != null)
                    uwg.Columns.FromKey(&quot;ParentResItemID&quot;).Header.Caption = &quot;Resource ID&quot;;
                //if (uwg.Columns.FromKey(&quot;IsCritical&quot;) != null)
                //    uwg.Columns.FromKey(&quot;IsCritical&quot;).Header.Caption = &quot;Is Critical&quot;;
                uwg.Columns.FromKey(&quot;Rate&quot;).Header.Caption = GlobalizationUtility.SetResource(&quot;Rate&quot;, false);
            }
                return null;
        }

        public override void HandleControls(Column item, Control ctrl)
        {
            switch (item.Name)
            {
                case &quot;Contractor&quot;:
                    var conDDL = (ctrl as DropDownList);
                    DataTable dTable =
                        BL.Instance.GetContractors(int.Parse(Request[&quot;ParentID&quot;], CultureInfo.CurrentCulture));
                    DataRow[] contractorSelectedRows = dTable.Select(&quot;CType&lt;&gt;&#39;S&#39;&quot;);
                    foreach (DataRow cRow in contractorSelectedRows)
                    {
                        dTable.Rows.Remove(cRow);
                    }
                    conDDL.DataSource = dTable;
                    conDDL.DataTextField = &quot;Contact&quot;;
                    conDDL.DataValueField = &quot;ValueandType&quot;;
                    conDDL.DataBind();
                    var li = new ListItem(&quot;--Select One--&quot;, &quot;--Select One--&quot;);
                    conDDL.Items.Insert(0, li);
                    conDDL.Enabled =
                        !((DetailControls[&quot;ContractorType&quot;].FormCtrl as RadioButtonList).SelectedValue ==
                          &quot;Prime Contractor&quot;);
                    break;
                case &quot;WorkOrderNo&quot;:
                    var woddl = (ctrl as DropDownList);
                    woddl.Items.Insert(0, new ListItem(&quot;Select&quot;, &quot;NA&quot;));
                    woddl.Enabled =
                        !((DetailControls[&quot;ContractorType&quot;].FormCtrl as RadioButtonList).SelectedValue ==
                          &quot;Prime Contractor&quot;);
                    break;
                    //case &quot;Status&quot;:
                    //    DropDownList statusDDL = (ctrl as DropDownList);
                    //    statusDDL.Items.Add(&quot;Draft&quot;);
                    //    statusDDL.Items.Add(&quot;Complete&quot;);
                    //    List&lt;string&gt; permissions = ModuleManager.Instance.GetPermissionByRole(this.ModuleID, UserDetail.GetCurrentUserDetail().RID);
                    //    if (MasterRow != null &amp;&amp; MasterRow[&quot;Status&quot;].ToString2() != &quot;Draft&quot;)
                    //        statusDDL.Items.Add(&quot;Submission for Approval&quot;);
                    //    if (MasterRow != null &amp;&amp;
                    //            (MasterRow[&quot;Status&quot;].ToString2() == &quot;Approved&quot; || MasterRow[&quot;Status&quot;].ToString2() == &quot;Issued&quot; ||
                    //             MasterRow[&quot;Status&quot;].ToString2() == &quot;Partially Recovered&quot; ||
                    //             MasterRow[&quot;Status&quot;].ToString2() == &quot;Fully Recovered&quot;))
                    //        statusDDL.Items.Add(MasterRow[&quot;Status&quot;].ToString2());
                    //    break;
                case &quot;MITypeName&quot;:
                    var issueTypeDDL = (ctrl as DropDownList);
                    issueTypeDDL.Items.Add(&quot;Non-Returnable&quot;);
                    issueTypeDDL.Items.Add(&quot;Site Transfer&quot;);
                    issueTypeDDL.Items.Add(&quot;Returnable&quot;);
                    issueTypeDDL.Items.Add(&quot;Deductable&quot;);
                    break;
                case &quot;ResourceDetails&quot;:
                    (ctrl as UltraWebGrid).DisplayLayout.ClientSideEvents.AfterCellUpdateHandler = &quot;updatecosts&quot;;
                    break;
                    //case &quot;HdnDetails&quot;:
                    //    Panel aspPnl = currentPage.FindControl(&quot;aspPnl&quot;);
                    //    (ctrl as Button).Attributes.Add(&quot;onclick&quot;, &quot;document.getElementById(&#39;&quot; + aspPnl.ClientID + &quot;&#39;).style.display = \&quot;block\&quot;;&quot;);
                    //    break;
            }
        }

        public override void HandleUserControls(Column item, Control ctrl)
        {
            switch (item.Name)
            {
                case &quot;ItemPicker&quot;:
                    var itemPicker = (ctrl as ItemPickerControl);
                    itemPicker.ModuleID = ParentModuleID;
                    itemPicker.ParentInstanceID = Convert.ToInt32(ParentInstanceID);
                    itemPicker.SelectedIndexChanged += itemPicker_SelectedIndexChanged;
                    //itemPicker.BackClicked += BtnCancelItemPicker_Click;
                    itemPicker.EnableMultipleSelect = false;
                    itemPicker.EnableQuantityEdit = true;
                    // itemPicker.HideCostColumns = true;
                    (DetailControls[&quot;Item&quot;].FormCtrl as TextBox).ReadOnly = true;
                    break;
                case &quot;ResourcePicker&quot;:
                    var materialPicker = (ctrl as GenericPickerControl);
                    ConfigureMaterialPicker(materialPicker);
                    break;
                case &quot;ActivityPicker&quot;:
                    var activityPicker = (ctrl as GenericPickerControl);
                    ConfigureActivityPicker(activityPicker);
                    break;
                case &quot;EquipmentPicker&quot;:
                    var equipmentPicker = (ctrl as GenericPickerControl);
                    ConfigureEquipmentPicker(equipmentPicker);
                    break;
                case &quot;DimensionPicker&quot;:
                    var dimensionsPicker = (ctrl as GenericPickerControl);
                    ConfigureDimensionsPicker(dimensionsPicker);
                    break;
            }
        }


        private void itemPicker_SelectedIndexChanged(object sender, ClickEventArgs e)
        {
            Item stdItem = (DetailControls[&quot;ItemPicker&quot;].FormCtrl as ItemPickerControl).GetDTOFromHTTP(e);
            GetDetailDataByItem(stdItem);
            (DetailControls[&quot;ItemID&quot;].FormCtrl as TextBox).Text = stdItem.ItemID.ToString();
            OnEventDoneClicked(e);
            (DetailControls[&quot;Add Materials&quot;].FormCtrl as Button).Visible = true;
            (DetailControls[&quot;Inventory Dimensions&quot;].FormCtrl as Button).Visible = true;
        }

        private void BtnCancelItemPicker_Click(object sender, EventArgs e)
        {
            OnEventDoneClicked(e);
        }

        private void ConfigureMaterialPicker(GenericPickerControl materialPicker)
        {
            materialPicker.DefaultSortColumn = &quot;ParentResItemID&quot;;
            materialPicker.IsFilterXml = true;
            materialPicker.DisplayFilter = true;
            materialPicker.EnableMultipleSelect = true;
            materialPicker.DataSourceCommandType = DataSourceType.StoredProcedure;
            materialPicker.Filters = GetFilters();
            materialPicker.ItemSelected += materialPicker_ItemSelected;
            materialPicker.BackClicked += materialPicker_BackClicked;
            materialPicker.BindData += materialPicker_BindData;
            materialPicker.StateMgmtContext = &quot;Material Picker&quot;;
            //SET THE ERP CURRENCY FOR THE GENERIC PICKER
            var currentPage = (Page) (HttpContext.Current.Handler);
            materialPicker.Currency = LocalizationManager.GetModuleCurrency(&quot;LIBRARY&quot;, null,
                                                                            currentPage.Session[
                                                                                Constants.EIS_ADDITIONAL_INFO].ToString2
                                                                                ());
        }

        private void ConfigureDimensionsPicker(GenericPickerControl dimensionsPicker)
        {
            dimensionsPicker.DefaultSortColumn = &quot;Size&quot;;
            dimensionsPicker.IsFilterXml = true;
            dimensionsPicker.DisplayFilter = true;
            dimensionsPicker.EnableMultipleSelect = false;
            dimensionsPicker.DataSourceCommandType = DataSourceType.StoredProcedure;
            dimensionsPicker.Filters = GetDimensionsFilters();
            dimensionsPicker.ItemSelected += dimensionsPicker_ItemSelected;
            dimensionsPicker.BackClicked += materialPicker_BackClicked;
            dimensionsPicker.BindData += dimensionsPicker_BindData;


            //SET THE ERP CURRENCY FOR THE GENERIC PICKER
            var currentPage = (Page) (HttpContext.Current.Handler);
            dimensionsPicker.Currency = LocalizationManager.GetModuleCurrency(&quot;LIBRARY&quot;, null,
                                                                              currentPage.Session[
                                                                                  Constants.EIS_ADDITIONAL_INFO].
                                                                                  ToString2());
        }

        private BrixFilter[] GetDimensionsFilters()
        {
            var filters = new BrixFilter[3];

            filters[0] = new BrixFilter();
            filters[0].Title = &quot;Size :&quot;;
            filters[0].Name = &quot;Size&quot;;
            filters[0].FilterType = BrixFilter.Type.Text;

            filters[1] = new BrixFilter();
            filters[1].Title = &quot;Color :&quot;;
            filters[1].Name = &quot;Color&quot;;
            filters[1].FilterType = BrixFilter.Type.Text;

            filters[2] = new BrixFilter();
            filters[2].Title = &quot;Configuration :&quot;;
            filters[2].Name = &quot;Configuration&quot;;
            filters[2].FilterType = BrixFilter.Type.Text;

            return filters;
        }

        private void ConfigureEquipmentPicker(GenericPickerControl equipmentPicker)
        {
            equipmentPicker.DefaultSortColumn = &quot;HireOrderItem&quot;;
            equipmentPicker.IsFilterXml = true;
            equipmentPicker.DisplayFilter = true;
            equipmentPicker.EnableMultipleSelect = false;
            equipmentPicker.DataSourceCommandType = DataSourceType.StoredProcedure;
            equipmentPicker.Filters = GetEquipmentFilters();
            equipmentPicker.ItemSelected += equipmentPicker_ItemSelected;
            equipmentPicker.BackClicked += materialPicker_BackClicked;
            equipmentPicker.BindData += equipmentPicker_BindData;

            //The StateMgmtContext will differenciate between two generic pickers.
            equipmentPicker.StateMgmtContext = &quot;Equipment Picker&quot;;

            //SET THE ERP CURRENCY FOR THE GENERIC PICKER
            var currentPage = (Page) (HttpContext.Current.Handler);
            equipmentPicker.Currency = LocalizationManager.GetModuleCurrency(&quot;LIBRARY&quot;, null,
                                                                             currentPage.Session[
                                                                                 Constants.EIS_ADDITIONAL_INFO].
                                                                                 ToString2());
        }

        private void ConfigureActivityPicker(GenericPickerControl activityPicker)
        {
            activityPicker.DefaultSortColumn = &quot;ActivityID&quot;;
            activityPicker.IsFilterXml = true;
            activityPicker.DisplayFilter = true;
            activityPicker.EnableMultipleSelect = true;
            activityPicker.DataSourceCommandType = DataSourceType.StoredProcedure;
            activityPicker.Filters = GetActivityFilters();
            activityPicker.ItemSelected += activityPicker_ItemSelected;
            activityPicker.BackClicked += materialPicker_BackClicked;
            activityPicker.BindData += activityPicker_BindData;
            activityPicker.StateMgmtContext = &quot;Activity Picker&quot;;
            //SET THE ERP CURRENCY FOR THE GENERIC PICKER
            var currentPage = (Page) (HttpContext.Current.Handler);
            activityPicker.Currency = LocalizationManager.GetModuleCurrency(&quot;LIBRARY&quot;, null,
                                                                            currentPage.Session[
                                                                                Constants.EIS_ADDITIONAL_INFO].ToString2
                                                                                ());
        }

        public override void HandleWorkFlow()
        {
            (DetailControls[&quot;Approved By&quot;].FormCtrl as TextBox).Enabled =
                (DetailControls[&quot;Approved By&quot;].FormCtrl as TextBox).Parent.Parent.Visible =
                (DetailControls[&quot;Created By&quot;].FormCtrl as TextBox).Enabled =
                (DetailControls[&quot;Created By&quot;].FormCtrl as TextBox).Parent.Parent.Visible =
                (DetailControls[&quot;ApprovedDate&quot;].FormCtrl as TextBox).Enabled =
                (DetailControls[&quot;ApprovedDate&quot;].FormCtrl as TextBox).Parent.Parent.Visible =
                (DetailControls[&quot;ApprovedDate&quot;].FormCtrl as TextBox).EnableViewState = false;
            (DetailControls[&quot;ApprovedDate&quot;].FormCtrl as TextBox).Text =
                String.IsNullOrEmpty((DetailControls[&quot;ApprovedDate&quot;].FormCtrl as TextBox).Text)
                    ? &quot;&quot;
                    : Convert.ToDateTime((DetailControls[&quot;ApprovedDate&quot;].FormCtrl as TextBox).Text,
                                         CultureInfo.CurrentCulture).ToString(AMP3ApplicationSettings.Instance.FORMAT_DATE,
                                                                              CultureInfo.CurrentCulture);
            (DetailControls[&quot;Recovered Details&quot;].FormCtrl as Button).Visible = false;

            if (ProjectMode == &quot;I&quot;)
            {
                (DetailControls[&quot;CreatedDate&quot;].FormCtrl as WebDateChooser).MinDate = DefaultRecordDate;
                (DetailControls[&quot;ReqdDate&quot;].FormCtrl as WebDateChooser).MinDate = DefaultRecordDate;
                (DetailControls[&quot;CreatedDate&quot;].FormCtrl as WebDateChooser).MaxDate = IntegrationCutoffDate.AddDays(-1);
                (DetailControls[&quot;CreatedDate&quot;].FormCtrl as WebDateChooser).Enabled =
                    (DetailControls[&quot;CreatedDate&quot;].FormCtrl as WebDateChooser).Parent.Parent.Visible = true;
                (DetailControls[&quot;ReqdDate&quot;].FormCtrl as WebDateChooser).MaxDate = IntegrationCutoffDate.AddDays(-1);
                ;

                if (Mode == &quot;New&quot;)
                {
                    (DetailControls[&quot;CreatedDate&quot;].FormCtrl as WebDateChooser).Value = DefaultRecordDate;
                    (DetailControls[&quot;ReqdDate&quot;].FormCtrl as WebDateChooser).Value = DefaultRecordDate;
                }
            }
            else if (ProjectMode == &quot;L&quot;)
            {
                (DetailControls[&quot;CreatedDate&quot;].FormCtrl as WebDateChooser).MaxDate = DateTime.MaxValue;
                (DetailControls[&quot;CreatedDate&quot;].FormCtrl as WebDateChooser).Enabled =
                    (DetailControls[&quot;CreatedDate&quot;].FormCtrl as WebDateChooser).Parent.Parent.Visible = false;
                (DetailControls[&quot;ReqdDate&quot;].FormCtrl as WebDateChooser).MaxDate = DateTime.MaxValue;
                ;

                if (Mode == &quot;New&quot;)
                {
                    (DetailControls[&quot;CreatedDate&quot;].FormCtrl as WebDateChooser).Value = MWDateTimeHelper.MWToday;
                    (DetailControls[&quot;ReqdDate&quot;].FormCtrl as WebDateChooser).Value = MWDateTimeHelper.MWToday;
                }
            }

            //Hiding the Equipment and Serial No. /Registration No., should be visible only for Hired Order Equipments.
            (ColumnGroups[&quot;Activity&quot;].HtmlTblRow).Style.Value =
                (ColumnGroups[&quot;Equipment&quot;].HtmlTblRow).Style.Value =
                (ColumnGroups[&quot;IdentificationNo&quot;].HtmlTblRow).Style.Value = &quot;display:none&quot;;
            (DetailControls[&quot;HiredEquipmentID&quot;].FormCtrl as TextBox).Visible = false;
            (DetailControls[&quot;ActivityID&quot;].FormCtrl as TextBox).Visible = false;
            (DetailControls[&quot;ItemID&quot;].FormCtrl as TextBox).Visible = false;

            if ((DetailControls[&quot;PickItem&quot;].FormCtrl as Button) != null)
                (DetailControls[&quot;PickItem&quot;].FormCtrl as Button).Text = &quot;Pick Item&quot;;

            //if (string.IsNullOrEmpty((DetailControls[&quot;Item&quot;].FormCtrl as TextBox).Text))
            //    (DetailControls[&quot;Inventory Dimensions&quot;].FormCtrl as Button).Visible = false;

            DataTable dtTemp = BL.Instance.GetOwnerDetails(Request[&quot;ParentID&quot;].ToInt32_2());
            if (dtTemp.Rows[0][&quot;MIWithBOQ&quot;] != null)
                MIWithBOQ = bool.Parse(dtTemp.Rows[0][&quot;MIWithBOQ&quot;].ToString());

            if (string.IsNullOrEmpty((DetailControls[&quot;Item&quot;].FormCtrl as TextBox).Text))
            {
                (DetailControls[&quot;Inventory Dimensions&quot;].FormCtrl as Button).Visible = false;
                if (MIWithBOQ)
                    (DetailControls[&quot;Add Materials&quot;].FormCtrl as Button).Visible = false;
            }


            if (((ColumnGroups[&quot;Activity&quot;].HtmlTblRow).Style.Value == &quot;display:block&quot;) &amp;&amp;
                (DetailControls[&quot;ActivityID&quot;].FormCtrl as TextBox).Text == string.Empty)
                (DetailControls[&quot;Add Materials&quot;].FormCtrl as Button).Visible = false;
            else if (((ColumnGroups[&quot;Equipment&quot;].HtmlTblRow).Style.Value == &quot;display:block&quot;) &amp;&amp;
                     (DetailControls[&quot;HiredEquipmentID&quot;].FormCtrl as TextBox).Text == string.Empty)
                (DetailControls[&quot;Add Materials&quot;].FormCtrl as Button).Visible = false;
            else if (((ColumnGroups[&quot;Item&quot;].HtmlTblRow).Style.Value == &quot;display:block&quot;) &amp;&amp;
                     (DetailControls[&quot;ItemID&quot;].FormCtrl as TextBox).Text == string.Empty)
                (DetailControls[&quot;Add Materials&quot;].FormCtrl as Button).Visible = false;

            //Check in case of Save button click without adding any Resource
            //If it is a hire order equipment, then display the Equipment and Serial No. /Registration No. 
            if (!string.IsNullOrEmpty((DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).SelectedValue) &amp;&amp;
                (DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).SelectedValue != &quot;NA&quot;)
                CheckForEquipmentHireOrder();

            // Modifying and hiding the Equipment Picker column labels.
            var equipmentPicker = (DetailControls[&quot;EquipmentPicker&quot;].FormCtrl as GenericPickerControl);
            (DetailControls[&quot;ActivityPicker&quot;].FormCtrl as GenericPickerControl).ModifyColumnProperties(
                &quot;StandardItemNo&quot;, false, null, null, null, false,
                LocalizationManager.GetString(KeyConstants.LOC_PAY_ITEM_NO_ABBR));
            equipmentPicker.ModifyColumnProperties(&quot;HireOrderItem&quot;, false, null, null, null, false, &quot;Hire Order Item&quot;);
            equipmentPicker.ModifyColumnProperties(&quot;IdentificationNo&quot;, false, null, null, null, false,
                                                   &quot;Serial No. /Registration No.&quot;);
            equipmentPicker.ModifyColumnProperties(&quot;HiredEquipmentID&quot;, true, null, null, null, false);
            var activitypicker = (DetailControls[&quot;ActivityPicker&quot;].FormCtrl as GenericPickerControl);
            activitypicker.ModifyColumnProperties(&quot;ActivityID&quot;, true, null, null, null, false);

            if (MasterRow != null)
            {
                if (MasterRow[&quot;WorkOrderNo&quot;] != null &amp;&amp; MasterRow[&quot;WorkOrderNo&quot;].ToString2() != &quot;0&quot; &amp;&amp;
                    MasterRow[&quot;WorkOrderNo&quot;].ToString2() != &quot;None&quot;)
                {
                    PopulateWO();
                    if (
                        (DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).Items.FindByText(
                            MasterRow[&quot;WorkOrderNo&quot;].ToString2()) != null)
                    {
                        (DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).SelectedIndex = -1;
                        (DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).Items.FindByText(
                            MasterRow[&quot;WorkOrderNo&quot;].ToString2()).Selected = true;
                        if ((DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).SelectedIndex &gt; 0 &amp;&amp;
                            ProjectMode.Equals(&quot;I&quot;))
                        {
                            DateTime dtMindate =
                                MATRISSBL.Instance.GetWOIssuedDate(
                                    (DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).SelectedItem.Value.
                                        ToInt32_2());
                            (DetailControls[&quot;CreatedDate&quot;].FormCtrl as WebDateChooser).MinDate = dtMindate;
                        }
                    }
                    else
                    {
                        (DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).SelectedIndex = -1;
                        (DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).Items.Add(
                            MasterRow[&quot;WorkOrderNo&quot;].ToString2());
                        (DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).Items.FindByText(
                            MasterRow[&quot;WorkOrderNo&quot;].ToString2()).Selected = true;
                    }
                    CheckForEquipmentHireOrder();
                }

                if (Mode == &quot;View&quot; || Mode == &quot;Approve&quot; ||
                    (MasterRow[&quot;Status&quot;].ToString2() == &quot;Approved&quot; || MasterRow[&quot;Status&quot;].ToString2() == &quot;Issued&quot; ||
                     MasterRow[&quot;Status&quot;].ToString2() == &quot;Partially Recovered&quot; ||
                     MasterRow[&quot;Status&quot;].ToString2() == &quot;Fully Recovered&quot;))
                {
                    (DetailControls[&quot;PickItem&quot;].FormCtrl as Button).Visible = false;
                    (DetailControls[&quot;Add Materials&quot;].FormCtrl as Button).Visible = false;
                    (DetailControls[&quot;Delete Resource&quot;].FormCtrl as Button).Visible = false;
                    (DetailControls[&quot;Inventory Dimensions&quot;].FormCtrl as Button).Visible = false;
                    // Makes the Equipment Picker button invisible when the user comes in non editable mode.
                    (DetailControls[&quot;PickEquipment&quot;].FormCtrl as Button).Visible = false;
                    (DetailControls[&quot;PickActivity&quot;].FormCtrl as Button).Visible = false;
                }
                if (Mode == &quot;Edit&quot; || Mode == &quot;View&quot; || Mode == &quot;Approve&quot;)
                {
                    (DetailControls[&quot;Created By&quot;].FormCtrl as TextBox).Parent.Parent.Visible =
                        (DetailControls[&quot;CreatedDate&quot;].FormCtrl as WebDateChooser).Parent.Parent.Visible = true;
                    //(DetailControls[&quot;ContractorType&quot;].FormCtrl as RadioButtonList).Enabled = false;
                    if (MasterRow[&quot;Status&quot;].ToString2() == &quot;Approved&quot; || MasterRow[&quot;Status&quot;].ToString2() == &quot;Issued&quot; ||
                        MasterRow[&quot;Status&quot;].ToString2() == &quot;Partially Recovered&quot; ||
                        MasterRow[&quot;Status&quot;].ToString2() == &quot;Fully Recovered&quot;)
                    {
                        (DetailControls[&quot;Approved By&quot;].FormCtrl as TextBox).Parent.Parent.Visible =
                            (DetailControls[&quot;ApprovedDate&quot;].FormCtrl as TextBox).Parent.Parent.Visible = true;
                    }
                }
                if (Mode == &quot;View&quot;)
                {
                    (DetailControls[&quot;Recovered Details&quot;].FormCtrl as Button).Visible = true;
                    (DetailControls[&quot;Item&quot;].FormCtrl as TextBox).Enabled = true;
                    (DetailControls[&quot;Item&quot;].FormCtrl as TextBox).ReadOnly = true;
                    (DetailControls[&quot;CreatedDate&quot;].FormCtrl as WebDateChooser).Enabled = false;
                }
                else
                    (DetailControls[&quot;Recovered Details&quot;].FormCtrl as Button).Visible = false;

                if (!MIWithBOQ)
                {
                    (DetailControls[&quot;PickItem&quot;].FormCtrl as Button).Visible = false;
                    (DetailControls[&quot;Item&quot;].FormCtrl as TextBox).Visible = false;
                }

                if (MasterRow[&quot;Status&quot;].ToString2() == &quot;Complete&quot;)
                {
                    if (DetailControls[&quot;Add Materials&quot;] != null)
                        (DetailControls[&quot;Add Materials&quot;].FormCtrl as Button).Visible = false;
                }
            }
        }

        public void ClearOnSelection()
        {
            (DetailControls[&quot;Item&quot;].FormCtrl as TextBox).Text = string.Empty;
            (DetailControls[&quot;Equipment&quot;].FormCtrl as TextBox).Text = string.Empty;
            (DetailControls[&quot;Activity&quot;].FormCtrl as TextBox).Text = string.Empty;
            (DetailControls[&quot;HiredEquipmentID&quot;].FormCtrl as TextBox).Text = string.Empty;
            (DetailControls[&quot;ActivityID&quot;].FormCtrl as TextBox).Text = string.Empty;
            (DetailControls[&quot;IdentificationNo&quot;].FormCtrl as TextBox).Text = string.Empty;

            (ColumnGroups[&quot;Activity&quot;].HtmlTblRow).Style.Value =
                (ColumnGroups[&quot;Equipment&quot;].HtmlTblRow).Style.Value =
                (ColumnGroups[&quot;IdentificationNo&quot;].HtmlTblRow).Style.Value = &quot;display:none&quot;;
            if (!MIWithBOQ)
                (ColumnGroups[&quot;Item&quot;].HtmlTblRow).Style.Value = &quot;display:none&quot;;
            else
                (ColumnGroups[&quot;Item&quot;].HtmlTblRow).Style.Value = &quot;display:block&quot;;
        }

        public override void HandleEvents(object sender, string CommandName)
        {
            if (CommandName.Equals(&quot;ContractorType&quot;))
            {
                DeleteResourcesFromGrid(1);
                ClearOnSelection();
                (DetailControls[&quot;ItemID&quot;].FormCtrl as TextBox).Text = string.Empty;
                (DetailControls[&quot;Add Materials&quot;].FormCtrl as Button).Visible = false;
                (DetailControls[&quot;Inventory Dimensions&quot;].FormCtrl as Button).Visible = false;
                if (MasterRow != null &amp;&amp;
                    (DetailControls[&quot;ContractorType&quot;].FormCtrl as RadioButtonList).SelectedValue !=
                    MasterRow[&quot;ContractorType&quot;].ToString2())
                {
                    //DeleteResourcesFromGrid(1);
                    if (MasterRow[&quot;Status&quot;].ToString2() != &quot;Draft&quot;)
                    {
                        (DetailControls[&quot;Add Materials&quot;].FormCtrl as Button).Visible = false;
                        (DetailControls[&quot;Delete Resource&quot;].FormCtrl as Button).Visible = true;
                    }
                }
                if ((DetailControls[&quot;ContractorType&quot;].FormCtrl as RadioButtonList).SelectedValue == &quot;Prime Contractor&quot;)
                {
                    (DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).SelectedIndex = 0;
                    (DetailControls[&quot;Contractor&quot;].FormCtrl as DropDownList).SelectedIndex = 0;
                    (DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).Enabled = false;
                    (DetailControls[&quot;Contractor&quot;].FormCtrl as DropDownList).Enabled = false;
                    if ((DetailControls[&quot;ItemPicker&quot;].FormCtrl as ItemPickerControl).ModuleID != &quot;CONTMGT&quot; ||
                        ((DetailControls[&quot;ItemPicker&quot;].FormCtrl as ItemPickerControl).ParentInstanceID !=
                         ParentInstanceID))
                    {
                        (DetailControls[&quot;ItemPicker&quot;].FormCtrl as ItemPickerControl).ModuleID = &quot;CONTMGT&quot;;
                        (DetailControls[&quot;ItemPicker&quot;].FormCtrl as ItemPickerControl).ParentInstanceID = ParentInstanceID;
                        (DetailControls[&quot;ItemPicker&quot;].FormCtrl as ItemPickerControl).InitializeGrid();
                    }
                    (ColumnGroups[&quot;Activity&quot;].HtmlTblRow).Style.Value =
                        (ColumnGroups[&quot;Equipment&quot;].HtmlTblRow).Style.Value =
                        (ColumnGroups[&quot;IdentificationNo&quot;].HtmlTblRow).Style.Value = &quot;display:none&quot;;
                    if (!MIWithBOQ)
                        (DetailControls[&quot;Add Materials&quot;].FormCtrl as Button).Visible = true;
                    else
                        (DetailControls[&quot;Add Materials&quot;].FormCtrl as Button).Visible = false;
                }
                else
                {
                    (DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).Enabled = true;
                    (DetailControls[&quot;Contractor&quot;].FormCtrl as DropDownList).Enabled = true;
                }
                //if (MasterRow != null &amp;&amp; statusDDL.SelectedItem.Text != MasterRow[&quot;Status&quot;].ToString2() &amp;&amp; (DetailControls[&quot;ContractorType&quot;].FormCtrl as RadioButtonList).SelectedValue == MasterRow[&quot;ContractorType&quot;].ToString2())
                //{
                //    List&lt;string&gt; permissions = ModuleManager.Instance.GetPermissionByRole(this.ModuleID, UserDetail.GetCurrentUserDetail().RID);
                //    if (permissions.Contains(&quot;Approve&quot;) &amp;&amp; MasterRow[&quot;Status&quot;].ToString2() != &quot;Draft&quot;)
                //        statusDDL.Items.Add(&quot;Submission for Approval&quot;);
                //    if (MasterRow[&quot;Status&quot;].ToString2() == &quot;Approved&quot; || MasterRow[&quot;Status&quot;].ToString2() == &quot;Issued&quot; ||
                //        MasterRow[&quot;Status&quot;].ToString2() == &quot;Partially Recovered&quot; ||
                //        MasterRow[&quot;Status&quot;].ToString2() == &quot;Fully Recovered&quot;)
                //        statusDDL.Items.Add(MasterRow[&quot;Status&quot;].ToString2());
                //    (DetailControls[&quot;Status&quot;].FormCtrl as DropDownList).ClearSelection();
                //    (DetailControls[&quot;Status&quot;].FormCtrl as DropDownList).Items.FindByText(MasterRow[&quot;Status&quot;].ToString2()).Selected = true;
                //}
            }
            else if (CommandName.Equals(&quot;Contractor&quot;))
            {
                ValidateContractorType();
                ClearOnSelection();
                if ((DetailControls[&quot;ContractorType&quot;].FormCtrl as RadioButtonList).SelectedValue != &quot;Prime Contractor&quot;)
                {
                    PopulateWO();
                }
            }
            else if (CommandName.Equals(&quot;Delete Resource&quot;))
            {
                DeleteResourcesFromGrid(0);
                (DetailControls[&quot;Add Materials&quot;].FormCtrl as Button).Visible = true;
                (DetailControls[&quot;Inventory Dimensions&quot;].FormCtrl as Button).Visible = true;
            }
            else if (CommandName.Equals(&quot;WorkOrderNo&quot;))
            {
                //DeleteResourcesFromGrid(1);
                ValidateContractorType();

                ClearOnSelection();
                //Check : If it is a hire order equipment, then display the Equipment and Serial No. /Registration No. 
                CheckForEquipmentHireOrder();
                // Binds the Equipments to the Equipment Picker on change of Work Order No.
                AddEquipment();
                AddActivities();
                if (Request.Form[MasterControls[&quot;WorkOrderNo&quot;]] != &quot;0&quot; &amp;&amp;
                    Request.Form[MasterControls[&quot;WorkOrderNo&quot;]] != null)
                {
                    int parentid = Request.Form[MasterControls[&quot;WorkOrderNo&quot;]] != &quot;0&quot; &amp;&amp;
                                   Request.Form[MasterControls[&quot;WorkOrderNo&quot;]] != null
                                       ? Int32.Parse(Request.Form[MasterControls[&quot;WorkOrderNo&quot;]])
                                       : 0;
                    if ((DetailControls[&quot;ItemPicker&quot;].FormCtrl as ItemPickerControl).ModuleID != &quot;WORKORD&quot;
                        || ((DetailControls[&quot;ItemPicker&quot;].FormCtrl as ItemPickerControl).ParentInstanceID != parentid)
                        )
                    {
                        (DetailControls[&quot;ItemPicker&quot;].FormCtrl as ItemPickerControl).ModuleID = &quot;WORKORD&quot;;
                        (DetailControls[&quot;ItemPicker&quot;].FormCtrl as ItemPickerControl).ParentInstanceID = parentid;
                        (DetailControls[&quot;ItemPicker&quot;].FormCtrl as ItemPickerControl).InitializeGrid();
                    }
                    if (!MIWithBOQ &amp;&amp; (ColumnGroups[&quot;Equipment&quot;].HtmlTblRow).Style.Value == &quot;display:none&quot; &amp;&amp;
                        (ColumnGroups[&quot;Activity&quot;].HtmlTblRow).Style.Value == &quot;display:none&quot;)
                        (DetailControls[&quot;Add Materials&quot;].FormCtrl as Button).Visible = true;
                    else
                        (DetailControls[&quot;Add Materials&quot;].FormCtrl as Button).Visible = false;
                    if ((DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).SelectedIndex &gt; 0 &amp;&amp;
                        ProjectMode.Equals(&quot;I&quot;))
                    {
                        DateTime dtMindate =
                            MATRISSBL.Instance.GetWOIssuedDate(
                                (DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).SelectedItem.Value.ToInt32_2());
                        (DetailControls[&quot;CreatedDate&quot;].FormCtrl as WebDateChooser).MinDate = dtMindate;
                    }
                }
                else
                    (DetailControls[&quot;Add Materials&quot;].FormCtrl as Button).Visible = false;
            }
            else if (CommandName.Equals(&quot;Inventory Dimensions&quot;))
            {
                var uwg = (DetailControls[&quot;ResourceDetails&quot;].FormCtrl as UltraWebGrid);
                if (uwg.DisplayLayout.ActiveRow == null)
                {
                    string msg = &quot;Please select a resource&quot;;
                    var myPage = (Page) HttpContext.Current.Handler;
                    myPage.ClientScript.RegisterStartupScript(GetType(), &quot;ShowAlert&quot;, &quot;alert(&#39;&quot; + msg + &quot;&#39;);&quot;, true);
                    return;
                }

                (DetailControls[&quot;DimensionPicker&quot;].FormCtrl as GenericPickerControl).ChangeTableOrViewAndBind(&quot;&quot;);
            }
        }

        // Binds the Equipments to the Equipment Picker
        public void AddEquipment()
        {
            var equipmentPicker = (DetailControls[&quot;EquipmentPicker&quot;].FormCtrl as GenericPickerControl);
            equipmentPicker.ChangeTableOrViewAndBind(&quot;&quot;);
        }

        // Binds the Activities to the Activity Picker
        public void AddActivities()
        {
            var activityPicker = (DetailControls[&quot;ActivityPicker&quot;].FormCtrl as GenericPickerControl);
            activityPicker.ChangeTableOrViewAndBind(&quot;&quot;);
        }

        //private methods
        public virtual void SaveResourceDetails(int IssueID, int itemID)
        {
            foreach (UltraGridRow row in (DetailControls[&quot;ResourceDetails&quot;].FormCtrl as UltraWebGrid).Rows)
            {
                if (String.IsNullOrEmpty(row.Cells.FromKey(&quot;Quantity&quot;).Text))
                    row.Cells.FromKey(&quot;Quantity&quot;).Value = 0;
                row.Cells.FromKey(&quot;Cost&quot;).Value =
                    Decimal.Parse(row.Cells.FromKey(&quot;Quantity&quot;).Text, CultureInfo.CurrentCulture)*
                    decimal.Parse(row.Cells.FromKey(&quot;Rate&quot;).ToString2(), CultureInfo.CurrentCulture);
            }
            //TO DO:  create a SP to bulk update resources in editmode. Remove below condition
            if (InstanceID != 0)
            {
                string resourceDetailIDList = String.Empty;
                DataSet ds = ItemManager.Instance.GetRateAnalysis(ModuleID, InstanceID, itemID);
                //ItemManager.Instance.HideMultiCurrencyColumns(ds.Tables[1]);
                if (ds.Tables[1].Columns.Contains(&quot;Contractor&quot;))
                    ds.Tables[1].Columns.Remove(&quot;Contractor&quot;);
                if (ds.Tables[1].Columns.Contains(&quot;TradeAgmtCurrency&quot;))
                    ds.Tables[1].Columns.Remove(&quot;TradeAgmtCurrency&quot;);
                foreach (DataRow dr in ds.Tables[1].Rows)
                {
                    resourceDetailIDList += dr[&quot;ResourceDetailID&quot;].ToString2() + &quot;,&quot;;
                }
                if (!string.IsNullOrEmpty(resourceDetailIDList))
                {
                    resourceDetailIDList = resourceDetailIDList.Substring(0,
                                                                          resourceDetailIDList.LastIndexOf(&quot;,&quot;,
                                                                                                           StringComparison
                                                                                                               .
                                                                                                               OrdinalIgnoreCase));
                    ItemManager.Instance.DeleteRateAnalysis(resourceDetailIDList);
                }
            }
            var resourceDTO = new Resource();
            var uwgDetails = (DetailControls[&quot;ResourceDetails&quot;].FormCtrl as UltraWebGrid);
            foreach (UltraGridRow dr in uwgDetails.Rows)
            {
                resourceDTO.ItemID = itemID;
                resourceDTO.ResourceTypeID = 3;
                resourceDTO.Description = dr.Cells.FromKey(&quot;Description&quot;).Text;
                resourceDTO.UnitID = Int32.Parse(dr.Cells.FromKey(&quot;UnitID&quot;).Text, CultureInfo.CurrentCulture);
                resourceDTO.Unit = dr.Cells.FromKey(&quot;Unit&quot;).Text;
                resourceDTO.Rate = Decimal.Parse(dr.Cells.FromKey(&quot;Rate&quot;).Text, CultureInfo.CurrentCulture);
                resourceDTO.Quantity = String.IsNullOrEmpty(dr.Cells.FromKey(&quot;Quantity&quot;).Text)
                                           ? (decimal) 0
                                           : Decimal.Parse(dr.Cells.FromKey(&quot;Quantity&quot;).Text, CultureInfo.CurrentCulture);
                resourceDTO.Cost = Decimal.Parse(dr.Cells.FromKey(&quot;Cost&quot;).Text, CultureInfo.CurrentCulture);
                resourceDTO.Notes = dr.Cells.FromKey(&quot;Notes&quot;).Text;
                resourceDTO.IsCritical = string.IsNullOrEmpty(dr.Cells.FromKey(&quot;IsCritical&quot;).Text)
                                             ? false
                                             : Convert.ToBoolean(dr.Cells.FromKey(&quot;IsCritical&quot;).Text);
                if (dr.Cells.FromKey(&quot;ResItemID&quot;) != null)
                    resourceDTO.ResItemID = dr.Cells.FromKey(&quot;ResItemID&quot;).Text.Trim();
                if (dr.Cells.FromKey(&quot;ParentResItemID&quot;) != null)
                    resourceDTO.ParentResItemID = dr.Cells.FromKey(&quot;ParentResItemID&quot;).Text;
                resourceDTO.ModuleID = &quot;MATRISS&quot;;
                resourceDTO.ParentInstanceID = IssueID;
                //AX Inventory Dimension Columns
                if (dr.Cells.FromKey(&quot;Size&quot;) != null)
                    resourceDTO.Size = dr.Cells.FromKey(&quot;Size&quot;).Text;
                if (dr.Cells.FromKey(&quot;Color&quot;) != null)
                    resourceDTO.Color = dr.Cells.FromKey(&quot;Color&quot;).Text;
                if (dr.Cells.FromKey(&quot;Configuration&quot;) != null)
                    resourceDTO.Configuration = dr.Cells.FromKey(&quot;Configuration&quot;).Text;
                int ResourceDetailID = ItemManager.Instance.SaveRateAnalysisDetails(resourceDTO);
                if (Mode == &quot;Approve&quot;)
                {
                    if (dr.Cells.FromKey(&quot;ApprovedQuantity&quot;).ToString2() != &quot;Cell&quot;)
                        MATRISSBL.Instance.UpdateMaterialIssuedQuantity(ResourceDetailID,
                                                                        decimal.Parse(
                                                                            dr.Cells.FromKey(&quot;ApprovedQuantity&quot;).
                                                                                ToString2(), CultureInfo.CurrentCulture));
                }
            }
        }

        public void PopulateWO()
        {
            var ddlWorkOrder = (DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList);
            ddlWorkOrder.Items.Clear();
            ddlWorkOrder.Items.Insert(0, new ListItem(&quot;None&quot;, &quot;0&quot;));
            if ((DetailControls[&quot;Contractor&quot;].FormCtrl as DropDownList).SelectedIndex &gt; 0)
            {
                dtFiltered =
                    WORKORDManager.Instance.GetWOOrContractor(ParentInstanceID, null,
                                                              int.Parse(
                                                                  (DetailControls[&quot;Contractor&quot;].FormCtrl as DropDownList)
                                                                      .SelectedItem.Value.Split(new[] {&#39;,&#39;})[0],
                                                                  CultureInfo.CurrentCulture)).DataSet.Tables[1];
                int i = 1;
                foreach (DataRow dRow in dtFiltered.Rows)
                {
                    ddlWorkOrder.Items.Insert(i,
                                              new ListItem(dRow[&quot;WorkOrderNo&quot;].ToString2(),
                                                           dRow[&quot;WorkOrderID&quot;].ToString2()));
                    i++;
                }
            }
            if (ddlWorkOrder.Items.Count == 1)
                (DetailControls[&quot;Add Materials&quot;].FormCtrl as Button).Visible = false;
        }

        public void DeleteResourcesFromGrid(int clear)
        {
            var uwg = (DetailControls[&quot;ResourceDetails&quot;].FormCtrl as UltraWebGrid);
            int i = 0;
            while (i &lt;= (uwg.Rows.Count - 1))
            {
                if (clear == 1 || uwg.Rows[i].Cells.FromKey(&quot;Multi&quot;).Value.ToString2() == &quot;true&quot;)
                {
                    uwg.Rows[i].Delete();
                }
                else
                    i++;
            }
        }

        protected void dimensionsPicker_BindData(string Filter, string SortOrder, out DataSet DsResult,
                                                 ref int CurrentPage, int PageSize, out int PageCount)
        {
            DsResult = new DataSet();
            PageCount = 0;
            string axCompany = ((Page) HttpContext.Current.Handler).Session[Constants.EIS_ADDITIONAL_INFO] == null
                                   ? string.Empty
                                   : ((Page) HttpContext.Current.Handler).Session[Constants.EIS_ADDITIONAL_INFO].
                                         ToString2();

            var uwg = (DetailControls[&quot;ResourceDetails&quot;].FormCtrl as UltraWebGrid);
            UltraGridRow activeRow = uwg.DisplayLayout.ActiveRow;

            if (activeRow != null)
            {
                string resItemId = activeRow.Cells.FromKey(&quot;ParentResItemId&quot;).ToString2();
                string itemFilter = &quot;&lt;ItemId type =&#39;txt&#39;&gt;&quot; + resItemId + &quot;&lt;/ItemId&gt;&lt;/XMLRoot&gt;&quot;;
                if (string.IsNullOrEmpty(Filter))
                    Filter = &quot;&lt;XMLRoot&gt;&quot; + itemFilter;
                else
                    Filter = Filter.Replace(&quot;&lt;/XMLRoot&gt;&quot;, itemFilter);

                DataSet ds = new BrixDataSet();
                PageCount = (int) Math.Ceiling(GetDimensionsPageCount(Filter)/PageSize);
                var objAdditionalInfo = new EISAdditionalInfo(RegisteredEIS.AX);
                objAdditionalInfo.AddInfo(Constants.EIS_ADDITIONAL_INFO, axCompany);
                var dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
                dictAdditionalInfo.Add(RegisteredEIS.AX, objAdditionalInfo);
                var ConnectorParameters =
                    new ConnectorParameters(dictAdditionalInfo, MethodBase.GetCurrentMethod(),
                                            AMP3ObjectType.Unknown, new ConnectionFilter(Filter, null, null, null, null),
                                            null);
                int count = 0;
                try
                {
                    if (IntegrationConnectorManager.HandleIntegration(ConnectorParameters, ref count, ref ds, true))
                    {
                        if (ds.Tables.Count &gt; 0)
                        {
                            DsResult = ds;
                            PageCount = PageCount == 0 ? 1 : PageCount;
                        }
                    }
                }
                catch (Exception ex)
                {
                }
            }
            (DetailControls[&quot;DimensionPicker&quot;].FormCtrl as GenericPickerControl).ModifyColumnProperties(&quot;InventDimId&quot;,
                                                                                                        true, null, null,
                                                                                                        null, false);
            (DetailControls[&quot;DimensionPicker&quot;].FormCtrl as GenericPickerControl).ModifyColumnProperties(&quot;InventDimId&quot;,
                                                                                                        true, null, null,
                                                                                                        null, false);
            (DetailControls[&quot;DimensionPicker&quot;].FormCtrl as GenericPickerControl).ModifyColumnProperties(&quot;ItemId&quot;, true,
                                                                                                        null, null, null,
                                                                                                        false);
            (DetailControls[&quot;DimensionPicker&quot;].FormCtrl as GenericPickerControl).ModifyColumnProperties(&quot;InventSizeId&quot;,
                                                                                                        false, null,
                                                                                                        null, null,
                                                                                                        false, &quot;Size&quot;);
            (DetailControls[&quot;DimensionPicker&quot;].FormCtrl as GenericPickerControl).ModifyColumnProperties(
                &quot;InventColorId&quot;, false, null, null, null, false, &quot;Color&quot;);
            (DetailControls[&quot;DimensionPicker&quot;].FormCtrl as GenericPickerControl).ModifyColumnProperties(&quot;ConfigId&quot;,
                                                                                                        false, null,
                                                                                                        null, null,
                                                                                                        false,
                                                                                                        &quot;Configuration&quot;);
        }

        private double GetDimensionsPageCount(string filter)
        {
            string mappedCompany = string.Empty;
            mappedCompany = ((Page) HttpContext.Current.Handler).Session[Constants.EIS_ADDITIONAL_INFO].ToString2();
            return LibraryInterface.Instance.GetResourceItemsCount(mappedCompany, &quot;&quot;, 0, &quot;&quot;, filter);
        }


        protected void equipmentPicker_BindData(string Filter, string SortOrder, out DataSet DsResult,
                                                ref int CurrentPage, int PageSize, out int PageCount)
        {
            DsResult = new DataSet();

            string workOrderNo = string.Empty;

            // If it is Edit mode and Work Order  exists and is not NA, then pass this work order to get the equipments.
            if (Mode == &quot;Edit&quot; &amp;&amp; !string.IsNullOrEmpty(MasterRow[&quot;WorkOrderNo&quot;].ToString()) &amp;&amp;
                MasterRow[&quot;WorkOrderNo&quot;].ToString() != &quot;None&quot;)
                workOrderNo = MasterRow[&quot;WorkOrderNo&quot;].ToString2();
                // If Work Order  exists and is not NA, then pass this work order to get the equipments.
            else if (!string.IsNullOrEmpty((DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).SelectedValue) &amp;&amp;
                     (DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).SelectedValue != &quot;NA&quot;)
                workOrderNo = (DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).SelectedItem.Text;

            DsResult.Tables.Add(MATRISSBL.Instance.GetHiredEquipments(workOrderNo, CurrentPage, PageSize, SortOrder,
                                                                      Filter, out PageCount));
        }

        protected void activityPicker_BindData(string Filter, string SortOrder, out DataSet DsResult,
                                               ref int CurrentPage, int PageSize, out int PageCount)
        {
            DsResult = new DataSet();

            string workOrderNo = string.Empty;

            // If it is Edit mode and Work Order  exists and is not NA, then pass this work order to get the activities.
            if (Mode == &quot;Edit&quot; &amp;&amp; !string.IsNullOrEmpty(MasterRow[&quot;WorkOrderNo&quot;].ToString()) &amp;&amp;
                MasterRow[&quot;WorkOrderNo&quot;].ToString() != &quot;None&quot;)
                workOrderNo = MasterRow[&quot;WorkOrderNo&quot;].ToString2();
                // If Work Order  exists and is not NA, then pass this work order to get the activities.
            else if (!string.IsNullOrEmpty((DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).SelectedValue) &amp;&amp;
                     (DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).SelectedValue != &quot;NA&quot;)
                workOrderNo = (DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).SelectedItem.Text;

            DsResult.Tables.Add(MATRISSBL.Instance.GetActivities(workOrderNo, CurrentPage, PageSize, SortOrder, Filter,
                                                                 out PageCount));
        }

        //registered events
        protected void materialPicker_BindData(string Filter, string SortOrder, out DataSet DsResult,
                                               ref int CurrentPage, int PageSize, out int PageCount)
        {
            string AXCompany = ((Page) HttpContext.Current.Handler).Session[Constants.EIS_ADDITIONAL_INFO] == null
                                   ? string.Empty
                                   : ((Page) HttpContext.Current.Handler).Session[Constants.EIS_ADDITIONAL_INFO].
                                         ToString2();

            DataTable dtMap = IntegrationConnectorManager.Instance.GetERPObjectMapInfo(ParentInstanceID.ToString2(),
                                                                                       AMP3Object.CONTMGT, null,
                                                                                       AMP3Object.UNKNOWN,
                                                                                       RegisteredEIS.AX);
            PageCount = 0;
            DsResult = new BrixDataSet();

            int startRowIndex = (PageSize*(CurrentPage - 1)) + 1;

            if (dtMap.Rows.Count &gt; 0)
            {
                if (!string.IsNullOrEmpty(Filter))
                    Filter = Filter.Replace(&quot;&lt;/XMLRoot&gt;&quot;,
                                            &quot;&lt;ProjId type=&#39;txt&#39;&gt;&quot; + dtMap.Rows[0][&quot;ERPId&quot;].ToString2() +
                                            &quot;&lt;/ProjId&gt;&lt;/XMLRoot&gt;&quot;);
                else
                    Filter = &quot;&lt;XMLRoot&gt;&lt;ProjId type=&#39;txt&#39;&gt;&quot; + dtMap.Rows[0][&quot;ERPId&quot;].ToString2() + &quot;&lt;/ProjId&gt;&lt;/XMLRoot&gt;&quot;;
                var AdditionalInfo = new EISAdditionalInfo(RegisteredEIS.AX);
                AdditionalInfo.AddInfo(&quot;AXCompany&quot;, AXCompany);
                var dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
                dictAdditionalInfo.Add(RegisteredEIS.AX, AdditionalInfo);

                //GET PAGE COUNT
                var connectorParameters = new ConnectorParameters(dictAdditionalInfo,
                                                                  MethodBase.GetCurrentMethod().DeclaringType.ToString2(),
                                                                  &quot;GetPageCount&quot;, AMP3ObjectType.Unknown,
                                                                  new ConnectionFilter(Filter, null, null, null, null),
                                                                  null);
                IntegrationConnectorManager.HandleIntegration(connectorParameters, ref PageCount, ref DsResult, true);
                PageCount = PageCount &lt; PageSize ? 1 : (int) Math.Ceiling(PageCount.ToDecimal2()/PageSize);
                //GET MATERIALS FROM AX BASED ON WAREHOUSE
                connectorParameters = new ConnectorParameters(dictAdditionalInfo, MethodBase.GetCurrentMethod(),
                                                              AMP3ObjectType.Unknown,
                                                              new ConnectionFilter(Filter, SortOrder, startRowIndex,
                                                                                   PageSize, null), null);
                int count = 0;
                IntegrationConnectorManager.HandleIntegration(connectorParameters, ref count, ref DsResult, true);
            }
        }

        private void materialPicker_BackClicked(object sender, EventArgs e)
        {
            OnEventDoneClicked(e);
            CheckForEquipmentHireOrder();
            if (((((ColumnGroups[&quot;Equipment&quot;].HtmlTblRow).Style.Value == &quot;display:block&quot;) &amp;&amp;
                  (DetailControls[&quot;HiredEquipmentID&quot;].FormCtrl as TextBox).Text != string.Empty) ||
                 ((ColumnGroups[&quot;Activity&quot;].HtmlTblRow).Style.Value == &quot;display:block&quot;) &amp;&amp;
                 (DetailControls[&quot;Activity&quot;].FormCtrl as TextBox).Text != string.Empty))
                //&amp;&amp; (DetailControls[&quot;Status&quot;].FormCtrl as DropDownList).SelectedValue == &quot;Draft&quot;)
            {
                (DetailControls[&quot;Add Materials&quot;].FormCtrl as Button).Visible = true;
            }
            else if (MIWithBOQ &amp;&amp; ((ColumnGroups[&quot;Item&quot;].HtmlTblRow).Style.Value == &quot;display:none&quot;) &amp;&amp;
                     (DetailControls[&quot;ItemID&quot;].FormCtrl as TextBox).Text != string.Empty)
                (DetailControls[&quot;Add Materials&quot;].FormCtrl as Button).Visible = false;
            (DetailControls[&quot;Inventory Dimensions&quot;].FormCtrl as Button).Visible = true;
        }

        private void equipmentPicker_ItemSelected(object sender, ItemSelectedEventArgs e)
        {
            // Get the Selected Equipment from the picker
            DataTable selectedResources = e.SelectedItems;
            // Bind the Selected equipment in the picker to the page controls.
            (DetailControls[&quot;Equipment&quot;].FormCtrl as TextBox).Text = selectedResources.Rows[0][&quot;Equipment&quot;].ToString();
            (DetailControls[&quot;IdentificationNo&quot;].FormCtrl as TextBox).Text =
                selectedResources.Rows[0][&quot;IdentificationNo&quot;].ToString();
            // Save the HiredEquipmentID of the selected equipment to map it with Material Issue.
            (DetailControls[&quot;HiredEquipmentID&quot;].FormCtrl as TextBox).Text =
                selectedResources.Rows[0][&quot;HiredEquipmentID&quot;].ToString();

            (DetailControls[&quot;Add Materials&quot;].FormCtrl as Button).Visible = true;

            materialPicker_BackClicked(sender, e);
        }

        private void activityPicker_ItemSelected(object sender, ItemSelectedEventArgs e)
        {
            // Get the Selected Activity from the picker
            DataTable selectedResources = e.SelectedItems;
            // Bind the Selected activity in the picker to the page controls.
            (DetailControls[&quot;Activity&quot;].FormCtrl as TextBox).Text =
                selectedResources.Rows[0][&quot;Activity Name&quot;].ToString();

            // Save the ActivityID of the selected activity to map it with Material Issue.
            (DetailControls[&quot;ActivityID&quot;].FormCtrl as TextBox).Text = selectedResources.Rows[0][&quot;ActivityID&quot;].ToString();

            (DetailControls[&quot;Add Materials&quot;].FormCtrl as Button).Visible = true;

            materialPicker_BackClicked(sender, e);
        }


        private void materialPicker_ItemSelected(object sender, ItemSelectedEventArgs e)
        {
            try
            {
                if (AddResourcesToGrid(e))
                {
                    materialPicker_BackClicked(sender, e);
                    throw new Exception(&quot;Duplicate Resources Not Allowed.&quot;);
                }
                materialPicker_BackClicked(sender, e);
            }
            catch (Exception ex)
            {
                throw new Exception(ex.Message);
            }
        }

        private void dimensionsPicker_ItemSelected(object sender, ItemSelectedEventArgs e)
        {
            try
            {
                bool isDuplicate = false;
                DataTable dt = e.SelectedItems;
                var uwg = (DetailControls[&quot;ResourceDetails&quot;].FormCtrl as UltraWebGrid);
                UltraGridRow activeRow = uwg.DisplayLayout.ActiveRow;
                if (dt.Rows.Count &gt; 0)
                {
                    DataRow dr = dt.Rows[0];
                    string selResItemID = activeRow.Cells.FromKey(&quot;ParentResItemId&quot;).Value.ToString2() +
                                          (string.IsNullOrEmpty(dr[&quot;InventSizeId&quot;].ToString2())
                                               ? &quot;&quot;
                                               : (&quot;@&quot; + dr[&quot;InventSizeId&quot;].ToString2().ToLower())) +
                                          (string.IsNullOrEmpty(dr[&quot;InventColorId&quot;].ToString2())
                                               ? &quot;&quot;
                                               : (&quot;@&quot; + dr[&quot;InventColorId&quot;].ToString2().ToLower())) +
                                          (string.IsNullOrEmpty(dr[&quot;ConfigId&quot;].ToString2())
                                               ? &quot;&quot;
                                               : (&quot;@&quot; + dr[&quot;ConfigId&quot;].ToString2().ToLower()));
                    foreach (UltraGridRow uwr in uwg.Rows)
                    {
                        string filter = activeRow.Cells.FromKey(&quot;ParentResItemId&quot;).Value.ToString2() +
                                        (string.IsNullOrEmpty(uwr.Cells.FromKey(&quot;Size&quot;).Text)
                                             ? &quot;&quot;
                                             : (&quot;@&quot; + uwr.Cells.FromKey(&quot;Size&quot;).Text.ToLower())) +
                                        (string.IsNullOrEmpty(uwr.Cells.FromKey(&quot;Color&quot;).Text)
                                             ? &quot;&quot;
                                             : (&quot;@&quot; + uwr.Cells.FromKey(&quot;Color&quot;).Text.ToLower())) +
                                        (string.IsNullOrEmpty(uwr.Cells.FromKey(&quot;Configuration&quot;).Text)
                                             ? &quot;&quot;
                                             : (&quot;@&quot; + uwr.Cells.FromKey(&quot;Configuration&quot;).Text.ToLower()));
                        if (filter.Equals(selResItemID))
                        {
                            isDuplicate = true;
                            dt.Rows.RemoveAt(0);
                            continue;
                        }
                    }

                    if (!isDuplicate)
                    {
                        activeRow.Cells.FromKey(&quot;ResItemId&quot;).Value = selResItemID;
                        activeRow.Cells.FromKey(&quot;Size&quot;).Value = dr[&quot;InventSizeId&quot;].ToString2();
                        activeRow.Cells.FromKey(&quot;Color&quot;).Value = dr[&quot;InventColorId&quot;].ToString2();
                        activeRow.Cells.FromKey(&quot;Configuration&quot;).Value = dr[&quot;ConfigId&quot;].ToString2();
                    }
                    else
                    {
                        materialPicker_BackClicked(sender, e);
                        throw new Exception(&quot;Duplicate Resources will not be added.&quot;);
                    }
                }

                materialPicker_BackClicked(sender, e);
            }
            catch (Exception ex)
            {
                throw new Exception(ex.Message);
            }
        }

        public virtual bool AddResourcesToGrid(ItemSelectedEventArgs e)
        {
            DataTable selectedResources = e.SelectedItems;
            if (!selectedResources.Columns.Contains(&quot;ResItemID&quot;))
                selectedResources.Columns.Add(&quot;ResItemID&quot;);
            var gridMaterials = (UltraWebGrid) DetailControls[&quot;ResourceDetails&quot;].FormCtrl;
            var uniqueKeys = new List&lt;string&gt;();
            foreach (UltraGridRow dr in gridMaterials.Rows)
                uniqueKeys.Add(dr.Cells.FromKey(&quot;ResItemID&quot;).ToString2().ToLower2());
            bool isDuplicate = false;

            foreach (UltraGridRow dr in gridMaterials.Rows)
            {
                string filter = &quot;ParentResItemID = &#39;&quot; + dr.Cells.FromKey(&quot;ParentResItemID&quot;).Text.Replace(&quot;&#39;&quot;, &quot;\&#39;&#39;&quot;) +
                                &quot;&#39; and Size=&#39;&quot; +
                                (!string.IsNullOrEmpty(dr.Cells.FromKey(&quot;Size&quot;).Text)
                                     ? dr.Cells.FromKey(&quot;Size&quot;).Text.Replace(&quot;&#39;&quot;, &quot;\&#39;&#39;&quot;)
                                     : &quot;&quot;) +
                                &quot;&#39; and Color=&#39;&quot; +
                                (!string.IsNullOrEmpty(dr.Cells.FromKey(&quot;Color&quot;).Text)
                                     ? dr.Cells.FromKey(&quot;Color&quot;).Text.Replace(&quot;&#39;&quot;, &quot;\&#39;&#39;&quot;)
                                     : &quot;&quot;) +
                                &quot;&#39; and Configuration=&#39;&quot; +
                                (!string.IsNullOrEmpty(dr.Cells.FromKey(&quot;Configuration&quot;).Text)
                                     ? dr.Cells.FromKey(&quot;Configuration&quot;).Text.Replace(&quot;&#39;&quot;, &quot;\&#39;&#39;&quot;)
                                     : &quot;&quot;)
                                + &quot;&#39;&quot;;
                if ((selectedResources.Select(filter)).Length &gt; 0)
                {
                    isDuplicate = true;
                    selectedResources.Rows.Remove((selectedResources.Select(filter))[0]);
                }
            }
            //CHECK FOR DUPLICATE RESOURCES IN THE PICKER
            //for (int i = 0; i &lt; selectedResources.Rows.Count; i++)
            //{
            //   DataRow[] dr = (DataRow[])selectedResources.Select(&quot;ResItemID = &#39;&quot; + selectedResources.Rows[i][&quot;ResItemID&quot;] + &quot;&#39;&quot;);
            //   int rowCount = dr.Length;
            //   int counter = 0;
            //   if (dr.Length &gt; 1)
            //   {
            //       isDuplicate = true;
            //       while (counter &lt; rowCount)
            //       {
            //           selectedResources.Rows.Remove(((DataRow[])selectedResources.Select(&quot;ResItemID = &#39;&quot; + selectedResources.Rows[i][&quot;ResItemID&quot;] + &quot;&#39;&quot;))[0]);
            //           counter++;
            //       }
            //   }                               
            //}

            //foreach (UltraGridRow dr in gridMaterials.Rows)
            //{
            //    resItemIDTemp = dr.Cells.FromKey(&quot;ResItemID&quot;).ToString2().ToLower2();
            //    uniqueKeys.Add(resItemIDTemp);
            //    if (((DataRow[])selectedResources.Select(&quot;ResItemID = &#39;&quot; + resItemIDTemp + &quot;&#39;&quot;)).Length &gt; 0)
            //    {
            //        isDuplicate = true;
            //        selectedResources.Rows.Remove(((DataRow[])selectedResources.Select(&quot;ResItemID = &#39;&quot; + resItemIDTemp + &quot;&#39;&quot;))[0]);
            //    }
            //}
            var currentPage = (Page) (HttpContext.Current.Handler);
            string ERPCompany = currentPage.Session[Constants.EIS_ADDITIONAL_INFO].ToString2();
            int itemID = 0;
            Int32.TryParse((DetailControls[&quot;ItemID&quot;].FormCtrl as TextBox).Text, out itemID);

            foreach (DataRow dr in selectedResources.Rows)
            {
                string strResItemID = dr[&quot;ParentResItemID&quot;].ToString2() +
                                      (string.IsNullOrEmpty(dr[&quot;Size&quot;].ToString2())
                                           ? &quot;&quot;
                                           : (&quot;@&quot; + dr[&quot;Size&quot;].ToString2().ToLower2())) +
                                      (string.IsNullOrEmpty(dr[&quot;Color&quot;].ToString2())
                                           ? &quot;&quot;
                                           : (&quot;@&quot; + dr[&quot;Color&quot;].ToString2().ToLower2())) +
                                      (string.IsNullOrEmpty(dr[&quot;Configuration&quot;].ToString2())
                                           ? &quot;&quot;
                                           : (&quot;@&quot; + dr[&quot;Configuration&quot;].ToString2().ToLower2()));
                var values = new object[19];
                values[0] = false; //Select
                values[1] = 0; //ResourceDetailID
                values[2] = itemID; //ItemID
                values[3] = 3; //ResourceTypeID
                values[4] = &quot;&quot;; // Resource Type name
                values[5] = dr[&quot;Description&quot;].ToString2(); //Description
                values[6] = 0; //UnitID
                values[7] = dr[&quot;Unit&quot;].ToString2(); //Unit
                values[8] = false; //Is Critical
                //APPLY CURRENCY CONVERSION FROM COMPANY CURRENCY TO CONTRACT CURRENCY
                decimal rate = dr[&quot;Rate&quot;].ToDecimal2();
                LocalizationManager.ApplyCurrencyConversion(
                    LocalizationManager.GetModuleCurrency(&quot;LIBRARY&quot;, null, ERPCompany),
                    LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL), ref rate, ERPCompany);
                values[9] = rate.ToString2();
                values[10] = 0; //Quantity
                values[11] = 0; //Cost
                values[12] = &quot;&quot;; //Notes
                values[13] = strResItemID; //ResItemID                
                values[14] = dr[&quot;ParentResItemID&quot;].ToString2(); //ParentResItemID
                values[15] = dr[&quot;Size&quot;].ToString2();
                values[16] = dr[&quot;Color&quot;].ToString2();
                values[17] = dr[&quot;Configuration&quot;].ToString2();
                values[18] = 0; //Cumulative Issued Qty

                var urg = new UltraGridRow(values);
                gridMaterials.Rows.Add(urg);
            }

            if (!gridMaterials.Columns.Exists(&quot;Multi&quot;))
            {
                var ugc = new UltraGridColumn(&quot;Multi&quot;, &quot;Select&quot;, ColumnType.CheckBox, false);
                gridMaterials.Columns.Insert(0, ugc);
                gridMaterials.Columns.FromKey(&quot;Multi&quot;).AllowUpdate = AllowUpdate.Yes;
                gridMaterials.Columns.FromKey(&quot;Multi&quot;).Width = Unit.Percentage(6.5);
            }
            if (gridMaterials.Columns.Exists(&quot;Notes&quot;))
            {
                gridMaterials.Columns.FromKey(&quot;Notes&quot;).AllowUpdate = AllowUpdate.Yes;
                gridMaterials.Columns.FromKey(&quot;Notes&quot;).CellStyle.BackColor = Color.Yellow;
            }
            HideGridColumns(
                new[]
                    {
                        &quot;ResourceDetailID&quot;, &quot;ItemID&quot;, &quot;ResourceTypeID&quot;, &quot;UnitID&quot;, &quot;ResourceTypeName&quot;, &quot;ResItemID&quot;,
                        &quot;MaterialIssueNo&quot;, &quot;WastagePercent&quot;, &quot;WastageQty&quot;, &quot;ReworkQty&quot;, &quot;RegularQty&quot;, &quot;WasteInitialQty&quot;,
                        &quot;WasteAmt&quot;
                    }, gridMaterials);
            gridMaterials.Columns.FromKey(&quot;Quantity&quot;).AllowUpdate = AllowUpdate.Yes;
            gridMaterials.Columns.FromKey(&quot;Quantity&quot;).CellStyle.BackColor = Color.Yellow;
            gridMaterials.Columns.FromKey(&quot;Quantity&quot;).Header.Caption = &quot;Requested Quantity&quot;;
            gridMaterials.Columns.FromKey(&quot;Quantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
            gridMaterials.Columns.FromKey(&quot;Cost&quot;).Format =
                LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) + AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
            gridMaterials.Columns.FromKey(&quot;Rate&quot;).Format =
                LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) + AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
            gridMaterials.Columns.FromKey(&quot;Rate&quot;).Header.Caption = GlobalizationUtility.SetResource(&quot;Rate&quot;, false);
            return isDuplicate;
        }

        // Filter set up for equipment picker.
        private BrixFilter[] GetEquipmentFilters()
        {
            var filters = new BrixFilter[3];

            filters[0] = new BrixFilter();
            filters[0].Title = &quot;Hire Order Item&quot;;
            filters[0].Name = &quot;HireOrderItem&quot;;
            filters[0].FilterType = BrixFilter.Type.Text;

            filters[1] = new BrixFilter();
            filters[1].Title = &quot;Equipment :&quot;;
            filters[1].Name = &quot;Equipment&quot;;
            filters[1].FilterType = BrixFilter.Type.Text;

            filters[2] = new BrixFilter();
            filters[2].Title = &quot;Serial No. /Registration No. :&quot;;
            filters[2].Name = &quot;IdentificationNo&quot;;
            filters[2].FilterType = BrixFilter.Type.Text;

            return filters;
        }

        // Filter set up for equipment picker.
        private BrixFilter[] GetActivityFilters()
        {
            var filters = new BrixFilter[2];

            filters[0] = new BrixFilter();
            filters[0].Title = &quot;Activity name :&quot;;
            filters[0].Name = &quot;ActivityName&quot;;
            filters[0].FilterType = BrixFilter.Type.Text;

            filters[1] = new BrixFilter();
            filters[1].Title = &quot;Description :&quot;;
            filters[1].Name = &quot;Description&quot;;
            filters[1].FilterType = BrixFilter.Type.Text;

            return filters;
        }

        private BrixFilter[] GetFilters()
        {
            var filters = new BrixFilter[2];

            filters[0] = new BrixFilter();
            filters[0].Title = &quot;Resource ID :&quot;;
            filters[0].Name = &quot;ParentResItemID&quot;;
            filters[0].FilterType = BrixFilter.Type.Text;

            filters[1] = new BrixFilter();
            filters[1].Title = &quot;Description :&quot;;
            filters[1].Name = &quot;Description&quot;;
            filters[1].FilterType = BrixFilter.Type.Text;

            return filters;
        }

        protected virtual void GetDetailDataByItem(Item stdItem)
        {
            try
            {
                var dt = new DataTable();
                //Fill Resource Grid
                dt =
                    ItemManager.Instance.GetRateAnalysis(ParentModuleID, ParentInstanceID, (int) stdItem.ItemID).Tables[
                        1];
                DataSet qtyDataSet = MATRISSBL.Instance.GetItemQuantity((int) stdItem.ItemID,
                                                                        Request.Form[MasterControls[&quot;WorkOrderNo&quot;]] !=
                                                                        &quot;0&quot; &amp;&amp;
                                                                        Request.Form[MasterControls[&quot;WorkOrderNo&quot;]] !=
                                                                        null &amp;&amp;
                                                                        Request.Form[MasterControls[&quot;WorkOrderNo&quot;]] !=
                                                                        &quot;NA&quot;
                                                                            ? Int32.Parse(
                                                                                Request.Form[
                                                                                    MasterControls[&quot;WorkOrderNo&quot;]])
                                                                            : 0);

                if (dt.Columns.Contains(&quot;Contractor&quot;))
                    dt.Columns.Remove(&quot;Contractor&quot;);
                if (dt.Columns.Contains(&quot;TradeAgmtCurrency&quot;))
                    dt.Columns.Remove(&quot;TradeAgmtCurrency&quot;);
                for (int count = dt.Columns.Count - 1; count &gt;= 0; count--)
                {
                    if (!(RelevantColumns.Contains(dt.Columns[count].ColumnName)))
                    {
                        dt.Columns.Remove(dt.Columns[count]);
                    }
                }

                var dc = new DataColumn(&quot;EstimatedQuantity&quot;, typeof (decimal));
                dt.Columns.Add(dc);
                foreach (DataRow row in dt.Rows)
                {
                    DataRow[] selectedRows =
                        qtyDataSet.Tables[0].Select(&quot;ResourceID= &#39;&quot; + row[&quot;ResItemID&quot;].ToString().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) +
                                                    &quot;&#39;&quot;);
                    if (selectedRows.Length &gt; 0)
                        row[&quot;EstimatedQuantity&quot;] = decimal.Parse(selectedRows[0][&quot;EstimatedQuantity&quot;].ToString());
                    row[&quot;Quantity&quot;] = decimal.Parse(row[&quot;Quantity&quot;].ToString())*stdItem.Quantity;
                    row[&quot;Cost&quot;] = decimal.Parse(row[&quot;Quantity&quot;].ToString())*decimal.Parse(row[&quot;Rate&quot;].ToString());
                }
                DataRow[] materialRows;
                materialRows = dt.Select(&quot;ResourceTypeName &lt;&gt; &#39;Material&#39;&quot;);
                foreach (DataRow row in materialRows)
                    dt.Rows.Remove(row);

                if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX))
                {
                    string AXCompany = ((Page) HttpContext.Current.Handler).Session[Constants.EIS_ADDITIONAL_INFO] ==
                                       null
                                           ? string.Empty
                                           : ((Page) HttpContext.Current.Handler).Session[Constants.EIS_ADDITIONAL_INFO]
                                                 .ToString2();

                    DataTable dtMap =
                        IntegrationConnectorManager.Instance.GetERPObjectMapInfo(ParentInstanceID.ToString2(),
                                                                                 AMP3Object.CONTMGT, null,
                                                                                 AMP3Object.UNKNOWN, RegisteredEIS.AX);
                    DataSet DsResult = new BrixDataSet();

                    if (dtMap.Rows.Count &gt; 0)
                    {
                        string Filter = &quot;&lt;XMLRoot&gt;&lt;ProjId type=&#39;txt&#39;&gt;&quot; + dtMap.Rows[0][&quot;ERPId&quot;].ToString2() +
                                        &quot;&lt;/ProjId&gt;&lt;/XMLRoot&gt;&quot;;
                        var AdditionalInfo = new EISAdditionalInfo(RegisteredEIS.AX);
                        AdditionalInfo.AddInfo(&quot;AXCompany&quot;, AXCompany);
                        var dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
                        dictAdditionalInfo.Add(RegisteredEIS.AX, AdditionalInfo);

                        //GET MATERIALS FROM AX BASED ON WAREHOUSE
                        var connectorParameters = new ConnectorParameters(dictAdditionalInfo,
                                                                          MethodBase.GetCurrentMethod(),
                                                                          AMP3ObjectType.Unknown,
                                                                          new ConnectionFilter(Filter, null, null, null,
                                                                                               null), null);
                        int count = 0;
                        IntegrationConnectorManager.HandleIntegration(connectorParameters, ref count, ref DsResult, true);
                    }
                    var dtTemp = new DataTable();
                    dtTemp = dt;
                    if (dt.Rows.Count &gt; 0)
                    {
                        for (int i = dtTemp.Rows.Count - 1; i &gt;= 0; i--)
                        {
                            DataRow dr = dtTemp.Rows[i];
                            if (DsResult.Tables[0].Select(&quot;ParentResItemID = &#39;&quot; +
                                                          dr[&quot;ParentResItemID&quot;].ToString2().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;)
                                                          + &quot;&#39; AND Size = &#39;&quot; + dr[&quot;Size&quot;].ToString2().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) +
                                                          &quot;&#39; AND Color = &#39;&quot;
                                                          + dr[&quot;Color&quot;].ToString2().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) +
                                                          &quot;&#39; AND Configuration = &#39;&quot;
                                                          + dr[&quot;Configuration&quot;].ToString2().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) + &quot;&#39;&quot;).
                                    Length == 0)
                                dt.Rows.Remove(dr);
                        }
                    }
                }

                var uwg = (DetailControls[&quot;ResourceDetails&quot;].FormCtrl as UltraWebGrid);
                uwg.DataSource = dt;
                uwg.DataBind();
                if (!uwg.Columns.Exists(&quot;Multi&quot;))
                {
                    var ugc = new UltraGridColumn(&quot;Multi&quot;, &quot;Select&quot;, ColumnType.CheckBox, false);
                    (DetailControls[&quot;ResourceDetails&quot;].FormCtrl as UltraWebGrid).Columns.Insert(0, ugc);
                    (DetailControls[&quot;ResourceDetails&quot;].FormCtrl as UltraWebGrid).Columns.FromKey(&quot;Multi&quot;).AllowUpdate =
                        AllowUpdate.Yes;
                    (DetailControls[&quot;ResourceDetails&quot;].FormCtrl as UltraWebGrid).Columns.FromKey(&quot;Multi&quot;).Width =
                        Unit.Percentage(6.5);
                }
                HideGridColumns(
                    new[]
                        {
                            &quot;ModuleID&quot;, &quot;ParentInstanceID&quot;, &quot;ResourceDetailID&quot;, &quot;ItemID&quot;, &quot;ResourceTypeID&quot;, &quot;UnitID&quot;,
                            &quot;ResItemID&quot;, &quot;ResourceTypeName&quot;, &quot;MaterialIssueNo&quot;, &quot;Vendor Name&quot;, &quot;Vendor Cost&quot;, &quot;Vendor Rate&quot;
                            , &quot;WastagePercent&quot;, &quot;WastageQty&quot;, &quot;ReworkQty&quot;, &quot;RegularQty&quot;, &quot;WasteInitialQty&quot;, &quot;WasteAmt&quot;
                        },
                    uwg);
                if (uwg.Columns.Exists(&quot;Notes&quot;))
                {
                    uwg.Columns.FromKey(&quot;Notes&quot;).AllowUpdate = AllowUpdate.Yes;
                    uwg.Columns.FromKey(&quot;Notes&quot;).CellStyle.BackColor = Color.Yellow;
                }
                uwg.Columns.FromKey(&quot;Quantity&quot;).AllowUpdate = AllowUpdate.Yes;
                uwg.Columns.FromKey(&quot;Quantity&quot;).CellStyle.BackColor = Color.Yellow;
                uwg.Columns.FromKey(&quot;Quantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                if (uwg.Columns.Exists(&quot;EstimatedQuantity&quot;))
                {
                    uwg.Columns.FromKey(&quot;EstimatedQuantity&quot;).CellStyle.BackColor = Color.LightGray;
                    uwg.Columns.FromKey(&quot;EstimatedQuantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                    uwg.Columns.FromKey(&quot;EstimatedQuantity&quot;).Header.Caption = &quot;Estimated Quantity&quot;;
                }
                uwg.Columns.FromKey(&quot;Cost&quot;).Format = LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) +
                                                     AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                uwg.Columns.FromKey(&quot;Rate&quot;).Format = LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) +
                                                     AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                if (uwg.Columns.FromKey(&quot;IsCritical&quot;) != null)
                    uwg.Columns.FromKey(&quot;IsCritical&quot;).Header.Caption = &quot;Is Critical&quot;;
                if (uwg.Columns.FromKey(&quot;ResourceTypeName&quot;) != null)
                    uwg.Columns.FromKey(&quot;ResourceTypeName&quot;).Header.Caption = &quot;Resource Type Name&quot;;
                if (uwg.Columns.FromKey(&quot;ResItemID&quot;) != null)
                    uwg.Columns.FromKey(&quot;ResItemID&quot;).Header.Caption = &quot;Resource Item ID&quot;;
                if (uwg.Columns.FromKey(&quot;ParentResItemID&quot;) != null)
                    uwg.Columns.FromKey(&quot;ParentResItemID&quot;).Header.Caption = &quot;Resource ID&quot;;
                uwg.Columns.FromKey(&quot;Rate&quot;).Header.Caption = GlobalizationUtility.SetResource(&quot;Rate&quot;, false);

                //Fill the Item TextBox
                (DetailControls[&quot;Item&quot;].FormCtrl as TextBox).Text = &quot;LineNo : &quot; + stdItem.LineNo + &quot;\r\nStdItemNo : &quot; +
                                                                    stdItem.StandardItemNo + &quot;\r\nDesrctiption : &quot; +
                                                                    stdItem.Description;

                //Populate Sub Item
                //DataTable subItems = ItemManager.Instance.GetSubItemData(&quot;CONTMGT&quot;, this.ParentInstanceID, (int)stdItem.ItemID).Tables[0];
                //(DetailControls[&quot;Sub Item&quot;].FormCtrl as DropDownList).Enabled = (subItems.Rows.Count &gt; 0);
                //(DetailControls[&quot;Sub Item&quot;].FormCtrl as DropDownList).DataSource = subItems;
                //(DetailControls[&quot;Sub Item&quot;].FormCtrl as DropDownList).DataTextField = &quot;Description&quot;;
                //(DetailControls[&quot;Sub Item&quot;].FormCtrl as DropDownList).DataValueField = &quot;SubItemID&quot;;
                //(DetailControls[&quot;Sub Item&quot;].FormCtrl as DropDownList).DataBind();
                //(DetailControls[&quot;Sub Item&quot;].FormCtrl as DropDownList).Width = Unit.Pixel(175);
            }
            catch (Exception ex)
            {
                throw new Exception(ex.Message);
            }
        }

        private void AppendPEDetails(DataTable dtResource, DataTable dtPEDetails)
        {
            var dc = new DataColumn(&quot;Recovered Qty&quot;, typeof (decimal));
            dtResource.Columns.Add(dc);
            dc = new DataColumn(&quot;Recovered Amount&quot;, typeof (decimal));
            dtResource.Columns.Add(dc);
            foreach (DataRow row in dtResource.Rows)
            {
                DataRow[] rowcol = dtPEDetails.Select(&quot;ResourceDetailId=&quot; + row[&quot;ResourceDetailID&quot;]);
                if (rowcol.Length &gt; 0)
                {
                    row[&quot;Recovered Qty&quot;] = Decimal.Parse(rowcol[0][&quot;Recovered Qty&quot;].ToString2(),
                                                         CultureInfo.CurrentCulture);
                    row[&quot;Recovered Amount&quot;] = Decimal.Parse(rowcol[0][&quot;Recovered Amount&quot;].ToString2(),
                                                            CultureInfo.CurrentCulture);
                }
                else
                {
                    row[&quot;Recovered Qty&quot;] = 0;
                    row[&quot;Recovered Amount&quot;] = 0;
                }
            }
        }

        public override object GetPopUpDetails(int resourceDetailId)
        {
            return MATRISSBL.Instance.GetPEMIDetails(InstanceID, resourceDetailId).Tables[0];
        }

        private void ValidateContractorType()
        {
            if (MasterRow != null &amp;&amp;
                (DetailControls[&quot;ContractorType&quot;].FormCtrl as RadioButtonList).SelectedValue !=
                MasterRow[&quot;ContractorType&quot;].ToString2())
            {
                //DeleteResourcesFromGrid(1);
                if (status != &quot;Draft&quot;)
                {
                    //(DetailControls[&quot;Status&quot;].FormCtrl as DropDownList).ClearSelection();
                    //(DetailControls[&quot;Status&quot;].FormCtrl as DropDownList).Items.FindByText(&quot;Draft&quot;).Selected = true;
                    (DetailControls[&quot;Add Materials&quot;].FormCtrl as Button).Visible = true;
                    (DetailControls[&quot;Delete Resource&quot;].FormCtrl as Button).Visible = true;
                }
            }
        }

        private void CheckForEquipmentHireOrder()
        {
            if (dtFiltered != null)
            {
                foreach (DataRow drWorkOrder in dtFiltered.Rows)
                {
                    //Checking for the Work Order in the query with the selected work order in the dropdown list and for the Hire Order
                    if (drWorkOrder[&quot;WorkOrderID&quot;].ToString() ==
                        (DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).SelectedValue
                        &amp;&amp; drWorkOrder[&quot;WorkOrderType&quot;].ToString() == &quot;E&quot;)
                    {
                        (ColumnGroups[&quot;Equipment&quot;].HtmlTblRow).Style.Value =
                            (ColumnGroups[&quot;IdentificationNo&quot;].HtmlTblRow).Style.Value = &quot;display:block&quot;;
                        (ColumnGroups[&quot;Item&quot;].HtmlTblRow).Style.Value = &quot;display:none&quot;;
                        (DetailControls[&quot;PickEquipment&quot;].FormCtrl as Button).Visible = true;
                        (DetailControls[&quot;Add Materials&quot;].FormCtrl as Button).Visible = true;
                        (DetailControls[&quot;Inventory Dimensions&quot;].FormCtrl as Button).Visible = true;
                        break;
                    }
                    else if (drWorkOrder[&quot;WorkOrderID&quot;].ToString() ==
                             (DetailControls[&quot;WorkOrderNo&quot;].FormCtrl as DropDownList).SelectedValue
                             &amp;&amp; drWorkOrder[&quot;WorkOrderType&quot;].ToString() == &quot;A&quot;)
                    {
                        (ColumnGroups[&quot;Item&quot;].HtmlTblRow).Style.Value = &quot;display:none&quot;;
                        (ColumnGroups[&quot;Activity&quot;].HtmlTblRow).Style.Value = &quot;display:block&quot;;
                        (DetailControls[&quot;Add Materials&quot;].FormCtrl as Button).Visible = true;
                        (DetailControls[&quot;Inventory Dimensions&quot;].FormCtrl as Button).Visible = true;
                        break;
                    }
                    else
                    {
                        (ColumnGroups[&quot;Activity&quot;].HtmlTblRow).Style.Value =
                            (ColumnGroups[&quot;Equipment&quot;].HtmlTblRow).Style.Value =
                            (ColumnGroups[&quot;IdentificationNo&quot;].HtmlTblRow).Style.Value = &quot;display:none&quot;;
                        if (MIWithBOQ) (ColumnGroups[&quot;Item&quot;].HtmlTblRow).Style.Value = &quot;display:block&quot;;
                    }
                }
            }
        }

        private bool ValidateResourceForAXDimensions(string parentResItemId, string size, string color,
                                                     string configuration)
        {
            string validate = &quot;&quot;;
            if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX))
            {
                string AXCompany = ((Page) HttpContext.Current.Handler).Session[Constants.EIS_ADDITIONAL_INFO] == null
                                       ? string.Empty
                                       : ((Page) HttpContext.Current.Handler).Session[Constants.EIS_ADDITIONAL_INFO].
                                             ToString();
                validate = ItemManager.Instance.ValidateInventoryDimensions(AXCompany, parentResItemId, size, color,
                                                                            configuration);
                if (string.IsNullOrEmpty(validate))
                    return true;
                else
                    return false;
            }
            else
                return true;
        }

        public override void CancelHandler(object sender, bool bAfterSave, out string sRedirectTo)
        {
            base.CancelHandler(sender, bAfterSave, out sRedirectTo);
        }

        public override string PostSaveRedirectUrl(string sSavedToken = &quot;&quot;)
        {
            return ReturnUrl();
        }
    }

    [CustomResourceType(&quot;Forms&quot;, &quot;XMATISS&quot;)]
    public class PerformMIOperations : FormsCustomResource
    {
        public PerformMIOperations()
        {
            _Namespace = &quot;Forms&quot;;
            _Path = &quot;Forms.Contract.MI&quot;;
            _Name = &quot;PerformMIIOperations&quot;;
            _Desc = &quot;Perform Material Issue Operations&quot;;

            _InParameters = new[] {&quot;Operation,System.String&quot;};
            _OutParameters = new[] {&quot;IsSuccessful,System.Boolean&quot;, &quot;Reason,System.String&quot;};
        }

        private bool IsERPConnected
        {
            get { return IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX); }
        }

        public override void ExecuteDerived()
        {
            int currentuserid = GetInputParam(&quot;_currentuserid&quot;).ToInt32_2();
            string operation = GetInputParam(&quot;Operation&quot;).ToString();
            string company = GetInputParam(&quot;Company&quot;).ToString();
            try
            {
                switch (operation.ToUpper())
                {
                    case &quot;COMPLETE&quot;:
                        MIComplete(currentuserid);
                        break;
                    case &quot;SUBMIT&quot;:
                        MISubmit(currentuserid);
                        break;
                    case &quot;APPROVE&quot;:
                        MIApprove(currentuserid, company);
                        break;
                    case &quot;REJECT&quot;:
                        MIReject();
                        break;
                }
            }
            catch (Exception ex)
            {
                SetOutParam(&quot;IsSuccessful&quot;, false, &quot;System.Boolean&quot;);
                SetOutParam(&quot;Reason&quot;, ex.Message, &quot;System.string&quot;);
                throw ex;
            }
        }

        private void MIComplete(int currentuserid)
        {
            string RegID = InstanceId;
            string result = MATRISSBL.Instance.ApproveMaterialIssue(RegID.ToInt32_2(), 1, currentuserid, DateTime.UtcNow,
                                                                    &quot;C&quot;);
            if (result == &quot;Complete Successful&quot;)
                SetOutParam(&quot;IsSuccessful&quot;, true, &quot;System.Boolean&quot;);
            else
                SetOutParam(&quot;IsSuccessful&quot;, false, &quot;System.Boolean&quot;);
        }

        private void MISubmit(int currentuserid)
        {
            string RegID = InstanceId;
            string result = MATRISSBL.Instance.ApproveMaterialIssue(RegID.ToInt32_2(), 1, currentuserid, DateTime.UtcNow,
                                                                    &quot;S&quot;);
            if (result == &quot;Submit Successful&quot;)
                SetOutParam(&quot;IsSuccessful&quot;, true, &quot;System.Boolean&quot;);
            else
                SetOutParam(&quot;IsSuccessful&quot;, false, &quot;System.Boolean&quot;);
        }

        private void MIApprove(int currentuserid, string mappedCompany)
        {
            string RegID = InstanceId;
            string result = MATRISSBL.Instance.ApproveMaterialIssue(RegID.ToInt32_2(), 1, currentuserid, DateTime.UtcNow,
                                                                    &quot;A&quot;);
            if (result == &quot;Approve Successful&quot;)
            {
                if (IsERPConnected)
                {
                    DataTable dt = MATRISSBL.Instance.GetMIContractProjectDetails(InstanceId.ToInt32_2());
                    if (dt.Rows.Count &gt; 0)
                    {
                        var objAdditionalInfo = new EISAdditionalInfo(RegisteredEIS.AX);
                        objAdditionalInfo.AddInfo(Constants.EIS_ADDITIONAL_INFO, mappedCompany);
                        var listMod = new EISMIListModel();
                        listMod.ContractID = dt.Rows[0][&quot;ContractID&quot;].ToInt32_2();
                        listMod.ProjectID = dt.Rows[0][&quot;ProjectID&quot;].ToInt32_2();
                        listMod.PMode = dt.Rows[0][&quot;ProjectMode&quot;].ToString2();
                        listMod.MIID = InstanceId;
                        listMod.AXCompany = objAdditionalInfo;
                        listMod.HandleApprove();
                    }
                }
                SetOutParam(&quot;IsSuccessful&quot;, true, &quot;System.Boolean&quot;);
            }
            else
            {
                SetOutParam(&quot;IsSuccessful&quot;, false, &quot;System.Boolean&quot;);
                SetOutParam(&quot;Reason&quot;, result, &quot;System.string&quot;);
            }
        }


        private void MIReject()
        {
            string RegID = InstanceId;
            string result = MATRISSBL.Instance.UnapproveMaterialIssue(RegID.ToInt32_2(), &#39;R&#39;);
            if (string.IsNullOrEmpty(result))
                SetOutParam(&quot;IsSuccessful&quot;, true, &quot;System.Boolean&quot;);
            else
            {
                SetOutParam(&quot;IsSuccessful&quot;, false, &quot;System.Boolean&quot;);
                SetOutParam(&quot;Reason&quot;, result, &quot;System.string&quot;);
            }
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[39,9,39,38,0],[41,9,41,41,0],[49,17,49,18,0],[49,19,49,121,0],[49,122,49,123,0],[58,13,58,14,0],[59,17,59,72,0],[60,17,60,80,0],[61,13,61,14,0],[70,13,70,14,0],[71,17,71,72,0],[72,17,72,76,0],[73,13,73,14,0],[79,13,79,14,0],[80,17,83,42,0],[84,13,84,14,0],[89,17,89,18,0],[89,19,89,56,0],[89,57,89,58,0],[94,17,94,18,0],[94,19,94,74,0],[94,75,94,76,0],[99,17,99,18,0],[99,19,99,36,0],[99,37,99,38,0],[104,17,104,18,0],[104,19,104,45,0],[104,46,104,47,0],[109,17,109,18,0],[109,19,109,53,0],[109,54,109,55,0],[114,17,114,18,0],[114,19,114,43,0],[114,44,114,45,0],[119,17,119,18,0],[119,19,119,38,0],[119,39,119,40,0],[124,9,124,10,0],[125,13,126,95,0],[127,9,127,10,0],[130,9,130,10,0],[131,13,131,76,0],[132,13,132,35,0],[133,13,134,95,0],[135,17,135,35,0],[136,13,136,42,0],[138,13,138,93,0],[139,13,139,53,0],[140,17,140,80,0],[142,13,142,28,0],[143,13,143,14,0],[144,17,144,80,0],[145,13,145,14,0],[148,13,148,32,0],[149,9,149,10,0],[152,9,152,10,0],[153,13,155,44,0],[157,13,157,94,0],[158,13,158,14,0],[159,17,159,73,0],[160,17,160,46,0],[162,13,162,114,0],[163,13,163,14,0],[164,17,164,115,0],[165,17,165,18,0],[166,21,166,90,0],[167,21,167,50,0],[169,17,170,73,0],[171,17,171,18,0],[172,21,172,93,0],[173,21,173,50,0],[175,13,175,14,0],[176,13,176,29,0],[177,13,179,82,0],[180,13,180,14,0],[181,17,181,68,0],[182,17,182,46,0],[185,13,185,20,0],[185,22,185,38,0],[185,39,185,41,0],[185,42,185,107,0],[186,13,186,14,0],[187,17,187,96,0],[188,17,190,87,0],[191,17,193,89,0],[194,17,196,105,0],[197,17,197,78,0],[198,21,198,61,0],[199,17,199,96,0],[202,17,202,120,0],[203,17,203,18,0],[204,21,204,68,0],[205,21,205,50,0],[207,22,208,40,0],[209,17,209,18,0],[210,21,210,90,0],[211,21,211,50,0],[214,17,214,118,0],[215,17,215,18,0],[216,21,216,103,0],[217,21,217,22,0],[218,25,219,51,0],[220,25,220,54,0],[222,17,222,18,0],[223,13,223,14,0],[225,13,225,35,0],[226,13,226,14,0],[227,17,227,24,0],[227,26,227,42,0],[227,43,227,45,0],[227,46,227,111,0],[228,17,228,18,0],[229,21,229,82,0],[230,21,230,22,0],[231,25,231,69,0],[232,25,232,54,0],[234,21,234,115,0],[235,21,235,22,0],[236,25,236,71,0],[237,25,237,54,0],[239,21,239,91,0],[240,21,240,22,0],[241,25,243,37,0],[244,25,244,26,0],[245,29,245,74,0],[246,29,246,58,0],[248,25,249,107,0],[250,25,250,26,0],[251,29,251,101,0],[252,29,252,58,0],[254,25,254,37,0],[255,21,255,22,0],[256,17,256,18,0],[257,17,257,34,0],[258,17,258,18,0],[259,21,259,66,0],[260,21,260,50,0],[262,13,262,14,0],[264,13,264,116,0],[265,13,265,14,0],[266,17,266,97,0],[267,17,270,35,0],[272,17,272,88,0],[273,17,273,33,0],[274,17,274,33,0],[275,17,275,24,0],[275,26,275,42,0],[275,43,275,45,0],[275,46,275,54,0],[276,17,276,18,0],[277,21,279,111,0],[280,21,280,120,0],[281,17,281,18,0],[282,17,282,39,0],[283,17,283,18,0],[284,21,284,86,0],[285,21,285,50,0],[287,13,287,14,0],[289,13,289,119,0],[290,13,290,76,0],[291,13,291,20,0],[291,22,291,34,0],[291,35,291,37,0],[291,38,291,60,0],[292,13,292,14,0],[293,17,293,42,0],[294,13,294,14,0],[296,13,296,28,0],[297,13,297,93,0],[300,13,300,71,0],[301,13,301,29,0],[302,13,302,14,0],[303,17,303,44,0],[304,17,304,48,0],[305,17,305,48,0],[306,17,306,38,0],[307,17,307,38,0],[308,17,308,37,0],[309,17,309,52,0],[310,17,310,56,0],[311,17,311,72,0],[312,17,312,41,0],[313,17,313,40,0],[314,17,314,40,0],[315,17,315,74,0],[316,13,316,14,0],[318,13,318,38,0],[319,13,319,113,0],[320,13,320,32,0],[321,13,321,101,0],[322,13,322,109,0],[324,13,324,31,0],[325,13,325,14,0],[326,17,326,47,0],[327,17,327,46,0],[329,13,329,50,0],[330,13,330,41,0],[331,13,331,55,0],[332,9,332,10,0],[336,9,336,10,0],[337,13,367,19,0],[368,13,368,23,0],[369,9,369,10,0],[372,9,372,10,0],[373,13,373,74,0],[374,13,374,56,0],[375,13,375,51,0],[376,13,376,58,0],[377,13,377,58,0],[378,13,378,50,0],[379,13,379,52,0],[380,13,380,46,0],[381,13,381,14,0],[382,17,382,72,0],[383,17,383,18,0],[384,21,384,91,0],[385,21,385,105,0],[386,21,386,105,0],[387,17,387,18,0],[388,17,388,72,0],[389,17,389,18,0],[390,21,390,89,0],[391,21,391,93,0],[392,17,392,18,0],[393,17,393,123,0],[394,17,396,40,0],[397,17,399,83,0],[400,17,400,50,0],[402,17,404,74,0],[405,21,405,35,0],[406,22,406,87,0],[407,17,407,18,0],[408,21,408,86,0],[409,25,409,42,0],[416,17,416,18,0],[418,17,418,58,0],[419,13,419,14,0],[421,13,421,33,0],[422,9,422,10,0],[425,9,425,10,0],[426,13,426,28,0],[427,13,427,93,0],[428,13,428,47,0],[429,13,429,115,0],[430,18,430,54,0],[430,56,430,66,0],[430,68,430,75,0],[431,13,431,14,0],[432,17,432,83,0],[433,17,433,18,0],[434,21,434,66,0],[435,17,435,18,0],[436,13,436,14,0],[437,13,437,84,0],[439,13,439,35,0],[440,13,440,14,0],[441,17,447,82,0],[448,17,448,81,0],[449,17,449,42,0],[450,17,450,24,0],[450,26,450,37,0],[450,38,450,40,0],[450,41,450,52,0],[451,17,451,18,0],[452,21,453,125,0],[454,21,454,49,0],[455,25,455,115,0],[456,17,456,18,0],[458,17,462,99,0],[463,17,463,18,0],[464,21,464,54,0],[465,21,465,103,0],[466,21,466,31,0],[467,21,467,82,0],[468,21,468,44,0],[469,21,469,65,0],[470,21,470,22,0],[471,25,471,32,0],[471,34,471,44,0],[471,45,471,47,0],[471,48,471,63,0],[472,25,472,26,0],[473,29,473,126,0],[474,29,474,30,0],[475,33,477,73,0],[478,33,478,34,0],[479,37,482,115,0],[483,33,483,34,0],[484,33,484,37,0],[485,29,485,30,0],[486,25,486,26,0],[487,21,487,22,0],[488,26,488,48,0],[489,25,489,32,0],[489,34,489,45,0],[489,46,489,48,0],[489,49,489,60,0],[490,29,490,83,0],[491,21,491,94,0],[492,21,492,51,0],[493,21,493,45,0],[494,21,494,36,0],[495,21,495,43,0],[496,21,496,22,0],[497,25,497,84,0],[498,25,498,89,0],[499,25,499,95,0],[500,25,500,100,0],[501,25,501,102,0],[502,21,502,22,0],[503,21,503,119,0],[504,21,504,64,0],[505,21,505,22,0],[506,25,506,103,0],[507,25,507,121,0],[508,21,508,22,0],[509,21,509,65,0],[510,21,510,22,0],[511,25,511,104,0],[512,25,512,124,0],[513,25,513,104,0],[514,21,514,22,0],[515,21,515,61,0],[516,21,516,22,0],[517,25,517,100,0],[518,25,518,120,0],[519,21,519,22,0],[520,17,520,18,0],[523,17,523,18,0],[524,21,524,43,0],[525,21,525,22,0],[526,25,537,56,0],[538,25,538,75,0],[539,25,539,26,0],[540,29,540,93,0],[541,29,541,54,0],[542,25,542,26,0],[543,25,543,32,0],[543,34,543,45,0],[543,46,543,48,0],[543,49,543,60,0],[544,25,544,26,0],[545,29,547,61,0],[548,29,548,57,0],[549,33,549,123,0],[550,25,550,26,0],[552,25,552,49,0],[553,25,553,40,0],[554,25,554,58,0],[555,25,555,26,0],[556,29,556,106,0],[557,29,557,56,0],[558,29,558,88,0],[559,29,559,87,0],[560,25,560,26,0],[561,25,561,69,0],[562,25,562,26,0],[563,29,563,108,0],[564,29,564,128,0],[565,29,565,108,0],[566,25,566,26,0],[567,21,567,22,0],[568,17,568,18,0],[569,17,569,67,0],[570,17,570,18,0],[571,21,571,80,0],[572,21,572,85,0],[573,21,573,83,0],[574,21,574,88,0],[575,17,575,18,0],[576,17,582,29,0],[583,17,583,107,0],[584,17,584,87,0],[585,17,586,101,0],[587,17,588,101,0],[589,17,589,63,0],[590,21,590,86,0],[591,17,591,68,0],[592,21,592,91,0],[595,17,595,110,0],[596,13,596,14,0],[597,17,597,29,0],[598,9,598,10,0],[601,9,601,10,0],[602,13,602,31,0],[605,21,605,57,0],[606,21,607,112,0],[608,21,608,84,0],[609,21,609,28,0],[609,30,609,42,0],[609,43,609,45,0],[609,46,609,68,0],[610,21,610,22,0],[611,25,611,50,0],[612,21,612,22,0],[613,21,613,48,0],[614,21,614,54,0],[615,21,615,60,0],[616,21,616,39,0],[617,21,617,79,0],[618,21,618,48,0],[619,21,621,47,0],[622,21,622,27,0],[624,21,624,56,0],[625,21,625,73,0],[626,21,628,47,0],[629,21,629,27,0],[644,21,644,63,0],[645,21,645,62,0],[646,21,646,61,0],[647,21,647,58,0],[648,21,648,58,0],[649,21,649,27,0],[651,21,651,114,0],[652,21,652,27,0],[658,9,658,10,0],[661,9,661,10,0],[662,13,662,31,0],[665,21,665,66,0],[666,21,666,58,0],[667,21,667,85,0],[668,21,668,88,0],[670,21,670,61,0],[671,21,671,58,0],[673,21,673,82,0],[674,21,674,27,0],[676,21,676,73,0],[677,21,677,61,0],[678,21,678,27,0],[680,21,680,73,0],[681,21,681,61,0],[682,21,682,27,0],[684,21,684,74,0],[685,21,685,63,0],[686,21,686,27,0],[688,21,688,75,0],[689,21,689,65,0],[690,21,690,27,0],[692,9,692,10,0],[696,9,696,10,0],[697,13,697,107,0],[698,13,698,42,0],[699,13,699,93,0],[700,13,700,35,0],[701,13,701,81,0],[702,13,702,88,0],[703,9,703,10,0],[706,9,706,10,0],[707,13,707,35,0],[708,9,708,10,0],[711,9,711,10,0],[712,13,712,66,0],[713,13,713,47,0],[714,13,714,49,0],[715,13,715,56,0],[716,13,716,83,0],[717,13,717,51,0],[718,13,718,72,0],[719,13,719,70,0],[720,13,720,64,0],[721,13,721,65,0],[723,13,723,68,0],[724,13,727,85,0],[728,9,728,10,0],[731,9,731,10,0],[732,13,732,57,0],[733,13,733,49,0],[734,13,734,51,0],[735,13,735,59,0],[736,13,736,85,0],[737,13,737,63,0],[738,13,738,76,0],[739,13,739,72,0],[740,13,740,68,0],[744,13,744,68,0],[745,13,748,96,0],[749,9,749,10,0],[752,9,752,10,0],[753,13,753,45,0],[755,13,755,43,0],[756,13,756,41,0],[757,13,757,38,0],[758,13,758,58,0],[760,13,760,43,0],[761,13,761,42,0],[762,13,762,39,0],[763,13,763,58,0],[765,13,765,43,0],[766,13,766,50,0],[767,13,767,47,0],[768,13,768,58,0],[770,13,770,28,0],[771,9,771,10,0],[774,9,774,10,0],[775,13,775,65,0],[776,13,776,48,0],[777,13,777,50,0],[778,13,778,58,0],[779,13,779,84,0],[780,13,780,61,0],[781,13,781,74,0],[782,13,782,71,0],[783,13,783,66,0],[786,13,786,67,0],[789,13,789,68,0],[790,13,793,95,0],[794,9,794,10,0],[797,9,797,10,0],[798,13,798,61,0],[799,13,799,47,0],[800,13,800,49,0],[801,13,801,56,0],[802,13,802,83,0],[803,13,803,59,0],[804,13,804,72,0],[805,13,805,70,0],[806,13,806,64,0],[807,13,807,65,0],[809,13,809,68,0],[810,13,813,85,0],[814,9,814,10,0],[817,9,817,10,0],[818,13,824,94,0],[825,13,830,107,0],[831,13,831,86,0],[833,13,833,36,0],[834,13,834,14,0],[835,17,835,104,0],[836,17,836,101,0],[837,17,837,120,0],[838,17,839,109,0],[840,17,840,117,0],[841,17,841,18,0],[843,17,843,35,0],[844,17,844,18,0],[845,21,845,106,0],[846,21,846,103,0],[847,17,847,18,0],[848,13,848,14,0],[849,18,849,41,0],[850,13,850,14,0],[851,17,851,104,0],[852,17,853,110,0],[854,17,854,101,0],[855,17,855,18,0],[857,17,857,35,0],[858,17,858,18,0],[859,21,859,113,0],[860,21,860,110,0],[861,17,861,18,0],[862,13,862,14,0],[865,13,867,92,0],[868,13,868,86,0],[869,13,869,80,0],[870,13,870,76,0],[872,13,872,73,0],[873,17,873,84,0],[878,13,878,93,0],[879,13,879,53,0],[880,17,880,80,0],[882,13,882,89,0],[883,13,883,14,0],[884,17,884,93,0],[885,17,885,31,0],[886,21,886,90,0],[887,13,887,14,0],[890,13,891,89,0],[892,17,892,86,0],[893,18,894,100,0],[895,17,895,86,0],[896,18,897,90,0],[898,17,898,86,0],[902,13,903,96,0],[904,17,904,46,0],[907,13,907,104,0],[908,13,910,83,0],[911,13,911,120,0],[912,13,913,84,0],[914,13,914,103,0],[915,13,915,102,0],[916,13,916,96,0],[918,13,918,35,0],[919,13,919,14,0],[920,17,921,68,0],[922,17,922,18,0],[923,21,923,34,0],[924,21,926,75,0],[927,21,927,22,0],[928,25,928,101,0],[929,25,930,83,0],[931,25,932,53,0],[933,25,933,26,0],[934,29,937,54,0],[938,29,938,108,0],[939,25,939,26,0],[940,21,940,22,0],[942,21,942,22,0],[943,25,943,101,0],[944,25,945,67,0],[946,25,947,83,0],[948,21,948,22,0],[949,21,949,50,0],[950,17,950,18,0],[952,17,955,76,0],[956,17,956,18,0],[957,21,957,85,0],[958,21,958,90,0],[959,21,959,92,0],[960,21,960,97,0],[962,21,962,90,0],[963,21,963,89,0],[964,17,964,18,0],[965,17,965,75,0],[966,17,966,18,0],[967,21,968,113,0],[970,21,972,78,0],[973,21,973,22,0],[974,25,975,111,0],[976,21,976,22,0],[977,17,977,18,0],[978,17,978,36,0],[979,17,979,18,0],[980,21,980,93,0],[981,21,981,81,0],[982,21,982,82,0],[983,21,983,96,0],[984,17,984,18,0],[986,21,986,94,0],[988,17,988,32,0],[989,17,989,18,0],[990,21,990,85,0],[991,21,991,82,0],[992,17,992,18,0],[994,17,994,67,0],[995,17,995,18,0],[996,21,996,65,0],[997,25,997,94,0],[998,17,998,18,0],[999,13,999,14,0],[1000,9,1000,10,0],[1003,9,1003,10,0],[1004,13,1004,78,0],[1005,13,1005,83,0],[1006,13,1006,82,0],[1007,13,1007,90,0],[1008,13,1008,84,0],[1009,13,1009,90,0],[1011,13,1013,92,0],[1014,13,1014,28,0],[1015,17,1015,80,0],[1017,17,1017,81,0],[1018,9,1018,10,0],[1021,9,1021,10,0],[1022,13,1022,54,0],[1023,13,1023,14,0],[1024,17,1024,44,0],[1025,17,1025,36,0],[1026,17,1026,84,0],[1027,17,1027,86,0],[1028,17,1028,93,0],[1029,17,1031,61,0],[1032,17,1032,18,0],[1034,21,1034,68,0],[1035,21,1035,22,0],[1036,25,1036,94,0],[1037,25,1037,95,0],[1038,21,1038,22,0],[1039,17,1039,18,0],[1040,17,1040,120,0],[1041,17,1041,18,0],[1042,21,1042,96,0],[1043,21,1043,95,0],[1044,21,1044,94,0],[1045,21,1045,93,0],[1046,21,1048,44,0],[1049,21,1049,22,0],[1050,25,1050,107,0],[1051,25,1051,122,0],[1052,25,1052,103,0],[1053,21,1053,22,0],[1054,21,1056,100,0],[1057,21,1057,36,0],[1058,25,1058,93,0],[1060,25,1060,94,0],[1061,17,1061,18,0],[1063,17,1063,18,0],[1064,21,1064,93,0],[1065,21,1065,92,0],[1066,17,1066,18,0],[1079,13,1079,14,0],[1080,18,1080,55,0],[1081,13,1081,14,0],[1082,17,1082,42,0],[1083,17,1083,36,0],[1084,17,1084,120,0],[1085,17,1085,18,0],[1086,21,1086,34,0],[1087,17,1087,18,0],[1088,13,1088,14,0],[1089,18,1089,60,0],[1090,13,1090,14,0],[1091,17,1091,44,0],[1092,17,1092,85,0],[1093,17,1093,92,0],[1094,13,1094,14,0],[1095,18,1095,56,0],[1096,13,1096,14,0],[1098,17,1098,42,0],[1100,17,1100,36,0],[1102,17,1102,46,0],[1104,17,1104,32,0],[1105,17,1105,33,0],[1106,17,1107,73,0],[1108,17,1108,18,0],[1109,21,1112,44,0],[1113,21,1115,26,0],[1116,21,1116,22,0],[1117,25,1117,107,0],[1118,25,1118,114,0],[1119,25,1119,103,0],[1120,21,1120,22,0],[1121,21,1122,93,0],[1123,25,1123,93,0],[1125,25,1125,94,0],[1126,21,1127,49,0],[1128,21,1128,22,0],[1129,25,1131,122,0],[1132,25,1132,104,0],[1133,21,1133,22,0],[1134,17,1134,18,0],[1136,21,1136,90,0],[1137,13,1137,14,0],[1138,18,1138,65,0],[1139,13,1139,14,0],[1140,17,1140,88,0],[1141,17,1141,57,0],[1142,17,1142,18,0],[1143,21,1143,61,0],[1144,21,1144,69,0],[1145,21,1145,118,0],[1146,21,1146,28,0],[1149,17,1149,115,0],[1150,13,1150,14,0],[1151,9,1151,10,0],[1155,9,1155,10,0],[1156,13,1156,104,0],[1157,13,1157,58,0],[1158,9,1158,10,0],[1162,9,1162,10,0],[1163,13,1163,102,0],[1164,13,1164,57,0],[1165,9,1165,10,0],[1169,9,1169,10,0],[1170,13,1170,20,0],[1170,22,1170,38,0],[1170,39,1170,41,0],[1170,42,1170,107,0],[1171,13,1171,14,0],[1172,17,1172,78,0],[1173,21,1173,61,0],[1174,17,1176,102,0],[1177,13,1177,14,0],[1179,13,1179,33,0],[1180,13,1180,14,0],[1181,17,1181,60,0],[1182,17,1182,97,0],[1184,17,1184,65,0],[1185,21,1185,63,0],[1186,17,1186,72,0],[1187,21,1187,70,0],[1188,17,1188,24,0],[1188,26,1188,36,0],[1188,37,1188,39,0],[1188,40,1188,57,0],[1189,17,1189,18,0],[1190,21,1190,86,0],[1191,17,1191,18,0],[1192,17,1192,65,0],[1193,17,1193,18,0],[1194,21,1198,132,0],[1199,21,1199,83,0],[1200,17,1200,18,0],[1201,13,1201,14,0],[1202,13,1202,46,0],[1203,13,1203,91,0],[1204,13,1204,20,0],[1204,22,1204,37,0],[1204,38,1204,40,0],[1204,41,1204,56,0],[1205,13,1205,14,0],[1206,17,1206,45,0],[1207,17,1207,48,0],[1208,17,1208,80,0],[1209,17,1209,111,0],[1210,17,1210,66,0],[1211,17,1211,109,0],[1212,17,1214,123,0],[1215,17,1215,109,0],[1216,17,1216,68,0],[1217,17,1219,103,0],[1220,17,1220,59,0],[1221,21,1221,87,0],[1222,17,1222,65,0],[1223,21,1223,92,0],[1224,17,1224,50,0],[1225,17,1225,56,0],[1227,17,1227,54,0],[1228,21,1228,70,0],[1229,17,1229,55,0],[1230,21,1230,72,0],[1231,17,1231,63,0],[1232,21,1232,88,0],[1233,17,1233,98,0],[1234,17,1234,39,0],[1235,17,1235,18,0],[1236,21,1236,84,0],[1237,25,1240,123,0],[1241,17,1241,18,0],[1242,13,1242,14,0],[1243,9,1243,10,0],[1246,9,1246,10,0],[1247,13,1247,89,0],[1248,13,1248,40,0],[1249,13,1249,69,0],[1250,13,1250,91,0],[1251,13,1251,14,0],[1252,17,1257,114,0],[1258,17,1258,27,0],[1259,17,1259,24,0],[1259,26,1259,38,0],[1259,39,1259,41,0],[1259,42,1259,57,0],[1260,17,1260,18,0],[1261,21,1263,94,0],[1264,21,1264,25,0],[1265,17,1265,18,0],[1266,13,1266,14,0],[1267,13,1267,47,0],[1268,17,1268,86,0],[1269,9,1269,10,0],[1272,9,1272,10,0],[1273,13,1273,84,0],[1274,13,1274,23,0],[1275,13,1275,46,0],[1276,13,1276,14,0],[1277,17,1277,98,0],[1278,17,1278,18,0],[1279,21,1279,42,0],[1280,17,1280,18,0],[1282,21,1282,25,0],[1283,13,1283,14,0],[1284,9,1284,10,0],[1288,9,1288,10,0],[1289,13,1289,38,0],[1290,13,1290,27,0],[1291,13,1294,54,0],[1296,13,1296,84,0],[1297,13,1297,66,0],[1299,13,1299,35,0],[1300,13,1300,14,0],[1301,17,1301,91,0],[1302,17,1302,96,0],[1303,17,1303,50,0],[1304,21,1304,55,0],[1306,21,1306,71,0],[1308,17,1308,48,0],[1309,17,1309,89,0],[1310,17,1310,81,0],[1311,17,1311,85,0],[1312,17,1312,93,0],[1313,17,1313,77,0],[1314,17,1317,51,0],[1318,17,1318,31,0],[1320,17,1320,18,0],[1321,21,1321,117,0],[1322,21,1322,22,0],[1323,25,1323,49,0],[1324,25,1324,26,0],[1325,29,1325,43,0],[1326,29,1326,72,0],[1327,25,1327,26,0],[1328,21,1328,22,0],[1329,17,1329,18,0],[1330,17,1330,37,0],[1331,17,1331,18,0],[1332,17,1332,18,0],[1333,13,1333,14,0],[1334,13,1336,118,0],[1337,13,1339,118,0],[1340,13,1342,112,0],[1343,13,1346,120,0],[1347,13,1348,75,0],[1349,13,1353,122,0],[1354,9,1354,10,0],[1357,9,1357,10,0],[1358,13,1358,49,0],[1359,13,1359,117,0],[1360,13,1360,102,0],[1361,9,1361,10,0],[1366,9,1366,10,0],[1367,13,1367,38,0],[1369,13,1369,47,0],[1372,13,1373,63,0],[1374,17,1374,68,0],[1376,18,1377,101,0],[1378,17,1378,106,0],[1380,13,1381,95,0],[1382,9,1382,10,0],[1386,9,1386,10,0],[1387,13,1387,38,0],[1389,13,1389,47,0],[1392,13,1393,63,0],[1394,17,1394,68,0],[1396,18,1397,101,0],[1398,17,1398,106,0],[1400,13,1401,82,0],[1402,9,1402,10,0],[1407,9,1407,10,0],[1408,13,1411,54,0],[1413,13,1416,106,0],[1417,13,1417,27,0],[1418,13,1418,42,0],[1420,13,1420,66,0],[1422,13,1422,38,0],[1423,13,1423,14,0],[1424,17,1424,51,0],[1425,21,1427,68,0],[1429,21,1429,122,0],[1430,17,1430,78,0],[1431,17,1431,64,0],[1432,17,1432,93,0],[1433,17,1433,74,0],[1436,17,1440,73,0],[1441,17,1441,119,0],[1442,17,1442,108,0],[1444,17,1447,107,0],[1448,17,1448,31,0],[1449,17,1449,115,0],[1450,13,1450,14,0],[1451,9,1451,10,0],[1454,9,1454,10,0],[1455,13,1455,35,0],[1456,13,1456,42,0],[1457,13,1460,89,0],[1462,13,1462,14,0],[1463,17,1463,85,0],[1464,13,1464,14,0],[1465,18,1466,90,0],[1467,17,1467,86,0],[1468,13,1468,88,0],[1469,9,1469,10,0],[1472,9,1472,10,0],[1474,13,1474,59,0],[1476,13,1476,120,0],[1477,13,1478,74,0],[1480,13,1481,74,0],[1483,13,1483,81,0],[1485,13,1485,51,0],[1486,9,1486,10,0],[1489,9,1489,10,0],[1491,13,1491,59,0],[1493,13,1494,71,0],[1497,13,1497,122,0],[1499,13,1499,81,0],[1501,13,1501,51,0],[1502,9,1502,10,0],[1506,9,1506,10,0],[1508,13,1508,14,0],[1509,17,1509,43,0],[1510,17,1510,18,0],[1511,21,1511,59,0],[1512,21,1512,77,0],[1514,17,1514,55,0],[1515,13,1515,14,0],[1516,13,1516,33,0],[1517,13,1517,14,0],[1518,17,1518,49,0],[1520,9,1520,10,0],[1523,9,1523,10,0],[1525,13,1525,14,0],[1526,17,1526,42,0],[1527,17,1527,48,0],[1528,17,1528,88,0],[1529,17,1529,70,0],[1530,17,1530,39,0],[1531,17,1531,18,0],[1532,21,1532,45,0],[1533,21,1542,96,0],[1543,21,1543,28,0],[1543,30,1543,46,0],[1543,47,1543,49,0],[1543,50,1543,58,0],[1544,21,1544,22,0],[1545,25,1554,107,0],[1555,25,1555,57,0],[1556,25,1556,26,0],[1557,29,1557,48,0],[1558,29,1558,49,0],[1559,29,1559,38,0],[1561,21,1561,22,0],[1563,21,1563,38,0],[1564,21,1564,22,0],[1565,25,1565,83,0],[1566,25,1566,96,0],[1567,25,1567,98,0],[1568,25,1568,101,0],[1569,21,1569,22,0],[1571,21,1571,22,0],[1572,25,1572,63,0],[1573,25,1573,87,0],[1575,17,1575,18,0],[1577,17,1577,55,0],[1578,13,1578,14,0],[1579,13,1579,33,0],[1580,13,1580,14,0],[1581,17,1581,49,0],[1583,9,1583,10,0],[1586,9,1586,10,0],[1587,13,1587,59,0],[1588,13,1588,66,0],[1589,17,1589,60,0],[1590,13,1590,91,0],[1591,13,1591,49,0],[1592,13,1592,20,0],[1592,22,1592,37,0],[1592,38,1592,40,0],[1592,41,1592,59,0],[1593,17,1593,86,0],[1594,13,1594,38,0],[1596,13,1596,20,0],[1596,22,1596,37,0],[1596,38,1596,40,0],[1596,41,1596,59,0],[1597,13,1597,14,0],[1598,17,1611,39,0],[1612,17,1612,67,0],[1613,17,1613,18,0],[1614,21,1614,40,0],[1615,21,1615,90,0],[1616,17,1616,18,0],[1617,13,1617,14,0],[1645,13,1645,68,0],[1646,13,1646,96,0],[1647,13,1647,28,0],[1648,13,1648,93,0],[1650,13,1650,20,0],[1650,22,1650,32,0],[1650,33,1650,35,0],[1650,36,1650,58,0],[1651,13,1651,14,0],[1652,17,1661,98,0],[1662,17,1662,45,0],[1663,17,1663,35,0],[1664,17,1664,31,0],[1665,17,1665,36,0],[1666,17,1666,31,0],[1667,17,1667,32,0],[1668,17,1668,59,0],[1669,17,1669,31,0],[1670,17,1670,52,0],[1671,17,1671,35,0],[1673,17,1673,56,0],[1674,17,1676,108,0],[1677,17,1677,46,0],[1678,17,1678,32,0],[1679,17,1679,32,0],[1680,17,1680,33,0],[1681,17,1681,43,0],[1682,17,1682,64,0],[1683,17,1683,53,0],[1684,17,1684,54,0],[1685,17,1685,62,0],[1686,17,1686,32,0],[1688,17,1688,52,0],[1689,17,1689,45,0],[1690,13,1690,14,0],[1692,13,1692,56,0],[1693,13,1693,14,0],[1694,17,1694,94,0],[1695,17,1695,54,0],[1696,17,1696,86,0],[1697,17,1697,85,0],[1698,13,1698,14,0],[1699,13,1699,55,0],[1700,13,1700,14,0],[1701,17,1701,86,0],[1702,17,1702,91,0],[1703,13,1703,14,0],[1704,13,1710,39,0],[1711,13,1711,85,0],[1712,13,1712,90,0],[1713,13,1713,93,0],[1714,13,1714,113,0],[1715,13,1716,130,0],[1717,13,1718,130,0],[1719,13,1719,116,0],[1720,13,1720,32,0],[1721,9,1721,10,0],[1725,9,1725,10,0],[1726,13,1726,45,0],[1728,13,1728,43,0],[1729,13,1729,50,0],[1730,13,1730,47,0],[1731,13,1731,58,0],[1733,13,1733,43,0],[1734,13,1734,46,0],[1735,13,1735,43,0],[1736,13,1736,58,0],[1738,13,1738,43,0],[1739,13,1739,65,0],[1740,13,1740,50,0],[1741,13,1741,58,0],[1743,13,1743,28,0],[1744,9,1744,10,0],[1748,9,1748,10,0],[1749,13,1749,45,0],[1751,13,1751,43,0],[1752,13,1752,50,0],[1753,13,1753,46,0],[1754,13,1754,58,0],[1756,13,1756,43,0],[1757,13,1757,48,0],[1758,13,1758,45,0],[1759,13,1759,58,0],[1761,13,1761,28,0],[1762,9,1762,10,0],[1765,9,1765,10,0],[1766,13,1766,45,0],[1768,13,1768,43,0],[1769,13,1769,48,0],[1770,13,1770,49,0],[1771,13,1771,58,0],[1773,13,1773,43,0],[1774,13,1774,48,0],[1775,13,1775,45,0],[1776,13,1776,58,0],[1778,13,1778,28,0],[1779,9,1779,10,0],[1782,9,1782,10,0],[1784,13,1784,14,0],[1785,17,1785,42,0],[1787,17,1789,28,0],[1790,17,1800,82,0],[1802,17,1802,55,0],[1803,21,1803,53,0],[1804,17,1804,62,0],[1805,21,1805,60,0],[1806,22,1806,54,0],[1806,56,1806,66,0],[1806,68,1806,75,0],[1807,17,1807,18,0],[1808,21,1808,83,0],[1809,21,1809,22,0],[1810,25,1810,62,0],[1811,21,1811,22,0],[1812,17,1812,18,0],[1814,17,1814,80,0],[1815,17,1815,36,0],[1816,17,1816,24,0],[1816,26,1816,37,0],[1816,38,1816,40,0],[1816,41,1816,48,0],[1817,17,1817,18,0],[1818,21,1820,58,0],[1821,21,1821,49,0],[1822,25,1822,115,0],[1823,21,1823,98,0],[1824,21,1824,115,0],[1825,17,1825,18,0],[1827,17,1827,76,0],[1828,17,1828,24,0],[1828,26,1828,37,0],[1828,38,1828,40,0],[1828,41,1828,53,0],[1829,21,1829,41,0],[1831,17,1831,107,0],[1832,17,1832,18,0],[1833,21,1837,63,0],[1839,21,1842,120,0],[1843,21,1843,58,0],[1845,21,1845,46,0],[1846,21,1846,22,0],[1847,25,1848,63,0],[1849,25,1849,86,0],[1850,25,1850,72,0],[1851,25,1851,101,0],[1852,25,1852,82,0],[1855,25,1859,109,0],[1860,25,1860,39,0],[1861,25,1861,123,0],[1862,21,1862,22,0],[1863,21,1863,50,0],[1864,21,1864,33,0],[1865,21,1865,43,0],[1866,21,1866,22,0],[1867,30,1867,59,0],[1867,61,1867,67,0],[1867,69,1867,72,0],[1868,25,1868,26,0],[1869,29,1869,57,0],[1870,29,1877,49,0],[1878,33,1878,52,0],[1879,25,1879,26,0],[1880,21,1880,22,0],[1881,17,1881,18,0],[1883,17,1883,88,0],[1884,17,1884,37,0],[1885,17,1885,32,0],[1886,17,1886,50,0],[1887,17,1887,18,0],[1888,21,1888,98,0],[1889,21,1889,105,0],[1890,21,1891,41,0],[1892,21,1893,46,0],[1894,17,1894,18,0],[1895,17,1902,26,0],[1903,17,1903,49,0],[1904,17,1904,18,0],[1905,21,1905,80,0],[1906,21,1906,85,0],[1907,17,1907,18,0],[1908,17,1908,79,0],[1909,17,1909,84,0],[1910,17,1910,107,0],[1911,17,1911,61,0],[1912,17,1912,18,0],[1913,21,1913,100,0],[1914,21,1914,120,0],[1915,21,1915,100,0],[1916,17,1916,18,0],[1917,17,1918,101,0],[1919,17,1920,101,0],[1921,17,1921,63,0],[1922,21,1922,86,0],[1923,17,1923,69,0],[1924,21,1924,99,0],[1925,17,1925,62,0],[1926,21,1926,90,0],[1927,17,1927,68,0],[1928,21,1928,91,0],[1929,17,1929,110,0],[1932,17,1934,89,0],[1944,13,1944,14,0],[1945,13,1945,33,0],[1946,13,1946,14,0],[1947,17,1947,49,0],[1949,9,1949,10,0],[1952,9,1952,10,0],[1953,13,1953,72,0],[1954,13,1954,40,0],[1955,13,1955,71,0],[1956,13,1956,40,0],[1957,13,1957,20,0],[1957,22,1957,33,0],[1957,34,1957,36,0],[1957,37,1957,52,0],[1958,13,1958,14,0],[1959,17,1959,102,0],[1960,17,1960,39,0],[1961,17,1961,18,0],[1962,21,1963,86,0],[1964,21,1965,89,0],[1966,17,1966,18,0],[1968,17,1968,18,0],[1969,21,1969,46,0],[1970,21,1970,49,0],[1971,17,1971,18,0],[1972,13,1972,14,0],[1973,9,1973,10,0],[1976,9,1976,10,0],[1977,13,1977,94,0],[1978,9,1978,10,0],[1981,9,1981,10,0],[1982,13,1984,57,0],[1985,13,1985,14,0],[1987,17,1987,39,0],[1988,17,1988,18,0],[1991,21,1991,89,0],[1992,21,1992,91,0],[1993,17,1993,18,0],[1994,13,1994,14,0],[1995,9,1995,10,0],[1998,9,1998,10,0],[1999,13,1999,36,0],[2000,13,2000,14,0],[2001,17,2001,24,0],[2001,26,2001,45,0],[2001,46,2001,48,0],[2001,49,2001,64,0],[2002,17,2002,18,0],[2004,21,2006,75,0],[2007,21,2007,22,0],[2008,25,2009,105,0],[2010,25,2010,88,0],[2011,25,2011,93,0],[2012,25,2012,93,0],[2013,25,2013,100,0],[2014,25,2014,31,0],[2016,26,2018,80,0],[2019,21,2019,22,0],[2020,25,2020,88,0],[2021,25,2021,93,0],[2022,25,2022,93,0],[2023,25,2023,100,0],[2024,25,2024,31,0],[2027,21,2027,22,0],[2028,25,2030,104,0],[2031,25,2031,39,0],[2031,40,2031,104,0],[2032,21,2032,22,0],[2033,17,2033,18,0],[2034,13,2034,14,0],[2035,9,2035,10,0],[2039,9,2039,10,0],[2040,13,2040,34,0],[2041,13,2041,103,0],[2042,13,2042,14,0],[2043,17,2046,57,0],[2047,17,2048,92,0],[2049,17,2049,52,0],[2050,21,2050,33,0],[2052,21,2052,34,0],[2055,17,2055,29,0],[2056,9,2056,10,0],[2059,9,2059,10,0],[2060,13,2060,69,0],[2061,9,2061,10,0],[2064,9,2064,10,0],[2065,13,2065,32,0],[2066,9,2066,10,0],[2072,9,2072,37,0],[2073,9,2073,10,0],[2074,13,2074,34,0],[2075,13,2075,41,0],[2076,13,2076,44,0],[2077,13,2077,57,0],[2079,13,2079,63,0],[2080,13,2080,92,0],[2081,9,2081,10,0],[2085,17,2085,18,0],[2085,19,2085,112,0],[2085,113,2085,114,0],[2089,9,2089,10,0],[2090,13,2090,77,0],[2091,13,2091,70,0],[2092,13,2092,66,0],[2094,13,2094,14,0],[2095,17,2095,45,0],[2098,25,2098,51,0],[2099,25,2099,31,0],[2101,25,2101,49,0],[2102,25,2102,31,0],[2104,25,2104,59,0],[2105,25,2105,31,0],[2107,25,2107,36,0],[2108,25,2108,31,0],[2110,13,2110,14,0],[2111,13,2111,33,0],[2112,13,2112,14,0],[2113,17,2113,70,0],[2114,17,2114,68,0],[2115,17,2115,26,0],[2117,9,2117,10,0],[2120,9,2120,10,0],[2121,13,2121,39,0],[2122,13,2123,74,0],[2124,13,2124,49,0],[2125,17,2125,69,0],[2127,17,2127,70,0],[2128,9,2128,10,0],[2131,9,2131,10,0],[2132,13,2132,39,0],[2133,13,2134,74,0],[2135,13,2135,47,0],[2136,17,2136,69,0],[2138,17,2138,70,0],[2139,9,2139,10,0],[2142,9,2142,10,0],[2143,13,2143,39,0],[2144,13,2145,74,0],[2146,13,2146,48,0],[2147,13,2147,14,0],[2148,17,2148,36,0],[2149,17,2149,18,0],[2150,21,2150,107,0],[2151,21,2151,43,0],[2152,21,2152,22,0],[2153,25,2153,89,0],[2154,25,2154,97,0],[2155,25,2155,60,0],[2156,25,2156,83,0],[2157,25,2157,81,0],[2158,25,2158,79,0],[2159,25,2159,51,0],[2160,25,2160,63,0],[2161,25,2161,49,0],[2162,21,2162,22,0],[2163,17,2163,18,0],[2164,17,2164,69,0],[2165,13,2165,14,0],[2167,13,2167,14,0],[2168,17,2168,70,0],[2169,17,2169,64,0],[2170,13,2170,14,0],[2171,9,2171,10,0],[2175,9,2175,10,0],[2176,13,2176,39,0],[2177,13,2177,95,0],[2178,13,2178,46,0],[2179,17,2179,69,0],[2181,13,2181,14,0],[2182,17,2182,70,0],[2183,17,2183,64,0],[2184,13,2184,14,0],[2185,9,2185,10,0]]);
    </script>
  </body>
</html>