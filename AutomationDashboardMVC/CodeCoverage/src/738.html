<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Business Layer\BL\DocumentComponent.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Data.Common;
using System.Data.SqlClient;
using System.Globalization;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.AMP3.DocumentManagementBL;
using Aurigo.AMP3.DocumentManagementDTO;
using Aurigo.AMP3.Logging;
using Aurigo.AMP3.Resources.MessageResources;
using Aurigo.Brix.Platform.BusinessLayer.DTO;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.Common.Utility;

namespace Aurigo.AMP3.DocumentManagementDAC
{
    internal class DocumentComponent : SingletonManagerBase&lt;DocumentComponent&gt;
    {
        private DocumentComponent() { }

        internal DataTable GetDocumentsByFolder(int FolderId)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetFolderDocuments&quot;);
                conn.DB.AddInParameter(cmd, &quot;FolderId&quot;, DbType.Int32, FolderId);
                return conn.DB.ExecuteDataSet(cmd).Tables[0];
            }
        }

        /// &lt;summary&gt;
        /// gets a doc DTO collection from database for a folder
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;FolderId&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;List&lt;Document&gt;&lt;/returns&gt;
        internal List&lt;Document&gt; GetFolderDocuments(int FolderId)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    var DocColl = new List&lt;Document&gt;();
                    DbCommand cmd1 = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetFolderDocuments&quot;);

                    conn.DB.AddInParameter(cmd1, &quot;FolderId&quot;, DbType.Int32, FolderId);

                    using (IDataReader reader1 = conn.DB.ExecuteReader(cmd1))
                    {
                        while (reader1.Read())
                        {
                            //read only parent documents from DB , here 7 is for ParentId field
                            if (reader1.GetInt32(7) == 0)
                            {
                                DbCommand cmd2 = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetDocuments&quot;);

                                conn.DB.AddInParameter(cmd2, &quot;DocId&quot;, DbType.Int32, reader1.GetInt32(0));

                                var DTOList = new List&lt;Document&gt;();

                                using (IDataReader reader2 = conn.DB.ExecuteReader(cmd2))
                                {
                                    int i = 0;
                                    var DTOobj = new Document();

                                    //populating DTOList with doc versions of parent document

                                    while (reader2.Read())
                                    {
                                        if (i == 0)
                                        {
                                            DTOobj.DocId = reader2.GetInt32(0);
                                            DTOobj.DocName = reader2[1].ToString2();
                                            DTOobj.DocDesc = reader2[2].ToString2();
                                            DTOobj.AuthorName = reader2[3].ToString2();
                                            DTOobj.CreationDate = reader2.GetDateTime(4);
                                            DTOobj.DocSize = reader2[5].ToString2();
                                            DTOobj.StorageId = reader2[6].ToString2();
                                            DTOobj.ParentId = reader2.GetInt32(7);
                                            DTOobj.DocType = reader2.GetInt32(8);
                                            DTOobj.Status = reader2.GetBoolean(9);
                                            DTOobj.VersionNo = reader2.GetInt32(11);
                                            DTOobj.CheckedByName = reader2[12].ToString2();
                                            DTOobj.CheckedBy = reader2.GetInt32(13);
                                            ;
                                            DTOobj.DocTypeDesc = reader2[13].ToString2();
                                        }
                                        else
                                        {
                                            var dto = new Document();

                                            dto.DocId = reader2.GetInt32(0);
                                            dto.DocName = reader2[1].ToString2();
                                            dto.DocDesc = reader2[2].ToString2();
                                            dto.AuthorName = reader2[3].ToString2();
                                            dto.CreationDate = reader2.GetDateTime(4);
                                            dto.DocSize = reader2[5].ToString2();
                                            dto.StorageId = reader2[6].ToString2();
                                            dto.ParentId = reader2.GetInt32(7);
                                            dto.DocType = reader2.GetInt32(8);
                                            dto.Status = reader2.GetBoolean(9);
                                            dto.VersionNo = reader2.GetInt32(11);
                                            dto.CheckedByName = reader2[12].ToString2();
                                            dto.CheckedBy = reader2.GetInt32(13);
                                            dto.DocTypeDesc = reader2[14].ToString2();
                                            //add the revisions to DTOList 
                                            DTOList.Add(dto);
                                        }

                                        i++;
                                    }

                                    if (i &gt; 0)
                                    {
                                        //add the parent document to the end
                                        var dto1 = new Document();
                                        dto1.DocId = reader1.GetInt32(0);
                                        dto1.DocName = reader1[1].ToString2();
                                        dto1.DocDesc = reader1[2].ToString2();
                                        dto1.AuthorName = reader1[3].ToString2();
                                        dto1.CreationDate = reader1.GetDateTime(4);
                                        dto1.DocSize = reader1[5].ToString2();
                                        dto1.StorageId = reader1[6].ToString2();
                                        dto1.ParentId = reader1.GetInt32(7);
                                        dto1.DocType = reader1.GetInt32(8);
                                        dto1.Status = reader1.GetBoolean(9);
                                        dto1.VersionNo = reader1.GetInt32(11);
                                        dto1.CheckedByName = reader1[12].ToString2();
                                        dto1.CheckedBy = reader1.GetInt32(13);
                                        dto1.DocTypeDesc = reader1[13].ToString2();
                                        //add the revisions to DTOList 
                                        DTOList.Add(dto1);

                                        DTOobj.DTOList = DTOList;
                                    }
                                    else
                                    {
                                        //populate all fields of main DTO object from datareader
                                        DTOobj.DocId = reader1.GetInt32(0);
                                        DTOobj.DocName = reader1[1].ToString2();
                                        DTOobj.DocDesc = reader1[2].ToString2();
                                        DTOobj.AuthorName = reader1[3].ToString2();
                                        DTOobj.CreationDate = reader1.GetDateTime(4);
                                        DTOobj.DocSize = reader1[5].ToString2();
                                        DTOobj.StorageId = reader1[6].ToString2();
                                        DTOobj.ParentId = reader1.GetInt32(7);
                                        DTOobj.DocType = reader1.GetInt32(8);
                                        DTOobj.Status = reader1.GetBoolean(9);
                                        DTOobj.VersionNo = reader1.GetInt32(11);
                                        DTOobj.CheckedByName = reader1[12].ToString2();
                                        DTOobj.CheckedBy = reader1.GetInt32(13);
                                        DTOobj.DocTypeDesc = reader1[13].ToString2();
                                        //in case the parent doc has no versions
                                        DTOobj.DTOList = null;
                                    }

                                    //populate the List obj with the main dto object
                                    DocColl.Add(DTOobj);
                                }
                            }
                        }
                    }
                    return DocColl;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_DOCMGMT);
                throw;
            }
        }

        /// &lt;summary&gt;
        /// returns a folderDTO collection from DB
        /// &lt;/summary&gt;
        /// &lt;returns&gt;Dictionary&lt;int, object&gt;&lt;/returns&gt;
        internal Dictionary&lt;int, Folder&gt; GetSubfolders(string ModuleId, string InstanceId, int FolderId)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    Dictionary&lt;int, Folder&gt; FolderColl = new Dictionary&lt;int, Folder&gt;();
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetSubfolders&quot;);

                    conn.DB.AddInParameter(cmd, &quot;FolderId&quot;, DbType.Int32, FolderId);
                    conn.DB.AddInParameter(cmd, &quot;ModuleCode&quot;, DbType.String, ModuleId);
                    conn.DB.AddInParameter(cmd, &quot;InstanceId&quot;, DbType.String, InstanceId);

                    using (IDataReader reader = conn.DB.ExecuteReader(cmd))
                    {
                        while (reader.Read())
                        {
                            Folder FolderDTOobj = PopulateFolderDTO(reader);
                            FolderColl.Add(FolderDTOobj.FolderId, FolderDTOobj);
                        }
                    }
                    return FolderColl;
                }
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_DOCMGMT);
                throw;
            }
        }

        /// &lt;summary&gt;
        /// adds a subfolder under the given folder id
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;FolderDTO&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        internal int AddFolder(Folder FolderDTO)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTAddFolder&quot;);

                conn.DB.AddInParameter(cmd, &quot;FOLDERNAME&quot;, DbType.String, FolderDTO.FolderName);
                conn.DB.AddInParameter(cmd, &quot;FOLDERDESC&quot;, DbType.String, FolderDTO.FolderDesc);
                conn.DB.AddInParameter(cmd, &quot;PARENTID&quot;, DbType.Int32, FolderDTO.ParentId);
                conn.DB.AddInParameter(cmd, &quot;MODULEID&quot;, DbType.String, FolderDTO.ModuleId);
                conn.DB.AddInParameter(cmd, &quot;INSTANCEID&quot;, DbType.String, FolderDTO.InstanceId);
                conn.DB.AddInParameter(cmd, &quot;LISTID&quot;, DbType.String, FolderDTO.ListID);
                conn.DB.AddInParameter(cmd, &quot;LISTPATH&quot;, DbType.String, FolderDTO.ListPath);
                conn.DB.AddInParameter(cmd, &quot;PARENTMODULEID&quot;, DbType.String, FolderDTO.ParentModuleId);
                conn.DB.AddInParameter(cmd, &quot;PARENTINSTANCEID&quot;, DbType.Int32, FolderDTO.ParentInstanceId);
                conn.DB.AddInParameter(cmd, &quot;FolderType&quot;, DbType.Int32, FolderDTO.FolderType.ToInt32_2());

                conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                conn.DB.AddOutParameter(cmd, &quot;FOLDERID&quot;, DbType.Int32, 4);
                conn.DB.ExecuteScalar(cmd);

                object id = conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString();
                object objFolderId = conn.DB.GetParameterValue(cmd, &quot;FOLDERID&quot;).ToString();

                int retval = id.ToString().ToInt32_2();
                int folderId = objFolderId.ToString().ToInt32_2();
                if (folderId &gt;= 0)
                    FolderDTO.FolderId = folderId;

                return (retval);
            }
        }

        /// &lt;summary&gt;
        /// gets the foldername from DB , If getDsiplayName is true returns &#39;Documents&#39; if parentFolderid = 0
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;folderid&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;foldername&lt;/returns&gt;
        /// updated by for new variable // change made By Akila
        public string GetFolderName(int folderid, bool getDisplayName = false)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                string foldername;
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetFolderName&quot;);

                conn.DB.AddInParameter(cmd, &quot;FOLDERID&quot;, DbType.Int32, folderid);
                conn.DB.AddInParameter(cmd, &quot;GETDISPLAYNAME&quot;, DbType.Boolean, getDisplayName);
                conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.String, 100);
                conn.DB.ExecuteScalar(cmd);

                foldername = conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2();
                return (foldername != &quot;&quot;) ? foldername : &quot;0&quot;;
            }
        }

        /// &lt;summary&gt;
        /// gets the parent foldername of the folder DB 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;folderid&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;parent foldername&lt;/returns&gt;
        public string GetParentFolderName(int folderid)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                string pfoldername;
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetParentFolderName&quot;);

                conn.DB.AddInParameter(cmd, &quot;FOLDERID&quot;, DbType.Int32, folderid);
                conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.String, 100);
                conn.DB.ExecuteScalar(cmd);

                pfoldername = conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2();
                return (pfoldername != &quot;&quot;) ? pfoldername : &quot;0&quot;;
            }
        }

        /// &lt;summary&gt;
        /// Returns the top one folder detail based on input param (use it only for hidden folder, unused module id)
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;folderName&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;moduleId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;instanceId&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public Folder GetFolderDetails(string folderName, string moduleId, string instanceId)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetFolderDetailsOnModuleId&quot;);
                conn.DB.AddInParameter(cmd, &quot;FolderName&quot;, DbType.String, folderName);
                conn.DB.AddInParameter(cmd, &quot;ModuleId&quot;, DbType.String, moduleId);
                conn.DB.AddInParameter(cmd, &quot;InstanceId&quot;, DbType.String, instanceId);

                using (IDataReader dr = conn.DB.ExecuteReader(cmd))
                    if (dr.Read())
                        return PopulateFolderDTO(dr);
                return new Folder();
            }
        }

        /// &lt;summary&gt;
        /// gets the details of the selected folder
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;folderid&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;folder DTO object&lt;/returns&gt;
        public Folder GetFolderDetails(int folderid)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetFolderDetails&quot;);
                conn.DB.AddInParameter(cmd, &quot;FOLDERID&quot;, DbType.Int32, folderid);
                using (IDataReader dr = conn.DB.ExecuteReader(cmd))
                    if (dr.Read())
                        return PopulateFolderDTO(dr);
                return new Folder();
            }
        }

        private Folder PopulateFolderDTO(IDataReader dr)
        {
            Folder folobj = new Folder();
            folobj.FolderId = dr.GetInt32(dr.GetOrdinal(&quot;FolderId&quot;));
            folobj.FolderName = dr.GetString(dr.GetOrdinal(&quot;FolderName&quot;));
            folobj.FolderDesc = dr.GetString(dr.GetOrdinal(&quot;FolderDescription&quot;));
            if (!dr.IsDBNull(dr.GetOrdinal(&quot;ParentFolderId&quot;)))
                folobj.ParentId = dr.GetInt32(dr.GetOrdinal(&quot;ParentFolderId&quot;));
            folobj.ModuleId = dr.GetString(dr.GetOrdinal(&quot;ModuleId&quot;));
            if (!dr.IsDBNull(dr.GetOrdinal(&quot;InstanceId&quot;)))
                folobj.InstanceId = dr.GetString(dr.GetOrdinal(&quot;InstanceId&quot;));
            folobj.ListID = dr.IsDBNull(dr.GetOrdinal(&quot;ListID&quot;)) ? null : dr.GetString(dr.GetOrdinal(&quot;ListID&quot;));
            folobj.ListPath = dr.IsDBNull(dr.GetOrdinal(&quot;ListPath&quot;)) ? null : dr.GetString(dr.GetOrdinal(&quot;ListPath&quot;));
            folobj.ParentModuleId = dr.IsDBNull(dr.GetOrdinal(&quot;ParentModuleId&quot;)) ? null : dr.GetString(dr.GetOrdinal(&quot;ParentModuleId&quot;));
            if (!dr.IsDBNull(dr.GetOrdinal(&quot;ParentInstanceId&quot;)))
                folobj.ParentInstanceId = dr.GetInt32(dr.GetOrdinal(&quot;ParentInstanceId&quot;));

            if (!dr.IsDBNull(dr.GetOrdinal(&quot;PermissionFolderID&quot;)))
                folobj.PermissionFolderID = dr.GetInt32(dr.GetOrdinal(&quot;PermissionFolderID&quot;));
            else
                folobj.PermissionFolderID = null;

            if (!dr.IsDBNull(dr.GetOrdinal(&quot;FolderType&quot;)))
                folobj.FolderType = (FolderType)dr.GetInt32(dr.GetOrdinal(&quot;FolderType&quot;));
            else
                folobj.FolderType = FolderType.None;

            return folobj;
        }

        /// &lt;summary&gt;
        /// updates the details of selected folder
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;FolderDTO&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;int&lt;/returns&gt;
        public int ModifyFolder(Folder FolderDTO)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTModifyFolder&quot;);

                conn.DB.AddInParameter(cmd, &quot;FOLDERID&quot;, DbType.Int32, FolderDTO.FolderId);
                conn.DB.AddInParameter(cmd, &quot;FOLDERNAME&quot;, DbType.String, FolderDTO.FolderName);
                conn.DB.AddInParameter(cmd, &quot;FOLDERDESC&quot;, DbType.String, FolderDTO.FolderDesc);
                conn.DB.AddInParameter(cmd, &quot;MODULEID&quot;, DbType.String, FolderDTO.ModuleId);
                conn.DB.AddInParameter(cmd, &quot;PARENTID&quot;, DbType.Int32, FolderDTO.ParentId);
                conn.DB.AddInParameter(cmd, &quot;LISTID&quot;, DbType.String, FolderDTO.ListID);
                conn.DB.AddInParameter(cmd, &quot;LISTPATH&quot;, DbType.String, FolderDTO.ListPath);
                conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                conn.DB.ExecuteScalar(cmd);

                return conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();
            }
        }

        /// &lt;summary&gt;
        /// deletes docs in folder from DB 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;FolderId&quot;&gt;&lt;/param&gt;
        /// &lt;returns name=&quot;int&quot;&gt;&lt;/returns&gt;
        public int DeleteFolderDocuments(int FolderId)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTDeleteFolderDocuments&quot;);

                conn.DB.AddInParameter(cmd, &quot;FOLDERID&quot;, DbType.Int32, FolderId);
                conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                conn.DB.ExecuteScalar(cmd);

                return conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();
            }
        }

        /// &lt;summary&gt;
        /// deletes selected folder from DB
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;FolderId&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;int&lt;/returns&gt;
        public int DeleteFolder(int folderId)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTDeleteFolder&quot;);

                conn.DB.AddInParameter(cmd, &quot;FOLDERID&quot;, DbType.Int32, folderId);
                conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                conn.DB.ExecuteScalar(cmd);

                return conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();
            }
        }

        /// &lt;summary&gt;
        /// checks whether folder contains docs/subfolders
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;ids&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;1 if empty,-1 if contains subfolders,-2 if contains only docs&lt;/returns&gt;
        public int CheckDocumentStatus(string ids)
        {
            int cnt = 0;
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTCheckDocumentStatus&quot;);

                conn.DB.AddInParameter(cmd, &quot;FOLDERIDS&quot;, DbType.String, ids);

                using (IDataReader reader = conn.DB.ExecuteReader(cmd))
                {
                    while (reader.Read())
                        cnt = reader.GetInt32(0);
                }

                return (cnt &gt; 0) ? 0 : 1;
            }
        }

        /// &lt;summary&gt;
        /// checks whether document name already exists
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;docname&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;folderid&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public int CheckDocumentName(string docname, int folderid)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTCheckDocumentName&quot;);

                conn.DB.AddInParameter(cmd, &quot;DOCNAME&quot;, DbType.String, docname);
                conn.DB.AddInParameter(cmd, &quot;FOLDERID&quot;, DbType.Int32, folderid);
                conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                conn.DB.ExecuteScalar(cmd);

                return conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();
            }
        }

        /// &lt;summary&gt;
        /// delete all subfolders of selected folder
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;folderid&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public int DeleteSubfolders(int folderid)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTDeleteSubfolders&quot;);

                conn.DB.AddInParameter(cmd, &quot;FOLDERID&quot;, DbType.Int32, folderid);
                conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                conn.DB.ExecuteScalar(cmd);

                return conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();
            }
        }

        /// &lt;summary&gt;
        /// gets the MIME type of the selected doc
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;typeid&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;string&lt;/returns&gt;
        public string GetMIMEType(int typeid, string company = null)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString(company)))
            {
                string typename;
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetMIMEType&quot;);

                conn.DB.AddInParameter(cmd, &quot;TYPEID&quot;, DbType.Int32, typeid);
                conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.String, 100);
                conn.DB.ExecuteScalar(cmd);

                typename = conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2();
                return (typename != &quot;&quot;) ? typename : &quot;0&quot;;
            }
        }

        /// &lt;summary&gt;
        /// gets the type id corresponding to the mimetype
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;mimetype&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;int&lt;/returns&gt;
        public int GetTypeId(string mimetype)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetTypeId&quot;);

                conn.DB.AddInParameter(cmd, &quot;MIMETYPE&quot;, DbType.String, mimetype);
                conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.String, 100);
                conn.DB.ExecuteScalar(cmd);

                return conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();
            }
        }

        /// &lt;summary&gt;
        /// adds a doc to the DB 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;DocDTO&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;-1 if there exists a similar name ,0 if any error has occurred or else it will return you the document id&lt;/returns&gt;
        public int AddDocument(Document DocDTO)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTAddDocument&quot;);
                conn.DB.AddInParameter(cmd, &quot;DOCNAME&quot;, DbType.String, DocDTO.DocName);
                conn.DB.AddInParameter(cmd, &quot;DOCSIZE&quot;, DbType.String, DocDTO.DocSize);
                conn.DB.AddInParameter(cmd, &quot;TYPEID&quot;, DbType.Int32, DocDTO.DocType);
                conn.DB.AddInParameter(cmd, &quot;PARENTID&quot;, DbType.Int32, DocDTO.ParentId);
                conn.DB.AddInParameter(cmd, &quot;VERSIONNO&quot;, DbType.Int32, DocDTO.VersionNo);
                conn.DB.AddInParameter(cmd, &quot;FOLDERID&quot;, DbType.Int32, DocDTO.FolderId);
                conn.DB.AddInParameter(cmd, &quot;STATUSID&quot;, DbType.Boolean, DocDTO.Status);
                conn.DB.AddInParameter(cmd, &quot;STORAGEID&quot;, DbType.String, DocDTO.StorageId);
                conn.DB.AddInParameter(cmd, &quot;XMLINFO&quot;, DbType.String, DocDTO.XMLInfo);
                conn.DB.AddInParameter(cmd, &quot;DOCDESC&quot;, DbType.String, DocDTO.DocDesc);
                conn.DB.AddInParameter(cmd, &quot;CREATIONDATE&quot;, DbType.DateTime, DocDTO.CreationDate.ToDateTimeString_ForDatabaseOpenXml());
                conn.DB.AddInParameter(cmd, &quot;AUTHOR&quot;, DbType.Int32, DocDTO.Author);
                conn.DB.AddInParameter(cmd, &quot;AUTHORNAME&quot;, DbType.String, DocDTO.AuthorName);
                conn.DB.AddInParameter(cmd, &quot;CHECKEDBY&quot;, DbType.Int32, DocDTO.CheckedBy);
                conn.DB.AddInParameter(cmd, &quot;SRCMODULEID&quot;, DbType.String, DocDTO.SrcModuleID);
                conn.DB.AddInParameter(cmd, &quot;SPFILENAME&quot;, DbType.String, DocDTO.SPName);
                conn.DB.AddInParameter(cmd, &quot;ISTEMPLATE&quot;, DbType.Int32, DocDTO.IsTemplate);
                conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                conn.DB.AddInParameter(cmd, &quot;SRCMODULECODE&quot;, DbType.String, DocDTO.SrcModuleCode);
                conn.DB.AddInParameter(cmd, &quot;SRCID&quot;, DbType.String, DocDTO.SrcID);
                conn.DB.AddInParameter(cmd, &quot;DOCTYPE&quot;, DbType.String, (int)DocDTO.DocumentType);
                conn.DB.ExecuteScalar(cmd);

                return conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();
            }
        }

        public int UpdateDocument(Document DocDTO, string UpdateType, int linkId = -1)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTAddDocument&quot;);
                conn.DB.AddInParameter(cmd, &quot;DOCID&quot;, DbType.Int32, DocDTO.DocId);
                conn.DB.AddInParameter(cmd, &quot;CHECKTYPE&quot;, DbType.String, UpdateType);
                conn.DB.AddInParameter(cmd, &quot;DOCNAME&quot;, DbType.String, DocDTO.DocName);
                conn.DB.AddInParameter(cmd, &quot;DOCSIZE&quot;, DbType.String, DocDTO.DocSize);
                conn.DB.AddInParameter(cmd, &quot;TYPEID&quot;, DbType.Int32, DocDTO.DocType);
                conn.DB.AddInParameter(cmd, &quot;PARENTID&quot;, DbType.Int32, DocDTO.ParentId);
                conn.DB.AddInParameter(cmd, &quot;VERSIONNO&quot;, DbType.Int32, DocDTO.VersionNo);
                conn.DB.AddInParameter(cmd, &quot;FOLDERID&quot;, DbType.Int32, DocDTO.FolderId);
                conn.DB.AddInParameter(cmd, &quot;STATUSID&quot;, DbType.Boolean, DocDTO.Status);
                conn.DB.AddInParameter(cmd, &quot;STORAGEID&quot;, DbType.String, DocDTO.StorageId);
                conn.DB.AddInParameter(cmd, &quot;XMLINFO&quot;, DbType.String, DocDTO.XMLInfo);
                conn.DB.AddInParameter(cmd, &quot;DOCDESC&quot;, DbType.String, DocDTO.DocDesc);
                conn.DB.AddInParameter(cmd, &quot;CREATIONDATE&quot;, DbType.DateTime, DocDTO.CreationDate.ToDateTimeString_ForDatabaseOpenXml());
                conn.DB.AddInParameter(cmd, &quot;UPDATIONDATE&quot;, DbType.DateTime, DocDTO.UpdationDate.ToDateTimeString_ForDatabaseOpenXml());
                conn.DB.AddInParameter(cmd, &quot;UpdatedBy&quot;, DbType.Int64, DocDTO.UpdatedBy);
                conn.DB.AddInParameter(cmd, &quot;AUTHOR&quot;, DbType.Int32, DocDTO.Author);
                conn.DB.AddInParameter(cmd, &quot;AUTHORNAME&quot;, DbType.String, DocDTO.AuthorName);
                conn.DB.AddInParameter(cmd, &quot;CHECKEDBY&quot;, DbType.Int32, DocDTO.CheckedBy);
                conn.DB.AddInParameter(cmd, &quot;ISTEMPLATE&quot;, DbType.Int32, DocDTO.IsTemplate);
                if (linkId &gt; -1 || linkId == -2)
                    conn.DB.AddInParameter(cmd, &quot;LinkID&quot;, DbType.Int32, linkId);
                // -2 handled to get linkid while adding to update description
                conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                conn.DB.ExecuteScalar(cmd);

                return conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();
            }
        }

        /// &lt;summary&gt;
        /// changes status of doc to checked out
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;DocId&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public int CheckOutDocument(int DocId)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                UserDetail ud = UserDetail.GetCurrentUserDetail();
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTChangeStatus&quot;);

                conn.DB.AddInParameter(cmd, &quot;DOCID&quot;, DbType.Int32, DocId);
                conn.DB.AddInParameter(cmd, &quot;USERID&quot;, DbType.Int32, ud.UID);
                conn.DB.AddInParameter(cmd, &quot;USERNAME&quot;, DbType.String, ud.UserName);
                conn.DB.AddInParameter(cmd, &quot;DESCRIPTION&quot;, DbType.String, &quot;&quot;);
                conn.DB.AddInParameter(cmd, &quot;UPDATEDATE&quot;, DbType.DateTime, DateTime.UtcNow);
                conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                conn.DB.ExecuteScalar(cmd);

                return conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();
            }
        }

        /// &lt;summary&gt;
        /// gets the document details for the storage id
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;storageId&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public Document GetDocumentDetails(string storageId)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                Document DTOobj = new Document();
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetDocumentDetails&quot;);

                conn.DB.AddInParameter(cmd, &quot;STORAGEID&quot;, DbType.String, storageId);

                using (IDataReader reader = conn.DB.ExecuteReader(cmd))
                {
                    if (reader.Read())
                        PopulateDocumentDTO(reader, DTOobj);
                    if (reader.NextResult() &amp;&amp; reader.Read())
                        DTOobj.FolderDetails = PopulateFolderDTO(reader);
                }
                return DTOobj;
            }
        }

        /// &lt;summary&gt;
        /// changes the status of document to check in
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;docid&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;checkindesc&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;int&lt;/returns&gt;
        public int CheckInDocument(int docid, string checkindesc)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                UserDetail ud = UserDetail.GetCurrentUserDetail();

                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTChangeStatus&quot;);

                conn.DB.AddInParameter(cmd, &quot;DOCID&quot;, DbType.Int32, docid);
                conn.DB.AddInParameter(cmd, &quot;USERID&quot;, DbType.Int32, ud.UID);
                conn.DB.AddInParameter(cmd, &quot;USERNAME&quot;, DbType.String, ud.UserName);
                conn.DB.AddInParameter(cmd, &quot;DESC&quot;, DbType.String, checkindesc);
                conn.DB.AddInParameter(cmd, &quot;UPDATEDATE&quot;, DbType.DateTime, DateTime.UtcNow);
                conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                conn.DB.ExecuteScalar(cmd);

                return conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();
            }
        }

        //change made for archiving and moving documents //original changesby Akila
        public void SaveVersiondescription(int docid, int VERSIONNO, string checkindesc)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                UserDetail ud = UserDetail.GetCurrentUserDetail();

                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTSaveVersiondescription&quot;);

                conn.DB.AddInParameter(cmd, &quot;DOCID&quot;, DbType.Int32, docid);
                conn.DB.AddInParameter(cmd, &quot;VERSIONNO&quot;, DbType.Int32, VERSIONNO);
                conn.DB.AddInParameter(cmd, &quot;DESC&quot;, DbType.String, checkindesc);
                conn.DB.ExecuteScalar(cmd);
            }
        }

        /// &lt;summary&gt;
        /// gets the highest version number for the document
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;docid&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public int GetVersion(int docid)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetVersion&quot;);

                conn.DB.AddInParameter(cmd, &quot;DOCID&quot;, DbType.Int32, docid);
                conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.String, 100);
                conn.DB.ExecuteScalar(cmd);

                return conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();
            }
        }

        /// &lt;summary&gt;
        /// changes status of document to checked in without saving changes
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;DocId&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;int&lt;/returns&gt;
        public int UndoCheckOut(int DocId)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTUndoCheckOut&quot;);

                conn.DB.AddInParameter(cmd, &quot;DOCID&quot;, DbType.Int32, DocId);
                conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                conn.DB.ExecuteScalar(cmd);

                return conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();
            }
        }

        /// &lt;summary&gt;
        /// deletes a docment from DB
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;DocId&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public int DeleteDocument(int DocId)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTDeleteDocument&quot;);

                conn.DB.AddInParameter(cmd, &quot;DOCID&quot;, DbType.Int32, DocId);
                conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                conn.DB.ExecuteScalar(cmd);

                return conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();
            }
        }

        /// &lt;summary&gt;
        /// gets the details of a doc 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;docid&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public Document ViewDocumentDetails(int docid, string company = null)
        {
            string conStr = ConnectionHelper.GetConnectionString(company);

            using (var conn = new ConnHolder(conStr))
            {
                Document DTOobj = new Document();
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTViewDocument&quot;);

                conn.DB.AddInParameter(cmd, &quot;DOCID&quot;, DbType.String, docid);

                using (IDataReader reader = conn.DB.ExecuteReader(cmd))
                {
                    if (reader.Read())
                        PopulateDocumentDTO(reader, DTOobj);
                    if (reader.NextResult() &amp;&amp; reader.Read())
                        DTOobj.FolderDetails = PopulateFolderDTO(reader);
                }
                return DTOobj;
            }
        }

        public Document ViewDocumentDetailsFor(string company, int docid)
        {
            return ViewDocumentDetails(docid, company);
        }

        public Document GetDocumentWithDocIDandVerNo(int docid, int versionNo, string company = null)
        {
            string conStr = ConnectionHelper.GetConnectionString(company);

            using (var conn = new ConnHolder(conStr))
            {
                Document DTOobj = new Document();
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTViewDocumentWithVersionNo&quot;);

                conn.DB.AddInParameter(cmd, &quot;DOCID&quot;, DbType.String, docid);
                conn.DB.AddInParameter(cmd, &quot;VersionNo&quot;, DbType.Int32, versionNo);

                using (IDataReader reader = conn.DB.ExecuteReader(cmd))
                {
                    if (reader.Read())
                        PopulateDocumentDTO(reader, DTOobj);
                    if (reader.NextResult() &amp;&amp; reader.Read())
                        DTOobj.FolderDetails = PopulateFolderDTO(reader);
                }
                return DTOobj;
            }
        }

        private void PopulateDocumentDTO(IDataReader dr, Document dto)
        {
            dto.DocId = dr.GetInt32(dr.GetOrdinal(&quot;DocId&quot;));
            dto.DocName = dr.GetString(dr.GetOrdinal(&quot;DocName&quot;));
            dto.DocDesc = dr.GetString(dr.GetOrdinal(&quot;DocDesc&quot;));
            dto.AuthorName = dr.GetString(dr.GetOrdinal(&quot;AuthorName&quot;));
            dto.CreationDate = dr.GetDateTime(dr.GetOrdinal(&quot;CreationDate&quot;));
            dto.UpdationDate = dr.GetDateTime(dr.GetOrdinal(&quot;UpdationDate&quot;));
            dto.DocSize = dr.GetString(dr.GetOrdinal(&quot;DocSize&quot;));
            dto.StorageId = dr.GetString(dr.GetOrdinal(&quot;StorageId&quot;));
            dto.ParentId = dr.GetInt32(dr.GetOrdinal(&quot;ParentId&quot;));
            dto.DocType = dr.GetInt32(dr.GetOrdinal(&quot;TypeId&quot;));
            dto.Status = dr.GetBoolean(dr.GetOrdinal(&quot;Status&quot;));
            dto.FolderId = dr.GetInt32(dr.GetOrdinal(&quot;FolderId&quot;));
            dto.VersionNo = dr.GetInt32(dr.GetOrdinal(&quot;VersionNumber&quot;));
            dto.Author = dr.GetInt32(dr.GetOrdinal(&quot;Author&quot;));
            dto.XMLInfo = dr.GetString(dr.GetOrdinal(&quot;XMLInfo&quot;));
            dto.SPName = dr.GetString(dr.GetOrdinal(&quot;SPFILENAME&quot;));
            dto.UpdatedBy = dr.GetInt32(dr.GetOrdinal(&quot;UpdatedBy&quot;));
            dto.CheckedBy = dr.GetInt32(dr.GetOrdinal(&quot;CheckedBy&quot;));

            dr.GetSchemaTable().DefaultView.RowFilter = string.Format(&quot;ColumnName= &#39;{0}&#39;&quot;, &quot;DocTypeDesc&quot;);
            if (dr.GetSchemaTable().DefaultView.Count &gt; 0)
            {
                int index = dr.GetOrdinal(&quot;DocTypeDesc&quot;);
                if (!dr.IsDBNull(index))
                    dto.DocTypeDesc = dr.GetString(index);
            }

            dr.GetSchemaTable().DefaultView.RowFilter = string.Format(&quot;ColumnName= &#39;{0}&#39;&quot;, &quot;SrcModuleID&quot;);
            if (dr.GetSchemaTable().DefaultView.Count &gt; 0)
            {
                int index = dr.GetOrdinal(&quot;SrcModuleID&quot;);
                if (!dr.IsDBNull(index))
                    dto.SrcModuleID = dr.GetString(index);
            }

            dr.GetSchemaTable().DefaultView.RowFilter = string.Format(&quot;ColumnName= &#39;{0}&#39;&quot;, &quot;SrcID&quot;);
            if (dr.GetSchemaTable().DefaultView.Count &gt; 0)
            {
                int index = dr.GetOrdinal(&quot;SrcID&quot;);
                if (!dr.IsDBNull(index))
                    dto.SrcID = dr.GetString(index);
            }

            dr.GetSchemaTable().DefaultView.RowFilter = string.Format(&quot;ColumnName= &#39;{0}&#39;&quot;, &quot;DocType&quot;);
            if (dr.GetSchemaTable().DefaultView.Count &gt; 0)
            {
                int index = dr.GetOrdinal(&quot;DocType&quot;);
                if (!dr.IsDBNull(index))
                    dto.DocumentType = (DocumentType)dr.GetInt32(index);
            }

            dr.GetSchemaTable().DefaultView.RowFilter = string.Format(&quot;ColumnName= &#39;{0}&#39;&quot;, &quot;SignLockedBy&quot;);
            if (dr.GetSchemaTable().DefaultView.Count &gt; 0)
            {
                int index = dr.GetOrdinal(&quot;SignLockedBy&quot;);
                if (!dr.IsDBNull(index))
                    dto.SignLockedBy = dr.GetString(index);
            }

            dr.GetSchemaTable().DefaultView.RowFilter = string.Format(&quot;ColumnName= &#39;{0}&#39;&quot;, &quot;SignLockedOn&quot;);
            if (dr.GetSchemaTable().DefaultView.Count &gt; 0)
            {
                int index = dr.GetOrdinal(&quot;SignLockedOn&quot;);
                if (!dr.IsDBNull(index))
                    dto.SignLockedOn = dr.GetDateTime(dr.GetOrdinal(&quot;SignLockedOn&quot;));
            }

            dr.GetSchemaTable().DefaultView.RowFilter = string.Format(&quot;ColumnName= &#39;{0}&#39;&quot;, &quot;SignedDocID&quot;);
            if (dr.GetSchemaTable().DefaultView.Count &gt; 0)
            {
                int index = dr.GetOrdinal(&quot;SignedDocID&quot;);
                if (!dr.IsDBNull(index))
                    dto.SignedDocID = dr.GetInt32(dr.GetOrdinal(&quot;SignedDocID&quot;));
            }

            dr.GetSchemaTable().DefaultView.RowFilter = string.Format(&quot;ColumnName= &#39;{0}&#39;&quot;, &quot;AssociationType&quot;);
            if (dr.GetSchemaTable().DefaultView.Count &gt; 0)
                dto.ChildAssociationType = dr.GetString(dr.GetOrdinal(&quot;AssociationType&quot;));

            dr.GetSchemaTable().DefaultView.RowFilter = string.Format(&quot;ColumnName= &#39;{0}&#39;&quot;, &quot;DisplayDocName&quot;);
            if (dr.GetSchemaTable().DefaultView.Count &gt; 0)
            {
                dto.DisplayDocName = dr.GetString(dr.GetOrdinal(&quot;DisplayDocName&quot;));
            }
        }

        /// &lt;summary&gt;
        /// gets the search fields for the doc module
        /// &lt;/summary&gt;
        /// &lt;returns&gt;xml string&lt;/returns&gt;
        public string GetSearchCriteria()
        {
            return &quot;&lt;SearchCriterion module=\&quot;DOCMGMT\&quot;&gt;&quot;
                   + &quot;&lt;Type name=\&quot;Document\&quot;&gt;&quot;
                   + &quot;&lt;searchfield&gt;DocName&lt;/searchfield&gt;&quot;
                   + &quot;&lt;searchfield&gt;DocDesc&lt;/searchfield&gt;&quot;
                   + &quot;&lt;searchfield&gt;AuthorName&lt;/searchfield&gt;&quot;
                   + &quot;&lt;/Type&gt;&quot;
                   + &quot;&lt;/SearchCriterion&gt;&quot;;
        }

        /// &lt;summary&gt;
        /// gets the search results from DB from search field and keyword
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;searchfield&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;keyword&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;xml string&lt;/returns&gt;
        public DataTable GetSearchResults(string searchfield, string keyword)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTSearchForCriteria&quot;);

                conn.DB.AddInParameter(cmd, &quot;SearchCriteria&quot;, DbType.String, searchfield);
                conn.DB.AddInParameter(cmd, &quot;Keyword&quot;, DbType.String, keyword);

                return conn.DB.ExecuteDataSet(cmd).Tables[0];
            }
        }

        /// &lt;summary&gt;
        /// Gets the collection of storage ids of all documents in a particular folder
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;folderid&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public Dictionary&lt;int, string&gt; GetStorageIDs(int folderid)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetFolderDocuments&quot;);
                Dictionary&lt;int, string&gt; DocColl = new Dictionary&lt;int, string&gt;();

                conn.DB.AddInParameter(cmd, &quot;FolderId&quot;, DbType.Int32, folderid);

                using (IDataReader reader = conn.DB.ExecuteReader(cmd))
                {
                    while (reader.Read()) //adding docid and storage id in dictionary
                        DocColl.Add(reader.GetInt32(reader.GetOrdinal(&quot;DocId&quot;)),
                            reader.GetString(reader.GetOrdinal(&quot;StorageId&quot;)));
                }
                return DocColl;
            }
        }

        /// &lt;summary&gt;
        /// gets the docids from LinkMod table
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;ProjId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;ModuleId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;MimeType&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;List of docids&lt;/returns&gt;
        public List&lt;Document&gt; GetAttachments(int ProjId, string ModuleId, string MimeType)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetAttachments&quot;);
                var DocDTOList = new List&lt;Document&gt;();

                conn.DB.AddInParameter(cmd, &quot;PROJECTID&quot;, DbType.Int32, ProjId);
                conn.DB.AddInParameter(cmd, &quot;MODULEID&quot;, DbType.String, ModuleId);
                conn.DB.AddInParameter(cmd, &quot;MIMETYPE&quot;, DbType.String, MimeType);

                using (IDataReader reader = conn.DB.ExecuteReader(cmd))
                {
                    while (reader.Read())
                    {
                        DocDTOList.Add(new Document()
                        {
                            DocName = reader.GetString(reader.GetOrdinal(&quot;DocName&quot;)),
                            DocDesc = reader.GetString(reader.GetOrdinal(&quot;DocDesc&quot;)),
                            StorageId = reader.GetString(reader.GetOrdinal(&quot;StorageId&quot;)),
                            DocId = reader.GetInt32(reader.GetOrdinal(&quot;DocId&quot;)),
                        });
                    }
                }
                return DocDTOList;
            }
        }

        /// &lt;summary&gt;
        /// deletes all attachments of the module from the folder
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;FolderID&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public int DeleteAttachments(int FolderID)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTDeleteAttachments&quot;);

                conn.DB.AddInParameter(cmd, &quot;FOLDERID&quot;, DbType.Int32, FolderID);
                conn.DB.AddOutParameter(cmd, &quot;STATUS&quot;, DbType.Int32, 4);
                conn.DB.ExecuteScalar(cmd);

                return conn.DB.GetParameterValue(cmd, &quot;STATUS&quot;).ToString2().ToInt32_2();
            }
        }

        /// &lt;summary&gt;
        /// Gets parent folderid for a module
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;ModuleId&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public int GetParentFolderIdForModule(string InstanceID, string ModuleID, string ParentModuleID,
            int? ParentInstanceID)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetParentFolderIdForModule&quot;);

                conn.DB.AddInParameter(cmd, &quot;ModuleID&quot;, DbType.String, ModuleID);
                conn.DB.AddInParameter(cmd, &quot;InstanceID&quot;, DbType.String, InstanceID);
                if (!string.IsNullOrEmpty(ParentModuleID))
                    conn.DB.AddInParameter(cmd, &quot;ParentModuleID&quot;, DbType.String, ParentModuleID);
                if (ParentInstanceID.HasValue)
                    conn.DB.AddInParameter(cmd, &quot;ParentInstanceID&quot;, DbType.Int32, ParentInstanceID);
                conn.DB.AddOutParameter(cmd, &quot;FolderID&quot;, DbType.Int32, 4);
                conn.DB.ExecuteScalar(cmd);

                return conn.DB.GetParameterValue(cmd, &quot;FolderID&quot;).ToString2().ToInt32_2();
            }
        }

        public Folder GetInstanceRootFolder(int InstanceId, string ModuleId)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetInstanceRootFolder&quot;);

                conn.DB.AddInParameter(cmd, &quot;INSTANCEID&quot;, DbType.String, InstanceId);
                conn.DB.AddInParameter(cmd, &quot;MODULEID&quot;, DbType.String, ModuleId);

                using (IDataReader dr = conn.DB.ExecuteReader(cmd))
                {
                    if (dr.Read())
                        return PopulateFolderDTO(dr);
                }

                return new Folder();
            }
        }

        public DataTable GetProjectsRootFolder(List&lt;string&gt; projects, bool isSingleProjectMode)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetProjectRootFolder&quot;);

                conn.DB.AddInParameter(cmd, &quot;PROJECTIDS&quot;, DbType.String, string.Join(&quot;,&quot;, projects));
                conn.DB.AddInParameter(cmd, &quot;ISSINGLEPROJECTMODE&quot;, DbType.Boolean, isSingleProjectMode);

                return conn.DB.ExecuteDataSet(cmd).Tables[0];
            }
        }

        internal DataTable GetModuleDocuments(string ModuleID, string qryInstanceIDs)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetModuleDocuments&quot;);
                conn.DB.AddInParameter(cmd, &quot;ModuleID&quot;, DbType.String, ModuleID);
                conn.DB.AddInParameter(cmd, &quot;qryInstanceIDs&quot;, DbType.String, qryInstanceIDs);
                return conn.DB.ExecuteDataSet(cmd).Tables[0];
            }
        }

        internal DataTable GetProjectAssociation(int projectID, string moduleID)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_PROJECTGetProjectModules&quot;);
                conn.DB.AddInParameter(cmd, &quot;in_ProjectID&quot;, DbType.Int32, projectID);
                conn.DB.AddInParameter(cmd, &quot;ModuleID&quot;, DbType.String, moduleID);

                return conn.DB.ExecuteDataSet(cmd).Tables[0];
            }
        }

        internal DataSet GetFolderPermissions(int projectId, int folderId, int rid, int uid)
        {
            DataSet ds = new DataSet();
            var dic = new Dictionary&lt;string, object&gt;();
            ds =
                ComponentHelper.Instance.ExecuteDataSet(
                    DocumentManagementBL.DocumentStoredProcedure.usp_DOCMGMTGetFolderPermissions, dic, projectId,
                    folderId, rid, uid).Copy();
            bool status;
            status = dic[&quot;IsInherited&quot;].ToString() == &quot;1&quot; ? true : false;
            DataTable dt = new DataTable(&quot;IsInherited&quot;);
            dt.Columns.Add(&quot;IsInherited&quot;);
            dt.Rows.Add(new object[] { status });
            ds.Tables.Add(dt);
            return ds;
        }

        internal DataSet GetFolderPermissions(int folderId, int projectId, string moduleId, int instanceId, int userID, int roleId = 0)
        {
            return ComponentHelper.Instance.ExecuteDataSet(
                    DocumentManagementBL.DocumentStoredProcedure.usp_DOCMGMTGetFolderPermissionsByParams, null, projectId, moduleId,
                    instanceId, folderId, roleId, userID).Copy();
        }

        internal bool CreateUpdateFolderPermissions(string xmlPermissions)
        {
            var dic = new Dictionary&lt;string, object&gt;();
            ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                DocumentManagementBL.DocumentStoredProcedure.usp_DOCMGMTCUPermissions, dic, xmlPermissions);
            bool status;
            status = dic[&quot;IsSaved&quot;].ToString() == &quot;1&quot; ? true : false;

            return status;
        }

        public void CreateVersion(int docid, string comments, int versionNo, int userID, string userName, string newFile)
        {
            using (ConnHolder conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTAddDocumentVersion&quot;);
                conn.DB.AddInParameter(cmd, &quot;DocId&quot;, DbType.Int32, docid);
                conn.DB.AddInParameter(cmd, &quot;VersionNumber&quot;, DbType.Int32, versionNo);
                conn.DB.AddInParameter(cmd, &quot;Comments&quot;, DbType.String, comments);
                conn.DB.AddInParameter(cmd, &quot;CreatedBy&quot;, DbType.Int32, userID);
                conn.DB.AddInParameter(cmd, &quot;CreatedByName&quot;, DbType.String, userName);
                conn.DB.AddInParameter(cmd, &quot;StorageId&quot;, DbType.String, newFile);
                conn.DB.ExecuteNonQuery(cmd);
            }
        }

        internal DataSet GetVersions(int docid)
        {
            try
            {
                using (ConnHolder conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetDocumentVersions&quot;);
                    conn.DB.AddInParameter(cmd, &quot;DocId&quot;, DbType.Int32, docid);
                    return conn.DB.ExecuteDataSet(cmd);
                }
            }
            catch (Exception)
            {
                return new DataSet();
            }
        }

        // for comment Log
        public void AddCommentLog(CommentLogDTO dtoCommentLog)
        {
            ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                DocumentStoredProcedure.usp_DOCMGMTInsertCommentLog, null,
                dtoCommentLog.DocId, dtoCommentLog.CommentDate, dtoCommentLog.LoggedBy, dtoCommentLog.LogById,
                dtoCommentLog.Comments, dtoCommentLog.ReferenceNo);
        }

        public void DeleteCommentLog(string commentLogIds)
        {
            ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                DocumentStoredProcedure.usp_DOCMGMTDeleteCommentLog, null, commentLogIds);
        }

        public DataSet GetCommentLog(CommentLogDTO dtoCommentLog)
        {
            return ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTGetCommentLog, null,
                dtoCommentLog.DocId);
        }

        public void UpdateCommentLog(CommentLogDTO dtoCommentLog)
        {
            ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                DocumentStoredProcedure.usp_DOCMGMTUpdateCommentLog, null,
                dtoCommentLog.CommentLogId, dtoCommentLog.RespondedBy, dtoCommentLog.RespondById,
                dtoCommentLog.RespondedOn, dtoCommentLog.Response, dtoCommentLog.Complete, dtoCommentLog.ReferenceNo, dtoCommentLog.Comments);
        }

        //added for change to upload multiple documents and archive //originally developed by Akila
        public void SaveDocumentContent(string storageId, string documentName, string documentType,
            byte[] documentContent, string documentDescription)
        {
            using (ConnHolder conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTSaveDocumentContent&quot;);
                cmd.CommandTimeout = 600;
                conn.DB.AddInParameter(cmd, &quot;StorageID&quot;, DbType.String, storageId);
                conn.DB.AddInParameter(cmd, &quot;DocumentName&quot;, DbType.String, documentName);
                conn.DB.AddInParameter(cmd, &quot;DocumentType&quot;, DbType.String, documentType);
                conn.DB.AddInParameter(cmd, &quot;DocumentContent&quot;, DbType.Binary, documentContent);
                conn.DB.AddInParameter(cmd, &quot;DocumentDescription&quot;, DbType.String, documentDescription);

                conn.DB.ExecuteNonQuery(cmd);
            }
        }

        public DataSet SearchAllDocuments(int projectID, string searchMode, string allWords, string exactWords,
            bool includeSynonyms, string notContains,
            string author, string title, string tags, string fileTypes, int lastModified, int folderId,
            bool recursiveSearch, int roleId,
            int createdBy, int createdOn, int modifiedBy)
        {
            DataSet ds = new DataSet();
            using (ConnHolder conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTSearchAllDocuments&quot;);
                conn.DB.AddInParameter(cmd, &quot;ProjectID&quot;, DbType.Int32, projectID);
                conn.DB.AddInParameter(cmd, &quot;SearchMode&quot;, DbType.String, searchMode);
                conn.DB.AddInParameter(cmd, &quot;AllWords&quot;, DbType.String, allWords);
                conn.DB.AddInParameter(cmd, &quot;ExactWords&quot;, DbType.String, exactWords);
                conn.DB.AddInParameter(cmd, &quot;IncludeSynonymns&quot;, DbType.Boolean, includeSynonyms);
                conn.DB.AddInParameter(cmd, &quot;NotContains&quot;, DbType.String, notContains);
                conn.DB.AddInParameter(cmd, &quot;Author&quot;, DbType.String, author);
                conn.DB.AddInParameter(cmd, &quot;Title&quot;, DbType.String, title);
                conn.DB.AddInParameter(cmd, &quot;Tags&quot;, DbType.String, tags);
                conn.DB.AddInParameter(cmd, &quot;FileTypes&quot;, DbType.String, fileTypes);
                conn.DB.AddInParameter(cmd, &quot;LastModified&quot;, DbType.Int32, lastModified);
                conn.DB.AddInParameter(cmd, &quot;FolderId&quot;, DbType.Int32, folderId);
                conn.DB.AddInParameter(cmd, &quot;RoleId&quot;, DbType.Int32, roleId);
                conn.DB.AddInParameter(cmd, &quot;RecursiveSearch&quot;, DbType.Boolean, recursiveSearch);
                conn.DB.AddInParameter(cmd, &quot;CreatedBy&quot;, DbType.Int32, createdBy);
                conn.DB.AddInParameter(cmd, &quot;CreatedOn&quot;, DbType.Int32, createdOn);
                conn.DB.AddInParameter(cmd, &quot;ModifiedBy&quot;, DbType.Int32, modifiedBy);

                ds = conn.DB.ExecuteDataSet(cmd);
            }

            return ds;
        }

        public void DeleteDocumentContent(string docIds)
        {
            using (ConnHolder conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTDeleteDocumentContent&quot;);
                conn.DB.AddInParameter(cmd, &quot;DocIds&quot;, DbType.String, docIds);
                conn.DB.ExecuteNonQuery(cmd);
            }
        }

        public DataSet GetAllDocumentFolders(string moduleId, int instanceId, int RoleId, string strProjectDocument,
            string strEstimteDocument, string strContractDocument, string strSystemFolders)
        {
            using (ConnHolder conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetAllDocumentFolder&quot;);
                conn.DB.AddInParameter(cmd, &quot;ModuleId&quot;, DbType.String, moduleId);
                conn.DB.AddInParameter(cmd, &quot;InstanceId&quot;, DbType.Int32, instanceId);
                conn.DB.AddInParameter(cmd, &quot;RoleId&quot;, DbType.Int32, RoleId);
                conn.DB.AddInParameter(cmd, &quot;ProjectDoc&quot;, DbType.String, strProjectDocument);
                conn.DB.AddInParameter(cmd, &quot;EstimateDoc&quot;, DbType.String, strEstimteDocument);
                conn.DB.AddInParameter(cmd, &quot;ContractDoc&quot;, DbType.String, strContractDocument);
                conn.DB.AddInParameter(cmd, &quot;IsSystemFolders&quot;, DbType.String, strSystemFolders);
                return conn.DB.ExecuteDataSet(cmd);
            }
        }

        public void UpdateActivityLog(string Type, int EntityId, string Activity, string LogMessage, int UID = 0)
        {
            using (ConnHolder conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                if (UID == 0)
                {
                    UserDetail ud = UserDetail.GetCurrentUserDetail();
                    UID = ud.UID;
                }
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTCreateActivityLog&quot;);
                conn.DB.AddInParameter(cmd, &quot;Type&quot;, DbType.String, Type);
                conn.DB.AddInParameter(cmd, &quot;EntityId&quot;, DbType.Int32, EntityId);
                conn.DB.AddInParameter(cmd, &quot;Activity&quot;, DbType.Xml, &quot;&lt;ROOT&gt;&quot; + Activity + &quot;&lt;/ROOT&gt;&quot;);
                conn.DB.AddInParameter(cmd, &quot;LogMessage&quot;, DbType.String, LogMessage);
                conn.DB.AddInParameter(cmd, &quot;UserId&quot;, DbType.Int32, UID);
                conn.DB.ExecuteDataSet(cmd);
            }
        }

        public DataSet GetRecentActivities(int NoRecords, int ProjectID, int RoleId)
        {
            using (ConnHolder conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetRecentActivityLog&quot;);
                conn.DB.AddInParameter(cmd, &quot;NoRecords&quot;, DbType.Int32, NoRecords);
                conn.DB.AddInParameter(cmd, &quot;ProjectID&quot;, DbType.Int32, ProjectID);
                conn.DB.AddInParameter(cmd, &quot;RoleId&quot;, DbType.Int32, RoleId);
                return conn.DB.ExecuteDataSet(cmd);
            }
        }

        internal DataSet GetAllFilesAndFolders(int folderId, int instanceId, string moduleCode, string roleIds)
        {
            DataSet ds = new DataSet();

            ds =
                ComponentHelper.Instance.ExecuteDataSet(
                    DocumentManagementBL.DocumentStoredProcedure.usp_DOCMGMTGetAllFilesAndFolders, null, folderId,
                    instanceId, moduleCode, roleIds);

            return ds;
        }

        internal DataSet GetAllFolders(int folderId, int instanceId, string moduleCode)
        {
            DataSet ds = new DataSet();

            ds =
                ComponentHelper.Instance.ExecuteDataSet(
                    DocumentManagementBL.DocumentStoredProcedure.usp_DOCMGMTGetAllFolders, null, folderId, instanceId,
                    moduleCode);

            return ds;
        }

        public DataTable GetDocumentsByNameAndFolderId(string docName, int folderID)
        {
            return ComponentHelper.Instance.ExecuteDataSet(DocumentManagementBL.DocumentStoredProcedure.usp_DOCMGMTGetDocumentsByNameAndFolderId, null, docName, folderID).Tables[0];
        }

        /// &lt;summary&gt;
        /// Gets all the documents in the Project.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;projectID&quot;&gt;Project ID for which the documents are to be fetched.&lt;/param&gt;
        /// &lt;returns&gt;DataSet with details of the documents for the project.&lt;/returns&gt;
        public DataSet GetDocumentsByProject(int projectID)
        {
            return
                ComponentHelper.Instance.ExecuteDataSet(
                    DocumentManagementBL.DocumentStoredProcedure.usp_DOCMGMTGetDocumentsByProject, null, projectID);
        }

        /// &lt;summary&gt;
        /// Deletes all the documents that are associated to master documents by the specified assocaition type.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;masterDocID&quot;&gt;Document ID of the master document for which the associated documents are to be deleted.&lt;/param&gt;
        /// &lt;param name=&quot;associationType&quot;&gt;The type of association to be deleted.&lt;/param&gt;
        public void DeleteAllAssociatedDocs(int masterDocID, int associationType)
        {
            ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                DocumentStoredProcedure.usp_DOCMGMTDeleteAllAssociatedDocs, null,
                masterDocID, associationType);
        }

        internal DataSet GetAllAssociationTypes()
        {
            using (ConnHolder conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetAllAssociationTypes&quot;);
                return conn.DB.ExecuteDataSet(cmd);
            }
        }

        internal void CreateAssociation(int MasterDocId, string AsosciatedDocPath, int? AssociatedDocId,
            int AssociationTypeId, int VersionNo = 1)
        {
            using (ConnHolder conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTCreateAssociatedDocs&quot;);
                conn.DB.AddInParameter(cmd, &quot;MasterDocID&quot;, DbType.Int32, MasterDocId);
                conn.DB.AddInParameter(cmd, &quot;AssociatedDocumentPath&quot;, DbType.String, AsosciatedDocPath);
                conn.DB.AddInParameter(cmd, &quot;AssociatedDocid&quot;, DbType.Int32, AssociatedDocId);
                conn.DB.AddInParameter(cmd, &quot;AssociationTypeID&quot;, DbType.Int32, AssociationTypeId);
                conn.DB.AddInParameter(cmd, &quot;VersionNo&quot;, DbType.Int32, VersionNo);
                conn.DB.ExecuteNonQuery(cmd);
            }
        }

        internal DataSet GetAssociatedDocs(int docId, int? associationType = null)
        {
            DataSet ds = new DataSet();

            ds =
                ComponentHelper.Instance.ExecuteDataSet(
                    DocumentManagementBL.DocumentStoredProcedure.usp_DOCMGMTGetAssociatedDocsByDocId, null, docId,
                    associationType);

            return ds;
        }

        internal DataSet GetMissingAssociatedDocs(int docId)
        {
            DataSet ds = new DataSet();

            ds =
                ComponentHelper.Instance.ExecuteDataSet(
                    DocumentManagementBL.DocumentStoredProcedure.usp_DOCMGMTGetMissingAssociatedDocsByDocId, null, docId);

            return ds;
        }

        internal DataSet GetAllDocumentsandFoldersWithRootFolder(string moduleId, int instanceId, int RoleId,
            string strProjectDocument, string strEstimteDocument, string strContractDocument, string strSystemFolders)
        {
            using (ConnHolder conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetAllDocumentsandFoldersWithRootFolder&quot;);
                conn.DB.AddInParameter(cmd, &quot;ModuleId&quot;, DbType.String, moduleId);
                conn.DB.AddInParameter(cmd, &quot;InstanceId&quot;, DbType.Int32, instanceId);
                conn.DB.AddInParameter(cmd, &quot;RoleId&quot;, DbType.Int32, RoleId);
                conn.DB.AddInParameter(cmd, &quot;ProjectDoc&quot;, DbType.String, strProjectDocument);
                conn.DB.AddInParameter(cmd, &quot;EstimateDoc&quot;, DbType.String, strEstimteDocument);
                conn.DB.AddInParameter(cmd, &quot;ContractDoc&quot;, DbType.String, strContractDocument);
                conn.DB.AddInParameter(cmd, &quot;IsSystemFolders&quot;, DbType.String, strSystemFolders);
                return conn.DB.ExecuteDataSet(cmd);
            }
        }

        public Document GetMasterDocDetails(int AssociatedDocId)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                Document DTOobj = new Document();
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetMasterDoc&quot;);

                conn.DB.AddInParameter(cmd, &quot;AssociatedDocId&quot;, DbType.String, AssociatedDocId);

                using (IDataReader reader = conn.DB.ExecuteReader(cmd))
                {
                    if (reader.Read())
                        PopulateDocumentDTO(reader, DTOobj);
                }
                return DTOobj;
            }
        }

        internal void DeleteAssociations(string DocIds)
        {
            ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                DocumentStoredProcedure.usp_DOCMGMTDeleteAssociations, null,
                DocIds);
        }


        /// &lt;summary&gt;
        /// Gets the document details required to redirect to document list page.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;docId&quot;&gt;Document id for which details are required&lt;/param&gt;
        /// &lt;returns&gt;DataSet with document details&lt;/returns&gt;
        public DataSet GetDocumentDetailsForURL(int docId)
        {
            return ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTGetDocumentDetailsForURL,
                null,
                docId);
        }

        /// &lt;summary&gt;
        /// Gets Association Type from Association TypeId
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;associationType&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;string&lt;/returns&gt;
        public string GetAssociationType(int associationType)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetAssociationType&quot;);

                conn.DB.AddInParameter(cmd, &quot;AssociationTypeID&quot;, DbType.Int32, associationType);
                conn.DB.AddOutParameter(cmd, &quot;AssociationType&quot;, DbType.String, 500);
                conn.DB.ExecuteScalar(cmd);
                return conn.DB.GetParameterValue(cmd, &quot;AssociationType&quot;).ToString2();
            }
        }

        /// &lt;summary&gt;
        /// Deletes all the associations for a document.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;docIds&quot;&gt;DocId of the document for which associations is to be deleted.&lt;/param&gt;
        public void DeleteAllAssociationsForDocument(string docIds)
        {
            ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                DocumentStoredProcedure.usp_DOCMGMTDeleteAllAssociationsForDocument, null,
                docIds);
        }

        internal void DeleteSelectedAssociationsForDocument(DataTable associationToBeRemoved)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTDeleteSelectedAssociationsForDocument&quot;);

                SqlParameter parameter = new SqlParameter();
                parameter.ParameterName = &quot;@Associations&quot;;
                parameter.SqlDbType = System.Data.SqlDbType.Structured;
                parameter.Value = associationToBeRemoved;
                cmd.Parameters.Add(parameter);
                conn.DB.ExecuteScalar(cmd);
            }
        }

        /// &lt;summary&gt;
        /// Send Email Notification on Document CheckIn
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;docId&quot;&gt;&lt;/param&gt;
        public DataSet GetCheckinNotificationDetails(int docId, int projectId)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetCheckinNotificationDetails&quot;);
                    conn.DB.AddInParameter(cmd, &quot;DocId&quot;, DbType.Int32, docId);
                    conn.DB.AddInParameter(cmd, &quot;ProjectID&quot;, DbType.Int32, projectId);
                    return conn.DB.ExecuteDataSet(cmd);
                }
            }
            catch (Exception)
            {
                return new DataSet();
            }
        }

        public DataSet GetDocumentMetadataDetails(int docId, string revisionNumber, DateTime updatedOn)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetDocumentMetaDataChanges&quot;);
                    conn.DB.AddInParameter(cmd, &quot;DocId&quot;, DbType.Int32, docId);
                    conn.DB.AddInParameter(cmd, &quot;RevisionNumber&quot;, DbType.String, revisionNumber);
                    conn.DB.AddInParameter(cmd, &quot;UpdatedOn&quot;, DbType.DateTime, updatedOn);
                    return conn.DB.ExecuteDataSet(cmd);
                }
            }
            catch (Exception)
            {
                return new DataSet();
            }
        }

        /// &lt;summary&gt;
        /// Get the document details for a specific docid
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;DocumentID&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public List&lt;Document&gt; GetDocumentBasedOnDocumentID(string DocumentIDs)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetDocumentDetailsByDocID&quot;);
                List&lt;Document&gt; DocumentList = new List&lt;Document&gt;();
                conn.DB.AddInParameter(cmd, &quot;DOCIDS&quot;, DbType.String, DocumentIDs);

                using (IDataReader reader = conn.DB.ExecuteReader(cmd))
                {
                    while (reader.Read())
                    {
                        Document DTOobj = new Document();
                        PopulateDocumentDTO(reader, DTOobj);
                        DocumentList.Add(DTOobj);
                    }
                }

                return DocumentList;
            }
        }

        internal DataTable GetFolderRulesForMD(string selectedMetadata)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetFolderRulesForMetaData&quot;);
                    conn.DB.AddInParameter(cmd, &quot;MetaData&quot;, DbType.String, selectedMetadata);
                    DataSet ds = conn.DB.ExecuteDataSet(cmd);
                    if (ds.Tables.Count &gt; 0) return ds.Tables[0];
                    else return new DataTable();
                }
            }
            catch (Exception)
            {
                return new DataTable();
            }
        }

        internal DataTable GetFolderMappingForMD(string selectedMetadata)
        {
            try
            {
                using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
                {
                    DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetFolderMappingForMetaData&quot;);
                    conn.DB.AddInParameter(cmd, &quot;MetaData&quot;, DbType.String, selectedMetadata);
                    DataSet ds = conn.DB.ExecuteDataSet(cmd);
                    if (ds.Tables.Count &gt; 0) return ds.Tables[0];
                    else return new DataTable();
                }
            }
            catch (Exception)
            {
                return new DataTable();
            }
        }

        /// &lt;summary&gt;
        /// Gets the annotation details created by the specified user.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;docID&quot;&gt;DocId of the document on which the annotations are done.&lt;/param&gt;
        /// &lt;param name=&quot;userID&quot;&gt;UserId of the user who created the annotation.&lt;/param&gt;
        /// &lt;param name=&quot;versionNo&quot;&gt;Version No of the document.&lt;/param&gt;
        /// &lt;returns&gt;DataSet with one table containing the details of the annotation.&lt;/returns&gt;
        public DataSet GetAnnotationDetailsByUser(int docID, int userID, int versionNo)
        {
            try
            {
                return
                    ComponentHelper.Instance.ExecuteDataSet(
                        DocumentStoredProcedure.usp_DOCMGMTGetAnnotationDetailsByUser, null,
                        docID, userID, versionNo);
            }
            catch (Exception)
            {
                return new DataSet();
            }
        }

        /// &lt;summary&gt;
        /// Saves annotations to the database.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;dto&quot;&gt;DocumentAnnotation object containing details of the annotation.&lt;/param&gt;
        public void SaveAnnotations(DocumentAnnotation dto)
        {
            try
            {
                string mode = &quot;&quot;;

                if (dto.AnnotationMode == AnnotationMode.Review)
                    mode = &quot;Review&quot;;
                else if (dto.AnnotationMode == AnnotationMode.Consolidate)
                    mode = &quot;Consolidate&quot;;

                ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                    DocumentStoredProcedure.usp_DOCMGMTSaveAnnotations, null,
                    dto.DocumentID, dto.VersionNumber, dto.DocumentName, dto.AnnotationData, mode, dto.CreatedBy,
                    dto.CreatedOn);
            }
            catch (Exception)
            {
            }
        }

        /// &lt;summary&gt;
        /// Gets the annotation details.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;documentAnnotationId&quot;&gt;ID of the annotation to be retrieved.&lt;/param&gt;
        /// &lt;returns&gt;DataSet with one table containing details of annotation.&lt;/returns&gt;
        internal DataSet GetAnnotationDetails(int documentAnnotationId)
        {
            try
            {
                return ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTGetAnnotationDetails,
                    null,
                    documentAnnotationId);
            }
            catch (Exception)
            {
                return new DataSet();
            }
        }

        /// &lt;summary&gt;
        /// Gets list of annotations for consolidation.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;docId&quot;&gt;DocId of the document for which annotations are required.&lt;/param&gt;
        /// &lt;param name=&quot;versionNo&quot;&gt;VersionNumber of the document for which annotations are required.&lt;/param&gt;
        /// &lt;returns&gt;DataSet with one table containing list of annotations.&lt;/returns&gt;
        internal DataSet GetAnnotationsForConsolidation(int docId, int versionNo)
        {
            try
            {
                return
                    ComponentHelper.Instance.ExecuteDataSet(
                        DocumentStoredProcedure.usp_DOCMGMTGetAnnotationsForConsolidation, null, docId, versionNo);
            }
            catch (Exception)
            {
                return new DataSet();
            }
        }

        /// &lt;summary&gt;
        /// Gets the list of reviewed documents for a document.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;docId&quot;&gt;DocId of the document whose reviewed documents are required.&lt;/param&gt;
        /// &lt;returns&gt;DataSet with one table containing details of the reviewed documents.&lt;/returns&gt;
        internal DataSet GetAllReviewDocuments(int docId)
        {
            try
            {
                return ComponentHelper.Instance.ExecuteDataSet(
                    DocumentStoredProcedure.usp_DOCMGMTGetAllReviewDocuments, null, docId);
            }
            catch (Exception)
            {
                return new DataSet();
            }
        }

        /// &lt;summary&gt;
        /// Gets the Project Id from the document id.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;docId&quot;&gt;DocId of the document for which projectid is required.&lt;/param&gt;
        /// &lt;returns&gt;ProjectId&lt;/returns&gt;
        internal int GetProjectIdFromDocumentId(int docId)
        {
            object pid =
                ComponentHelper.Instance.ExecuteScalar(DocumentStoredProcedure.usp_DOCMGMTGetProjectIdFromDocumentId,
                    null, docId);

            if (pid != null)
                return (int)pid;

            return 0;
        }

        internal int GetProjectIdFromDocumentId(int docId, int folderId)
        {
            object pid =
                ComponentHelper.Instance.ExecuteScalar(DocumentStoredProcedure.usp_DOCMGMTGetProjectIdFromDocumentIdNew,
                    null, docId, folderId);

            if (pid != null)
                return (int)pid;

            return 0;
        }

        internal int GetProjectIdFromFolderId(int folderId)
        {
            object pid =
                ComponentHelper.Instance.ExecuteScalar(DocumentStoredProcedure.usp_DOCMGMTGetProjectIdFromFolderId,
                    null, folderId);

            if (pid != null)
                return (int)pid;

            return 0;
        }

        /// &lt;summary&gt;
        /// Deletes all the annotations related to the documents specified, including all versions of the document.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;docid&quot;&gt;DocIds of the documents whose annotations are to be deleted&lt;/param&gt;
        internal void DeleteAnnotations(string docIds)
        {
            ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                DocumentStoredProcedure.usp_DOCMGMTDeleteAnnotations, null, docIds);
        }

        public string GetFullFolderPath(int folderid)
        {
            using (var conn = new ConnHolder(ConnectionHelper.GetConnectionString()))
            {
                string folderPath;
                DbCommand cmd = conn.DB.GetStoredProcCommand(&quot;usp_DOCMGMTGetFullFolderPath&quot;);

                conn.DB.AddInParameter(cmd, &quot;FOLDERID&quot;, DbType.Int32, folderid);
                folderPath = conn.DB.ExecuteScalar(cmd).ToString();

                return (folderPath != &quot;&quot;) ? folderPath : &quot;&quot;;
            }
        }

        public void SaveAttachmentMetadata(int linkId, string metaDataXML)
        {
            ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                DocumentStoredProcedure.usp_DOCMGMTSaveAttachmentMetadata, null, linkId, metaDataXML);
        }

        public DataSet GetAttachmentMetadata(string linkIds)
        {
            try
            {
                return ComponentHelper.Instance.ExecuteDataSet(
                    DocumentStoredProcedure.usp_DOCMGMTGetAttachmentMetadata, null, linkIds);
            }
            catch (Exception)
            {
                return new DataSet();
            }
        }

        public DataSet GetAllLinksOfDocument(int docId)
        {
            return ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTGetAllLinksOfDocument,
                null, docId);
        }

        public bool CheckIsUserAuthorisedForInboxDocument(int userID, int docID)
        {
            DataSet ds = ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTCheckIsUserAuthorisedForInboxDocument, null, userID, docID);
            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0 &amp;&amp; ds.Tables[0].Rows.Count &gt; 0)
                return true;

            return false;
        }

        internal bool CheckDocumentExistsInProject(string docName, int projectID)
        {
            DataSet ds = ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTCheckDocumentExistsInProject, null, docName, projectID);
            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0 &amp;&amp; ds.Tables[0].Rows.Count &gt; 0)
                return true;

            return false;
        }

        public DataSet GetFoldersHierarchy(object[] parameters)
        {
            return ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTGetFoldersHierarchy, null,
            parameters);
        }

        public DataSet GetDocumentDetailsForSyncEstimate(int instanceId, string moduleId, int userID, int PID,
            string deletedFolderIds, string deletedDocIds, string existingDocIds,
            string offlineFoldersFromMobileDevice, string onlineFoldersFromMobileDevice,
            string offlineDocsFromMobileDevice, string onlineDocsFromMobileDevice, string existingAnnotationIds)
        {
            return ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTGetDocumentDetailsForSyncEstimate, null,
           instanceId, moduleId, userID, PID,
           deletedFolderIds, deletedDocIds, existingDocIds,
           offlineFoldersFromMobileDevice, onlineFoldersFromMobileDevice,
           offlineDocsFromMobileDevice, onlineDocsFromMobileDevice, existingAnnotationIds);
        }

        public DataSet GetPaginatedFoldersForProject(int PID, int instanceId, string moduleId, int userID, int lastSyncedFolderId, int pageSize,
            bool showSystemFolders, int systemFolderParentID, string systemFolderParentName)
        {
            return ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTGetPaginatedFoldersForProject, null,
                PID, instanceId, moduleId, userID, lastSyncedFolderId, pageSize, showSystemFolders, systemFolderParentID, systemFolderParentName);
        }

        public DataSet GetPaginatedDocumentsForFolder(int folderId, int currentUserId, int lastSyncedDocId, string lastSyncedDate, int pageSize)
        {
            return ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTGetPaginatedDocumentsForFolder, null,
               folderId, currentUserId, lastSyncedDocId, lastSyncedDate, pageSize);
        }

        public void CreateOrUpdateDocumentOfflineSettings(string type, string typeInstanceId, int PID,
            int userID, DateTime modifiedOn, bool isOffline)
        {
            ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTCUOfflineSettings, null,
                type, typeInstanceId, PID, userID, modifiedOn, isOffline);
        }

        public void GetOfflineSettingsForFolder(int projectId, int folderId, int userId, out bool isOffline, out bool isOfflineBecauseOfParent)
        {
            isOffline = false;
            isOfflineBecauseOfParent = false;
            Dictionary&lt;string, object&gt; outParams = new Dictionary&lt;string, object&gt;();
            ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTGetOfflineSettingsForFolder, outParams,
                projectId, folderId, userId);

            if (outParams.ContainsKey(&quot;IsOffline&quot;))
                isOffline = outParams[&quot;IsOffline&quot;].ToBoolean2();

            if (outParams.ContainsKey(&quot;IsOfflineBecauseOfParent&quot;))
                isOfflineBecauseOfParent = outParams[&quot;IsOfflineBecauseOfParent&quot;].ToBoolean2();

        }

        public object GetValidLinkIdsForFolder(int folderId)
        {
            return ComponentHelper.Instance.ExecuteScalar(DocumentStoredProcedure.usp_DOCMGMTGetValidLinkIdsForFolder, null, folderId);
        }


        public DataSet GetDocIdsAndItsAnnotationIdsForFolder(int folderId)
        {
            return ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTGetDocIdsandItsAnnotationIdsForFolder, null, folderId);
        }

        internal void CreateAnnotation(int docID, int versionNo, int linkID, string annotationFile, string createdBy, int createdByID, string annotationName)
        {
            ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTCUDAnnotation, null,
                docID, versionNo, linkID, annotationFile, createdBy, createdByID, annotationName, null);
        }

        internal void UpdateAnnotation(int docID, int versionNo, int linkID, string annotationFile, string createdBy, int createdByID, string annotationName, int annotationID)
        {
            ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTCUDAnnotation, null,
                docID, versionNo, linkID, annotationFile, createdBy, createdByID, annotationName, annotationID);
        }

        internal DataSet GetAnnotation(int docID, int annotationID)
        {
            DataSet ds = ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTGetAnnotation, null,
                docID, annotationID);
            return ds;
        }

        internal DataSet GetLinkIdForDocument(int docId, string moduleId, int srcId)
        {
            DataSet ds = ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTGetLinkIDForDocument, null, docId, moduleId, srcId.ToString());
            return ds;
        }

        internal void UpdateFormInstanceTimestamp(int linkID)
        {
            ComponentHelper.Instance.ExecuteScalar(DocumentStoredProcedure.usp_DOCMGMTUpdateFormInstanceTimestamp, null,
                linkID);
        }


        internal DataSet ValidateOfflineFolderSettings(string folderIds, int userId, bool checkForOffline)
        {
            DataSet ds = ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTValidateOfflineFolderSettings, null,
                folderIds, userId, checkForOffline);
            return ds;
        }

        internal DataSet GetAnnotationDetailsForDocumentList(string docAnnotationsXML)
        {
            DataSet ds = ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTGetAnnotationDetailsForDocumentList, null,
               docAnnotationsXML);
            return ds;
        }

        internal void LockDocumentForSigning(int docId, string lockedBy)
        {
            ComponentHelper.Instance.ExecuteScalar(DocumentStoredProcedure.usp_DOCMGMTLockDocForSigning, null,
                docId, lockedBy);
        }

        internal void UnlockDocumentForSigning(int docId)
        {
            ComponentHelper.Instance.ExecuteScalar(DocumentStoredProcedure.usp_DOCMGMTUnlockDocForSigning, null,
                docId);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[21,9,21,36,1],[21,37,21,38,1],[21,39,21,40,1],[24,9,24,10,1],[25,20,25,85,1],[26,13,26,14,1],[27,17,27,95,1],[28,17,28,81,1],[29,17,29,62,1],[31,9,31,10,1],[39,9,39,10,0],[41,13,41,14,0],[42,24,42,89,0],[43,17,43,18,0],[44,21,44,56,0],[45,21,45,100,0],[47,21,47,86,0],[49,28,49,77,0],[50,21,50,22,0],[51,25,51,47,0],[52,25,52,26,0],[54,29,54,58,0],[55,29,55,30,0],[56,33,56,106,0],[58,33,58,106,0],[60,33,60,68,0],[62,40,62,89,0],[63,33,63,34,0],[64,37,64,47,0],[65,37,65,65,0],[69,37,69,59,0],[70,37,70,38,0],[71,41,71,52,0],[72,41,72,42,0],[73,45,73,80,0],[74,45,74,85,0],[75,45,75,85,0],[76,45,76,88,0],[77,45,77,90,0],[78,45,78,85,0],[79,45,79,87,0],[80,45,80,83,0],[81,45,81,82,0],[82,45,82,83,0],[83,45,83,85,0],[84,45,84,92,0],[85,45,85,85,0],[86,45,86,46,0],[87,45,87,90,0],[88,41,88,42,0],[90,41,90,42,0],[91,45,91,70,0],[93,45,93,77,0],[94,45,94,82,0],[95,45,95,82,0],[96,45,96,85,0],[97,45,97,87,0],[98,45,98,82,0],[99,45,99,84,0],[100,45,100,80,0],[101,45,101,79,0],[102,45,102,80,0],[103,45,103,82,0],[104,45,104,89,0],[105,45,105,82,0],[106,45,106,87,0],[108,45,108,62,0],[109,41,109,42,0],[111,41,111,45,0],[112,37,112,38,0],[114,37,114,47,0],[115,37,115,38,0],[117,41,117,67,0],[118,41,118,74,0],[119,41,119,79,0],[120,41,120,79,0],[121,41,121,82,0],[122,41,122,84,0],[123,41,123,79,0],[124,41,124,81,0],[125,41,125,77,0],[126,41,126,76,0],[127,41,127,77,0],[128,41,128,79,0],[129,41,129,86,0],[130,41,130,79,0],[131,41,131,84,0],[133,41,133,59,0],[135,41,135,66,0],[136,37,136,38,0],[138,37,138,38,0],[140,41,140,76,0],[141,41,141,81,0],[142,41,142,81,0],[143,41,143,84,0],[144,41,144,86,0],[145,41,145,81,0],[146,41,146,83,0],[147,41,147,79,0],[148,41,148,78,0],[149,41,149,79,0],[150,41,150,81,0],[151,41,151,88,0],[152,41,152,81,0],[153,41,153,86,0],[155,41,155,63,0],[156,37,156,38,0],[159,37,159,57,0],[160,33,160,34,0],[161,29,161,30,0],[162,25,162,26,0],[163,21,163,22,0],[164,21,164,36,0],[167,13,167,33,0],[168,13,168,14,0],[169,17,169,93,0],[170,17,170,23,0],[172,9,172,10,0],[179,9,179,10,1],[181,13,181,14,1],[182,24,182,89,1],[183,17,183,18,1],[184,21,184,88,1],[185,21,185,94,1],[187,21,187,85,1],[188,21,188,88,1],[189,21,189,90,1],[191,28,191,75,1],[192,21,192,22,1],[193,25,193,46,1],[194,25,194,26,1],[195,29,195,77,1],[196,29,196,81,1],[197,25,197,26,1],[198,21,198,22,1],[199,21,199,39,1],[202,13,202,33,0],[203,13,203,14,0],[204,17,204,93,0],[205,17,205,23,0],[207,9,207,10,1],[215,9,215,10,1],[216,20,216,85,1],[217,13,217,14,1],[218,17,218,86,1],[220,17,220,96,1],[221,17,221,96,1],[222,17,222,91,1],[223,17,223,92,1],[224,17,224,96,1],[225,17,225,88,1],[226,17,226,92,1],[227,17,227,104,1],[228,17,228,107,1],[229,17,229,107,1],[231,17,231,73,1],[232,17,232,75,1],[233,17,233,44,1],[235,17,235,81,1],[236,17,236,92,1],[238,17,238,56,1],[239,17,239,67,1],[240,17,240,35,1],[241,21,241,51,1],[243,17,243,33,1],[245,9,245,10,1],[254,9,254,10,1],[255,20,255,85,1],[256,13,256,14,1],[258,17,258,90,1],[260,17,260,81,1],[261,17,261,95,1],[262,17,262,76,1],[263,17,263,44,1],[265,17,265,83,1],[266,17,266,62,1],[268,9,268,10,1],[276,9,276,10,0],[277,20,277,85,0],[278,13,278,14,0],[280,17,280,96,0],[282,17,282,81,0],[283,17,283,76,0],[284,17,284,44,0],[286,17,286,84,0],[287,17,287,64,0],[289,9,289,10,0],[299,9,299,10,0],[300,20,300,85,0],[301,13,301,14,0],[302,17,302,103,0],[303,17,303,86,0],[304,17,304,82,0],[305,17,305,86,0],[307,24,307,67,0],[308,21,308,35,0],[309,25,309,54,0],[310,17,310,37,0],[312,9,312,10,0],[320,9,320,10,1],[321,20,321,85,1],[322,13,322,14,1],[323,17,323,93,1],[324,17,324,81,1],[325,24,325,67,1],[326,21,326,35,1],[327,25,327,54,1],[328,17,328,37,1],[330,9,330,10,1],[333,9,333,10,1],[334,13,334,42,1],[335,13,335,70,1],[336,13,336,75,1],[337,13,337,82,1],[338,13,338,63,1],[339,17,339,80,1],[340,13,340,71,1],[341,13,341,59,1],[342,17,342,79,1],[343,13,343,113,1],[344,13,344,119,1],[345,13,345,137,1],[346,13,346,65,1],[347,17,347,90,1],[349,13,349,67,1],[350,17,350,94,0],[352,17,352,50,1],[354,13,354,59,1],[355,17,355,90,1],[357,17,357,53,0],[359,13,359,27,1],[360,9,360,10,1],[368,9,368,10,1],[369,20,369,85,1],[370,13,370,14,1],[371,17,371,89,1],[373,17,373,91,1],[374,17,374,96,1],[375,17,375,96,1],[376,17,376,92,1],[377,17,377,91,1],[378,17,378,88,1],[379,17,379,92,1],[380,17,380,73,1],[381,17,381,44,1],[383,17,383,89,1],[385,9,385,10,1],[393,9,393,10,1],[394,20,394,85,1],[395,13,395,14,1],[396,17,396,98,1],[398,17,398,81,1],[399,17,399,73,1],[400,17,400,44,1],[402,17,402,89,1],[404,9,404,10,1],[412,9,412,10,1],[413,20,413,85,1],[414,13,414,14,1],[415,17,415,89,1],[417,17,417,81,1],[418,17,418,73,1],[419,17,419,44,1],[421,17,421,89,1],[423,9,423,10,1],[431,9,431,10,0],[432,13,432,25,0],[433,20,433,85,0],[434,13,434,14,0],[435,17,435,96,0],[437,17,437,78,0],[439,24,439,71,0],[440,17,440,18,0],[441,21,441,42,0],[442,25,442,50,0],[443,17,443,18,0],[445,17,445,42,0],[447,9,447,10,0],[456,9,456,10,0],[457,20,457,85,0],[458,13,458,14,0],[459,17,459,94,0],[461,17,461,80,0],[462,17,462,81,0],[463,17,463,73,0],[464,17,464,44,0],[466,17,466,89,0],[468,9,468,10,0],[476,9,476,10,0],[477,20,477,85,0],[478,13,478,14,0],[479,17,479,93,0],[481,17,481,81,0],[482,17,482,73,0],[483,17,483,44,0],[485,17,485,89,0],[487,9,487,10,0],[495,9,495,10,1],[496,20,496,92,1],[497,13,497,14,1],[499,17,499,88,1],[501,17,501,77,1],[502,17,502,76,1],[503,17,503,44,1],[505,17,505,81,1],[506,17,506,58,1],[508,9,508,10,1],[516,9,516,10,1],[517,20,517,85,1],[518,13,518,14,1],[519,17,519,86,1],[521,17,521,82,1],[522,17,522,76,1],[523,17,523,44,1],[525,17,525,89,1],[527,9,527,10,1],[535,9,535,10,1],[536,20,536,85,1],[537,13,537,14,1],[538,17,538,88,1],[539,17,539,87,1],[540,17,540,87,1],[541,17,541,85,1],[542,17,542,88,1],[543,17,543,90,1],[544,17,544,88,1],[545,17,545,88,1],[546,17,546,91,1],[547,17,547,87,1],[548,17,548,87,1],[549,17,549,137,1],[550,17,550,84,1],[551,17,551,93,1],[552,17,552,90,1],[553,17,553,95,1],[554,17,554,89,1],[555,17,555,92,1],[556,17,556,73,1],[557,17,557,99,1],[558,17,558,83,1],[559,17,559,97,1],[560,17,560,44,1],[562,17,562,89,1],[564,9,564,10,1],[567,9,567,10,1],[568,20,568,85,1],[569,13,569,14,1],[570,17,570,88,1],[571,17,571,82,1],[572,17,572,85,1],[573,17,573,87,1],[574,17,574,87,1],[575,17,575,85,1],[576,17,576,88,1],[577,17,577,90,1],[578,17,578,88,1],[579,17,579,88,1],[580,17,580,91,1],[581,17,581,87,1],[582,17,582,87,1],[583,17,583,137,1],[584,17,584,137,1],[585,17,585,90,1],[586,17,586,84,1],[587,17,587,93,1],[588,17,588,90,1],[589,17,589,92,1],[590,17,590,49,1],[591,21,591,81,1],[593,17,593,73,1],[594,17,594,44,1],[596,17,596,89,1],[598,9,598,10,1],[606,9,606,10,0],[607,20,607,85,0],[608,13,608,14,0],[609,17,609,67,0],[610,17,610,89,0],[612,17,612,75,0],[613,17,613,77,0],[614,17,614,85,0],[615,17,615,79,0],[616,17,616,93,0],[617,17,617,73,0],[618,17,618,44,0],[620,17,620,89,0],[622,9,622,10,0],[630,9,630,10,1],[631,20,631,85,1],[632,13,632,14,1],[633,17,633,50,1],[634,17,634,95,1],[636,17,636,84,1],[638,24,638,71,1],[639,17,639,18,1],[640,21,640,39,1],[641,25,641,61,1],[642,21,642,62,1],[643,25,643,74,1],[644,17,644,18,1],[645,17,645,31,1],[647,9,647,10,1],[656,9,656,10,0],[657,20,657,85,0],[658,13,658,14,0],[659,17,659,67,0],[661,17,661,89,0],[663,17,663,75,0],[664,17,664,77,0],[665,17,665,85,0],[666,17,666,81,0],[667,17,667,93,0],[668,17,668,73,0],[669,17,669,44,0],[671,17,671,89,0],[673,9,673,10,0],[677,9,677,10,0],[678,20,678,85,0],[679,13,679,14,0],[680,17,680,67,0],[682,17,682,99,0],[684,17,684,75,0],[685,17,685,83,0],[686,17,686,81,0],[687,17,687,44,0],[688,13,688,14,0],[689,9,689,10,0],[697,9,697,10,0],[698,20,698,85,0],[699,13,699,14,0],[700,17,700,87,0],[702,17,702,75,0],[703,17,703,76,0],[704,17,704,44,0],[706,17,706,89,0],[708,9,708,10,0],[716,9,716,10,0],[717,20,717,85,0],[718,13,718,14,0],[719,17,719,89,0],[721,17,721,75,0],[722,17,722,73,0],[723,17,723,44,0],[725,17,725,89,0],[727,9,727,10,0],[735,9,735,10,1],[736,20,736,85,1],[737,13,737,14,1],[738,17,738,91,1],[740,17,740,75,1],[741,17,741,73,1],[742,17,742,44,1],[744,17,744,89,1],[746,9,746,10,1],[754,9,754,10,1],[755,13,755,75,1],[757,20,757,53,1],[758,13,758,14,1],[759,17,759,50,1],[760,17,760,89,1],[762,17,762,76,1],[764,24,764,71,1],[765,17,765,18,1],[766,21,766,39,1],[767,25,767,61,1],[768,21,768,62,1],[769,25,769,74,1],[770,17,770,18,1],[771,17,771,31,1],[773,9,773,10,1],[776,9,776,10,1],[777,13,777,56,1],[778,9,778,10,1],[781,9,781,10,0],[782,13,782,75,0],[784,20,784,53,0],[785,13,785,14,0],[786,17,786,50,0],[787,17,787,102,0],[789,17,789,76,0],[790,17,790,83,0],[792,24,792,71,0],[793,17,793,18,0],[794,21,794,39,0],[795,25,795,61,0],[796,21,796,62,0],[797,25,797,74,0],[798,17,798,18,0],[799,17,799,31,0],[801,9,801,10,0],[804,9,804,10,1],[805,13,805,61,1],[806,13,806,66,1],[807,13,807,66,1],[808,13,808,72,1],[809,13,809,78,1],[810,13,810,78,1],[811,13,811,66,1],[812,13,812,70,1],[813,13,813,67,1],[814,13,814,64,1],[815,13,815,65,1],[816,13,816,67,1],[817,13,817,73,1],[818,13,818,63,1],[819,13,819,66,1],[820,13,820,68,1],[821,13,821,69,1],[822,13,822,69,1],[824,13,824,107,1],[825,13,825,59,1],[826,13,826,14,1],[827,17,827,58,1],[828,17,828,41,1],[829,21,829,59,1],[830,13,830,14,1],[832,13,832,107,1],[833,13,833,59,1],[834,13,834,14,1],[835,17,835,58,1],[836,17,836,41,1],[837,21,837,59,1],[838,13,838,14,1],[840,13,840,101,1],[841,13,841,59,1],[842,13,842,14,1],[843,17,843,52,1],[844,17,844,41,1],[845,21,845,53,1],[846,13,846,14,1],[848,13,848,103,1],[849,13,849,59,1],[850,13,850,14,1],[851,17,851,54,1],[852,17,852,41,1],[853,21,853,73,1],[854,13,854,14,1],[856,13,856,108,1],[857,13,857,59,1],[858,13,858,14,1],[859,17,859,59,1],[860,17,860,41,1],[861,21,861,60,0],[862,13,862,14,1],[864,13,864,108,1],[865,13,865,59,1],[866,13,866,14,1],[867,17,867,59,1],[868,17,868,41,1],[869,21,869,86,0],[870,13,870,14,1],[872,13,872,107,1],[873,13,873,59,1],[874,13,874,14,1],[875,17,875,58,1],[876,17,876,41,1],[877,21,877,81,1],[878,13,878,14,1],[880,13,880,111,1],[881,13,881,59,1],[882,17,882,91,0],[884,13,884,110,1],[885,13,885,59,1],[886,13,886,14,1],[887,17,887,84,1],[888,13,888,14,1],[889,9,889,10,1],[896,9,896,10,0],[897,13,903,43,0],[904,9,904,10,0],[913,9,913,10,0],[914,20,914,85,0],[915,13,915,14,0],[916,17,916,94,0],[918,17,918,91,0],[919,17,919,80,0],[921,17,921,62,0],[923,9,923,10,0],[931,9,931,10,1],[932,20,932,85,1],[933,13,933,14,1],[934,17,934,95,1],[935,17,935,81,1],[937,17,937,81,1],[939,24,939,71,1],[940,17,940,18,1],[941,21,941,42,1],[942,25,943,79,0],[944,17,944,18,1],[945,17,945,32,1],[947,9,947,10,1],[957,9,957,10,1],[958,20,958,85,1],[959,13,959,14,1],[960,17,960,91,1],[961,17,961,55,1],[963,17,963,80,1],[964,17,964,82,1],[965,17,965,82,1],[967,24,967,71,1],[968,17,968,18,1],[969,21,969,42,1],[970,21,970,22,0],[971,25,977,28,0],[978,21,978,22,0],[979,17,979,18,1],[980,17,980,35,1],[982,9,982,10,1],[990,9,990,10,0],[991,20,991,85,0],[992,13,992,14,0],[993,17,993,94,0],[995,17,995,81,0],[996,17,996,73,0],[997,17,997,44,0],[999,17,999,89,0],[1001,9,1001,10,0],[1010,9,1010,10,1],[1011,20,1011,85,1],[1012,13,1012,14,1],[1013,17,1013,103,1],[1015,17,1015,82,1],[1016,17,1016,86,1],[1017,17,1017,59,1],[1018,21,1018,98,1],[1019,17,1019,47,1],[1020,21,1020,101,1],[1021,17,1021,75,1],[1022,17,1022,44,1],[1024,17,1024,91,1],[1026,9,1026,10,1],[1029,9,1029,10,1],[1030,20,1030,85,1],[1031,13,1031,14,1],[1032,17,1032,98,1],[1034,17,1034,86,1],[1035,17,1035,82,1],[1037,24,1037,67,1],[1038,17,1038,18,1],[1039,21,1039,35,1],[1040,25,1040,54,1],[1041,17,1041,18,1],[1043,17,1043,37,1],[1045,9,1045,10,1],[1048,9,1048,10,0],[1049,20,1049,85,0],[1050,13,1050,14,0],[1051,17,1051,97,0],[1053,17,1053,102,0],[1054,17,1054,105,0],[1056,17,1056,62,0],[1058,9,1058,10,0],[1061,9,1061,10,0],[1062,20,1062,85,0],[1063,13,1063,14,0],[1064,17,1064,95,0],[1065,17,1065,82,0],[1066,17,1066,94,0],[1067,17,1067,62,0],[1069,9,1069,10,0],[1072,9,1072,10,1],[1073,20,1073,85,1],[1074,13,1074,14,1],[1075,17,1075,94,1],[1076,17,1076,86,1],[1077,17,1077,82,1],[1079,17,1079,62,1],[1081,9,1081,10,1],[1084,9,1084,10,1],[1085,13,1085,40,1],[1086,13,1086,56,1],[1087,13,1090,48,1],[1092,13,1092,74,1],[1093,13,1093,57,1],[1094,13,1094,43,1],[1095,13,1095,50,1],[1096,13,1096,31,1],[1097,13,1097,23,1],[1098,9,1098,10,1],[1101,9,1101,10,1],[1102,13,1104,66,1],[1105,9,1105,10,1],[1108,9,1108,10,0],[1109,13,1109,56,0],[1110,13,1111,109,0],[1113,13,1113,70,0],[1115,13,1115,27,0],[1116,9,1116,10,0],[1119,9,1119,10,1],[1120,20,1120,92,1],[1121,13,1121,14,1],[1122,17,1122,95,1],[1123,17,1123,75,1],[1124,17,1124,87,1],[1125,17,1125,82,1],[1126,17,1126,80,1],[1127,17,1127,87,1],[1128,17,1128,82,1],[1129,17,1129,46,1],[1130,13,1130,14,1],[1131,9,1131,10,1],[1134,9,1134,10,0],[1136,13,1136,14,0],[1137,24,1137,96,0],[1138,17,1138,18,0],[1139,21,1139,100,0],[1140,21,1140,79,0],[1141,21,1141,56,0],[1144,13,1144,30,0],[1145,13,1145,14,0],[1146,17,1146,38,0],[1148,9,1148,10,0],[1152,9,1152,10,1],[1153,13,1156,68,1],[1157,9,1157,10,1],[1160,9,1160,10,0],[1161,13,1162,91,0],[1163,9,1163,10,0],[1166,9,1166,10,1],[1167,13,1168,38,1],[1169,9,1169,10,1],[1172,9,1172,10,0],[1173,13,1176,143,0],[1177,9,1177,10,0],[1182,9,1182,10,0],[1183,20,1183,92,0],[1184,13,1184,14,0],[1185,17,1185,96,0],[1186,17,1186,42,0],[1187,17,1187,84,0],[1188,17,1188,90,0],[1189,17,1189,90,0],[1190,17,1190,96,0],[1191,17,1191,104,0],[1193,17,1193,46,0],[1194,13,1194,14,0],[1195,9,1195,10,0],[1202,9,1202,10,0],[1203,13,1203,40,0],[1204,20,1204,92,0],[1205,13,1205,14,0],[1206,17,1206,95,0],[1207,17,1207,83,0],[1208,17,1208,86,0],[1209,17,1209,82,0],[1210,17,1210,86,0],[1211,17,1211,98,0],[1212,17,1212,88,0],[1213,17,1213,78,0],[1214,17,1214,76,0],[1215,17,1215,74,0],[1216,17,1216,84,0],[1217,17,1217,89,0],[1218,17,1218,81,0],[1219,17,1219,77,0],[1220,17,1220,97,0],[1221,17,1221,83,0],[1222,17,1222,83,0],[1223,17,1223,85,0],[1225,17,1225,50,0],[1226,13,1226,14,0],[1228,13,1228,23,0],[1229,9,1229,10,0],[1232,9,1232,10,1],[1233,20,1233,92,1],[1234,13,1234,14,1],[1235,17,1235,98,1],[1236,17,1236,78,1],[1237,17,1237,46,1],[1238,13,1238,14,1],[1239,9,1239,10,1],[1243,9,1243,10,1],[1244,20,1244,92,1],[1245,13,1245,14,1],[1246,17,1246,97,1],[1247,17,1247,82,1],[1248,17,1248,85,1],[1249,17,1249,77,1],[1250,17,1250,94,1],[1251,17,1251,95,1],[1252,17,1252,96,1],[1253,17,1253,97,1],[1254,17,1254,52,1],[1256,9,1256,10,1],[1259,9,1259,10,0],[1260,20,1260,92,0],[1261,13,1261,14,0],[1262,17,1262,30,0],[1263,17,1263,18,0],[1264,21,1264,71,0],[1265,21,1265,34,0],[1266,17,1266,18,0],[1267,17,1267,94,0],[1268,17,1268,74,0],[1269,17,1269,81,0],[1270,17,1270,102,0],[1271,17,1271,86,0],[1272,17,1272,74,0],[1273,17,1273,45,0],[1274,13,1274,14,0],[1275,9,1275,10,0],[1278,9,1278,10,0],[1279,20,1279,92,0],[1280,13,1280,14,0],[1281,17,1281,97,0],[1282,17,1282,83,0],[1283,17,1283,83,0],[1284,17,1284,77,0],[1285,17,1285,52,0],[1287,9,1287,10,0],[1290,9,1290,10,0],[1291,13,1291,40,0],[1293,13,1296,54,0],[1298,13,1298,23,0],[1299,9,1299,10,0],[1302,9,1302,10,0],[1303,13,1303,40,0],[1305,13,1308,33,0],[1310,13,1310,23,0],[1311,9,1311,10,0],[1314,9,1314,10,0],[1315,13,1315,182,0],[1316,9,1316,10,0],[1324,9,1324,10,0],[1325,13,1327,117,0],[1328,9,1328,10,0],[1336,9,1336,10,0],[1337,13,1339,47,0],[1340,9,1340,10,0],[1343,9,1343,10,1],[1344,20,1344,92,1],[1345,13,1345,14,1],[1346,17,1346,99,1],[1347,17,1347,52,1],[1349,9,1349,10,1],[1353,9,1353,10,0],[1354,20,1354,92,0],[1355,13,1355,14,0],[1356,17,1356,97,0],[1357,17,1357,87,0],[1358,17,1358,105,0],[1359,17,1359,95,0],[1360,17,1360,99,0],[1361,17,1361,83,0],[1362,17,1362,46,0],[1363,13,1363,14,0],[1364,9,1364,10,0],[1367,9,1367,10,1],[1368,13,1368,40,1],[1370,13,1373,38,1],[1375,13,1375,23,1],[1376,9,1376,10,1],[1379,9,1379,10,1],[1380,13,1380,40,1],[1382,13,1384,123,1],[1386,13,1386,23,1],[1387,9,1387,10,1],[1391,9,1391,10,1],[1392,20,1392,92,1],[1393,13,1393,14,1],[1394,17,1394,116,1],[1395,17,1395,82,1],[1396,17,1396,85,1],[1397,17,1397,77,1],[1398,17,1398,94,1],[1399,17,1399,95,1],[1400,17,1400,96,1],[1401,17,1401,97,1],[1402,17,1402,52,1],[1404,9,1404,10,1],[1407,9,1407,10,1],[1408,20,1408,85,1],[1409,13,1409,14,1],[1410,17,1410,50,1],[1411,17,1411,89,1],[1413,17,1413,96,1],[1415,24,1415,71,1],[1416,17,1416,18,1],[1417,21,1417,39,1],[1418,25,1418,61,0],[1419,17,1419,18,1],[1420,17,1420,31,1],[1422,9,1422,10,1],[1425,9,1425,10,1],[1426,13,1428,25,1],[1429,9,1429,10,1],[1438,9,1438,10,1],[1439,13,1441,24,1],[1442,9,1442,10,1],[1450,9,1450,10,0],[1451,20,1451,85,0],[1452,13,1452,14,0],[1453,17,1453,95,0],[1455,17,1455,97,0],[1456,17,1456,85,0],[1457,17,1457,44,0],[1458,17,1458,86,0],[1460,9,1460,10,0],[1467,9,1467,10,0],[1468,13,1470,25,0],[1471,9,1471,10,0],[1474,9,1474,10,1],[1475,20,1475,85,1],[1476,13,1476,14,1],[1477,17,1477,114,1],[1479,17,1479,61,1],[1480,17,1480,59,1],[1481,17,1481,72,1],[1482,17,1482,58,1],[1483,17,1483,47,1],[1484,17,1484,44,1],[1485,13,1485,14,1],[1486,9,1486,10,1],[1493,9,1493,10,0],[1495,13,1495,14,0],[1496,24,1496,89,0],[1497,17,1497,18,0],[1498,21,1498,110,0],[1499,21,1499,79,0],[1500,21,1500,87,0],[1501,21,1501,56,0],[1504,13,1504,30,0],[1505,13,1505,14,0],[1506,17,1506,38,0],[1508,9,1508,10,0],[1511,9,1511,10,0],[1513,13,1513,14,0],[1514,24,1514,89,0],[1515,17,1515,18,0],[1516,21,1516,107,0],[1517,21,1517,79,0],[1518,21,1518,98,0],[1519,21,1519,90,0],[1520,21,1520,56,0],[1523,13,1523,30,0],[1524,13,1524,14,0],[1525,17,1525,38,0],[1527,9,1527,10,0],[1535,9,1535,10,0],[1536,20,1536,85,0],[1537,13,1537,14,0],[1538,17,1538,102,0],[1539,17,1539,68,0],[1540,17,1540,83,0],[1542,24,1542,71,0],[1543,17,1543,18,0],[1544,21,1544,42,0],[1545,21,1545,22,0],[1546,25,1546,58,0],[1547,25,1547,61,0],[1548,25,1548,50,0],[1549,21,1549,22,0],[1550,17,1550,18,0],[1552,17,1552,37,0],[1554,9,1554,10,0],[1557,9,1557,10,0],[1559,13,1559,14,0],[1560,24,1560,89,0],[1561,17,1561,18,0],[1562,21,1562,106,0],[1563,21,1563,94,0],[1564,21,1564,62,0],[1565,21,1565,45,0],[1565,46,1565,66,0],[1566,26,1566,49,0],[1569,13,1569,30,0],[1570,13,1570,14,0],[1571,17,1571,40,0],[1573,9,1573,10,0],[1576,9,1576,10,0],[1578,13,1578,14,0],[1579,24,1579,89,0],[1580,17,1580,18,0],[1581,21,1581,108,0],[1582,21,1582,94,0],[1583,21,1583,62,0],[1584,21,1584,45,0],[1584,46,1584,66,0],[1585,26,1585,49,0],[1588,13,1588,30,0],[1589,13,1589,14,0],[1590,17,1590,40,0],[1592,9,1592,10,0],[1602,9,1602,10,0],[1604,13,1604,14,0],[1605,17,1608,51,0],[1610,13,1610,30,0],[1611,13,1611,14,0],[1612,17,1612,38,0],[1614,9,1614,10,0],[1621,9,1621,10,0],[1623,13,1623,14,0],[1624,17,1624,34,0],[1626,17,1626,65,0],[1627,21,1627,37,0],[1628,22,1628,75,0],[1629,21,1629,42,0],[1631,17,1634,36,0],[1635,13,1635,14,0],[1636,13,1636,30,0],[1637,13,1637,14,0],[1638,13,1638,14,0],[1639,9,1639,10,0],[1647,9,1647,10,0],[1649,13,1649,14,0],[1650,17,1652,43,0],[1654,13,1654,30,0],[1655,13,1655,14,0],[1656,17,1656,38,0],[1658,9,1658,10,0],[1667,9,1667,10,0],[1669,13,1669,14,0],[1670,17,1672,116,0],[1674,13,1674,30,0],[1675,13,1675,14,0],[1676,17,1676,38,0],[1678,9,1678,10,0],[1686,9,1686,10,1],[1688,13,1688,14,1],[1689,17,1690,92,1],[1692,13,1692,30,0],[1693,13,1693,14,0],[1694,17,1694,38,0],[1696,9,1696,10,1],[1704,9,1704,10,0],[1705,13,1707,34,0],[1709,13,1709,29,0],[1710,17,1710,33,0],[1712,13,1712,22,0],[1713,9,1713,10,0],[1716,9,1716,10,1],[1717,13,1719,44,1],[1721,13,1721,29,1],[1722,17,1722,33,1],[1724,13,1724,22,0],[1725,9,1725,10,1],[1728,9,1728,10,1],[1729,13,1731,37,1],[1733,13,1733,29,1],[1734,17,1734,33,1],[1736,13,1736,22,0],[1737,9,1737,10,1],[1744,9,1744,10,0],[1745,13,1746,85,0],[1747,9,1747,10,0],[1750,9,1750,10,0],[1751,20,1751,85,0],[1752,13,1752,14,0],[1754,17,1754,94,0],[1756,17,1756,81,0],[1757,17,1757,68,0],[1759,17,1759,61,0],[1761,9,1761,10,0],[1764,9,1764,10,0],[1765,13,1766,103,0],[1767,9,1767,10,0],[1770,9,1770,10,0],[1772,13,1772,14,0],[1773,17,1774,94,0],[1776,13,1776,30,0],[1777,13,1777,14,0],[1778,17,1778,38,0],[1780,9,1780,10,0],[1783,9,1783,10,0],[1784,13,1785,30,0],[1786,9,1786,10,0],[1789,9,1789,10,0],[1790,13,1790,161,0],[1791,13,1791,82,0],[1792,17,1792,29,0],[1794,13,1794,26,0],[1795,9,1795,10,0],[1798,9,1798,10,0],[1799,13,1799,157,0],[1800,13,1800,82,0],[1801,17,1801,29,0],[1803,13,1803,26,0],[1804,9,1804,10,0],[1807,9,1807,10,1],[1808,13,1809,25,1],[1810,9,1810,10,1],[1816,9,1816,10,0],[1817,13,1821,92,0],[1822,9,1822,10,0],[1826,9,1826,10,0],[1827,13,1828,147,0],[1829,9,1829,10,0],[1832,9,1832,10,0],[1833,13,1834,84,0],[1835,9,1835,10,0],[1839,9,1839,10,0],[1840,13,1841,75,0],[1842,9,1842,10,0],[1845,9,1845,10,1],[1846,13,1846,31,1],[1847,13,1847,46,1],[1848,13,1848,85,1],[1849,13,1850,46,1],[1852,13,1852,52,1],[1853,17,1853,65,1],[1855,13,1855,67,1],[1856,17,1856,95,1],[1858,9,1858,10,1],[1861,9,1861,10,0],[1862,13,1862,136,0],[1863,9,1863,10,0],[1867,9,1867,10,0],[1868,13,1868,150,0],[1869,9,1869,10,0],[1872,9,1872,10,0],[1873,13,1874,105,0],[1875,9,1875,10,0],[1878,9,1878,10,0],[1879,13,1880,113,0],[1881,9,1881,10,0],[1884,9,1884,10,0],[1885,13,1886,38,0],[1887,13,1887,23,0],[1888,9,1888,10,0],[1891,9,1891,10,0],[1892,13,1892,164,0],[1893,13,1893,23,0],[1894,9,1894,10,0],[1897,9,1897,10,0],[1898,13,1899,25,0],[1900,9,1900,10,0],[1904,9,1904,10,0],[1905,13,1906,53,0],[1907,13,1907,23,0],[1908,9,1908,10,0],[1911,9,1911,10,0],[1912,13,1913,35,0],[1914,13,1914,23,0],[1915,9,1915,10,0],[1918,9,1918,10,0],[1919,13,1920,34,0],[1921,9,1921,10,0],[1924,9,1924,10,0],[1925,13,1926,24,0],[1927,9,1927,10,0]]);
    </script>
  </body>
</html>