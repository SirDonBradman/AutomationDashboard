<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Platform UI\SilverlightFaultBehavior.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
// This is an auto-generated file to enable WCF faults to reach Silverlight clients.

using System;
using System.Collections.ObjectModel;
using System.Net;
using System.ServiceModel;
using System.ServiceModel.Channels;
using System.ServiceModel.Description;
using System.ServiceModel.Dispatcher;

namespace ItemGanttView.Web
{
    public class SilverlightFaultBehavior : Attribute, IServiceBehavior
    {
        private class SilverlightFaultEndpointBehavior : IEndpointBehavior
        {
            public void AddBindingParameters(ServiceEndpoint endpoint, BindingParameterCollection bindingParameters)
            {
            }

            public void ApplyClientBehavior(ServiceEndpoint endpoint, ClientRuntime clientRuntime)
            {
            }

            public void ApplyDispatchBehavior(ServiceEndpoint endpoint, EndpointDispatcher endpointDispatcher)
            {
                endpointDispatcher.DispatchRuntime.MessageInspectors.Add(new SilverlightFaultMessageInspector());
            }

            public void Validate(ServiceEndpoint endpoint)
            {
            }

            private class SilverlightFaultMessageInspector : IDispatchMessageInspector
            {
                public object AfterReceiveRequest(ref Message request, IClientChannel channel,
                    InstanceContext instanceContext)
                {
                    return null;
                }

                public void BeforeSendReply(ref Message reply, object correlationState)
                {
                    if ((reply != null) &amp;&amp; reply.IsFault)
                    {
                        HttpResponseMessageProperty property = new HttpResponseMessageProperty();
                        property.StatusCode = HttpStatusCode.OK;
                        reply.Properties[HttpResponseMessageProperty.Name] = property;
                    }
                }
            }
        }

        public void AddBindingParameters(ServiceDescription serviceDescription, ServiceHostBase serviceHostBase,
            Collection&lt;ServiceEndpoint&gt; endpoints, BindingParameterCollection bindingParameters)
        {
        }

        public void ApplyDispatchBehavior(ServiceDescription serviceDescription, ServiceHostBase serviceHostBase)
        {
            foreach (ServiceEndpoint endpoint in serviceDescription.Endpoints)
            {
                endpoint.Behaviors.Add(new SilverlightFaultEndpointBehavior());
            }
        }

        public void Validate(ServiceDescription serviceDescription, ServiceHostBase serviceHostBase)
        {
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[18,13,18,14,0],[19,13,19,14,0],[22,13,22,14,0],[23,13,23,14,0],[26,13,26,14,0],[27,17,27,114,0],[28,13,28,14,0],[31,13,31,14,0],[32,13,32,14,0],[38,17,38,18,0],[39,21,39,33,0],[40,17,40,18,0],[43,17,43,18,0],[44,21,44,58,0],[45,21,45,22,0],[46,25,46,98,0],[47,25,47,65,0],[48,25,48,87,0],[49,21,49,22,0],[50,17,50,18,0],[56,9,56,10,0],[57,9,57,10,0],[60,9,60,10,0],[61,13,61,20,0],[61,22,61,46,0],[61,47,61,49,0],[61,50,61,78,0],[62,13,62,14,0],[63,17,63,80,0],[64,13,64,14,0],[65,9,65,10,0],[68,9,68,10,0],[69,9,69,10,0]]);
    </script>
  </body>
</html>