<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Construction Vertical\Addon Modules\Contract Manager\Pay Estimates\BL\PEBL.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Globalization;
using System.Reflection;
using System.Text;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.CONTMGTPEDAC;
using Aurigo.AMP3.CONTMGTPEDTO;
using Aurigo.AMP3.Core.IntegrationConnector;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.Brix.Construction.ContractManager.BusinessLayer.BL;
using Aurigo.Brix.Constructon.RFI;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.AMP3.ContractManager.BusinessLayer;
using Aurigo.Brix.Platform.BusinessLayer.DTO;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using System.Linq;
using Aurigo.Common.Utility;

namespace Aurigo.AMP3.CONTMGTPEBL
{
    public class BL : SingletonManagerBase&lt;BL&gt;, IModuleInstances
    {
        public BL() { }

        private string Operation(PEOperations opn)
        {
            string oStr = String.Empty;
            switch (opn)
            {
                case PEOperations.Create:
                    oStr = &quot;C&quot;;
                    break;
                case PEOperations.Update:
                    oStr = &quot;U&quot;;
                    break;
                case PEOperations.Destroy:
                    oStr = &quot;HD&quot;;
                    break;
                case PEOperations.Approve:
                    oStr = &quot;SA&quot;;
                    break;
                case PEOperations.UnApprove:
                    oStr = &quot;SD&quot;;
                    break;
                case PEOperations.Submit:
                    oStr = &quot;S&quot;;
                    break;
                case PEOperations.ReDraft:
                    oStr = &quot;US&quot;;
                    break;
            }
            return oStr;
        }

        public DataSet GetPEPrepaymentDetails(int contractID, int? peID, DateTime toDate, int? contractorID,
                                              string contractorType, int? workOrderID, string getAvailableMOH,
                                              string isForPopUp)
        {
            return DAC.Instance.GetPEPrepaymentDetails(contractID, peID, toDate, contractorID, contractorType,
                                                       workOrderID, getAvailableMOH, isForPopUp);
        }

        public DataTable GetPEMIDetails(int contractID, int? peID, DateTime? toDate, int? contractorID,
                                        string contractorType, int? workOrderID, string includeAllTypes)
        {
            return DAC.Instance.GetPEMIDetails(contractID, peID, toDate, contractorID, contractorType, workOrderID,
                                               includeAllTypes);
        }

        public void UndoApprovePE(int SelPEID)
        {
            DAC.Instance.UndoApprovePE(SelPEID);
        }

        public void CalculatePEDetails(int contractID, int peID)
        {
            var dic = new Dictionary&lt;string, object&gt;();
            ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                PayEstimateStoredProcedure.usp_CONTMGTPECalcPEDetails, dic, new object[] { peID, contractID });
        }

        internal DataTable GetSubmittedRFIList(int ContractID, int peID, DateTime toDate)
        {
            return RequestForInformationBL.Instance.GetRFIItemsForRAB(ContractID, peID, toDate);
        }

        public DataTable GetPEBasicSettings(int contractID, string moduleID)
        {
            return
                ComponentHelper.Instance.ExecuteDataSet(PayEstimateStoredProcedure.usp_CONTMGTPEGetPEBasicSettings, null,
                                                        contractID, moduleID).Tables[0];
        }

        internal string ValidatePEForFinal(int peID, string verifiableModules)
        {
            return DAC.Instance.ValidatePEForFinal(peID, verifiableModules);
        }

        internal DataTable GetTaxes(string company, string contractID, string invoiceID, string brixObjectId)
        {
            DataTable dtTemp = new BrixDataTable();
            string filterCriteria = &quot;&lt;XMLRoot&gt;&lt;POInvoiceId type=&#39;txt&#39;&gt;&quot; + invoiceID + &quot;&lt;/POInvoiceId&gt;&lt;/XMLRoot&gt;&quot;;
            var filter = new ConnectionFilter(filterCriteria, null, null, null, null);

            var dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
            dictAdditionalInfo.Add(RegisteredEIS.AX,
                                   new EISAdditionalInfo(RegisteredEIS.AX).AddInfo(&quot;AXCompany&quot;, company));
            var ConnectorParameters =
                new ConnectorParameters(dictAdditionalInfo, MethodBase.GetCurrentMethod(),
                                        AMP3ObjectType.Unknown, filter, null);
            DataSet ds = new BrixDataSet();
            int count = 0;
            if (IntegrationConnectorManager.HandleIntegration(ConnectorParameters, ref count, ref ds, true))
            {
                if (ds.Tables.Count &gt; 0)
                    dtTemp = ds.Tables[0];
            }

            return dtTemp;
        }

        public DataSet GetWFReqData(int peID)
        {
            return DAC.Instance.GetWFReqData(peID);
        }

        public decimal CalculateTotalAmount(int peid, decimal costAmt)
        {
            return DAC.Instance.CalculateTotalAmount(peid, costAmt);
        }

        public bool IsLatestPE(int POID, int PEID)
        {
            if (PEID == 0)
                return true;
            else
                return DAC.Instance.IsLatestPE(POID, PEID);
        }

        public string GetPENextRANumber(int POID)
        {
            return DAC.Instance.GetPENextRANumber(POID);
        }

        public DataTable GetRetentionPercent(int POTypeInstanceID, string POType)
        {
            DataSet ds = DAC.Instance.GetRetentionPercent(POTypeInstanceID, POType);
            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0)
                return ds.Tables[0];
            else
                return null;
        }

        public DataSet GetPreviousPEDetails(int POID, int PEID)
        {
            DataSet ds = DAC.Instance.GetPreviousPEDetails(POID, PEID);
            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0)
                return ds;
            else
                return null;
        }

        public DataSet GetPayEstimateDetails(int PEID, DateTime toDate)
        {
            return DAC.Instance.GetPayEstimateDetails(PEID, toDate);
        }

        public DataSet GetAvailablePostings(int POID, DateTime fromDate, DateTime toDate, int? PEID)
        {
            DataSet ds = DAC.Instance.GetAvailablePostings(POID, fromDate, toDate, PEID);
            if (ds != null)
                return ds;
            else
                return null;
        }

        public DataSet GetAvailablePostingsForPicker(int POID, DateTime fromDate, DateTime toDate, int? PEID, string filterIds, string filterText, string sortBy, int rowStartIdx, int rowEndIdx)
        {
            DataSet ds = DAC.Instance.GetAvailablePostingsForPicker(POID, fromDate, toDate, PEID, filterIds, filterText, sortBy, rowStartIdx, rowEndIdx);
            if (ds != null)
                return ds;
            else
                return null;
        }

        public DataTable GetUnbilledAdvance(int POID, int? PEID, DateTime ToDate)
        {
            DataSet ds = DAC.Instance.GetUnbilledAdvance(POID, PEID, ToDate);
            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0)
                return ds.Tables[0];
            else
                return null;
        }

        public DataSet GetPendingRecoveries(int POID, int? PEID, DateTime ToDate)
        {
            DataSet ds = DAC.Instance.GetPendingRecoveries(POID, PEID, ToDate);
            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0)
                return ds;
            else
                return null;
        }

        public ProcurementPERecoveriesDTO CreateUpdatePEAdvanceRecoveries(out Exception ex, out DataSet ds, Dictionary&lt;string, object&gt; dicOut, ProcurementPERecoveriesDTO dto)
        {
            return DAC.Instance.CreateUpdatePEAdvanceRecoveries(out ex, out ds, dicOut, dto);
        }

        public void DeleteRecoveryByWorkPostingID(string ids, int peid)
        {
            DAC.Instance.DeleteRecoveryByWorkPostingID(ids, peid);
        }

        public ProcurementPERecoveriesDTO CreateUpdatePEAdvanceRecoveryMaster(out Exception ex, out DataSet ds, Dictionary&lt;string, object&gt; dicOut, ProcurementPERecoveryMasterDTO dto)
        {
            ex = null; ds = null;
            ProcurementPERecoveriesDTO dt = null;
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(PayEstimateStoredProcedure.usp_PROCMGTCUPEAdvanceRecoveryMaster, dicOut, dto.RecoveryID, dto.PEAdvanceID, dto.PEID, dto.Amount);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows || ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new ProcurementPERecoveriesDTO();
                dr.FillDTO(dt);
            }
            catch (Exception e) { ex = e; }
            return dt;
        }

        public void DeletePEAdvanceRecoveryMaster(int RecoveryId)
        {
            ComponentHelper.Instance.ExecuteDataSet(PayEstimateStoredProcedure.usp_PROCMGTDeletePEAdvanceRecoveryMaster, null, RecoveryId);
        }

        public void UpdateAdvanceSummary(int PEID, int AdvanceID)
        {
            ComponentHelper.Instance.ExecuteDataSet(PayEstimateStoredProcedure.usp_PROCMGTUpdateAdvanceSummary, null, PEID, AdvanceID);
        }

        public bool ValidateUnapprove(int PEID)
        {
            return DAC.Instance.ValidateUnapprove(PEID);
        }

        public bool ValidatePreviousPEUnApproved(int PID, int PEID)
        {
            bool IsValid = false;
            IsValid = DAC.Instance.ValidatePreviousPEUnApproved(PID, PEID);
            return IsValid;
        }

        public bool ValidatePreviousPEApproved(int PID, int PEID)
        {
            bool IsValid = false;
            IsValid = DAC.Instance.ValidatePreviousPEApproved(PID, PEID);
            return IsValid;
        }

        public ProcurementCommitmentsDTO GetCommiments(int? POID, string POType, int? POTypeInstanceID)
        {
            ProcurementCommitmentsDTO dto = new ProcurementCommitmentsDTO();
            DataSet ds = DAC.Instance.GetCommiments(POID, POType, POTypeInstanceID);
            if (ds != null)
            {
                if (ds.Tables.Count &gt; 0 &amp;&amp; ds.Tables[0].Rows.Count &gt; 0)
                {
                    ds.Tables[0].Rows[0].FillDTO(dto);
                    List&lt;ProcurementCommitmentItemsDTO&gt; list = new List&lt;ProcurementCommitmentItemsDTO&gt;();
                    if (ds.Tables.Count &gt; 1 &amp;&amp; ds.Tables[1].Rows.Count &gt; 0)
                    {
                        for (int i = 0; i &lt; ds.Tables[1].Rows.Count; i++)
                        {
                            ProcurementCommitmentItemsDTO itemDto = new ProcurementCommitmentItemsDTO();
                            ds.Tables[1].Rows[i].FillDTO(itemDto);
                            list.Add(itemDto);
                        }
                        dto.CommitmentItems = list;
                    }
                }
            }
            return dto;
        }

        #region &quot;Validate Approve Pay Estimate&quot;

        public DataTable ValidatePE(int contractID, int PEID, PEOperations opn)
        {
            return DAC.Instance.ValidatePE(contractID, PEID, Operation(opn));
        }

        public string ValidatePayEstimate(ProcurementPayEstimateDTO dto, out string recordsWithError)
        {
            return DAC.Instance.ValidatePayEstimate(dto.PEID, dto.Status, out recordsWithError);
        }

        #endregion

        #region &quot;CUD Pay Estimate&quot;

        public Int32 CUDPE(int contractID, PEOperations opn, DTOPE dto)
        {
            var xml = new StringBuilder();

            //TODO:Merge - remove this createdDate and use dto.CreatedOn
            DateTime dt = dto.CreatedOn == null ? DateTime.UtcNow : dto.CreatedOn.ToDateTime_MWCulture().ToUtc();
            string createdDate = dt.ToString(&quot;MM/dd/yyyy HH:mm&quot;);
            xml.AppendFormat(CultureInfo.CurrentCulture,
                             &quot;&lt;XMLROOT&gt;\n&lt;PE&gt;&lt;OPN&gt;{0}&lt;/OPN&gt;\n&lt;ContractID&gt;{1}&lt;/ContractID&gt;\n&lt;CreatedBy&gt;{2}&lt;/CreatedBy&gt;&lt;CreatedOn&gt;{3}&lt;/CreatedOn&gt;&lt;RFI&gt;{4}&lt;/RFI&gt;\n&quot;,
                             Operation(opn), contractID, dto.CreatedBy, createdDate, dto.IsRFI.ToInt32_2());

            for (int i = 0; i &lt; dto.IDs.Count; i++)
            {
                xml.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;ID&gt;{0}&lt;/ID&gt;&quot;, dto.IDs[i]);
            }

            if (opn == PEOperations.Create || opn == PEOperations.Update)
            {
                xml.AppendFormat(CultureInfo.CurrentCulture,
                                 &quot;&lt;FromDt&gt;{0}&lt;/FromDt&gt;\n&lt;ToDt&gt;{1}&lt;/ToDt&gt;\n&lt;IncMOHRet&gt;{2}&lt;/IncMOHRet&gt;\n&lt;HoldRel&gt;{3}&lt;/HoldRel&gt;\n&lt;AdditionsTotal&gt;{4}&lt;/AdditionsTotal&gt;&quot; +
                                 &quot;\n&lt;DeductionsTotal&gt;{5}&lt;/DeductionsTotal&gt;\n&lt;Comments&gt;{6}&lt;/Comments&gt;&lt;ContractorID&gt;{7}&lt;/ContractorID&gt;&lt;ContractorType&gt;{8}&lt;/ContractorType&gt;&quot; +
                                 &quot;&lt;ContractAdvRecoveryPercent&gt;{9}&lt;/ContractAdvRecoveryPercent&gt;&lt;WOID&gt;{10}&lt;/WOID&gt;\n&lt;RetAmtFromRule&gt;{11}&lt;/RetAmtFromRule&gt;\n&lt;IsFinal&gt;{12}&lt;/IsFinal&gt;&quot; +
                                 &quot;\n&lt;RetentionReleaseDate&gt;{13}&lt;/RetentionReleaseDate&gt;\n&lt;RetentionMode&gt;{14}&lt;/RetentionMode&gt;&lt;RetentionPercent&gt;{15}&lt;/RetentionPercent&gt;&quot; +
                                 &quot;&lt;RetReleaseAmt&gt;{16}&lt;/RetReleaseAmt&gt;&quot;,
                                DateTime.Parse(dto.FromDt.ToDateTime_MWCulture().ToDateOnlyString_ForDatabaseOpenXml() +
                                 &quot; 12:00:00 AM&quot;).ToUtc(),
                                 DateTime.Parse(dto.ToDt.ToDateTime_MWCulture().ToDateOnlyString_ForDatabaseOpenXml() +
                                 &quot; 23:59:59 PM&quot;).ToUtc(), dto.DedMOHRet ?? &quot;N&quot;, dto.RetainageRelP, dto.AdditionsTotal,
                                 dto.DeductionsTotal, UIHelper.ReplaceXMLCharEntities(dto.Comments), dto.ContractorID, dto.ContractorType,
                                 dto.ContractAdvRecoveryPercent.ToString2(), dto.WOID.ToString2(),
                                 dto.RetAmtFromRule.ToDecimal2(), dto.IsFinal, dto.RetentionReleaseDate, dto.RetentionMode, dto.RetentionPercent, dto.RetReleaseAmt);
                if (dto.Postings.Count &gt; 0)
                {
                    xml.Append(&quot;&lt;Postings&gt;\n&quot;);
                    for (int n = 0; n &lt; dto.Postings.Count; n++)
                    {
                        xml.Append(&quot;&lt;Posting&gt;&quot;);
                        xml.AppendFormat(CultureInfo.CurrentCulture,
                                         &quot;&lt;ID&gt;{0}&lt;/ID&gt;&lt;ItemID&gt;{1}&lt;/ItemID&gt;&lt;ActivityID&gt;{2}&lt;/ActivityID&gt;&quot;,
                                         dto.Postings[n].ID, dto.Postings[n].ItemID, dto.Postings[n].ActivityID);
                        if (dto.Postings[n].MBQuantity.HasValue)
                            xml.AppendFormat(CultureInfo.CurrentCulture,
                                             &quot;&lt;MBQuantity&gt;{0}&lt;/MBQuantity&gt;&lt;CertifiedQuantity&gt;{1}&lt;/CertifiedQuantity&gt;&quot;,
                                             dto.Postings[n].MBQuantity.Value, dto.Postings[n].CertifiedQuantity.Value);
                        if (dto.Postings[n].BillingRate.HasValue)
                            xml.AppendFormat(CultureInfo.CurrentCulture,
                                             &quot;&lt;BillingRate&gt;{0}&lt;/BillingRate&gt;&lt;IsPartRate&gt;{1}&lt;/IsPartRate&gt;&lt;ParentId&gt;{2}&lt;/ParentId&gt;&quot;,
                                             dto.Postings[n].BillingRate.Value, dto.Postings[n].IsPartRate.Value,
                                             dto.Postings[n].ParentId.Value);
                        xml.Append(&quot;&lt;/Posting&gt;&quot;);
                    }
                    xml.Append(&quot;&lt;/Postings&gt;\n&quot;);
                }
                else if (dto.MBooks.Count &gt; 0)
                {
                    xml.Append(&quot;&lt;MBooks&gt;\n&quot;);
                    for (int n = 0; n &lt; dto.MBooks.Count; n++)
                    {
                        xml.Append(&quot;&lt;MBook&gt;&quot;);
                        xml.AppendFormat(CultureInfo.CurrentCulture,
                                         &quot;&lt;MBookItemID&gt;{0}&lt;/MBookItemID&gt;&lt;BillingQty&gt;{1}&lt;/BillingQty&gt;&lt;CertifiedQty&gt;{2}&lt;/CertifiedQty&gt;&lt;UnitRate&gt;{3}&lt;/UnitRate&gt;&lt;BillingRate&gt;{4}&lt;/BillingRate&gt;&lt;ParentID&gt;{5}&lt;/ParentID&gt;&lt;IsPartRate&gt;{6}&lt;/IsPartRate&gt;&quot;,
                                         dto.MBooks[n].MBookItemId.Value, dto.MBooks[n].BillingQty.Value,
                                         dto.MBooks[n].CertifiedQty.Value, dto.MBooks[n].UnitRate.Value,
                                         dto.MBooks[n].BillingRate.Value, dto.MBooks[n].ParentID,
                                         dto.MBooks[n].IsPartRate);
                        xml.Append(&quot;&lt;/MBook&gt;&quot;);
                    }
                    xml.Append(&quot;&lt;/MBooks&gt;\n&quot;);
                }

                #region Pay Estimate Prepayments

                xml.Append(&quot;&lt;PEPrepayments&gt;\n&quot;);
                for (int i = 0; i &lt; dto.Prepayments.Count; i++)
                {
                    xml.AppendFormat(CultureInfo.CurrentCulture,
                                     &quot;&lt;Prepayment&gt;&lt;MOHID&gt;{0}&lt;/MOHID&gt;&lt;Amount&gt;{1}&lt;/Amount&gt;&lt;CurrentRecovery&gt;{2}&lt;/CurrentRecovery&gt;&lt;/Prepayment&gt;&quot;,
                                     dto.Prepayments[i].MOHID, dto.Prepayments[i].Amount,
                                     dto.Prepayments[i].CurrentRecovery);
                }
                xml.Append(&quot;&lt;/PEPrepayments&gt;\n&quot;);

                #endregion

                #region Pay Estimate Material Deductions

                xml.Append(&quot;&lt;PEMaterialDeductions&gt;\n&quot;);
                for (int i = 0; i &lt; dto.MaterialDeductions.Count; i++)
                {
                    xml.AppendFormat(CultureInfo.CurrentCulture,
                                     &quot;&lt;MaterialDeduction&gt;&lt;MIListID&gt;{0}&lt;/MIListID&gt;&quot; +
                                     &quot;&lt;ResourceDetailID&gt;{1}&lt;/ResourceDetailID&gt;&quot; +
                                     &quot;&lt;CurrentRecoveryQty&gt;{2}&lt;/CurrentRecoveryQty&gt;&quot; +
                                     &quot;&lt;CurrentRecoveryRate&gt;{3}&lt;/CurrentRecoveryRate&gt;&lt;/MaterialDeduction&gt;&quot;,
                                     dto.MaterialDeductions[i].MIListID,
                                     dto.MaterialDeductions[i].ResourceDetailID,
                                     dto.MaterialDeductions[i].RecoveredQuantity,
                                     dto.MaterialDeductions[i].RecoveredRate);
                }
                xml.Append(&quot;&lt;/PEMaterialDeductions&gt;\n&quot;);

                #endregion

                #region Pay Estimate Adjustments

                xml.Append(&quot;&lt;PEAdjustments&gt;\n&quot;);
                for (int i = 0; i &lt; dto.Adjustments.Count; i++)
                {
                    xml.AppendFormat(CultureInfo.CurrentCulture,
                                     &quot;&lt;Adjustment&gt;&lt;AdjustmentID&gt;{0}&lt;/AdjustmentID&gt;&quot; +
                                     &quot;&lt;AdjustmentType&gt;{1}&lt;/AdjustmentType&gt;&quot; +
                                     &quot;&lt;AdjustmentDescription&gt;{2}&lt;/AdjustmentDescription&gt;&quot; +
                                     &quot;&lt;Amount&gt;{3}&lt;/Amount&gt;&lt;/Adjustment&gt;&quot;,
                                     dto.Adjustments[i].AdjustmentID,
                                     dto.Adjustments[i].AdjustmentType,
                                     dto.Adjustments[i].AdjustmentDescription,
                                     dto.Adjustments[i].Amount);
                }
                xml.Append(&quot;&lt;/PEAdjustments&gt;\n&quot;);

                #endregion
            }

            if (dto.RetainageP.HasValue)
                xml.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;RetP&gt;{0}&lt;/RetP&gt;&quot;, dto.RetainageP.Value);
            xml.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;HoldAmtCurr&gt;{0}&lt;/HoldAmtCurr&gt;&quot;, dto.HoldAmtCurr);

            xml.Append(&quot;&lt;/PE&gt;\n&lt;/XMLROOT&gt;\n&quot;);

            return DAC.Instance.CUDPE(xml);
        }

        #endregion

        #region &quot;Get Item Postings&quot;

        #endregion

        #region &quot;Get PE Settings&quot;

        public DataSet GetAllPESettings(int contractID, int? contractorID, string contractorType, int? woid)
        {
            return DAC.Instance.GetAllPESettings(contractID, contractorID, contractorType, woid);
        }

        /// &lt;summary&gt;
        /// This will retrun a string to set the Item grid header based on the settings
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;woId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;contractId&quot;&gt;Contract ID &lt;/param&gt;
        /// &lt;returns&gt;Header which can be directly bided to label&lt;/returns&gt;
        public string GetItemGridHeader(int woId, int contractId)
        {
            //If workorder id is 0 then it is for prime contractor
            string type = (woId == 0) ? &quot;P&quot; : &quot;S&quot;;
            DataTable dt = DAC.Instance.GetContractorSourceAndType(contractId, type);
            string header;
            if (type.Equals(&quot;S&quot;))
            {
                header = (dt.Rows[0][&quot;Source&quot;].ToString2().Equals(&quot;1&quot;)) ? PEConstants.ItemPostings : PEConstants.MBooks.Replace(&quot;Measurement Book&quot;, LocalizationManager.GetString(&quot;LOC_MeasurementBook&quot;));
            }
            else
            {
                header = (dt.Rows[0][&quot;Source&quot;].ToString2().Equals(&quot;1&quot;))
                             ? ((dt.Rows[0][&quot;Items&quot;].ToString2().Equals(&quot;1&quot;))
                                    ? PEConstants.SubmittedRFI.Replace(&quot;RFI&quot;, LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;))
                                    : PEConstants.ApprovedRFI.Replace(&quot;RFI&quot;, LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;)))
                             : PEConstants.ItemPostings;
            }
            return header;
        }

        #endregion

        #region &quot;CUD PE Settings&quot;

        public void UpdateSettings(int contractID, PESettings dto)
        {
            var xml = new StringBuilder();

            xml.AppendFormat(CultureInfo.CurrentCulture,
                             &quot;&lt;XMLROOT&gt;\n&lt;ContractID&gt;{0}&lt;/ContractID&gt;&lt;PESETTINGS&gt;&lt;TIERED&gt;{1}&lt;/TIERED&gt;{2}\n&lt;TIERS&gt;&quot;,
                             contractID, dto.Tiered,
                             (dto.ContractAmount.HasValue ? &quot;&lt;MAXAMT&gt;&quot; + dto.ContractAmount + &quot;&lt;/MAXAMT&gt;&quot; : String.Empty)
                             +
                             (dto.RecoveryPercentage.HasValue
                                  ? &quot;&lt;RECPER&gt;&quot; + dto.RecoveryPercentage + &quot;&lt;/RECPER&gt;&quot;
                                  : String.Empty)
                );

            for (int i = 0; i &lt; dto.Tiers.Rows.Count; i++)
            {
                xml.AppendFormat(CultureInfo.CurrentCulture,
                                 &quot;&lt;TIER&gt;\n&lt;START&gt;{0}&lt;/START&gt;\n&lt;END&gt;{1}&lt;/END&gt;\n&lt;PERCENT&gt;{2}&lt;/PERCENT&gt;\n&lt;/TIER&gt;&quot;,
                                 dto.Tiers.Rows[i][&quot;Start&quot;], dto.Tiers.Rows[i][&quot;End&quot;], dto.Tiers.Rows[i][&quot;Percent&quot;]);
            }
            xml.Append(&quot;&lt;/TIERS&gt;\n&lt;/PESETTINGS&gt;&lt;/XMLROOT&gt;&quot;);

            DAC.Instance.UpdateSettings(xml);
        }

        #endregion

        #region &quot;Details Report&quot;

        public DataSet GetAllDetails(int contractID, int peID, string type)
        {
            return DAC.Instance.GetAllDetails(contractID, peID, type);
        }

        #endregion

        #region MBook

        ///// &lt;summary&gt;
        ///// Returns Measurement Book List
        ///// &lt;/summary&gt;
        ///// &lt;param name=&quot;woId&quot;&gt;Work Order ID&lt;/param&gt;
        ///// &lt;param name=&quot;filter&quot;&gt;Contains dates, PEID and status&lt;/param&gt;
        ///// &lt;returns&gt;&lt;/returns&gt;
        public DataTable GetPEMBookDetails(int workOrderID, string filter)
        {
            return DAC.Instance.GetPEMBookDetails(workOrderID, filter);
        }

        /// &lt;summary&gt;
        /// Returns the details of the selected MBooks
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;selectedMBooks&quot;&gt;Selected MBooks in XML&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public DataSet GetSelectedMBookDetails(int workOrderID, int pEID, string selectedMBooks, string existingMBooks,
                                               string existingPRMBooks)
        {
            return DAC.Instance.GetSelectedMBookDetails(workOrderID, pEID, selectedMBooks, existingMBooks,
                                                        existingPRMBooks);
        }

        /// &lt;summary&gt;
        /// Returns the details of the selected ACTI WO MBooks
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;selectedMBooks&quot;&gt;Selected MBooks in XML&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public DataTable GetSelectedACTIWOMBookDetails(int workOrderID, int pEID, string selectedMBooks,
                                                       string existingMBooks, string existingPRMBooks)
        {
            return DAC.Instance.GetSelectedACTIWOMBookDetails(workOrderID, pEID, selectedMBooks, existingMBooks,
                                                              existingPRMBooks);
        }

        #endregion

        #region Part Rates

        #region MBook Part Rates

        /// &lt;summary&gt;
        /// Gets part rate Activities for Activity based Work order
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;workOrderID&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;peId&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public DataTable GetPartRates(int workOrderID, int peId)
        {
            return DAC.Instance.GetPartRates(workOrderID, peId);
        }

        /// &lt;summary&gt;
        /// Gets part rate Activities for Activity based Work order
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;workOrderID&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;peId&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public DataTable GetACTIPartRates(int workOrderID, int peId)
        {
            return DAC.Instance.GetACTIPartRates(workOrderID, peId);
        }

        #endregion

        #region RFI Part Rates

        public DataTable GetPartRateRFIs(int contractId, int peId)
        {
            return DAC.Instance.GetPartRateRFIs(contractId, peId);
        }

        #endregion

        #region Itempostings Part Rates

        public DataTable GetPartRateIPs(int contractId, int workOrderId, int peId)
        {
            return DAC.Instance.GetPartRateIPs(contractId, workOrderId, peId);
        }

        public DataTable GetACTIWOPartRateIPs(int contractId, int workOrderId, int peId)
        {
            return DAC.Instance.GetACTIWOPartRateIPs(contractId, workOrderId, peId);
        }

        #endregion

        #endregion

        #region Additions/Deductions

        public DataTable GetPEAdjustmentDetails(int? peID, int? adjustmentType)
        {
            return
                ComponentHelper.Instance.ExecuteDataSet(PayEstimateStoredProcedure.usp_CONTMGTPEGetAdjustmentDetails,
                                                        null, peID, adjustmentType).Tables[0];
        }

        public DataTable GetAdjustmentMasterList(string company, int? adjustmentType)
        {
            if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX))
            {
                int count = 0;
                var ds = new DataSet();
                string filter = &quot;&lt;XMLRoot&gt;&lt;AdjustmentType Type=&#39;int&#39;&gt;&quot; + adjustmentType + &quot;&lt;/AdjustmentType&gt;&lt;/XMLRoot&gt;&quot;;
                var objAdditionalInfo = new EISAdditionalInfo(RegisteredEIS.AX);
                objAdditionalInfo.AddInfo(Constants.EIS_ADDITIONAL_INFO, company);
                var dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
                dictAdditionalInfo.Add(RegisteredEIS.AX, objAdditionalInfo);
                var connectorParameters =
                    new ConnectorParameters(dictAdditionalInfo, MethodBase.GetCurrentMethod(), AMP3ObjectType.Unknown,
                                            new ConnectionFilter(filter, null, null, null, null), null);

                if (IntegrationConnectorManager.HandleIntegration(connectorParameters, ref count, ref ds, true))
                {
                    return ds.Tables[0];
                }
                else
                    return new DataTable();
            }
            else
                return GetPEAdjustmentDetails(null, adjustmentType);
        }



        #endregion

        #region &quot;CUD Retainage Release&quot;

        public void CUDPERet(int contractID, PEOperations opn, DTOPERet dto)
        {
            var xml = new StringBuilder();

            xml.AppendFormat(CultureInfo.CurrentCulture,
                             &quot;&lt;XMLROOT&gt;\n&lt;RET&gt;&lt;OPN&gt;{0}&lt;/OPN&gt;\n&lt;ContractID&gt;{1}&lt;/ContractID&gt;\n&lt;CreatedBy&gt;{2}&lt;/CreatedBy&gt;\n&quot;,
                             Operation(opn), contractID, dto.CreatedBy);

            for (int i = 0; i &lt; dto.IDs.Count; i++)
            {
                xml.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;ID&gt;{0}&lt;/ID&gt;&quot;, dto.IDs[i]);
            }

            if (opn == PEOperations.Create || opn == PEOperations.Update)
            {
                xml.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;Amt&gt;{0}&lt;/Amt&gt;\n&quot;, dto.Amt ?? 0);
            }

            xml.Append(&quot;&lt;/RET&gt;\n&lt;/XMLROOT&gt;\n&quot;);

            DAC.Instance.CUDPE(xml);
        }

        #endregion

        #region &quot;Get Pay Estimates&quot;

        public int GetPECount(int contractID, string filterSearch)
        {
            return DAC.Instance.GetPECount(contractID, filterSearch);
        }

        public int GetPECount(int contractID, string filterSearch, int? workOrderID)
        {
            return DAC.Instance.GetPECount(contractID, filterSearch, workOrderID);
        }

        public int GetApprovedPECount(int contractID, int? workOrderID)
        {
            return DAC.Instance.GetApprovedPECount(contractID, workOrderID);
        }

        public DataTable GetPE(int contractID, object startRowIdx, object maxRows, string sortOrder, string filterSearch,
                               string export)
        {
            return DAC.Instance.GetPE(contractID, startRowIdx, maxRows, sortOrder, filterSearch, export);
        }

        public DataTable GetPE(int contractID, object startRowIdx, object maxRows, string sortOrder, string filterSearch,
                               string export, int? workOrderId)
        {
            return DAC.Instance.GetPE(contractID, startRowIdx, maxRows, sortOrder, filterSearch, export, workOrderId);
        }

        public DataSet GetItemsPE(int contractID, int? peID, string filterSearch)
        {
            return DAC.Instance.GetItemsPE(contractID, peID, filterSearch);
        }

        public DataSet GetPE(int contractID, int peID, int? workOrderID)
        {
            return DAC.Instance.GetPE(contractID, peID, workOrderID);
        }

        public DataSet GetPE(int contractID, int peID)
        {
            return DAC.Instance.GetPE(contractID, peID);
        }

        public DataTable GetActivitiesPE(int contractID, int? peID, string filterSearch)
        {
            return DAC.Instance.GetActivitiesPE(contractID, peID, filterSearch);
        }

        public String GetNextPEID(int contractID, int? workOrderId)
        {
            return DAC.Instance.GetNextPEID(contractID, workOrderId);
        }

        public string GetContrItemSource(int contractID, string type)
        {
            return DAC.Instance.GetContrItemSource(contractID, type);
        }

        internal DataTable GetEquipmentLogsPE(int contractId, int? peId, string filterSearch)
        {
            return DAC.Instance.GetEquipmentLogsPE(contractId, peId, filterSearch).Tables[0];
        }

        internal DataSet GetAdditionsDeductions(int peid)
        {
            return DAC.Instance.GetAdditionsDeductions(peid);
        }

        #endregion

        #region &quot;Get Retainage Release&quot;

        public int GetPERetCount(int contractID, string filterSearch)
        {
            return DAC.Instance.GetPERetCount(contractID, filterSearch);
        }

        public DataTable GetPERet(int contractID, object startRowIdx, object maxRows, string sortOrder,
                                  string filterSearch)
        {
            return DAC.Instance.GetPERet(contractID, startRowIdx, maxRows, sortOrder, filterSearch);
        }

        public DataTable GetPERet(int contractID, int peID)
        {
            return DAC.Instance.GetPERet(contractID, peID);
        }

        #endregion

        #region IModuleInstances Members

        public string GetModuleInstances(string parentID, string parentModuleID)
        {
            return &quot;select PEID from vw_PAYESTMDetails where ((POType = &#39;CONTMGT&#39; and POTypeInstanceID = &quot; + parentID + &quot;) or (POType = &#39;WORKORD&#39; and POTypeInstanceID in (SELECT WorkOrderID from WORKORDMain where ContractID = &quot; + parentID + &quot;)))&quot;;
        }
        #endregion


        public DataSet ValidatePayEstimates(int PEID, int POID, string XMLString, string xmlCurrentWD)
        {
            return DAC.Instance.ValidatePayEstimates(PEID, POID, XMLString, xmlCurrentWD);
        }

        public bool RetentionOnAdjustments()
        {
            List&lt;string&gt; components = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_PAYESTM);

            return components.Contains(&quot;RetentionOnAdjustments&quot;);
        }


        public bool RetentionOnAdvances()
        {
            List&lt;string&gt; components = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_PAYESTM);

            return components.Contains(&quot;RetentionOnAdvances&quot;);
        }

        /// &lt;summary&gt;
        /// returns dictionary for positive and negative qty lookup for workItems
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;poTypeInstanceID&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;

        public Dictionary&lt;int, PayEstimate_WorkItemDto&gt; GetPEDetailsQtyByPOTypeInstanceID(List&lt;int&gt; workItemIdList, int poTypeInstanceID, int? payEstimateIdToExclude)
        {
            workItemIdList = workItemIdList.Distinct().ToList();

            string csvItemsId = string.Join(&quot;,&quot;, workItemIdList);

            DataSet ds = DAC.Instance.GetPEDetailsQtyByPOTypeInstanceID(csvItemsId, &quot;CONTMGT&quot;, poTypeInstanceID, payEstimateIdToExclude);

            Dictionary&lt;int, PayEstimate_WorkItemDto&gt; returnDictionary = new Dictionary&lt;int, PayEstimate_WorkItemDto&gt;();

            if (ds.Tables.Count &gt; 0)
            {
                if (ds.Tables[0].Rows.Count &lt; workItemIdList.Count)
                    throw new Exception(string.Format(&quot;Some work item validaitons could not be fetched [0].&quot;, string.Join(&quot;,&quot;, workItemIdList)));

                foreach (DataRow row in ds.Tables[0].Rows)
                {
                    PayEstimate_WorkItemDto dto = new PayEstimate_WorkItemDto()
                    {
                        POTypeInstanceID = poTypeInstanceID,
                        WorkItemId = row[&quot;WorkItemID&quot;].ToInt32_2(),
                        MaxAllowedQty = row[&quot;MaxAllowedQty&quot;].ToDecimal2(),

                        AnyExistingWorkDone = (row[&quot;AnyExistingWorkDone&quot;] == System.DBNull.Value) ? false : row[&quot;AnyExistingWorkDone&quot;].ToBoolean2(),

                        PositivePostedQty = (row[&quot;PositivePostedQty&quot;] == System.DBNull.Value) ? 0 : row[&quot;PositivePostedQty&quot;].ToDecimal2(),
                        NegativePostedQty = (row[&quot;NegativePostedQty&quot;] == System.DBNull.Value) ? 0 : row[&quot;NegativePostedQty&quot;].ToDecimal2()
                    };

                    returnDictionary.Add(dto.WorkItemId, dto);
                }
            }

            return returnDictionary;
        }

        public string ValidateMOHForPE(int peid)
        {
            int result = DAC.Instance.ValidateMOHForPE(peid);

            if (result == -1)
            {
                return &quot;One or more MOH added to this Pay Estimate are already closed. Pay Estimate cannot be approved.&quot;;
            }

            return string.Empty;
        }
    }

    [Context(Name = &quot;PAYESTM&quot;)]
    public class COBreadCrumb : ContractBreadCrumb
    {
    }

    public class PayEstimate_WorkItemDto
    {
        public int WorkItemId { get; set; }
        public int POTypeInstanceID { get; set; }

        public decimal MaxAllowedQty { get; set; }

        /// &lt;summary&gt;
        /// This will be false if there were no pay estimate records created for the workItem
        /// &lt;/summary&gt;
        public bool AnyExistingWorkDone { get; set; }

        public decimal PositivePostedQty { get; set; }
        public decimal NegativePostedQty { get; set; }

        public decimal TotalPostedQty { get { return PositivePostedQty + NegativePostedQty; } }


    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[27,9,27,20,1],[27,21,27,22,1],[27,23,27,24,1],[30,9,30,10,0],[31,13,31,40,0],[32,13,32,25,0],[35,21,35,32,0],[36,21,36,27,0],[38,21,38,32,0],[39,21,39,27,0],[41,21,41,33,0],[42,21,42,27,0],[44,21,44,33,0],[45,21,45,27,0],[47,21,47,33,0],[48,21,48,27,0],[50,21,50,32,0],[51,21,51,27,0],[53,21,53,33,0],[54,21,54,27,0],[56,13,56,25,0],[57,9,57,10,0],[62,9,62,10,0],[63,13,64,98,0],[65,9,65,10,0],[69,9,69,10,0],[70,13,71,65,0],[72,9,72,10,0],[75,9,75,10,0],[76,13,76,49,0],[77,9,77,10,0],[80,9,80,10,0],[81,13,81,56,0],[82,13,83,112,0],[84,9,84,10,0],[87,9,87,10,0],[88,13,88,97,0],[89,9,89,10,0],[92,9,92,10,0],[93,13,95,89,0],[96,9,96,10,0],[99,9,99,10,0],[100,13,100,77,0],[101,9,101,10,0],[104,9,104,10,0],[105,13,105,52,0],[106,13,106,114,0],[107,13,107,87,0],[109,13,109,89,0],[110,13,111,107,0],[112,13,114,79,0],[115,13,115,44,0],[116,13,116,27,0],[117,13,117,109,0],[118,13,118,14,0],[119,17,119,41,0],[120,21,120,43,0],[121,13,121,14,0],[123,13,123,27,0],[124,9,124,10,0],[127,9,127,10,0],[128,13,128,52,0],[129,9,129,10,0],[132,9,132,10,0],[133,13,133,69,0],[134,9,134,10,0],[137,9,137,10,1],[138,13,138,27,1],[139,17,139,29,1],[141,17,141,60,0],[142,9,142,10,1],[145,9,145,10,1],[146,13,146,57,1],[147,9,147,10,1],[150,9,150,10,1],[151,13,151,85,1],[152,13,152,51,1],[153,17,153,37,1],[155,17,155,29,0],[156,9,156,10,1],[159,9,159,10,1],[160,13,160,72,1],[161,13,161,51,1],[162,17,162,27,1],[164,17,164,29,0],[165,9,165,10,1],[168,9,168,10,0],[169,13,169,69,0],[170,9,170,10,0],[173,9,173,10,1],[174,13,174,90,1],[175,13,175,28,1],[176,17,176,27,1],[178,17,178,29,0],[179,9,179,10,1],[182,9,182,10,0],[183,13,183,154,0],[184,13,184,28,0],[185,17,185,27,0],[187,17,187,29,0],[188,9,188,10,0],[191,9,191,10,1],[192,13,192,78,1],[193,13,193,51,1],[194,17,194,37,1],[196,17,196,29,0],[197,9,197,10,1],[200,9,200,10,1],[201,13,201,80,1],[202,13,202,51,1],[203,17,203,27,1],[205,17,205,29,0],[206,9,206,10,1],[209,9,209,10,0],[210,13,210,94,0],[211,9,211,10,0],[214,9,214,10,0],[215,13,215,67,0],[216,9,216,10,0],[219,9,219,10,0],[220,13,220,23,0],[220,24,220,34,0],[221,13,221,50,0],[223,13,223,14,0],[224,17,224,190,0],[225,17,225,136,0],[225,137,225,149,0],[226,17,226,51,0],[227,17,227,55,0],[228,17,228,32,0],[229,13,229,14,0],[230,13,230,32,0],[230,33,230,34,0],[230,35,230,42,0],[230,43,230,44,0],[231,13,231,23,0],[232,9,232,10,0],[235,9,235,10,0],[236,13,236,140,0],[237,9,237,10,0],[240,9,240,10,0],[241,13,241,136,0],[242,9,242,10,0],[245,9,245,10,0],[246,13,246,57,0],[247,9,247,10,0],[250,9,250,10,0],[251,13,251,34,0],[252,13,252,76,0],[253,13,253,28,0],[254,9,254,10,0],[257,9,257,10,1],[258,13,258,34,1],[259,13,259,74,1],[260,13,260,28,1],[261,9,261,10,1],[264,9,264,10,1],[265,13,265,77,1],[266,13,266,85,1],[267,13,267,28,1],[268,13,268,14,1],[269,17,269,72,1],[270,17,270,18,1],[271,21,271,55,1],[272,21,272,106,1],[273,21,273,76,1],[274,21,274,22,1],[275,30,275,39,1],[275,41,275,68,1],[275,70,275,73,1],[276,25,276,26,1],[277,29,277,105,1],[278,29,278,67,1],[279,29,279,47,1],[280,25,280,26,1],[281,25,281,52,1],[282,21,282,22,1],[283,17,283,18,1],[284,13,284,14,1],[285,13,285,24,1],[286,9,286,10,1],[291,9,291,10,0],[292,13,292,78,0],[293,9,293,10,0],[296,9,296,10,1],[297,13,297,97,1],[298,9,298,10,1],[305,9,305,10,0],[306,13,306,43,0],[309,13,309,114,0],[310,13,310,66,0],[311,13,313,109,0],[315,18,315,27,0],[315,29,315,46,0],[315,48,315,51,0],[316,13,316,14,0],[317,17,317,90,0],[318,13,318,14,0],[320,13,320,74,0],[321,13,321,14,0],[322,17,334,166,0],[335,17,335,44,0],[336,17,336,18,0],[337,21,337,48,0],[338,26,338,35,0],[338,37,338,59,0],[338,61,338,64,0],[339,21,339,22,0],[340,25,340,49,0],[341,25,343,114,0],[344,25,344,65,0],[345,29,347,121,0],[348,25,348,66,0],[349,29,352,78,0],[353,25,353,50,0],[354,21,354,22,0],[355,21,355,49,0],[356,17,356,18,0],[357,22,357,47,0],[358,17,358,18,0],[359,21,359,46,0],[360,26,360,35,0],[360,37,360,57,0],[360,59,360,62,0],[361,21,361,22,0],[362,25,362,47,0],[363,25,368,68,0],[369,25,369,48,0],[370,21,370,22,0],[371,21,371,47,0],[372,17,372,18,0],[376,17,376,49,0],[377,22,377,31,0],[377,33,377,58,0],[377,60,377,63,0],[378,17,378,18,0],[379,21,382,74,0],[383,17,383,18,0],[384,17,384,50,0],[390,17,390,56,0],[391,22,391,31,0],[391,33,391,65,0],[391,67,391,70,0],[392,17,392,18,0],[393,21,401,79,0],[402,17,402,18,0],[403,17,403,57,0],[409,17,409,49,0],[410,22,410,31,0],[410,33,410,58,0],[410,60,410,63,0],[411,17,411,18,0],[412,21,420,65,0],[421,17,421,18,0],[422,17,422,50,0],[425,13,425,14,0],[427,13,427,41,0],[428,17,428,104,0],[429,13,429,109,0],[431,13,431,47,0],[433,13,433,44,0],[434,9,434,10,0],[445,9,445,10,0],[446,13,446,98,0],[447,9,447,10,0],[456,9,456,10,0],[458,13,458,51,0],[459,13,459,86,0],[461,13,461,34,0],[462,13,462,14,0],[463,17,463,203,0],[464,13,464,14,0],[466,13,466,14,0],[467,17,471,57,0],[472,13,472,14,0],[473,13,473,27,0],[474,9,474,10,0],[481,9,481,10,0],[482,13,482,43,0],[484,13,492,19,0],[494,18,494,27,0],[494,29,494,53,0],[494,55,494,58,0],[495,13,495,14,0],[496,17,498,118,0],[499,13,499,14,0],[500,13,500,61,0],[502,13,502,46,0],[503,9,503,10,0],[510,9,510,10,0],[511,13,511,71,0],[512,9,512,10,0],[525,9,525,10,0],[526,13,526,72,0],[527,9,527,10,0],[536,9,536,10,0],[537,13,538,75,0],[539,9,539,10,0],[548,9,548,10,0],[549,13,550,81,0],[551,9,551,10,0],[566,9,566,10,0],[567,13,567,65,0],[568,9,568,10,0],[577,9,577,10,0],[578,13,578,69,0],[579,9,579,10,0],[586,9,586,10,0],[587,13,587,67,0],[588,9,588,10,0],[595,9,595,10,0],[596,13,596,79,0],[597,9,597,10,0],[600,9,600,10,0],[601,13,601,85,0],[602,9,602,10,0],[611,9,611,10,0],[612,13,614,95,0],[615,9,615,10,0],[618,9,618,10,0],[619,13,619,103,0],[620,13,620,14,0],[621,17,621,31,0],[622,17,622,40,0],[623,17,623,121,0],[624,17,624,81,0],[625,17,625,83,0],[626,17,626,93,0],[627,17,627,77,0],[628,17,630,105,0],[632,17,632,113,0],[633,17,633,18,0],[634,21,634,41,0],[637,21,637,44,0],[640,17,640,69,0],[641,9,641,10,0],[650,9,650,10,0],[651,13,651,43,0],[653,13,655,73,0],[657,18,657,27,0],[657,29,657,46,0],[657,48,657,51,0],[658,13,658,14,0],[659,17,659,90,0],[660,13,660,14,0],[662,13,662,74,0],[663,13,663,14,0],[664,17,664,96,0],[665,13,665,14,0],[667,13,667,48,0],[669,13,669,37,0],[670,9,670,10,0],[677,9,677,10,0],[678,13,678,70,0],[679,9,679,10,0],[682,9,682,10,0],[683,13,683,83,0],[684,9,684,10,0],[687,9,687,10,0],[688,13,688,77,0],[689,9,689,10,0],[693,9,693,10,0],[694,13,694,106,0],[695,9,695,10,0],[699,9,699,10,0],[700,13,700,119,0],[701,9,701,10,0],[704,9,704,10,0],[705,13,705,76,0],[706,9,706,10,0],[709,9,709,10,0],[710,13,710,70,0],[711,9,711,10,0],[714,9,714,10,0],[715,13,715,57,0],[716,9,716,10,0],[719,9,719,10,0],[720,13,720,81,0],[721,9,721,10,0],[724,9,724,10,0],[725,13,725,70,0],[726,9,726,10,0],[729,9,729,10,0],[730,13,730,70,0],[731,9,731,10,0],[734,9,734,10,0],[735,13,735,94,0],[736,9,736,10,0],[739,9,739,10,0],[740,13,740,62,0],[741,9,741,10,0],[748,9,748,10,0],[749,13,749,73,0],[750,9,750,10,0],[754,9,754,10,0],[755,13,755,101,0],[756,9,756,10,0],[759,9,759,10,0],[760,13,760,60,0],[761,9,761,10,0],[768,9,768,10,0],[769,13,769,248,0],[770,9,770,10,0],[775,9,775,10,0],[776,13,776,91,0],[777,9,777,10,0],[780,9,780,10,1],[781,13,781,108,1],[783,13,783,66,1],[784,9,784,10,1],[788,9,788,10,1],[789,13,789,108,1],[791,13,791,63,1],[792,9,792,10,1],[801,9,801,10,0],[802,13,802,65,0],[804,13,804,66,0],[806,13,806,138,0],[808,13,808,120,0],[810,13,810,37,0],[811,13,811,14,0],[812,17,812,68,0],[813,21,813,146,0],[815,17,815,24,0],[815,26,815,37,0],[815,38,815,40,0],[815,41,815,58,0],[816,17,816,18,0],[817,21,827,23,0],[829,21,829,63,0],[830,17,830,18,0],[831,13,831,14,0],[833,13,833,37,0],[834,9,834,10,0],[837,9,837,10,1],[838,13,838,62,1],[840,13,840,30,1],[841,13,841,14,0],[842,17,842,122,0],[845,13,845,33,1],[846,9,846,10,1],[856,33,856,37,0],[856,38,856,42,0],[857,39,857,43,0],[857,44,857,48,0],[859,40,859,44,0],[859,45,859,49,0],[864,43,864,47,0],[864,48,864,52,0],[866,44,866,48,0],[866,49,866,53,0],[867,44,867,48,0],[867,49,867,53,0],[869,45,869,46,0],[869,47,869,92,0],[869,93,869,94,0]]);
    </script>
  </body>
</html>