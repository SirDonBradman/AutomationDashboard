<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Construction Vertical\Addon Modules\Contract Manager\Cost Revision\BL\CostRevisionValidationManager.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Linq;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core.BusinessLayer.BL;
using Aurigo.AMP3.Core.BusinessLayer.DTO;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.Brix.Construction.ContractManager.BusinessLayer;
using Aurigo.Brix.Construction.CoreModules.BusinessLayer.Interfaces;

namespace Aurigo.Brix.Construction.ContractManager.CostRevisionUI.BL
{
    public class CostRevisionValidationManager
    {
        private static volatile Dictionary&lt;string, CostRevisionValidationManager&gt; _Inst = null;
        private static readonly object _oSync = new object();
        private CostRevisionValidationManager() { }
        public static CostRevisionValidationManager Instance
        {
            get
            {
                lock (_oSync)
                {
                    if (_Inst == null) _Inst = new Dictionary&lt;string, CostRevisionValidationManager&gt;();
                    string currentCompany = ConnectionHelper.GetCurrentCompany();
                    if (!_Inst.ContainsKey(currentCompany))
                        _Inst.Add(currentCompany, new CostRevisionValidationManager());

                    return _Inst[currentCompany];
                }
            }
        }



        #region Context Dictionaries

        private static readonly Dictionary&lt;string, Type&gt; itemVerifiableClasses;
        private static readonly Dictionary&lt;string, Type&gt; subItemVerifiableClasses;
        private static readonly Dictionary&lt;string, Type&gt; activityVerifiableClasses;
        private static readonly Dictionary&lt;string, Type&gt; resourceVerifiableClasses;
        private static readonly Dictionary&lt;string, Type&gt; componentVerifiableClasses;
        private static readonly List&lt;string&gt; itemVerifiableContexts;
        private static readonly List&lt;string&gt; subItemVerifiableContexts;
        private static readonly List&lt;string&gt; activityVerifiableContexts;
        private static readonly List&lt;string&gt; resourceVerifiableContexts;
        private static readonly List&lt;string&gt; componentVerifiableContexts;

        #endregion

        static CostRevisionValidationManager()
        {
            #region Init Item Contexts

            if (itemVerifiableClasses == null)
            {
                itemVerifiableClasses = ModelHelper.GetModelObjects(typeof(IItemVerifiable));
            }
            if (itemVerifiableContexts == null)
            {
                itemVerifiableContexts = new List&lt;string&gt;();
                itemVerifiableContexts.Add(&quot;CONTMGT&quot;);
                itemVerifiableContexts.Add(&quot;ITMPOST&quot;);
                itemVerifiableContexts.Add(&quot;WORKORD&quot;);
                itemVerifiableContexts.Add(&quot;CONTMOH&quot;);
                itemVerifiableContexts.Add(&quot;PURCIND&quot;);
                itemVerifiableContexts.Add(&quot;FIXUTBD&quot;);
                itemVerifiableContexts.Add(&quot;LABMGMT&quot;);
                itemVerifiableContexts.Add(&quot;CONTRFI&quot;);
            }

            #endregion

            #region Init SubItem Contexts

            if (subItemVerifiableClasses == null)
            {
                subItemVerifiableClasses = ModelHelper.GetModelObjects(typeof(ISubItemVerifiable));
            }
            if (subItemVerifiableContexts == null)
            {
                subItemVerifiableContexts = new List&lt;string&gt;();
                subItemVerifiableContexts.Add(&quot;CONTMGT&quot;);
                subItemVerifiableContexts.Add(&quot;ITMPOST&quot;);
                subItemVerifiableContexts.Add(&quot;WORKORD&quot;);
                subItemVerifiableContexts.Add(&quot;PURCIND&quot;);
            }

            #endregion

            #region Init Activity Contexts

            if (activityVerifiableClasses == null)
            {
                activityVerifiableClasses = ModelHelper.GetModelObjects(typeof(IActivityVerifiable));
            }
            if (activityVerifiableContexts == null)
            {
                activityVerifiableContexts = new List&lt;string&gt;();
                activityVerifiableContexts.Add(&quot;ITMPOST&quot;);
                activityVerifiableContexts.Add(&quot;WORKORD&quot;);
            }

            #endregion

            #region Init Resource Contexts

            if (resourceVerifiableClasses == null)
            {
                resourceVerifiableClasses = ModelHelper.GetModelObjects(typeof(IResourceVerifiable));
            }
            if (resourceVerifiableContexts == null)
            {
                resourceVerifiableContexts = new List&lt;string&gt;();
                resourceVerifiableContexts.Add(&quot;ITMPOST&quot;);
                resourceVerifiableContexts.Add(&quot;FIXUTBD&quot;);
                resourceVerifiableContexts.Add(&quot;LABMGMT&quot;);
                resourceVerifiableContexts.Add(&quot;PURCIND&quot;);
            }

            #endregion

            #region Init Component Contexts

            if (componentVerifiableClasses == null)
            {
                componentVerifiableClasses = ModelHelper.GetModelObjects(typeof(IComponentVerifiable));
            }
            if (componentVerifiableContexts == null)
            {
                componentVerifiableContexts = new List&lt;string&gt;();
                componentVerifiableContexts.Add(&quot;SUBMTAL&quot;);
            }

            #endregion
        }

        internal string ValidateItemBeforeSave(Item itemDTO)
        {
            string retValidate = String.Empty;

            if (itemDTO == null || !itemDTO.ItemID.HasValue || !itemDTO.ModuleID.Equals(Constants.MODID_COSTVER) ||
                !itemDTO.ReferenceItemID.HasValue || !(itemDTO.ReferenceItemID.GetValueOrDefault(0) &gt; 0))
                return retValidate;

            #region Call Validations on all Subcontracting Activities under that Item

            DataSet itemActivities = ItemManager.Instance.GetItemActivities(itemDTO.ModuleID, itemDTO.ParentInstanceID,
                                                                            itemDTO.ItemID.GetValueOrDefault(0), &quot;N&quot;);
            if (itemActivities != null &amp;&amp; itemActivities.Tables.Count &gt; 0)
            {
                foreach (DataRow drActivity in itemActivities.Tables[0].Rows)
                {
                    int activityID = 0;
                    if (!String.IsNullOrEmpty(drActivity[&quot;AssociatedResourceID&quot;].ToString()) &amp;&amp;
                        Int32.TryParse(drActivity[&quot;ActivityID&quot;].ToString(), out activityID))
                    {
                        Activity activityDTO = ItemManager.Instance.GetActivity(itemDTO.ModuleID,
                                                                                itemDTO.ParentInstanceID,
                                                                                itemDTO.ItemID.GetValueOrDefault(0),
                                                                                activityID);
                        int resID = 0;
                        if (Int32.TryParse(drActivity[&quot;AssociatedResourceID&quot;].ToString(), out resID))
                        {
                            Resource resDTO = ItemManager.Instance.GetRateAnalysis(resID);
                            activityDTO.Quantity = resDTO.Quantity.GetValueOrDefault(0) * itemDTO.Quantity;

                            string ret = ValidateActivityBeforeSave(activityDTO);
                            if (!String.IsNullOrEmpty(ret))
                                retValidate += ret + &quot;|&quot;;
                        }
                    }
                }
            }

            if (!String.IsNullOrEmpty(retValidate))
                return retValidate;

            #endregion

            int contractID = 0;
            DataSet revisionDetails = CostRevisionManager.Instance.GetRevisionDetails(itemDTO.ParentInstanceID, 0);
            if (revisionDetails != null &amp;&amp; revisionDetails.Tables.Count &gt; 0 &amp;&amp; revisionDetails.Tables[0].Rows.Count &gt; 0)
                Int32.TryParse(revisionDetails.Tables[0].Rows[0][&quot;ContractID&quot;].ToString(), out contractID);

            Item refItemDTO = ItemManager.Instance.GetItemDetails(Constants.MODID_CONTMGT, contractID,
                                                                  itemDTO.ReferenceItemID.GetValueOrDefault(0));
            if (String.IsNullOrEmpty(refItemDTO.ModuleID) || !refItemDTO.ModuleID.Equals(Constants.MODID_CONTMGT) ||
                !(refItemDTO.ParentInstanceID == contractID))
                return retValidate;

            #region Validating Item against all IItemVerifiable Modules

            #region Fill up all proposed values for item here

            decimal origQty = refItemDTO.Quantity;
            refItemDTO.Quantity = itemDTO.Quantity;
            refItemDTO.DiffQuantity = itemDTO.DiffQuantity;

            #endregion

            foreach (string itemContext in itemVerifiableContexts)
            {
                if (itemVerifiableClasses.ContainsKey(itemContext) &amp;&amp; itemVerifiableClasses[itemContext] != null)
                {
                    var verifyItem = (IItemVerifiable)Activator.CreateInstance(itemVerifiableClasses[itemContext]);
                    if (verifyItem != null)
                    {
                        retValidate = verifyItem.ValidateItemBeforeSave(refItemDTO);
                        if (!String.IsNullOrEmpty(retValidate))
                            return retValidate;
                    }
                }
            }

            #region Restore all original values here

            refItemDTO.Quantity = origQty;

            #endregion

            #endregion

            return retValidate;
        }

        internal string ValidateItemBeforeDelete(Item itemDTO)
        {
            string retValidate = String.Empty;

            if (itemDTO == null || !itemDTO.ItemID.HasValue || !itemDTO.ModuleID.Equals(Constants.MODID_COSTVER) ||
                !itemDTO.ReferenceItemID.HasValue || !(itemDTO.ReferenceItemID.GetValueOrDefault(0) &gt; 0))
                return retValidate;

            #region Validating Item&#39;s Resources against all IResourceVerifiable Modules

            DataSet itemResources = ItemManager.Instance.GetRateAnalysis(itemDTO.ModuleID, itemDTO.ParentInstanceID,
                                                                         itemDTO.ItemID.GetValueOrDefault(0));

            if (itemResources != null &amp;&amp; itemResources.Tables.Count &gt; 1)
            {
                foreach (DataRow resRow in itemResources.Tables[1].Rows)
                {
                    var itemResource = new Resource();
                    ComponentHelper.CopyDataTableToDto(resRow, itemResources.Tables[1].Columns, itemResource);
                    string ret = ValidateResourceBeforeDelete(itemDTO, itemResource);
                    if (!String.IsNullOrEmpty(ret))
                        retValidate += ret + &quot;|&quot;;
                }
            }

            if (!String.IsNullOrEmpty(retValidate))
                return retValidate;

            #endregion

            int contractID = 0;
            DataSet revisionDetails = CostRevisionManager.Instance.GetRevisionDetails(itemDTO.ParentInstanceID, 0);
            if (revisionDetails != null &amp;&amp; revisionDetails.Tables.Count &gt; 0 &amp;&amp; revisionDetails.Tables[0].Rows.Count &gt; 0)
                Int32.TryParse(revisionDetails.Tables[0].Rows[0][&quot;ContractID&quot;].ToString(), out contractID);

            Item refItemDTO = ItemManager.Instance.GetItemDetails(Constants.MODID_CONTMGT, contractID,
                                                                  itemDTO.ReferenceItemID.GetValueOrDefault(0));
            if (String.IsNullOrEmpty(refItemDTO.ModuleID) || !refItemDTO.ModuleID.Equals(Constants.MODID_CONTMGT) ||
                !(refItemDTO.ParentInstanceID == contractID))
                return retValidate;

            #region Validating Item against all IItemVerifiable Modules

            foreach (string itemContext in itemVerifiableContexts)
            {
                if (itemVerifiableClasses.ContainsKey(itemContext) &amp;&amp; itemVerifiableClasses[itemContext] != null)
                {
                    var verifyItem = (IItemVerifiable)Activator.CreateInstance(itemVerifiableClasses[itemContext]);
                    if (verifyItem != null)
                    {
                        retValidate = verifyItem.ValidateItemBeforeDelete(refItemDTO);
                        if (!String.IsNullOrEmpty(retValidate))
                            return retValidate;
                    }
                }
            }

            #endregion

            return retValidate;
        }

        internal string ValidateSubItemBeforeSave(SubItem dtoSubItem)
        {
            string retValidate = String.Empty;

            if (dtoSubItem == null || !dtoSubItem.SubItemID.HasValue ||
                !dtoSubItem.ModuleID.Equals(Constants.MODID_COSTVER) || !dtoSubItem.ReferenceSubItemID.HasValue ||
                !(dtoSubItem.ReferenceSubItemID.GetValueOrDefault(0) &gt; 0))
                return retValidate;

            int contractID = 0;
            DataSet revisionDetails = CostRevisionManager.Instance.GetRevisionDetails(dtoSubItem.ParentInstanceID, 0);
            if (revisionDetails != null &amp;&amp; revisionDetails.Tables.Count &gt; 0 &amp;&amp; revisionDetails.Tables[0].Rows.Count &gt; 0)
                Int32.TryParse(revisionDetails.Tables[0].Rows[0][&quot;ContractID&quot;].ToString(), out contractID);

            SubItem refSubItemDTO = ItemManager.Instance.GetSubItem(Constants.MODID_CONTMGT, contractID,
                                                                    Convert.ToInt32(
                                                                        dtoSubItem.ReferenceSubItemID.GetValueOrDefault(
                                                                            0)));
            if (String.IsNullOrEmpty(refSubItemDTO.ModuleID) || !refSubItemDTO.ModuleID.Equals(Constants.MODID_CONTMGT) ||
                !(refSubItemDTO.ParentInstanceID == contractID))
                return retValidate;

            #region Validating Sub Item against all ISubItemVerifiable Modules

            #region Fill up all proposed values for sub item here

            decimal origQty = refSubItemDTO.Quantity;
            refSubItemDTO.Quantity = dtoSubItem.Quantity;

            #endregion

            foreach (string subItemContext in subItemVerifiableContexts)
            {
                if (subItemVerifiableClasses.ContainsKey(subItemContext) &amp;&amp;
                    subItemVerifiableClasses[subItemContext] != null)
                {
                    var verifySubItem =
                        (ISubItemVerifiable)Activator.CreateInstance(subItemVerifiableClasses[subItemContext]);
                    if (verifySubItem != null)
                    {
                        retValidate = verifySubItem.ValidateSubItemBeforeSave(refSubItemDTO);
                        if (!String.IsNullOrEmpty(retValidate))
                            return retValidate;
                    }
                }
            }

            #region Restore all original values here

            refSubItemDTO.Quantity = origQty;

            #endregion

            #endregion

            return retValidate;
        }

        internal string ValidateSubItemBeforeDelete(SubItem dtoSubItem)
        {
            string retValidate = String.Empty;

            if (dtoSubItem == null || !dtoSubItem.SubItemID.HasValue ||
                !dtoSubItem.ModuleID.Equals(Constants.MODID_COSTVER) || !dtoSubItem.ReferenceSubItemID.HasValue ||
                !(dtoSubItem.ReferenceSubItemID.GetValueOrDefault(0) &gt; 0))
                return retValidate;

            int contractID = 0;
            DataSet revisionDetails = CostRevisionManager.Instance.GetRevisionDetails(dtoSubItem.ParentInstanceID, 0);
            if (revisionDetails != null &amp;&amp; revisionDetails.Tables.Count &gt; 0 &amp;&amp; revisionDetails.Tables[0].Rows.Count &gt; 0)
                Int32.TryParse(revisionDetails.Tables[0].Rows[0][&quot;ContractID&quot;].ToString(), out contractID);

            SubItem refSubItemDTO = ItemManager.Instance.GetSubItem(Constants.MODID_CONTMGT, contractID,
                                                                    Convert.ToInt32(
                                                                        dtoSubItem.ReferenceSubItemID.GetValueOrDefault(
                                                                            0)));
            if (String.IsNullOrEmpty(refSubItemDTO.ModuleID) || !refSubItemDTO.ModuleID.Equals(Constants.MODID_CONTMGT) ||
                !(refSubItemDTO.ParentInstanceID == contractID))
                return retValidate;

            #region Validating Sub Item against all ISubItemVerifiable Modules

            foreach (string subItemContext in subItemVerifiableContexts)
            {
                if (subItemVerifiableClasses.ContainsKey(subItemContext) &amp;&amp;
                    subItemVerifiableClasses[subItemContext] != null)
                {
                    var verifySubItem =
                        (ISubItemVerifiable)Activator.CreateInstance(subItemVerifiableClasses[subItemContext]);
                    if (verifySubItem != null)
                    {
                        retValidate = verifySubItem.ValidateSubItemBeforeDelete(refSubItemDTO);
                        if (!String.IsNullOrEmpty(retValidate))
                            return retValidate;
                    }
                }
            }

            #endregion

            return retValidate;
        }

        internal string ValidateActivityBeforeSave(Activity dtoActivity)
        {
            string retValidate = String.Empty;

            if (dtoActivity == null || !dtoActivity.ActivityID.HasValue ||
                !dtoActivity.ModuleID.Equals(Constants.MODID_COSTVER) || !dtoActivity.ReferenceActivityID.HasValue ||
                !(dtoActivity.ReferenceActivityID.GetValueOrDefault(0) &gt; 0))
                return retValidate;

            int contractID = 0;
            DataSet revisionDetails =
                CostRevisionManager.Instance.GetRevisionDetails(
                    Convert.ToInt32(dtoActivity.ParentInstanceID.GetValueOrDefault(0)), 0);
            if (revisionDetails != null &amp;&amp; revisionDetails.Tables.Count &gt; 0 &amp;&amp; revisionDetails.Tables[0].Rows.Count &gt; 0)
                Int32.TryParse(revisionDetails.Tables[0].Rows[0][&quot;ContractID&quot;].ToString(), out contractID);

            Activity refActDTO = ItemManager.Instance.GetActivity(Constants.MODID_CONTMGT, contractID, null,
                                                                  dtoActivity.ReferenceActivityID.GetValueOrDefault(0));
            if (String.IsNullOrEmpty(refActDTO.ModuleID) || !refActDTO.ModuleID.Equals(Constants.MODID_CONTMGT) ||
                !(refActDTO.ParentInstanceID == contractID))
                return retValidate;

            #region Validating Activity against all IActivityVerifiable Modules

            #region Fill up all proposed values for Activity here

            decimal? origQty = refActDTO.Quantity;
            refActDTO.Quantity = dtoActivity.Quantity;

            #endregion

            foreach (string activityContext in activityVerifiableContexts)
            {
                if (activityVerifiableClasses.ContainsKey(activityContext) &amp;&amp;
                    activityVerifiableClasses[activityContext] != null)
                {
                    var verifyAct =
                        (IActivityVerifiable)Activator.CreateInstance(activityVerifiableClasses[activityContext]);
                    if (verifyAct != null)
                    {
                        retValidate = verifyAct.ValidateActivityBeforeSave(refActDTO);
                        if (!String.IsNullOrEmpty(retValidate))
                            return retValidate;
                    }
                }
            }

            #region Restore all original values here

            refActDTO.Quantity = origQty;

            #endregion

            #endregion

            return retValidate;
        }

        internal string ValidateActivityBeforeDelete(Activity dtoActivity)
        {
            string retValidate = String.Empty;

            if (dtoActivity == null || !dtoActivity.ActivityID.HasValue ||
                !dtoActivity.ModuleID.Equals(Constants.MODID_COSTVER) || !dtoActivity.ReferenceActivityID.HasValue ||
                !(dtoActivity.ReferenceActivityID.GetValueOrDefault(0) &gt; 0))
                return retValidate;

            int contractID = 0;
            DataSet revisionDetails =
                CostRevisionManager.Instance.GetRevisionDetails(
                    Convert.ToInt32(dtoActivity.ParentInstanceID.GetValueOrDefault(0)), 0);
            if (revisionDetails != null &amp;&amp; revisionDetails.Tables.Count &gt; 0 &amp;&amp; revisionDetails.Tables[0].Rows.Count &gt; 0)
                Int32.TryParse(revisionDetails.Tables[0].Rows[0][&quot;ContractID&quot;].ToString(), out contractID);

            Activity refActDTO = ItemManager.Instance.GetActivity(Constants.MODID_CONTMGT, contractID, null,
                                                                  dtoActivity.ReferenceActivityID.GetValueOrDefault(0));
            if (String.IsNullOrEmpty(refActDTO.ModuleID) || !refActDTO.ModuleID.Equals(Constants.MODID_CONTMGT) ||
                !(refActDTO.ParentInstanceID == contractID))
                return retValidate;

            #region Validating Activity against all IActivityVerifiable Modules

            foreach (string activityContext in activityVerifiableContexts)
            {
                if (activityVerifiableClasses.ContainsKey(activityContext) &amp;&amp;
                    activityVerifiableClasses[activityContext] != null)
                {
                    var verifyAct =
                        (IActivityVerifiable)Activator.CreateInstance(activityVerifiableClasses[activityContext]);
                    if (verifyAct != null)
                    {
                        retValidate = verifyAct.ValidateActivityBeforeDelete(refActDTO);
                        if (!String.IsNullOrEmpty(retValidate))
                            return retValidate;
                    }
                }
            }

            #endregion

            return retValidate;
        }

        internal string ValidateResourceBeforeSave(Item itemDTO, Resource dtoResource)
        {
            string retValidate = String.Empty;

            if (itemDTO == null || !itemDTO.ItemID.HasValue || !itemDTO.ModuleID.Equals(Constants.MODID_COSTVER) ||
                !itemDTO.ReferenceItemID.HasValue || !(itemDTO.ReferenceItemID.GetValueOrDefault(0) &gt; 0))
                return retValidate;

            if (dtoResource == null || !dtoResource.ModuleID.Equals(Constants.MODID_COSTVER))
                return retValidate;

            int contractID = 0;
            int costRevisionID = dtoResource.ParentInstanceID;
            DataSet revisionDetails = CostRevisionManager.Instance.GetRevisionDetails(dtoResource.ParentInstanceID, 0);
            if (revisionDetails != null &amp;&amp; revisionDetails.Tables.Count &gt; 0 &amp;&amp; revisionDetails.Tables[0].Rows.Count &gt; 0)
                Int32.TryParse(revisionDetails.Tables[0].Rows[0][&quot;ContractID&quot;].ToString(), out contractID);

            Item refItemDTO = ItemManager.Instance.GetItemDetails(Constants.MODID_CONTMGT, contractID,
                                                                  itemDTO.ReferenceItemID.GetValueOrDefault(0));
            if (String.IsNullOrEmpty(refItemDTO.ModuleID) || !refItemDTO.ModuleID.Equals(Constants.MODID_CONTMGT) ||
                !(refItemDTO.ParentInstanceID == contractID))
                return retValidate;

            #region If the resource is being added in Cost Revision, call the validations as though the resource were created already in Contract

            Resource refResDTO = null;
            if (dtoResource.ResourceDetailID.HasValue)
            {
                refResDTO =
                    CostRevisionManager.Instance.GetReferenceResource(dtoResource.ResourceDetailID.GetValueOrDefault(0));
                if (String.IsNullOrEmpty(refResDTO.ModuleID) || !refResDTO.ModuleID.Equals(Constants.MODID_CONTMGT) ||
                    !(refResDTO.ParentInstanceID == contractID))
                {
                    //return retValidate;
                    refResDTO = dtoResource;
                    refResDTO.ModuleID = Constants.MODID_CONTMGT;
                    refResDTO.ParentInstanceID = contractID;
                    refResDTO.ItemID = refItemDTO.ItemID.GetValueOrDefault(0);
                }
            }
            else
            {
                refResDTO = dtoResource;
                refResDTO.ModuleID = Constants.MODID_CONTMGT;
                refResDTO.ParentInstanceID = contractID;
                refResDTO.ItemID = refItemDTO.ItemID.GetValueOrDefault(0);
            }

            #endregion

            #region Validating Resource against all IResourceVerifiable Modules

            #region Fill up all proposed values for Item here

            decimal origItemQty = refItemDTO.Quantity;
            refItemDTO.Quantity = itemDTO.Quantity;

            #endregion

            #region Fill up all proposed values for Resource here

            decimal? origResQty = refResDTO.Quantity;
            refResDTO.Quantity = dtoResource.Quantity;
            refResDTO.WastagePercent = dtoResource.WastagePercent;
            refResDTO.DiffQuantity = dtoResource.DiffQuantity;

            #endregion

            foreach (string resourceContext in resourceVerifiableContexts)
            {
                if (resourceVerifiableClasses.ContainsKey(resourceContext) &amp;&amp;
                    resourceVerifiableClasses[resourceContext] != null)
                {
                    var verifyResource =
                        (IResourceVerifiable)Activator.CreateInstance(resourceVerifiableClasses[resourceContext]);
                    if (verifyResource != null)
                    {
                        retValidate = verifyResource.ValidateResourceBeforeSave(refItemDTO, refResDTO);
                        if (!String.IsNullOrEmpty(retValidate))
                        {
                            if (!refResDTO.ResourceDetailID.HasValue)
                            {
                                refResDTO.ModuleID = Constants.MODID_COSTVER;
                                refResDTO.ParentInstanceID = costRevisionID;
                                refResDTO.ItemID = itemDTO.ItemID.GetValueOrDefault(0);
                            }
                            return retValidate;
                        }
                    }
                }
            }

            #region Restore all original values for Resource here

            refResDTO.Quantity = origResQty;
            //if (!refResDTO.ResourceDetailID.HasValue)
            //{
            refResDTO.ModuleID = Constants.MODID_COSTVER;
            refResDTO.ParentInstanceID = costRevisionID;
            refResDTO.ItemID = itemDTO.ItemID.GetValueOrDefault(0);
            //}

            #endregion

            #region Restore all original values for Item here

            refItemDTO.Quantity = origItemQty;

            #endregion

            #endregion

            return retValidate;
        }

        internal string ValidateResourceBeforeDelete(Item itemDTO, Resource dtoResource, bool isContractResource)
        {
            string retValidate = String.Empty;
            int costRevisionID = dtoResource.ParentInstanceID;
            if (isContractResource)
            {
                if (itemDTO == null || !itemDTO.ItemID.HasValue || !itemDTO.ModuleID.Equals(Constants.MODID_CONTMGT))
                    return retValidate;
            }
            else
            {
                if (itemDTO == null || !itemDTO.ItemID.HasValue || !itemDTO.ModuleID.Equals(Constants.MODID_COSTVER) ||
                    !itemDTO.ReferenceItemID.HasValue || !(itemDTO.ReferenceItemID.GetValueOrDefault(0) &gt; 0))
                    return retValidate;
            }

            if (isContractResource)
            {
                if (dtoResource == null || !dtoResource.ResourceDetailID.HasValue ||
                    !dtoResource.ModuleID.Equals(Constants.MODID_CONTMGT))
                    return retValidate;
            }
            else
            {
                if (dtoResource == null || !dtoResource.ResourceDetailID.HasValue ||
                    !dtoResource.ModuleID.Equals(Constants.MODID_COSTVER))
                    return retValidate;
            }

            int contractID = 0;
            DataSet revisionDetails = CostRevisionManager.Instance.GetRevisionDetails(dtoResource.ParentInstanceID, 0);
            if (revisionDetails != null &amp;&amp; revisionDetails.Tables.Count &gt; 0 &amp;&amp; revisionDetails.Tables[0].Rows.Count &gt; 0)
                Int32.TryParse(revisionDetails.Tables[0].Rows[0][&quot;ContractID&quot;].ToString(), out contractID);

            Item refItemDTO = null;
            if (!isContractResource)
            {
                refItemDTO = ItemManager.Instance.GetItemDetails(Constants.MODID_CONTMGT, contractID,
                                                                 itemDTO.ReferenceItemID.GetValueOrDefault(0));
                if (String.IsNullOrEmpty(refItemDTO.ModuleID) || !refItemDTO.ModuleID.Equals(Constants.MODID_CONTMGT) ||
                    !(refItemDTO.ParentInstanceID == contractID))
                    return retValidate;
            }
            else
                refItemDTO = itemDTO;

            Resource refResDTO = null;
            if (!isContractResource)
            {
                refResDTO =
                    CostRevisionManager.Instance.GetReferenceResource(dtoResource.ResourceDetailID.GetValueOrDefault(0));
                if (String.IsNullOrEmpty(refResDTO.ModuleID) || !refResDTO.ModuleID.Equals(Constants.MODID_CONTMGT) ||
                    !(refResDTO.ParentInstanceID == contractID))
                {
                    //   return retValidate;
                    refResDTO = dtoResource;
                    refResDTO.ModuleID = Constants.MODID_CONTMGT;
                    refResDTO.ParentInstanceID = contractID;
                    refResDTO.ItemID = refItemDTO.ItemID.GetValueOrDefault(0);
                }
            }
            else
                refResDTO = dtoResource;

            #region Validating Resource against all IResourceVerifiable Modules

            foreach (string resourceContext in resourceVerifiableContexts)
            {
                if (resourceVerifiableClasses.ContainsKey(resourceContext) &amp;&amp;
                    resourceVerifiableClasses[resourceContext] != null)
                {
                    var verifyResource =
                        (IResourceVerifiable)Activator.CreateInstance(resourceVerifiableClasses[resourceContext]);
                    if (verifyResource != null)
                    {
                        retValidate = verifyResource.ValidateResourceBeforeDelete(refItemDTO, refResDTO);
                        if (!String.IsNullOrEmpty(retValidate))
                        {
                            refResDTO.ModuleID = Constants.MODID_COSTVER;
                            refResDTO.ParentInstanceID = costRevisionID;
                            refResDTO.ItemID = itemDTO.ItemID.GetValueOrDefault(0);
                            return retValidate;
                        }
                    }
                }
            }

            #endregion

            refResDTO.ModuleID = Constants.MODID_COSTVER;
            refResDTO.ParentInstanceID = costRevisionID;
            refResDTO.ItemID = itemDTO.ItemID.GetValueOrDefault(0);
            return retValidate;
        }

        internal string ValidateResourceBeforeDelete(Item itemDTO, Resource dtoResource)
        {
            return ValidateResourceBeforeDelete(itemDTO, dtoResource, false);
        }

        internal string ValidateComponentBeforeSave(Component dtoComponent)
        {
            string retValidate = String.Empty;

            if (dtoComponent == null || !dtoComponent.ComponentID.HasValue ||
                !dtoComponent.ModuleID.Equals(Constants.MODID_COSTVER))
                return retValidate;

            int contractID = 0;
            DataSet revisionDetails =
                CostRevisionManager.Instance.GetRevisionDetails(dtoComponent.ParentInstanceID.GetValueOrDefault(0), 0);
            if (revisionDetails != null &amp;&amp; revisionDetails.Tables.Count &gt; 0 &amp;&amp; revisionDetails.Tables[0].Rows.Count &gt; 0)
                Int32.TryParse(revisionDetails.Tables[0].Rows[0][&quot;ContractID&quot;].ToString(), out contractID);

            Component refComponentDTO =
                CostRevisionManager.Instance.GetReferenceComponent(dtoComponent.ComponentID.GetValueOrDefault(0));
            if (String.IsNullOrEmpty(refComponentDTO.ModuleID) ||
                !refComponentDTO.ModuleID.Equals(Constants.MODID_CONTMGT) ||
                !(refComponentDTO.ParentInstanceID == contractID))
                return retValidate;

            #region Validating Component against all IComponentVerifiable Modules

            foreach (string componentContext in componentVerifiableContexts)
            {
                if (componentVerifiableClasses.ContainsKey(componentContext) &amp;&amp;
                    componentVerifiableClasses[componentContext] != null)
                {
                    var verifyComponent =
                        (IComponentVerifiable)Activator.CreateInstance(componentVerifiableClasses[componentContext]);
                    if (verifyComponent != null)
                    {
                        retValidate = verifyComponent.ValidateComponentBeforeSave(refComponentDTO);
                        if (!String.IsNullOrEmpty(retValidate))
                            return retValidate;
                    }
                }
            }

            #endregion

            return retValidate;
        }

        internal string ValidateComponentBeforeDelete(Component dtoComponent, bool isContractComponent)
        {
            string retValidate = String.Empty;

            if (isContractComponent)
            {
                if (dtoComponent == null || !dtoComponent.ComponentID.HasValue ||
                    !dtoComponent.ModuleID.Equals(Constants.MODID_CONTMGT))
                    return retValidate;
            }
            else
            {
                if (dtoComponent == null || !dtoComponent.ComponentID.HasValue ||
                    !dtoComponent.ModuleID.Equals(Constants.MODID_COSTVER))
                    return retValidate;
            }

            int contractID = 0;
            DataSet revisionDetails =
                CostRevisionManager.Instance.GetRevisionDetails(dtoComponent.ParentInstanceID.GetValueOrDefault(0), 0);
            if (revisionDetails != null &amp;&amp; revisionDetails.Tables.Count &gt; 0 &amp;&amp; revisionDetails.Tables[0].Rows.Count &gt; 0)
                Int32.TryParse(revisionDetails.Tables[0].Rows[0][&quot;ContractID&quot;].ToString(), out contractID);

            Component refComponentDTO = null;
            if (!isContractComponent)
            {
                refComponentDTO =
                    CostRevisionManager.Instance.GetReferenceComponent(dtoComponent.ComponentID.GetValueOrDefault(0));
                if (String.IsNullOrEmpty(refComponentDTO.ModuleID) ||
                    !refComponentDTO.ModuleID.Equals(Constants.MODID_CONTMGT) ||
                    !(refComponentDTO.ParentInstanceID == contractID))
                    return retValidate;
            }
            else
                refComponentDTO = dtoComponent;

            #region Validating Component against all IComponentVerifiable Modules

            foreach (string componentContext in componentVerifiableContexts)
            {
                if (componentVerifiableClasses.ContainsKey(componentContext) &amp;&amp;
                    componentVerifiableClasses[componentContext] != null)
                {
                    var verifyComponent =
                        (IComponentVerifiable)Activator.CreateInstance(componentVerifiableClasses[componentContext]);
                    if (verifyComponent != null)
                    {
                        retValidate = verifyComponent.ValidateComponentBeforeDelete(refComponentDTO);
                        if (!String.IsNullOrEmpty(retValidate))
                            return retValidate;
                    }
                }
            }

            #endregion

            return retValidate;
        }

        internal string ValidateComponentBeforeDelete(Component dtoComponent)
        {
            return ValidateComponentBeforeDelete(dtoComponent, false);
        }

        internal bool ValidateActivitiesForGridEdit(Activity dtoActivity)
        {
            if (dtoActivity == null || !dtoActivity.ActivityID.HasValue ||
                !dtoActivity.ModuleID.Equals(Constants.MODID_COSTVER) || !dtoActivity.ReferenceActivityID.HasValue ||
                !(dtoActivity.ReferenceActivityID.GetValueOrDefault(0) &gt; 0))
                return true;

            int contractID = 0;
            DataSet revisionDetails =
                CostRevisionManager.Instance.GetRevisionDetails(
                    Convert.ToInt32(dtoActivity.ParentInstanceID.GetValueOrDefault(0)), 0);
            if (revisionDetails != null &amp;&amp; revisionDetails.Tables.Count &gt; 0 &amp;&amp; revisionDetails.Tables[0].Rows.Count &gt; 0)
                Int32.TryParse(revisionDetails.Tables[0].Rows[0][&quot;ContractID&quot;].ToString(), out contractID);

            Activity refActDTO = ItemManager.Instance.GetActivity(Constants.MODID_CONTMGT, contractID, null,
                                                                  dtoActivity.ReferenceActivityID.GetValueOrDefault(0));
            if (String.IsNullOrEmpty(refActDTO.ModuleID) || !refActDTO.ModuleID.Equals(Constants.MODID_CONTMGT) ||
                !(refActDTO.ParentInstanceID == contractID))
                return true;

            return false;
        }

        internal bool ValidateSubItemForGridEdit(SubItem dtoSubItem)
        {
            if (dtoSubItem == null || !dtoSubItem.SubItemID.HasValue ||
                !dtoSubItem.ModuleID.Equals(Constants.MODID_COSTVER) || !dtoSubItem.ReferenceSubItemID.HasValue ||
                !(dtoSubItem.ReferenceSubItemID.GetValueOrDefault(0) &gt; 0))
                return true;

            int contractID = 0;
            DataSet revisionDetails = CostRevisionManager.Instance.GetRevisionDetails(dtoSubItem.ParentInstanceID, 0);
            if (revisionDetails != null &amp;&amp; revisionDetails.Tables.Count &gt; 0 &amp;&amp; revisionDetails.Tables[0].Rows.Count &gt; 0)
                Int32.TryParse(revisionDetails.Tables[0].Rows[0][&quot;ContractID&quot;].ToString(), out contractID);

            SubItem refSubItemDTO = ItemManager.Instance.GetSubItem(Constants.MODID_CONTMGT, contractID,
                                                                    Convert.ToInt32(
                                                                        dtoSubItem.ReferenceSubItemID.GetValueOrDefault(
                                                                            0)));
            if (String.IsNullOrEmpty(refSubItemDTO.ModuleID) || !refSubItemDTO.ModuleID.Equals(Constants.MODID_CONTMGT) ||
                !(refSubItemDTO.ParentInstanceID == contractID))
                return true;

            return false;
        }

        internal bool ValidateRateAnalysisForGridEdit(Item itemDTO, Resource dtoResource)
        {
            if (itemDTO == null || !itemDTO.ItemID.HasValue || !itemDTO.ModuleID.Equals(Constants.MODID_COSTVER) ||
                !itemDTO.ReferenceItemID.HasValue || !(itemDTO.ReferenceItemID.GetValueOrDefault(0) &gt; 0))
                return true;

            if (dtoResource == null || !dtoResource.ResourceDetailID.HasValue ||
                !dtoResource.ModuleID.Equals(Constants.MODID_COSTVER))
                return true;

            int contractID = 0;
            DataSet revisionDetails = CostRevisionManager.Instance.GetRevisionDetails(dtoResource.ParentInstanceID, 0);
            if (revisionDetails != null &amp;&amp; revisionDetails.Tables.Count &gt; 0 &amp;&amp; revisionDetails.Tables[0].Rows.Count &gt; 0)
                Int32.TryParse(revisionDetails.Tables[0].Rows[0][&quot;ContractID&quot;].ToString(), out contractID);

            Item refItemDTO = ItemManager.Instance.GetItemDetails(Constants.MODID_CONTMGT, contractID,
                                                                  itemDTO.ReferenceItemID.GetValueOrDefault(0));
            if (String.IsNullOrEmpty(refItemDTO.ModuleID) || !refItemDTO.ModuleID.Equals(Constants.MODID_CONTMGT) ||
                !(refItemDTO.ParentInstanceID == contractID))
                return true;

            Resource refResDTO =
                CostRevisionManager.Instance.GetReferenceResource(dtoResource.ResourceDetailID.GetValueOrDefault(0));
            if (String.IsNullOrEmpty(refResDTO.ModuleID) || !refResDTO.ModuleID.Equals(Constants.MODID_CONTMGT) ||
                !(refResDTO.ParentInstanceID == contractID))
                return true;

            return false;
        }

        internal DataSet ValidateCostRevisionBeforeApproval(int costRevisionID)
        {
            int contractID = 0;
            DataSet revisionDetails = CostRevisionManager.Instance.GetRevisionDetails(costRevisionID, 0);
            if (revisionDetails != null &amp;&amp; revisionDetails.Tables.Count &gt; 0 &amp;&amp; revisionDetails.Tables[0].Rows.Count &gt; 0)
                Int32.TryParse(revisionDetails.Tables[0].Rows[0][&quot;ContractID&quot;].ToString(), out contractID);

            DataSet dsValidate = CostRevisionManager.Instance.GetApprovalChanges(costRevisionID);

            #region Hidden Columns in the Dataset for Display

            var commonHiddenCols = new[]
                                       {
                                           &quot;ModuleID&quot;, &quot;ParentInstanceID&quot;, &quot;ItemID&quot;,
                                           &quot;AlternateID&quot;, &quot;UnitID&quot;, &quot;ReferenceItemID&quot;,
                                           &quot;ReferenceItemType&quot;, &quot;ContainerID&quot;, &quot;GroupID&quot;,
                                           &quot;ResourceDetailID&quot;, &quot;ResourceTypeID&quot;, &quot;UnitID&quot;,
                                           &quot;ComponentID&quot;, &quot;SubItemID&quot;, &quot;GroupID&quot;, &quot;ReferenceSubItemID&quot;,
                                           &quot;UnitIDDim1&quot;, &quot;UnitIDDim2&quot;, &quot;UnitIDDim3&quot;,
                                           &quot;ActivityID&quot;, &quot;UnitID&quot;, &quot;UnitIDDim1&quot;,
                                           &quot;UnitIDDim2&quot;, &quot;UnitIDDim3&quot;, &quot;ReferenceActivityID&quot;,
                                           &quot;AssociatedResourceID&quot;
                                       };

            #endregion

            #region Naming of tables

            DataTable dtItemsDeleted = dsValidate.Tables[0];
            DataTable dtItemsUpdated = dsValidate.Tables[1];
            DataTable dtResourcesDeleted = dsValidate.Tables[2];
            DataTable dtResourcesUpdated = dsValidate.Tables[3];
            DataTable dtComponentsDeleted = dsValidate.Tables[4];
            DataTable dtComponentsUpdated = dsValidate.Tables[5];
            DataTable dtSubItemsDeleted = dsValidate.Tables[6];
            DataTable dtSubItemsUpdated = dsValidate.Tables[7];
            DataTable dtActivitiesDeleted = dsValidate.Tables[8];
            DataTable dtActivitiesUpdated = dsValidate.Tables[9];
            DataTable dtItemsCreated = dsValidate.Tables[10];

            #endregion

            #region Adding Error Message column to all tables

            foreach (DataTable dtTemp in dsValidate.Tables)
            {
                if (!dtTemp.Columns.Contains(&quot;Error Message&quot;))
                    dtTemp.Columns.Add(&quot;Error Message&quot;, Type.GetType(&quot;System.String&quot;));
            }

            #endregion

            #region Validating the Deleted Items

            foreach (DataRow drItemDel in dtItemsDeleted.Rows)
            {
                var itemValidate = new Item();
                ComponentHelper.CopyDataTableToDto(drItemDel, dtItemsDeleted.Columns, itemValidate);
                itemValidate.DiffQuantity = 0;
                string retValidate = ValidateItemBeforeDelete(itemValidate);
                if (!String.IsNullOrEmpty(retValidate))
                    drItemDel[&quot;Error Message&quot;] = retValidate;
            }

            #endregion

            #region Validating the Modified Items

            foreach (DataRow drItemUpdated in dtItemsUpdated.Rows)
            {
                var itemValidate = new Item();
                ComponentHelper.CopyDataTableToDto(drItemUpdated, dtItemsUpdated.Columns, itemValidate);

                //if (itemValidate.Quantity == 0)
                //{
                //    drItemUpdated[&quot;Error Message&quot;] = &quot;Execution Quantity of Item \&#39;&quot; + itemValidate.StandardItemNo + &quot;\&#39; cannot be Zero. Request Denied.&quot;;
                //    continue;
                //}

                itemValidate.DiffQuantity = 0;
                string retValidate = ValidateItemBeforeSave(itemValidate);
                if (!String.IsNullOrEmpty(retValidate))
                    drItemUpdated[&quot;Error Message&quot;] = retValidate;
            }

            #endregion

            #region Validating the Deleted Resources

            foreach (DataRow drResDel in dtResourcesDeleted.Rows)
            {
                var resValidate = new Resource();
                ComponentHelper.CopyDataTableToDto(drResDel, dtResourcesDeleted.Columns, resValidate);
                resValidate.DiffQuantity = 0;

                Item itemDTO = ItemManager.Instance.GetItemDetails(Constants.MODID_CONTMGT, contractID,
                                                                   resValidate.ItemID);
                itemDTO.DiffQuantity = 0;
                if (String.IsNullOrEmpty(itemDTO.ModuleID) || !itemDTO.ModuleID.Equals(Constants.MODID_CONTMGT) ||
                    !(itemDTO.ParentInstanceID == contractID))
                {
                    drResDel[&quot;Error Message&quot;] = &quot;Resource to be validated not in Contract Module.&quot;;
                    continue;
                }

                string retValidate = ValidateResourceBeforeDelete(itemDTO, resValidate, true);
                if (!String.IsNullOrEmpty(retValidate))
                    drResDel[&quot;Error Message&quot;] = retValidate;
            }

            #endregion

            #region Validating the Modified Resources

            foreach (DataRow drResUpdated in dtResourcesUpdated.Rows)
            {
                var resValidate = new Resource();
                ComponentHelper.CopyDataTableToDto(drResUpdated, dtResourcesUpdated.Columns, resValidate);
                resValidate.DiffQuantity = 0;

                Item itemDTO = ItemManager.Instance.GetItemDetails(Constants.MODID_COSTVER, costRevisionID,
                                                                   resValidate.ItemID);
                itemDTO.DiffQuantity = 0;
                if (String.IsNullOrEmpty(itemDTO.ModuleID) || !itemDTO.ModuleID.Equals(Constants.MODID_COSTVER) ||
                    !(itemDTO.ParentInstanceID == costRevisionID))
                {
                    drResUpdated[&quot;Error Message&quot;] = &quot;Resource to be validated not in Cost Planning Module.&quot;;
                    continue;
                }

                string retValidate = ValidateResourceBeforeSave(itemDTO, resValidate);
                if (!String.IsNullOrEmpty(retValidate))
                    drResUpdated[&quot;Error Message&quot;] = retValidate;
            }

            #endregion

            #region Validating the Deleted Components

            foreach (DataRow drComponentDel in dtComponentsDeleted.Rows)
            {
                var componentValidate = new Component();
                ComponentHelper.CopyDataTableToDto(drComponentDel, dtComponentsDeleted.Columns, componentValidate);

                string retValidate = ValidateComponentBeforeDelete(componentValidate, true);
                if (!String.IsNullOrEmpty(retValidate))
                    drComponentDel[&quot;Error Message&quot;] = retValidate;
            }

            #endregion

            #region Validating the Updated Components

            foreach (DataRow drComponentUpdated in dtComponentsUpdated.Rows)
            {
                var componentValidate = new Component();
                ComponentHelper.CopyDataTableToDto(drComponentUpdated, dtComponentsUpdated.Columns, componentValidate);

                string retValidate = ValidateComponentBeforeSave(componentValidate);
                if (!String.IsNullOrEmpty(retValidate))
                    drComponentUpdated[&quot;Error Message&quot;] = retValidate;
            }

            #endregion

            #region Validating the Deleted SubItems

            foreach (DataRow drSubItemDel in dtSubItemsDeleted.Rows)
            {
                var subItemValidate = new SubItem();
                ComponentHelper.CopyDataTableToDto(drSubItemDel, dtSubItemsDeleted.Columns, subItemValidate);
                string retValidate = ValidateSubItemBeforeDelete(subItemValidate);
                if (!String.IsNullOrEmpty(retValidate))
                    drSubItemDel[&quot;Error Message&quot;] = retValidate;
            }

            #endregion

            #region Validating the Updated SubItems

            foreach (DataRow drSubItemUpdated in dtSubItemsUpdated.Rows)
            {
                var subItemValidate = new SubItem();
                ComponentHelper.CopyDataTableToDto(drSubItemUpdated, dtSubItemsUpdated.Columns, subItemValidate);
                string retValidate = ValidateSubItemBeforeSave(subItemValidate);
                if (!String.IsNullOrEmpty(retValidate))
                    drSubItemUpdated[&quot;Error Message&quot;] = retValidate;
            }

            #endregion

            #region Validating the Deleted Activities

            foreach (DataRow drActivityDel in dtActivitiesDeleted.Rows)
            {
                var activityValidate = new Activity();
                ComponentHelper.CopyDataTableToDto(drActivityDel, dtActivitiesDeleted.Columns, activityValidate);
                string retValidate = ValidateActivityBeforeDelete(activityValidate);
                if (!String.IsNullOrEmpty(retValidate))
                    drActivityDel[&quot;Error Message&quot;] = retValidate;
            }

            #endregion

            #region Validating the Updated Activities

            foreach (DataRow drActivityUpdated in dtActivitiesUpdated.Rows)
            {
                var activityValidate = new Activity();
                ComponentHelper.CopyDataTableToDto(drActivityUpdated, dtActivitiesUpdated.Columns, activityValidate);
                string retValidate = ValidateActivityBeforeSave(activityValidate);
                if (!String.IsNullOrEmpty(retValidate))
                    drActivityUpdated[&quot;Error Message&quot;] = retValidate;
            }

            #endregion

            #region Validating the Created Items for Zero Quantity

            //foreach (DataRow drItemCreated in dtItemsCreated.Rows)
            //{
            //    Item itemValidate = new Item();
            //    ComponentHelper.CopyDataTableToDto&lt;Item&gt;(drItemCreated, dtItemsCreated.Columns, itemValidate);
            //    if (itemValidate.Quantity == 0)
            //        drItemCreated[&quot;Error Message&quot;] = &quot;Execution Quantity of Item \&#39;&quot; + itemValidate.StandardItemNo + &quot;\&#39; cannot be Zero. Request Denied.&quot;;
            //}

            #endregion

            #region Removing Hidden Columns from all the Tables

            List&lt;DataColumn&gt; removeCols;
            foreach (DataTable dtTemp in dsValidate.Tables)
            {
                removeCols = new List&lt;DataColumn&gt;();

                foreach (DataColumn currCol in dtTemp.Columns)
                    if (commonHiddenCols.Contains(currCol.ColumnName))
                        removeCols.Add(currCol);

                foreach (DataColumn rem in removeCols)
                    dtTemp.Columns.Remove(rem);
            }

            #endregion

            return dsValidate;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[16,9,16,96,0],[17,9,17,62,0],[18,9,18,48,0],[18,49,18,50,0],[18,51,18,52,0],[22,13,22,14,0],[23,17,23,30,0],[24,17,24,18,0],[25,21,25,39,0],[25,40,25,104,0],[26,21,26,82,0],[27,21,27,60,0],[28,25,28,88,0],[30,21,30,50,0],[32,13,32,14,0],[53,9,53,10,0],[56,13,56,47,0],[57,13,57,14,0],[58,17,58,94,0],[59,13,59,14,0],[60,13,60,48,0],[61,13,61,14,0],[62,17,62,61,0],[63,17,63,55,0],[64,17,64,55,0],[65,17,65,55,0],[66,17,66,55,0],[67,17,67,55,0],[68,17,68,55,0],[69,17,69,55,0],[70,17,70,55,0],[71,13,71,14,0],[77,13,77,50,0],[78,13,78,14,0],[79,17,79,100,0],[80,13,80,14,0],[81,13,81,51,0],[82,13,82,14,0],[83,17,83,64,0],[84,17,84,58,0],[85,17,85,58,0],[86,17,86,58,0],[87,17,87,58,0],[88,13,88,14,0],[94,13,94,51,0],[95,13,95,14,0],[96,17,96,102,0],[97,13,97,14,0],[98,13,98,52,0],[99,13,99,14,0],[100,17,100,65,0],[101,17,101,59,0],[102,17,102,59,0],[103,13,103,14,0],[109,13,109,51,0],[110,13,110,14,0],[111,17,111,102,0],[112,13,112,14,0],[113,13,113,52,0],[114,13,114,14,0],[115,17,115,65,0],[116,17,116,59,0],[117,17,117,59,0],[118,17,118,59,0],[119,17,119,59,0],[120,13,120,14,0],[126,13,126,52,0],[127,13,127,14,0],[128,17,128,104,0],[129,13,129,14,0],[130,13,130,53,0],[131,13,131,14,0],[132,17,132,66,0],[133,17,133,60,0],[134,13,134,14,0],[137,9,137,10,0],[140,9,140,10,0],[141,13,141,47,0],[143,13,144,106,0],[145,17,145,36,0],[149,13,150,119,0],[151,13,151,75,0],[152,13,152,14,0],[153,17,153,24,0],[153,26,153,44,0],[153,45,153,47,0],[153,48,153,77,0],[154,17,154,18,0],[155,21,155,40,0],[156,21,157,93,0],[158,21,158,22,0],[159,25,162,93,0],[163,25,163,39,0],[164,25,164,102,0],[165,25,165,26,0],[166,29,166,91,0],[167,29,167,108,0],[169,29,169,82,0],[170,29,170,60,0],[171,33,171,58,0],[172,25,172,26,0],[173,21,173,22,0],[174,17,174,18,0],[175,13,175,14,0],[177,13,177,52,0],[178,17,178,36,0],[182,13,182,32,0],[183,13,183,116,0],[184,13,184,121,0],[185,17,185,108,0],[187,13,188,113,0],[189,13,190,62,0],[191,17,191,36,0],[197,13,197,51,0],[198,13,198,52,0],[199,13,199,60,0],[203,13,203,20,0],[203,22,203,40,0],[203,41,203,43,0],[203,44,203,66,0],[204,13,204,14,0],[205,17,205,114,0],[206,17,206,18,0],[207,21,207,116,0],[208,21,208,44,0],[209,21,209,22,0],[210,25,210,85,0],[211,25,211,64,0],[212,29,212,48,0],[213,21,213,22,0],[214,17,214,18,0],[215,13,215,14,0],[219,13,219,43,0],[225,13,225,32,0],[226,9,226,10,0],[229,9,229,10,0],[230,13,230,47,0],[232,13,233,106,0],[234,17,234,36,0],[238,13,239,111,0],[241,13,241,73,0],[242,13,242,14,0],[243,17,243,24,0],[243,26,243,40,0],[243,41,243,43,0],[243,44,243,72,0],[244,17,244,18,0],[245,21,245,55,0],[246,21,246,111,0],[247,21,247,86,0],[248,21,248,52,0],[249,25,249,50,0],[250,17,250,18,0],[251,13,251,14,0],[253,13,253,52,0],[254,17,254,36,0],[258,13,258,32,0],[259,13,259,116,0],[260,13,260,121,0],[261,17,261,108,0],[263,13,264,113,0],[265,13,266,62,0],[267,17,267,36,0],[271,13,271,20,0],[271,22,271,40,0],[271,41,271,43,0],[271,44,271,66,0],[272,13,272,14,0],[273,17,273,114,0],[274,17,274,18,0],[275,21,275,116,0],[276,21,276,44,0],[277,21,277,22,0],[278,25,278,87,0],[279,25,279,64,0],[280,29,280,48,0],[281,21,281,22,0],[282,17,282,18,0],[283,13,283,14,0],[287,13,287,32,0],[288,9,288,10,0],[291,9,291,10,0],[292,13,292,47,0],[294,13,296,75,0],[297,17,297,36,0],[299,13,299,32,0],[300,13,300,119,0],[301,13,301,121,0],[302,17,302,108,0],[304,13,307,82,0],[308,13,309,65,0],[310,17,310,36,0],[316,13,316,54,0],[317,13,317,58,0],[321,13,321,20,0],[321,22,321,43,0],[321,44,321,46,0],[321,47,321,72,0],[322,13,322,14,0],[323,17,324,70,0],[325,17,325,18,0],[326,21,327,112,0],[328,21,328,47,0],[329,21,329,22,0],[330,25,330,94,0],[331,25,331,64,0],[332,29,332,48,0],[333,21,333,22,0],[334,17,334,18,0],[335,13,335,14,0],[339,13,339,46,0],[345,13,345,32,0],[346,9,346,10,0],[349,9,349,10,0],[350,13,350,47,0],[352,13,354,75,0],[355,17,355,36,0],[357,13,357,32,0],[358,13,358,119,0],[359,13,359,121,0],[360,17,360,108,0],[362,13,365,82,0],[366,13,367,65,0],[368,17,368,36,0],[372,13,372,20,0],[372,22,372,43,0],[372,44,372,46,0],[372,47,372,72,0],[373,13,373,14,0],[374,17,375,70,0],[376,17,376,18,0],[377,21,378,112,0],[379,21,379,47,0],[380,21,380,22,0],[381,25,381,96,0],[382,25,382,64,0],[383,29,383,48,0],[384,21,384,22,0],[385,17,385,18,0],[386,13,386,14,0],[390,13,390,32,0],[391,9,391,10,0],[394,9,394,10,0],[395,13,395,47,0],[397,13,399,77,0],[400,17,400,36,0],[402,13,402,32,0],[403,13,405,92,0],[406,13,406,121,0],[407,17,407,108,0],[409,13,410,121,0],[411,13,412,61,0],[413,17,413,36,0],[419,13,419,51,0],[420,13,420,55,0],[424,13,424,20,0],[424,22,424,44,0],[424,45,424,47,0],[424,48,424,74,0],[425,13,425,14,0],[426,17,427,72,0],[428,17,428,18,0],[429,21,430,115,0],[431,21,431,43,0],[432,21,432,22,0],[433,25,433,87,0],[434,25,434,64,0],[435,29,435,48,0],[436,21,436,22,0],[437,17,437,18,0],[438,13,438,14,0],[442,13,442,42,0],[448,13,448,32,0],[449,9,449,10,0],[452,9,452,10,0],[453,13,453,47,0],[455,13,457,77,0],[458,17,458,36,0],[460,13,460,32,0],[461,13,463,92,0],[464,13,464,121,0],[465,17,465,108,0],[467,13,468,121,0],[469,13,470,61,0],[471,17,471,36,0],[475,13,475,20,0],[475,22,475,44,0],[475,45,475,47,0],[475,48,475,74,0],[476,13,476,14,0],[477,17,478,72,0],[479,17,479,18,0],[480,21,481,115,0],[482,21,482,43,0],[483,21,483,22,0],[484,25,484,89,0],[485,25,485,64,0],[486,29,486,48,0],[487,21,487,22,0],[488,17,488,18,0],[489,13,489,14,0],[493,13,493,32,0],[494,9,494,10,0],[497,9,497,10,0],[498,13,498,47,0],[500,13,501,106,0],[502,17,502,36,0],[504,13,504,94,0],[505,17,505,36,0],[507,13,507,32,0],[508,13,508,63,0],[509,13,509,120,0],[510,13,510,121,0],[511,17,511,108,0],[513,13,514,113,0],[515,13,516,62,0],[517,17,517,36,0],[521,13,521,39,0],[522,13,522,55,0],[523,13,523,14,0],[524,17,525,122,0],[526,17,527,65,0],[528,17,528,18,0],[530,21,530,45,0],[531,21,531,66,0],[532,21,532,61,0],[533,21,533,79,0],[534,17,534,18,0],[535,13,535,14,0],[537,13,537,14,0],[538,17,538,41,0],[539,17,539,62,0],[540,17,540,57,0],[541,17,541,75,0],[542,13,542,14,0],[550,13,550,55,0],[551,13,551,52,0],[557,13,557,54,0],[558,13,558,55,0],[559,13,559,67,0],[560,13,560,63,0],[564,13,564,20,0],[564,22,564,44,0],[564,45,564,47,0],[564,48,564,74,0],[565,13,565,14,0],[566,17,567,72,0],[568,17,568,18,0],[569,21,570,115,0],[571,21,571,48,0],[572,21,572,22,0],[573,25,573,104,0],[574,25,574,64,0],[575,25,575,26,0],[576,29,576,70,0],[577,29,577,30,0],[578,33,578,78,0],[579,33,579,77,0],[580,33,580,88,0],[581,29,581,30,0],[582,29,582,48,0],[584,21,584,22,0],[585,17,585,18,0],[586,13,586,14,0],[590,13,590,45,0],[593,13,593,58,0],[594,13,594,57,0],[595,13,595,68,0],[602,13,602,47,0],[608,13,608,32,0],[609,9,609,10,0],[612,9,612,10,0],[613,13,613,47,0],[614,13,614,63,0],[615,13,615,36,0],[616,13,616,14,0],[617,17,617,118,0],[618,21,618,40,0],[619,13,619,14,0],[621,13,621,14,0],[622,17,623,110,0],[624,21,624,40,0],[625,13,625,14,0],[627,13,627,36,0],[628,13,628,14,0],[629,17,630,75,0],[631,21,631,40,0],[632,13,632,14,0],[634,13,634,14,0],[635,17,636,75,0],[637,21,637,40,0],[638,13,638,14,0],[640,13,640,32,0],[641,13,641,120,0],[642,13,642,121,0],[643,17,643,108,0],[645,13,645,36,0],[646,13,646,37,0],[647,13,647,14,0],[648,17,649,112,0],[650,17,651,66,0],[652,21,652,40,0],[653,13,653,14,0],[655,17,655,38,0],[657,13,657,39,0],[658,13,658,37,0],[659,13,659,14,0],[660,17,661,122,0],[662,17,663,65,0],[664,17,664,18,0],[666,21,666,45,0],[667,21,667,66,0],[668,21,668,61,0],[669,21,669,79,0],[670,17,670,18,0],[671,13,671,14,0],[673,17,673,41,0],[677,13,677,20,0],[677,22,677,44,0],[677,45,677,47,0],[677,48,677,74,0],[678,13,678,14,0],[679,17,680,72,0],[681,17,681,18,0],[682,21,683,115,0],[684,21,684,48,0],[685,21,685,22,0],[686,25,686,106,0],[687,25,687,64,0],[688,25,688,26,0],[689,29,689,74,0],[690,29,690,73,0],[691,29,691,84,0],[692,29,692,48,0],[694,21,694,22,0],[695,17,695,18,0],[696,13,696,14,0],[700,13,700,58,0],[701,13,701,57,0],[702,13,702,68,0],[703,13,703,32,0],[704,9,704,10,0],[707,9,707,10,0],[708,13,708,78,0],[709,9,709,10,0],[712,9,712,10,0],[713,13,713,47,0],[715,13,716,72,0],[717,17,717,36,0],[719,13,719,32,0],[720,13,721,120,0],[722,13,722,121,0],[723,17,723,108,0],[725,13,726,115,0],[727,13,729,67,0],[730,17,730,36,0],[734,13,734,20,0],[734,22,734,45,0],[734,46,734,48,0],[734,49,734,76,0],[735,13,735,14,0],[736,17,737,74,0],[738,17,738,18,0],[739,21,740,118,0],[741,21,741,49,0],[742,21,742,22,0],[743,25,743,100,0],[744,25,744,64,0],[745,29,745,48,0],[746,21,746,22,0],[747,17,747,18,0],[748,13,748,14,0],[752,13,752,32,0],[753,9,753,10,0],[756,9,756,10,0],[757,13,757,47,0],[759,13,759,37,0],[760,13,760,14,0],[761,17,762,76,0],[763,21,763,40,0],[764,13,764,14,0],[766,13,766,14,0],[767,17,768,76,0],[769,21,769,40,0],[770,13,770,14,0],[772,13,772,32,0],[773,13,774,120,0],[775,13,775,121,0],[776,17,776,108,0],[778,13,778,46,0],[779,13,779,38,0],[780,13,780,14,0],[781,17,782,119,0],[783,17,785,71,0],[786,21,786,40,0],[787,13,787,14,0],[789,17,789,48,0],[793,13,793,20,0],[793,22,793,45,0],[793,46,793,48,0],[793,49,793,76,0],[794,13,794,14,0],[795,17,796,74,0],[797,17,797,18,0],[798,21,799,118,0],[800,21,800,49,0],[801,21,801,22,0],[802,25,802,102,0],[803,25,803,64,0],[804,29,804,48,0],[805,21,805,22,0],[806,17,806,18,0],[807,13,807,14,0],[811,13,811,32,0],[812,9,812,10,0],[815,9,815,10,0],[816,13,816,71,0],[817,9,817,10,0],[820,9,820,10,0],[821,13,823,77,0],[824,17,824,29,0],[826,13,826,32,0],[827,13,829,92,0],[830,13,830,121,0],[831,17,831,108,0],[833,13,834,121,0],[835,13,836,61,0],[837,17,837,29,0],[839,13,839,26,0],[840,9,840,10,0],[843,9,843,10,0],[844,13,846,75,0],[847,17,847,29,0],[849,13,849,32,0],[850,13,850,119,0],[851,13,851,121,0],[852,17,852,108,0],[854,13,857,82,0],[858,13,859,65,0],[860,17,860,29,0],[862,13,862,26,0],[863,9,863,10,0],[866,9,866,10,0],[867,13,868,106,0],[869,17,869,29,0],[871,13,872,71,0],[873,17,873,29,0],[875,13,875,32,0],[876,13,876,120,0],[877,13,877,121,0],[878,17,878,108,0],[880,13,881,113,0],[882,13,883,62,0],[884,17,884,29,0],[886,13,887,118,0],[888,13,889,61,0],[890,17,890,29,0],[892,13,892,26,0],[893,9,893,10,0],[896,9,896,10,0],[897,13,897,32,0],[898,13,898,106,0],[899,13,899,121,0],[900,17,900,108,0],[902,13,902,98,0],[906,13,917,42,0],[923,13,923,61,0],[924,13,924,61,0],[925,13,925,65,0],[926,13,926,65,0],[927,13,927,66,0],[928,13,928,66,0],[929,13,929,64,0],[930,13,930,64,0],[931,13,931,66,0],[932,13,932,66,0],[933,13,933,62,0],[939,13,939,20,0],[939,22,939,38,0],[939,39,939,41,0],[939,42,939,59,0],[940,13,940,14,0],[941,17,941,63,0],[942,21,942,88,0],[943,13,943,14,0],[949,13,949,20,0],[949,22,949,39,0],[949,40,949,42,0],[949,43,949,62,0],[950,13,950,14,0],[951,17,951,47,0],[952,17,952,101,0],[953,17,953,47,0],[954,17,954,77,0],[955,17,955,56,0],[956,21,956,62,0],[957,13,957,14,0],[963,13,963,20,0],[963,22,963,43,0],[963,44,963,46,0],[963,47,963,66,0],[964,13,964,14,0],[965,17,965,47,0],[966,17,966,105,0],[974,17,974,47,0],[975,17,975,75,0],[976,17,976,56,0],[977,21,977,66,0],[978,13,978,14,0],[984,13,984,20,0],[984,22,984,38,0],[984,39,984,41,0],[984,42,984,65,0],[985,13,985,14,0],[986,17,986,50,0],[987,17,987,103,0],[988,17,988,46,0],[990,17,991,88,0],[992,17,992,42,0],[993,17,994,63,0],[995,17,995,18,0],[996,21,996,100,0],[997,21,997,30,0],[1000,17,1000,95,0],[1001,17,1001,56,0],[1002,21,1002,61,0],[1003,13,1003,14,0],[1009,13,1009,20,0],[1009,22,1009,42,0],[1009,43,1009,45,0],[1009,46,1009,69,0],[1010,13,1010,14,0],[1011,17,1011,50,0],[1012,17,1012,107,0],[1013,17,1013,46,0],[1015,17,1016,88,0],[1017,17,1017,42,0],[1018,17,1019,67,0],[1020,17,1020,18,0],[1021,21,1021,109,0],[1022,21,1022,30,0],[1025,17,1025,87,0],[1026,17,1026,56,0],[1027,21,1027,65,0],[1028,13,1028,14,0],[1034,13,1034,20,0],[1034,22,1034,44,0],[1034,45,1034,47,0],[1034,48,1034,72,0],[1035,13,1035,14,0],[1036,17,1036,57,0],[1037,17,1037,116,0],[1039,17,1039,93,0],[1040,17,1040,56,0],[1041,21,1041,67,0],[1042,13,1042,14,0],[1048,13,1048,20,0],[1048,22,1048,48,0],[1048,49,1048,51,0],[1048,52,1048,76,0],[1049,13,1049,14,0],[1050,17,1050,57,0],[1051,17,1051,120,0],[1053,17,1053,85,0],[1054,17,1054,56,0],[1055,21,1055,71,0],[1056,13,1056,14,0],[1062,13,1062,20,0],[1062,22,1062,42,0],[1062,43,1062,45,0],[1062,46,1062,68,0],[1063,13,1063,14,0],[1064,17,1064,53,0],[1065,17,1065,110,0],[1066,17,1066,83,0],[1067,17,1067,56,0],[1068,21,1068,65,0],[1069,13,1069,14,0],[1075,13,1075,20,0],[1075,22,1075,46,0],[1075,47,1075,49,0],[1075,50,1075,72,0],[1076,13,1076,14,0],[1077,17,1077,53,0],[1078,17,1078,114,0],[1079,17,1079,81,0],[1080,17,1080,56,0],[1081,21,1081,69,0],[1082,13,1082,14,0],[1088,13,1088,20,0],[1088,22,1088,43,0],[1088,44,1088,46,0],[1088,47,1088,71,0],[1089,13,1089,14,0],[1090,17,1090,55,0],[1091,17,1091,114,0],[1092,17,1092,85,0],[1093,17,1093,56,0],[1094,21,1094,66,0],[1095,13,1095,14,0],[1101,13,1101,20,0],[1101,22,1101,47,0],[1101,48,1101,50,0],[1101,51,1101,75,0],[1102,13,1102,14,0],[1103,17,1103,55,0],[1104,17,1104,118,0],[1105,17,1105,83,0],[1106,17,1106,56,0],[1107,21,1107,70,0],[1108,13,1108,14,0],[1127,13,1127,20,0],[1127,22,1127,38,0],[1127,39,1127,41,0],[1127,42,1127,59,0],[1128,13,1128,14,0],[1129,17,1129,53,0],[1131,17,1131,24,0],[1131,26,1131,44,0],[1131,45,1131,47,0],[1131,48,1131,62,0],[1132,21,1132,71,0],[1133,25,1133,49,0],[1135,17,1135,24,0],[1135,26,1135,40,0],[1135,41,1135,43,0],[1135,44,1135,54,0],[1136,21,1136,48,0],[1137,13,1137,14,0],[1141,13,1141,31,0],[1142,9,1142,10,0]]);
    </script>
  </body>
</html>