<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Business Layer\BL\ScriptUpdateManager.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core.BusinessLayer.BL;
using Aurigo.AMP3.Core.UserControls;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.AMP3.ModuleManagementDAC;
using Aurigo.AMP3.ModuleManagementDTO;
using Aurigo.Brix.Platform.BusinessLayer.AbstractModels;
using Aurigo.Brix.Platform.BusinessLayer.BL;
using Aurigo.Brix.Platform.BusinessLayer.DataResouces;
using Aurigo.Brix.Platform.BusinessLayer.DTO;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Aurigo.Brix.Platform.BusinessLayer.XMLForm;
using Aurigo.Brix.Platform.BusinessLayer.XmlForm_Framework;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.Brix.ReportServerHelper;
using Aurigo.Common;
using Aurigo.Common.Utility;
using Aurigo.Workflow;
using Microsoft.SqlServer.Management.Common;
using Microsoft.SqlServer.Management.Smo;
using Newtonsoft.Json;
using System;
using System.Collections.Generic;
using System.Configuration;
using System.Data;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Net.Http;
using System.Reflection;
using System.Threading;
using System.Threading.Tasks;
using System.Xml;

namespace Aurigo.AMP3.ModuleManagementBL
{
    public class ScriptUpdateManager : SingletonManagerBase&lt;ScriptUpdateManager&gt;
    {
        //List of all the companies that needs to be updated.
        Dictionary&lt;string, TaskList&gt; _CompanyModules;
        //List of all the scripts that needs to be executed
        List&lt;ScriptDetails&gt; _Scripts;
        //List of XMLs, XOMLs, Reports, Context etc thats needs to be uploaded
        List&lt;DBJob&gt; _DBJobs;
        //List of errors
        List&lt;string&gt; _ObservedExceptions;
        TaskStatus _UploadStatus;
        Dictionary&lt;string, bool&gt; _FilesAndDirs;
        public bool UploadOnAll;
        public string RootPath;
        public string _DbPrefix;
        List&lt;Task&gt; lstTasks;
        public List&lt;DirectoryDetails&gt; _CopyDirs;
        public List&lt;FileDetails&gt; _CopyFiles;
        ModulesForVersion _UploadDetails;
        public bool VersionCheckPassed;

        private ScriptUpdateManager()
        {
            _ObservedExceptions = new List&lt;string&gt;();
        }

        public bool CanUploadNew()
        {
            return _UploadStatus == TaskStatus.NotStarted || _UploadStatus == TaskStatus.Done ||
                   _UploadStatus == TaskStatus.Cancelled || _UploadStatus == TaskStatus.Aborted;
        }

        public bool IsBusy()
        {
            return _UploadStatus == TaskStatus.Cancelling || _UploadStatus == TaskStatus.InProgress;
        }

        public List&lt;Task&gt; StartCollectingScripts(string sRootPath, bool bAsTask = true)
        {
            RootPath = sRootPath;
            if (IsBusy()) return new List&lt;Task&gt;();
            if (null == _Scripts) _Scripts = new List&lt;ScriptDetails&gt;();
            else _Scripts.Clear();
            _ObservedExceptions.Clear();
            if (null == _FilesAndDirs) _FilesAndDirs = new Dictionary&lt;string, bool&gt;();
            else _FilesAndDirs.Clear();
            if (null == _DBJobs) _DBJobs = new List&lt;DBJob&gt;();
            else _DBJobs.Clear();
            if (null == _CopyDirs) _CopyDirs = new List&lt;DirectoryDetails&gt;();
            else _CopyDirs.Clear();
            if (null == _CopyFiles) _CopyFiles = new List&lt;FileDetails&gt;();
            else _CopyFiles.Clear();
            _DbPrefix = ConnectionHelper.GetDBPrefix();
            _UploadDetails = new ModulesForVersion();
            VersionCheckPassed = true;

            List&lt;DBInfo&gt; customerDBs;
            if (null != _CompanyModules) _CompanyModules.Clear();
            else _CompanyModules = new Dictionary&lt;string, TaskList&gt;();

            customerDBs = ConnectionHelper.GetAllDatabaseInstances();
            if (UploadOnAll &amp;&amp; customerDBs != null)
            {
                foreach (DBInfo db in customerDBs)
                    _CompanyModules.Add(db.DBName,
                        new TaskList
                        {
                            company = db.Company,
                            scripts = _Scripts,
                            dbInfo = db,
                            RootPath = RootPath,
                            lstDBJobs = _DBJobs,
                            _mod = _UploadDetails
                        });
            }
            else
            {
                DBInfo currentDBSever = customerDBs.Find(s =&gt; s.IsCurrent);
                _CompanyModules.Add(currentDBSever.DBName,
                    new TaskList
                    {
                        company = currentDBSever.Company,
                        scripts = _Scripts,
                        dbInfo = currentDBSever,
                        RootPath = RootPath,
                        lstDBJobs = _DBJobs,
                        _mod = _UploadDetails
                    });
            }

            if (null == lstTasks) lstTasks = new List&lt;Task&gt;();
            else lstTasks.Clear();
            foreach (TaskList ts in _CompanyModules.Values)
            {
                if (!bAsTask) continue;
                lstTasks.Add(ts.FireUpdateScript(this));
            }

            return lstTasks;
        }

        public bool ScheduleScript(string script, string moduleName, bool bOnAllDbs = true)
        {
            if (null == _Scripts) _Scripts = new List&lt;ScriptDetails&gt;();
            ScriptDetails dt = _Scripts.FirstOrDefault(x =&gt; x.Name == moduleName);
            if (dt == null)
                _Scripts.Add(new ScriptDetails { Name = moduleName, Contents = script });
            else
                dt.Contents = script;
            return false;
        }

        public bool ScheduleScript2(string scriptFilePath, string moduleName, bool bOnAllDbs = true)
        {
            if (!File.Exists(scriptFilePath))
                throw new Exception(string.Format(&quot;Script file Absent for {0} {1}&quot;, moduleName, scriptFilePath));
            using (TextReader reader = new StreamReader(scriptFilePath))
            {
                ScheduleScript(reader.ReadToEnd(), moduleName, bOnAllDbs);
            }
            return false;
        }

        public void ScheduleAddModule(ModuleManagementDTO.ModuleDetails newModule)
        {
            _DBJobs.Add(new DBJob { sync = new object(), Name = &quot;AddModule&quot;, Content = newModule });
        }

        public void ScheduleAddModuleFile(ModuleManagementDTO.ModuleFile moduleFile)
        {
            _DBJobs.Add(new DBJob { sync = new object(), Name = &quot;AddModuleFile&quot;, Content = moduleFile });
        }

        public void ScheduleAddPlatform(ModulePlatform newPlatform)
        {
            _DBJobs.Add(new DBJob { sync = new object(), Name = &quot;AddPlatform&quot;, Content = newPlatform });
        }

        public void ScheduleAddApplication(XmlNode xPlatformNode, ModulePlatform newPlatform,
            ModuleManagementDTO.ModuleDetails newModule, string webpath)
        {
            int userid = null == UserDetail.GetCurrentUserDetail() ? 1 : UserDetail.GetCurrentUserDetail().UID;
            _DBJobs.Add(new DBJob
            {
                sync = new object(),
                Name = &quot;AddApplication&quot;,
                Content =
                    new AppDetails
                    {
                        node = xPlatformNode,
                        module = newModule,
                        platform = newPlatform,
                        webpath = webpath,
                        userid = userid
                    }
            });
        }

        internal void ScheduleAddModuleEntry(ModuleManagementDTO.ModuleDetails newModule, XmlNode xPlatformNode,
            string dir)
        {
            int userid = null == UserDetail.GetCurrentUserDetail() ? 1 : UserDetail.GetCurrentUserDetail().UID;
            _DBJobs.Add(new DBJob
            {
                sync = new object(),
                Name = &quot;AddModuleEntry&quot;,
                Content = new AppDetails { node = xPlatformNode, module = newModule, dir = dir, userid = userid }
            });
        }

        public void ScheduleUpdateDependencies(string moduleId, Dictionary&lt;string, string&gt; dependentModules)
        {
            _DBJobs.Add(new DBJob
            {
                sync = new object(),
                Name = &quot;UpdateDependencies&quot;,
                Content = new Dependencies { moduleId = moduleId, Dep = dependentModules }
            });
        }

        public void ScheduleUploadXMLForm(BrixFormModel model)
        {
            _DBJobs.Add(new DBJob { sync = new object(), Name = &quot;UploadXMLForm&quot;, Content = model });
        }

        public void ScheduleStoreFormXML(string tempXMLPath, BrixFormModel model)
        {
            _DBJobs.Add(new DBJob
            {
                sync = new object(),
                Name = &quot;StoreFormXML&quot;,
                Content = new XMLDetails { XMLPath = tempXMLPath, Model = model }
            });
        }

        public void ScheduleUploadXMLControl(string tempXMLPath, BrixFormModel model)
        {
            _DBJobs.Add(new DBJob
            {
                sync = new object(),
                Name = &quot;UploadXMLControl&quot;,
                Content = new XMLDetails { XMLPath = tempXMLPath, Model = model }
            });
        }

        public void ScheduleUploadSharedXMLControl(string tempXMLPath, BrixFormModel model)
        {
            _DBJobs.Add(new DBJob
            {
                sync = new object(),
                Name = &quot;UploadSharedXMLControl&quot;,
                Content = new XMLDetails { XMLPath = tempXMLPath, Model = model }
            });
            //this is line in added so the the parent foms model can be modified before its gets added to DB Jobs.
            XMLFileIO.Instance.StoreXML(model.form.ModuleID, tempXMLPath, model.form.Name + &quot;.xml&quot;,
                XMLType.SharedControl, model.form.IsTemplate, &quot;&quot;);
        }

        public void ScheduleUploadXOML(string filePath, bool overwrite)
        {
            _DBJobs.Add(new DBJob
            {
                sync = new object(),
                Name = &quot;UploadXOML&quot;,
                Content = new WfDetails { filePath = filePath, overwrite = overwrite }
            });
        }

        public void ScheduleUploadReportXML(string filePath, int userid)
        {
            RptDetails det = new RptDetails { File = filePath, userid = userid };
            _DBJobs.Add(new DBJob { sync = new object(), Name = &quot;UploadReportXML&quot;, Content = det });
        }

        public void ScheduleUploadReportRdl(string filePath)
        {
            _DBJobs.Add(new DBJob { sync = new object(), Name = &quot;UploadReportRdl&quot;, Content = filePath });
        }

        public void ScheduleUploadContextMenu(string filePath)
        {
            MnuDetails det = new MnuDetails { File = filePath };
            _DBJobs.Add(new DBJob { sync = new object(), Name = &quot;UploadContextMenu&quot;, Content = det });
        }

        public void ScheduleGenerateXMLFormReports(BrixFormModel model)
        {
            _DBJobs.Add(new DBJob { sync = new object(), Name = &quot;GenerateReportRdl&quot;, Content = model });
        }

        public void ScheduleGenerateXMLFormAuditLogReports(BrixFormModel model)
        {
            _DBJobs.Add(new DBJob { sync = new object(), Name = &quot;generateauditlogreportrdl&quot;, Content = model });
        }

        //public void ScheduleGenerateXMLFormDetailsReports(BrixFormModel model)
        //{
        //    _DBJobs.Add(new DBJob { sync = new object(), Name = &quot;GenerateDetailsReportRdl&quot;, Content = model });
        //}
        public void ScheduleRendererRDL(BrixFormModel model)
        {
            _DBJobs.Add(new DBJob { sync = new object(), Name = &quot;RendererRDL&quot;, Content = model });
        }

        public void ScheduleValidateVersion(ModuleManagementDTO.ModuleDetails newModule,
            Dictionary&lt;string, string&gt; dependentModules, Dictionary&lt;string, string&gt; dModules)
        {
            _UploadDetails.dependentModules = dependentModules;
            _UploadDetails.dModules = dModules;
            _UploadDetails.newModule = newModule;
        }

        public void ScheduleCopyDirectory(string destPath, DirectoryInfo info)
        {
            DirectoryDetails det = new DirectoryDetails { DestDir = destPath, Info = info };
            _CopyDirs.Add(det);
        }

        public void ScheduleCopyFile(string destPath, string source, bool overwrite = true)
        {
            FileDetails det = new FileDetails { DestDirOrFile = destPath, SourceFile = source, Overwrite = overwrite };
            _CopyFiles.Add(det);
        }

        public bool AddForCleanup(string dirPath, bool bIsDir)
        {
            if (string.IsNullOrEmpty(dirPath)) return false;
            if (!_FilesAndDirs.ContainsKey(dirPath)) _FilesAndDirs.Add(dirPath, bIsDir);
            return true;
        }

        public void ScheduleAddSummary(string moduleName, string IP, string userName)
        {
            _DBJobs.Add(new DBJob
            {
                sync = new object(),
                Name = &quot;ModuleSummary&quot;,
                Content = moduleName + &quot;_#_&quot; + IP + &quot;_#_&quot; + userName
            });
        }

        public void StartUpdate(bool bAsTask = true)
        {
            if (_UploadStatus == TaskStatus.InProgress || _UploadStatus == TaskStatus.Cancelling) return;

            _UploadStatus = TaskStatus.InProgress;
            ModuleUploadResult result =
                new ModuleUploadResult(string.Format(&quot;Starting Task Execution For Each DB &quot; + DateTime.UtcNow.ToString(),
                    ModuleUploadResultType.Error));
            foreach (TaskList ts in _CompanyModules.Values)
            {
                if (bAsTask)
                {
                    result =
                        new ModuleUploadResult(string.Format(&quot;Signalling Task to Start at &quot; + DateTime.UtcNow.ToString(),
                            ModuleUploadResultType.Error));
                    ts.MarkScriptsReady();
                    continue;
                }

                ServerConnection conn = new ServerConnection();
                conn.ServerInstance = ts.dbInfo.ServerInstanceName;
                conn.DatabaseName = ts.dbInfo.DBName;
                conn.LoginSecure = ts.dbInfo.LoginSecure;
                if (!ts.dbInfo.LoginSecure)
                {
                    conn.Login = ts.dbInfo.UName;
                    conn.Password = ts.dbInfo.Pwd;
                }

                Microsoft.SqlServer.Management.Smo.Server server = new Server(conn);
                result =
                    new ModuleUploadResult(string.Format(
                        &quot;Starting Serial Task Execution at &quot; + DateTime.UtcNow.ToString(), ModuleUploadResultType.Error));
                ts.UpdateTheScripts(this, server);
                result =
                    new ModuleUploadResult(string.Format(
                        &quot;Done with Serial Task Execution at &quot; + DateTime.UtcNow.ToString(), ModuleUploadResultType.Error));

                try
                {
                    server.ConnectionContext.Disconnect();
                }
                catch (Exception)
                {
                }
            }
        }

        public void WaitForCompletion(List&lt;ModuleUploadResult&gt; uploadResults = null)
        {
            while (lstTasks.Count &gt; 0)
            {
                try
                {
                    int taskId = Task.WaitAny(lstTasks.ToArray());
                    if (lstTasks[taskId].Exception != null)
                    {
                        string msg = lstTasks[taskId].Exception.Message;
                        foreach (Exception ex in lstTasks[taskId].Exception.InnerExceptions)
                            msg += &quot;\n&quot; + ex.Message + &quot;\n&quot; + ex.StackTrace;
                        if (null != uploadResults)
                            uploadResults.Add(new ModuleUploadResult(msg, ModuleUploadResultType.Error));
                    }
                    lstTasks.RemoveAt(taskId);
                }
                catch (AggregateException ae)
                {
                    ae.Flatten();
                    string msg = ae.Message;
                    foreach (Exception ex in ae.InnerExceptions) msg += &quot;\n&quot; + ex.Message + &quot;\n&quot; + ex.StackTrace;
                    if (null != uploadResults)
                        uploadResults.Add(new ModuleUploadResult(msg, ModuleUploadResultType.Error));
                }
            }
            lstTasks.Clear();
            foreach (DirectoryDetails det in _CopyDirs)
            {
                CopyWebFiles(det.DestDir, det.Info, ref uploadResults);
            }
            foreach (FileDetails det in _CopyFiles)
            {
                try
                {
                    if (null != ConfigurationManager.AppSettings[&quot;LogSuccess&quot;])
                        Utilities.LogToFile(AppConfig.LogFile(true),
                            &quot;\r\nCopying the file : &quot; + det.SourceFile + &quot; to &quot; + det.DestDirOrFile,
                            MethodBase.GetCurrentMethod());
                    File.Copy(det.SourceFile, det.DestDirOrFile, det.Overwrite);
                }
                catch (Exception ex)
                {
                    uploadResults.Add(new ModuleUploadResult
                    {
                        Message = &quot;Failed to copy &quot; + det.SourceFile + &quot; with message &quot; + ex.Message,
                        ResultType = ModuleUploadResultType.Error
                    });
                }
            }
            _DBJobs.Clear();
            _CopyDirs.Clear();
            _CopyFiles.Clear();
            _Scripts.Clear();
            foreach (string sDir in _FilesAndDirs.Keys)
                try
                {
                    if (_FilesAndDirs[sDir])
                    {
                        if (Directory.Exists(sDir)) Directory.Delete(sDir, true);
                        continue;
                    }
                    if (File.Exists(sDir)) File.Delete(sDir);
                }
                catch (Exception)
                {
                    if (null != uploadResults)
                        uploadResults.Add(new ModuleUploadResult(&quot;Could not delete dir/file &quot; + sDir,
                            ModuleUploadResultType.Error));
                }
            _FilesAndDirs.Clear();

            if (null != uploadResults)
            {
                uploadResults.Add(new ModuleUploadResult(&quot;All Upload Tasks Completed.&quot;, ModuleUploadResultType.Error));
            }
            _UploadStatus = TaskStatus.Done;
        }

        public List&lt;ModuleUploadResult&gt; GetStatus()
        {
            List&lt;ModuleUploadResult&gt; results = new List&lt;ModuleUploadResult&gt;();
            if (null == _CompanyModules) return results;
            TaskStatus cumulativeStatus = TaskStatus.NotStarted;
            foreach (TaskList sVal in _CompanyModules.Values)
            {
                cumulativeStatus = TaskStatus.InProgress;
                results.Add(new ModuleUploadResult(sVal.StatusMessage(),
                    sVal.GetStatus() == TaskStatus.Aborted
                        ? ModuleUploadResultType.Error
                        : ModuleUploadResultType.Information));
                if (sVal.GetStatus() == TaskStatus.Done)
                {
                    cumulativeStatus = TaskStatus.Done;
                    continue;
                }
                cumulativeStatus = sVal.IsCancelling ? TaskStatus.Cancelling : TaskStatus.InProgress;
            }
            foreach (string s in _ObservedExceptions)
            {
                results.Add(new ModuleUploadResult(s, ModuleUploadResultType.Error));
            }
            _UploadStatus = cumulativeStatus;
            return results;
        }

        public void CancelAllUploads()
        {
            foreach (TaskList sVal in _CompanyModules.Values)
            {
                sVal.Cancel();
            }
        }

        public void AddUnObservedException(UnobservedTaskExceptionEventArgs ex)
        {
            _ObservedExceptions.Add(ex.Exception.Message);
            Utilities.LogDebug(new AppErrInfo { appWhat = ex.Exception.Message }, MethodBase.GetCurrentMethod(),
                &quot;AddUnObservedException&quot;, &quot;UploadLogs.txt&quot;);
            ex.SetObserved();
        }

        private void CopyWebFiles(string destinationPath, DirectoryInfo di, ref List&lt;ModuleUploadResult&gt; status)
        {
            try
            {
                if (destinationPath.Contains(&quot;Uploadable Items&quot;)) return;

                if (!Directory.Exists(destinationPath))
                    Directory.CreateDirectory(destinationPath);

                //Copy AllFiles in the current Directory
                foreach (FileInfo contentFile in di.GetFiles())
                {
                    if (contentFile.Extension.ToLower2() == &quot;.sql&quot; ||
                        contentFile.FullName.Contains(&quot;Uploadable Items&quot;) ||
                        contentFile.Extension.ToLower2() == &quot;.xoml&quot;)
                        continue;

                    string filepath = Path.Combine(destinationPath, contentFile.Name);
                    try
                    {
                        if (null != ConfigurationManager.AppSettings[&quot;LogSuccess&quot;])
                            Utilities.LogToFile(AppConfig.LogFile(true), &quot;\r\nCopying the file : &quot; + filepath,
                                MethodBase.GetCurrentMethod());
                        File.Copy(contentFile.FullName, filepath, true);
                        if (null != status)
                            status.Add(new ModuleUploadResult(&quot;File &#39;{0}&#39; deployed.&quot;.Format2(filepath)));
                    }
                    catch (UnauthorizedAccessException ex)
                    {
                        if (null != status)
                        {
                            if (!new FileInfo(filepath).IsReadOnly)
                                status.Add(new ModuleUploadResult(ex.Message, ModuleUploadResultType.Error));
                            else
                                status.Add(new ModuleUploadResult(&quot;Read-only file. &quot; + ex.Message,
                                    ModuleUploadResultType.Error));
                        }
                    }
                }

                //need to copy all the content files in sub directories maintaining folder structire
                foreach (DirectoryInfo contentDir in di.GetDirectories())
                {
                    string dirpath = Path.Combine(destinationPath, contentDir.Name);
                    CopyWebFiles(dirpath, contentDir, ref status);
                }
            }
            catch (Exception ex)
            {
                status.Add(new ModuleUploadResult(&quot;Failed to deploy {0}.&quot;.Format2(destinationPath),
                    ModuleUploadResultType.Error, ex));
                Utilities.LogToFile(AppConfig.LogFile(true), &quot;\r\n Error Copying file : &quot; + ex.Message,
                    MethodBase.GetCurrentMethod());
            }
        }
    }

    public class RptDetails
    {
        public string File { get; set; }
        public List&lt;ReportDetails&gt; RptLst;
        public int userid;
    }

    public class MnuDetails
    {
        public string File { get; set; }
        public List&lt;BrixContextMenu&gt; MnuList;
    }

    public class MenuDetails
    {
    }

    public class WfDetails
    {
        public string wftId { get; set; }
        public string wfName { get; set; }
        public string wfDesc { get; set; }
        public string wfModuleId { get; set; }
        public string filePath { get; set; }
        public bool ispublished { get; set; }
        public bool overwrite { get; set; }
        public WorkflowDefiniton workflowDef { get; set; }
    }

    public class Dependencies
    {
        public string moduleId { get; set; }
        public Dictionary&lt;string, string&gt; Dep { get; set; }
    }

    public class XMLDetails
    {
        public string XMLPath { get; set; }
        public BrixFormModel Model { get; set; }
    }

    public class DBScript
    {
        public string ScriptName;
        public TaskStatus status;
        public string resultMessage;

        public bool IsDone
        {
            get
            {
                return status == TaskStatus.NotStarted || status == TaskStatus.Done || status == TaskStatus.Cancelled ||
                       status == TaskStatus.Aborted;
            }
        }
    }

    public class DirectoryDetails
    {
        public string DestDir;
        public DirectoryInfo Info;
    }

    public class FileDetails
    {
        public string DestDirOrFile;
        public string SourceFile;
        public bool Overwrite;
    }

    public class ScriptDetails
    {
        public string Name;
        public string Contents;
    }

    public class ModulesForVersion
    {
        public ModuleManagementDTO.ModuleDetails newModule;
        public Dictionary&lt;string, string&gt; dependentModules;
        public Dictionary&lt;string, string&gt; dModules;
    }

    public class AppDetails
    {
        public XmlNode node;
        public ModulePlatform platform;
        public Aurigo.AMP3.ModuleManagementDTO.ModuleDetails module;
        public string dir;
        public string webpath;
        public int userid;
    }

    public class TaskList
    {
        public string company;
        public DBInfo dbInfo;
        public List&lt;DBScript&gt; lst;
        public List&lt;ScriptDetails&gt; scripts;
        public bool IsCancelling;
        public CancellationToken cancellationToken;
        public Task _DBUpdateTask;
        public string RootPath;
        public List&lt;DBJob&gt; lstDBJobs;
        AutoResetEvent _evt;
        public ModulesForVersion _mod;

        public TaskList()
        {
            lst = new List&lt;DBScript&gt;();
            _evt = new AutoResetEvent(true);
        }

        public Task FireUpdateScript(ScriptUpdateManager mgr)
        {
            _evt.Reset();
            _DBUpdateTask = Task.Factory.StartNew((tList) =&gt;
            {
                string start = DateTime.UtcNow.ToString();
                ServerConnection conn = new ServerConnection();
                conn.ServerInstance = dbInfo.ServerInstanceName;
                conn.DatabaseName = dbInfo.DBName;
                conn.LoginSecure = dbInfo.LoginSecure;
                if (!dbInfo.LoginSecure)
                {
                    conn.Login = dbInfo.UName;
                    conn.Password = dbInfo.Pwd;
                }

                Microsoft.SqlServer.Management.Smo.Server server = new Server(conn);
                server.ConnectionContext.ExecuteNonQuery(@&quot;SET ANSI_NULLS ON &quot; + Environment.NewLine + &quot; GO &quot;);
                string end = DateTime.UtcNow.ToString();
                ModuleUploadResult result =
                    new ModuleUploadResult(
                        string.Format(&quot;Waiting for Parallel Task Execution at &quot; + end + &quot; at &quot; + dbInfo.DBName,
                            ModuleUploadResultType.Error));
                _evt.WaitOne();

                result =
                    new ModuleUploadResult(
                        string.Format(
                            &quot;Starting Parallel Task Execution at &quot; + DateTime.UtcNow.ToString() + &quot; on &quot; + dbInfo.DBName,
                            ModuleUploadResultType.Error));
                UpdateTheScripts(tList, server);
                result =
                    new ModuleUploadResult(
                        string.Format(
                            &quot;Done with Parallel Task Execution at &quot; + DateTime.UtcNow.ToString() + &quot; on &quot; + dbInfo.DBName,
                            ModuleUploadResultType.Error));


                try
                {
                    server.ConnectionContext.Disconnect();
                }
                catch (Exception)
                {
                }
            }, mgr, cancellationToken);
            return _DBUpdateTask;
        }

        public void MarkScriptsReady()
        {
            _evt.Set();
        }

        public void UpdateTheScripts(object tList, Microsoft.SqlServer.Management.Smo.Server server)
        {
            bool bHasErrors = false;
            bool bHasModuleErrors = false;
            ScriptUpdateManager lstScripts = (ScriptUpdateManager)tList;
            ModuleUploadDetails dto = new ModuleUploadDetails();
            try
            {
                string db = server.ConnectionContext.DatabaseName;
                if (!lstScripts.VersionCheckPassed)
                {
                    ModuleUploadResult res =
                        new ModuleUploadResult(
                            &quot;Aborting upload on &quot; + db + &quot; - Version check has failed for main database.&quot;,
                            ModuleUploadResultType.Error);
                    return;
                }

                List&lt;ModuleUploadResult&gt; lstUploadResult = new List&lt;ModuleUploadResult&gt;();
                if (null == _mod) return;
                string CoreVersion = GetModuleVersion(Constants.MODID_CORE, company);
                //if (!ValidateVersion(lstUploadResult, _mod.newModule, CoreVersion)) return;
                //if (!ValidateModuleVersion(_mod.newModule, lstUploadResult, _mod.dependentModules, _mod.dModules, company)) return;
                _mod = null;

                //Execute AddModule before uploading any report
                //Execute AddModule before uploading XMLs. Otherwise the entry in COREMobileCacheModuleData does not get created as part of Xml form upload
                //Required to fix permission issues in scratch build  
                List&lt;DBJob&gt; addModulesType = lstDBJobs.FindAll(jb =&gt; jb.Name.Equals(&quot;addmodule&quot;, StringComparison.CurrentCultureIgnoreCase));

                foreach (DBJob dj in addModulesType)
                {
                    if (!UpdateDBWithData(server, company, lstUploadResult, dj, false, bHasModuleErrors))
                        bHasModuleErrors = bHasErrors = true;
                }

                //Uploading the XMLs before running the scripts.
                List&lt;DBJob&gt; xmls =
                    lstDBJobs.FindAll(
                        jb =&gt; jb.Name.Equals(&quot;uploadxmlform&quot;, StringComparison.CurrentCultureIgnoreCase) ||
                              jb.Name.Equals(&quot;storeformxml&quot;, StringComparison.CurrentCultureIgnoreCase));


                foreach (DBJob dj in xmls)
                {
                    if (!UpdateDBWithData(server, company, lstUploadResult, dj, false, bHasModuleErrors))
                        bHasModuleErrors = bHasErrors = true;
                }

                //Executing scripts
                foreach (ScriptDetails sd in scripts)
                {
                    DBScript script = null;
                    try
                    {
                        if (cancellationToken.IsCancellationRequested) return;

                        string msg = &quot;DB schema script &quot; + sd.Name + &quot; started on database &quot; + db + &quot; at &quot; +
                                     DateTime.UtcNow.ToString(&quot;HH:mm:ss tt&quot;) + &quot;.\n&quot;;
                        script = new DBScript { ScriptName = db, resultMessage = msg, status = TaskStatus.InProgress };
                        lst.Add(script);

                        dto.Message = msg;
                        dto.MessageLevel = (int)ModuleUploadResultType.Information;
                        dto.ModuleID = &quot;&quot;;
                        dto.ParentID = 0;
                        dto.Type = &quot;Details&quot;;
                        dto.UploadTime = DateTime.UtcNow;
                        ModuleUploadManager.Instance.LogModuleUploadDetails(dto);
                        Utilities.LogDebug(new AppErrInfo { appWhat = msg }, MethodBase.GetCurrentMethod(),
                            &quot;FireUpdateScript&quot;, &quot;UploadLogs.txt&quot;);

                        int result = server.ConnectionContext.ExecuteNonQuery(sd.Contents);

                        msg = &quot;DB schema script &quot; + sd.Name + &quot; executed with return value &quot; + result.ToString() +
                              &quot; on database &quot; + db + &quot; at &quot; + DateTime.UtcNow.ToString(&quot;HH:mm:ss tt&quot;) + &quot;.\n&quot;;

                        if (null != server.ConnectionContext.CapturedSql)
                            Utilities.LogDebug(
                                new AppErrInfo
                                {
                                    appWhat = &quot;DB schema script Result&quot;,
                                    appWhere = server.ConnectionContext.CapturedSql.Text.ToString()
                                },
                                MethodBase.GetCurrentMethod());

                        dto.Message = msg;
                        dto.UploadTime = DateTime.UtcNow;
                        ModuleUploadManager.Instance.LogModuleUploadDetails(dto);

                        script.resultMessage = msg;
                        script.status = TaskStatus.Done;
                        Utilities.LogDebug(new AppErrInfo { appWhat = msg }, MethodBase.GetCurrentMethod(),
                            &quot;FireUpdateScript&quot;, &quot;UploadLogs.txt&quot;);
                    }
                    catch (Exception ex)
                    {
                        string msg =
                            string.Format(&quot;DB schema script &#39;{0}&#39; upload failed for database {1} with message\n{2}&quot;,
                                sd.Name, db, ex.Message + (null == ex.InnerException ? &quot;&quot; : ex.InnerException.Message));

                        dto.Message = msg;
                        dto.MessageLevel = (int)ModuleUploadResultType.Error;
                        dto.ModuleID = &quot;&quot;;
                        dto.ParentID = 0;
                        dto.Type = &quot;Details&quot;;
                        dto.UploadTime = DateTime.UtcNow;
                        ModuleUploadManager.Instance.LogModuleUploadDetails(dto);

                        Utilities.LogError(ex, new AppErrInfo { appWhat = msg }, MethodBase.GetCurrentMethod());
                        script.resultMessage = msg;
                        script.status = TaskStatus.Aborted;
                    }
                }
                Utilities.LogDebug(new AppErrInfo { appWhat = &quot;Upload of all script completed for &quot; + db },
                    MethodBase.GetCurrentMethod(), &quot;FireUpdateScript&quot;, &quot;UploadLogs.txt&quot;);

                //Connecting to SSRS to upload reports later
                bool? isSSRSconfigured = null;
                try
                {
                    ReportHelper.Instance.Connect(
                        ReportManager.Instance.GetSettingsOn(ConnectionHelper.GetConnectionString(company)));
                    ReportHelper.Instance.CheckConnection();
                    isSSRSconfigured = true;
                }
                catch (Exception)
                {
                    isSSRSconfigured = false;
                }

                //Uploading everyting else inside Uploadable items - XMLs, reports, xoml, context etx

                foreach (DBJob dj in lstDBJobs)
                {
                    //XMLs have already been uploaded
                    if (dj.Name.Equals(&quot;uploadxmlform&quot;, StringComparison.CurrentCultureIgnoreCase) ||
                        dj.Name.Equals(&quot;storeformxml&quot;, StringComparison.CurrentCultureIgnoreCase) ||
                        dj.Name.Equals(&quot;addmodule&quot;, StringComparison.CurrentCultureIgnoreCase))
                        continue;

                    if (!UpdateDBWithData(server, company, lstUploadResult, dj, isSSRSconfigured, bHasModuleErrors))
                        bHasModuleErrors = bHasErrors = true;

                    if (dj.Name.Equals(&quot;modulesummary&quot;, StringComparison.CurrentCultureIgnoreCase))
                        bHasModuleErrors = false;
                }
                dto.Message = &quot;Upload of data (xml forms, xoml, reports...) for db &quot; + db +
                              (bHasErrors ? &quot; done with errors.&quot; : &quot; done without errors.&quot;);
                dto.MessageLevel = bHasErrors
                    ? (int)ModuleUploadResultType.Error
                    : (int)ModuleUploadResultType.Information;
                dto.ModuleID = &quot;&quot;;
                dto.ParentID = 0;
                dto.Type = &quot;Details&quot;;
                dto.UploadTime = DateTime.UtcNow;
                ModuleUploadManager.Instance.LogModuleUploadDetails(dto);
                Utilities.LogDebug(new AppErrInfo { appWhat = &quot;Upload of all script completed for &quot; + db },
                    MethodBase.GetCurrentMethod(), &quot;FireUpdateScript&quot;, &quot;UploadLogs.txt&quot;);
            }
            catch (Exception ex)
            {
                dto.Message = &quot;Upload failed for Task &quot; + company + &quot; with message: &quot; + ex.Message;
                dto.MessageLevel = (int)ModuleUploadResultType.Information;
                dto.ModuleID = &quot;&quot;;
                dto.ParentID = 0;
                dto.Type = &quot;Details&quot;;
                dto.UploadTime = DateTime.UtcNow;
                ModuleUploadManager.Instance.LogModuleUploadDetails(dto);
                Utilities.LogDebug(new AppErrInfo { appWhat = &quot;Upload of script failed for Task &quot; + company },
                    MethodBase.GetCurrentMethod(), &quot;FireUpdateScript&quot;, &quot;UploadLogs.txt&quot;);
            }
        }

        private bool UpdateDBWithData(Server server, string company, List&lt;ModuleUploadResult&gt; lstResult, DBJob dj,
            bool? isSSRSconfigured, bool hasError)
        {
            ModuleUploadDetails dto = new ModuleUploadDetails();
            string status = &quot;&quot;;
            try
            {
                string sjobType = dj.Name.ToLower();
                XMLDetails xmlDetails = null;
                switch (sjobType)
                {
                    case &quot;addmodule&quot;:
                        AddModule(lstResult, (ModuleManagementDTO.ModuleDetails)dj.Content, company);
                        break;
                    case &quot;addmodulefile&quot;:
                        lock (dj.sync)
                        {
                            AddModuleFile(company, (ModuleFile)dj.Content);
                        }
                        break;
                    case &quot;addapplication&quot;:
                        AddApplication((AppDetails)dj.Content, company);
                        break;
                    case &quot;addmoduleentry&quot;:
                        AddModuleEntry(lstResult, (AppDetails)dj.Content, company, isSSRSconfigured);
                        break;
                    case &quot;addplatform&quot;:
                        AddPlatform((ModulePlatform)dj.Content, company);
                        break;
                    case &quot;updatedependencies&quot;:
                        Dependencies dm = (Dependencies)dj.Content;
                        UpdateDependencies(dm.moduleId, dm.Dep, company);
                        break;
                    case &quot;uploadxmlform&quot;:
                        lock (dj.sync)
                        {
                            status += UploadXMLForm((BrixFormModel)dj.Content, status, company);
                        }
                        break;
                    case &quot;storeformxml&quot;:
                        lock (dj.sync)
                        {
                            xmlDetails = (XMLDetails)dj.Content;
                            status += StoreFormXML(xmlDetails.XMLPath, xmlDetails.Model, company);
                        }
                        break;
                    case &quot;uploadxmlcontrol&quot;:
                        lock (dj.sync)
                        {
                            xmlDetails = (XMLDetails)dj.Content;
                            UploadXMLControl(xmlDetails.XMLPath, xmlDetails.Model, status, company);
                        }
                        break;
                    case &quot;uploadsharedxmlcontrol&quot;:
                        lock (dj.sync)
                        {
                            xmlDetails = (XMLDetails)dj.Content;
                            UploadSharedXMLControl(xmlDetails.XMLPath, xmlDetails.Model, status, company);
                        }
                        break;
                    case &quot;uploadxoml&quot;:
                        lock (dj.sync)
                        {
                            UploadXoml((WfDetails)dj.Content, company);
                        }
                        break;
                    case &quot;uploadreportxml&quot;:
                        lock (dj.sync)
                        {
                            RptDetails rpt = (RptDetails)dj.Content;
                            UploadReportXML(lstResult, rpt.File, ref rpt.RptLst, rpt.userid, company);
                        }
                        break;
                    case &quot;uploadreportrdl&quot;:
                        lock (dj.sync)
                        {
                            UploadReportRdl(lstResult, isSSRSconfigured, (string)dj.Content, company);
                        }
                        break;
                    case &quot;uploadcontextmenu&quot;:
                        lock (dj.sync)
                        {
                            MnuDetails mnu = (MnuDetails)dj.Content;
                            UploadContextMenu(mnu.File, ref mnu.MnuList, ref lstResult, company);
                        }
                        break;
                    case &quot;generatereportrdl&quot;:
                        lock (dj.sync)
                        {
                            CultureInfo ci = new CultureInfo(AMP3ApplicationSettings.Instance.Culture);
                            Thread.CurrentThread.CurrentCulture = ci;
                            Thread.CurrentThread.CurrentUICulture = ci;
                            BrixFormModel model = (BrixFormModel)dj.Content;
                            GenerateReportRDL(model, company, lstResult, isSSRSconfigured);
                        }
                        break;
                    case &quot;rendererrdl&quot;:
                        lock (dj.sync)
                        {
                            BrixFormModel model = (BrixFormModel)dj.Content;
                            CultureInfo ci = new CultureInfo(AMP3ApplicationSettings.Instance.Culture);
                            Thread.CurrentThread.CurrentCulture = ci;
                            Thread.CurrentThread.CurrentUICulture = ci;
                            RendererRDL(model, company, lstResult, isSSRSconfigured);
                        }
                        break;
                    case &quot;modulesummary&quot;:
                        {
                            string details = (string)dj.Content;
                            string[] dets = details.Split(new string[] { &quot;_#_&quot; }, StringSplitOptions.RemoveEmptyEntries);
                            LogSummary(dets[0], dets[1], dets[2], company, hasError);
                            break;
                        }
                    case &quot;generateauditlogreportrdl&quot;:
                        lock (dj.sync)
                        {
                            CultureInfo ci = new CultureInfo(AMP3ApplicationSettings.Instance.Culture);
                            Thread.CurrentThread.CurrentCulture = ci;
                            Thread.CurrentThread.CurrentUICulture = ci;
                            BrixFormModel model = (BrixFormModel)dj.Content;
                            GenerateReportRDLForAuditLog(model, company, lstResult, isSSRSconfigured);
                        }
                        break;
                    default:
                        throw new Exception(&quot;Unknown module upload detected &quot;);
                }
            }
            catch (Exception ex)
            {
                dto.Message = &quot;Upload of data for &quot; + dj.Name + &quot; for db &quot; + company + &quot; failed with error &quot; +
                              ex.Message;
                lstResult.Add(new ModuleUploadResult(dto.Message, ModuleUploadResultType.Error, ex));
                dto.MessageLevel = (int)ModuleUploadResultType.Error;
                dto.ModuleID = &quot;&quot;;
                dto.ParentID = 0;
                dto.Type = &quot;Details&quot;;
                dto.UploadTime = DateTime.UtcNow;
                ModuleUploadManager.Instance.LogModuleUploadDetails(dto);
                Utilities.LogDebug(new AppErrInfo { appWhat = &quot;DB Data Update Failed for DB &quot; + company },
                    MethodBase.GetCurrentMethod(), &quot;FireUpdateScript&quot;, &quot;UploadLogs.txt&quot;);
                return false;
            }
            if (string.IsNullOrEmpty(status)) return true;
            lstResult.Add(new ModuleUploadResult(status, ModuleUploadResultType.Information));
            return true;
        }

        public static void GenerateReportRDL(BrixFormModel model, string company, List&lt;ModuleUploadResult&gt; lstResult,
            bool? isSSRSconfigured)
        {
            using (HttpClientHelper client = new HttpClientHelper(ConfigurationManager.AppSettings[&quot;RDLGeneratorServiceBaseURL&quot;]?.ToString(), AMP3ApplicationSettings.Instance.ServiceAuthorizationToken))
            {
                HttpResponseMessage response = client.GetResponse($@&quot;api/RDLGeneration/GenerateReportRDL?moduleId={model.form.Name}&amp;company={company}&quot;);
                if (response.IsSuccessStatusCode)
                {
                    List&lt;ModuleUploadResult&gt; lst = JsonConvert.DeserializeObject&lt;List&lt;ModuleUploadResult&gt;&gt;(response.Content.ReadAsAsync&lt;string&gt;().Result);
                    if (lst?.Count &gt; 0) lstResult.AddRange(lst);
                }
            }
        }

        public static void GenerateReportRDLForAuditLog(BrixFormModel model, string company, List&lt;ModuleUploadResult&gt; lstResult,
           bool? isSSRSconfigured)
        {
            using (HttpClientHelper client = new HttpClientHelper(ConfigurationManager.AppSettings[&quot;RDLGeneratorServiceBaseURL&quot;]?.ToString(), AMP3ApplicationSettings.Instance.ServiceAuthorizationToken))
            {
                HttpResponseMessage response = client.GetResponse($@&quot;api/RDLGeneration/GenerateReportRDLForAuditLog?moduleId={model.form.Name}&amp;company={company}&quot;);
                if (response.IsSuccessStatusCode)
                {
                    List&lt;ModuleUploadResult&gt; lst = JsonConvert.DeserializeObject&lt;List&lt;ModuleUploadResult&gt;&gt;(response.Content.ReadAsAsync&lt;string&gt;().Result);
                    if (lst?.Count &gt; 0) lstResult.AddRange(lst);
                }
            }
        }

        private static ReportDetails CreateReportDetails(BrixFormModel model, bool IsActive,
            string QueryStringParameters)
        {
            string header =
                model.form.ParseDynamicString((model.form.Header.Length &gt; 113)
                    ? model.form.Header.Substring(0, 113)
                    : model.form.Header, false);
            ReportDetails newReport = new ReportDetails();
            newReport.Name = model.form.Name + &quot;_&quot; + header + &quot;_ListReport&quot;;
            newReport.ParentModuleID = model.form.ParentModuleID;
            newReport.ModuleId = model.form.ModuleID;
            newReport.Description = &quot;List Page Report&quot;;
            newReport.IsActive = IsActive;
            newReport.UploadedDate = DateTime.UtcNow;

            //TODO:Get the userid properly
            newReport.UploadedBy = 1;

            newReport.ModelType = &quot;List&quot;;
            newReport.ParentContext = model.form.Name;
            newReport.Context = model.form.Name + &quot;List&quot;;
            newReport.ReportType = &quot;sql&quot;;
            newReport.QueryStringParameters = QueryStringParameters.Trim().TrimEnd(&#39;,&#39;);
            return newReport;
        }

        private static XMLRenderingEngine engine;

        public static void RendererRDL(BrixFormModel model, string company, List&lt;ModuleUploadResult&gt; lstResult,
            bool? isSSRSconfigured)
        {
            using (HttpClientHelper client = new HttpClientHelper(ConfigurationManager.AppSettings[&quot;RDLGeneratorServiceBaseURL&quot;]?.ToString(), AMP3ApplicationSettings.Instance.ServiceAuthorizationToken))
            {
                HttpResponseMessage response = client.GetResponse($@&quot;api/RDLGeneration/RendererRDL?moduleId={model.form.Name}&amp;company={company}&quot;);
                if (response.IsSuccessStatusCode)
                {
                    List&lt;ModuleUploadResult&gt; lst = JsonConvert.DeserializeObject&lt;List&lt;ModuleUploadResult&gt;&gt;(response.Content.ReadAsAsync&lt;string&gt;().Result);
                    if (lst?.Count &gt; 0) lstResult.AddRange(lst);
                }
            }
        }

        private void LogSummary(string moduleName, string IP, string userName, string company, bool hasError)
        {
            string msg =
                string.Format(string.Format(&quot;Module &#39;{0}&#39; deployed successfully{1} at {2} on db {3}.\n&quot;, moduleName,
                    (hasError ? &quot; with warnings&quot; : &quot;&quot;), DateTime.UtcNow.ToString(&quot;HH:mm:ss tt&quot;),
                    string.IsNullOrEmpty(company) ? &quot;central&quot; : company),
                    hasError ? ModuleUploadResultType.Warning : ModuleUploadResultType.Information, true);

            new ModuleUploadResult(msg, hasError ? ModuleUploadResultType.Warning : ModuleUploadResultType.Information, null,
                false);

            ModuleUploadDetails detailsDto = new ModuleUploadDetails();
            detailsDto.UploadTime = DateTime.UtcNow;
            detailsDto.Message = msg;
            detailsDto.MessageLevel = hasError
                ? (int)ModuleUploadResultType.Warning
                : (int)ModuleUploadResultType.Information;
            detailsDto.ModuleID = &quot;&quot;;
            detailsDto.ParentID = 0;
            detailsDto.Type = &quot;Summary&quot;;
            ModuleUploadManager.Instance.LogModuleUploadDetails(detailsDto);

            ModuleUploadMaster dto = new ModuleUploadMaster();
            dto.UserName = userName;
            dto.UploadTime = DateTime.UtcNow;
            dto.Status = msg;
            dto.IP = IP;
            ModuleUploadManager.Instance.LogModuleUploadMaster(dto);
        }

        public static void AddModuleFile(string company, ModuleFile mf)
        {
            ModuleManagementComponent.Instance.AddModuleFile(mf, company);
        }

        public static bool ValidateVersion(List&lt;ModuleUploadResult&gt; status, ModuleManagementDTO.ModuleDetails newModule,
            string CoreVersion)
        {
            string depErr1 =
                &quot;Module &#39;{2}&#39; upload failed. The core module version {0} older than the installed version {1}.\n&quot;;
            string depErr2 =
                &quot;Module &#39;{0}&#39; upload failed. Requires a more recent application version {1} than the installed version {2}.\n&quot;;
            if (newModule.IsCoreModule)
            {
                if (CheckVersion(newModule.Version, CoreVersion) &gt; 0)
                {
                    status.Add(new ModuleUploadResult(depErr1.Format2(newModule.Version, CoreVersion, newModule.Name),
                        ModuleUploadResultType.Error));
                    return false;
                }
                return true;
            }

            if (CheckVersion(newModule.CoreVersion, CoreVersion) &gt;= 0) return true;
            status.Add(new ModuleUploadResult(depErr2.Format2(newModule.Name, newModule.CoreVersion, CoreVersion),
                ModuleUploadResultType.Error));
            return false;
        }

        public string GetModuleVersion(string moduleID, string company = null)
        {
            DataRow dr = GetModuleDetails(moduleID, company);
            return (dr != null) ? (dr[&quot;Version&quot;].ToString2()) : &quot;&quot;;
        }

        private static int CheckVersion(string verReq, string verCurr)
        {
            if (verReq.Equals(verCurr)) return 0;

            string[] vr = verReq.Split(&#39;.&#39;);
            string[] vc = verCurr.Split(&#39;.&#39;);
            for (int idx = 0; idx &lt; Math.Min(vr.Length, vc.Length); idx++)
            {
                if (vr[idx].ToInt32_2() &lt; vc[idx].ToInt32_2()) return 1;
                if (vr[idx].ToInt32_2() &gt; vc[idx].ToInt32_2()) return -1;
            }
            return 0;
        }

        public static bool ValidateModuleVersion(ModuleManagementDTO.ModuleDetails newModule,
            List&lt;ModuleUploadResult&gt; status, Dictionary&lt;string, string&gt; dependentModules,
            Dictionary&lt;string, string&gt; dModules, string company)
        {
            if (null == dependentModules) return true;
            try
            {
                string depErr = &quot;Module &#39;{0}&#39; upload failed. Dependent module &#39;{1}&#39; not deployed.\n&quot;;
                string depErr2 =
                    &quot;Module &#39;{0}&#39; upload failed. This module requires a more recent &#39;{1}&#39; version {2} than the installed version {3}.\n&quot;;
                foreach (var module in dependentModules)
                {
                    if (!dModules.ContainsKey(module.Key))
                    {
                        status.Add(new ModuleUploadResult(depErr.Format2(newModule.Name, module.Key),
                            ModuleUploadResultType.Error));
                        return false;
                    }

                    DataRow moduleRow = GetModuleDetails(module.Key, company);
                    if (CheckVersion(module.Value, moduleRow[&quot;Version&quot;].ToString2()) &lt; 0)
                    {
                        status.Add(new ModuleUploadResult(depErr2.Format2(newModule.Name, moduleRow[&quot;ModuleName&quot;],
                            module.Value, moduleRow[&quot;Version&quot;]), ModuleUploadResultType.Error));
                        return false;
                    }
                }
            }
            catch (Exception ex)
            {
                status.Add(new ModuleUploadResult(&quot;Error while checking for version: &quot; + ex.Message,
                    ModuleUploadResultType.Error, ex));
                return false;
            }
            return true;
        }

        public static DataRow GetModuleDetails(string moduleID, string company = null)
        {
            string currentCompany = null == company ? ConnectionHelper.GetCurrentCompany() : company;
            return CoreDatabaseHelper.GetModuleDetails(moduleID, currentCompany);
        }

        public static bool AddModule(List&lt;ModuleUploadResult&gt; status,
            Aurigo.AMP3.ModuleManagementDTO.ModuleDetails newModule, string db)
        {
            if (!(ModuleManagementComponent.Instance.AddModule(newModule, db) &gt;= 0))
            {
                status.Add(
                    new ModuleUploadResult(
                        string.Format(&quot;Module &#39;{0}&#39; upload failed on database {1}.\n&quot;, newModule.Name, db),
                        ModuleUploadResultType.Error));
                return false;
            }
            return true;
        }

        private static void UploadReportXML(List&lt;ModuleUploadResult&gt; status, string file,
            ref List&lt;ReportDetails&gt; reportDetails, int userid, string db)
        {
            if (null == reportDetails || reportDetails.Count &lt; 1)
            {
                try
                {
                    var results = new List&lt;ModuleUploadResult&gt;();
                    reportDetails = ReportManager.Instance.GetReportDetailsFromXml(file, ref results, userid, true);
                }
                catch (Exception ex)
                {
                    status.Add(
                        new ModuleUploadResult(
                            string.Format(&quot;Invalid Report XML file &#39;{0}&#39;.\n&quot;, Path.GetFileName(file)),
                            ModuleUploadResultType.Error, ex));
                }
            }

            if (reportDetails != null &amp;&amp; reportDetails.Count &gt; 0)
            {
                var results = new List&lt;ModuleUploadResult&gt;();
                ReportManager.Instance.UploadXMLReports(reportDetails, ref results, db, userid, null, null);
                if (results.Count &gt; 0)
                {
                    status.AddRange(results);
                }
            }
        }

        private static bool? UploadReportRdl(List&lt;ModuleUploadResult&gt; status, bool? isSSRSconfigured, string filePath,
            string db)
        {
            try
            {
                if (!isSSRSconfigured.HasValue)
                {
                    ReportHelper.Instance.Connect(ReportManager.Instance.GetSettingsOn(ConnectionHelper.GetConnectionString(db)));
                    ReportHelper.Instance.CheckConnection();
                    isSSRSconfigured = true;
                }
            }
            catch (Exception)
            {
                isSSRSconfigured = false;
            }
            string filename = Path.GetFileNameWithoutExtension(filePath);
            if (isSSRSconfigured.HasValue &amp;&amp; isSSRSconfigured.Value)
            {
                ReportHelper.Instance.RptServer.UploadReport(filePath, Path.GetFileNameWithoutExtension(filePath));
                status.Add(
                    new ModuleUploadResult(string.Format(&quot;Report &#39;{0}&#39; uploaded successfully {1} at {2}.\n&quot;, filename,
                        (string.IsNullOrEmpty(db) ? &quot;&quot; : &quot; on database &quot; + db), DateTime.UtcNow.ToString(&quot;HH:mm:ss tt&quot;))));
            }
            else
            {
                status.Add(new ModuleUploadResult(string.Format(
                    &quot;Reporting Services is not configured correctly {1}. Report &#39;{0}&#39; upload failed.\n&quot;,
                    filename, (string.IsNullOrEmpty(db) ? &quot;&quot; : &quot; on database &quot; + db)), ModuleUploadResultType.Error));
            }
            return isSSRSconfigured;
        }

        public static int AddPlatform(ModulePlatform newPlatform, string db)
        {
            return ModuleManagementComponent.Instance.AddPlatform(newPlatform, db);
        }

        public static void UpdateDependencies(string moduleId, Dictionary&lt;string, string&gt; dependentModules,
            string CompanyCode)
        {
            ModuleManagementComponent.Instance.UpdateModuleDependencies(moduleId, dependentModules, CompanyCode);
        }

        public static string UploadXMLForm(BrixFormModel model, string statusMessage, string db)
        {
            // Create requried table and Views for the form
            // Create the table in the database

            try
            {
                if (model.form.InstantiateTable)
                {
                    ComponentHelper.Instance.ExecuteNonQueryOn(ConnectionHelper.GetConnectionString(db),
                        model.CreateScript());

                    // Drop the view if exists
                    ComponentHelper.Instance.ExecuteNonQueryOn(ConnectionHelper.GetConnectionString(db),
                        model.form.DropViewQuery());
                    // Create the view
                    ComponentHelper.Instance.ExecuteNonQueryOn(ConnectionHelper.GetConnectionString(db),
                        model.form.CreateViewQuery());

                    if (model.form.QRGenerator.QRControl.Count &gt; 0)
                    {
                        // Drop the QR view if exists
                        ComponentHelper.Instance.ExecuteNonQueryOn(ConnectionHelper.GetConnectionString(db),
                            model.form.DropQRViewQuery());
                        // Create the QR view
                        ComponentHelper.Instance.ExecuteNonQueryOn(ConnectionHelper.GetConnectionString(db),
                            model.form.CreateQRViewQuery());
                    }
                }
                if (model.form.IsSearchable)
                {
                    //Create Search View
                    if (string.IsNullOrEmpty(model.form.BaseTableName) &amp;&amp; model.form.InstantiateTable == true)
                    {
                        ComponentHelper.Instance.ExecuteNonQueryOn(ConnectionHelper.GetConnectionString(db), model.form.DropSeacrhViewQuery());
                        ComponentHelper.Instance.ExecuteNonQueryOn(ConnectionHelper.GetConnectionString(db), model.form.CreateSearchableViewQuery());
                    }
                    model.form.ProcessAllContainersDeeply(
                      cc =&gt;
                      {
                          if (cc is DynamicGrid || cc is StaticGrid &amp;&amp; !string.IsNullOrEmpty(((DataBaseContainer)cc).TableName))
                          {
                              if (((cc is StaticGrid) &amp;&amp; cc.Containers[0].GetType() == typeof(Header)) || cc is DynamicGrid)
                              {
                                  ComponentHelper.Instance.ExecuteNonQueryOn(ConnectionHelper.GetConnectionString(db), model.form.DropDynamicGridSearchViewQuery(((DataBaseContainer)cc).TableName));
                                  ComponentHelper.Instance.ExecuteNonQueryOn(ConnectionHelper.GetConnectionString(db), model.form.CreateDynamicGridSearchViewQuery(((DataBaseContainer)cc).TableName));
                              }
                          }
                      }
                   );
                }
                statusMessage += &quot;DB scripts executed on database &quot; + db + &quot; for xml &quot; +
                                 model.form.ParseDynamicString(model.form.Header, false) + &quot; successfully at &quot; +
                                 DateTime.UtcNow.ToString(&quot;HH:mm:ss tt&quot;) + &quot;.\n&quot;;

                //Clear the provider cache otherwise the xml changes will not get refected. 
                IProvider _provider = AppProviderManager.Instance.GetProvider(&quot;BRIXProvider&quot;,
                    ConnectionHelper.GetCurrentCompany());
                if (_provider != null)
                {
                    ((BrixCoreDataProvider)_provider).ClearXmlFormModel(model.form.Name);
                }
            }
            catch (Exception ex)
            {
                //View Creation failed. Suppressing the error - Can be a product template or a dashboard
                statusMessage += &quot;DB scripts failed to execute on database &quot; + db + &quot; for xml &quot; + model.form.Header +
                                 &quot; at &quot; + DateTime.UtcNow.ToString(&quot;HH:mm:ss tt&quot;) + &quot;.\n&quot;;
                statusMessage += &quot;Details: &quot; + ex.Message + &quot;.\n&quot;;
                statusMessage += &quot;Inner Exception: &quot; + ex.InnerException + &quot;.\n&quot;;
            }
            return statusMessage;
        }

        public static string StoreFormXML(string tempXMLPath, BrixFormModel model, string db)
        {
            try
            {
                XMLFileIO.Instance.StoreXML(model.form.ModuleID, tempXMLPath, model.form.Name + &quot;.xml&quot;, XMLType.Form, model.form.IsTemplate, db);

                //This is done so that the permissions logic can make use of latest data from table COREMobileCacheModuleData, when an upload of xmlForm happens
                MobileCacheComponent.Instance.CreateUpdateMobileModuleCache(model.form.Name);

                return string.Format(&quot;Successfully stored xml form {0} in db binary table&quot;, model.form.ModuleID);
            }
            catch (Exception ex)
            {
                //Store XML failed. Suppressing the error - Can be a product template or a dashboard
                return &quot;Failed to store XML on database &quot; + db + &quot; for xml &quot; + model.form.Name + &quot;.xml at &quot; +
                       DateTime.UtcNow.ToString(&quot;HH:mm:ss tt&quot;) + &quot;.\n&quot;
                       + &quot;Details: &quot; + ex.Message + &quot;.\n&quot;
                       + &quot;Inner Exception: &quot; + ex.InnerException + &quot;.\n&quot;;
            }
        }

        public static void UploadXMLControl(string tempXMLPath, BrixFormModel model, string statusMessage, string db)
        {
            try
            {
                if (model.form.InstantiateTable)
                {
                    ComponentHelper.Instance.ExecuteNonQueryOn(ConnectionHelper.GetConnectionString(db),
                        model.CreateScript());

                    ComponentHelper.Instance.ExecuteNonQueryWithVariableParametersOn(
                        ConnectionHelper.GetConnectionString(db),
                        Aurigo.Brix.Platform.BusinessLayer.DataAccessHelper.StoredProcedure.usp_MODMGMTCUXMLControl,
                        null, null, model.form.Name,
                        (model.form as XMLControl).ParentPageURL);
                }
                XMLFileIO.Instance.StoreXML(model.form.ModuleID, tempXMLPath, model.form.Name + &quot;.xml&quot;, XMLType.Control,
                    model.form.IsTemplate, db);
                statusMessage += &quot;DB scripts executed on database &quot; + db + &quot; successfully at &quot; +
                                 DateTime.UtcNow.ToString(&quot;HH:mm:ss tt&quot;) + &quot;.\n&quot;;
            }
            catch (Exception ex)
            {
                //Store XML failed. Suppressing the error - Can be a product template or a dashboard
                statusMessage += &quot;Failed to Upload XML Control &quot; + tempXMLPath + &quot;on database &quot; + db + &quot; for xml &quot; +
                                 model.form.Name + &quot;.xml at &quot; + DateTime.UtcNow.ToString(&quot;HH:mm:ss tt&quot;) + &quot;.\n&quot;
                                 + &quot;Details: &quot; + ex.Message + &quot;.\n&quot;
                                 + &quot;Inner Exception: &quot; + ex.InnerException + &quot;.\n&quot;;
            }
        }

        public static void UploadSharedXMLControl(string tempXMLPath, BrixFormModel model, string statusMessage,
            string db)
        {
            try
            {
                XMLFileIO.Instance.StoreXML(model.form.ModuleID, tempXMLPath, model.form.Name + &quot;.xml&quot;,
                    XMLType.SharedControl, model.form.IsTemplate, db);
                statusMessage += &quot;&quot;;
            }
            catch (Exception ex)
            {
                //Store XML failed. Suppressing the error - Can be a product template or a dashboard
                statusMessage += &quot;Failed to Upload XML Control &quot; + tempXMLPath + &quot;on database &quot; + db + &quot; for xml &quot; +
                                 model.form.Name + &quot;.xml at &quot; + DateTime.UtcNow.ToString(&quot;HH:mm:ss tt&quot;) + &quot;.\n&quot;
                                 + &quot;Details: &quot; + ex.Message + &quot;.\n&quot;
                                 + &quot;Inner Exception: &quot; + ex.InnerException + &quot;.\n&quot;;
            }
        }

        public static void UploadXoml(WfDetails wf, string db)
        {
            if (string.IsNullOrEmpty(wf.wftId))
            {
                using (XmlReader reader = XmlReader.Create(wf.filePath))
                {
                    var workflowDef = new WorkflowDefiniton();
                    while (reader.Read())
                    {
                        if (reader.LocalName != &quot;StateMachineTemplate&quot;) continue;
                        wf.wftId = reader.GetAttribute(&quot;TemplateId&quot;);
                        wf.wfName = reader.GetAttribute(&quot;Name&quot;, &quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;);
                        wf.wfDesc = reader.GetAttribute(&quot;Description&quot;);
                        wf.wfModuleId = reader.GetAttribute(&quot;AssociatedFormId&quot;);
                        wf.ispublished = true;
                        wf.workflowDef = workflowDef;
                        if (!string.IsNullOrEmpty(reader.GetAttribute(&quot;LinkedFormXML&quot;))
                            &amp;&amp;
                            !reader.GetAttribute(&quot;LinkedFormXML&quot;)
                                .Equals(&quot;undefined&quot;, StringComparison.CurrentCultureIgnoreCase))
                            wf.workflowDef.LinkedFormXML = reader.GetAttribute(&quot;LinkedFormXML&quot;);
                        if (!string.IsNullOrEmpty(reader.GetAttribute(&quot;ViewPermissions&quot;)))
                            wf.workflowDef.ViewPermissions = reader.GetAttribute(&quot;ViewPermissions&quot;).ToBoolean2();
                        if (!string.IsNullOrEmpty(reader.GetAttribute(&quot;WorkflowJSON&quot;))
                            &amp;&amp; !reader.GetAttribute(&quot;WorkflowJSON&quot;).Equals(&quot;{x:Null}&quot;, StringComparison.CurrentCultureIgnoreCase))
                            wf.workflowDef.WorkflowJSON = reader.GetAttribute(&quot;WorkflowJSON&quot;);
                        break;
                    }
                }
            }
            if (!wf.overwrite &amp;&amp; IsWorkflowAlreadyExist(wf, db))
            {
                throw new Exception(&quot;Upload of Workflow &quot; + wf.wfName + &quot; aborted. Workflow already exists.\n&quot;);
            }
            try
            {
                UploadXOML(wf.wftId, wf.wfName, wf.wfDesc, wf.wfModuleId, wf.filePath, wf.ispublished, wf.workflowDef,
                    db);
            }
            catch (Exception ex)
            {
                throw new Exception(&quot;Upload of Workflow &quot; + wf.wfName + &quot; failed.\n Error Details:&quot; + ex.Message);
            }
        }

        private static bool IsWorkflowAlreadyExist(WfDetails wf, string db)
        {
            //TODO: write code here to check if the workflow already exists in the db
            return false;
        }

        public static void UploadXOML(string wftId, string wfName, string wfDesc, string wfModuleId, string filePath,
            bool ispublished, WorkflowDefiniton workflowDef, string db)
        {
            string[] aPaths = filePath.Split(&#39;\\&#39;);
            string sFile = aPaths.Length &gt; 1 ? aPaths[aPaths.Length - 1] : filePath;

            string fileId = null;
            BinaryStoreManager bsm = new BinaryStoreManager();
            if (!bsm.UploadNewStreamFromFile(out fileId, db, filePath, &quot;&quot;, wftId))
                throw new Exception(string.Format(&quot;Failed to upload workflow.(wftId: {0}, file: {1})&quot;, wftId, filePath));
            sFile = &quot;&quot;;

            int? userid = UserDetail.GetCurrentUserDetail()?.UID ?? 1;

            workflowDef.Name = wfName;
            workflowDef.Description = wfDesc;
            workflowDef.AssociatedForm = wfModuleId;
            workflowDef.IsValidation = true;
            workflowDef.ParentInstanceID = 0;
            workflowDef.ParentModule = &quot;&quot;;
            workflowDef.IsPublished = ispublished;
            workflowDef.CreatedOn = DateTime.UtcNow;
            workflowDef.CreatedBy = userid;
            workflowDef.LastModifiedOn = DateTime.UtcNow;
            workflowDef.LastModifiedBy = userid;
            workflowDef.DefinitionFilePath = sFile;
            workflowDef.TriggerEvent = &quot;create&quot;;
            workflowDef.WorkflowGUID = wftId;
            workflowDef.FileId = fileId;

            IProviderManager _WfProviderMgr = AppProviderManager.Instance;
            string _CompanyId = ConnectionHelper.GetCurrentCompany();
            IProvider _Provider = _WfProviderMgr.GetProvider(&quot;BRIXProvider&quot;, _CompanyId);
            ITemplateWFManager _TemplatesMgr = ((BrixCoreDataProvider)_Provider).GetTemplateWFManager();

            workflowDef.MetadataJSON = _TemplatesMgr.SerializeWorkflowToJson(wftId, fileId: fileId);

            ComponentHelper.Instance.ExecuteNonQueryOn(ConnectionHelper.GetConnectionString(db),
                WFStoredProcedure.usp_WORKFLWCUWorkflowDefinitions,
                null, workflowDef);
        }

        public void UploadContextMenu(string sContextMenuFilePath, ref List&lt;BrixContextMenu&gt; cMenuDetails,
            ref List&lt;ModuleUploadResult&gt; status, string db)
        {
            status.Clear();

            if (cMenuDetails == null || cMenuDetails.Count &lt; 1)
            {
                try
                {
                    var xCMenuDoc = new XmlDocument();
                    xCMenuDoc.Load(sContextMenuFilePath);
                    cMenuDetails =
                        ContextMenuManager.Instance.GetContextMenuDetailsFromXml(xCMenuDoc.FirstChild.ParentNode,
                            ref status);
                }
                catch (Exception ex)
                {
                    status.Add(new ModuleUploadResult(&quot;Invalid Report XML file.\n&quot;, ModuleUploadResultType.Error, ex));
                }
            }
            try
            {
                ContextMenuManager.Instance.UploadXMLContextMenus(cMenuDetails, ref status, db);
            }
            catch (Exception ex)
            {
                status.Add(
                    new ModuleUploadResult(
                        &quot;Context menu details upload failed for &quot; + sContextMenuFilePath + &quot;.\n Error Details: &quot; +
                        ex.Message, ModuleUploadResultType.Error, ex));
            }
            if (status.Count == 0)
            {
                status.Add(
                    new ModuleUploadResult(&quot;Context menu details uploaded successfully at &quot; +
                                           DateTime.UtcNow.ToString(&quot;HH:mm:ss tt&quot;) + &quot;.\n&quot;));
                File.SetLastWriteTime(RootPath + &quot;Web.config&quot;, DateTime.UtcNow);
            }
        }

        public static bool AddApplication(AppDetails details, string company)
        {
            // Create entry in the MODMGMTPlatforms Table
            int rtnCode;
            rtnCode = ModuleManagementComponent.Instance.AddPlatform(details.platform, company);
            switch (rtnCode)
            {
                case 2: //parent module not found
                    return false;
                case 0: //already deployed
                case 1: // success
                case 3: //same version
                default: //Platform ID returned
                    break;
            }

            ///chk for features
            ///Default feature = Common.Constants.MODMGMT_DEFAULTFEATURE
            details.module.Features.Add(Constants.MODFEAT_VISIBILITY, Constants.MODFEAT_VISIBILITY);
            if (details.node.SelectNodes(&quot;features&quot;).Count &gt; 0)
            {
                foreach (XmlNode xNode in details.node.SelectNodes(&quot;features&quot;)[0].ChildNodes)
                {
                    string featureName = xNode.Attributes[&quot;name&quot;].InnerText;
                    if (featureName.ToLower2() != Constants.MODFEAT_VISIBILITY.ToLower2())
                        details.module.Features.Add(featureName, xNode.InnerText);
                }
            }

            //Add Application Types
            if (details.node.SelectNodes(&quot;appTypes&quot;).Count &gt; 0)
            {
                var appTypes = new Dictionary&lt;string, string&gt;();
                foreach (XmlNode xNode in details.node.SelectNodes(&quot;appTypes&quot;)[0].ChildNodes)
                    appTypes.Add(xNode.Attributes[&quot;key&quot;].InnerText, xNode.Attributes[&quot;value&quot;].InnerText);

                ModuleManagementComponent.Instance.AddApplicationTypes(appTypes, company);
            }

            //Add Applications
            if (details.node.SelectNodes(&quot;applications/application&quot;).Count &gt; 0)
            {
                foreach (XmlNode node in details.node.SelectNodes(&quot;applications/application&quot;))
                {
                    String[] types = node.Attributes[&quot;appType&quot;].Value.Split(&#39;|&#39;);
                    foreach (string type in types)
                    {
                        var app = new ApplicationDetails();
                        app.ApplicationName = node.Attributes[&quot;name&quot;].Value;
                        app.FullName = node.Attributes[&quot;fullname&quot;].Value;
                        app.Version = node.Attributes[&quot;version&quot;].Value;
                        app.ApplicationType = type;
                        app.Folder = node.Attributes[&quot;folder&quot;].Value;
                        app.Path = &quot;{0}\\{1}\\{2}&quot;.Format2(details.webpath, app.Folder, app.Version);

                        var links =
                            new List&lt;KeyValuePair&lt;string, KeyValuePair&lt;string, string&gt;&gt;&gt;();
                        for (int i = 0; i &lt; node.ChildNodes.Count; i++)
                        {
                            string key = node.ChildNodes[i].Attributes[&quot;key&quot;].Value.ToString2();
                            if (key.ToLower2().Equals(&quot;description&quot;))
                            {
                                app.Description = node.ChildNodes[i].InnerText;
                            }
                            else
                            {
                                var kvp =
                                    new KeyValuePair&lt;string, string&gt;(node.ChildNodes[i].Attributes[&quot;value&quot;].Value,
                                        node.ChildNodes[i].InnerText);
                                var parentKVP =
                                    new KeyValuePair&lt;string, KeyValuePair&lt;string, string&gt;&gt;(key, kvp);
                                links.Add(parentKVP);
                            }
                        }
                        app.Links = links;

                        ModuleManagementComponent.Instance.AddApplication(app, company);
                    }
                }
            }
            return true;
        }

        public static bool AddModuleEntry(List&lt;ModuleUploadResult&gt; status, AppDetails app, string company,
            bool? isSSRSconfigured)
        {
            if (status.Count == 0 ||
                !(status.Count &gt; 0 &amp;&amp; status.Exists(s =&gt; s.ResultType == ModuleUploadResultType.Error)))
            {
                AddModule(status, app.module, company);
            }
            else if (status.Count &gt; 0 &amp;&amp;
                     status.Exists(
                         s =&gt; s.ResultType == ModuleUploadResultType.Error &amp;&amp; s.Message.StartsWith(&quot;Read-only file.&quot;)))
            {
                status.Add(
                    new ModuleUploadResult(
                        string.Format(
                            &quot;Module &#39;{0}&#39; upload failed. The error is caused if one or more files have the read-only attribute set. Remove read-only attribute and upload the module &#39;{0}&#39; again.\n&quot;,
                            app.module.Name), ModuleUploadResultType.Error));
                return false;
            }

            if (app.node.SelectNodes(&quot;features&quot;).Count &gt; 0)
            {
                ModuleManagementComponent.Instance.UpdatePermissionMatrix(app.module.ModuleID, null,
                    Constants.USRMGMT_ADMIN_RID, true, null, company);
            }
            return true;
        }

        public string StatusMessage()
        {
            string status = &quot;&quot;;
            foreach (DBScript uploadStatus in lst)
            {
                status += &quot;\n&quot; + uploadStatus.resultMessage;
            }
            return status;
        }

        public TaskStatus GetStatus()
        {
            foreach (DBScript stat in lst)
            {
                if (stat.status == TaskStatus.Aborted || stat.status == TaskStatus.Cancelling ||
                    stat.status == TaskStatus.InProgress) return stat.status;
            }
            return TaskStatus.Done;
        }

        public void Cancel()
        {
            IsCancelling = true;
        }

        public void ClearTaskListIfDone()
        {
            foreach (DBScript stat in lst)
            {
                if (!stat.IsDone) return;
            }
            lst.Clear();
        }
    }

    public enum TaskStatus
    {
        NotStarted = 0,
        InProgress = 1,
        Cancelling = 2,
        Done = 3,
        Cancelled = 4,
        Aborted = 5
    }

    public class DBJob
    {
        public string Name { get; set; }
        public object Content { get; set; }
        public object sync = new object();
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[58,9,58,38,1],[59,9,59,10,1],[60,13,60,54,1],[61,9,61,10,1],[64,9,64,10,0],[65,13,66,97,0],[67,9,67,10,0],[70,9,70,10,1],[71,13,71,101,1],[72,9,72,10,1],[75,9,75,10,1],[76,13,76,34,1],[77,13,77,26,1],[77,27,77,51,0],[78,13,78,34,1],[78,35,78,72,1],[79,18,79,35,0],[80,13,80,41,1],[81,13,81,39,1],[81,40,81,87,1],[82,18,82,40,0],[83,13,83,33,1],[83,34,83,62,1],[84,18,84,34,0],[85,13,85,35,1],[85,36,85,77,1],[86,18,86,36,0],[87,13,87,36,1],[87,37,87,74,1],[88,18,88,37,0],[89,13,89,56,1],[90,13,90,54,1],[91,13,91,39,1],[94,13,94,41,1],[94,42,94,66,0],[95,18,95,71,1],[97,13,97,70,1],[98,13,98,52,1],[99,13,99,14,0],[100,17,100,24,0],[100,26,100,35,0],[100,36,100,38,0],[100,39,100,50,0],[101,21,110,28,0],[111,13,111,14,0],[113,13,113,14,1],[114,17,114,63,1],[114,63,114,74,1],[114,74,114,76,1],[114,17,114,76,1],[115,17,124,24,1],[125,13,125,14,1],[127,13,127,34,1],[127,35,127,63,1],[128,18,128,35,0],[129,13,129,20,1],[129,22,129,33,1],[129,34,129,36,1],[129,37,129,59,1],[130,13,130,14,1],[131,17,131,30,1],[131,31,131,40,0],[132,17,132,57,1],[133,13,133,14,1],[135,13,135,29,1],[136,9,136,10,1],[139,9,139,10,1],[140,13,140,34,1],[140,35,140,72,0],[141,13,141,61,1],[141,61,141,81,0],[141,81,141,83,1],[141,13,141,83,1],[142,13,142,28,1],[143,17,143,90,1],[145,17,145,38,0],[146,13,146,26,1],[147,9,147,10,1],[150,9,150,10,1],[151,13,151,46,1],[152,17,152,114,0],[153,20,153,72,1],[154,13,154,14,1],[155,17,155,75,1],[156,13,156,14,1],[157,13,157,26,1],[158,9,158,10,1],[161,9,161,10,1],[162,13,162,101,1],[163,9,163,10,1],[166,9,166,10,0],[167,13,167,106,0],[168,9,168,10,0],[171,9,171,10,1],[172,13,172,105,1],[173,9,173,10,1],[177,9,177,10,0],[178,13,178,112,0],[179,13,192,16,0],[193,9,193,10,0],[197,9,197,10,0],[198,13,198,112,0],[199,13,204,16,0],[205,9,205,10,0],[208,9,208,10,1],[209,13,214,16,1],[215,9,215,10,1],[218,9,218,10,1],[219,13,219,101,1],[220,9,220,10,1],[223,9,223,10,1],[224,13,229,16,1],[230,9,230,10,1],[233,9,233,10,0],[234,13,239,16,0],[240,9,240,10,0],[243,9,243,10,0],[244,13,249,16,0],[251,13,252,67,0],[253,9,253,10,0],[256,9,256,10,0],[257,13,262,16,0],[263,9,263,10,0],[266,9,266,10,1],[267,13,267,82,1],[268,13,268,101,1],[269,9,269,10,1],[272,9,272,10,1],[273,13,273,106,1],[274,9,274,10,1],[277,9,277,10,0],[278,13,278,65,0],[279,13,279,103,0],[280,9,280,10,0],[283,9,283,10,1],[284,13,284,105,1],[285,9,285,10,1],[288,9,288,10,0],[289,13,289,113,0],[290,9,290,10,0],[297,9,297,10,1],[298,13,298,99,1],[299,9,299,10,1],[303,9,303,10,1],[304,13,304,64,1],[305,13,305,48,1],[306,13,306,50,1],[307,9,307,10,1],[310,9,310,10,1],[311,13,311,93,1],[312,13,312,32,1],[313,9,313,10,1],[316,9,316,10,0],[317,13,317,120,0],[318,13,318,33,0],[319,9,319,10,0],[322,9,322,10,1],[323,13,323,47,1],[323,48,323,61,0],[324,13,324,53,1],[324,54,324,89,1],[325,13,325,25,1],[326,9,326,10,1],[329,9,329,10,1],[330,13,335,16,1],[336,9,336,10,1],[339,9,339,10,1],[340,13,340,98,1],[340,99,340,106,0],[342,13,342,51,1],[343,13,345,52,1],[346,13,346,20,1],[346,22,346,33,1],[346,34,346,36,1],[346,37,346,59,1],[347,13,347,14,1],[348,17,348,29,1],[349,17,349,18,1],[350,21,352,60,1],[353,21,353,43,1],[354,21,354,30,1],[357,17,357,64,0],[358,17,358,68,0],[359,17,359,54,0],[360,17,360,58,0],[361,17,361,44,0],[362,17,362,18,0],[363,21,363,50,0],[364,21,364,51,0],[365,17,365,18,0],[367,17,367,85,0],[368,17,370,123,0],[371,17,371,51,0],[372,17,374,124,0],[377,17,377,18,0],[378,21,378,59,0],[379,17,379,18,0],[380,17,380,34,0],[381,17,381,18,0],[382,17,382,18,0],[383,13,383,14,0],[384,9,384,10,1],[387,9,387,10,1],[388,13,388,39,1],[389,13,389,14,1],[391,17,391,18,1],[392,21,392,67,1],[393,21,393,60,1],[394,21,394,22,0],[395,25,395,73,0],[396,25,396,32,0],[396,34,396,46,0],[396,47,396,49,0],[396,50,396,92,0],[397,29,397,77,0],[398,25,398,51,0],[399,29,399,106,0],[400,21,400,22,0],[401,21,401,47,1],[402,17,402,18,1],[403,17,403,46,0],[404,17,404,18,0],[405,21,405,34,0],[406,21,406,45,0],[407,21,407,28,0],[407,30,407,42,0],[407,43,407,45,0],[407,46,407,64,0],[407,66,407,114,0],[408,21,408,47,0],[409,25,409,102,0],[410,17,410,18,0],[411,13,411,14,1],[412,13,412,30,1],[413,13,413,20,1],[413,22,413,42,1],[413,43,413,45,1],[413,46,413,55,1],[414,13,414,14,1],[415,17,415,72,1],[416,13,416,14,1],[417,13,417,20,1],[417,22,417,37,0],[417,38,417,40,1],[417,41,417,51,1],[418,13,418,14,0],[420,17,420,18,0],[421,21,421,80,0],[422,25,424,60,0],[425,21,425,81,0],[426,17,426,18,0],[427,17,427,37,0],[428,17,428,18,0],[429,21,433,24,0],[434,17,434,18,0],[435,13,435,14,0],[436,13,436,29,1],[437,13,437,31,1],[438,13,438,32,1],[439,13,439,30,1],[440,13,440,20,1],[440,22,440,33,1],[440,34,440,36,1],[440,37,440,55,1],[442,17,442,18,1],[443,21,443,45,1],[444,21,444,22,1],[445,25,445,52,1],[445,53,445,82,1],[446,25,446,34,1],[448,21,448,43,0],[448,44,448,62,0],[449,17,449,18,0],[450,17,450,34,0],[451,17,451,18,0],[452,21,452,47,0],[453,25,454,60,0],[455,17,455,18,0],[456,13,456,35,1],[458,13,458,39,1],[459,13,459,14,1],[460,17,460,120,1],[461,13,461,14,1],[462,13,462,45,1],[463,9,463,10,1],[466,9,466,10,0],[467,13,467,79,0],[468,13,468,41,0],[468,42,468,57,0],[469,13,469,65,0],[470,13,470,20,0],[470,22,470,35,0],[470,36,470,38,0],[470,39,470,61,0],[471,13,471,14,0],[472,17,472,58,0],[473,17,476,64,0],[477,17,477,57,0],[478,17,478,18,0],[479,21,479,56,0],[480,21,480,30,0],[482,17,482,102,0],[483,13,483,14,0],[484,13,484,20,0],[484,22,484,30,0],[484,31,484,33,0],[484,34,484,53,0],[485,13,485,14,0],[486,17,486,86,0],[487,13,487,14,0],[488,13,488,46,0],[489,13,489,28,0],[490,9,490,10,0],[493,9,493,10,0],[494,13,494,20,0],[494,22,494,35,0],[494,36,494,38,0],[494,39,494,61,0],[495,13,495,14,0],[496,17,496,31,0],[497,13,497,14,0],[498,9,498,10,0],[501,9,501,10,0],[502,13,502,59,0],[503,13,504,61,0],[505,13,505,30,0],[506,9,506,10,0],[509,9,509,10,1],[511,13,511,14,1],[512,17,512,66,1],[512,67,512,74,0],[514,17,514,56,1],[515,21,515,64,0],[518,17,518,24,1],[518,26,518,46,1],[518,47,518,49,1],[518,50,518,63,1],[519,17,519,18,1],[520,21,522,69,1],[523,25,523,34,0],[525,21,525,87,1],[527,21,527,22,1],[528,25,528,84,1],[529,29,530,64,1],[531,25,531,73,1],[532,25,532,44,1],[533,29,533,106,1],[534,21,534,22,1],[535,21,535,59,0],[536,21,536,22,0],[537,25,537,44,0],[538,25,538,26,0],[539,29,539,68,0],[540,33,540,110,0],[542,33,543,68,0],[544,25,544,26,0],[545,21,545,22,0],[546,17,546,18,1],[549,17,549,24,1],[549,26,549,50,1],[549,51,549,53,1],[549,54,549,73,1],[550,17,550,18,1],[551,21,551,85,1],[552,21,552,67,1],[553,17,553,18,1],[554,13,554,14,1],[555,13,555,33,0],[556,13,556,14,0],[557,17,558,56,0],[559,17,560,52,0],[561,13,561,14,0],[562,9,562,10,1],[567,30,567,34,1],[567,35,567,39,1],[574,30,574,34,0],[574,35,574,39,0],[584,31,584,35,0],[584,36,584,40,0],[585,32,585,36,0],[585,37,585,41,0],[586,32,586,36,0],[586,37,586,41,0],[587,36,587,40,0],[587,41,587,45,0],[588,34,588,38,0],[588,39,588,43,0],[589,35,589,39,0],[589,40,589,44,0],[590,33,590,37,0],[590,38,590,42,0],[591,48,591,52,0],[591,53,591,57,0],[596,34,596,38,1],[596,39,596,43,1],[597,49,597,53,1],[597,54,597,58,1],[602,33,602,37,1],[602,38,602,42,1],[603,38,603,42,1],[603,43,603,47,1],[615,13,615,14,0],[616,17,617,53,0],[618,13,618,14,0],[672,9,672,26,1],[673,9,673,10,1],[674,13,674,40,1],[675,13,675,45,1],[676,9,676,10,1],[679,9,679,10,1],[680,13,680,26,1],[681,13,682,13,1],[682,13,682,14,1],[682,14,683,17,1],[683,17,683,59,1],[683,59,684,17,1],[684,17,684,64,1],[684,64,685,17,1],[685,17,685,65,1],[685,65,686,17,1],[686,17,686,51,1],[686,51,687,17,1],[687,17,687,55,1],[687,55,688,17,1],[688,17,688,41,1],[688,41,689,17,1],[689,17,689,18,1],[689,18,690,21,1],[690,21,690,47,1],[690,47,691,21,1],[691,21,691,48,1],[691,48,692,17,1],[692,17,692,18,1],[692,18,694,17,1],[694,17,694,85,1],[694,85,695,17,1],[695,17,695,112,1],[695,112,696,17,1],[696,17,696,57,1],[696,57,697,17,1],[697,17,700,60,1],[700,60,701,17,1],[701,17,701,32,1],[701,32,703,17,1],[703,17,707,60,1],[707,60,708,17,1],[708,17,708,49,1],[708,49,709,17,1],[709,17,713,60,1],[713,60,717,17,1],[717,17,717,18,1],[717,18,718,21,1],[718,21,718,59,1],[718,59,719,17,1],[719,17,719,18,1],[719,18,720,17,1],[720,17,720,34,0],[720,34,721,17,1],[721,17,721,18,0],[721,18,722,17,1],[722,17,722,18,0],[722,18,723,13,1],[723,13,723,14,1],[723,14,723,40,1],[681,13,723,40,1],[724,13,724,34,1],[725,9,725,10,1],[728,9,728,10,1],[729,13,729,24,1],[730,9,730,10,1],[733,9,733,10,1],[734,13,734,37,1],[735,13,735,43,1],[736,13,736,73,1],[737,13,737,65,1],[739,13,739,14,1],[740,17,740,67,1],[741,17,741,52,1],[742,17,742,18,0],[743,21,746,59,0],[747,21,747,28,0],[750,17,750,91,1],[751,17,751,34,1],[751,35,751,42,0],[752,17,752,86,1],[755,17,755,29,1],[760,17,760,70,1],[760,70,760,140,1],[760,140,760,142,1],[760,17,760,142,1],[762,17,762,24,1],[762,26,762,34,1],[762,35,762,37,1],[762,38,762,52,1],[763,17,763,18,1],[764,21,764,106,1],[765,25,765,62,0],[766,17,766,18,1],[769,17,771,31,1],[771,31,772,104,1],[772,104,772,106,1],[769,17,772,106,1],[775,17,775,24,1],[775,26,775,34,1],[775,35,775,37,1],[775,38,775,42,1],[776,17,776,18,1],[777,21,777,106,1],[778,25,778,62,0],[779,17,779,18,1],[782,17,782,24,1],[782,26,782,42,1],[782,43,782,45,1],[782,46,782,53,1],[783,17,783,18,1],[784,21,784,44,1],[786,21,786,22,1],[787,25,787,71,1],[787,72,787,79,0],[789,25,790,86,1],[791,25,791,120,1],[792,25,792,41,1],[794,25,794,43,1],[795,25,795,84,1],[796,25,796,43,1],[797,25,797,42,1],[798,25,798,46,1],[799,25,799,58,1],[800,25,800,82,1],[801,25,802,67,1],[804,25,804,92,1],[806,25,807,111,1],[809,25,809,74,1],[810,29,816,64,1],[818,25,818,43,1],[819,25,819,58,1],[820,25,820,82,1],[822,25,822,52,1],[823,25,823,57,1],[824,25,825,67,1],[826,21,826,22,1],[827,21,827,41,0],[828,21,828,22,0],[829,25,831,121,0],[833,25,833,43,0],[834,25,834,78,0],[835,25,835,43,0],[836,25,836,42,0],[837,25,837,46,0],[838,25,838,58,0],[839,25,839,82,0],[841,25,841,113,0],[842,25,842,52,0],[843,25,843,60,0],[844,21,844,22,0],[845,17,845,18,1],[846,17,847,90,1],[850,17,850,47,1],[852,17,852,18,1],[853,21,854,110,1],[855,21,855,61,1],[856,21,856,45,1],[857,17,857,18,1],[858,17,858,34,0],[859,17,859,18,0],[860,21,860,46,0],[861,17,861,18,0],[865,17,865,24,1],[865,26,865,34,1],[865,35,865,37,1],[865,38,865,47,1],[866,17,866,18,1],[868,21,870,96,1],[871,25,871,34,1],[873,21,873,117,1],[874,25,874,62,0],[876,21,876,100,1],[877,25,877,50,1],[878,17,878,18,1],[879,17,880,93,1],[881,17,883,63,1],[884,17,884,35,1],[885,17,885,34,1],[886,17,886,38,1],[887,17,887,50,1],[888,17,888,74,1],[889,17,890,90,1],[891,13,891,14,1],[892,13,892,33,0],[893,13,893,14,0],[894,17,894,100,0],[895,17,895,76,0],[896,17,896,35,0],[897,17,897,34,0],[898,17,898,38,0],[899,17,899,50,0],[900,17,900,74,0],[901,17,902,90,0],[903,13,903,14,0],[904,9,904,10,1],[908,9,908,10,1],[909,13,909,65,1],[910,13,910,32,1],[912,13,912,14,1],[913,17,913,53,1],[914,17,914,46,1],[915,17,915,34,1],[918,25,918,102,1],[919,25,919,31,1],[921,25,921,39,0],[922,25,922,26,0],[923,29,923,76,0],[924,25,924,26,0],[925,25,925,31,0],[927,25,927,73,0],[928,25,928,31,0],[930,25,930,102,0],[931,25,931,31,0],[933,25,933,74,1],[934,25,934,31,1],[936,25,936,68,1],[937,25,937,74,1],[938,25,938,31,1],[940,25,940,39,1],[941,25,941,26,1],[942,29,942,97,1],[943,25,943,26,1],[944,25,944,31,1],[946,25,946,39,1],[947,25,947,26,1],[948,29,948,65,1],[949,29,949,99,1],[950,25,950,26,1],[951,25,951,31,1],[953,25,953,39,0],[954,25,954,26,0],[955,29,955,65,0],[956,29,956,101,0],[957,25,957,26,0],[958,25,958,31,0],[960,25,960,39,0],[961,25,961,26,0],[962,29,962,65,0],[963,29,963,107,0],[964,25,964,26,0],[965,25,965,31,0],[967,25,967,39,0],[968,25,968,26,0],[969,29,969,72,0],[970,25,970,26,0],[971,25,971,31,0],[973,25,973,39,1],[974,25,974,26,1],[975,29,975,69,1],[976,29,976,103,1],[977,25,977,26,1],[978,25,978,31,1],[980,25,980,39,1],[981,25,981,26,1],[982,29,982,103,1],[983,25,983,26,1],[984,25,984,31,1],[986,25,986,39,0],[987,25,987,26,0],[988,29,988,69,0],[989,29,989,98,0],[990,25,990,26,0],[991,25,991,31,0],[993,25,993,39,1],[994,25,994,26,1],[995,29,995,104,1],[996,29,996,70,1],[997,29,997,72,1],[998,29,998,77,1],[999,29,999,92,1],[1000,25,1000,26,1],[1001,25,1001,31,1],[1003,25,1003,39,1],[1004,25,1004,26,1],[1005,29,1005,77,1],[1006,29,1006,104,1],[1007,29,1007,70,1],[1008,29,1008,72,1],[1009,29,1009,86,1],[1010,25,1010,26,1],[1011,25,1011,31,1],[1013,25,1013,26,1],[1014,29,1014,65,1],[1015,29,1015,122,1],[1016,29,1016,86,1],[1017,29,1017,35,1],[1020,25,1020,39,0],[1021,25,1021,26,0],[1022,29,1022,104,0],[1023,29,1023,70,0],[1024,29,1024,72,0],[1025,29,1025,77,0],[1026,29,1026,103,0],[1027,25,1027,26,0],[1028,25,1028,31,0],[1030,25,1030,80,0],[1032,13,1032,14,1],[1033,13,1033,33,0],[1034,13,1034,14,0],[1035,17,1036,42,0],[1037,17,1037,102,0],[1038,17,1038,70,0],[1039,17,1039,35,0],[1040,17,1040,34,0],[1041,17,1041,38,0],[1042,17,1042,50,0],[1043,17,1043,74,0],[1044,17,1045,90,0],[1046,17,1046,30,0],[1048,13,1048,46,1],[1048,47,1048,59,1],[1049,13,1049,95,1],[1050,13,1050,25,1],[1051,9,1051,10,1],[1055,9,1055,10,1],[1056,20,1056,202,1],[1057,13,1057,14,1],[1058,17,1058,153,1],[1059,17,1059,50,1],[1060,17,1060,18,1],[1061,21,1061,155,1],[1062,21,1062,40,1],[1062,41,1062,65,1],[1063,17,1063,18,1],[1064,13,1064,14,1],[1065,9,1065,10,1],[1069,9,1069,10,0],[1070,20,1070,202,0],[1071,13,1071,14,0],[1072,17,1072,164,0],[1073,17,1073,50,0],[1074,17,1074,18,0],[1075,21,1075,155,0],[1076,21,1076,40,0],[1076,41,1076,65,0],[1077,17,1077,18,0],[1078,13,1078,14,0],[1079,9,1079,10,0],[1083,9,1083,10,0],[1084,13,1087,49,0],[1088,13,1088,59,0],[1089,13,1089,77,0],[1090,13,1090,66,0],[1091,13,1091,54,0],[1092,13,1092,56,0],[1093,13,1093,43,0],[1094,13,1094,54,0],[1097,13,1097,38,0],[1099,13,1099,42,0],[1100,13,1100,55,0],[1101,13,1101,58,0],[1102,13,1102,42,0],[1103,13,1103,89,0],[1104,13,1104,30,0],[1105,9,1105,10,0],[1111,9,1111,10,1],[1112,20,1112,202,1],[1113,13,1113,14,1],[1114,17,1114,147,1],[1115,17,1115,50,1],[1116,17,1116,18,1],[1117,21,1117,155,1],[1118,21,1118,40,1],[1118,41,1118,65,1],[1119,17,1119,18,1],[1120,13,1120,14,1],[1121,9,1121,10,1],[1124,9,1124,10,1],[1125,13,1129,107,1],[1131,13,1132,24,1],[1134,13,1134,72,1],[1135,13,1135,53,1],[1136,13,1136,38,1],[1137,13,1139,59,1],[1140,13,1140,38,1],[1141,13,1141,37,1],[1142,13,1142,41,1],[1143,13,1143,77,1],[1145,13,1145,63,1],[1146,13,1146,37,1],[1147,13,1147,46,1],[1148,13,1148,30,1],[1149,13,1149,25,1],[1150,13,1150,69,1],[1151,9,1151,10,1],[1154,9,1154,10,0],[1155,13,1155,75,0],[1156,9,1156,10,0],[1160,9,1160,10,0],[1161,13,1162,115,0],[1163,13,1164,128,0],[1165,13,1165,40,0],[1166,13,1166,14,0],[1167,17,1167,70,0],[1168,17,1168,18,0],[1169,21,1170,56,0],[1171,21,1171,34,0],[1173,17,1173,29,0],[1176,13,1176,71,0],[1176,72,1176,84,0],[1177,13,1178,48,0],[1179,13,1179,26,0],[1180,9,1180,10,0],[1183,9,1183,10,1],[1184,13,1184,62,1],[1185,13,1185,68,1],[1186,9,1186,10,1],[1189,9,1189,10,0],[1190,13,1190,40,0],[1190,41,1190,50,0],[1192,13,1192,45,0],[1193,13,1193,46,0],[1194,18,1194,29,0],[1194,31,1194,67,0],[1194,69,1194,74,0],[1195,13,1195,14,0],[1196,17,1196,63,0],[1196,64,1196,73,0],[1197,17,1197,63,0],[1197,64,1197,74,0],[1198,13,1198,14,0],[1199,13,1199,22,0],[1200,9,1200,10,0],[1205,9,1205,10,0],[1206,13,1206,42,0],[1206,43,1206,55,0],[1208,13,1208,14,0],[1209,17,1209,102,0],[1210,17,1211,138,0],[1212,17,1212,24,0],[1212,26,1212,36,0],[1212,37,1212,39,0],[1212,40,1212,56,0],[1213,17,1213,18,0],[1214,21,1214,59,0],[1215,21,1215,22,0],[1216,25,1217,60,0],[1218,25,1218,38,0],[1221,21,1221,79,0],[1222,21,1222,90,0],[1223,21,1223,22,0],[1224,25,1225,97,0],[1226,25,1226,38,0],[1228,17,1228,18,0],[1229,13,1229,14,0],[1230,13,1230,33,0],[1231,13,1231,14,0],[1232,17,1233,56,0],[1234,17,1234,30,0],[1236,13,1236,25,0],[1237,9,1237,10,0],[1240,9,1240,10,1],[1241,13,1241,102,1],[1242,13,1242,82,1],[1243,9,1243,10,1],[1247,9,1247,10,1],[1248,13,1248,85,1],[1249,13,1249,14,0],[1250,17,1253,56,0],[1254,17,1254,30,0],[1256,13,1256,25,1],[1257,9,1257,10,1],[1261,9,1261,10,1],[1262,13,1262,66,1],[1263,13,1263,14,1],[1265,17,1265,18,1],[1266,21,1266,66,1],[1267,21,1267,117,1],[1268,17,1268,18,1],[1269,17,1269,37,0],[1270,17,1270,18,0],[1271,21,1274,64,0],[1275,17,1275,18,0],[1276,13,1276,14,1],[1278,13,1278,66,1],[1279,13,1279,14,1],[1280,17,1280,62,1],[1281,17,1281,109,1],[1282,17,1282,39,1],[1283,17,1283,18,1],[1284,21,1284,46,1],[1285,17,1285,18,1],[1286,13,1286,14,1],[1287,9,1287,10,1],[1291,9,1291,10,1],[1293,13,1293,14,1],[1294,17,1294,48,1],[1295,17,1295,18,0],[1296,21,1296,131,0],[1297,21,1297,61,0],[1298,21,1298,45,0],[1299,17,1299,18,0],[1300,13,1300,14,1],[1301,13,1301,30,0],[1302,13,1302,14,0],[1303,17,1303,42,0],[1304,13,1304,14,0],[1305,13,1305,74,1],[1306,13,1306,69,1],[1307,13,1307,14,1],[1308,17,1308,116,1],[1309,17,1311,124,1],[1312,13,1312,14,1],[1314,13,1314,14,0],[1315,17,1317,119,0],[1318,13,1318,14,0],[1319,13,1319,37,1],[1320,9,1320,10,1],[1323,9,1323,10,1],[1324,13,1324,84,1],[1325,9,1325,10,1],[1329,9,1329,10,1],[1330,13,1330,114,1],[1331,9,1331,10,1],[1334,9,1334,10,1],[1339,13,1339,14,1],[1340,17,1340,49,1],[1341,17,1341,18,1],[1342,21,1343,47,1],[1346,21,1347,53,1],[1349,21,1350,55,1],[1352,21,1352,68,1],[1353,21,1353,22,0],[1355,25,1356,59,0],[1358,25,1359,61,0],[1360,21,1360,22,0],[1361,17,1361,18,1],[1362,17,1362,45,1],[1363,17,1363,18,1],[1365,21,1365,111,1],[1366,21,1366,22,1],[1367,25,1367,144,1],[1368,25,1368,150,1],[1369,21,1369,22,1],[1370,21,1372,23,1],[1372,23,1372,24,1],[1372,24,1373,27,1],[1373,27,1373,129,1],[1373,129,1374,27,1],[1374,27,1374,28,1],[1374,28,1375,31,1],[1375,31,1375,125,1],[1375,125,1376,31,1],[1376,31,1376,32,1],[1376,32,1377,35,1],[1377,35,1377,198,1],[1377,198,1378,35,1],[1378,35,1378,200,1],[1378,200,1379,31,1],[1379,31,1379,32,1],[1379,32,1380,27,1],[1380,27,1380,28,1],[1380,28,1381,23,1],[1381,23,1381,24,1],[1381,24,1382,22,1],[1370,21,1382,22,1],[1383,17,1383,18,1],[1384,17,1386,82,1],[1389,17,1390,59,1],[1391,17,1391,39,1],[1392,17,1392,18,1],[1393,21,1393,90,1],[1394,17,1394,18,1],[1395,13,1395,14,1],[1396,13,1396,33,0],[1397,13,1397,14,0],[1399,17,1400,91,0],[1401,17,1401,67,0],[1402,17,1402,82,0],[1403,13,1403,14,0],[1404,13,1404,34,1],[1405,9,1405,10,1],[1408,9,1408,10,1],[1410,13,1410,14,1],[1411,17,1411,146,1],[1414,17,1414,94,1],[1416,17,1416,114,1],[1418,13,1418,33,0],[1419,13,1419,14,0],[1421,17,1424,74,0],[1426,9,1426,10,1],[1429,9,1429,10,1],[1431,13,1431,14,1],[1432,17,1432,49,1],[1433,17,1433,18,1],[1434,21,1435,47,1],[1437,21,1441,67,1],[1442,17,1442,18,1],[1443,17,1444,48,1],[1445,17,1446,82,1],[1447,13,1447,14,1],[1448,13,1448,33,0],[1449,13,1449,14,0],[1451,17,1454,84,0],[1455,13,1455,14,0],[1456,9,1456,10,1],[1460,9,1460,10,0],[1462,13,1462,14,0],[1463,17,1464,71,0],[1465,17,1465,37,0],[1466,13,1466,14,0],[1467,13,1467,33,0],[1468,13,1468,14,0],[1470,17,1473,84,0],[1474,13,1474,14,0],[1475,9,1475,10,0],[1478,9,1478,10,0],[1479,13,1479,48,0],[1480,13,1480,14,0],[1481,24,1481,72,0],[1482,17,1482,18,0],[1483,21,1483,63,0],[1484,21,1484,42,0],[1485,21,1485,22,0],[1486,25,1486,72,0],[1486,73,1486,82,0],[1487,25,1487,70,0],[1488,25,1488,113,0],[1489,25,1489,72,0],[1490,25,1490,81,0],[1491,25,1491,47,0],[1492,25,1492,54,0],[1493,25,1496,97,0],[1497,29,1497,97,0],[1498,25,1498,91,0],[1499,29,1499,114,0],[1500,25,1501,131,0],[1502,29,1502,95,0],[1503,25,1503,31,0],[1505,17,1505,18,0],[1506,13,1506,14,0],[1507,13,1507,65,0],[1508,13,1508,14,0],[1509,17,1509,113,0],[1512,13,1512,14,0],[1513,17,1514,25,0],[1515,13,1515,14,0],[1516,13,1516,33,0],[1517,13,1517,14,0],[1518,17,1518,115,0],[1520,9,1520,10,0],[1523,9,1523,10,0],[1525,13,1525,26,0],[1526,9,1526,10,0],[1530,9,1530,10,0],[1531,13,1531,52,0],[1532,13,1532,85,0],[1534,13,1534,34,0],[1535,13,1535,63,0],[1536,13,1536,83,0],[1537,17,1537,122,0],[1538,13,1538,24,0],[1540,13,1540,71,0],[1542,13,1542,39,0],[1543,13,1543,46,0],[1544,13,1544,53,0],[1545,13,1545,45,0],[1546,13,1546,46,0],[1547,13,1547,43,0],[1548,13,1548,51,0],[1549,13,1549,53,0],[1550,13,1550,44,0],[1551,13,1551,58,0],[1552,13,1552,49,0],[1553,13,1553,52,0],[1554,13,1554,49,0],[1555,13,1555,46,0],[1556,13,1556,41,0],[1558,13,1558,75,0],[1559,13,1559,70,0],[1560,13,1560,90,0],[1561,13,1561,105,0],[1563,13,1563,101,0],[1565,13,1567,36,0],[1568,9,1568,10,0],[1572,9,1572,10,0],[1573,13,1573,28,0],[1575,13,1575,64,0],[1576,13,1576,14,0],[1578,17,1578,18,0],[1579,21,1579,55,0],[1580,21,1580,58,0],[1581,21,1583,41,0],[1584,17,1584,18,0],[1585,17,1585,37,0],[1586,17,1586,18,0],[1587,21,1587,120,0],[1588,17,1588,18,0],[1589,13,1589,14,0],[1591,13,1591,14,0],[1592,17,1592,97,0],[1593,13,1593,14,0],[1594,13,1594,33,0],[1595,13,1595,14,0],[1596,17,1599,72,0],[1600,13,1600,14,0],[1601,13,1601,35,0],[1602,13,1602,14,0],[1603,17,1605,94,0],[1606,17,1606,81,0],[1607,13,1607,14,0],[1608,9,1608,10,0],[1611,9,1611,10,0],[1614,13,1614,97,0],[1615,13,1615,29,0],[1618,21,1618,34,0],[1623,21,1623,27,0],[1628,13,1628,101,0],[1629,13,1629,64,0],[1630,13,1630,14,0],[1631,17,1631,24,0],[1631,26,1631,39,0],[1631,40,1631,42,0],[1631,43,1631,93,0],[1632,17,1632,18,0],[1633,21,1633,77,0],[1634,21,1634,91,0],[1635,25,1635,83,0],[1636,17,1636,18,0],[1637,13,1637,14,0],[1640,13,1640,64,0],[1641,13,1641,14,0],[1642,17,1642,65,0],[1643,17,1643,24,0],[1643,26,1643,39,0],[1643,40,1643,42,0],[1643,43,1643,93,0],[1644,21,1644,106,0],[1646,17,1646,91,0],[1647,13,1647,14,0],[1650,13,1650,80,0],[1651,13,1651,14,0],[1652,17,1652,24,0],[1652,26,1652,38,0],[1652,39,1652,41,0],[1652,42,1652,94,0],[1653,17,1653,18,0],[1654,21,1654,82,0],[1655,21,1655,28,0],[1655,30,1655,41,0],[1655,42,1655,44,0],[1655,45,1655,50,0],[1656,21,1656,22,0],[1657,25,1657,60,0],[1658,25,1658,77,0],[1659,25,1659,74,0],[1660,25,1660,72,0],[1661,25,1661,52,0],[1662,25,1662,70,0],[1663,25,1663,102,0],[1665,25,1666,92,0],[1667,30,1667,39,0],[1667,41,1667,66,0],[1667,68,1667,71,0],[1668,25,1668,26,0],[1669,29,1669,97,0],[1670,29,1670,70,0],[1671,29,1671,30,0],[1672,33,1672,80,0],[1673,29,1673,30,0],[1675,29,1675,30,0],[1676,33,1678,71,0],[1679,33,1680,102,0],[1681,33,1681,54,0],[1682,29,1682,30,0],[1683,25,1683,26,0],[1684,25,1684,43,0],[1686,25,1686,89,0],[1687,21,1687,22,0],[1688,17,1688,18,0],[1689,13,1689,14,0],[1690,13,1690,25,0],[1691,9,1691,10,0],[1695,9,1695,10,1],[1696,13,1697,58,1],[1697,58,1697,102,1],[1697,102,1697,105,1],[1696,13,1697,105,1],[1698,13,1698,14,1],[1699,17,1699,56,1],[1700,13,1700,14,1],[1701,18,1703,31,0],[1703,31,1703,118,0],[1703,118,1703,120,0],[1701,18,1703,120,0],[1704,13,1704,14,0],[1705,17,1709,78,0],[1710,17,1710,30,0],[1713,13,1713,60,1],[1714,13,1714,14,0],[1715,17,1716,71,0],[1717,13,1717,14,0],[1718,13,1718,25,1],[1719,9,1719,10,1],[1722,9,1722,10,0],[1723,13,1723,32,0],[1724,13,1724,20,0],[1724,22,1724,43,0],[1724,44,1724,46,0],[1724,47,1724,50,0],[1725,13,1725,14,0],[1726,17,1726,61,0],[1727,13,1727,14,0],[1728,13,1728,27,0],[1729,9,1729,10,0],[1732,9,1732,10,0],[1733,13,1733,20,0],[1733,22,1733,35,0],[1733,36,1733,38,0],[1733,39,1733,42,0],[1734,13,1734,14,0],[1735,17,1736,58,0],[1736,59,1736,78,0],[1737,13,1737,14,0],[1738,13,1738,36,0],[1739,9,1739,10,0],[1742,9,1742,10,0],[1743,13,1743,33,0],[1744,9,1744,10,0],[1747,9,1747,10,0],[1748,13,1748,20,0],[1748,22,1748,35,0],[1748,36,1748,38,0],[1748,39,1748,42,0],[1749,13,1749,14,0],[1750,17,1750,34,0],[1750,35,1750,42,0],[1751,13,1751,14,0],[1752,13,1752,25,0],[1753,9,1753,10,0],[1768,30,1768,34,1],[1768,35,1768,39,1],[1769,33,1769,37,1],[1769,38,1769,42,1],[1770,9,1770,43,1]]);
    </script>
  </body>
</html>