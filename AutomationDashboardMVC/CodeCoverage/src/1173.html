<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Business Layer\BL\Procurement Management\ProcurementPayEstimates.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.Brix.Platform.BusinessLayer.DataAccessHelper;
using Aurigo.Brix.Platform.BusinessLayer.DTO;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.Common.Utility;

namespace Aurigo.Brix.Platform.BusinessLayer.BL
{
    public class ProcurementPayEstimates : SingletonManagerBase&lt;ProcurementPayEstimates&gt;
    {
        private ProcurementPayEstimates()
        {
        }

        public ProcurementPayEstimateDTO CreateUpdatePayEstimates(out Exception ex, out DataSet ds,
            Dictionary&lt;string, object&gt; dicOut, ProcurementPayEstimateDTO dto)
        {
            ex = null;
            ds = null;
            ProcurementPayEstimateDTO dt = null;
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTCUPayEstimates, dicOut, dto.PEID,
                    dto.PENum, dto.POID, dto.FromDate, dto.ToDate, dto.IsFinal, dto.Status, dto.Notes, dto.CreatedOn,
                    dto.CreatedBy, dto.LastModifiedOn, dto.LastModifiedBy, dto.ApprovedOn, dto.ApprovedBy, dto.WorkDone);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new ProcurementPayEstimateDTO();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public ProcurementPEDetailsDTO CreateUpdatePEDetails(out Exception ex, out DataSet ds,
            Dictionary&lt;string, object&gt; dicOut, ProcurementPEDetailsDTO dto)
        {
            ex = null;
            ds = null;
            ProcurementPEDetailsDTO dt = null;
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTCUPEDetails, dicOut,
                    dto.PEDetailsID, dto.PEID, dto.WorkPostingID, dto.WorkItemID, dto.Quantity, dto.BillingRate,
                    dto.Amount);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new ProcurementPEDetailsDTO();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public ProcurementPEAdvanceDTO CreateUpdatePEAdvance(out Exception ex, out DataSet ds,
            Dictionary&lt;string, object&gt; dicOut, ProcurementPEAdvanceDTO dto)
        {
            ex = null;
            ds = null;
            ProcurementPEAdvanceDTO dt = null;
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTCUPEAdvance, dicOut,
                    dto.PEAdvanceID, dto.PEID, dto.AdvanceTypeID, dto.Amount);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new ProcurementPEAdvanceDTO();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public ProcurementPERecoveriesDTO CreateUpdatePEAdvanceRecoveries(out Exception ex, out DataSet ds,
            Dictionary&lt;string, object&gt; dicOut, ProcurementPERecoveriesDTO dto)
        {
            ex = null;
            ds = null;
            ProcurementPERecoveriesDTO dt = null;
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTCUPEAdvanceRecoveries, dicOut,
                    dto.RecoveryID, dto.MasterID, dto.PEAdvanceID, dto.PEID, dto.Amount, dto.DetailsID,
                    dto.WorkPostingID);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new ProcurementPERecoveriesDTO();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public ProcurementPEAdjustmentsDTO CreateUpdateEAdjustments(out Exception ex, out DataSet ds,
            Dictionary&lt;string, object&gt; dicOut, ProcurementPEAdjustmentsDTO dto)
        {
            ex = null;
            ds = null;
            ProcurementPEAdjustmentsDTO dt = null;
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTCUPEAdjustments, dicOut,
                    dto.AdjustmentID, dto.PEID, dto.AdjustmentDescription, dto.AdjustmentNotes, dto.Amount);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new ProcurementPEAdjustmentsDTO();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public ProcurementPEHoldRetentionDTO CreateUpdatePEHoldAndRetention(out Exception ex, out DataSet ds,
            Dictionary&lt;string, object&gt; dicOut, ProcurementPEHoldRetentionDTO dto)
        {
            ex = null;
            ds = null;
            ProcurementPEHoldRetentionDTO dt = null;
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTCUPEHoldAndRetention, dicOut,
                    dto.RetentionID, dto.PEID, dto.BucketType, dto.RetentionType, dto.RetentionPercentage,
                    dto.RetentionAmount, dto.ReleaseType, dto.ReleasePercentage, dto.ReleaseAmount);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new ProcurementPEHoldRetentionDTO();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public void DeletePayEstimateDetails(string PEID)
        {
            ProcurementComponent.Instance.DeletePayEstimateDetails(PEID);
        }

        public ProcurementPayEstimateDTO CreateUpdatePayEstimates(out Exception ex, out DataSet ds,
            Dictionary&lt;string, object&gt; dicOut, object PEID, object PENum, object POID, object FromDate, object ToDate,
            object IsFinal, object Status, object Notes, object CreatedOn, object CreatedBy, object LastModifiedOn,
            object LastModifiedBy, object ApprovedOn, object ApprovedBy, object WorkDone)
        {
            ex = null;
            ds = null;
            ProcurementPayEstimateDTO dt = null;
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTCUPayEstimates, dicOut, PEID,
                    PENum, POID, FromDate, ToDate, IsFinal, Status, Notes, CreatedOn, CreatedBy, LastModifiedOn,
                    LastModifiedBy, ApprovedOn, ApprovedBy, WorkDone);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new ProcurementPayEstimateDTO();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public ProcurementPEAdjustmentsDTO CreateUpdatePEAdjustments(out Exception ex, out DataSet ds,
            Dictionary&lt;string, object&gt; dicOut, object AdjustmentID, object PEID, object AdjustmentDescription,
            object AdjustmentNotes, object Amount)
        {
            ex = null;
            ds = null;
            ProcurementPEAdjustmentsDTO dt = null;
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTCUPEAdjustments, dicOut,
                    AdjustmentID, PEID, AdjustmentDescription, AdjustmentNotes, Amount);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new ProcurementPEAdjustmentsDTO();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public ProcurementPEAdvanceDTO CreateUpdatePEAdvance(out Exception ex, out DataSet ds,
            Dictionary&lt;string, object&gt; dicOut, object AdvanceID, object PEID, object AdvanceType,
            object AdvanceTypeInstanceID, object Amount)
        {
            ex = null;
            ds = null;
            ProcurementPEAdvanceDTO dt = null;
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTCUPEAdvance, dicOut, AdvanceID,
                    PEID, AdvanceType, AdvanceTypeInstanceID, Amount);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new ProcurementPEAdvanceDTO();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public ProcurementPERecoveriesDTO CreateUpdatePEAdvanceRecoveries(out Exception ex, out DataSet ds,
            Dictionary&lt;string, object&gt; dicOut, object RecoveryID, object MasterID, object AdvanceID, object PEID,
            object Amount, object DetailsId, object WorkPostingID)
        {
            ex = null;
            ds = null;
            ProcurementPERecoveriesDTO dt = null;
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTCUPEAdvanceRecoveries, dicOut,
                    RecoveryID, MasterID, AdvanceID, PEID, Amount, DetailsId, WorkPostingID);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new ProcurementPERecoveriesDTO();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public ProcurementPEDetailsDTO CreateUpdatePEDetails(out Exception ex, out DataSet ds,
            Dictionary&lt;string, object&gt; dicOut, object PEDetailsID, object PEID, object WorkPostingID, object WorkItemID,
            object Quantity, object BillingRate, object Amount)
        {
            ex = null;
            ds = null;
            ProcurementPEDetailsDTO dt = null;
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTCUPEDetails, dicOut, PEDetailsID,
                    PEID, WorkPostingID, WorkItemID, Quantity, BillingRate, Amount);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new ProcurementPEDetailsDTO();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public ProcurementPEHoldRetentionDTO CreateUpdatePEHoldAndRetention(out Exception ex, out DataSet ds,
            Dictionary&lt;string, object&gt; dicOut, object RetentionID, object PEID, object BucketType, object RetentionType,
            object RetentionPercentage, object RetentionAmount, object ReleaseType, object ReleasePercentage,
            object ReleaseAmount)
        {
            ex = null;
            ds = null;
            ProcurementPEHoldRetentionDTO dt = null;
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTCUPEHoldAndRetention, dicOut,
                    RetentionID, PEID, BucketType, RetentionType, RetentionPercentage, RetentionAmount, ReleaseType,
                    ReleasePercentage, ReleaseAmount);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new ProcurementPEHoldRetentionDTO();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public dtoPROCMGTWorkPosting CreateUpdateWorkPosting(out Exception ex, out DataSet ds,
            Dictionary&lt;string, object&gt; dicOut, object WPostingID, object POID, object PayItemID, object PostingQty,
            object UnitRate, object ParentID, object Status, object PostingDate, object ReferencePostingType,
            object ReferencePostingID)
        {
            ex = null;
            ds = null;
            dtoPROCMGTWorkPosting dt = null;
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTCUWorkPosting, dicOut, WPostingID,
                    POID, PayItemID, PostingQty, UnitRate, ParentID, Status, PostingDate, ReferencePostingType,
                    ReferencePostingID);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new dtoPROCMGTWorkPosting();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public dtoPROCMGTWorkPosting CreateUpdateWorkPosting(out Exception ex, out DataSet ds,
            Dictionary&lt;string, object&gt; dicOut, dtoPROCMGTWorkPosting dto)
        {
            ex = null;
            ds = null;
            dtoPROCMGTWorkPosting dt = null;
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTCUWorkPosting, dicOut,
                    dto.WPostingID, dto.POID, dto.PayItemID, dto.PostingQty, dto.UnitRate, dto.ParentID, dto.Status,
                    dto.PostingDate, dto.ReferencePostingType, dto.ReferencePostingID);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new dtoPROCMGTWorkPosting();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public ProcurementPayEstimateDTO DeletePayEstimates(out Exception ex, out DataSet ds, int id)
        {
            ex = null;
            ds = null;
            Dictionary&lt;string, object&gt; dicOut = new Dictionary&lt;string, object&gt;();
            ProcurementPayEstimateDTO dt = null;
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTDeletePayEstimates, dicOut, id);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                ProcurementPayEstimateDTO outdto = new ProcurementPayEstimateDTO();
                dr.FillDTO(outdto);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public ProcurementPEAdjustmentsDTO DeletePEAdjustments(out Exception ex, out DataSet ds, string ids)
        {
            ex = null;
            ds = null;
            Dictionary&lt;string, object&gt; dicOut = new Dictionary&lt;string, object&gt;();
            ProcurementPEAdjustmentsDTO dt = null;
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTDeletePEAdjustments, dicOut, ids);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new ProcurementPEAdjustmentsDTO();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public ProcurementPEAdvanceDTO DeletePEAdvance(out Exception ex, out DataSet ds, int id)
        {
            ex = null;
            ds = null;
            Dictionary&lt;string, object&gt; dicOut = new Dictionary&lt;string, object&gt;();
            ProcurementPEAdvanceDTO dt = null;
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTDeletePEAdvance, dicOut, id);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new ProcurementPEAdvanceDTO();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public ProcurementPERecoveriesDTO DeletePEAdvanceRecoveries(out Exception ex, out DataSet ds, int id)
        {
            ex = null;
            ds = null;
            Dictionary&lt;string, object&gt; dicOut = new Dictionary&lt;string, object&gt;();
            ProcurementPERecoveriesDTO dt = null;
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTDeletePEAdvanceRecoveries, dicOut,
                    id);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new ProcurementPERecoveriesDTO();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public ProcurementPEDetailsDTO DeletePEDetails(out Exception ex, out DataSet ds, string ids, string Type)
        {
            ex = null;
            ds = null;
            Dictionary&lt;string, object&gt; dicOut = new Dictionary&lt;string, object&gt;();
            ProcurementPEDetailsDTO dt = null;
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTDeletePEDetails, dicOut, ids, Type);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new ProcurementPEDetailsDTO();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public ProcurementPEHoldRetentionDTO DeletePEHoldAndRetention(out Exception ex, out DataSet ds, int id)
        {
            ex = null;
            ds = null;
            Dictionary&lt;string, object&gt; dicOut = new Dictionary&lt;string, object&gt;();
            ProcurementPEHoldRetentionDTO dt = null;
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTDeletePEHoldAndRetention, dicOut,
                    id);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new ProcurementPEHoldRetentionDTO();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public dtoPROCMGTWorkPosting DeleteWorkPosting(out Exception ex, out DataSet ds, int id)
        {
            ex = null;
            ds = null;
            Dictionary&lt;string, object&gt; dicOut = new Dictionary&lt;string, object&gt;();
            dtoPROCMGTWorkPosting dt = null;
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTDeleteWorkPosting, dicOut, id);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new dtoPROCMGTWorkPosting();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public ProcurementPayEstimateDTO GetPayEstimates(out Exception ex, out DataSet ds, int id)
        {
            ex = null;
            ds = null;
            ProcurementPayEstimateDTO dt = null;
            Dictionary&lt;string, object&gt; dicOut = new Dictionary&lt;string, object&gt;();
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTGetPayEstimates, dicOut, id);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                ProcurementPayEstimateDTO payEstimate = new ProcurementPayEstimateDTO();
                dr.FillDTO(payEstimate);

                List&lt;ProcurementPEDetailsDTO&gt; peDetailsDto = null;
                if (ds.Tables.Count &gt; 1 &amp;&amp; ds.Tables[1] != null)
                {
                    peDetailsDto = new List&lt;ProcurementPEDetailsDTO&gt;();
                    foreach (DataRow row in ds.Tables[1].Rows)
                    {
                        ProcurementPEDetailsDTO pE = new ProcurementPEDetailsDTO();
                        row.FillDTO(pE);
                        peDetailsDto.Add(pE);
                    }
                }
                payEstimate.peItems = peDetailsDto;
                dt = payEstimate;
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public ProcurementPEAdjustmentsDTO GetPEAdjustments(out Exception ex, out DataSet ds, string id)
        {
            ex = null;
            ds = null;
            ProcurementPEAdjustmentsDTO dt = null;
            Dictionary&lt;string, object&gt; dicOut = new Dictionary&lt;string, object&gt;();
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTGetPEAdjustments, dicOut, id);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new ProcurementPEAdjustmentsDTO();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public ProcurementPEAdvanceDTO GetPEAdvance(out Exception ex, out DataSet ds, int id)
        {
            ex = null;
            ds = null;
            ProcurementPEAdvanceDTO dt = null;
            Dictionary&lt;string, object&gt; dicOut = new Dictionary&lt;string, object&gt;();
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTGetPEAdvance, dicOut, id);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new ProcurementPEAdvanceDTO();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public ProcurementPERecoveriesDTO GetPEAdvanceRecoveries(out Exception ex, out DataSet ds, int id)
        {
            ex = null;
            ds = null;
            ProcurementPERecoveriesDTO dt = null;
            Dictionary&lt;string, object&gt; dicOut = new Dictionary&lt;string, object&gt;();
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTGetPEAdvanceRecoveries, dicOut, id);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new ProcurementPERecoveriesDTO();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public ProcurementPEDetailsDTO GetPEDetails(out Exception ex, out DataSet ds, int id)
        {
            ex = null;
            ds = null;
            ProcurementPEDetailsDTO dt = null;
            Dictionary&lt;string, object&gt; dicOut = new Dictionary&lt;string, object&gt;();
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTGetPEDetails, dicOut, id);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new ProcurementPEDetailsDTO();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public ProcurementPEHoldRetentionDTO GetPEHoldAndRetention(out Exception ex, out DataSet ds, int id)
        {
            ex = null;
            ds = null;
            ProcurementPEHoldRetentionDTO dt = null;
            Dictionary&lt;string, object&gt; dicOut = new Dictionary&lt;string, object&gt;();
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTGetPEHoldAndRetention, dicOut, id);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new ProcurementPEHoldRetentionDTO();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public dtoPROCMGTWorkPosting GetWorkPosting(out Exception ex, out DataSet ds, int id)
        {
            ex = null;
            ds = null;
            dtoPROCMGTWorkPosting dt = null;
            Dictionary&lt;string, object&gt; dicOut = new Dictionary&lt;string, object&gt;();
            try
            {
                ds = ComponentHelper.Instance.ExecuteDataSet(ProcurementSP.usp_PROCMGTGetWorkPosting, dicOut, id);
                if (null == ds || null == ds.Tables || ds.Tables.Count &lt; 1 || null == ds.Tables[0].Rows ||
                    ds.Tables[0].Rows.Count &lt; 1) return null;
                DataRow dr = ds.Tables[0].Rows[0];
                dt = new dtoPROCMGTWorkPosting();
                dr.FillDTO(dt);
            }
            catch (Exception e)
            {
                ex = e;
            }
            return dt;
        }

        public void UpdateWorkDoneFromDetails(int PEID)
        {
            ProcurementComponent.Instance.UpdateWorkDoneFromDetails(PEID);
        }


        public int GetPIDFromPEID(int id)
        {
            object pid = ComponentHelper.Instance.ExecuteScalar(
                       ProcurementSP.usp_PAYESTMGetPIDFromPEID, null, id);
            if (pid != null)
                return pid.ToInt32_2();
            else
                return -1;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[14,9,14,42,1],[15,9,15,10,1],[16,9,16,10,1],[20,9,20,10,1],[21,13,21,23,1],[22,13,22,23,1],[23,13,23,49,1],[25,13,25,14,1],[26,17,28,122,1],[29,17,30,49,1],[30,50,30,62,0],[31,17,31,51,1],[32,17,32,54,1],[33,17,33,32,1],[34,13,34,14,1],[35,13,35,32,0],[36,13,36,14,0],[37,17,37,24,0],[38,13,38,14,0],[39,13,39,23,1],[40,9,40,10,1],[44,9,44,10,0],[45,13,45,23,0],[46,13,46,23,0],[47,13,47,47,0],[49,13,49,14,0],[50,17,52,33,0],[53,17,54,49,0],[54,50,54,62,0],[55,17,55,51,0],[56,17,56,52,0],[57,17,57,32,0],[58,13,58,14,0],[59,13,59,32,0],[60,13,60,14,0],[61,17,61,24,0],[62,13,62,14,0],[63,13,63,23,0],[64,9,64,10,0],[68,9,68,10,1],[69,13,69,23,1],[70,13,70,23,1],[71,13,71,47,1],[73,13,73,14,1],[74,17,75,79,1],[76,17,77,49,1],[77,50,77,62,0],[78,17,78,51,1],[79,17,79,52,1],[80,17,80,32,1],[81,13,81,14,1],[82,13,82,32,0],[83,13,83,14,0],[84,17,84,24,0],[85,13,85,14,0],[86,13,86,23,1],[87,9,87,10,1],[91,9,91,10,0],[92,13,92,23,0],[93,13,93,23,0],[94,13,94,50,0],[96,13,96,14,0],[97,17,99,40,0],[100,17,101,49,0],[101,50,101,62,0],[102,17,102,51,0],[103,17,103,55,0],[104,17,104,32,0],[105,13,105,14,0],[106,13,106,32,0],[107,13,107,14,0],[108,17,108,24,0],[109,13,109,14,0],[110,13,110,23,0],[111,9,111,10,0],[115,9,115,10,0],[116,13,116,23,0],[117,13,117,23,0],[118,13,118,51,0],[120,13,120,14,0],[121,17,122,109,0],[123,17,124,49,0],[124,50,124,62,0],[125,17,125,51,0],[126,17,126,56,0],[127,17,127,32,0],[128,13,128,14,0],[129,13,129,32,0],[130,13,130,14,0],[131,17,131,24,0],[132,13,132,14,0],[133,13,133,23,0],[134,9,134,10,0],[138,9,138,10,1],[139,13,139,23,1],[140,13,140,23,1],[141,13,141,53,1],[143,13,143,14,1],[144,17,146,101,1],[147,17,148,49,1],[148,50,148,62,0],[149,17,149,51,1],[150,17,150,58,1],[151,17,151,32,1],[152,13,152,14,1],[153,13,153,32,0],[154,13,154,14,0],[155,17,155,24,0],[156,13,156,14,0],[157,13,157,23,1],[158,9,158,10,1],[161,9,161,10,0],[162,13,162,74,0],[163,9,163,10,0],[169,9,169,10,0],[170,13,170,23,0],[171,13,171,23,0],[172,13,172,49,0],[174,13,174,14,0],[175,17,177,71,0],[178,17,179,49,0],[179,50,179,62,0],[180,17,180,51,0],[181,17,181,54,0],[182,17,182,32,0],[183,13,183,14,0],[184,13,184,32,0],[185,13,185,14,0],[186,17,186,24,0],[187,13,187,14,0],[188,13,188,23,0],[189,9,189,10,0],[194,9,194,10,0],[195,13,195,23,0],[196,13,196,23,0],[197,13,197,51,0],[199,13,199,14,0],[200,17,201,89,0],[202,17,203,49,0],[203,50,203,62,0],[204,17,204,51,0],[205,17,205,56,0],[206,17,206,32,0],[207,13,207,14,0],[208,13,208,32,0],[209,13,209,14,0],[210,17,210,24,0],[211,13,211,14,0],[212,13,212,23,0],[213,9,213,10,0],[218,9,218,10,0],[219,13,219,23,0],[220,13,220,23,0],[221,13,221,47,0],[223,13,223,14,0],[224,17,225,71,0],[226,17,227,49,0],[227,50,227,62,0],[228,17,228,51,0],[229,17,229,52,0],[230,17,230,32,0],[231,13,231,14,0],[232,13,232,32,0],[233,13,233,14,0],[234,17,234,24,0],[235,13,235,14,0],[236,13,236,23,0],[237,9,237,10,0],[242,9,242,10,0],[243,13,243,23,0],[244,13,244,23,0],[245,13,245,50,0],[247,13,247,14,0],[248,17,249,94,0],[250,17,251,49,0],[251,50,251,62,0],[252,17,252,51,0],[253,17,253,55,0],[254,17,254,32,0],[255,13,255,14,0],[256,13,256,32,0],[257,13,257,14,0],[258,17,258,24,0],[259,13,259,14,0],[260,13,260,23,0],[261,9,261,10,0],[266,9,266,10,0],[267,13,267,23,0],[268,13,268,23,0],[269,13,269,47,0],[271,13,271,14,0],[272,17,273,85,0],[274,17,275,49,0],[275,50,275,62,0],[276,17,276,51,0],[277,17,277,52,0],[278,17,278,32,0],[279,13,279,14,0],[280,13,280,32,0],[281,13,281,14,0],[282,17,282,24,0],[283,13,283,14,0],[284,13,284,23,0],[285,9,285,10,0],[291,9,291,10,0],[292,13,292,23,0],[293,13,293,23,0],[294,13,294,53,0],[296,13,296,14,0],[297,17,299,55,0],[300,17,301,49,0],[301,50,301,62,0],[302,17,302,51,0],[303,17,303,58,0],[304,17,304,32,0],[305,13,305,14,0],[306,13,306,32,0],[307,13,307,14,0],[308,17,308,24,0],[309,13,309,14,0],[310,13,310,23,0],[311,9,311,10,0],[317,9,317,10,0],[318,13,318,23,0],[319,13,319,23,0],[320,13,320,45,0],[322,13,322,14,0],[323,17,325,41,0],[326,17,327,49,0],[327,50,327,62,0],[328,17,328,51,0],[329,17,329,50,0],[330,17,330,32,0],[331,13,331,14,0],[332,13,332,32,0],[333,13,333,14,0],[334,17,334,24,0],[335,13,335,14,0],[336,13,336,23,0],[337,9,337,10,0],[341,9,341,10,0],[342,13,342,23,0],[343,13,343,23,0],[344,13,344,45,0],[346,13,346,14,0],[347,17,349,88,0],[350,17,351,49,0],[351,50,351,62,0],[352,17,352,51,0],[353,17,353,50,0],[354,17,354,32,0],[355,13,355,14,0],[356,13,356,32,0],[357,13,357,14,0],[358,17,358,24,0],[359,13,359,14,0],[360,13,360,23,0],[361,9,361,10,0],[364,9,364,10,0],[365,13,365,23,0],[366,13,366,23,0],[367,13,367,82,0],[368,13,368,49,0],[370,13,370,14,0],[371,17,371,119,0],[372,17,373,49,0],[373,50,373,62,0],[374,17,374,51,0],[375,17,375,84,0],[376,17,376,36,0],[377,13,377,14,0],[378,13,378,32,0],[379,13,379,14,0],[380,17,380,24,0],[381,13,381,14,0],[382,13,382,23,0],[383,9,383,10,0],[386,9,386,10,0],[387,13,387,23,0],[388,13,388,23,0],[389,13,389,82,0],[390,13,390,51,0],[392,13,392,14,0],[393,17,393,121,0],[394,17,395,49,0],[395,50,395,62,0],[396,17,396,51,0],[397,17,397,56,0],[398,17,398,32,0],[399,13,399,14,0],[400,13,400,32,0],[401,13,401,14,0],[402,17,402,24,0],[403,13,403,14,0],[404,13,404,23,0],[405,9,405,10,0],[408,9,408,10,0],[409,13,409,23,0],[410,13,410,23,0],[411,13,411,82,0],[412,13,412,47,0],[414,13,414,14,0],[415,17,415,116,0],[416,17,417,49,0],[417,50,417,62,0],[418,17,418,51,0],[419,17,419,52,0],[420,17,420,32,0],[421,13,421,14,0],[422,13,422,32,0],[423,13,423,14,0],[424,17,424,24,0],[425,13,425,14,0],[426,13,426,23,0],[427,9,427,10,0],[430,9,430,10,0],[431,13,431,23,0],[432,13,432,23,0],[433,13,433,82,0],[434,13,434,50,0],[436,13,436,14,0],[437,17,438,25,0],[439,17,440,49,0],[440,50,440,62,0],[441,17,441,51,0],[442,17,442,55,0],[443,17,443,32,0],[444,13,444,14,0],[445,13,445,32,0],[446,13,446,14,0],[447,17,447,24,0],[448,13,448,14,0],[449,13,449,23,0],[450,9,450,10,0],[453,9,453,10,0],[454,13,454,23,0],[455,13,455,23,0],[456,13,456,82,0],[457,13,457,47,0],[459,13,459,14,0],[460,17,460,123,0],[461,17,462,49,0],[462,50,462,62,0],[463,17,463,51,0],[464,17,464,52,0],[465,17,465,32,0],[466,13,466,14,0],[467,13,467,32,0],[468,13,468,14,0],[469,17,469,24,0],[470,13,470,14,0],[471,13,471,23,0],[472,9,472,10,0],[475,9,475,10,0],[476,13,476,23,0],[477,13,477,23,0],[478,13,478,82,0],[479,13,479,53,0],[481,13,481,14,0],[482,17,483,25,0],[484,17,485,49,0],[485,50,485,62,0],[486,17,486,51,0],[487,17,487,58,0],[488,17,488,32,0],[489,13,489,14,0],[490,13,490,32,0],[491,13,491,14,0],[492,17,492,24,0],[493,13,493,14,0],[494,13,494,23,0],[495,9,495,10,0],[498,9,498,10,0],[499,13,499,23,0],[500,13,500,23,0],[501,13,501,82,0],[502,13,502,45,0],[504,13,504,14,0],[505,17,505,118,0],[506,17,507,49,0],[507,50,507,62,0],[508,17,508,51,0],[509,17,509,50,0],[510,17,510,32,0],[511,13,511,14,0],[512,13,512,32,0],[513,13,513,14,0],[514,17,514,24,0],[515,13,515,14,0],[516,13,516,23,0],[517,9,517,10,0],[520,9,520,10,1],[521,13,521,23,1],[522,13,522,23,1],[523,13,523,49,1],[524,13,524,82,1],[526,13,526,14,1],[527,17,527,116,1],[528,17,529,49,1],[529,50,529,62,0],[530,17,530,51,1],[531,17,531,89,1],[532,17,532,41,1],[534,17,534,67,1],[535,17,535,65,1],[536,17,536,18,1],[537,21,537,72,1],[538,21,538,28,1],[538,30,538,41,0],[538,42,538,44,1],[538,45,538,62,1],[539,21,539,22,0],[540,25,540,84,0],[541,25,541,41,0],[542,25,542,46,0],[543,21,543,22,0],[544,17,544,18,1],[545,17,545,52,1],[546,17,546,34,1],[547,13,547,14,1],[548,13,548,32,0],[549,13,549,14,0],[550,17,550,24,0],[551,13,551,14,0],[552,13,552,23,1],[553,9,553,10,1],[556,9,556,10,0],[557,13,557,23,0],[558,13,558,23,0],[559,13,559,51,0],[560,13,560,82,0],[562,13,562,14,0],[563,17,563,117,0],[564,17,565,49,0],[565,50,565,62,0],[566,17,566,51,0],[567,17,567,56,0],[568,17,568,32,0],[569,13,569,14,0],[570,13,570,32,0],[571,13,571,14,0],[572,17,572,24,0],[573,13,573,14,0],[574,13,574,23,0],[575,9,575,10,0],[578,9,578,10,0],[579,13,579,23,0],[580,13,580,23,0],[581,13,581,47,0],[582,13,582,82,0],[584,13,584,14,0],[585,17,585,113,0],[586,17,587,49,0],[587,50,587,62,0],[588,17,588,51,0],[589,17,589,52,0],[590,17,590,32,0],[591,13,591,14,0],[592,13,592,32,0],[593,13,593,14,0],[594,17,594,24,0],[595,13,595,14,0],[596,13,596,23,0],[597,9,597,10,0],[600,9,600,10,0],[601,13,601,23,0],[602,13,602,23,0],[603,13,603,50,0],[604,13,604,82,0],[606,13,606,14,0],[607,17,607,123,0],[608,17,609,49,0],[609,50,609,62,0],[610,17,610,51,0],[611,17,611,55,0],[612,17,612,32,0],[613,13,613,14,0],[614,13,614,32,0],[615,13,615,14,0],[616,17,616,24,0],[617,13,617,14,0],[618,13,618,23,0],[619,9,619,10,0],[622,9,622,10,0],[623,13,623,23,0],[624,13,624,23,0],[625,13,625,47,0],[626,13,626,82,0],[628,13,628,14,0],[629,17,629,113,0],[630,17,631,49,0],[631,50,631,62,0],[632,17,632,51,0],[633,17,633,52,0],[634,17,634,32,0],[635,13,635,14,0],[636,13,636,32,0],[637,13,637,14,0],[638,17,638,24,0],[639,13,639,14,0],[640,13,640,23,0],[641,9,641,10,0],[644,9,644,10,0],[645,13,645,23,0],[646,13,646,23,0],[647,13,647,53,0],[648,13,648,82,0],[650,13,650,14,0],[651,17,651,122,0],[652,17,653,49,0],[653,50,653,62,0],[654,17,654,51,0],[655,17,655,58,0],[656,17,656,32,0],[657,13,657,14,0],[658,13,658,32,0],[659,13,659,14,0],[660,17,660,24,0],[661,13,661,14,0],[662,13,662,23,0],[663,9,663,10,0],[666,9,666,10,0],[667,13,667,23,0],[668,13,668,23,0],[669,13,669,45,0],[670,13,670,82,0],[672,13,672,14,0],[673,17,673,115,0],[674,17,675,49,0],[675,50,675,62,0],[676,17,676,51,0],[677,17,677,50,0],[678,17,678,32,0],[679,13,679,14,0],[680,13,680,32,0],[681,13,681,14,0],[682,17,682,24,0],[683,13,683,14,0],[684,13,684,23,0],[685,9,685,10,0],[688,9,688,10,1],[689,13,689,75,1],[690,9,690,10,1],[694,9,694,10,0],[695,13,696,75,0],[697,13,697,29,0],[698,17,698,40,0],[700,17,700,27,0],[701,9,701,10,0]]);
    </script>
  </body>
</html>