<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Business Layer\BL\LibraryInterface.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Data.OleDb;
using System.Globalization;
using System.Linq;
using System.Text;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core.BusinessLayer.DTO;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.AMP3.LibraryDAC;
using Aurigo.AMP3.LibraryDTO;
using Aurigo.AMP3.Logging;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.AMP3.Resources.MessageResources;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.Brix.DataAccess.Core;
using Aurigo.Brix.Platform.BusinessLayer.DTO;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.Common.Utility;

namespace Aurigo.AMP3.LibraryBL
{
    /// &lt;summary&gt;
    /// This Class contains methods that provide functionality for the Library Module.
    /// The UI class(Code behind) calls these methods directly
    /// &lt;/summary&gt;
    [Context(Name = Constants.MODID_LIBRARY)]
    public class LibraryInterface : SingletonManagerBase&lt;LibraryInterface&gt;, IXmlTree
    {
        private List&lt;string&gt; _coreModuleComponents = null;
        private const string IMGPATHCATEGORY = &quot;~/Images/IcnFolder.gif&quot;;
        private const string IMGPATHCATALOG = &quot;~/Images/IcnPage.gif&quot;;

        public static SortedDictionary&lt;string, Type&gt; contextDictionary;
        private readonly UserDetail ud = UserDetail.GetCurrentUserDetail();

        public LibraryInterface()
        {
        }

        static LibraryInterface()
        {
            if (contextDictionary == null)
            {
                contextDictionary = new SortedDictionary&lt;string, Type&gt;();
                Dictionary&lt;string, Type&gt; dict = ModelHelper.GetModelObjects(typeof(IXmlLibraryTree));
                foreach (var kvp in dict)
                    contextDictionary.Add(kvp.Key, kvp.Value);
            }
        }

        private List&lt;string&gt; CoreModuleComponents
        {
            get
            {
                if (_coreModuleComponents == null)
                    _coreModuleComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);

                return _coreModuleComponents;
            }
        }

        #region IXmlTree Members

        public TNode GetXmlForTree(int projectId, int userId, int roleId, string platform)
        {
            return GetLibraryXml();
        }

        public Dictionary&lt;string, string&gt; GetTreeForMobile(int projectID, int instanceId, int userId, int roleId)
        {
            return new Dictionary&lt;string, string&gt;();
        }

        string IXmlTree.ActiveTab
        {
            get { return &quot;Library&quot;; }
            set { }
        }

        string IXmlTree.ModuleID
        {
            get { return &quot;Library&quot;; }
            set { }
        }

        #endregion IXmlTree Members

        public bool IsCatEmptyBeforeSettingMandatory(int catalogID)
        {
            return LibraryComponent.Instance.IsCatEmptyBeforeSettingMandatory(catalogID);
        }

        public void UpdateCatalogOrder(int catalogColumnID, int position)
        {
            LibraryComponent.Instance.UpdateCatalogOrder(catalogColumnID, position);
        }

        public DataTable GetRecordsInTableFormat(int catalogId, string sortOrder)
        {
            return LibraryComponent.Instance.GetRecordsInTableFormat(catalogId, sortOrder);
        }

        /// &lt;summary&gt;
        /// Gets the structure of the Catalog(Column Names,Column Types etc.)
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;nodeID&quot;&gt;The Node ID&lt;/param&gt;
        /// &lt;returns&gt;DataTable which contains the Schema(Column Names,Types,Size etc.) &lt;/returns&gt;
        public DataTable GetCatalogSchema(int nodeID)
        {
            return LibraryComponent.Instance.GetCatalogSchema(nodeID);
        }

        /// &lt;summary&gt;
        /// Copies the Schema(Column Names,Types,Size etc.) from an existing Catalog
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;fromNodeID&quot;&gt;Node ID of the Existing Catalog&lt;/param&gt;
        /// &lt;param name=&quot;toNodeID&quot;&gt;Node ID of the newly creating record&lt;/param&gt;
        public void CopyExistingSchema(int fromNodeID, int toNodeID)
        {
            var catMgmtObj = new CatalogManagement();
            catMgmtObj.CopyExistingSchema(fromNodeID, toNodeID);
        }

        /// &lt;summary&gt;
        /// Create a New Column for the Catalog Schema
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;catalogID&quot;&gt;The Node ID&lt;/param&gt;
        /// &lt;param name=&quot;columnName&quot;&gt;The Column Name&lt;/param&gt;
        /// &lt;param name=&quot;columnType&quot;&gt;The Data Type of the Column&lt;/param&gt;
        /// &lt;param name=&quot;columnSize&quot;&gt;The Size of the Column&lt;/param&gt;
        /// &lt;param name=&quot;isUnique&quot;&gt;Is the column unique&lt;/param&gt;
        /// &lt;param name=&quot;isDescriptive&quot;&gt;Is the column descriptive&lt;/param&gt;
        /// &lt;param name=&quot;isMandatory&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;Returns true if column is created successfully, &lt;/returns&gt;
        /// &lt;returns&gt;false if column already exists&lt;/returns&gt;
        public bool CreateCatalogSchema(int catalogID, string columnName, string columnType, int columnSize,
            bool isUnique, bool isDescriptive, bool isMandatory)
        {
            var catMgmtObj = new CatalogManagement();
            int catalogColumnID =
                LibraryComponent.Instance.CreateCatalogSchema(catalogID, columnName, columnType, columnSize, isUnique,
                    isDescriptive, isMandatory);
            if (catalogColumnID == -1)
                return false;

            catMgmtObj.AddCatalogRecordsforUpdatedSchema(catalogID, catalogColumnID);
            return true;
        }

        /// &lt;summary&gt;
        /// Update the schema for the selected catalog
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;catalogColumnID&quot;&gt;The Uniaue Column ID&lt;/param&gt;
        /// &lt;param name=&quot;columnName&quot;&gt;The Column Name&lt;/param&gt;
        /// &lt;param name=&quot;columnType&quot;&gt;The Data Type of the Column&lt;/param&gt;
        /// &lt;param name=&quot;columnSize&quot;&gt;The Size of the Column&lt;/param&gt;
        /// &lt;param name=&quot;isUnique&quot;&gt;Is the column unique&lt;/param&gt;
        /// &lt;param name=&quot;isDescriptive&quot;&gt;Is the column descriptive&lt;/param&gt;
        /// &lt;param name=&quot;isMandatory&quot;&gt;&lt;/param&gt;
        public int UpdateCatalogSchema(int catalogColumnID, string columnName, string columnType, int columnSize,
            bool isUnique, bool isDescriptive, bool isMandatory)
        {
            return
                LibraryComponent.Instance.UpdateCatalogSchema(catalogColumnID, columnName, columnType, columnSize,
                    isUnique, isDescriptive, isMandatory);
        }

        /// &lt;summary&gt;
        /// Delete the Schema for the selected Catalog
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;catalogColumnID&quot;&gt;The Unique Column ID&lt;/param&gt;
        /// &lt;param name=&quot;catalogID&quot;&gt;The Node ID&lt;/param&gt;
        public int DeleteCatalogSchema(int catalogColumnID, int catalogID)
        {
            var catMgmtObj = new CatalogManagement();
            return catMgmtObj.DeleteCatalogRecordsforUpdatedSchema(catalogColumnID, catalogID);
        }

        /// &lt;summary&gt;
        /// To convert a Byte Array of Unicode values (UTF-8 encoded) to a complete String.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;characters&quot;&gt;Unicode Byte Array to be converted to String&lt;/param&gt;
        /// &lt;returns&gt;String converted from Unicode Byte Array&lt;/returns&gt;
        private String UTF8ByteArrayToString(Byte[] characters)
        {
            var encoding = new UTF8Encoding();
            String constructedString = encoding.GetString(characters);
            return (constructedString);
        }

        /// &lt;summary&gt;
        /// This method was created on 14-nov-2006
        /// This method accepts two comma separated strings as parameters
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;strHiddenNodes&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;strDeletedNodes&quot;&gt;&lt;/param&gt;
        public void SaveToDataBase(string strHiddenNodes, string strDeletedNodes)
        {
            // split the comma separated strings and get the node id&#39;s of the TreeNodes

            string[] strDelNodes = strDeletedNodes.Split(&#39;,&#39;);
            if (strDelNodes.Length &gt; 0)
            {
                var sbDelNodes = new StringBuilder(&quot;&lt;DeletedNodes&gt;&quot;);
                foreach (string strLocal in strDelNodes)
                    sbDelNodes.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;Node id=\&quot;{0}\&quot;/&gt;&quot;, strLocal);
                sbDelNodes.Append(&quot;&lt;/DeletedNodes&gt;&quot;);
                LibraryComponent.Instance.DeleteSchemaAssociatedRecords(sbDelNodes.ToString2());
            }

            string[] strHidNodes = strHiddenNodes.Split(&#39;,&#39;);
            if (strHidNodes.Length &gt; 0)
            {
                var sbHidNodes = new StringBuilder(&quot;&lt;HiddenNodes&gt;&quot;);
                foreach (string strLocal in strHidNodes)
                    sbHidNodes.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;Node id=\&quot;{0}\&quot;/&gt;&quot;, strLocal);
                sbHidNodes.Append(&quot;&lt;/HiddenNodes&gt;&quot;);
                LibraryComponent.Instance.HideUnhideTreeNodes(sbHidNodes.ToString2());
            }
        }

        /// &lt;summary&gt;
        /// Gets XML String which contains the numner of categories, catalogs, hidden catalogs
        /// &lt;/summary&gt;
        /// &lt;returns&gt;XML String which contains the numner of categories, catalogs, hidden catalogs&lt;/returns&gt;
        public DataTable GetLibrarySummary(int targetPage)
        {
            return LibraryComponent.Instance.GetLibrarySummary(targetPage);
        }

        /// &lt;summary&gt;
        /// Gets the nodes under particular Node.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;nodeID&quot;&gt;The Node ID&lt;/param&gt;
        /// &lt;returns&gt;Returns a DataTable which contains the list of Nodes immediately under a Selected Node&lt;/returns&gt;
        public DataTable GetChildNodesList(int nodeID)
        {
            return LibraryComponent.Instance.GetChildNodesList(nodeID);
        }

        /// &lt;summary&gt;
        /// Adds a new record to the selected Catalog
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;nodeID&quot;&gt;The Node ID&lt;/param&gt;
        /// &lt;param name=&quot;Value&quot;&gt;The value of the record.&lt;/param&gt;
        /// &lt;param name=&quot;CatalogColumnID&quot;&gt;The unique column ID&lt;/param&gt;
        /// &lt;param name=&quot;catalogRowID&quot;&gt;The Unique row id per catalog&lt;/param&gt;
        public void AddNewRecord(int nodeID, string Value, int CatalogColumnID, int catalogRowID)
        {
            LibraryComponent.Instance.AddNewRecord(nodeID, Value, CatalogColumnID, catalogRowID);
        }

        /// &lt;summary&gt;
        /// Hide/Unhides the Selected Columns in the Catalog Schema
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;catalogColumnID&quot;&gt;The Unique Column ID&lt;/param&gt;
        /// &lt;param name=&quot;isVisible&quot;&gt;&lt;/param&gt;
        public void HideUnhideCatalogColumn(int catalogColumnID, bool isVisible)
        {
            LibraryComponent.Instance.HideUnhideCatalogColumn(catalogColumnID, isVisible);
        }

        /// &lt;summary&gt;
        /// Gets the Maximum Row number from the CatalogRecords Table for a Catalog
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;CatalogID&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;Maximum RowID&lt;/returns&gt;
        public int GetMaxCatalogRowNumber(int CatalogID)
        {
            return LibraryComponent.Instance.GetMaxCatalogRowNumber(CatalogID);
        }

        /// &lt;summary&gt;
        /// Edit record for a catalog
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;catalogID&quot;&gt;The Node ID&lt;/param&gt;
        /// &lt;param name=&quot;catalogValue&quot;&gt;Edited Record&lt;/param&gt;
        /// &lt;param name=&quot;CatalogColumnID&quot;&gt;The unique Column ID&lt;/param&gt;
        /// &lt;param name=&quot;catalogRowID&quot;&gt;Row ID for the Selected Row&lt;/param&gt;
        public void EditRecord(int catalogID, string catalogValue, int CatalogColumnID, int catalogRowID)
        {
            LibraryComponent.Instance.EditRecord(catalogID, catalogValue, CatalogColumnID, catalogRowID);
        }

        /// &lt;summary&gt;
        /// Deletes the selected record
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;catalogID&quot;&gt;The Node ID&lt;/param&gt;
        /// &lt;param name=&quot;catalogRowID&quot;&gt;Row ID for the Selected Row&lt;/param&gt;
        public void DeleteRecord(int catalogID, int catalogRowID)
        {
            LibraryComponent.Instance.DeleteRecord(catalogID, catalogRowID);
        }

        /// &lt;summary&gt;
        /// Returns a Record matching the links Search Criteria
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;typeName&quot;&gt;Unique name to a Catalog(Internal)&lt;/param&gt;
        /// &lt;param name=&quot;catalogRowID&quot;&gt;The Row Id of the record&lt;/param&gt;
        /// &lt;returns&gt;records in XML format&lt;/returns&gt;
        public string ViewSearchResults(string typeName, int catalogRowID)
        {
            return LibraryComponent.Instance.ViewSearchResults(typeName, catalogRowID);
        }

        /// &lt;summary&gt;
        /// Checks for records in the catalog before setting the unique bit.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;catalogID&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public bool IsCatEmptyBeforeSettingUnique(int catalogID)
        {
            return LibraryComponent.Instance.IsCatEmptyBeforeSettingUnique(catalogID);
        }

        internal TNode GetLibraryXml()
        {
            var tree = new TNode();

            XMLTreeContextAttribute[] attribs;
            foreach (var kvp in contextDictionary)
            {
                attribs = (XMLTreeContextAttribute[])
                    kvp.Value.GetCustomAttributes(typeof(XMLTreeContextAttribute), true);
                if (HasPermission(attribs[0].ModuleId))
                {
                    var node = new TNode(kvp.Key, &quot;&quot;);

                    var xmltree = (IXmlLibraryTree)Activator.CreateInstance(kvp.Value);
                    //Sending the root node as the first parameter
                    xmltree.GetXmlForLibraryTree(node, tree);
                    if (node.Nodes.Count &gt; 0)
                        tree.Nodes.Add(node);
                }
            }

            //BuildLibraryXmlForCategories(0, sPath, tree);

            return tree;
        }

        private bool HasPermission(string moduleId)
        {
            List&lt;string&gt; permissions = ModuleManager.Instance.GetPermissionByUserOrRole(moduleId, ud.UID, ud.RID, 0);
            if (moduleId.Equals(Constants.MODID_LIBRARY))
            {
                if (CoreModuleComponents.Contains(&quot;ShowUnifiedLibraryPermissions&quot;))
                    return permissions.Contains(&quot;Common&quot;);
                else
                    return LibraryInterface.Instance.HasAccessToAnyLibraryForm(ud.UID);
            }
            else
            {
                return permissions.Contains(&quot;Library Visibility&quot;);
            }
        }

        public bool HasAccessToAnyLibraryForm(int userID)
        {
            DataSet ds = LibraryComponent.Instance.GetAuthorisedLibraryForms(userID);

            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0 &amp;&amp; ds.Tables[0].Rows.Count &gt; 0)
                return true;

            return false;
        }

        public DataTable GetAuthorisedLibraryForms(int userID)
        {
            DataSet ds = LibraryComponent.Instance.GetAuthorisedLibraryForms(userID);

            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0 &amp;&amp; ds.Tables[0].Rows.Count &gt; 0)
                return ds.Tables[0];

            return null;
        }

        /// &lt;summary&gt;
        /// Return you the XML string which contains the Library Node iNformation
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private void BuildLibraryXmlForCategories(int NodeID, string sPath, TNode parentNode)
        {
            DataTable dtVisibleNodes = LibraryComponent.Instance.GetAllVisibleNodes();

            IQueryable&lt;BrixModule&gt; moduleDetails = from m in CoreDb.Db.Modules select m;

            foreach (DataRow row in dtVisibleNodes.Select(&quot;ParentID =&quot; + NodeID, &quot;NodeName&quot;))
            {
                BrixModule moduleDetail = (from m in moduleDetails
                                           where m.ModuleDescription == row[&quot;NodeName&quot;].ToString2()
                                           select m).FirstOrDefault();

                if ((moduleDetail == null || string.IsNullOrEmpty(moduleDetail.ModuleID)) ||
                    HasPermission(moduleDetail.ModuleID))
                {
                    bool isCatalog = (row[&quot;IsCatalog&quot;].ToString2() == &quot;True&quot;);

                    var node = new TNode(row[&quot;NodeName&quot;].ToString2(),
                        sPath + &quot;ViewLibraryCatalogPage.aspx&quot; + &quot;?nodeid=&quot; + row[&quot;NodeID&quot;].ToString2() +
                        &quot;&amp;nodename=&quot; + row[&quot;NodeName&quot;].ToString2());
                    parentNode.Nodes.Add(node);

                    if (!isCatalog) // Only categories have a hierarchy further down
                    {
                        BuildLibraryXmlForCategories(row[&quot;NodeID&quot;].ToString2().ToInt32_2(), sPath, node);
                    }
                }
            }
        }

        #region Import Standard Items with Item Rate Analysis

        internal void Upload(string filename, DataSet dsItems)
        {
            try
            {
                DataTable dt = dsItems.Tables.Add(&quot;Table&quot;);
                dt.Columns.Add(&quot;StandardItemNo&quot;, Type.GetType(&quot;System.String&quot;));
                dt.Columns.Add(LocalizationManager.GetString(KeyConstants.LOC_SECTION), Type.GetType(&quot;System.String&quot;));
                dt.Columns.Add(&quot;StandardItemDescription&quot;, Type.GetType(&quot;System.String&quot;));
                dt.Columns.Add(&quot;Unit&quot;, Type.GetType(&quot;System.String&quot;));
                dt.Columns.Add(&quot;Lumpsum&quot;, Type.GetType(&quot;System.String&quot;));
                dt.Columns.Add(&quot;Unit_Cost&quot;, Type.GetType(&quot;System.Decimal&quot;));
                dt.Columns.Add(&quot;Margin&quot;, Type.GetType(&quot;System.Decimal&quot;));

                using (
                    var xlsData =
                        new OleDbDataAdapter(
                            &quot;SELECT [StandardItemID], [StandardItemNo], [Unit], [StandardItemDescription], [&quot; +
                            LocalizationManager.GetString(KeyConstants.LOC_SECTION) +
                            &quot;], [Lumpsum], [Unit Cost] AS [Unit_Cost], [Margin] FROM [Items$]&quot;,
                            &quot;Provider=Microsoft.Jet.OLEDB.4.0;Data Source=&quot; + filename + &quot;;&quot; +
                            &quot;Extended Properties=&#39;Excel 8.0;HDR=Yes;IMEX=1&#39;&quot;))
                {
                    xlsData.Fill(dsItems, &quot;Table&quot;);
                }
                //MANPOWER
                dt = new BrixDataTable(&quot;ICAResDetails&quot;);
                dt.Columns.Add(&quot;StandardItemID&quot;, Type.GetType(&quot;System.Int32&quot;));
                dt.Columns.Add(&quot;Description&quot;, Type.GetType(&quot;System.String&quot;));
                dt.Columns[&quot;Description&quot;].MaxLength = 300;
                dt.Columns.Add(&quot;Unit&quot;, Type.GetType(&quot;System.String&quot;));
                dt.Columns[&quot;Unit&quot;].MaxLength = 50;
                dt.Columns.Add(&quot;ResItemID&quot;, Type.GetType(&quot;System.String&quot;));
                dt.Columns.Add(&quot;Rate_Per_Unit&quot;, Type.GetType(&quot;System.Decimal&quot;));
                //dt.Columns[&quot;Rate_Per_Unit&quot;].AllowDBNull = false;
                dt.Columns.Add(&quot;Quantity&quot;, Type.GetType(&quot;System.Decimal&quot;));
                //dt.Columns[&quot;Quantity&quot;].AllowDBNull = false;
                dt.Columns.Add(&quot;Notes&quot;, Type.GetType(&quot;System.String&quot;));
                dt.Columns[&quot;Notes&quot;].MaxLength = 1000;
                //dt.PrimaryKey = new DataColumn[] { dt.Columns[&quot;StandardItemID&quot;], dt.Columns[&quot;Description&quot;] };
                dt.Columns.Add(&quot;ResType&quot;, Type.GetType(&quot;System.String&quot;));
                dt.Columns[&quot;ResType&quot;].DefaultValue = &quot;manpower&quot;;
                using (
                    var xlsData =
                        new OleDbDataAdapter(
                            &quot;SELECT [StandardItemID], [ResItemID], [Description], [Unit], [Rate Per Unit] AS [Rate_Per_Unit], [Quantity], [Notes] FROM [&quot; +
                            LocalizationManager.GetString(KeyConstants.LOC_ICA_MANPOWER) + &quot;$]&quot;,
                            &quot;Provider=Microsoft.Jet.OLEDB.4.0;Data Source=&quot; + filename +
                            &quot;; Extended Properties=&#39;Excel 8.0;HDR=Yes;IMEX=1&#39;&quot;))
                {
                    xlsData.Fill(dt);
                }
                dsItems.Merge(dt);
                //EQUIPMENT
                dt = dsItems.Tables[&quot;ICAResDetails&quot;].Clone();
                dt.Columns[&quot;ResType&quot;].DefaultValue = &quot;equipment&quot;;
                using (
                    var xlsData =
                        new OleDbDataAdapter(
                            &quot;SELECT [StandardItemID], [ResItemID], [Description], [Unit], [Rate Per Unit] AS [Rate_Per_Unit], [Quantity], [Notes] FROM [&quot; +
                            LocalizationManager.GetString(KeyConstants.LOC_ICA_EQUIPMENT) + &quot;$]&quot;,
                            &quot;Provider=Microsoft.Jet.OLEDB.4.0;Data Source=&quot; + filename +
                            &quot;; Extended Properties=&#39;Excel 8.0;HDR=Yes;IMEX=1&#39;&quot;))
                {
                    xlsData.Fill(dt);
                }
                dsItems.Merge(dt);
                //MATERIALS
                dt = dsItems.Tables[&quot;ICAResDetails&quot;].Clone();
                dt.Columns[&quot;ResType&quot;].DefaultValue = &quot;material&quot;;
                using (
                    var xlsData =
                        new OleDbDataAdapter(
                            &quot;SELECT [StandardItemID], [ResItemID], [Description], [Unit], [Rate Per Unit] AS [Rate_Per_Unit], [Quantity], [Notes] FROM [&quot; +
                            LocalizationManager.GetString(KeyConstants.LOC_ICA_MATERIALS) + &quot;$]&quot;,
                            &quot;Provider=Microsoft.Jet.OLEDB.4.0;Data Source=&quot; + filename +
                            &quot;; Extended Properties=&#39;Excel 8.0;HDR=Yes;IMEX=1&#39;&quot;))
                {
                    xlsData.Fill(dt);
                }
                dsItems.Merge(dt);
                //MISC
                dt = dsItems.Tables[&quot;ICAResDetails&quot;].Clone();
                dt.Columns[&quot;ResType&quot;].DefaultValue = &quot;misc&quot;;
                using (
                    var xlsData =
                        new OleDbDataAdapter(
                            &quot;SELECT [StandardItemID], [Description], [Unit], [Rate Per Unit] AS [Rate_Per_Unit], [Quantity], [Notes] FROM [&quot; +
                            LocalizationManager.GetString(KeyConstants.LOC_ICA_MISC) + &quot;$]&quot;,
                            &quot;Provider=Microsoft.Jet.OLEDB.4.0;Data Source=&quot; + filename +
                            &quot;; Extended Properties=&#39;Excel 8.0;HDR=Yes;IMEX=1&#39;&quot;))
                {
                    xlsData.Fill(dt);
                }
                dsItems.Merge(dt);
                //Measurement Book
                dt = dsItems.Tables.Add(&quot;Measurement_Book&quot;);
                dt.Columns.Add(&quot;StandardItemID&quot;, Type.GetType(&quot;System.Int32&quot;));
                dt.Columns.Add(&quot;Dimension_Title_1&quot;, Type.GetType(&quot;System.String&quot;));
                dt.Columns[&quot;Dimension_Title_1&quot;].MaxLength = 100;
                dt.Columns.Add(&quot;Dimension_Unit_1&quot;, Type.GetType(&quot;System.String&quot;));
                dt.Columns[&quot;Dimension_Unit_1&quot;].MaxLength = 50;
                dt.Columns.Add(&quot;Dimension_Title_2&quot;, Type.GetType(&quot;System.String&quot;));
                dt.Columns[&quot;Dimension_Title_2&quot;].MaxLength = 100;
                dt.Columns.Add(&quot;Dimension_Unit_2&quot;, Type.GetType(&quot;System.String&quot;));
                dt.Columns[&quot;Dimension_Unit_2&quot;].MaxLength = 50;
                dt.Columns.Add(&quot;Dimension_Title_3&quot;, Type.GetType(&quot;System.String&quot;));
                dt.Columns[&quot;Dimension_Title_3&quot;].MaxLength = 100;
                dt.Columns.Add(&quot;Dimension_Unit_3&quot;, Type.GetType(&quot;System.String&quot;));
                dt.Columns[&quot;Dimension_Unit_3&quot;].MaxLength = 50;
                //dt.PrimaryKey = new DataColumn[] { dt.Columns[&quot;StandardItemID&quot;] };
                using (
                    var xlsData =
                        new OleDbDataAdapter(
                            &quot;SELECT [StandardItemID], [Dimension Title 1] AS [Dimension_Title_1], [Dimension Unit 1] AS [Dimension_Unit_1], [Dimension Title 2] AS [Dimension_Title_2], [Dimension Unit 2] AS [Dimension_Unit_2], [Dimension Title 3] AS [Dimension_Title_3], [Dimension Unit 3] AS [Dimension_Unit_3] FROM [Measurement Book$]&quot;,
                            &quot;Provider=Microsoft.Jet.OLEDB.4.0;Data Source=&quot; + filename +
                            &quot;; Extended Properties=&#39;Excel 8.0;HDR=Yes;IMEX=1&#39;&quot;))
                {
                    xlsData.Fill(dsItems, &quot;Measurement_Book&quot;);
                }

                // The import will ignore any additional columns

                // Deleting the row to import in these cases
                // 1) Item Number is blank
                // 2) Itemdescription is blank
                // 3) Unit is blank
                // 4) Section is blank
                // 5) Lumpsum is blank
                DataTable dtItem = dsItems.Tables[0];
                dtItem.Columns[LocalizationManager.GetString(KeyConstants.LOC_SECTION)].ColumnName = &quot;Section&quot;;

                for (int i = 0; i &lt; dtItem.Rows.Count; i++)
                {
                    DataRow dr = dtItem.Rows[i];
                    if ((dr[&quot;StandardItemID&quot;] == DBNull.Value) || (dr[&quot;StandardItemNo&quot;] == DBNull.Value) ||
                        (dr[&quot;Section&quot;] == DBNull.Value)
                        || (dr[&quot;StandardItemDescription&quot;] == DBNull.Value) || (dr[&quot;Unit&quot;] == DBNull.Value)
                        || (dr[&quot;Lumpsum&quot;] == DBNull.Value)
                        || ((dr[&quot;StandardItemNo&quot;] = dr[&quot;StandardItemNo&quot;].ToString2().Trim()).ToString2().Length == 0)
                        || ((dr[&quot;Section&quot;] = dr[&quot;Section&quot;].ToString2().Trim()).ToString2().Length == 0)
                        ||
                        ((dr[&quot;StandardItemDescription&quot;] = dr[&quot;StandardItemDescription&quot;].ToString2().Trim()).ToString2().
                            Length == 0)
                        || ((dr[&quot;Unit&quot;] = dr[&quot;Unit&quot;].ToString2().Trim()).ToString2().Length == 0)
                        || ((dr[&quot;Lumpsum&quot;] = dr[&quot;Lumpsum&quot;].ToString2().Trim()).ToString2().Length == 0))
                    {
                        dr.Delete(); // delete the entire blank row.
                        continue;
                    }

                    // Trim the text fields if they exceed the database field length
                    if (dr[&quot;StandardItemNo&quot;].ToString2().Length &gt; 100)
                        dr[&quot;StandardItemNo&quot;] = dr[&quot;StandardItemNo&quot;].ToString2().Substring(0, 100);

                    if (dr[&quot;Section&quot;].ToString2().Length &gt; 300)
                        dr[&quot;Section&quot;] = dr[&quot;Section&quot;].ToString2().Substring(0, 300);

                    if (dr[&quot;StandardItemDescription&quot;].ToString2().Length &gt; 300)
                        dr[&quot;StandardItemDescription&quot;] = dr[&quot;StandardItemDescription&quot;].ToString2().Substring(0, 300);

                    if (dr[&quot;Unit&quot;].ToString2().Length &gt; 50)
                        dr[&quot;Unit&quot;] = dr[&quot;Unit&quot;].ToString2().Substring(0, 50);

                    for (int j = 0; j &lt; i; j++) // Discard Duplicates
                    {
                        if ((dtItem.Rows[j].RowState != DataRowState.Deleted)
                            &amp;&amp; (dtItem.Rows[j][&quot;Section&quot;].ToString2().Equals(dr[&quot;Section&quot;]))
                            &amp;&amp;
                            (dtItem.Rows[j][&quot;StandardItemDescription&quot;].ToString2().Equals(dr[&quot;StandardItemDescription&quot;])))
                            dr.Delete();
                    }
                }
                dtItem.AcceptChanges(); // Commits any deleted rows

                DeleteResItems(dtItem, dsItems.Tables[&quot;ICAResDetails&quot;]);
                DiscardDuplicates(dsItems.Tables[&quot;ICAResDetails&quot;]);
                //Measurement Book
                DeleteResItems(dtItem, dt);
                for (int i = 0; i &lt; dt.Rows.Count; i++)
                {
                    DataRow dr = dt.Rows[i];

                    int x = 0;
                    if (dr[&quot;Dimension_Title_1&quot;] != DBNull.Value &amp;&amp; dr[&quot;Dimension_Unit_1&quot;] != DBNull.Value)
                        x += 1;
                    else
                        dr[&quot;Dimension_Title_1&quot;] = dr[&quot;Dimension_Unit_1&quot;] = DBNull.Value;

                    if (dr[&quot;Dimension_Title_2&quot;] != DBNull.Value &amp;&amp; dr[&quot;Dimension_Unit_2&quot;] != DBNull.Value)
                        x += 1;
                    else
                        dr[&quot;Dimension_Title_2&quot;] = dr[&quot;Dimension_Unit_2&quot;] = DBNull.Value;

                    if (dr[&quot;Dimension_Title_3&quot;] != DBNull.Value &amp;&amp; dr[&quot;Dimension_Unit_3&quot;] != DBNull.Value)
                        x += 1;
                    else
                        dr[&quot;Dimension_Title_3&quot;] = dr[&quot;Dimension_Unit_3&quot;] = DBNull.Value;

                    if (x &lt; 2)
                        dr.Delete();
                }
                dt.AcceptChanges();
                DiscardDuplicatesDy(dt);
                DiscardLSDimension(dtItem, dt);
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.ToString2(), Constants.MODID_LIBRARY);
                throw;
            }
        }

        private void DiscardDuplicatesDy(DataTable dt)
        {
            for (int i = 0; i &lt; dt.Rows.Count; i++)
            {
                DataRow dr = dt.Rows[i];
                for (int j = 0; j &lt; i; j++) // Discard Duplicates
                {
                    if (dt.Rows[j].RowState != DataRowState.Deleted)
                        if (dt.Rows[j][&quot;StandardItemID&quot;].ToString2().Equals(dr[&quot;StandardItemID&quot;].ToString2()))
                            dr.Delete();
                }
            }
            dt.AcceptChanges();
        }

        private void DiscardLSDimension(DataTable dtItem, DataTable dt)
        {
            //delete Dimension, if the item is LS
            for (int i = 0; i &lt; dt.Rows.Count; i++)
            {
                DataRow dr = dt.Rows[i];
                if (dr.RowState != DataRowState.Deleted)
                {
                    if (
                        dtItem.Select(
                            &quot;StandardItemID=&#39;{0}&#39; AND LumpSum=&#39;Y&#39;&quot;.Format2(dr[&quot;StandardItemID&quot;].ToString2().Replace(
                                &quot;&#39;&quot;, &quot;&#39;&#39;&quot;))).Length &gt; 0)
                        dr.Delete();
                }
            }
            dt.AcceptChanges(); // Commits any deleted rows
        }

        private void DeleteResItems(DataTable dtItem, DataTable dt)
        {
            //delete invalid rows
            for (int i = 0; i &lt; dt.Rows.Count; i++)
            {
                DataRow dr = dt.Rows[i];
                if (dr.RowState != DataRowState.Deleted)
                {
                    if (BlankRow(dr.ItemArray))
                        dr.Delete();
                    else if (dr[&quot;StandardItemID&quot;] == DBNull.Value)
                        dr.Delete();
                    else if (
                        dtItem.Select(
                            &quot;StandardItemID=&#39;{0}&#39;&quot;.Format2(dr[&quot;StandardItemID&quot;].ToString2().Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;))).
                            Length == 0)
                        dr.Delete();
                }
            }
            dt.AcceptChanges(); // Commits any deleted rows
        }

        private bool BlankRow(object[] ItemArray)
        {
            bool IsBlank = true;
            foreach (object obj in ItemArray)
            {
                if (obj != null)
                {
                    IsBlank = false;
                    break;
                }
            }
            return IsBlank;
        }

        private void DiscardDuplicates(DataTable dt)
        {
            for (int i = 0; i &lt; dt.Rows.Count; i++)
            {
                DataRow dr = dt.Rows[i];
                for (int j = 0; j &lt; i; j++) // Discard Duplicates
                {
                    if ((dt.Rows[j][&quot;StandardItemID&quot;].ToString2().Equals(dr[&quot;StandardItemID&quot;]))
                        &amp;&amp; (dt.Rows[j][&quot;Description&quot;].ToString2().Equals(dr[&quot;Description&quot;]))
                        &amp;&amp; (dt.Rows[j][&quot;ResType&quot;].ToString2().Equals(dr[&quot;ResType&quot;])))
                        dr.Delete();
                }
            }
            dt.AcceptChanges();
        }

        #endregion Import Standard Items with Item Rate Analysis

        #region Resource Items

        /// &lt;summary&gt;
        /// Gets all Resource Items
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public DataTable GetResourceItems(string additionalInfo, string resType, int startRowIdx, int maxRows,
            string sortOrder, string filterSearch)
        {
            return LibraryComponent.Instance.GetResourceItems(additionalInfo, resType, 0, startRowIdx, maxRows,
                sortOrder, filterSearch);
        }

        internal DataTable GetResourceItems(string additionalInfo, string resType, int MeasSysID, int startRowIdx,
            int maxRows, string sortOrder, string filterSearch)
        {
            return LibraryComponent.Instance.GetResourceItems(additionalInfo, resType, MeasSysID, startRowIdx, maxRows,
                sortOrder, filterSearch);
        }

        /// &lt;summary&gt;
        /// Creates a Resource Item
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;resDTO&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        internal int CreateResourceItem(ResourceItem resDTO, string resType)
        {
            return LibraryComponent.Instance.CreateResourceItem(resDTO, resType);
        }

        /// &lt;summary&gt;
        /// Updates a resource
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;resDTO&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        internal int UpdateResourceItem(ResourceItem resDTO, string resType)
        {
            return LibraryComponent.Instance.UpdateResourceItem(resDTO, resType);
        }

        /// &lt;summary&gt;
        /// Deletes the resource item
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;resourceItemID&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        internal int DeleteResourceItem(int resourceItemID, string resType)
        {
            return LibraryComponent.Instance.DeleteResourceItem(resourceItemID, resType);
        }

        internal DataTable GetLibraryResources(string resourceType)
        {
            DataSet ds = LibraryComponent.Instance.GetLibraryResources(resourceType);
            return (ds.Tables.Count &gt; 0 ? ds.Tables[0] : new DataTable());
        }

        /// &lt;summary&gt;
        ///
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;p&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public double GetResourceItemsCount(string additionalInfo, string resType, int measSysID, string sortOrder,
            string filterSearch)
        {
            return LibraryComponent.Instance.GetResourceItemsCount(additionalInfo, resType, measSysID, sortOrder,
                filterSearch);
        }

        #endregion Resource Items

        #region &quot;Checklists&quot;

        internal int CUDStages(LandManagement landDTO, string operation, string multipleIDS)
        {
            return LibraryComponent.Instance.CUDStages(landDTO, operation, multipleIDS);
        }

        internal DataTable GetStages(object startRowIdx, object maxRows, string sortOrder,
            string filterSearch, string returnAllRows)
        {
            return LibraryComponent.Instance.GetStages(startRowIdx, maxRows, sortOrder, filterSearch, returnAllRows);
        }

        internal int GetStagesCount(string filterSearch)
        {
            return LibraryComponent.Instance.GetStagesCount(filterSearch);
        }

        internal DataTable GetStage(int stageID)
        {
            return LibraryComponent.Instance.GetStage(stageID);
        }

        public int CUDActivities(LandManagement landDTO, string operation, string multipleIDS)
        {
            return LibraryComponent.Instance.CUDActivities(landDTO, operation, multipleIDS);
        }

        internal DataTable GetActivities(object startRowIdx, object maxRows, string sortOrder,
            string filterSearch, string returnAllRows)
        {
            return LibraryComponent.Instance.GetActivities(startRowIdx, maxRows, sortOrder, filterSearch, returnAllRows);
        }

        internal int GetActivitiesCount(string filterSearch)
        {
            return LibraryComponent.Instance.GetActivitiesCount(filterSearch);
        }

        public DataTable GetActivity(int activityID)
        {
            return LibraryComponent.Instance.GetActivity(activityID);
        }

        internal int CUDCheckListLinking(LandManagement landDTO, string operation, string multipleIDS)
        {
            return LibraryComponent.Instance.CUDCheckListLinking(landDTO, operation, multipleIDS);
        }

        public DataTable GetCheckLists(object startRowIdx, object maxRows, string sortOrder,
            string filterSearch, string returnAllRows)
        {
            return LibraryComponent.Instance.GetCheckLists(startRowIdx, maxRows, sortOrder, filterSearch, returnAllRows);
        }

        internal int GetCheckListsCount(string filterSearch)
        {
            return LibraryComponent.Instance.GetCheckListsCount(filterSearch);
        }

        internal DataTable[] GetCheckList(int checkListID)
        {
            return LibraryComponent.Instance.GetCheckList(checkListID);
        }

        internal int DeleteChecklistStage(string multipleIDS)
        {
            return LibraryComponent.Instance.DeleteChecklistStage(multipleIDS);
        }

        internal int GetCheckListActivitiesCount(string filterSearch)
        {
            return LibraryComponent.Instance.GetCheckListActivitiesCount(filterSearch);
        }

        public DataTable GetCheckListActivity(int activityID)
        {
            return LibraryComponent.Instance.GetCheckListActivity(activityID);
        }

        public DataTable GetChecklistActivities(object startRowIdx, object maxRows, string sortOrder,
            string filterSearch, string returnAllRows)
        {
            return LibraryComponent.Instance.GetChecklistActivities(startRowIdx, maxRows, sortOrder, filterSearch,
                returnAllRows);
        }

        public DataTable GetChecklistStages(string moduleID)
        {
            return LibraryComponent.Instance.GetChecklistStages(moduleID);
        }

        internal int DeleteChecklistFromLibrary(string checklistIDs)
        {
            return LibraryComponent.Instance.DeleteChecklistFromLibrary(checklistIDs);
        }

        internal int ChecklistCUDStages(int stageID, string name, string description, string modeuleID, string mode)
        {
            return LibraryComponent.Instance.ChecklistCUDStages(stageID, name, description, modeuleID, mode);
        }

        public void AddPrepayRecoveryRules(int recoveryId, string recoveryRuleName, string description, int prepayMode,
            double percent, double amount, string mode)
        {
            LibraryComponent.Instance.AddPrepayRecoveryRules(recoveryId, recoveryRuleName, description, prepayMode,
                percent, amount, mode);
        }

        public DataTable GetPrepaymentType()
        {
            return LibraryComponent.Instance.GetPrepaymentType();
        }

        #endregion &quot;Checklists&quot;

        #region Activities

        internal DataSet GetActivities(int MeasSysID, int startRowIdx,
            int maxRows, string sortOrder, string filterSearch)
        {
            return LibraryComponent.Instance.GetActivities(MeasSysID, startRowIdx, maxRows,
                sortOrder, filterSearch);
        }

        #endregion Activities

        ///// &lt;summary&gt;
        ///// Imports the standard items from data table
        ///// &lt;/summary&gt;
        ///// &lt;param name=&quot;dsItems&quot;&gt;&lt;/param&gt;
        ///// &lt;param name=&quot;standardTableID&quot;&gt;&lt;/param&gt;
        ///// &lt;returns&gt;&lt;/returns&gt;
        //internal int ImportStandardItems(string sItems, int standardTableID)
        //{
        //    return LibraryComponent.Instance.ImportStandardItems(sItems, standardTableID);
        //}
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[31,9,31,59,0],[36,9,36,76,0],[38,9,38,34,0],[39,9,39,10,0],[40,9,40,10,0],[43,9,43,10,1],[44,13,44,43,1],[45,13,45,14,1],[46,17,46,74,1],[47,17,47,102,1],[48,17,48,24,1],[48,26,48,33,1],[48,34,48,36,1],[48,37,48,41,1],[49,21,49,63,1],[50,13,50,14,1],[51,9,51,10,1],[56,13,56,14,0],[57,17,57,51,0],[58,21,58,111,0],[60,17,60,46,0],[61,13,61,14,0],[67,9,67,10,1],[68,13,68,36,1],[69,9,69,10,1],[72,9,72,10,1],[73,13,73,53,1],[74,9,74,10,1],[78,17,78,18,1],[78,19,78,36,1],[78,37,78,38,1],[79,17,79,18,0],[79,19,79,20,0],[84,17,84,18,1],[84,19,84,36,1],[84,37,84,38,1],[85,17,85,18,0],[85,19,85,20,0],[91,9,91,10,0],[92,13,92,90,0],[93,9,93,10,0],[96,9,96,10,0],[97,13,97,85,0],[98,9,98,10,0],[101,9,101,10,0],[102,13,102,92,0],[103,9,103,10,0],[111,9,111,10,0],[112,13,112,71,0],[113,9,113,10,0],[121,9,121,10,0],[122,13,122,54,0],[123,13,123,65,0],[124,9,124,10,0],[140,9,140,10,0],[141,13,141,54,0],[142,13,144,49,0],[145,13,145,39,0],[146,17,146,30,0],[148,13,148,86,0],[149,13,149,25,0],[150,9,150,10,0],[164,9,164,10,0],[165,13,167,59,0],[168,9,168,10,0],[176,9,176,10,0],[177,13,177,54,0],[178,13,178,96,0],[179,9,179,10,0],[187,9,187,10,0],[188,13,188,47,0],[189,13,189,71,0],[190,13,190,40,0],[191,9,191,10,0],[200,9,200,10,0],[203,13,203,63,0],[204,13,204,40,0],[205,13,205,14,0],[206,17,206,70,0],[207,17,207,24,0],[207,26,207,41,0],[207,42,207,44,0],[207,45,207,56,0],[208,21,208,105,0],[209,17,209,54,0],[210,17,210,97,0],[211,13,211,14,0],[213,13,213,62,0],[214,13,214,40,0],[215,13,215,14,0],[216,17,216,69,0],[217,17,217,24,0],[217,26,217,41,0],[217,42,217,44,0],[217,45,217,56,0],[218,21,218,105,0],[219,17,219,53,0],[220,17,220,87,0],[221,13,221,14,0],[222,9,222,10,0],[229,9,229,10,0],[230,13,230,76,0],[231,9,231,10,0],[239,9,239,10,0],[240,13,240,72,0],[241,9,241,10,0],[251,9,251,10,0],[252,13,252,98,0],[253,9,253,10,0],[261,9,261,10,0],[262,13,262,91,0],[263,9,263,10,0],[271,9,271,10,0],[272,13,272,80,0],[273,9,273,10,0],[283,9,283,10,0],[284,13,284,106,0],[285,9,285,10,0],[293,9,293,10,0],[294,13,294,77,0],[295,9,295,10,0],[304,9,304,10,0],[305,13,305,88,0],[306,9,306,10,0],[314,9,314,10,0],[315,13,315,87,0],[316,9,316,10,0],[319,9,319,10,1],[320,13,320,36,1],[323,13,323,20,1],[323,22,323,29,1],[323,30,323,32,1],[323,33,323,50,1],[324,13,324,14,1],[325,17,326,90,1],[327,17,327,56,1],[328,17,328,18,1],[329,21,329,55,1],[331,21,331,88,1],[333,21,333,62,1],[334,21,334,46,1],[335,25,335,46,1],[336,17,336,18,1],[337,13,337,14,1],[341,13,341,25,1],[342,9,342,10,1],[345,9,345,10,0],[346,13,346,118,0],[347,13,347,58,0],[348,13,348,14,0],[349,17,349,84,0],[350,21,350,59,0],[352,21,352,88,0],[355,13,355,14,0],[356,17,356,67,0],[358,9,358,10,0],[361,9,361,10,0],[362,13,362,86,0],[364,13,364,82,0],[365,17,365,29,0],[367,13,367,26,0],[368,9,368,10,0],[371,9,371,10,0],[372,13,372,86,0],[374,13,374,82,0],[375,17,375,37,0],[377,13,377,25,0],[378,9,378,10,0],[385,9,385,10,0],[386,13,386,87,0],[388,13,388,89,0],[390,13,390,20,0],[390,22,390,33,0],[390,34,390,36,0],[390,37,390,93,0],[391,13,391,14,0],[392,17,394,71,0],[396,17,397,58,0],[398,17,398,18,0],[399,21,399,79,0],[401,21,403,69,0],[404,21,404,48,0],[406,21,406,36,0],[407,21,407,22,0],[408,25,408,106,0],[409,21,409,22,0],[410,17,410,18,0],[411,13,411,14,0],[412,9,412,10,0],[417,9,417,10,0],[419,13,419,14,0],[420,17,420,60,0],[421,17,421,81,0],[422,17,422,120,0],[423,17,423,90,0],[424,17,424,71,0],[425,17,425,74,0],[426,17,426,77,0],[427,17,427,74,0],[430,21,436,78,0],[437,17,437,18,0],[438,21,438,52,0],[439,17,439,18,0],[441,17,441,57,0],[442,17,442,80,0],[443,17,443,78,0],[444,17,444,59,0],[445,17,445,71,0],[446,17,446,51,0],[447,17,447,76,0],[448,17,448,81,0],[450,17,450,76,0],[452,17,452,72,0],[453,17,453,54,0],[455,17,455,74,0],[456,17,456,65,0],[458,21,463,80,0],[464,17,464,18,0],[465,21,465,38,0],[466,17,466,18,0],[467,17,467,35,0],[469,17,469,62,0],[470,17,470,66,0],[472,21,477,80,0],[478,17,478,18,0],[479,21,479,38,0],[480,17,480,18,0],[481,17,481,35,0],[483,17,483,62,0],[484,17,484,65,0],[486,21,491,80,0],[492,17,492,18,0],[493,21,493,38,0],[494,17,494,18,0],[495,17,495,35,0],[497,17,497,62,0],[498,17,498,61,0],[500,21,505,80,0],[506,17,506,18,0],[507,21,507,38,0],[508,17,508,18,0],[509,17,509,35,0],[511,17,511,61,0],[512,17,512,80,0],[513,17,513,84,0],[514,17,514,65,0],[515,17,515,83,0],[516,17,516,63,0],[517,17,517,84,0],[518,17,518,65,0],[519,17,519,83,0],[520,17,520,63,0],[521,17,521,84,0],[522,17,522,65,0],[523,17,523,83,0],[524,17,524,63,0],[527,21,531,80,0],[532,17,532,18,0],[533,21,533,63,0],[534,17,534,18,0],[544,17,544,54,0],[545,17,545,112,0],[547,22,547,31,0],[547,33,547,54,0],[547,56,547,59,0],[548,17,548,18,0],[549,21,549,49,0],[550,21,560,105,0],[561,21,561,22,0],[562,25,562,37,0],[563,25,563,34,0],[567,21,567,71,0],[568,25,568,99,0],[570,21,570,64,0],[571,25,571,85,0],[573,21,573,80,0],[574,25,574,117,0],[576,21,576,60,0],[577,25,577,78,0],[579,26,579,35,0],[579,37,579,42,0],[579,44,579,47,0],[580,21,580,22,0],[581,25,584,123,0],[585,29,585,41,0],[586,21,586,22,0],[587,17,587,18,0],[588,17,588,40,0],[590,17,590,73,0],[591,17,591,68,0],[593,17,593,44,0],[594,22,594,31,0],[594,33,594,50,0],[594,52,594,55,0],[595,17,595,18,0],[596,21,596,45,0],[598,21,598,31,0],[599,21,599,107,0],[600,25,600,32,0],[602,25,602,89,0],[604,21,604,107,0],[605,25,605,32,0],[607,25,607,89,0],[609,21,609,107,0],[610,25,610,32,0],[612,25,612,89,0],[614,21,614,31,0],[615,25,615,37,0],[616,17,616,18,0],[617,17,617,36,0],[618,17,618,41,0],[619,17,619,48,0],[620,13,620,14,0],[621,13,621,33,0],[622,13,622,14,0],[623,17,623,97,0],[624,17,624,23,0],[626,9,626,10,0],[629,9,629,10,0],[630,18,630,27,0],[630,29,630,46,0],[630,48,630,51,0],[631,13,631,14,0],[632,17,632,41,0],[633,22,633,31,0],[633,33,633,38,0],[633,40,633,43,0],[634,17,634,18,0],[635,21,635,69,0],[636,25,636,111,0],[637,29,637,41,0],[638,17,638,18,0],[639,13,639,14,0],[640,13,640,32,0],[641,9,641,10,0],[644,9,644,10,0],[646,18,646,27,0],[646,29,646,46,0],[646,48,646,51,0],[647,13,647,14,0],[648,17,648,41,0],[649,17,649,57,0],[650,17,650,18,0],[651,21,654,57,0],[655,25,655,37,0],[656,17,656,18,0],[657,13,657,14,0],[658,13,658,32,0],[659,9,659,10,0],[662,9,662,10,0],[664,18,664,27,0],[664,29,664,46,0],[664,48,664,51,0],[665,13,665,14,0],[666,17,666,41,0],[667,17,667,57,0],[668,17,668,18,0],[669,21,669,48,0],[670,25,670,37,0],[671,26,671,67,0],[672,25,672,37,0],[673,26,676,41,0],[677,25,677,37,0],[678,17,678,18,0],[679,13,679,14,0],[680,13,680,32,0],[681,9,681,10,0],[684,9,684,10,0],[685,13,685,33,0],[686,13,686,20,0],[686,22,686,32,0],[686,33,686,35,0],[686,36,686,45,0],[687,13,687,14,0],[688,17,688,33,0],[689,17,689,18,0],[690,21,690,37,0],[691,21,691,27,0],[693,13,693,14,0],[694,13,694,28,0],[695,9,695,10,0],[698,9,698,10,0],[699,18,699,27,0],[699,29,699,46,0],[699,48,699,51,0],[700,13,700,14,0],[701,17,701,41,0],[702,22,702,31,0],[702,33,702,38,0],[702,40,702,43,0],[703,17,703,18,0],[704,21,706,86,0],[707,25,707,37,0],[708,17,708,18,0],[709,13,709,14,0],[710,13,710,32,0],[711,9,711,10,0],[723,9,723,10,0],[724,13,725,42,0],[726,9,726,10,0],[730,9,730,10,0],[731,13,732,42,0],[733,9,733,10,0],[741,9,741,10,0],[742,13,742,82,0],[743,9,743,10,0],[751,9,751,10,0],[752,13,752,82,0],[753,9,753,10,0],[761,9,761,10,0],[762,13,762,90,0],[763,9,763,10,0],[766,9,766,10,0],[767,13,767,86,0],[768,13,768,75,0],[769,9,769,10,0],[778,9,778,10,0],[779,13,780,31,0],[781,9,781,10,0],[788,9,788,10,0],[789,13,789,89,0],[790,9,790,10,0],[794,9,794,10,0],[795,13,795,118,0],[796,9,796,10,0],[799,9,799,10,0],[800,13,800,75,0],[801,9,801,10,0],[804,9,804,10,0],[805,13,805,64,0],[806,9,806,10,0],[809,9,809,10,0],[810,13,810,93,0],[811,9,811,10,0],[815,9,815,10,0],[816,13,816,122,0],[817,9,817,10,0],[820,9,820,10,0],[821,13,821,79,0],[822,9,822,10,0],[825,9,825,10,0],[826,13,826,70,0],[827,9,827,10,0],[830,9,830,10,0],[831,13,831,99,0],[832,9,832,10,0],[836,9,836,10,0],[837,13,837,122,0],[838,9,838,10,0],[841,9,841,10,0],[842,13,842,79,0],[843,9,843,10,0],[846,9,846,10,0],[847,13,847,72,0],[848,9,848,10,0],[851,9,851,10,0],[852,13,852,80,0],[853,9,853,10,0],[856,9,856,10,0],[857,13,857,88,0],[858,9,858,10,0],[861,9,861,10,0],[862,13,862,79,0],[863,9,863,10,0],[867,9,867,10,0],[868,13,869,32,0],[870,9,870,10,0],[873,9,873,10,0],[874,13,874,75,0],[875,9,875,10,0],[878,9,878,10,0],[879,13,879,87,0],[880,9,880,10,0],[883,9,883,10,0],[884,13,884,110,0],[885,9,885,10,0],[889,9,889,10,0],[890,13,891,40,0],[892,9,892,10,0],[895,9,895,10,1],[896,13,896,66,1],[897,9,897,10,1],[905,9,905,10,0],[906,13,907,42,0],[908,9,908,10,0]]);
    </script>
  </body>
</html>