<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Construction Vertical\Addon Modules\Contract Manager\Material Issue\ConcreateModels\POLIssueReportModel.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.ContractManager.BusinessLayer;
using Aurigo.AMP3.Core.AbstractModels;
using Aurigo.Brix.Platform.BusinessLayer.DTO;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Microsoft.Reporting.WebForms;
using Report = Aurigo.AMP3.Core.AbstractModels.Report;
using X = Aurigo.AMP3.Core.AbstractModels;


namespace Aurigo.Brix.Construction.ContractManager.MaterialIssueUI.ConcreateModels
{
    [ReportModelContext(Name = &quot;POLISSU&quot;, ModuleId = &quot;MATRISS&quot;)]
    public class POLIssueReportModel : ReportModel
    {
        public override string Header
        {
            get { throw new NotImplementedException(); }
        }

        public override string ReportPath
        {
            get { throw new NotImplementedException(); }
        }

        public override string ReturnURL
        {
            get { throw new NotImplementedException(); }
        }

        public override Report GetReportObject(Dictionary&lt;string, string&gt; dicFilter)
        {
            throw new NotImplementedException();
        }

        public override IEnumerable&lt;ReportParameter&gt; GetReportParameters(ReportDetails rd)
        {
            var repParameter = new List&lt;ReportParameter&gt;();
            string issuedMaterialIssueIds = &quot;&quot;;
            DataTable dtIssues = GetIssuedMaterialIssues(Request[&quot;ContractID&quot;].ToInt32_2());

            foreach (DataRow materialIssues in dtIssues.Select())
            {
                issuedMaterialIssueIds += materialIssues[&quot;Material Issue ID&quot;] + &quot;,&quot;;
            }

            if (!string.IsNullOrEmpty(rd.QueryStringParameters))
            {
                repParameter.Add(new ReportParameter(&quot;IssuedMaterialIssueIDs&quot;, issuedMaterialIssueIds));
            }
            return repParameter;
        }

        private DataTable GetIssuedMaterialIssues(int contractID)
        {
            //string filterCriteria = &quot;&quot;;
            //string mappedCompany = &quot;&quot;;
            //if (!Request[&quot;PMode&quot;].ToString().Equals(&quot;I&quot;))
            //{               
            //    DataTable dtMap = IntegrationConnectorManager.Instance.GetERPObjectMapInfo(contractID.ToString2(), AMP3Object.CONTMGT, null, AMP3Object.UNKNOWN, RegisteredEIS.AX);
            //    if (dtMap.Rows.Count &gt; 0)
            //    {
            //        filterCriteria = &quot;&lt;XMLRoot&gt;&lt;ProjId type=&#39;txt&#39;&gt;&quot; + dtMap.Rows[0][&quot;ERPId&quot;].ToString2() + &quot;&lt;/ProjId&gt;&lt;MaterialIssueStatus type=&#39;int&#39;&gt;3&lt;/MaterialIssueStatus&gt;&lt;/XMLRoot&gt;&quot;;
            //        mappedCompany = dtMap.Rows[0][&quot;ERPCompany&quot;].ToString2();
            //    }
            //    else
            //    {
            //        return new DataTable();
            //    }

            //    ConnectionFilter filter = new ConnectionFilter(filterCriteria, null, null, null, null);
            //    EISAdditionalInfo objAdditionalInfo = new EISAdditionalInfo(RegisteredEIS.AX);
            //    objAdditionalInfo.AddInfo(Constants.EIS_ADDITIONAL_INFO, mappedCompany);
            //    Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt; dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
            //    dictAdditionalInfo.Add(RegisteredEIS.AX, objAdditionalInfo);
            //    ConnectorParameters ConnectorParameters =
            //                     new ConnectorParameters(dictAdditionalInfo, MethodInfo.GetCurrentMethod(),
            //                         AMP3ObjectType.Unknown, filter, null);
            //    DataSet ds = new BrixDataSet();
            //    int count = 0;
            //    if (IntegrationConnectorManager.HandleIntegration(ConnectorParameters, ref count, ref ds, true))
            //    {
            //        DataTable dtMI = BL.Instance.GetMaterialIssuesToBeIssued(Convert.ToInt32(Request[&quot;ContractID&quot;]), &quot;Y&quot;);
            //        DataTable dtAXMI = ds.Tables[0];
            //        dtAXMI.Columns.Add(&quot;MIListId&quot;,typeof(System.Int32));
            //        foreach (DataRow drAXMI in dtAXMI.Rows)
            //        {
            //            DataRow [] drSelect = dtMI.Select(&quot;MaterialIssueID = &#39;&quot; + drAXMI[&quot;MaterialIssueID&quot;] + &quot;&#39;&quot;);
            //            if (drSelect.Length &gt; 0)
            //                drAXMI[&quot;MIListId&quot;] = drSelect[0][&quot;MIListId&quot;];
            //        }
            //        BL.Instance.UpdateMIStatusFromERPToBrix(ds.Tables[0]);
            //        return ds.Tables[0];// return count;
            //    }
            //    else
            //        return null;
            //}
            //else
            return BL.Instance.GetMaterialIssuesToBeIssued(Convert.ToInt32(Request[&quot;ContractID&quot;]), &quot;Y&quot;);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[21,17,21,18,0],[21,19,21,55,0],[26,17,26,18,0],[26,19,26,55,0],[31,17,31,18,0],[31,19,31,55,0],[35,9,35,10,0],[36,13,36,49,0],[40,9,40,10,0],[41,13,41,60,0],[42,13,42,48,0],[43,13,43,93,0],[45,13,45,20,0],[45,22,45,44,0],[45,45,45,47,0],[45,48,45,65,0],[46,13,46,14,0],[47,17,47,85,0],[48,13,48,14,0],[50,13,50,65,0],[51,13,51,14,0],[52,17,52,105,0],[53,13,53,14,0],[54,13,54,33,0],[55,9,55,10,0],[58,9,58,10,0],[102,13,102,105,0],[103,9,103,10,0]]);
    </script>
  </body>
</html>