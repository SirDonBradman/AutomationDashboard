<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Construction Vertical\Addon Modules\Contract Manager\Work Order\ConcreateModels\ACTIWOReportModel.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Globalization;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core.AbstractModels;
using Aurigo.AMP3.Core.IntegrationConnector;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.AMP3.WORKORDBL;
using Aurigo.AMP3.WORKORDDTO;
using Aurigo.Brix.Core.WebUiHelper;
using Aurigo.Brix.Platform.CoreUtilities.Utility;

namespace Aurigo.AMP3.WORKORDUI
{
    [ReportModelContext(Name = &quot;ACTI-WO&quot;, HasFilter = true, ModuleId = &quot;WORKORD&quot;)]
    public class ACTIWOReportModel : ReportModel
    {
        private readonly string equipment = LocalizationManager.GetString(KeyConstants.LOC_ICA_EQUIPMENT).ToString2();
        private readonly string manpower = LocalizationManager.GetString(KeyConstants.LOC_ICA_MANPOWER).ToString2();
        public string reportPathForAX = &quot;&quot;;

        public string workOrderID = &quot;&quot;;

        public string WorkOrderID
        {
            get { return workOrderID; }
            set { workOrderID = value; }
        }

        public override string ReportPath
        {
            get
            {
                if (ReportCode.Equals(&quot;REQFORQUOT&quot;))
                    return &quot;../Modules/WORKORD/ACTIWOReqForQuotReport.rpx&quot;;
                else
                    return &quot;../Modules/WORKORD/ACTIWOReport.rpx&quot;;
            }
        }

        public override string Header
        {
            get
            {
                if (ReportCode.Equals(&quot;REQFORQUOT&quot;))
                    return &quot;Request For Quotation Report&quot;;
                else
                    return &quot;Work Order Report&quot;;
            }
        }

        public override string ReturnURL
        {
            get
            {
                if (!string.IsNullOrEmpty(Request[&quot;ParentContext&quot;]) &amp;&amp;
                    Request[&quot;ParentContext&quot;].Equals(Constants.MODID_CONTMGT))
                    return base.ReturnURL;
                else
                    return @&quot;~/Common/BrixListPage.aspx?Context=WORKORD&amp;PID=&quot; + Request[&quot;PID&quot;] + &quot;&amp;ContractID=&quot; +
                           Request[&quot;ParentID&quot;] + &quot;&amp;ParentID=&quot; + Request[&quot;ParentID&quot;];
            }
        }

        public override bool CheckAccess(UserDetail ud)
        {
            string context = &quot;WORKORDReport&quot; + &quot;-&quot; + ReportCode;
            List&lt;string&gt; permissions = ModuleManager.Instance.GetPermissionByUserOrRole(PermissionModule, ud.UID,
                            ud.RID, Request.QueryString[&quot;PID&quot;].ToInt32_2());
            return permissions.Contains(context);
        }

        public override Report GetReportObject(Dictionary&lt;string, string&gt; dicFilter)
        {
            if (ReportCode.Equals(&quot;REQFORQUOT&quot;))
                return GetRequestForQuotationReport(dicFilter);
            else
                return GetWorkOrderReport(dicFilter);
        }

        public override BrixFilter[] GetApplyFilterLabels()
        {
            string purchId = &quot;&quot;;
            BrixFilter[] flr = null;
            DataTable dtPurchId = IntegrationConnectorManager.Instance.GetERPObjectMapInfo(Request[&quot;WOID&quot;],
                                                                                           AMP3Object.WORKORD, ParentID,
                                                                                           AMP3Object.CONTMGT,
                                                                                           RegisteredEIS.AX);
            if (dtPurchId.Rows.Count &gt; 0)
            {
                purchId = dtPurchId.Rows[0][&quot;ERPId&quot;].ToString();
                DataTable poPostingJournalID =
                    WOManager.Instance.GetAXPurchaseOrderJournals(AdditionalInfo[&quot;AXCompany&quot;].ToString(),
                                                                  Request.QueryString[WOConstants.QRY_WORKORDERID],
                                                                  Convert.ToString(ParentID));
                if (poPostingJournalID.Rows.Count &gt; 0)
                {
                    flr = new BrixFilter[2];
                    // AX Purchase Order
                    flr[0] = SetFilterAttributes(BrixFilter.Type.Text, &quot;txtAXPOID&quot;, &quot;Purchase Order&quot;);
                    flr[0].DataTextField = purchId;
                    //AX Purchase order Posting Journals
                    flr[1] = SetFilterAttributes(BrixFilter.Type.Combo, &quot;ddlAXPOPostingIds&quot;, &quot;Purchase Order Journal&quot;);
                    var filterValues = new string[poPostingJournalID.Rows.Count + 1];
                    filterValues[0] = &quot;Select,0&quot;;
                    for (int count = 1; count &lt;= poPostingJournalID.Rows.Count; count++)
                    {
                        filterValues[count] = poPostingJournalID.Rows[count - 1][&quot;PurchOrderDocNum&quot;] + &quot;,&quot; +
                                              poPostingJournalID.Rows[count - 1][&quot;PurchOrderDocNum&quot;];
                    }
                    flr[1].DataSource = GetComboDataSourceWithValues(filterValues);
                }
            }
            return flr;
        }

        internal Report GetWorkOrderReport(Dictionary&lt;string, string&gt; dicFilter)
        {
            var repObj = new Report();
            var dt = new DataTable();
            Report.RptControl[] rptctl;
            string path;
            int subRptCount = 1;
            if (!string.IsNullOrEmpty(reportPathForAX))
                repObj.ReportPath = reportPathForAX;
            else
                repObj.ReportPath = ReportPath;

            if (string.IsNullOrEmpty(workOrderID) &amp;&amp;
                !string.IsNullOrEmpty(Request.QueryString[WOConstants.QRY_WORKORDERID]))
            {
                workOrderID = Request.QueryString[WOConstants.QRY_WORKORDERID];
            }

            DataTable dtWOData = WORKORDManager.Instance.GetWOMainReport(ParentID.ToInt32_2(), workOrderID.ToInt32_2());
            if (dtWOData.Rows.Count &gt; 0 &amp;&amp; dtWOData.Rows[0][&quot;Status&quot;].ToString().Equals(&quot;Issued&quot;))
            {
                dt = GetTaxesDataTable(dicFilter);
                if (dt.Rows.Count &gt; 0)
                    subRptCount++;
            }

            var subrpt = new Report[subRptCount];
            subRptCount = 0;
            var subrptctl_0 = new Report.RptControl[10];
            subrptctl_0[0] = SetReportControlAttributes(&quot;Detail&quot;, &quot;txtSubItem&quot;, null, FormatType.UnitPrice,
                                                        ControlType.TextBox, StyleType.Detail);
            subrptctl_0[1] = SetReportControlAttributes(&quot;Detail&quot;, &quot;txtQuantity&quot;, null, FormatType.Quantity,
                                                        ControlType.TextBox, StyleType.Detail);
            subrptctl_0[2] = SetReportControlAttributes(&quot;Detail&quot;, &quot;txtContractor&quot;, ControlType.TextBox, StyleType.Detail);
            subrptctl_0[3] = SetReportControlAttributes(&quot;Detail&quot;, &quot;txtPayItemNo&quot;, ControlType.TextBox, StyleType.Detail);
            subrptctl_0[4] = SetReportControlAttributes(&quot;Detail&quot;, &quot;txtDescription&quot;, ControlType.TextBox,
                                                        StyleType.Detail);
            subrptctl_0[5] = SetReportControlAttributes(&quot;Detail&quot;, &quot;txtUnit&quot;, ControlType.TextBox, StyleType.Detail);

            subrptctl_0[6] = SetReportControlAttributes(&quot;GroupHeader1&quot;, &quot;txtActivityName&quot;, ControlType.TextBox,
                                                        StyleType.Detail);
            subrptctl_0[7] = SetReportControlAttributes(&quot;GroupHeader1&quot;, &quot;lblActivityName&quot;, &quot;Activity Name :&quot;,
                                                        FormatType.None, ControlType.Label, StyleType.Caption);
            subrptctl_0[8] = SetReportControlAttributes(&quot;GroupFooter1&quot;, &quot;txtSubTotalQty&quot;, null, FormatType.Quantity,
                                                        ControlType.TextBox, StyleType.Detail);
            subrptctl_0[9] = SetReportControlAttributes(&quot;GroupFooter1&quot;, &quot;lblSubTotal&quot;, &quot;Sub Total :&quot;, FormatType.None,
                                                        ControlType.Label, StyleType.Caption);

            path = &quot;../Modules/WORKORD/ACTIWOItems.rpx&quot;;
            subrpt[subRptCount] = SetSubReportAttributes(&quot;GrpHeader&quot;, &quot;subRptItems&quot;, subrptctl_0, path);
            subrpt[subRptCount].DataSource = WOManager.Instance.GetWOSubReport(workOrderID.ToInt32_2(),
                                                                               ParentID.ToInt32_2());
            subRptCount++;

            var subrptActivities = new Report.RptControl[5];
            subrptActivities[0] = SetReportControlAttributes(&quot;Detail&quot;, &quot;txtUnitCost&quot;, null, FormatType.UnitPrice,
                                                             ControlType.TextBox, StyleType.Detail);
            subrptActivities[1] = SetReportControlAttributes(&quot;Detail&quot;, &quot;txtAmount&quot;, null, FormatType.Amount,
                                                             ControlType.TextBox, StyleType.Detail);
            subrptActivities[2] = SetReportControlAttributes(&quot;Detail&quot;, &quot;txtQuantity&quot;, null, FormatType.Quantity,
                                                             ControlType.TextBox, StyleType.Detail);
            subrptActivities[3] = SetReportControlAttributes(&quot;Detail&quot;, &quot;txtActivityName&quot;, ControlType.TextBox,
                                                             StyleType.Detail);
            subrptActivities[4] = SetReportControlAttributes(&quot;Detail&quot;, &quot;txtUnit&quot;, ControlType.TextBox, StyleType.Detail);
            path = &quot;../Modules/WORKORD/ACTIWOActivities.rpx&quot;;
            subrpt[0] = SetSubReportAttributes(&quot;GrpHeader&quot;, &quot;SubRptActivities&quot;, subrptActivities, path);
            subrpt[0].DataSource = WOManager.Instance.GetWOSubReportforActivities(workOrderID.ToInt32_2(),
                                                                                  ParentID.ToInt32_2());

            rptctl = new Report.RptControl[58];
            rptctl[0] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;TextBox&quot;, null, FormatType.Amount, ControlType.TextBox,
                                                   StyleType.Detail);
            rptctl[1] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label7&quot;, PayItemNoAbbr, FormatType.None,
                                                   ControlType.Label, StyleType.Caption);
            rptctl[2] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;txtEndDate&quot;, null, FormatType.Date, ControlType.TextBox,
                                                   StyleType.Detail);
            rptctl[3] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;txtStartDate&quot;, null, FormatType.Date,
                                                   ControlType.TextBox, StyleType.Detail);
            rptctl[4] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;txtPrimeContractor&quot;, null, FormatType.Date,
                                                   ControlType.TextBox, StyleType.Detail);
            rptctl[5] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;lblIssuedDate&quot;, null, FormatType.Date,
                                                   ControlType.TextBox, StyleType.Detail);
            rptctl[6] = SetReportControlAttributes(&quot;ReportHeader&quot;, &quot;lblHeader&quot;, ControlType.Label, StyleType.Header);
            rptctl[7] = SetReportControlAttributes(&quot;PageHeader&quot;, &quot;Label6&quot;, ControlType.Label, StyleType.Header);
            rptctl[8] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;lblProjNamePg2&quot;, ControlType.Label,
                                                   StyleType.HeaderDetails);
            rptctl[9] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[10] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label1&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[11] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label2&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[12] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label3&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[13] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label5&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[14] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label15&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[15] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label18&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[16] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label20&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[17] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label21&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[18] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label22&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[19] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label11&quot;, ControlType.Label, StyleType.Caption);
            rptctl[20] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label17&quot;, ControlType.Label, StyleType.Caption);
            rptctl[21] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label8&quot;, ControlType.Label, StyleType.Caption);
            rptctl[22] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label12&quot;, ControlType.Label, StyleType.Caption);
            rptctl[23] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label10&quot;, ControlType.Label, StyleType.Caption);
            rptctl[24] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label13&quot;, ControlType.Label, StyleType.Caption);
            rptctl[25] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;txtContract&quot;, ControlType.TextBox, StyleType.Detail);
            rptctl[26] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;txtProjectInspector&quot;, ControlType.TextBox,
                                                    StyleType.Detail);
            rptctl[27] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;txtWorkDate&quot;, ControlType.TextBox, StyleType.Detail);
            rptctl[28] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;TextBox1&quot;, ControlType.TextBox, StyleType.Detail);
            rptctl[29] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;TextBox2&quot;, ControlType.TextBox, StyleType.Detail);
            rptctl[30] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;lblStatus&quot;, ControlType.TextBox, StyleType.Detail);
            rptctl[31] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label9&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[32] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label23&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[33] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label24&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[34] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label25&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[35] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;TextBox4&quot;, ControlType.TextBox, StyleType.Detail);
            rptctl[36] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;TextBox5&quot;, ControlType.TextBox, StyleType.Detail);
            rptctl[37] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;TextBox6&quot;, ControlType.TextBox, StyleType.Detail);
            rptctl[38] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;TextBox7&quot;, ControlType.TextBox, StyleType.Detail);
            rptctl[39] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;lblNoItems&quot;, &quot;No &quot; + ItemNameAbbr + &quot;s exist&quot;,
                                                    FormatType.None, ControlType.Label, StyleType.Detail);
            rptctl[40] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;TextBox8&quot;, ControlType.TextBox, StyleType.Detail);
            rptctl[41] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label27&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[42] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;lblNoActivities&quot;, &quot;No Activities exist&quot;,
                                                    FormatType.None, ControlType.Label, StyleType.Detail);
            rptctl[43] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;lblSummaryOfActivities&quot;, ControlType.Label,
                                                    StyleType.Caption);
            rptctl[44] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;lblActivityName&quot;, ControlType.Label, StyleType.Caption);
            rptctl[45] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;lblActUnit&quot;, ControlType.Label, StyleType.Caption);
            rptctl[46] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;lblActQuantity&quot;, ControlType.Label, StyleType.Caption);
            rptctl[47] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;lblActUnitCost&quot;, ControlType.Label, StyleType.Caption);
            rptctl[48] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;lblActAmount&quot;, ControlType.Label, StyleType.Caption);
            rptctl[49] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;lblDateIssued&quot;, ControlType.Label, StyleType.Caption);

            rptctl[50] = SetReportControlAttributes(&quot;ReportFooter&quot;, &quot;lblPreparedBy&quot;, ControlType.Label, StyleType.Caption);
            rptctl[51] = SetReportControlAttributes(&quot;ReportFooter&quot;, &quot;txtPreparedBy&quot;, ControlType.TextBox, StyleType.Detail);
            rptctl[52] = SetReportControlAttributes(&quot;ReportFooter&quot;, &quot;lblApprovedBy&quot;, ControlType.Label, StyleType.Caption);
            rptctl[53] = SetReportControlAttributes(&quot;ReportFooter&quot;, &quot;txtApprovedBy&quot;, ControlType.TextBox, StyleType.Detail);
            rptctl[54] = SetReportControlAttributes(&quot;ReportFooter&quot;, &quot;lblIssuedBy&quot;, ControlType.Label, StyleType.Caption);
            rptctl[55] = SetReportControlAttributes(&quot;ReportFooter&quot;, &quot;txtIssuedBy&quot;, ControlType.TextBox, StyleType.Detail);
            rptctl[56] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;lblExtReference&quot;, ControlType.Label, StyleType.Caption);
            rptctl[57] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;txtExtReference&quot;, ControlType.TextBox, StyleType.Detail);

            # region Work Order Taxes from Supreme

            if (dt.Rows.Count &gt; 0 &amp;&amp; dtWOData.Rows.Count &gt; 0)
            {
                var woTaxesrpt1_0 = new Report.RptControl[13];
                woTaxesrpt1_0[0] = SetReportControlAttributes(&quot;Detail&quot;, &quot;txtAXTaxCode&quot;, null, FormatType.Amount,
                                                              ControlType.TextBox, StyleType.Detail);
                woTaxesrpt1_0[1] = SetReportControlAttributes(&quot;Detail&quot;, &quot;txtAXTaxBaseAmount&quot;, null, FormatType.Amount,
                                                              ControlType.TextBox, StyleType.Detail);
                woTaxesrpt1_0[2] = SetReportControlAttributes(&quot;Detail&quot;, &quot;txtAXTaxAmount&quot;, null, FormatType.Amount,
                                                              ControlType.TextBox, StyleType.Detail);
                woTaxesrpt1_0[3] = SetReportControlAttributes(&quot;GroupHeader1&quot;, &quot;lblAXTaxCode&quot;, ControlType.TextBox,
                                                              StyleType.Caption);
                woTaxesrpt1_0[4] = SetReportControlAttributes(&quot;GroupHeader1&quot;, &quot;lblAXTaxBaseAmount&quot;, ControlType.TextBox,
                                                              StyleType.Caption);
                woTaxesrpt1_0[5] = SetReportControlAttributes(&quot;GroupHeader1&quot;, &quot;lblAXTaxAmount&quot;, ControlType.TextBox,
                                                              StyleType.Caption);
                woTaxesrpt1_0[6] = SetReportControlAttributes(&quot;GroupHeader1&quot;, &quot;lblTaxCaption&quot;, ControlType.Label,
                                                              StyleType.Caption);
                woTaxesrpt1_0[7] = SetReportControlAttributes(&quot;GroupFooter1&quot;, &quot;txtTotalAXTaxAmount&quot;, null,
                                                              FormatType.Amount, ControlType.TextBox, StyleType.Detail);
                woTaxesrpt1_0[8] = SetReportControlAttributes(&quot;GroupFooter1&quot;, &quot;lblTotalAXTaxAmount&quot;, ControlType.Label,
                                                              StyleType.Caption);
                woTaxesrpt1_0[9] = SetReportControlAttributes(&quot;GroupFooter1&quot;, &quot;lblTotalWOAmount&quot;, ControlType.Label,
                                                              StyleType.Caption);
                woTaxesrpt1_0[10] = SetReportControlAttributes(&quot;GroupFooter1&quot;, &quot;txtTotalWOAmount&quot;, null,
                                                               FormatType.Amount, ControlType.TextBox, StyleType.Detail);
                woTaxesrpt1_0[11] = SetReportControlAttributes(&quot;GroupFooter1&quot;, &quot;lblTotalAmountInclTax&quot;,
                                                               ControlType.Label, StyleType.Caption);
                woTaxesrpt1_0[12] = SetReportControlAttributes(&quot;GroupFooter1&quot;, &quot;txtTotalAmountInclTax&quot;, null,
                                                               FormatType.Amount, ControlType.TextBox, StyleType.Detail);
                path = &quot;../Modules/WORKORD/AXWOTaxes.rpx&quot;;
                subrpt[subRptCount] = SetSubReportAttributes(&quot;ReportFooter&quot;, &quot;subWOAXTaxes&quot;, woTaxesrpt1_0, path);
                dt.Columns.Add(&quot;WOAmount&quot;, typeof (Double));
                dt.Columns.Add(&quot;TotalAmount&quot;, typeof (Double));
                string amount =
                    Convert.ToDecimal(dt.Compute(&quot;sum(SourceTaxAmountCur)&quot;, &quot;&quot;)).ToString(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT,
                                                                                          CultureInfo.CurrentCulture);
                foreach (DataRow dr in dt.Rows)
                {
                    dr[&quot;TotalAmount&quot;] = Convert.ToDouble(amount) + Convert.ToDouble(dtWOData.Rows[0][&quot;EstimatedValue&quot;]);
                    dr[&quot;WOAmount&quot;] = Convert.ToDouble(dtWOData.Rows[0][&quot;EstimatedValue&quot;]);
                }
                subrpt[subRptCount].DataSource = dt;
            }

            # endregion

            repObj.RptControls = rptctl;
            repObj.SubReports = subrpt;
            repObj.DataSource = dtWOData;
            return repObj;
        }

        public DataTable GetTaxesDataTable(Dictionary&lt;string, string&gt; dicFilter)
        {
            var dtWOTaxes = new DataTable();
            if (dicFilter != null)
            {
                if (dicFilter.ContainsKey(&quot;ddlAXPOPostingIds&quot;))
                {
                    string POJournalID = Convert.ToString(dicFilter[&quot;ddlAXPOPostingIds&quot;], CultureInfo.CurrentCulture);
                    if (!POJournalID.Equals(&quot;Select&quot;))
                    {
                        DataTable dtPurchId = IntegrationConnectorManager.Instance.GetERPObjectMapInfo(workOrderID,
                                                                                                       AMP3Object.
                                                                                                           WORKORD,
                                                                                                       ParentID,
                                                                                                       AMP3Object.
                                                                                                           CONTMGT,
                                                                                                       RegisteredEIS.AX);
                        string POID = &quot;&quot;;
                        if (dtPurchId.Rows.Count &gt; 0)
                        {
                            POID = dtPurchId.Rows[0][&quot;ERPId&quot;].ToString();
                        }

                        dtWOTaxes = WOManager.Instance.GetTaxes(AdditionalInfo[&quot;AXCompany&quot;].ToString(), POID,
                                                                POJournalID, Convert.ToString(ParentID));
                    }
                    else
                        return dtWOTaxes;
                }
            }
            else
                return dtWOTaxes;
            return dtWOTaxes;
        }


        public DataTable GetComboDataSourceWithValues(string[] values)
        {
            DataTable dtTemp = new BrixDataTable();
            dtTemp.Columns.Add(&quot;Value&quot;);
            dtTemp.Columns.Add(&quot;Name&quot;);
            dtTemp.AcceptChanges();

            foreach (string value in values)
            {
                DataRow dr = dtTemp.NewRow();
                dr[0] = value.Split(&#39;,&#39;)[1];
                dr[1] = value.Split(&#39;,&#39;)[0];
                dtTemp.Rows.Add(dr);
            }
            return dtTemp;
        }


        private Report GetRequestForQuotationReport(Dictionary&lt;string, string&gt; dicFilter)
        {
            var repObj = new Report();
            Report[] subrpt;

            repObj.ReportPath = ReportPath;
            Report.RptControl[] rptctl;
            string path;

            subrpt = new Report[1];
            var subrptctl_0 = new Report.RptControl[5];
            subrptctl_0[0] = SetReportControlAttributes(&quot;Detail&quot;, &quot;TextBox4&quot;, null, FormatType.Quantity,
                                                        ControlType.TextBox, StyleType.Detail);
            subrptctl_0[1] = SetReportControlAttributes(&quot;Detail&quot;, &quot;txtContractor&quot;, ControlType.TextBox, StyleType.Detail);
            subrptctl_0[2] = SetReportControlAttributes(&quot;Detail&quot;, &quot;TextBox&quot;, ControlType.TextBox, StyleType.Detail);
            subrptctl_0[3] = SetReportControlAttributes(&quot;Detail&quot;, &quot;TextBox1&quot;, ControlType.TextBox, StyleType.Detail);
            subrptctl_0[4] = SetReportControlAttributes(&quot;Detail&quot;, &quot;TextBox3&quot;, ControlType.TextBox, StyleType.Detail);
            path = &quot;../Modules/WORKORD/ACTIWOReqForQuotItems.rpx&quot;;
            subrpt[0] = SetSubReportAttributes(&quot;GrpHeader&quot;, &quot;subRptItems&quot;, subrptctl_0, path);
            subrpt[0].DataSource = WORKORDManager.Instance.GetRFQReport(ParentID.ToInt32_2(),
                                                                        Request.QueryString[WOConstants.QRY_WORKORDERID]
                                                                            .ToInt32_2());

            //WOManager.Instance.GetWOSubReport(BrixDatatypeHelper.ToInt32_2(Request.QueryString[WOConstants.QRY_WORKORDERID]), BrixDatatypeHelper.ToInt32_2(this.ParentID));

            rptctl = new Report.RptControl[45];
            rptctl[0] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label7&quot;, PayItemNoAbbr, FormatType.None,
                                                   ControlType.Label, StyleType.Caption);
            rptctl[1] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;txtEndDate&quot;, null, FormatType.Date, ControlType.TextBox,
                                                   StyleType.Detail);
            rptctl[2] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;txtStartDate&quot;, null, FormatType.Date,
                                                   ControlType.TextBox, StyleType.Detail);
            rptctl[3] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;txtPrimeContractor&quot;, null, FormatType.Date,
                                                   ControlType.TextBox, StyleType.Detail);
            rptctl[4] = SetReportControlAttributes(&quot;ReportHeader&quot;, &quot;lblHeader&quot;, ControlType.Label, StyleType.Header);
            rptctl[5] = SetReportControlAttributes(&quot;PageHeader&quot;, &quot;Label6&quot;, ControlType.Label, StyleType.Header);
            rptctl[6] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;lblProjNamePg2&quot;, ControlType.Label,
                                                   StyleType.HeaderDetails);
            rptctl[7] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[8] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label1&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[9] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label2&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[10] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label15&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[11] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label18&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[12] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label19&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[13] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label20&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[14] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label21&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[15] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label22&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[16] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label11&quot;, ControlType.Label, StyleType.Caption);
            rptctl[17] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label17&quot;, ControlType.Label, StyleType.Caption);
            rptctl[18] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label8&quot;, ControlType.Label, StyleType.Caption);
            rptctl[19] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label10&quot;, ControlType.Label, StyleType.Caption);
            rptctl[20] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label12&quot;, ControlType.Label, StyleType.Caption);
            rptctl[21] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label13&quot;,
                                                    GlobalizationUtility.SetResource(&quot;Unit Cost&quot;, false),
                                                    FormatType.None, ControlType.Label, StyleType.Caption);
            rptctl[22] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label14&quot;,
                                                    GlobalizationUtility.SetResource(&quot;Amount&quot;, false), FormatType.None,
                                                    ControlType.Label, StyleType.Caption);
            rptctl[23] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label3&quot;,
                                                    GlobalizationUtility.SetResource(&quot;Total Amount&quot;, false),
                                                    FormatType.None, ControlType.Label, StyleType.Caption);
            rptctl[24] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;txtContract&quot;, ControlType.TextBox, StyleType.Detail);
            rptctl[25] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;txtProjectInspector&quot;, ControlType.TextBox,
                                                    StyleType.Detail);
            rptctl[26] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;txtWorkDate&quot;, ControlType.TextBox, StyleType.Detail);
            rptctl[27] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;TextBox1&quot;, ControlType.TextBox, StyleType.Detail);
            rptctl[28] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;TextBox2&quot;, ControlType.TextBox, StyleType.Detail);
            rptctl[29] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;TextBox3&quot;, ControlType.TextBox, StyleType.Detail);
            rptctl[30] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label9&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[31] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label23&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[32] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label24&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[33] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label25&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[34] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;TextBox4&quot;, ControlType.TextBox, StyleType.Detail);
            rptctl[35] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;TextBox5&quot;, ControlType.TextBox, StyleType.Detail);
            rptctl[36] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;TextBox6&quot;, ControlType.TextBox, StyleType.Detail);
            rptctl[37] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;TextBox7&quot;, ControlType.TextBox, StyleType.Detail);
            rptctl[38] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label26&quot;, &quot;No &quot; + ItemNameAbbr + &quot;s exist&quot;,
                                                    FormatType.None, ControlType.Label, StyleType.Detail);
            rptctl[39] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;TextBox8&quot;, ControlType.TextBox, StyleType.Detail);
            rptctl[40] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label27&quot;, ControlType.Label, StyleType.HeaderDetails);
            rptctl[41] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label5&quot;, &quot; With &quot; + manpower, FormatType.None,
                                                    ControlType.Label, StyleType.HeaderDetails);
            rptctl[42] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;Label28&quot;, &quot; With &quot; + equipment, FormatType.None,
                                                    ControlType.Label, StyleType.HeaderDetails);
            rptctl[43] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;TextBox9&quot;, ControlType.TextBox, StyleType.Detail);
            rptctl[44] = SetReportControlAttributes(&quot;GrpHeader&quot;, &quot;TextBox&quot;, ControlType.TextBox, StyleType.Detail);

            repObj.RptControls = rptctl;
            repObj.SubReports = subrpt;
            repObj.DataSource = WOManager.Instance.GetWOMainReport(ParentID.ToInt32_2(),
                                                                   Request.QueryString[WOConstants.QRY_WORKORDERID].
                                                                       ToInt32_2());
            return repObj;
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[20,9,20,119,0],[21,9,21,117,0],[22,9,22,44,0],[24,9,24,40,0],[28,17,28,18,0],[28,19,28,38,0],[28,39,28,40,0],[29,17,29,18,0],[29,19,29,39,0],[29,40,29,41,0],[35,13,35,14,0],[36,17,36,53,0],[37,21,37,76,0],[39,21,39,66,0],[40,13,40,14,0],[46,13,46,14,0],[47,17,47,53,0],[48,21,48,59,0],[50,21,50,48,0],[51,13,51,14,0],[57,13,57,14,0],[58,17,59,78,0],[60,21,60,43,0],[62,21,63,85,0],[64,13,64,14,0],[68,9,68,10,0],[69,13,69,65,0],[70,13,71,77,0],[72,13,72,50,0],[73,9,73,10,0],[76,9,76,10,0],[77,13,77,49,0],[78,17,78,64,0],[80,17,80,54,0],[81,9,81,10,0],[84,9,84,10,0],[85,13,85,33,0],[86,13,86,37,0],[87,13,90,110,0],[91,13,91,42,0],[92,13,92,14,0],[93,17,93,65,0],[94,17,97,95,0],[98,17,98,55,0],[99,17,99,18,0],[100,21,100,45,0],[102,21,102,103,0],[103,21,103,52,0],[105,21,105,120,0],[106,21,106,86,0],[107,21,107,50,0],[108,26,108,39,0],[108,41,108,79,0],[108,81,108,88,0],[109,21,109,22,0],[110,25,111,102,0],[112,21,112,22,0],[113,21,113,84,0],[114,17,114,18,0],[115,13,115,14,0],[116,13,116,24,0],[117,9,117,10,0],[120,9,120,10,0],[121,13,121,39,0],[122,13,122,38,0],[125,13,125,33,0],[126,13,126,56,0],[127,17,127,53,0],[129,17,129,48,0],[131,13,132,89,0],[133,13,133,14,0],[134,17,134,80,0],[135,13,135,14,0],[137,13,137,121,0],[138,13,138,99,0],[139,13,139,14,0],[140,17,140,51,0],[141,17,141,39,0],[142,21,142,35,0],[143,13,143,14,0],[145,13,145,50,0],[146,13,146,29,0],[147,13,147,57,0],[148,13,149,96,0],[150,13,151,96,0],[152,13,152,123,0],[153,13,153,122,0],[154,13,155,75,0],[156,13,156,117,0],[158,13,159,75,0],[160,13,161,112,0],[162,13,163,96,0],[164,13,165,95,0],[167,13,167,57,0],[168,13,168,105,0],[169,13,170,102,0],[171,13,171,27,0],[173,13,173,61,0],[174,13,175,101,0],[176,13,177,101,0],[178,13,179,101,0],[180,13,181,80,0],[182,13,182,122,0],[183,13,183,62,0],[184,13,184,105,0],[185,13,186,105,0],[188,13,188,48,0],[189,13,190,70,0],[191,13,192,90,0],[193,13,194,70,0],[195,13,196,91,0],[197,13,198,91,0],[199,13,200,91,0],[201,13,201,118,0],[202,13,202,113,0],[203,13,204,77,0],[205,13,205,118,0],[206,13,206,120,0],[207,13,207,120,0],[208,13,208,120,0],[209,13,209,120,0],[210,13,210,121,0],[211,13,211,121,0],[212,13,212,121,0],[213,13,213,121,0],[214,13,214,121,0],[215,13,215,115,0],[216,13,216,115,0],[217,13,217,114,0],[218,13,218,115,0],[219,13,219,115,0],[220,13,220,115,0],[221,13,221,120,0],[222,13,223,71,0],[224,13,224,120,0],[225,13,225,117,0],[226,13,226,117,0],[227,13,227,118,0],[228,13,228,120,0],[229,13,229,121,0],[230,13,230,121,0],[231,13,231,121,0],[232,13,232,117,0],[233,13,233,117,0],[234,13,234,117,0],[235,13,235,117,0],[236,13,237,107,0],[238,13,238,117,0],[239,13,239,121,0],[240,13,241,107,0],[242,13,243,72,0],[244,13,244,123,0],[245,13,245,118,0],[246,13,246,122,0],[247,13,247,122,0],[248,13,248,120,0],[249,13,249,121,0],[251,13,251,124,0],[252,13,252,125,0],[253,13,253,124,0],[254,13,254,125,0],[255,13,255,122,0],[256,13,256,123,0],[257,13,257,123,0],[258,13,258,124,0],[262,13,262,62,0],[263,13,263,14,0],[264,17,264,63,0],[265,17,266,102,0],[267,17,268,102,0],[269,17,270,102,0],[271,17,272,82,0],[273,17,274,82,0],[275,17,276,82,0],[277,17,278,82,0],[279,17,280,121,0],[281,17,282,82,0],[283,17,284,82,0],[285,17,286,122,0],[287,17,288,102,0],[289,17,290,122,0],[291,17,291,59,0],[292,17,292,115,0],[293,17,293,61,0],[294,17,294,64,0],[295,17,297,119,0],[298,17,298,24,0],[298,26,298,36,0],[298,37,298,39,0],[298,40,298,47,0],[299,17,299,18,0],[300,21,300,121,0],[301,21,301,91,0],[302,17,302,18,0],[303,17,303,53,0],[304,13,304,14,0],[308,13,308,41,0],[309,13,309,40,0],[310,13,310,42,0],[311,13,311,27,0],[312,9,312,10,0],[315,9,315,10,0],[316,13,316,45,0],[317,13,317,35,0],[318,13,318,14,0],[319,17,319,64,0],[320,17,320,18,0],[321,21,321,119,0],[322,21,322,55,0],[323,21,323,22,0],[324,25,330,122,0],[331,25,331,42,0],[332,25,332,54,0],[333,25,333,26,0],[334,29,334,74,0],[335,25,335,26,0],[337,25,338,106,0],[339,21,339,22,0],[341,25,341,42,0],[342,17,342,18,0],[343,13,343,14,0],[345,17,345,34,0],[346,13,346,30,0],[347,9,347,10,0],[351,9,351,10,0],[352,13,352,52,0],[353,13,353,41,0],[354,13,354,40,0],[355,13,355,36,0],[357,13,357,20,0],[357,22,357,34,0],[357,35,357,37,0],[357,38,357,44,0],[358,13,358,14,0],[359,17,359,46,0],[360,17,360,45,0],[361,17,361,45,0],[362,17,362,37,0],[363,13,363,14,0],[364,13,364,27,0],[365,9,365,10,0],[369,9,369,10,0],[370,13,370,39,0],[373,13,373,44,0],[377,13,377,36,0],[378,13,378,56,0],[379,13,380,96,0],[381,13,381,123,0],[382,13,382,117,0],[383,13,383,118,0],[384,13,384,118,0],[385,13,385,67,0],[386,13,386,95,0],[387,13,389,91,0],[393,13,393,48,0],[394,13,395,90,0],[396,13,397,70,0],[398,13,399,91,0],[400,13,401,91,0],[402,13,402,118,0],[403,13,403,113,0],[404,13,405,77,0],[406,13,406,118,0],[407,13,407,119,0],[408,13,408,119,0],[409,13,409,121,0],[410,13,410,121,0],[411,13,411,121,0],[412,13,412,121,0],[413,13,413,121,0],[414,13,414,121,0],[415,13,415,115,0],[416,13,416,115,0],[417,13,417,114,0],[418,13,418,115,0],[419,13,419,115,0],[420,13,422,108,0],[423,13,425,91,0],[426,13,428,108,0],[429,13,429,120,0],[430,13,431,71,0],[432,13,432,120,0],[433,13,433,117,0],[434,13,434,117,0],[435,13,435,117,0],[436,13,436,120,0],[437,13,437,121,0],[438,13,438,121,0],[439,13,439,121,0],[440,13,440,117,0],[441,13,441,117,0],[442,13,442,117,0],[443,13,443,117,0],[444,13,445,107,0],[446,13,446,117,0],[447,13,447,121,0],[448,13,449,97,0],[450,13,451,97,0],[452,13,452,117,0],[453,13,453,116,0],[455,13,455,41,0],[456,13,456,40,0],[457,13,459,85,0],[460,13,460,27,0],[461,9,461,10,0]]);
    </script>
  </body>
</html>