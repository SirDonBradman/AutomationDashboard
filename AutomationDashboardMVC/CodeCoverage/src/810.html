<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Business Layer\BL\ImportUserAccounts.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Globalization;
using System.Text;
using System.Text.RegularExpressions;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.Brix.Platform.BusinessLayer.DataAccessHelper;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Aurigo.AMP3.UserManagementBL;
using Aurigo.AMP3.ModuleManagementBL;

namespace Aurigo.AMP3.Core.BusinessLayer.BL
{
    [Context(Name = &quot;USRMGMT&quot;)]
    public class ImportUserAccounts : ImportBase
    {
        public override string NameSheet(DataTable schema)
        {
            string sheetName = null;
            foreach (DataRow dr in schema.Rows)
            {
                if (dr[&quot;TABLE_NAME&quot;].ToString() == (&quot;&#39;Users&#39;&quot;))
                {
                    sheetName = dr[&quot;TABLE_NAME&quot;].ToString();
                    break;
                }
            }
            return sheetName;
        }

        public override DataSet GetSchema(string additionalInfo)
        {
            var ctTab = new DataTable();
            var dsitems = new DataSet();
            ctTab = dsitems.Tables.Add(&quot;Users&quot;);
            ctTab.Columns.AddRange(new[]
            {
                new DataColumn(&quot;UserName&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;FirstName&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;MiddleName&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;LastName&quot;, Type.GetType(&quot;System.String&quot;)),
                // new DataColumn(&quot;Password&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;CompanyName&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;Address1&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;Address2&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;Address3&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;City&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;State&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;Country&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;Zipcode&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;Telephone&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;Email&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;Fax&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;CertNo&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;IsActive&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;MobileNo&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;AccountExpiryDate&quot;, Type.GetType(&quot;System.DateTime&quot;)),
                new DataColumn(&quot;BusinessUnit&quot;, Type.GetType(&quot;System.String&quot;)),
                //new DataColumn(&quot;SendEmail&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;IsSMS&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;WebUser&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;MobileUser&quot;, Type.GetType(&quot;System.String&quot;)),
                new DataColumn(&quot;Roles&quot;, Type.GetType(&quot;System.String&quot;)),
            });
            ctTab.Rows.Add(new object[] { null, null, null });
            return dsitems;
        }

        public override DataSet GetResult(string additionalInfo, DataSet ds, int ParentInstanceID, ImportMode mode,
            out ImportStatus status)
        {
            try
            {
                DataTable Table = ds.Tables[0];
                var xml = new StringBuilder();
                xml.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;XMLROOT&gt;\n&quot;);
                Dictionary&lt;string, string&gt; usersToEmail = new Dictionary&lt;string, string&gt;();
                foreach (DataRow dr in Table.Rows)
                {
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;Users&gt;\n&quot;);

                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                        dr[&quot;UserName&quot;] == null
                            ? string.Empty
                            : &quot;&lt;UserName&gt;&quot; + dr[&quot;UserName&quot;].ToString() + &quot;&lt;/UserName&gt;\n&quot;);
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                        dr[&quot;FirstName&quot;] == null
                            ? string.Empty
                            : &quot;&lt;FirstName&gt;&quot; + dr[&quot;FirstName&quot;].ToString() + &quot;&lt;/FirstName&gt;\n&quot;);
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                        dr[&quot;MiddleName&quot;] == null
                            ? string.Empty
                            : &quot;&lt;MiddleName&gt;&quot; + dr[&quot;MiddleName&quot;].ToString() + &quot;&lt;/MiddleName&gt;\n&quot;);
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                        dr[&quot;LastName&quot;] == null
                            ? string.Empty
                            : &quot;&lt;LastName&gt;&quot; + dr[&quot;LastName&quot;].ToString() + &quot;&lt;/LastName&gt;\n&quot;);
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                        dr[&quot;CompanyName&quot;] == null
                            ? string.Empty
                            : &quot;&lt;CompanyName&gt;&quot; + dr[&quot;CompanyName&quot;].ToString() + &quot;&lt;/CompanyName&gt;\n&quot;);
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                        dr[&quot;Address1&quot;] == null
                            ? string.Empty
                            : &quot;&lt;Address1&gt;&quot; + dr[&quot;Address1&quot;].ToString() + &quot;&lt;/Address1&gt;\n&quot;);
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                        dr[&quot;Address2&quot;] == null
                            ? string.Empty
                            : &quot;&lt;Address2&gt;&quot; + dr[&quot;UserName&quot;].ToString() + &quot;&lt;/Address2&gt;\n&quot;);
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                        dr[&quot;Address3&quot;] == null
                            ? string.Empty
                            : &quot;&lt;Address3&gt;&quot; + dr[&quot;Address3&quot;].ToString() + &quot;&lt;/Address3&gt;\n&quot;);
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                        dr[&quot;City&quot;] == null
                            ? string.Empty
                            : &quot;&lt;City&gt;&quot; + dr[&quot;City&quot;].ToString() + &quot;&lt;/City&gt;\n&quot;);
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                        dr[&quot;State&quot;] == null
                            ? string.Empty
                            : &quot;&lt;State&gt;&quot; + dr[&quot;State&quot;].ToString() + &quot;&lt;/State&gt;\n&quot;);
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                        dr[&quot;Country&quot;] == null
                            ? string.Empty
                            : &quot;&lt;Country&gt;&quot; + dr[&quot;Country&quot;].ToString() + &quot;&lt;/Country&gt;\n&quot;);
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                        dr[&quot;Zipcode&quot;] == null
                            ? string.Empty
                            : &quot;&lt;Zipcode&gt;&quot; + dr[&quot;Zipcode&quot;].ToString() + &quot;&lt;/Zipcode&gt;\n&quot;);
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                        dr[&quot;Telephone&quot;] == null
                            ? string.Empty
                            : &quot;&lt;Telephone&gt;&quot; + dr[&quot;Telephone&quot;].ToString() + &quot;&lt;/Telephone&gt;\n&quot;);
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                        dr[&quot;Email&quot;] == null
                            ? string.Empty
                            : &quot;&lt;Email&gt;&quot; + dr[&quot;Email&quot;].ToString() + &quot;&lt;/Email&gt;\n&quot;);
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                        dr[&quot;Fax&quot;] == null
                            ? string.Empty
                            : &quot;&lt;Fax&gt;&quot; + dr[&quot;Fax&quot;].ToString() + &quot;&lt;/Fax&gt;\n&quot;);
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                        dr[&quot;CertNo&quot;] == null
                            ? string.Empty
                            : &quot;&lt;CertNo&gt;&quot; + dr[&quot;CertNo&quot;].ToString() + &quot;&lt;/CertNo&gt;\n&quot;);
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                        dr[&quot;IsActive&quot;] == null
                            ? string.Empty
                            : &quot;&lt;IsActive&gt;&quot; + dr[&quot;IsActive&quot;].ToString() + &quot;&lt;/IsActive&gt;\n&quot;);
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                        dr[&quot;MobileNo&quot;] == null
                            ? string.Empty
                            : &quot;&lt;MobileNo&gt;&quot; + dr[&quot;MobileNo&quot;].ToString() + &quot;&lt;/MobileNo&gt;\n&quot;);
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                        dr[&quot;AccountExpiryDate&quot;] == null
                            ? string.Empty
                            : &quot;&lt;AccountExpiryDate&gt;&quot; + dr[&quot;AccountExpiryDate&quot;].ToString().ToMWDateTimeString_FormatDateTime() + &quot;&lt;/AccountExpiryDate&gt;\n&quot;);
                    //xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                    //                dr[&quot;SendEmail&quot;] == null
                    //                    ? string.Empty
                    //                    : &quot;&lt;SendEmail&gt;&quot; + dr[&quot;SendEmail&quot;].ToString() + &quot;&lt;/SendEmail&gt;\n&quot;);
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                      dr[&quot;BusinessUnit&quot;] == null
                          ? string.Empty
                          : &quot;&lt;BusinessUnit&gt;&quot; + dr[&quot;BusinessUnit&quot;].ToString() + &quot;&lt;/BusinessUnit&gt;\n&quot;);
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                        dr[&quot;IsSMS&quot;] == null
                            ? string.Empty
                            : &quot;&lt;IsSMS&gt;&quot; + dr[&quot;IsSMS&quot;].ToString() + &quot;&lt;/IsSMS&gt;\n&quot;);
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                        dr[&quot;WebUser&quot;] == null
                            ? string.Empty
                            : &quot;&lt;WebUser&gt;&quot; + dr[&quot;WebUser&quot;].ToString() + &quot;&lt;/WebUser&gt;\n&quot;);
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                        dr[&quot;MobileUser&quot;] == null
                            ? string.Empty
                            : &quot;&lt;MobileUser&gt;&quot; + dr[&quot;MobileUser&quot;].ToString() + &quot;&lt;/MobileUser&gt;\n&quot;);
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;{0}&quot;,
                        dr[&quot;Roles&quot;] == null
                            ? string.Empty
                            : &quot;&lt;Roles&gt;&quot; + dr[&quot;Roles&quot;].ToString() + &quot;&lt;/Roles&gt;\n&quot;);
                    xml.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;/Users&gt;\n&quot;);
                }
                xml.AppendFormat(CultureInfo.CurrentCulture, &quot;&lt;/XMLROOT&gt;&quot;);

                if (xml != null)
                {
                    ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                        StoredProcedure.usp_USRMGMTINSERTUserAccounts, null, xml.ToString());

                    status.Status = true;
                    status.Message = &quot;Records Successfully Imported!!&quot;;
                    Dictionary&lt;string, string&gt; settings = UserManager.Instance.GetUserSettings();

                    if (settings.ContainsKey(&quot;SendEmailAfterImport&quot;) &amp;&amp; settings[&quot;SendEmailAfterImport&quot;] == &quot;1&quot;)
                    {
                        string pwd = settings.ContainsKey(&quot;DefaultImportPasswordTxt&quot;) ? settings[&quot;DefaultImportPasswordTxt&quot;] : string.Empty; 
                        SendEmailNotificationToNewUsers(Table, status, pwd);
                    }
                }
                else
                {
                    status.Status = false;
                    status.Message = &quot;Import Failed.&quot;;
                }
            }
            catch (Exception)
            {
                status = new ImportStatus { Status = false, Message = &quot;An unexpected error has occurred.&quot; };
            }
            return null;
        }

        private void SendEmailNotificationToNewUsers(DataTable usersToEmail, ImportStatus status, string pwd)
        {
            string appName = AMP3ApplicationSettings.Instance.AppName;
            string link = string.Format(&quot;&lt;a href={0} &gt;Click here &lt;/a&gt; to login.&quot;, System.Configuration.ConfigurationManager.AppSettings[&quot;SiteRoot&quot;]);
            string body = &quot;&lt;table&gt;&lt;tr&gt;&lt;td&gt;Your new &quot; + appName + &quot; account login details are given below. You can now login to &quot;
                            + appName + &quot; with this User Id and Password.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td &gt;User Id: {0} &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td &gt;Password: {1}&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt; &quot; + link + &quot;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;;

            List&lt;string&gt; UsrmgmtModuleComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_USRMGMT);
            bool allowEmailLogin = UsrmgmtModuleComponents.Contains(&quot;AllowEmailLogin&quot;);
            bool result = true;
            string emails = string.Empty;
            
            string subject = &quot;New &quot; + appName + &quot; Account&quot;;
         
            foreach (DataRow u in usersToEmail.Rows)
            {
                try
                {
                    Mailer.SendEmail(u[&quot;Email&quot;].ToString(), subject, string.Format(body, allowEmailLogin? u[&quot;Email&quot;].ToString(): u[&quot;UserName&quot;].ToString(), pwd),isBodyHtml:true);
                }
                catch (Exception)
                {
                    result = false;
                    emails += u[&quot;Email&quot;].ToString() + &quot;,&quot;;
                }
            }

            if (!result)
            {
                status.Status = false;
                status.Message += &quot; Could not send email to &quot; + emails.TrimEnd(&#39;,&#39;) + &quot;.&quot;;
            }
        }

        protected override void ValidateData(string additionalInfo, DataSet dsOriginal, DataSet dsValidation,
            List&lt;string&gt; ErrorTables)
        {
            // To check duplicate record inside excel 
            if (ErrorTables.Count == 0)
            {
                for (int i = 0; i &lt; dsValidation.Tables[&quot;Users&quot;].Rows.Count; i++)
                {
                    for (int j = i + 1; j &lt; dsValidation.Tables[&quot;Users&quot;].Rows.Count; j++)
                    {
                        if (dsValidation.Tables[&quot;Users&quot;].Rows[j][0].ToString().ToLower() ==
                            dsValidation.Tables[&quot;Users&quot;].Rows[i][0].ToString().ToLower())
                        {
                            string duplicate = dsValidation.Tables[&quot;Users&quot;].Rows[i][0].ToString();
                            dsValidation.Tables[&quot;Users&quot;].Rows[j][0] = duplicate + &quot; - &quot; + ErrorIndicator +
                                                                      &quot;Duplicate Record.&quot;;

                            if (!ErrorTables.Contains(dsValidation.Tables[0].TableName))
                                ErrorTables.Add(dsValidation.Tables[0].TableName);
                        }
                    }
                }
            }

            DataTable dtRoles =
                ComponentHelper.Instance.ExecuteDataSet(StoredProcedure.usp_USRMGMTGetRolesDetails, null).Tables[0];
            bool isExists = false;
            foreach (DataRow dr in dsValidation.Tables[&quot;Users&quot;].Rows)
            {
                foreach (string role in dr[&quot;Roles&quot;].ToString().ToLower().Split(&quot;,&quot;.ToCharArray()))
                {
                    foreach (DataRow dr1 in dtRoles.Rows)
                    {
                        isExists = false;
                        if (dr1[&quot;RoleName&quot;].ToString().ToLower() == role)
                        {
                            isExists = true;
                            break;
                        }
                    }
                    if (!isExists)
                    {
                        dr[&quot;Roles&quot;] = dr[&quot;Roles&quot;] + &quot; - &quot; + ErrorIndicator + &quot;This RoleName does not exists.&quot;;

                        if (!ErrorTables.Contains(dsValidation.Tables[0].TableName))
                            ErrorTables.Add(dsValidation.Tables[0].TableName);

                        break;
                    }
                }
            }

            //Validate BU
            string tableName = &quot;COREBusinessUnit&quot;;
            string idAttribute = &quot;ID&quot;;
            string parentIdAttribute = &quot;ParentID&quot;;
            string textAttribute = &quot;Name&quot;;
            string whereClause = &quot;IsActive=1&quot;;
            bool isValid = false;
            DataTable dtBusinessUnit =  ComponentHelper.Instance.ExecuteDataSet(StoredProcedure.usp_GetDropDownTreeDataForExcelImport, null, tableName, idAttribute, parentIdAttribute, textAttribute, whereClause).Tables[0];

            //To check UserName and EmailID record of excel exists in database
            DataTable dtItems =
                ComponentHelper.Instance.ExecuteDataSet(StoredProcedure.usp_USRMGMTGetUserDetailsForExport, null).Tables
                    [0];
            foreach (DataRow dr in dsValidation.Tables[&quot;Users&quot;].Rows)
            {
                foreach (DataRow dr1 in dtItems.Rows)
                {
                    if (dr1[&quot;UserName&quot;].ToString().ToLower() == dr[&quot;UserName&quot;].ToString().ToLower())
                    {
                        dr[&quot;UserName&quot;] = dr[&quot;UserName&quot;] + &quot; - &quot; + ErrorIndicator + &quot;This UserName already exists.&quot;;

                        if (!ErrorTables.Contains(dsValidation.Tables[0].TableName))
                            ErrorTables.Add(dsValidation.Tables[0].TableName);
                    }

                    if (dr1[&quot;Email&quot;].ToString().ToLower() == dr[&quot;Email&quot;].ToString().ToLower())
                    {
                        dr[&quot;Email&quot;] = dr[&quot;Email&quot;] + &quot; - &quot; + ErrorIndicator + &quot;This EmailID already exists.&quot;;

                        if (!ErrorTables.Contains(dsValidation.Tables[0].TableName))
                            ErrorTables.Add(dsValidation.Tables[0].TableName);
                    }
                }

                //BU              
                if (dr[&quot;BusinessUnit&quot;].ToString() != null &amp;&amp; dr[&quot;BusinessUnit&quot;].ToString() != &quot;&quot;)
                {
                    isValid = false;
                    if (!dr[&quot;BusinessUnit&quot;].ToString().Contains(&quot;Duplicate&quot;) &amp;&amp;
                       !dr[&quot;BusinessUnit&quot;].ToString().Contains(&quot;exist&quot;))
                    {

                        string value = dr[&quot;BusinessUnit&quot;].ToString();
                        if (!string.IsNullOrEmpty(value) &amp;&amp; dtBusinessUnit.Rows.Count &gt; 0)
                        {
                            string invalidValues = string.Empty;
                            List&lt;String&gt; values = new List&lt;string&gt;();
                            bool hasDuplicateNodes = false;
                            foreach (string val in value.TrimEnd(&#39;,&#39;).Split(&#39;,&#39;))
                            {
                                string bu_val = val.Trim();
                                if (values.Contains(bu_val))
                                {
                                    isValid = true;
                                    hasDuplicateNodes = true;
                                    invalidValues = bu_val;
                                    break;
                                }
                                values.Add(bu_val);
                                DataRow[] rows = dtBusinessUnit.Select(&quot;Path= &#39;&quot; + bu_val.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) + &quot;&#39;&quot;);
                                if (rows == null || rows.Length &lt; 1)
                                {
                                    invalidValues += bu_val + &quot;,&quot;;
                                    isValid = false;
                                }
                                else
                                {
                                    isValid = true;
                                }
                            }
                            if (!isValid || !string.IsNullOrEmpty(invalidValues))
                            {
                                if (hasDuplicateNodes)
                                    dr[&quot;BusinessUnit&quot;] = dr[&quot;BusinessUnit&quot;] + ErrorIndicator + &quot; Duplicate Value(s)[&quot; + invalidValues + &quot;]&quot;;
                                else
                                    dr[&quot;BusinessUnit&quot;] = dr[&quot;BusinessUnit&quot;] + ErrorIndicator + &quot; Invalid Value(s)[&quot; + invalidValues.TrimEnd(&#39;,&#39;) + &quot;]&quot;;

                                if (!ErrorTables.Contains(dsValidation.Tables[0].TableName))
                                    ErrorTables.Add(dsValidation.Tables[0].TableName);
                            }
                        }
                    }
                }

                //All Regular Expression validations 
                if (dr[&quot;Telephone&quot;].ToString() != null &amp;&amp; dr[&quot;Telephone&quot;].ToString() != &quot;&quot;)
                {
                    if (!dr[&quot;Telephone&quot;].ToString().Contains(&quot;Duplicate&quot;) &amp;&amp;
                        !dr[&quot;Telephone&quot;].ToString().Contains(&quot;exist&quot;) &amp;&amp;
                        !Regex.IsMatch(dr[&quot;Telephone&quot;].ToString(), @&quot;[0-9 \-\(\)\+]+&quot;))
                    {
                        dr[&quot;Telephone&quot;] = dr[&quot;Telephone&quot;] + &quot; - &quot; + ErrorIndicator + &quot;Invalid Telephone No&quot;;
                        if (!ErrorTables.Contains(dsValidation.Tables[0].TableName))
                            ErrorTables.Add(dsValidation.Tables[0].TableName);
                    }
                }
                if (dr[&quot;Fax&quot;].ToString() != null &amp;&amp; dr[&quot;Fax&quot;].ToString() != &quot;&quot;)
                {
                    if (!dr[&quot;Fax&quot;].ToString().Contains(&quot;Duplicate&quot;) &amp;&amp; !dr[&quot;Fax&quot;].ToString().Contains(&quot;exist&quot;) &amp;&amp;
                        !Regex.IsMatch(dr[&quot;Fax&quot;].ToString(), @&quot;[0-9 \-\(\)\+]+&quot;))
                    {
                        dr[&quot;Fax&quot;] = dr[&quot;Fax&quot;] + &quot; - &quot; + ErrorIndicator + &quot;Invalid Fax No&quot;;
                        if (!ErrorTables.Contains(dsValidation.Tables[0].TableName))
                            ErrorTables.Add(dsValidation.Tables[0].TableName);
                    }
                }
                if (dr[&quot;MobileNo&quot;].ToString() != null &amp;&amp; dr[&quot;MobileNo&quot;].ToString() != &quot;&quot;)
                {
                    if (!dr[&quot;MobileNo&quot;].ToString().Contains(&quot;Duplicate&quot;) &amp;&amp; !dr[&quot;MobileNo&quot;].ToString().Contains(&quot;exist&quot;) &amp;&amp;
                        !Regex.IsMatch(dr[&quot;MobileNo&quot;].ToString(), @&quot;[0-9 \-\(\)\+]+&quot;))
                    {
                        dr[&quot;MobileNo&quot;] = dr[&quot;MobileNo&quot;] + &quot; - &quot; + ErrorIndicator + &quot;Invalid Mobile No&quot;;
                        if (!ErrorTables.Contains(dsValidation.Tables[0].TableName))
                            ErrorTables.Add(dsValidation.Tables[0].TableName);
                    }
                }
                if (!dr[&quot;Email&quot;].ToString().Contains(&quot;Duplicate&quot;) &amp;&amp; !dr[&quot;Email&quot;].ToString().Contains(&quot;exist&quot;) &amp;&amp;
                    !Regex.IsMatch(dr[&quot;Email&quot;].ToString(), @&quot;\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*&quot;))
                {
                    dr[&quot;Email&quot;] = dr[&quot;Email&quot;] + &quot; - &quot; + ErrorIndicator + &quot;Invalid Email ID&quot;;
                    if (!ErrorTables.Contains(dsValidation.Tables[0].TableName))
                        ErrorTables.Add(dsValidation.Tables[0].TableName);
                }
                if (!dr[&quot;UserName&quot;].ToString().Contains(&quot;Duplicate&quot;) &amp;&amp; !dr[&quot;UserName&quot;].ToString().Contains(&quot;exist&quot;) &amp;&amp;
                    !Regex.IsMatch(dr[&quot;UserName&quot;].ToString(), @&quot;[a-zA-Z0-9_/]+&quot;))
                {
                    dr[&quot;UserName&quot;] = dr[&quot;UserName&quot;] + &quot; - &quot; + ErrorIndicator + &quot;Invalid User Name&quot;;
                    if (!ErrorTables.Contains(dsValidation.Tables[0].TableName))
                        ErrorTables.Add(dsValidation.Tables[0].TableName);
                }
                if (!dr[&quot;FirstName&quot;].ToString().Contains(&quot;Duplicate&quot;) &amp;&amp; !dr[&quot;FirstName&quot;].ToString().Contains(&quot;exist&quot;) &amp;&amp;
                    !Regex.IsMatch(dr[&quot;FirstName&quot;].ToString(), @&quot;[a-zA-Z0-9 \-\&#39;]+&quot;))
                {
                    dr[&quot;FirstName&quot;] = dr[&quot;FirstName&quot;] + &quot; - &quot; + ErrorIndicator + &quot;Invalid First Name&quot;;
                    if (!ErrorTables.Contains(dsValidation.Tables[0].TableName))
                        ErrorTables.Add(dsValidation.Tables[0].TableName);
                }
                if (dr[&quot;MiddleName&quot;].ToString() != null &amp;&amp; dr[&quot;MiddleName&quot;].ToString() != &quot;&quot;)
                {
                    if (!dr[&quot;MiddleName&quot;].ToString().Contains(&quot;Duplicate&quot;) &amp;&amp;
                        !dr[&quot;MiddleName&quot;].ToString().Contains(&quot;exist&quot;) &amp;&amp;
                        !Regex.IsMatch(dr[&quot;MiddleName&quot;].ToString(), @&quot;[a-zA-Z0-9 \-\&#39;]+&quot;))
                    {
                        dr[&quot;MiddleName&quot;] = dr[&quot;MiddleName&quot;] + &quot; - &quot; + ErrorIndicator + &quot;Invalid Middle Name&quot;;
                        if (!ErrorTables.Contains(dsValidation.Tables[0].TableName))
                            ErrorTables.Add(dsValidation.Tables[0].TableName);
                    }
                }
                if (dr[&quot;LastName&quot;].ToString() != null &amp;&amp; dr[&quot;LastName&quot;].ToString() != &quot;&quot;)
                {
                    if (!dr[&quot;LastName&quot;].ToString().Contains(&quot;Duplicate&quot;) &amp;&amp; !dr[&quot;LastName&quot;].ToString().Contains(&quot;exist&quot;) &amp;&amp;
                        !Regex.IsMatch(dr[&quot;LastName&quot;].ToString(), @&quot;[a-zA-Z0-9 \-\&#39;]+&quot;))
                    {
                        dr[&quot;LastName&quot;] = dr[&quot;LastName&quot;] + &quot; - &quot; + ErrorIndicator + &quot;Invalid Last Name&quot;;
                        if (!ErrorTables.Contains(dsValidation.Tables[0].TableName))
                            ErrorTables.Add(dsValidation.Tables[0].TableName);
                    }
                }
                if (dr[&quot;Zipcode&quot;].ToString() != null &amp;&amp; dr[&quot;Zipcode&quot;].ToString() != &quot;&quot;)
                {
                    if (!dr[&quot;Zipcode&quot;].ToString().Contains(&quot;Duplicate&quot;) &amp;&amp; !dr[&quot;Zipcode&quot;].ToString().Contains(&quot;exist&quot;) &amp;&amp;
                        !Regex.IsMatch(dr[&quot;Zipcode&quot;].ToString(), @&quot;[0-9\-]+&quot;))
                    {
                        dr[&quot;Zipcode&quot;] = dr[&quot;Zipcode&quot;] + &quot; - &quot; + ErrorIndicator + &quot;Invalid Zipcode&quot;;
                        if (!ErrorTables.Contains(dsValidation.Tables[0].TableName))
                            ErrorTables.Add(dsValidation.Tables[0].TableName);
                    }
                }
                if (dr[&quot;State&quot;].ToString() != null &amp;&amp; dr[&quot;State&quot;].ToString() != &quot;&quot;)
                {
                    if (!dr[&quot;State&quot;].ToString().Contains(&quot;Duplicate&quot;) &amp;&amp; !dr[&quot;State&quot;].ToString().Contains(&quot;exist&quot;) &amp;&amp;
                        !Regex.IsMatch(dr[&quot;State&quot;].ToString(), @&quot;[a-zA-Z0-9 \-]+&quot;))
                    {
                        dr[&quot;State&quot;] = dr[&quot;State&quot;] + &quot; - &quot; + ErrorIndicator + &quot;Invalid State&quot;;
                        if (!ErrorTables.Contains(dsValidation.Tables[0].TableName))
                            ErrorTables.Add(dsValidation.Tables[0].TableName);
                    }
                }
                if (dr[&quot;City&quot;].ToString() != null &amp;&amp; dr[&quot;City&quot;].ToString() != &quot;&quot;)
                {
                    if (!dr[&quot;City&quot;].ToString().Contains(&quot;Duplicate&quot;) &amp;&amp; !dr[&quot;City&quot;].ToString().Contains(&quot;exist&quot;) &amp;&amp;
                        !Regex.IsMatch(dr[&quot;City&quot;].ToString(), @&quot;[a-zA-Z0-9 \-]+&quot;))
                    {
                        dr[&quot;City&quot;] = dr[&quot;City&quot;] + &quot; - &quot; + ErrorIndicator + &quot;Invalid City&quot;;
                        if (!ErrorTables.Contains(dsValidation.Tables[0].TableName))
                            ErrorTables.Add(dsValidation.Tables[0].TableName);
                    }
                }
                if (dr[&quot;Country&quot;].ToString() != null &amp;&amp; dr[&quot;Country&quot;].ToString() != &quot;&quot;)
                {
                    if (!dr[&quot;Country&quot;].ToString().Contains(&quot;Duplicate&quot;) &amp;&amp; !dr[&quot;Country&quot;].ToString().Contains(&quot;exist&quot;) &amp;&amp;
                        !Regex.IsMatch(dr[&quot;Country&quot;].ToString(), @&quot;[a-zA-Z0-9 \-]+&quot;))
                    {
                        dr[&quot;Country&quot;] = dr[&quot;Country&quot;] + &quot; - &quot; + ErrorIndicator + &quot;Invalid Country&quot;;
                        if (!ErrorTables.Contains(dsValidation.Tables[0].TableName))
                            ErrorTables.Add(dsValidation.Tables[0].TableName);
                    }
                }
                if (dr[&quot;AccountExpiryDate&quot;].ToString() == null || dr[&quot;AccountExpiryDate&quot;].ToString() == &quot;&quot;)
                {
                    dr[&quot;AccountExpiryDate&quot;] = dr[&quot;AccountExpiryDate&quot;] + &quot; - &quot; + ErrorIndicator +
                                              &quot;Invalid AccountExpiryDate&quot;;
                    if (!ErrorTables.Contains(dsValidation.Tables[0].TableName))
                        ErrorTables.Add(dsValidation.Tables[0].TableName);
                }

                //if (!Regex.IsMatch(dr[&quot;IsActive&quot;].ToString(), &quot;[Yes,No]&quot;))
                if (dr[&quot;IsActive&quot;].ToString().ToLower() != &quot;yes&quot; &amp;&amp; dr[&quot;IsActive&quot;].ToString().ToLower() != &quot;no&quot;)
                {
                    dr[&quot;IsActive&quot;] = dr[&quot;IsActive&quot;] + &quot; - &quot; + ErrorIndicator + &quot;IsActive should be Yes/No&quot;;
                    if (!ErrorTables.Contains(dsValidation.Tables[0].TableName))
                        ErrorTables.Add(dsValidation.Tables[0].TableName);
                }
                //     if (dr[&quot;SendEmail&quot;].ToString() != null &amp;&amp; dr[&quot;SendEmail&quot;].ToString() != &quot;&quot;)
                //     {
                //         if (!dr[&quot;SendEmail&quot;].ToString().Contains(&quot;Duplicate&quot;) &amp;&amp; !dr[&quot;SendEmail&quot;].ToString().Contains(&quot;exist&quot;) &amp;&amp;
                //!Regex.IsMatch(dr[&quot;SendEmail&quot;].ToString(), @&quot;[Yes,No]&quot;))
                //         {
                //             dr[0] = dr[0] + &quot; - &quot; + ErrorIndicator + &quot;SendEmail should be Yes/No&quot;;
                //             if (!ErrorTables.Contains(dsValidation.Tables[0].TableName))
                //                 ErrorTables.Add(dsValidation.Tables[0].TableName);
                //         }
                //     }
                if (dr[&quot;IsSMS&quot;].ToString() != null &amp;&amp; dr[&quot;IsSMS&quot;].ToString() != &quot;&quot;)
                {
                    if (dr[&quot;IsSMS&quot;].ToString().ToLower() != &quot;yes&quot; &amp;&amp; dr[&quot;IsSMS&quot;].ToString().ToLower() != &quot;no&quot;)
                    {
                        dr[&quot;IsSMS&quot;] = dr[&quot;IsSMS&quot;] + &quot; - &quot; + ErrorIndicator + &quot;SendEmail should be Yes/No&quot;;
                        if (!ErrorTables.Contains(dsValidation.Tables[0].TableName))
                            ErrorTables.Add(dsValidation.Tables[0].TableName);
                    }
                }
                if (dr[&quot;WebUser&quot;].ToString() != null &amp;&amp; dr[&quot;WebUser&quot;].ToString() != &quot;&quot;)
                {
                    if (dr[&quot;WebUser&quot;].ToString().ToLower() != &quot;yes&quot; &amp;&amp; dr[&quot;WebUser&quot;].ToString().ToLower() != &quot;no&quot;)
                    {
                        dr[&quot;WebUser&quot;] = dr[&quot;WebUser&quot;] + &quot; - &quot; + ErrorIndicator + &quot;WebUser should be Yes/No&quot;;
                        if (!ErrorTables.Contains(dsValidation.Tables[0].TableName))
                            ErrorTables.Add(dsValidation.Tables[0].TableName);
                    }
                }
                if (dr[&quot;MobileUser&quot;].ToString() != null &amp;&amp; dr[&quot;MobileUser&quot;].ToString() != &quot;&quot;)
                {
                    if (dr[&quot;MobileUser&quot;].ToString().ToLower() != &quot;yes&quot; &amp;&amp; dr[&quot;MobileUser&quot;].ToString().ToLower() != &quot;no&quot;)
                    {
                        dr[&quot;MobileUser&quot;] = dr[&quot;MobileUser&quot;] + &quot; - &quot; + ErrorIndicator + &quot;MobileUser should be Yes/No&quot;;
                        if (!ErrorTables.Contains(dsValidation.Tables[0].TableName))
                            ErrorTables.Add(dsValidation.Tables[0].TableName);
                    }
                }
            }
        }

        public override DataTable GetData(string additionalInfo)
        {
            throw new NotImplementedException();
        }

        public override DataTable GetTable(string additionalInfo)
        {
            throw new NotImplementedException();
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[20,9,20,10,0],[21,13,21,37,0],[22,13,22,20,0],[22,22,22,32,0],[22,33,22,35,0],[22,36,22,47,0],[23,13,23,14,0],[24,17,24,64,0],[25,17,25,18,0],[26,21,26,61,0],[27,21,27,27,0],[29,13,29,14,0],[30,13,30,30,0],[31,9,31,10,0],[34,9,34,10,1],[35,13,35,41,1],[36,13,36,41,1],[37,13,37,49,1],[38,13,66,16,1],[67,13,67,63,1],[68,13,68,28,1],[69,9,69,10,1],[73,9,73,10,0],[75,13,75,14,0],[76,17,76,48,0],[77,17,77,47,0],[78,17,78,77,0],[79,17,79,92,0],[80,17,80,24,0],[80,26,80,36,0],[80,37,80,39,0],[80,40,80,50,0],[81,17,81,18,0],[82,21,82,79,0],[84,21,87,91,0],[88,21,91,94,0],[92,21,95,97,0],[96,21,99,91,0],[100,21,103,100,0],[104,21,107,91,0],[108,21,111,91,0],[112,21,115,91,0],[116,21,119,79,0],[120,21,123,82,0],[124,21,127,88,0],[128,21,131,88,0],[132,21,135,94,0],[136,21,139,82,0],[140,21,143,76,0],[144,21,147,85,0],[148,21,151,91,0],[152,21,155,91,0],[156,21,159,154,0],[164,21,167,101,0],[168,21,171,82,0],[172,21,175,88,0],[176,21,179,97,0],[180,21,183,82,0],[184,21,184,80,0],[185,17,185,18,0],[186,17,186,76,0],[188,17,188,33,0],[189,17,189,18,0],[190,21,191,94,0],[193,21,193,42,0],[194,21,194,72,0],[195,21,195,98,0],[197,21,197,113,0],[198,21,198,22,0],[199,25,199,141,0],[200,25,200,77,0],[201,21,201,22,0],[202,17,202,18,0],[204,17,204,18,0],[205,21,205,43,0],[206,21,206,55,0],[207,17,207,18,0],[208,13,208,14,0],[209,13,209,30,0],[210,13,210,14,0],[211,17,211,109,0],[212,13,212,14,0],[213,13,213,25,0],[214,9,214,10,0],[217,9,217,10,1],[218,13,218,71,1],[219,13,219,150,1],[220,13,221,189,1],[223,13,223,121,1],[224,13,224,88,1],[225,13,225,32,1],[226,13,226,42,1],[228,13,228,60,1],[230,13,230,20,1],[230,22,230,31,1],[230,32,230,34,1],[230,35,230,52,1],[231,13,231,14,1],[233,17,233,18,1],[234,21,234,178,1],[235,17,235,18,0],[236,17,236,34,1],[237,17,237,18,1],[238,21,238,36,1],[239,21,239,59,1],[240,17,240,18,1],[241,13,241,14,1],[243,13,243,25,1],[244,13,244,14,1],[245,17,245,39,1],[246,17,246,91,1],[247,13,247,14,1],[248,9,248,10,1],[252,9,252,10,0],[254,13,254,40,0],[255,13,255,14,0],[256,22,256,31,0],[256,33,256,76,0],[256,78,256,81,0],[257,17,257,18,0],[258,26,258,39,0],[258,41,258,84,0],[258,86,258,89,0],[259,21,259,22,0],[260,25,261,90,0],[262,25,262,26,0],[263,29,263,99,0],[264,29,265,91,0],[267,29,267,89,0],[268,33,268,83,0],[269,25,269,26,0],[270,21,270,22,0],[271,17,271,18,0],[272,13,272,14,0],[274,13,275,117,0],[276,13,276,35,0],[277,13,277,20,0],[277,22,277,32,0],[277,33,277,35,0],[277,36,277,69,0],[278,13,278,14,0],[279,17,279,24,0],[279,26,279,37,0],[279,38,279,40,0],[279,41,279,98,0],[280,17,280,18,0],[281,21,281,28,0],[281,30,281,41,0],[281,42,281,44,0],[281,45,281,57,0],[282,21,282,22,0],[283,25,283,42,0],[284,25,284,74,0],[285,25,285,26,0],[286,29,286,45,0],[287,29,287,35,0],[289,21,289,22,0],[290,21,290,35,0],[291,21,291,22,0],[292,25,292,111,0],[294,25,294,85,0],[295,29,295,79,0],[297,25,297,31,0],[299,17,299,18,0],[300,13,300,14,0],[303,13,303,51,0],[304,13,304,39,0],[305,13,305,51,0],[306,13,306,43,0],[307,13,307,47,0],[308,13,308,34,0],[309,13,309,223,0],[312,13,314,25,0],[315,13,315,20,0],[315,22,315,32,0],[315,33,315,35,0],[315,36,315,69,0],[316,13,316,14,0],[317,17,317,24,0],[317,26,317,37,0],[317,38,317,40,0],[317,41,317,53,0],[318,17,318,18,0],[319,21,319,101,0],[320,21,320,22,0],[321,25,321,116,0],[323,25,323,85,0],[324,29,324,79,0],[325,21,325,22,0],[327,21,327,95,0],[328,21,328,22,0],[329,25,329,109,0],[331,25,331,85,0],[332,29,332,79,0],[333,21,333,22,0],[334,17,334,18,0],[337,17,337,98,0],[338,17,338,18,0],[339,21,339,37,0],[340,21,341,73,0],[342,21,342,22,0],[344,25,344,70,0],[345,25,345,91,0],[346,25,346,26,0],[347,29,347,65,0],[348,29,348,70,0],[349,29,349,60,0],[350,29,350,36,0],[350,38,350,48,0],[350,49,350,51,0],[350,52,350,81,0],[351,29,351,30,0],[352,33,352,60,0],[353,33,353,61,0],[354,33,354,34,0],[355,37,355,52,0],[356,37,356,62,0],[357,37,357,60,0],[358,37,358,43,0],[360,33,360,52,0],[361,33,361,117,0],[362,33,362,69,0],[363,33,363,34,0],[364,37,364,67,0],[365,37,365,53,0],[366,33,366,34,0],[368,33,368,34,0],[369,37,369,52,0],[370,33,370,34,0],[371,29,371,30,0],[372,29,372,82,0],[373,29,373,30,0],[374,33,374,55,0],[375,37,375,141,0],[377,37,377,152,0],[379,33,379,93,0],[380,37,380,87,0],[381,29,381,30,0],[382,25,382,26,0],[383,21,383,22,0],[384,17,384,18,0],[387,17,387,92,0],[388,17,388,18,0],[389,21,391,88,0],[392,21,392,22,0],[393,25,393,109,0],[394,25,394,85,0],[395,29,395,79,0],[396,21,396,22,0],[397,17,397,18,0],[398,17,398,80,0],[399,17,399,18,0],[400,21,401,82,0],[402,21,402,22,0],[403,25,403,91,0],[404,25,404,85,0],[405,29,405,79,0],[406,21,406,22,0],[407,17,407,18,0],[408,17,408,90,0],[409,17,409,18,0],[410,21,411,87,0],[412,21,412,22,0],[413,25,413,104,0],[414,25,414,85,0],[415,29,415,79,0],[416,21,416,22,0],[417,17,417,18,0],[418,17,419,108,0],[420,17,420,18,0],[421,21,421,93,0],[422,21,422,81,0],[423,25,423,75,0],[424,17,424,18,0],[425,17,426,82,0],[427,17,427,18,0],[428,21,428,100,0],[429,21,429,81,0],[430,25,430,75,0],[431,17,431,18,0],[432,17,433,86,0],[434,17,434,18,0],[435,21,435,103,0],[436,21,436,81,0],[437,25,437,75,0],[438,17,438,18,0],[439,17,439,94,0],[440,17,440,18,0],[441,21,443,91,0],[444,21,444,22,0],[445,25,445,110,0],[446,25,446,85,0],[447,29,447,79,0],[448,21,448,22,0],[449,17,449,18,0],[450,17,450,90,0],[451,17,451,18,0],[452,21,453,89,0],[454,21,454,22,0],[455,25,455,104,0],[456,25,456,85,0],[457,29,457,79,0],[458,21,458,22,0],[459,17,459,18,0],[460,17,460,88,0],[461,17,461,18,0],[462,21,463,79,0],[464,21,464,22,0],[465,25,465,100,0],[466,25,466,85,0],[467,29,467,79,0],[468,21,468,22,0],[469,17,469,18,0],[470,17,470,84,0],[471,17,471,18,0],[472,21,473,84,0],[474,21,474,22,0],[475,25,475,94,0],[476,25,476,85,0],[477,29,477,79,0],[478,21,478,22,0],[479,17,479,18,0],[480,17,480,82,0],[481,17,481,18,0],[482,21,483,83,0],[484,21,484,22,0],[485,25,485,91,0],[486,25,486,85,0],[487,29,487,79,0],[488,21,488,22,0],[489,17,489,18,0],[490,17,490,88,0],[491,17,491,18,0],[492,21,493,86,0],[494,21,494,22,0],[495,25,495,100,0],[496,25,496,85,0],[497,29,497,79,0],[498,21,498,22,0],[499,17,499,18,0],[500,17,500,108,0],[501,17,501,18,0],[502,21,503,75,0],[504,21,504,81,0],[505,25,505,75,0],[506,17,506,18,0],[509,17,509,113,0],[510,17,510,18,0],[511,21,511,108,0],[512,21,512,81,0],[513,25,513,75,0],[514,17,514,18,0],[525,17,525,84,0],[526,17,526,18,0],[527,21,527,111,0],[528,21,528,22,0],[529,25,529,107,0],[530,25,530,85,0],[531,29,531,79,0],[532,21,532,22,0],[533,17,533,18,0],[534,17,534,88,0],[535,17,535,18,0],[536,21,536,115,0],[537,21,537,22,0],[538,25,538,109,0],[539,25,539,85,0],[540,29,540,79,0],[541,21,541,22,0],[542,17,542,18,0],[543,17,543,94,0],[544,17,544,18,0],[545,21,545,121,0],[546,21,546,22,0],[547,25,547,118,0],[548,25,548,85,0],[549,29,549,79,0],[550,21,550,22,0],[551,17,551,18,0],[552,13,552,14,0],[553,9,553,10,0],[556,9,556,10,0],[557,13,557,49,0],[561,9,561,10,0],[562,13,562,49,0]]);
    </script>
  </body>
</html>