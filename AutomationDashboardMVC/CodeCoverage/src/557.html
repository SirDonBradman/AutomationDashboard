<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Construction Vertical\Main Modules\Planning Management\ConcreteModels\ProgramFormManagerModel.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core.AbstractModels;
using Aurigo.AMP3.Core.UserControls;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.AMP3.ProjectBL;
using Aurigo.AMP3.ProjectDTO;
using Aurigo.Brix.Core.WebUiHelper;
using Aurigo.Brix.Platform.BusinessLayer.AbstractModels;
using Aurigo.Brix.Platform.BusinessLayer.DataResouces;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Infragistics.WebUI.WebDataInput;
using System;
using System.Collections.Generic;
using System.Data;
using System.Globalization;
using System.Linq;
using System.Text;
using System.Web;
using System.Web.Script.Serialization;
using System.Web.UI;
using System.Web.UI.WebControls;
using Telerik.Web.UI;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.Brix.Platform.BusinessLayer.XMLForm;
using Aurigo.Common.Utility;

namespace Aurigo.Brix.Construction.PlanningManagement
{
    [Serializable]
    public class ProgramFormManagerModel : XMLFormManagerModel
    {
        #region Private Fields

        [NonSerialized]
        private BrixFormModel xmlModel;
        private List&lt;string&gt; _planningComponents;
        private Dictionary&lt;string, string&gt; _uploadedModuleList;

        private string mode;

        private int ProgramID
        {
            get
            {
                if (xmlModel != null &amp;&amp; !string.IsNullOrEmpty(xmlModel.RequestParams[&quot;InstanceID&quot;] as string))
                    return xmlModel.RequestParams[&quot;InstanceID&quot;].ToInt32_2();

                return 0;
            }
        }

        private List&lt;string&gt; PlanningModuleComponents
        {
            get
            {
                if (_planningComponents == null)
                    _planningComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_PLANING);

                return _planningComponents;
            }
        }

        private Dictionary&lt;string, string&gt; UploadedModuleList
        {
            get
            {
                if (_uploadedModuleList == null)
                    _uploadedModuleList = ModuleManager.Instance.GetModuleList();
                return _uploadedModuleList;
            }
        }

        private bool IncludeLandInPlanning
        {
            get
            {
                return PlanningModuleComponents.Contains(&quot;IncludeLandInPlanning&quot;);
            }
        }

        private bool HasLandManagementModule
        {
            get
            {
                return UploadedModuleList.ContainsKey(Constants.MODID_PLANING);
            }
        }
        #endregion

        #region Public Methods

        public static string DataTableToJSON(DataTable table)
        {
            var list = new List&lt;Dictionary&lt;string, object&gt;&gt;();

            foreach (DataRow row in table.Rows)
            {
                var dict = new Dictionary&lt;string, object&gt;();

                foreach (DataColumn col in table.Columns)
                {
                    dict[col.ColumnName] = row[col];
                }
                list.Add(dict);
            }
            JavaScriptSerializer serializer = new JavaScriptSerializer();
            return serializer.Serialize(list);
        }

        public override void OnInit(BrixFormModel model, XmlFormArgs e)
        {
            try
            {
                xmlModel = model;

                Button btnRetrieveProjects = (model.form.GetControl(&quot;btnRetrieveProjects&quot;).ControlReference[0] as Button);
                btnRetrieveProjects.Click += new EventHandler(btnRetrieveProjects_Click);
                btnRetrieveProjects.Attributes.Add(&quot;skip&quot;, &quot;1&quot;);
                base.OnInit(model, e);

                mode = HttpContext.Current.Request[&quot;Mode&quot;];

                if (model.form.Renderer.GetType().Name == &quot;HtmlRenderer&quot;)
                {
                    (model.form.page as BrixPageBase).PageTabBar.Tabs.AddRange(new[]
                                            {
                                                new Tab(&quot;Program Details&quot;, &quot;#&quot;, true),
                                                new Tab(&quot;Forecast Details&quot;),
                                                new Tab(&quot;Schedule - Gantt View&quot;)
                                            });
                    string itemPageURL;

                    Button btnGenerate = (model.form.GetControl(&quot;btnGenerate&quot;).ControlReference[0] as Button);
                    btnGenerate.Click += new EventHandler(btnGenerate_Click);
                    btnGenerate.Attributes.Add(&quot;skip&quot;, &quot;1&quot;);

                    if (mode == ModeTypes.New.ToString() || mode == ModeTypes.New.ToInt32_2().ToString())
                    {
                        btnGenerate.Visible = false;
                        (model.form.page as BrixPageBase).PageTabBar.Tabs[1].linkButton.Attributes.Add(&quot;href&quot;, &quot;#&quot;);
                        (model.form.page as BrixPageBase).PageTabBar.Tabs[1].linkButton.OnClientClick = &quot;return AutoSave(&#39;&quot; + mode + &quot;&#39;,&#39;lnkSave&#39;,&#39;1&#39;);&quot;;
                        (model.form.page as BrixPageBase).PageTabBar.Tabs[1].linkButton.PostBackUrl = string.Empty;

                        (model.form.page as BrixPageBase).PageTabBar.Tabs[2].linkButton.Attributes.Add(&quot;href&quot;, &quot;#&quot;);
                        (model.form.page as BrixPageBase).PageTabBar.Tabs[2].linkButton.OnClientClick = &quot;return AutoSave(&#39;&quot; + mode + &quot;&#39;,&#39;lnkSave&#39;,&#39;2&#39;);&quot;;
                        (model.form.page as BrixPageBase).PageTabBar.Tabs[2].linkButton.PostBackUrl = string.Empty;
                    }
                    else if (mode == ModeTypes.Edit.ToString())
                    {
                        //added this to autosave when the screen edits.
                        //(model.form.page as BrixPageBase).PageTabBar.Tabs[1].linkButton.Attributes.Add(&quot;href&quot;, &quot;#&quot;);
                        (model.form.page as BrixPageBase).PageTabBar.Tabs[1].linkButton.OnClientClick = &quot;return AutoSave(&#39;&quot; + mode + &quot;&#39;,&#39;lnkSave&#39;,&#39;1&#39;);&quot;;
                        (model.form.page as BrixPageBase).PageTabBar.Tabs[1].linkButton.PostBackUrl = string.Format(CultureInfo.CurrentCulture, &quot;~/Modules/PLANING/ProgramForecast.aspx?Context=PROGRAM&amp;PID=0&amp;ParentID=0&amp;Mode={0}&amp;InstanceID={1}&quot;, ModeTypes.Edit.ToString(), model.form.instanceID);

                        //(model.form.page as BrixPageBase).PageTabBar.Tabs[2].linkButton.Attributes.Add(&quot;href&quot;, &quot;#&quot;);
                        (model.form.page as BrixPageBase).PageTabBar.Tabs[2].linkButton.OnClientClick = &quot;return AutoSave(&#39;&quot; + mode + &quot;&#39;,&#39;lnkSave&#39;,&#39;2&#39;);&quot;;
                        string BackURL = string.Format(CultureInfo.CurrentCulture, &quot;~/Common/BrixForm.aspx?Context=PROGRAM&amp;PID=0&amp;ParentID=0&amp;Mode={0}&amp;InstanceID={1}&quot;, ModeTypes.Edit.ToString(), model.form.instanceID);
                        string encryptedURL = SecurityHelpers.Encrypt_Simple(BackURL);
                        (model.form.page as BrixPageBase).PageTabBar.Tabs[2].linkButton.PostBackUrl = string.Format(CultureInfo.CurrentCulture, &quot;~/ItemGanttView.aspx?Context=PROGRAM&amp;ParentID={0}&amp;PID=0&amp;QPID=0&amp;UID={1}&amp;ParentModuleId=BDGTEST&amp;BackURL={2}&quot;,
                        model.form.instanceID, UserDetail.GetCurrentUserDetail().UID, HttpContext.Current.Server.UrlEncode(encryptedURL));
                    }
                    else
                    {
                        btnGenerate.Visible = true;
                        itemPageURL = string.Format(CultureInfo.CurrentCulture, &quot;~/Modules/PLANING/ProgramForecast.aspx?Context=PROGRAM&amp;PID=0&amp;ParentID=0&amp;Mode={0}&amp;InstanceID={1}&quot;, mode, model.form.instanceID);

                        (model.form.page as BrixPageBase).PageTabBar.Tabs[1].linkButton.PostBackUrl = itemPageURL;

                        string BackURL = string.Format(CultureInfo.CurrentCulture, &quot;~/Common/BrixForm.aspx?Context=PROGRAM&amp;PID=0&amp;ParentID=0&amp;Mode={0}&amp;InstanceID={1}&quot;, ModeTypes.View.ToString(), model.form.instanceID);
                        string encryptedURL = SecurityHelpers.Encrypt_Simple(BackURL);
                        itemPageURL = string.Format(CultureInfo.CurrentCulture, &quot;~/ItemGanttView.aspx?Context=PROGRAM&amp;ParentID={0}&amp;PID=0&amp;QPID=0&amp;UID={1}&amp;ParentModuleId=BDGTEST&amp;BackURL={2}&quot;,
                        model.form.instanceID, UserDetail.GetCurrentUserDetail().UID, HttpContext.Current.Server.UrlEncode(encryptedURL));

                        (model.form.page as BrixPageBase).PageTabBar.Tabs[2].linkButton.PostBackUrl = itemPageURL;

                        if (mode == ModeTypes.View.ToString() || mode == ModeTypes.View.ToInt32_2().ToString())
                        {
                            CreateChart();
                        }
                    }
                }

                RadGrid projectsgrid = (model.form.GetContainer(&quot;DGPlanningProjects&quot;).ControlReference[0] as RadGrid);
                DropDownList ddlProgramCategoryType = (xmlModel.form.GetControl(&quot;ProgramCategory&quot;).ControlReference[0] as DropDownList);

                ddlProgramCategoryType.Attributes.Add(&quot;onfocus&quot;, &quot;PersistOldProgramCategory()&quot;);
                ddlProgramCategoryType.Attributes.Add(&quot;onchange&quot;, &quot;clearPlaningProjects(&#39;&quot; + projectsgrid.ClientID + &quot;&#39;)&quot;);

                if (!(HasLandManagementModule &amp;&amp; IncludeLandInPlanning))
                {
                    string script = &quot;$(document).ready(HideLandRelatedControls);&quot;;
                    RegisterClientScriptBlock(script);
                }

                List&lt;string&gt; budgetModuleComponent = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_BDGMGMT);
                if (!budgetModuleComponent.Contains(&quot;EnableCostInflation&quot;))
                {
                    string script = &quot;$(document).ready(function(){HideInflation();});&quot;;
                    RegisterClientScriptBlock(script);

                    RadGrid grid = (model.form.GetContainer(&quot;DGPlanningProjects&quot;).ControlReference[0] as RadGrid);
                    grid.MasterTableView.GetColumnSafe(&quot;InflatedAmount&quot;).Display = false;
                }
            }
            catch (Exception ex)
            {
            }
        }

        public override void OnPageLoad(BrixFormModel model, XmlFormArgs e)
        {
            try
            {
                model.form.page.ClientScript.RegisterHiddenField(&quot;hdnAutoSave&quot;, &quot;No&quot;);
                model.form.page.ClientScript.RegisterHiddenField(&quot;hdnSource&quot;, &quot;&quot;);

                WebNumericEdit LandCost = (xmlModel.form.GetControl(&quot;LandCost&quot;).ControlReference[0] as WebNumericEdit);
                xControl hdnIsLandEnabled = xmlModel.form.GetControl(&quot;hdnIsLandEnabled&quot;);

                if (!HasLandManagementModule || !IncludeLandInPlanning)
                    hdnIsLandEnabled.SetServerValue(&quot;0&quot;);
                else
                    hdnIsLandEnabled.SetServerValue(&quot;1&quot;);

                model.form.page.ClientScript.RegisterClientScriptBlock(this.GetType(), &quot;GetVisibleHideControls&quot;, &quot;$(document).ready(function(){ VisibleHideControls(&#39;&quot; + UIHelper.JavascriptEncode(hdnIsLandEnabled.GetServerValue()) + &quot;&#39;); });&quot;, true);

                RadGrid grid = (model.form.GetContainer(&quot;DGPlanningProjects&quot;).ControlReference[0] as RadGrid);
                RadGrid gridLand = (model.form.GetContainer(&quot;DGPlanningLands&quot;).ControlReference[0] as RadGrid);

                //Setting Planning Project Rad Grid ClientID
                model.form.page.ClientScript.RegisterHiddenField(&quot;HiddenDGPlanningProjects&quot;, grid.ClientID);
                //Setting Planning Land Rad Grid ClientID
                model.form.page.ClientScript.RegisterHiddenField(&quot;HiddenDGPlanningLands&quot;, gridLand.ClientID);
                //Setting Amount Digit from application settings
                //model.form.page.ClientScript.RegisterHiddenField(&quot;HiddenAmountDigits&quot;, CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT).ToString());

                //Enable ViewState=true for Planning Project Dynamic Grid
                int TotalNoOfColumns = 0;
                //  var GetTotalTableColumns = ComponentHelper.Instance.ExecuteScalar(&quot;SELECT COUNT(COLUMN_NAME) FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = &#39;PLANINGProjects&#39;&quot;);

                var GetTotalTableColumns = ComponentHelper.Instance.ExecuteScalar(PlanningManagementStoredProcedure.usp_PLANINGGetTotalTableColumn, null, &quot;PLANINGProjects&quot;);
                if (GetTotalTableColumns != null)
                {
                    TotalNoOfColumns = Convert.ToInt32(GetTotalTableColumns);
                }

                if (grid.Columns.Count &gt; TotalNoOfColumns)
                {
                    for (int i = TotalNoOfColumns + 1; i &lt; grid.Columns.Count; i++)
                    {
                        grid.Columns[i].Display = false;
                    }
                }

                //Enable ViewState=true for Planning Land Dynamic Grid

                TotalNoOfColumns = 0;
                //  GetTotalTableColumns = ComponentHelper.Instance.ExecuteScalar(&quot;SELECT COUNT(COLUMN_NAME) FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = &#39;PLANINGLands&#39;&quot;);

                GetTotalTableColumns = ComponentHelper.Instance.ExecuteScalar(PlanningManagementStoredProcedure.usp_PLANINGGetTotalTableColumn, null, &quot;PLANINGLands&quot;);
                if (GetTotalTableColumns != null)
                {
                    TotalNoOfColumns = Convert.ToInt32(GetTotalTableColumns);
                }

                if (gridLand.Columns.Count &gt; TotalNoOfColumns)
                {
                    for (int i = TotalNoOfColumns + 1; i &lt; gridLand.Columns.Count; i++)
                    {
                        gridLand.Columns[i].Display = false;
                    }
                }

                WebNumericEdit Budget = (model.form.GetControl(&quot;Budget&quot;).ControlReference[0] as WebNumericEdit);
                WebNumericEdit Remaining = (model.form.GetControl(&quot;Remaining&quot;).ControlReference[0] as WebNumericEdit);
                Budget.ClientSideEvents.ValueChange = &quot;BudgetChange(&#39;&quot; + Budget.ClientID + &quot;&#39;,&#39;&quot; + Remaining.ClientID + &quot;&#39;,&#39;&quot; + grid.ClientID + &quot;&#39;)&quot;;

                if ((!model.form.page.IsPostBack))
                {
                    WebNumericEdit SelectionProgramBudget = (xmlModel.form.GetControl(&quot;SelectionProgramBudget&quot;).ControlReference[0] as WebNumericEdit);
                    CheckBoxList SelectionIncludeOngoing = (xmlModel.form.GetControl(&quot;SelectionIncludeOngoing&quot;).ControlReference[0] as CheckBoxList);
                    //WebNumericEdit SelectionProjectValue = (xmlModel.form.GetControl(&quot;SelectionProjectValue&quot;).ControlReference[0] as WebNumericEdit);

                    WebNumericEdit SelectionMinValue = (xmlModel.form.GetControl(&quot;SelectionMaxCost&quot;).ControlReference[0] as WebNumericEdit);
                    WebNumericEdit SelectionMaxValue = (xmlModel.form.GetControl(&quot;SelectionMinCost&quot;).ControlReference[0] as WebNumericEdit);
                    SelectionProgramBudget.Text = &quot;&quot;;
                    SelectionIncludeOngoing = null;
                    SelectionMinValue.Text = &quot;&quot;;
                    SelectionMaxValue.Text = &quot;&quot;;

                    //Budget field should not be editable for an approved contigency program
                    if (!string.IsNullOrEmpty(mode) &amp;&amp; mode != &quot;New&quot;)
                    {
                        var ProgramStatus = ComponentHelper.Instance.ExecuteScalar(&quot;select top 1 CurrentStatus from WorkflowFormMapping WF INNER JOIN PLANINGMaster PM ON PM.ID=WF.FormInstanceID and WF.FormID=&#39;PROGRAM&#39; where PM.ID={0}&quot;, model.form.instanceID);
                        if (ProgramStatus != null &amp;&amp; ProgramStatus.ToString().ToUpper() == &quot;APPROVED&quot;)
                        {
                            if (Budget != null)
                                Budget.ReadOnly = true;
                        }
                    }
                }

                //Set Project Cost Values &amp; Program count
                decimal dProjectCost = 0;
                int dProjectCount = 0;
                decimal inflatedCost = 0;
                if ((grid.DataSource is DataTable) &amp;&amp; (grid.DataSource as DataTable).Rows.Count &gt; 0)
                {
                    dProjectCount = (grid.DataSource as DataTable).Rows.Count;
                    for (int i = 0; i &lt; dProjectCount; i++)
                    {
                        dProjectCost = (dProjectCost == 0) ? Convert.ToDecimal((grid.DataSource as DataTable).Rows[i][&quot;ProjectTotalCost&quot;]) : (dProjectCost + Convert.ToDecimal((grid.DataSource as DataTable).Rows[i][&quot;ProjectTotalCost&quot;]));
                        inflatedCost = (inflatedCost == 0) ? Convert.ToDecimal((grid.DataSource as DataTable).Rows[i][&quot;InflatedAmount&quot;]) : (inflatedCost + Convert.ToDecimal((grid.DataSource as DataTable).Rows[i][&quot;InflatedAmount&quot;]));
                    }
                    xmlModel.form.GetControl(&quot;ProjectCost&quot;).SetServerValue(dProjectCost);
                }
                else
                    xmlModel.form.GetControl(&quot;ProjectCost&quot;).SetServerValue(dProjectCost);

                xmlModel.form.GetControl(&quot;InflatedCost&quot;).SetServerValue(inflatedCost);
                xmlModel.form.GetControl(&quot;ProjectCount&quot;).SetServerValue(dProjectCount);

                //Set Land Values
                decimal dLandCost = 0;
                if ((gridLand.DataSource is DataTable) &amp;&amp; (gridLand.DataSource as DataTable).Rows.Count &gt; 0)
                {
                    for (int i = 0; i &lt; (gridLand.DataSource as DataTable).Rows.Count; i++)
                    {
                        dLandCost = (dLandCost == 0) ? Convert.ToDecimal((gridLand.DataSource as DataTable).Rows[i][&quot;LandValue&quot;]) : (dLandCost + Convert.ToDecimal((gridLand.DataSource as DataTable).Rows[i][&quot;LandValue&quot;]));
                    }
                    xmlModel.form.GetControl(&quot;LandCost&quot;).SetServerValue(dLandCost);
                }
                else
                    xmlModel.form.GetControl(&quot;LandCost&quot;).SetServerValue(dLandCost);
                xmlModel.form.GetControl(&quot;TotalCost&quot;).SetServerValue(dProjectCost + dLandCost);


                RadioButtonList ProgramType = (xmlModel.form.GetControl(&quot;ProgramType&quot;).ControlReference[0] as RadioButtonList);
                if (ProgramType != null &amp;&amp; ProgramType.SelectedValue == &quot;1&quot;)
                {
                    decimal dBudgetValue = (Budget.Value == null) ? 0 : Budget.Value.ToDecimal2();
                    //Set Project Cost Values
                    decimal dContingencyProjectCost = 0;
                    if ((grid.DataSource is DataTable) &amp;&amp; (grid.DataSource as DataTable).Rows.Count &gt; 0)
                    {
                        for (int i = 0; i &lt; (grid.DataSource as DataTable).Rows.Count; i++)
                        {
                            dContingencyProjectCost = (dContingencyProjectCost == 0) ? Convert.ToDecimal((grid.DataSource as DataTable).Rows[i][&quot;ProjectTotalCost&quot;]) : (dContingencyProjectCost + Convert.ToDecimal((grid.DataSource as DataTable).Rows[i][&quot;ProjectTotalCost&quot;]));
                        }
                        xmlModel.form.GetControl(&quot;Remaining&quot;).SetServerValue(dBudgetValue - dContingencyProjectCost);
                    }
                    else
                        xmlModel.form.GetControl(&quot;Remaining&quot;).SetServerValue(dBudgetValue - dContingencyProjectCost);
                }
            }
            catch (Exception ex) { };
        }

        public override void AfterSave(BrixFormModel model, XmlFormArgs e)
        {
            base.AfterSave(model, e);

            RadioButtonList ProgramType = (model.form.GetControl(&quot;ProgramType&quot;).ControlReference[0] as RadioButtonList);
            if (ProgramType.SelectedValue == &quot;1&quot;)
            {
                CreateProject(model);
            }

            PlanningManagementManager.Instance.GetProgramForecastDetails(int.Parse(model.form.instanceID));

            PlanningManagementManager.Instance.UpdateProgramDatesForProgram(int.Parse(model.form.instanceID));

            if (model.Request.Form[&quot;hdnAutoSave&quot;] == &quot;Yes&quot;)
            {
                if (mode == &quot;New&quot;)
                {
                    var sParams = new string[] { };
                    StartWorkflowInstancesFor.SimulateWorkflowAction(true, false, &quot;PROGRAM&quot;, model.form.instanceID, &quot;0&quot;, &quot;0&quot;,
                        &quot;Draft Stage Reached&quot;, &quot;None&quot;, 1, &quot;&quot;, sParams);
                }

                mode = (mode == &quot;New&quot;) ? &quot;Edit&quot; : mode; //once saved change the mode to edit .
                if (mode != &quot;Edit&quot;)
                    return;
                string itemPageURL = &quot;&quot;;
                if (model.Request.Form[&quot;hdnSource&quot;] == &quot;2&quot;)
                {
                    string BackURL = string.Format(CultureInfo.CurrentCulture, &quot;~/Common/BrixForm.aspx?Context=PROGRAM&amp;PID=0&amp;ParentID=0&amp;Mode={0}&amp;InstanceID={1}&quot;, mode, model.form.instanceID);
                    string encryptedURL = SecurityHelpers.Encrypt_Simple(BackURL);
                    itemPageURL = string.Format(CultureInfo.CurrentCulture, &quot;~/ItemGanttView.aspx?Context=PROGRAM&amp;ParentID={0}&amp;PID=0&amp;QPID=0&amp;UID={1}&amp;ParentModuleId=BDGTEST&amp;BackURL={2}&quot;,
                    model.form.instanceID, UserDetail.GetCurrentUserDetail().UID, HttpContext.Current.Server.UrlEncode(encryptedURL));
                    model.Response.Redirect(itemPageURL);
                }
                else
                {
                    itemPageURL = string.Format(CultureInfo.CurrentCulture, &quot;~/Modules/PLANING/ProgramForecast.aspx?Context=PROGRAM&amp;PID=0&amp;ParentID=0&amp;Mode={0}&amp;InstanceID={1}&quot;,
                    mode, model.form.instanceID);

                    model.Response.Redirect(itemPageURL);
                }
            }

            Dictionary&lt;string, Type&gt; dicObj = AfterSaveRecordModel.GetModelObjects();

            foreach (KeyValuePair&lt;string, Type&gt; kvp in dicObj)
            {
                var Savemodel = AfterSaveRecordModel.GetInstance(kvp.Key);
                if (Savemodel != null)
                    Savemodel.SaveDetails(model.form.instanceID, null, null, &quot;SAVE_PROGRAM&quot;);
            }
        }

        public override void BeforeSave(BrixFormModel model, XmlFormArgs e)
        {
            try
            {
                RadGrid dgPlanningProjects = (model.form.GetContainer(&quot;DGPlanningProjects&quot;).ControlReference[0] as RadGrid);
                RadioButtonList ProgramType = (model.form.GetControl(&quot;ProgramType&quot;).ControlReference[0] as RadioButtonList);
                if (ProgramType.SelectedValue == &quot;1&quot;)
                {
                    WebNumericEdit Budget = (model.form.GetControl(&quot;Budget&quot;).ControlReference[0] as WebNumericEdit);
                    WebNumericEdit Remaining = (model.form.GetControl(&quot;Remaining&quot;).ControlReference[0] as WebNumericEdit);
                    decimal dGetTotalBudget = (string.IsNullOrEmpty(Budget.Text)) ? 0 : Convert.ToDecimal(Budget.Text);

                    //Remove rows from the grid where ProjectID is null or empty.
                    if ((dgPlanningProjects.DataSource is DataSet) &amp;&amp; (dgPlanningProjects.DataSource as DataSet).Tables.Count &gt; 0)
                    {
                        dgPlanningProjects.DataSource = (dgPlanningProjects.DataSource as DataSet).Tables[0].Rows.OfType&lt;DataRow&gt;().Where(x =&gt; !string.IsNullOrEmpty(Convert.ToString(x[&quot;ProjectID&quot;]))).CopyToDataTable();
                        dgPlanningProjects.DataBind();
                    }

                    decimal dGetProjectTotalFromGrid = 0;
                    foreach (var row in MWGrid.GetRows(dgPlanningProjects))
                    {
                        if (!string.IsNullOrEmpty(MWGrid.GetCellValue(row, &quot;ProjectTotalCost&quot;)))
                        {
                            dGetProjectTotalFromGrid += Convert.ToDecimal(MWGrid.GetCellValue(row, &quot;ProjectTotalCost&quot;));
                        }
                    }
                    if (dGetProjectTotalFromGrid &gt; dGetTotalBudget)
                        throw new Exception(&quot;Cumulative Cost of the Project(s) exceeds the Budget.&quot;);

                    model.form.GetControl(&quot;Remaining&quot;).SetServerValue(dGetTotalBudget - dGetProjectTotalFromGrid);
                }
                else
                {
                    RadGrid grid = (model.form.GetContainer(&quot;DGPlanningProjects&quot;).ControlReference[0] as RadGrid);
                    RadGrid gridLand = (model.form.GetContainer(&quot;DGPlanningLands&quot;).ControlReference[0] as RadGrid);

                    //Set Project Cost Values
                    decimal dProjectCost = 0;
                    decimal inflatedCost = 0;
                    if ((grid.DataSource is DataTable) &amp;&amp; (grid.DataSource as DataTable).Rows.Count &gt; 0)
                    {
                        for (int i = 0; i &lt; (grid.DataSource as DataTable).Rows.Count; i++)
                        {
                            dProjectCost = (dProjectCost == 0) ? Convert.ToDecimal((grid.DataSource as DataTable).Rows[i][&quot;ProjectTotalCost&quot;]) : (dProjectCost + Convert.ToDecimal((grid.DataSource as DataTable).Rows[i][&quot;ProjectTotalCost&quot;]));
                            inflatedCost = (inflatedCost == 0) ? Convert.ToDecimal((grid.DataSource as DataTable).Rows[i][&quot;InflatedAmount&quot;]) : (inflatedCost + Convert.ToDecimal((grid.DataSource as DataTable).Rows[i][&quot;InflatedAmount&quot;]));
                        }
                        xmlModel.form.GetControl(&quot;ProjectCost&quot;).SetServerValue(dProjectCost);
                        xmlModel.form.GetControl(&quot;ProjectCount&quot;).SetServerValue((grid.DataSource as DataTable).Rows.Count);
                    }
                    else
                    {
                        xmlModel.form.GetControl(&quot;ProjectCost&quot;).SetServerValue(dProjectCost);
                        xmlModel.form.GetControl(&quot;ProjectCount&quot;).SetServerValue(0);
                    }

                    xmlModel.form.GetControl(&quot;InflatedCost&quot;).SetServerValue(inflatedCost);

                    //Set Land Values
                    decimal dLandCost = 0;
                    if ((gridLand.DataSource is DataTable) &amp;&amp; (gridLand.DataSource as DataTable).Rows.Count &gt; 0)
                    {
                        for (int i = 0; i &lt; (gridLand.DataSource as DataTable).Rows.Count; i++)
                        {
                            dLandCost = (dLandCost == 0) ? Convert.ToDecimal((gridLand.DataSource as DataTable).Rows[i][&quot;LandValue&quot;]) : (dLandCost + Convert.ToDecimal((gridLand.DataSource as DataTable).Rows[i][&quot;LandValue&quot;]));
                        }
                        xmlModel.form.GetControl(&quot;LandCost&quot;).SetServerValue(dLandCost);
                    }
                    else
                        xmlModel.form.GetControl(&quot;LandCost&quot;).SetServerValue(dLandCost);
                    xmlModel.form.GetControl(&quot;TotalCost&quot;).SetServerValue(dProjectCost + dLandCost);
                    ////Land Value

                    //RadGrid dgPlanningLands = (xmlModel.form.GetContainer(&quot;DGPlanningProjects&quot;).ControlReference[0] as RadGrid);
                    //decimal dGetLandValeFromGrid = 0;
                    //if ((dgPlanningLands.DataSource is DataTable) &amp;&amp; (dgPlanningLands.DataSource as DataTable).Rows.Count &gt; 0)
                    //{
                    //    dgPlanningLands.DataSource = (dgPlanningLands.DataSource as DataTable).Rows.OfType&lt;DataRow&gt;().Where(x =&gt; !string.IsNullOrEmpty(Convert.ToString(x[&quot;LandID&quot;]))).CopyToDataTable();
                    //    dgPlanningLands.DataBind();
                    //}

                    //foreach (var row in MWGrid.GetRows(dgPlanningLands))
                    //{
                    //    if (!string.IsNullOrEmpty(MWGrid.GetCellValue(row, &quot;LandValue&quot;)))
                    //    {
                    //        dGetLandValeFromGrid += Convert.ToDecimal(MWGrid.GetCellValue(row, &quot;LandValue&quot;));
                    //    }
                    //}

                    //model.form.GetControl(&quot;ProjectCost&quot;).SetServerValue(dGetProjectTotalFromGrid);
                    //model.form.GetControl(&quot;LandCost&quot;).SetServerValue(dGetLandValeFromGrid);
                    //model.form.GetControl(&quot;TotalCost&quot;).SetServerValue(dGetProjectTotalFromGrid + dGetLandValeFromGrid);
                }
                base.BeforeSave(model, e);
                e.IsValid = true;
                e.ExecuteBase = true;
            }
            catch (Exception ex)
            {
                e.IsValid = false;
                e.ExecuteBase = false;
                e.ErrorMessage = ex.Message;
            }
        }

        public override void AfterCustomizeToolbar(BrixFormModel model, ToolBar MainToolBar, XmlFormArgs e)
        {
            RadioButtonList ProgramType = (model.form.GetControl(&quot;ProgramType&quot;).ControlReference[0] as RadioButtonList);

            string WFStatus = PlanningManagementManager.Instance.GetPlanningStatus(model.form.instanceID.ToInt32_2(), &quot;PROGRAM&quot;);
            if ((WFStatus.ToUpper() == &quot;APPROVED&quot; || WFStatus.ToUpper() == &quot;CLOSED&quot;) &amp;&amp; ProgramType.SelectedValue == &quot;0&quot;)
            {
                MainToolBar.HideMenu(&quot;lnkSave&quot;);
            }
            if (WFStatus.ToUpper() == &quot;SUBMITTED&quot; &amp;&amp; MainToolBar.GetMenuReference(&quot;lnkSave&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkSave&quot;).Hide();
            }

            base.AfterCustomizeToolbar(model, MainToolBar, e);
        }

        #endregion

        #region Protected Methods

        #endregion

        #region Private Methods

        private void btnGenerate_Click(object sender, EventArgs e)
        {
            Button btnGen = (sender as Button);
            var ProgramStatus = PlanningManagementManager.Instance.GetPlanningStatus(ProgramID, &quot;PROGRAM&quot;);
            if (ProgramStatus != null &amp;&amp; ProgramStatus.ToString().ToUpper() == &quot;APPROVED&quot;)
            {
                if (btnGen != null)
                    btnGen.Enabled = false;
            }
            CreateChart();
        }

        private void CreateChart()
        {
            try
            {
                Panel ph = (xmlModel.form.GetControl(&quot;SummaryHolder&quot;).ControlReference[0] as Panel);
                ph.Controls.Clear();

                DataSet ds = PlanningSummaryHelper.Instance.GetSummary(string.IsNullOrEmpty(xmlModel.form.instanceID) ? 0 : xmlModel.form.instanceID.ToInt32_2(), &quot;PROGRAM&quot;);

                Literal ltrSummary = new Literal();

                int programYear = 0;

                if (ds.Tables.Count &gt;= 2 &amp;&amp; ds.Tables[2].Rows.Count &gt; 0)
                {
                    int.TryParse(ds.Tables[2].Rows[0][&quot;ProgramYear&quot;]?.ToString(), out programYear);
                }

                StringBuilder sb = PlanningSummaryHelper.Instance.GetSummaryTable(ds.Tables[1], &quot;PROGRAM&quot;, programYear);
                ltrSummary.Text = sb.ToString();

                ph.Controls.Add(PlanningSummaryHelper.Instance.CreateChart(ds.Tables[0], &quot;Region&quot;, &quot;ProjectValue&quot;, &quot;Program Category&quot;));
                ph.Controls.Add(ltrSummary);
            }
            catch (Exception ex)
            {
                ShowError(ex.Message.Replace(&quot;|&quot;, &quot;\\n&quot;));
            }
        }

        private void btnRetrieveProjects_Click(object sender, EventArgs e)
        {
            try
            {
                string ddlProgramCat = xmlModel.form.GetControl(&quot;ProgramCategory&quot;).GetServerValue();
                if (ddlProgramCat == Constants.XML_CONTROL_NULL_VALUE)
                {
                    string alertmsg = &quot;Please select a Program Category.&quot;;
                    ShowError(alertmsg);
                    return;
                }

                string programBudget = xmlModel.form.GetControl(&quot;SelectionProgramBudget&quot;).GetServerValue();
                string hdnIncludeOngoing = xmlModel.form.GetControl(&quot;hdnIncludeOngoing&quot;).GetServerValue();
                string projectMinCost = xmlModel.form.GetControl(&quot;SelectionMinCost&quot;).GetServerValue();
                string projectMaxCost = xmlModel.form.GetControl(&quot;SelectionMaxCost&quot;).GetServerValue();
                int programCategory = 0;

                if (ddlProgramCat != Constants.XML_CONTROL_NULL_VALUE)
                    programCategory = Convert.ToInt32(ddlProgramCat);

                int includeOngoingProjects = 0;
                if (!string.IsNullOrEmpty(hdnIncludeOngoing))
                    includeOngoingProjects = hdnIncludeOngoing.ToInt32_2();
                else
                    includeOngoingProjects = 0;

                DataSet Tempds = PlanningManagementManager.Instance.GetProjectsAndLandsForProgram(
                    string.IsNullOrEmpty(programBudget) ? 0 : programBudget.ToDecimal2(),
                    includeOngoingProjects,
                    string.IsNullOrEmpty(projectMinCost) || projectMinCost.Equals(Constants.XML_CONTROL_NULL_VALUE) ? 0 : projectMinCost.ToDouble2(),
                    string.IsNullOrEmpty(projectMaxCost) || projectMaxCost.Equals(Constants.XML_CONTROL_NULL_VALUE) ? 0 : projectMaxCost.ToDouble2(),
                    programCategory,
                    HasLandManagementModule &amp;&amp; IncludeLandInPlanning);
                DataSet ds = Tempds.Clone();

                decimal totalProjectCost = 0;

                if (programBudget.ToDecimal2() != 0)
                {
                    foreach (DataRow dRow in Tempds.Tables[0].Rows)
                    {
                        decimal currentProjectCost = (dRow[&quot;ProjectTotalCost&quot;] is DBNull) ? 0 : dRow[&quot;ProjectTotalCost&quot;].ToDecimal2();
                        if (totalProjectCost + currentProjectCost &lt;= programBudget.ToDecimal2())
                        {
                            totalProjectCost += currentProjectCost;
                            ds.Tables[0].ImportRow(dRow);
                        }
                    }
                }
                else
                {
                    ds = Tempds;
                }

                if (ds.Tables.Count &gt; 0 &amp;&amp; ds.Tables[0].Rows.Count &gt; 0)
                {
                    DataTable dtProject = BindProjectsGrid(ds, ProgramID);
                    DataTable dtLand = new DataTable();

                    if (HasLandManagementModule &amp;&amp; IncludeLandInPlanning)
                        dtLand = BindLandGrid(ds, ProgramID);

                    SetValueAfterRetrieve(dtProject, dtLand);
                }
                else
                {
                    string addlandmsg = string.Empty;
                    var IsLandManagementEnabled = ComponentHelper.Instance.ExecuteScalar(&quot;select CASE WHEN IsActive=1 THEN &#39;1&#39; ELSE &#39;0&#39; END IsLandEnabled from MODMGMTModules where ModuleID=&#39;LANDMGT&#39;&quot;);
                    if (IsLandManagementEnabled != null &amp;&amp; IsLandManagementEnabled.ToString() == &quot;1&quot;)
                    {
                        addlandmsg = &quot; and Lands&quot;;
                    }
                    string alertmsg = &quot;No Projects&quot; + addlandmsg + &quot; meet the specified criteria. Revise the criteria and search again&quot;;
                    ShowError(alertmsg);
                }

                Button btnRetrieve = (sender as Button);
                var ProgramStatus = PlanningManagementManager.Instance.GetPlanningStatus(ProgramID, &quot;PROGRAM&quot;);
                if (ProgramStatus != null &amp;&amp; ProgramStatus.ToString().ToUpper() == &quot;APPROVED&quot;)
                {
                    if (btnRetrieve != null)
                        btnRetrieve.Enabled = false;
                }
            }
            catch (Exception ex)
            {
                ShowError(ex.Message);
            }
        }

        private DataTable BindLandGrid(DataSet ds, int programID)
        {
            RadGrid dgPlanningLands = (xmlModel.form.GetContainer(&quot;DGPlanningLands&quot;).ControlReference[0] as RadGrid);
            List&lt;string&gt; hiddenColumns = new List&lt;string&gt;();

            //Start For Planning Land
            DataTable dtLand = new DataTable();
            dgPlanningLands.MasterTableView.AutoGeneratedColumns.ToList().ForEach(x =&gt;
            {
                dtLand.Columns.Add(x.UniqueName);

                if (!x.Display)
                    hiddenColumns.Add(x.UniqueName);
            });

            for (int i = 0; i &lt; ds.Tables[0].Rows.Count; i++)
            {
                if (ds.Tables[0].Rows[i][&quot;LandOrProject&quot;].ToString() == &quot;IsLand&quot;)
                {
                    if (ds.Tables[0].Rows[i][&quot;ID&quot;].ToString() != &quot;0&quot;)
                    {
                        dtLand.Rows.Add(null, programID, null, null, ds.Tables[0].Rows[i][&quot;ID&quot;].ToString(), ds.Tables[0].Rows[i][&quot;Title&quot;].ToString(), ds.Tables[0].Rows[i][&quot;Description&quot;].ToString(),
                            ds.Tables[0].Rows[i][&quot;ProjectTotalCost&quot;].ToString());
                    }
                }
            }

            dgPlanningLands.DataSource = dtLand;//No date time field hence ToMWDateTime() is not required
            dgPlanningLands.DataBind();
            (xmlModel.form.GetContainer(&quot;DGPlanningLands&quot;).ControlReference[1] as HiddenField).Value = DataTableToJSON(dtLand);

            /*
             * The Display property for the Hidden columns are set to true after DataBind
             * Need to set it back to false
             * */

            for (int i = 0; i &lt; hiddenColumns.Count; i++)
            {
                GridColumn thisColumn = dgPlanningLands.MasterTableView.GetColumnSafe(hiddenColumns[i]);

                if (thisColumn != null)
                    thisColumn.Display = false;
            }

            //End For Planning Land
            return dtLand;
        }

        private DataTable BindProjectsGrid(DataSet ds, int programID)
        {
            RadGrid dgPlanningProjects = (xmlModel.form.GetContainer(&quot;DGPlanningProjects&quot;).ControlReference[0] as RadGrid);

            //Start For Planning Project
            DataTable dtProject = new DataTable();
            dgPlanningProjects.MasterTableView.AutoGeneratedColumns.ToList().ForEach(x =&gt;
            {
                dtProject.Columns.Add(x.UniqueName, x.DataType);
            });

            for (int i = 0; i &lt; ds.Tables[0].Rows.Count; i++)
            {
                if (ds.Tables[0].Rows[i][&quot;LandOrProject&quot;].ToString() == &quot;IsProject&quot;)
                {
                    dtProject.Rows.Add(null, programID, null, null, ds.Tables[0].Rows[i][&quot;ID&quot;].ToString(), ds.Tables[0].Rows[i][&quot;TotalScore&quot;].ToString(), ds.Tables[0].Rows[i][&quot;Title&quot;].ToString(), ds.Tables[0].Rows[i][&quot;Description&quot;].ToString()
                        , ds.Tables[0].Rows[i][&quot;ProgramYear&quot;].ToString(), (ds.Tables[0].Rows[i][&quot;ProjectTotalCost&quot;] is DBNull) ? &quot;0.0000&quot; : ds.Tables[0].Rows[i][&quot;ProjectTotalCost&quot;].ToString()
                        , (ds.Tables[0].Rows[i][&quot;InflatedAmount&quot;] is DBNull) ? &quot;0.0000&quot; : ds.Tables[0].Rows[i][&quot;InflatedAmount&quot;].ToString()
                        , ds.Tables[0].Rows[i][&quot;ProjectStatus&quot;].ToString());
                }
            }
            dgPlanningProjects.DataSource = dtProject; //No date time field hence ToMWDateTime() is not required
            dgPlanningProjects.DataBind();
            (xmlModel.form.GetContainer(&quot;DGPlanningProjects&quot;).ControlReference[1] as HiddenField).Value = DataTableToJSON(dtProject);

            /*
             * The Display property for the Hidden columns are set to true after DataBind
             * Need to set it back to false
             * */

            GridColumn[] cols = dgPlanningProjects.MasterTableView.AutoGeneratedColumns;

            for (int i = 0; i &lt; cols.Length; i++)
            {
                GridColumn col = cols[i];
                xControl colControl = xmlModel.form.GetControl(MWGrid.GetDatabaseFriendlyExpression(col.UniqueName));
                if (colControl.Type == Platform.BusinessLayer.XMLForm.ControlType.Hidden)
                {
                    col.Display = false;
                }
                String format = colControl.GetControlFormat();
                if (!string.IsNullOrWhiteSpace(format))
                {
                    if (col is GridNumericColumn)
                    {
                        (col as GridNumericColumn).DataFormatString = &quot;{0:&quot; + format + &quot;}&quot;;
                    }
                }
            }

            //End For Planning Project

            return dtProject;
        }

        private void SetValueAfterRetrieve(DataTable DtProject, DataTable DtLand)
        {
            decimal dProjectCost = 0;
            decimal dLandCost = 0;
            decimal inflatedCost = 0;

            for (int i = 0; i &lt; DtProject.Rows.Count; i++)
            {
                dProjectCost = (dProjectCost == 0) ? Convert.ToDecimal(DtProject.Rows[i][&quot;ProjectTotalCost&quot;]) : (dProjectCost + Convert.ToDecimal(DtProject.Rows[i][&quot;ProjectTotalCost&quot;]));
                inflatedCost = (inflatedCost == 0) ? Convert.ToDecimal(DtProject.Rows[i][&quot;InflatedAmount&quot;]) : (inflatedCost + Convert.ToDecimal(DtProject.Rows[i][&quot;InflatedAmount&quot;]));
            }

            for (int i = 0; i &lt; DtLand.Rows.Count; i++)
            {
                dLandCost = (dLandCost == 0) ? Convert.ToDecimal(DtLand.Rows[i][&quot;LandValue&quot;]) : (dLandCost + Convert.ToDecimal(DtLand.Rows[i][&quot;LandValue&quot;]));
            }

            xmlModel.form.GetControl(&quot;ProjectCost&quot;).SetServerValue(dProjectCost);
            xmlModel.form.GetControl(&quot;InflatedCost&quot;).SetServerValue(inflatedCost);
            xmlModel.form.GetControl(&quot;ProjectCount&quot;).SetServerValue(DtProject.Rows.Count);
            xmlModel.form.GetControl(&quot;LandCost&quot;).SetServerValue(dLandCost);
            xmlModel.form.GetControl(&quot;TotalCost&quot;).SetServerValue(dProjectCost + dLandCost);
        }

        private void CreateProject(BrixFormModel model)
        {
            var projDTO = new Project();
            int PID, BID;

            PID = (int)ComponentHelper.Instance.ExecuteScalar(PlanningManagementStoredProcedure.usp_PLANINGCheckContengencyPROJECT, null, model.form.instanceID);

            TextBox ProgramName = (model.form.GetControl(&quot;Title&quot;).ControlReference[0] as TextBox);
            DropDownList ProgramYear = (model.form.GetControl(&quot;ProgramYear&quot;).ControlReference[0] as DropDownList);
            WebNumericEdit Budget = (model.form.GetControl(&quot;Budget&quot;).ControlReference[0] as WebNumericEdit);
            DropDownList ProgramType = (model.form.GetControl(&quot;ProgramCategory&quot;).ControlReference[0] as DropDownList);

            projDTO.ProjectName = &quot;Project-&quot; + ProgramName.Text;
            projDTO.ProjectCode = &quot;CPROJ-&quot; + model.form.instanceID;
            projDTO.ProjectOwner = &quot;Planner&quot;;
            projDTO.ProjectStartDate = Convert.ToDateTime(&quot;01/01/&quot; + ProgramYear.SelectedValue.ToString()).SetKindToUtc();
            projDTO.ProjectEndDate = Convert.ToDateTime(&quot;12/31/&quot; + Convert.ToString(Convert.ToInt32(ProgramYear.SelectedValue.ToString()) + 4)).SetKindToUtc();
            projDTO.ProjectCreatedDate = DateTime.UtcNow;
            projDTO.ProgramYear = ProgramYear.SelectedValue;
            projDTO.ProjectClass = ProgramType.SelectedValue;

            decimal Budgetvalue;

            decimal.TryParse(Budget.Text, out Budgetvalue);

            projDTO.ProjectValue = Budgetvalue;
            projDTO.ProjectIsActive = false;

            if (PID == 0)
            {
                ProjectManager blInstance = ProjectManager.Instance;
                PID = blInstance.CreateProject(projDTO, UserDetail.GetCurrentUserDetail().UID, UserDetail.GetCurrentUserDetail().RID);
            }
            else
            {
                projDTO.ProjectID = PID;
                ProjectManager blInstance = ProjectManager.Instance;
                PID = blInstance.UpdateProject(projDTO, UserDetail.GetCurrentUserDetail().UID, UserDetail.GetCurrentUserDetail().RID);
            }

            if (PID &gt; 0)
            {
                BID = (int)ComponentHelper.Instance.ExecuteScalar(PlanningManagementStoredProcedure.usp_PLANINGCreateBudget, null, model.form.instanceID, PID);

                if (BID &gt; 0)
                {
                    ScheduleUpdationModel obj = ScheduleUpdationModel.GetInstance(&quot;BDGTEST&quot;);
                    obj.CreateForecast(BID, PID, UserDetail.GetCurrentUserDetail().UID);
                }
            }
        }

        #endregion
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[45,13,45,14,1],[46,17,46,111,1],[47,21,47,77,1],[49,17,49,26,1],[50,13,50,14,1],[56,13,56,14,1],[57,17,57,49,1],[58,21,58,112,1],[60,17,60,44,1],[61,13,61,14,1],[67,13,67,14,1],[68,17,68,49,1],[69,21,69,82,1],[70,17,70,44,1],[71,13,71,14,1],[77,13,77,14,1],[78,17,78,83,1],[79,13,79,14,1],[85,13,85,14,1],[86,17,86,80,1],[87,13,87,14,1],[94,9,94,10,1],[95,13,95,63,1],[97,13,97,20,1],[97,22,97,33,1],[97,34,97,36,1],[97,37,97,47,1],[98,13,98,14,1],[99,17,99,61,1],[101,17,101,24,1],[101,26,101,40,1],[101,41,101,43,1],[101,44,101,57,1],[102,17,102,18,1],[103,21,103,53,1],[104,17,104,18,1],[105,17,105,32,1],[106,13,106,14,1],[107,13,107,74,1],[108,13,108,47,1],[109,9,109,10,1],[112,9,112,10,1],[114,13,114,14,1],[115,17,115,34,1],[117,17,117,123,1],[118,17,118,90,1],[119,17,119,65,1],[120,17,120,39,1],[122,17,122,60,1],[124,17,124,74,1],[125,17,125,18,1],[126,21,131,48,1],[134,21,134,111,1],[135,21,135,78,1],[136,21,136,61,1],[138,21,138,106,1],[139,21,139,22,1],[140,25,140,53,1],[141,25,141,117,1],[142,25,142,154,1],[143,25,143,116,1],[145,25,145,117,1],[146,25,146,154,1],[147,25,147,116,1],[148,21,148,22,1],[149,26,149,64,1],[150,21,150,22,1],[153,25,153,154,1],[154,25,154,294,1],[157,25,157,154,1],[158,25,158,217,1],[159,25,159,87,1],[160,25,161,139,1],[162,21,162,22,1],[164,21,164,22,1],[165,25,165,52,1],[166,25,166,209,1],[168,25,168,115,1],[170,25,170,217,1],[171,25,171,87,1],[172,25,173,139,1],[175,25,175,115,1],[177,25,177,112,1],[178,25,178,26,1],[179,29,179,43,1],[180,25,180,26,1],[181,21,181,22,1],[182,17,182,18,1],[184,17,184,119,1],[185,17,185,137,1],[187,17,187,97,1],[188,17,188,124,1],[190,17,190,73,1],[191,17,191,18,1],[192,21,192,83,1],[193,21,193,55,1],[194,17,194,18,1],[196,17,196,123,1],[197,17,197,76,1],[198,17,198,18,0],[199,21,199,88,0],[200,21,200,55,0],[202,21,202,115,0],[203,21,203,90,0],[204,17,204,18,0],[205,13,205,14,1],[206,13,206,33,0],[207,13,207,14,0],[208,13,208,14,0],[209,9,209,10,1],[212,9,212,10,1],[214,13,214,14,1],[215,17,215,87,1],[216,17,216,83,1],[218,17,218,120,1],[219,17,219,90,1],[221,17,221,72,1],[222,21,222,58,1],[224,21,224,58,0],[226,17,226,250,1],[228,17,228,111,1],[229,17,229,112,1],[232,17,232,109,1],[234,17,234,110,1],[239,17,239,42,1],[242,17,242,174,1],[243,17,243,50,1],[244,17,244,18,1],[245,21,245,78,1],[246,17,246,18,1],[248,17,248,59,1],[249,17,249,18,0],[250,26,250,54,0],[250,56,250,78,0],[250,80,250,83,0],[251,21,251,22,0],[252,25,252,57,0],[253,21,253,22,0],[254,17,254,18,0],[258,17,258,38,1],[261,17,261,167,1],[262,17,262,50,1],[263,17,263,18,1],[264,21,264,78,1],[265,17,265,18,1],[267,17,267,63,1],[268,17,268,18,0],[269,26,269,54,0],[269,56,269,82,0],[269,84,269,87,0],[270,21,270,22,0],[271,25,271,61,0],[272,21,272,22,0],[273,17,273,18,0],[275,17,275,113,1],[276,17,276,119,1],[277,17,277,150,1],[279,17,279,51,1],[280,17,280,18,1],[281,21,281,152,1],[282,21,282,150,1],[285,21,285,141,1],[286,21,286,141,1],[287,21,287,54,1],[288,21,288,52,1],[289,21,289,49,1],[290,21,290,49,1],[293,21,293,70,1],[294,21,294,22,1],[295,25,295,260,1],[296,25,296,103,1],[297,25,297,26,1],[298,29,298,48,1],[299,33,299,56,1],[300,25,300,26,1],[301,21,301,22,1],[302,17,302,18,1],[305,17,305,42,1],[306,17,306,39,1],[307,17,307,42,1],[308,17,308,101,1],[309,17,309,18,1],[310,21,310,79,1],[311,26,311,35,1],[311,37,311,54,1],[311,56,311,59,1],[312,21,312,22,1],[313,25,313,237,1],[314,25,314,233,1],[315,21,315,22,1],[316,21,316,90,1],[317,17,317,18,1],[319,21,319,90,1],[321,17,321,87,1],[322,17,322,88,1],[325,17,325,39,1],[326,17,326,109,1],[327,17,327,18,0],[328,26,328,35,0],[328,37,328,86,0],[328,88,328,91,0],[329,21,329,22,0],[330,25,330,222,0],[331,21,331,22,0],[332,21,332,84,0],[333,17,333,18,0],[335,21,335,84,1],[336,17,336,96,1],[339,17,339,128,1],[340,17,340,77,1],[341,17,341,18,0],[342,21,342,99,0],[344,21,344,57,0],[345,21,345,105,0],[346,21,346,22,0],[347,30,347,39,0],[347,41,347,86,0],[347,88,347,91,0],[348,25,348,26,0],[349,29,349,274,0],[350,25,350,26,0],[351,25,351,118,0],[352,21,352,22,0],[354,25,354,118,0],[355,17,355,18,0],[356,13,356,14,1],[357,13,357,33,0],[357,34,357,35,0],[357,36,357,37,0],[357,37,357,38,1],[358,9,358,10,1],[361,9,361,10,1],[362,13,362,38,1],[364,13,364,121,1],[365,13,365,50,1],[366,13,366,14,0],[367,17,367,38,0],[368,13,368,14,0],[370,13,370,108,1],[372,13,372,111,1],[374,13,374,60,1],[375,13,375,14,1],[376,17,376,35,1],[377,17,377,18,0],[378,21,378,52,0],[379,21,380,72,0],[381,17,381,18,0],[383,17,383,56,1],[384,17,384,36,1],[385,21,385,28,0],[386,17,386,41,1],[387,17,387,60,1],[388,17,388,18,1],[389,21,389,192,1],[390,21,390,83,1],[391,21,392,135,1],[393,21,393,58,1],[394,17,394,18,0],[396,17,396,18,1],[397,21,398,50,1],[400,21,400,58,1],[401,17,401,18,0],[402,13,402,14,0],[404,13,404,86,1],[406,13,406,20,1],[406,22,406,52,1],[406,53,406,55,1],[406,56,406,62,1],[407,13,407,14,1],[408,17,408,75,1],[409,17,409,39,1],[410,21,410,94,1],[411,13,411,14,1],[412,9,412,10,1],[415,9,415,10,1],[417,13,417,14,1],[418,17,418,125,1],[419,17,419,125,1],[420,17,420,54,1],[421,17,421,18,0],[422,21,422,117,0],[423,21,423,123,0],[424,21,424,120,0],[427,21,427,131,0],[428,21,428,22,0],[429,25,429,144,0],[429,144,429,199,0],[429,199,429,219,0],[429,25,429,219,0],[430,25,430,55,0],[431,21,431,22,0],[433,21,433,58,0],[434,21,434,28,0],[434,30,434,37,0],[434,38,434,40,0],[434,41,434,75,0],[435,21,435,22,0],[436,25,436,97,0],[437,25,437,26,0],[438,29,438,121,0],[439,25,439,26,0],[440,21,440,22,0],[441,21,441,68,0],[442,25,442,102,0],[444,21,444,115,0],[445,17,445,18,0],[447,17,447,18,1],[448,21,448,115,1],[449,21,449,116,1],[452,21,452,46,1],[453,21,453,46,1],[454,21,454,105,1],[455,21,455,22,1],[456,30,456,39,1],[456,41,456,86,1],[456,88,456,91,1],[457,25,457,26,1],[458,29,458,241,1],[459,29,459,237,1],[460,25,460,26,1],[461,25,461,94,1],[462,25,462,124,1],[463,21,463,22,1],[465,21,465,22,1],[466,25,466,94,1],[467,25,467,84,1],[468,21,468,22,1],[470,21,470,91,1],[473,21,473,43,1],[474,21,474,113,1],[475,21,475,22,0],[476,30,476,39,0],[476,41,476,90,0],[476,92,476,95,0],[477,25,477,26,0],[478,29,478,226,0],[479,25,479,26,0],[480,25,480,88,0],[481,21,481,22,0],[483,25,483,88,1],[484,21,484,100,1],[506,17,506,18,1],[507,17,507,43,1],[508,17,508,34,1],[509,17,509,38,1],[510,13,510,14,1],[511,13,511,33,0],[512,13,512,14,0],[513,17,513,35,0],[514,17,514,39,0],[515,17,515,45,0],[516,13,516,14,0],[517,9,517,10,1],[520,9,520,10,1],[521,13,521,121,1],[523,13,523,130,1],[524,13,524,122,1],[525,13,525,14,1],[526,17,526,49,1],[527,13,527,14,1],[528,13,528,102,1],[529,13,529,14,1],[530,17,530,64,1],[531,13,531,14,1],[533,13,533,63,1],[534,9,534,10,1],[545,9,545,10,1],[546,13,546,48,1],[547,13,547,108,1],[548,13,548,91,1],[549,13,549,14,0],[550,17,550,36,0],[551,21,551,44,0],[552,13,552,14,0],[553,13,553,27,1],[554,9,554,10,1],[557,9,557,10,1],[559,13,559,14,1],[560,17,560,101,1],[561,17,561,37,1],[563,17,563,174,1],[565,17,565,52,1],[567,17,567,37,1],[569,17,569,73,1],[570,17,570,18,1],[571,21,571,100,1],[572,17,572,18,1],[574,17,574,121,1],[575,17,575,49,1],[577,17,577,137,1],[578,17,578,45,1],[579,13,579,14,1],[580,13,580,33,0],[581,13,581,14,0],[582,17,582,59,0],[583,13,583,14,0],[584,9,584,10,1],[587,9,587,10,1],[589,13,589,14,1],[590,17,590,101,1],[591,17,591,71,1],[592,17,592,18,0],[593,21,593,75,0],[594,21,594,41,0],[595,21,595,28,0],[598,17,598,108,1],[599,17,599,107,1],[600,17,600,103,1],[601,17,601,103,1],[602,17,602,41,1],[604,17,604,71,1],[605,21,605,70,1],[607,17,607,48,1],[608,17,608,62,1],[609,21,609,76,0],[611,21,611,48,1],[613,17,619,71,1],[620,17,620,45,1],[622,17,622,46,1],[624,17,624,53,1],[625,17,625,18,1],[626,21,626,28,1],[626,30,626,42,1],[626,43,626,45,1],[626,46,626,67,1],[627,21,627,22,1],[628,25,628,135,1],[629,25,629,97,1],[630,25,630,26,1],[631,29,631,68,1],[632,29,632,58,1],[633,25,633,26,1],[634,21,634,22,1],[635,17,635,18,1],[637,17,637,18,1],[638,21,638,33,1],[639,17,639,18,1],[641,17,641,72,1],[642,17,642,18,1],[643,21,643,75,1],[644,21,644,56,1],[646,21,646,74,1],[647,25,647,62,0],[649,21,649,62,1],[650,17,650,18,1],[652,17,652,18,0],[653,21,653,54,0],[654,21,654,202,0],[655,21,655,102,0],[656,21,656,22,0],[657,25,657,51,0],[658,21,658,22,0],[659,21,659,137,0],[660,21,660,41,0],[661,17,661,18,0],[663,17,663,57,1],[664,17,664,112,1],[665,17,665,95,1],[666,17,666,18,0],[667,21,667,45,0],[668,25,668,53,0],[669,17,669,18,0],[670,13,670,14,1],[671,13,671,33,0],[672,13,672,14,0],[673,17,673,39,0],[674,13,674,14,0],[675,9,675,10,1],[678,9,678,10,0],[679,13,679,118,0],[680,13,680,61,0],[683,13,683,48,0],[684,13,685,13,0],[685,13,685,14,0],[685,14,686,17,0],[686,17,686,50,0],[686,50,688,17,0],[688,17,688,32,0],[688,32,689,21,0],[689,21,689,53,0],[689,53,690,13,0],[690,13,690,14,0],[690,14,690,16,0],[684,13,690,16,0],[692,18,692,27,0],[692,29,692,56,0],[692,58,692,61,0],[693,13,693,14,0],[694,17,694,82,0],[695,17,695,18,0],[696,21,696,70,0],[697,21,697,22,0],[698,25,699,82,0],[700,21,700,22,0],[701,17,701,18,0],[702,13,702,14,0],[704,13,704,49,0],[705,13,705,40,0],[706,13,706,128,0],[713,18,713,27,0],[713,29,713,52,0],[713,54,713,57,0],[714,13,714,14,0],[715,17,715,105,0],[717,17,717,40,0],[718,21,718,48,0],[719,13,719,14,0],[722,13,722,27,0],[723,9,723,10,0],[726,9,726,10,1],[727,13,727,124,1],[730,13,730,51,1],[731,13,732,13,1],[732,13,732,14,1],[732,14,733,17,1],[733,17,733,65,1],[733,65,734,13,1],[734,13,734,14,1],[734,14,734,16,1],[731,13,734,16,1],[736,18,736,27,1],[736,29,736,56,1],[736,58,736,61,1],[737,13,737,14,1],[738,17,738,85,1],[739,17,739,18,1],[740,21,743,77,1],[744,17,744,18,1],[745,13,745,14,1],[746,13,746,55,1],[747,13,747,43,1],[748,13,748,134,1],[755,13,755,89,1],[757,18,757,27,1],[757,29,757,44,1],[757,46,757,49,1],[758,13,758,14,1],[759,17,759,42,1],[760,17,760,118,1],[761,17,761,90,1],[762,17,762,18,1],[763,21,763,41,1],[764,17,764,18,1],[765,17,765,63,1],[766,17,766,56,1],[767,17,767,18,1],[768,21,768,50,1],[769,21,769,22,1],[770,25,770,92,1],[771,21,771,22,1],[772,17,772,18,1],[773,13,773,14,1],[777,13,777,30,1],[778,9,778,10,1],[781,9,781,10,1],[782,13,782,38,1],[783,13,783,35,1],[784,13,784,38,1],[786,18,786,27,1],[786,29,786,53,1],[786,55,786,58,1],[787,13,787,14,1],[788,17,788,187,1],[789,17,789,183,1],[790,13,790,14,1],[792,18,792,27,1],[792,29,792,50,1],[792,52,792,55,0],[793,13,793,14,0],[794,17,794,158,0],[795,13,795,14,0],[797,13,797,82,1],[798,13,798,83,1],[799,13,799,91,1],[800,13,800,76,1],[801,13,801,92,1],[802,9,802,10,1],[805,9,805,10,0],[806,13,806,41,0],[809,13,809,162,0],[811,13,811,99,0],[812,13,812,115,0],[813,13,813,109,0],[814,13,814,119,0],[816,13,816,65,0],[817,13,817,68,0],[818,13,818,46,0],[819,13,819,123,0],[820,13,820,160,0],[821,13,821,58,0],[822,13,822,61,0],[823,13,823,62,0],[827,13,827,60,0],[829,13,829,48,0],[830,13,830,45,0],[832,13,832,26,0],[833,13,833,14,0],[834,17,834,69,0],[835,17,835,135,0],[836,13,836,14,0],[838,13,838,14,0],[839,17,839,41,0],[840,17,840,69,0],[841,17,841,135,0],[842,13,842,14,0],[844,13,844,25,0],[845,13,845,14,0],[846,17,846,160,0],[848,17,848,29,0],[849,17,849,18,0],[850,21,850,94,0],[851,21,851,89,0],[852,17,852,18,0],[853,13,853,14,0],[854,9,854,10,0]]);
    </script>
  </body>
</html>