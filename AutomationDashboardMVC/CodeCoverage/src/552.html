<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Construction Vertical\Main Modules\Planning Management\BL\PlanningManagementManager.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core.AbstractModels;
using Aurigo.AMP3.Core.BusinessLayer.BL;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.AMP3.Logging;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.AMP3.ProjectDAC;
using Aurigo.AMP3.Resources.MessageResources;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.Brix.Platform.BusinessLayer.DataResouces;
using Aurigo.Brix.Platform.BusinessLayer.DTO;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using System;
using System.Collections.Generic;
using System.Data;
using System.IO;
using System.Linq;
using System.Text;
using System.Xml;
using System.Xml.Serialization;
using Aurigo.Brix.Construction.BudgetManager.BusinessLayer.BL;
using Aurigo.Brix.Construction.PlanningManagement.DTO;
using Aurigo.Brix.Construction.ContractManager.QuantityPlanningUI.BL;
using Aurigo.Brix.Platform.BusinessLayer.BL;
using Aurigo.Common;
using Aurigo.Brix.Platform.BusinessLayer.AbstractModels;
using Aurigo.DataBinding;
using Aurigo.Common.Utility;

namespace Aurigo.Brix.Construction.PlanningManagement
{
    [Context(Name = &quot;PLANING&quot;)]
    public class PlanningManagementManager : SingletonManagerBase&lt;PlanningManagementManager&gt;, IXmlTree
    {
        #region Public Fields

        public static SortedDictionary&lt;string, Type&gt; contextDictionary;

        #endregion
        
        #region Public Constructors

        static PlanningManagementManager()
        {
            if (contextDictionary == null)
            {
                contextDictionary = new SortedDictionary&lt;string, Type&gt;();
                Dictionary&lt;string, Type&gt; dict = ModelHelper.GetModelObjects(typeof(IXmlPlanningTree));
                foreach (var kvp in dict)
                    contextDictionary.Add(kvp.Key, kvp.Value);
            }
        }

        public PlanningManagementManager()
        {
        }

        #endregion

        #region IXmlTree Members

        string IXmlTree.ActiveTab { get { return LocalizationManager.GetString(&quot;Planning&quot;); } set { } }

        string IXmlTree.ModuleID { get { return &quot;PLANING&quot;; } set { } }

        public TNode GetXmlForTree(int projectID, int userId, int roleId, string platform)
        {
            try
            {
                List&lt;string&gt; permissions = ModuleManager.Instance.GetPermissionByUserOrRole(&quot;PLANING&quot;, userId, roleId, projectID);
                DataSet ds = new DataSet();
                ds.Merge(ModuleManager.Instance.GetModules().Select(&quot;ParentModuleID=&#39;PLANING&#39;&quot;, &quot;ModuleType,Folder&quot;));

                TNode tree = new TNode();

                UserDetail ud = UserDetail.GetCurrentUserDetail();
                // Pass only modules under planning

                //Modules / forms which, user role doesn&#39;t have permissions should not come in navigation tree
                if (ds.Tables.Count &gt; 0 &amp;&amp; ds.Tables[0].Rows.Count &gt; 0)
                {
                    for (int i = 0; i &lt; ds.Tables[0].Rows.Count; i++)
                    {
                        List&lt;string&gt; permissionsForModules = ModuleManager.Instance.GetPermissionByUserOrRole(ds.Tables[0].Rows[i][&quot;ModuleID&quot;].ToString(),
                            ud.UID, ud.RID, projectID);
                        if (!permissionsForModules.Contains(&quot;Visibility&quot;))
                            ds.Tables[0].Rows.Remove(ds.Tables[0].Rows[i]);
                    }
                }

                tree.Nodes.Add(new TNode(&quot;Planned Projects&quot;, &quot;~/Common/BrixListPage.aspx?Context=PROJECT&amp;PP=1&quot;));

                if (ds.Tables.Count &gt; 0 &amp;&amp; ds.Tables[0].Rows.Count &gt; 0)
                    ProjectComponent.Instance.GetProjectLevelXmlForms(tree, ds.Tables[0], 0, 0);

                XMLTreeContextAttribute[] attribs;
                foreach (var kvp in contextDictionary)
                {
                    attribs = (XMLTreeContextAttribute[])
                              kvp.Value.GetCustomAttributes(typeof(XMLTreeContextAttribute), true);
                    var xmltree = (IXmlPlanningTree)Activator.CreateInstance(kvp.Value);
                    //Sending the root node as the first parameter
                    xmltree.GetXmlForPlanningTree(tree, null);
                }

                // Newly Added code -- Tree node which represents report gallery
                ReportManager.Instance.GetReportGalleryXml(tree, &quot;PLANING&quot;, 0, 0);

                //End of Newly Added code
                return tree;
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_PROJECT);
                throw;
            }
        }

        public Dictionary&lt;string, string&gt; GetTreeForMobile(int projectID, int instanceId, int userId, int roleId)
        {
            return new Dictionary&lt;string, string&gt;();
        }

        #endregion

        #region Public Methods

        public DataSet GetProgramForecastDetails(int PlanningID)
        {
            return PlanningManagementComponent.Instance.GetProgramForecastDetails(PlanningID);
        }

        public object GetProgramType(int PlanningID)
        {
            return PlanningManagementComponent.Instance.GetProgramType(PlanningID);
        }

        public object SaveProgramForecastScheduleData(int PlanningID, string xmlArgument)
        {
            return PlanningManagementComponent.Instance.SaveProgramForecastScheduleData(PlanningID, xmlArgument);
        }

        public DataSet GetMasterProgramForecastDetails(int PlanningID, DateTime programCycleStartDate, DateTime programCycleEndDate)
        {
            return PlanningManagementComponent.Instance.GetMstrProgramForecastDetails(PlanningID, programCycleStartDate, programCycleEndDate);
        }

        public object SaveMstrProgramForecastScheduleData(int MPID, string xmlArgument)
        {
            return PlanningManagementComponent.Instance.SaveMstrProgramForecastScheduleData(MPID, &quot;MSTRPLN&quot;, xmlArgument);
        }

        public string GetPlanningStatus(int ID, string ModuleID)
        {
            return PlanningManagementComponent.Instance.GetPlanningStatus(ID, ModuleID);
        }

        public void RefreshPlanningScores(int ID)
        {
            PlanningManagementComponent.Instance.RefreshPlanningScores(ID);
        }

        public bool CaptureCurrentProgramForecastSnapshot(int ProgramID, string Notes)
        {
            UserDetail user = UserDetail.GetCurrentUserDetail();
            object returnValue = PlanningManagementComponent.Instance.CaptureProgramForecastSnapshot(ProgramID, user.UserName, Notes);
            return Convert.ToInt32(returnValue) == 1;
        }

        public DataSet GetProgramForecastSnapshot(int ProgramID, int SnapshotID)
        {
            return PlanningManagementComponent.Instance.GetProgramForecastSnapshot(ProgramID, SnapshotID);
            //var SnapshotData = ProgramManagerComponent.Instance.GetProgramForecastSnapshot(ProgramID);
            //return XMLToDataSet(SnapshotData.ToString());
        }

        public bool CaptureCurrentMasterProgramForecastSnapshot(int MasterProgramID, string Notes)
        {
            UserDetail user = UserDetail.GetCurrentUserDetail();
            object returnValue = PlanningManagementComponent.Instance.CaptureMasterProgramForecastSnapshot(MasterProgramID, user.UserName, Notes);
            return Convert.ToInt32(returnValue) == 1;
        }

        public DataSet GetMasterProgramForecastSnapshot(int MasterProgramID, int SnapshotID, DateTime programCycleStartDate, DateTime programCycleEndDate)
        {
            return PlanningManagementComponent.Instance.GetMasterProgramForecastSnapshot(MasterProgramID, SnapshotID, programCycleStartDate, programCycleEndDate);
        }

        public bool CreateForecastAndApproveMAP(int InstanceId)
        {
            int returnValue;
            int BID;
            UserDetail ud = UserDetail.GetCurrentUserDetail();
            string currentUserId = ud.UID.ToString2();
            string currentRoleId = ud.RID.ToString();
            string currentUser = ud.UserName.ToString();

            string sUser = &quot;CurrentUser,&quot; + currentUser + &quot;,System.String&quot;;
            string sUserId = &quot;CurrentUserId,&quot; + currentUserId + &quot;,System.Int32&quot;;
            string sRoleId = &quot;CurrentRoleId,&quot; + currentRoleId + &quot;,System.Int32&quot;;
            string sContext = &quot;Context,&quot; + &quot;XQTYPLN&quot; + &quot;,System.String&quot;;

            returnValue = 0;
            Dictionary&lt;string, object&gt; dict = new Dictionary&lt;string, object&gt;();

            ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(PlanningManagementStoredProcedure.usp_PLANINGProjectCheckForecast, dict, InstanceId);
            if (dict.ContainsKey(&quot;return&quot;))
                returnValue = int.Parse(dict[&quot;return&quot;].ToString());

            BID = returnValue;

            if (returnValue &gt; 0)
            {
                ScheduleUpdationModel objmodel = ScheduleUpdationModel.GetInstance(&quot;QTYPLAN&quot;);
                if (objmodel != null)
                {
                    if (objmodel.CreateForecast(returnValue, Convert.ToInt32(InstanceId), UserDetail.GetCurrentUserDetail().UID))
                    {
                        var sParams = new string[] { sUser, sUserId, sRoleId, sContext };

                        StartWorkflowInstancesFor.SimulateWorkflowAction(true, false, &quot;XQTYPLN&quot;, returnValue.ToString(), BID.ToString(),
                        InstanceId.ToString(), &quot;Auto Creataed for Publish.&quot;, &quot;None&quot;, currentUserId.ToInt32_2(), &quot;&quot;, sParams);

                        dict = new Dictionary&lt;string, object&gt;();
                        ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(PlanningManagementStoredProcedure.usp_PLANINGProjectGETQPIDFROMBudgetEstimate, dict, InstanceId, returnValue);
                        if (dict.ContainsKey(&quot;return&quot;))
                            returnValue = int.Parse(dict[&quot;return&quot;].ToString());

                        if (returnValue &gt; 0)
                        {
                            StartWorkflowInstancesFor.TriggerActionsOnFormInstance(&quot;XQTYPLN&quot;, returnValue.ToString()
                               , &quot;Completed by Publisher.&quot;, &quot;IEBe0c64285139c4312bd42c3c676a4b3b8&quot;, currentUserId.ToInt32_2(), InstanceId, &quot;&quot;, sParams, &quot;Complete&quot;);

                            StartWorkflowInstancesFor.TriggerActionsOnFormInstance(&quot;XQTYPLN&quot;, returnValue.ToString()
                             , &quot;Submitted by Publisher.&quot;, &quot;IEBccf09fe5ccc246cf8fcc7ee9efb246c4&quot;, currentUserId.ToInt32_2(), InstanceId, &quot;&quot;, sParams, &quot;Submit&quot;);

                            StartWorkflowInstancesFor.TriggerActionsOnFormInstance(&quot;XQTYPLN&quot;, returnValue.ToString()
                                , &quot;Approved by Publisher.&quot;, &quot;IEB2d15d62600104fb7888ef5e1c9e3f37b&quot;, currentUserId.ToInt32_2(), InstanceId, &quot;&quot;, sParams, &quot;Approve&quot;);

                            return true;
                        }
                    }
                }
            }
            return false;
        }

        public void MarkBudgetAsReleaseToPlanning(int budgetEstimateID, bool releaseToPlanning)
        {
            PlanningManagementComponent.Instance.MarkBudgetAsReleaseToPlanning(budgetEstimateID, releaseToPlanning);
        }

        public bool HasReleasedToPlanningBudgetEstimate(int projectID)
        {
            bool hasReleasedToPlanningBudgetEstimate = false;
            DataSet ds = PlanningManagementComponent.Instance.GetReleasedToPlanningBudgetEstimate(projectID);

            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0 &amp;&amp; ds.Tables[0].Rows.Count &gt; 0)
                hasReleasedToPlanningBudgetEstimate = true;

            return hasReleasedToPlanningBudgetEstimate;
        }

        /// &lt;summary&gt;
        /// Gets the ID of the latest Budget Estimate that was marked as Release to Planning in the specified Project.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;projectID&quot;&gt;Project ID&lt;/param&gt;
        /// &lt;returns&gt;ID of the Budget Estimate&lt;/returns&gt;
        public int GetReleasedToPlanningBudgetEstimate(int projectID)
        {
            int budgetEstimateID = 0;
            DataSet ds = PlanningManagementComponent.Instance.GetReleasedToPlanningBudgetEstimate(projectID);

            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0 &amp;&amp; ds.Tables[0].Rows.Count &gt; 0)
                budgetEstimateID = ds.Tables[0].Rows[0][&quot;ID&quot;].ToInt32_2();

            return budgetEstimateID;
        }

        public bool ValidateBudgetEstimateForReleaseToPlanning(int beID, int projectID)
        {
            if (!BudgetManagementManager.Instance.IsBudgetItemAvailable(beID))
            {
                throw new Exception(&quot;No items added to budget estimate. Action cannot be completed&quot;);
            }

            if (BudgetManagementManager.Instance.IsEstimateTotalZero(beID))
            {
                throw new Exception(&quot;Total amount should not be zero for &quot; + BudgetManagementManager.Instance.GetBudgetEstimateID(beID));
            }

            return true;
        }

        public void GenerateForecastAndApprove(int beID, int projectID, int userId, int roleID, string userName,
                                                string completeActionName, string submitActionName, string approveActionName)
        {
            BudgetManagementManager.Instance.GenerateForecastForBudgetEstimate(beID, projectID, userId);

            int latestForecastID = BudgetManagementManager.Instance.GetLatestForecastID(beID);

            CreateAndApproveForecastWF(userId, latestForecastID, projectID,
                completeActionName, submitActionName, approveActionName,
                &quot;Completed by Publisher.&quot;, &quot;Submitted by Publisher.&quot;, &quot;Approved by Publisher.&quot;);
        }

        public void CreateAndApproveForecastWF(int userID, int forecastID, int projectID,
            string completeActionName, string submitActionName, string approveActionName,
            string completeMessage, string submitMessage, string approveMessage,
            bool createNewWorkflow = false, int contractID = 0)
        {
            UserDetail ud = UserDetail.GetUserDetail(userID);
            string message = string.Empty;
            string isSystemAction = &quot;IsSystemAction,true,System.String&quot;;
            string[] customParams = new string[] { isSystemAction };

            if (createNewWorkflow)
                BrixWorkflowManager.Instance.TriggerWorkflow(TriggerPoint.TriggerActions[0], &quot;XQTYPLN&quot;, projectID.ToString(), contractID.ToString(), &quot;&quot;, forecastID.ToString(), null, null, ud);

            message = StartWorkflowInstancesFor.TriggerActionsOnFormInstance(&quot;XQTYPLN&quot;, forecastID.ToString(), completeMessage, string.Empty, userID, projectID, &quot;&quot;, null, completeActionName, customParams, ud);

            if (!string.IsNullOrEmpty(message))
                throw new Exception(message);

            message = StartWorkflowInstancesFor.TriggerActionsOnFormInstance(&quot;XQTYPLN&quot;, forecastID.ToString(), submitMessage, string.Empty, userID, projectID, &quot;&quot;, null, submitActionName, customParams, ud);

            if (!string.IsNullOrEmpty(message))
                throw new Exception(message);

            message = StartWorkflowInstancesFor.TriggerActionsOnFormInstance(&quot;XQTYPLN&quot;, forecastID.ToString(), approveMessage, string.Empty, userID, projectID, &quot;&quot;, null, approveActionName, customParams, ud);

            if (!string.IsNullOrEmpty(message))
                throw new Exception(message);

            if (!QuantityPlanningManager.Instance.IsForecastApproved(forecastID))
                throw new Exception(&quot;Unable to approve forecast.&quot;);
        }

        public int GetProgramIDForBudgetEstimate(int budgetEstimateID)
        {
            int programID = 0;
            DataSet ds = PlanningManagementComponent.Instance.GetProgramIDForBudgetEstimate(budgetEstimateID);

            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0 &amp;&amp; ds.Tables[0].Rows.Count &gt; 0)
                programID = ds.Tables[0].Rows[0][&quot;PlanningID&quot;].ToInt32_2();

            return programID;
        }

        public bool IsBudgetEstimateReleasedToPlanning(int budgetEstimateID)
        {
            bool isReleasedToPlanning = false;

            DataSet ds = PlanningManagementComponent.Instance.IsBudgetEstimateReleasedToPlanning(budgetEstimateID);

            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0 &amp;&amp; ds.Tables[0].Rows.Count &gt; 0)
                isReleasedToPlanning = ds.Tables[0].Rows[0][&quot;ReleaseToPlanning&quot;].ToInt32_2() == 1;

            return isReleasedToPlanning;
        }

        public DataTable GetProgramAndMasterProgramForProject(int projectID)
        {
            return PlanningManagementComponent.Instance.GetProgramAndMasterProgramForProject(projectID).Tables[0];
        }

        public void UpdateProgramForecast(string projectIDs, int planID)
        {
            PlanningManagementComponent.Instance.UpdateProgramForecastForProject(projectIDs, planID);
        }

        public void UpdateMasterProgramForecast(string planIDs, int mpID)
        {
            PlanningManagementComponent.Instance.UpdateMasterProgramForecastForProgram(planIDs, mpID);
        }

        public void UpdateProjectStatus(int projectID, ProjectStatus status)
        {
            PlanningManagementComponent.Instance.UpdateProjectStatus(projectID, status);
        }

        public bool IsProjectAddedToProgram(int projectId)
        {
            bool isProjectAddedToProgram = false;
            DataTable dt = PlanningManagementComponent.Instance.GetProgramDetailsForProject(projectId);

            if (dt != null &amp;&amp; dt.Rows.Count &gt; 0)
                isProjectAddedToProgram = true;

            return isProjectAddedToProgram;
        }

        public List&lt;int&gt; GetUpdatedProjectsforProgram(int planID)
        {
            List&lt;int&gt; projects = new List&lt;int&gt;();
            DataTable dt = PlanningManagementComponent.Instance.GetUpdatedProjectsforProgram(planID);
            if (dt != null)
            {
                foreach (DataRow dr in dt.Rows)
                {
                    projects.Add(dr[&quot;ProjectId&quot;].ToInt32_2());
                }
            }
            return projects;
        }

        public List&lt;int&gt; GetUpdatedProjectsforMasterProgram(int MPID)
        {
            List&lt;int&gt; projects = new List&lt;int&gt;();
            DataTable dt = PlanningManagementComponent.Instance.GetUpdatedProjectsforMasterProgram(MPID);
            if (dt != null)
            {
                foreach (DataRow dr in dt.Rows)
                {
                    projects.Add(dr[&quot;PlanningId&quot;].ToInt32_2());
                }
            }
            return projects;
        }

        /// &lt;summary&gt;
        /// Gets the current fiscal year based on settings in Program Cycle
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;see cref=&quot;FiscalYear&quot;/&gt; Object&lt;/returns&gt;
        public FiscalYear GetCurrentFiscalYear()
        {
            FiscalYear fy = null;
            DataTable dt = PlanningManagementComponent.Instance.GetProgramCycle();

            if (dt != null &amp;&amp; dt.Rows.Count &gt; 0)
            {
                fy = new FiscalYear();
                string startMonth = dt.Rows[0][&quot;StartMonth&quot;].ToString();
                string endMonth = dt.Rows[0][&quot;EndMonth&quot;].ToString();

                Enum.TryParse&lt;Month&gt;(startMonth, out fy.StartMonth);
                Enum.TryParse&lt;Month&gt;(endMonth, out fy.EndMonth);

                if (MWDateTimeHelper.MWNow.Month &lt; fy.StartMonth.ToInt32_2())
                {
                    fy.StartDate = new DateTime(MWDateTimeHelper.MWNow.Year - 1, fy.StartMonth.ToInt32_2(), 1);
                    fy.EndDate = new DateTime(MWDateTimeHelper.MWNow.Year, fy.EndMonth.ToInt32_2(), DateTime.DaysInMonth(MWDateTimeHelper.MWNow.Year, fy.EndMonth.ToInt32_2()));
                }
                else
                {
                    fy.StartDate = new DateTime(MWDateTimeHelper.MWNow.Year, fy.StartMonth.ToInt32_2(), 1);
                    fy.EndDate = new DateTime(MWDateTimeHelper.MWNow.Year + 1, fy.EndMonth.ToInt32_2(), DateTime.DaysInMonth(MWDateTimeHelper.MWNow.Year + 1, fy.EndMonth.ToInt32_2()));
                }
            }

            return fy;
        }

        /// &lt;summary&gt;
        /// Checks if the any of the program forecast has remaining amount
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;masterProgramID&quot;&gt;ID of the master program&lt;/param&gt;
        /// &lt;returns&gt;If any program has remaining amount then true, false otherwise&lt;/returns&gt;
        public bool CheckIfProgramForecastHasRemainingAmout(int masterProgramID, DateTime programCycleStartDate, DateTime programCycleEndDate)
        {
            bool hasRemainingAmount = false;
            DataSet ObjDS = ComponentHelper.Instance.ExecuteDataSet(PlanningManagementStoredProcedure.usp_PLANINGMasterProgramGetItemDetails, null, masterProgramID, programCycleStartDate.ToUtc(), programCycleEndDate.ToUtc());
            decimal amount = 0;

            if (ObjDS == null || ObjDS.Tables.Count &lt; 2 || ObjDS.Tables[1].Rows.Count &lt; 1)
                return hasRemainingAmount;

            for (int i = 0; i &lt; ObjDS.Tables[1].Rows.Count; i++)
            {
                if (Decimal.TryParse(ObjDS.Tables[1].Rows[i][&quot;RemainingAmount&quot;].ToString(), out amount))
                {
                    if (amount != 0)
                    {
                        hasRemainingAmount = true;
                        break;
                    }
                }
            }

            return hasRemainingAmount;
        }

        /// &lt;summary&gt;
        /// Checks if any of the program is included in any other submitted Master Program
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;masterProgramID&quot;&gt;ID of the Master Program&lt;/param&gt;
        /// &lt;returns&gt;If any of the program is included in any other submitted master program then true, otherwise false&lt;/returns&gt;
        public bool IsAnyProgramIncludedInOtherSubmittedMasterProgram(int masterProgramID)
        {
            bool isIncludedInOtherSubmittedMasterProgram = false;


            Dictionary&lt;string, object&gt; dicReturn = new Dictionary&lt;string, object&gt;();
            int returnValue = 0;
            DataSet ObjValidate = ComponentHelper.Instance.ExecuteDataSet(PlanningManagementStoredProcedure.usp_PLANINGValidateProjectMasterProgramYear, dicReturn, masterProgramID);

            if (dicReturn.ContainsKey(&quot;return&quot;))
                returnValue = int.Parse(dicReturn[&quot;return&quot;].ToString());

            if (returnValue &gt; 0)
                isIncludedInOtherSubmittedMasterProgram = true;


            return isIncludedInOtherSubmittedMasterProgram;
        }

        public void UpdateMasterProgramStatus(int masterProgramID, MasterProgramStatus status)
        {
            PlanningManagementComponent.Instance.UpdateMasterprogramStatus(masterProgramID, status);
        }

        public bool ValidateMultipleMasterProgramPerYear(int masterProgramID)
        {
            bool multipleMasterProgramValidation = true;

            if (!IsMultipleMasterProgramPerYearAllowed())
            {
                if (PlanningManagementComponent.Instance.MasterProgramForYearAlreadyExists(masterProgramID))
                    multipleMasterProgramValidation = false;
            }

            return multipleMasterProgramValidation;
        }

        public bool IsMultipleMasterProgramPerYearAllowed()
        {
            List&lt;string&gt; components = Aurigo.AMP3.ModuleManagementBL.ModuleManager.Instance.GetModuleComponenets(Aurigo.AMP3.Common.Constants.MODID_PLANING);
            bool enableMultipleMstProgramCreationPerYear = false;

            if (components.Count != 0 &amp;&amp; components.Contains(&quot;MasterProgramAllowYearDuplication&quot;))
                enableMultipleMstProgramCreationPerYear = true;


            return enableMultipleMstProgramCreationPerYear;
        }

        /// &lt;summary&gt;
        /// Checks if 
        /// 1. one or more program is being referred in other master program.
        /// 2. Atleast one program is added to the master program
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;masterProgramID&quot;&gt;ID of the Master Program&lt;/param&gt;
        /// &lt;returns&gt;Error message if the validation fails, empty string otherwise&lt;/returns&gt;
        public string ValidateMasterProgramApproval(int masterProgramID)
        {
            return PlanningManagementComponent.Instance.ValidateMasterProgramApproval(masterProgramID);
        }

        /// &lt;summary&gt;
        /// Sets the IsDefer flag in PROJECTProjectMain to 0 for all the projects in MasterProgram
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;masterProgramID&quot;&gt;ID of the Master Program&lt;/param&gt;
        public void SetProjectIsDeferFlagToZero(int masterProgramID)
        {
            PlanningManagementComponent.Instance.SetProjectIsDeferFlagToZero(masterProgramID);
        }

        /// &lt;summary&gt;
        /// Gets details of Budget and Forecast for all the projects in a Master Program
        /// Check the comment inside the method for more information of each table
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;masterProgramID&quot;&gt;ID of the Master Program&lt;/param&gt;
        /// &lt;returns&gt;DataSet with 6 tables&lt;/returns&gt;
        public DataSet GetBudgetForecastDetailsForMasterProgram(int masterProgramID)
        {
            DataSet ds = PlanningManagementComponent.Instance.GetBudgetForecastDetailsForMasterProgram(masterProgramID);

            if (ds == null || ds.Tables.Count &lt; 6)
                return null;

            /*
             * Table 1: Gets the master program id            
             * Table 2: Gets budget forecast master data (does not include item distribution)
             * Table 3: Gets the land forecast master data
             * Table 4: Current forecast details for Master Program
             * Table 5: New forecast schedule data for budget estimate
             * Table 6: New forecast schedule data for land
             */

            ds.Tables[0].TableName = &quot;MasterProgramID&quot;;
            ds.Tables[1].TableName = &quot;BudgetForecastDetails&quot;;
            ds.Tables[2].TableName = &quot;LandForecastDetails&quot;;
            ds.Tables[3].TableName = &quot;MasterProgramForecastDetails&quot;;
            ds.Tables[4].TableName = &quot;NewProjectItemScheduleData&quot;;
            ds.Tables[5].TableName = &quot;NewLandScheduleData&quot;;

            return ds;
        }

        public object UpdateProgramForecast(int programID, int masterProgramID, string scheduleXml = null)
        {
            return PlanningManagementComponent.Instance.UpdateProgramForecast(programID, masterProgramID, scheduleXml);
        }

        public DataSet GetProgramsAndProjectsForMasterProgram(int masterProgramID)
        {
            return PlanningManagementComponent.Instance.GetProgramsAndProjectsForMasterProgram(masterProgramID);
        }

        public void UpdateProgramRevisionStatus(int programRevisionID, ProgramRevisionStatus status)
        {
            PlanningManagementComponent.Instance.UpdateProgramRevisionStatus(programRevisionID, status);
        }

        public bool CheckIfProgramRevisionHasAtleastOneItem(int programRevisionID)
        {
            bool hasAtleastOneItem = false;
            DataSet ds = PlanningManagementComponent.Instance.GetAddedAndRemovedProjectsForProgramRevision(programRevisionID);

            if (ds != null &amp;&amp; ds.Tables.Count &gt;= 2 &amp;&amp;
                (ds.Tables[0].Rows.Count &gt; 0 || ds.Tables[1].Rows.Count &gt; 0))
                hasAtleastOneItem = true;

            return hasAtleastOneItem;
        }

        /// &lt;summary&gt;
        /// Returns &lt;see cref=&quot;DataSet&quot;/&gt; with added and removed projects for the revision
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;programRevisionID&quot;&gt;ID of the Program Revision&lt;/param&gt;
        /// &lt;returns&gt;&lt;see cref=&quot;DataSet&quot;/&gt; with two tables. First table contails details of projects removed.&lt;/returns&gt;
        public DataSet GetAddedAndRemovedProjectsForProgramRevision(int programRevisionID)
        {
            return PlanningManagementComponent.Instance.GetAddedAndRemovedProjectsForProgramRevision(programRevisionID);
        }

        public int? GetProgramIDFromProgramRevision(int programRevisionID)
        {
            return PlanningManagementComponent.Instance.GetProgramIDFromProgramRevision(programRevisionID); ;
        }

        public void UpdateProgramFromProgramRevision(int programRevisionID)
        {
            PlanningManagementComponent.Instance.UpdateProgramFromProgramRevision(programRevisionID);
        }

        public void UpdateMasterProgramFromProgramRevision(int programRevisionID)
        {
            PlanningManagementComponent.Instance.UpdateMasterProgramFromProgramRevision(programRevisionID);
        }

        public int? GetMasterProgramIDFromProgramRevision(int programRevisionID)
        {
            return PlanningManagementComponent.Instance.GetMasterProgramIDFromProgramRevision(programRevisionID); ;
        }

        public DataSet GetBudgetDetailsForForecast(int forecastID)
        {
            return PlanningManagementComponent.Instance.GetBudgetDetailsForForecast(forecastID);
        }

        public DataSet GetProjectAndBudgetDetailsForForecast(int forecastID)
        {
            return PlanningManagementComponent.Instance.GetProjectAndBudgetDetailsForForecast(forecastID);
        }

        /// &lt;summary&gt;
        /// Updates the Budget Estimates table with the forecast ID
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;budgetEstimateID&quot;&gt;ID of the Budget Estimare&lt;/param&gt;
        /// &lt;param name=&quot;forecastID&quot;&gt;ID of the Forecast&lt;/param&gt;
        /// &lt;param name=&quot;forecastModifiedDate&quot;&gt;Modified Date of the Forecast&lt;/param&gt;
        public void UpdateBudgetEstimateWithForecastID(int budgetEstimateID, int forecastID, DateTime? forecastModifiedDate)
        {
            /*
             * Passing the current datetime instead of forecast modified date
             * Need to check if we ever need to pass the modified date
             * */
            DateTime? currentDateTime = MWDateTimeHelper.UtcNow;
            PlanningManagementComponent.Instance.UpdateBudgetEstimateWithForecastID(budgetEstimateID, forecastID, currentDateTime);
        }

        public DataSet GetProjectBudgetForecastDetailsForProgramRevision(int programRevisionID)
        {
            /*
             * This method returns details of projects, budgets and forecasts
             * for the projects that were added to the Program revision
             * Table 1: ProjectID, BEID, QPID as present in the MasterProgram
             * Table 2: Project, Budget and Forecast Details as in Budget and QTYPLN tables
             * */

            DataSet ds = PlanningManagementComponent.Instance.GetProjectBudgetForecastDetailsForProgramRevision(programRevisionID);

            if (ds != null &amp;&amp; ds.Tables.Count &gt;= 2)
            {
                ds.Tables[0].TableName = &quot;ProjectDetails&quot;;
                ds.Tables[1].TableName = &quot;BudgetForecastDetails&quot;;
            }

            return ds;
        }

        public void Update_PLANING_RollUpAmount_For_Program(int planningID)
        {
            PlanningManagementComponent.Instance.Update_PLANING_RollUpAmount_For_Program(planningID);
        }

        public void Update_PLANING_RollUpAmount_For_MasterProgram(int masterProgramId)
        {
            PlanningManagementComponent.Instance.Update_PLANING_RollUpAmount_For_MasterProgram(masterProgramId);
        }

        public DataSet GetCommonProjectsInPrograms(string programIDs)
        {
            return PlanningManagementComponent.Instance.GetCommonProjectsInPrograms(programIDs);
        }

        public int GetMasterProgramIDFromProgramID(int programID)
        {
            int masterProgramID = 0;
            DataSet ds = PlanningManagementComponent.Instance.GetMasterProgramFromProgramID(programID);

            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0 &amp;&amp; ds.Tables[0].Rows.Count &gt; 0)
                masterProgramID = ds.Tables[0].Rows[0][&quot;ID&quot;].ToInt32_2();

            return masterProgramID;
        }

        public bool AreProjectsPartOfMasterProgram(string projectIds, int masterProgramID)
        {
            bool isPartOfMasterProgram = false;
            DataSet ds = PlanningManagementComponent.Instance.CheckIfProjectsArePartOfMasterProgram(projectIds, masterProgramID);

            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0 &amp;&amp; ds.Tables[0].Rows.Count &gt; 0)
                isPartOfMasterProgram = true;

            return isPartOfMasterProgram;
        }

        public bool CheckIfProgramCycleConfigurationDataIsConsumed()
        {
            bool projectOrPlanningFundRecordsExist = PlanningManagementComponent.Instance.CheckIfAnyProgramOrPlanningFundExists();
            if (projectOrPlanningFundRecordsExist)
                return true;
            return false;
        }

        public ProgramCycle GetProgramCycle()
        {
            ProgramCycle pc = new ProgramCycle();
            DataTable dt = PlanningManagementComponent.Instance.GetProgramCycle();

            if (dt != null &amp;&amp; dt.Rows.Count &gt; 0)
            {
                string startMonth = dt.Rows[0][&quot;StartMonth&quot;].ToString();
                string endMonth = dt.Rows[0][&quot;EndMonth&quot;].ToString();

                pc.StartMonth = (Month)Enum.Parse(typeof(Month), startMonth);
                pc.EndMonth = (Month)Enum.Parse(typeof(Month), endMonth);

                pc.ProgramDuration = dt.Rows[0][&quot;ProgramDuration&quot;].ToInt32_2();
            }

            return pc;
        }

        public DataSet GetMasterProgramDetails(int masterProgramID)
        {
            return PlanningManagementComponent.Instance.GetMasterProgramDetails(masterProgramID);
        }

        public void GetProgramCycleStartAndEndDates(int masterProgramID, out DateTime startDate, out DateTime endDate)
        {
            startDate = DateTime.UtcNow;
            endDate = DateTime.UtcNow;

            ProgramCycle pc = PlanningManagementManager.Instance.GetProgramCycle();
            DataSet dsMPDetails = PlanningManagementManager.Instance.GetMasterProgramDetails(masterProgramID);

            if (dsMPDetails != null &amp;&amp; dsMPDetails.Tables.Count &gt; 0 &amp;&amp; dsMPDetails.Tables[0].Rows.Count &gt; 0)
            {
                int programYear = dsMPDetails.Tables[0].Rows[0][&quot;ProgramYear&quot;].ToInt32_2();

                startDate = new DateTime(programYear, pc.StartMonth.ToInt32_2(), 1);

                endDate = new DateTime(programYear + pc.ProgramDuration, pc.EndMonth.ToInt32_2(), DateTime.DaysInMonth(programYear, pc.EndMonth.ToInt32_2()));
            }
        }

        public DataSet GetProjectsInProgram(int programID)
        {
            return PlanningManagementComponent.Instance.GetProjectsInProgram(programID);
        }

        public DataSet GetProjectsInMasterProgram(int masterProgramID)
        {
            return PlanningManagementComponent.Instance.GetProjectsInMasterProgram(masterProgramID);
        }

        public void UpdateProgramDatesForProgram(int programID)
        {
            DataSet ds = GetProjectsInProgram(programID);

            if (ds == null || ds.Tables.Count == 0 || ds.Tables[0].Rows.Count == 0)
                return;

            CalendarCalculationsModel calendarModel = CalendarCalculationsModel.GetInstance(&quot;BDGTEST&quot;);
            CalendarDetails calendarDetails;
            StringBuilder projectDetails = new StringBuilder();

            projectDetails.Append(&quot;&lt;Root&gt;&quot;);

            foreach (DataRow dr in ds.Tables[0].Rows)
            {
                int projectID = dr[&quot;ProjectID&quot;].ToInt32_2();
                int qpID = dr[&quot;QPID&quot;].ToInt32_2();
                DateTime startDate = dr[&quot;StartDate&quot;].ToMWDateTime();
                DateTime endDate = dr[&quot;EndDate&quot;].ToMWDateTime();
                calendarDetails = calendarModel.GetCalendarDetails(projectID);

                if (!calendarModel.IsWorkingDay(calendarDetails, startDate))
                    startDate = calendarModel.GetNextWorkingDay(calendarDetails, startDate);

                if (!calendarModel.IsWorkingDay(calendarDetails, endDate))
                    endDate = calendarModel.GetPreviousWorkingDay(calendarDetails, endDate);

                if (endDate.Hour != calendarDetails.DefaultEndTime.Hours)
                    endDate = endDate.Date.AddHours(calendarDetails.DefaultEndTime.Hours);

                long effort = TimeSpan.FromHours(calendarModel.GetWorkingDaysCount(startDate, endDate, calendarDetails) * calendarDetails.Hours.TotalHours).Ticks;

                projectDetails.Append(&quot;&lt;Project&gt;&quot;);
                projectDetails.AppendFormat(&quot;&lt;ProjectID&gt;{0}&lt;/ProjectID&gt;&quot;, projectID);
                projectDetails.AppendFormat(&quot;&lt;QPID&gt;{0}&lt;/QPID&gt;&quot;, qpID);
                projectDetails.AppendFormat(&quot;&lt;Type&gt;{0}&lt;/Type&gt;&quot;, &quot;PROJECT&quot;);
                projectDetails.AppendFormat(&quot;&lt;StartDate&gt;{0}&lt;/StartDate&gt;&quot;, startDate.ToUtc().ToDateTimeString_ForDatabaseOpenXml());
                projectDetails.AppendFormat(&quot;&lt;EndDate&gt;{0}&lt;/EndDate&gt;&quot;, endDate.ToUtc().ToDateTimeString_ForDatabaseOpenXml());
                projectDetails.AppendFormat(&quot;&lt;EffortTicks&gt;{0}&lt;/EffortTicks&gt;&quot;, effort);

                projectDetails.Append(&quot;&lt;/Project&gt;&quot;);
            }

            projectDetails.Append(&quot;&lt;/Root&gt;&quot;);

            PlanningManagementComponent.Instance.UpdateProgramDatesForProgram(programID, &quot;PROGRAM&quot;, projectDetails.ToString());
        }

        public void UpdateProgramDatesForMasterProgram(int masterProgramID)
        {
            DataSet ds = GetProjectsInMasterProgram(masterProgramID);

            if (ds == null || ds.Tables.Count == 0 || ds.Tables[0].Rows.Count == 0)
                return;

            CalendarCalculationsModel calendarModel = CalendarCalculationsModel.GetInstance(&quot;BDGTEST&quot;);
            CalendarDetails calendarDetails;
            StringBuilder projectDetails = new StringBuilder();

            projectDetails.Append(&quot;&lt;Root&gt;&quot;);

            foreach (DataRow dr in ds.Tables[0].Rows)
            {
                int projectID = dr[&quot;ProjectID&quot;].ToInt32_2();
                int qpID = dr[&quot;QPID&quot;].ToInt32_2();
                DateTime startDate = dr[&quot;StartDate&quot;].ToMWDateTime();
                DateTime endDate = dr[&quot;EndDate&quot;].ToMWDateTime();
                calendarDetails = calendarModel.GetCalendarDetails(projectID);

                if (!calendarModel.IsWorkingDay(calendarDetails, startDate))
                    startDate = calendarModel.GetNextWorkingDay(calendarDetails, startDate);

                if (!calendarModel.IsWorkingDay(calendarDetails, endDate))
                    endDate = calendarModel.GetPreviousWorkingDay(calendarDetails, endDate);

                if (endDate.Hour != calendarDetails.DefaultEndTime.Hours)
                    endDate = endDate.Date.AddHours(calendarDetails.DefaultEndTime.Hours);

                long effort = TimeSpan.FromHours(calendarModel.GetWorkingDaysCount(startDate, endDate, calendarDetails) * calendarDetails.Hours.TotalHours).Ticks;

                projectDetails.Append(&quot;&lt;Project&gt;&quot;);
                projectDetails.AppendFormat(&quot;&lt;ProjectID&gt;{0}&lt;/ProjectID&gt;&quot;, projectID);
                projectDetails.AppendFormat(&quot;&lt;QPID&gt;{0}&lt;/QPID&gt;&quot;, qpID);
                projectDetails.AppendFormat(&quot;&lt;Type&gt;{0}&lt;/Type&gt;&quot;, &quot;PROJECT&quot;);
                projectDetails.AppendFormat(&quot;&lt;StartDate&gt;{0}&lt;/StartDate&gt;&quot;, startDate.ToUtc().ToDateTimeString_ForDatabaseOpenXml());
                projectDetails.AppendFormat(&quot;&lt;EndDate&gt;{0}&lt;/EndDate&gt;&quot;, endDate.ToUtc().ToDateTimeString_ForDatabaseOpenXml());
                projectDetails.AppendFormat(&quot;&lt;EffortTicks&gt;{0}&lt;/EffortTicks&gt;&quot;, effort);

                projectDetails.Append(&quot;&lt;/Project&gt;&quot;);
            }

            projectDetails.Append(&quot;&lt;/Root&gt;&quot;);

            PlanningManagementComponent.Instance.UpdateProgramDatesForMasterProgram(masterProgramID, &quot;MSTRPLN&quot;, projectDetails.ToString());
        }
        #endregion

        #region Internal Methods

        internal void ExportGridData(string eventString, DataTable dt, string sheetName, string WorkBookName,
                                        string[] hiddencols = null, Dictionary&lt;string, string&gt; editcols = null, Dictionary&lt;string, string&gt; renameColumns = null, Dictionary&lt;string, string&gt; totalColumns = null)
        {
            DataSet ds = new DataSet();
            ds.Tables.Add(dt.Copy());
            ds.Tables[0].TableName = sheetName;
            ExcelExportEntity excelExportEntity = new ExcelExportEntity(ds);
            excelExportEntity.ExcelDataSet.DataSetName = WorkBookName;
            if (hiddencols != null &amp;&amp; hiddencols.Length &gt; 0)
            {
                excelExportEntity.HiddenColumnsByTableNameAndSheetName = new Dictionary&lt;string, IList&lt;string&gt;&gt;();
                List&lt;string&gt; hiddenColumnsList = hiddencols.Cast&lt;string&gt;().ToList();
                excelExportEntity.HiddenColumnsByTableNameAndSheetName.Add(sheetName, hiddenColumnsList);
            }
            if (renameColumns != null &amp;&amp; renameColumns.Count &gt; 0)
            {
                excelExportEntity.NewColumnNamesByTableNameAndSheetName = new Dictionary&lt;string, Dictionary&lt;string, string&gt;&gt;();
                excelExportEntity.NewColumnNamesByTableNameAndSheetName.Add(sheetName, renameColumns);
            }
            if (totalColumns != null &amp;&amp; totalColumns.Count &gt; 0)
            {
                excelExportEntity.ColumnsToBeTotalled = new Dictionary&lt;string, Dictionary&lt;string, string&gt;&gt;();
                excelExportEntity.ColumnsToBeTotalled.Add(sheetName, totalColumns);
            }
            ExcelHelper.ExportToExcel(eventString, excelExportEntity);
        }

        internal int GetScheduleID(DataTable dt, string name, int StartNo)
        {
            if (dt.Columns.Contains(&quot;Name&quot;))
            {
                if (dt.Rows.Count &gt; 0 &amp;&amp; dt.Rows[0][&quot;PeriodBasis&quot;].ToString2().Equals(&quot;2&quot;))
                {
                    DateTime stDt;
                    DateTime.TryParse(dt.Rows[0][&quot;Name&quot;].ToString2(), out stDt);
                    return (Convert.ToDateTime(name, DateFormatCulture.GetDateFormatCulture()) - stDt).Days + StartNo;
                }
                else
                    return dt.Select(&quot;Name = &#39;&quot; + name + &quot;&#39;&quot;)[0][&quot;Number&quot;].ToInt32_2(); // Monthly
            }
            else
                return name.Split(&#39;:&#39;)[0].Replace(&quot;Week &quot;, &quot;&quot;).Trim().ToInt32_2() + StartNo - 1; // Weekly
        }

        internal DataRow ValidateBudgetForecastCompletion(int forecastId)
        {
            DataSet dsResult = PlanningManagementComponent.Instance.ValidateBudgetForecastCompletion(forecastId);
            if (dsResult != null &amp;&amp; dsResult.Tables.Count &gt; 0 &amp;&amp; dsResult.Tables[0].Rows.Count &gt; 0)
                return dsResult.Tables[0].Rows[0];
            else
                return null;
        }

        internal DataRow ValidateBudgetForecastPublish(int forecastId)
        {
            DataSet dsResult = PlanningManagementComponent.Instance.ValidateBudgetForecastPublish(forecastId);
            if (dsResult != null &amp;&amp; dsResult.Tables.Count &gt; 0 &amp;&amp; dsResult.Tables[0].Rows.Count &gt; 0)
                return dsResult.Tables[0].Rows[0];
            else
                return null;
        }

        internal bool ValidateBudgetForecastUnPublish(int forecastId)
        {
            object canUnPublish = PlanningManagementComponent.Instance.ValidateBudgetForecastUnPublish(forecastId);
            return canUnPublish?.ToBoolean2() ?? false;

        }

        internal bool ValidateForecastItems(int forecastId)
        {
            DataSet errorLogData = QuantityPlanningManager.Instance.GetInvalidElements(forecastId);
            bool hasError = false;
            foreach (DataTable table in errorLogData.Tables)
                if (table.Rows.Count &gt; 0)
                {
                    hasError = true;
                    break;
                }

            return hasError;
        }

        public DataSet GetProjectsAndLandsForProgram(decimal programBudget, int includeExecutionProjects, double minProjectValue, double maxProjectValue, int programCategory, bool includeLand)
        {
            return PlanningManagementComponent.Instance.GetProjectsAndLandsForProgram(programBudget, includeExecutionProjects, minProjectValue, maxProjectValue, programCategory, includeLand);
        }

        internal void UpdateBudgetSettings(string startMonth, string endMonth, int duration)
        {
            PlanningManagementComponent.Instance.UpdateBudgetSettings(startMonth, endMonth, duration);
        }

        #endregion

        #region Private Methods

        private string DataSetToXml(DataSet ds)
        {
            using (var memoryStream = new MemoryStream())
            {
                using (TextWriter streamWriter = new StreamWriter(memoryStream))
                {
                    var xmlSerializer = new XmlSerializer(typeof(DataSet));
                    xmlSerializer.Serialize(streamWriter, ds);
                    return Encoding.UTF8.GetString(memoryStream.ToArray());
                }
            }
        }

        private DataSet XMLToDataSet(string xml)
        {
            XmlReader xmlReader = XmlReader.Create(new StringReader(xml));
            var dataSet = (DataSet)new XmlSerializer(typeof(DataSet)).Deserialize(xmlReader);
            DataSet ds1 = new DataSet();
            var dataSet1 = ds1.ReadXml(xmlReader);

            return dataSet;
        }

        #endregion
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[45,9,45,10,1],[46,13,46,43,1],[47,13,47,14,1],[48,17,48,74,1],[49,17,49,103,1],[50,17,50,24,1],[50,26,50,33,0],[50,34,50,36,1],[50,37,50,41,1],[51,21,51,63,0],[52,13,52,14,1],[53,9,53,10,1],[55,9,55,43,1],[56,9,56,10,1],[57,9,57,10,1],[63,41,63,42,1],[63,43,63,92,1],[63,93,63,94,1],[63,99,63,100,0],[63,101,63,102,0],[65,40,65,41,1],[65,42,65,59,1],[65,60,65,61,1],[65,66,65,67,0],[65,68,65,69,0],[68,9,68,10,1],[70,13,70,14,1],[71,17,71,131,1],[72,17,72,44,1],[73,17,73,119,1],[75,17,75,42,1],[77,17,77,67,1],[81,17,81,72,1],[82,17,82,18,1],[83,26,83,35,1],[83,37,83,64,1],[83,66,83,69,1],[84,21,84,22,1],[85,25,86,56,1],[87,25,87,75,1],[88,29,88,76,0],[89,21,89,22,1],[90,17,90,18,1],[92,17,92,114,1],[94,17,94,72,1],[95,21,95,97,1],[98,17,98,24,1],[98,26,98,33,0],[98,34,98,36,1],[98,37,98,54,1],[99,17,99,18,0],[100,21,101,100,0],[102,21,102,89,0],[104,21,104,63,0],[105,17,105,18,0],[108,17,108,83,1],[111,17,111,29,1],[113,13,113,33,0],[114,13,114,14,0],[115,17,115,93,0],[116,17,116,23,0],[118,9,118,10,1],[121,9,121,10,1],[122,13,122,53,1],[123,9,123,10,1],[130,9,130,10,1],[131,13,131,95,1],[132,9,132,10,1],[135,9,135,10,1],[136,13,136,84,1],[137,9,137,10,1],[140,9,140,10,0],[141,13,141,114,0],[142,9,142,10,0],[145,9,145,10,1],[146,13,146,143,1],[147,9,147,10,1],[150,9,150,10,0],[151,13,151,123,0],[152,9,152,10,0],[155,9,155,10,1],[156,13,156,89,1],[157,9,157,10,1],[160,9,160,10,0],[161,13,161,76,0],[162,9,162,10,0],[165,9,165,10,1],[166,13,166,65,1],[167,13,167,135,1],[168,13,168,54,1],[169,9,169,10,1],[172,9,172,10,0],[173,13,173,107,0],[176,9,176,10,0],[179,9,179,10,1],[180,13,180,65,1],[181,13,181,147,1],[182,13,182,54,1],[183,9,183,10,1],[186,9,186,10,0],[187,13,187,163,0],[188,9,188,10,0],[191,9,191,10,0],[194,13,194,63,0],[195,13,195,55,0],[196,13,196,54,0],[197,13,197,57,0],[199,13,199,76,0],[200,13,200,81,0],[201,13,201,81,0],[202,13,202,73,0],[204,13,204,29,0],[205,13,205,80,0],[207,13,207,161,0],[208,13,208,44,0],[209,17,209,68,0],[211,13,211,31,0],[213,13,213,33,0],[214,13,214,14,0],[215,17,215,95,0],[216,17,216,38,0],[217,17,217,18,0],[218,21,218,130,0],[219,21,219,22,0],[220,25,220,90,0],[222,25,223,126,0],[225,25,225,65,0],[226,25,226,198,0],[227,25,227,56,0],[228,29,228,80,0],[230,25,230,45,0],[231,25,231,26,0],[232,29,233,164,0],[235,29,236,160,0],[238,29,239,163,0],[241,29,241,41,0],[243,21,243,22,0],[244,17,244,18,0],[245,13,245,14,0],[246,13,246,26,0],[247,9,247,10,0],[250,9,250,10,1],[251,13,251,117,1],[252,9,252,10,1],[255,9,255,10,0],[256,13,256,62,0],[257,13,257,110,0],[259,13,259,82,0],[260,17,260,60,0],[262,13,262,56,0],[263,9,263,10,0],[271,9,271,10,1],[272,13,272,38,1],[273,13,273,110,1],[275,13,275,82,1],[276,17,276,75,1],[278,13,278,37,1],[279,9,279,10,1],[282,9,282,10,0],[283,13,283,79,0],[284,13,284,14,0],[285,17,285,102,0],[288,13,288,76,0],[289,13,289,14,0],[290,17,290,138,0],[293,13,293,25,0],[294,9,294,10,0],[298,9,298,10,0],[299,13,299,105,0],[301,13,301,95,0],[303,13,305,97,0],[306,9,306,10,0],[312,9,312,10,1],[313,13,313,62,1],[314,13,314,43,1],[315,13,315,73,1],[316,13,316,69,1],[318,13,318,35,1],[319,17,319,193,1],[321,13,321,210,1],[323,13,323,48,1],[324,17,324,46,0],[326,13,326,206,1],[328,13,328,48,1],[329,17,329,46,0],[331,13,331,208,1],[333,13,333,48,1],[334,17,334,46,0],[336,13,336,82,1],[337,17,337,68,0],[338,9,338,10,1],[341,9,341,10,0],[342,13,342,31,0],[343,13,343,111,0],[345,13,345,82,0],[346,17,346,76,0],[348,13,348,30,0],[349,9,349,10,0],[352,9,352,10,0],[353,13,353,47,0],[355,13,355,116,0],[357,13,357,82,0],[358,17,358,99,0],[360,13,360,41,0],[361,9,361,10,0],[364,9,364,10,1],[365,13,365,115,1],[366,9,366,10,1],[369,9,369,10,1],[370,13,370,102,1],[371,9,371,10,1],[374,9,374,10,1],[375,13,375,103,1],[376,9,376,10,1],[379,9,379,10,1],[380,13,380,89,1],[381,9,381,10,1],[384,9,384,10,0],[385,13,385,50,0],[386,13,386,104,0],[388,13,388,49,0],[389,17,389,48,0],[391,13,391,44,0],[392,9,392,10,0],[395,9,395,10,1],[396,13,396,50,1],[397,13,397,102,1],[398,13,398,28,1],[399,13,399,14,1],[400,17,400,24,1],[400,26,400,36,0],[400,37,400,39,1],[400,40,400,47,1],[401,17,401,18,0],[402,21,402,63,0],[403,17,403,18,0],[404,13,404,14,1],[405,13,405,29,1],[406,9,406,10,1],[409,9,409,10,0],[410,13,410,50,0],[411,13,411,106,0],[412,13,412,28,0],[413,13,413,14,0],[414,17,414,24,0],[414,26,414,36,0],[414,37,414,39,0],[414,40,414,47,0],[415,17,415,18,0],[416,21,416,64,0],[417,17,417,18,0],[418,13,418,14,0],[419,13,419,29,0],[420,9,420,10,0],[427,9,427,10,1],[428,13,428,34,1],[429,13,429,83,1],[431,13,431,49,1],[432,13,432,14,1],[433,17,433,39,1],[434,17,434,73,1],[435,17,435,69,1],[437,17,437,69,1],[438,17,438,65,1],[440,17,440,78,1],[441,17,441,18,0],[442,21,442,112,0],[443,21,443,177,0],[444,17,444,18,0],[446,17,446,18,1],[447,21,447,108,1],[448,21,448,185,1],[449,17,449,18,1],[450,13,450,14,1],[452,13,452,23,1],[453,9,453,10,1],[461,9,461,10,1],[462,13,462,45,1],[463,13,463,226,1],[464,13,464,32,1],[466,13,466,91,1],[467,17,467,43,0],[469,18,469,27,1],[469,29,469,59,1],[469,61,469,64,1],[470,13,470,14,1],[471,17,471,105,1],[472,17,472,18,1],[473,21,473,37,1],[474,21,474,22,0],[475,25,475,51,0],[476,25,476,31,0],[478,17,478,18,1],[479,13,479,14,1],[481,13,481,39,1],[482,9,482,10,1],[490,9,490,10,1],[491,13,491,66,1],[494,13,494,85,1],[495,13,495,33,1],[496,13,496,182,1],[498,13,498,49,1],[499,17,499,73,1],[501,13,501,33,1],[502,17,502,64,0],[505,13,505,60,1],[506,9,506,10,1],[509,9,509,10,1],[510,13,510,101,1],[511,9,511,10,1],[514,9,514,10,1],[515,13,515,57,1],[517,13,517,58,1],[518,13,518,14,0],[519,17,519,109,0],[520,21,520,61,0],[521,13,521,14,0],[523,13,523,52,1],[524,9,524,10,1],[527,9,527,10,1],[528,13,528,158,1],[529,13,529,66,1],[531,13,531,99,1],[532,17,532,64,1],[535,13,535,60,1],[536,9,536,10,1],[546,9,546,10,1],[547,13,547,104,1],[548,9,548,10,1],[555,9,555,10,1],[556,13,556,95,1],[557,9,557,10,1],[566,9,566,10,1],[567,13,567,121,1],[569,13,569,51,1],[570,17,570,29,0],[581,13,581,56,1],[582,13,582,62,1],[583,13,583,60,1],[584,13,584,69,1],[585,13,585,67,1],[586,13,586,60,1],[588,13,588,23,1],[589,9,589,10,1],[592,9,592,10,1],[593,13,593,120,1],[594,9,594,10,1],[597,9,597,10,1],[598,13,598,113,1],[599,9,599,10,1],[602,9,602,10,1],[603,13,603,105,1],[604,9,604,10,1],[607,9,607,10,1],[608,13,608,44,1],[609,13,609,127,1],[611,13,612,78,1],[613,17,613,42,1],[615,13,615,38,1],[616,9,616,10,1],[624,9,624,10,1],[625,13,625,121,1],[626,9,626,10,1],[629,9,629,10,1],[630,13,630,108,1],[631,9,631,10,1],[634,9,634,10,1],[635,13,635,102,1],[636,9,636,10,1],[639,9,639,10,1],[640,13,640,108,1],[641,9,641,10,1],[644,9,644,10,1],[645,13,645,114,1],[646,9,646,10,1],[649,9,649,10,1],[650,13,650,97,1],[651,9,651,10,1],[654,9,654,10,1],[655,13,655,107,1],[656,9,656,10,1],[665,9,665,10,1],[670,13,670,65,1],[671,13,671,132,1],[672,9,672,10,1],[675,9,675,10,1],[683,13,683,132,1],[685,13,685,52,1],[686,13,686,14,1],[687,17,687,59,1],[688,17,688,66,1],[689,13,689,14,1],[691,13,691,23,1],[692,9,692,10,1],[695,9,695,10,0],[696,13,696,102,0],[697,9,697,10,0],[700,9,700,10,0],[701,13,701,113,0],[702,9,702,10,0],[705,9,705,10,1],[706,13,706,97,1],[707,9,707,10,1],[710,9,710,10,1],[711,13,711,37,1],[712,13,712,104,1],[714,13,714,82,1],[715,17,715,74,1],[717,13,717,36,1],[718,9,718,10,1],[721,9,721,10,1],[722,13,722,48,1],[723,13,723,130,1],[725,13,725,82,1],[726,17,726,46,0],[728,13,728,42,1],[729,9,729,10,1],[732,9,732,10,0],[733,13,733,131,0],[734,13,734,51,0],[735,17,735,29,0],[736,13,736,26,0],[737,9,737,10,0],[740,9,740,10,1],[741,13,741,50,1],[742,13,742,83,1],[744,13,744,49,1],[745,13,745,14,1],[746,17,746,73,1],[747,17,747,69,1],[749,17,749,78,1],[750,17,750,74,1],[752,17,752,80,1],[753,13,753,14,1],[755,13,755,23,1],[756,9,756,10,1],[759,9,759,10,1],[760,13,760,98,1],[761,9,761,10,1],[764,9,764,10,1],[765,13,765,41,1],[766,13,766,39,1],[768,13,768,84,1],[769,13,769,111,1],[771,13,771,109,1],[772,13,772,14,1],[773,17,773,92,1],[775,17,775,85,1],[777,17,777,159,1],[778,13,778,14,1],[779,9,779,10,1],[782,9,782,10,1],[783,13,783,89,1],[784,9,784,10,1],[787,9,787,10,1],[788,13,788,101,1],[789,9,789,10,1],[792,9,792,10,1],[793,13,793,58,1],[795,13,795,84,1],[796,17,796,24,1],[798,13,798,104,1],[800,13,800,64,1],[802,13,802,45,1],[804,13,804,20,1],[804,22,804,32,1],[804,33,804,35,1],[804,36,804,53,1],[805,13,805,14,1],[806,17,806,61,1],[807,17,807,51,1],[808,17,808,69,1],[809,17,809,65,1],[810,17,810,79,1],[812,17,812,77,1],[813,21,813,93,0],[815,17,815,75,1],[816,21,816,93,0],[818,17,818,74,1],[819,21,819,91,1],[821,17,821,163,1],[823,17,823,52,1],[824,17,824,86,1],[825,17,825,71,1],[826,17,826,76,1],[827,17,827,132,1],[828,17,828,126,1],[829,17,829,87,1],[831,17,831,53,1],[832,13,832,14,1],[834,13,834,46,1],[836,13,836,128,1],[837,9,837,10,1],[840,9,840,10,1],[841,13,841,70,1],[843,13,843,84,1],[844,17,844,24,0],[846,13,846,104,1],[848,13,848,64,1],[850,13,850,45,1],[852,13,852,20,1],[852,22,852,32,1],[852,33,852,35,1],[852,36,852,53,1],[853,13,853,14,1],[854,17,854,61,1],[855,17,855,51,1],[856,17,856,69,1],[857,17,857,65,1],[858,17,858,79,1],[860,17,860,77,1],[861,21,861,93,0],[863,17,863,75,1],[864,21,864,93,0],[866,17,866,74,1],[867,21,867,91,0],[869,17,869,163,1],[871,17,871,52,1],[872,17,872,86,1],[873,17,873,71,1],[874,17,874,76,1],[875,17,875,132,1],[876,17,876,126,1],[877,17,877,87,1],[879,17,879,53,1],[880,13,880,14,1],[882,13,882,46,1],[884,13,884,140,1],[885,9,885,10,1],[892,9,892,10,0],[893,13,893,40,0],[894,13,894,38,0],[895,13,895,48,0],[896,13,896,77,0],[897,13,897,71,0],[898,13,898,61,0],[899,13,899,14,0],[900,17,900,114,0],[901,17,901,85,0],[902,17,902,106,0],[903,13,903,14,0],[904,13,904,66,0],[905,13,905,14,0],[906,17,906,128,0],[907,17,907,103,0],[908,13,908,14,0],[909,13,909,64,0],[910,13,910,14,0],[911,17,911,110,0],[912,17,912,84,0],[913,13,913,14,0],[914,13,914,71,0],[915,9,915,10,0],[918,9,918,10,0],[919,13,919,45,0],[920,13,920,14,0],[921,17,921,92,0],[922,17,922,18,0],[924,21,924,81,0],[925,21,925,119,0],[928,21,928,88,0],[931,17,931,97,0],[932,9,932,10,0],[935,9,935,10,1],[936,13,936,114,1],[937,13,937,100,1],[938,17,938,51,1],[940,17,940,29,0],[941,9,941,10,1],[944,9,944,10,1],[945,13,945,111,1],[946,13,946,100,1],[947,17,947,51,1],[949,17,949,29,0],[950,9,950,10,1],[953,9,953,10,1],[954,13,954,116,1],[955,13,955,56,1],[957,9,957,10,1],[960,9,960,10,1],[961,13,961,100,1],[962,13,962,35,1],[963,13,963,20,1],[963,22,963,37,1],[963,38,963,40,1],[963,41,963,60,1],[964,17,964,42,1],[965,17,965,18,0],[966,21,966,37,0],[967,21,967,27,0],[970,13,970,29,1],[971,9,971,10,1],[974,9,974,10,1],[975,13,975,192,1],[976,9,976,10,1],[979,9,979,10,0],[980,13,980,103,0],[981,9,981,10,0],[988,9,988,10,0],[989,20,989,57,0],[990,13,990,14,0],[991,24,991,80,0],[992,17,992,18,0],[993,21,993,76,0],[994,21,994,63,0],[995,21,995,76,0],[998,9,998,10,0],[1001,9,1001,10,0],[1002,13,1002,75,0],[1003,13,1003,94,0],[1004,13,1004,41,0],[1005,13,1005,51,0],[1007,13,1007,28,0],[1008,9,1008,10,0]]);
    </script>
  </body>
</html>