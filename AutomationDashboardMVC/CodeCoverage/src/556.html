<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Construction Vertical\Main Modules\Planning Management\BL\WorkProjectListManagerModel.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Globalization;
using System.DirectoryServices;
using Aurigo.AMP3.UserManagementDTO;
using Aurigo.AMP3.UserManagementBL;
using Aurigo.AMP3.DataAccess.Core;
using System.Data;
using Aurigo.Brix.Core.WebUiHelper;
using Aurigo.Common;
using Aurigo.Brix.Platform.BusinessLayer.AbstractModels;
using Aurigo.AMP3.Core.AbstractModels;
using System.Web.UI.WebControls;
using Infragistics.WebUI.WebDataInput;
using Telerik.Web.UI;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Aurigo.AMP3.Common;
using System.Web.Script.Serialization;
using Aurigo.AMP3.Core.UserControls;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.Brix.Platform.BusinessLayer.DataResouces;
using Aurigo.AMP3.ProjectDTO;
using Aurigo.AMP3.ProjectBL;
using System.Web.UI;
using System.Text;
using Aurigo.Brix.Platform.BusinessLayer.BL;
using Aurigo.Brix.Platform.BusinessLayer.UserControls;

namespace Aurigo.Brix.Construction.PlanningManagement
{
    public class WorkProjectListMangerModel : XMLListManagerModel
    {
        public string BusinessUnit_Text { get { return AMP3.Resources.TerminologyResources.LocalizationManager.GetString(&quot;BusinessUnit&quot;); } }

        //Commented Asheesh2016:This is not there in screen: Unnecessary performance hit: hence commented :
        //private string LoadPicker { get; set; }
        private string LoadWPPicker { get; set; }
        //Commented Asheesh2016:This is not there in screen: Unnecessary performance hit: hence commented :
        //private HiddenField hdnPickerSelectedRows;
        //private HiddenField hdnWPPickerSelectedRows;
        private HiddenField hdnDeleteAssociation;
        AMP3.Core.AbstractModels.ListModel listModel;

        int ProjectID
        {
            get
            {
                string projectid = (string.IsNullOrEmpty(HttpContext.Current.Request.QueryString[&quot;PID&quot;]) ? &quot;0&quot; : HttpContext.Current.Request.QueryString[&quot;PID&quot;]);
                return projectid.ToInt32_2();
            }
        }


        public override void AfterSetUIDetails(ListModel model, XmlFormArgs e)
        {
            model.ModifyColumnProperties(&quot;AutoGeneratedID&quot;, false, null, null, null, false, &quot;Auto Generated ID&quot;);
            model.ModifyColumnProperties(&quot;Name&quot;, false, null, null, null, false, &quot;Name&quot;);
            model.ModifyColumnProperties(&quot;Description&quot;, false, null, null, null, false, &quot;Description&quot;);
            model.ModifyColumnProperties(&quot;Code&quot;, false, null, null, null, false, &quot;ID&quot;);
            model.ModifyColumnProperties(&quot;ProgramYear&quot;, false, null, null, null, false, &quot;Program Year&quot;);
            model.ModifyColumnProperties(&quot;Business Unit&quot;, false, null, null, null, false, BusinessUnit_Text);
            model.ModifyColumnProperties(&quot;ProgramCategoryID&quot;, true, null, null, null, false, &quot;ProgramCategoryID&quot;);
        }

        public override void AddItemsToMenuGroups(List&lt;MenuGroup&gt; menuGroups)
        {
            if (ProjectID == 0)
            {
                base.AddItemsToMenuGroups(menuGroups);
                MenuGroup groupWP = menuGroups.Find(x =&gt; x.Title == &quot;Work Projects&quot;);
                if (groupWP != null)
                {
                    menuGroups.Remove(groupWP);
                }
            }
        }

        public override void CustomizeToolBarMenu(ListModel model, AMP3.Core.UserControls.ToolBar toolBar)
        {
            //Commented Asheesh2016:This is not there in screen: Unnecessary performance hit: hence commented :
            //if (toolBar.GetMenuReference(&quot;lnkAddWP&quot;) != null &amp;&amp; ProjectID &gt; 0)
            //    toolBar.GetMenuReference(&quot;lnkAddWP&quot;).OnClientClick = LoadWPPicker;

            //Commented Asheesh2016:This is not there in screen: Unnecessary performance hit: hence commented :
            //if (toolBar.GetMenuReference(&quot;lnkAssociate&quot;) != null)
            //    toolBar.GetMenuReference(&quot;lnkAssociate&quot;).Visible = false;
            ////toolBar.GetMenuReference(&quot;lnkAssociate&quot;).OnClientClick = &quot;var isSelected = lnkValidation(&#39;&quot; +
            ////                                                            Convert.ToInt32(ValidateSelection.OneItem,
            ////                                                                            CultureInfo.CurrentCulture) +
            ////                                                            &quot;&#39;, &#39;&quot; + model.mwGrid.ClientID + &quot;&#39;, &#39;&quot; +
            ////                                                            model.QueryStringName + &quot;&#39;); &quot; + &quot;if(isSelected) &quot; + LoadPicker;
            //if (toolBar.GetMenuReference(&quot;lnkAssociate&quot;) != null)
            //    toolBar.GetMenuReference(&quot;lnkAssociate&quot;).OnClientClick = LoadPicker;

            if (toolBar.GetMenuReference(&quot;lnkDisassociate&quot;) != null &amp;&amp; ProjectID == 0)
                toolBar.GetMenuReference(&quot;lnkDisassociate&quot;).Visible = false;

            if (toolBar.GetMenuReference(&quot;lnkDisassociate&quot;) != null &amp;&amp; ProjectID &gt; 0)
                toolBar.GetMenuReference(&quot;lnkDisassociate&quot;).OnClientClick =
                    &quot;if(lnkValidation(&#39;&quot; + Convert.ToInt32(ValidateSelection.OneItem, CultureInfo.CurrentCulture) + &quot;&#39;, &#39;&quot; + model.mwGrid.ClientID + &quot;&#39;, &#39;&quot; + model.QueryStringName + &quot;&#39;))&quot; +
                    &quot; {if(IsWPLinked(&#39;&quot; + model.mwGrid.ClientID + &quot;&#39;, &#39;&quot; + model.QueryStringName + &quot;&#39;)) {return  DeleteAssociation(&#39;&quot; + hdnDeleteAssociation.ClientID + &quot;&#39;);} &quot; +
                    &quot; else{if (confirm(&#39;Do you want to disassociate the selected work project?&#39;)){return true;} else {return false;}}} else { return false;}&quot;;

            if (toolBar.GetMenuReference(&quot;lnkDelete&quot;) != null &amp;&amp; ProjectID != 0)
                toolBar.GetMenuReference(&quot;lnkDelete&quot;).Visible = false;
            if (ProjectID &gt; 0)
            {
                if (toolBar.GetMenuReference(&quot;lnkNew&quot;) != null)
                    toolBar.GetMenuReference(&quot;lnkNew&quot;).Visible = false;
            }
            else
            {
                //Commented Asheesh2016:This is not there in screen: Unnecessary performance hit: hence commented :
                //if (toolBar.GetMenuReference(&quot;lnkAddWP&quot;) != null)
                //    toolBar.GetMenuReference(&quot;lnkAddWP&quot;).Visible = false;
            }
        }

        //Commented Asheesh2016:This is not there in screen: Unnecessary performance hit: hence commented :
        //private string ProgramCatID(ListModel model)
        //{
        //    foreach (var row in MWGrid.GetRows(model.mwGrid))
        //    {

        //        return MWGrid.GetCellValue(row, &quot;ProgramCategory&quot;);
        //    }
        //    return &quot;&quot;;
        //}

        //Commented Asheesh2016:This is not there in screen: Unnecessary performance hit: hence commented :
        //private void objGrid_OnGridLoad(PickerGrid grid)
        //{
        //    throw new NotImplementedException(&quot;Note to Developer: Please add where condition to filter by business unit WHEN REMOVING THIS EXCEPTION.&quot;);
        //    string ProgramCategoryID = string.Empty;
        //    ProgramCategoryID = ProgramCatID(listModel);
        //    StringBuilder parameters = new StringBuilder();
        //    parameters.Append(&quot;{&quot;);
        //    parameters.Append(&quot;\&quot;DataSource\&quot; : \&quot;_table:vw_PlanningProjects\&quot;&quot;);
        //    if (HttpContext.Current.Request.QueryString[&quot;PID&quot;] != null)
        //        parameters.Append(&quot;,\&quot;WhereCond\&quot; : \&quot;PID @^ &quot; + ProjectID + &quot;PID ProgramCategory @^ &quot; + ProgramCategoryID + &quot;ProgramCategory\&quot;&quot;);
        //    parameters.Append(&quot;}&quot;);

        //    grid.OptionalParamaters = grid.BuildOptionalParameters(parameters.ToString());
        //}

        //Commented Asheesh2016:This is not there in screen: Unnecessary performance hit: hence commented :
        //private void WPobjGrid_OnGridLoad(PickerGrid grid)
        //{
        //    throw new NotImplementedException(&quot;Note to Developer: Please add where condition to filter by business unit WHEN REMOVING THIS EXCEPTION.&quot;);
        //    StringBuilder parameters = new StringBuilder();
        //    parameters.Append(&quot;{&quot;);
        //    parameters.Append(&quot;\&quot;DataSource\&quot; : \&quot;_table:vw_PlanningProjects\&quot;&quot;);
        //    parameters.Append(&quot;,\&quot;WhereCond\&quot; : \&quot;PID @^ &quot; + ProjectID + &quot;PID\&quot;&quot;);
        //    parameters.Append(&quot;}&quot;);

        //    grid.OptionalParamaters = grid.BuildOptionalParameters(parameters.ToString());
        //}

        //Commented Asheesh2016:This is not there in screen: Unnecessary performance hit: hence commented :
        //private List&lt;PickerColumnDetails&gt; GetGridColumns()
        //{
        //    List&lt;PickerColumnDetails&gt; gridColumns = new List&lt;PickerColumnDetails&gt;();

        //    gridColumns.Add(new PickerColumnDetails { ColumnName = &quot;RowNum&quot;, Caption = &quot;RowNum&quot;, Hidden = true, Type = &quot;number&quot; });
        //    gridColumns.Add(new PickerColumnDetails { ColumnName = &quot;ProjectId&quot;, Caption = &quot;ProjectId&quot;, Hidden = true, Type = &quot;number&quot; });
        //    gridColumns.Add(new PickerColumnDetails { ColumnName = &quot;ProjectName&quot;, Caption = &quot;Name&quot;, Hidden = false, Type = &quot;string&quot; });
        //    gridColumns.Add(new PickerColumnDetails { ColumnName = &quot;ProgramYear&quot;, Caption = &quot;Program Year&quot;, Hidden = false, Type = &quot;string&quot; });
        //    gridColumns.Add(new PickerColumnDetails { ColumnName = &quot;StatusName&quot;, Caption = &quot;Status&quot;, Hidden = false, Type = &quot;string&quot; });
        //    gridColumns.Add(new PickerColumnDetails { ColumnName = &quot;ProgramCategory&quot;, Caption = &quot;Program Category&quot;, Hidden = false, Type = &quot;string&quot; });
        //    return gridColumns;
        //}
        //Commented Asheesh2016:This is not there in screen: Unnecessary performance hit: hence commented :
        //private List&lt;PickerColumnDetails&gt; GetWPGridColumns()
        //{
        //    List&lt;PickerColumnDetails&gt; gridColumns = new List&lt;PickerColumnDetails&gt;();

        //    gridColumns.Add(new PickerColumnDetails { ColumnName = &quot;ID&quot;, Caption = &quot;ID&quot;, Hidden = true, Type = &quot;number&quot; });
        //    gridColumns.Add(new PickerColumnDetails { ColumnName = &quot;Name&quot;, Caption = &quot;Name&quot;, Hidden = false, Type = &quot;string&quot; });
        //    gridColumns.Add(new PickerColumnDetails { ColumnName = &quot;Description&quot;, Caption = &quot;Description&quot;, Hidden = false, Type = &quot;string&quot; });
        //    gridColumns.Add(new PickerColumnDetails { ColumnName = &quot;EstimatedCost&quot;, Caption = &quot;Estimated Cost&quot;, Hidden = false, Type = &quot;number&quot; });
        //    gridColumns.Add(new PickerColumnDetails { ColumnName = &quot;ProgramYear&quot;, Caption = &quot;Program Year&quot;, Hidden = false, Type = &quot;string&quot; });
        //    gridColumns.Add(new PickerColumnDetails { ColumnName = &quot;ProgramCategory&quot;, Caption = &quot;Program Category&quot;, Hidden = false, Type = &quot;string&quot; });
        //    return gridColumns;
        //}

        //Commented Asheesh2016:This is not there in screen: Unnecessary performance hit: hence commented :
        //private void InitializeTaskProjectPicker()
        //{
        //    Page page = HttpContext.Current.Handler as Page;
        //    Control ct = page.LoadControl(&quot;~/Modules/UserControls/PickerGrid.ascx&quot;);

        //    hdnPickerSelectedRows = new HiddenField();
        //    hdnPickerSelectedRows.ID = &quot;hdnPickerSelectedRows&quot;;
        //    hdnPickerSelectedRows.ClientIDMode = ClientIDMode.Static;

        //    page.Form.Controls.Add(hdnPickerSelectedRows);

        //    PickerGrid objGrid = (PickerGrid)ct;
        //    objGrid.InitializePicker(&quot;/api/WorkProjects/&quot;, GetGridColumns(), &quot;ID&quot;);
        //    objGrid.ID = &quot;addBudgetItems&quot;;
        //    objGrid.EnableMultiSelect = false;
        //    objGrid.ButtonText = &quot;Add&quot;;
        //    objGrid.PageSize = 20;
        //    objGrid.PostBackAfterSelect = true;
        //    objGrid.BeforePickerLoadScript = &quot;&quot;;

        //    objGrid.TriggerButton.Style.Add(HtmlTextWriterStyle.Display, &quot;none&quot;);

        //    objGrid.AfterPickerSelectScript = &quot;$(&#39;#hdnPickerSelectedRows&#39;).val(JSON.stringify({0}));&quot;;
        //    objGrid.OnItemSelected += new PickerGrid.SelectedItems(gwpPickerGrid_OnItemSelected);


        //    objGrid.OnGridLoad += new PickerGrid.GridLoad(objGrid_OnGridLoad);
        //    objGrid.Title = &quot;Select Projects&quot;;

        //    LoadPicker = &quot;$(&#39;#&quot; + objGrid.TriggerButton.ClientID + &quot;&#39;).click();return false;&quot;;
        //    page.Form.Controls.Add(objGrid);


        //}

        //Commented Asheesh2016:This is not there in screen: Unnecessary performance hit: hence commented :
        //private void InitializeTaskWPPicker()
        //{
        //    Page page = HttpContext.Current.Handler as Page;
        //    Control ct = page.LoadControl(&quot;~/Modules/UserControls/PickerGrid.ascx&quot;);

        //    hdnWPPickerSelectedRows = new HiddenField();
        //    hdnWPPickerSelectedRows.ID = &quot;hdnWPPickerSelectedRows&quot;;
        //    hdnWPPickerSelectedRows.ClientIDMode = ClientIDMode.Static;

        //    page.Form.Controls.Add(hdnWPPickerSelectedRows);

        //    PickerGrid WPobjGrid = (PickerGrid)ct;
        //    WPobjGrid.InitializePicker(&quot;/api/GetWPForProject/&quot;, GetWPGridColumns(), &quot;ID&quot;);
        //    WPobjGrid.ID = &quot;addWPItems&quot;;
        //    WPobjGrid.EnableMultiSelect = false;
        //    WPobjGrid.ButtonText = &quot;Add&quot;;
        //    WPobjGrid.PageSize = 20;
        //    WPobjGrid.PostBackAfterSelect = true;
        //    WPobjGrid.BeforePickerLoadScript = &quot;&quot;;

        //    WPobjGrid.TriggerButton.Style.Add(HtmlTextWriterStyle.Display, &quot;none&quot;);

        //    WPobjGrid.AfterPickerSelectScript = &quot;$(&#39;#hdnWPPickerSelectedRows&#39;).val(JSON.stringify({0}));&quot;;
        //    WPobjGrid.OnItemSelected += new PickerGrid.SelectedItems(WPobjGrid_OnItemSelected);

        //    WPobjGrid.OnGridLoad += new PickerGrid.GridLoad(WPobjGrid_OnGridLoad);

        //    WPobjGrid.Title = &quot;Select WPs&quot;;

        //    LoadWPPicker = &quot;$(&#39;#&quot; + WPobjGrid.TriggerButton.ClientID + &quot;&#39;).click();return false;&quot;;
        //    page.Form.Controls.Add(WPobjGrid);


        //}

        public override void OnInit(AMP3.Core.AbstractModels.ListModel model, XmlFormArgs e)
        {
            ((Page)HttpContext.Current.Handler).ClientScript.RegisterClientScriptInclude(&quot;ABCD&quot;, VirtualPathUtility.ToAbsolute(&quot;~/kendojs/kendo.all.min.js&quot;));
            ((Page)HttpContext.Current.Handler).ClientScript.RegisterStartupScript(GetType(), &quot;ABCD1&quot;, @&quot;&lt;link type=&quot;&quot;text/css&quot;&quot; rel=&quot;&quot;stylesheet&quot;&quot;  href=&quot;&quot;&quot; + VirtualPathUtility.ToAbsolute(&quot;~/kendostyles/kendo.common.min.css&quot;) + &quot;\&quot;&gt;&lt;/script&gt;&quot;);
            ((Page)HttpContext.Current.Handler).ClientScript.RegisterStartupScript(GetType(), &quot;ABCD2&quot;, @&quot;&lt;link type=&quot;&quot;text/css&quot;&quot; rel=&quot;&quot;stylesheet&quot;&quot; href=&quot;&quot;&quot; + VirtualPathUtility.ToAbsolute(&quot;~/kendostyles/kendo.blueopal.min.css&quot;) + &quot;\&quot;&gt;&lt;/script&gt;&quot;);
            base.OnInit(model, e);

            //Commented Asheesh2016:This is not there in screen: Unnecessary performance hit: hence commented :
            //InitializeTaskProjectPicker();//Associate Projects to WP
            //if (ProjectID &gt; 0)
            //    InitializeTaskWPPicker();//Add WPs to Project

            listModel = model;
            IntitalizeAssociationScript();
            //if (model.Request.QueryString[&quot;From&quot;] == &quot;Budget&quot;)
            //   .ReturnUrl(&quot;/Common/BrixItemListPage.aspx?Context=BDGTEST&amp;PID=&#39;&quot; + model.Request.QueryString[&quot;PID&quot;] + &quot;&#39;&amp;ParentID=&quot; + model.Request.QueryString[&quot;ParentID&quot;] + &quot;&amp;Mode=Edit&quot;, true);

        }
        public void IntitalizeAssociationScript()
        {
            Page page = HttpContext.Current.Handler as Page;
            hdnDeleteAssociation = new HiddenField();
            hdnDeleteAssociation.Value = &quot;0&quot;;
            hdnDeleteAssociation.ID = &quot;hdnDeleteAssociation&quot;;
            hdnDeleteAssociation.ClientIDMode = ClientIDMode.Static;
            page.ClientScript.RegisterStartupScript(GetType(), &quot;AlertDissascLinkedItems&quot;, &quot;function DeleteAssociationLinkedItems(hiddenValueClientID){ &quot; +
               &quot;if (confirm(&#39;There are linked items. Do you want to delete the linked items?&#39;))&quot; +
               &quot;{ $(&#39;#&#39; + hiddenValueClientID).val(&#39;1&#39;);}&quot; +
               &quot;else{$(&#39;#&#39; + hiddenValueClientID).val(&#39;0&#39;);}return false;}&quot;, true);

            page.ClientScript.RegisterStartupScript(GetType(), &quot;AlertDissasc&quot;, &quot;function DeleteAssociation(hiddenValueClientID){ &quot; +
               &quot;if (confirm(&#39;There are linked items. Are you sure you want to disassociate the selected work project?&#39;))&quot; +
               &quot;{ DeleteAssociationLinkedItems(hiddenValueClientID); return true; }&quot; +
               &quot;else{return false;}}&quot;, true);

            string linkedItemIds = GetLinkedWPItemIds(ProjectID);
            page.ClientScript.RegisterStartupScript(GetType(), &quot;CheckProjectIsLinked&quot;, &quot;function IsWPLinked(gridName, queryStringName, linkedItemIds){ &quot; +
            &quot; var grid = $find(gridName); &quot; +
            &quot; var linkedItemIds =&#39;&quot; + linkedItemIds + &quot;&#39;;&quot; +
            &quot; var selectedItems = grid.get_masterTableView().get_selectedItems(); &quot; +
            &quot; var selectedId = grid.get_masterTableView().getCellByColumnUniqueName(selectedItems[0], queryStringName).innerHTML; &quot; +
            &quot; var ids = linkedItemIds.split(\&quot;,\&quot;); &quot; +
            &quot; for (var i = 0; i &lt; ids.length; i++) { &quot; +
            &quot; if (ids[i] == selectedId) { return true; } }&quot; +
            &quot; return false; } &quot;, true);

            page.Form.Controls.Add(hdnDeleteAssociation);
        }

        public override void HandleMenuItem(string eventString, string selectedIds, ListModel model, XmlFormArgs e)
        {
            switch (eventString)
            {
                case &quot;Disassociate&quot;:
                    bool delLinkedItems = false;
                    bool delApprovedItem = false;
                    bool IsDeleteItems = hdnDeleteAssociation.Value.ToString() == &quot;1&quot; ? true : false;
                    foreach (string selectedID in selectedIds.Split(&#39;,&#39;))
                    {
                        int disAsocWPResult = WPDisassociate(model, selectedID, IsDeleteItems);
                        if (disAsocWPResult == -1)
                            delLinkedItems = true;

                        else if (disAsocWPResult == 2)
                            delApprovedItem = true;
                    }
                    if (delLinkedItems)
                        throw new Exception(&quot;Failed to remove linked items for the Work Project.&quot;);
                    if (delApprovedItem)
                        throw new Exception(&quot;Some linked items could not be removed.&quot;);

                    break;

                case &quot;Delete&quot;:
                    if (string.IsNullOrEmpty(selectedIds))
                    {
                        throw new Exception(&quot;Please select a record.&quot;);
                    }
                    DeleteWorkProject(model, selectedIds);
                    model.Response.Redirect(model.Request.RawUrl);
                    break;


                default:
                    base.HandleMenuItem(eventString, selectedIds, model, e);
                    break;
            }
        }


        //Commented Asheesh2016:This is not there in screen: Unnecessary performance hit: hence commented :
        //bool ValidationForSameProgramCategory(string PID, string WPID)
        //{
        //    Dictionary&lt;string, object&gt; dic = new Dictionary&lt;string, object&gt;();
        //    DataSet ds = ComponentHelper.Instance.ExecuteDataSet(PlanningClassStoredProcedure.usp_ValidateAssociateWorkProjects, dic, PID, WPID);

        //    if (dic[&quot;OUTPUT&quot;] != null &amp;&amp; dic[&quot;OUTPUT&quot;].ToString() != &quot;0&quot;)
        //    {
        //        Page page = HttpContext.Current.Handler as Page;
        //        JavaScriptSerializer JS = new JavaScriptSerializer();
        //        string errMessage = JS.Serialize(dic[&quot;OUTPUT&quot;]);
        //        page.ClientScript.RegisterStartupScript(GetType(), &quot;ShowAlert&quot;, &quot;ShowError(&quot; + errMessage + &quot;);&quot;, true);
        //        return false;
        //    }
        //    return true;
        //}

        int WPDisassociate(ListModel model, string selectedIds, bool DeleteItems)
        {
            if (!string.IsNullOrEmpty(selectedIds))
                return ComponentHelper.Instance.ExecuteScalar(PlanningManagementStoredProcedure.usp_PLANINGDissociateWP, null, ProjectID, selectedIds, DeleteItems).ToInt32_2();
            return 0;
        }
        int DeleteWorkProject(ListModel model, string selectedIds)
        {
            if (!string.IsNullOrEmpty(selectedIds))
                return ComponentHelper.Instance.ExecuteScalar(PlanningManagementStoredProcedure.usp_PLANINGDeleteWP, null, selectedIds).ToInt32_2();
            return 0;
        }

        string GetLinkedWPItemIds(int pID)
        {
            string ids = string.Empty;
            DataSet ds = ComponentHelper.Instance.ExecuteDataSet(PlanningManagementStoredProcedure.usp_PLANINGGetLinkedWPItemIds, null, pID);
            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0)
            {
                foreach (DataRow row in ds.Tables[0].Rows)
                {
                    ids += row[0] + &quot;,&quot;;
                }
            }
            return ids;
        }

        //Commented Asheesh2016:This is not there in screen: Unnecessary performance hit: hence commented :
        //void gwpPickerGrid_OnItemSelected(PickerGrid grid, List&lt;Dictionary&lt;string, object&gt;&gt; selectedRows)
        //{
        //    string instanceIds = string.Empty;

        //    try
        //    {
        //        foreach (Dictionary&lt;string, object&gt; entry in selectedRows)
        //        {
        //            string PID = entry[&quot;ProjectId&quot;].ToString2();
        //            instanceIds = listModel.GetSelectedIds();//WPID
        //            if (!string.IsNullOrEmpty(instanceIds))
        //            {
        //                if (ProjectID == 0)
        //                {
        //                    if (ValidationForSameProgramCategory(PID, instanceIds))
        //                        ComponentHelper.Instance.ExecuteDataSet(PlanningClassStoredProcedure.usp_PLANINGAssociateWP, null, PID, instanceIds);
        //                }
        //                else
        //                    ComponentHelper.Instance.ExecuteDataSet(PlanningClassStoredProcedure.usp_PLANINGAssociateWP, null, PID, instanceIds);
        //            }
        //        }
        //    }
        //    catch (System.Exception ex)
        //    {
        //        Page page = HttpContext.Current.Handler as Page;
        //        JavaScriptSerializer JS = new JavaScriptSerializer();
        //        string errMessage = JS.Serialize(ex.Message.Replace(&quot;|&quot;, &quot;&lt;br/&gt;&quot;));
        //        page.ClientScript.RegisterStartupScript(GetType(), &quot;ShowAlert&quot;, &quot;ShowError(&quot; + errMessage + &quot;);&quot;, true);
        //    }
        //}

        //Commented Asheesh2016:This is not there in screen: Unnecessary performance hit: hence commented :
        //void WPobjGrid_OnItemSelected(PickerGrid grid, List&lt;Dictionary&lt;string, object&gt;&gt; selectedRows)
        //{
        //    try
        //    {
        //        foreach (Dictionary&lt;string, object&gt; entry in selectedRows)
        //        {
        //            string WPID = entry[&quot;ID&quot;].ToString2();
        //            if (!string.IsNullOrEmpty(WPID))
        //                ComponentHelper.Instance.ExecuteDataSet(PlanningClassStoredProcedure.usp_PLANINGAddWPsToProjects, null, ProjectID, WPID.ToInt32_2());
        //        }
        //    }
        //    catch (System.Exception ex)
        //    {
        //        Page page = HttpContext.Current.Handler as Page;
        //        JavaScriptSerializer JS = new JavaScriptSerializer();
        //        string errMessage = JS.Serialize(ex.Message.Replace(&quot;|&quot;, &quot;&lt;br/&gt;&quot;));
        //        page.ClientScript.RegisterStartupScript(GetType(), &quot;ShowAlert&quot;, &quot;ShowError(&quot; + errMessage + &quot;);&quot;, true);
        //    }
        //}
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[35,47,35,48,1],[35,49,35,138,1],[35,139,35,140,1],[39,39,39,43,0],[39,44,39,48,0],[49,13,49,14,1],[50,17,50,162,1],[51,17,51,46,1],[52,13,52,14,1],[57,9,57,10,1],[58,13,58,114,1],[59,13,59,90,1],[60,13,60,104,1],[61,13,61,88,1],[62,13,62,105,1],[63,13,63,110,1],[64,13,64,115,1],[65,9,65,10,1],[68,9,68,10,1],[69,13,69,32,1],[70,13,70,14,1],[71,17,71,55,1],[72,17,72,58,1],[72,58,72,84,1],[72,84,72,86,1],[72,17,72,86,1],[73,17,73,37,1],[74,17,74,18,1],[75,21,75,48,1],[76,17,76,18,1],[77,13,77,14,1],[78,9,78,10,1],[81,9,81,10,1],[97,13,97,87,1],[98,17,98,77,0],[100,13,100,86,1],[101,17,104,159,0],[106,13,106,81,1],[107,17,107,71,0],[108,13,108,31,1],[109,13,109,14,0],[110,17,110,64,0],[111,21,111,72,0],[112,13,112,14,0],[114,13,114,14,1],[118,13,118,14,1],[119,9,119,10,1],[261,9,261,10,1],[262,13,262,159,1],[263,13,263,247,1],[264,13,264,248,1],[265,13,265,35,1],[272,13,272,31,1],[273,13,273,43,1],[277,9,277,10,1],[279,9,279,10,1],[280,13,280,61,1],[281,13,281,54,1],[282,13,282,46,1],[283,13,283,62,1],[284,13,284,69,1],[285,13,288,84,1],[290,13,293,46,1],[295,13,295,66,1],[296,13,304,40,1],[306,13,306,58,1],[307,9,307,10,1],[310,9,310,10,1],[311,13,311,33,1],[314,21,314,49,0],[315,21,315,50,0],[316,21,316,102,0],[317,21,317,28,0],[317,30,317,47,0],[317,48,317,50,0],[317,51,317,73,0],[318,21,318,22,0],[319,25,319,96,0],[320,25,320,51,0],[321,29,321,51,0],[323,30,323,55,0],[324,29,324,52,0],[325,21,325,22,0],[326,21,326,40,0],[327,25,327,100,0],[328,21,328,41,0],[329,25,329,88,0],[331,21,331,27,0],[334,21,334,59,1],[335,21,335,22,0],[336,25,336,72,0],[338,21,338,59,1],[339,21,339,67,1],[340,21,340,27,0],[344,21,344,77,1],[345,21,345,27,1],[347,9,347,10,1],[368,9,368,10,0],[369,13,369,52,0],[370,17,370,177,0],[371,13,371,22,0],[372,9,372,10,0],[374,9,374,10,1],[375,13,375,52,1],[376,17,376,149,1],[377,13,377,22,0],[378,9,378,10,1],[381,9,381,10,1],[382,13,382,39,1],[383,13,383,142,1],[384,13,384,51,1],[385,13,385,14,1],[386,17,386,24,1],[386,26,386,37,0],[386,38,386,40,1],[386,41,386,58,1],[387,17,387,18,0],[388,21,388,41,0],[389,17,389,18,0],[390,13,390,14,1],[391,13,391,24,1],[392,9,392,10,1]]);
    </script>
  </body>
</html>