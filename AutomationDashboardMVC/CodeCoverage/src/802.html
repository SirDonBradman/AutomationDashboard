<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Business Layer\UserControls\RateAnalysisControl.ascx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Globalization;
using System.Linq;
using System.Reflection;
using System.Text;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core.AbstractModels;
using Aurigo.AMP3.Core.BusinessLayer.BL;
using Aurigo.AMP3.Core.BusinessLayer.DTO;
using Aurigo.AMP3.Core.IntegrationConnector;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.AMP3.LibraryBL;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.Brix.Core.WebUiHelper;
using Aurigo.Brix.Platform.BusinessLayer.DataAccessHelper;
using Aurigo.Brix.Platform.BusinessLayer.UserControls;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Infragistics.WebUI.UltraWebGrid;
using Infragistics.WebUI.WebDataInput;
using Newtonsoft.Json;
using Newtonsoft.Json.Linq;
using GridBoundColumn = Telerik.Web.UI.GridBoundColumn;
using GridColumn = Telerik.Web.UI.GridColumn;
using GridNumericColumn = Telerik.Web.UI.GridNumericColumn;

namespace Aurigo.AMP3.Core.UserControls
{
    public partial class RateAnalysisControl : UserControl, ICallbackEventHandler
    {
        // private bool isDisable = false;
        private static DataTable dtTempunit = new BrixDataTable();

        private readonly LibraryInterface blInstance = LibraryInterface.Instance;
        private readonly string equipment = LocalizationManager.GetString(KeyConstants.LOC_ICA_EQUIPMENT);
        private readonly string manpower = LocalizationManager.GetString(KeyConstants.LOC_ICA_MANPOWER);
        private readonly string misc = LocalizationManager.GetString(KeyConstants.LOC_ICA_MISC);
        private string CallBackResult;
        protected ToolBar MainToolBar;
        protected WebNumericEdit RateAnalysisCost;
        protected WebNumericEdit RateAnalysisQuantity;
        protected WebNumericEdit RateAnalysisRate;
        private GenericPickerControl dimensionsPicker;
        private bool isERPFetchResourceSupported;
        private ItemDetailModel parentItemModel;
        private string parentResItemId;
        private GenericPickerControl tradeAgreementPicker;
        protected WebNumericEdit wneWastagePercent;
        private ValueList valListUnit = new ValueList();
        private ValueList valListAXConfig = new ValueList();
        private ValueList valListAXSize = new ValueList();
        private ValueList valListAXColor = new ValueList();
        protected global::Infragistics.WebUI.UltraWebGrid.UltraWebGrid uwgOverheads;
        protected global::Infragistics.WebUI.WebCombo.WebCombo igcmboUnit;
        protected global::Infragistics.WebUI.WebCombo.WebCombo igcmboAXConfig;
        protected global::Infragistics.WebUI.WebCombo.WebCombo igcmboAXSize;
        protected global::Infragistics.WebUI.WebCombo.WebCombo igcmboAXColor;
        protected global::System.Web.UI.WebControls.HiddenField hdnDeleteExistingResources;

        public decimal TotalResourceAmount
        {
            get { return hdnResourceTotal == null || String.IsNullOrEmpty(hdnResourceTotal.Value) ? 0 : hdnResourceTotal.Value.ToDecimal2(); }
        }

        public PickerGrid ResourcePicker;

        public ItemDetailModel ParentItemModel
        {
            get { return parentItemModel; }
            set { parentItemModel = value; }
        }

        private bool IsERPConnected
        {
            get { return IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX); }
        }

        public string ModuleID
        {
            set { hdnModuleID.Value = value; }
            get { return hdnModuleID.Value; }
        }

        public bool isOverheadsShown
        {
            set { hdnShowOverheadsGrid.Value = value.ToString2(); }
            get { return Boolean.Parse(hdnShowOverheadsGrid.Value); }
        }

        public int ParentInstanceID
        {
            set { hdnParentInstanceID.Value = value.ToString2(); }
            get
            {
                return (!string.IsNullOrEmpty(hdnParentInstanceID.Value))
                    ? Convert.ToInt32(hdnParentInstanceID.Value, CultureInfo.CurrentCulture)
                    : 0;
            }
        }

        public bool ReadOnly
        {
            get
            {
                return (string.IsNullOrEmpty(hdnReadOnly.Value)
                    ? false
                    : Convert.ToBoolean(hdnReadOnly.Value, CultureInfo.CurrentCulture));
            }
            set
            {
                hdnReadOnly.Value = value.ToString2();
                MakeReadOnly(value);
            }
        }

        public int MeasSysID
        {
            set { hdnMeasSysID.Value = value.ToString2(); }
            get { return Convert.ToInt32(hdnMeasSysID.Value, CultureInfo.CurrentCulture); }
        }

        public int ItemID
        {
            get
            {
                return (!string.IsNullOrEmpty(ItemID4RateAnalysis.Text))
                    ? Convert.ToInt32(ItemID4RateAnalysis.Text, CultureInfo.CurrentCulture)
                    : 0;
            }
        }

        public int SetItemID4RateAnalysis
        {
            set { ItemID4RateAnalysis.Text = value.ToString2(); }
        }

        public int SubItemID
        {
            get
            {
                return (!string.IsNullOrEmpty(SubItemID4RA.Text))
                    ? Convert.ToInt32(SubItemID4RA.Text, CultureInfo.CurrentCulture)
                    : 0;
            }
            set { SubItemID4RA.Text = value.ToString2(); }
        }

        public string RAPageTitle
        {
            set { hdnPageTitle.Value = value; }
            get { return hdnPageTitle.Value; }
        }

        #region ICallbackEventHandler Members

        public string GetCallbackResult()
        {
            // RETURN THE LIST OF MATERIAL ISSUE NO AND THIER ASSOCIATED ISSUED QUANTIY AND BALANCE QUANTITY.
            return CallBackResult;
        }

        public void RaiseCallbackEvent(string eventArgument)
        {
            String[] parameters = eventArgument.Split(&quot;;&quot;.ToCharArray());
            string resItemID = parameters[0];
            int itemID = Convert.ToInt32(parameters[1], CultureInfo.CurrentCulture);

            try
            {
                if (!string.IsNullOrEmpty(Request[&quot;ContractID&quot;]))
                {
                    CallBackResult = string.Empty;
                    DataTable dtBrixMI = IntegrationConnectorManager.Instance.GetAXApprovedMaterialIssues(itemID,
                        SubItemID,
                        resItemID);
                    DataTable dtAXMI =
                        GetApprovedMaterialIssues(Convert.ToInt32(Request[&quot;ContractID&quot;], CultureInfo.CurrentCulture),
                            resItemID);

                    if (dtBrixMI != null &amp;&amp; dtAXMI != null)
                    {
                        bool isApprovedMat = false;
                        for (int i = 0; i &lt; dtBrixMI.Rows.Count; i++)
                        {
                            DataRow[] drSelect =
                                dtAXMI.Select(&quot;MaterialIssueId = &#39;&quot; + dtBrixMI.Rows[i][&quot;MaterialIssueId&quot;].ToString2() +
                                              &quot;&#39;&quot;);
                            if (drSelect.Length != 0)
                            {
                                // USE DTBRIXMI TO  GET THE CORRESPONDING QUANTITIES AND THEN SERALISE THEM AND SEND BACK TO CLIENT.
                                string matIssueID = dtBrixMI.Rows[i][&quot;MaterialIssueId&quot;].ToString2();
                                string issuedQuantity =
                                    GetIssuedQuantity(resItemID, matIssueID).Rows[0][&quot;IssuedQty&quot;].ToString2();
                                string balQuantity =
                                    (Convert.ToDecimal(issuedQuantity, CultureInfo.CurrentCulture) -
                                     (ItemManager.Instance.GetBalancedQty(
                                         Convert.ToInt32(Request[&quot;ContractID&quot;], CultureInfo.CurrentCulture), resItemID,
                                         matIssueID))).ToString(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY,
                                             CultureInfo.CurrentCulture);
                                CallBackResult += matIssueID + &quot;;&quot;;
                                CallBackResult += issuedQuantity + &quot;;&quot;;
                                CallBackResult += balQuantity + &quot;|&quot;;
                                isApprovedMat = true;
                            }
                        }
                        if (isApprovedMat)
                            CallBackResult = CallBackResult.Trim(&quot;|&quot;.ToCharArray());
                        else
                            CallBackResult = &quot;NoIssual&quot;;
                    }
                    else
                        CallBackResult = &quot;NoIssual&quot;;
                }
            }
            catch (Exception ex)
            {
                CallBackResult = &quot;Error: &quot; + ex.Message;
            }

            //CallBackResult = &quot;MIN-001;15;10|MIN-002;20;5|MIN-003;50;35&quot;;
        }

        #endregion ICallbackEventHandler Members

        public event EventHandler BackClicked;

        private bool IsERPMaterialIssueSupported()
        {
            //Removed code from here so as to remove the MI association with Item Postings
            return false;
        }

        public bool IsStdItemSelected { get; set; }

        protected void Page_Load(object sender, EventArgs e)
        {
            string fileName = &quot;~/Scripts/XmlframeworkJScript.js&quot;;
            Page.ClientScript.RegisterClientScriptInclude(&quot;XmlframeworkJScript&quot;, ResolveClientUrl(fileName) + &quot;?v=&quot; + UIScriptHelper.GetFileCacheDateTimeParam(fileName));

            SetResourceCountDetails();
            InitializeResourcePicker();

            hdnAmountDigits.Value = CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT).ToString2();
            hdnCulture.Value = AMP3ApplicationSettings.Instance.Culture.ToString2();
            hdnQuantityDigits.Value = CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY).ToString2();
            hdnUnitPriceDigits.Value = CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE).ToString2();

            if (hdnMode.Value.Equals(&quot;1&quot;))
            {
                ddlRateAnalysisResource.Enabled = false;
                if (hdnResourceType.Value != &quot;&quot;)
                    ddlRateAnalysisResource.SelectedIndex =
                        Convert.ToInt32(hdnResourceType.Value, CultureInfo.CurrentCulture) - 1;
            }
            else if (hdnMode.Value.Equals(&quot;0&quot;))
            {
                ddlRateAnalysisResource.Enabled = true;
                hdnResourceType.Value = Convert.ToString(ddlRateAnalysisResource.SelectedIndex,
                    CultureInfo.CurrentCulture);
                ddlRateAnalysisResource.Attributes[&quot;onchange&quot;] = &quot;ShowHideResourcePicker(&#39;&quot; + hdnResourceType.Value +
                                                                 &quot;&#39;);&quot;;
            }
            tradeAgreementPicker.EnableMultipleSelect = false;
            dimensionsPicker.EnableMultipleSelect = false;

            RegisterCallBackScript();

            hdnCriticalCheck.Value = AMP3ApplicationSettings.Instance.appSettings[&quot;CheckResouceCritical&quot;];

            RateAnalysisRate.ClientSideEvents.KeyDown = &quot;wne_EditKeyDownHandler&quot;;
            RateAnalysisQuantity.ClientSideEvents.KeyDown = &quot;wne_EditKeyDownHandler&quot;;
            hdnSubContID.Value = ItemManager.Instance.GetResourceTypeID(&quot;SubContract&quot;).ToString();

            // Get currency as per localisation
            try
            {
                lblCost.Text = string.Format(&quot;Cost in {0}:&quot;,
                    LocalizationManager.GetModuleCurrency(
                        Request[&quot;Context&quot;] ?? Request[&quot;ParentContext&quot;],
                        Request[&quot;ParentId&quot;] ?? Request[&quot;ContractID&quot;],
                        Session[&quot;AXCompany&quot;].ToString()));
            }
            catch (Exception)
            {
                lblCost.Text = &quot;Cost :&quot;;
            }

            lblEquipmentCount.Text = string.IsNullOrEmpty(hdnEquipmentCount.Value) ? GetResourceCount(&quot;Equipment&quot;) : hdnEquipmentCount.Value;
            lblManPowerCount.Text = string.IsNullOrEmpty(hdnManPowerCount.Value) ? GetResourceCount(&quot;Personnel&quot;) : hdnManPowerCount.Value;
            lblMaterialCount.Text = string.IsNullOrEmpty(hdnMaterialCount.Value) ? GetResourceCount(&quot;Material&quot;) : hdnMaterialCount.Value;
            lblSubContractCount.Text = string.IsNullOrEmpty(hdnSubContractCount.Value) ? GetResourceCount(&quot;SubContract&quot;) : hdnSubContractCount.Value;

            if (IsPostBack)
            {
                btnResourcePicker.Enabled = true;
            }

            hdnManualRecordCount.Value = GetManualRecordCount();
        }

        private void SetResourceCountDetails()
        {
            SetResourceCountDetails(equipment, lblEquipment, lblEquipmentCount);
            SetResourceCountDetails(manpower, lblManPower, lblManPowerCount);
            SetResourceCountDetails(&quot;Material&quot;, lblMaterial, lblMaterialCount);            
            SetResourceCountDetails(&quot;SubContract&quot;, lblSubContract, lblSubContractCount);
            SetResourceCountDetails(misc, lblMisc, lblMiscCount);
            SetResourceCountDetails(&quot;Overhead&quot;, lblOverhead, lblOverheadCount);
        }

        private void SetResourceCountDetails(string resourceType, Label lblResource, Label lblResourceCount)
        {
            lblResource.Text = resourceType + &quot; : &quot;;
            lblResourceCount.Text = GetResourceCount(resourceType);
        }

        private string GetResourceCount(string resourceType)
        {
            int resourceCount = 0;
            if (resourceType.Equals(&quot;Overhead&quot;))
            {
                resourceCount = (from res in uwgOverheads.Rows.Cast&lt;UltraGridRow&gt;()
                                 where res.Cells.FromKey(&quot;ResourceTypeName&quot;).Value.Equals(resourceType)
                                 select res).Count();
            }
            else
            {
                DataView dataView = gridRateAnalysis.DataSource as DataView;
                if (dataView != null)
                {
                    DataTable dt = dataView.ToTable();
                    if (dt?.Rows?.Count &gt; 0)
                    {
                        string filterExpression = string.Format(&quot;ResourceTypeName = &#39;{0}&#39;&quot;, resourceType);
                        DataRow[] rows = dt.Select(filterExpression);
                        resourceCount = rows.Length;
                    }
                }
            }
            return resourceCount.ToString2();
        }

        private string GetManualRecordCount()
        {
            int manualRecordCount = 0;
            DataView dataView = gridRateAnalysis.DataSource as DataView;
            if (dataView != null)
            {
                DataTable dt = dataView.ToTable();
                if (dt?.Rows?.Count &gt; 0)
                {
                    string filterExpression = string.Format(&quot;ResItemID like &#39;%{0}%&#39;&quot;, &quot;MANUAL&quot;);
                    DataRow[] rows = dt.Select(filterExpression);
                    manualRecordCount = rows.Length;
                }
            }

            return manualRecordCount.ToString2();
        }

        protected virtual void OnBackClicked(EventArgs e)
        {
            if (BackClicked != null)
                BackClicked(this, e);
        }

        protected override void OnInit(EventArgs e)
        {
            CreateToolBarMenu();
            parentResItemId = IsERPConnected ? &quot;ParentResItemID&quot; : &quot;ResItemID&quot;;

            # region Trade Agreement Picker

            tradeAgreementPicker = (ucTradeAgreementPicker as GenericPickerControl);
            tradeAgreementPicker.IsFilterXml = true;
            tradeAgreementPicker.DisplayFilter = true;
            tradeAgreementPicker.BackClicked += resourcePicker_BackClicked;
            tradeAgreementPicker.ItemSelected += tradeAgreementPicker_SelectedIndexChanged;
            tradeAgreementPicker.BindData += tradeAgreement_BindData;
            tradeAgreementPicker.DataSourceCommandType = DataSourceType.StoredProcedure;
            tradeAgreementPicker.DefaultSortColumn = &quot;ItemId&quot;;
            tradeAgreementPicker.Filters = GetTradeAgreementFilters();
            tradeAgreementPicker.ModifyColumnProperties(&quot;AccountCode&quot;, true, null, null, null, false);
            tradeAgreementPicker.ModifyColumnProperties(&quot;AccountRelation&quot;, false, null, null, null, false,
                &quot;Vendor Account&quot;);
            tradeAgreementPicker.ModifyColumnProperties(&quot;Name&quot;, false, 2, null, null, false, &quot;Vendor Name&quot;);
            tradeAgreementPicker.ModifyColumnProperties(&quot;Size&quot;, false, 3, null, null, false);
            tradeAgreementPicker.ModifyColumnProperties(&quot;Color&quot;, false, 4, null, null, false);
            tradeAgreementPicker.ModifyColumnProperties(&quot;Configuration&quot;, false, 5, null, null, false);
            tradeAgreementPicker.ModifyColumnProperties(&quot;Amount&quot;, false, null, null, null, false, &quot;Price&quot;);
            tradeAgreementPicker.StateMgmtContext = &quot;TradePicker&quot;;

            #endregion

            # region Inventory Dimensions Picker

            dimensionsPicker = (ucDimensionsPicker as GenericPickerControl);
            dimensionsPicker.IsFilterXml = true;
            dimensionsPicker.DisplayFilter = true;
            dimensionsPicker.BackClicked += resourcePicker_BackClicked;
            dimensionsPicker.ItemSelected += inventoryDimensionsPicker_SelectedIndexChanged;
            dimensionsPicker.BindData += inventoryDimensions_BindData;
            dimensionsPicker.DataSourceCommandType = DataSourceType.StoredProcedure;
            dimensionsPicker.DefaultSortColumn = &quot;ResItemID&quot;;
            dimensionsPicker.Filters = GetDimensionsFilters();
            dimensionsPicker.ModifyColumnProperties(&quot;InventDimId&quot;, true, null, null, null, false);
            dimensionsPicker.ModifyColumnProperties(&quot;ItemId&quot;, true, null, null, null, false);
            dimensionsPicker.ModifyColumnProperties(&quot;InventSizeId&quot;, false, null, null, null, false, &quot;Size&quot;);
            dimensionsPicker.ModifyColumnProperties(&quot;InventColorId&quot;, false, null, null, null, false, &quot;Color&quot;);
            dimensionsPicker.ModifyColumnProperties(&quot;ConfigId&quot;, false, null, null, null, false, &quot;Configuration&quot;);
            dimensionsPicker.StateMgmtContext = &quot;DimPicker&quot;;

            #endregion

            btnResourcePicker.Click += btnResourcePicker_Click;
            btnTradeAgreement.Click += btnTradeAgreement_Click;
            //btnInventoryDimensions.Click += new EventHandler(btnInventoryDimensions_Click);
            btnDeleteRateAnalysis.Click += btnDeleteRateAnalysis_Click;
            //btnSaveRateAnalysis.Click += new EventHandler(btnDoneRateAnalysis_Click);
            // ddlRateAnalysisResource.Attributes[&quot;onchange&quot;] = &quot;ShowHideResourcePicker(&#39;&quot; + &quot;&#39;);&quot;;

            #region Checking the Inventory Capabilities of the Current ERP - Set value of isERPFetchResourceSupported

            /* MethodName and ClassName are hardcoded to coincide with the AX listmodel design */
            isERPFetchResourceSupported = ErpFetchTriggerPointSupported();

            #endregion

            hdnDecimalPlaces.Value =
                CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT).ToString2();
            base.OnInit(e);
        }

        private BrixFilter[] GetFilters()
        {
            var filters = new BrixFilter[2];

            filters[0] = new BrixFilter();
            filters[0].Title = &quot;Resource ID :&quot;;
            filters[0].Name = parentResItemId;
            filters[0].FilterType = BrixFilter.Type.Text;

            filters[1] = new BrixFilter();
            filters[1].Title = &quot;Description :&quot;;
            filters[1].Name = &quot;Description&quot;;
            filters[1].FilterType = BrixFilter.Type.Text;

            //filters[2] = new BrixFilter();
            //filters[2].Title = &quot;Resource Group :&quot;;
            //filters[2].Name = &quot;ResourceGroupId&quot;;
            //filters[2].FilterType = BrixFilter.Type.Text;

            return filters;
        }

        private BrixFilter[] GetDimensionsFilters()
        {
            var filters = new BrixFilter[3];

            filters[0] = new BrixFilter();
            filters[0].Title = &quot;Size :&quot;;
            filters[0].Name = &quot;InventSizeId&quot;;
            filters[0].FilterType = BrixFilter.Type.Text;

            filters[1] = new BrixFilter();
            filters[1].Title = &quot;Color :&quot;;
            filters[1].Name = &quot;InventColorId&quot;;
            filters[1].FilterType = BrixFilter.Type.Text;

            filters[2] = new BrixFilter();
            filters[2].Title = &quot;Configuration :&quot;;
            filters[2].Name = &quot;ConfigId&quot;;
            filters[2].FilterType = BrixFilter.Type.Text;

            return filters;
        }

        private BrixFilter[] GetTradeAgreementFilters()
        {
            var filters = new BrixFilter[5];

            filters[0] = new BrixFilter();
            filters[0].Title = &quot;Size :&quot;;
            filters[0].Name = &quot;Table2_InventSizeId&quot;;
            filters[0].FilterType = BrixFilter.Type.Text;

            filters[1] = new BrixFilter();
            filters[1].Title = &quot;Color :&quot;;
            filters[1].Name = &quot;Table2_InventColorId&quot;;
            filters[1].FilterType = BrixFilter.Type.Text;

            filters[2] = new BrixFilter();
            filters[2].Title = &quot;Configuration :&quot;;
            filters[2].Name = &quot;Table2_ConfigId&quot;;
            filters[2].FilterType = BrixFilter.Type.Text;

            filters[3] = new BrixFilter();
            filters[3].Title = &quot;From Date :&quot;;
            filters[3].Name = &quot;FromDate&quot;;
            filters[3].FilterType = BrixFilter.Type.Date;

            filters[4] = new BrixFilter();
            filters[4].Title = &quot;To Date :&quot;;
            filters[4].Name = &quot;ToDate&quot;;
            filters[4].FilterType = BrixFilter.Type.Date;

            return filters;
        }

        private void InitializeResourcePicker()
        {
            Page page = HttpContext.Current.Handler as Page;
            //string LoadPicker;
            ResourcePicker = page.LoadControl(&quot;~/Modules/UserControls/PickerGrid.ascx&quot;) as PickerGrid;

            List&lt;PickerColumnDetails&gt; columns = GetColumnForPicker();
            string parameters = PopulateParametersForPicker();
            ResourcePicker.Title = &quot;Resource Picker&quot;;
            ResourcePicker.ID = &quot;RateAnalysisResourcePicker&quot;;
            ResourcePicker.EnableMultiSelect = true;
            ResourcePicker.PostBackAfterSelect = false;
            ResourcePicker.PageSize = 20;
            ResourcePicker.BeforePickerLoadScript = string.Empty;
            ResourcePicker.AfterPickerSelectScript = &quot;ConsumeSelectedResource({0},&#39;&quot; + gridRateAnalysis.ClientID + &quot;&#39;)&quot;;
            ResourcePicker.TriggerButton.Style.Add(HtmlTextWriterStyle.Display, &quot;none&quot;);
            //LoadPicker = &quot;$(document).ready(function() { $(&#39;#&quot; + ResourcePicker.TriggerButton.ClientID + &quot;&#39;).click();return false;});&quot;;
            ResourcePicker.InitializePicker(&quot;/api/GenericXMLPicker/&quot;, columns, &quot;ID&quot;);
            ResourcePicker.OptionalParamaters = ResourcePicker.BuildOptionalParameters(parameters);
            ResourcePickerPlaceHolder.Controls.Clear();
            ResourcePickerPlaceHolder.Controls.Add(ResourcePicker);
        }

        protected virtual List&lt;PickerColumnDetails&gt; GetColumnForPicker()
        {
            List&lt;PickerColumnDetails&gt; columns = null;
            columns = new List&lt;PickerColumnDetails&gt;
            {
                                                new PickerColumnDetails { ColumnName = &quot;ID&quot;, Caption = &quot;Item Id&quot;, Hidden = true, Type = &quot;number&quot; },
                                                new PickerColumnDetails { ColumnName = &quot;ResItemID&quot;, Caption = &quot;Resource ID&quot;, Hidden = false, Type = &quot;string&quot; },
                                                new PickerColumnDetails { ColumnName = &quot;Description&quot;, Caption = &quot;Title&quot;, Hidden = false, Type = &quot;string&quot; },
                                                new PickerColumnDetails { ColumnName = &quot;ResourceTypeName&quot;, Caption = &quot;Resource Category&quot;, Hidden = false, Type = &quot;string&quot; },
                                                new PickerColumnDetails { ColumnName = &quot;ResourceType&quot;, Caption = &quot;Resource Type&quot;, Hidden = false, Type = &quot;string&quot; },
                                                new PickerColumnDetails { ColumnName = &quot;Unit&quot;, Caption = &quot;Unit&quot;, Hidden = false, Type = &quot;string&quot; },
                                                new PickerColumnDetails { ColumnName = &quot;Rate&quot;, Caption = &quot;Fixed Price in $&quot;, Hidden = false, Type = &quot;string&quot; },
                                                new PickerColumnDetails { ColumnName = &quot;VariablePrice&quot;, Caption = &quot;Variable Price in $/Unit&quot;, Hidden = false, Type = &quot;string&quot; },
                                                new PickerColumnDetails { ColumnName = &quot;SystemId&quot;, Caption = &quot;System ID&quot;, Hidden = true, Type = &quot;int&quot; },
                                                //new PickerColumnDetails { ColumnName = &quot;RowNum&quot;, Caption = &quot;RowNum&quot;, Hidden = true, Type = &quot;int&quot; },
                                                };

            if (hiddenResourceSelectedText.Value != &quot;&quot;)
            {
                if (hiddenResourceSelectedText.Value.Contains(&quot;Personnel&quot;))
                {
                    columns = new List&lt;PickerColumnDetails&gt; {
                                                new PickerColumnDetails { ColumnName = &quot;ID&quot;, Caption = &quot;Item Id&quot;, Hidden = true, Type = &quot;number&quot; },
                                                new PickerColumnDetails { ColumnName = &quot;ResItemID&quot;, Caption = &quot;Resource ID&quot;, Hidden = false, Type = &quot;string&quot; },
                                                new PickerColumnDetails { ColumnName = &quot;Description&quot;, Caption = &quot;Title&quot;, Hidden = false, Type = &quot;string&quot; },
                                                new PickerColumnDetails { ColumnName = &quot;ResourceTypeName&quot;, Caption = &quot;Resource Category&quot;, Hidden = false, Type = &quot;string&quot; },
                                                new PickerColumnDetails { ColumnName = &quot;ResourceType&quot;, Caption = &quot;Resource Type&quot;, Hidden = false, Type = &quot;string&quot; },
                                                new PickerColumnDetails { ColumnName = &quot;Unit&quot;, Caption = &quot;Unit&quot;, Hidden = false, Type = &quot;string&quot; },
                                                new PickerColumnDetails { ColumnName = &quot;Rate&quot;, Caption = &quot;Fixed Price in $&quot;, Hidden = false, Type = &quot;string&quot; },
                                                new PickerColumnDetails { ColumnName = &quot;VariablePrice&quot;, Caption = &quot;Variable Price in $/Unit&quot;, Hidden = false, Type = &quot;string&quot; },
                                                //new PickerColumnDetails { ColumnName = &quot;RowNum&quot;, Caption = &quot;RowNum&quot;, Hidden = true, Type = &quot;int&quot; },
                                                new PickerColumnDetails { ColumnName = &quot;Size&quot;, Caption = &quot;Size&quot;, Hidden = false, Type = &quot;string&quot; },
                                                new PickerColumnDetails { ColumnName = &quot;Color&quot;, Caption = &quot;Color&quot;, Hidden = false, Type = &quot;string&quot; },
                                                new PickerColumnDetails { ColumnName = &quot;Configuration&quot;, Caption = &quot;Configuration&quot;, Hidden = false, Type = &quot;string&quot; },
                                                new PickerColumnDetails { ColumnName = &quot;SystemId&quot;, Caption = &quot;System ID&quot;, Hidden = true, Type = &quot;int&quot; },
                                                };
                }
            }
            return columns;
        }

        private string PopulateParametersForPicker()
        {
            string resourceType = &quot;&quot;;
            StringBuilder parameters = new StringBuilder();
            if (hiddenResourceSelectedText.Value == &quot;&quot;)
                parameters.Append(&quot;{&quot;)
                    .Append(&quot;\&quot;DataSource\&quot; : \&quot;_table:vw_LIBRARYResManPower\&quot;&quot;)
                       .Append(&quot;}&quot;);
            string ddlSelectedresourceType = &quot;&quot;;

            if (!String.IsNullOrEmpty(hiddenResourceSelectedText.Value))
            {
                ddlSelectedresourceType = hiddenResourceSelectedText.Value.ToLower();
                if (ddlSelectedresourceType.Contains(&quot;equipment&quot;))
                    resourceType = &quot;vw_LIBRARYResEquipment&quot;;
                else if (ddlSelectedresourceType.Contains(&quot;resource&quot;))
                    resourceType = &quot;vw_LibResource&quot;;
                else if (ddlSelectedresourceType.Contains(&quot;material&quot;))
                    resourceType = &quot;vw_LIBRARYResMaterial&quot;;
                else if (ddlSelectedresourceType.Contains(&quot;subcontract&quot;))
                    resourceType = &quot;vw_LIBRARYResSubContract&quot;;
                else if (ddlSelectedresourceType.Contains(&quot;spareparts&quot;))
                    resourceType = &quot;vw_LIBRARYResSpareParts&quot;;
                else if (ddlSelectedresourceType.ToLower2().Contains(&quot;personnel&quot;))
                    resourceType = &quot;vw_LIBRARYResManPower&quot;;

                parameters.Append(&quot;{&quot;)
                     .Append(&quot;\&quot;DataSource\&quot; : \&quot;_table:&quot; + resourceType + &quot;\&quot;,&quot;)
                     .Append(&quot;\&quot;WhereCond\&quot;:\&quot;&quot; + &quot;SystemId@^&quot; + MeasSysID.ToString2() + &quot;\&quot;&quot;)
                        .Append(&quot;}&quot;);
            }

            return parameters.ToString();
        }

        private void tradeAgreement_BindData(string Filter, string SortOrder, out DataSet DsResult, ref int CurrentPage,
            int PageSize, out int PageCount)
        {
            DsResult = new DataSet();
            PageCount = 0;
            if (gridRateAnalysis.SelectedItems.Count &gt; 0)
            {
                foreach (Telerik.Web.UI.GridDataItem item in gridRateAnalysis.SelectedItems)
                {
                    string dimensionFilter = &quot;&quot;;
                    string resItemID = item[&quot;ParentResItemId&quot;].Text;
                    string size = item[&quot;Size&quot;].Text == null
                        ? &quot;&quot;
                        : item[&quot;Size&quot;].Text.ToString2();
                    string color = item[&quot;Color&quot;].Text == null
                        ? &quot;&quot;
                        : item[&quot;Color&quot;].Text;
                    string configuration = item[&quot;Configuration&quot;].Text == null
                        ? &quot;&quot;
                        : item[&quot;Configuration&quot;].Text;
                    string itemFilter = &quot;&lt;ItemRelation type =&#39;txt&#39;&gt;&quot; + resItemID + &quot;&lt;/ItemRelation&gt;&quot;;
                    dimensionFilter = (!string.IsNullOrEmpty(size))
                        ? &quot;&lt;Table2_InventSizeId type =&#39;txt&#39;&gt;&quot; + size + &quot;&lt;/Table2_InventSizeId&gt;&quot;
                        : &quot;&quot;;
                    dimensionFilter += (!string.IsNullOrEmpty(color))
                        ? &quot;&lt;Table2_InventColorId type =&#39;txt&#39;&gt;&quot; + color + &quot;&lt;/Table2_InventColorId&gt;&quot;
                        : &quot;&quot;;
                    dimensionFilter += (!string.IsNullOrEmpty(color))
                        ? &quot;&lt;Table2_ConfigId type =&#39;txt&#39;&gt;&quot; + configuration + &quot;&lt;/Table2_ConfigId&gt;&quot;
                        : &quot;&quot;;

                    if (string.IsNullOrEmpty(Filter))
                        Filter = &quot;&lt;XMLRoot&gt;&quot; + itemFilter + dimensionFilter + &quot;&lt;/XMLRoot&gt;&quot;;
                    else
                        Filter = Filter.Replace(&quot;&lt;/XMLRoot&gt;&quot;, itemFilter + dimensionFilter + &quot;&lt;/XMLRoot&gt;&quot;);
                    int count = 0;
                    DataSet dsAXTradeAgmt = new BrixDataSet();
                    PageCount = (int)Math.Ceiling(GetTradeAgreementPageCount(Filter) / PageSize);
                    IntegrationConnectorManager.HandleIntegration(
                        GetConnectorParameters(MethodBase.GetCurrentMethod(), Filter), ref count, ref dsAXTradeAgmt, true);
                    DsResult = dsAXTradeAgmt;
                    PageCount = PageCount == 0 ? 1 : PageCount;
                }
            }
            else
            {
                DsResult = new DataSet();
                PageCount = 1;
            }
        }

        private void inventoryDimensions_BindData(string Filter, string SortOrder, out DataSet DsResult,
            ref int CurrentPage, int PageSize, out int PageCount)
        {
            DsResult = new DataSet();
            PageCount = 0;
            if (gridRateAnalysis.SelectedItems.Count &gt; 0)
            {
                foreach (Telerik.Web.UI.GridDataItem item in gridRateAnalysis.SelectedItems)
                {
                    string resItemId = item[&quot;ResItemId&quot;].Text.ToString2();
                    string itemFilter = &quot;&lt;ItemId type =&#39;txt&#39;&gt;&quot; + resItemId + &quot;&lt;/ItemId&gt;&lt;/XMLRoot&gt;&quot;;
                    if (string.IsNullOrEmpty(Filter))
                        Filter = &quot;&lt;XMLRoot&gt;&quot; + itemFilter;
                    else
                        Filter = Filter.Replace(&quot;&lt;/XMLRoot&gt;&quot;, itemFilter);

                    DataSet ds = new BrixDataSet();
                    PageCount = (int)Math.Ceiling(GetDimensionsPageCount(Filter) / PageSize);
                    int count = 0;
                    if (
                        IntegrationConnectorManager.HandleIntegration(
                            GetConnectorParameters(MethodBase.GetCurrentMethod(), Filter), ref count, ref ds, true))
                    {
                        if (ds.Tables.Count &gt; 0)
                        {
                            DsResult = ds;
                            PageCount = PageCount == 0 ? 1 : PageCount;
                        }
                    }
                }
            }
        }

        private double GetPageCount(string resType, int measSysID, string sort, string filter)
        {
            string mappedCompany = string.Empty;
            //if (ConfigurationManager.AppSettings[&quot;CompanyFilter&quot;] != null &amp;&amp; ConfigurationManager.AppSettings[&quot;CompanyFilter&quot;] == &quot;On&quot;)
            mappedCompany = Session[Constants.EIS_ADDITIONAL_INFO].ToString2();
            return blInstance.GetResourceItemsCount(mappedCompany, resType, measSysID, sort, filter);
        }

        private double GetDimensionsPageCount(string filter)
        {
            int count = 0;
            DataSet ds = new BrixDataSet();
            if (
                IntegrationConnectorManager.HandleIntegration(
                    GetConnectorParameters(MethodBase.GetCurrentMethod(), filter), ref count, ref ds, true))
                return count;
            else
                return 0;
        }

        private double GetTradeAgreementPageCount(string filter)
        {
            int count = 0;
            DataSet ds = new BrixDataSet();
            if (
                IntegrationConnectorManager.HandleIntegration(
                    GetConnectorParameters(MethodBase.GetCurrentMethod(), filter), ref count, ref ds, true))
                return count;
            else
                return 0;
        }

        private bool ErpFetchTriggerPointSupported()
        {
            bool isERPFetchEquipmentSupported,
                isERPFetchManpowerSupported,
                isERPFetchMaterialSupported,
                isERPFetchSparePartsSupported;
            isERPFetchEquipmentSupported =
                isERPFetchManpowerSupported = isERPFetchMaterialSupported = isERPFetchSparePartsSupported = false;

            var dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
            var connectorParameters =
                new ConnectorParameters(dictAdditionalInfo, EISPageDataManager.GetClassNameForResType(&quot;equipment&quot;),
                    &quot;GetList&quot;, AMP3ObjectType.Unknown, null, null);
            isERPFetchEquipmentSupported =
                IntegrationConnectorManager.Instance.IsTriggerPointEnabled(connectorParameters);
            connectorParameters =
                new ConnectorParameters(dictAdditionalInfo, EISPageDataManager.GetClassNameForResType(&quot;manpower&quot;),
                    &quot;GetList&quot;, AMP3ObjectType.Unknown, null, null);
            isERPFetchManpowerSupported = IntegrationConnectorManager.Instance.IsTriggerPointEnabled(connectorParameters);
            connectorParameters =
                new ConnectorParameters(dictAdditionalInfo, EISPageDataManager.GetClassNameForResType(&quot;material&quot;),
                    &quot;GetList&quot;, AMP3ObjectType.Unknown, null, null);
            isERPFetchMaterialSupported = IntegrationConnectorManager.Instance.IsTriggerPointEnabled(connectorParameters);
            connectorParameters =
                new ConnectorParameters(dictAdditionalInfo, EISPageDataManager.GetClassNameForResType(&quot;spareparts&quot;),
                    &quot;GetList&quot;, AMP3ObjectType.Unknown, null, null);
            isERPFetchSparePartsSupported =
                IntegrationConnectorManager.Instance.IsTriggerPointEnabled(connectorParameters);

            return isERPFetchEquipmentSupported || isERPFetchManpowerSupported || isERPFetchMaterialSupported ||
                   isERPFetchSparePartsSupported;
        }

        private void tradeAgreementPicker_SelectedIndexChanged(object sender, ItemSelectedEventArgs e)
        {
            /*string tradeCurrency = &quot;&quot;;
            decimal cost, rate;
            DataTable selectedResources = e.SelectedItems;
            foreach (DataRow dr in selectedResources.Rows)
            {
                UltraGridRow ugr = gridRateAnalysis.DisplayLayout.ActiveRow;
                ugr.Cells.FromKey(&quot;Contractor&quot;).Value = dr[&quot;AccountRelation&quot;].ToString2();
                ugr.Cells.FromKey(&quot;Configuration&quot;).Value = dr[&quot;Configuration&quot;].ToString2().Trim();
                ugr.Cells.FromKey(&quot;Size&quot;).Value = dr[&quot;Size&quot;].ToString2().Trim();
                ugr.Cells.FromKey(&quot;Color&quot;).Value = dr[&quot;Color&quot;].ToString2().Trim();
                ugr.Cells.FromKey(&quot;TradeAgmtCurrency&quot;).Value = tradeCurrency = dr[&quot;Currency&quot;].ToString2();
                ugr.Cells.FromKey(&quot;Unit&quot;).Value = dr[&quot;Unit&quot;].ToString2();
                string resItemId = ugr.Cells.FromKey(&quot;ParentResItemId&quot;).Value +
                                   (string.IsNullOrEmpty(dr[&quot;Size&quot;].ToString2().Trim())
                                       ? &quot;&quot;
                                       : (&quot;@&quot; + dr[&quot;Size&quot;].ToString2().ToLower2().Trim())) +
                                   (string.IsNullOrEmpty(dr[&quot;Color&quot;].ToString2().Trim())
                                       ? &quot;&quot;
                                       : (&quot;@&quot; + dr[&quot;Color&quot;].ToString2().ToLower2().Trim())) +
                                   (string.IsNullOrEmpty(dr[&quot;Configuration&quot;].ToString2().Trim())
                                       ? &quot;&quot;
                                       : (&quot;@&quot; + dr[&quot;Configuration&quot;].ToString2().ToLower2().Trim()));
                ugr.Cells.FromKey(&quot;ResItemId&quot;).Value = resItemId;

                //Do currency conversion from Trade Currency to Contract/Estimate Currency
                string moduleCurrency = LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL);

                rate = Convert.ToDecimal(dr[&quot;Amount&quot;].ToString2());
                LocalizationManager.ApplyCurrencyConversion(tradeCurrency, moduleCurrency, ref rate,
                    Session[&quot;AXCompany&quot;].ToString2());

                if (ModuleID == &quot;ITMPOST&quot;)
                {
                    cost = Convert.ToDecimal(rate * Convert.ToDecimal(ugr.Cells.FromKey(&quot;Quantity&quot;).Value));
                }
                else
                {
                    cost =
                        Convert.ToDecimal(rate * Convert.ToDecimal(ugr.Cells.FromKey(&quot;Quantity&quot;).Value) *
                                          (1 + Convert.ToDecimal(ugr.Cells.FromKey(&quot;WastagePercent&quot;).Value) / 100));
                    ugr.Cells.FromKey(&quot;WasteAmt&quot;).Value =
                        Convert.ToDecimal(rate * Convert.ToDecimal(ugr.Cells.FromKey(&quot;Quantity&quot;).Value) *
                                          Convert.ToDecimal(ugr.Cells.FromKey(&quot;WastagePercent&quot;).Value) / 100);
                }

                ugr.Cells.FromKey(&quot;Cost&quot;).Value = cost;
                ugr.Cells.FromKey(&quot;Rate&quot;).Value = rate;
                gridRateAnalysis.Columns.FromKey(&quot;Rate&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;
                gridRateAnalysis.Columns.FromKey(&quot;Cost&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                gridRateAnalysis.Columns.FromKey(&quot;WasteAmt&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
            }
            resourcePicker_BackClicked(sender, e);*/
        }

        private void inventoryDimensionsPicker_SelectedIndexChanged(object sender, ItemSelectedEventArgs e)
        {
            /*DataTable selectedResources = e.SelectedItems;
            foreach (DataRow dr in selectedResources.Rows)
            {
                UltraGridRow ugr = gridRateAnalysis.DisplayLayout.ActiveRow;
                ugr.Cells.FromKey(&quot;Configuration&quot;).Value = dr[&quot;ConfigId&quot;].ToString2();
                ugr.Cells.FromKey(&quot;Size&quot;).Value = dr[&quot;InventSizeId&quot;].ToString2();
                ugr.Cells.FromKey(&quot;Color&quot;).Value = dr[&quot;InventColorId&quot;].ToString2();
            }
            resourcePicker_BackClicked(sender, e);*/
        }

        private Resource GetDTOFromHTTP(ItemSelectedEventArgs e)
        {
            var selResource = new Resource();

            selResource.Description = e.SelectedItems.Rows[0][&quot;Description&quot;].ToString2();
            selResource.Unit = e.SelectedItems.Rows[0][&quot;Unit&quot;].ToString2();
            if (e.SelectedItems.Columns.Contains(&quot;ResItemID&quot;))
                selResource.ResItemID = e.SelectedItems.Rows[0][&quot;ResItemID&quot;].ToString2();
            selResource.Rate = Convert.ToDecimal(e.SelectedItems.Rows[0][&quot;Rate&quot;] ?? 0, CultureInfo.CurrentCulture);
            return selResource;
        }

        protected override void OnPreRender(EventArgs e)
        {
            if (ReadOnly)
            {
                //DisableButton(false);
                //ColumnsCollection cols = gridRateAnalysis.Columns;
                //foreach (UltraGridColumn ugc in cols)
                //    ugc.AllowUpdate = AllowUpdate.No;
            }

            if (ModuleID != &quot;ITMPOST&quot; || !IsERPConnected || !IsERPMaterialIssueSupported() ||
                ModuleManager.Instance.GetModuleDetails(&quot;MATRISS&quot;) == null)
                btnMaterialIssuDetails.Visible = false;
            if (IsERPConnected &amp;&amp; isERPFetchResourceSupported)
            {
                RateAnalysisDescription.Enabled = false;
                txtResItemID.Enabled = false;
                ddlRateAnalysisUnitID.Enabled = false;
                hdnEIS.Value = &quot;1&quot;;
            }
            else
            {
                btnTradeAgreement.Visible = false;
                btnInventoryDimensions.Visible = false;
                ddlAXItemGroups.Style[&quot;display&quot;] = &quot;none&quot;;
            }
            // set the grid height to a fixed value
            //gridRateAnalysis.DisplayLayout.FrameStyle.Height = Unit.Pixel(200);
            //gridRateAnalysis.Height = Unit.Pixel(180);
            uwgOverheads.DisplayLayout.FrameStyle.Height = Unit.Pixel(200);
            uwgOverheads.Height = Unit.Pixel(180);

            if (Visible)
            {
                MasterPage obj = Page.Master;
                if (Page.Master.Master != null)
                    obj = Page.Master.Master;
                if (obj != null &amp;&amp; obj.FindControl(&quot;ToolbarRow&quot;) != null)
                    (obj.FindControl(&quot;ToolbarRow&quot;) as Literal).Text = &quot;&lt;tr style=&#39;display:none&#39;&gt;&quot;;
            }
            if (parentItemModel != null)
            {
                if (!parentItemModel.DisplayRateAnalysisSection)
                {
                    if (MainToolBar.GetMenuReference(&quot;lnkAddMiscellaneous&quot;) != null &amp;&amp; !btnAddRateAnalysis.Visible)
                        MainToolBar.HideMenu(&quot;lnkAddMiscellaneous&quot;);
                    if (MainToolBar.GetMenuReference(&quot;lnkDelete&quot;) != null &amp;&amp; !btnDeleteRateAnalysis.Visible)
                        MainToolBar.HideMenu(&quot;lnkDelete&quot;);
                    if (MainToolBar.GetMenuReference(&quot;lnkTradeAgreement&quot;) != null &amp;&amp; !btnTradeAgreement.Visible)
                        MainToolBar.HideMenu(&quot;lnkTradeAgreement&quot;);
                    if (MainToolBar.GetMenuReference(&quot;lnkInventoryDimensions&quot;) != null &amp;&amp; !btnInventoryDimensions.Visible)
                        MainToolBar.HideMenu(&quot;lnkInventoryDimensions&quot;);
                    if (MainToolBar.GetMenuReference(&quot;lnkMIDetails&quot;) != null &amp;&amp; !btnMaterialIssuDetails.Visible)
                        MainToolBar.HideMenu(&quot;lnkMIDetails&quot;);
                }

                if (parentItemModel.DisplayRateAnalysisSection)
                {
                    if (ModuleID == &quot;LIBRARY&quot;)
                    {
                        btnResourceAddMisc.Visible = false;
                        this.HideCounter(&quot;Miscellaneous&quot;);
                    }
                    else
                    {
                        btnResourceAddMisc.Visible = true;
                    }

                    if (!ReadOnly)
                        btnResourceDelete.Visible = true;
                    DivMenuRateAnalyisis.Visible = false;
                }
            }
            base.OnPreRender(e);
        }

        private void BindMaterialIssueNo(string ResItemID)
        {
            if (!string.IsNullOrEmpty(Request[&quot;ContractID&quot;]))
            {
                DataTable dtBrixMI = IntegrationConnectorManager.Instance.GetAXApprovedMaterialIssues(ItemID, SubItemID,
                    ResItemID);
                DataTable dtAXMI =
                    GetApprovedMaterialIssues(Convert.ToInt32(Request[&quot;ContractID&quot;], CultureInfo.CurrentCulture),
                        ResItemID);

                //Filter out Issued MI&#39;s
                if (dtBrixMI != null &amp;&amp; dtAXMI != null)
                {
                    for (int i = 0; i &lt; dtBrixMI.Rows.Count; i++)
                    {
                        DataRow[] drSelect =
                            dtAXMI.Select(&quot;MaterialIssueId = &#39;&quot; + dtBrixMI.Rows[i][&quot;MaterialIssueId&quot;].ToString2() + &quot;&#39;&quot;);
                        if (drSelect.Length == 0)
                        {
                            dtBrixMI.Rows.RemoveAt(i);
                            i--;
                        }
                    }
                    UIHelper.BindDropDownData(ddlMaterialIssueNo, dtBrixMI, &quot;MaterialIssueId&quot;, &quot;MaterialIssueId&quot;, true);
                }
            }
        }

        private DataTable GetIssuedQuantity(string ResItemId, string materialIssueId)
        {
            string filterCriteria = &quot;&quot;;
            filterCriteria = &quot;&lt;XMLRoot&gt;&lt;MaterialIssueId type=&#39;txt&#39;&gt;&quot; + materialIssueId +
                             &quot;&lt;/MaterialIssueId&gt;&lt;Table2_ItemId type =&#39;txt&#39;&gt;&quot; + ResItemId + &quot;&lt;/Table2_ItemId&gt;&lt;/XMLRoot&gt;&quot;;

            var filter = new ConnectionFilter(filterCriteria, null, null, null, null);
            var objAdditionalInfo = new EISAdditionalInfo(RegisteredEIS.AX);
            objAdditionalInfo.AddInfo(Constants.EIS_ADDITIONAL_INFO, Session[Constants.EIS_ADDITIONAL_INFO]);
            var dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
            dictAdditionalInfo.Add(RegisteredEIS.AX, objAdditionalInfo);

            var ConnectorParameters =
                new ConnectorParameters(dictAdditionalInfo, MethodBase.GetCurrentMethod(),
                    AMP3ObjectType.Unknown, filter, null);
            DataSet ds = new BrixDataSet();
            int count = 0;
            if (IntegrationConnectorManager.HandleIntegration(ConnectorParameters, ref count, ref ds, true))
            {
                return ds.Tables[0]; // return count;
            }
            else
                return null;
        }

        private DataTable GetApprovedMaterialIssues(int contractID, string ResItemID)
        {
            string filterCriteria = &quot;&quot;;
            string mappedCompany = &quot;&quot;;

            DataTable dtMap = IntegrationConnectorManager.Instance.GetERPObjectMapInfo(contractID.ToString2(),
                AMP3Object.CONTMGT, null,
                AMP3Object.UNKNOWN,
                RegisteredEIS.AX);
            if (dtMap.Rows.Count &gt; 0)
            {
                filterCriteria = &quot;&lt;XMLRoot&gt;&lt;ProjId type=&#39;txt&#39;&gt;&quot; + dtMap.Rows[0][&quot;ERPId&quot;].ToString2() +
                                 &quot;&lt;/ProjId&gt;&lt;MaterialIssueStatus type=&#39;int&#39;&gt;3&lt;/MaterialIssueStatus&gt;&lt;Table2_ItemId type=&#39;txt&#39;&gt;&quot; +
                                 ResItemID + &quot;&lt;/Table2_ItemId&gt;&lt;/XMLRoot&gt;&quot;;
                mappedCompany = dtMap.Rows[0][&quot;ERPCompany&quot;].ToString2();
            }
            else
            {
                return null;
            }

            var filter = new ConnectionFilter(filterCriteria, null, null, null, null);
            var objAdditionalInfo = new EISAdditionalInfo(RegisteredEIS.AX);
            objAdditionalInfo.AddInfo(Constants.EIS_ADDITIONAL_INFO, mappedCompany);
            var dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
            dictAdditionalInfo.Add(RegisteredEIS.AX, objAdditionalInfo);
            var ConnectorParameters =
                new ConnectorParameters(dictAdditionalInfo, MethodBase.GetCurrentMethod(),
                    AMP3ObjectType.Unknown, filter, null);
            DataSet ds = new BrixDataSet();
            int count = 0;
            if (IntegrationConnectorManager.HandleIntegration(ConnectorParameters, ref count, ref ds, true))
            {
                return ds.Tables[0]; // return count;
            }
            else
                return null;
        }

        private void resourcePicker_BackClicked(object sender, EventArgs e)
        {
            ShowDiv(RateAnalysisDivEnums.Resources);
            ddlRateAnalysisResource.SelectedIndex = 0;
            ddlAXItemGroups.SelectedIndex = 0;
            hdnItemGroupValue.Value = &quot;&quot;;
            if (parentItemModel != null &amp;&amp; parentItemModel.DisplayRateAnalysisSection &amp;&amp; Parent.FindControl(&quot;DivCreateItem&quot;) != null)
                Parent.FindControl(&quot;DivCreateItem&quot;).Visible = true;
        }

        private void ShowDiv(RateAnalysisDivEnums divType)
        {
            string resourceHeader = ModuleID.Equals(&quot;ITMPOST&quot;) ? &quot;Resource Consumption&quot; : &quot;Rate Analysis&quot;;
            //HtmlGenericControl header = ((HtmlGenericControl)((Page)HttpContext.Current.Handler).Form.FindControl(&quot;C2&quot;).FindControl(&quot;tdPageHeader&quot;));
            DivResources.Visible = (RateAnalysisDivEnums.Resources == divType);
            DivResourcePicker.Visible = (RateAnalysisDivEnums.ResourcePicker == divType);
            DivTradeAgreementPicker.Visible = (RateAnalysisDivEnums.TradeAgreementPicker == divType);
            DivDimensionsPicker.Visible = (RateAnalysisDivEnums.DimensionsPicker == divType);
            RAPageTitle = (RateAnalysisDivEnums.Resources == divType)
                ? resourceHeader
                : ddlRateAnalysisResource.SelectedItem.Text + &quot; Picker&quot;;
            if (parentItemModel != null)
            {
                if (parentItemModel.DisplayRateAnalysisSection &amp;&amp; RateAnalysisDivEnums.ResourcePicker == divType)
                {
                    if (Parent.FindControl(&quot;DivCreateItem&quot;) != null)
                        Parent.FindControl(&quot;DivCreateItem&quot;).Visible = false;
                    if (Parent.FindControl(&quot;DivAttachmentControl&quot;) != null)
                        Parent.FindControl(&quot;DivAttachmentControl&quot;).Visible = false;
                    if (this.Page != null &amp;&amp; this.Page is BrixPageBase)
                        ((BrixPageBase)this.Page).HideShowMainToolBar = false;
                }
                else if (parentItemModel.DisplayRateAnalysisSection)
                {
                    if (this.Page != null &amp;&amp; this.Page is BrixPageBase)
                        ((BrixPageBase)this.Page).HideShowMainToolBar = true;
                }
            }
            //if (divType == RateAnalysisDivEnums.TradeAgreementPicker)
            //    header.InnerText = &quot;Trade Agreement&quot;;
            //if (divType == RateAnalysisDivEnums.DimensionsPicker)
            //    header.InnerText = &quot;Inventory Dimensions&quot;;
        }

        private void btnResourcePicker_Click(object sender, EventArgs e)
        {
            hiddenResourceSelectedText.Value = ddlRateAnalysisResource.SelectedItem.Text;
            InitializeResourcePicker();
            Page page = HttpContext.Current.Handler as Page;
            Page.ClientScript.RegisterStartupScript(this.GetType(), &quot;CallTriggerClick&quot;, &quot;javascript:TriggerClick();&quot;, true);
        }

        private void btnTradeAgreement_Click(object sender, EventArgs e)
        {
            tradeAgreementPicker.StateMgmtContext = &quot;Resource&quot; + ddlRateAnalysisResource.Text;
            ShowDiv(RateAnalysisDivEnums.TradeAgreementPicker);
            tradeAgreementPicker.ChangeTableOrViewAndBind(&quot;&quot;);
        }

        private void btnInventoryDimensions_Click(object sender, EventArgs e)
        {
            dimensionsPicker.StateMgmtContext = &quot;Resource&quot; + ddlRateAnalysisResource.Text;
            ShowDiv(RateAnalysisDivEnums.DimensionsPicker);
            dimensionsPicker.ChangeTableOrViewAndBind(&quot;&quot;);
        }

        private void btnBack_Click(object sender, EventArgs e)
        {
            ClearInsertForm();
            OnBackClicked(e);
        }

        protected void btnRAEdit_Click(object sender, EventArgs e)
        {
            if (ModuleID == &quot;ITMPOST&quot; &amp;&amp; ddlRateAnalysisResource.SelectedItem.Text.Equals(&quot;Material&quot;))
            {
                txtIssuedQty.Text = string.Empty;
                txtBalancedQty.Text = string.Empty;
                if (gridRateAnalysis.SelectedItems.Count &gt; 0)
                {
                    foreach (Telerik.Web.UI.GridDataItem item in gridRateAnalysis.SelectedItems)
                    {
                        RateAnalysisDescription.Text = item[&quot;Description&quot;].Text.ToString2();
                        txtResItemID.Text = item[&quot;ResItemID&quot;].ToString2();
                    }
                }
                if (ModuleManager.Instance.GetModuleDetails(&quot;MATRISS&quot;) != null)
                {
                    BindMaterialIssueNo(txtResItemID.Text);
                    if (ddlMaterialIssueNo.SelectedItem != null)
                    {
                        string issQty = string.Empty;
                        issQty =
                            GetIssuedQuantity(txtResItemID.Text, ddlMaterialIssueNo.SelectedItem.Text).Rows[0][
                                &quot;IssuedQty&quot;].ToString2();
                        txtIssuedQty.Text = String.IsNullOrEmpty(issQty)
                            ? (0.0M).ToString(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY,
                                CultureInfo.CurrentCulture)
                            : Convert.ToDecimal(issQty, CultureInfo.CurrentCulture).ToString(
                                AMP3ApplicationSettings.Instance.FORMAT_QUANTITY, CultureInfo.CurrentCulture);
                        if (!String.IsNullOrEmpty(txtIssuedQty.Text))
                        {
                            txtBalancedQty.Text =
                                ((Convert.ToDecimal(txtIssuedQty.Text, CultureInfo.CurrentCulture)) -
                                 (ItemManager.Instance.GetBalancedQty(
                                     Convert.ToInt32(Request[&quot;ContractID&quot;], CultureInfo.CurrentCulture),
                                     txtResItemID.Text, ddlMaterialIssueNo.SelectedItem.Text))).ToString(
                                         AMP3ApplicationSettings.Instance.FORMAT_QUANTITY, CultureInfo.CurrentCulture);
                        }
                        else
                            txtBalancedQty.Text = string.Empty;
                    }
                    else
                    {
                        txtIssuedQty.Text = string.Empty;
                        txtBalancedQty.Text = string.Empty;
                    }
                    trMaterialIssueNo.Style[&quot;display&quot;] = &quot;table-row&quot;;
                }
                RateAnalysisForm.Style[&quot;display&quot;] = &quot;block&quot;;
                //DisableButton(false);
            }
        }

        protected void ddlMaterialIssueNo_SelIdxChanged(object sender, EventArgs e)
        {
            string issQty = string.Empty;
            issQty =
                GetIssuedQuantity(txtResItemID.Text, ddlMaterialIssueNo.SelectedItem.Text).Rows[0][&quot;IssuedQty&quot;].
                    ToString2();
            txtIssuedQty.Text = String.IsNullOrEmpty(issQty)
                ? (0.0M).ToString(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY, CultureInfo.CurrentCulture)
                : Convert.ToDecimal(issQty, CultureInfo.CurrentCulture).ToString(
                    AMP3ApplicationSettings.Instance.FORMAT_QUANTITY, CultureInfo.CurrentCulture);
            if (!String.IsNullOrEmpty(txtIssuedQty.Text))
            {
                txtBalancedQty.Text =
                    ((Convert.ToDecimal(txtIssuedQty.Text, CultureInfo.CurrentCulture)) -
                     (ItemManager.Instance.GetBalancedQty(
                         Convert.ToInt32(Request[&quot;ContractID&quot;], CultureInfo.CurrentCulture), txtResItemID.Text,
                         ddlMaterialIssueNo.SelectedItem.Text))).ToString(
                             AMP3ApplicationSettings.Instance.FORMAT_QUANTITY,
                             CultureInfo.CurrentCulture);
            }
            else
                txtBalancedQty.Text = string.Empty;
        }

        private void btnDeleteRateAnalysis_Click(object sender, EventArgs e)
        {
            string[] ids = deleteResourceDetailID.Text.Split(&quot;,&quot;.ToCharArray());
            ItemManager.Instance.DeleteRateAnalysis(ids[0]);
            BindRateAnalysis1(ModuleID, ParentInstanceID, ItemID);
            ClearInsertForm();
        }

        protected void AlertError(string errMessage)
        {
            errMessage = errMessage.Replace(&quot;\&#39;&quot;, &quot;\\&#39;&quot;).Replace(&quot;\n&quot;, &quot;\\n&quot;).Replace(&quot;|&quot;, &quot;\\n&quot;);
            ScriptManager.RegisterStartupScript(btnResourcePicker, btnResourcePicker.GetType(), &quot;ShowAlert&quot;,
                &quot;ShowError(&#39;&quot; + errMessage + &quot;&#39;);&quot;, true);
        }

        protected Resource GetResourceDTO(DataRow item, DataColumnCollection columns)
        {
            DataTable dtResourceTypes = ItemManager.Instance.GetResourceTypes();

            Resource resourceDTO = new Resource();
            Int32 tempResDetailID = 0;
            if (columns.Contains(&quot;ResourceDetailID&quot;) &amp;&amp;
                Int32.TryParse(item[&quot;ResourceDetailID&quot;].ToString2(), out tempResDetailID) &amp;&amp;
                tempResDetailID != 0)
                resourceDTO.ResourceDetailID = tempResDetailID;
            else
                resourceDTO.ResourceDetailID = null;

            resourceDTO.ItemID = Convert.ToInt32(ItemID4RateAnalysis.Text, CultureInfo.CurrentCulture);

            string resName = item[&quot;ResourceTypeName&quot;].ToString2();
            resourceDTO.ResourceTypeName = resName;
            resourceDTO.ResourceTypeID = Convert.ToInt16(dtResourceTypes.Select(&quot;ResourceTypeName=&#39;&quot; + resName + &quot;&#39;&quot;)[0][&quot;ResourceTypeID&quot;], CultureInfo.CurrentCulture);

            resourceDTO.Description = item[&quot;Description&quot;].ToString2();

            if (columns.Contains(&quot;Unit&quot;))
            {
                string tempUnit = item[&quot;Unit&quot;].ToString2();
                Int64 tempUnitID = 0;
                if (Int64.TryParse(tempUnit, out tempUnitID))
                {
                    // MISCELLANEOUS -- INTEGER UNIT ID IS COMING
                    resourceDTO.UnitID = tempUnitID;
                    resourceDTO.Unit = dtTempunit.Select(&quot;UnitID=&#39;&quot; + tempUnit + &quot;&#39;&quot;)[0][&quot;Unit&quot;].ToString2();
                }
                else
                {
                    //  IT IS TEXT AND DIRECTLY COMING FROM AX
                    resourceDTO.Unit = tempUnit;
                    resourceDTO.UnitID = dtTempunit.Select(&quot;Unit=&#39;&quot; + tempUnit + &quot;&#39;&quot;)[0][&quot;UnitID&quot;].ToInt32_2();
                }
            }
            resourceDTO.Rate = (columns.Contains(&quot;Rate&quot;)) ? Convert.ToDecimal(item[&quot;Rate&quot;].ToString2(), CultureInfo.CurrentCulture) : 0;
            resourceDTO.WastagePercent = (columns.Contains(&quot;WastagePercent&quot;)) ? Convert.ToDecimal(item[&quot;WastagePercent&quot;].ToString2(), CultureInfo.CurrentCulture) : 0;
            resourceDTO.WastageQty = (columns.Contains(&quot;WastageQty&quot;)) ? Convert.ToDecimal(item[&quot;WastageQty&quot;].ToString2(), CultureInfo.CurrentCulture) : 0;
            resourceDTO.ReworkQty = (columns.Contains(&quot;ReworkQty&quot;)) ? Convert.ToDecimal(item[&quot;ReworkQty&quot;].ToString2(), CultureInfo.CurrentCulture) : 0;
            resourceDTO.RegularQty = (columns.Contains(&quot;RegularQty&quot;)) ? Convert.ToDecimal(item[&quot;RegularQty&quot;].ToString2(), CultureInfo.CurrentCulture) : 0;
            resourceDTO.Quantity = (columns.Contains(&quot;Quantity&quot;) &amp;&amp; !string.IsNullOrEmpty(item[&quot;Quantity&quot;].ToString2())) ? Convert.ToDecimal(item[&quot;Quantity&quot;].ToString2(), CultureInfo.CurrentCulture) : 0;
            resourceDTO.Cost = (columns.Contains(&quot;Cost&quot;) &amp;&amp; !string.IsNullOrEmpty(item[&quot;Cost&quot;].ToString2())) ? Convert.ToDecimal(item[&quot;Cost&quot;].ToString2(), CultureInfo.CurrentCulture) : 0;
            resourceDTO.Notes = (columns.Contains(&quot;Notes&quot;)) ? item[&quot;Notes&quot;].ToString2() : &quot;&quot;;
            resourceDTO.ResourceType = (columns.Contains(&quot;ResourceType&quot;)) ? item[&quot;ResourceType&quot;].ToString2() : &quot;&quot;;
            resourceDTO.VariablePrice = (columns.Contains(&quot;VariablePrice&quot;)) ? Convert.ToDecimal(item[&quot;VariablePrice&quot;].ToString2(), CultureInfo.CurrentCulture) : 0;
            resourceDTO.UtilizationPercentage = (columns.Contains(&quot;UtilizationPercentage&quot;) &amp;&amp; !string.IsNullOrEmpty(item[&quot;UtilizationPercentage&quot;].ToString2())) ? Convert.ToDecimal(item[&quot;UtilizationPercentage&quot;].ToString2(), CultureInfo.CurrentCulture) : 0;
            resourceDTO.Count = (columns.Contains(&quot;Count&quot;)) ? Convert.ToDecimal(item[&quot;Count&quot;].ToString2(), CultureInfo.CurrentCulture) : 0;
            resourceDTO.ModuleID = ModuleID;
            resourceDTO.ParentInstanceID = ParentInstanceID;

            if (resName != &quot;Miscellaneous&quot;)
            {
                if (columns.Contains(&quot;ResItemID&quot;))
                    resourceDTO.ResItemID = item[&quot;ResItemID&quot;].ToString2();
            }
            else if (columns.Contains(&quot;ParentResItemID&quot;))
                resourceDTO.ResItemID = item[&quot;ParentResItemID&quot;].ToString2();

            if (columns.Contains(&quot;ParentResItemID&quot;) &amp;&amp; !string.IsNullOrEmpty(item[&quot;ParentResItemID&quot;].ToString2()))
                resourceDTO.ParentResItemID = item[&quot;ParentResItemID&quot;].ToString2();

            if (columns.Contains(&quot;IsCritical&quot;) &amp;&amp; !string.IsNullOrEmpty(item[&quot;IsCritical&quot;].ToString2()))
                resourceDTO.IsCritical = Convert.ToBoolean(item[&quot;IsCritical&quot;].ToString2(), CultureInfo.CurrentCulture);

            if (ModuleID == &quot;ITMPOST&quot; &amp;&amp; columns.Contains(&quot;MaterialIssueNo&quot;))
                resourceDTO.MaterialIssueNo = item[&quot;MaterialIssueNo&quot;].ToString2();

            resourceDTO.Configuration = (columns.Contains(&quot;Configuration&quot;)) ? item[&quot;Configuration&quot;].ToString2().Trim() : string.Empty;
            resourceDTO.Color = (columns.Contains(&quot;Color&quot;)) ? item[&quot;Color&quot;].ToString2().Trim() : string.Empty;
            resourceDTO.Size = (columns.Contains(&quot;Size&quot;)) ? item[&quot;Size&quot;].ToString2().Trim() : string.Empty;

            // AX TRADE AGREEMENT COLUMNS
            if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX))
            {
                resourceDTO.AccountNumber = (columns.Contains(&quot;Contractor&quot;))
                    ? item[&quot;Contractor&quot;].ToString2()
                    : string.Empty;
                resourceDTO.Currency = (columns.Contains(&quot;TradeAgmtCurrency&quot;))
                    ? item[&quot;TradeAgmtCurrency&quot;].ToString2()
                    : string.Empty;
            }

            if (columns.Contains(&quot;Unit&quot;) &amp;&amp;
                dtTempunit.Select(&quot;Unit=&#39;&quot; + item[&quot;Unit&quot;].ToString2() + &quot;&#39;&quot;).Length &gt; 0)
            {
                if (dtTempunit.Columns.Contains(&quot;Prorated&quot;))
                    resourceDTO.Prorated =
                        dtTempunit.Select(&quot;Unit=&#39;&quot; + item[&quot;Unit&quot;].ToString2() + &quot;&#39;&quot;)[0][&quot;Prorated&quot;].
                            ToString2();
                else if (dtTempunit.Columns.Contains(&quot;IsProrated&quot;))
                    resourceDTO.Prorated =
                        dtTempunit.Select(&quot;Unit=&#39;&quot; + item[&quot;Unit&quot;].ToString2() + &quot;&#39;&quot;)[0][&quot;IsProrated&quot;]
                            .ToString2();
                else
                    resourceDTO.Prorated = &quot;Y&quot;;
            }
            else
                resourceDTO.Prorated = &quot;Y&quot;;
            return resourceDTO;
        }

        public virtual void SaveResources(object sender, EventArgs e)
        {
            string errMessage = String.Empty;
            if (!ReadOnly)
            {
                //var ResourceInvalidAddedRows = new List&lt;Telerik.Web.UI.GridDataItem&gt;();
                try
                {
                    Item itemDTO = ItemManager.Instance.GetItemDetails(ModuleID, ParentInstanceID, ItemID);
                    //TODO: APPLY TRANSACTION HERE (VERY IMPORTANT)
                    string deletedIDs = deleteResourceDetailID.Text.Trim(&quot;,&quot;.ToCharArray());
                    if (!string.IsNullOrEmpty(deletedIDs))
                    {
                        foreach (string resSelID in deletedIDs.Split(&#39;,&#39;))
                        {
                            int resIDInt = 0;
                            if (Int32.TryParse(resSelID, out resIDInt))
                            {
                                Resource resDTO = ItemManager.Instance.GetRateAnalysis(resIDInt);

                                #region Validate Resource before Deleting

                                if (parentItemModel != null)
                                {
                                    string resValidate = parentItemModel.ValidateResourceBeforeDelete(itemDTO, resDTO);
                                    if (!String.IsNullOrEmpty(resValidate))
                                        errMessage += resValidate + &quot;|&quot;;
                                    else
                                    {
                                        //If there is an Associated Activity (SubContracting) then deletion is allowed only
                                        //for zero weightage
                                        if (
                                            !resDTO.ResourceTypeName.Equals(&quot;SubContract&quot;,
                                                StringComparison.CurrentCultureIgnoreCase) ||
                                            DeleteAssociatedActivityIfWeightageIsZero(ref errMessage, resSelID, resDTO))
                                            ItemManager.Instance.DeleteRateAnalysis(resSelID);
                                    }
                                }
                                else
                                {
                                    //If there is an Associated Activity (SubContracting) then deletion is allowed only
                                    //for zero weightage
                                    if (
                                        !resDTO.ResourceTypeName.Equals(&quot;SubContract&quot;,
                                            StringComparison.CurrentCultureIgnoreCase) ||
                                        DeleteAssociatedActivityIfWeightageIsZero(ref errMessage, resSelID, resDTO))
                                        ItemManager.Instance.DeleteRateAnalysis(resSelID);
                                }

                                #endregion
                            }
                        }
                    }

                    if (!string.IsNullOrEmpty(hdnResource.Value))
                    {
                        if (hdnDeleteExistingResources.Value == &quot;Y&quot;)
                        {
                            // Delete existing resources. To override new one&#39;s.
                            ItemManager.Instance.DeleteResourceDetails(ItemID);
                        }

                        DataTable activities = ItemManager.Instance.GetItemActivities(ModuleID, ParentInstanceID, ItemID, &quot;N&quot;).Tables[0];

                        DataTable array = JsonConvert.DeserializeObject&lt;DataTable&gt;(JArray.Parse(hdnResource.Value).ToString2());
                        var columns = array.Columns;
                        foreach (DataRow item in array.Rows)
                        {
                            Resource resourceDTO = GetResourceDTO(item, columns);

                            #region Fill in the Difference in Quantity

                            if (columns.Contains(&quot;WastagePercent&quot;) &amp;&amp;
                                !String.IsNullOrEmpty(item[&quot;WastagePercent&quot;].ToString2()))
                            {
                                if (item[&quot;WastagePercent&quot;].ToDecimal2() &gt; 100)
                                {
                                    AlertError(&quot;Wastgae(%) value can&#39;t be more then 100 percent&quot;);
                                    return;
                                }
                            }

                            if (columns.Contains(&quot;ResourceDetailID&quot;) &amp;&amp;
                                !String.IsNullOrEmpty(item[&quot;ResourceDetailID&quot;].ToString2()))
                            {
                                int resIDInt = 0;
                                if (Int32.TryParse(item[&quot;ResourceDetailID&quot;].ToString2(), out resIDInt) &amp;&amp;
                                    (resIDInt &gt; 0))
                                {
                                    Resource resExistingDTO = ItemManager.Instance.GetRateAnalysis(resIDInt);
                                    if (resourceDTO.Quantity.HasValue &amp;&amp; resExistingDTO.Quantity.HasValue)
                                    {
                                        if (ModuleID.Equals(&quot;ITMPOST&quot;))
                                            resourceDTO.DiffQuantity = resourceDTO.Quantity.GetValueOrDefault(0) -
                                                                       resExistingDTO.Quantity.GetValueOrDefault(0);
                                        else
                                            resourceDTO.DiffQuantity = resourceDTO.Quantity.GetValueOrDefault(0) *
                                                                       (1 +
                                                                        resourceDTO.WastagePercent.GetValueOrDefault(0) / 100) -
                                                                       resExistingDTO.Quantity.GetValueOrDefault(0) *
                                                                       (1 +
                                                                        resExistingDTO.WastagePercent.GetValueOrDefault(0) /
                                                                        100);
                                    }
                                }
                            }
                            else
                                resourceDTO.DiffQuantity = null; //When adding a resource, run the validation

                            #endregion

                            #region Validate Resource before Saving

                            if (parentItemModel != null)
                            {
                                string resValidate = parentItemModel.ValidateResourceBeforeSave(itemDTO, resourceDTO);
                                if (!String.IsNullOrEmpty(resValidate))
                                {
                                    errMessage += resValidate + &quot;|&quot;;
                                    if (resourceDTO.ResourceDetailID == null)
                                    {
                                        //Add the Invalid row to the list so that they can be added later.
                                        //ResourceInvalidAddedRows.Add(item);
                                    }
                                }
                                else
                                    SaveResource(activities, resourceDTO, itemDTO, ref errMessage);
                            }
                            else
                                SaveResource(activities, resourceDTO, itemDTO, ref errMessage);

                            #endregion
                        }
                    }
                }
                catch (Exception ex)
                {
                    // ROLL BACK THE TRANSACTION AND THEN DISPLAY THE ERROR MESSAGE.
                    AlertError(ex.Message);
                }

                BindRateAnalysis1(ModuleID, ParentInstanceID, ItemID);

                //Insert the newly added rows where validation failed.

                //foreach (UltraGridRow ugr in ResourceInvalidAddedRows)
                //    gridRateAnalysis.Rows.Add(ugr);

                deleteResourceDetailID.Text = String.Empty;
                ClearInsertForm();
            }

            if (parentItemModel != null &amp;&amp; parentItemModel.DisplayRateAnalysisSection &amp;&amp; Parent.FindControl(&quot;DivCreateItem&quot;) != null)
            {
                Parent.FindControl(&quot;DivCreateItem&quot;).Visible = true;
            }

            if (!String.IsNullOrEmpty(errMessage))
                AlertError(errMessage);
            else
                OnBackClicked(e);
        }

        private void SaveResource(DataTable activities, Resource resourceDTO, Item itemDTO,
            ref string errMessage)
        {
            if (resourceDTO.ResourceTypeName.Equals(&quot;subcontract&quot;,
                StringComparison.CurrentCultureIgnoreCase))
            {
                DataRow[] activityAssociated =
                    activities.Select(&quot;name=&#39;&quot; + resourceDTO.ResItemID.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) + &quot;&#39; and description=&#39;&quot; +
                                      resourceDTO.Description.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) +
                                      &quot;&#39;&quot;);
                if (string.IsNullOrEmpty(resourceDTO.ResourceDetailID.ToString()))
                {
                    #region Case when resource is being created for the first time

                    if (activityAssociated.Length &gt; 0)
                        errMessage += &quot;An activity with name: &quot; + resourceDTO.ResItemID + &quot; and Description: &quot; +
                                      resourceDTO.Description + &quot; already exists, hence the resource can not be added.&quot;;
                    else
                    {
                        resourceDTO.ResourceDetailID = ItemManager.Instance.SaveRateAnalysisDetails(resourceDTO);
                        CreateAssociatedSubcontractingActivity(resourceDTO, itemDTO);
                    }

                    #endregion
                }
                else
                {
                    #region Case when Resource has already been created

                    if (activityAssociated.Length &gt; 0
                        &amp;&amp; !String.IsNullOrEmpty(activityAssociated[0][&quot;AssociatedResourceID&quot;].ToString2())
                        &amp;&amp;
                        activityAssociated[0][&quot;AssociatedResourceID&quot;].ToString2().Equals(
                            resourceDTO.ResourceDetailID.ToString()))
                    {
                        int activityIDInt = 0;
                        if (Int32.TryParse(activityAssociated[0][&quot;ActivityID&quot;].ToString(), out activityIDInt))
                        {
                            Activity activityDTO = ItemManager.Instance.GetActivity(ModuleID, ParentInstanceID, ItemID,
                                activityIDInt);
                            //Set the new activity quantity for validations
                            activityDTO.Quantity = (resourceDTO.Quantity == null ? 0 : resourceDTO.Quantity) *
                                                   itemDTO.Quantity;

                            #region Validate Activity before Saving

                            if (parentItemModel != null)
                            {
                                string resValidate = parentItemModel.ValidateActivityBeforeSave(activityDTO);
                                if (!String.IsNullOrEmpty(resValidate))
                                    errMessage += resValidate + &quot;|&quot;;
                                else
                                {
                                    resourceDTO.ResourceDetailID =
                                        ItemManager.Instance.SaveRateAnalysisDetails(resourceDTO);
                                    CreateAssociatedSubcontractingActivity(resourceDTO, itemDTO);
                                }
                            }
                            else
                            {
                                resourceDTO.ResourceDetailID = ItemManager.Instance.SaveRateAnalysisDetails(resourceDTO);
                                CreateAssociatedSubcontractingActivity(resourceDTO, itemDTO);
                            }

                            #endregion
                        }
                    }
                    else
                        errMessage += &quot;Resource &quot; + resourceDTO.ResItemID +
                                      &quot; has already been created, but without an associated Activity.&quot;;

                    #endregion
                }
            }
            else
            {
                resourceDTO.ResourceDetailID = ItemManager.Instance.SaveRateAnalysisDetails(resourceDTO);
            }
        }

        protected bool DeleteAssociatedActivityIfWeightageIsZero(ref string errMessage, string resSelID, Resource resDTO)
        {
            DataTable activity =
                ComponentHelper.Instance.ExecuteDataSet(StoredProcedure.usp_CORITEMGetAssociatedActivityWeightage, null,
                    resSelID).Tables[0];
            if (activity.Rows.Count &gt; 0 &amp;&amp; !string.IsNullOrEmpty(activity.Rows[0][&quot;Percentage&quot;].ToString()) &amp;&amp;
                double.Parse(activity.Rows[0][&quot;Percentage&quot;].ToString()) &gt; 0)
            {
                errMessage += &quot;SubContract resources having activity with more than 0% weightage can not be deleted.&quot;;
                return false;
            }
            else
            {
                int activityIDInt = 0;
                if (Int32.TryParse(activity.Rows[0][&quot;ActivityID&quot;].ToString(), out activityIDInt))
                {
                    Activity activityDTO = ItemManager.Instance.GetActivity(ModuleID, ParentInstanceID, ItemID,
                        activityIDInt);

                    #region Validate Activity before Deleting

                    if (parentItemModel != null)
                    {
                        string resValidate = parentItemModel.ValidateActivityBeforeDelete(activityDTO);
                        if (!String.IsNullOrEmpty(resValidate))
                        {
                            errMessage += &quot;SubContracting resource &#39;&quot; + resDTO.Description +
                                          &quot;&#39; is related with activity &#39;&quot; + resDTO.Description + &quot;&#39; and &quot; + resValidate +
                                          &quot;|&quot;;
                            return false;
                        }
                        else
                            ItemManager.Instance.DeleteActivity(activityIDInt.ToString2());
                    }
                    else
                        ItemManager.Instance.DeleteActivity(activityIDInt.ToString2());

                    #endregion
                }

                return true;
            }
        }

        protected void CreateAssociatedSubcontractingActivity(Resource resourceDTO, Item itemDTO)
        {
            var activityDTO = new Activity();

            activityDTO.Description = resourceDTO.Description;
            activityDTO.AssociatedResourceID = resourceDTO.ResourceDetailID;
            activityDTO.Name = resourceDTO.ParentResItemID;
            activityDTO.Unit = resourceDTO.Unit;
            activityDTO.UnitID = resourceDTO.UnitID;
            activityDTO.Quantity = (resourceDTO.Quantity == null ? 0 : resourceDTO.Quantity) * itemDTO.Quantity *
                                   (1 + (resourceDTO.WastagePercent == null ? 0 : resourceDTO.WastagePercent) / 100);
            activityDTO.ItemID = resourceDTO.ItemID;
            activityDTO.ModuleID = resourceDTO.ModuleID;
            activityDTO.ParentInstanceID = resourceDTO.ParentInstanceID;
            activityDTO.Percentage = 0;

            ItemManager.Instance.SaveActivity(activityDTO);

            itemDTO.ActivityCount += 1;
        }

        protected void gridRateAnalysis_ItemDataBound(object sender, Telerik.Web.UI.GridItemEventArgs e)
        {
            if (e.Item is Telerik.Web.UI.GridDataItem)
            {
                Telerik.Web.UI.GridDataItem item = e.Item as Telerik.Web.UI.GridDataItem;

                // Tooltip
                foreach (GridColumn column in gridRateAnalysis.MasterTableView.RenderColumns)
                {
                    if (column is GridBoundColumn)
                    {
                        if (column.UniqueName == &quot;VariablePrice&quot;)
                        {
                            item[column.UniqueName].ToolTip = item[column.UniqueName].Text + &quot; $/&quot; + item[&quot;Unit&quot;].Text;
                        }
                        else if (column.UniqueName == &quot;Quantity&quot;)
                        {
                            item[column.UniqueName].ToolTip = item[column.UniqueName].Text + &quot; &quot; + item[&quot;Unit&quot;].Text;
                        }
                    }
                }

                item[&quot;TotalQty&quot;].Text = (item[&quot;Quantity&quot;].Text.ToDecimal2() * (1 + ((item[&quot;WastagePercent&quot;] != null) ? item[&quot;WastagePercent&quot;].Text.ToDecimal2() : 0) / 100)).ToString2();

                int resourceId = 0;
                if (item[&quot;ResourceDetailID&quot;] != null &amp;&amp; int.TryParse(item[&quot;ResourceDetailID&quot;].Text, out resourceId))
                {
                    Resource resourceDTO = ItemManager.Instance.GetRateAnalysis(resourceId);
                    Item itemDTO = ItemManager.Instance.GetItemDetails(ModuleID, ParentInstanceID, ItemID);
                    if (parentItemModel != null &amp;&amp;
                        !parentItemModel.ValidateRateAnalysisForGridEdit(itemDTO, resourceDTO))
                    {
                        var nonEditableColumns = new List&lt;string&gt;((&quot;IsCritical&quot;).Split(&#39;,&#39;));
                        foreach (string column in nonEditableColumns)
                            if (item[column] != null)
                            {
                                TextBox tbRO = (TextBox)item[column].Controls[0];
                                tbRO.ReadOnly = true;
                            }
                    }
                }
            }
        }

        protected virtual void HideColumns()
        {
            Telerik.Web.UI.GridTableView grid = gridRateAnalysis.MasterTableView;

            if (parentItemModel != null &amp;&amp; parentItemModel.DisplayRateAnalysisSection)
            {
                grid.GetColumnSafe(&quot;IsCritical&quot;).Visible = false;
                grid.GetColumnSafe(&quot;Notes&quot;).Visible = false;
                grid.GetColumnSafe(&quot;Size&quot;).Visible = false;
                grid.GetColumnSafe(&quot;Color&quot;).Visible = false;
                grid.GetColumnSafe(&quot;Configuration&quot;).Visible = false;

                grid.GetColumnSafe(&quot;WasteInitialQty&quot;).Display = false;
                grid.GetColumnSafe(&quot;TotalQty&quot;).Display = false;
                grid.GetColumnSafe(&quot;WastagePercent&quot;).Display = false;
                grid.GetColumnSafe(&quot;WastageQty&quot;).Display = false;
                grid.GetColumnSafe(&quot;WasteAmt&quot;).Display = false;

                if (ModuleID == &quot;LIBRARY&quot;)
                {
                    grid.GetColumnSafe(&quot;Quantity&quot;).Display = false;
                    grid.GetColumnSafe(&quot;Cost&quot;).Display = false;
                    grid.GetColumnSafe(&quot;UtilizationPercentage&quot;).Display = false;
                    grid.GetColumnSafe(&quot;Count&quot;).Display = false;
                }
                else if (ModuleID.IsEqualToAny(&quot;BDGTEST&quot;, &quot;CONTMGT&quot;, &quot;ESTMATE&quot;, &quot;BDGTREV&quot;))
                {
                    grid.GetColumnSafe(&quot;UtilizationPercentage&quot;).Display = false;
                }
            }

            if (ModuleID == &quot;ITMPOST&quot;)
            {
                grid.GetColumnSafe(&quot;WastageQty&quot;).Display = true;
                grid.GetColumnSafe(&quot;ReworkQty&quot;).Display = true;
                grid.GetColumnSafe(&quot;RegularQty&quot;).Display = true;
            }

            if (!IsERPConnected)
            {
                grid.GetColumnSafe(&quot;TradeAgmtCurrency&quot;).Visible = false;
                grid.GetColumnSafe(&quot;Contractor&quot;).Visible = false;
            }
        }

        private void FormatRateAnalysisGrid()
        {
            Telerik.Web.UI.GridTableView grid = gridRateAnalysis.MasterTableView;

            int decimalDigits_UnitPrice = CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE);
            int decimalDigits_Quantity = CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY);
            int decimalDigits_Amount = CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT);

            #region Rate

            GridColumn rateColumn = grid.GetColumnSafe(&quot;Rate&quot;);
            if (rateColumn != null)
            {
                rateColumn.HeaderText = &quot;Fixed Price in &quot; + LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL);
                GridNumericColumn rate_GridNumericColumn = rateColumn as GridNumericColumn;
                if (rate_GridNumericColumn != null)
                {
                    rate_GridNumericColumn.AllowRounding = true;
                    rate_GridNumericColumn.DecimalDigits = decimalDigits_UnitPrice;
                    rate_GridNumericColumn.DataFormatString = &quot;{0:N&quot; + decimalDigits_UnitPrice + &quot;}&quot;;
                }
            }

            #endregion Rate

            #region Quantity

            GridColumn qty_GridColumn = grid.GetColumnSafe(&quot;Quantity&quot;);
            if (qty_GridColumn != null)
            {
                if (ModuleID == &quot;ITMPOST&quot;)
                    qty_GridColumn.HeaderText = &quot;Total Qty&quot;;

                GridNumericColumn qty_GridNumericColumn = qty_GridColumn as GridNumericColumn;
                if (qty_GridNumericColumn != null)
                {
                    qty_GridNumericColumn.AllowRounding = true;
                    qty_GridNumericColumn.DecimalDigits = decimalDigits_Quantity;
                    qty_GridNumericColumn.DataFormatString = &quot;{0:N&quot; + decimalDigits_Quantity + &quot;}&quot;;
                    qty_GridNumericColumn.MinValue = 0;
                }
            }

            #endregion Quantity

            #region Variable Price

            GridColumn variablePrice_GridColumn = grid.GetColumnSafe(&quot;VariablePrice&quot;);
            if (variablePrice_GridColumn != null)
            {
                variablePrice_GridColumn.HeaderText = &quot;Variable Price in &quot; + LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) + &quot;/Unit&quot;;
                GridNumericColumn variablePrice_GridNumericColumn = variablePrice_GridColumn as GridNumericColumn;
                if (variablePrice_GridNumericColumn != null)
                {
                    variablePrice_GridNumericColumn.AllowRounding = true;
                    variablePrice_GridNumericColumn.DecimalDigits = decimalDigits_Amount;
                    variablePrice_GridNumericColumn.DataFormatString = &quot;{0:N&quot; + decimalDigits_Amount + &quot;}&quot;;
                }
            }

            #endregion Variable Price

            #region UtilizationPercentage

            GridColumn utilization_GridColumn = grid.GetColumnSafe(&quot;UtilizationPercentage&quot;);
            if (utilization_GridColumn != null)
            {
                GridNumericColumn utilization_GridNumericColumn = utilization_GridColumn as GridNumericColumn;
                if (utilization_GridNumericColumn != null)
                {
                    utilization_GridNumericColumn.AllowRounding = true;
                    utilization_GridNumericColumn.DecimalDigits = 2;
                    utilization_GridNumericColumn.DataFormatString = &quot;{0:N&quot; + &quot;2&quot; + &quot;}&quot;;
                    utilization_GridNumericColumn.MaxValue = 100;
                }
            }

            #endregion UtilizationPercentage

            #region Count

            GridColumn count_GridColumn = grid.GetColumnSafe(&quot;Count&quot;);
            if (count_GridColumn != null)
            {
                GridNumericColumn count_GridNumericColumn = count_GridColumn as GridNumericColumn;
                if (count_GridNumericColumn != null)
                {
                    count_GridNumericColumn.AllowRounding = true;
                    count_GridNumericColumn.DecimalDigits = 0;
                    count_GridNumericColumn.DataFormatString = &quot;{0:N0}&quot;; // Integer
                    count_GridNumericColumn.MinValue = 1;
                }
            }

            #endregion Count

            #region Cost

            GridColumn cost_GridColumn = grid.GetColumnSafe(&quot;Cost&quot;);
            if (cost_GridColumn != null)
            {
                cost_GridColumn.HeaderText = &quot;Amount in &quot; + LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL);
                GridNumericColumn cost_GridNumericColumn = cost_GridColumn as GridNumericColumn;
                if (cost_GridNumericColumn != null)
                {
                    cost_GridNumericColumn.AllowRounding = true;
                    cost_GridNumericColumn.DecimalDigits = decimalDigits_Amount;
                    cost_GridNumericColumn.DataFormatString = &quot;{0:N&quot; + decimalDigits_Amount + &quot;}&quot;;
                }
            }

            #endregion Cost

            RateAnalysisForm.Style.Value = &quot;display:none&quot;;

            #region  Unused Code

            if (grid.GetColumnSafe(&quot;WasteAmt&quot;) != null &amp;&amp; grid.GetColumnSafe(&quot;WasteAmt&quot;).Display)
            {
                grid.GetColumnSafe(&quot;WasteAmt&quot;).HeaderText = &quot;Waste Amount in &quot; + LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL);
                (grid.GetColumnSafe(&quot;WasteAmt&quot;) as Telerik.Web.UI.GridNumericColumn).DataFormatString = &quot;{0:N&quot; + decimalDigits_Amount + &quot;}&quot;;
            }

            if (grid.GetColumnSafe(&quot;TotalQty&quot;) != null &amp;&amp; grid.GetColumnSafe(&quot;TotalQty&quot;).Display)
            {
                (grid.GetColumnSafe(&quot;TotalQty&quot;) as Telerik.Web.UI.GridNumericColumn).DataFormatString = &quot;{0:N&quot; + decimalDigits_Quantity + &quot;}&quot;;
            }
            if (grid.GetColumnSafe(&quot;WasteInitialQty&quot;) != null &amp;&amp; grid.GetColumnSafe(&quot;WasteInitialQty&quot;).Display)
            {
                (grid.GetColumnSafe(&quot;WasteInitialQty&quot;) as Telerik.Web.UI.GridNumericColumn).DataFormatString = &quot;{0:N&quot; + decimalDigits_Quantity + &quot;}&quot;;
            }
            if (grid.GetColumnSafe(&quot;WastageQty&quot;) != null &amp;&amp; grid.GetColumnSafe(&quot;WastageQty&quot;).Display)
            {
                (grid.GetColumnSafe(&quot;WastageQty&quot;) as Telerik.Web.UI.GridNumericColumn).DataFormatString = &quot;{0:N&quot; + decimalDigits_Quantity + &quot;}&quot;;
            }
            if (grid.GetColumnSafe(&quot;ReworkQty&quot;) != null &amp;&amp; grid.GetColumnSafe(&quot;ReworkQty&quot;).Display)
            {
                (grid.GetColumnSafe(&quot;ReworkQty&quot;) as Telerik.Web.UI.GridNumericColumn).DataFormatString = &quot;{0:N&quot; + decimalDigits_Quantity + &quot;}&quot;;
            }
            if (grid.GetColumnSafe(&quot;RegularQty&quot;) != null &amp;&amp; grid.GetColumnSafe(&quot;RegularQty&quot;).Display)
            {
                (grid.GetColumnSafe(&quot;RegularQty&quot;) as Telerik.Web.UI.GridNumericColumn).DataFormatString = &quot;{0:N&quot; + decimalDigits_Quantity + &quot;}&quot;;
            }

            #endregion

            grid.Rebind();
        }

        private void AddFooter(string column, string format)
        {
            gridRateAnalysis.ShowFooter = ShowMarginInfo.Yes.ToBoolean2();
            var item = gridRateAnalysis.MasterTableView.GetItems(Telerik.Web.UI.GridItemType.Footer)[0];
            if (item != null)
            {
                Telerik.Web.UI.GridFooterItem footer = item as Telerik.Web.UI.GridFooterItem;
                if (footer[column] != null)
                {
                    footer[column].Text = Convert.ToDecimal(hdnResourceTotal.Value, CultureInfo.CurrentCulture).ToString(
                             AMP3ApplicationSettings.Instance.FORMAT_QUANTITY, CultureInfo.CurrentCulture);
                    gridRateAnalysis.MasterTableView.GetColumnSafe(column).ItemStyle.HorizontalAlign = HorizontalAlign.Right;
                    gridRateAnalysis.MasterTableView.GetColumnSafe(column).HeaderStyle.HorizontalAlign = HorizontalAlign.Right;
                    gridRateAnalysis.MasterTableView.GetColumnSafe(column).FooterStyle.HorizontalAlign = HorizontalAlign.Right;
                }
            }
        }

        protected void BindRateAnalysis1(string moduleID, int parentInstanceID, int itemID)
        {
            //Item itemDTO;
            //itemDTO = ItemManager.Instance.GetItemDetails(ModuleID, ParentInstanceID, ItemID);

            //lblstditemnnovalue.Text = itemDTO.StandardItemNo;

            var CurrencyFormat = new NumberFormatInfo();
            hdnContractCurrency.Value =
                CurrencyFormat.CurrencySymbol = LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL);

            DataSet ds = ItemManager.Instance.GetRateAnalysis(moduleID, parentInstanceID, itemID);
            ds.Tables[1].Columns.Add(&quot;TotalQty&quot;, typeof(decimal));
            ds.Tables[1].AcceptChanges();

            if (IsStdItemSelected)
            {
                // Nullify library record IDs. To save for current item.
                foreach (DataRow row in ds.Tables[1].Rows)
                {
                    row[&quot;ResourceDetailID&quot;] = 0;
                    row[&quot;Cost&quot;] = row[&quot;Rate&quot;];
                    row[&quot;Quantity&quot;] = 0;
                }

                hdnResource.Value = ds.Tables[1].DataTableToJSON(); // Client event &#39;gridRateAnalysis_GridCreated&#39; will bind data to grid using hdnResource.
                hdnDeleteExistingResources.Value = &quot;Y&quot;;

                DataTable emptyTable = new DataTable();
                emptyTable = ds.Tables[1].Clone(); // Copies only structure not the data. It will have only columns.
                gridRateAnalysis.DataSource = emptyTable;
            }
            else
            {
                gridRateAnalysis.DataSource = ds.Tables[1].ToMWDateTime().DefaultView;
            }

            gridRateAnalysis.DataBind();

            decimal sum = 0;
            foreach (DataRow row in ds.Tables[1].Rows)
            {
                sum += row[&quot;Cost&quot;].ToDecimal2();
            }

            hdnResourceTotal.Value = sum.ToString();

            //Add Footer for grid

            //Hide Columns in RateAnalysic Grid
            HideColumns();

            //Customize Columns in RateAnalysic Grid
            FormatRateAnalysisGrid();

            AddFooter(&quot;Cost&quot;, AMP3ApplicationSettings.Instance.FORMAT_AMOUNT);

            //Don&#39;t know what this is
            ShowOverheads(isOverheadsShown);
            if (isOverheadsShown)
            {
                DataTable dtOverheads = ItemManager.Instance.GetOverheadRateAnalysis(moduleID, parentInstanceID, itemID);
                uwgOverheads.DataSource = dtOverheads.ToMWDateTime();
                uwgOverheads.DataBind();

                FormatOverheadsGrid();
            }
            //

            //ColumnsCollection cols = gridRateAnalysis.Columns;

            // MAKE ALL THE COLUMNS EDITABLE  (BASED ON AX CONNECTION STATUS)
            /*foreach (UltraGridColumn ugc in cols)
            {
                if (ugc.Key != &quot;ResourceTypeName&quot; &amp;&amp; ugc.Key != &quot;Cost&quot; &amp;&amp; ugc.Key != &quot;WasteInitialQty&quot; &amp;&amp;
                    ugc.Key != &quot;WasteAmt&quot;
                    &amp;&amp; ugc.Key != &quot;TradeAgmtCurrency&quot; &amp;&amp; ugc.Key != &quot;Contractor&quot;
                    &amp;&amp; ugc.Key != &quot;Size&quot; &amp;&amp; ugc.Key != &quot;Color&quot; &amp;&amp; ugc.Key != &quot;Configuration&quot; &amp;&amp;
                    ugc.Key != &quot;TradeAgmtCurrency&quot;)
                    ugc.AllowUpdate = AllowUpdate.Yes;
                if (!IsERPConnected &amp;&amp; (ugc.Key == &quot;TradeAgmtCurrency&quot; || ugc.Key == &quot;Contractor&quot;))
                    ugc.Hidden = true;
            }

            //Legacy code not in use but not allowed to delete
            /* To bind Units from Dynamics AX - ds.Tables[3] replaced by AX Units */
            if (IsERPConnected)
            {
                string result = &quot;&quot;;
                //ALL UNITS FROM AX
                DataTable dtUnit = BindAXUnits();
                if (dtUnit != null)
                {
                    for (int i = 0; i &lt; dtUnit.Rows.Count; i++)
                    {
                        string unit = dtUnit.Rows[i][&quot;Unit&quot;].ToString2();
                        int unitId = Convert.ToInt32(dtUnit.Rows[i][&quot;Id&quot;].ToString2(), CultureInfo.CurrentCulture);
                        result += unit + &quot;;&quot;;
                        result += unitId + &quot;|&quot;;
                    }
                    result = result.Trim(&quot;|&quot;.ToCharArray());
                    hdnAllUnits.Value = result;
                }
                //TODO : Remove Indexing
                ds.Tables[3].Rows.Clear();
                ds.Tables[3].Columns.Clear();
                ds.Tables[3].Merge(dtUnit);
                //CONVERTIBLE UNITS FROM AZ
                result = &quot;&quot;;
                DataTable dtConvertibleUnits = GetAXConvertibleUnits(null);
                if (dtUnit != null)
                {
                    for (int i = 0; i &lt; dtConvertibleUnits.Rows.Count; i++)
                    {
                        string unit = dtConvertibleUnits.Rows[i][&quot;FromUnit&quot;].ToString2();
                        string convertibleUnit = dtConvertibleUnits.Rows[i][&quot;ToUnit&quot;].ToString2();
                        result += unit + &quot;;&quot;;
                        result += convertibleUnit + &quot;|&quot;;
                    }
                    result = result.Trim(&quot;|&quot;.ToCharArray());
                    hdnConvertibleUnits.Value = result;
                }
            }
            else
            {
                //Store the Units from Library in a hidden field if its not connected to AX.
                string result = string.Empty;
                DataTable dtUnit = ds.Tables[3];
                if (dtUnit != null)
                {
                    for (int i = 0; i &lt; dtUnit.Rows.Count; i++)
                    {
                        string unit = dtUnit.Rows[i][&quot;Unit&quot;].ToString2();
                        int unitId = Convert.ToInt32(dtUnit.Rows[i][&quot;UnitID&quot;].ToString2(), CultureInfo.CurrentCulture);
                        result += unit + &quot;;&quot;;
                        result += unitId + &quot;|&quot;;
                    }
                    result = result.Trim(&quot;|&quot;.ToCharArray());
                    hdnAllUnits.Value = result;
                }
            }

            DataTable dtInMWDateTime = ds.Tables[3].ToMWDateTime();
            ddlRateAnalysisUnitID.DataSource = dtInMWDateTime;
            ddlRateAnalysisUnitID.DataTextField = &quot;Unit&quot;;
            ddlRateAnalysisUnitID.DataValueField = &quot;UnitID&quot;;

            // BIND THE WEB COMBO FOR UNITS HERE
            valListUnit.DataSource = dtInMWDateTime;
            valListUnit.DisplayMember = &quot;Unit&quot;;
            valListUnit.ValueMember = &quot;Unit&quot;;
            valListUnit.DataBind();

            DisableButton(true);
            ddlRateAnalysisUnitID.DataBind();

            CurrencyFormat.NumberDecimalDigits =
                CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE);
            RateAnalysisCost.MinDecimalPlaces = MinDecimalPlaces.SameAsDecimalPlaces;
            RateAnalysisCost.NumberFormat = CurrencyFormat;
            switch (CurrencyFormat.NumberDecimalDigits)
            {
                case 0:
                    RateAnalysisRate.MinDecimalPlaces = MinDecimalPlaces.None;
                    break;

                case -1:
                    RateAnalysisRate.MinDecimalPlaces = MinDecimalPlaces.SameAsDecimalPlaces;
                    break;

                case 1:
                    RateAnalysisRate.MinDecimalPlaces = MinDecimalPlaces.One;
                    break;

                case 2:
                    RateAnalysisRate.MinDecimalPlaces = MinDecimalPlaces.Two;
                    break;

                case 3:
                    RateAnalysisRate.MinDecimalPlaces = MinDecimalPlaces.Three;
                    break;

                case 4:
                    RateAnalysisRate.MinDecimalPlaces = MinDecimalPlaces.Four;
                    break;
            }
            RateAnalysisRate.NumberFormat = CurrencyFormat;

            CurrencyFormat.NumberDecimalDigits =
                CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY);
            var CurrencyFormatQty = new NumberFormatInfo();
            CurrencyFormatQty.NumberDecimalDigits =
                CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY);

            switch (CurrencyFormatQty.NumberDecimalDigits)
            {
                case -1:
                    RateAnalysisQuantity.MinDecimalPlaces =
                        wneWastagePercent.MinDecimalPlaces = MinDecimalPlaces.SameAsDecimalPlaces;
                    break;

                case 0:
                    RateAnalysisQuantity.MinDecimalPlaces =
                        wneWastagePercent.MinDecimalPlaces = MinDecimalPlaces.None;
                    break;

                case 1:
                    RateAnalysisQuantity.MinDecimalPlaces =
                        wneWastagePercent.MinDecimalPlaces = MinDecimalPlaces.One;
                    break;

                case 2:
                    RateAnalysisQuantity.MinDecimalPlaces =
                        wneWastagePercent.MinDecimalPlaces = MinDecimalPlaces.Two;
                    break;

                case 3:
                    RateAnalysisQuantity.MinDecimalPlaces =
                        wneWastagePercent.MinDecimalPlaces = MinDecimalPlaces.Three;
                    break;

                case 4:
                    RateAnalysisQuantity.MinDecimalPlaces =
                        wneWastagePercent.MinDecimalPlaces = MinDecimalPlaces.Four;
                    break;
            }
            RateAnalysisQuantity.NumberFormat = CurrencyFormat;

            SetResourceCountDetails();
        }

        private void ShowOverheads(bool isVisible)
        {
            trOverheadsGrid.Style.Clear();
            trOverheadLabels.Style.Clear();

            trOverheadsGrid.Style.Add(&quot;display&quot;, isVisible ? &quot;table-row&quot; : &quot;none&quot;);
            trOverheadLabels.Style.Add(&quot;display&quot;, isVisible ? &quot;table-row&quot; : &quot;none&quot;);
        }

        private void FormatOverheadsGrid()
        {
            // to fix XSS attack
            foreach (UltraGridColumn col in uwgOverheads.Columns)
            {
                col.HTMLEncodeContent = true;
            }

            ColumnsCollection cols = uwgOverheads.Columns;

            if (cols.FromKey(&quot;Rate&quot;) != null)
            {
                cols.FromKey(&quot;Rate&quot;).Header.Caption = &quot;Rate in &quot; +
                                                      LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL);
                cols.FromKey(&quot;Rate&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;
                cols.FromKey(&quot;Rate&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;Rate&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
            }
            if (cols.FromKey(&quot;Cost&quot;) != null)
            {
                cols.FromKey(&quot;Cost&quot;).Header.Caption = &quot;Cost in &quot; +
                                                      LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL);
                cols.FromKey(&quot;Cost&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                cols.FromKey(&quot;Cost&quot;).Footer.Total = SummaryInfo.Sum;
                cols.FromKey(&quot;Cost&quot;).Footer.Style.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;Cost&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;Cost&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
            }
            if (cols.FromKey(&quot;Quantity&quot;) != null)
            {
                cols.FromKey(&quot;Quantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                cols.FromKey(&quot;Quantity&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;Quantity&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
            }
            cols.FromKey(&quot;ResourceTypeName&quot;).Header.Caption = &quot;Resource Type&quot;;

            uwgOverheads.DisplayLayout.RowSelectorsDefault = RowSelectors.No;
            uwgOverheads.DisplayLayout.ColFootersVisibleDefault = ShowMarginInfo.Yes;

            if (cols.FromKey(&quot;ModuleID&quot;) != null) cols.FromKey(&quot;ModuleID&quot;).Hidden = true;
            if (cols.FromKey(&quot;ParentInstanceID&quot;) != null) cols.FromKey(&quot;ParentInstanceID&quot;).Hidden = true;
            cols.FromKey(&quot;ResourceDetailID&quot;).Hidden = true;
            cols.FromKey(&quot;ItemID&quot;).Hidden = true;
            cols.FromKey(&quot;ResourceTypeID&quot;).Hidden = true;
            cols.FromKey(&quot;ResItemID&quot;).Hidden = false;
            cols.FromKey(&quot;ResItemID&quot;).Header.Caption = &quot;Resource ID&quot;;
        }

        private void RemoveResourceTypes(DataTable dataTable, string[] resourceTypes)
        {
            foreach (string resourceType in resourceTypes)
            {
                HideCounter(resourceType);
                DataRow[] invalidRows = dataTable.Select(&quot;ResourceTypeName = &#39;&quot; + resourceType + &quot;&#39;&quot;);
                foreach (DataRow invalidRow in invalidRows)
                    dataTable.Rows.Remove(invalidRow);
            }
        }

        private void HideCounter(string resourceType)
        {
            switch (resourceType)
            {
                case &quot;Equipment&quot;:
                    lblEquipment.Style.Value = &quot;display:none&quot;;
                    lblEquipmentCount.Style.Value = &quot;display:none&quot;;
                    break;

                case &quot;Personnel&quot;:
                    lblManPower.Style.Value = &quot;display:none&quot;;
                    lblManPowerCount.Style.Value = &quot;display:none&quot;;
                    break;

                case &quot;Material&quot;:
                    lblMaterial.Style.Value = &quot;display:none&quot;;
                    lblMaterialCount.Style.Value = &quot;display:none&quot;;
                    break;

                case &quot;Miscellaneous&quot;:
                    lblMisc.Style.Value = &quot;display:none&quot;;
                    lblMiscCount.Style.Value = &quot;display:none&quot;;
                    break;

                case &quot;Overhead&quot;:
                    lblOverhead.Style.Value = &quot;display:none&quot;;
                    lblOverheadCount.Style.Value = &quot;display:none&quot;;
                    break;

                case &quot;SubContract&quot;:
                    lblSubContract.Style.Value = &quot;display:none&quot;;
                    lblSubContractCount.Style.Value = &quot;display:none&quot;;
                    break;
            }
        }

        protected void ClearInsertForm()
        {
            RateAnalysisDescription.Text = &quot;&quot;;
            RateAnalysisRate.ValueDecimal = 0;
            RateAnalysisQuantity.ValueDecimal = 0;
            RateAnalysisCost.ValueDecimal = 0;
            RateAnalysisNotes.Text = &quot;&quot;;
            txtResItemID.Text = &quot;&quot;;
            ddlRateAnalysisResource.SelectedIndex = 0;
            txtResorceItemID.Text = &quot;&quot;;
            hdnUnit.Value = &quot;&quot;;
            hdnUnitID.Value = &quot;&quot;;
            hdnMode.Value = &quot;&quot;;
        }

        private void MakeReadOnly(bool value)
        {
            btnAddRateAnalysis.Visible = !value;
            BtnEditRateAnalysis.Visible = !value;
            btnDeleteRateAnalysis.Visible = !value;
            ddlRateAnalysisResource.Visible = !value;
            btnResourcePicker.Visible = !value;
            btnResourceDelete.Visible = !value;
            txtResorceItemID.ReadOnly = value;
            //btnInventoryDimensions.Visible = !value;
            btnTradeAgreement.Visible = !value;
            //ddlAXItemGroups.Visible = !value;
        }

        private void DisableButton(bool value)
        {
            btnAddRateAnalysis.Attributes.Add(&quot;onclick&quot;, &quot;ShowAddResourceBox(); return false;&quot;);
            if (parentItemModel != null &amp;&amp; !parentItemModel.DisplayRateAnalysisSection)
            {
                if (MainToolBar.GetMenuReference(&quot;lnkAddMiscellaneous&quot;) != null)
                {
                    MainToolBar.GetMenuReference(&quot;lnkAddMiscellaneous&quot;).CausesValidation = true;
                    MainToolBar.GetMenuReference(&quot;lnkAddMiscellaneous&quot;).ValidationGroup = &quot;Master&quot;;
                }
                if (MainToolBar.GetMenuReference(&quot;lnkDelete&quot;) != null)
                    MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).OnClientClick = &quot;return DeleteRateAnalysis();&quot;;
            }
            BtnEditRateAnalysis.OnClientClick = &quot;return ShowRAEditForm();&quot;;

            //if (btnAddRateAnalysis != null)
            //    btnAddRateAnalysis.Visible = value;
            //if (btnDeleteRateAnalysis != null)
            //    btnDeleteRateAnalysis.Visible = value;

            //if (btnResourcePicker != null)
            //    btnResourcePicker.Enabled = value;
            //if (ddlRateAnalysisResource != null)
            //    ddlRateAnalysisResource.Enabled = value;
            //if (btnBack != null)
            //    btnBack.Visible = value;

            //if (btnTradeAgreement != null)
            //    btnTradeAgreement.Visible = value;
        }

        public void LoadItem(string moduleID, int parentInstanceID, int itemID)
        {
            if (!IsStdItemSelected)
            {
                hdnModuleID.Value = moduleID;
                hdnParentInstanceID.Value = parentInstanceID.ToString2();
                ItemID4RateAnalysis.Text = itemID.ToString2();

                if (parentItemModel != null &amp;&amp; ParentItemModel.DisplayRateAnalysisSection &amp;&amp; ItemID4RateAnalysis.Text == &quot;0&quot;)
                    ItemID4RateAnalysis.Text = &quot;-4&quot;;
            }

            DataTable dtResourceTypes = ItemManager.Instance.GetResourceTypes();

            foreach (DataRow dr in dtResourceTypes.Rows)
            {
                if (
                        dr[&quot;ResourceTypeName&quot;].ToString2().IsEqualToAny(&quot;SpareParts&quot;, &quot;Miscellaneous&quot;, &quot;Overhead&quot;, &quot;SubContract&quot;)
                        || (
                                dr[&quot;ResourceTypeName&quot;].ToString2().IsEqualToAny(&quot;Personnel&quot;, &quot;Equipment&quot;)
                                &amp;&amp; Request[&quot;DWRID&quot;] != null
                           )
                    )
                {
                    dr.Delete();
                }
            }

            DataRow drType = dtResourceTypes.NewRow();
            drType[0] = -1;
            drType[1] = &quot;Select Resource Type&quot;;
            dtResourceTypes.Rows.InsertAt(drType, 0);
            dtResourceTypes.AcceptChanges();
            UIHelper.BindDropDownData(ddlRateAnalysisResource, dtResourceTypes, &quot;ResourceTypeName&quot;, &quot;ResourceTypeID&quot;, true);

            //Some legacy code whcih is not in use but not allowed to be deleted
            BindAXItemGroups();
            BindAXFixedAssetGroups();
            //

            if (ddlIsCritical.Items.FindByValue(&quot;false&quot;) == null)
                ddlIsCritical.Items.Add(new ListItem(&quot;No&quot;, &quot;false&quot;));

            if (ddlIsCritical.Items.FindByValue(&quot;true&quot;) == null)
                ddlIsCritical.Items.Add(new ListItem(&quot;Yes&quot;, &quot;true&quot;));

            //UIHelper.SetGridLayout(gridRateAnalysis);

            // gridRateAnalysis.DisplayLayout.ViewType = ViewType.OutlookGroupBy;

            //gridRateAnalysis.DisplayLayout.RowSelectorsDefault = RowSelectors.No;
            //gridRateAnalysis.DisplayLayout.ColFootersVisibleDefault = ShowMarginInfo.Yes;

            if (!IsStdItemSelected)
            {
                if (!string.IsNullOrEmpty(ItemID4RateAnalysis.Text))
                    BindRateAnalysis1(moduleID, parentInstanceID, Convert.ToInt32(ItemID4RateAnalysis.Text, CultureInfo.CurrentCulture));
            }
            else
            {
                BindRateAnalysis1(moduleID, parentInstanceID, itemID);
            }

            SetResourceCountDetails();
        }

        public void LoadItem(int itemID)
        {
            LoadItem(ModuleID, ParentInstanceID, itemID);
        }

        public void BindUnits(DataTable dataTable, string textFieldColumn, string valueFieldColumn)
        {
            if (ddlRateAnalysisUnitID != null)
                UIHelper.BindDropDownData(ddlRateAnalysisUnitID, dataTable, textFieldColumn, valueFieldColumn, true);
            dtTempunit = dataTable;
        }

        #region LEGACY CODE NOT IN USE

        private DataTable BindAXUnits()
        {
            int count = 0;
            DataSet dsUnits = new BrixDataSet();
            var dtUnits = new DataTable();
            if (
                IntegrationConnectorManager.HandleIntegration(
                    GetConnectorParameters(MethodBase.GetCurrentMethod(), null), ref count, ref dsUnits, true))
            {
                dtUnits = dsUnits.Tables[1];
            }
            return dtUnits;
        }

        public void BindAXInventoryDimensionsData(string resItemId)
        {
            string itemID = &quot;&lt;XMLRoot&gt;&lt;ItemId type =&#39;txt&#39;&gt;&quot; + resItemId + &quot;&lt;/ItemId&gt;&lt;/XMLRoot&gt;&quot;;
            DataSet ds = new BrixDataSet();
            int count = 0;
            if (
                IntegrationConnectorManager.HandleIntegration(
                    GetConnectorParameters(MethodBase.GetCurrentMethod(), itemID), ref count, ref ds, true))
            {
                if (ds.Tables.Count &gt; 3)
                {
                    UIHelper.BindDropDownData(valListAXSize, ds.Tables[0], &quot;InventSizeId&quot;, &quot;InventSizeId&quot;);
                    //igcmboAXSize.Columns[0].Header.Caption = &quot;Size&quot;;
                    UIHelper.BindDropDownData(valListAXColor, ds.Tables[1], &quot;InventColorId&quot;, &quot;InventColorId&quot;);
                    //igcmboAXColor.Columns[0].Header.Caption = &quot;Color&quot;;
                    UIHelper.BindDropDownData(valListAXConfig, ds.Tables[2], &quot;ConfigId&quot;, &quot;ConfigId&quot;);
                    //igcmboAXConfig.Columns[0].Header.Caption = &quot;Configuration&quot;;
                }
            }
        }

        private void BindAXConvertibleUnits(string unit)
        {
            string itemID = &quot;&lt;XMLRoot&gt;&lt;FromUnit type =&#39;txt&#39;&gt;&quot; + unit + &quot;&lt;/FromUnit&gt;&lt;/XMLRoot&gt;&quot;;
            DataSet ds = new BrixDataSet();
            int count = 0;
            if (
                IntegrationConnectorManager.HandleIntegration(
                    GetConnectorParameters(MethodBase.GetCurrentMethod(), null), ref count, ref ds, true))
            {
                if (ds.Tables.Count &gt; 2)
                {
                    UIHelper.BindDropDownData(valListUnit, ds.Tables[2], &quot;Unit&quot;, &quot;Unit&quot;);
                }
            }
        }

        private DataTable GetAXConvertibleUnits(string unit)
        {
            //string itemID = &quot;&lt;XMLRoot&gt;&lt;FromUnit type =&#39;txt&#39;&gt;&quot; + unit + &quot;&lt;/FromUnit&gt;&lt;/XMLRoot&gt;&quot;;
            DataSet ds = new BrixDataSet();
            int count = 0;
            if (
                IntegrationConnectorManager.HandleIntegration(
                    GetConnectorParameters(MethodBase.GetCurrentMethod(), null), ref count, ref ds, true))
            {
                if (ds.Tables.Count &gt; 1)
                    return ds.Tables[1];
            }
            return new DataTable();
        }

        private void BindAXItemGroups()
        {
            DataSet ds = new BrixDataSet();
            int count = 0;
            if (
                IntegrationConnectorManager.HandleIntegration(
                    GetConnectorParameters(MethodBase.GetCurrentMethod(), null), ref count, ref ds, true))
            {
                if (ds.Tables.Count &gt; 1)
                {
                    DataTable dtItemGroups = ds.Tables[1];
                    DataRow drGroup = dtItemGroups.NewRow();
                    drGroup[0] = &quot;All&quot;;
                    drGroup[1] = &quot;All&quot;;
                    dtItemGroups.Rows.InsertAt(drGroup, 0);
                    dtItemGroups.AcceptChanges();
                    string data = &quot;&quot;;
                    foreach (DataRow dr in dtItemGroups.Rows)
                    {
                        data += dr[&quot;Resource Group&quot;].ToString2() + &quot;;&quot;;
                        data += dr[&quot;Resource Group&quot;].ToString2() + &quot;|&quot;;
                    }
                    data = data.Trim(&quot;|&quot;.ToCharArray());
                    hdnItemGroups.Value = data;
                    // UIHelper.BindDropDownData(ddlAXItemGroups, ds.Tables[1], &quot;Resource Group&quot;, &quot;Resource Group&quot;);
                }
            }
        }

        protected void BindAXFixedAssetGroups()
        {
            DataSet ds = new BrixDataSet();
            int count = 0;
            if (
                IntegrationConnectorManager.HandleIntegration(
                    GetConnectorParameters(MethodBase.GetCurrentMethod(), null), ref count, ref ds, true))
            {
                if (ds.Tables.Count &gt; 0)
                {
                    DataTable dtItemGroups = ds.Tables[1];
                    DataRow drGroup = dtItemGroups.NewRow();
                    drGroup[0] = &quot;All&quot;;
                    drGroup[1] = &quot;All&quot;;
                    dtItemGroups.Rows.InsertAt(drGroup, 0);
                    dtItemGroups.AcceptChanges();
                    string data = &quot;&quot;;
                    foreach (DataRow dr in dtItemGroups.Rows)
                    {
                        data += dr[&quot;GroupId&quot;].ToString2() + &quot;;&quot;;
                        data += dr[&quot;GroupId&quot;].ToString2() + &quot;|&quot;;
                    }
                    data = data.Trim(&quot;|&quot;.ToCharArray());
                    hdnEquipmentGroups.Value = data;
                    //  UIHelper.BindDropDownData(ddlAXItemGroups, ds.Tables[1], &quot;GroupId&quot;, &quot;GroupId&quot;);
                }
            }
        }

        private ConnectorParameters GetConnectorParameters(MethodBase methodInfo, string filter)
        {
            var additionalInfo = new EISAdditionalInfo(RegisteredEIS.AX);
            additionalInfo.AddInfo(Constants.EIS_ADDITIONAL_INFO, Session[&quot;AXCompany&quot;].ToString2());
            var dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
            dictAdditionalInfo.Add(RegisteredEIS.AX, additionalInfo);
            var connectorParameters =
                new ConnectorParameters(dictAdditionalInfo, methodInfo, AMP3ObjectType.Unknown,
                    new ConnectionFilter(filter, null, null, null, null), null);
            return connectorParameters;
        }

        private void RegisterCallBackScript()
        {
            var sb = new StringBuilder();
            sb.Append(&quot;&lt;script language=\&quot;javascript\&quot; type=\&quot;text/javascript\&quot;&gt;&quot;);
            sb.Append(&quot;function SendMIssueRequest(arguments,context){&quot;);
            sb.Append(&quot;try{ ShowLoadingOnRequest(); }catch(ex){ }&quot;);
            sb.Append(Page.ClientScript.GetCallbackEventReference(this, &quot;arguments&quot;, &quot;HandleMIssueResponse&quot;, &quot;context&quot;,
                true));
            sb.Append(&quot;}&quot;);
            sb.Append(&quot;&lt;/script&gt;&quot;);
            ScriptManager.RegisterStartupScript(btnResourcePicker, btnResourcePicker.GetType(), &quot;MICallBackScript&quot;,
                sb.ToString2(), false);
        }

        #endregion

        #region ToolBar Menu

        protected void CreateToolBarMenu()
        {
            var menuGroups = new List&lt;MenuGroup&gt;();
            MenuGroup generalGroup = new MenuGroup(&quot;General&quot;);
            generalGroup.AddMenu(new TextIcon(&quot;lnkAddMiscellaneous&quot;, &quot;Add Miscellaneous&quot;, &quot;Icn_Library_16.png&quot;));
            generalGroup.AddMenu(new TextIcon(&quot;lnkDelete&quot;, &quot;Delete&quot;, &quot;Icn_Delete_16.png&quot;));
            generalGroup.AddMenu(new TextIcon(&quot;lnkTradeAgreement&quot;, &quot;Trade Agreement&quot;, &quot;Icn_TradeAgreement_16.png&quot;));
            generalGroup.AddMenu(new TextIcon(&quot;lnkInventoryDimensions&quot;, &quot;Inventory Dimensions&quot;, &quot;Icn_Inventory_16.png&quot;));
            menuGroups.Add(generalGroup);
            MainToolBar.CreateToolBar(menuGroups);

            if (MainToolBar.GetMenuReference(&quot;lnkAddMiscellaneous&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkAddMiscellaneous&quot;).CausesValidation = true;
                MainToolBar.GetMenuReference(&quot;lnkAddMiscellaneous&quot;).ValidationGroup = &quot;Master&quot;;
                MainToolBar.GetMenuReference(&quot;lnkAddMiscellaneous&quot;).OnClientClick = &quot;return RAControl_AddNewRow();&quot;;
            }
            if (MainToolBar.GetMenuReference(&quot;lnkDelete&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).CausesValidation = true;
                MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).ValidationGroup = &quot;Master&quot;;
                MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).OnClientClick = &quot;return DeleteRateAnalysis();&quot;;
                MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).Click += btnDeleteRateAnalysis_Click;
            }
            if (MainToolBar.GetMenuReference(&quot;lnkDone&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkDone&quot;).CausesValidation = true;
                MainToolBar.GetMenuReference(&quot;lnkDone&quot;).ValidationGroup = &quot;Master&quot;;
                MainToolBar.GetMenuReference(&quot;lnkDone&quot;).OnClientClick = &quot;return ValidateRateAnalysisGrid();&quot;;
                MainToolBar.GetMenuReference(&quot;lnkDone&quot;).Click += SaveResources;
            }
            if (MainToolBar.GetMenuReference(&quot;lnkTradeAgreement&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkTradeAgreement&quot;).CausesValidation = true;
                MainToolBar.GetMenuReference(&quot;lnkTradeAgreement&quot;).ValidationGroup = &quot;Master&quot;;
                MainToolBar.GetMenuReference(&quot;lnkTradeAgreement&quot;).OnClientClick = &quot;return ShowTradeAgreement();&quot;;
                MainToolBar.GetMenuReference(&quot;lnkTradeAgreement&quot;).Click += btnTradeAgreement_Click;
            }
            if (MainToolBar.GetMenuReference(&quot;lnkInventoryDimensions&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkInventoryDimensions&quot;).CausesValidation = true;
                MainToolBar.GetMenuReference(&quot;lnkInventoryDimensions&quot;).ValidationGroup = &quot;Master&quot;;
                MainToolBar.GetMenuReference(&quot;lnkInventoryDimensions&quot;).OnClientClick =
                    &quot;return ShowInventoryDimensions();&quot;;
            }

            if (MainToolBar.GetMenuReference(&quot;lnkMIDetails&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkMIDetails&quot;).CausesValidation = true;
                MainToolBar.GetMenuReference(&quot;lnkMIDetails&quot;).ValidationGroup = &quot;Master&quot;;
                MainToolBar.GetMenuReference(&quot;lnkMIDetails&quot;).ToolTip = &quot;Material Issue Details&quot;;
                MainToolBar.GetMenuReference(&quot;lnkMIDetails&quot;).OnClientClick = &quot;GetMaterialIssueDetails();return false;&quot;;
            }
        }

        #endregion

        #region Nested type: getApprovedMI

        private delegate DataTable getApprovedMI(int a, string b);

        #endregion
    }

    public enum RateAnalysisDivEnums
    {
        Resources = 1,
        ResourcePicker = 2,
        TradeAgreementPicker = 3,
        DimensionsPicker = 4
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[38,9,38,67,1],[40,9,40,82,1],[41,9,41,107,1],[42,9,42,105,1],[43,9,43,97,1],[55,9,55,57,1],[56,9,56,61,1],[57,9,57,59,1],[58,9,58,60,1],[68,17,68,18,1],[68,19,68,141,1],[68,142,68,143,1],[75,17,75,18,1],[75,19,75,42,1],[75,43,75,44,1],[76,17,76,18,1],[76,19,76,43,1],[76,44,76,45,1],[81,17,81,18,1],[81,19,81,112,1],[81,113,81,114,1],[86,17,86,18,1],[86,19,86,45,1],[86,46,86,47,1],[87,17,87,18,1],[87,19,87,44,1],[87,45,87,46,1],[92,17,92,18,1],[92,19,92,66,1],[92,67,92,68,1],[93,17,93,18,1],[93,19,93,68,1],[93,69,93,70,1],[98,17,98,18,1],[98,19,98,65,1],[98,66,98,67,1],[100,13,100,14,1],[101,17,103,25,1],[104,13,104,14,1],[110,13,110,14,1],[111,17,113,89,1],[114,13,114,14,1],[116,13,116,14,1],[117,17,117,55,1],[118,17,118,37,1],[119,13,119,14,1],[124,17,124,18,1],[124,19,124,58,1],[124,59,124,60,1],[125,17,125,18,0],[125,19,125,90,0],[125,91,125,92,0],[131,13,131,14,1],[132,17,134,25,1],[135,13,135,14,1],[140,17,140,18,1],[140,19,140,64,1],[140,65,140,66,1],[146,13,146,14,0],[147,17,149,25,0],[150,13,150,14,0],[151,17,151,18,0],[151,19,151,57,0],[151,58,151,59,0],[156,17,156,18,0],[156,19,156,46,0],[156,47,156,48,0],[157,17,157,18,1],[157,19,157,45,1],[157,46,157,47,1],[163,9,163,10,0],[165,13,165,35,0],[166,9,166,10,0],[169,9,169,10,0],[170,13,170,74,0],[171,13,171,46,0],[172,13,172,85,0],[175,13,175,14,0],[176,17,176,66,0],[177,17,177,18,0],[178,21,178,51,0],[179,21,181,36,0],[182,21,184,40,0],[186,21,186,60,0],[187,21,187,22,0],[188,25,188,52,0],[189,30,189,39,0],[189,41,189,64,0],[189,66,189,69,0],[190,25,190,26,0],[191,29,193,52,0],[194,29,194,54,0],[195,29,195,30,0],[197,33,197,101,0],[198,33,199,111,0],[200,33,205,74,0],[206,33,206,68,0],[207,33,207,72,0],[208,33,208,69,0],[209,33,209,54,0],[210,29,210,30,0],[211,25,211,26,0],[212,25,212,43,0],[213,29,213,85,0],[215,29,215,57,0],[216,21,216,22,0],[218,25,218,53,0],[219,17,219,18,0],[220,13,220,14,0],[221,13,221,33,0],[222,13,222,14,0],[223,17,223,57,0],[224,13,224,14,0],[227,9,227,10,0],[234,9,234,10,0],[236,13,236,26,0],[237,9,237,10,0],[239,41,239,45,1],[239,46,239,50,1],[242,9,242,10,1],[243,13,243,66,1],[244,13,244,171,1],[246,13,246,39,1],[247,13,247,40,1],[249,13,249,138,1],[250,13,250,85,1],[251,13,251,142,1],[252,13,252,145,1],[254,13,254,43,1],[255,13,255,14,0],[256,17,256,57,0],[257,17,257,49,0],[258,21,259,96,0],[260,13,260,14,0],[261,18,261,48,1],[262,13,262,14,0],[263,17,263,56,0],[264,17,265,49,0],[266,17,267,72,0],[268,13,268,14,0],[269,13,269,63,1],[270,13,270,59,1],[272,13,272,38,1],[274,13,274,107,1],[276,13,276,82,1],[277,13,277,86,1],[278,13,278,99,1],[282,13,282,14,1],[283,17,287,59,1],[288,13,288,14,1],[289,13,289,30,0],[290,13,290,14,0],[291,17,291,41,0],[292,13,292,14,0],[294,13,294,142,1],[295,13,295,139,1],[296,13,296,138,1],[297,13,297,150,1],[299,13,299,28,1],[300,13,300,14,1],[301,17,301,50,1],[302,13,302,14,1],[304,13,304,65,1],[305,9,305,10,1],[308,9,308,10,1],[309,13,309,81,1],[310,13,310,78,1],[311,13,311,80,1],[312,13,312,89,1],[313,13,313,66,1],[314,13,314,80,1],[315,9,315,10,1],[318,9,318,10,1],[319,13,319,53,1],[320,13,320,68,1],[321,9,321,10,1],[324,9,324,10,1],[325,13,325,35,1],[326,13,326,49,1],[327,13,327,14,1],[328,17,329,40,1],[329,40,329,104,0],[329,104,330,54,1],[328,17,330,54,1],[331,13,331,14,1],[333,13,333,14,1],[334,17,334,77,1],[335,17,335,38,1],[336,17,336,18,1],[337,21,337,55,1],[338,21,338,45,1],[339,21,339,22,0],[340,25,340,107,0],[341,25,341,70,0],[342,25,342,53,0],[343,21,343,22,0],[344,17,344,18,1],[345,13,345,14,1],[346,13,346,46,1],[347,9,347,10,1],[350,9,350,10,1],[351,13,351,39,1],[352,13,352,73,1],[353,13,353,34,1],[354,13,354,14,1],[355,17,355,51,1],[356,17,356,41,1],[357,17,357,18,0],[358,21,358,97,0],[359,21,359,66,0],[360,21,360,53,0],[361,17,361,18,0],[362,13,362,14,1],[364,13,364,50,1],[365,9,365,10,1],[368,9,368,10,1],[369,13,369,37,1],[370,17,370,38,1],[371,9,371,10,1],[374,9,374,10,1],[375,13,375,33,1],[376,13,376,80,1],[380,13,380,85,1],[381,13,381,53,1],[382,13,382,55,1],[383,13,383,76,1],[384,13,384,92,1],[385,13,385,70,1],[386,13,386,89,1],[387,13,387,63,1],[388,13,388,71,1],[389,13,389,103,1],[390,13,391,35,1],[392,13,392,109,1],[393,13,393,94,1],[394,13,394,95,1],[395,13,395,103,1],[396,13,396,108,1],[397,13,397,67,1],[403,13,403,77,1],[404,13,404,49,1],[405,13,405,51,1],[406,13,406,72,1],[407,13,407,93,1],[408,13,408,71,1],[409,13,409,85,1],[410,13,410,62,1],[411,13,411,63,1],[412,13,412,99,1],[413,13,413,94,1],[414,13,414,109,1],[415,13,415,111,1],[416,13,416,114,1],[417,13,417,61,1],[421,13,421,64,1],[422,13,422,64,1],[424,13,424,72,1],[431,13,431,75,1],[435,13,436,118,1],[437,13,437,28,1],[438,9,438,10,1],[441,9,441,10,0],[442,13,442,45,0],[444,13,444,43,0],[445,13,445,48,0],[446,13,446,47,0],[447,13,447,58,0],[449,13,449,43,0],[450,13,450,48,0],[451,13,451,45,0],[452,13,452,58,0],[459,13,459,28,0],[460,9,460,10,0],[463,9,463,10,1],[464,13,464,45,1],[466,13,466,43,1],[467,13,467,41,1],[468,13,468,46,1],[469,13,469,58,1],[471,13,471,43,1],[472,13,472,42,1],[473,13,473,47,1],[474,13,474,58,1],[476,13,476,43,1],[477,13,477,50,1],[478,13,478,42,1],[479,13,479,58,1],[481,13,481,28,1],[482,9,482,10,1],[485,9,485,10,1],[486,13,486,45,1],[488,13,488,43,1],[489,13,489,41,1],[490,13,490,53,1],[491,13,491,58,1],[493,13,493,43,1],[494,13,494,42,1],[495,13,495,54,1],[496,13,496,58,1],[498,13,498,43,1],[499,13,499,50,1],[500,13,500,49,1],[501,13,501,58,1],[503,13,503,43,1],[504,13,504,46,1],[505,13,505,42,1],[506,13,506,58,1],[508,13,508,43,1],[509,13,509,44,1],[510,13,510,40,1],[511,13,511,58,1],[513,13,513,28,1],[514,9,514,10,1],[517,9,517,10,1],[518,13,518,61,1],[520,13,520,103,1],[522,13,522,70,1],[523,13,523,63,1],[524,13,524,54,1],[525,13,525,62,1],[526,13,526,53,1],[527,13,527,56,1],[528,13,528,42,1],[529,13,529,66,1],[530,13,530,121,1],[531,13,531,89,1],[533,13,533,86,1],[534,13,534,100,1],[535,13,535,56,1],[536,13,536,68,1],[537,9,537,10,1],[540,9,540,10,1],[541,13,541,54,1],[542,13,554,51,1],[556,13,556,56,1],[557,13,557,14,0],[558,17,558,76,0],[559,17,559,18,0],[560,21,574,51,0],[575,17,575,18,0],[576,13,576,14,0],[577,13,577,28,1],[578,9,578,10,1],[581,9,581,10,1],[582,13,582,38,1],[583,13,583,60,1],[584,13,584,56,1],[585,17,587,37,1],[588,13,588,49,1],[590,13,590,73,1],[591,13,591,14,0],[592,17,592,86,0],[593,17,593,67,0],[594,21,594,61,0],[595,22,595,71,0],[596,21,596,53,0],[597,22,597,71,0],[598,21,598,60,0],[599,22,599,74,0],[600,21,600,63,0],[601,22,601,73,0],[602,21,602,62,0],[603,22,603,83,0],[604,21,604,60,0],[606,17,609,38,0],[610,13,610,14,0],[612,13,612,42,1],[613,9,613,10,1],[617,9,617,10,0],[618,13,618,38,0],[619,13,619,27,0],[620,13,620,58,0],[621,13,621,14,0],[622,17,622,24,0],[622,26,622,58,0],[622,59,622,61,0],[622,62,622,92,0],[623,17,623,18,0],[624,21,624,49,0],[625,21,625,69,0],[626,21,628,57,0],[629,21,631,46,0],[632,21,634,54,0],[635,21,635,102,0],[636,21,638,30,0],[639,21,641,30,0],[642,21,644,30,0],[646,21,646,54,0],[647,25,647,92,0],[649,25,649,108,0],[650,21,650,35,0],[651,21,651,63,0],[652,21,652,98,0],[653,21,654,124,0],[655,21,655,46,0],[656,21,656,64,0],[657,17,657,18,0],[658,13,658,14,0],[660,13,660,14,0],[661,17,661,42,0],[662,17,662,31,0],[663,13,663,14,0],[664,9,664,10,0],[668,9,668,10,0],[669,13,669,38,0],[670,13,670,27,0],[671,13,671,58,0],[672,13,672,14,0],[673,17,673,24,0],[673,26,673,58,0],[673,59,673,61,0],[673,62,673,92,0],[674,17,674,18,0],[675,21,675,75,0],[676,21,676,100,0],[677,21,677,54,0],[678,25,678,59,0],[680,25,680,75,0],[682,21,682,52,0],[683,21,683,94,0],[684,21,684,35,0],[685,21,687,117,0],[688,21,688,22,0],[689,25,689,49,0],[690,25,690,26,0],[691,29,691,43,0],[692,29,692,72,0],[693,25,693,26,0],[694,21,694,22,0],[695,17,695,18,0],[696,13,696,14,0],[697,9,697,10,0],[700,9,700,10,0],[701,13,701,49,0],[703,13,703,80,0],[704,13,704,102,0],[705,9,705,10,0],[708,9,708,10,0],[709,13,709,27,0],[710,13,710,44,0],[711,13,713,109,0],[714,17,714,30,0],[716,17,716,26,0],[717,9,717,10,0],[720,9,720,10,0],[721,13,721,27,0],[722,13,722,44,0],[723,13,725,109,0],[726,17,726,30,0],[728,17,728,26,0],[729,9,729,10,0],[732,9,732,10,1],[737,13,738,115,1],[740,13,740,89,1],[741,13,743,68,1],[744,13,745,97,1],[746,13,748,68,1],[749,13,749,123,1],[750,13,752,68,1],[753,13,753,123,1],[754,13,756,68,1],[757,13,758,97,1],[760,13,761,50,1],[762,9,762,10,1],[765,9,765,10,0],[818,9,818,10,0],[821,9,821,10,0],[831,9,831,10,0],[834,9,834,10,0],[835,13,835,46,0],[837,13,837,90,0],[838,13,838,76,0],[839,13,839,63,0],[840,17,840,90,0],[841,13,841,116,0],[842,13,842,32,0],[843,9,843,10,0],[846,9,846,10,1],[847,13,847,26,1],[848,13,848,14,0],[853,13,853,14,0],[855,13,856,76,1],[857,17,857,56,1],[858,13,858,63,1],[859,13,859,14,0],[860,17,860,57,0],[861,17,861,46,0],[862,17,862,55,0],[863,17,863,36,0],[864,13,864,14,0],[866,13,866,14,1],[867,17,867,51,1],[868,17,868,56,1],[869,17,869,59,1],[870,13,870,14,1],[874,13,874,76,1],[875,13,875,51,1],[877,13,877,25,1],[878,13,878,14,1],[879,17,879,46,1],[880,17,880,48,1],[881,21,881,46,0],[882,17,882,74,1],[883,21,883,99,0],[884,13,884,14,1],[885,13,885,41,1],[886,13,886,14,1],[887,17,887,65,1],[888,17,888,18,0],[889,21,889,116,0],[890,25,890,69,0],[891,21,891,109,0],[892,25,892,59,0],[893,21,893,113,0],[894,25,894,67,0],[895,21,895,123,0],[896,25,896,72,0],[897,21,897,113,0],[898,25,898,62,0],[899,17,899,18,0],[901,17,901,64,1],[902,17,902,18,1],[903,21,903,47,1],[904,21,904,22,1],[905,25,905,60,1],[906,25,906,59,1],[907,21,907,22,1],[909,21,909,22,1],[910,25,910,59,1],[911,21,911,22,1],[913,21,913,35,1],[914,25,914,58,1],[915,21,915,58,1],[916,17,916,18,1],[917,13,917,14,1],[918,13,918,33,1],[919,9,919,10,1],[922,9,922,10,0],[923,13,923,62,0],[924,13,924,14,0],[925,17,926,32,0],[927,17,929,36,0],[932,17,932,56,0],[933,17,933,18,0],[934,26,934,35,0],[934,37,934,60,0],[934,62,934,65,0],[935,21,935,22,0],[936,25,937,122,0],[938,25,938,50,0],[939,25,939,26,0],[940,29,940,55,0],[941,29,941,33,0],[942,25,942,26,0],[943,21,943,22,0],[944,21,944,121,0],[945,17,945,18,0],[946,13,946,14,0],[947,9,947,10,0],[950,9,950,10,0],[951,13,951,40,0],[952,13,953,121,0],[955,13,955,87,0],[956,13,956,77,0],[957,13,957,110,0],[958,13,958,89,0],[959,13,959,73,0],[961,13,963,59,0],[964,13,964,44,0],[965,13,965,27,0],[966,13,966,109,0],[967,13,967,14,0],[968,17,968,37,0],[971,17,971,29,0],[972,9,972,10,0],[975,9,975,10,0],[976,13,976,40,0],[977,13,977,39,0],[979,13,982,35,0],[983,13,983,38,0],[984,13,984,14,0],[985,17,987,75,0],[988,17,988,73,0],[989,13,989,14,0],[991,13,991,14,0],[992,17,992,29,0],[995,13,995,87,0],[996,13,996,77,0],[997,13,997,85,0],[998,13,998,89,0],[999,13,999,73,0],[1000,13,1002,59,0],[1003,13,1003,44,0],[1004,13,1004,27,0],[1005,13,1005,109,0],[1006,13,1006,14,0],[1007,17,1007,37,0],[1010,17,1010,29,0],[1011,9,1011,10,0],[1014,9,1014,10,0],[1015,13,1015,53,0],[1016,13,1016,55,0],[1017,13,1017,47,0],[1018,13,1018,42,0],[1019,13,1019,134,0],[1020,17,1020,68,0],[1021,9,1021,10,0],[1024,9,1024,10,0],[1025,13,1025,107,0],[1027,13,1027,80,0],[1028,13,1028,90,0],[1029,13,1029,102,0],[1030,13,1030,94,0],[1031,13,1033,73,0],[1034,13,1034,41,0],[1035,13,1035,14,0],[1036,17,1036,114,0],[1037,17,1037,18,0],[1038,21,1038,69,0],[1039,25,1039,77,0],[1040,21,1040,76,0],[1041,25,1041,84,0],[1042,21,1042,72,0],[1043,25,1043,79,0],[1044,17,1044,18,0],[1045,22,1045,69,0],[1046,17,1046,18,0],[1047,21,1047,72,0],[1048,25,1048,78,0],[1049,17,1049,18,0],[1050,13,1050,14,0],[1055,9,1055,10,0],[1058,9,1058,10,0],[1059,13,1059,90,0],[1060,13,1060,40,0],[1061,13,1061,61,0],[1062,13,1062,125,0],[1063,9,1063,10,0],[1066,9,1066,10,0],[1067,13,1067,95,0],[1068,13,1068,64,0],[1069,13,1069,63,0],[1070,9,1070,10,0],[1073,9,1073,10,0],[1074,13,1074,91,0],[1075,13,1075,60,0],[1076,13,1076,59,0],[1077,9,1077,10,0],[1080,9,1080,10,0],[1081,13,1081,31,0],[1082,13,1082,30,0],[1083,9,1083,10,0],[1086,9,1086,10,0],[1087,13,1087,103,0],[1088,13,1088,14,0],[1089,17,1089,50,0],[1090,17,1090,52,0],[1091,17,1091,62,0],[1092,17,1092,18,0],[1093,21,1093,28,0],[1093,30,1093,62,0],[1093,63,1093,65,0],[1093,66,1093,96,0],[1094,21,1094,22,0],[1095,25,1095,93,0],[1096,25,1096,75,0],[1097,21,1097,22,0],[1098,17,1098,18,0],[1099,17,1099,80,0],[1100,17,1100,18,0],[1101,21,1101,60,0],[1102,21,1102,65,0],[1103,21,1103,22,0],[1104,25,1104,54,0],[1105,25,1107,58,0],[1108,25,1112,111,0],[1113,25,1113,70,0],[1114,25,1114,26,0],[1115,29,1120,120,0],[1121,25,1121,26,0],[1123,29,1123,64,0],[1124,21,1124,22,0],[1126,21,1126,22,0],[1127,25,1127,58,0],[1128,25,1128,60,0],[1129,21,1129,22,0],[1130,21,1130,70,0],[1131,17,1131,18,0],[1132,17,1132,61,0],[1134,13,1134,14,0],[1135,9,1135,10,0],[1138,9,1138,10,0],[1139,13,1139,42,0],[1140,13,1142,33,0],[1143,13,1146,99,0],[1147,13,1147,58,0],[1148,13,1148,14,0],[1149,17,1155,58,0],[1156,13,1156,14,0],[1158,17,1158,52,0],[1159,9,1159,10,0],[1162,9,1162,10,0],[1163,13,1163,81,0],[1164,13,1164,61,0],[1165,13,1165,67,0],[1166,13,1166,31,0],[1167,9,1167,10,0],[1170,9,1170,10,0],[1171,13,1171,99,0],[1172,13,1173,59,0],[1174,9,1174,10,0],[1177,9,1177,10,0],[1178,13,1178,81,0],[1180,13,1180,51,0],[1181,13,1181,39,0],[1182,13,1184,38,0],[1185,17,1185,64,0],[1187,17,1187,53,0],[1189,13,1189,104,0],[1191,13,1191,67,0],[1192,13,1192,52,0],[1193,13,1193,169,0],[1195,13,1195,71,0],[1197,13,1197,42,0],[1198,13,1198,14,0],[1199,17,1199,60,0],[1200,17,1200,38,0],[1201,17,1201,62,0],[1202,17,1202,18,0],[1204,21,1204,53,0],[1205,21,1205,110,0],[1206,17,1206,18,0],[1208,17,1208,18,0],[1210,21,1210,49,0],[1211,21,1211,112,0],[1212,17,1212,18,0],[1213,13,1213,14,0],[1214,13,1214,137,0],[1215,13,1215,167,0],[1216,13,1216,155,0],[1217,13,1217,152,0],[1218,13,1218,155,0],[1219,13,1219,204,0],[1220,13,1220,188,0],[1221,13,1221,94,0],[1222,13,1222,115,0],[1223,13,1223,164,0],[1224,13,1224,256,0],[1225,13,1225,140,0],[1226,13,1226,45,0],[1227,13,1227,61,0],[1229,13,1229,44,0],[1230,13,1230,14,0],[1231,17,1231,51,0],[1232,21,1232,75,0],[1233,13,1233,14,0],[1234,18,1234,58,0],[1235,17,1235,77,0],[1237,13,1237,115,0],[1238,17,1238,83,0],[1240,13,1240,105,0],[1241,17,1241,120,0],[1243,13,1243,78,0],[1244,17,1244,83,0],[1246,13,1246,135,0],[1247,13,1247,111,0],[1248,13,1248,108,0],[1251,13,1251,103,0],[1252,13,1252,14,0],[1253,17,1255,36,0],[1256,17,1258,36,0],[1259,13,1259,14,0],[1261,13,1262,89,0],[1263,13,1263,14,0],[1264,17,1264,61,0],[1265,21,1267,41,0],[1268,22,1268,68,0],[1269,21,1271,42,0],[1273,21,1273,48,0],[1274,13,1274,14,0],[1276,17,1276,44,0],[1277,13,1277,32,0],[1278,9,1278,10,0],[1281,9,1281,10,1],[1282,13,1282,46,1],[1283,13,1283,27,1],[1284,13,1284,14,1],[1287,17,1287,18,1],[1288,21,1288,108,1],[1290,21,1290,93,1],[1291,21,1291,59,1],[1292,21,1292,22,0],[1293,25,1293,32,0],[1293,34,1293,49,0],[1293,50,1293,52,0],[1293,53,1293,74,0],[1294,25,1294,26,0],[1295,29,1295,46,0],[1296,29,1296,72,0],[1297,29,1297,30,0],[1298,33,1298,98,0],[1302,33,1302,61,0],[1303,33,1303,34,0],[1304,37,1304,120,0],[1305,37,1305,76,0],[1306,41,1306,73,0],[1308,37,1308,38,0],[1311,41,1314,121,0],[1315,45,1315,95,0],[1316,37,1316,38,0],[1317,33,1317,34,0],[1319,33,1319,34,0],[1322,37,1325,117,0],[1326,41,1326,91,0],[1327,33,1327,34,0],[1330,29,1330,30,0],[1331,25,1331,26,0],[1332,21,1332,22,0],[1334,21,1334,66,1],[1335,21,1335,22,1],[1336,25,1336,69,1],[1337,25,1337,26,1],[1339,29,1339,80,1],[1340,25,1340,26,1],[1342,25,1342,138,1],[1344,25,1344,129,1],[1345,25,1345,53,1],[1346,25,1346,32,1],[1346,34,1346,46,0],[1346,47,1346,49,1],[1346,50,1346,60,1],[1347,25,1347,26,0],[1348,29,1348,82,0],[1352,29,1353,91,0],[1354,29,1354,30,0],[1355,33,1355,79,0],[1356,33,1356,34,0],[1357,37,1357,99,0],[1358,37,1358,44,0],[1360,29,1360,30,0],[1362,29,1363,93,0],[1364,29,1364,30,0],[1365,33,1365,50,0],[1366,33,1367,52,0],[1368,33,1368,34,0],[1369,37,1369,110,0],[1370,37,1370,107,0],[1371,37,1371,38,0],[1372,41,1372,72,0],[1373,45,1374,117,0],[1376,45,1382,78,0],[1383,37,1383,38,0],[1384,33,1384,34,0],[1385,29,1385,30,0],[1387,33,1387,65,0],[1393,29,1393,57,0],[1394,29,1394,30,0],[1395,33,1395,119,0],[1396,33,1396,72,0],[1397,33,1397,34,0],[1398,37,1398,69,0],[1399,37,1399,78,0],[1400,37,1400,38,0],[1403,37,1403,38,0],[1404,33,1404,34,0],[1406,37,1406,100,0],[1407,29,1407,30,0],[1409,33,1409,96,0],[1412,25,1412,26,0],[1413,21,1413,22,1],[1414,17,1414,18,1],[1415,17,1415,37,0],[1416,17,1416,18,0],[1418,21,1418,44,0],[1419,17,1419,18,0],[1421,17,1421,71,1],[1428,17,1428,60,1],[1429,17,1429,35,1],[1430,13,1430,14,1],[1432,13,1432,134,1],[1433,13,1433,14,1],[1434,17,1434,68,1],[1435,13,1435,14,1],[1437,13,1437,51,1],[1438,17,1438,40,0],[1440,17,1440,34,1],[1441,9,1441,10,1],[1445,9,1445,10,0],[1446,13,1447,60,0],[1448,13,1448,14,0],[1449,17,1452,44,0],[1453,17,1453,83,0],[1454,17,1454,18,0],[1457,21,1457,55,0],[1458,25,1459,121,0],[1461,21,1461,22,0],[1462,25,1462,114,0],[1463,25,1463,86,0],[1464,21,1464,22,0],[1467,17,1467,18,0],[1469,17,1469,18,0],[1472,21,1476,70,0],[1477,21,1477,22,0],[1478,25,1478,47,0],[1479,25,1479,111,0],[1480,25,1480,26,0],[1481,29,1482,48,0],[1484,29,1485,69,0],[1489,29,1489,57,0],[1490,29,1490,30,0],[1491,33,1491,110,0],[1492,33,1492,72,0],[1493,37,1493,69,0],[1495,33,1495,34,0],[1496,37,1497,99,0],[1498,37,1498,98,0],[1499,33,1499,34,0],[1500,29,1500,30,0],[1502,29,1502,30,0],[1503,33,1503,122,0],[1504,33,1504,94,0],[1505,29,1505,30,0],[1508,25,1508,26,0],[1509,21,1509,22,0],[1511,25,1512,104,0],[1515,17,1515,18,0],[1516,13,1516,14,0],[1518,13,1518,14,0],[1519,17,1519,106,0],[1520,13,1520,14,0],[1521,9,1521,10,0],[1524,9,1524,10,0],[1525,13,1527,41,0],[1528,13,1529,77,0],[1530,13,1530,14,0],[1531,17,1531,119,0],[1532,17,1532,30,0],[1535,13,1535,14,0],[1536,17,1536,39,0],[1537,17,1537,98,0],[1538,17,1538,18,0],[1539,21,1540,40,0],[1544,21,1544,49,0],[1545,21,1545,22,0],[1546,25,1546,104,0],[1547,25,1547,64,0],[1548,25,1548,26,0],[1549,29,1551,47,0],[1552,29,1552,42,0],[1555,29,1555,92,0],[1556,21,1556,22,0],[1558,25,1558,88,0],[1561,17,1561,18,0],[1563,17,1563,29,0],[1565,9,1565,10,0],[1568,9,1568,10,0],[1569,13,1569,46,0],[1571,13,1571,63,0],[1572,13,1572,77,0],[1573,13,1573,60,0],[1574,13,1574,49,0],[1575,13,1575,53,0],[1576,13,1577,118,0],[1578,13,1578,53,0],[1579,13,1579,57,0],[1580,13,1580,73,0],[1581,13,1581,40,0],[1583,13,1583,60,0],[1585,13,1585,40,0],[1586,9,1586,10,0],[1589,9,1589,10,1],[1590,13,1590,55,1],[1591,13,1591,14,0],[1592,17,1592,90,0],[1595,17,1595,24,0],[1595,26,1595,43,0],[1595,44,1595,46,0],[1595,47,1595,93,0],[1596,17,1596,18,0],[1597,21,1597,51,0],[1598,21,1598,22,0],[1599,25,1599,66,0],[1600,25,1600,26,0],[1601,29,1601,120,0],[1602,25,1602,26,0],[1603,30,1603,66,0],[1604,25,1604,26,0],[1605,29,1605,118,0],[1606,25,1606,26,0],[1607,21,1607,22,0],[1608,17,1608,18,0],[1610,17,1610,186,0],[1612,17,1612,36,0],[1613,17,1613,117,0],[1614,17,1614,18,0],[1615,21,1615,93,0],[1616,21,1616,108,0],[1617,21,1618,96,0],[1619,21,1619,22,0],[1620,25,1620,94,0],[1621,25,1621,32,0],[1621,34,1621,47,0],[1621,48,1621,50,0],[1621,51,1621,69,0],[1622,29,1622,54,0],[1623,29,1623,30,0],[1624,33,1624,82,0],[1625,33,1625,54,0],[1626,29,1626,30,0],[1627,21,1627,22,0],[1628,17,1628,18,0],[1629,13,1629,14,0],[1630,9,1630,10,1],[1633,9,1633,10,1],[1634,13,1634,82,1],[1636,13,1636,87,1],[1637,13,1637,14,1],[1638,17,1638,66,1],[1639,17,1639,61,1],[1640,17,1640,60,1],[1641,17,1641,61,1],[1642,17,1642,69,1],[1644,17,1644,71,1],[1645,17,1645,64,1],[1646,17,1646,70,1],[1647,17,1647,66,1],[1648,17,1648,64,1],[1650,17,1650,43,1],[1651,17,1651,18,1],[1652,21,1652,68,1],[1653,21,1653,64,1],[1654,21,1654,81,1],[1655,21,1655,65,1],[1656,17,1656,18,1],[1657,22,1657,92,1],[1658,17,1658,18,1],[1659,21,1659,81,1],[1660,17,1660,18,1],[1661,13,1661,14,1],[1663,13,1663,39,1],[1664,13,1664,14,0],[1665,17,1665,65,0],[1666,17,1666,64,0],[1667,17,1667,65,0],[1668,13,1668,14,0],[1670,13,1670,33,1],[1671,13,1671,14,1],[1672,17,1672,73,1],[1673,17,1673,66,1],[1674,13,1674,14,1],[1675,9,1675,10,1],[1678,9,1678,10,1],[1679,13,1679,82,1],[1681,13,1681,136,1],[1682,13,1682,133,1],[1683,13,1683,129,1],[1687,13,1687,64,1],[1688,13,1688,36,1],[1689,13,1689,14,1],[1690,17,1690,125,1],[1691,17,1691,92,1],[1692,17,1692,52,1],[1693,17,1693,18,1],[1694,21,1694,65,1],[1695,21,1695,84,1],[1696,21,1696,102,1],[1697,17,1697,18,1],[1698,13,1698,14,1],[1704,13,1704,72,1],[1705,13,1705,40,1],[1706,13,1706,14,1],[1707,17,1707,43,1],[1708,21,1708,61,0],[1710,17,1710,95,1],[1711,17,1711,51,1],[1712,17,1712,18,1],[1713,21,1713,64,1],[1714,21,1714,82,1],[1715,21,1715,100,1],[1716,21,1716,56,1],[1717,17,1717,18,1],[1718,13,1718,14,1],[1724,13,1724,87,1],[1725,13,1725,50,1],[1726,13,1726,14,1],[1727,17,1727,152,1],[1728,17,1728,115,1],[1729,17,1729,61,1],[1730,17,1730,18,1],[1731,21,1731,74,1],[1732,21,1732,90,1],[1733,21,1733,108,1],[1734,17,1734,18,1],[1735,13,1735,14,1],[1741,13,1741,93,1],[1742,13,1742,48,1],[1743,13,1743,14,1],[1744,17,1744,111,1],[1745,17,1745,59,1],[1746,17,1746,18,1],[1747,21,1747,72,1],[1748,21,1748,69,1],[1749,21,1749,89,1],[1750,21,1750,66,1],[1751,17,1751,18,1],[1752,13,1752,14,1],[1758,13,1758,71,1],[1759,13,1759,42,1],[1760,13,1760,14,1],[1761,17,1761,99,1],[1762,17,1762,53,1],[1763,17,1763,18,1],[1764,21,1764,66,1],[1765,21,1765,63,1],[1766,21,1766,73,1],[1767,21,1767,58,1],[1768,17,1768,18,1],[1769,13,1769,14,1],[1775,13,1775,69,1],[1776,13,1776,41,1],[1777,13,1777,14,1],[1778,17,1778,125,1],[1779,17,1779,97,1],[1780,17,1780,52,1],[1781,17,1781,18,1],[1782,21,1782,65,1],[1783,21,1783,81,1],[1784,21,1784,99,1],[1785,17,1785,18,1],[1786,13,1786,14,1],[1790,13,1790,59,1],[1794,13,1794,98,1],[1795,13,1795,14,0],[1796,17,1796,146,0],[1797,17,1797,141,0],[1798,13,1798,14,0],[1800,13,1800,98,1],[1801,13,1801,14,0],[1802,17,1802,143,0],[1803,13,1803,14,0],[1804,13,1804,112,1],[1805,13,1805,14,0],[1806,17,1806,150,0],[1807,13,1807,14,0],[1808,13,1808,102,1],[1809,13,1809,14,0],[1810,17,1810,145,0],[1811,13,1811,14,0],[1812,13,1812,100,1],[1813,13,1813,14,0],[1814,17,1814,144,0],[1815,13,1815,14,0],[1816,13,1816,102,1],[1817,13,1817,14,0],[1818,17,1818,145,0],[1819,13,1819,14,0],[1823,13,1823,27,1],[1824,9,1824,10,1],[1827,9,1827,10,1],[1828,13,1828,75,1],[1829,13,1829,105,1],[1830,13,1830,30,1],[1831,13,1831,14,1],[1832,17,1832,94,1],[1833,17,1833,44,1],[1834,17,1834,18,1],[1835,21,1836,108,1],[1837,21,1837,126,1],[1838,21,1838,128,1],[1839,21,1839,128,1],[1840,17,1840,18,1],[1841,13,1841,14,1],[1842,9,1842,10,1],[1845,9,1845,10,1],[1851,13,1851,57,1],[1852,13,1853,113,1],[1855,13,1855,99,1],[1856,13,1856,67,1],[1857,13,1857,42,1],[1859,13,1859,35,1],[1860,13,1860,14,1],[1862,17,1862,24,1],[1862,26,1862,37,0],[1862,38,1862,40,1],[1862,41,1862,58,1],[1863,17,1863,18,0],[1864,21,1864,49,0],[1865,21,1865,47,0],[1866,21,1866,41,0],[1867,17,1867,18,0],[1869,17,1869,68,1],[1870,17,1870,56,1],[1872,17,1872,56,1],[1873,17,1873,51,1],[1874,17,1874,58,1],[1875,13,1875,14,1],[1877,13,1877,14,1],[1878,17,1878,87,1],[1879,13,1879,14,1],[1881,13,1881,41,1],[1883,13,1883,29,1],[1884,13,1884,20,1],[1884,22,1884,33,0],[1884,34,1884,36,1],[1884,37,1884,54,1],[1885,13,1885,14,0],[1886,17,1886,49,0],[1887,13,1887,14,0],[1889,13,1889,53,1],[1894,13,1894,27,1],[1897,13,1897,38,1],[1899,13,1899,79,1],[1902,13,1902,45,1],[1903,13,1903,34,1],[1904,13,1904,14,0],[1905,17,1905,122,0],[1906,17,1906,70,0],[1907,17,1907,41,0],[1909,17,1909,39,0],[1910,13,1910,14,0],[1930,13,1930,32,1],[1931,13,1931,14,0],[1932,17,1932,36,0],[1934,17,1934,50,0],[1935,17,1935,36,0],[1936,17,1936,18,0],[1937,26,1937,35,0],[1937,37,1937,58,0],[1937,60,1937,63,0],[1938,21,1938,22,0],[1939,25,1939,74,0],[1940,25,1940,116,0],[1941,25,1941,46,0],[1942,25,1942,48,0],[1943,21,1943,22,0],[1944,21,1944,61,0],[1945,21,1945,48,0],[1946,17,1946,18,0],[1948,17,1948,43,0],[1949,17,1949,46,0],[1950,17,1950,44,0],[1952,17,1952,29,0],[1953,17,1953,76,0],[1954,17,1954,36,0],[1955,17,1955,18,0],[1956,26,1956,35,0],[1956,37,1956,70,0],[1956,72,1956,75,0],[1957,21,1957,22,0],[1958,25,1958,90,0],[1959,25,1959,99,0],[1960,25,1960,46,0],[1961,25,1961,57,0],[1962,21,1962,22,0],[1963,21,1963,61,0],[1964,21,1964,56,0],[1965,17,1965,18,0],[1966,13,1966,14,0],[1968,13,1968,14,1],[1970,17,1970,46,1],[1971,17,1971,49,1],[1972,17,1972,36,1],[1973,17,1973,18,1],[1974,26,1974,35,1],[1974,37,1974,58,1],[1974,60,1974,63,1],[1975,21,1975,22,1],[1976,25,1976,74,1],[1977,25,1977,120,1],[1978,25,1978,46,1],[1979,25,1979,48,1],[1980,21,1980,22,1],[1981,21,1981,61,1],[1982,21,1982,48,1],[1983,17,1983,18,1],[1984,13,1984,14,1],[1986,13,1986,68,1],[1987,13,1987,63,1],[1988,13,1988,58,1],[1989,13,1989,61,1],[1992,13,1992,53,1],[1993,13,1993,48,1],[1994,13,1994,46,1],[1995,13,1995,36,1],[1997,13,1997,33,1],[1998,13,1998,46,1],[2000,13,2001,110,1],[2002,13,2002,86,1],[2003,13,2003,60,1],[2004,13,2004,56,1],[2007,21,2007,79,0],[2008,21,2008,27,0],[2011,21,2011,94,0],[2012,21,2012,27,0],[2015,21,2015,78,0],[2016,21,2016,27,0],[2019,21,2019,78,1],[2020,21,2020,27,1],[2023,21,2023,80,0],[2024,21,2024,27,0],[2027,21,2027,79,0],[2028,21,2028,27,0],[2030,13,2030,60,1],[2032,13,2033,108,1],[2034,13,2034,60,1],[2035,13,2036,108,1],[2038,13,2038,59,1],[2041,21,2042,99,0],[2043,21,2043,27,0],[2046,21,2047,84,0],[2048,21,2048,27,0],[2051,21,2052,83,1],[2053,21,2053,27,1],[2056,21,2057,83,0],[2058,21,2058,27,0],[2061,21,2062,85,0],[2063,21,2063,27,0],[2066,21,2067,84,0],[2068,21,2068,27,0],[2070,13,2070,64,1],[2072,13,2072,39,1],[2073,9,2073,10,1],[2076,9,2076,10,1],[2077,13,2077,43,1],[2078,13,2078,44,1],[2080,13,2080,84,1],[2081,13,2081,85,1],[2082,9,2082,10,1],[2085,9,2085,10,0],[2087,13,2087,20,0],[2087,22,2087,41,0],[2087,42,2087,44,0],[2087,45,2087,65,0],[2088,13,2088,14,0],[2089,17,2089,46,0],[2090,13,2090,14,0],[2092,13,2092,59,0],[2094,13,2094,46,0],[2095,13,2095,14,0],[2096,17,2097,119,0],[2098,17,2098,98,0],[2099,17,2099,88,0],[2100,17,2100,91,0],[2101,13,2101,14,0],[2102,13,2102,46,0],[2103,13,2103,14,0],[2104,17,2105,119,0],[2106,17,2106,94,0],[2107,17,2107,69,0],[2108,17,2108,91,0],[2109,17,2109,88,0],[2110,17,2110,91,0],[2111,13,2111,14,0],[2112,13,2112,50,0],[2113,13,2113,14,0],[2114,17,2114,100,0],[2115,17,2115,92,0],[2116,17,2116,95,0],[2117,13,2117,14,0],[2118,13,2118,79,0],[2120,13,2120,78,0],[2121,13,2121,86,0],[2123,13,2123,50,0],[2123,51,2123,90,0],[2124,13,2124,58,0],[2124,59,2124,106,0],[2125,13,2125,60,0],[2126,13,2126,50,0],[2127,13,2127,58,0],[2128,13,2128,54,0],[2129,13,2129,70,0],[2130,9,2130,10,0],[2133,9,2133,10,0],[2134,13,2134,20,0],[2134,22,2134,41,0],[2134,42,2134,44,0],[2134,45,2134,58,0],[2135,13,2135,14,0],[2136,17,2136,43,0],[2137,17,2137,103,0],[2138,17,2138,24,0],[2138,26,2138,44,0],[2138,45,2138,47,0],[2138,48,2138,59,0],[2139,21,2139,55,0],[2140,13,2140,14,0],[2141,9,2141,10,0],[2144,9,2144,10,1],[2145,13,2145,34,1],[2148,21,2148,63,0],[2149,21,2149,68,0],[2150,21,2150,27,0],[2153,21,2153,62,0],[2154,21,2154,67,0],[2155,21,2155,27,0],[2158,21,2158,62,0],[2159,21,2159,67,0],[2160,21,2160,27,0],[2163,21,2163,58,1],[2164,21,2164,63,1],[2165,21,2165,27,1],[2168,21,2168,62,0],[2169,21,2169,67,0],[2170,21,2170,27,0],[2173,21,2173,65,0],[2174,21,2174,70,0],[2175,21,2175,27,0],[2177,9,2177,10,1],[2180,9,2180,10,1],[2181,13,2181,47,1],[2182,13,2182,47,1],[2183,13,2183,51,1],[2184,13,2184,47,1],[2185,13,2185,41,1],[2186,13,2186,36,1],[2187,13,2187,55,1],[2188,13,2188,40,1],[2189,13,2189,32,1],[2190,13,2190,34,1],[2191,13,2191,32,1],[2192,9,2192,10,1],[2195,9,2195,10,1],[2196,13,2196,49,1],[2197,13,2197,50,1],[2198,13,2198,52,1],[2199,13,2199,54,1],[2200,13,2200,48,1],[2201,13,2201,48,1],[2202,13,2202,47,1],[2204,13,2204,48,1],[2206,9,2206,10,1],[2209,9,2209,10,1],[2210,13,2210,97,1],[2211,13,2211,88,1],[2212,13,2212,14,0],[2213,17,2213,81,0],[2214,17,2214,18,0],[2215,21,2215,97,0],[2216,21,2216,100,0],[2217,17,2217,18,0],[2218,17,2218,71,0],[2219,21,2219,110,0],[2220,13,2220,14,0],[2221,13,2221,76,1],[2237,9,2237,10,1],[2240,9,2240,10,1],[2241,13,2241,36,1],[2242,13,2242,14,1],[2243,17,2243,46,1],[2244,17,2244,74,1],[2245,17,2245,63,1],[2247,17,2247,126,1],[2248,21,2248,53,1],[2249,13,2249,14,1],[2251,13,2251,81,1],[2253,13,2253,20,1],[2253,22,2253,32,1],[2253,33,2253,35,1],[2253,36,2253,56,1],[2254,13,2254,14,1],[2255,17,2261,22,1],[2262,17,2262,18,1],[2263,21,2263,33,1],[2264,17,2264,18,1],[2265,13,2265,14,1],[2267,13,2267,55,1],[2268,13,2268,28,1],[2269,13,2269,48,1],[2270,13,2270,54,1],[2271,13,2271,45,1],[2272,13,2272,125,1],[2275,13,2275,32,1],[2276,13,2276,38,1],[2279,13,2279,66,1],[2280,17,2280,70,1],[2282,13,2282,65,1],[2283,17,2283,70,1],[2292,13,2292,36,1],[2293,13,2293,14,1],[2294,17,2294,69,1],[2295,21,2295,138,1],[2296,13,2296,14,1],[2298,13,2298,14,1],[2299,17,2299,71,1],[2300,13,2300,14,1],[2302,13,2302,39,1],[2303,9,2303,10,1],[2306,9,2306,10,1],[2307,13,2307,58,1],[2308,9,2308,10,1],[2311,9,2311,10,1],[2312,13,2312,47,1],[2313,17,2313,118,1],[2314,13,2314,36,1],[2315,9,2315,10,1],[2320,9,2320,10,0],[2321,13,2321,27,0],[2322,13,2322,49,0],[2323,13,2323,43,0],[2324,13,2326,112,0],[2327,13,2327,14,0],[2328,17,2328,45,0],[2329,13,2329,14,0],[2330,13,2330,28,0],[2331,9,2331,10,0],[2334,9,2334,10,0],[2335,13,2335,97,0],[2336,13,2336,44,0],[2337,13,2337,27,0],[2338,13,2340,109,0],[2341,13,2341,14,0],[2342,17,2342,41,0],[2343,17,2343,18,0],[2344,21,2344,108,0],[2346,21,2346,111,0],[2348,21,2348,102,0],[2350,17,2350,18,0],[2351,13,2351,14,0],[2352,9,2352,10,0],[2355,9,2355,10,0],[2356,13,2356,96,0],[2357,13,2357,44,0],[2358,13,2358,27,0],[2359,13,2361,107,0],[2362,13,2362,14,0],[2363,17,2363,41,0],[2364,17,2364,18,0],[2365,21,2365,90,0],[2366,17,2366,18,0],[2367,13,2367,14,0],[2368,9,2368,10,0],[2371,9,2371,10,0],[2373,13,2373,44,0],[2374,13,2374,27,0],[2375,13,2377,107,0],[2378,13,2378,14,0],[2379,17,2379,41,0],[2380,21,2380,41,0],[2381,13,2381,14,0],[2382,13,2382,36,0],[2383,9,2383,10,0],[2386,9,2386,10,1],[2387,13,2387,44,1],[2388,13,2388,27,1],[2389,13,2391,107,1],[2392,13,2392,14,0],[2393,17,2393,41,0],[2394,17,2394,18,0],[2395,21,2395,59,0],[2396,21,2396,61,0],[2397,21,2397,40,0],[2398,21,2398,40,0],[2399,21,2399,60,0],[2400,21,2400,50,0],[2401,21,2401,38,0],[2402,21,2402,28,0],[2402,30,2402,40,0],[2402,41,2402,43,0],[2402,44,2402,61,0],[2403,21,2403,22,0],[2404,25,2404,72,0],[2405,25,2405,72,0],[2406,21,2406,22,0],[2407,21,2407,57,0],[2408,21,2408,48,0],[2410,17,2410,18,0],[2411,13,2411,14,0],[2412,9,2412,10,1],[2415,9,2415,10,1],[2416,13,2416,44,1],[2417,13,2417,27,1],[2418,13,2420,107,1],[2421,13,2421,14,0],[2422,17,2422,41,0],[2423,17,2423,18,0],[2424,21,2424,59,0],[2425,21,2425,61,0],[2426,21,2426,40,0],[2427,21,2427,40,0],[2428,21,2428,60,0],[2429,21,2429,50,0],[2430,21,2430,38,0],[2431,21,2431,28,0],[2431,30,2431,40,0],[2431,41,2431,43,0],[2431,44,2431,61,0],[2432,21,2432,22,0],[2433,25,2433,65,0],[2434,25,2434,65,0],[2435,21,2435,22,0],[2436,21,2436,57,0],[2437,21,2437,53,0],[2439,17,2439,18,0],[2440,13,2440,14,0],[2441,9,2441,10,1],[2444,9,2444,10,1],[2445,13,2445,74,1],[2446,13,2446,101,1],[2447,13,2447,89,1],[2448,13,2448,70,1],[2449,13,2451,81,1],[2452,13,2452,40,1],[2453,9,2453,10,1],[2456,9,2456,10,1],[2457,13,2457,42,1],[2458,13,2458,84,1],[2459,13,2459,73,1],[2460,13,2460,69,1],[2461,13,2462,24,1],[2463,13,2463,28,1],[2464,13,2464,36,1],[2465,13,2466,40,1],[2467,9,2467,10,1],[2474,9,2474,10,1],[2475,13,2475,52,1],[2476,13,2476,63,1],[2477,13,2477,114,1],[2478,13,2478,92,1],[2479,13,2479,117,1],[2480,13,2480,122,1],[2481,13,2481,42,1],[2482,13,2482,51,1],[2484,13,2484,77,1],[2485,13,2485,14,1],[2486,17,2486,93,1],[2487,17,2487,96,1],[2488,17,2488,117,1],[2489,13,2489,14,1],[2490,13,2490,67,1],[2491,13,2491,14,1],[2492,17,2492,83,1],[2493,17,2493,86,1],[2494,17,2494,106,1],[2495,17,2495,96,1],[2496,13,2496,14,1],[2497,13,2497,65,1],[2498,13,2498,14,0],[2499,17,2499,81,0],[2500,17,2500,84,0],[2501,17,2501,110,0],[2502,17,2502,80,0],[2503,13,2503,14,0],[2504,13,2504,75,1],[2505,13,2505,14,1],[2506,17,2506,91,1],[2507,17,2507,94,1],[2508,17,2508,114,1],[2509,17,2509,100,1],[2510,13,2510,14,1],[2511,13,2511,80,1],[2512,13,2512,14,1],[2513,17,2513,96,1],[2514,17,2514,99,1],[2515,17,2516,57,1],[2517,13,2517,14,1],[2519,13,2519,70,1],[2520,13,2520,14,0],[2521,17,2521,86,0],[2522,17,2522,89,0],[2523,17,2523,97,0],[2524,17,2524,120,0],[2525,13,2525,14,0],[2526,9,2526,10,1]]);
    </script>
  </body>
</html>