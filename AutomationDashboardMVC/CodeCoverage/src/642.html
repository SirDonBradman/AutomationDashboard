<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Business Layer\UserControls\ExpressionDesigner.ascx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.IO;
using System.Linq;
using System.Runtime.Serialization.Json;
using System.Text;
using System.Web.UI;
using System.Web.UI.WebControls;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.Brix.Evaluator;
using Aurigo.Common;
using System.Web;
using Aurigo.AMP3.Common;

namespace ExpressionDesigner
{
    public partial class ExpressionDesigner : UserControl, ICallbackEventHandler
    {
        #region Delegates

        public delegate string MarkDirty(bool bVal);

        #endregion

        private const String EmptyExpressionImage = @&quot;~\Images\EmptyContainer.gif&quot;;
        private const String EmptyContainerImage = @&quot;~\Images\EmptyContainer.gif&quot;;
        private const String NumericExpressionImage = @&quot;~\Images\NumericExpression.gif&quot;;
        private const String TextExpressionImage = @&quot;~\Images\TextExpression.gif&quot;;
        private const String BooleanExpressoinImage = @&quot;~\Images\BooleanExpression.gif&quot;;
        private const String DateExpressionImage = @&quot;~\Images\DateExpression.bmp&quot;;
        private const String ConditionImage = @&quot;~\Images\QuestionMark.gif&quot;;

        private const String ContainerText = &quot;Add Condition Or Expression&quot;;
        private const String IfConditionExpression = &quot;If:(Boolean) Expression&quot;;
        private const String ElseExpression = &quot;Else:&quot;;
        private const String SelectedParameters = &quot;SelectedParameters&quot;;
        private const String UsedParameters = &quot;UsedParameters&quot;;
        private string _CallbackString;
        private string _CurrentAction;
        private bool _DisableChangingExpType;
        protected ExprUIParams _UIParams;

        #region ICallbackEventHandler Members

        public string GetCallbackResult()
        {
            return _CallbackString;
        }

        public void RaiseCallbackEvent(string eventArgument)
        {
            var jsonSerialiser = new DataContractJsonSerializer(typeof(ajaxUIData));
            var stream1 = new MemoryStream();
            stream1.Write(Encoding.Unicode.GetBytes(eventArgument), 0, Encoding.Unicode.GetBytes(eventArgument).Length);
            stream1.Position = 0;
            var values = (ajaxUIData)jsonSerialiser.ReadObject(stream1);
            try
            {
                if (values.action == &quot;InitializeResPicker&quot;)
                {
                    string[] contents = values.otherdata.Split(&#39;~&#39;);
                    string inputSession = contents.Length &gt; 1
                        ? contents[0]
                        : string.IsNullOrEmpty(values.otherdata)
                            ? &quot;PickerFirstLevel&quot;
                            : values.otherdata;
                    string restrict = contents.Length &gt; 1 ? contents[1] : &quot;&quot;;
                    string sSelectedParam = contents.Length &gt; 1 ? contents[0] : &quot;&quot;;
                    var p = new PickerParams();
                    p.AllowCustomParameters = false;
                    p.AdditionalHostResources = _UIParams.PickerContextResources;
                    p.ResourceContextsToFilter = _UIParams.PickerContexts;
                    p.IsMappingMode = false;
                    p.Providers = AppProviderManager.Instance.Providers(ConnectionHelper.GetCurrentCompany());
                    p.RestrictOutputParamsToType = restrict;
                    p.GetRIByResourceID += new GetInstanceByResourceID(p_GetRIByResourceID);
                    IParam pm = _UIParams.Exp._HostParams.GetParam(values.what);
                    if (null != pm)
                    {
                        if (!string.IsNullOrWhiteSpace(pm.DerivedFrom) &amp;&amp;
                            _UIParams.Exp._HostResourceInstances.ContainsKey(pm.DerivedFrom))
                            p.InResInstance = _UIParams.Exp._HostResourceInstances[pm.DerivedFrom];
                    }

                    //Session[inputSession] = p;
                    HttpContext.Current.Cache.Insert(Session.SessionID + &quot;_&quot; + inputSession, p, null, System.Web.Caching.Cache.NoAbsoluteExpiration, TimeSpan.FromMinutes(AMP3ApplicationSettings.Instance.SessionTimeout));

                    if (null != ExpPickerIsBeingLaunched) ExpPickerIsBeingLaunched(true);
                    _CallbackString = &quot;OK&quot;;
                }
                if (values.action == &quot;GetNodeValues&quot;)
                {
                    ajaxUIData data = OnNodeClick(values);
                    _CallbackString = &quot;OK&quot; + WebUtilities.WriteAjaxUIText(jsonSerialiser, stream1, data);
                }
                if (values.action == &quot;AddCondition&quot;)
                {
                    ajaxUIData data = AddCondition(values);
                    _CallbackString = &quot;OK&quot; + WebUtilities.WriteAjaxUIText(jsonSerialiser, stream1, data);
                }
                if (values.action == &quot;AddExpression&quot;)
                {
                    ajaxUIData data = AddExpression(values);
                    _CallbackString = &quot;OK&quot; + WebUtilities.WriteAjaxUIText(jsonSerialiser, stream1, data);
                }
                if (values.action == &quot;RemoveNode&quot;)
                {
                    ajaxUIData data = RemoveNode(values);
                    _CallbackString = &quot;OK&quot; + WebUtilities.WriteAjaxUIText(jsonSerialiser, stream1, data);
                }
                if (values.action == &quot;UpdateNode&quot;)
                {
                    ajaxUIData data = UpdateNode(values);
                    _CallbackString = &quot;OK&quot; + WebUtilities.WriteAjaxUIText(jsonSerialiser, stream1, data);
                }
                if (values.action == &quot;ValidateExpression&quot;)
                {
                    ajaxUIData data = ValidateExpression(values);
                    _CallbackString = &quot;OK&quot; + WebUtilities.WriteAjaxUIText(jsonSerialiser, stream1, data);
                }
                if (values.action == &quot;SaveExpression&quot;)
                {
                    ajaxUIData data = SaveExpression(values);
                    _CallbackString = &quot;OK&quot; + WebUtilities.WriteAjaxUIText(jsonSerialiser, stream1, data);
                }
                if (values.action == &quot;SaveExpressionAsDraft&quot;)
                {
                    ajaxUIData data = SaveExpression(values, true);
                    _CallbackString = &quot;OK&quot; + WebUtilities.WriteAjaxUIText(jsonSerialiser, stream1, data);
                }
                if (values.action == &quot;RemoveParameter&quot;)
                {
                    ajaxUIData data = RemoveParmeter(values);
                    _CallbackString = &quot;OK&quot; + WebUtilities.WriteAjaxUIText(jsonSerialiser, stream1, data);
                }
                if (values.action == &quot;SaveCustomParameter&quot;)
                {
                    ajaxUIData data = SaveCustomParameter(values);
                    _CallbackString = &quot;OK&quot; + WebUtilities.WriteAjaxUIText(jsonSerialiser, stream1, data);
                }
            }
            catch (Exception exeption)
            {
                _CallbackString = exeption.Message;
            }
        }

        IResourceInstance p_GetRIByResourceID(string resourceID)
        {
            IResourceInstance res = null;
            KeyValuePair&lt;string, IResourceInstance&gt; kvp = new KeyValuePair&lt;string, IResourceInstance&gt;();
            if (null != _UIParams.Exp &amp;&amp; null != _UIParams.Exp._HostResourceInstances)
            {
                kvp =
                    _UIParams.Exp._HostResourceInstances.FirstOrDefault(
                        x =&gt; x.Value.ResourceId.Equals(resourceID, StringComparison.CurrentCultureIgnoreCase));
                res = kvp.Value;
            }
            if (null != res) return res;
            if (null != _UIParams.Exp &amp;&amp; null != _UIParams.Exp._EffectiveResourceInstances)
            {
                kvp =
                    _UIParams.Exp._EffectiveResourceInstances.FirstOrDefault(
                        x =&gt; x.Value.ResourceId.Equals(resourceID, StringComparison.CurrentCultureIgnoreCase));
                res = kvp.Value;
            }
            return res;
        }

        #endregion

        #region PostCallbackMethods

        private ajaxUIData OnNodeClick(ajaxUIData values)
        {
            string[] paths = null;
            string sToSplit = values.otherdata.Substring(1);
            if (!string.IsNullOrEmpty(values.otherdata)) paths = sToSplit.Split(&#39;\\&#39;);

            string id = paths[paths.Length - 1];

            var ex = new Expr { Id = id };
            ExpNode nd = _UIParams.Exp.FindNode(ex);
            var data = new ajaxUIData();

            if (null == nd) throw new Exception(&quot;Node not found.&quot;);

            string script =
                string.Format(
                    &quot;{0}.innerHTML=&#39;{1}&#39;;document.getElementById(&#39;{2}&#39;).value=&#39;{3}&#39;;document.getElementById(&#39;{4}&#39;).value=&#39;{5}&#39;;&quot;,
                    lblExpressionType.ClientID,
                    nd._Details.NodeType == Expr.ExpType_Condition ? &quot;Boolean&quot; : _UIParams.Exp.Type,
                    txtNodeName.ClientID, HttpUtility.JavaScriptStringEncode(nd._Details.Name),
                    txtExpression.ClientID,
                    nd._Details.Expression == null ? &quot;&quot; : HttpUtility.JavaScriptStringEncode(nd._Details.Expression.Replace(Environment.NewLine, &quot;\\n&quot;)));

            data.srcdata = script;
            data.srcobject = txtExpression.ClientID;
            data.how = nd.CanEdit().ToString();
            data.destdata += expressionDiv.ClientID + &quot;=&quot; + data.how + &quot;,&quot;;
            data.destdata += btnAddCondition.ClientID + &quot;=&quot; + nd.CanAddChildCondition() + &quot;,&quot;;
            data.destdata += btnAddExpression.ClientID + &quot;=&quot; + nd.CanAddChildStatement() + &quot;,&quot;;
            data.destdata += btnRemove.ClientID + &quot;=&quot; +
                             (nd.CanRemove() &amp;&amp; _UIParams.Exp.RootNode._Details.Id != nd._Details.Id);
            return data;
        }

        private ajaxUIData AddCondition(ajaxUIData val)
        {
            string[] paths = null;
            string sToSplit = val.otherdata.Substring(1);
            if (!string.IsNullOrEmpty(val.otherdata)) paths = sToSplit.Split(&#39;\\&#39;);

            string id = paths[paths.Length - 1];

            var ex = new Expr { Id = id };
            ExpNode nd = _UIParams.Exp.FindNode(ex);
            var data = new ajaxUIData();

            if (null == nd) throw new Exception(&quot;No node is selected or Selected node is not found.&quot;);
            if (!nd.CanAddChildCondition()) throw new Exception(&quot;Condition cannot be added to this node.&quot;);

            ExpNode ifchild = nd.AddCondition();
            if (null == ifchild) throw new Exception(&quot;Failed adding condition to this node.&quot;);

            return data;
        }

        private ajaxUIData AddExpression(ajaxUIData val)
        {
            string[] paths = null;
            string sToSplit = val.otherdata.Substring(1);
            if (!string.IsNullOrEmpty(val.otherdata)) paths = sToSplit.Split(&#39;\\&#39;);

            string id = paths[paths.Length - 1];

            var ex = new Expr { Id = id };
            ExpNode nd = _UIParams.Exp.FindNode(ex);
            var data = new ajaxUIData();

            if (null == nd) throw new Exception(&quot;No node is selected or Selected node is not found.&quot;);
            bool bAlreadyExists;
            ExpNode ifchild = nd.AddDefaultStatement(false, out bAlreadyExists);

            //data.destobject = ifchild.NodePath;

            return data;
        }

        private ajaxUIData UpdateNode(ajaxUIData val)
        {
            string[] paths = null;
            string sToSplit = val.otherdata.Substring(1);
            if (!string.IsNullOrEmpty(val.otherdata)) paths = sToSplit.Split(&#39;\\&#39;);

            string id = paths[paths.Length - 1];

            var ex = new Expr { Id = id };
            ExpNode nd = _UIParams.Exp.FindNode(ex);
            var data = new ajaxUIData();

            if (null == nd) throw new Exception(&quot;No node is selected or Selected node is not found.&quot;);
            nd._Details.Expression = val.when;
            nd._Details.Name = val.what;

            return data;
        }

        private ajaxUIData ValidateExpression(ajaxUIData values)
        {
            var data = new ajaxUIData();

            string errs;
            _UIParams.Exp.ValidateStructure(out errs);

            string code = &quot;&quot;;
            if (string.IsNullOrEmpty(errs)) _UIParams.Exp.CompileToValidate(out errs, out code);

            if (string.IsNullOrWhiteSpace(errs))
            {
                data.destobject = &quot;Validation Successful&quot;;
                data.what = &quot;success&quot;;
            }
            else
            {
                data.destobject = errs + &quot;\n&quot; + code;
                data.what = &quot;error&quot;;
            }


            return data;
        }

        //private string EvaluateToValidate(string errs)
        //{
        //    object o = null;
        //    DBExpTree dyu = new DBExpTree();
        //    dyu.Id = _UIParams.Exp.Id;
        //    dyu.LoadFromDB(null, out errs);
        //    try
        //    {
        //        Resolve r = new Resolve(dyu_ResolveParams);
        //        dyu.ResolveParams += r;
        //        o = dyu.Evaluate(out errs);
        //        dyu.ResolveParams -= r;
        //    }
        //    catch (Exception ex) { tvExpressionTree.Nodes[0].Text = tvExpressionTree.Nodes[0].Text + &quot; eval : &quot; + ex.Message; }
        //    return errs;
        //}
        private ajaxUIData RemoveNode(ajaxUIData val)
        {
            string[] paths = null;
            string sToSplit = val.otherdata.Substring(1);
            if (!string.IsNullOrEmpty(val.otherdata)) paths = sToSplit.Split(&#39;\\&#39;);

            string id = paths[paths.Length - 1];

            var ex = new Expr { Id = id };
            ExpNode nd = _UIParams.Exp.FindNode(ex);
            var data = new ajaxUIData();

            if (null == nd) throw new Exception(&quot;No node is selected or Selected node is not found.&quot;);
            if (null != nd._Parent)
            {
                nd._Parent.RemoveChildNode(nd);
                data.destobject = nd.Parent.NodePath;
            }

            return data;
        }

        private ajaxUIData SaveExpression(ajaxUIData values = null, bool bAsDraft = false)
        {
            var data = new ajaxUIData();

            string errs;
            string code;
            SaveExpression(values, bAsDraft, out errs, out code);

            if (string.IsNullOrWhiteSpace(errs))
            {
                data.destobject = &quot;Saved Successfully&quot;;
                data.what = &quot;success&quot;;
            }
            else
            {
                data.destobject = errs + &quot;\n&quot; + code;
                data.what = &quot;error&quot;;
            }

            data.what = _UIParams.Exp.Name;

            return data;
        }

        private ajaxUIData RemoveParmeter(ajaxUIData val)
        {
            var data = new ajaxUIData();
            _UIParams.Exp.RemoveSelectedParam(val.otherdata);
            return data;
        }

        private ajaxUIData SaveCustomParameter(ajaxUIData val)
        {
            var data = new ajaxUIData();
            _UIParams.Exp.AddUpdateSelectedParam(new Param(val.otherdata, val.when, val.what));
            return data;
        }

        private object ge_GV(string sParam)
        {
            switch (sParam)
            {
                case &quot;d1&quot;:
                    return DateTime.UtcNow.AddDays(3);
                case &quot;d2&quot;:
                    return &quot;10/11/2010&quot;;
                case &quot;s1&quot;:
                    return &quot;test santa banta&quot;;
                case &quot;s2&quot;:
                    return &quot;cfc kkkk oo&quot;;
                case &quot;f1&quot;:
                    return 2222245.43;
                case &quot;b1&quot;:
                    return true;
                case &quot;b2&quot;:
                    return false;
                case &quot;i1&quot;:
                    return &quot;345&quot;;
                default:
                    return 34;
            }
        }

        //IParam dyu_ResolveParams(object sender, IParam e)
        //{
        //    Param p = new Param();
        //    p.Name = e.Name;

        //    switch (e.Name)
        //    {
        //        case &quot;d1&quot;: p.Value = DateTime.UtcNow.AddDays(3); break;
        //        case &quot;d2&quot;: p.Value = &quot;10/11/2010&quot;; break;
        //        case &quot;s1&quot;: p.Value = &quot;test santa banta&quot;; break;
        //        case &quot;s2&quot;: p.Value = &quot;cfc kkkk oo&quot;; break;
        //        case &quot;f1&quot;: p.Value = 2222245.43; break;
        //        case &quot;b1&quot;: p.Value = true; break;
        //        case &quot;b2&quot;: p.Value = false; break;
        //        case &quot;i1&quot;: p.Value = &quot;345&quot;; break;
        //        default: p.Value = 235; break;
        //    }
        //    return p;
        //}

        #endregion

        #region Generic Code

        private int GetCheckedNodeIndex(TreeNodeCollection nodes)
        {
            int index;
            for (index = 0; index &lt; nodes.Count; index++)
            {
                if (nodes[index].Checked)
                    break;
            }
            return index;
        }

        private void CheckSelectedNode()
        {
            while (tvExpressionTree.CheckedNodes.Count &gt; 0)
            {
                tvExpressionTree.CheckedNodes[0].Checked = false;
            }
            tvExpressionTree.SelectedNode.Checked = true;
        }

        private void ClearCheckedNodes()
        {
            while (tvExpressionTree.CheckedNodes.Count &gt; 0)
            {
                tvExpressionTree.CheckedNodes[0].Checked = false;
            }
        }

        #endregion

        public event MarkDirty ExpPickerIsBeingLaunched;

        protected void Page_Load(object sender, EventArgs e)
        {
            lblError.Text = String.Empty;

            if (!IsPostBack &amp;&amp; !Page.IsCallback)
            {
                txtExpressionName.Text = _UIParams.Exp.Name;
                txtDescription.Text = _UIParams.Exp.Description;
                ddlOutputDataType.SelectedValue = _UIParams.Exp.Type;
            }
            if (IsPostBack)
            {
                _UIParams.Exp.Name = txtExpressionName.Text;
                _UIParams.Exp.Type = ddlOutputDataType.SelectedValue;
                _UIParams.Exp.Description = txtDescription.Text;
            }
            if (Page.IsCallback) return;

            if (_DisableChangingExpType) ddlOutputDataType.Enabled = false;

            string sErrors = &quot;&quot;;
            InitializeTree(sErrors);
            UpdateTreeBehaviourToUseAjax(tvExpressionTree);
            AddAjaxScriptToButtons();
            ProcessPostAjaxActions();
            if (_UIParams.Exp._HostParams != null)
            {
                BindParameterGrid(_UIParams.Exp._HostParams.Contents.Values.ToList());
            }
        }

        public void InitDefinition(ExprUIParams uiParams, bool bDisableChangingExpType = false)
        {
            _UIParams = uiParams;
            _DisableChangingExpType = bDisableChangingExpType;
            if (null != _UIParams &amp;&amp; null != _UIParams.Exp &amp;&amp; (!Page.IsCallback &amp;&amp; !IsPostBack))
            {
                foreach (string s in _UIParams.HostParams.GetKeys())
                {
                    if (_UIParams.Exp._HostParams.Exists(s)) continue;
                    _UIParams.Exp._HostParams.SetParam(_UIParams.HostParams.GetParam(s));
                }
            }
        }

        public string GetSaveButtonScript(string btnClientId, bool bIsSaveAsDraft = false,
            bool bRedirectAfterSave = true, string sPostSaveRedirectPage = &quot;&quot;)
        {
            if (string.IsNullOrEmpty(sPostSaveRedirectPage))
                sPostSaveRedirectPage = Page.AppRelativeVirtualPath.Substring(2);
            string redirectAfterSuccessfulAjax = bRedirectAfterSave
                ? string.Format(&quot;RedirectAfterSuccessfulAjax({{0}},\&quot;{0}\&quot;);&quot;,
                    sPostSaveRedirectPage)
                : sPostSaveRedirectPage; //sPostSaveRedirectPage is a script
            string ajaxServerParamsForSave = string.Format(
                &quot;GetID(&#39;{0}&#39;).value, GetID(&#39;{1}&#39;).value, GetID(&#39;{2}&#39;).value&quot;, txtExpressionName.ClientID,
                ddlOutputDataType.ClientID, txtDescription.ClientID);
            string sSaveScript = WebUtilities.AjaxWithCustomScriptAfterCall(
                Page.ClientScript,
                GetType(),
                this,
                btnClientId,
                bIsSaveAsDraft ? &quot;SaveExpressionAsDraft&quot; : &quot;SaveExpression&quot;,
                ajaxServerParamsForSave, redirectAfterSuccessfulAjax, &quot;OK&quot;);
            return sSaveScript;
        }

        public DBExpTree SaveExpression(ajaxUIData values, bool bAsDraft, out string errs, out string code)
        {
            _UIParams.Exp.Name = null == values ? txtExpressionName.Text : values.otherdata;
            _UIParams.Exp.Type = null == values ? ddlOutputDataType.SelectedValue : values.what;
            _UIParams.Exp.Description = null == values ? txtDescription.Text : values.when;

            errs = &quot;&quot;;
            if (!bAsDraft) _UIParams.Exp.ValidateStructure(out errs);
            if (!string.IsNullOrWhiteSpace(errs)) throw new Exception(errs);

            code = &quot;&quot;;
            if (null != _UIParams.Exp._EffectiveParams)
            {
                foreach (ExpTree&lt;DBNode&gt;.ParamWithType p in _UIParams.Exp._EffectiveParams.Values)
                {
                    if (null == p.p) continue;
                    IParam prm = _UIParams.HostParams.GetParam(p.p.Name);
                    if (null == prm) continue;
                    p.p.DerivedPath = prm.DerivedPath;
                    p.p.DerivedFrom = prm.DerivedFrom;
                    p.p.AdditionalPath = prm.AdditionalPath;
                    if (!string.IsNullOrEmpty(p.p.DerivedPath) || !string.IsNullOrEmpty(p.p.DerivedFrom) ||
                        !string.IsNullOrEmpty(p.p.AdditionalPath))
                        p.p.IsDerived = true;
                }
            }
            if (!_UIParams.Exp.SaveToDB(bAsDraft, out errs, out code)) throw new Exception(errs);
            if (!string.IsNullOrWhiteSpace(errs)) throw new Exception(errs);
            return _UIParams.Exp;
        }

        #region PageLifeCycleMethods

        private void InitializeTree(string sErrors)
        {
            var tn = new TreeNode();
            if (null != _UIParams.Exp.RootNode._Details)
            {
                // To fix XSS attack
                tn.Text = HttpUtility.HtmlEncode(_UIParams.Exp.RootNode._Details.Name);
                tn.Value = _UIParams.Exp.RootNode._Details.Id;
            }
            tvExpressionTree.Nodes.Add(tn);
            if (null != _UIParams.Exp.RootNode._Children || _UIParams.Exp.RootNode._Children.Count &gt; 0)
            {
                foreach (ExpNode rn in _UIParams.Exp.RootNode._Children) FillNode(rn, tn);
                tvExpressionTree.Nodes[0].Text = tvExpressionTree.Nodes[0].Text + &quot;: &quot; + sErrors;
                string path = hdnTreeClicked.Value.Length &gt; 1 ? hdnTreeClicked.Value.Substring(1) : hdnTreeClicked.Value;
                path = path.Replace(&#39;\\&#39;, &#39;/&#39;);
                tn = tvExpressionTree.FindNode(path);
                if (null != tn) tn.Select();
            }
            txtExpression.ToolTip =
                @&quot;Example:
foreach(string s in [StringArrayVariable]) {
    //Some code here
}
[AnyVariable].ToString();
[NumericArrayVariable].Sum();
[NumericArrayVariable].Count();
[NumericArrayVariable].Average();
[NumericArrayVariable].Max();
[NumericArrayVariable].Min();
Math.Max([NumericVariable], 5);
DateTime.UtcNow;
[DateVariable].AddDays(4);
[DateVariable].AddMonths(1); [DateVariable].AddYears(1);
[DateVariable].Subtract([AnotherDateVariable]).Days;
[DateVariable].Subtract([AnotherDateVariable]).Hours;
[DateVariable].Subtract([AnotherDateVariable]).Minutes;
[StringVariable].AsDate(); [StringVariable].AsNumeric();
[StringVariable].Contains(&quot;&quot;abc&quot;&quot;);
[StringVariable].Replace(&quot;&quot;abc&quot;&quot;, &quot;&quot;pqr&quot;&quot;);
[StringVariable].Lenght;
[StringVariable].Substring(4,4);
&quot;;
            expressionDiv.Style.Add(&quot;display&quot;, &quot;none&quot;);
        }

        private void UpdateTreeBehaviourToUseAjax(TreeView tvw)
        {
            var sv = new StringBuilder();
            string setHref =
                @&quot; function setHref{0}(){{
                                    var treeLinks = document.getElementById(&#39;{0}&#39;).getElementsByTagName(&#39;A&#39;);
                                    for (var i = 0; i &lt; treeLinks.length; i++)
                                    if (treeLinks[i].href.indexOf(&#39;__doPostBack&#39;) != -1) 
                                    treeLinks[i].href = treeLinks[i].href.replace(&#39;__doPostBack&#39;, &#39;OnTreeNodeClick{0}&#39;);
                                    if(Sys != null &amp;&amp; Sys.WebForms != undefined)
                                            Sys.WebForms.PageRequestManager.getInstance().add_endRequest(setHref{0});
                                }}
                                setHref{0}();
                                function MarkTreeClicked(tnodePath) {{document.getElementById(&#39;{1}&#39;).value = tnodePath; }}&quot;;

            sv.AppendFormat(setHref, tvw.ClientID, hdnTreeClicked.ClientID);
            ScriptManager.RegisterStartupScript(this, GetType(), &quot;RestoreTreeviewClick&quot;, sv.ToString(), true);

            string ajx = WebUtilities.AjaxWithCustomScriptAfterCall(
                Page.ClientScript,
                GetType(),
                this,
                tvw.ClientID,
                &quot;GetNodeValues&quot;,
                &quot;tnodePath&quot;, &quot;FillNodeValues({0});&quot;, &quot;OK&quot;);
            sv.Clear();
            sv.AppendFormat(
                @&quot;
                                function OnTreeNodeClick{1}(tvwName, tnodePath) {{
                                    MarkTreeClicked(tnodePath);
                                    {0};
                                }}&quot;,
                ajx, tvw.ClientID);
            ScriptManager.RegisterStartupScript(tvw, GetType(), &quot;OnTreeNodeClickCustom&quot;, sv.ToString(), true);
        }

        private void AddAjaxScriptToButtons()
        {
            txtExpression.Attributes.Add(&quot;onkeyup&quot;, &quot;return ExpKeyUp(event)&quot;);
            txtExpression.Attributes.Add(&quot;onkeydown&quot;, &quot;return ExpKeyDown(event)&quot;);
            txtExpression.Attributes.Add(&quot;onmouseup&quot;, &quot;return RetainExpCaretPos(event, this)&quot;);
            txtExpression.Attributes.Add(&quot;onkeyup&quot;, &quot;return RetainExpCaretPos(event, this)&quot;);
            txtExpression.Style.Add(&quot;font-family&quot;, &quot;Verdana&quot;);
            string doPostback = string.Format(&quot;DoPostbackAfterAjax({{0}},&#39;{0}&#39;);&quot;, btnAddExpression.ClientID);
            string ajx = WebUtilities.AjaxWithCustomScriptAfterCall(
                Page.ClientScript,
                GetType(),
                this,
                btnAddExpression.ClientID,
                &quot;AddExpression&quot;,
                hdnTreeClicked.ClientID + &quot;.value&quot;, doPostback, &quot;OK&quot;);
            btnAddExpression.Attributes.Add(&quot;onclick&quot;, ajx);

            doPostback = string.Format(&quot;SetSelectedNodeAjx({{0}}, &#39;{1}&#39;); DoPostbackAfterAjax({{0}},&#39;{0}&#39;);&quot;,
                btnAddCondition.ClientID, hdnTreeClicked.ClientID);
            ajx = WebUtilities.AjaxWithCustomScriptAfterCall(
                Page.ClientScript,
                GetType(),
                this,
                btnAddCondition.ClientID,
                &quot;AddCondition&quot;,
                hdnTreeClicked.ClientID + &quot;.value&quot;, doPostback, &quot;OK&quot;);
            btnAddCondition.Attributes.Add(&quot;onclick&quot;, ajx);

            doPostback = string.Format(&quot;SetSelectedNodeAjx({{0}}, &#39;{1}&#39;);DoPostbackAfterAjax({{0}},&#39;{0}&#39;);&quot;,
                btnRemove.ClientID, hdnTreeClicked.ClientID);
            ajx = WebUtilities.AjaxWithCustomScriptAfterCall(
                Page.ClientScript,
                GetType(),
                this,
                btnRemove.ClientID,
                &quot;RemoveNode&quot;,
                hdnTreeClicked.ClientID + &quot;.value&quot;, doPostback, &quot;OK&quot;);
            btnRemove.Attributes.Add(&quot;onclick&quot;, ajx);

            ajx = WebUtilities.AjaxWithCustomScriptAfterCall(
                Page.ClientScript,
                GetType(),
                this,
                btnValidate.ClientID,
                &quot;ValidateExpression&quot;,
                hdnTreeClicked.ClientID + &quot;.value&quot;, &quot;AlertAfterValidation({0});&quot;, &quot;OK&quot;);
            btnValidate.Attributes.Add(&quot;onclick&quot;, ajx);

            doPostback = string.Format(&quot;SetSelectedNodeAjx({{0}}, &#39;{1}&#39;); DoPostbackAfterAjax({{0}},&#39;{0}&#39;);&quot;,
                btnApply.ClientID, hdnTreeClicked.ClientID);
            string ajaxServerParamsForUpdate =
                string.Format(&quot;GetID(&#39;{0}&#39;).value, GetID(&#39;{1}&#39;).value, GetID(&#39;{2}&#39;).value&quot;, hdnTreeClicked.ClientID,
                    txtNodeName.ClientID, txtExpression.ClientID);
            ajx = WebUtilities.AjaxWithCustomScriptAfterCall(
                Page.ClientScript,
                GetType(),
                this,
                btnApply.ClientID,
                &quot;UpdateNode&quot;,
                ajaxServerParamsForUpdate, doPostback, &quot;OK&quot;);
            btnApply.Attributes.Add(&quot;onclick&quot;, ajx);

            string sPopup = WebUtilities.ModalWindowScriptWithPostBackAfterShow(
                Page.ClientScript,
                GetType(),
                this,
                Server,
                btnAddResource.ClientID,
                &quot;InitializeResPicker&quot;,
                &quot;GetID(&#39;&quot; + hdnSelectedParameter.ClientID + &quot;&#39;).value&quot;,
                &quot;PickerFirstLevel&quot;,
                Request.Url.Scheme + &quot;://&quot; + Request.Url.Authority + &quot;/Modules/Workflw/ExprPickerDialog.aspx&quot;,
                &quot;&quot;,
                hdnActionInfo.ClientID,
                &quot;Add ResouceInstance&quot;,
                &quot;Aurigo.Workflow.ExternalCallInstance~None&quot;,
                Utilities.GetUnique(Evaluator.Inst.GetRandomizer(), 8));
            btnAddResource.Attributes.Add(&quot;onclick&quot;, sPopup);

            string deleteRow =
                string.Format(
                    &quot;var dothis = {{0}}; var row = igtbl_getActiveRow(&#39;{0}&#39;); if(undefined !=row) {{{{row.remove(); row.deleteRow();}}}}&quot;,
                    grdMainOutputParameters.ClientID);
            ajx = WebUtilities.AjaxWithCustomScriptAfterCall(
                Page.ClientScript,
                GetType(),
                this,
                btnRemoveParameter.ClientID,
                &quot;RemoveParameter&quot;,
                &quot;GetID(&#39;&quot; + hdnSelectedParameter.ClientID + &quot;&#39;).value&quot;, deleteRow, &quot;OK&quot;);
            btnRemoveParameter.Attributes.Add(&quot;onclick&quot;, ajx);
            //string sval = WebUtilities.ConstructAjaxActionPostBackString(Server, ajx, &quot;todo&quot;, &quot;Remove&quot;);

            doPostback = string.Format(&quot;GetID(&#39;{0}&#39;).style.display = &#39;none&#39;; DoPostbackAfterAjax({{0}},&#39;{0}&#39;);&quot;,
                btnSaveCustomParameter.ClientID);
            ajaxServerParamsForUpdate = string.Format(&quot;GetID(&#39;{0}&#39;).value, GetID(&#39;{1}&#39;).value, GetID(&#39;{2}&#39;).value&quot;,
                txtCustomParamName.ClientID, ddlCustomParamterType.ClientID,
                txtCustomParameterValue.ClientID);
            ajx = WebUtilities.AjaxWithCustomScriptAfterCall(
                Page.ClientScript,
                GetType(),
                this,
                btnSaveCustomParameter.ClientID,
                &quot;SaveCustomParameter&quot;,
                ajaxServerParamsForUpdate, doPostback, &quot;OK&quot;);
            btnSaveCustomParameter.Attributes.Add(&quot;onclick&quot;, ajx);
            btnAddCustomParam.Attributes.Add(&quot;onclick&quot;,
                &quot;GetID(&#39;&quot; + trCustomParameter.ClientID + &quot;&#39;).style.display = &#39;&#39;;&quot;);
            btnAddCustomParam.Visible = _UIParams.ShowCustom;
            btnCloseCustomParameter.Attributes.Add(&quot;onclick&quot;,
                &quot;GetID(&#39;&quot; + trCustomParameter.ClientID + &quot;&#39;).style.display = &#39;none&#39;;&quot;);
            btnClose.Attributes.Add(&quot;onclick&quot;, &quot;GetID(&#39;&quot; + expressionDiv.ClientID + &quot;&#39;).style.display=&#39;none&#39;;&quot;);
            return;
        }

        private void BindParameterGrid(List&lt;IParam&gt; parameterUsed)
        {
            grdMainOutputParameters.Clear();
            if (parameterUsed.Count == 0) return;

            var dt = new DataTable();
            dt.Columns.AddRange(new[]
            {
                new DataColumn(&quot;Name&quot;),
                new DataColumn(&quot;Type&quot;),
                new DataColumn(&quot;IsArray&quot;),
                new DataColumn(&quot;InstanceID&quot;)
            });

            DataRow dr;
            foreach (IParam parameter in parameterUsed)
            {
                dr = dt.NewRow();
                dr[&quot;Name&quot;] = parameter.Name;
                dr[&quot;Type&quot;] = parameter.Type;
                dr[&quot;IsArray&quot;] = parameter.IsArrayType;
                dr[&quot;InstanceID&quot;] = parameter.DerivedFrom;
                dt.Rows.Add(dr);
            }

            grdMainOutputParameters.DataSource = dt;
            grdMainOutputParameters.DataBind();
        }

        private void ProcessPostAjaxActions()
        {
            _CurrentAction = hdnActionInfo.Value;
            hdnActionInfo.Value = &quot;&quot;;
            string[] actions = !string.IsNullOrEmpty(_CurrentAction) ? _CurrentAction.Split(&#39;|&#39;) : null;
            string[] actionContents = (actions != null) ? actions[0].Split(&#39;~&#39;) : null;
            string sAction = (actionContents != null) ? actionContents[0] : null;
            if (sAction == &quot;Add ResouceInstance&quot;)
            {
                //var p = (PickerParams)Session[&quot;PickerFirstLevel&quot;];
                //Session.Remove(&quot;PickerFirstLevel&quot;);
                string key = Session.SessionID + &quot;_&quot; + &quot;PickerFirstLevel&quot;;
                var p = (PickerParams)HttpContext.Current.Cache[key];
                HttpContext.Current.Cache.Remove(key);

                if (!p.IsCancelled &amp;&amp; null != p.InResInstance)
                {
                    _UIParams.Exp.AddUpdateSelectedParam(p.InResInstance);
                }
            }
        }

        private void FillNode(string id, TreeNode tnParent)
        {
            var ex = new Expr { Id = id };
            ExpNode nd = _UIParams.Exp.FindNode(ex);
            foreach (ExpNode rn in nd._Children) FillNode(rn, tnParent);
        }

        private void FillNode(ExpNode nd, TreeNode tnParent)
        {
            var tn = new TreeNode();
            if (null != nd._Details)
            {
                tn.Text = HttpUtility.HtmlEncode(Expr.ExpType_Condition == nd._Details.NodeType
                    ? &quot;if &quot; + nd._Details.Name
                    : Expr.ExpType_CodeBlock == nd._Details.NodeType
                        ? nd._Details.Name
                        : &quot;else &quot; + nd._Details.Name);
                tn.Value = nd._Details.Id;
            }
            tnParent.ChildNodes.Add(tn);
            tnParent.Expand();
            if (null == nd._Children || nd._Children.Count &lt; 1) return;
            foreach (ExpNode rn in nd._Children) FillNode(rn, tn);
        }

        private string GetExpressionImage()
        {
            switch (_UIParams.Exp.Type)
            {
                case &quot;Boolean&quot;:
                    return BooleanExpressoinImage;
                case &quot;Double&quot;:
                    return NumericExpressionImage;
                case &quot;String&quot;:
                    return TextExpressionImage;
                case &quot;DateTime&quot;:
                    return DateExpressionImage;
                case &quot;Boolean[]&quot;:
                    return BooleanExpressoinImage;
                case &quot;Double[]&quot;:
                    return NumericExpressionImage;
                case &quot;String[]&quot;:
                    return TextExpressionImage;
                case &quot;DateTime[]&quot;:
                    return DateExpressionImage;
                default:
                    return EmptyContainerImage;
            }
        }

        private void ShowErrorMessage(string ex)
        {
            lblError.Text = ex;
        }

        #endregion
    }

    [Serializable]
    public class ExprUIParams
    {
        public DBExpTree Exp;
        public IParams HostParams;
        public string Mode;
        public List&lt;IResource&gt; PickerContextResources;
        public List&lt;string&gt; PickerContexts;
        public bool ShowCustom;
        public bool ShowSave;

        public void CreateNewExpression()
        {
            Exp = new DBExpTree();
            Exp._HostParams = new Params(Guid.NewGuid());

            Exp.ExpId = Evaluator.Inst.GetRandomNumber();
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[47,9,47,10,0],[48,13,48,36,0],[49,9,49,10,0],[52,9,52,10,0],[53,13,53,85,0],[54,13,54,46,0],[55,13,55,121,0],[56,13,56,34,0],[57,13,57,73,0],[59,13,59,14,0],[60,17,60,60,0],[61,17,61,18,0],[62,21,62,69,0],[63,21,67,48,0],[68,21,68,78,0],[69,21,69,84,0],[70,21,70,48,0],[71,21,71,53,0],[72,21,72,82,0],[73,21,73,75,0],[74,21,74,45,0],[75,21,75,111,0],[76,21,76,61,0],[77,21,77,93,0],[78,21,78,81,0],[79,21,79,36,0],[80,21,80,22,0],[81,25,82,94,0],[83,29,83,100,0],[84,21,84,22,0],[87,21,87,221,0],[89,21,89,58,0],[89,59,89,90,0],[90,21,90,44,0],[91,17,91,18,0],[92,17,92,54,0],[93,17,93,18,0],[94,21,94,59,0],[95,21,95,106,0],[96,17,96,18,0],[97,17,97,53,0],[98,17,98,18,0],[99,21,99,60,0],[100,21,100,106,0],[101,17,101,18,0],[102,17,102,54,0],[103,17,103,18,0],[104,21,104,61,0],[105,21,105,106,0],[106,17,106,18,0],[107,17,107,51,0],[108,17,108,18,0],[109,21,109,58,0],[110,21,110,106,0],[111,17,111,18,0],[112,17,112,51,0],[113,17,113,18,0],[114,21,114,58,0],[115,21,115,106,0],[116,17,116,18,0],[117,17,117,59,0],[118,17,118,18,0],[119,21,119,66,0],[120,21,120,106,0],[121,17,121,18,0],[122,17,122,55,0],[123,17,123,18,0],[124,21,124,62,0],[125,21,125,106,0],[126,17,126,18,0],[127,17,127,62,0],[128,17,128,18,0],[129,21,129,68,0],[130,21,130,106,0],[131,17,131,18,0],[132,17,132,56,0],[133,17,133,18,0],[134,21,134,62,0],[135,21,135,106,0],[136,17,136,18,0],[137,17,137,60,0],[138,17,138,18,0],[139,21,139,67,0],[140,21,140,106,0],[141,17,141,18,0],[142,13,142,14,0],[143,13,143,39,0],[144,13,144,14,0],[145,17,145,52,0],[146,13,146,14,0],[147,9,147,10,0],[150,9,150,10,0],[151,13,151,42,0],[152,13,152,105,0],[153,13,153,87,0],[154,13,154,14,0],[155,17,157,30,0],[157,30,157,110,0],[157,110,157,112,0],[155,17,157,112,0],[158,17,158,33,0],[159,13,159,14,0],[160,13,160,29,0],[160,30,160,41,0],[161,13,161,92,0],[162,13,162,14,0],[163,17,165,30,0],[165,30,165,110,0],[165,110,165,112,0],[163,17,165,112,0],[166,17,166,33,0],[167,13,167,14,0],[168,13,168,24,0],[169,9,169,10,0],[176,9,176,10,0],[177,13,177,35,0],[178,13,178,61,0],[179,13,179,57,0],[179,58,179,87,0],[181,13,181,49,0],[183,13,183,43,0],[184,13,184,53,0],[185,13,185,41,0],[187,13,187,28,0],[187,29,187,68,0],[189,13,196,155,0],[198,13,198,35,0],[199,13,199,53,0],[200,13,200,48,0],[201,13,201,76,0],[202,13,202,95,0],[203,13,203,96,0],[204,13,205,103,0],[206,13,206,25,0],[207,9,207,10,0],[210,9,210,10,0],[211,13,211,35,0],[212,13,212,58,0],[213,13,213,54,0],[213,55,213,84,0],[215,13,215,49,0],[217,13,217,43,0],[218,13,218,53,0],[219,13,219,41,0],[221,13,221,28,0],[221,29,221,103,0],[222,13,222,44,0],[222,45,222,108,0],[224,13,224,49,0],[225,13,225,33,0],[225,34,225,95,0],[227,13,227,25,0],[228,9,228,10,0],[231,9,231,10,0],[232,13,232,35,0],[233,13,233,58,0],[234,13,234,54,0],[234,55,234,84,0],[236,13,236,49,0],[238,13,238,43,0],[239,13,239,53,0],[240,13,240,41,0],[242,13,242,28,0],[242,29,242,103,0],[244,13,244,81,0],[248,13,248,25,0],[249,9,249,10,0],[252,9,252,10,0],[253,13,253,35,0],[254,13,254,58,0],[255,13,255,54,0],[255,55,255,84,0],[257,13,257,49,0],[259,13,259,43,0],[260,13,260,53,0],[261,13,261,41,0],[263,13,263,28,0],[263,29,263,103,0],[264,13,264,47,0],[265,13,265,41,0],[267,13,267,25,0],[268,9,268,10,0],[271,9,271,10,0],[272,13,272,41,0],[275,13,275,55,0],[277,13,277,30,0],[278,13,278,44,0],[278,45,278,97,0],[280,13,280,49,0],[281,13,281,14,0],[282,17,282,59,0],[283,17,283,39,0],[284,13,284,14,0],[286,13,286,14,0],[287,17,287,54,0],[288,17,288,37,0],[289,13,289,14,0],[292,13,292,25,0],[293,9,293,10,0],[312,9,312,10,0],[313,13,313,35,0],[314,13,314,58,0],[315,13,315,54,0],[315,55,315,84,0],[317,13,317,49,0],[319,13,319,43,0],[320,13,320,53,0],[321,13,321,41,0],[323,13,323,28,0],[323,29,323,103,0],[324,13,324,36,0],[325,13,325,14,0],[326,17,326,48,0],[327,17,327,54,0],[328,13,328,14,0],[330,13,330,25,0],[331,9,331,10,0],[334,9,334,10,0],[335,13,335,41,0],[339,13,339,66,0],[341,13,341,49,0],[342,13,342,14,0],[343,17,343,56,0],[344,17,344,39,0],[345,13,345,14,0],[347,13,347,14,0],[348,17,348,54,0],[349,17,349,37,0],[350,13,350,14,0],[352,13,352,44,0],[354,13,354,25,0],[355,9,355,10,0],[358,9,358,10,0],[359,13,359,41,0],[360,13,360,62,0],[361,13,361,25,0],[362,9,362,10,0],[365,9,365,10,0],[366,13,366,41,0],[367,13,367,96,0],[368,13,368,25,0],[369,9,369,10,0],[372,9,372,10,0],[373,13,373,28,0],[376,21,376,55,0],[378,21,378,41,0],[380,21,380,47,0],[382,21,382,42,0],[384,21,384,39,0],[386,21,386,33,0],[388,21,388,34,0],[390,21,390,34,0],[392,21,392,31,0],[394,9,394,10,0],[421,9,421,10,0],[423,18,423,27,0],[423,29,423,48,0],[423,50,423,57,0],[424,13,424,14,0],[425,17,425,42,0],[426,21,426,27,0],[427,13,427,14,0],[428,13,428,26,0],[429,9,429,10,0],[432,9,432,10,0],[433,13,433,60,0],[434,13,434,14,0],[435,17,435,66,0],[436,13,436,14,0],[437,13,437,58,0],[438,9,438,10,0],[441,9,441,10,0],[442,13,442,60,0],[443,13,443,14,0],[444,17,444,66,0],[445,13,445,14,0],[446,9,446,10,0],[453,9,453,10,1],[454,13,454,42,1],[456,13,456,49,1],[457,13,457,14,1],[458,17,458,61,1],[459,17,459,65,1],[460,17,460,70,1],[461,13,461,14,1],[462,13,462,28,1],[463,13,463,14,0],[464,17,464,61,0],[465,17,465,70,0],[466,17,466,65,0],[467,13,467,14,0],[468,13,468,33,1],[468,34,468,41,0],[470,13,470,41,1],[470,42,470,76,0],[472,13,472,33,1],[473,13,473,37,1],[474,13,474,60,1],[475,13,475,38,1],[476,13,476,38,1],[477,13,477,51,1],[478,13,478,14,1],[479,17,479,87,1],[480,13,480,14,1],[481,9,481,10,1],[484,9,484,10,1],[485,13,485,34,1],[486,13,486,63,1],[487,13,487,97,1],[488,13,488,14,1],[489,17,489,24,1],[489,26,489,34,1],[489,35,489,37,1],[489,38,489,68,1],[490,17,490,18,1],[491,21,491,61,1],[491,62,491,71,0],[492,21,492,90,1],[493,17,493,18,1],[494,13,494,14,1],[495,9,495,10,1],[499,9,499,10,0],[500,13,500,61,0],[501,17,501,82,0],[502,13,505,41,0],[506,13,508,70,0],[509,13,515,77,0],[516,13,516,32,0],[517,9,517,10,0],[520,9,520,10,0],[521,13,521,93,0],[522,13,522,97,0],[523,13,523,92,0],[525,13,525,23,0],[526,13,526,27,0],[526,28,526,70,0],[527,13,527,50,0],[527,51,527,77,0],[529,13,529,23,0],[530,13,530,56,0],[531,13,531,14,0],[532,17,532,24,0],[532,26,532,57,0],[532,58,532,60,0],[532,61,532,98,0],[533,17,533,18,0],[534,21,534,37,0],[534,38,534,47,0],[535,21,535,74,0],[536,21,536,37,0],[536,38,536,47,0],[537,21,537,55,0],[538,21,538,55,0],[539,21,539,61,0],[540,21,541,67,0],[542,25,542,46,0],[543,17,543,18,0],[544,13,544,14,0],[545,13,545,71,0],[545,72,545,98,0],[546,13,546,50,0],[546,51,546,77,0],[547,13,547,34,0],[548,9,548,10,0],[553,9,553,10,1],[554,13,554,37,1],[555,13,555,57,1],[556,13,556,14,1],[558,17,558,88,1],[559,17,559,63,1],[560,13,560,14,1],[561,13,561,44,1],[562,13,562,104,1],[563,13,563,14,1],[564,17,564,24,1],[564,26,564,36,0],[564,37,564,39,1],[564,40,564,72,1],[564,74,564,91,0],[565,17,565,98,1],[566,17,566,122,1],[567,17,567,48,1],[568,17,568,54,1],[569,17,569,32,1],[569,33,569,45,0],[570,13,570,14,1],[571,13,594,3,1],[595,13,595,56,1],[596,9,596,10,1],[599,9,599,10,1],[600,13,600,42,1],[601,13,611,125,1],[613,13,613,77,1],[614,13,614,111,1],[616,13,622,60,1],[623,13,623,24,1],[624,13,630,36,1],[631,13,631,111,1],[632,9,632,10,1],[635,9,635,10,1],[636,13,636,79,1],[637,13,637,83,1],[638,13,638,96,1],[639,13,639,94,1],[640,13,640,63,1],[641,13,641,111,1],[642,13,648,71,1],[649,13,649,61,1],[651,13,652,68,1],[653,13,659,71,1],[660,13,660,60,1],[662,13,663,62,1],[664,13,670,71,1],[671,13,671,54,1],[673,13,679,89,1],[680,13,680,56,1],[682,13,683,61,1],[684,13,686,67,1],[687,13,693,62,1],[694,13,694,53,1],[696,13,710,73,1],[711,13,711,62,1],[713,13,716,55,1],[717,13,723,90,1],[724,13,724,63,1],[727,13,728,50,1],[729,13,731,51,1],[732,13,738,62,1],[739,13,739,67,1],[740,13,741,84,1],[742,13,742,62,1],[743,13,744,88,1],[745,13,745,113,1],[746,13,746,20,1],[747,9,747,10,1],[750,9,750,10,1],[751,13,751,45,1],[752,13,752,42,1],[752,43,752,50,0],[754,13,754,38,1],[755,13,761,16,1],[764,13,764,20,1],[764,22,764,38,1],[764,39,764,41,1],[764,42,764,55,1],[765,13,765,14,1],[766,17,766,34,1],[767,17,767,45,1],[768,17,768,45,1],[769,17,769,55,1],[770,17,770,58,1],[771,17,771,33,1],[772,13,772,14,1],[774,13,774,53,1],[775,13,775,48,1],[776,9,776,10,1],[779,9,779,10,1],[780,13,780,50,1],[781,13,781,38,1],[782,13,782,105,1],[783,13,783,88,1],[784,13,784,82,1],[785,13,785,50,1],[786,13,786,14,0],[789,17,789,75,0],[790,17,790,70,0],[791,17,791,55,0],[793,17,793,63,0],[794,17,794,18,0],[795,21,795,75,0],[796,17,796,18,0],[797,13,797,14,0],[798,9,798,10,1],[801,9,801,10,0],[802,13,802,43,0],[803,13,803,53,0],[804,13,804,20,0],[804,22,804,32,0],[804,33,804,35,0],[804,36,804,48,0],[804,50,804,73,0],[805,9,805,10,0],[808,9,808,10,0],[809,13,809,37,0],[810,13,810,37,0],[811,13,811,14,0],[812,17,816,55,0],[817,17,817,43,0],[818,13,818,14,0],[819,13,819,41,0],[820,13,820,31,0],[821,13,821,64,0],[821,65,821,72,0],[822,13,822,20,0],[822,22,822,32,0],[822,33,822,35,0],[822,36,822,48,0],[822,50,822,67,0],[823,9,823,10,0],[826,9,826,10,0],[827,13,827,40,0],[830,21,830,51,0],[832,21,832,51,0],[834,21,834,48,0],[836,21,836,48,0],[838,21,838,51,0],[840,21,840,51,0],[842,21,842,48,0],[844,21,844,48,0],[846,21,846,48,0],[848,9,848,10,0],[851,9,851,10,0],[852,13,852,32,0],[853,9,853,10,0],[870,9,870,10,1],[871,13,871,35,1],[872,13,872,58,1],[874,13,874,58,1],[875,9,875,10,1]]);
    </script>
  </body>
</html>