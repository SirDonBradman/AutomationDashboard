<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Business Layer\UserControls\SubItemControl.ascx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Globalization;
using System.Reflection;
using System.Web.Configuration;
using System.Web.Script.Serialization;
using System.Web.UI;
using System.Web.UI.WebControls;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core.AbstractModels;
using Aurigo.AMP3.Core.BusinessLayer.BL;
using Aurigo.AMP3.Core.BusinessLayer.DTO;
using Aurigo.AMP3.Core.IntegrationConnector;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Infragistics.WebUI.UltraWebGrid;
using Infragistics.WebUI.WebDataInput;

namespace Aurigo.AMP3.Core.UserControls
{
    public partial class SubItemControl : UserControl
    {
        public string IsDimensionUnitsHidden = &quot;false&quot;;
        public bool IsSubItemsLoaded;
        protected ToolBar MainToolBar;
        protected WebNumericEdit SubItemDimension1;
        protected WebNumericEdit SubItemDimension2;
        protected WebNumericEdit SubItemDimension3;
        protected WebNumericEdit SubItemNumber;
        protected WebNumericEdit SubItemQuantity;
        private ValueList valListGroups = new ValueList();
        private char groupType = &#39; &#39;;
        private ValueList valListUnits = new ValueList();
        protected global::Infragistics.WebUI.UltraWebGrid.UltraWebGrid gridSubItem;
        private ItemDetailModel parentItemModel;
        public bool IsContractView { get; set; }

        public string ModuleID
        {
            set { hdnModuleID.Value = value; }
            get { return hdnModuleID.Value; }
        }

        public int ParentInstanceID
        {
            set { hdnParentInstanceID.Value = value.ToString2(); }
            get
            {
                return (!string.IsNullOrEmpty(hdnParentInstanceID.Value))
                    ? hdnParentInstanceID.Value.ToInt32_2()
                    : 0;
            }
        }

        public bool ReadOnly
        {
            get { return hdnReadOnly.Value.ToBoolean2(); }
            set
            {
                hdnReadOnly.Value = value.ToString2();
                btnSubItemEdit.Visible = MBEnable.Enabled = Dim1.Enabled = Dim2.Enabled = Dim3.Enabled = !value;
                btnSubItemAdd.Visible =
                    btnSubItemDelete.Visible = btnSave.Visible = !ReferenceItemType.Equals(&quot;M&quot;) &amp;&amp; !value;
            }
        }

        public int ItemID
        {
            get
            {
                return (!string.IsNullOrEmpty(txtItemID4SubItem.Text))
                    ? txtItemID4SubItem.Text.ToInt32_2()
                    : 0;
            }
            set { txtItemID4SubItem.Text = value.ToString2(); }
        }

        public ItemDetailModel ParentItemModel
        {
            get { return parentItemModel; }
            set { parentItemModel = value; }
        }

        public string ReferenceItemType
        {
            set
            {
                hdnReferenceItemType.Value = value;
                btnSubItemAdd.Visible = btnSubItemDelete.Visible = btnSave.Visible =
                    Dim1.Enabled =
                        Dim2.Enabled = Dim3.Enabled = !value.Equals(&quot;M&quot;);
                SubItemDimension1.MinValue = SubItemDimension2.MinValue =
                    SubItemDimension3.MinValue = value.Equals(&quot;M&quot;) ? -999999999.9999 : 0;
            }
            get { return hdnReferenceItemType.Value; }
        }

        public event EventHandler BackClicked;

        private void GetModuleIDAndParentInstanceID(ref string moduleID, ref int parentInstanceID)
        {
            switch (ModuleID)
            {
                case Constants.MODID_CHNGORD:
                    moduleID = Constants.MODID_CONTMGT;
                    parentInstanceID = Request[&quot;ContractID&quot;].Parse2();
                    break;
                case Constants.MODID_ESTMADD:
                    moduleID = Constants.MODID_ESTMATE;
                    parentInstanceID = Request[&quot;ProjectEstimateID&quot;].Parse2();
                    break;
            }
        }

        private char GetGroupType()
        {
            string moduleID = ModuleID;
            int parentInstanceID = ParentInstanceID;
            GetModuleIDAndParentInstanceID(ref moduleID, ref parentInstanceID);
            char gType = ItemManager.Instance.GetGroupType(parentInstanceID, moduleID);
            hdnGroupType.Value = gType.ToString();
            return gType;
        }

        private void BindGlobalGroups()
        {
            string moduleID = ModuleID;
            int parentInstanceID = ParentInstanceID;
            GetModuleIDAndParentInstanceID(ref moduleID, ref parentInstanceID);
            DataTable dtGlobalGroups = ItemManager.Instance.GetGlobalSubItemGroups(parentInstanceID, moduleID);
            valListGroups.DataSource = ddlGlobalGroup.DataSource = dtGlobalGroups.ToMWDateTime();
            valListGroups.DisplayMember = ddlGlobalGroup.DataTextField = &quot;Name&quot;;
            valListGroups.ValueMember = &quot;Name&quot;;
            ddlGlobalGroup.DataValueField = &quot;ID&quot;;
            ddlGlobalGroup.DataBind();
            valListGroups.DataBind();
        }

        protected virtual void OnBackClicked(EventArgs e)
        {
            if (BackClicked != null)
                BackClicked(this, e);
        }

        protected override void OnInit(EventArgs e)
        {
            CreateToolBarMenu();

            if (WebConfigurationManager.AppSettings[&quot;HideSIDimensionUnits&quot;] != null)
                IsDimensionUnitsHidden = WebConfigurationManager.AppSettings[&quot;HideSIDimensionUnits&quot;].ToLower2();

            btnSubItemDelete.Click += btnSubItemDelete_Click;
            btnSave.Click += btnSaveSubItem_Click;
            btnBack.Click += btnBack_Click;

            base.OnInit(e);
        }

        protected override void OnPreRender(EventArgs e)
        {
            if (ReadOnly || ((ModuleID == &quot;CHNGORD&quot; || ModuleID == &quot;BDGTREV&quot;) &amp;&amp; ReferenceItemType == &quot;M&quot;))
                foreach (UltraGridColumn ugc in gridSubItem.Columns)
                    ugc.AllowUpdate = AllowUpdate.No;

            if ((ModuleID == &quot;CHNGORD&quot; || ModuleID == &quot;BDGTREV&quot;) &amp;&amp; ReferenceItemType == &quot;M&quot;)
            {
                MBEnable.Enabled = Dim1.Enabled = Dim2.Enabled = Dim3.Enabled = false;
                btnSave.Visible = btnSubItemEdit.Visible = true &amp;&amp; !ReadOnly;
            }
            else
            {
                btnSubItemEdit.Visible = false;
            }

            if (Visible)
            {
                MasterPage obj = Page.Master;
                if (Page.Master.Master != null)
                    obj = Page.Master.Master;
                if (obj != null &amp;&amp; obj.FindControl(&quot;ToolbarRow&quot;) != null)
                    (obj.FindControl(&quot;ToolbarRow&quot;) as Literal).Text = &quot;&lt;tr style=&#39;display:none&#39;&gt;&quot;;
            }
            if (MainToolBar.GetMenuReference(&quot;lnkEdit&quot;) != null &amp;&amp; !btnSubItemEdit.Visible)
                MainToolBar.HideMenu(&quot;lnkEdit&quot;);
            if (MainToolBar.GetMenuReference(&quot;lnkSave&quot;) != null &amp;&amp; !btnSave.Visible)
                MainToolBar.HideMenu(&quot;lnkSave&quot;);
            if (MainToolBar.GetMenuReference(&quot;lnkNew&quot;) != null &amp;&amp; !btnSubItemAdd.Visible)
                MainToolBar.HideMenu(&quot;lnkNew&quot;);
            if (MainToolBar.GetMenuReference(&quot;lnkDelete&quot;) != null &amp;&amp; !btnSubItemDelete.Visible)
                MainToolBar.HideMenu(&quot;lnkDelete&quot;);

            base.OnPreRender(e);
        }

        private void btnBack_Click(object sender, EventArgs e)
        {
            OnBackClicked(e);
        }

        private void AlertError(string errMessage)
        {
            // Sync with ChangeSet 34636 from production MTO
            JavaScriptSerializer JS = new JavaScriptSerializer();
            Page.ClientScript.RegisterStartupScript(GetType(), &quot;ShowAlert&quot;,
                &quot;ShowError(&quot; + JS.Serialize(errMessage.Replace(&quot;|&quot;, &quot;\\n&quot;)) + &quot;);&quot;, true);
        }

        public List&lt;SubItem&gt; GetSubItems()
        {
            var subitems = new List&lt;SubItem&gt;();
            foreach (UltraGridRow row in gridSubItem.DisplayLayout.Rows)
                subitems.Add(GetSubItemDTO(row));
            return subitems;
        }

        protected void btnSaveSubItem_Click(object sender, EventArgs e)
        {
            string errMessage = ValidateSubItem(null, true);

            if (!String.IsNullOrEmpty(errMessage))
            {
                AlertError(errMessage);
                FormatGridForGlobalGroup(gridSubItem.Columns);
            }
            else
                LoadItem(ModuleID, ParentInstanceID, ItemID);
        }

        public Decimal TruncateDecimal(Decimal subItemQty)
        {
            int noOfDecimal = CoreDatabaseHelper.GetDigitsAfterDecimal(subItemQty.ToString2());
            int noOfAppDecimal =
                CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY);
            if (noOfDecimal &gt; noOfAppDecimal)
            {
                switch (noOfAppDecimal)
                {
                    case 1:
                        subItemQty = decimal.Round(subItemQty, 1);
                        break;
                    case 2:
                        subItemQty = decimal.Round(subItemQty, 2);
                        break;
                    case 3:
                        subItemQty = decimal.Round(subItemQty, 3);
                        break;
                    case 4:
                        subItemQty = decimal.Round(subItemQty, 4);
                        break;
                    case 5:
                        subItemQty = decimal.Round(subItemQty, 5);
                        break;
                    case 6:
                        subItemQty = decimal.Round(subItemQty, 6);
                        break;
                }
            }
            return subItemQty;
        }

        public string ValidateSubItem(Item parentItem, bool isSaveSubItem = false)
        {
            string errMessage = string.Empty;

            if (groupType == &#39; &#39;)
                groupType = GetGroupType();

            Decimal totalSIQty = 0;
            foreach (UltraGridRow row in gridSubItem.DisplayLayout.Rows)
            {
                decimal subItemQty = 0;
                Decimal.TryParse(row.Cells.FromKey(&quot;Quantity&quot;).Text, out subItemQty);
                totalSIQty += TruncateDecimal(subItemQty);
            }

            if (totalSIQty &gt; 999999999.9999M)
                errMessage = &quot;Total quantity should not more than &#39;999999999.9999&#39;.&quot;;
            if (String.IsNullOrEmpty(errMessage))
            {
                if (parentItem == null)
                    parentItem = parentItemModel.GetItemDetails(ItemID);
                List&lt;SubItem&gt; subitems = GetSubItems();
                if (subitems.Count &gt; 0)
                {
                    parentItem.DiffQuantity = totalSIQty - parentItem.Quantity;
                    parentItem.Quantity = totalSIQty;
                    errMessage += parentItemModel.ValidateItemBeforeSave(parentItem, subitems);

                    #region Validate Item before saving SubItems

                    if (String.IsNullOrEmpty(errMessage))
                    {
                        foreach (SubItem subItemDTO in subitems)
                        {
                            subItemDTO.ItemUnitPrice = parentItem.UnitPrice;

                            #region Validate SubItem before Saving

                            bool issave = isSaveSubItem;
                            if (parentItemModel != null)
                            {
                                string resValidate = parentItemModel.ValidateSubItemBeforeSave(subItemDTO);
                                if (!String.IsNullOrEmpty(resValidate))
                                    errMessage += resValidate + &quot;|&quot;;
                                else
                                    issave = isSaveSubItem ? true : false;
                            }
                            if (issave)
                                ItemManager.Instance.SaveSubItem(subItemDTO);

                            #endregion
                        }
                    }

                    #endregion
                }
            }
            return errMessage;
        }

        private void btnSubItemDelete_Click(object sender, EventArgs e)
        {
            try
            {
                string errMessage = String.Empty;

                string[] ids = DeleteSubItemId.Text.Split(&quot;,&quot;.ToCharArray());
                if (ids.Length &gt; 1)
                {
                    Decimal totalSIQty = 0;
                    UltraGridRow selRow = null;
                    foreach (UltraGridRow row in gridSubItem.DisplayLayout.Rows)
                    {
                        if (row.Cells.FromKey(&quot;SubItemID&quot;).Value.ToString2().Equals(ids[0]))
                        {
                            selRow = row;
                            continue;
                        }
                        decimal subItemQty = 0;
                        Decimal.TryParse(row.Cells.FromKey(&quot;Quantity&quot;).Text, out subItemQty);
                        totalSIQty += subItemQty;
                    }

                    #region Validate Item before deleting SubItems

                    if (parentItemModel != null)
                    {
                        Item parentItem = parentItemModel.GetItemDetails(ItemID);
                        parentItem.DiffQuantity = totalSIQty - parentItem.Quantity;
                        parentItem.Quantity = totalSIQty;
                        errMessage += parentItemModel.ValidateItemBeforeSave(parentItem, null);
                    }

                    #endregion

                    if (String.IsNullOrEmpty(errMessage) &amp;&amp; selRow != null)
                    {
                        SubItem subItemDTO = GetSubItemDTO(selRow);

                        #region Validate SubItem before Deleting

                        if (parentItemModel != null)
                        {
                            string resValidate = parentItemModel.ValidateSubItemBeforeDelete(subItemDTO);
                            if (!String.IsNullOrEmpty(resValidate))
                                errMessage += resValidate + &quot;|&quot;;
                            else
                                ItemManager.Instance.DeleteSubItem(subItemDTO.SubItemID.GetValueOrDefault(0).ToString2());
                        }
                        else
                            ItemManager.Instance.DeleteSubItem(subItemDTO.SubItemID.GetValueOrDefault(0).ToString2());

                        #endregion
                    }

                    if (!String.IsNullOrEmpty(errMessage))
                    {
                        AlertError(errMessage);
                        FormatGridForGlobalGroup(gridSubItem.Columns);
                    }

                    LoadItem(ModuleID, ParentInstanceID, ids[1].ToInt32_2());
                    SubItemID.Text = &quot;0&quot;;
                }
            }
            catch (Exception ex)
            {
                AlertError(ex.Message);
            }
        }

        private void BindSubItemGrid(string moduleID, int parentInstanceID, int itemID)
        {
            BindSubItemGrid(moduleID, parentInstanceID, itemID, IsContractView);
        }

        private void BindSubItemGrid(string moduleID, int parentInstanceID, int itemID, bool isContractView)
        {
            if (groupType == &#39; &#39;)
                groupType = GetGroupType();
            if (groupType == &#39;G&#39;)
            {
                trGroup.Style[&quot;display&quot;] = &quot;table-row&quot;;
                trDescription.Style[&quot;display&quot;] = &quot;none&quot;;
                BindGlobalGroups();
            }
            else
            {
                trDescription.Style[&quot;display&quot;] = &quot;table-row&quot;;
                trGroup.Style[&quot;display&quot;] = &quot;none&quot;;
            }
            gridSubItem.InitializeRow += gridSubItem_InitializeRow;
            var CurrencyFormat = new NumberFormatInfo();
            CurrencyFormat.CurrencySymbol = LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL);

            DataSet ds = ItemManager.Instance.GetSubItemData(moduleID, parentInstanceID, itemID, isContractView);
            gridSubItem.DataSource = ds.Tables[0].ToMWDateTime();
            gridSubItem.DataBind();

            // to fix XSS attack
            foreach (UltraGridColumn col in gridSubItem.Columns)
            {
                col.HTMLEncodeContent = true;
            }

            if (groupType == &#39;G&#39;)
                gridSubItem.Columns.FromKey(&quot;Description&quot;).Header.Caption = &quot;Global Group&quot;;

            if (ds.Tables.Count &gt; 1)
            {
                // to prevent XSS attack
                lblStdItemID.Text = UIHelper.JavascriptEncode(ds.Tables[1].Rows[0][&quot;StandardItemNo&quot;].ToString2());
                lblItemDesc.Text = UIHelper.JavascriptEncode(ds.Tables[1].Rows[0][&quot;Description&quot;].ToString2());
            }

            if (ds.Tables[0].Rows.Count &gt; 0)
            {
                string PrefixOriginal = String.Empty;
                if (((moduleID == &quot;CHNGORD&quot; || moduleID == &quot;BDGTREV&quot;) &amp;&amp; ReferenceItemType == &quot;M&quot;) ||
                    moduleID == &quot;ITMPOST&quot;)
                {
                    PrefixOriginal = &quot;Original&quot;;
                }
                MBEnable.Checked = (ds.Tables[0].Rows[0][PrefixOriginal + &quot;Number&quot;] != DBNull.Value);
                Dim1.Checked = (ds.Tables[0].Rows[0][PrefixOriginal + &quot;Dimension1&quot;] != DBNull.Value &amp;&amp; MBEnable.Checked);
                Dim2.Checked = (ds.Tables[0].Rows[0][PrefixOriginal + &quot;Dimension2&quot;] != DBNull.Value &amp;&amp; MBEnable.Checked);
                Dim3.Checked = (ds.Tables[0].Rows[0][PrefixOriginal + &quot;Dimension3&quot;] != DBNull.Value &amp;&amp; MBEnable.Checked);
            }
            else
            {
                MBEnable.Checked = Dim1.Checked = Dim2.Checked = Dim3.Checked = false;
                SubItemQuantity.ReadOnly = false;
            }

            if (ModuleID.Equals(Constants.MODID_COSTVER) &amp;&amp;
                !String.IsNullOrEmpty(ds.Tables[1].Rows[0][&quot;ReferenceItemID&quot;].ToString2()) &amp;&amp;
                !ds.Tables[3].Rows[0][&quot;ModuleID&quot;].ToString2().Equals(Constants.MODID_LIBRARY))
                //To check whether the BOQ is a new one or not.
            {
                if (!ds.Tables[3].Rows[0][&quot;ModuleID&quot;].ToString2().Equals(Constants.MODID_COSTVER))
                    //To check whether it&#39;s been copied from Contract BOQ or from Cost version BOQ.
                    MBEnable.Enabled = Dim1.Enabled = Dim2.Enabled = Dim3.Enabled = false;
            }

            gridSubItem.Columns.FromKey(&quot;Dimension1&quot;).Hidden =
                gridSubItem.Columns.FromKey(&quot;UnitDim1&quot;).Hidden = !Dim1.Checked;
            gridSubItem.Columns.FromKey(&quot;Dimension2&quot;).Hidden =
                gridSubItem.Columns.FromKey(&quot;UnitDim2&quot;).Hidden = !Dim2.Checked;
            gridSubItem.Columns.FromKey(&quot;Dimension3&quot;).Hidden =
                gridSubItem.Columns.FromKey(&quot;UnitDim3&quot;).Hidden = !Dim3.Checked;
            gridSubItem.Columns.FromKey(&quot;Number&quot;).Hidden = !MBEnable.Checked;
            gridSubItem.Columns.FromKey(&quot;Dimension1&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
            gridSubItem.Columns.FromKey(&quot;Dimension2&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
            gridSubItem.Columns.FromKey(&quot;Dimension3&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
            gridSubItem.Columns.FromKey(&quot;Number&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
            tdSubItemDimension1.Attributes.Add(&quot;style&quot;, Dim1.Checked ? &quot;display:table-cell&quot; : &quot;display:none&quot;);
            tdSubItemDimension2.Attributes.Add(&quot;style&quot;, Dim2.Checked ? &quot;display:table-cell&quot; : &quot;display:none&quot;);
            tdSubItemDimension3.Attributes.Add(&quot;style&quot;, Dim3.Checked ? &quot;display:table-cell&quot; : &quot;display:none&quot;);
            tdSubItemNumber.Attributes.Add(&quot;style&quot;,
                (Dim1.Checked || Dim2.Checked || Dim3.Checked || MBEnable.Checked)
                    ? &quot;display:table-cell&quot;
                    : &quot;display:none&quot;);
            trDims.Attributes.Add(&quot;style&quot;,
                (MBEnable.Checked &amp;&amp; ds.Tables[0].Rows.Count &gt; 0) ? &quot;display:table-row&quot; : &quot;display:none&quot;);
            if (MBEnable.Checked)
            {
                SubItemQuantity.ReadOnly = true;
                gridSubItem.Columns.FromKey(&quot;Number&quot;).Hidden = false;
            }
            CurrencyFormat.NumberDecimalDigits =
                CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY);
            SubItemDimension1.MinDecimalPlaces = MinDecimalPlaces.SameAsDecimalPlaces;
            SubItemDimension1.NumberFormat = CurrencyFormat;
            SubItemDimension2.MinDecimalPlaces = MinDecimalPlaces.SameAsDecimalPlaces;
            SubItemDimension2.NumberFormat = CurrencyFormat;
            SubItemDimension3.MinDecimalPlaces = MinDecimalPlaces.SameAsDecimalPlaces;
            SubItemDimension3.NumberFormat = CurrencyFormat;
            SubItemNumber.MinDecimalPlaces = MinDecimalPlaces.SameAsDecimalPlaces;
            SubItemNumber.NumberFormat = CurrencyFormat;
            SubItemQuantity.MinDecimalPlaces = MinDecimalPlaces.SameAsDecimalPlaces;
            SubItemQuantity.NumberFormat = CurrencyFormat;

            /* To bind Units from Dynamics AX - ds.Tables[2] replaced by AX Units */
            if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.AX))
            {
                var additionalInfo = new EISAdditionalInfo(RegisteredEIS.AX);
                additionalInfo.AddInfo(Constants.EIS_ADDITIONAL_INFO,
                    Session[Constants.EIS_ADDITIONAL_INFO] == null
                        ? string.Empty
                        : Session[Constants.EIS_ADDITIONAL_INFO].ToString2());
                var dictAdditionalInfo = new Dictionary&lt;RegisteredEIS, EISAdditionalInfo&gt;();
                dictAdditionalInfo.Add(RegisteredEIS.AX, additionalInfo);
                var connectorParameter = new ConnectorParameters(dictAdditionalInfo, MethodBase.GetCurrentMethod(),
                    AMP3ObjectType.Unknown, null, null);
                int count = 0;
                DataSet dsUnits = new BrixDataSet();
                if (IntegrationConnectorManager.HandleIntegration(connectorParameter, ref count, ref dsUnits, true))
                {
                    DataTable dtUnit = dsUnits.Tables[1].Copy();
                    //TODO : Remove Indexing
                    ds.Tables[2].Rows.Clear();
                    ds.Tables[2].Columns.Clear();
                    ds.Tables[2].Merge(dtUnit);
                }
            }

            BindUnits(ds.Tables[2], &quot;Unit&quot;, &quot;UnitID&quot;);
            IsSubItemsLoaded = true;
        }

        private void gridSubItem_InitializeRow(object sender, RowEventArgs e)
        {
            if (e.Row != null)
            {
                int subItemId = 0;
                if (e.Row.Cells.FromKey(&quot;SubItemID&quot;) != null &amp;&amp;
                    int.TryParse(e.Row.Cells.FromKey(&quot;SubItemID&quot;).Value.ToString2(), out subItemId))
                {
                    SubItem subItemDTO = ItemManager.Instance.GetSubItem(ModuleID, ParentInstanceID, subItemId);
                    if (parentItemModel != null &amp;&amp; !parentItemModel.ValidateSubItemForGridEdit(subItemDTO))
                    {
                        var nonEditableColumns =
                            new List&lt;string&gt;((&quot;Description,Attr1value,UnitDim1,UnitDim2,UnitDim3&quot;).Split(&#39;,&#39;));
                        foreach (UltraGridCell cell in e.Row.Cells)
                            if (nonEditableColumns.Contains(cell.Key))
                                cell.AllowEditing = AllowEditing.No;
                    }
                }

                #region Commented out

                if (groupType == &#39;G&#39;)
                {
                    object GroupID;
                    if ((GroupID = e.Row.Cells.FromKey(&quot;GroupID&quot;).Value) != null)
                    {
                        ListItem item;
                        if ((item = ddlGlobalGroup.Items.FindByValue(GroupID.ToString2())) != null)
                            e.Row.Cells.FromKey(&quot;Description&quot;).Value = item.Text;
                    }
                }

                #endregion
            }
        }

        public SubItem GetSubItemDTO(UltraGridRow row)
        {
            decimal tryParse = 0;

            var subItemDTO = new SubItem();

            if (!String.IsNullOrEmpty(row.Cells.FromKey(&quot;SubItemID&quot;).Value.ToString2().Trim()) &amp;&amp;
                row.Cells.FromKey(&quot;SubItemID&quot;).Value.ToString2() != &quot;0&quot;)
            {
                int tryInt = 0;
                int.TryParse(row.Cells.FromKey(&quot;SubItemID&quot;).Value.ToString2(), out tryInt);
                subItemDTO.SubItemID = tryInt.ToString2().Parse2();
                subItemDTO.SubItemID = (subItemDTO.SubItemID == 0) ? null : subItemDTO.SubItemID;
            }
            subItemDTO.ItemID = ItemID;
            subItemDTO.IsGlobal = false;
            subItemDTO.Attr1Value = row.Cells.FromKey(&quot;Attr1Value&quot;).Text;
            subItemDTO.Description = row.Cells.FromKey(&quot;Description&quot;).Text;

            if (groupType == &#39;G&#39;)
            {
                ListItem selItem = ddlGlobalGroup.Items.FindByText(row.Cells.FromKey(&quot;Description&quot;).Text ?? string.Empty);
                if (selItem != null)
                    subItemDTO.GroupID = long.Parse(selItem.Value);
                subItemDTO.IsGlobal = true;
            }

            if (MBEnable.Checked)
            {
                tryParse = 0;
                if (Decimal.TryParse(row.Cells.FromKey(&quot;Number&quot;).Text, out tryParse))
                    subItemDTO.Number = tryParse;
                else
                    subItemDTO.Number = null;
            }
            else
            {
                subItemDTO.Number = null;
            }

            if (Dim1.Checked)
            {
                tryParse = 0;
                if (Decimal.TryParse(row.Cells.FromKey(&quot;Dimension1&quot;).Text, out tryParse))
                    subItemDTO.Dimension1 = tryParse;
                else
                    subItemDTO.Dimension1 = null;

                subItemDTO.UnitDim1 = row.Cells.FromKey(&quot;UnitDim1&quot;).Text;
                if (!Convert.ToBoolean(IsDimensionUnitsHidden) &amp;&amp;
                    !string.IsNullOrEmpty(row.Cells.FromKey(&quot;UnitIDDim1&quot;).Text))
                    subItemDTO.UnitIDDim1 = long.Parse(row.Cells.FromKey(&quot;UnitIDDim1&quot;).Text, CultureInfo.CurrentCulture);
            }
            else
            {
                subItemDTO.Dimension1 = null;
            }

            if (Dim2.Checked)
            {
                tryParse = 0;
                if (Decimal.TryParse(row.Cells.FromKey(&quot;Dimension2&quot;).Text, out tryParse))
                    subItemDTO.Dimension2 = tryParse;
                else
                    subItemDTO.Dimension2 = null;

                subItemDTO.UnitDim2 = row.Cells.FromKey(&quot;UnitDim2&quot;).Text;
                if (!Convert.ToBoolean(IsDimensionUnitsHidden) &amp;&amp;
                    !string.IsNullOrEmpty(row.Cells.FromKey(&quot;UnitIDDim2&quot;).Text))
                    subItemDTO.UnitIDDim2 = long.Parse(row.Cells.FromKey(&quot;UnitIDDim2&quot;).Text, CultureInfo.CurrentCulture);
            }
            else
            {
                subItemDTO.Dimension2 = null;
            }

            if (Dim3.Checked)
            {
                tryParse = 0;
                if (Decimal.TryParse(row.Cells.FromKey(&quot;Dimension3&quot;).Text, out tryParse))
                    subItemDTO.Dimension3 = tryParse;
                else
                    subItemDTO.Dimension3 = null;

                subItemDTO.UnitDim3 = row.Cells.FromKey(&quot;UnitDim3&quot;).Text;
                if (!Convert.ToBoolean(IsDimensionUnitsHidden) &amp;&amp;
                    !string.IsNullOrEmpty(row.Cells.FromKey(&quot;UnitIDDim3&quot;).Text))
                    subItemDTO.UnitIDDim3 = long.Parse(row.Cells.FromKey(&quot;UnitIDDim3&quot;).Text, CultureInfo.CurrentCulture);
            }
            else
            {
                subItemDTO.Dimension3 = null;
            }

            tryParse = 0;
            Decimal.TryParse(row.Cells.FromKey(&quot;Quantity&quot;).Text, out tryParse);
            subItemDTO.Quantity = TruncateDecimal(tryParse);

            subItemDTO.Notes = row.Cells.FromKey(&quot;Notes&quot;).Text;
            subItemDTO.ModuleID = ModuleID;
            subItemDTO.ParentInstanceID = ParentInstanceID;
            long refSID = 0;
            long.TryParse(row.Cells.FromKey(&quot;ReferenceSubItemID&quot;).Value.ToString2(), out refSID);
            subItemDTO.ReferenceSubItemID = (refSID == 0) ? (long?)null : refSID;

            return subItemDTO;
        }

        public SubItem GetDTOFromHTTP(EventArgs e)
        {
            var subItemDTO = new SubItem();

            if (SubItemID.Text != &quot;0&quot;)
                subItemDTO.SubItemID = SubItemID.Text.Parse2();

            SubItemID.Text = &quot;0&quot;;
            subItemDTO.ItemID = ItemID;
            subItemDTO.IsGlobal = false; //Hardcoding instead of fetching from App settings.
            subItemDTO.Attr1Value = Attr1Value.Text;
            subItemDTO.Description = SubItemDescription.Text;

            if (MBEnable.Checked)
                subItemDTO.Number = SubItemNumber.ValueDecimal;
            else
                subItemDTO.Number = null;

            if (Dim1.Checked)
            {
                subItemDTO.Dimension1 = SubItemDimension1.ValueDecimal;
                subItemDTO.UnitIDDim1 = ddlUnitIDDim1.SelectedValue.ToInt64_2();
                subItemDTO.UnitDim1 = ddlUnitIDDim1.SelectedItem.Text;
            }
            else
                subItemDTO.Dimension1 = null;

            if (Dim2.Checked)
            {
                subItemDTO.Dimension2 = SubItemDimension2.ValueDecimal;
                subItemDTO.UnitIDDim2 = ddlUnitIDDim2.SelectedValue.ToInt64_2();
                subItemDTO.UnitDim2 = ddlUnitIDDim2.SelectedItem.Text;
            }
            else
                subItemDTO.Dimension2 = null;

            if (Dim3.Checked)
            {
                subItemDTO.Dimension3 = SubItemDimension3.ValueDecimal;
                subItemDTO.UnitIDDim3 = ddlUnitIDDim3.SelectedValue.ToInt64_2();
                subItemDTO.UnitDim3 = ddlUnitIDDim3.SelectedItem.Text;
            }
            else
                subItemDTO.Dimension3 = null;

            subItemDTO.Quantity = SubItemQuantity.ValueDecimal;
            subItemDTO.Notes = SubItemNotes.Text;
            subItemDTO.ModuleID = ModuleID;
            subItemDTO.ParentInstanceID = ParentInstanceID;


            return subItemDTO;
        }

        public void LoadItem(int itemID)
        {
            LoadItem(ModuleID, ParentInstanceID, itemID, IsContractView);
        }

        public void LoadItemForValidation(int itemID)
        {
            DataSet ds = ItemManager.Instance.GetSubItemData(ModuleID, ParentInstanceID, itemID, IsContractView);
            gridSubItem.DataSource = ds.Tables[0].ToMWDateTime();
            gridSubItem.DataBind();
            BindGlobalGroups();
        }

        public void LoadItem(int itemID, bool isContractView)
        {
            LoadItem(ModuleID, ParentInstanceID, itemID, isContractView);
        }

        public void LoadItem(string moduleID, int parentInstanceID, int itemID)
        {
            LoadItem(moduleID, parentInstanceID, itemID, IsContractView);
        }

        public void LoadItem(string moduleID, int parentInstanceID, int itemID, bool isContractView)
        {
            if (!Visible)
                return;
            UIHelper.SetGridLayout(gridSubItem);
            txtItemID4SubItem.Text = itemID.ToString2();
            gridSubItem.DisplayLayout.ColFootersVisibleDefault = ShowMarginInfo.Yes;

            if (itemID &gt; 0)
                BindSubItemGrid(moduleID, parentInstanceID, itemID, isContractView);

            ColumnsCollection cols = gridSubItem.Columns;

            //Rearrange columns...
            cols.FromKey(&quot;Description&quot;).Move(1);
            cols.FromKey(&quot;Attr1value&quot;).Move(2);
            cols.FromKey(&quot;Number&quot;).Move(3);
            cols.FromKey(&quot;Dimension1&quot;).Move(4);
            cols.FromKey(&quot;UnitDim1&quot;).Move(5);
            cols.FromKey(&quot;Dimension2&quot;).Move(6);
            cols.FromKey(&quot;UnitDim2&quot;).Move(7);
            cols.FromKey(&quot;Dimension3&quot;).Move(8);
            cols.FromKey(&quot;UnitDim3&quot;).Move(9);

            cols.FromKey(&quot;Quantity&quot;).FooterStyleResolved.HorizontalAlign = HorizontalAlign.Right;

            string[] NumericColumns = { &quot;Number&quot;, &quot;Dimension1&quot;, &quot;Dimension2&quot;, &quot;Dimension3&quot;, &quot;Quantity&quot; };
            foreach (string column in NumericColumns)
            {
                if (cols.Exists(column))
                    cols.FromKey(column).CellStyle.HorizontalAlign = HorizontalAlign.Right;
            }
            string[] HiddenColumns =
            {
                &quot;SubItemID&quot;, &quot;ItemID&quot;, &quot;IsGlobal&quot;, &quot;GroupID&quot;, &quot;ReferenceSubItemID&quot;,
                &quot;OriginalNumber&quot;, &quot;OriginalDimension1&quot;, &quot;OriginalDimension2&quot;, &quot;OriginalDimension3&quot;
                , &quot;OriginalQuantity&quot;, &quot;UnitIDDim1&quot;, &quot;UnitIDDim2&quot;, &quot;UnitIDDim3&quot;
            };
            foreach (string column in HiddenColumns)
            {
                if (cols.Exists(column))
                    cols.FromKey(column).Hidden = true;
            }

            // ASSIGNING EDITOR CONTROL TO ALL UNIT COLUMNS
            string[] UnitColumns = { &quot;Unit&quot;, &quot;UnitDim1&quot;, &quot;UnitDim2&quot;, &quot;UnitDim3&quot; };
            foreach (string unitCol in UnitColumns)
                if (cols.Exists(unitCol))
                {
                    cols.FromKey(unitCol).ValueList = valListUnits;
                    cols.FromKey(unitCol).ValueList.DisplayStyle = ValueListDisplayStyle.DisplayText;
                    cols.FromKey(unitCol).Type = Infragistics.WebUI.UltraWebGrid.ColumnType.DropDownList;
                    cols.FromKey(unitCol).AllowUpdate = AllowUpdate.Yes;
                }

            FormatGridForGlobalGroup(cols);

            tdSubItemDim1.InnerText =
                (Dim1.Text = cols.FromKey(&quot;Dimension1&quot;).Header.Caption = AMP3ApplicationSettings.Instance.Dim1Title) +
                &quot; :&quot;;
            tdSubItemDim2.InnerText =
                (Dim2.Text = cols.FromKey(&quot;Dimension2&quot;).Header.Caption = AMP3ApplicationSettings.Instance.Dim2Title) +
                &quot; :&quot;;
            tdSubItemDim3.InnerText =
                (Dim3.Text = cols.FromKey(&quot;Dimension3&quot;).Header.Caption = AMP3ApplicationSettings.Instance.Dim3Title) +
                &quot; :&quot;;

            cols.FromKey(&quot;UnitDim1&quot;).Header.Caption = AMP3ApplicationSettings.Instance.Dim1Title + &quot; Unit&quot;;
            cols.FromKey(&quot;UnitDim2&quot;).Header.Caption = AMP3ApplicationSettings.Instance.Dim2Title + &quot; Unit&quot;;
            cols.FromKey(&quot;UnitDim3&quot;).Header.Caption = AMP3ApplicationSettings.Instance.Dim3Title + &quot; Unit&quot;;

            //fox for MW7-27628
            //gridSubItem.DataKeyField = &quot;SubItemId&quot;;
            if (!MBEnable.Checked)
                cols.FromKey(&quot;Quantity&quot;).AllowUpdate = AllowUpdate.Yes;
            else
                cols.FromKey(&quot;Quantity&quot;).AllowUpdate = AllowUpdate.No;

            cols.FromKey(&quot;Quantity&quot;).Footer.Total = SummaryInfo.Sum;
            cols.FromKey(&quot;Quantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;

            MBEnable.Attributes.Add(&quot;onClick&quot;,
                &quot;MB_Click(); HideColumn(&#39;&quot; + cols.FromKey(&quot;Number&quot;).Index + &quot;&#39;,&#39;&quot; +
                cols.FromKey(&quot;Dimension1&quot;).Index + &quot;&#39;,&#39;&quot;
                + cols.FromKey(&quot;Dimension2&quot;).Index + &quot;&#39;,&#39;&quot; + cols.FromKey(&quot;Dimension3&quot;).Index +
                &quot;&#39;,&#39;&quot;
                + cols.FromKey(&quot;UnitDim1&quot;).Index + &quot;&#39;,&#39;&quot; + cols.FromKey(&quot;UnitDim2&quot;).Index + &quot;&#39;,&#39;&quot; +
                cols.FromKey(&quot;UnitDim3&quot;).Index + &quot;&#39;,&#39;&quot;
                + gridSubItem.ClientID + &quot;&#39;,&#39;&quot; + MBEnable.ClientID + &quot;&#39;,&#39;&quot; +
                tdSubItemNumber.ClientID + &quot;&#39;)&quot;);
            //MBEnable.Attributes.Add(&quot;onClick&quot;, &quot;MB_Click(); HideColumn(&#39;&quot; + cols.FromKey(&quot;Number&quot;).Index + &quot;&#39;,&#39;&quot; + gridSubItem.ClientID + &quot;&#39;,&#39;&quot; + MBEnable.ClientID + &quot;&#39;,&#39;&quot; + tdSubItemNumber.ClientID + &quot;&#39;)&quot;);
            Dim1.Attributes.Add(&quot;onClick&quot;, &quot;HideColumn(&#39;&quot; + cols.FromKey(&quot;Dimension1&quot;).Index + &quot;&#39;,&#39;-1&#39;,&#39;-1&#39;,&#39;-1&#39;,&#39;&quot;
                                           + cols.FromKey(&quot;UnitDim1&quot;).Index + &quot;&#39;,&#39;-1&#39;,&#39;-1&#39;,&#39;&quot;
                                           + gridSubItem.ClientID + &quot;&#39;,&#39;&quot; + Dim1.ClientID + &quot;&#39;,&#39;&quot; +
                                           tdSubItemDimension1.ClientID + &quot;&#39;)&quot;);
            Dim2.Attributes.Add(&quot;onClick&quot;, &quot;HideColumn(&#39;&quot; + cols.FromKey(&quot;Dimension2&quot;).Index + &quot;&#39;,&#39;-1&#39;,&#39;-1&#39;,&#39;-1&#39;,&#39;&quot;
                                           + cols.FromKey(&quot;UnitDim2&quot;).Index + &quot;&#39;,&#39;-1&#39;,&#39;-1&#39;,&#39;&quot;
                                           + gridSubItem.ClientID + &quot;&#39;,&#39;&quot; + Dim2.ClientID + &quot;&#39;,&#39;&quot; +
                                           tdSubItemDimension2.ClientID + &quot;&#39;)&quot;);
            Dim3.Attributes.Add(&quot;onClick&quot;, &quot;HideColumn(&#39;&quot; + cols.FromKey(&quot;Dimension3&quot;).Index + &quot;&#39;,&#39;-1&#39;,&#39;-1&#39;,&#39;-1&#39;,&#39;&quot;
                                           + cols.FromKey(&quot;UnitDim3&quot;).Index + &quot;&#39;,&#39;-1&#39;,&#39;-1&#39;,&#39;&quot;
                                           + gridSubItem.ClientID + &quot;&#39;,&#39;&quot; + Dim3.ClientID + &quot;&#39;,&#39;&quot; +
                                           tdSubItemDimension3.ClientID + &quot;&#39;)&quot;);


            btnSubItemDelete.Attributes.Add(&quot;onclick&quot;,
                &quot;DeleteSubItem(&#39;&quot; + gridSubItem.ClientID + &quot;&#39;,&#39;&quot; + DeleteSubItemId.ClientID +
                &quot;&#39;)&quot;);
            if (MainToolBar.GetMenuReference(&quot;lnkDelete&quot;) != null)
                MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).OnClientClick = &quot;return DeleteSubItem(&#39;&quot; +
                                                                          gridSubItem.ClientID + &quot;&#39;,&#39;&quot; +
                                                                          DeleteSubItemId.ClientID + &quot;&#39;)&quot;;
            DeleteSubItemId.Attributes.Add(&quot;style&quot;, &quot;display:none;&quot;);

            gridSubItem.Columns.FromKey(&quot;Dimension1&quot;).Width = Unit.Pixel(50);
            gridSubItem.Columns.FromKey(&quot;Dimension2&quot;).Width = Unit.Pixel(50);
            gridSubItem.Columns.FromKey(&quot;Dimension3&quot;).Width = Unit.Pixel(50);
            gridSubItem.Columns.FromKey(&quot;UnitDim1&quot;).Width = Unit.Pixel(60);
            gridSubItem.Columns.FromKey(&quot;UnitDim2&quot;).Width = Unit.Pixel(60);
            gridSubItem.Columns.FromKey(&quot;UnitDim3&quot;).Width = Unit.Pixel(60);
            gridSubItem.Columns.FromKey(&quot;Number&quot;).Width = Unit.Pixel(50);
            if (gridSubItem.Columns.FromKey(&quot;Attr1value&quot;) != null)
                gridSubItem.Columns.FromKey(&quot;Attr1value&quot;).Header.Caption = &quot;Attribute&quot;;

            List&lt;string&gt; components = ModuleManager.Instance.GetModuleComponenets(&quot;COREMOD&quot;);
            if (!components.Contains(&quot;ItemDimension1&quot;) &amp;&amp; !components.Contains(&quot;ItemDimension1&quot;) &amp;&amp;
                !components.Contains(&quot;ItemDimension1&quot;))
                trDimensionsRequierd.Style.Add(&quot;display&quot;, &quot;none&quot;);
        }

        private void FormatGridForGlobalGroup(ColumnsCollection cols)
        {
            if ((cols.Exists(&quot;Description&quot;) &amp;&amp; groupType == &#39;G&#39;) &amp;&amp;
                !((ModuleID == &quot;CHNGORD&quot; || ModuleID == &quot;BDGTREV&quot;) &amp;&amp; ReferenceItemType == &quot;M&quot;))
            {
                if (valListGroups.DataSource == null)
                    BindGlobalGroups();
                cols.FromKey(&quot;Description&quot;).ValueList = valListGroups; // ddlGlobalGroup.UniqueID;
                cols.FromKey(&quot;Description&quot;).ValueList.DisplayStyle = ValueListDisplayStyle.DisplayText;
                cols.FromKey(&quot;Description&quot;).Type = Infragistics.WebUI.UltraWebGrid.ColumnType.DropDownList;
                if (valListGroups.DataSource != null &amp;&amp; ((DataTable)valListGroups.DataSource).Rows.Count == 0)
                    cols.FromKey(&quot;Description&quot;).AllowUpdate = AllowUpdate.No;
                else
                    cols.FromKey(&quot;Description&quot;).AllowUpdate = AllowUpdate.Yes;
            }
        }

        public void SetStdItemNoAndDescTemporarily(string StdItemNo, string Description)
        {
            // to prevent XSS attack
            lblStdItemID.Text = UIHelper.JavascriptEncode(StdItemNo);
            lblItemDesc.Text = UIHelper.JavascriptEncode(Description);
        }

        public void BindUnits(DataTable dataTable, string textFieldColumn, string valueFieldColumn)
        {
            if (ddlUnitIDDim1 != null)
                UIHelper.BindDropDownData(ddlUnitIDDim1, dataTable, textFieldColumn, valueFieldColumn);
            if (ddlUnitIDDim2 != null)
                UIHelper.BindDropDownData(ddlUnitIDDim2, dataTable, textFieldColumn, valueFieldColumn);
            if (ddlUnitIDDim3 != null)
                UIHelper.BindDropDownData(ddlUnitIDDim3, dataTable, textFieldColumn, valueFieldColumn);
            if (ddlHiddenUnits != null)
                UIHelper.BindDropDownData(ddlHiddenUnits, dataTable, textFieldColumn, valueFieldColumn);
            if (valListUnits != null)
                UIHelper.BindDropDownData(valListUnits, dataTable, textFieldColumn, valueFieldColumn);
        }

        public void ClearSubItems()
        {
            gridSubItem.Rows.Clear();
        }

        #region ToolBar Menu

        protected void CreateToolBarMenu()
        {
            var menuGroups = new List&lt;MenuGroup&gt;();
            MenuGroup generalGroup = new MenuGroup(&quot;General&quot;);
            generalGroup.AddMenu(new LargeButton(&quot;lnkNew&quot;, &quot;New&quot;, &quot;Icn_New.png&quot;));
            generalGroup.AddMenu(new LargeButton(&quot;lnkEdit&quot;, &quot;Edit&quot;, &quot;Icn_Edit.png&quot;));
            generalGroup.AddMenu(new LargeButton(&quot;lnkDelete&quot;, &quot;Delete&quot;, &quot;Icn_Delete.png&quot;));
            generalGroup.AddMenu(new LargeButton(&quot;lnkSave&quot;, &quot;Save&quot;, &quot;Icn_Save.png&quot;));
            generalGroup.AddMenu(new LargeButton(&quot;lnkBack&quot;, &quot;Back&quot;, &quot;Icn_Back.png&quot;));
            menuGroups.Add(generalGroup);
            MainToolBar.CreateToolBar(menuGroups);

            if (MainToolBar.GetMenuReference(&quot;lnkNew&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkNew&quot;).OnClientClick = &quot;return AddEmptyRowtoGrid(this);&quot;;
                MainToolBar.GetMenuReference(&quot;lnkNew&quot;).CausesValidation = false;
            }
            if (MainToolBar.GetMenuReference(&quot;lnkEdit&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).OnClientClick = &quot;return ShowInputForm(1); &quot;;
                MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).CausesValidation = false;
            }
            if (MainToolBar.GetMenuReference(&quot;lnkSave&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkSave&quot;).OnClientClick = &quot;return ValidateGrid();&quot;;
                MainToolBar.GetMenuReference(&quot;lnkSave&quot;).Click += btnSaveSubItem_Click;
                MainToolBar.GetMenuReference(&quot;lnkSave&quot;).CausesValidation = false;
            }
            if (MainToolBar.GetMenuReference(&quot;lnkDelete&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).OnClientClick = &quot;return DeleteSubItem();&quot;;
                MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).Click += btnSubItemDelete_Click;
                MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).CausesValidation = false;
            }
            if (MainToolBar.GetMenuReference(&quot;lnkBack&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkBack&quot;).CausesValidation = false;
                MainToolBar.GetMenuReference(&quot;lnkBack&quot;).Click += btnBack_Click;
            }
        }

        #endregion
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[26,9,26,56,1],[34,9,34,59,1],[35,9,35,38,1],[36,9,36,58,1],[39,38,39,42,1],[39,43,39,47,1],[43,17,43,18,1],[43,19,43,45,1],[43,46,43,47,1],[44,17,44,18,1],[44,19,44,44,1],[44,45,44,46,1],[49,17,49,18,1],[49,19,49,65,1],[49,66,49,67,1],[51,13,51,14,1],[52,17,54,25,1],[55,13,55,14,1],[60,17,60,18,1],[60,19,60,57,1],[60,58,60,59,1],[62,13,62,14,1],[63,17,63,55,1],[64,17,64,113,1],[65,17,66,107,1],[67,13,67,14,1],[73,13,73,14,1],[74,17,76,25,1],[77,13,77,14,1],[78,17,78,18,1],[78,19,78,62,1],[78,63,78,64,1],[83,17,83,18,0],[83,19,83,42,0],[83,43,83,44,0],[84,17,84,18,1],[84,19,84,43,1],[84,44,84,45,1],[90,13,90,14,1],[91,17,91,52,1],[92,17,94,74,1],[95,17,96,90,1],[97,13,97,14,1],[98,17,98,18,1],[98,19,98,53,1],[98,54,98,55,1],[104,9,104,10,1],[105,13,105,30,1],[108,21,108,56,1],[109,21,109,71,1],[110,21,110,27,1],[112,21,112,56,0],[113,21,113,78,0],[114,21,114,27,0],[116,9,116,10,1],[119,9,119,10,1],[120,13,120,40,1],[121,13,121,53,1],[122,13,122,80,1],[123,13,123,88,1],[124,13,124,51,1],[125,13,125,26,1],[126,9,126,10,1],[129,9,129,10,1],[130,13,130,40,1],[131,13,131,53,1],[132,13,132,80,1],[133,13,133,112,1],[134,13,134,98,1],[135,13,135,81,1],[136,13,136,48,1],[137,13,137,50,1],[138,13,138,39,1],[139,13,139,38,1],[140,9,140,10,1],[143,9,143,10,1],[144,13,144,37,1],[145,17,145,38,1],[146,9,146,10,1],[149,9,149,10,1],[150,13,150,33,1],[152,13,152,85,1],[153,17,153,113,0],[155,13,155,62,1],[156,13,156,51,1],[157,13,157,44,1],[159,13,159,28,1],[160,9,160,10,1],[163,9,163,10,1],[164,13,164,108,1],[165,17,165,24,0],[165,26,165,45,0],[165,46,165,48,0],[165,49,165,68,0],[166,21,166,54,0],[168,13,168,94,1],[169,13,169,14,0],[170,17,170,87,0],[171,17,171,78,0],[172,13,172,14,0],[174,13,174,14,1],[175,17,175,48,1],[176,13,176,14,1],[178,13,178,25,1],[179,13,179,14,1],[180,17,180,46,1],[181,17,181,48,1],[182,21,182,46,0],[183,17,183,74,1],[184,21,184,99,0],[185,13,185,14,1],[186,13,186,92,1],[187,17,187,49,1],[188,13,188,85,1],[189,17,189,49,0],[190,13,190,90,1],[191,17,191,48,0],[192,13,192,96,1],[193,17,193,51,0],[195,13,195,33,1],[196,9,196,10,1],[199,9,199,10,1],[200,13,200,30,1],[201,9,201,10,1],[204,9,204,10,0],[206,13,206,66,0],[207,13,208,91,0],[209,9,209,10,0],[212,9,212,10,1],[213,13,213,48,1],[214,13,214,20,1],[214,22,214,38,1],[214,39,214,41,1],[214,42,214,72,1],[215,17,215,50,1],[216,13,216,29,1],[217,9,217,10,1],[220,9,220,10,1],[221,13,221,61,1],[223,13,223,51,1],[224,13,224,14,0],[225,17,225,40,0],[226,17,226,63,0],[227,13,227,14,0],[229,17,229,62,1],[230,9,230,10,1],[233,9,233,10,1],[234,13,234,96,1],[235,13,236,108,1],[237,13,237,46,1],[238,13,238,14,1],[239,17,239,40,1],[242,25,242,67,1],[243,25,243,31,1],[245,25,245,67,0],[246,25,246,31,0],[248,25,248,67,0],[249,25,249,31,0],[251,25,251,67,0],[252,25,252,31,0],[254,25,254,67,0],[255,25,255,31,0],[257,25,257,67,0],[258,25,258,31,0],[260,13,260,14,1],[261,13,261,31,1],[262,9,262,10,1],[265,9,265,10,1],[266,13,266,46,1],[268,13,268,34,1],[269,17,269,44,1],[271,13,271,36,1],[272,13,272,20,1],[272,22,272,38,1],[272,39,272,41,1],[272,42,272,72,1],[273,13,273,14,1],[274,17,274,40,1],[275,17,275,86,1],[276,17,276,59,1],[277,13,277,14,1],[279,13,279,46,1],[280,17,280,86,0],[281,13,281,50,1],[282,13,282,14,1],[283,17,283,40,1],[284,21,284,73,1],[285,17,285,56,1],[286,17,286,40,1],[287,17,287,18,1],[288,21,288,80,1],[289,21,289,54,1],[290,21,290,96,1],[294,21,294,58,1],[295,21,295,22,1],[296,25,296,32,1],[296,34,296,52,1],[296,53,296,55,1],[296,56,296,64,1],[297,25,297,26,1],[298,29,298,77,1],[302,29,302,57,1],[303,29,303,57,1],[304,29,304,30,1],[305,33,305,108,1],[306,33,306,72,1],[307,37,307,69,0],[309,37,309,75,1],[310,29,310,30,1],[311,29,311,40,1],[312,33,312,78,1],[315,25,315,26,1],[316,21,316,22,1],[319,17,319,18,1],[320,13,320,14,1],[321,13,321,31,1],[322,9,322,10,1],[325,9,325,10,0],[327,13,327,14,0],[328,17,328,50,0],[330,17,330,78,0],[331,17,331,36,0],[332,17,332,18,0],[333,21,333,44,0],[334,21,334,48,0],[335,21,335,28,0],[335,30,335,46,0],[335,47,335,49,0],[335,50,335,80,0],[336,21,336,22,0],[337,25,337,93,0],[338,25,338,26,0],[339,29,339,42,0],[340,29,340,38,0],[342,25,342,48,0],[343,25,343,94,0],[344,25,344,50,0],[345,21,345,22,0],[349,21,349,49,0],[350,21,350,22,0],[351,25,351,82,0],[352,25,352,84,0],[353,25,353,58,0],[354,25,354,96,0],[355,21,355,22,0],[359,21,359,76,0],[360,21,360,22,0],[361,25,361,68,0],[365,25,365,53,0],[366,25,366,26,0],[367,29,367,106,0],[368,29,368,68,0],[369,33,369,65,0],[371,33,371,123,0],[372,25,372,26,0],[374,29,374,119,0],[377,21,377,22,0],[379,21,379,59,0],[380,21,380,22,0],[381,25,381,48,0],[382,25,382,71,0],[383,21,383,22,0],[385,21,385,78,0],[386,21,386,42,0],[387,17,387,18,0],[388,13,388,14,0],[389,13,389,33,0],[390,13,390,14,0],[391,17,391,40,0],[392,13,392,14,0],[393,9,393,10,0],[396,9,396,10,0],[397,13,397,81,0],[398,9,398,10,0],[401,9,401,10,1],[402,13,402,34,1],[403,17,403,44,1],[404,13,404,34,1],[405,13,405,14,0],[406,17,406,56,0],[407,17,407,57,0],[408,17,408,36,0],[409,13,409,14,0],[411,13,411,14,1],[412,17,412,62,1],[413,17,413,51,1],[414,13,414,14,1],[415,13,415,68,1],[416,13,416,57,1],[417,13,417,109,1],[419,13,419,114,1],[420,13,420,66,1],[421,13,421,36,1],[424,13,424,20,1],[424,22,424,41,1],[424,42,424,44,1],[424,45,424,64,1],[425,13,425,14,1],[426,17,426,46,1],[427,13,427,14,1],[429,13,429,34,1],[430,17,430,92,0],[432,13,432,37,1],[433,13,433,14,1],[435,17,435,115,1],[436,17,436,111,1],[437,13,437,14,1],[439,13,439,45,1],[440,13,440,14,1],[441,17,441,54,1],[442,17,443,43,1],[444,17,444,18,0],[445,21,445,49,0],[446,17,446,18,0],[447,17,447,102,1],[448,17,448,122,1],[449,17,449,122,1],[450,17,450,122,1],[451,13,451,14,1],[453,13,453,14,1],[454,17,454,87,1],[455,17,455,50,1],[456,13,456,14,1],[458,13,460,95,1],[462,13,462,14,0],[463,17,463,99,0],[465,21,465,91,0],[466,13,466,14,0],[468,13,469,80,1],[470,13,471,80,1],[472,13,473,80,1],[474,13,474,78,1],[475,13,475,113,1],[476,13,476,113,1],[477,13,477,113,1],[478,13,478,109,1],[479,13,479,111,1],[480,13,480,111,1],[481,13,481,111,1],[482,13,485,39,1],[486,13,487,107,1],[488,13,488,34,1],[489,13,489,14,0],[490,17,490,49,0],[491,17,491,70,0],[492,13,492,14,0],[493,13,494,108,1],[495,13,495,87,1],[496,13,496,61,1],[497,13,497,87,1],[498,13,498,61,1],[499,13,499,87,1],[500,13,500,61,1],[501,13,501,83,1],[502,13,502,57,1],[503,13,503,85,1],[504,13,504,59,1],[507,13,507,103,1],[508,13,508,14,0],[509,17,509,78,0],[510,17,513,79,0],[514,17,514,93,0],[515,17,515,74,0],[516,17,517,57,0],[518,17,518,31,0],[519,17,519,53,0],[520,17,520,117,0],[521,17,521,18,0],[522,21,522,65,0],[524,21,524,47,0],[525,21,525,50,0],[526,21,526,48,0],[527,17,527,18,0],[528,13,528,14,0],[530,13,530,55,1],[531,13,531,37,1],[532,9,532,10,1],[535,9,535,10,1],[536,13,536,31,1],[537,13,537,14,1],[538,17,538,35,1],[539,17,540,101,1],[541,17,541,18,1],[542,21,542,113,1],[543,21,543,108,1],[544,21,544,22,0],[545,25,546,112,0],[547,25,547,32,0],[547,34,547,52,0],[547,53,547,55,0],[547,56,547,67,0],[548,29,548,71,0],[549,33,549,69,0],[550,21,550,22,0],[551,17,551,18,1],[555,17,555,38,1],[556,17,556,18,0],[558,21,558,82,0],[559,21,559,22,0],[561,25,561,100,0],[562,29,562,82,0],[563,21,563,22,0],[564,17,564,18,0],[567,13,567,14,1],[568,9,568,10,1],[571,9,571,10,1],[572,13,572,34,1],[574,13,574,44,1],[576,13,577,73,1],[578,13,578,14,1],[579,17,579,32,1],[580,17,580,92,1],[581,17,581,68,1],[582,17,582,98,1],[583,13,583,14,1],[584,13,584,40,1],[585,13,585,41,1],[586,13,586,74,1],[587,13,587,76,1],[589,13,589,34,1],[590,13,590,14,0],[591,17,591,123,0],[592,17,592,37,0],[593,21,593,68,0],[594,17,594,44,0],[595,13,595,14,0],[597,13,597,34,1],[598,13,598,14,0],[599,17,599,30,0],[600,17,600,86,0],[601,21,601,50,0],[603,21,603,46,0],[604,13,604,14,0],[606,13,606,14,1],[607,17,607,42,1],[608,13,608,14,1],[610,13,610,30,1],[611,13,611,14,0],[612,17,612,30,0],[613,17,613,90,0],[614,21,614,54,0],[616,21,616,50,0],[618,17,618,74,0],[619,17,620,81,0],[621,21,621,122,0],[622,13,622,14,0],[624,13,624,14,1],[625,17,625,46,1],[626,13,626,14,1],[628,13,628,30,1],[629,13,629,14,0],[630,17,630,30,0],[631,17,631,90,0],[632,21,632,54,0],[634,21,634,50,0],[636,17,636,74,0],[637,17,638,81,0],[639,21,639,122,0],[640,13,640,14,0],[642,13,642,14,1],[643,17,643,46,1],[644,13,644,14,1],[646,13,646,30,1],[647,13,647,14,0],[648,17,648,30,0],[649,17,649,90,0],[650,21,650,54,0],[652,21,652,50,0],[654,17,654,74,0],[655,17,656,81,0],[657,21,657,122,0],[658,13,658,14,0],[660,13,660,14,1],[661,17,661,46,1],[662,13,662,14,1],[664,13,664,26,1],[665,13,665,80,1],[666,13,666,61,1],[668,13,668,64,1],[669,13,669,44,1],[670,13,670,60,1],[671,13,671,29,1],[672,13,672,98,1],[673,13,673,82,1],[675,13,675,31,1],[676,9,676,10,1],[679,9,679,10,0],[680,13,680,44,0],[682,13,682,39,0],[683,17,683,64,0],[685,13,685,34,0],[686,13,686,40,0],[687,13,687,41,0],[688,13,688,53,0],[689,13,689,62,0],[691,13,691,34,0],[692,17,692,64,0],[694,17,694,42,0],[696,13,696,30,0],[697,13,697,14,0],[698,17,698,72,0],[699,17,699,81,0],[700,17,700,71,0],[701,13,701,14,0],[703,17,703,46,0],[705,13,705,30,0],[706,13,706,14,0],[707,17,707,72,0],[708,17,708,81,0],[709,17,709,71,0],[710,13,710,14,0],[712,17,712,46,0],[714,13,714,30,0],[715,13,715,14,0],[716,17,716,72,0],[717,17,717,81,0],[718,17,718,71,0],[719,13,719,14,0],[721,17,721,46,0],[723,13,723,64,0],[724,13,724,50,0],[725,13,725,44,0],[726,13,726,60,0],[729,13,729,31,0],[730,9,730,10,0],[733,9,733,10,1],[734,13,734,74,1],[735,9,735,10,1],[738,9,738,10,1],[739,13,739,114,1],[740,13,740,66,1],[741,13,741,36,1],[742,13,742,32,1],[743,9,743,10,1],[746,9,746,10,0],[747,13,747,74,0],[748,9,748,10,0],[751,9,751,10,1],[752,13,752,74,1],[753,9,753,10,1],[756,9,756,10,1],[757,13,757,26,1],[758,17,758,24,0],[759,13,759,49,1],[760,13,760,57,1],[761,13,761,85,1],[763,13,763,28,1],[764,17,764,85,1],[766,13,766,58,1],[769,13,769,49,1],[770,13,770,48,1],[771,13,771,44,1],[772,13,772,48,1],[773,13,773,46,1],[774,13,774,48,1],[775,13,775,46,1],[776,13,776,48,1],[777,13,777,46,1],[779,13,779,98,1],[781,13,781,106,1],[782,13,782,20,1],[782,22,782,35,1],[782,36,782,38,1],[782,39,782,53,1],[783,13,783,14,1],[784,17,784,41,1],[785,21,785,92,1],[786,13,786,14,1],[787,13,792,15,1],[793,13,793,20,1],[793,22,793,35,1],[793,36,793,38,1],[793,39,793,52,1],[794,13,794,14,1],[795,17,795,41,1],[796,21,796,56,1],[797,13,797,14,1],[800,13,800,83,1],[801,13,801,20,1],[801,22,801,36,1],[801,37,801,39,1],[801,40,801,51,1],[802,17,802,42,1],[803,17,803,18,1],[804,21,804,68,1],[805,21,805,102,1],[806,21,806,106,1],[807,21,807,73,1],[808,17,808,18,1],[810,13,810,44,1],[812,13,814,22,1],[815,13,817,22,1],[818,13,820,22,1],[822,13,822,108,1],[823,13,823,108,1],[824,13,824,108,1],[828,13,828,35,1],[829,17,829,72,1],[831,17,831,71,0],[833,13,833,69,1],[834,13,834,96,1],[836,13,844,50,1],[846,13,849,81,1],[850,13,853,81,1],[854,13,857,81,1],[860,13,862,23,1],[863,13,863,67,1],[864,17,866,107,1],[867,13,867,70,1],[869,13,869,78,1],[870,13,870,78,1],[871,13,871,78,1],[872,13,872,76,1],[873,13,873,76,1],[874,13,874,76,1],[875,13,875,74,1],[876,13,876,67,1],[877,17,877,88,1],[879,13,879,94,1],[880,13,881,56,1],[882,17,882,67,1],[883,9,883,10,1],[886,9,886,10,1],[887,13,888,97,1],[889,13,889,14,0],[890,17,890,54,0],[891,21,891,40,0],[892,17,892,71,0],[893,17,893,104,0],[894,17,894,108,0],[895,17,895,111,0],[896,21,896,78,0],[898,21,898,79,0],[899,13,899,14,0],[900,9,900,10,1],[903,9,903,10,1],[905,13,905,70,1],[906,13,906,71,1],[907,9,907,10,1],[910,9,910,10,1],[911,13,911,39,1],[912,17,912,104,1],[913,13,913,39,1],[914,17,914,104,1],[915,13,915,39,1],[916,17,916,104,1],[917,13,917,40,1],[918,17,918,105,1],[919,13,919,38,1],[920,17,920,103,1],[921,9,921,10,1],[924,9,924,10,1],[925,13,925,38,1],[926,9,926,10,1],[931,9,931,10,1],[932,13,932,52,1],[933,13,933,63,1],[934,13,934,83,1],[935,13,935,86,1],[936,13,936,92,1],[937,13,937,86,1],[938,13,938,86,1],[939,13,939,42,1],[940,13,940,51,1],[942,13,942,64,1],[943,13,943,14,1],[944,17,944,106,1],[945,17,945,81,1],[946,13,946,14,1],[947,13,947,65,1],[948,13,948,14,1],[949,17,949,101,1],[950,17,950,82,1],[951,13,951,14,1],[952,13,952,65,1],[953,13,953,14,1],[954,17,954,98,1],[955,17,955,87,1],[956,17,956,82,1],[957,13,957,14,1],[958,13,958,67,1],[959,13,959,14,1],[960,17,960,101,1],[961,17,961,91,1],[962,17,962,84,1],[963,13,963,14,1],[964,13,964,65,1],[965,13,965,14,1],[966,17,966,82,1],[967,17,967,80,1],[968,13,968,14,1],[969,9,969,10,1]]);
    </script>
  </body>
</html>