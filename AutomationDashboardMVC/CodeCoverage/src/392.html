<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Construction Vertical\Core Modules\Submittals\Submittals.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Globalization;
using System.Web.Configuration;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core;
using Aurigo.AMP3.Core.UserControls;
using Aurigo.AMP3.Logging;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.AMP3.Resources.MessageResources;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.AMP3.SubmittalsBL;
using Aurigo.AMP3.SubmittalsDTO;
using Aurigo.Brix.Core.WebUiHelper;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.Brix.WorkflowMediators;
using Infragistics.Documents.Excel;
using Infragistics.WebUI.UltraWebGrid;
using Infragistics.WebUI.UltraWebGrid.ExcelExport;
using Aurigo.Brix.Platform.BusinessLayer.BL;
using System.Web;
using System.Web.Script.Serialization;
namespace Aurigo.AMP3.Submittals.UI
{
    [Serializable]
    public class FormStateMgmt : StateManagementBase
    {
        private int? _RowId;
        private int _projectID;

        public FormStateMgmt(string stateId, int projectID)
            : base(stateId)
        {
            _projectID = projectID;
        }

        public int ProjectID
        {
            get { return _projectID; }
            set { _projectID = value; }
        }

        public int? ActiveRowID
        {
            get { return _RowId; }
            set { _RowId = value; }
        }

        public override void MaintainState(int pageIdx, string sortKey, Telerik.Web.UI.GridSortOrder sortOrder, string filterCriterion)
        {
            ProjectID = ProjectID;
            base.MaintainState(pageIdx, sortKey, sortOrder, filterCriterion);
        }

        public void MaintainState(int pageIdx, string sortKey, SortIndicator sortOrder, string filterCriterion, int? activeRowId)
        {
            _RowId = activeRowId;
            ProjectID = ProjectID;
            base.MaintainState(pageIdx, sortKey, base.GetSortOrder(sortOrder), filterCriterion);
        }

        public override void ClearState()
        {
            base.ClearState();
            ProjectID = 0;
            ActiveRowID = null;
        }
    }

    [ListModelContext(Name = &quot;SUBMTAL&quot;, Table = &quot;SUBMTALRegisterMaster&quot;)]
    public partial class Submittals : BrixPageBase
    {
        private string MOD_COMMON_STATE_ID;
        protected ModalPopupExtender PopupExtender;
        private ApprovalHistory approvalHistory;
        private ApprovalWorkflow approvalWorkflow;
        protected UltraWebGridExcelExporter expGrid;
        protected UltraWebGrid grdSubmittals;
        private bool hasWorkFlow;
        protected UserControl mypager;
        private FormStateMgmt pageState;

        public string FormName
        {
            get { return &quot;XSUBTAL&quot;; }
        }

        public int ParentModuleId
        {
            get { return 0; }
        }

        public string ListPrimaryKey
        {
            get { return &quot;SubmittalID&quot;; }
        }

        public int PID
        {
            get { return 0; }
        }

        public override void InclueScriptAndStyleFiles()
        {
            base.InclueScriptAndStyleFiles();
            base.RegisterClientScriptInclude(&quot;~/Scripts/BrixListPageValidate.js&quot;);
        }

        protected override void OnPreInit(EventArgs e)
        {
            if (!String.IsNullOrEmpty(Request[&quot;PID&quot;]))
                ModuleId = Request[&quot;PID&quot;].Equals(&quot;0&quot;) ? &quot;LANDMGT&quot; : &quot;SUBMTAL&quot;;
            base.OnPreInit(e);
        }

        protected override void OnInit(EventArgs e)
        {
            ((PagerControl)mypager).ItemClicked += HandlePagerEvent;
            grdSubmittals.SortColumn += grdSubmittals_SortColumn;
            grdSubmittals.Columns.FromKey(&quot;Multi&quot;).AllowUpdate = AllowUpdate.Yes;
            mypager.EnableViewState = true;

            //PopupExtender = (ModalPopupExtender)this.Master.FindControl(&quot;filterExtender&quot;);
            PopupExtender.Visible = true;
            PopupExtender.Title = &quot;Submittal&quot;;

            var f = new WorkflowFactory(grdSubmittals, null);
            if (f.GetInfo(&quot;SUBMTAL&quot;) != null)
            {
                //ListModelContextAttribute[] attribs = (ListModelContextAttribute[])
                //        this.GetType().GetCustomAttributes(typeof(ListModelContextAttribute), true);
                //hasWorkFlow = true;
                //approvalWorkflow = (appWorkflow as ApprovalWorkflow);
                //approvalHistory = (appWorkflowHistory as ApprovalHistory);
                //approvalWorkflow.ApproveClicked += new ApprovalWorkflow.ApprovalEventHandler(approvalWorkflow_ApproveClicked);
                //approvalWorkflow.SetInstanceID(grdSubmittals, null, &quot;RegisterID&quot;, &quot;0&quot;, &quot;SUBMTAL&quot;, &quot;SUBMTALRegisterMaster&quot;, &quot;RegisterID&quot;, &quot;CreatedOn&quot;);
                //approvalHistory.SetInstanceID(grdSubmittals, null, &quot;RegisterID&quot;, &quot;0&quot;, &quot;SUBMTAL&quot;);
            }
            else
            {
                PopupExtender.AddNewPopup(aspPnlApprove.ClientID, btnMPGhost.ClientID, btnCncl.ClientID, 420, 430);
            }
            base.PageUniqueID = HttpContext.Current.Request.QueryString[&quot;Link&quot;];
            base.OnInit(e);
        }

        protected void approvalWorkflow_ApproveClicked(object sender, ApprovalEventArgs e)
        {
            if (e != null)
            {
                if (e.Action.Equals(ApprovalAction.Approve))
                {
                    btnApprove_Click(sender, new EventArgs());
                }
                else if (e.Action.Equals(ApprovalAction.Unapprove))
                {
                    lnkUnApprove_Click(sender, new EventArgs());
                }
                else if (e.Action.Equals(ApprovalAction.Reject))
                {
                    lnkReject_Click(sender, new EventArgs());
                }
            }
        }

        public void HandlePagerEvent(object sender, ItemClickEventArgs e)
        {
            BindData();

            grdSubmittals.DisplayLayout.Pager.CurrentPageIndex = 1;

            pageState.MaintainState(((HtmlInputHidden)mypager.FindControl(&quot;currentPage&quot;)).Value.ToInt32_2(),
                pageState.SortKey, pageState.GetSortOrder(UIHelper.GetSortIndicator(ViewState[SubConstants.ODS_SORTORDER])),
                ViewState[SubConstants.ODS_FILTER] == null ? null : ViewState[SubConstants.ODS_FILTER].ToString2());
        }

        protected void Page_Load(object sender, EventArgs e)
        {
            //State management
            MOD_COMMON_STATE_ID = Request[&quot;Link&quot;] + Request[&quot;LinkID&quot;];

            #region Authorization

            UIHelper.DisableRoleSelection(Page);
            EnsureChildControls();
            //MainToolBar.GetMenuReference(&quot;lnkNew&quot;).Enabled =
            //    MainToolBar.GetMenuReference(&quot;lnkView&quot;).Enabled =
            //    MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).Enabled =
            //    MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).Enabled =
            //    MainToolBar.GetMenuReference(&quot;lnkApprove&quot;).Enabled =
            //    MainToolBar.GetMenuReference(&quot;lnkReply&quot;).Enabled =
            //    MainToolBar.GetMenuReference(&quot;lnkTransmittal&quot;).Enabled = false;

            //List&lt;string&gt; featurelist = ModuleManager.Instance.GetPermissionByRole(&quot;SUBMTAL&quot;,
            //                                                                      UserDetail.GetCurrentUserDetail().RID);
            //MainToolBar.GetMenuReference(&quot;lnkNew&quot;).Enabled = featurelist.Contains(&quot;Create&quot;);
            //MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).Enabled = featurelist.Contains(&quot;Edit&quot;);
            //MainToolBar.GetMenuReference(&quot;lnkSubmit&quot;).Enabled = featurelist.Contains(&quot;Submit&quot;);
            //MainToolBar.GetMenuReference(&quot;lnkView&quot;).Enabled = featurelist.Contains(&quot;View&quot;);
            //MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).Enabled = featurelist.Contains(&quot;Delete&quot;);
            //MainToolBar.GetMenuReference(&quot;lnkApprove&quot;).Enabled = featurelist.Contains(&quot;Approve&quot;);
            //MainToolBar.GetMenuReference(&quot;lnkReply&quot;).Enabled = featurelist.Contains(&quot;Reply&quot;);
            //MainToolBar.GetMenuReference(&quot;lnkTransmittal&quot;).Enabled = featurelist.Contains(&quot;Transmit&quot;);

            #endregion

            if ((pageState =
                 UIHelper.GetModuleFromStateBag(MOD_COMMON_STATE_ID, Context) as
                 FormStateMgmt) == null)
            {
                //Project Level
                pageState = new FormStateMgmt(MOD_COMMON_STATE_ID, Request[&quot;LinkID&quot;].ToInt32_2());
                UIHelper.UpdateModuleStateBag(MOD_COMMON_STATE_ID, pageState, Context);
            }
            else if (!WebConfigurationManager.AppSettings[&quot;StateMgmtGlobal&quot;].ToBoolean2()
                     &amp;&amp; Request.UrlReferrer != null
                     &amp;&amp; !Array.Exists(Request.UrlReferrer.Segments,
                                      delegate (string s)
                                      {
                                          return (s != null &amp;&amp;
                                                  s.StartsWith(MOD_COMMON_STATE_ID,
                                                               StringComparison.OrdinalIgnoreCase));
                                      }
                             ) || pageState.ProjectID != Request[&quot;PID&quot;].ToInt32_2())
            {
                pageState.ClearState();
            }
            else
            {
                ViewState[Constants.ODS_SORTORDER] = pageState.SortOrder;
                ViewState[Constants.ODS_FILTER] = pageState.FilterCriterion;
                (mypager.FindControl(&quot;currentPage&quot;) as HtmlInputHidden).Value = pageState.PageIndex.ToString2();
                if (ViewState[Constants.ODS_FILTER] != null &amp;&amp; !IsPostBack)
                    pageState.RestoreFilterState(Page, ViewState[Constants.ODS_FILTER].ToString2());
            }
            if (!IsPostBack)
                BindData();

            PageTitle = &quot;Submittal Register&quot;;
        }

        protected void grdSubmittals_SortColumn(object sender, SortColumnEventArgs e)
        {
            ApplySort(grdSubmittals.Columns[e.ColumnNo].Key);
            pageState.MaintainState((mypager.FindControl(&quot;currentPage&quot;) as HtmlInputHidden).Value.ToInt32_2(),
                grdSubmittals.Columns[e.ColumnNo].Key, UIHelper.GetSortIndicator(ViewState[Constants.ODS_SORTORDER]),
                ViewState[Constants.ODS_FILTER] == null ? null : ViewState[Constants.ODS_FILTER].ToString2(), null);
        }

        public void ContextMenu1_ItemCommand(object sender, CommandEventArgs e)
        {
            string selectedSub = hdnMulti.Value;
            hdnMulti.Value = &quot;&quot;;
            if (selectedSub.LastIndexOf(&#39;,&#39;) &gt; 0)
                selectedSub = selectedSub.Substring(0, selectedSub.LastIndexOf(&#39;,&#39;));

            switch (e.CommandName)
            {
                case &quot;Create&quot;:
                    Response.Redirect(&quot;CreateSubmittal.aspx?PID=&quot; + Request[Constants.QRY_PROJECTID] + &quot;&amp;Link=&quot; +
                                      Request[&quot;Link&quot;] + &quot;&amp;LinkID=&quot; + Request[&quot;LinkID&quot;] + &quot;&amp;LMID=&quot; + Request[&quot;LinkID&quot;] + &quot;&amp;ParentID=&quot; + Request[&quot;LinkID&quot;]);
                    break;

                case &quot;Edit&quot;:
                    Response.Redirect(&quot;ViewSubmittal.aspx?Mode=Edit&amp;PID=&quot; + Request[Constants.QRY_PROJECTID] +
                                      &quot;&amp;RegisterID=&quot; + selectedSub +
                                      &quot;&amp;Link=&quot; + Request[&quot;Link&quot;] + &quot;&amp;LinkID=&quot; + Request[&quot;LinkID&quot;] + &quot;&amp;LMID=&quot; +
                                      Request[&quot;LinkID&quot;] + &quot;&amp;ParentID=&quot; + Request[&quot;LinkID&quot;]);
                    break;

                case &quot;View&quot;:
                    Response.Redirect(&quot;ViewSubmittal.aspx?Mode=View&amp;PID=&quot; + Request[Constants.QRY_PROJECTID] +
                                      &quot;&amp;RegisterID=&quot; + selectedSub +
                                      &quot;&amp;Link=&quot; + Request[&quot;Link&quot;] + &quot;&amp;LinkID=&quot; + Request[&quot;LinkID&quot;] + &quot;&amp;LMID=&quot; +
                                      Request[&quot;LinkID&quot;] + &quot;&amp;ParentID=&quot; + Request[&quot;LinkID&quot;]);
                    break;

                case &quot;Reply&quot;:
                    {
                        string modeParamValue = string.Format(&quot;{0}={1}&quot;, ProjectSubmittalsListModel.CONST_QueryParamName_Mode, SubConstants.DIRECTION_IN);

                        Response.Redirect(&quot;Response.aspx?&quot; + modeParamValue + &quot;&amp;PID=&quot; +
                                          Request[Constants.QRY_PROJECTID] +
                                          &quot;&amp;RegisterID=&quot; + selectedSub +
                                          &quot;&amp;Link=&quot; + Request[&quot;Link&quot;] + &quot;&amp;LinkID=&quot; + Request[&quot;LinkID&quot;] + &quot;&amp;LMID=&quot; +
                                          Request[&quot;LinkID&quot;] + &quot;&amp;ParentID=&quot; + Request[&quot;LinkID&quot;]);
                    }
                    break;

                case &quot;Transmittal&quot;:
                    {
                        string modeParamValue = string.Format(&quot;{0}={1}&quot;, ProjectSubmittalsListModel.CONST_QueryParamName_Mode, SubConstants.DIRECTION_OUT);

                        Response.Redirect(&quot;Response.aspx?&quot; + modeParamValue + &quot;&amp;PID=&quot; +
                                          Request[Constants.QRY_PROJECTID] +
                                          &quot;&amp;RegisterID=&quot; + selectedSub +
                                          &quot;&amp;Link=&quot; + Request[&quot;Link&quot;] + &quot;&amp;LinkID=&quot; + Request[&quot;LinkID&quot;] + &quot;&amp;LMID=&quot; +
                                          Request[&quot;LinkID&quot;] + &quot;&amp;ParentID=&quot; + Request[&quot;LinkID&quot;]);
                    }
                    break;

                case &quot;Import&quot;:
                    Response.Redirect(&quot;Import.aspx?PID=&quot; + Request[Constants.QRY_PROJECTID] +
                                      &quot;&amp;Link=&quot; + Request[&quot;Link&quot;] + &quot;&amp;LinkID=&quot; + Request[&quot;LinkID&quot;] + &quot;&amp;LMID=&quot; +
                                      Request[&quot;LinkID&quot;], true);
                    break;

                case &quot;Export&quot;:
                    ExportSubmittals();
                    break;

                case &quot;Submit&quot;:
                    string[] submittalsID = selectedSub.Split(&#39;,&#39;);
                    foreach (string str in submittalsID)
                    {
                        SubmittalsManager.BLInstance.SubmittalUpdateStatus(str.ToInt32_2(), String.Empty, &quot;P&quot;,
                                                                           UserDetail.GetCurrentUserDetail().UID, null);
                    }
                    BindData();
                    break;

                case &quot;Delete&quot;:
                    var dtoSubmittals = new List&lt;DTOSubmittals&gt;();
                    string[] submittalsIDs = selectedSub.Split(&#39;,&#39;);
                    for (int i = 0; i &lt; submittalsIDs.Length; i++)
                    {
                        var submittals = new DTOSubmittals();
                        submittals.SubmittalID = submittalsIDs[i].ToInt32_2();
                        submittals.CreatedBy = UserDetail.GetCurrentUserDetail().UID;
                        dtoSubmittals.Add(submittals);
                    }

                    try
                    {
                        SubmittalsManager.BLInstance.CUDSubmittals(Operations.Delete, dtoSubmittals);
                    }
                    catch (Exception ex)
                    {
                        JavaScriptSerializer JS = new JavaScriptSerializer();
                        ShowError(JS.Serialize(ex.Message));
                    }

                    MaintainActiveRow(null);
                    GetPageCount();
                    BindData();
                    break;
            }
        }

        private void ExportSubmittals()
        {
            var grdExport = new UltraWebGrid(&quot;grdExport&quot;);

            int? moduleLinkID;
            if (Request[&quot;LinkID&quot;] == &quot;0&quot;)
                moduleLinkID = null;
            else
                moduleLinkID = Request[&quot;LinkID&quot;].ToInt32_2();
            int cnt = SubmittalsManager.BLInstance.GetSubmittalsCount(null, Request[Constants.QRY_PROJECTID].ToInt32_2(),
                                                                      null, Request[&quot;Link&quot;],
                                                                      Request[&quot;LinkID&quot;].ToInt32_2());
            DataTable dtExport = SubmittalsManager.BLInstance.GetSubmittals(null,
                                                                            Request[Constants.QRY_PROJECTID].ToInt32_2(),
                                                                            null, 1, cnt, null, Request[&quot;Link&quot;],
                                                                            moduleLinkID, &#39;N&#39;);

            if (dtExport.Rows.Count == 0)
            {
                ShowError(&quot;No Records to Export&quot;);
                return;
            }

            grdExport.DataSource = dtExport;
            grdExport.DataBind();

            ColumnsCollection cols;

            cols = grdExport.Bands[0].Columns;

            cols.FromKey(&quot;RegisterID&quot;).Hidden = true;
            cols.FromKey(&quot;HasAttachment&quot;).Hidden = true;
            cols.FromKey(&quot;RowNum&quot;).Hidden = true;
            cols.FromKey(&quot;Description&quot;).Hidden = true;
            cols.FromKey(&quot;DueDate&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_DATE;

            cols.FromKey(&quot;Requirement&quot;).Header.Caption = &quot;Submittal Requirement&quot;;
            cols.FromKey(&quot;SubmittalType&quot;).Header.Caption = &quot;Submittal Type&quot;;
            cols.FromKey(&quot;DueDate&quot;).Header.Caption = &quot;Due Date&quot;;
            cols.FromKey(&quot;Reference&quot;).Header.Caption = &quot;Submittal Reference&quot;;
            cols.FromKey(&quot;Notes&quot;).Header.Caption = &quot;Submittal Notes&quot;;

            if (Request[&quot;Link&quot;] == &quot;PROJECT&quot; || Request[&quot;Link&quot;] == &quot;LANDMGT&quot;)
            {
                cols.FromKey(&quot;SubmittalType&quot;).Move(0);
                cols.FromKey(&quot;Requirement&quot;).Move(1);
                cols.FromKey(&quot;Reference&quot;).Move(2);
                cols.FromKey(&quot;Notes&quot;).Move(3);
                cols.FromKey(&quot;DueDate&quot;).Move(4);
            }
            else
            {
                cols.FromKey(&quot;LineNo&quot;).Header.Caption = &quot;Line No&quot;;
                cols.FromKey(&quot;ItemDescription&quot;).Header.Caption =
                    LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR) + &quot; Description&quot;;
                cols.FromKey(&quot;LineNo&quot;).Move(0);
                cols.FromKey(&quot;ItemDescription&quot;).Move(1);
                cols.FromKey(&quot;Component&quot;).Move(2);
                cols.FromKey(&quot;SubmittalType&quot;).Move(3);
                cols.FromKey(&quot;Requirement&quot;).Move(4);
                cols.FromKey(&quot;Reference&quot;).Move(5);
                cols.FromKey(&quot;Notes&quot;).Move(6);
                cols.FromKey(&quot;DueDate&quot;).Move(7);
            }

            switch (Request[&quot;Link&quot;])
            {
                case &quot;PROJECT&quot;:
                    expGrid.WorksheetName = &quot;SubmittalsProject&quot;;
                    expGrid.DownloadName = &quot;SubmittalsProject&quot; + &quot;.XLS&quot;;
                    break;
                case &quot;LANDMGT&quot;:
                    expGrid.WorksheetName = &quot;SubmittalsLand&quot;;
                    expGrid.DownloadName = &quot;SubmittalsLand&quot; + &quot;.XLS&quot;;
                    break;
                case &quot;CONTMGT&quot;:
                    expGrid.WorksheetName = &quot;SubmittalsContract&quot;;
                    expGrid.DownloadName = &quot;SubmittalsContract&quot; + &quot;.XLS&quot;;
                    break;
                case &quot;ESTMATE&quot;:
                    expGrid.WorksheetName = &quot;SubmittalsEstimate&quot;;
                    expGrid.DownloadName = &quot;SubmittalsEstimate&quot; + &quot;.XLS&quot;;
                    break;
            }

            Workbook book = expGrid.Export(grdExport);
        }

        public void BindData()
        {
            GetPageCount();

            int? moduleLinkID;
            if (Request[&quot;LinkID&quot;] == &quot;0&quot;)
                moduleLinkID = null;
            else
                moduleLinkID = Request[&quot;LinkID&quot;].ToInt32_2();

            try
            {
                int startIdx = (startIdx = (mypager.FindControl(&quot;currentPage&quot;) as HtmlInputHidden).Value.ToInt32_2() - 1) == -1 ? 0 : startIdx;

                startIdx = 1 + (grdSubmittals.DisplayLayout.Pager.PageSize * startIdx);

                DataTable dTable = SubmittalsManager.BLInstance.GetSubmittals(
                    null, Request[Constants.QRY_PROJECTID].ToInt32_2(),
                    ViewState[Constants.ODS_FILTER] == null ? null : ViewState[Constants.ODS_FILTER].ToString2(),
                    startIdx, grdSubmittals.DisplayLayout.Pager.PageSize,
                    ViewState[Constants.ODS_SORTORDER] == null ? null : ViewState[Constants.ODS_SORTORDER].ToString2(),
                    Request[&quot;Link&quot;], moduleLinkID, &#39;N&#39;);

                grdSubmittals.DataSource = dTable;
                grdSubmittals.DataBind();

                SetGridColumns();
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.ToString2(), &quot;SUBMTAL&quot;);
            }
        }

        protected void btnFilterGhost_Click(object sender, EventArgs e)
        {
            ApplyFilter();
        }

        protected void ApplyFilter()
        {
            ViewState[Constants.ODS_FILTER] =
                ModelHelper.GetFilterXML(tblFilter.UniqueID.Remove(tblFilter.UniqueID.Length - 9), Request,
                GetApplyFilterLabels());
            GetPageCount();
            BindData();
            pageState.setPagerProperties(mypager);
        }

        public BrixFilter[] GetApplyFilterLabels()
        {

            List&lt;BrixFilter&gt; filters = new List&lt;BrixFilter&gt;();

            filters.Add(new BrixFilter() { Name = &quot;txtRequirement&quot;, Title = &quot;Requirement&quot;, FilterType = BrixFilter.Type.Text, });
            filters.Add(new BrixFilter() { Name = &quot;txtSubmittalType&quot;, Title = &quot;SubmittalType&quot;, FilterType = BrixFilter.Type.Text, });
            filters.Add(new BrixFilter() { Name = &quot;rblStatus&quot;, Title = &quot;Status&quot;, FilterType = BrixFilter.Type.Radio, });
            
            return filters.ToArray();
        }

        private void GetPageCount()
        {
            double rCnt;
            string currentPage;
            string pageCount;

            int? moduleLinkID;

            if (Request[&quot;LinkID&quot;] == &quot;0&quot;)
                moduleLinkID = null;
            else
                moduleLinkID = Request[&quot;LinkID&quot;].ToInt32_2();

            rCnt = SubmittalsManager.BLInstance.GetSubmittalsCount(null, Request[Constants.QRY_PROJECTID].ToInt32_2(),
                ViewState[Constants.ODS_FILTER] == null ? null : ViewState[Constants.ODS_FILTER].ToString2(),
                Request[&quot;Link&quot;], moduleLinkID);

            if (pageState.PageIndex != 0 &amp;&amp;
                Math.Ceiling(rCnt / grdSubmittals.DisplayLayout.Pager.PageSize) &gt;= pageState.PageIndex)
            {
                (mypager.FindControl(&quot;currentPage&quot;) as HtmlInputHidden).Value =
                    currentPage = pageState.PageIndex &gt; 0 ? pageState.PageIndex.ToString2() : &quot;0&quot;;
            }
            else
            {
                (mypager.FindControl(&quot;currentPage&quot;) as HtmlInputHidden).Value = currentPage = rCnt &gt; 0 ? &quot;1&quot; : &quot;0&quot;;
            }

            (mypager.FindControl(&quot;pageCount&quot;) as HtmlInputHidden).Value =
                pageCount = rCnt &gt; grdSubmittals.DisplayLayout.Pager.PageSize ?
                Convert.ToString(Math.Ceiling(rCnt / grdSubmittals.DisplayLayout.Pager.PageSize), CultureInfo.CurrentCulture)
                    : rCnt &gt; 0 ? &quot;1&quot; : &quot;0&quot;;

            (mypager as PagerControl).Set_Page(currentPage.ToInt32_2(), pageCount.ToInt32_2());

            pageState.MaintainState((mypager.FindControl(&quot;currentPage&quot;) as HtmlInputHidden).Value.ToInt32_2(),
                pageState.SortKey, UIHelper.GetSortIndicator(ViewState[Constants.ODS_SORTORDER]),
                ViewState[Constants.ODS_FILTER] == null ? null : ViewState[Constants.ODS_FILTER].ToString2(), pageState.ActiveRowID);
        }

        private void SetGridColumns()
        {
            foreach (UltraGridColumn col in grdSubmittals.Columns)
                col.Hidden = true;

            ColumnsCollection cols = grdSubmittals.Bands[0].Columns;

            cols.FromKey(&quot;Multi&quot;).Hidden = false;
            cols.FromKey(&quot;Requirement&quot;).Hidden = false;
            cols.FromKey(&quot;Description&quot;).Hidden = false;
            cols.FromKey(&quot;SubmittalType&quot;).Hidden = false;
            cols.FromKey(&quot;DueDate&quot;).Hidden = false;
            cols.FromKey(&quot;HasAttachment&quot;).Hidden = false;
            cols.FromKey(&quot;Status&quot;).Hidden = false;
            cols.FromKey(&quot;CreatedBy&quot;).Hidden = false;

            cols.FromKey(&quot;Requirement&quot;).Header.Caption = &quot;Submittal Requirement&quot;;
            cols.FromKey(&quot;SubmittalType&quot;).Header.Caption = &quot;Submittal Type&quot;;
            cols.FromKey(&quot;DueDate&quot;).Header.Caption = &quot;Due Date&quot;;
            cols.FromKey(&quot;CreatedBy&quot;).Header.Caption = &quot;Created By&quot;;

            cols.FromKey(&quot;DueDate&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_DATE;

            cols.FromKey(&quot;HasAttachment&quot;).Width = Unit.Pixel(50);
            cols.FromKey(&quot;HasAttachment&quot;).Header.Caption =
                &quot;&lt;img src=&#39;../../Images/Toolbar/IcnAttachment.gif&#39; alt=&#39;Attachments&#39; Title=&#39;Attachments&#39; /&gt;&quot;;
            cols.FromKey(&quot;HasAttachment&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Center;
            cols.FromKey(&quot;HasAttachment&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Center;

            cols.FromKey(&quot;HasAttachment&quot;).Move(1);

            if (Request[&quot;Link&quot;] != &quot;PROJECT&quot; &amp;&amp; Request[&quot;Link&quot;] != &quot;LANDMGT&quot;)
            {
                cols.FromKey(&quot;LineNo&quot;).Hidden = false;
                cols.FromKey(&quot;ItemDescription&quot;).Hidden = false;
                cols.FromKey(&quot;Component&quot;).Hidden = false;

                cols.FromKey(&quot;LineNo&quot;).Header.Caption = &quot;Line No.&quot;;
                cols.FromKey(&quot;LineNo&quot;).Width = Unit.Pixel(50);
                cols.FromKey(&quot;LineNo&quot;).Move(2);
                cols.FromKey(&quot;ItemDescription&quot;).Header.Caption = &quot;Item Description&quot;;
                cols.FromKey(&quot;ItemDescription&quot;).Width = Unit.Pixel(175);
                cols.FromKey(&quot;ItemDescription&quot;).Move(3);
                cols.FromKey(&quot;Component&quot;).Width = Unit.Pixel(100);
                cols.FromKey(&quot;Component&quot;).Move(4);
            }

            cols.FromKey(&quot;Requirement&quot;).Width = Unit.Pixel(175);
            cols.FromKey(&quot;CreatedBy&quot;).Width = Unit.Pixel(100);
            cols.FromKey(&quot;SubmittalType&quot;).Width = Unit.Pixel(100);
            cols.FromKey(&quot;DueDate&quot;).Width = Unit.Pixel(75);
            cols.FromKey(&quot;Status&quot;).Width = Unit.Pixel(100);

            grdSubmittals.DisplayLayout.ScrollBar = ScrollBar.Auto;
            grdSubmittals.DisplayLayout.FrameStyle.Height = Unit.Percentage(100);
            grdSubmittals.DisplayLayout.Pager.PagerStyle.CustomRules = &quot;display:none&quot;;
        }

        protected void ApplySort(string sortKey)
        {
            string sortOrder = string.Empty;
            if (ViewState[Constants.ODS_SORTORDER] != null
                &amp;&amp; ViewState[Constants.ODS_SORTORDER].ToString2().EndsWith(&quot;ASC&quot;, StringComparison.OrdinalIgnoreCase)
                &amp;&amp; ViewState[Constants.ODS_SORTORDER].ToString2().StartsWith(sortKey, StringComparison.OrdinalIgnoreCase))
                sortOrder = sortKey + &quot; DESC&quot;;
            else
                sortOrder = sortKey + &quot; ASC&quot;;
            BindData();
            foreach (UltraGridColumn uwgcol in grdSubmittals.DisplayLayout.Bands[0].Columns)
                if (uwgcol.SortIndicator != SortIndicator.None)
                    uwgcol.SortIndicator = SortIndicator.None;
            if (grdSubmittals.Columns.Exists(sortKey))
                grdSubmittals.Bands[0].Columns.FromKey(sortKey).SortIndicator = sortOrder.EndsWith(&quot; DESC&quot;,
                    StringComparison.OrdinalIgnoreCase) ? SortIndicator.Descending : SortIndicator.Ascending;
            ViewState[Constants.ODS_SORTORDER] = sortOrder;
        }

        protected void MaintainActiveRow(int? ActiveRowIndex)
        {
            pageState.MaintainState(pageState.PageIndex, pageState.SortKey, pageState.GetSortOrder(pageState.SortOrder), pageState.FilterCriterion, ActiveRowIndex);
        }

        protected override void CreateChildControls()
        {
            List&lt;MenuGroup&gt; MenuGroupList = new List&lt;MenuGroup&gt;();

            MenuGroup GeneralGroup = new MenuGroup(&quot;General&quot;);
            GeneralGroup.AddMenu(new LargeButton(&quot;lnkNew&quot;, &quot;New&quot;, &quot;Icn_New.png&quot;));
            GeneralGroup.AddMenu(new TextIcon(&quot;lnkEdit&quot;, &quot;Edit&quot;, &quot;Icn_Edit_16.png&quot;));
            GeneralGroup.AddMenu(new TextIcon(&quot;lnkView&quot;, &quot;View&quot;, &quot;Icn_View_16.png&quot;));
            GeneralGroup.AddMenu(new TextIcon(&quot;lnkDelete&quot;, &quot;Delete&quot;, &quot;Icn_Delete_16.png&quot;));
            MenuGroupList.Add(GeneralGroup);

            MenuGroup WorkflowGroup = new MenuGroup(&quot;WorkFlow&quot;);
            WorkflowGroup.AddMenu(new TextIcon(&quot;lnkApprove&quot;, hasWorkFlow ? &quot;Approve&quot; : &quot;Approve/Reject&quot;, &quot;Icn_Approve_16.png&quot;));
            if (hasWorkFlow) WorkflowGroup.AddMenu(new TextIcon(&quot;lnkWorkFlow&quot;, &quot;Approval History&quot;, &quot;Icn_Settings_16.png&quot;));
            WorkflowGroup.AddMenu(new TextIcon(&quot;lnkSubmit&quot;, &quot;Submit&quot;, &quot;Icn_View_16.png&quot;));
            WorkflowGroup.AddMenu(new TextIcon(&quot;lnkReply&quot;, &quot;Reply&quot;, &quot;Icn_reply_16.png&quot;));
            WorkflowGroup.AddMenu(new TextIcon(&quot;lnkTransmittal&quot;, &quot;Transmittal&quot;, &quot;Icn_Transmittal_16.png&quot;));
            MenuGroupList.Add(WorkflowGroup);

            MenuGroup OthersGroup = new MenuGroup(&quot;Others&quot;);
            LargeButton FilterGroup = new LargeButton(&quot;lnkFilter&quot;, &quot;Filter&quot;, &quot;Icn_Filter.png&quot;);
            FilterGroup.AddSubMenu(new LargeButton(&quot;lnkFilterClr&quot;, &quot;Remove Filter&quot;, &quot;Icn_Filterremove_16.png&quot;));
            OthersGroup.AddMenu(FilterGroup);
            OthersGroup.AddMenu(new TextIcon(&quot;lnkImport&quot;, &quot;Excel Import&quot;, &quot;Icn_importxl_16.png&quot;));
            OthersGroup.AddMenu(new TextIcon(&quot;lnkExport&quot;, &quot;Excel Export (xls)&quot;, &quot;Icn_export_16.png&quot;));
            OthersGroup.AddMenu(new TextIcon(&quot;lnkExportXlsx&quot;, &quot;Excel Export (xlsx)&quot;, &quot;Icn_export_16.png&quot;));
            MenuGroupList.Add(OthersGroup);

            CreateToolBarMenu(MenuGroupList, null);
        }

        protected override void CustomizeToolBar()
        {
            string strModID = SubmittalsManager.Helper_GetModuleId_ForSubmittals_ByLinkId(Request[&quot;Link&quot;], Constants.MODID_PROJECT_Submittals);

            List&lt;string&gt; FeatureList = ModuleManager.Instance.GetPermissionByUserOrRole(strModID, UserDetail.GetCurrentUserDetail().UID,
                            UserDetail.GetCurrentUserDetail().RID, Request.QueryString[&quot;PID&quot;].ToInt32_2());

            if (MainToolBar.GetMenuReference(&quot;lnkNew&quot;) != null)
            {
                if (!FeatureList.Contains(&quot;Create&quot;))
                    MainToolBar.DisableMenu(&quot;lnkNew&quot;);
                MainToolBar.GetMenuReference(&quot;lnkNew&quot;).Click += lnkNew_Click;
            }
            if (MainToolBar.GetMenuReference(&quot;lnkEdit&quot;) != null)
            {
                if (!FeatureList.Contains(&quot;Edit&quot;))
                    MainToolBar.DisableMenu(&quot;lnkEdit&quot;);
                MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).Click += lnkEdit_Click;
                MainToolBar.GetMenuReference(&quot;lnkEdit&quot;).OnClientClick = &quot;return lnkValidation(&#39;Edit&#39;);&quot;;
            }
            if (MainToolBar.GetMenuReference(&quot;lnkView&quot;) != null)
            {
                if (!FeatureList.Contains(&quot;View&quot;))
                    MainToolBar.DisableMenu(&quot;lnkView&quot;);
                MainToolBar.GetMenuReference(&quot;lnkView&quot;).Click += lnkView_Click;
                MainToolBar.GetMenuReference(&quot;lnkView&quot;).OnClientClick = &quot;return lnkValidation(&#39;View&#39;);&quot;;
            }
            if (MainToolBar.GetMenuReference(&quot;lnkDelete&quot;) != null)
            {
                if (!FeatureList.Contains(&quot;Delete&quot;))
                    MainToolBar.DisableMenu(&quot;lnkDelete&quot;);
                MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).Click += lnkDelete_Click;
                MainToolBar.GetMenuReference(&quot;lnkDelete&quot;).OnClientClick = &quot;return lnkValidation(&#39;Delete&#39;);&quot;;
            }

            if (MainToolBar.GetMenuReference(&quot;lnkSubmit&quot;) != null)
            {
                if (!FeatureList.Contains(&quot;Submit&quot;))
                    MainToolBar.DisableMenu(&quot;lnkSubmit&quot;);
                MainToolBar.GetMenuReference(&quot;lnkSubmit&quot;).Click += lnkSubmit_Click;
                MainToolBar.GetMenuReference(&quot;lnkSubmit&quot;).OnClientClick = &quot;return lnkValidation(&#39;Submit&#39;);&quot;;
            }

            if (MainToolBar.GetMenuReference(&quot;lnkApprove&quot;) != null)
            {
                if (!FeatureList.Contains(&quot;Approve&quot;))
                    MainToolBar.DisableMenu(&quot;lnkApprove&quot;);
                MainToolBar.GetMenuReference(&quot;lnkApprove&quot;).OnClientClick = &quot;return lnkValidation(&#39;Approve&#39;);&quot;;
            }

            if (hasWorkFlow &amp;&amp; MainToolBar.GetMenuReference(&quot;lnkWorkFlow&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkWorkFlow&quot;).OnClientClick =
                    &quot;if(lnkValidation(&#39;WorkFlow&#39;)){ LoadWorkfowHistory(); } return false;;&quot;;
            }

            if (MainToolBar.GetMenuReference(&quot;lnkReply&quot;) != null)
            {
                if (!FeatureList.Contains(&quot;Reply&quot;))
                    MainToolBar.DisableMenu(&quot;lnkReply&quot;);
                MainToolBar.GetMenuReference(&quot;lnkReply&quot;).Click += lnkReply_Click;
                MainToolBar.GetMenuReference(&quot;lnkReply&quot;).OnClientClick = &quot;return lnkValidation(&#39;Reply&#39;);&quot;;
            }

            if (MainToolBar.GetMenuReference(&quot;lnkTransmittal&quot;) != null)
            {
                if (!FeatureList.Contains(&quot;Transmit&quot;))
                    MainToolBar.DisableMenu(&quot;lnkTransmittal&quot;);
                MainToolBar.GetMenuReference(&quot;lnkTransmittal&quot;).Click += lnkTransmittal_Click;
                MainToolBar.GetMenuReference(&quot;lnkTransmittal&quot;).OnClientClick = &quot;return lnkValidation(&#39;Transmittal&#39;);&quot;;
            }

            if (MainToolBar.GetMenuReference(&quot;lnkImport&quot;) != null)
            {
                if (!FeatureList.Contains(&quot;Import&quot;))
                    MainToolBar.DisableMenu(&quot;lnkImport&quot;);
                MainToolBar.GetMenuReference(&quot;lnkImport&quot;).Click += lnkImport_Click;
            }

            if (MainToolBar.GetMenuReference(&quot;lnkExport&quot;) != null)
            {
                if (!FeatureList.Contains(&quot;Export&quot;))
                    MainToolBar.DisableMenu(&quot;lnkExport&quot;);
                MainToolBar.GetMenuReference(&quot;lnkExport&quot;).Click += lnkExport_Click;
            }

            if (MainToolBar.GetMenuReference(&quot;lnkExportXlsx&quot;) != null)
            {
                if (!FeatureList.Contains(&quot;Export&quot;))
                    MainToolBar.DisableMenu(&quot;lnkExportXlsx&quot;);
                MainToolBar.GetMenuReference(&quot;lnkExportXlsx&quot;).Click += lnkExport_Click;
            }

            ScriptManager.RegisterArrayDeclaration(tblFilter, &quot;FilterFields&quot;,
                                                   &quot;&#39;&quot; + txtRequirement.ClientID + &quot;&#39;,&#39;&quot; + txtSubmittalType.ClientID +
                                                   &quot;&#39;,&#39;&quot; + rblStatus.ClientID + &quot;&#39;,&#39;3&#39;&quot;);

            //MainToolBar.GetMenuReference(&quot;lnkFilterClr&quot;).Style.Add(&quot;display&quot;, &quot;none&quot;);
            MainToolBar.GetMenuReference(&quot;lnkFilter&quot;).AddAttribute(&quot;style&quot;, &quot;display:none&quot;);
            PopupExtender.AddNewPopup(aspPnlFilter.ClientID, MainToolBar.GetMenuReference(&quot;lnkFilter&quot;).ClientID,
                                      btnCancel.ClientID);
            PopupExtender.AddNewPopup(aspPnlFilter.ClientID, MainToolBar.GetMenuReference(&quot;lnkFilter_SplitButton&quot;).ClientID,
                                      btnCancel.ClientID);
            btnFilter.OnClientClick = &quot;document.getElementById(&#39;&quot; + btnCancel.ClientID + &quot;&#39;).click(); applyFilter(&#39;&quot; +
                                      btnFilterGhost.ClientID + &quot;&#39;, &#39;&quot; +
                                      MainToolBar.GetMenuReference(&quot;lnkFilter&quot;).ClientID + &quot;&#39;, &#39;&quot; +
                                      MainToolBar.GetMenuReference(&quot;lnkFilterClr&quot;).ClientID + &quot;&#39;); return false;&quot;;
            btnReset.Attributes.Add(&quot;onClick&quot;,
                                    &quot;document.getElementById(&#39;&quot; + btnCancel.ClientID +
                                    &quot;&#39;).click();return resetFilters(&#39;&quot; + btnFilterGhost.ClientID + &quot;&#39;, &#39;&quot; +
                                    MainToolBar.GetMenuReference(&quot;lnkFilter&quot;).ClientID + &quot;&#39;, &#39;&quot; +
                                    MainToolBar.GetMenuReference(&quot;lnkFilterClr&quot;).ClientID + &quot;&#39;);&quot;);
            MainToolBar.GetMenuReference(&quot;lnkFilterClr&quot;).OnClientClick = &quot;return resetFilters(&#39;&quot; +
                                                                         btnFilterGhost.ClientID + &quot;&#39;, &#39;&quot; +
                                                                         MainToolBar.GetMenuReference(&quot;lnkFilter&quot;).
                                                                             ClientID + &quot;&#39;, &#39;&quot; +
                                                                         MainToolBar.GetMenuReference(&quot;lnkFilterClr&quot;).
                                                                             ClientID + &quot;&#39;);&quot;;
            RegisterStartupScript(&quot;showHideFilterButtons(&#39;&quot; +
                            MainToolBar.GetMenuReference(&quot;lnkFilter&quot;).ClientID + &quot;&#39;, &#39;&quot; +
                            MainToolBar.GetMenuReference(&quot;lnkFilterClr&quot;).ClientID + &quot;&#39;);&quot;, aspPnlFilter, &quot;showHideFilterButtons&quot;);
            if (hasWorkFlow)
            {
                PopupExtender.AddNewPopup(approvalWorkflow.aspPnlApprove.ClientID, btnMPGhost.ClientID,
                                          approvalWorkflow.btnCncl.ClientID, 300, 565);
                PopupExtender.AddNewPopup(approvalHistory.aspPnlWF.ClientID, btnWFGhost.ClientID,
                                          approvalHistory.btnCncl.ClientID, 300, 565);
            }
        }

        #region &quot;Link Button Clicks&quot;

        protected void lnkEdit_Click(object sender, EventArgs e)
        {
            if ((sender as LinkButton).Enabled == false)
                return;

            ContextMenu1_ItemCommand(sender, new CommandEventArgs(&quot;Edit&quot;, null));
        }

        protected void lnkUnApprove_Click(object sender, EventArgs e)
        {
            string SelectedSubmittals = hdnMulti.Value;
            int SubmittalID = SelectedSubmittals.Split(&#39;,&#39;)[0].ToInt32_2();
            SubmittalsManager.BLInstance.SubmittalUpdateStatus(SubmittalID, txtNotes.Text, &quot;P&quot;,
                                                               UserDetail.GetCurrentUserDetail().UID, null);
            BindData();
        }

        protected void lnkReject_Click(object sender, EventArgs e)
        {
            string SelectedSubmittals = hdnMulti.Value;
            int SubmittalID = SelectedSubmittals.Split(&#39;,&#39;)[0].ToInt32_2();
            SubmittalsManager.BLInstance.SubmittalUpdateStatus(SubmittalID, txtNotes.Text, &quot;R&quot;,
                                                               UserDetail.GetCurrentUserDetail().UID, null);
            BindData();
        }

        protected void lnkNew_Click(object sender, EventArgs e)
        {
            if ((sender as LinkButton).Enabled == false)
                return;

            ContextMenu1_ItemCommand(sender, new CommandEventArgs(&quot;Create&quot;, null));
        }

        protected void lnkView_Click(object sender, EventArgs e)
        {
            if ((sender as LinkButton).Enabled == false)
                return;

            ContextMenu1_ItemCommand(sender, new CommandEventArgs(&quot;View&quot;, null));
        }

        protected void btnDblClick_Click(object sender, EventArgs e)
        {
            ContextMenu1_ItemCommand(sender, new CommandEventArgs(&quot;View&quot;, null));
        }

        protected void lnkDelete_Click(object sender, EventArgs e)
        {
            if ((sender as LinkButton).Enabled == false)
                return;

            ContextMenu1_ItemCommand(sender, new CommandEventArgs(&quot;Delete&quot;, null));
        }

        protected void lnkSubmit_Click(object sender, EventArgs e)
        {
            if ((sender as LinkButton).Enabled == false)
                return;

            ContextMenu1_ItemCommand(sender, new CommandEventArgs(&quot;Submit&quot;, null));
        }

        protected void lnkReply_Click(object sender, EventArgs e)
        {
            if ((sender as LinkButton).Enabled == false)
                return;

            ContextMenu1_ItemCommand(sender, new CommandEventArgs(&quot;Reply&quot;, null));
        }

        protected void lnkTransmittal_Click(object sender, EventArgs e)
        {
            if ((sender as LinkButton).Enabled == false)
                return;

            ContextMenu1_ItemCommand(sender, new CommandEventArgs(&quot;Transmittal&quot;, null));
        }

        protected void lnkImport_Click(object sender, EventArgs e)
        {
            if ((sender as LinkButton).Enabled == false)
                return;

            ContextMenu1_ItemCommand(sender, new CommandEventArgs(&quot;Import&quot;, null));
        }

        protected void lnkExport_Click(object sender, EventArgs e)
        {
            if ((sender as LinkButton).Enabled == false)
                return;

            ContextMenu1_ItemCommand(sender, new CommandEventArgs(&quot;Export&quot;, null));
        }

        protected void btnApprove_Click(object sender, EventArgs e)
        {
            try
            {
                string SelectedSubmittals = hdnMulti.Value;
                int SubmittalID = SelectedSubmittals.Split(&#39;,&#39;)[0].ToInt32_2();

                if (hasWorkFlow)
                {
                    SubmittalsManager.BLInstance.SubmittalUpdateStatus(SubmittalID, txtNotes.Text, &quot;A&quot;,
                                                                       UserDetail.GetCurrentUserDetail().UID, null);
                }
                else
                {
                    if (rblApprove.Items[0].Selected)
                    {
                        SubmittalsManager.BLInstance.SubmittalUpdateStatus(SubmittalID, txtNotes.Text, &quot;A&quot;,
                                                                           UserDetail.GetCurrentUserDetail().UID, null);
                    }
                    else
                    {
                        SubmittalsManager.BLInstance.SubmittalUpdateStatus(SubmittalID, txtNotes.Text, &quot;R&quot;,
                                                                           UserDetail.GetCurrentUserDetail().UID, null);
                    }
                }
                txtNotes.Text = string.Empty;
                rblApprove.ClearSelection();
                BindData();
            }
            catch
            {
            }
        }

        # endregion
    }

    // This is for submittals List
    [ContextElement(Name = &quot;Project List&quot;)]
    public class ProjectListSubmittalsContextMenuImplementation : ContextElementCallBack
    {
        #region ContextElementCallBack Members

        public List&lt;BrixContextMenu&gt; GetActionList()
        {
            var lst = new List&lt;BrixContextMenu&gt;();
            DataRow drSubmittal = ModuleManagementBL.ModuleManager.Instance.GetModuleDetails(&quot;SUBMTAL&quot;);

            if (drSubmittal != null &amp;&amp; drSubmittal.Table.Columns.Contains(&quot;IsActive&quot;) &amp;&amp; drSubmittal[&quot;IsActive&quot;].ToBoolean2())
            {
                var item = new BrixContextMenu();
                item.Name = item.Description = &quot;Submittals List&quot;;
                item.GridParameters = &quot;ProjectID&quot;;
                item.IconImage = &quot;IcnPage.gif&quot;;
                lst.Add(item);
            }
            return lst;
        }

        public void DoCallBack(string Name, CIDictionary Parameters)
        {
            switch (Name)
            {
                case &quot;Submittals List&quot;:
                    HttpContext.Current.Response.Redirect(
                        @&quot;~/Common/BrixListPage.aspx&quot; + &quot;?context=SUBMTAL&amp;PID=&quot; + Parameters[&quot;ProjectId&quot;] + &quot;&amp;Link=PROJECT&amp;LinkID=0&amp;nt=1&quot;, true);
                    break;
            }
        }

        #endregion
    }

}

    </pre>
    <script type="text/javascript">
      highlightRanges([[36,15,36,28,0],[37,9,37,10,0],[38,13,38,36,0],[39,9,39,10,0],[43,17,43,18,0],[43,19,43,37,0],[43,38,43,39,0],[44,17,44,18,0],[44,19,44,38,0],[44,39,44,40,0],[49,17,49,18,0],[49,19,49,33,0],[49,34,49,35,0],[50,17,50,18,0],[50,19,50,34,0],[50,35,50,36,0],[54,9,54,10,0],[55,13,55,35,0],[56,13,56,78,0],[57,9,57,10,0],[60,9,60,10,0],[61,13,61,34,0],[62,13,62,35,0],[63,13,63,97,0],[64,9,64,10,0],[67,9,67,10,0],[68,13,68,31,0],[69,13,69,27,0],[70,13,70,32,0],[71,9,71,10,0],[89,17,89,18,0],[89,19,89,36,0],[89,37,89,38,0],[94,17,94,18,0],[94,19,94,28,0],[94,29,94,30,0],[99,17,99,18,0],[99,19,99,40,0],[99,41,99,42,0],[104,17,104,18,0],[104,19,104,28,0],[104,29,104,30,0],[108,9,108,10,0],[109,13,109,46,0],[110,13,110,83,0],[111,9,111,10,0],[114,9,114,10,0],[115,13,115,55,0],[116,17,116,79,0],[117,13,117,31,0],[118,9,118,10,0],[121,9,121,10,0],[122,13,122,69,0],[123,13,123,66,0],[124,13,124,82,0],[125,13,125,44,0],[128,13,128,42,0],[129,13,129,47,0],[131,13,131,62,0],[132,13,132,46,0],[133,13,133,14,0],[142,13,142,14,0],[144,13,144,14,0],[145,17,145,116,0],[146,13,146,14,0],[147,13,147,81,0],[148,13,148,28,0],[149,9,149,10,0],[152,9,152,10,0],[153,13,153,27,0],[154,13,154,14,0],[155,17,155,61,0],[156,17,156,18,0],[157,21,157,63,0],[158,17,158,18,0],[159,22,159,68,0],[160,17,160,18,0],[161,21,161,65,0],[162,17,162,18,0],[163,22,163,65,0],[164,17,164,18,0],[165,21,165,62,0],[166,17,166,18,0],[167,13,167,14,0],[168,9,168,10,0],[171,9,171,10,0],[172,13,172,24,0],[174,13,174,68,0],[176,13,178,117,0],[179,9,179,10,0],[182,9,182,10,0],[184,13,184,71,0],[188,13,188,49,0],[189,13,189,35,0],[211,13,213,41,0],[214,13,214,14,0],[216,17,216,99,0],[217,17,217,88,0],[218,13,218,14,0],[219,18,223,39,0],[223,39,223,40,0],[223,40,224,43,0],[224,43,226,101,0],[226,101,227,39,0],[227,39,227,40,0],[227,40,228,85,0],[219,18,228,85,0],[229,13,229,14,0],[230,17,230,40,0],[231,13,231,14,0],[233,13,233,14,0],[234,17,234,74,0],[235,17,235,77,0],[236,17,236,113,0],[237,17,237,76,0],[238,21,238,101,0],[239,13,239,14,0],[240,13,240,29,0],[241,17,241,28,0],[243,13,243,46,0],[244,9,244,10,0],[247,9,247,10,0],[248,13,248,62,0],[249,13,251,117,0],[252,9,252,10,0],[255,9,255,10,0],[256,13,256,49,0],[257,13,257,33,0],[258,13,258,50,0],[259,17,259,86,0],[261,13,261,35,0],[264,21,265,155,0],[266,21,266,27,0],[269,21,272,93,0],[273,21,273,27,0],[276,21,279,93,0],[280,21,280,27,0],[283,21,283,22,0],[284,25,284,155,0],[286,25,290,97,0],[291,21,291,22,0],[292,21,292,27,0],[295,21,295,22,0],[296,25,296,156,0],[298,25,302,97,0],[303,21,303,22,0],[304,21,304,27,0],[307,21,309,64,0],[310,21,310,27,0],[313,21,313,40,0],[314,21,314,27,0],[317,21,317,68,0],[318,21,318,28,0],[318,30,318,40,0],[318,41,318,43,0],[318,44,318,56,0],[319,21,319,22,0],[320,25,321,121,0],[322,21,322,22,0],[323,21,323,32,0],[324,21,324,27,0],[327,21,327,67,0],[328,21,328,69,0],[329,26,329,35,0],[329,37,329,61,0],[329,63,329,66,0],[330,21,330,22,0],[331,25,331,62,0],[332,25,332,79,0],[333,25,333,86,0],[334,25,334,55,0],[335,21,335,22,0],[338,21,338,22,0],[339,25,339,102,0],[340,21,340,22,0],[341,21,341,41,0],[342,21,342,22,0],[343,25,343,78,0],[344,25,344,61,0],[345,21,345,22,0],[347,21,347,45,0],[348,21,348,36,0],[349,21,349,32,0],[350,21,350,27,0],[352,9,352,10,0],[355,9,355,10,0],[356,13,356,59,0],[359,13,359,42,0],[360,17,360,37,0],[362,17,362,62,0],[363,13,365,102,0],[366,13,369,96,0],[371,13,371,42,0],[372,13,372,14,0],[373,17,373,51,0],[374,17,374,24,0],[377,13,377,45,0],[378,13,378,34,0],[382,13,382,47,0],[384,13,384,54,0],[385,13,385,57,0],[386,13,386,50,0],[387,13,387,55,0],[388,13,388,91,0],[390,13,390,82,0],[391,13,391,77,0],[392,13,392,65,0],[393,13,393,78,0],[394,13,394,70,0],[396,13,396,78,0],[397,13,397,14,0],[398,17,398,55,0],[399,17,399,53,0],[400,17,400,51,0],[401,17,401,47,0],[402,17,402,49,0],[403,13,403,14,0],[405,13,405,14,0],[406,17,406,67,0],[407,17,408,96,0],[409,17,409,48,0],[410,17,410,57,0],[411,17,411,51,0],[412,17,412,55,0],[413,17,413,53,0],[414,17,414,51,0],[415,17,415,47,0],[416,17,416,49,0],[417,13,417,14,0],[419,13,419,37,0],[422,21,422,65,0],[423,21,423,73,0],[424,21,424,27,0],[426,21,426,62,0],[427,21,427,70,0],[428,21,428,27,0],[430,21,430,66,0],[431,21,431,74,0],[432,21,432,27,0],[434,21,434,66,0],[435,21,435,74,0],[436,21,436,27,0],[439,13,439,55,0],[440,9,440,10,0],[443,9,443,10,0],[444,13,444,28,0],[447,13,447,42,0],[448,17,448,37,0],[450,17,450,62,0],[453,13,453,14,0],[454,17,454,144,0],[456,17,456,88,0],[458,17,463,57,0],[465,17,465,51,0],[466,17,466,42,0],[468,17,468,34,0],[469,13,469,14,0],[470,13,470,33,0],[471,13,471,14,0],[472,17,472,83,0],[473,13,473,14,0],[474,9,474,10,0],[477,9,477,10,0],[478,13,478,27,0],[479,9,479,10,0],[482,9,482,10,0],[483,13,485,41,0],[486,13,486,28,0],[487,13,487,24,0],[488,13,488,51,0],[489,9,489,10,0],[492,9,492,10,0],[494,13,494,63,0],[496,13,496,130,0],[497,13,497,134,0],[498,13,498,121,0],[500,13,500,38,0],[501,9,501,10,0],[504,9,504,10,0],[511,13,511,42,0],[512,17,512,37,0],[514,17,514,62,0],[516,13,518,48,0],[520,13,521,104,0],[522,13,522,14,0],[523,17,524,99,0],[525,13,525,14,0],[527,13,527,14,0],[528,17,528,116,0],[529,13,529,14,0],[531,13,534,44,0],[536,13,536,96,0],[538,13,540,134,0],[541,9,541,10,0],[544,9,544,10,0],[545,13,545,20,0],[545,22,545,41,0],[545,42,545,44,0],[545,45,545,66,0],[546,17,546,35,0],[548,13,548,69,0],[550,13,550,50,0],[551,13,551,56,0],[552,13,552,56,0],[553,13,553,58,0],[554,13,554,52,0],[555,13,555,58,0],[556,13,556,51,0],[557,13,557,54,0],[559,13,559,82,0],[560,13,560,77,0],[561,13,561,65,0],[562,13,562,69,0],[564,13,564,91,0],[566,13,566,66,0],[567,13,568,110,0],[569,13,569,94,0],[570,13,570,97,0],[572,13,572,51,0],[574,13,574,78,0],[575,13,575,14,0],[576,17,576,55,0],[577,17,577,64,0],[578,17,578,58,0],[580,17,580,68,0],[581,17,581,63,0],[582,17,582,48,0],[583,17,583,85,0],[584,17,584,73,0],[585,17,585,57,0],[586,17,586,67,0],[587,17,587,51,0],[588,13,588,14,0],[590,13,590,65,0],[591,13,591,63,0],[592,13,592,67,0],[593,13,593,60,0],[594,13,594,60,0],[596,13,596,68,0],[597,13,597,82,0],[598,13,598,87,0],[599,9,599,10,0],[602,9,602,10,0],[603,13,603,45,0],[604,13,606,123,0],[607,17,607,47,0],[609,17,609,46,0],[610,13,610,24,0],[611,13,611,20,0],[611,22,611,44,0],[611,45,611,47,0],[611,48,611,92,0],[612,17,612,64,0],[613,21,613,63,0],[614,13,614,55,0],[615,17,616,110,0],[617,13,617,60,0],[618,9,618,10,0],[621,9,621,10,0],[622,13,622,165,0],[623,9,623,10,0],[626,9,626,10,0],[627,13,627,67,0],[629,13,629,63,0],[630,13,630,83,0],[631,13,631,86,0],[632,13,632,86,0],[633,13,633,92,0],[634,13,634,45,0],[636,13,636,65,0],[637,13,637,129,0],[638,13,638,29,0],[638,30,638,124,0],[639,13,639,91,0],[640,13,640,90,0],[641,13,641,108,0],[642,13,642,46,0],[644,13,644,61,0],[645,13,645,96,0],[646,13,646,113,0],[647,13,647,46,0],[648,13,648,99,0],[649,13,649,103,0],[650,13,650,108,0],[651,13,651,44,0],[653,13,653,52,0],[654,9,654,10,0],[657,9,657,10,0],[658,13,658,144,0],[660,13,661,108,0],[663,13,663,64,0],[664,13,664,14,0],[665,17,665,53,0],[666,21,666,55,0],[667,17,667,78,0],[668,13,668,14,0],[669,13,669,65,0],[670,13,670,14,0],[671,17,671,51,0],[672,21,672,56,0],[673,17,673,80,0],[674,17,674,105,0],[675,13,675,14,0],[676,13,676,65,0],[677,13,677,14,0],[678,17,678,51,0],[679,21,679,56,0],[680,17,680,80,0],[681,17,681,105,0],[682,13,682,14,0],[683,13,683,67,0],[684,13,684,14,0],[685,17,685,53,0],[686,21,686,58,0],[687,17,687,84,0],[688,17,688,109,0],[689,13,689,14,0],[691,13,691,67,0],[692,13,692,14,0],[693,17,693,53,0],[694,21,694,58,0],[695,17,695,84,0],[696,17,696,109,0],[697,13,697,14,0],[699,13,699,68,0],[700,13,700,14,0],[701,17,701,54,0],[702,21,702,59,0],[703,17,703,111,0],[704,13,704,14,0],[706,13,706,84,0],[707,13,707,14,0],[708,17,709,93,0],[710,13,710,14,0],[712,13,712,66,0],[713,13,713,14,0],[714,17,714,52,0],[715,21,715,57,0],[716,17,716,82,0],[717,17,717,107,0],[718,13,718,14,0],[720,13,720,72,0],[721,13,721,14,0],[722,17,722,55,0],[723,21,723,63,0],[724,17,724,94,0],[725,17,725,119,0],[726,13,726,14,0],[728,13,728,67,0],[729,13,729,14,0],[730,17,730,53,0],[731,21,731,58,0],[732,17,732,84,0],[733,13,733,14,0],[735,13,735,67,0],[736,13,736,14,0],[737,17,737,53,0],[738,21,738,58,0],[739,17,739,84,0],[740,13,740,14,0],[742,13,742,71,0],[743,13,743,14,0],[744,17,744,53,0],[745,21,745,62,0],[746,17,746,88,0],[747,13,747,14,0],[749,13,751,90,0],[754,13,754,93,0],[755,13,756,59,0],[757,13,758,59,0],[759,13,762,115,0],[763,13,767,100,0],[768,13,773,95,0],[774,13,776,131,0],[777,13,777,29,0],[778,13,778,14,0],[779,17,780,88,0],[781,17,782,87,0],[783,13,783,14,0],[784,9,784,10,0],[789,9,789,10,0],[790,13,790,57,0],[791,17,791,24,0],[793,13,793,82,0],[794,9,794,10,0],[797,9,797,10,0],[798,13,798,56,0],[799,13,799,76,0],[800,13,801,109,0],[802,13,802,24,0],[803,9,803,10,0],[806,9,806,10,0],[807,13,807,56,0],[808,13,808,76,0],[809,13,810,109,0],[811,13,811,24,0],[812,9,812,10,0],[815,9,815,10,0],[816,13,816,57,0],[817,17,817,24,0],[819,13,819,84,0],[820,9,820,10,0],[823,9,823,10,0],[824,13,824,57,0],[825,17,825,24,0],[827,13,827,82,0],[828,9,828,10,0],[831,9,831,10,0],[832,13,832,82,0],[833,9,833,10,0],[836,9,836,10,0],[837,13,837,57,0],[838,17,838,24,0],[840,13,840,84,0],[841,9,841,10,0],[844,9,844,10,0],[845,13,845,57,0],[846,17,846,24,0],[848,13,848,84,0],[849,9,849,10,0],[852,9,852,10,0],[853,13,853,57,0],[854,17,854,24,0],[856,13,856,83,0],[857,9,857,10,0],[860,9,860,10,0],[861,13,861,57,0],[862,17,862,24,0],[864,13,864,89,0],[865,9,865,10,0],[868,9,868,10,0],[869,13,869,57,0],[870,17,870,24,0],[872,13,872,84,0],[873,9,873,10,0],[876,9,876,10,0],[877,13,877,57,0],[878,17,878,24,0],[880,13,880,84,0],[881,9,881,10,0],[884,9,884,10,0],[886,13,886,14,0],[887,17,887,60,0],[888,17,888,80,0],[890,17,890,33,0],[891,17,891,18,0],[892,21,893,117,0],[894,17,894,18,0],[896,17,896,18,0],[897,21,897,54,0],[898,21,898,22,0],[899,25,900,121,0],[901,21,901,22,0],[903,21,903,22,0],[904,25,905,121,0],[906,21,906,22,0],[907,17,907,18,0],[908,17,908,46,0],[909,17,909,45,0],[910,17,910,28,0],[911,13,911,14,0],[912,13,912,18,0],[913,13,913,14,0],[914,13,914,14,0],[915,9,915,10,0],[927,9,927,10,1],[928,13,928,51,1],[929,13,929,105,1],[931,13,931,127,1],[932,13,932,14,1],[933,17,933,50,1],[934,17,934,66,1],[935,17,935,51,1],[936,17,936,48,1],[937,17,937,31,1],[938,13,938,14,1],[939,13,939,24,1],[940,9,940,10,1],[943,9,943,10,0],[944,13,944,26,0],[947,21,948,146,0],[949,21,949,27,0],[951,9,951,10,0]]);
    </script>
  </body>
</html>