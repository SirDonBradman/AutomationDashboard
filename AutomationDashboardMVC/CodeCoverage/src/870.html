<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Business Layer\Utility\BrixPageBase.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections;
using System.Collections.Generic;
using System.Configuration;
using System.Data;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Reflection;
using System.Runtime.Serialization.Json;
using System.Text;
using System.Text.RegularExpressions;
using System.Threading;
using System.Web;
using System.Web.Caching;
using System.Web.Configuration;
using System.Web.Script.Serialization;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.Core.AbstractModels;
using Aurigo.AMP3.Core.BusinessLayer.BL;
using Aurigo.AMP3.Core.BusinessLayer.DTO;
using Aurigo.AMP3.Core.UserControls;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.AMP3.EnterpriseBL;
using Aurigo.AMP3.Logging;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.AMP3.ProjectBL;
using Aurigo.AMP3.Resources.MessageResources;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.AMP3.UserManagementBL;
using Aurigo.Brix.Platform.BusinessLayer.AbstractModels;
using Aurigo.Brix.Platform.BusinessLayer.BL;
using Aurigo.Brix.Platform.BusinessLayer.DataAccessHelper;
using Aurigo.Brix.Platform.BusinessLayer.UserControls;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Aurigo.Brix.Platform.BusinessLayer.XMLForm;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.Brix.WorkflowMediators;
using Aurigo.Common;
using Aurigo.Workflow;
using CacheProvider;
using Infragistics.WebUI.UltraWebGrid;
using Telerik.Web.UI;

namespace Aurigo.Brix.Core.WebUiHelper
{
    public class BrixPageBase : Page, ICallbackEventHandler
    {
        // member variable to hold the help ID
        // pages derived from this page will set their own value
        public ToolBar MainToolBar;

        public TabBar PageTabBar;
        public string ParentModuleID;
        public const string groupName = &quot;Workflow&quot;;
        public HtmlGenericControl XMLInjectionDiv;
        protected object _CanAddSaveButton;
        protected object _SaveButtonAdded;
        protected IWorkflowEnabled _FormInfo;
        protected object _HasInCompleteWorkflows;
        protected object _IsEdit;
        protected object _IsList;
        protected object _IsNew;
        protected object _IsView;
        protected DateTime _PageInitTime;
        protected DateTime? _OnPreRenderCompleteTime;
        protected string _PerfLog;
        protected string _RequestString;
        protected List&lt;Guid&gt; _WorkflowsInitiated;
        protected List&lt;Guid&gt; _WorkflowsInitiatedForCurrentStatus;
        protected Dictionary&lt;string, KeyValuePair&lt;string, List&lt;IAction&gt;&gt;&gt; _WorkflowStates;
        private ContextMenu _cMenu;
        protected Dictionary&lt;string, IState&gt; _wfStates;
        protected ApprovalWorkflow appWorkflow;
        protected bool _IsListPage;
        public bool bypassInstanceSetting;
        private string callbackString;
        protected string _CompanyId;
        protected string _SmtpServer;
        protected List&lt;string&gt; _ModuleComponents;
        protected bool _bIsWorkflowTimedOut;
        protected bool _bIsOnInitCalled;
        protected bool _bIsCreateChildControlsCalled;
        public string PageUniqueID = string.Empty;
        protected Dictionary&lt;string, bool?&gt; dicHasRoleToPlay;

        public DataTable columnInfo;
        private HiddenField hdnViewStateKey;
        protected List&lt;Label&gt; labels;
        public XMLRenderingEngine xmlEngine;
        public BrixFormModel xmlInjection;
        public bool UpdateTree = false;
        public string PageTitle { get; set; }
        public string ContextElement { get; set; }
        public UltraWebGrid ContextElementUGrid { get; set; }
        public RadGrid ContextElementRadGrid { get; set; }
        public HierarchicalGrid ContextElementHGrid { get; set; }
        public string ActiveTab = &quot;ENTPRSE&quot;;

        public bool ShowRedirectConfirm = false;

        public string ModuleId { get; set; }

        public virtual List&lt;string&gt; PermissionsToCheck { get; set; }

        public string sActionName = &quot;&quot;;
        private bool _isWorkflowAssociated;
        private UserUsage userUsage;

        private ToastrNotification _notifier;
        public MasterPage master;

        private UIScriptHelper _ScriptHelper = new UIScriptHelper();

        public UIScriptHelper ScriptHelper
        {
            get
            {
                return _ScriptHelper;
            }
        }

        public string Timestamp
        {
            get
            {
                if (ViewState[&quot;Timestamp&quot;] == null)
                    ViewState[&quot;Timestamp&quot;] = string.Empty;

                return ViewState[&quot;Timestamp&quot;].ToString();
            }
            set
            {
                ViewState[&quot;Timestamp&quot;] = value;
            }
        }

        public BrixPageBase()
        {
            this.Load += new EventHandler(this.Page_LoadBase);
        }

        public List&lt;string&gt; CoreModuleComponents
        {
            get
            {
                InitModuleComponents();
                return _ModuleComponents;
            }
        }

        public string FormInstanceId
        {
            get
            {
                int pid = String.IsNullOrEmpty(Request.QueryString[Constants.QRY_PROJECTID])
                    ? -1
                    : int.TryParse(Request.QueryString[Constants.QRY_PROJECTID], out pid) ? pid : -1;
                return pid.ToString();
            }
        }

        public bool ShowWorkFlowActionOnListPage { get; set; } = true;

        public bool CreateNewWorkflow
        {
            get
            {
                if (ViewState[&quot;createNewWorkflow&quot;] == null) return false;
                else
                    return Boolean.Parse(ViewState[&quot;createNewWorkflow&quot;].ToString());
            }
            set
            {
                ViewState[&quot;createNewWorkflow&quot;] = value;
                ViewState[&quot;WorkflowGuid&quot;] = &quot;&quot;;
            }
        }

        public bool HideShowMainToolBar
        {
            get
            {
                return MainToolBar.Visible;
            }
            set
            {
                MainToolBar.Visible = value;
            }
        }

        public string WorkflowGuids
        {
            get
            {
                return ViewState[&quot;WorkflowGuid&quot;] == null ? string.Empty : ViewState[&quot;WorkflowGuid&quot;].ToString();
            }
            set
            {
                var sVal = (string)ViewState[&quot;WorkflowGuid&quot;];
                if (sVal == null) ViewState[&quot;WorkflowGuid&quot;] = value;
                else if (!sVal.Contains(value)) ViewState[&quot;WorkflowGuid&quot;] = &quot;,&quot; + value;
            }
        }

        protected virtual bool IsNew
        {
            get
            {
                if (null == _IsNew) SetModes();
                return (null == _IsNew) ? false : (bool)_IsNew;
            }
        }

        protected virtual bool IsEdit
        {
            get
            {
                if (null == _IsEdit) SetModes();
                return (null == _IsEdit) ? false : (bool)_IsEdit;
            }
        }

        protected virtual bool IsView
        {
            get
            {
                if (null == _IsView) SetModes();
                return (null == _IsView) ? false : (bool)_IsView;
            }
        }

        protected virtual bool IsList
        {
            get
            {
                if (null == _IsView) SetModes();
                return (null == _IsView) ? false : (bool)_IsView;
            }
        }

        protected bool HasSaveButton
        {
            get { return null == _SaveButtonAdded ? false : (bool)_SaveButtonAdded; }
        }

        protected Aurigo.AMP3.Core.UserControls.Menu GetSaveButton()
        {
            return !HasSaveButton ? null : MainToolBar.GetMenuReference(&quot;lnkSave&quot;);
        }

        protected bool AddSaveButton(MenuArray menus)
        {
            if (!AllowSave)
            {
                _SaveButtonAdded = false;
                return false;
            }
            menus.Add(new BrixMenu(&quot;lnkSave&quot;, &quot;Save&quot;, &quot;Icn_Save.png&quot;, 55));
            _SaveButtonAdded = true;
            return true;
        }

        protected bool AddSaveButton(MenuGroup group)
        {
            if (!AllowSave)
            {
                _SaveButtonAdded = false;
                return false;
            }
            LargeButton lnkSave = new LargeButton(&quot;lnkSave&quot;, &quot;Save&quot;, &quot;Icn_Save.png&quot;);
            group.AddMenu(lnkSave);
            _SaveButtonAdded = true;
            return true;
        }

        public virtual bool AutoSaveOnWorkflowActionClick
        {
            get
            {
                if (MainToolBar.GetMenuReference(&quot;lnkSave&quot;) != null &amp;&amp; MainToolBar.GetMenuReference(&quot;lnkSave&quot;).Visible &amp;&amp; MainToolBar.GetMenuReference(&quot;lnkSave&quot;).Enabled &amp;&amp; !IsView)
                    return true;
                return false;
            }
        }

        private IList&lt;string&gt; _ModulePermissions = null;

        private IList&lt;string&gt; ModulePermissions
        {
            get
            {
                if (_ModulePermissions == null)
                {
                    int pID = (string.IsNullOrEmpty(Request.QueryString[&quot;PID&quot;]) ? 0 : Request.QueryString[&quot;PID&quot;].ToInt32_2());
                    UserDetail ud = UserDetail.GetCurrentUserDetail();
                    _ModulePermissions = ModuleManager.Instance.GetPermissionByUserOrRole(this.ModuleId, ud.UID, ud.RID, pID, true);
                }
                return _ModulePermissions;
            }
        }

        public bool AllowSave
        {
            get
            {
                if (_CanAddSaveButton != null) return (bool)_CanAddSaveButton;

                IWorkflowEnabled formInfo = null;
                if (!(this is IWorkflowEnabled))
                {
                    _CanAddSaveButton = true;
                    return true;
                }

                if (null == _FormInfo &amp;&amp; this is IWorkflowEnabled)
                    _FormInfo = (IWorkflowEnabled)this;
                if (null == formInfo) formInfo = _FormInfo;
                string form = (null != formInfo) ? formInfo.FormName : null;
                if (null == form) return false;

                if (string.IsNullOrEmpty(formInfo.FormInstanceId) || formInfo.FormInstanceId == &quot;-1&quot; || IsNew)
                {
                    //For New Case we need to show the save button only if user has create permission
                    bool bHasPerm = false;
                    try
                    {
                        ///we need a better solution here - the form value will return
                        ///xcontext while permissions are defined on legacy context
                        //List&lt;string&gt; perms = ModuleManager.Instance.GetPermissionByRole(form, UserDetail.GetCurrentUserDetail().RID);
                        //if (null != perms &amp;&amp; perms.Contains(&quot;Create&quot;)) bHasPerm = true;
                        bHasPerm = true;
                    }
                    catch
                    {
                    }
                    _CanAddSaveButton = bHasPerm;
                    return bHasPerm;
                }

                bool bIsWorkflowAssociatedatFormLevel = IsWorkflowAssociated();
                if (!bIsWorkflowAssociatedatFormLevel)
                {
                    //If workflow is not attach then we need to show the save button
                    _CanAddSaveButton = true;
                    return true;
                }

                bool bIsComplete = false;
                DataTable dt = BrixWorkflowManager.Instance.GetWorkflowMappingDetails(formInfo.FormInstanceId,
                    formInfo.FormName);
                List&lt;string&gt; stakeHolders = new List&lt;string&gt;();
                if (dt.Rows.Count &gt; 0)
                    for (int i = 0; i &lt; dt.Rows.Count; i++)
                    {
                        bIsComplete = DBNull.Value == dt.Rows[i][&quot;IsCompleted&quot;]
                            ? false
                            : dt.Rows[i][&quot;IsCompleted&quot;].ToString() == &quot;True&quot;;
                        if (bIsComplete) continue;
                        string[] roles = DBNull.Value == dt.Rows[i][&quot;CurrentRole&quot;]
                            ? null
                            : dt.Rows[i][&quot;CurrentRole&quot;].ToString().Split(&#39;,&#39;);
                        if (null == roles) continue;
                        stakeHolders.AddRange(roles);
                    }
                if (null == dicHasRoleToPlay) dicHasRoleToPlay = new Dictionary&lt;string, bool?&gt;();
                bool bHasRoleToPlay = false;
                UserDetail sCurrentUser = UserDetail.GetCurrentUserDetail();
                Dictionary&lt;int, string&gt; userRoles = new Dictionary&lt;int, string&gt;();

                int pid = (string.IsNullOrEmpty(Request.QueryString[&quot;PID&quot;]) ? 0 : Request.QueryString[&quot;PID&quot;].ToInt32_2());

                userRoles = UserManager.Instance.GetUserRolesBasedOnProjectId(sCurrentUser.UID,
                    pid, sCurrentUser.RID, sCurrentUser.RoleName);

                //If IsAllowEditingForNonStakeHolder is configured for a module
                //and if workflow is not completed and user is invited to the project
                //and has edit permission on module then the user can save the record.
                if (!bIsComplete &amp;&amp; userRoles.Count &gt; 0
                    &amp;&amp; IsEdit &amp;&amp; ModuleManager.Instance.IsAllowEditingForNonStakeHolder(ModuleId))
                {
                    if (null != ModulePermissions &amp;&amp; ModulePermissions.Contains(Constants.MODFEAT_EDIT.ToLower2()))
                    {
                        _CanAddSaveButton = true;
                        return true;
                    }
                }

                foreach (string stakeHolderRole in stakeHolders)
                {
                    int stakeHolderRoleID = UserManager.Instance.GetUsersRoleId(stakeHolderRole);
                    if (userRoles.ContainsKey(stakeHolderRoleID))
                    {
                        bHasRoleToPlay = true;
                        //if current user role matches the stakeholders roles, then proceed further
                        string workflowInstanceGuid = dt.Rows[0][&quot;WorkflowInstanceGuid&quot;].ToString();

                        _CanAddSaveButton = bHasRoleToPlay =
                            !WFRuntimeHandlerDB.HasCurrentUserPerformedWorkflowAction(workflowInstanceGuid, userRoles,
                                sCurrentUser.UID);
                        break;
                    }
                }
                return null == _CanAddSaveButton ? false : (bool)_CanAddSaveButton;
            }

            set
            {
                _CanAddSaveButton = value;
            }
        }

        private bool IsRedirected
        {
            get { return !string.IsNullOrEmpty(Request[&quot;Redirected&quot;]) &amp;&amp; Context.Session[&quot;REDIRECTMESSAGE&quot;] != null; }
        }

        #region ICallbackEventHandler Members

        public virtual string GetCallbackResult()
        {
            return callbackString;
        }

        public virtual void RaiseCallbackEvent(string eventArgument)
        {
            var jsonSerialiser = new DataContractJsonSerializer(typeof(ajaxData));
            var stream1 = new MemoryStream();
            stream1.Write(Encoding.Unicode.GetBytes(eventArgument), 0, Encoding.Unicode.GetBytes(eventArgument).Length);
            stream1.Position = 0;
            var values = (ajaxData)jsonSerialiser.ReadObject(stream1);
            callbackString = xControl.EvaluateFormulae(values, xmlInjection.form);
        }

        #endregion ICallbackEventHandler Members

        public ContextMenu CMenu
        {
            get
            {
                if (_cMenu == null)
                {
                    if (Page.MasterPageFile.ToUpper().Contains(&quot;INSITECORE.MASTER&quot;))
                        _cMenu = (ContextMenu)Page.Master.FindControl(&quot;CMenu&quot;);
                }
                return _cMenu;
            }
        }

        public ToastrNotification Notifier
        {
            get
            {
                if (_notifier == null)
                {
                    if (Page.MasterPageFile.ToUpper().Contains(&quot;INSITECORE.MASTER&quot;))
                        _notifier = (ToastrNotification)Page.Master.FindControl(&quot;toastrNotifier&quot;);
                    else if (Page.Master.MasterPageFile.ToUpper().Contains(&quot;INSITECORE.MASTER&quot;))
                        _notifier = (ToastrNotification)Page.Master.Master.FindControl(&quot;toastrNotifier&quot;);
                }
                return _notifier;
            }
        }

        protected override void OnPreInit(EventArgs e)
        {
            _PageInitTime = DateTime.UtcNow;
            InitUserUsage();

            if (WebConfigurationManager.AppSettings[&quot;CentralizedWebfarm&quot;] != null &amp;&amp;
                WebConfigurationManager.AppSettings[&quot;CentralizedWebfarm&quot;].ToBoolean2())
                new WebFarmData().Check(Page);

            #region Setting Culture Info

            //CultureInfo ci = new CultureInfo(AMP3ApplicationSettings.Instance.Culture);
            Thread.CurrentThread.CurrentCulture = DateFormatCulture.MWDateFormatCulture;
            Thread.CurrentThread.CurrentUICulture = DateFormatCulture.MWDateFormatCulture;

            #endregion Setting Culture Info

            if (PermissionsToCheck == null)
                PermissionsToCheck = new List&lt;string&gt;();

            base.OnPreInit(e);
            //if (String.IsNullOrEmpty(Request[Constants.QRY_PROJECTMODE]))
            //{
            //    if (!String.IsNullOrEmpty(Request[Constants.QRY_PROJECTID]))
            //    {
            //        NameValueCollection QS = Request.QueryString;
            //        QS = (NameValueCollection)Request.GetType().GetField(&quot;_queryString&quot;, BindingFlags.NonPublic | BindingFlags.Instance).GetValue(Request);
            //        PropertyInfo readOnlyInfo = QS.GetType().GetProperty(&quot;IsReadOnly&quot;, BindingFlags.NonPublic | BindingFlags.Instance);
            //        readOnlyInfo.SetValue(QS, false, null);
            //        QS[Constants.QRY_PROJECTMODE] = GetProjectMode();
            //        readOnlyInfo.SetValue(QS, true, null);
            //    }

            //}
        }

        private void InitUserUsage()
        {
            if (null != userUsage) return;
            userUsage = new UserUsage();
            userUsage.Url = Request.RawUrl;
            userUsage.IP = Request.ServerVariables[&quot;REMOTE_ADDR&quot;];
            userUsage.TimeDt = DateTime.UtcNow;
            userUsage.Comment = &quot;Page Visited&quot;;
        }

        protected override void OnLoad(EventArgs e)
        {
            base.OnLoad(e);

            #region UserUsage

            UserDetail ud = UserDetail.GetCurrentUserDetail();
            if (ud != null)
            {
                InitUserUsage();
                userUsage.UserID = ud.UID;
                userUsage.UserName = ud.UserName;
                userUsage.UserEmail = ud.Email;
                userUsage.SessionID = Session.SessionID;
                userUsage.Module = ModuleId;
                userUsage.Role = ud.RoleName;
                userUsage.CompanyCode = ConnectionHelper.GetCurrentCompany();

                // EnterpriseManager.Instance.CreateUpdateUserUsage(userUsage);
            }

            #endregion UserUsage

            this.InclueScriptAndStyleFiles();
        }

        protected override void OnPreRenderComplete(EventArgs e)
        {
            ScriptHelper.RegisterScriptsAndStyles(this);

            base.OnPreRenderComplete(e);
            _OnPreRenderCompleteTime = DateTime.UtcNow;
        }

        protected override void OnUnload(EventArgs e)
        {
            base.OnUnload(e);
            try
            {
                //if (!AppConfig.LogDebug()) return;
                TimeSpan spanBL = null == _OnPreRenderCompleteTime
                    ? DateTime.UtcNow.Subtract(_PageInitTime)
                    : _OnPreRenderCompleteTime.Value.Subtract(_PageInitTime);
                TimeSpan spanRender = null == _OnPreRenderCompleteTime
                    ? new TimeSpan()
                    : DateTime.UtcNow.Subtract(_OnPreRenderCompleteTime.Value);

                //_PerfLog = string.Format(&quot;{0}\t{1}\t\t{3}?{4}\t{2}\r\n&quot;, spanBL.TotalMilliseconds.ToString(), spanRender.TotalMilliseconds.ToString(), DateTime.UtcNow.ToString(), Page.AppRelativeVirtualPath, _RequestString);
                //Utilities.WriteToFile(AppConfig.LogFilePath() + &quot;Perf.csv&quot;, _PerfLog);

                if (userUsage == null) return;

                userUsage.BLTime = spanBL.TotalMilliseconds.ToString();
                userUsage.RenderTime = spanRender.TotalMilliseconds.ToString();

                if (spanRender.TotalMilliseconds == 0 &amp;&amp;
                    string.IsNullOrEmpty(ConfigurationManager.AppSettings[&quot;EnableUsageOnAjax&quot;]))
                    return;

                EnterpriseManager.Instance.CreateUpdateUserUsage(userUsage);
            }
            catch
            {
            }
        }

        protected bool UseApplyGridWidthStyle = true;

        protected void ApplyBrowserStyle(object obj)
        {
            Type type = obj.GetType();
            BindingFlags bindFlags = BindingFlags.Instance | BindingFlags.NonPublic | BindingFlags.Public |
                                     BindingFlags.Static;
            foreach (FieldInfo fieldInfo in type.GetFields(bindFlags))
            {
                object ctrl = fieldInfo.GetValue(obj);
                if (ctrl is UltraWebGrid)
                {
                    var grd = (ctrl as UltraWebGrid);
                    if (Request.Browser.IsBrowser(&quot;Chrome&quot;) || Request.Browser.IsBrowser(&quot;Safari&quot;) ||
                        Request.Browser.IsBrowser(&quot;Opera&quot;) || Request.UserAgent.Contains(&quot;Trident/7.0&quot;))
                        grd.Browser = BrowserLevel.UpLevel;
                }
                else if (ctrl is UserControl)
                    ApplyBrowserStyle(ctrl);
            }
        }

        protected void ApplyGridWidthStyle(Control control)
        {
            if (control is RadGrid)
            {
                var grid = (control as RadGrid);
                if (!ClientScript.IsStartupScriptRegistered(&quot;GridStyle&quot; + grid.ClientID))
                    RegisterStartupScript(string.Format(&quot;$(document).ready(function(){{ApplyGridStyle(\&quot;{0}\&quot;,\&quot;#{1}_main\&quot;)}});&quot;,
                            grid.ClientID, grid.ClientID.Replace(&quot;_&quot;, &quot;x&quot;)), grid, &quot;GridStyle&quot; + grid.ClientID);
            }
            foreach (Control ctrl in control.Controls)
                ApplyGridWidthStyle(ctrl);
        }

        protected void InitModuleComponents()
        {
            if (null == _ModuleComponents)
                _ModuleComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);
        }

        public virtual void InclueScriptAndStyleFiles()
        {
        }

        public virtual int GetProjectIdFromInstanceId()
        {
            return (string.IsNullOrEmpty(Request.QueryString[&quot;PID&quot;]) ? 0 : Request.QueryString[&quot;PID&quot;].ToInt32_2());
        }

        public virtual bool CheckAccess()
        {
            /* Read the permissions set to be checked for authorization
            * Get the UserId from the session
            * Get RoleId from session
            * Get Projectid/PID from params
            * */
            int pID = (string.IsNullOrEmpty(Request.QueryString[&quot;PID&quot;]) ? 0 : Request.QueryString[&quot;PID&quot;].ToInt32_2());
            UserDetail ud = UserDetail.GetCurrentUserDetail();
            //IList&lt;string&gt; allowedPermissions = ModuleManager.Instance.GetPermissionByUserOrRole(this.ModuleId, ud.UID, ud.RID, pID, true);

            // check if permissions to check is in allowed permissions.
            if (ModulePermissions.Count &lt; PermissionsToCheck.Count)
                return false;

            for (int i = 0; i &lt; PermissionsToCheck.Count; i++)
            {
                if (!ModulePermissions.Contains(PermissionsToCheck[i].ToLower()))
                    return false;
            }
            return true;
        }

        protected void Page_LoadBase(object sender, EventArgs e)
        {
            // To implement security:: making sure that BrixPageBase&#39;s OnInit() function is called, which internally call CheckAccess() function.
            if (!_bIsOnInitCalled)
            {
                throw new Exception(&quot;BrixPageBase&#39;s OnInit() function is not called.&quot;);
            }
        }

        public virtual void OnAccessDeniedRedirect()
        {
            // Permissions Inadequate
            UIHelper.RedirectURL(MessageResourceManager.GetString(&quot;E_USRMGMT_NO_PERMISSIONS_TO_VIEW_PAGE&quot;, Enumerations.MessageType.ErrorMessage),
                ResolveUrl(Constants.URL_ACCESS_DENIED), null, Context);
        }

        private bool VerifyPojectId()
        {
            if (GetProjectIdFromInstanceId() == (string.IsNullOrEmpty(Request.QueryString[&quot;PID&quot;]) ? 0 : Request.QueryString[&quot;PID&quot;].ToInt32_2()))
                return true;
            else
                return false;
        }

        protected override void OnInit(EventArgs e)
        {
            if (_bIsOnInitCalled)
            {
                if (null != e) base.OnInit(e);
                return;
            }
            try
            {
                if (!VerifyPojectId() || !CheckAccess())
                {
                    // Permissions Inadequate
                    OnAccessDeniedRedirect();
                }

                _RequestString = Request.QueryString.ToString();
                _CompanyId = ConnectionHelper.GetCurrentCompany();
                _SmtpServer = AMP3ApplicationSettings.Instance.SmtpServer;
                InitModuleComponents();

                ApplyBrowserStyle(Page);
                if (this is IXMLControl)
                {
                    IXMLControl x = this as IXMLControl;
                    InitXMLControl(x.ParentFormInstanceID != null &amp;&amp; x.ParentFormInstanceID.Length &gt; 0
                        ? x.ParentFormInstanceID[0]
                        : null);
                }

                // Note: this hack is to make it work with all the page which have insitecore or BrixTabMaster  as there master page.
                // BrixTabMaster has insitecore as it&#39;s master page.

                //ClientScript.RegisterClientScriptInclude(&quot;workflowScript&quot;,
                //    ResolveClientUrl(&quot;~/Scripts/Workflow_20160721_1717.js&quot;));
                if (this is IWorkflowEnabled &amp;&amp; (!_IsListPage || (_IsListPage &amp;&amp; this.ShowWorkFlowActionOnListPage)))
                {
                    EnableWorkflowNotesDialog(btnWorkflowAction_Click);
                }

                // THis line of code will give error if basepage is inherited by a page which does not use insitecore as its master page
                hdnViewStateKey = (HiddenField)FindControl(this, &quot;_hdnViewStateKey&quot;);

                if (IsRedirected)
                {
                    //master = Master.Master ?? Master;
                    //var Notifier = (ModalPopupExtender)master.FindControl(&quot;Notifier&quot;);
                    //Notifier.Visible = true;
                    //(master.FindControl(&quot;lblNotification&quot;) as Label).Text = Context.Session[&quot;REDIRECTMESSAGE&quot;].ToString();
                    //Notifier.AddNewPopup((master.FindControl(&quot;pnlNotifications&quot;) as Panel).ClientID, (master.FindControl(&quot;btnShowNotifier&quot;) as Button).ClientID, (master.FindControl(&quot;btnCancelNotifier&quot;) as Button).ClientID);
                    ShowError(Context.Session[&quot;REDIRECTMESSAGE&quot;].ToString());
                    //Page.ClientScript.RegisterStartupScript(this.GetType(), &quot;notification&quot;, &quot; $(&#39;document&#39;).ready(ShowErrorMessage);&quot;, true);
                    Context.Session[&quot;REDIRECTMESSAGE&quot;] = null;
                }

                _bIsOnInitCalled = true;
            }
            catch (Exception ex)
            {
                Logger.Log(AMP3.Resources.MessageResources.Enumerations.LogType.Error, ex.Message, &quot;BrixPageBase-OnInit&quot;, ex);
            }
            finally
            {
                if (null != e) base.OnInit(e);
            }
        }

        protected virtual void ShowConcurrencyMessage()
        {
            // _hdnShowConcurrencyMsg field should be in masterPage
            HiddenField hdnField = (HiddenField)FindControl(this, &quot;_hdnShowConcurrencyMsg&quot;);

            if (hdnField != null)
                hdnField.Value = &quot;1&quot;;
        }

        protected void InitXMLControl(object ParentFormInstanceID)
        {
            //Using Request.CurrentExecutionFIlePath instead of Request.URL as Request.url doesnt work for server.transfer
            //string formName = Request.Url.Segments[Request.Url.Segments.Length - 1].Split(&#39;.&#39;)[0];
            string formName =
                Request.CurrentExecutionFilePath.Split(&#39;/&#39;)[Request.CurrentExecutionFilePath.Split(&#39;/&#39;).Length - 1]
                    .Split(&#39;.&#39;)[0];
            //If it is in documents page then its a metadata for which an etry will not be there in xmlControlmater table. Hence take it from the path.
            //The metadata xmls are stored in \Modules\PROJECT\XMLControls\ folder.
            if (formName != &quot;Documents&quot;)
            {
                DataSet ds = ComponentHelper.Instance.ExecuteDataSet(StoredProcedure.usp_MODMGMTGetXmlControls, null,
                    formName);

                string xmlName = string.Empty;
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    if (ResolveClientUrl(dr[&quot;ParentPageURl&quot;].ToString()).Contains(Request.CurrentExecutionFilePath))
                    {
                        xmlName = dr[&quot;Name&quot;].ToString();
                        xmlInjection = BrixFormModel.GetInstance(xmlName, xmlName, Request, Response, &quot;Control&quot;);
                        if (xmlInjection.form != null &amp;&amp; xmlInjection.form.ParentModuleID == ModuleId)  // TO support multiple Xml Controls
                            break;
                    }
                }
            }
            else
            {
                if (!string.IsNullOrEmpty(Request[&quot;PID&quot;]))
                    xmlInjection = ProjectManager.Instance.GetProjectMetadataXMLModel(Request[&quot;PID&quot;].ToInt32_2());
                //if (!string.IsNullOrEmpty(Request[&quot;PID&quot;]))
                xmlInjection = GetMetadataXMLModel();
            }

            if (xmlInjection != null &amp;&amp; xmlInjection.form != null)
            {
                Control wc = FindControl(this, (xmlInjection.form as XMLControl).ReferenceControlID);
                var parentDiv = new HtmlGenericControl(&quot;div&quot;);
                if (wc == null)
                {
                    wc = new HtmlGenericControl(&quot;div&quot;);
                    Control holder = FindControl(this, &quot;C1&quot;);
                    holder.Controls.AddAt(holder.Controls.Count, wc);
                }

                switch ((xmlInjection.form as XMLControl).RelativePosition)
                {
                    case &quot;After&quot;:
                        wc.Parent.Controls.AddAt(wc.Parent.Controls.IndexOf(wc) + 1, parentDiv);

                        break;

                    case &quot;Before&quot;:
                        wc.Parent.Controls.AddAt(wc.Parent.Controls.IndexOf(wc) - 1, parentDiv);
                        break;

                    default:
                        wc.Controls.Add(parentDiv);
                        break;
                }

                xmlInjection.form.instanceID = ParentFormInstanceID == null
                    ? string.Empty
                    : ParentFormInstanceID.ToString();
                xmlEngine = new XMLRenderingEngine(this, xmlInjection, parentDiv);
                xmlEngine.Initialize();
                xmlEngine.Render(RenderFormat.RenderHtml);

                RegisterClientScriptInclude(&quot;~/scripts/bundle.brixform.*.js&quot;);

                //Append the client script required for xml framework to work properly
                //ClientScript.RegisterClientScriptInclude(&quot;XmlFrameworkScript&quot;,
                //    ResolveClientUrl(&quot;~/scripts/XmlframeworkJScript_20170123_1230.js&quot;));

                //Append the client script required for xml wrapper to work properly
                //First time it was not getting included since it was added inside XmlframeworkJScript_20151103
                //ClientScript.RegisterClientScriptInclude(&quot;XMLFrameworkWrapperClass&quot;,
                //    ResolveClientUrl(&quot;~/scripts/XMLFrameworkWrapperClass_20161202_1652.js&quot;));

                //Moved to master page
                //System.Web.HttpBrowserCapabilities browser = HttpContext.Current.Request.Browser;
                //if (browser.IsBrowser(&quot;Chrome&quot;) || browser.IsBrowser(&quot;Safari&quot;) || browser.IsBrowser(&quot;Opera&quot;))
                //{
                //    HtmlGenericControl divXml = new HtmlGenericControl(&quot;div&quot;);
                //    divXml.InnerHtml = &quot;&lt;script src=&#39;&quot; + ResolveClientUrl(&quot;~/Scripts/XmlFrameworkGridJScript.js&quot;) +
                //                       &quot;&#39; type=&#39;text/javascript&#39;&gt;&lt;/script&gt;&quot;;
                //    parentDiv.Controls.Add(divXml);
                //}
            }
        }

        private BrixFormModel GetMetadataXMLModel()
        {
            if (string.IsNullOrEmpty(Request.QueryString[&quot;DMetadata&quot;]))
            {
                if (!string.IsNullOrEmpty(Request[&quot;PID&quot;]))
                    return ProjectManager.Instance.GetProjectMetadataXMLModel(Request[&quot;PID&quot;].ToInt32_2());
            }
            else
            {
                if (!string.IsNullOrEmpty(Request.QueryString[&quot;DMetadata&quot;]))
                    return new BrixFormModel(Request.QueryString[&quot;DMetadata&quot;], Request.QueryString[&quot;DMetadata&quot;] + &quot;.xml&quot;,
                        Brix.Platform.BusinessLayer.XmlForm_Framework.XMLType.Control);
            }
            return null;
        }

        protected void EnableWorkflowNotesDialog(ApprovalWorkflow.OkEventHandler handler, string moduleId = &quot;&quot;)
        {
            if (!(this is IWorkflowEnabled) &amp;&amp; moduleId != &quot;XDOCMGT&quot;) return;
            if (moduleId != &quot;XDOCMGT&quot;)
            {
                if (null == _FormInfo) _FormInfo = (IWorkflowEnabled)this;
                if (this._FormInfo.FormName != &quot;XDOCMGT&quot; &amp;&amp; !IsWorkflowAssociated(_FormInfo.FormName)) return;
            }

            master = Master.Master ?? Master;

            appWorkflow = (ApprovalWorkflow)master.FindControl(&quot;appWorkflow&quot;);

            appWorkflow.Visible = true;
            appWorkflow.LinkDocumentVisible = false;
            if (!string.IsNullOrEmpty(moduleId)) appWorkflow.ModuleID = moduleId;
            if (!string.IsNullOrEmpty(Request[&quot;PID&quot;])) appWorkflow.PID = Request[&quot;PID&quot;].ToInt32_2();

            appWorkflow.OkClicked += handler;

            var popup = (ModalPopupExtender)master.FindControl(&quot;WorkflowPopupExtender&quot;);
            popup.Visible = true;
            var btnWorkfowPopup = (Button)master.FindControl(&quot;btnWorkfowPopup&quot;);

            string onLoad_JavascriptToBeCalled = appWorkflow.OnLoad_JavascriptToBeCalled;

            popup.AddNewPopup(appWorkflow.aspPnlApprove.ClientID, btnWorkfowPopup.ClientID,
                appWorkflow.btnCncl.ClientID, 200, 200, onDialogOpenScript: onLoad_JavascriptToBeCalled);
        }

        protected void EnableChecklistDialog(string moduleId = &quot;&quot;, string formInstanceId = &quot;&quot;)
        {
            if (_IsListPage || IsView) return;
            if (string.IsNullOrEmpty(moduleId) &amp;&amp; null == _FormInfo) return;
            if (string.IsNullOrEmpty(moduleId) &amp;&amp; null != _FormInfo) moduleId = _FormInfo.FormName;
            if (string.IsNullOrEmpty(formInstanceId) &amp;&amp; null != _FormInfo) formInstanceId = _FormInfo.FormInstanceId;

            if (string.IsNullOrEmpty(moduleId)) return;
            if (!ChecklistManager.Instance.IsCheckListAssociated(moduleId)) return;

            master = Master.Master ?? Master;

            FormCheckLists formCheckLists = (FormCheckLists)master.FindControl(&quot;appFormCheckLists&quot;);
            formCheckLists.Visible = true;
            formCheckLists.SetInstanceID(formInstanceId, moduleId);

            Button btnFormCheckLists = (Button)master.FindControl(&quot;btnFormCheckLists&quot;);

            ModalPopupExtender PopupExtender = (ModalPopupExtender)master.FindControl(&quot;PopupExtender&quot;);
            PopupExtender.AddNewPopup(formCheckLists.aspPnlChkList.ClientID, btnFormCheckLists.ClientID,
                formCheckLists.btnCncl.ClientID, 550, 760, &quot;CheckList(s)&quot;);
            formCheckLists.btnCncl.Attributes.Add(&quot;onclick&quot;,
                string.Format(&quot;$(&#39;#{0}&#39;).dialog(&#39;close&#39;); return false;&quot;, formCheckLists.aspPnlChkList.ClientID));

            if (formInstanceId.ToInt32_2() &gt; 0)
            {
                var mnu = new TextIcon(&quot;lnkCheckList&quot;, &quot;CheckList&quot;, &quot;Icn_AttachWorkflow_16.png&quot;);
                MainToolBar.AddMenuToToolbar(mnu, &quot;General&quot;);

                if (MainToolBar.GetMenuReference(mnu.ID) != null)
                {
                    MainToolBar.GetMenuReference(mnu.ID).CausesValidation = false;
                    MainToolBar.GetMenuReference(mnu.ID).OnClientClick = &quot;LoadCheckLists(&#39;&#39;); ShowWFPopup(&#39;btnFormCheckLists&#39;); return false;&quot;;
                }
            }
        }

        protected override void OnPreLoad(EventArgs e)
        {
            base.OnPreLoad(e);
            if (this is IWorkflowEnabled)
            {
                if (null == _FormInfo) _FormInfo = (IWorkflowEnabled)this;
                if (appWorkflow != null)
                {
                    appWorkflow.ModuleID = _FormInfo.FormName;
                    appWorkflow.PID = _FormInfo.PID;
                }

                InitializeWorkflowListForNewMode();
                InitializeWorkflowListForEditMode();
                _isWorkflowAssociated = IsWorkflowAssociated(_FormInfo.FormName);
            }
        }

        protected virtual bool ReadyToCreateNewWorkflow()
        {
            return true;
        }

        protected void InitializeWorkflowListForNewMode()
        {
            bool bCreateNew = false;
            if (IsPostBack &amp;&amp; !CreateNewWorkflow)
            {
                Utilities.LogToFile(AppConfig.LogFile(true),
                    &quot;NoNewWF: IsPostBack=&quot; + IsPostBack + &quot;CreateNewWorkflow=&quot; + CreateNewWorkflow,
                    MethodBase.GetCurrentMethod());
                return;
            }
            bCreateNew = CreateNewWorkflow;
            //clearing the view state property.
            CreateNewWorkflow = false;
            if (null != _WorkflowsInitiated &amp;&amp; !bCreateNew)
            {
                Utilities.LogToFile(AppConfig.LogFile(true),
                    &quot;NoNewWF: _WorkflowsInitiated.count=&quot; + _WorkflowsInitiated.Count,
                    MethodBase.GetCurrentMethod());
                return;
            }
            if (!IsNew)
            {
                Utilities.LogToFile(AppConfig.LogFile(true), &quot;NoNewWF: NewMode=&quot; + IsNew, MethodBase.GetCurrentMethod());
                return;
            }
            if (
                !BrixWorkflowManager.Instance.IsWorkflowAssociated(_FormInfo.FormName, _FormInfo.PID.ToString(),
                    _FormInfo.ParentModuleId.ToString()))
            {
                Utilities.LogToFile(AppConfig.LogFile(true),
                    &quot;NoNewWF: IsWorkflowAssociated=False for &quot; + _FormInfo.FormName,
                    MethodBase.GetCurrentMethod());
                return;
            }
            if (_IsListPage) return;

            string wfGuidFromListPage = Request.QueryString[&quot;WFID&quot;];
            //this is needed because the forms rendering engine gets initialised in the onpreinit mentod
            //and it needs the wfid during the prenit itself hence it has to have the wfid in the request querystring
            //as a result the wf creation takes place in the listpage &#39;New&#39; click of GenericXMLListModel
            if (null != wfGuidFromListPage)
            {
                if (string.IsNullOrEmpty(wfGuidFromListPage)) return;
                if (_WorkflowsInitiated == null)
                {
                    _WorkflowsInitiated = new List&lt;Guid&gt;();
                    _WorkflowStates = new Dictionary&lt;string, KeyValuePair&lt;string, List&lt;IAction&gt;&gt;&gt;();
                }
                var gd = new Guid(wfGuidFromListPage);
                if (Guid.Empty != gd) _WorkflowsInitiated.Add(gd);
            }
            else
            {
                if (ReadyToCreateNewWorkflow())
                {
                    string s =
                        string.Format(
                            &quot;Calling TriggerWorkflow!! {0} IsNew={1} bCreateNew={2} IsPostBack={3}, Is _WorkflowsInitiated Null ? {4}&quot;,
                            _FormInfo.FormName, IsNew, bCreateNew, IsPostBack, _WorkflowsInitiated == null);
                    Utilities.LogToFile(AppConfig.LogFile(true), s, MethodBase.GetCurrentMethod());
                    _WorkflowsInitiated = BrixWorkflowManager.Instance.TriggerWorkflow(TriggerPoint.TriggerActions[0],
                        _FormInfo.FormName, _FormInfo.PID.ToString(), _FormInfo.ParentModuleId.ToString(), &quot;&quot;,
                        _FormInfo.FormInstanceId);
                    _WorkflowStates = new Dictionary&lt;string, KeyValuePair&lt;string, List&lt;IAction&gt;&gt;&gt;();
                }
            }
            foreach (Guid guid in _WorkflowsInitiated)
            {
                WorkflowGuids = guid.ToString();
            }
            if (IsPostBack &amp;&amp; bCreateNew) AddWorkflowButtons();
        }

        private void InitializeWorkflowListForEditMode()
        {
            if (null != _WorkflowsInitiated) return;
            string wfGuids = WorkflowGuids;
            if (string.IsNullOrEmpty(_FormInfo.FormInstanceId)) return;
            //appWorkflow.InstanceID = _FormInfo.FormInstanceId;
            if ((IsNew &amp;&amp; !string.IsNullOrEmpty(wfGuids)) || IsEdit || (ModuleManager.Instance.IsAllowActionByAllStakeHolders(_FormInfo.FormName) &amp;&amp; IsView))
            {
                if (!IsWorkflowAssociated(_FormInfo.FormName)) return;
                DataTable mappingDetails = (string.IsNullOrEmpty(wfGuids))
                    ? BrixWorkflowManager.Instance.GetWorkflowMappingDetails(
                        _FormInfo.FormInstanceId, _FormInfo.FormName)
                    : BrixWorkflowManager.Instance.GetWorkflowMappingDetails(
                        _FormInfo.FormInstanceId, _FormInfo.FormName, wfGuids);
                if (null == _WorkflowsInitiated)
                {
                    _WorkflowsInitiated = new List&lt;Guid&gt;();
                    _WorkflowStates = new Dictionary&lt;string, KeyValuePair&lt;string, List&lt;IAction&gt;&gt;&gt;();
                }
                if (null == _WorkflowsInitiatedForCurrentStatus)
                {
                    _WorkflowsInitiatedForCurrentStatus = new List&lt;Guid&gt;();
                }
                DataRow[] aRows = mappingDetails.Select(&quot;IsCompleted=False&quot;);
                foreach (DataRow dr in aRows)
                {
                    Guid gd;
                    if (Guid.TryParse((string)dr[&quot;WorkflowInstanceGuid&quot;], out gd)) _WorkflowsInitiated.Add(gd);
                }

                DataRow[] dtRows = mappingDetails.Select();
                foreach (DataRow dr in dtRows)
                {
                    Guid gd;
                    if (Guid.TryParse((string)dr[&quot;WorkflowInstanceGuid&quot;], out gd))
                        _WorkflowsInitiatedForCurrentStatus.Add(gd);
                }
            }
        }

        protected virtual void SetModes()
        {
            _IsEdit = !string.IsNullOrEmpty(Request.QueryString[&quot;mode&quot;]) &amp;&amp;
                      Request.QueryString[&quot;mode&quot;].ToLower() == &quot;edit&quot;;
            _IsView = !string.IsNullOrEmpty(Request.QueryString[&quot;mode&quot;]) &amp;&amp;
                      Request.QueryString[&quot;mode&quot;].ToLower() == &quot;view&quot;;
            _IsNew = !string.IsNullOrEmpty(Request.QueryString[&quot;mode&quot;])
                ? Request.QueryString[&quot;mode&quot;].ToLower() == &quot;new&quot;
                : !IsEdit &amp;&amp; !IsView;
            _IsList = !string.IsNullOrEmpty(Request.QueryString[&quot;mode&quot;]) &amp;&amp;
                      Request.QueryString[&quot;mode&quot;].ToLower() == &quot;list&quot;;
        }

        protected override void CreateChildControls()
        {
            if (_bIsCreateChildControlsCalled) return;
            if (null == _ModuleComponents) InitModuleComponents();
            if (_ModuleComponents.Contains(&quot;ShowContextMenu&quot;))
            {
                try
                {
                    if (!string.IsNullOrEmpty(ContextElement))
                    {
                        string pageName = Page.Request.AppRelativeCurrentExecutionFilePath;
                        string context = Request[&quot;Context&quot;];
                        List&lt;BrixContextMenu&gt; menus = ContextMenuManager.Instance.GetMenus(ContextElement);
                        Control sourceControl = null;
                        bool isListPage = true;
                        string pageClassName = GetType().BaseType.Name;
                        switch (pageClassName)
                        {
                            case &quot;BrixListPage&quot;:
                            case &quot;BrixChecklist&quot;:
                                sourceControl = ContextElementRadGrid;
                                break;

                            case &quot;BrixItemListPage&quot;:
                                sourceControl = ContextElementHGrid;
                                break;

                            default:
                                isListPage = false;
                                if (ContextElementRadGrid != null)
                                    sourceControl = ContextElementRadGrid;
                                if (ContextElementHGrid != null)
                                    sourceControl = ContextElementHGrid;
                                break;
                        }
                        if (sourceControl != null)
                        {
                            foreach (BrixContextMenu m in menus)
                            {
                                if (!isListPage)
                                {
                                    sourceControl = FindControl(Page, m.SourceControlId);
                                }
                                CMenu.AddContextMenu(m);
                            }

                            CreateContextMenu();

                            if (CMenu != null &amp;&amp; CMenu.CMenuArray.Count &gt; 0)
                            {
                                CMenu.ContextMenuItemClick += new EventHandler(ContextMenuItemClick);
                                CMenu.DataBind();
                            }
                        }
                    }

                    if (ContextElementHGrid != null &amp;&amp; CMenu.CMenuArray.Count &gt; 0)
                    {
                        RegisterStartupScript(&quot;$(\&quot;#outermostdiv\&quot;).bind(&#39;contextmenu&#39;,function(e){return ActivateRow(e);}); &quot;, Page, &quot;HGrid_ActivateRow&quot;);
                    }
                    if (ContextElementRadGrid != null &amp;&amp; CMenu.CMenuArray.Count &gt; 0)
                    {
                        //ToDo: Check this function
                        ContextElementRadGrid.ClientSettings.ClientEvents.OnRowContextMenu = &quot;Grid_RowContextMenu&quot;;
                        //ClientScript.RegisterClientScriptBlock(Page.GetType(), &quot;Grid_MouseDown_1&quot;, &quot;function Grid_MouseDownCMenu(e) { return showmenuDiv(e); };&quot;, true);
                    }
                }
                catch (Exception ex)
                {
                }
            }

            //Load workflow status and history for non list page
            if (!IsPostBack &amp;&amp; !_IsListPage &amp;&amp; _isWorkflowAssociated &amp;&amp; !IsNew)
            {
                //Commented below line since it was not creating workflow menu buttons
                //AddWFHistoryStatusButtons(MainToolBar);
                SetJcriptDetailsForMenuButtons();
            }

            EnableChecklistDialog();

            base.CreateChildControls();
            _bIsCreateChildControlsCalled = true;

            ChildControlsCreated = true;
        }

        /// &lt;summary&gt;
        /// Add workflow buttons on Form Page
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;tb&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;menus&quot;&gt;&lt;/param&gt;
        public void AddWorkflowButtons(ToolBar tb = null, MenuArray menus = null)
        {
            if (!(this is IWorkflowEnabled)) return;
            if (_IsListPage) return;
            if (null == _FormInfo) _FormInfo = (IWorkflowEnabled)this;
            if (IsView &amp;&amp; !ModuleManager.Instance.IsAllowActionByAllStakeHolders(_FormInfo.FormName)) return;
            if (!IsWorkflowAssociated(_FormInfo.FormName)) return;
            if (!HasInCompleteWorkflows()) return;
            if (!CanShowWorkflowButtons()) return;
            if (null == _WorkflowsInitiated) InitializeWorkflowListForEditMode();
            if (null == _WorkflowsInitiated) return;
            for (int i = 0; i &lt; _WorkflowsInitiated.Count; i++)
            {
                UserDetail sCurrentUser = UserDetail.GetCurrentUserDetail();
                Guid actualGuid = Guid.Empty;
                int daysToComplete = 0;
                string actionsMustBePerformedBy = null;
                string stateName = string.Empty;
                List&lt;IAction&gt; actions = GetCurrentWorkflowActionButtons(_WorkflowsInitiated[i], ref actualGuid,
                    ref daysToComplete, ref actionsMustBePerformedBy, ref stateName);
                if (actualGuid == Guid.Empty) actualGuid = _WorkflowsInitiated[i];
                else
                {
                    _WorkflowsInitiated[i] = actualGuid;
                }
                if (!_WorkflowStates.ContainsKey(actualGuid.ToString()))
                    _WorkflowStates.Add(actualGuid.ToString(), new KeyValuePair&lt;string, List&lt;IAction&gt;&gt;(&quot;&quot;, actions));
                if (appWorkflow != null &amp;&amp; null != actions)
                {
                    appWorkflow.DaysToComplete = daysToComplete.ToString();
                }
                if (null == actions) continue;
                bool bGiveOpinion = BrixWorkflowManager.Instance.IsRoutedToUser(actualGuid.ToString(), sCurrentUser.UID);
                if (bGiveOpinion)
                    AddActionToMenu(tb, menus, actualGuid.ToString(), BrixWorkflowManager.GiveOpinion, &quot;Respond&quot;, &quot;Give Opinion&quot;,
                        &quot;Icn_Opinion.png&quot;, isCommentsMandatory: CoreModuleComponents.Contains(&quot;EnableMandatoryCommentsInBallinCourtRespond&quot;));

                bool bHasLocalRoleToPlay = false;
                string[] stakeHolders = null == actionsMustBePerformedBy
                    ? null
                    : actionsMustBePerformedBy.Split(&#39;,&#39;);
                if (null == dicHasRoleToPlay) dicHasRoleToPlay = new Dictionary&lt;string, bool?&gt;();
                if (null != stakeHolders)
                {
                    Dictionary&lt;int, string&gt; userRoles = new Dictionary&lt;int, string&gt;();
                    int pid = (string.IsNullOrEmpty(Request.QueryString[&quot;PID&quot;])
                        ? 0
                        : Request.QueryString[&quot;PID&quot;].ToInt32_2());
                    userRoles = UserManager.Instance.GetUserRolesBasedOnProjectId(sCurrentUser.UID,
                        pid, sCurrentUser.RID, sCurrentUser.RoleName);

                    foreach (string stakeHolderRole in stakeHolders)
                    {
                        if (string.IsNullOrEmpty(stakeHolderRole)) continue;
                        int stakeHolderRoleID = UserManager.Instance.GetUsersRoleId(stakeHolderRole);
                        if (userRoles.ContainsKey(stakeHolderRoleID))
                        {
                            bHasLocalRoleToPlay = true;

                            //if current user role matches the stakeholders roles, then proceed further
                            string workflowInstanceGuid = _WorkflowsInitiated[i].ToString();

                            _CanAddSaveButton = bHasLocalRoleToPlay =
                                !WFRuntimeHandlerDB.HasCurrentUserPerformedWorkflowAction(workflowInstanceGuid,
                                    userRoles, sCurrentUser.UID);
                            break;
                        }
                    }
                }
                if (!bHasLocalRoleToPlay) continue;
                //adding a property for adding or hiding ball in court in menu
                if (CoreModuleComponents.Contains(&quot;ShowWorkflowBallIncourt&quot;))
                {
                    if (!bGiveOpinion)
                        AddActionToMenu(tb, menus, actualGuid.ToString(), BrixWorkflowManager.RouteTo,
                            LocalizationManager.GetString(&quot;BallInCourt&quot;), &quot;Get Opinion&quot;, &quot;Icn_ballincourt_16.png&quot;, isCommentsMandatory: CoreModuleComponents.Contains(&quot;EnableMandatoryCommentsInBallinCourtRequest&quot;));
                }
                foreach (IAction action in actions)
                {
                    if (action is FormAction)
                    {
                        FormAction frmAction = action as FormAction;
                        AddActionToMenu(tb, menus, actualGuid.ToString(), action.InstanceId, action.ActionName,
                            action.ActionDisplayName, onClientClick: frmAction.OnClientClick, isCommentsMandatory: frmAction.IsCommentsMandatory, checklistId: frmAction.AssociatedCheckList.ToInt32_2());
                    }
                    else
                    {
                        AddActionToMenu(tb, menus, actualGuid.ToString(), action.InstanceId, action.ActionName,
                            action.ActionDisplayName);
                    }
                }
            }
        }

        /// &lt;summary&gt;
        /// Add workflow History and Status butons to workflow menugroup.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;tb&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;menus&quot;&gt;&lt;/param&gt;
        protected void AddWFHistoryStatusButtons(ToolBar tb)
        {
            if (null == MainToolBar) return;
            if (null == tb) tb = MainToolBar;
            MenuGroup mGroup = tb.Groups.Find(mg =&gt; mg.Title == &quot;Workflow&quot;);
            if (null == mGroup)
            {
                mGroup = new MenuGroup();
                mGroup.Title = &quot;Workflow&quot;;
                tb.Groups.Add(mGroup);
            }
            ;
            mGroup.AddMenu(new LargeButton(&quot;lnkWorkFlowHistory&quot;, &quot;History&quot;, &quot;Icn_History.png&quot;));
            mGroup.AddMenu(new LargeButton(&quot;lnkWorkFlowStatus&quot;, &quot;Status&quot;, &quot;Progress.png&quot;));
            //MainToolBar.Bind();
        }

        /// &lt;summary&gt;
        /// Add workflow buttons on List Page.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;tb&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;menus&quot;&gt;&lt;/param&gt;
        public void AddAllWorkflowButtons(ToolBar tb = null, MenuArray menus = null)
        {
            #region Generate unique Action Buttons based on stages of records.

            //            try
            //            {
            //                if (!(this is IWorkflowEnabled)) return;
            //                if (!_IsListPage) return;
            //                if (null == _FormInfo) _FormInfo = (IWorkflowEnabled)this;
            //                if (!IsWorkflowAssociated(_FormInfo.FormName)) return;
            //                if (!CanShowWorkflowButtons()) return;
            //                if (null == _ModuleComponents) InitModuleComponents();
            //                if (!_ModuleComponents.Contains(&quot;ShowWorkflowActionsInListPage&quot;)) return;
            //                if (!ShowWorkFlowActionOnListPage) return;

            //                //Get default wf associated with form.
            //                DataTable dtGetDefaultWF = ComponentHelper.Instance.ExecuteDataSet(WFStoredProcedure.usp_WORKFLWGetDefaultWorkflowByAssociatedForm, null, _FormInfo.FormName).Tables[0];
            //                if (dtGetDefaultWF == null || dtGetDefaultWF.Rows.Count == 0) return;

            //                List&lt;TextIcon&gt; allStageButtons = new List&lt;TextIcon&gt;();
            //                string[] buttons;

            //                string hideAllFunc = &quot;$(document).ready(function(){HideAllWFActions();});\nfunction HideAllWFActions(){&quot;;
            //                string showOnSelectFunc = &quot;function &quot; + EnableWFActionsJSFunction + @&quot;(grdId){ try{
            //    HideAllWFActions();
            //    var i = 0;
            //    var selectedRows = ListSelectedRows(grdId);
            //    if (null == selectedRows || undefined == selectedRows || selectedRows.length &lt; 1) return;
            //    var multi = false;
            //    var sButtons = &#39;&#39;;
            //    for(i = 0; i&lt;selectedRows.length;i++){
            //        if (selectedRows.length &gt; 1) multi = true;
            //        var currentRow = selectedRows[i];
            //        var wfPendingOn = currentRow.getCellFromKey(&#39;WF_PendingOnRole&#39;);
            //        wfPendingOn = null == wfPendingOn.getValue() ? &#39;&#39; : wfPendingOn.getValue();
            //        if (wfPendingOn == &#39;None&#39; || wfPendingOn == &#39;&#39;) continue;
            //        var buttons = currentRow.getCellFromKey(&#39;Buttons&#39;);
            //        sButtons += null == buttons.getValue() ? &#39;&#39; : &#39;,&#39; + buttons.getValue();
            //    }
            //    if (sButtons == &#39;&#39;) return;
            //    else sButtons = sButtons.substr(1);
            //    var arrbuttons = new Array();
            //arrbuttons = sButtons.split(&#39;,&#39;);
            //    var commonbuttons = new Array()
            //    commonbuttons = find_duplicates(arrbuttons,selectedRows.length);
            //
            //    ShowActionsForStage(commonbuttons); } catch(ex){}
            //}
            //
            //if (!Array.prototype.indexOf) Array.prototype.indexOf = ArrayIndexOfForIE8;
            //
            //
            //function find_duplicates(arr,selectRowCount) {
            //  var len=arr.length,
            //      out=new Array(),
            //      counts={};
            //
            //  for (var i=0;i&lt;len;i++) {
            //    var item = arr[i];
            //    var count = counts[item];
            //    counts[item] = counts[item] &gt;= 1 ? counts[item] + 1 : 1;
            //  }
            //
            //    var uniquebuttons = new Array();
            //  for (var item in counts) {
            //    if(counts[item] &gt;= selectRowCount &amp;&amp; out.indexOf(item) == -1)
            //        out.push(item);
            //    }
            //  return out;
            //}&quot;;

            //                string showActionsForStage = @&quot;function ShowActionsForStage(sButtons){&quot;;
            //                showActionsForStage += &quot;for (a in sButtons) { BrixMainToolBar.ShowMenu(sButtons[a]);}}&quot;;

            //                //For every row, check the action buttons column and generate action buttons.
            //                //If action buttons column is null (for older records or for other product implementations,
            //                //then set the buttons matching the stage in the default workflow.
            //                Type type = Page.GetType();
            //                BindingFlags bindFlags = BindingFlags.Instance | BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.Static;
            //                var BrixGrid = new UltraWebGrid();
            //                object ctrl = null;

            //                foreach (FieldInfo fieldInfo in type.GetFields(bindFlags))
            //                {
            //                    ctrl = fieldInfo.GetValue(Page);
            //                    if (ctrl != null &amp;&amp; ctrl is UltraWebGrid)
            //                    {
            //                        BrixGrid = (ctrl as UltraWebGrid);
            //                    }
            //                }
            //                foreach (UltraGridRow dr in BrixGrid.Rows)
            //                {
            //                    //Check if user has the stakeholder roles necessary for performing workflow actions.
            //                    string sCurrentUser = UserDetail.GetCurrentUserDetail().UserID;
            //                    bool bHasLocalRoleToPlay = false;
            //                    UltraGridColumn col = BrixGrid.Columns.FromKey(&quot;WF_PendingOnRole&quot;);
            //                    string[] stakeHolders = string.IsNullOrEmpty(dr.GetCellValue(col).ToString()) ? null : dr.GetCellValue(col).ToString().Split(&#39;,&#39;);
            //                    if (null != stakeHolders)
            //                        foreach (string stakeHolderRole in stakeHolders)
            //                        {
            //                            bHasLocalRoleToPlay = UserManager.Instance.IsUserRole(UserDetail.GetCurrentUserDetail().UID,
            //                                                                             UserManager.Instance.GetUsersRoleId(
            //                                                                                 stakeHolderRole));
            //                            //if current user role matches the stakeholders roles, then proceed further
            //                            if (bHasLocalRoleToPlay) break;
            //                        }
            //                    //if current user roles is not part of the stakeholders, then dont add the button.
            //                    else
            //                    {
            //                        dr.Cells[dr.Cells.IndexOf(&quot;Buttons&quot;)].Value = &quot;&quot;;
            //                        continue;
            //                    }
            //                    //make the buttons column blank so that nothing will load when the row is selected.
            //                    if (!bHasLocalRoleToPlay)
            //                    {
            //                        dr.Cells[dr.Cells.IndexOf(&quot;Buttons&quot;)].Value = &quot;&quot;;
            //                        continue;
            //                    }

            //                    //If buttons column has info, then add the list of buttons to main list if not already added. allStageButtons should contain the unique list of Action Names for the list page.
            //                    if (!string.IsNullOrEmpty(dr.Cells[dr.Cells.IndexOf(&quot;Buttons&quot;)].Value.ToString()))
            //                    {
            //                        //Get comma separated buttons list.
            //                        buttons = dr.Cells[dr.Cells.IndexOf(&quot;Buttons&quot;)].Value.ToString().Split(&#39;,&#39;);
            //                        if (buttons.Length &gt; 0)
            //                        {
            //                            foreach (string action in buttons)
            //                            {
            //                                TextIcon icn = new TextIcon
            //                                {
            //                                    ID = action,
            //                                    Text = action.Replace(&quot;XXX&quot;, &quot; &quot;),
            //                                    Title = action.Replace(&quot;XXX&quot;, &quot; &quot;)
            //                                };
            //                                //Add action button to list if not already added.
            //                                if (!allStageButtons.Exists(x =&gt; x.Text == icn.Text))
            //                                    allStageButtons.Add(icn);
            //                            }
            //                        }
            //                    }
            //                }

            //                //Generate contents of hideAllFunc function used to hide all buttons.
            //                foreach (TextIcon icn in allStageButtons)
            //                    hideAllFunc += &quot;BrixMainToolBar.HideMenu(&#39;&quot; + icn.ID + &quot;&#39;);\n&quot;;
            //                hideAllFunc += &quot;}&quot;;
            //                AddDropDownToMenu(null, allStageButtons);
            //                ClientScript.RegisterStartupScript(GetType(), &quot;ListpageWorkflowActions&quot;, hideAllFunc + &quot;\n&quot; + showOnSelectFunc + &quot;\n&quot; + showActionsForStage, true);
            //            }
            //            catch (Exception ex) { }

            #endregion Generate unique Action Buttons based on stages of records.
        }

        protected virtual string EnableWFActionsJSFunction
        {
            get { return &quot;ShowActionsOnSelect&quot;; }
        }

        private void AddActionToMenu(ToolBar tb, MenuArray menus, string sWfInstanceId, string actionId,
            string actionName, string toolTip = &quot;&quot;, string sIcon = &quot;Icn_Button.png&quot;,
            string onClientClick = &quot;&quot;, bool isCommentsMandatory = false, int checklistId = 0)
        {
            if (null == MainToolBar) return;
            if (null == actionId) return;
            if (null == tb) tb = MainToolBar;
            string actnName = actionName.Replace(&quot; &quot;, &quot;XXX&quot;);
            var mnu = new TextIcon(sWfInstanceId + &quot;_&quot; + actionId + &quot;_&quot; + actnName, actionName, sIcon);
            mnu.ToolTip = toolTip;
            mnu.CausesValidation = false;
            if (null != tb) tb.AddMenuToToolbar(mnu, groupName);
            else if (null != menus) menus.Add(mnu);
            else tb.AddMenuToToolbar(mnu, groupName);

            string frmActionJSON = $@&quot;{{onClientClickFunction:{(string.IsNullOrEmpty(onClientClick) ? &quot;&#39;&#39;&quot; : &quot;&#39;&quot; + onClientClick + &quot;&#39;&quot;)},
                                        isCommentsMandatory:{(isCommentsMandatory ? &quot;true&quot; : &quot;false&quot;)},
                                        associatedCheckList:{checklistId}}}&quot;;

            tb.GetMenuReference(mnu.ID).OnClientClick = string.Format(
                &quot;ShowWorkflowNotes(&#39;{0}&#39;, &#39;{1}&#39;, {2}); return false;&quot;,
                mnu.ID, (actionId == BrixWorkflowManager.RouteTo) ? true : false, frmActionJSON);
        }

        public void AddDropDownToMenu(ToolBar tb, List&lt;TextIcon&gt; lstImpExp, string actionId = &quot;DoWorkflowAction&quot;,
            string actionName = &quot;Select Actions&quot;, string sIcon = &quot;Icn_Button.png&quot;, RadGrid grid = null)
        {
            if (null == MainToolBar) return;
            if (null == tb) tb = MainToolBar;

            //Find Workflow Group
            //MenuGroup mGroup = tb.Groups.Find(mg =&gt; mg.Title == &quot;Workflow&quot;);
            //f (null == mGroup) return;

            //creating a dummy group
            MenuGroup mGroup = new MenuGroup(&quot;Workflow&quot;);

            //Find &#39;Select Actions&#39; Menu
            MenuButton menuImpExp = new MenuButton(actionId, actionName, sIcon);
            menuImpExp.ButtonSize = ButtonSize.Medium;
            MenuButton menu = (MenuButton)mGroup.Menus.Find(m =&gt; m.Text == menuImpExp.Text);

            if (menu == null)
            {
                mGroup.AddMenu(menuImpExp);
                //menuImpExp.lnkButton.Attributes.Add(&quot;href&quot;, &quot;#&quot;);
                menuImpExp.SubMenus.Clear();
                foreach (TextIcon mnu in lstImpExp)
                {
                    menuImpExp.AddSubMenu(mnu);
                    string[] paramList = mnu.ID.Split(&#39;|&#39;);
                    string frmActionJSON = $@&quot;{{onClientClickFunction:{(string.IsNullOrEmpty(paramList[3]) ? &quot;&#39;&#39;&quot; : &quot;&#39;&quot; + paramList[3] + &quot;&#39;&quot;)},
                                                isCommentsMandatory:{(paramList[4].ToBoolean2() ? &quot;true&quot; : &quot;false&quot;)},
                                                associatedCheckList:{(string.IsNullOrEmpty(paramList[5]) ? &quot;&#39;&#39;&quot; : paramList[5])}}}&quot;;
                    mnu.OnClientClick = string.Format(&quot;ShowWorkflowNotes(&#39;{0}&#39;, &#39;{1}&#39;, {2}); return false;&quot;,
                        paramList[0], //ActionName
                        paramList[0].EndsWith(BrixWorkflowManager.RouteTo) ? true : false, //IsRouteTo
                        frmActionJSON); //OnclientClick,IsCommentsMandatory,checklistId
                }
            }
            else
            {
                // menu.lnkButton.Attributes.Add(&quot;href&quot;, &quot;#&quot;);

                menu.SubMenus.Clear();
                foreach (TextIcon mnu in lstImpExp)
                {
                    menu.AddSubMenu(mnu);
                    string[] paramList = mnu.ID.Split(&#39;|&#39;);
                    string frmActionJSON = $@&quot;{{onClientClickFunction:{(string.IsNullOrEmpty(paramList[3]) ? &quot;&#39;&#39;&quot; : &quot;&#39;&quot; + paramList[3] + &quot;&#39;&quot;)},
                                                isCommentsMandatory:{(paramList[4].ToBoolean2() ? &quot;true&quot; : &quot;false&quot;)},
                                                associatedCheckList:{(string.IsNullOrEmpty(paramList[5]) ? &quot;&#39;&#39;&quot; : paramList[5])}}}&quot;;
                    mnu.OnClientClick = string.Format(&quot;ShowWorkflowNotes(&#39;{0}&#39;, &#39;{1}&#39;, {2}); return false;&quot;,
                        paramList[0], //ActionName
                        paramList[0].EndsWith(BrixWorkflowManager.RouteTo) ? true : false, //IsRouteTo
                        frmActionJSON); //OnclientClick,IsCommentsMandatory,checklistId
                }
            }

            MainToolBar.AddMenuToToolbar(menu ?? menuImpExp, &quot;Workflow&quot;);
            //MainToolBar.Bind();
        }

        protected void btnWorkflowAction_Click(object sender, OkEventArgs e)
        {
            Utilities.LogToFile(AppConfig.LogFile(true), &quot;WFAction Started: &quot; + e.Notes, MethodBase.GetCurrentMethod());

            if (null == _FormInfo) _FormInfo = (IWorkflowEnabled)this;
            if (!_IsListPage)
                WorkflowActionClick(e, _FormInfo);
            else
                WorkflowActionClick2(e, _FormInfo);
        }

        private void WorkflowActionClick2(OkEventArgs e, IWorkflowEnabled _FormInfo)
        {
            string errorMsgs = &quot;&quot;;
            try
            {
                string sel = GetSelectedIDs();
                if (string.IsNullOrEmpty(sel)) return;

                master = Master.Master != null ? Master.Master : Master;
                var ID = (HiddenField)master.FindControl(&quot;hdnActionName&quot;);

                //////////////////////////////////////////////////////////////////////////
                int[] idList = null;
                bool isSuccessConversionsOfIdList = false;
                try
                {
                    idList = sel.Split(&#39;,&#39;).Select(t =&gt; t.ToInt32_2()).OrderBy(t =&gt; t).ToArray();
                    isSuccessConversionsOfIdList = true;
                }
                catch
                {
                    isSuccessConversionsOfIdList = false;
                }

                string[] ids = null;

                if (!isSuccessConversionsOfIdList)
                    ids = sel.Split(&#39;,&#39;);
                else
                    ids = idList.Select(t =&gt; t.ToString()).ToArray();
                //////////////////////////////////////////////////////////////////////////
                // Explaination
                // the above sequencing patch is added to fulfill following scenario
                // when we do multiple approval of data it should happen based on the records created first.
                // this is because if calculation are dependent on previous records then we give priority as the record created order.
                //
                // However if any id field is not an integer then we are considering them as unordered.
                // So this will work only if the form id field is of type integer.
                //////////////////////////////////////////////////////////////////////////
                errorMsgs = PreWorkFlowValidation(ID.Value, idList);

                if (String.IsNullOrEmpty(errorMsgs))
                {
                    foreach (string id in ids)
                    {
                        sActionName = ID.Value;
                        string sActionId = string.Empty;
                        IWorkflowEnabled formInfo = (IWorkflowEnabled)this;
                        DateTime? dueDate = ComputeDueDate(e.DaysToComplete);

                        DataTable mappingDetails = BrixWorkflowManager.Instance.GetWorkflowMappingDetails(id,
                            _FormInfo.FormName);
                        DataRow[] aRows = mappingDetails.Select(&quot;IsCompleted=False&quot;);
                        string sWfInstanceId = null == aRows || aRows.Length &lt; 1
                            ? &quot;&quot;
                            : aRows[0][&quot;WorkflowInstanceGuid&quot;].ToString();
                        if (string.IsNullOrEmpty(sWfInstanceId)) continue;
                        Guid wfGuid = new Guid(sWfInstanceId);
                        Guid actualGuid = Guid.Empty;
                        int daysToComplete = 0;
                        string actionsMustBePerformedBy = string.Empty;
                        string stateName = string.Empty;
                        List&lt;IAction&gt; actions = GetCurrentWorkflowActionButtons(wfGuid, ref actualGuid, ref daysToComplete,
                            ref actionsMustBePerformedBy, ref stateName);
                        sWfInstanceId = Guid.Empty == actualGuid ? sWfInstanceId : actualGuid.ToString();

                        foreach (IAction action in actions)
                        {
                            if (action.ActionName == sActionName.Replace(&quot;XXX&quot;, &quot; &quot;))
                            {
                                sActionId = action.InstanceId + &quot;_&quot; + action.ActionName;
                                break;
                            }
                        }
                        string[] aIds = sActionId.Split(&#39;_&#39;);
                        if (null != aIds &amp;&amp; aIds.Length &gt; 0)
                        {
                            sActionId = aIds[0];

                            Utilities.LogToFile(AppConfig.LogFile(true), &quot;Updating Workflow Mappings &quot;,
                                MethodBase.GetCurrentMethod());

                            UpdateWorkflowMappings(id, sWfInstanceId, &quot;&quot;, formInfo, dueDate);

                            Utilities.LogToFile(AppConfig.LogFile(true), &quot;DoAction :  &quot; + sActionId,
                                MethodBase.GetCurrentMethod());

                            errorMsgs += DoPostSaveWorkflowActions(e, formInfo, id,
                                aIds.Length &gt; 1 ? aIds[1].Replace(&quot;XXX&quot;, &quot; &quot;) : null, sWfInstanceId, sActionId);
                            if (string.IsNullOrEmpty(errorMsgs))
                                sActionName = aIds.Length &gt; 1 ? aIds[1].Replace(&quot;XXX&quot;, &quot; &quot;) : null;
                        }
                    }
                }
                Utilities.LogToFile(AppConfig.LogFile(true), &quot;Action Complete &quot;, MethodBase.GetCurrentMethod());
                WorkflowActionComplete();

                Utilities.LogToFile(AppConfig.LogFile(true), &quot;Updating time stamp user details&quot;, MethodBase.GetCurrentMethod());
                HandleSytemDataAfterWorkFlow();

                Utilities.LogToFile(AppConfig.LogFile(true), &quot;Rebinding List Page&quot;, MethodBase.GetCurrentMethod());
                ReBindListPage();
                Utilities.LogToFile(AppConfig.LogFile(true), &quot;WFAction Returned the following messages: &quot; + errorMsgs,
                    MethodBase.GetCurrentMethod());

                JavaScriptSerializer JS = new JavaScriptSerializer();

                string successMsgs = BrixWorkflowManager.Instance.GetWorkflowSuccessMessages(ref errorMsgs);
                if (!string.IsNullOrEmpty(successMsgs)) ShowSuccess(JS.Serialize(successMsgs).Replace(&quot;\&quot;&quot;, &quot;&quot;));

                if (string.IsNullOrEmpty(errorMsgs)) return;

                // Sync with ChangeSet 34636 from production MTO
                ShowError(errorMsgs);
            }
            catch
            {
                Utilities.LogToFile(AppConfig.LogFile(true), &quot;WFAction Returned the following messages: &quot; + errorMsgs,
                    MethodBase.GetCurrentMethod());
                if (string.IsNullOrEmpty(errorMsgs)) return;

                JavaScriptSerializer JS = new JavaScriptSerializer();
                ShowError(JS.Serialize(errorMsgs));
            }
        }

        protected virtual void ReBindListPage()
        {
        }

        protected virtual string GetSelectedIDs()
        {
            return null;
        }

        protected virtual string PreWorkFlowValidation(string action, object obj)
        {
            return string.Empty;
        }

        protected virtual string CreateEditPageURL(string formInstanceID)
        {
            return string.Empty;
        }

        protected void WorkflowActionClick(OkEventArgs e, IWorkflowEnabled formInfo)
        {
            master = Master.Master != null ? Master.Master : Master;
            var ID = (HiddenField)master.FindControl(&quot;hdnActionName&quot;);
            string log = string.Format(&quot;ActionClicked: {0}\nBy: {1}\nCurrentRole: {2}&quot;, ID.Value,
                UserDetail.GetCurrentUserDetail().UserName,
                UserDetail.GetCurrentUserDetail().RoleName);
            Utilities.LogToFile(AppConfig.LogFile(true), log, MethodBase.GetCurrentMethod());

            bool bSuccess = false;
            string sErrors = &quot;&quot;;
            string sRedirector = &quot;&quot;;
            string sSavedInstanceToken = &quot;&quot;;
            try
            {
                if (AutoSaveOnWorkflowActionClick)
                    bSuccess = formInfo.SaveHandler(ID, out sSavedInstanceToken, out sErrors, out sRedirector);
                else
                    bSuccess = true;
            }
            catch (Exception ex)
            {
                //TODO: Show error message somewhere
                if (ex is System.Data.SqlClient.SqlException)
                {
                    Aurigo.AMP3.Logging.Logger.Log(Aurigo.AMP3.Resources.MessageResources.Enumerations.LogType.Error, ex.Message, Constants.MODID_CORE);
                    sErrors = &quot;Database Error.&quot;;
                }
                else if (ex is MWConcurrencyException)
                {
                    sErrors = string.Empty;
                }
                else
                {
                    sErrors = ex.Message;
                }
            }
            string formInstanceID = (formInfo.FormInstanceId == &quot;-1&quot;) ? sSavedInstanceToken : formInfo.FormInstanceId;
            if (!bSuccess)
            {
                Utilities.LogToFile(AppConfig.LogFile(true), &quot;SaveBeforeActionFailed: &quot; + sErrors,
                    MethodBase.GetCurrentMethod());
                if (!string.IsNullOrEmpty(sErrors))
                {
                    ShowError(sErrors);
                }
                HandleDataFromWorkFlow();
                return;
            }
            Utilities.LogToFile(AppConfig.LogFile(true), &quot;SaveBeforeActionSucceeded&quot;, MethodBase.GetCurrentMethod());

            if (this is IXMLControl &amp;&amp; xmlEngine != null)
                try
                {
                    xmlEngine.model.form.instanceID = sSavedInstanceToken;
                    xControl ctrl = xmlEngine.model.form.GetControl(xmlEngine.model.form.PrimaryKeyName);
                    (ctrl.ControlReference[0] as TextBox).Text = ctrl.EvaluateControlValue();
                    bypassInstanceSetting = true;
                    BrixPageBase_SaveXMLInjectionData(this, new EventArgs());
                }
                catch (Exception)
                {
                }

            if (string.IsNullOrEmpty(ID.Value) || !ID.Value.Contains(&quot;_&quot;))
                Response.Redirect(formInfo.PostCancelRedirectUrl, true);

            string[] aIds = ID.Value.Split(&#39;_&#39;);
            string sWfInstanceId = aIds[0];
            string sActionId = aIds[1];

            DateTime? dueDate = ComputeDueDate(e.DaysToComplete);
            Utilities.LogToFile(AppConfig.LogFile(true), &quot;Updating Workflow Mappings: &quot;, MethodBase.GetCurrentMethod());
            UpdateWorkflowMappings(formInstanceID, sWfInstanceId, &quot;&quot;, formInfo, dueDate);

            string errMsg = DoPostSaveWorkflowActions(e, formInfo, formInstanceID,
                aIds.Length &gt; 2 ? aIds[2].Replace(&quot;XXX&quot;, &quot; &quot;) : null, sWfInstanceId, sActionId);
            Utilities.LogToFile(AppConfig.LogFile(true), &quot;WFAction Returned: Action &#39;&quot; + sActionId + &quot;&#39;. &quot; + errMsg,
                MethodBase.GetCurrentMethod());

            HandleDataFromWorkFlow();

            string successMsgs = BrixWorkflowManager.Instance.GetWorkflowSuccessMessages(ref errMsg);

            string EditUrl = &quot;&quot;;
            if (IsNew)
                EditUrl = CreateEditPageURL(formInstanceID);

            if (!string.IsNullOrEmpty(errMsg) &amp;&amp; !IsNew &amp;&amp; !errMsg.ToLower2().Contains(&quot;warning:&quot;))
            {
                JavaScriptSerializer JS = new JavaScriptSerializer();
                ShowError(errMsg);// ShowError(JS.Serialize(errMsg).Replace(&quot;\&quot;&quot;, &quot;&quot;));
                if (!string.IsNullOrEmpty(successMsgs)) ShowSuccess(successMsgs);// ShowSuccess(JS.Serialize(successMsgs).Replace(&quot;\&quot;&quot;, &quot;&quot;));
            }
            else if (!string.IsNullOrEmpty(errMsg) &amp;&amp; !errMsg.ToLower2().Contains(&quot;warning:&quot;) &amp;&amp; IsNew &amp;&amp; EditUrl != &quot;&quot;)
            {
                JavaScriptSerializer JS = new JavaScriptSerializer();
                Session[&quot;WorkflowErrOnLastPage&quot;] = errMsg;
                Session[&quot;WorkflowSuccessOnLastPage&quot;] = successMsgs;
                Response.Redirect(EditUrl, true);
            }
            else
            {
                Session[&quot;WorkflowErrOnLastPage&quot;] = errMsg;
                Session[&quot;WorkflowSuccessOnLastPage&quot;] = successMsgs;

                if (string.IsNullOrEmpty(errMsg))
                    sActionName = aIds.Length &gt; 2 ? aIds[2].Replace(&quot;XXX&quot;, &quot; &quot;) : null;
                WorkflowActionComplete();

                Utilities.LogToFile(AppConfig.LogFile(true), &quot;Updating time stamp user details&quot;, MethodBase.GetCurrentMethod());
                HandleSytemDataAfterWorkFlow();

                Response.Redirect(formInfo.PostCancelRedirectUrl, true);
            }
        }

        private string DoPostSaveWorkflowActions(OkEventArgs e, IWorkflowEnabled formInfo, string formInstanceID,
            string actionName, string sWfInstanceId, string sActionId)
        {
            DateTime? dueDate = ComputeDueDate(e.DaysToComplete);
            int hID = BrixWorkflowManager.Instance.CreateWorkflowNotes(0, e.Notes, sActionId == BrixWorkflowManager.RouteTo
                ? &quot;RoutedTo:&quot; + e.User
                : actionName.Replace(&quot;XXX&quot;, &quot; &quot;),
                UserDetail.GetCurrentUserDetail().UID,
                sActionId == BrixWorkflowManager.RouteTo ? e.User : &quot;&quot;, sWfInstanceId, dueDate);
            appWorkflow.InstanceID = hID.ToString();
            appWorkflow.FormInfo = formInfo;
            string errMsg = appWorkflow.SaveAttachments();
            if (!string.IsNullOrEmpty(errMsg))
                return errMsg;

            ListModel lstModel;
            string moduleid = formInfo.FormName;
            if (moduleid == &quot;XDOCMGT&quot;)
            {
                // TODO : Need to See How this can be done.
                moduleid = &quot;DOCMGMT&quot;;
            }
            string EditPageUrl = string.Empty;
            DataRow drModule = ModuleManager.Instance.GetModuleDetails(formInfo.FormName, _CompanyId);
            if (drModule != null &amp;&amp; drModule.Table.Columns.Contains(&quot;NavigateUrl&quot;))
            {
                bool isXML = (drModule[&quot;NavigateUrl&quot;] != null) &amp;&amp; drModule[&quot;AssociatedModuleID&quot;] == System.DBNull.Value
                    ? drModule[&quot;NavigateUrl&quot;].ToString().ToLower() == &quot;xmlform&quot;
                    : false;

                if (isXML)
                {
                    lstModel = ListModel.GetXMLInstance(moduleid, null, null, null);
                    if (lstModel == null &amp;&amp; moduleid == &quot;DOCMGMT&quot;)
                        lstModel = ListModel.GetXMLInstance(&quot;XDOCMGT&quot;, null, null, null);
                }
                else

                    lstModel =
                        ListModel.GetInstance(
                            (drModule[&quot;AssociatedContext&quot;] != System.DBNull.Value)
                                ? Convert.ToString(drModule[&quot;AssociatedContext&quot;])
                                : moduleid, null, null, null);

                EditPageUrl = lstModel.GetEditPageURL(formInfo.PID.ToString(), formInfo.ParentModuleId.ToString(),
                    formInstanceID, moduleid);
            }

            if (sActionId.IsEqualToAny(StringComparison.CurrentCultureIgnoreCase, BrixWorkflowManager.RouteTo, BrixWorkflowManager.GiveOpinion))
            {
                BrixWorkflowManager.Instance.SaveWorkflowRoutedDetailsAndSendEmail(sActionId, sWfInstanceId, (string.IsNullOrEmpty(e.UserID) ? 0 : e.UserID.ToInt32_2()),
                    formInfo.FormName, formInstanceID, _SmtpServer, hID, formInfo.PID, formInfo.ParentModuleId, EditPageUrl);
                Response.Redirect(formInfo.PostCancelRedirectUrl, true);
            }

            Dictionary&lt;string, string&gt; ds = PassInformationToWorkFlow();
            ds.Add(&quot;Company&quot;, Session[Constants.EIS_ADDITIONAL_INFO].ToString());
            ds.Add(&quot;Culture&quot;, Thread.CurrentThread.CurrentCulture.Name);
            ds.Add(&quot;UICulture&quot;, Thread.CurrentThread.CurrentUICulture.Name);

            ds.Add(&quot;ShortDatePattern&quot;, Thread.CurrentThread.CurrentUICulture.DateTimeFormat.ShortDatePattern);
            ds.Add(&quot;DateSeparator&quot;, Thread.CurrentThread.CurrentUICulture.DateTimeFormat.DateSeparator);

            ds.Add(&quot;SaasCompany&quot;, _CompanyId);
            ds.Add(&quot;SaasSmtp&quot;, _SmtpServer);
            //For XPROJCT module projectId is formInstanceID
            ds.Add(&quot;Pid&quot;, moduleid == &quot;XPROJCT&quot; ? formInstanceID : formInfo.PID.ToString());
            ds.Add(&quot;ParentId&quot;, formInfo.ParentModuleId.ToString());
            ds.Add(&quot;ParentObjectPath&quot;, formInfo.ParentModuleId.ToString()); //to be used later
            ds.Add(&quot;ObjectPath&quot;, formInfo.FormName); //to be used later
            ds.Add(&quot;ObjectInstanceId&quot;, formInstanceID); //to be used later
            ds.Add(&quot;editpageurl&quot;, EditPageUrl); //Edit Page URL from
            if (null != dueDate) ds.Add(&quot;DueDateOverride&quot;, dueDate.Value.Ticks.ToString()); //to be used later

            errMsg += BrixWorkflowManager.Instance.TriggerActionOnWorkflowInstance(Guid.Parse(sWfInstanceId),
                sActionId,
                formInfo.PID,
                formInstanceID,
                null,
                ds, hID);
            if (null != errMsg &amp;&amp; errMsg.ToLower().Contains(&quot;timed out&quot;)) _bIsWorkflowTimedOut = true;

            HandleDataFromWorkFlow();
            return errMsg;
        }

        public DateTime? ComputeDueDate(string days)
        {
            if (string.IsNullOrEmpty(days)) return null;

            double daysToComplete = 0;
            if (!double.TryParse(days, out daysToComplete)) return null;

            if (daysToComplete &gt; -1)
                return DateTime.UtcNow.AddDays(daysToComplete);
            else
                return new DateTime(1900, 1, 1);
        }

        /// &lt;summary&gt;
        /// This will give a call back to the SaveHandler method in which the save logic is expected without any redirects
        /// After the call to the save handler, this method performs some workflow operations and then redirects to the
        /// url mentioned in either PostCancelRedirectUrl or PostSaveRedirectUrl
        /// &lt;/summary&gt;
        protected void WorkflowEnabledSaveHandler(bool redirectAfterSave = true, IWorkflowEnabled formInfo = null)
        {
            bool bSuccess = false;
            string sErrors = &quot;&quot;;
            string sRedirector = &quot;&quot;;
            string sSavedInstanceToken = &quot;&quot;;
            try
            {
                if (null == formInfo) formInfo = _FormInfo;
                bSuccess = formInfo.SaveHandler(formInfo, out sSavedInstanceToken, out sErrors, out sRedirector);
                if (!bSuccess &amp;&amp; sErrors != null &amp;&amp; sErrors != &quot;&quot;)
                {
                    ShowError(sErrors);
                }
                if (!bSuccess || string.IsNullOrEmpty(sSavedInstanceToken))
                {
                    //TO handle error message received from the workflow
                    HandleDataFromWorkFlow();
                    return;
                }
                // if it is saved successfully
                UpdateWorkflowMappings(sSavedInstanceToken,
                    (_WorkflowsInitiated != null &amp;&amp; _WorkflowsInitiated.Count &gt; 0)
                        ? _WorkflowsInitiated[0].ToString()
                        : string.Empty, null, formInfo);

                HandleDataFromWorkFlow();

                if (this is IXMLControl &amp;&amp; xmlEngine != null)
                {
                    bool isNewMode = xmlEngine.IsNewMode;
                    xmlEngine.model.form.instanceID = sSavedInstanceToken;
                    xmlEngine.model.form.IsInjectionType = isNewMode ? &quot;New&quot; : &quot;&quot;;
                    xControl ctrl = xmlEngine.model.form.GetControl(xmlEngine.model.form.PrimaryKeyName);
                    if (ctrl.ControlReference.Count &gt; 0)
                        (ctrl.ControlReference[0] as TextBox).Text = ctrl.EvaluateControlValue();
                    bypassInstanceSetting = true;
                    BrixPageBase_SaveXMLInjectionData(this, new EventArgs());
                }
            }
            catch (Exception ex)
            {
                //TODO: Show error message somewhere
                //TODO: Show error message somewhere
                if (ex is System.Data.SqlClient.SqlException)
                {
                    Aurigo.AMP3.Logging.Logger.Log(Aurigo.AMP3.Resources.MessageResources.Enumerations.LogType.Error, ex.Message, Constants.MODID_CORE);
                    sErrors = &quot;Database Error.&quot;;
                }
                else if (ex is MWConcurrencyException)
                {
                    sErrors = string.Empty;
                }
                else
                {
                    sErrors = ex.Message;
                }
                //TODO: Need to check with Nagendra
                bSuccess = false;
            }

            if (bSuccess &amp;&amp; redirectAfterSave)
            {
                Response.Redirect(formInfo.PostSaveRedirectUrl(sSavedInstanceToken), true);
                return;
            }

            if (!bSuccess &amp;&amp; !string.IsNullOrEmpty(sErrors))
            {
                ShowError(sErrors);
            }
        }

        public List&lt;int&gt; UpdateWorkflowMappings(string sSavedInstanceToken, string workflowInstaceGuid = &quot;&quot;,
            string sRouteUser = null, IWorkflowEnabled formInfo = null, DateTime? dueDate = null)
        {
            if (null == formInfo) formInfo = _FormInfo;
            List&lt;int&gt; lst = new List&lt;int&gt;();

            //Akila - If its a list page then the form key should not be updated. Otherwise junk data will be populated in the details column of the my task
            //For aspx pages in view mode formKey property is not implemented hence adding try catch. eg. ProjectDetails.aspx
            string formKey = string.Empty;

            try
            {
                formKey = _IsListPage ? null : formInfo.FormKey;
            }
            catch (Exception ex)
            {
                Utilities.LogToFile(AppConfig.LogFile(true), &quot;FormKey not available &quot;, MethodBase.GetCurrentMethod());
            }

            if (!string.IsNullOrEmpty(workflowInstaceGuid))
            {
                int mapId = BrixWorkflowManager.Instance.CreateUpdateWFInstanceFormMapping(formInfo.FormName,
                    sSavedInstanceToken,
                    workflowInstaceGuid, formKey, formInfo.PID,
                    formInfo.ParentModuleId, sRouteUser);
                lst.Add(mapId);
                return lst;
            }

            if (string.IsNullOrEmpty(WorkflowGuids)) return lst;

            string[] workflowGuids = WorkflowGuids.Split(&#39;,&#39;);
            foreach (string gd in workflowGuids)
            {
                if (string.IsNullOrEmpty(gd)) continue;
                int mapId = BrixWorkflowManager.Instance.CreateUpdateWFInstanceFormMapping(formInfo.FormName,
                    sSavedInstanceToken,
                    gd, formKey, formInfo.PID,
                    formInfo.ParentModuleId, sRouteUser);
                lst.Add(mapId);
            }
            return lst;
        }

        public IState GetWorkflowStageFor(Guid wfGuid, ref Guid newGuid)
        {
            if (null == _wfStates) _wfStates = new Dictionary&lt;string, IState&gt;();
            if (wfGuid == null || wfGuid == Guid.Empty) return null;

            if (_wfStates.ContainsKey(wfGuid.ToString())) return _wfStates[wfGuid.ToString()];
            IState currentState = BrixWorkflowManager.Instance.GetCurrentState(wfGuid, ref newGuid);
            return currentState;
        }

        public List&lt;IAction&gt; GetCurrentWorkflowActionButtons(Guid wfGuid, ref Guid newGuid, ref int daysToComplete,
            ref string actionsMustBePerformedBy, ref string stateName)
        {
            if (null == _wfStates) _wfStates = new Dictionary&lt;string, IState&gt;();
            if (wfGuid == null || wfGuid == Guid.Empty) return null;
            List&lt;IAction&gt; actions = new List&lt;IAction&gt;();
            if (_wfStates.ContainsKey(wfGuid.ToString()))
            {
                IState currentState = _wfStates[wfGuid.ToString()];
                foreach (IAction action in currentState.ActionButtons)
                    actions.Add(action);
                daysToComplete = currentState.DaysToComplete;
                actionsMustBePerformedBy = currentState.ActionsMustBePerformedBy;
                stateName = currentState.DisplayName;
            }
            actions = BrixWorkflowManager.Instance.GetCurrentWorkflowActionButtons(wfGuid, ref newGuid,
                ref daysToComplete, ref actionsMustBePerformedBy, ref stateName);
            return actions;
        }

        public bool IsWorkflowAssociated(string formName = null, IWorkflowEnabled formInfo = null)
        {
            if (null != _WorkflowsInitiated &amp;&amp; _WorkflowsInitiated.Count &gt; 0) return true;
            if (null == _FormInfo &amp;&amp; this is IWorkflowEnabled) _FormInfo = (IWorkflowEnabled)this;
            if (null == formInfo) formInfo = _FormInfo;
            string form = (null != formName) ? formName : (null != formInfo) ? formInfo.FormName : null;
            if (null == form || formInfo == null) return false;
            return BrixWorkflowManager.Instance.IsWorkflowAssociated(form, formInfo.PID.ToString(),
                formInfo.ParentModuleId.ToString());
        }

        protected virtual bool CanShowWorkflowButtons()
        {
            return true;
        }

        protected bool HasInCompleteWorkflows(IWorkflowEnabled formInfo = null)
        {
            if (null != _HasInCompleteWorkflows) return (bool)_HasInCompleteWorkflows;
            if (!(this is IWorkflowEnabled)) return false;
            if (null == _FormInfo) _FormInfo = (IWorkflowEnabled)this;
            if (null == formInfo) formInfo = _FormInfo;
            _HasInCompleteWorkflows = BrixWorkflowManager.Instance.HasInCompleteWorkflows(formInfo.FormInstanceId,
                formInfo.FormName,
                WorkflowGuids);
            return (bool)_HasInCompleteWorkflows;
        }

        private Aurigo.AMP3.Core.UserControls.Menu GetActionMenuItem(string sWfInstanceId, string actionId,
            string actionName)
        {
            if (null == MainToolBar) return null;
            actionName = actionName.Replace(&quot; &quot;, &quot;XXX&quot;);
            return MainToolBar.GetMenuReference(sWfInstanceId + &quot;_&quot; + actionId + &quot;_&quot; + actionName);
        }

        private void HideActionMenuItem(string sWfInstanceId, string actionId, string actionName, bool unHide = false)
        {
            if (null == MainToolBar) return;
            actionName = actionName.Replace(&quot; &quot;, &quot;XXX&quot;);
            MainToolBar.HideMenu(sWfInstanceId + &quot;_&quot; + actionId + &quot;_&quot; + actionName);
        }

        private void AddClientScriptToWorkflowButtons()
        {
            if (null == _WorkflowsInitiated) return;
            string clientScript = (this as IWorkflowEnabled).ClientValidationFunction;
            if (string.IsNullOrEmpty(clientScript)) return;
            if (_bIsWorkflowTimedOut) return;

            bool showWorkflowBallIncourt = CoreModuleComponents.Contains(&quot;ShowWorkflowBallIncourt&quot;);
            foreach (Guid gd in _WorkflowsInitiated)
            {
                Aurigo.AMP3.Core.UserControls.Menu btn;
                btn = GetActionMenuItem(gd.ToString(), BrixWorkflowManager.GiveOpinion, &quot;Respond&quot;);
                PrependButtonScript(clientScript, btn);
                Guid actualGuid = Guid.Empty;
                int daysToComplete = 0;
                string actionsMustBePerformedBy = null;
                string stateName = string.Empty;

                List&lt;IAction&gt; actions = new List&lt;IAction&gt;();
                if (_WorkflowStates.ContainsKey(actualGuid.ToString()) &amp;&amp; _WorkflowStates[gd.ToString()].Value != null)
                    actions = _WorkflowStates[gd.ToString()].Value;
                else
                    actions = GetCurrentWorkflowActionButtons(gd, ref actualGuid, ref daysToComplete,
                        ref actionsMustBePerformedBy, ref stateName);
                if (actualGuid == Guid.Empty) actualGuid = gd;

                //adding a property for adding or hiding ball in court in menu
                if (showWorkflowBallIncourt)
                {
                    btn = GetActionMenuItem(actualGuid.ToString(), BrixWorkflowManager.RouteTo,
                        LocalizationManager.GetString(&quot;BallInCourt&quot;));
                    PrependButtonScript(clientScript, btn);
                }

                foreach (IAction action in actions)
                {
                    btn = GetActionMenuItem(actualGuid.ToString(), action.InstanceId, action.ActionName);

                    if (btn != null)
                    {
                        btn.ValidationGroup = stateName.Replace(&#39; &#39;, &#39;_&#39;) + &quot;_&quot; +
                                              action.ActionName.Trim().Replace(&#39; &#39;, &#39;_&#39;);
                    }
                    PrependButtonScript(clientScript, btn);
                }
            }
        }

        protected void HideWorkflowButtons()
        {
            if (null == _WorkflowsInitiated) return;
            if (null == MainToolBar) return;

            MenuGroup mGroup = MainToolBar.Groups.Find(mg =&gt; mg.Title == groupName);
            if (mGroup != null)
            {
                MainToolBar.Groups.Remove(mGroup);
                MainToolBar.Bind();
            }
        }

        public static void PrependButtonScript(string clientScriptValidation, Aurigo.AMP3.Core.UserControls.Menu btn)
        {
            if (null == btn) return;
            //If the clientScriptValidation hs format specified then we need to pass the button&#39;s validation group.
            int formatCount = Regex.Matches(clientScriptValidation, @&quot;(?&lt;!\{)\{(?&lt;number&gt;[0-9]+).*?\}(?!\})&quot;).Count;

            if (formatCount &gt; 0)
            {
                clientScriptValidation = clientScriptValidation.Format2(btn.ValidationGroup.ToString2());
            }
            string finalScript = btn.OnClientClick;
            if (!string.IsNullOrEmpty(finalScript))
            {
                finalScript =
                    string.Format(
                        @&quot;{{ WorkflowCurrentAction = &#39;{2}&#39;; var done = {0}; if(done) {{ {1}; }} return false; }}&quot;,
                        clientScriptValidation.TrimEnd(&#39;;&#39;), btn.OnClientClick.TrimEnd(&#39;;&#39;), btn.CommandArgument);
                btn.RemoveAttribute(&quot;onclick&quot;);
            }
            else finalScript = clientScriptValidation;
            btn.OnClientClick = finalScript;
        }

        private void ContextMenuItemClick(object sender, EventArgs e)
        {
            var tempButton = (LinkButton)sender;
            if (ContextElementRadGrid != null)
                ContextMenuManager.Instance.DoCallBack(tempButton.CommandName, tempButton.CommandArgument,
                    ContextElementRadGrid);
            else if (ContextElementRadGrid != null)
                ContextMenuManager.Instance.DoCallBack(tempButton.CommandName, tempButton.CommandArgument,
                    ContextElementRadGrid);
            else
                ContextMenuManager.Instance.DoCallBack(tempButton.CommandName, tempButton.CommandArgument,
                    ContextElementHGrid);
        }

        private Control FindControl(Control control, string id)
        {
            if (control.ID == id)
                return control;
            else
            {
                foreach (Control c in control.Controls)
                {
                    Control ctr = FindControl(c, id);
                    if (ctr != null)
                        return ctr;
                }
            }
            return null;
        }

        public void BrixPageBase_SaveXMLInjectionData(object sender, EventArgs e)
        {
            if (xmlEngine != null)
            {
                if ((this as IXMLControl).SkipDefaultXMLInjectionSave) return;
                try
                {
                    if ((this as IXMLControl).ParentFormInstanceID.Length &gt; 0 &amp;&amp;
                        (this as IXMLControl).ParentFormInstanceID[0] != null)
                    {
                        if (!bypassInstanceSetting)
                        {
                            xmlEngine.model.form.instanceID = (this as IXMLControl).ParentFormInstanceID[0].ToString();
                            xControl ctrl = xmlEngine.model.form.GetControl(xmlEngine.model.form.PrimaryKeyName);
                            (ctrl.ControlReference[0] as TextBox).Text = ctrl.EvaluateControlValue();
                        }
                        xmlEngine.SaveData(Page, RenderFormat.RenderHtml);
                        (this as IXMLControl).HandleInjectionAfterSave(xmlEngine.model, xmlEngine.model.form.instanceID);
                        bypassInstanceSetting = false;
                    }
                }
                catch (Exception ex)
                {
                    (this as IXMLControl).HandleInjectionSaveException(xmlEngine.model, ex,
                        xmlEngine.model.form.instanceID);
                }
            }
            else
            {
                throw new Exception(&quot;EditPage interface is not implemented&quot;);
            }
        }

        protected override void OnPreRender(EventArgs e)
        {
            if (UseApplyGridWidthStyle)
                ApplyGridWidthStyle(Page);

            GlobalizationUtility.ApplyGlobalizationToPage(this, labels, columnInfo);

            if (this is IWorkflowEnabled)
                AddClientScriptToWorkflowButtons();

            if (PageTabBar != null &amp;&amp; PageTabBar.Tabs.Count &lt; 1 &amp;&amp; !string.IsNullOrEmpty(PageTitle))
                PageTabBar.Tabs.Add(new Tab(HttpUtility.HtmlEncode(PageTitle))); // to fix XSS attack

            SkipAutoPostBackControls(this.Page as Control);
            SetBreadCrumb();

            base.OnPreRender(e);
        }

        private void SetBreadCrumb()
        {
            master = (Master != null) ? Master.Master ?? Master : null;
            if (master != null &amp;&amp; master.FindControl(&quot;litBreadCrumb&quot;) != null)
            {
                // based on the ModuleId we need create the instance of below class like Root class for Home;
                string breadcrumbContext = PageUniqueID == &quot;&quot; ? ModuleId : PageUniqueID;
                BreadCrumbBase bc = BreadCrumbManager.GetInstance(breadcrumbContext);
                if (bc == null)
                    bc = new RootBreadCrumb();
                (master.FindControl(&quot;litBreadCrumb&quot;) as Literal).Text = bc.GetBreadCrumbHTML();
            }
        }

        private void SkipAutoPostBackControls(Control x)
        {
            foreach (Control c in x.Controls)
            {
                //If command argument is there then its a menu, and this should be skipped.
                //Otehrwise on click on save, wf buttons etc the message will be shown
                //TODO: Need to show the message on click on cancel
                if ((c is ListControl &amp;&amp; (c as ListControl).AutoPostBack)
                    || (c is Button)
                    || ((c is LinkButton) &amp;&amp; !string.IsNullOrEmpty((c as LinkButton).CommandArgument)))
                {
                    string showConfirmMessage = (c as WebControl).Attributes[&quot;showConfirmMessage&quot;];
                    if (string.IsNullOrEmpty(showConfirmMessage) || showConfirmMessage == &quot;0&quot;)
                        (c as WebControl).Attributes.Add(&quot;skip&quot;, &quot;1&quot;);
                }
                SkipAutoPostBackControls(c); // skipping autopostbaCK CONTROLS
            }
        }

        protected void CreateToolBarMenu(MenuArray menus, EventHandler eventHandler)
        {
            CreateToolBarMenu(menus, null, eventHandler);
        }

        protected void CreateToolBarMenu(List&lt;MenuGroup&gt; group, EventHandler eventHandler)
        {
            if (null == MainToolBar) MainToolBar = new ToolBar();
            CreateToolBarMenu(null, group, eventHandler);
        }

        private void CreateToolBarMenu(MenuArray menus, List&lt;MenuGroup&gt; groups, EventHandler eventHandler)
        {
            if (null == MainToolBar) return;
            if (eventHandler != null)
                MainToolBar.MenuItemClick += eventHandler;
            if (menus != null)
                MainToolBar.CreateToolBar(menus);
            else
                MainToolBar.CreateToolBar(groups);

            AddWorkflowButtons(); //For Form Page
            AddAllWorkflowButtons(); //For List Page

            CustomizeToolBar();

            //TODO: Need to check if injection works for forms which doesnt have workflow - Akila
            if (xmlEngine != null &amp;&amp; !xmlEngine.IsViewMode &amp;&amp; MainToolBar.GetMenuReference(&quot;lnkSave&quot;) != null &amp;&amp;
                !(this is IWorkflowEnabled))
            {
                MainToolBar.GetMenuReference(&quot;lnkSave&quot;).ValidationGroup = &quot;Master&quot;;
                MainToolBar.GetMenuReference(&quot;lnkSave&quot;).Click += BrixPageBase_SaveXMLInjectionData;
            }
        }

        protected void CreateButtons()
        {
            if (HttpContext.Current.Trace.IsEnabled)
                HttpContext.Current.Trace.Write(&quot;aspx.page&quot;, &quot;Begin CreateButtons()&quot;);

            #region generate unique action buttons based on stages of records.

            try
            {
                if (!(this is IWorkflowEnabled)) return;
                if (!_IsListPage) return;
                if (null == _FormInfo) _FormInfo = (IWorkflowEnabled)this;
                if (_FormInfo.FormName != &quot;XDOCMGT&quot; &amp;&amp; !IsWorkflowAssociated(_FormInfo.FormName)) return;//TODO: This can be optimize check if work flow exist and get the default workflow if it exist (make it one stored proc)
                if (!CanShowWorkflowButtons()) return;
                if (null == _ModuleComponents) InitModuleComponents();
                if (!_ModuleComponents.Contains(&quot;ShowWorkflowActionsInListPage&quot;))
                {
                    ShowWorkFlowActionOnListPage = false;
                    return;
                }
                if (!ShowWorkFlowActionOnListPage) return;

                //Bugfix: default workflow need not be checked.
                //         even without default workflow user can still get to see the action selection control
                //Get default wf associated with form. Exception for DOCMGMT as no default WF is ther
                //if (_FormInfo.FormName != &quot;XDOCMGT&quot;)
                //{
                //    DataTable dtGetDefaultWF =
                //        ComponentHelper.Instance.ExecuteDataSet(
                //            WFStoredProcedure.usp_WORKFLWGetDefaultWorkflowByAssociatedForm, null, _FormInfo.FormName)
                //            .Tables[0];
                //    if (dtGetDefaultWF == null || dtGetDefaultWF.Rows.Count == 0)
                //    {
                //        ShowWorkFlowActionOnListPage = false;
                //        return;
                //    }
                //}

                List&lt;TextIcon&gt; allStageButtons = new List&lt;TextIcon&gt;();
                string[] buttons;

                string showOnSelectFunc = string.Format(&quot;function {0}(gridId){{ COMMON_EnableWFActionsJSFunction(gridId);}}&quot;, EnableWFActionsJSFunction);

                //For every row, check the action buttons column and generate action buttons.
                //If action buttons column is null (for older records or for other product implementations,
                //then set the buttons matching the stage in the default workflow.
                Type type = Page.GetType();
                BindingFlags bindFlags = BindingFlags.Instance | BindingFlags.NonPublic | BindingFlags.Public |
                                         BindingFlags.Static;
                var grid = new RadGrid();
                object ctrl = null;

                foreach (FieldInfo fieldInfo in type.GetFields(bindFlags))
                {
                    ctrl = fieldInfo.GetValue(Page);
                    if (ctrl != null &amp;&amp; ctrl is RadGrid)
                    {
                        grid = (ctrl as RadGrid);
                    }
                }
                //ReBindListPage();
                if (grid != null &amp;&amp; grid.MasterTableView.DataSource != null &amp;&amp; ((DataSet)grid.MasterTableView.DataSource).Tables.Count &gt; 0)
                {
                    DataSet gridData = ((DataSet)grid.MasterTableView.DataSource);

                    UserDetail sCurrentUser = UserDetail.GetCurrentUserDetail();
                    DataColumn column = gridData.Tables[0].Columns[&quot;WF_PendingOnRole&quot;];
                    int pid = (string.IsNullOrEmpty(Request.QueryString[&quot;PID&quot;]) ? 0 : Request.QueryString[&quot;PID&quot;].ToInt32_2());
                    bool isPIDinDataTable = _FormInfo.FormName.ToUpper() == &quot;XPROJCT&quot; &amp;&amp; gridData.Tables[0].Columns.Contains(&quot;ProjectId&quot;);
                    DataTable dtAllRoles = UserManager.Instance.GetRolesDataTable();

                    string pidFilter = &quot;&quot;;
                    string pidlist = HttpContext.Current.Request[&quot;PID&quot;] ?? &quot;0&quot;;
                    string workflowInstanceGUIDs = string.Empty;
                    foreach (DataRow dr in gridData.Tables[0].Rows)
                    {
                        if (isPIDinDataTable) pidlist += dr[&quot;ProjectId&quot;].ToString() + &quot;,&quot;;
                        workflowInstanceGUIDs += dr[&quot;WorkflowInstanceGuid&quot;] + &quot;,&quot;;
                    }
                    pidlist = pidlist.TrimEnd(&#39;,&#39;);
                    workflowInstanceGUIDs = workflowInstanceGUIDs.TrimEnd(&#39;,&#39;);

                    DataTable dtWorflow = WFRuntimeHandlerDB.HasCurrentUserPerformedWorkflowAction(workflowInstanceGUIDs);

                    //Get project users and their roles
                    DataTable dtUsers = new DataTable();
                    if (isPIDinDataTable &amp;&amp; !string.IsNullOrEmpty(pidlist))
                    {
                        dtUsers = UserManager.Instance.GetProjectUsersByProjects(pidlist);
                    }

                    Dictionary&lt;int, string&gt; userRoles = new Dictionary&lt;int, string&gt;();
                    if (!isPIDinDataTable)
                    {
                        //Get roles for
                        userRoles = UserManager.Instance.GetUserRolesBasedOnProjectId(sCurrentUser.UID, pid,
                                        sCurrentUser.RID, sCurrentUser.RoleName);
                    }

                    foreach (DataRow dataItem in gridData.Tables[0].Rows)
                    {
                        if (dataItem is DataRow)
                        {
                            //Check if user has the stakeholder roles necessary for performing workflow actions.
                            bool bHasLocalRoleToPlay = false;
                            string pendingOnRole = null;
                            if (column != null)
                            {
                                pendingOnRole = string.IsNullOrEmpty(dataItem[column.ColumnName].ToString2())
                                    ? null
                                    : dataItem[column.ColumnName].ToString2();
                            }

                            string[] stakeHolders = string.IsNullOrEmpty(pendingOnRole)
                                ? null
                                : pendingOnRole.Split(&#39;,&#39;);
                            if (stakeHolders != null)
                            {
                                if (isPIDinDataTable)
                                {
                                    pid = dataItem[&quot;ProjectId&quot;].ToInt32_2();

                                    DataRow[] drs = dtUsers.Select(string.Format(&quot;UserId={0} AND ProjectId={1}&quot;, sCurrentUser.UID, pid));
                                    if (drs.Length &gt; 0)
                                    {
                                        userRoles = new Dictionary&lt;int, string&gt;();
                                        foreach (DataRow row in drs)
                                            userRoles.Add(Convert.ToInt32(row[&quot;RoleID&quot;].ToString()), row[&quot;RoleName&quot;].ToString());
                                    }
                                }

                                foreach (string stakeHolderRole in stakeHolders)
                                {
                                    int stakeHolderRoleID = 0; //UserManager.Instance.GetUsersRoleId(stakeHolderRole);
                                    DataRow[] rows = dtAllRoles.Select(string.Format(&quot;RoleName=&#39;{0}&#39;&quot;, stakeHolderRole));
                                    if (rows.Length &gt; 0)
                                        stakeHolderRoleID = Convert.ToInt32(rows[0][&quot;RoleId&quot;]);

                                    if (userRoles.ContainsKey(stakeHolderRoleID))
                                    {
                                        //if current user role matches the stakeholders roles, then proceed further
                                        bHasLocalRoleToPlay = true;

                                        string workflowInstanceGuid = dataItem[&quot;WorkflowInstanceGuid&quot;].ToString();
                                        bHasLocalRoleToPlay = !WFRuntimeHandlerDB.HasCurrentUserPerformedWorkflowAction(workflowInstanceGuid, userRoles, sCurrentUser.UID, dtWorflow);
                                        break;
                                    }
                                }
                            }
                            else
                            {
                                //if current user roles is not part of the stakeholders, then dont add the button.
                                dataItem[&quot;Buttons&quot;] = string.Empty;
                                continue;
                            }

                            //make the buttons column blank so that nothing will load when the row is selected.
                            if (!bHasLocalRoleToPlay)
                            {
                                dataItem[&quot;Buttons&quot;] = string.Empty;
                                continue;
                            }

                            object btns = dataItem[&quot;Buttons&quot;].ToString2();
                            string buttons2 = (btns == null) ? null : btns.ToString();
                            //If buttons column has info, then add the list of buttons to main list if not already added. allStageButtons should contain the unique list of Action Names for the list page.
                            if (!string.IsNullOrEmpty(buttons2))
                            {
                                //Get comma separated buttons list.
                                buttons = buttons2.Split(&#39;,&#39;);
                                if (buttons.Length &gt; 0)
                                {
                                    foreach (string action in buttons)
                                    {
                                        string[] actionParamList = action.Split(&#39;|&#39;);
                                        TextIcon icn = new TextIcon
                                        {
                                            ID = action,
                                            Text = actionParamList[0].Replace(&quot;XXX&quot;, &quot; &quot;),
                                            Title = actionParamList[0].Replace(&quot;XXX&quot;, &quot; &quot;),
                                        };
                                        //Add action button to list if not already added.
                                        if (!allStageButtons.Exists(x =&gt; x.ID == icn.ID))
                                            allStageButtons.Add(icn);
                                    }
                                }
                            }
                        }
                    }
                }

                string jsonArray = &quot;null&quot;;//JS null
                if (allStageButtons.Any())
                    jsonArray = &quot;[&quot; + string.Join(&quot;,&quot;, allStageButtons.Select(icn =&gt; string.Format(&quot;&#39;{0}&#39;&quot;, icn.Text))) + &quot;]&quot;;

                string hideAllFunc = @&quot;

$(document).ready(function(){HideAllWFActions();});

function HideAllWFActions(){
    HideAllWFActions_ForGivenIdArray(&quot; + jsonArray + @&quot;);
}&quot;;

                ////Generate contents of hideAllFunc function used to hide all buttons.
                //foreach (TextIcon icn in allStageButtons)
                //{
                //    hideAllFunc += &quot;BrixMainToolBar.HideMenu(&#39;&quot; + icn.Text + &quot;&#39;);\n&quot;;
                //}
                //hideAllFunc += &quot;}&quot;;
                AddDropDownToMenu(null, allStageButtons);

                //For clearing the old script and adding new script.
                if (ClientScript.IsStartupScriptRegistered(&quot;ListpageWorkflowActions&quot;))
                    ClientScript.RegisterStartupScript(GetType(), &quot;ListpageWorkflowActions&quot;, &quot;&quot;, true);

                RegisterStartupScript(hideAllFunc + &quot;\n&quot; + showOnSelectFunc /*+ &quot;\n&quot; + showActionsForStage*/, this, &quot;ListpageWorkflowActions&quot;);
            }
            catch (Exception ex)
            {
                Utilities.LogError(ex, new AppErrInfo { appWhat = &quot;Button Creation Failed on Brix List Page.&quot; },
                    MethodBase.GetCurrentMethod());
            }

            #endregion generate unique action buttons based on stages of records.

            if (HttpContext.Current.Trace.IsEnabled)
                HttpContext.Current.Trace.Write(&quot;aspx.page&quot;, &quot;End CreateButtons()&quot;);
        }

        protected virtual void CustomizeToolBar()
        {
        }

        protected virtual void CreateContextMenu()
        {
        }

        protected virtual void HandleDataFromWorkFlow()
        {
        }

        protected virtual void WorkflowActionComplete()
        {
        }

        protected virtual void HandleSytemDataAfterWorkFlow()
        {
        }

        public virtual Dictionary&lt;string, string&gt; PassInformationToWorkFlow()
        {
            return new Dictionary&lt;string, string&gt;();
        }

        #region Properties

        public string ItemNameAbbr
        {
            get { return LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR); }
        }

        public string ItemName
        {
            get { return LocalizationManager.GetString(KeyConstants.LOC_ITEM); }
        }

        public string ItemsName
        {
            get { return LocalizationManager.GetString(KeyConstants.LOC_ITEMS); }
        }

        public string PayEstimateName
        {
            get { return LocalizationManager.GetString(KeyConstants.LOC_PAY_ESTIMATE); }
        }

        public string PayEstimatesName
        {
            get { return LocalizationManager.GetString(KeyConstants.LOC_PAY_ESTIMATES); }
        }

        public string SectionName
        {
            get { return LocalizationManager.GetString(KeyConstants.LOC_SECTION); }
        }

        public string PayItemNo
        {
            get { return LocalizationManager.GetString(KeyConstants.LOC_PAY_ITEM_NO); }
        }

        public string PayItems
        {
            get { return LocalizationManager.GetString(KeyConstants.LOC_PAY_ITEMS); }
        }

        public string PayItemNoAbbr
        {
            get { return LocalizationManager.GetString(KeyConstants.LOC_PAY_ITEM_NO_ABBR); }
        }

        protected string GetProjectMode()
        {
            if (String.IsNullOrEmpty(Request[Constants.QRY_PROJECTID]) || Request[Constants.QRY_PROJECTID].Equals(&quot;0&quot;))
                return &quot;L&quot;;
            char projectMode = ProjectManager.Instance.GetProjectMode(Convert.ToInt32(Request[Constants.QRY_PROJECTID]));
            return projectMode.ToString();
        }

        #endregion Properties

        #region VIEWSTATE PERSISTENCE ON SERVER

        protected override void SavePageStateToPersistenceMedium(object viewState)
        {
            // Note: If Redis not enabled, save tp persistence medium.
            if (hdnViewStateKey == null || !CacheBroker.IsEnabled())
            {
                base.SavePageStateToPersistenceMedium(viewState);
                return;
            }

            // Add or update the cache with the viewsatate

            if (string.IsNullOrEmpty(hdnViewStateKey.Value))
                hdnViewStateKey.Value = GetNewKey();
            if (WebConfigurationManager.AppSettings[&quot;CentralizedWebfarm&quot;] != null &amp;&amp;
                WebConfigurationManager.AppSettings[&quot;CentralizedWebfarm&quot;].ToBoolean2())
            {
                Session[hdnViewStateKey.Value] = viewState;
                //onViewStateExpireInMemory(hdnViewStateKey.Value, viewState, CacheItemRemovedReason.Expired);
            }
            else
            {
                /*Cache.Insert(hdnViewStateKey.Value,
                    viewState,
                    null, // dependencies
                    Cache.NoAbsoluteExpiration, // absolute expire time
                    TimeSpan.FromMinutes(5), //sliding expiretime
                    CacheItemPriority.Normal,
                    onViewStateExpireInMemory
                    );*/
                var los = new LosFormatter();
                var writer = new StringWriter();
                los.Serialize(writer, viewState);
                CacheBroker.Put(hdnViewStateKey.Value, writer.ToString(), TimeSpan.FromMinutes(AMP3ApplicationSettings.Instance.SessionTimeout)
                    , regionName: AMP3ApplicationSettings.Instance.RedisRegionName);
            }
        }

        private string GetNewKey()
        {
            return Session.SessionID + &quot;_&quot; + DateTime.UtcNow.Ticks; // unique value for ever - assigned to a request once
        }

        protected void onViewStateExpireInMemory(string key, object value, CacheItemRemovedReason reason)
        {
            if (reason != CacheItemRemovedReason.Removed)
            {
                // serialize the view state into a base-64 encoded string
                var los = new LosFormatter();
                var writer = new StringWriter();
                los.Serialize(writer, value);

                // Persist viewstate in DB
                ComponentHelper.Instance.ExecuteNonQueryWithVariableParametersOn(
                    ConnectionHelper.GetConnectionString(&quot;&quot;),
                    StoredProcedure.usp_APPMGMTCUPersistData, null, key, writer.ToString());
            }
        }

        protected override object LoadPageStateFromPersistenceMedium()
        {
            // Note: If Redis not enabled, load from persistence medium.
            if (hdnViewStateKey == null || !CacheBroker.IsEnabled())
            {
                try
                {
                    return base.LoadPageStateFromPersistenceMedium();
                }
                catch (Exception e)
                {
                    //reload the page as the user has got logged out
                    if (e.InnerException is ViewStateException)
                    {
                        HttpContext.Current.ApplicationInstance.Response.Redirect(HttpContext.Current.ApplicationInstance.Request.Url.AbsoluteUri);
                        return new object();
                    }
                }
            }

            if (hdnViewStateKey != null &amp;&amp; !IsCrossPagePostBack)
            {
                string key = Request.Form[hdnViewStateKey.UniqueID];
                bool Webfarm = (WebConfigurationManager.AppSettings[&quot;CentralizedWebfarm&quot;] != null &amp;&amp;
                                WebConfigurationManager.AppSettings[&quot;CentralizedWebfarm&quot;].ToBoolean2());
                if (key != null &amp;&amp; Cache[key] != null &amp;&amp; !Webfarm)
                {
                    return Cache[key]; // viewstate is available in cache/memory
                }
                else if (key != null)
                {
                    if (Webfarm)
                    {
                        return Session[key];
                    }
                    else
                    {
                        // Load from DB , Deserialise and return
                        //object vState = LoadViewStateFromDB(key);

                        // Note: If Redis enabled, then only read from Redis. Else load from persistence medium.
                        if (CacheBroker.IsEnabled())
                        {
                            object vState = CacheBroker.Get(key, regionName: AMP3ApplicationSettings.Instance.RedisRegionName);
                            return vState == null ? null : new LosFormatter().Deserialize(vState.ToString());
                        }
                    }
                }
            }
            //return base.LoadPageStateFromPersistenceMedium();
            try
            {
                return base.LoadPageStateFromPersistenceMedium();
            }
            catch (Exception ex)
            {
                if (ex is HttpException &amp;&amp; ex.InnerException is ViewStateException)
                {
                    HttpContext.Current.ApplicationInstance.Response.Redirect(HttpContext.Current.ApplicationInstance.Request.Url.AbsoluteUri);
                    return new object();
                }
                else
                {
                    return base.LoadPageStateFromPersistenceMedium();
                }
            }
        }

        private object LoadViewStateFromDB(string key)
        {
            try
            {
                return ComponentHelper.Instance.ExecuteScalarOn(ConnectionHelper.GetConnectionString(&quot;&quot;),
                    &quot;select Value from APPMGMTPersistedData where ID={0}&quot;, key);
            }
            catch (Exception)
            {
                return null;
            }
        }

        #endregion VIEWSTATE PERSISTENCE ON SERVER

        public void UpdateWebFarmData(string key)
        {
            if (WebConfigurationManager.AppSettings[&quot;CentralizedWebfarm&quot;] != null &amp;&amp;
                WebConfigurationManager.AppSettings[&quot;CentralizedWebfarm&quot;].ToBoolean2())
                new WebFarmData().Update(key);
        }

        public bool HasPermission(string moduleId, string feature)
        {
            if (feature.Contains(&quot;,&quot;))
            {
                string[] SplitFeature = feature.Split(&#39;,&#39;);
                feature = SplitFeature[0];
            }
            return
                //ModuleManager.Instance.GetPermissionByUserOrRole(moduleId, UserDetail.GetCurrentUserDetail().UID,
                //    UserDetail.GetCurrentUserDetail().RID,
                //    (string.IsNullOrEmpty(Request.QueryString[&quot;PID&quot;]) ? 0 : Request.QueryString[&quot;PID&quot;].ToInt32_2())).
                //    ConvertAll(x =&gt; x.ToLower2()).Contains(feature.ToLower2());
                ModulePermissions.Contains(feature.ToLower2());
        }

        /// &lt;summary&gt;
        /// Add workflow History and Status butons to workflow menugroup.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;tb&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;menus&quot;&gt;&lt;/param&gt;
        protected void AddWFHistoryStatusButtons(ToolBar tb, MenuArray menus)
        {
            if (null == MainToolBar) return;
            if (null == tb) tb = MainToolBar;
            MenuGroup mGroup = tb.Groups.Find(mg =&gt; mg.Title == &quot;Workflow&quot;);
            if (null == mGroup)
            {
                mGroup = new MenuGroup();
                mGroup.Title = &quot;Workflow&quot;;
                tb.Groups.Add(mGroup);
            }
            ;
            mGroup.AddMenu(new LargeButton(&quot;lnkWorkFlowHistory&quot;, &quot;History&quot;, &quot;Icn_History.png&quot;));
            mGroup.AddMenu(new LargeButton(&quot;lnkWorkFlowStatus&quot;, &quot;Status&quot;, &quot;Progress.png&quot;));

            MainToolBar.Bind();
        }

        private void ShowNotificationMessage(NotificationMessage message)
        {
            Notifier.Notifications.Add(message);
        }

        private void ShowNotificationMessage(string message)
        {
            Notifier.Notifications.Add(new NotificationMessage(message));
        }

        private void ShowNotificationMessage(string message, string title)
        {
            Notifier.Notifications.Add(new NotificationMessage(message, title));
        }

        [Obsolete(&quot;Please use ShowSuccess() OR ShowError() OR ShowWarning() OR ShowInfo() instead of this method. This method will be made private in future.&quot;, false)]
        public void ShowNotificationMessage(string message, NotificationType type)
        {
            Notifier.Notifications.Add(new NotificationMessage(message, type));
        }

        private void ShowNotificationMessage(string message, string title, NotificationType type)
        {
            Notifier.Notifications.Add(new NotificationMessage(message, title, type));
        }

        protected void ShowSuccess(string message)
        {
            ShowNotificationMessage(message, NotificationType.Success);
        }

        protected void ShowWarning(string message)
        {
            ShowNotificationMessage(message, NotificationType.Warning);
        }

        protected void ShowError(string message)
        {
            ShowNotificationMessage(message, NotificationType.Error);
        }

        protected void ShowInfo(string message)
        {
            ShowNotificationMessage(message, NotificationType.Info);
        }

        public void RegisterStartupScript(string script, System.Web.UI.Control registerForControl = null, string key = &quot;&quot;, string targetKey = &quot;&quot;, bool afterTarget = false)
        {
            key = string.IsNullOrEmpty(key) ? Guid.NewGuid().ToString() : key;
            if (!string.IsNullOrEmpty(targetKey))
            {
                if (afterTarget)
                    ScriptHelper.AddStartUpScriptAfterTarget(registerForControl, key, script, targetKey);
                else
                    ScriptHelper.AddStartUpScriptBeforeTarget(registerForControl, key, script, targetKey);
                return;
            }
            ScriptHelper.AddStartUpScript(registerForControl, key, script);
        }

        public void RegisterClientScriptBlock(string script, System.Web.UI.Control registerForControl = null, string key = &quot;&quot;, string targetKey = &quot;&quot;, bool afterTarget = false)
        {
            key = string.IsNullOrEmpty(key) ? Guid.NewGuid().ToString() : key;
            if (!string.IsNullOrEmpty(targetKey))
            {
                if (afterTarget)
                    ScriptHelper.AddScriptAfterTarget(registerForControl, key, script, targetKey);
                else
                    ScriptHelper.AddScriptBeforeTarget(registerForControl, key, script, targetKey);
                return;
            }
            ScriptHelper.AddScript(registerForControl, key, script);
        }

        public void RegisterClientScriptInclude(string script, System.Web.UI.Control registerForControl = null, string key = &quot;&quot;, string targetKey = &quot;&quot;, bool afterTarget = false)
        {
            key = string.IsNullOrEmpty(key) ? Guid.NewGuid().ToString() : key;
            if (!string.IsNullOrEmpty(targetKey))
            {
                if (afterTarget)
                    ScriptHelper.AddScriptFileAfterTarget(registerForControl, key, script, targetKey);
                else
                    ScriptHelper.AddScriptFileBeforeTarget(registerForControl, key, script, targetKey);
                return;
            }
            ScriptHelper.AddScriptFile(registerForControl, key, script);
        }

        public void RegisterStyle(string styleFile)
        {
            ScriptHelper.AddStyleFile(Guid.NewGuid().ToString(), styleFile);
        }

        /// &lt;summary&gt;
        /// Initialize wf buttons javascripts.
        /// &lt;/summary&gt;
        protected virtual void SetJcriptDetailsForMenuButtons()
        {
            string sStatus = string.Empty;
            string fileID = string.Empty;
            string wfInstanceGUID = string.Empty;
            if (this.ModuleId != &quot;ENTPRSE&quot;)
            {
                master = this.Master;
                if (master != null)
                {
                    if (this.Master.MasterPageFile == null)
                        master = this.Master;
                    else if (this.Master.MasterPageFile != null || this.Master.MasterPageFile == &quot;/InSiteCore.Master&quot;)
                        master = this.Master.Master;
                    else master = null;
                }
                if (master != null)
                {
                    ModalPopupExtender PopupExtender = (ModalPopupExtender)master.FindControl(&quot;PopupExtender&quot;);

                    if (_FormInfo != null &amp;&amp; IsWorkflowAssociated(_FormInfo.FormName))
                    {
                        if (!string.IsNullOrEmpty(Request.QueryString[&quot;Mode&quot;]) &amp;&amp; Request.QueryString[&quot;Mode&quot;] == &quot;Edit&quot;)
                        {
                            if (MainToolBar.GetMenuReference(&quot;lnkWorkFlowStatus&quot;) != null)
                                MainToolBar.GetMenuReference(&quot;lnkWorkFlowStatus&quot;).AddAttribute(&quot;href&quot;, &quot;#&quot;);
                        }

                        DataTable dt = BrixWorkflowManager.Instance.GetWorkflowMappingDetails(_FormInfo.FormInstanceId,
                            _FormInfo.FormName);
                        if (dt != null &amp;&amp; dt.Rows.Count &gt; 0)
                        {
                            sStatus = dt.Rows[0][&quot;CurrentStatus&quot;].ToString();
                            fileID = dt.Rows[0][&quot;FileID&quot;].ToString();
                            wfInstanceGUID = dt.Rows[0][&quot;WorkflowInstanceGuid&quot;].ToString();
                        }

                        if (MainToolBar.GetMenuReference(&quot;lnkWorkFlowStatus&quot;) != null)
                            MainToolBar.GetMenuReference(&quot;lnkWorkFlowStatus&quot;).OnClientClick =
                                string.Format(
                                    &quot;LoadWorkflowStatusForForm(&#39;{0}&#39;, &#39;{1}&#39;); return false;&quot;,
                                    wfInstanceGUID, // 0  instanceID
                                    _FormInfo.FormName);

                        if (MainToolBar.GetMenuReference(&quot;lnkWorkFlowHistory&quot;) != null)
                        {
                            ApprovalHistory approvalHistory = (ApprovalHistory)master.FindControl(&quot;appWorkflowHistory&quot;);
                            approvalHistory.Visible = true;
                            Button btnWFHistory = (Button)master.FindControl(&quot;btnWFHistory&quot;);

                            approvalHistory.SetInstanceID(wfInstanceGUID, _FormInfo.FormName);
                            PopupExtender.AddNewPopup(approvalHistory.aspPnlWF.ClientID, btnWFHistory.ClientID,
                                approvalHistory.btnCncl.ClientID, 450, 600, &quot;WorkFlow History&quot;);
                            approvalHistory.btnCncl.Attributes.Add(&quot;onclick&quot;,
                                string.Format(&quot;$(&#39;#{0}&#39;).dialog(&#39;close&#39;); return false;&quot;, approvalHistory.aspPnlWF.ClientID));

                            if (MainToolBar.GetMenuReference(&quot;lnkWorkFlowHistory&quot;) != null)
                                MainToolBar.GetMenuReference(&quot;lnkWorkFlowHistory&quot;).OnClientClick =
                                    string.Format(&quot;LoadWorkfowHistory(); ShowWFPopup(&#39;{0}&#39;); return false;&quot;,
                                        btnWFHistory.ClientID);
                        }
                    }
                }
            }
        }
    }

    public class WorkflowEnabledForm : IWorkflowEnabled
    {
        public event SaveHandler SaveForm;

        public event CancelHandler CancelSave;

        public event PostSaveRedirectUrl GetRedirectUrlAfterSave;

        public bool IsOldWorkflow { get; set; }
        public string FormInstanceId { get; set; }
        public string FormName { get; set; }
        public string FormKey { get; set; }
        public string ClientValidationFunction { get; set; }
        public int ParentModuleId { get; set; }
        public int PID { get; set; }
        public string PostCancelRedirectUrl { get; set; }

        public virtual bool SaveHandler(object sender, out string sSavedInstanceToken, out string sErrors,
            out string sRedirectTo)
        {
            sSavedInstanceToken = &quot;&quot;;
            sErrors = &quot;&quot;;
            sRedirectTo = &quot;&quot;;
            if (null != SaveForm) return SaveForm(this, out sSavedInstanceToken, out sErrors, out sRedirectTo);
            return false;
        }

        public virtual void CancelHandler(object sender, bool bAfterSave, out string sRedirectTo)
        {
            sRedirectTo = &quot;&quot;;
            if (null != CancelSave) CancelSave(sender, bAfterSave, out sRedirectTo);
        }

        public virtual string PostSaveRedirectUrl(string sSavedToken = &quot;&quot;)
        {
            if (null != GetRedirectUrlAfterSave) return GetRedirectUrlAfterSave(sSavedToken);
            return &quot;&quot;;
        }
    }

    public delegate bool SaveHandler(
        object sender, out string sSavedInstanceToken, out string sErrors, out string sRedirectTo);

    public delegate void CancelHandler(object sender, bool bAfterSave, out string sRedirectTo);

    public delegate string PostSaveRedirectUrl(string sSavedToken = &quot;&quot;);

    [Serializable]
    public class WebFarmData
    {
        private bool isWebfarm = (WebConfigurationManager.AppSettings[&quot;CentralizedWebfarm&quot;] != null &amp;&amp;
                          WebConfigurationManager.AppSettings[&quot;CentralizedWebfarm&quot;].ToBoolean2());

        private StoredProcedure sp = new StoredProcedure()
        {
            Name = &quot;usp_APPMGMTCUDGWebFarmData&quot;,
            Input = &quot;ServerName,Key,UpdatedMode&quot;
        };

        public bool Add(string key)
        {
            if (isWebfarm)
            {
                string serverName = System.Environment.MachineName;
                DataTable dt = ComponentHelper.Instance.ExecuteDataSet(sp, null, serverName, key, &quot;I&quot;).Tables[0];
            }
            return true;
        }

        public bool Check(Page page)
        {
            string serverName = System.Environment.MachineName;
            DataTable dt = ComponentHelper.Instance.ExecuteDataSet(sp, null, serverName, &quot;&quot;, &quot;G&quot;).Tables[0];
            foreach (DataRow row in dt.Rows)
            {
                int val = Convert.ToInt32(row[&quot;Value&quot;]);
                if (val == 0)
                {
                    string key = row[&quot;Key&quot;].ToString();
                    switch (key)
                    {
                        case &quot;AppSettings&quot;:
                            AMP3ApplicationSettings.Instance.Reload();
                            break;

                        case &quot;CacheOfRoles&quot;:
                            UserManager.Instance.ClearCachedRoles();
                            break;
                        //case &quot;WorkflowRuntimeStarted&quot;:
                        //    BrixCoreDataProvider bdp = new BrixCoreDataProvider();
                        //    WFRuntimeHandler wh = (WFRuntimeHandler)bdp.GetRunningWFManager();
                        //    wh = null;
                        //    BrixWorkflowManager.Instance.RefreshRuntime();
                        //    break;
                        case &quot;ReCompileExpression&quot;:
                            Aurigo.Brix.Evaluator.Evaluator.Inst.ScheduleForReBuildOnNextEval();
                            break;
                    }
                    Add(key);
                }
            }
            return true;
        }

        public bool Remove(string key)
        {
            string serverName = System.Environment.MachineName;
            DataTable dt = ComponentHelper.Instance.ExecuteDataSet(sp, null, serverName, key, &quot;R&quot;).Tables[0];
            return true;
        }

        internal void Update(string key)
        {
            string serverName = System.Environment.MachineName;
            ComponentHelper.Instance.ExecuteDataSet(sp, null, serverName, key, &quot;U&quot;);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[87,9,87,51,1],[95,9,95,40,1],[96,35,96,39,1],[96,40,96,44,1],[97,40,97,44,1],[97,45,97,49,1],[98,51,98,55,0],[98,56,98,60,0],[99,48,99,52,1],[99,53,99,57,1],[100,55,100,59,1],[100,60,100,64,1],[101,9,101,45,1],[103,9,103,49,1],[105,34,105,38,1],[105,39,105,43,1],[107,58,107,62,1],[107,63,107,67,1],[109,9,109,40,1],[116,9,116,69,1],[121,13,121,14,1],[122,17,122,38,1],[123,13,123,14,1],[129,13,129,14,1],[130,17,130,52,1],[131,21,131,59,0],[133,17,133,58,1],[134,13,134,14,1],[136,13,136,14,1],[137,17,137,48,1],[138,13,138,14,1],[141,9,141,30,1],[142,9,142,10,1],[143,13,143,63,1],[144,9,144,10,1],[149,13,149,14,1],[150,17,150,40,1],[151,17,151,42,1],[152,13,152,14,1],[158,13,158,14,0],[159,17,161,102,0],[162,17,162,39,0],[163,13,163,14,0],[166,52,166,56,1],[166,57,166,61,0],[166,66,166,70,1],[171,13,171,14,1],[172,17,172,60,1],[172,61,172,74,1],[174,21,174,85,1],[175,13,175,14,1],[177,13,177,14,1],[178,17,178,56,1],[179,17,179,48,1],[180,13,180,14,1],[186,13,186,14,0],[187,17,187,44,0],[188,13,188,14,0],[190,13,190,14,0],[191,17,191,45,0],[192,13,192,14,0],[198,13,198,14,1],[199,17,199,112,1],[200,13,200,14,1],[202,13,202,14,1],[203,17,203,62,1],[204,17,204,34,1],[204,35,204,69,0],[205,22,205,48,1],[205,49,205,89,1],[206,13,206,14,1],[212,13,212,14,1],[213,17,213,36,1],[213,37,213,48,1],[214,17,214,64,1],[215,13,215,14,1],[221,13,221,14,1],[222,17,222,37,1],[222,38,222,49,0],[223,17,223,66,1],[224,13,224,14,1],[230,13,230,14,1],[231,17,231,37,1],[231,38,231,49,1],[232,17,232,66,1],[233,13,233,14,1],[239,13,239,14,0],[240,17,240,37,0],[240,38,240,49,0],[241,17,241,66,0],[242,13,242,14,0],[247,17,247,18,1],[247,19,247,84,1],[247,85,247,86,1],[251,9,251,10,1],[252,13,252,84,1],[253,9,253,10,1],[256,9,256,10,1],[257,13,257,28,1],[258,13,258,14,1],[259,17,259,42,1],[260,17,260,30,1],[262,13,262,76,1],[263,13,263,37,1],[264,13,264,25,1],[265,9,265,10,1],[268,9,268,10,1],[269,13,269,28,1],[270,13,270,14,1],[271,17,271,42,1],[272,17,272,30,1],[274,13,274,86,1],[275,13,275,36,1],[276,13,276,37,1],[277,13,277,25,1],[278,9,278,10,1],[283,13,283,14,1],[284,17,284,182,1],[285,21,285,33,1],[286,17,286,30,0],[287,13,287,14,1],[290,9,290,57,1],[295,13,295,14,1],[296,17,296,48,1],[297,17,297,18,1],[298,21,298,127,1],[299,21,299,71,1],[300,21,300,133,1],[301,17,301,18,1],[302,17,302,43,1],[303,13,303,14,1],[309,13,309,14,1],[310,17,310,47,1],[310,48,310,79,1],[312,17,312,50,1],[313,17,313,49,1],[314,17,314,18,1],[315,21,315,46,1],[316,21,316,33,1],[319,17,319,67,1],[320,21,320,56,1],[321,17,321,38,1],[321,39,321,60,1],[322,17,322,77,1],[323,17,323,34,1],[323,35,323,48,0],[325,17,325,111,1],[326,17,326,18,1],[328,21,328,43,1],[330,21,330,22,1],[335,25,335,41,1],[336,21,336,22,1],[337,21,337,26,0],[338,21,338,22,0],[339,21,339,22,0],[340,21,340,50,1],[341,21,341,37,1],[344,17,344,80,1],[345,17,345,55,1],[346,17,346,18,1],[348,21,348,46,1],[349,21,349,33,1],[352,17,352,42,1],[353,17,354,40,1],[355,17,355,64,1],[356,17,356,39,1],[357,26,357,35,1],[357,37,357,54,1],[357,56,357,59,1],[358,21,358,22,1],[359,25,361,78,1],[362,25,362,41,1],[362,42,362,51,1],[363,25,365,79,1],[366,25,366,43,1],[366,44,366,53,0],[367,25,367,54,1],[368,21,368,22,1],[369,17,369,46,1],[369,47,369,98,1],[370,17,370,45,1],[371,17,371,77,1],[372,17,372,83,1],[374,17,374,123,1],[376,17,377,67,1],[382,17,383,99,1],[384,17,384,18,0],[385,21,385,116,0],[386,21,386,22,0],[387,25,387,50,0],[388,25,388,37,0],[390,17,390,18,0],[392,17,392,24,1],[392,26,392,48,1],[392,49,392,51,1],[392,52,392,64,1],[393,17,393,18,1],[394,21,394,98,1],[395,21,395,66,1],[396,21,396,22,1],[397,25,397,47,1],[399,25,399,101,1],[401,25,403,51,1],[404,25,404,31,1],[406,17,406,18,0],[407,17,407,84,1],[408,13,408,14,1],[411,13,411,14,0],[412,17,412,43,0],[413,13,413,14,0],[418,17,418,18,1],[418,19,418,117,1],[418,118,418,119,1],[424,9,424,10,0],[425,13,425,35,0],[426,9,426,10,0],[429,9,429,10,0],[430,13,430,83,0],[431,13,431,46,0],[432,13,432,121,0],[433,13,433,34,0],[434,13,434,71,0],[435,13,435,83,0],[436,9,436,10,0],[443,13,443,14,1],[444,17,444,36,1],[445,17,445,18,1],[446,21,446,85,1],[447,25,447,80,1],[448,17,448,18,1],[449,17,449,31,1],[450,13,450,14,1],[456,13,456,14,1],[457,17,457,39,1],[458,17,458,18,1],[459,21,459,85,1],[460,25,460,99,1],[461,26,461,97,0],[462,25,462,106,0],[463,17,463,18,1],[464,17,464,34,1],[465,13,465,14,1],[469,9,469,10,1],[470,13,470,45,1],[471,13,471,29,1],[473,13,474,88,1],[475,17,475,47,1],[480,13,480,89,1],[481,13,481,91,1],[485,13,485,44,1],[486,17,486,57,1],[488,13,488,31,1],[502,9,502,10,1],[505,9,505,10,1],[506,13,506,35,1],[506,36,506,43,1],[507,13,507,41,1],[508,13,508,44,1],[509,13,509,67,1],[510,13,510,48,1],[511,13,511,48,1],[512,9,512,10,1],[515,9,515,10,1],[516,13,516,28,1],[520,13,520,63,1],[521,13,521,28,1],[522,13,522,14,1],[523,17,523,33,1],[524,17,524,43,1],[525,17,525,50,1],[526,17,526,48,1],[527,17,527,57,1],[528,17,528,45,1],[529,17,529,46,1],[530,17,530,78,1],[533,13,533,14,1],[537,13,537,46,1],[538,9,538,10,1],[541,9,541,10,1],[542,13,542,57,1],[544,13,544,41,1],[545,13,545,56,1],[546,9,546,10,1],[549,9,549,10,1],[550,13,550,30,1],[552,13,552,14,1],[554,17,556,78,1],[557,17,559,80,1],[564,17,564,39,1],[564,40,564,47,0],[566,17,566,72,1],[567,17,567,80,1],[569,17,570,97,1],[571,21,571,28,1],[573,17,573,77,1],[574,13,574,14,1],[575,13,575,18,0],[576,13,576,14,0],[577,13,577,14,0],[578,9,578,10,1],[580,9,580,54,1],[583,9,583,10,1],[584,13,584,39,1],[585,13,586,58,1],[587,13,587,20,1],[587,22,587,41,1],[587,42,587,44,1],[587,45,587,70,1],[588,13,588,14,1],[589,17,589,55,1],[590,17,590,42,1],[591,17,591,18,1],[592,21,592,54,1],[593,21,594,105,1],[595,25,595,60,1],[596,17,596,18,1],[597,22,597,46,1],[598,21,598,45,1],[599,13,599,14,1],[600,9,600,10,1],[603,9,603,10,1],[604,13,604,36,1],[605,13,605,14,1],[606,17,606,49,1],[607,17,607,90,1],[608,21,609,113,1],[610,13,610,14,1],[611,13,611,20,1],[611,22,611,34,1],[611,35,611,37,1],[611,38,611,54,1],[612,17,612,43,1],[613,9,613,10,1],[616,9,616,10,1],[617,13,617,43,1],[618,17,618,103,1],[619,9,619,10,1],[622,9,622,10,1],[623,9,623,10,1],[626,9,626,10,1],[627,13,627,116,1],[628,9,628,10,1],[631,9,631,10,1],[637,13,637,119,1],[638,13,638,63,1],[642,13,642,68,1],[643,17,643,30,0],[645,18,645,27,1],[645,29,645,57,1],[645,59,645,62,1],[646,13,646,14,1],[647,17,647,82,1],[648,21,648,34,0],[649,13,649,14,1],[650,13,650,25,1],[651,9,651,10,1],[654,9,654,10,1],[656,13,656,35,1],[657,13,657,14,0],[658,17,658,88,0],[660,9,660,10,1],[663,9,663,10,0],[665,13,666,73,0],[667,9,667,10,0],[670,9,670,10,1],[671,13,671,145,1],[672,17,672,29,1],[674,17,674,30,0],[675,9,675,10,1],[678,9,678,10,1],[679,13,679,34,1],[680,13,680,14,1],[681,17,681,31,1],[681,32,681,47,0],[682,17,682,24,1],[685,13,685,14,1],[686,17,686,57,1],[687,17,687,18,0],[689,21,689,46,0],[690,17,690,18,0],[692,17,692,65,1],[693,17,693,67,1],[694,17,694,75,1],[695,17,695,40,1],[697,17,697,41,1],[698,17,698,41,1],[699,17,699,18,1],[700,21,700,57,1],[701,21,703,33,1],[704,17,704,18,1],[711,17,711,118,1],[712,17,712,18,1],[713,21,713,72,1],[714,17,714,18,1],[717,17,717,86,1],[719,17,719,34,1],[720,17,720,18,0],[726,21,726,78,0],[728,21,728,63,0],[729,17,729,18,0],[731,17,731,41,1],[732,13,732,14,1],[733,13,733,33,0],[734,13,734,14,0],[735,17,735,127,0],[736,13,736,14,0],[738,13,738,14,1],[739,17,739,31,1],[739,32,739,47,1],[740,13,740,14,1],[741,9,741,10,1],[744,9,744,10,0],[746,13,746,93,0],[748,13,748,34,0],[749,17,749,38,0],[750,9,750,10,0],[753,9,753,10,1],[756,13,758,36,1],[761,13,761,41,1],[762,13,762,14,1],[763,17,764,31,1],[766,17,766,47,1],[767,17,767,24,1],[767,26,767,36,0],[767,37,767,39,1],[767,40,767,57,1],[768,17,768,18,0],[769,21,769,117,0],[770,21,770,22,0],[771,25,771,57,0],[772,25,772,114,0],[773,25,773,103,0],[774,29,774,35,0],[775,21,775,22,0],[776,17,776,18,0],[777,13,777,14,1],[779,13,779,14,1],[780,17,780,59,1],[781,21,781,115,1],[783,17,783,54,1],[784,13,784,14,1],[786,13,786,67,1],[787,13,787,14,0],[788,17,788,102,0],[789,17,789,63,0],[790,17,790,32,0],[791,17,791,18,0],[792,21,792,56,0],[793,21,793,62,0],[794,21,794,70,0],[795,17,795,18,0],[797,17,797,76,0],[800,25,800,97,0],[802,25,802,31,0],[805,25,805,97,0],[806,25,806,31,0],[809,25,809,52,0],[810,25,810,31,0],[813,17,815,55,0],[816,17,816,83,0],[817,17,817,40,0],[818,17,818,59,0],[820,17,820,79,0],[840,13,840,14,0],[841,9,841,10,1],[844,9,844,10,1],[845,13,845,72,1],[846,13,846,14,1],[847,17,847,59,1],[848,21,848,107,1],[849,13,849,14,0],[851,13,851,14,0],[852,17,852,77,0],[853,21,854,88,0],[855,13,855,14,0],[856,13,856,25,0],[857,9,857,10,1],[860,9,860,10,1],[861,13,861,70,1],[861,71,861,78,0],[862,13,862,39,1],[863,13,863,14,1],[864,17,864,39,1],[864,40,864,75,1],[865,17,865,103,1],[865,104,865,111,1],[866,13,866,14,1],[868,13,868,46,1],[870,13,870,79,1],[872,13,872,40,1],[873,13,873,53,1],[874,13,874,49,1],[874,50,874,82,1],[875,13,875,55,1],[875,56,875,101,1],[877,13,877,46,1],[879,13,879,89,1],[880,13,880,34,1],[881,13,881,81,1],[883,13,883,90,1],[885,13,886,106,1],[887,9,887,10,1],[890,9,890,10,1],[891,13,891,39,1],[891,40,891,47,1],[892,13,892,69,1],[892,70,892,77,1],[893,13,893,69,1],[893,70,893,100,1],[894,13,894,75,1],[894,76,894,118,1],[896,13,896,48,1],[896,49,896,56,1],[897,13,897,76,1],[897,77,897,84,1],[899,13,899,46,0],[901,13,901,101,0],[902,13,902,43,0],[903,13,903,68,0],[905,13,905,88,0],[907,13,907,104,0],[908,13,909,76,0],[910,13,911,115,0],[913,13,913,48,0],[914,13,914,14,0],[915,17,915,98,0],[916,17,916,62,0],[918,17,918,66,0],[919,17,919,18,0],[920,21,920,83,0],[921,21,921,144,0],[922,17,922,18,0],[923,13,923,14,0],[924,9,924,10,1],[927,9,927,10,1],[928,13,928,31,1],[929,13,929,42,1],[930,13,930,14,1],[931,17,931,39,1],[931,40,931,75,0],[932,17,932,41,1],[933,17,933,18,1],[934,21,934,63,1],[935,21,935,53,1],[936,17,936,18,1],[938,17,938,52,1],[939,17,939,53,1],[940,17,940,82,1],[941,13,941,14,1],[942,9,942,10,1],[945,9,945,10,1],[946,13,946,25,1],[947,9,947,10,1],[950,9,950,10,1],[951,13,951,37,1],[952,13,952,50,1],[953,13,953,14,1],[954,17,956,52,1],[957,17,957,24,1],[959,13,959,44,1],[961,13,961,39,1],[962,13,962,60,1],[963,13,963,14,0],[964,17,966,52,0],[967,17,967,24,0],[969,13,969,24,1],[970,13,970,14,1],[971,17,971,122,1],[972,17,972,24,1],[974,13,976,58,1],[977,13,977,14,1],[978,17,980,52,1],[981,17,981,24,1],[983,13,983,29,1],[983,30,983,37,1],[985,13,985,69,1],[989,13,989,44,1],[990,13,990,14,1],[991,17,991,62,1],[991,63,991,70,0],[992,17,992,49,1],[993,17,993,18,1],[994,21,994,60,1],[995,21,995,101,1],[996,17,996,18,1],[997,17,997,55,1],[998,17,998,38,1],[998,39,998,67,1],[999,13,999,14,1],[1001,13,1001,14,1],[1002,17,1002,48,1],[1003,17,1003,18,1],[1004,21,1007,109,1],[1008,21,1008,100,1],[1009,21,1011,51,1],[1012,21,1012,101,1],[1013,17,1013,18,1],[1014,13,1014,14,1],[1015,13,1015,20,1],[1015,22,1015,31,1],[1015,32,1015,34,1],[1015,35,1015,54,1],[1016,13,1016,14,1],[1017,17,1017,49,1],[1018,13,1018,14,1],[1019,13,1019,42,1],[1019,43,1019,64,0],[1020,9,1020,10,1],[1023,9,1023,10,1],[1024,13,1024,45,1],[1024,46,1024,53,1],[1025,13,1025,44,1],[1026,13,1026,64,1],[1026,65,1026,72,1],[1028,13,1028,158,1],[1029,13,1029,14,1],[1030,17,1030,63,1],[1030,64,1030,71,1],[1031,17,1035,80,1],[1036,17,1036,49,1],[1037,17,1037,18,1],[1038,21,1038,60,1],[1039,21,1039,101,1],[1040,17,1040,18,1],[1041,17,1041,65,1],[1042,17,1042,18,1],[1043,21,1043,76,1],[1044,17,1044,18,1],[1045,17,1045,78,1],[1046,17,1046,24,1],[1046,26,1046,36,1],[1046,37,1046,39,1],[1046,40,1046,45,1],[1047,17,1047,18,1],[1049,21,1049,83,1],[1049,84,1049,112,1],[1050,17,1050,18,1],[1052,17,1052,60,1],[1053,17,1053,24,1],[1053,26,1053,36,1],[1053,37,1053,39,1],[1053,40,1053,46,1],[1054,17,1054,18,1],[1056,21,1056,83,1],[1057,25,1057,69,1],[1058,17,1058,18,1],[1059,13,1059,14,1],[1060,9,1060,10,1],[1063,9,1063,10,1],[1064,13,1065,71,1],[1066,13,1067,71,1],[1068,13,1070,38,1],[1071,13,1072,71,1],[1073,9,1073,10,1],[1076,9,1076,10,1],[1077,13,1077,47,1],[1077,48,1077,55,0],[1078,13,1078,43,1],[1078,44,1078,67,0],[1079,13,1079,63,1],[1080,13,1080,14,1],[1082,17,1082,18,1],[1083,21,1083,63,1],[1084,21,1084,22,1],[1085,25,1085,92,1],[1086,25,1086,61,1],[1087,25,1087,108,1],[1088,25,1088,54,1],[1089,25,1089,48,1],[1090,25,1090,72,1],[1091,25,1091,47,1],[1095,33,1095,71,1],[1096,33,1096,39,1],[1099,33,1099,69,1],[1100,33,1100,39,1],[1103,33,1103,52,1],[1104,33,1104,67,1],[1105,37,1105,75,0],[1106,33,1106,65,1],[1107,37,1107,73,1],[1108,33,1108,39,1],[1110,25,1110,51,1],[1111,25,1111,26,1],[1112,29,1112,36,1],[1112,38,1112,55,1],[1112,56,1112,58,1],[1112,59,1112,64,1],[1113,29,1113,30,1],[1114,33,1114,49,1],[1115,33,1115,34,0],[1116,37,1116,90,0],[1117,33,1117,34,0],[1118,33,1118,57,1],[1119,29,1119,30,1],[1121,29,1121,49,1],[1123,29,1123,77,1],[1124,29,1124,30,1],[1125,33,1125,102,1],[1126,33,1126,50,1],[1127,29,1127,30,1],[1128,25,1128,26,1],[1129,21,1129,22,1],[1131,21,1131,83,1],[1132,21,1132,22,1],[1133,25,1133,156,1],[1134,21,1134,22,1],[1135,21,1135,85,1],[1136,21,1136,22,1],[1138,25,1138,116,1],[1140,21,1140,22,1],[1141,17,1141,18,1],[1142,17,1142,37,0],[1143,17,1143,18,0],[1144,17,1144,18,0],[1145,13,1145,14,1],[1148,13,1148,80,1],[1149,13,1149,14,1],[1152,17,1152,50,1],[1153,13,1153,14,1],[1155,13,1155,37,1],[1157,13,1157,40,1],[1158,13,1158,50,1],[1160,13,1160,41,1],[1161,9,1161,10,1],[1169,9,1169,10,1],[1170,13,1170,45,1],[1170,46,1170,53,1],[1171,13,1171,29,1],[1171,30,1171,37,1],[1172,13,1172,35,1],[1172,36,1172,71,1],[1173,13,1173,102,1],[1173,103,1173,110,1],[1174,13,1174,59,1],[1174,60,1174,67,1],[1175,13,1175,43,1],[1175,44,1175,51,1],[1176,13,1176,43,1],[1176,44,1176,51,0],[1177,13,1177,45,1],[1177,46,1177,82,1],[1178,13,1178,45,1],[1178,46,1178,53,0],[1179,18,1179,27,1],[1179,29,1179,58,1],[1179,60,1179,63,1],[1180,13,1180,14,1],[1181,17,1181,77,1],[1182,17,1182,46,1],[1183,17,1183,40,1],[1184,17,1184,56,1],[1185,17,1185,49,1],[1186,17,1187,86,1],[1188,17,1188,46,1],[1188,47,1188,83,1],[1190,17,1190,18,0],[1191,21,1191,57,0],[1192,17,1192,18,0],[1193,17,1193,73,1],[1194,21,1194,118,1],[1195,17,1195,60,1],[1196,17,1196,18,1],[1197,21,1197,76,1],[1198,17,1198,18,1],[1199,17,1199,37,1],[1199,38,1199,47,0],[1200,17,1200,122,1],[1201,17,1201,34,1],[1202,21,1203,143,0],[1205,17,1205,50,1],[1206,17,1208,59,1],[1209,17,1209,46,1],[1209,47,1209,98,1],[1210,17,1210,42,1],[1211,17,1211,18,1],[1212,21,1212,87,1],[1213,21,1215,67,1],[1216,21,1217,71,1],[1219,21,1219,28,1],[1219,30,1219,52,1],[1219,53,1219,55,1],[1219,56,1219,68,1],[1220,21,1220,22,1],[1221,25,1221,67,1],[1221,68,1221,77,0],[1222,25,1222,102,1],[1223,25,1223,70,1],[1224,25,1224,26,1],[1225,29,1225,56,1],[1228,29,1228,93,1],[1230,29,1232,66,1],[1233,29,1233,35,1],[1235,21,1235,22,0],[1236,17,1236,18,1],[1237,17,1237,42,1],[1237,43,1237,52,0],[1239,17,1239,78,1],[1240,17,1240,18,1],[1241,21,1241,39,1],[1242,25,1243,215,1],[1244,17,1244,18,1],[1245,17,1245,24,1],[1245,26,1245,40,1],[1245,41,1245,43,1],[1245,44,1245,51,1],[1246,17,1246,18,1],[1247,21,1247,46,1],[1248,21,1248,22,1],[1249,25,1249,69,1],[1250,25,1251,203,1],[1252,21,1252,22,1],[1254,21,1254,22,0],[1255,25,1256,55,0],[1257,21,1257,22,0],[1258,17,1258,18,1],[1259,13,1259,14,1],[1260,9,1260,10,1],[1268,9,1268,10,0],[1269,13,1269,37,0],[1269,38,1269,45,0],[1270,13,1270,28,0],[1270,29,1270,46,0],[1271,13,1271,53,0],[1271,53,1271,75,0],[1271,75,1271,77,0],[1271,13,1271,77,0],[1272,13,1272,32,0],[1273,13,1273,14,0],[1274,17,1274,42,0],[1275,17,1275,43,0],[1276,17,1276,39,0],[1277,13,1277,14,0],[1278,13,1278,14,0],[1279,13,1279,97,0],[1280,13,1280,92,0],[1282,9,1282,10,0],[1290,9,1290,10,1],[1441,9,1441,10,1],[1445,17,1445,18,1],[1445,19,1445,48,1],[1445,49,1445,50,1],[1451,9,1451,10,1],[1452,13,1452,37,1],[1452,38,1452,45,0],[1453,13,1453,34,1],[1453,35,1453,42,0],[1454,13,1454,28,1],[1454,29,1454,46,1],[1455,13,1455,62,1],[1456,13,1456,104,1],[1457,13,1457,35,1],[1458,13,1458,42,1],[1459,13,1459,28,1],[1459,29,1459,65,1],[1460,18,1460,36,0],[1460,37,1460,52,0],[1461,18,1461,54,0],[1463,13,1465,78,1],[1467,13,1469,98,1],[1470,9,1470,10,1],[1474,9,1474,10,1],[1475,13,1475,37,1],[1475,38,1475,45,0],[1476,13,1476,28,1],[1476,29,1476,46,1],[1483,13,1483,58,1],[1486,13,1486,81,1],[1487,13,1487,55,1],[1488,13,1488,66,1],[1488,66,1488,91,0],[1488,91,1488,93,1],[1488,13,1488,93,1],[1490,13,1490,30,1],[1491,13,1491,14,1],[1492,17,1492,44,1],[1494,17,1494,45,1],[1495,17,1495,24,1],[1495,26,1495,38,1],[1495,39,1495,41,1],[1495,42,1495,51,1],[1496,17,1496,18,1],[1497,21,1497,48,1],[1498,21,1498,60,1],[1499,21,1501,133,1],[1502,21,1505,40,1],[1506,17,1506,18,1],[1507,13,1507,14,1],[1509,13,1509,14,0],[1512,17,1512,39,0],[1513,17,1513,24,0],[1513,26,1513,38,0],[1513,39,1513,41,0],[1513,42,1513,51,0],[1514,17,1514,18,0],[1515,21,1515,42,0],[1516,21,1516,60,0],[1517,21,1519,133,0],[1520,21,1523,40,0],[1524,17,1524,18,0],[1525,13,1525,14,0],[1527,13,1527,74,1],[1529,9,1529,10,1],[1532,9,1532,10,1],[1533,13,1533,121,1],[1535,13,1535,35,1],[1535,36,1535,71,0],[1536,13,1536,30,1],[1537,17,1537,51,1],[1539,17,1539,52,1],[1540,9,1540,10,1],[1543,9,1543,10,1],[1544,13,1544,35,1],[1546,13,1546,14,1],[1547,17,1547,47,1],[1548,17,1548,47,1],[1548,48,1548,55,0],[1550,17,1550,73,1],[1551,17,1551,75,1],[1554,17,1554,37,1],[1555,17,1555,59,1],[1557,17,1557,18,1],[1558,21,1558,57,1],[1558,57,1558,70,1],[1558,70,1558,85,1],[1558,85,1558,86,1],[1558,86,1558,98,1],[1558,21,1558,98,1],[1559,21,1559,57,1],[1560,17,1560,18,1],[1561,17,1561,22,0],[1562,17,1562,18,0],[1563,21,1563,58,0],[1564,17,1564,18,0],[1566,17,1566,37,1],[1568,17,1568,51,1],[1569,21,1569,42,0],[1571,21,1571,46,1],[1571,46,1571,58,1],[1571,58,1571,70,1],[1571,21,1571,70,1],[1581,17,1581,69,1],[1583,17,1583,53,1],[1584,17,1584,18,1],[1585,21,1585,28,1],[1585,30,1585,39,1],[1585,40,1585,42,1],[1585,43,1585,46,1],[1586,21,1586,22,1],[1587,25,1587,48,1],[1588,25,1588,57,1],[1589,25,1589,76,1],[1590,25,1590,78,1],[1592,25,1593,49,1],[1594,25,1594,86,1],[1595,25,1597,75,1],[1598,25,1598,65,1],[1598,66,1598,75,0],[1599,25,1599,63,1],[1600,25,1600,54,1],[1601,25,1601,48,1],[1602,25,1602,72,1],[1603,25,1603,57,1],[1604,25,1605,74,1],[1606,25,1606,106,1],[1608,25,1608,32,1],[1608,34,1608,48,1],[1608,49,1608,51,1],[1608,52,1608,59,1],[1609,25,1609,26,1],[1610,29,1610,86,1],[1611,29,1611,30,1],[1612,33,1612,89,1],[1613,33,1613,39,1],[1615,25,1615,26,1],[1616,25,1616,62,1],[1617,25,1617,61,1],[1618,25,1618,26,1],[1619,29,1619,49,1],[1621,29,1622,64,1],[1624,29,1624,94,1],[1626,29,1627,64,1],[1629,29,1630,113,1],[1631,29,1631,65,1],[1632,33,1632,100,1],[1633,25,1633,26,1],[1634,21,1634,22,1],[1635,17,1635,18,1],[1636,17,1636,113,1],[1637,17,1637,42,1],[1639,17,1639,129,1],[1640,17,1640,48,1],[1642,17,1642,116,1],[1643,17,1643,34,1],[1644,17,1645,52,1],[1647,17,1647,70,1],[1649,17,1649,109,1],[1650,17,1650,56,1],[1650,57,1650,114,0],[1652,17,1652,53,1],[1652,54,1652,61,1],[1655,17,1655,38,1],[1656,13,1656,14,1],[1657,13,1657,18,0],[1658,13,1658,14,0],[1659,17,1660,52,0],[1661,17,1661,53,0],[1661,54,1661,61,0],[1663,17,1663,70,0],[1664,17,1664,52,0],[1665,13,1665,14,0],[1666,9,1666,10,1],[1669,9,1669,10,0],[1670,9,1670,10,0],[1673,9,1673,10,0],[1674,13,1674,25,0],[1675,9,1675,10,0],[1678,9,1678,10,0],[1679,13,1679,33,0],[1680,9,1680,10,0],[1683,9,1683,10,1],[1684,13,1684,33,1],[1685,9,1685,10,1],[1688,9,1688,10,1],[1689,13,1689,69,1],[1690,13,1690,71,1],[1691,13,1693,61,1],[1694,13,1694,94,1],[1696,13,1696,35,1],[1697,13,1697,33,1],[1698,13,1698,37,1],[1699,13,1699,45,1],[1701,13,1701,14,1],[1702,17,1702,51,1],[1703,21,1703,112,1],[1705,21,1705,37,0],[1706,13,1706,14,1],[1707,13,1707,33,0],[1708,13,1708,14,0],[1710,17,1710,62,0],[1711,17,1711,18,0],[1712,21,1712,153,0],[1713,21,1713,49,0],[1714,17,1714,18,0],[1715,22,1715,55,0],[1716,17,1716,18,0],[1717,21,1717,44,0],[1718,17,1718,18,0],[1720,17,1720,18,0],[1721,21,1721,42,0],[1722,17,1722,18,0],[1723,13,1723,14,0],[1724,13,1724,119,1],[1725,13,1725,27,1],[1726,13,1726,14,1],[1727,17,1728,52,1],[1729,17,1729,52,1],[1730,17,1730,18,0],[1731,21,1731,40,0],[1732,17,1732,18,0],[1733,17,1733,42,1],[1734,17,1734,24,1],[1736,13,1736,118,1],[1738,13,1738,58,1],[1740,17,1740,18,0],[1741,21,1741,75,0],[1742,21,1742,106,0],[1743,21,1743,94,0],[1744,21,1744,50,0],[1745,21,1745,78,0],[1746,17,1746,18,0],[1747,17,1747,34,0],[1748,17,1748,18,0],[1749,17,1749,18,0],[1751,13,1751,75,1],[1752,17,1752,73,0],[1754,13,1754,49,1],[1755,13,1755,44,1],[1756,13,1756,40,1],[1758,13,1758,66,1],[1759,13,1759,121,1],[1760,13,1760,90,1],[1762,13,1763,97,1],[1764,13,1765,48,1],[1767,13,1767,38,1],[1769,13,1769,102,1],[1771,13,1771,33,1],[1772,13,1772,23,1],[1773,17,1773,61,1],[1775,13,1775,100,1],[1776,13,1776,14,0],[1777,17,1777,70,0],[1778,17,1778,35,0],[1779,17,1779,56,0],[1779,57,1779,82,0],[1780,13,1780,14,0],[1781,18,1781,121,1],[1782,13,1782,14,0],[1783,17,1783,70,0],[1784,17,1784,59,0],[1785,17,1785,68,0],[1786,17,1786,50,0],[1787,13,1787,14,0],[1789,13,1789,14,1],[1790,17,1790,59,1],[1791,17,1791,68,1],[1793,17,1793,50,1],[1794,21,1794,88,0],[1795,17,1795,42,1],[1797,17,1797,129,1],[1798,17,1798,48,1],[1800,17,1800,73,1],[1801,13,1801,14,0],[1802,9,1802,10,1],[1806,9,1806,10,1],[1807,13,1807,66,1],[1808,13,1812,97,1],[1813,13,1813,53,1],[1814,13,1814,45,1],[1815,13,1815,59,1],[1816,13,1816,47,1],[1817,17,1817,31,0],[1820,13,1820,49,1],[1821,13,1821,39,1],[1822,13,1822,14,0],[1824,17,1824,38,0],[1825,13,1825,14,0],[1826,13,1826,47,1],[1827,13,1827,103,1],[1828,13,1828,84,1],[1829,13,1829,14,1],[1830,17,1832,29,1],[1834,17,1834,27,1],[1835,17,1835,18,1],[1836,21,1836,85,1],[1837,21,1837,67,1],[1838,25,1838,90,0],[1839,17,1839,18,1],[1842,21,1846,63,1],[1848,17,1849,47,1],[1850,13,1850,14,1],[1852,13,1852,145,1],[1853,13,1853,14,0],[1854,17,1855,126,0],[1856,17,1856,73,0],[1857,13,1857,14,0],[1859,13,1859,73,1],[1860,13,1860,82,1],[1861,13,1861,73,1],[1862,13,1862,77,1],[1864,13,1864,111,1],[1865,13,1865,105,1],[1867,13,1867,47,1],[1868,13,1868,45,1],[1870,13,1870,93,1],[1871,13,1871,68,1],[1872,13,1872,76,1],[1873,13,1873,53,1],[1874,13,1874,56,1],[1875,13,1875,48,1],[1876,13,1876,33,1],[1876,34,1876,92,0],[1878,13,1883,26,1],[1884,13,1884,74,1],[1884,75,1884,103,0],[1886,13,1886,38,1],[1887,13,1887,27,1],[1888,9,1888,10,1],[1891,9,1891,10,1],[1892,13,1892,44,1],[1892,45,1892,57,1],[1894,13,1894,39,0],[1895,13,1895,60,0],[1895,61,1895,73,0],[1897,13,1897,37,0],[1898,17,1898,64,0],[1900,17,1900,49,0],[1901,9,1901,10,1],[1909,9,1909,10,1],[1910,13,1910,35,1],[1911,13,1911,33,1],[1912,13,1912,37,1],[1913,13,1913,45,1],[1915,13,1915,14,1],[1916,17,1916,38,1],[1916,39,1916,60,1],[1917,17,1917,114,1],[1918,17,1918,67,1],[1919,17,1919,18,0],[1920,21,1920,40,0],[1921,17,1921,18,0],[1922,17,1922,76,1],[1923,17,1923,18,1],[1925,21,1925,46,1],[1926,21,1926,28,1],[1929,17,1932,57,1],[1934,17,1934,42,1],[1936,17,1936,62,1],[1937,17,1937,18,0],[1938,21,1938,58,0],[1939,21,1939,75,0],[1940,21,1940,83,0],[1941,21,1941,106,0],[1942,21,1942,57,0],[1943,25,1943,98,0],[1944,21,1944,50,0],[1945,21,1945,78,0],[1946,17,1946,18,0],[1947,13,1947,14,1],[1948,13,1948,33,1],[1949,13,1949,14,1],[1952,17,1952,62,1],[1953,17,1953,18,0],[1954,21,1954,153,0],[1955,21,1955,49,0],[1956,17,1956,18,0],[1957,22,1957,55,1],[1958,17,1958,18,0],[1959,21,1959,44,0],[1960,17,1960,18,0],[1962,17,1962,18,1],[1963,21,1963,42,1],[1964,17,1964,18,1],[1966,17,1966,34,1],[1967,13,1967,14,1],[1969,13,1969,47,1],[1970,13,1970,14,1],[1971,17,1971,92,1],[1972,17,1972,24,0],[1975,13,1975,61,1],[1976,13,1976,14,1],[1977,17,1977,36,1],[1978,13,1978,14,1],[1979,9,1979,10,1],[1983,9,1983,10,1],[1984,13,1984,34,1],[1984,35,1984,56,0],[1985,13,1985,45,1],[1989,13,1989,43,1],[1992,13,1992,14,1],[1993,17,1993,65,1],[1994,13,1994,14,1],[1995,13,1995,33,0],[1996,13,1996,14,0],[1997,17,1997,119,0],[1998,13,1998,14,0],[2000,13,2000,60,1],[2001,13,2001,14,1],[2002,17,2005,58,1],[2006,17,2006,32,1],[2007,17,2007,28,1],[2010,13,2010,53,1],[2010,54,2010,65,1],[2012,13,2012,63,0],[2013,13,2013,20,0],[2013,22,2013,31,0],[2013,32,2013,34,0],[2013,35,2013,48,0],[2014,13,2014,14,0],[2015,17,2015,46,0],[2015,47,2015,56,0],[2016,17,2019,58,0],[2020,17,2020,32,0],[2021,13,2021,14,0],[2022,13,2022,24,0],[2023,9,2023,10,1],[2026,9,2026,10,0],[2027,13,2027,35,0],[2027,36,2027,81,0],[2028,13,2028,56,0],[2028,57,2028,69,0],[2030,13,2030,58,0],[2030,59,2030,95,0],[2031,13,2031,101,0],[2032,13,2032,33,0],[2033,9,2033,10,0],[2037,9,2037,10,1],[2038,13,2038,35,1],[2038,36,2038,81,1],[2039,13,2039,56,1],[2039,57,2039,69,0],[2040,13,2040,57,1],[2041,13,2041,58,1],[2042,13,2042,14,0],[2043,17,2043,68,0],[2044,17,2044,24,0],[2044,26,2044,40,0],[2044,41,2044,43,0],[2044,44,2044,70,0],[2045,21,2045,41,0],[2046,17,2046,62,0],[2047,17,2047,82,0],[2048,17,2048,54,0],[2049,13,2049,14,0],[2050,13,2051,82,1],[2052,13,2052,28,1],[2053,9,2053,10,1],[2056,9,2056,10,1],[2057,13,2057,78,1],[2057,79,2057,91,1],[2058,13,2058,63,1],[2058,64,2058,99,1],[2059,13,2059,34,1],[2059,35,2059,56,1],[2060,13,2060,105,1],[2061,13,2061,50,1],[2061,51,2061,64,1],[2062,13,2063,53,1],[2064,9,2064,10,1],[2067,9,2067,10,1],[2068,13,2068,25,1],[2069,9,2069,10,1],[2072,9,2072,10,1],[2073,13,2073,49,1],[2073,50,2073,87,0],[2074,13,2074,45,1],[2074,46,2074,59,0],[2075,13,2075,35,1],[2075,36,2075,71,0],[2076,13,2076,34,1],[2076,35,2076,56,1],[2077,13,2079,32,1],[2080,13,2080,50,1],[2081,9,2081,10,1],[2085,9,2085,10,1],[2086,13,2086,37,1],[2086,38,2086,50,0],[2087,13,2087,57,1],[2088,13,2088,100,1],[2089,9,2089,10,1],[2092,9,2092,10,0],[2093,13,2093,37,0],[2093,38,2093,45,0],[2094,13,2094,57,0],[2095,13,2095,85,0],[2096,9,2096,10,0],[2099,9,2099,10,1],[2100,13,2100,45,1],[2100,46,2100,53,1],[2101,13,2101,87,1],[2102,13,2102,52,1],[2102,53,2102,60,1],[2103,13,2103,38,1],[2103,39,2103,46,0],[2105,13,2105,101,1],[2106,13,2106,20,1],[2106,22,2106,29,1],[2106,30,2106,32,1],[2106,33,2106,52,1],[2107,13,2107,14,1],[2109,17,2109,100,1],[2110,17,2110,56,1],[2111,17,2111,46,1],[2112,17,2112,40,1],[2113,17,2113,56,1],[2114,17,2114,49,1],[2116,17,2116,61,1],[2117,17,2117,120,1],[2118,21,2118,68,0],[2120,21,2121,70,1],[2122,17,2122,46,1],[2122,47,2122,63,1],[2125,17,2125,45,1],[2126,17,2126,18,1],[2127,21,2128,71,1],[2129,21,2129,60,1],[2130,17,2130,18,1],[2132,17,2132,24,1],[2132,26,2132,40,1],[2132,41,2132,43,1],[2132,44,2132,51,1],[2133,17,2133,18,1],[2134,21,2134,106,1],[2136,21,2136,37,1],[2137,21,2137,22,1],[2138,25,2139,90,1],[2140,21,2140,22,1],[2141,21,2141,60,1],[2142,17,2142,18,1],[2143,13,2143,14,1],[2144,9,2144,10,1],[2147,9,2147,10,1],[2148,13,2148,45,1],[2148,46,2148,53,0],[2149,13,2149,37,1],[2149,38,2149,45,0],[2151,13,2151,62,1],[2151,62,2151,83,1],[2151,83,2151,85,1],[2151,13,2151,85,1],[2152,13,2152,32,1],[2153,13,2153,14,1],[2154,17,2154,51,1],[2155,17,2155,36,1],[2156,13,2156,14,1],[2157,9,2157,10,1],[2160,9,2160,10,1],[2161,13,2161,29,1],[2161,30,2161,37,1],[2163,13,2163,117,1],[2165,13,2165,33,1],[2166,13,2166,14,1],[2167,17,2167,106,1],[2168,13,2168,14,1],[2169,13,2169,52,1],[2170,13,2170,52,1],[2171,13,2171,14,1],[2172,17,2175,115,1],[2176,17,2176,48,1],[2177,13,2177,14,1],[2178,18,2178,55,0],[2179,13,2179,45,1],[2180,9,2180,10,1],[2183,9,2183,10,0],[2184,13,2184,49,0],[2185,13,2185,47,0],[2186,17,2187,44,0],[2188,18,2188,52,0],[2189,17,2190,44,0],[2192,17,2193,42,0],[2194,9,2194,10,0],[2197,9,2197,10,1],[2198,13,2198,34,1],[2199,17,2199,32,1],[2201,13,2201,14,1],[2202,17,2202,24,1],[2202,26,2202,35,1],[2202,36,2202,38,1],[2202,39,2202,55,1],[2203,17,2203,18,1],[2204,21,2204,54,1],[2205,21,2205,37,1],[2206,25,2206,36,1],[2207,17,2207,18,1],[2208,13,2208,14,1],[2209,13,2209,25,1],[2210,9,2210,10,1],[2213,9,2213,10,0],[2214,13,2214,35,0],[2215,13,2215,14,0],[2216,17,2216,71,0],[2216,72,2216,79,0],[2218,17,2218,18,0],[2219,21,2220,79,0],[2221,21,2221,22,0],[2222,25,2222,52,0],[2223,25,2223,26,0],[2224,29,2224,120,0],[2225,29,2225,114,0],[2226,29,2226,102,0],[2227,25,2227,26,0],[2228,25,2228,75,0],[2229,25,2229,122,0],[2230,25,2230,55,0],[2231,21,2231,22,0],[2232,17,2232,18,0],[2233,17,2233,37,0],[2234,17,2234,18,0],[2235,21,2236,58,0],[2237,17,2237,18,0],[2238,13,2238,14,0],[2240,13,2240,14,0],[2241,17,2241,78,0],[2243,9,2243,10,0],[2246,9,2246,10,1],[2247,13,2247,40,1],[2248,17,2248,43,1],[2250,13,2250,85,1],[2252,13,2252,42,1],[2253,17,2253,52,1],[2255,13,2255,101,1],[2256,17,2256,81,1],[2258,13,2258,60,1],[2259,13,2259,29,1],[2261,13,2261,33,1],[2262,9,2262,10,1],[2265,9,2265,10,1],[2266,13,2266,72,1],[2267,13,2267,79,1],[2268,13,2268,14,1],[2270,17,2270,89,1],[2271,17,2271,86,1],[2272,17,2272,32,1],[2273,21,2273,47,1],[2274,17,2274,96,1],[2275,13,2275,14,1],[2276,9,2276,10,1],[2279,9,2279,10,1],[2280,13,2280,20,1],[2280,22,2280,31,1],[2280,32,2280,34,1],[2280,35,2280,45,1],[2281,13,2281,14,1],[2285,17,2287,104,1],[2288,17,2288,18,1],[2289,21,2289,100,1],[2290,21,2290,95,1],[2291,25,2291,71,1],[2292,17,2292,18,1],[2293,17,2293,45,1],[2294,13,2294,14,1],[2295,9,2295,10,1],[2298,9,2298,10,1],[2299,13,2299,58,1],[2300,9,2300,10,1],[2303,9,2303,10,1],[2304,13,2304,37,1],[2304,38,2304,66,0],[2305,13,2305,58,1],[2306,9,2306,10,1],[2309,9,2309,10,1],[2310,13,2310,37,1],[2310,38,2310,45,0],[2311,13,2311,38,1],[2312,17,2312,59,1],[2313,13,2313,31,1],[2314,17,2314,50,1],[2316,17,2316,51,1],[2318,13,2318,34,1],[2319,13,2319,37,1],[2321,13,2321,32,1],[2324,13,2325,45,1],[2326,13,2326,14,0],[2327,17,2327,84,0],[2328,17,2328,100,0],[2329,13,2329,14,0],[2330,9,2330,10,1],[2333,9,2333,10,1],[2334,13,2334,53,1],[2335,17,2335,87,0],[2340,13,2340,14,1],[2341,17,2341,49,1],[2341,50,2341,57,0],[2342,17,2342,34,1],[2342,35,2342,42,0],[2343,17,2343,39,1],[2343,40,2343,75,0],[2344,17,2344,98,1],[2344,99,2344,106,1],[2345,17,2345,47,1],[2345,48,2345,55,0],[2346,17,2346,47,1],[2346,48,2346,71,0],[2347,17,2347,82,1],[2348,17,2348,18,0],[2349,21,2349,58,0],[2350,21,2350,28,0],[2352,17,2352,51,1],[2352,52,2352,59,0],[2370,17,2370,71,1],[2373,17,2373,154,1],[2378,17,2378,44,1],[2379,17,2380,62,1],[2381,17,2381,42,1],[2382,17,2382,36,1],[2384,17,2384,24,1],[2384,26,2384,45,1],[2384,46,2384,48,1],[2384,49,2384,74,1],[2385,17,2385,18,1],[2386,21,2386,53,1],[2387,21,2387,57,1],[2388,21,2388,22,1],[2389,25,2389,50,1],[2390,21,2390,22,1],[2391,17,2391,18,1],[2393,17,2393,140,1],[2394,17,2394,18,1],[2395,21,2395,83,1],[2397,21,2397,81,1],[2398,21,2398,88,1],[2399,21,2399,127,1],[2400,21,2400,139,1],[2401,21,2401,85,1],[2403,21,2403,43,1],[2404,21,2404,80,1],[2405,21,2405,65,1],[2406,21,2406,28,1],[2406,30,2406,40,1],[2406,41,2406,43,1],[2406,44,2406,67,1],[2407,21,2407,22,1],[2408,25,2408,46,1],[2408,47,2408,91,1],[2409,25,2409,83,1],[2410,21,2410,22,1],[2411,21,2411,52,1],[2412,21,2412,80,1],[2414,21,2414,123,1],[2417,21,2417,57,1],[2418,21,2418,76,1],[2419,21,2419,22,1],[2420,25,2420,91,1],[2421,21,2421,22,1],[2423,21,2423,87,1],[2424,21,2424,43,1],[2425,21,2425,22,1],[2427,25,2428,82,1],[2429,21,2429,22,1],[2431,21,2431,28,1],[2431,30,2431,46,1],[2431,47,2431,49,1],[2431,50,2431,73,1],[2432,21,2432,22,1],[2433,25,2433,49,1],[2434,25,2434,26,1],[2436,29,2436,62,1],[2437,29,2437,57,1],[2438,29,2438,48,1],[2439,29,2439,30,1],[2440,33,2442,79,1],[2443,29,2443,30,1],[2445,29,2447,60,1],[2448,29,2448,54,1],[2449,29,2449,30,1],[2450,33,2450,54,1],[2451,33,2451,34,1],[2452,37,2452,77,1],[2454,37,2454,138,1],[2455,37,2455,56,1],[2456,37,2456,38,1],[2457,41,2457,83,1],[2458,41,2458,48,1],[2458,50,2458,61,1],[2458,62,2458,64,1],[2458,65,2458,68,1],[2459,45,2459,130,1],[2460,37,2460,38,1],[2461,33,2461,34,1],[2463,33,2463,40,1],[2463,42,2463,64,1],[2463,65,2463,67,1],[2463,68,2463,80,1],[2464,33,2464,34,1],[2465,37,2465,63,1],[2466,37,2466,122,1],[2467,37,2467,57,1],[2468,41,2468,96,1],[2470,37,2470,82,1],[2471,37,2471,38,1],[2473,41,2473,68,1],[2475,41,2475,115,1],[2476,41,2476,183,1],[2477,41,2477,47,1],[2479,33,2479,34,1],[2480,29,2480,30,1],[2482,29,2482,30,1],[2484,33,2484,68,1],[2485,33,2485,42,1],[2489,29,2489,54,1],[2490,29,2490,30,1],[2491,33,2491,68,1],[2492,33,2492,42,1],[2495,29,2495,75,1],[2496,29,2496,87,1],[2498,29,2498,65,1],[2499,29,2499,30,1],[2501,33,2501,63,1],[2502,33,2502,56,1],[2503,33,2503,34,1],[2504,37,2504,44,1],[2504,46,2504,59,1],[2504,60,2504,62,1],[2504,63,2504,70,1],[2505,37,2505,38,1],[2506,41,2506,86,1],[2507,41,2512,43,1],[2514,41,2514,74,1],[2514,74,2514,88,1],[2514,88,2514,90,1],[2514,41,2514,90,1],[2515,45,2515,70,1],[2516,37,2516,38,1],[2517,33,2517,34,1],[2518,29,2518,30,1],[2519,25,2519,26,1],[2520,21,2520,22,1],[2521,17,2521,18,1],[2523,17,2523,43,1],[2524,17,2524,43,1],[2525,21,2525,86,1],[2525,86,2525,118,1],[2525,118,2525,127,1],[2525,21,2525,127,1],[2527,17,2533,4,1],[2541,17,2541,58,1],[2544,17,2544,87,1],[2545,21,2545,104,0],[2547,17,2547,144,1],[2548,13,2548,14,1],[2549,13,2549,33,0],[2550,13,2550,14,0],[2551,17,2552,52,0],[2553,13,2553,14,0],[2557,13,2557,53,1],[2558,17,2558,85,0],[2559,9,2559,10,1],[2562,9,2562,10,1],[2563,9,2563,10,1],[2566,9,2566,10,1],[2567,9,2567,10,1],[2570,9,2570,10,1],[2571,9,2571,10,1],[2574,9,2574,10,1],[2575,9,2575,10,1],[2578,9,2578,10,1],[2579,9,2579,10,1],[2582,9,2582,10,1],[2583,13,2583,53,1],[2584,9,2584,10,1],[2590,17,2590,18,1],[2590,19,2590,84,1],[2590,85,2590,86,1],[2595,17,2595,18,1],[2595,19,2595,79,1],[2595,80,2595,81,1],[2600,17,2600,18,0],[2600,19,2600,80,0],[2600,81,2600,82,0],[2605,17,2605,18,1],[2605,19,2605,87,1],[2605,88,2605,89,1],[2610,17,2610,18,1],[2610,19,2610,88,1],[2610,89,2610,90,1],[2615,17,2615,18,0],[2615,19,2615,82,0],[2615,83,2615,84,0],[2620,17,2620,18,0],[2620,19,2620,86,0],[2620,87,2620,88,0],[2625,17,2625,18,0],[2625,19,2625,84,0],[2625,85,2625,86,0],[2630,17,2630,18,0],[2630,19,2630,91,0],[2630,92,2630,93,0],[2634,9,2634,10,0],[2635,13,2635,120,0],[2636,17,2636,28,0],[2637,13,2637,122,0],[2638,13,2638,43,0],[2639,9,2639,10,0],[2646,9,2646,10,1],[2648,13,2648,69,1],[2649,13,2649,14,1],[2650,17,2650,66,1],[2651,17,2651,24,1],[2656,13,2656,61,1],[2657,17,2657,53,1],[2658,13,2659,88,1],[2660,13,2660,14,1],[2661,17,2661,60,1],[2663,13,2663,14,1],[2665,13,2665,14,0],[2674,17,2674,46,0],[2675,17,2675,49,0],[2676,17,2676,50,0],[2677,17,2678,85,0],[2679,13,2679,14,0],[2680,9,2680,10,1],[2683,9,2683,10,1],[2684,13,2684,68,1],[2685,9,2685,10,1],[2688,9,2688,10,0],[2689,13,2689,58,0],[2690,13,2690,14,0],[2692,17,2692,46,0],[2693,17,2693,49,0],[2694,17,2694,46,0],[2697,17,2699,93,0],[2700,13,2700,14,0],[2701,9,2701,10,0],[2704,9,2704,10,1],[2706,13,2706,69,1],[2707,13,2707,14,1],[2709,17,2709,18,1],[2710,21,2710,70,1],[2712,17,2712,36,0],[2713,17,2713,18,0],[2715,21,2715,64,0],[2716,21,2716,22,0],[2717,25,2717,148,0],[2718,25,2718,45,0],[2720,17,2720,18,0],[2721,13,2721,14,0],[2723,13,2723,65,1],[2724,13,2724,14,1],[2725,17,2725,69,1],[2726,17,2727,105,1],[2728,17,2728,67,1],[2729,17,2729,18,0],[2730,21,2730,39,0],[2732,22,2732,38,1],[2733,17,2733,18,1],[2734,21,2734,33,1],[2735,21,2735,22,1],[2736,25,2736,45,1],[2739,21,2739,22,0],[2744,25,2744,53,0],[2745,25,2745,26,0],[2746,29,2746,128,0],[2747,29,2747,110,0],[2749,21,2749,22,0],[2750,17,2750,18,0],[2751,13,2751,14,0],[2754,13,2754,14,0],[2755,17,2755,66,0],[2757,13,2757,33,0],[2758,13,2758,14,0],[2759,17,2759,84,0],[2760,17,2760,18,0],[2761,21,2761,144,0],[2762,21,2762,41,0],[2765,17,2765,18,0],[2766,21,2766,70,0],[2769,9,2769,10,1],[2772,9,2772,10,0],[2774,13,2774,14,0],[2775,17,2776,81,0],[2778,13,2778,30,0],[2779,13,2779,14,0],[2780,17,2780,29,0],[2782,9,2782,10,0],[2787,9,2787,10,1],[2788,13,2789,88,1],[2790,17,2790,47,1],[2791,9,2791,10,1],[2794,9,2794,10,1],[2795,13,2795,39,1],[2796,13,2796,14,0],[2797,17,2797,60,0],[2798,17,2798,43,0],[2799,13,2799,14,0],[2800,13,2805,64,1],[2806,9,2806,10,1],[2814,9,2814,10,0],[2815,13,2815,37,0],[2815,38,2815,45,0],[2816,13,2816,28,0],[2816,29,2816,46,0],[2817,13,2817,53,0],[2817,53,2817,75,0],[2817,75,2817,77,0],[2817,13,2817,77,0],[2818,13,2818,32,0],[2819,13,2819,14,0],[2820,17,2820,42,0],[2821,17,2821,43,0],[2822,17,2822,39,0],[2823,13,2823,14,0],[2824,13,2824,14,0],[2825,13,2825,97,0],[2826,13,2826,92,0],[2828,13,2828,32,0],[2829,9,2829,10,0],[2832,9,2832,10,0],[2833,13,2833,49,0],[2834,9,2834,10,0],[2837,9,2837,10,0],[2838,13,2838,74,0],[2839,9,2839,10,0],[2842,9,2842,10,0],[2843,13,2843,81,0],[2844,9,2844,10,0],[2848,9,2848,10,1],[2849,13,2849,80,1],[2850,9,2850,10,1],[2853,9,2853,10,0],[2854,13,2854,87,0],[2855,9,2855,10,0],[2858,9,2858,10,1],[2859,13,2859,72,1],[2860,9,2860,10,1],[2863,9,2863,10,0],[2864,13,2864,72,0],[2865,9,2865,10,0],[2868,9,2868,10,1],[2869,13,2869,70,1],[2870,9,2870,10,1],[2873,9,2873,10,0],[2874,13,2874,69,0],[2875,9,2875,10,0],[2878,9,2878,10,1],[2879,13,2879,79,1],[2880,13,2880,50,1],[2881,13,2881,14,0],[2882,17,2882,33,0],[2883,21,2883,106,0],[2885,21,2885,107,0],[2886,17,2886,24,0],[2888,13,2888,76,1],[2889,9,2889,10,1],[2892,9,2892,10,1],[2893,13,2893,79,1],[2894,13,2894,50,1],[2895,13,2895,14,0],[2896,17,2896,33,0],[2897,21,2897,99,0],[2899,21,2899,100,0],[2900,17,2900,24,0],[2902,13,2902,69,1],[2903,9,2903,10,1],[2906,9,2906,10,1],[2907,13,2907,79,1],[2908,13,2908,50,1],[2909,13,2909,14,0],[2910,17,2910,33,0],[2911,21,2911,103,0],[2913,21,2913,104,0],[2914,17,2914,24,0],[2916,13,2916,73,1],[2917,9,2917,10,1],[2920,9,2920,10,1],[2921,13,2921,77,1],[2922,9,2922,10,1],[2928,9,2928,10,1],[2929,13,2929,43,1],[2930,13,2930,42,1],[2931,13,2931,50,1],[2932,13,2932,44,1],[2933,13,2933,14,1],[2934,17,2934,38,1],[2935,17,2935,36,1],[2936,17,2936,18,1],[2937,21,2937,60,1],[2938,25,2938,46,1],[2939,26,2939,119,1],[2940,25,2940,53,1],[2941,26,2941,40,0],[2942,17,2942,18,1],[2943,17,2943,36,1],[2944,17,2944,18,1],[2945,21,2945,112,1],[2947,21,2947,87,1],[2948,21,2948,22,1],[2949,25,2949,121,1],[2950,25,2950,26,1],[2951,29,2951,91,1],[2952,33,2952,109,0],[2953,25,2953,26,1],[2955,25,2956,49,1],[2957,25,2957,61,1],[2958,25,2958,26,1],[2959,29,2959,78,1],[2960,29,2960,70,1],[2961,29,2961,92,1],[2962,25,2962,26,1],[2964,25,2964,87,1],[2965,29,2969,57,0],[2971,25,2971,88,1],[2972,25,2972,26,0],[2973,29,2973,121,0],[2974,29,2974,60,0],[2975,29,2975,94,0],[2977,29,2977,95,0],[2978,29,2979,97,0],[2980,29,2981,127,0],[2983,29,2983,92,0],[2984,33,2986,64,0],[2987,25,2987,26,0],[2988,21,2988,22,1],[2989,17,2989,18,1],[2990,13,2990,14,1],[2991,9,2991,10,1],[3002,37,3002,41,0],[3002,42,3002,46,0],[3003,40,3003,44,1],[3003,45,3003,49,1],[3004,34,3004,38,0],[3004,39,3004,43,1],[3005,33,3005,37,1],[3005,38,3005,42,1],[3006,50,3006,54,0],[3006,55,3006,59,0],[3007,37,3007,41,0],[3007,42,3007,46,1],[3008,26,3008,30,0],[3008,31,3008,35,1],[3009,47,3009,51,0],[3009,52,3009,56,1],[3013,9,3013,10,1],[3014,13,3014,38,1],[3015,13,3015,26,1],[3016,13,3016,30,1],[3017,13,3017,34,1],[3017,35,3017,112,1],[3018,13,3018,26,0],[3019,9,3019,10,1],[3022,9,3022,10,0],[3023,13,3023,30,0],[3024,13,3024,36,0],[3024,37,3024,85,0],[3025,9,3025,10,0],[3028,9,3028,10,0],[3029,13,3029,49,0],[3029,50,3029,94,0],[3030,13,3030,23,0],[3031,9,3031,10,0],[3044,9,3045,99,1],[3047,9,3051,11,1],[3054,9,3054,10,1],[3055,13,3055,27,1],[3056,13,3056,14,1],[3057,17,3057,68,1],[3058,17,3058,114,1],[3059,13,3059,14,1],[3060,13,3060,25,1],[3061,9,3061,10,1],[3064,9,3064,10,1],[3065,13,3065,64,1],[3066,13,3066,109,1],[3067,13,3067,20,1],[3067,22,3067,33,1],[3067,34,3067,36,1],[3067,37,3067,44,1],[3068,13,3068,14,1],[3069,17,3069,57,1],[3070,17,3070,30,1],[3071,17,3071,18,0],[3072,21,3072,56,0],[3073,21,3073,33,0],[3076,29,3076,71,0],[3077,29,3077,35,0],[3080,29,3080,69,0],[3081,29,3081,35,0],[3089,29,3089,97,0],[3090,29,3090,35,0],[3092,21,3092,30,0],[3093,17,3093,18,0],[3094,13,3094,14,1],[3095,13,3095,25,1],[3096,9,3096,10,1],[3099,9,3099,10,0],[3100,13,3100,64,0],[3101,13,3101,110,0],[3102,13,3102,25,0],[3103,9,3103,10,0],[3106,9,3106,10,1],[3107,13,3107,64,1],[3108,13,3108,85,1],[3109,9,3109,10,1]]);
    </script>
  </body>
</html>