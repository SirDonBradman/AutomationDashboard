<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Construction Vertical\Addon Modules\Contract Manager\Work Order\ConcreateModels\WorkOrderListModel.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Drawing;
using System.Globalization;
using System.Web;
using System.Web.SessionState;
using System.Web.UI.WebControls;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.ContractManager.BusinessLayer;
using Aurigo.AMP3.Core.AbstractModels;
using Aurigo.AMP3.Core.UserControls;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.AMP3.WORKORDBL;
using Aurigo.AMP3.WORKORDDTO;
using Aurigo.Brix.Core.WebUiHelper;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Infragistics.Documents.Excel;
using Infragistics.WebUI.UltraWebGrid;
using Infragistics.WebUI.UltraWebGrid.ExcelExport;
using Infragistics.WebUI.WebSchedule;
using Aurigo.Common;
using Aurigo.AMP3.DataAccess.Core;
using Telerik.Web.UI;

namespace Aurigo.AMP3.WORKORDUI
{
    [ListModelContext(Name = &quot;WORKORD&quot;, Table = &quot;WORKORDMain&quot;)]
    public class WorkOrderListModel : ListModel, IWorkflowEnabledList
    {
        private WORKORDManager woManager = WORKORDManager.Instance;

        public override string QueryStringName
        {
            get { return &quot;WorkOrderID&quot;; }
        }

        public override string ModuleId
        {
            get { return &quot;WORKORD&quot;; }
        }

        private string ContractID
        {
            get { return Request[&quot;ParentID&quot;] ?? Request[&quot;ContractID&quot;]; }
        }

        List&lt;string&gt; WOModuleComponent = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_WORKORD);

        /// &lt;summary&gt;
        /// This is used to contain the work order status before work order issue.
        ///  2: Approve Request, 7: Ammendment Approve
        /// &lt;/summary&gt;
        public int WorkOrderStatus { get; set; }

        private bool IsExternalReferenceEditable
        {
            get { return WOModuleComponent.Contains(&quot;WOExternalReferenceEditable&quot;); }
        }

        // For checking wheather Hire Order Equipment module is uploaded for the contract.
        private bool IsHireOrderAttached
        {
            get { return BL.Instance.IsModuleAttached(Request[&quot;ContractID&quot;].ToInt32_2(), &quot;EQUPHIR&quot;); }
        }

        private bool IsPrePaymentsAttached
        {
            get { return BL.Instance.IsModuleAttached(Request[&quot;ContractID&quot;].ToInt32_2(), &quot;CONTMOH&quot;); }
        }

        private bool IsMOHAttached
        {
            get { return BL.Instance.IsModuleAttached(Request[&quot;ContractID&quot;].ToInt32_2(), &quot;MONHAND&quot;); }
        }

        public override bool HasMultiApprove
        {
            get { return false; }
        }

        public override List&lt;MenuGroup&gt; MenuGroups
        {
            get
            {
                List&lt;MenuGroup&gt; menuGroups = base.MenuGroups;

                #region General
                MenuGroup generalGroup = menuGroups.Find(mg =&gt; mg.Title == GROUP_GENERAL);
                if (generalGroup == null)
                {
                    generalGroup = new MenuGroup(GROUP_GENERAL);
                    menuGroups.Add(generalGroup);
                }
                LargeButton newButton = (LargeButton)generalGroup.Menus.Find(m =&gt; m.ID == MENU_NEW_ID);
                if (newButton != null)
                {
                    generalGroup.Menus.Remove(newButton);
                }
                newButton = new LargeButton(MENU_NEW_ID, MENU_NEW, &quot;Icn_New.png&quot;);
                newButton.AddSubMenu(new TextIcon(&quot;lnkNewWO1&quot;, &quot;New &quot; + ItemNameAbbr + &quot; based WO&quot;, &quot;Icn_New_16.png&quot;));
                List&lt;string&gt; ModuleComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);
                if (ModuleComponents.Contains(&quot;Activities&quot;))
                    newButton.AddSubMenu(new TextIcon(&quot;lnkNewWO2&quot;, &quot;New Activity based WO&quot;, &quot;Icn_New2_16.png&quot;));
                //If Hire Order Equipment module is uploaded, show the Sub Menu.
                if (IsHireOrderAttached)
                    newButton.AddSubMenu(new TextIcon(&quot;lnkNewWO3&quot;, &quot;New Equipment Hire Order&quot;, &quot;Icn_New2_16.png&quot;));
                if (DisplayCreateVersion)
                    newButton.AddSubMenu(new TextIcon(&quot;lnkCreateVersion&quot;, &quot;Create Version&quot;, &quot;Icn_Vesion_16.png&quot;));
                if (newButton.HasSubMenus)
                    generalGroup.AddMenu(newButton);
                generalGroup.AddMenu(new LargeButton(&quot;lnkCopyWO&quot;, &quot;Copy&quot;, &quot;Icn_Copy.png&quot;));
                #endregion

                #region WODetails
                MenuGroup detailsGroup = new MenuGroup(&quot;Details&quot;);

                #region Billing
                var billing = new LargeButton(&quot;lnkBill&quot;, &quot;Billing&quot;, &quot;Icn_Billing.png&quot;);
                //This not required for the new PE module 
                //billing.AddSubMenu(new TextIcon(&quot;lnkBillSettings&quot;, PayEstimateName + &quot; Settings&quot;, &quot;Icn_Settings_16.png&quot;));
                billing.AddSubMenu(new TextIcon(&quot;lnkPayEstimate&quot;, PayEstimateName, &quot;Icn_Billing_16.png&quot;));

                if (IsPrePaymentsAttached)
                {
                    billing.AddSubMenu(new TextIcon(&quot;lnkPrePaymentSettings&quot;, &quot;Pre-Payment Settings&quot;,
                                                      &quot;IcnPrepayment_16_Disable.png&quot;));
                    billing.AddSubMenu(new TextIcon(&quot;lnkPrePayment&quot;, &quot;Pre-Payment&quot;, &quot;IcnPrepayment_16.png&quot;));
                }
                if (IsMOHAttached)
                {
                    List&lt;string&gt; ModuleComponentsCONTMGT = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CONTMGT);
                    if (ModuleComponentsCONTMGT.Contains(&quot;MaterialOnHand&quot;))
                        billing.AddSubMenu(new TextIcon(&quot;lnkMOHPayment&quot;, &quot;Material On Hand&quot;, &quot;Icn_Receive_16.png&quot;));
                }
                detailsGroup.AddMenu(billing);
                #endregion

                #region Quotations
                var quotations = new LargeButton(&quot;lnkQuotations&quot;, &quot;Others&quot;, &quot;IcnQuotation.png&quot;);
                quotations.AddSubMenu(new TextIcon(&quot;lnkReceiveQuot&quot;, &quot;Receive Quotation&quot;, &quot;Icn_Quotation_16.png&quot;));
                if (DisplayReqforQuotation)
                    quotations.AddSubMenu(new TextIcon(&quot;lnkReqForQuot&quot;, &quot;Request for Quotation - PDF&quot;, &quot;Icn_Pdf_16.png&quot;));
                if (displayExport)
                    quotations.AddSubMenu(new TextIcon(&quot;lnkReqExcelExport&quot;, &quot;Request for Quotation â€“ Excel&quot;, &quot;Icn_export_16.png&quot;));
                quotations.AddSubMenu(new TextIcon(&quot;lnkRetentionRelease&quot;, &quot;Retention Release&quot;, &quot;Icn_Retensionrelease_16.png&quot;));
                quotations.AddSubMenu(new TextIcon(&quot;lnkChecklists&quot;, &quot;Checklists&quot;, &quot;Icn_Scheduling_16.png&quot;));
                if (displaySettings)
                    quotations.AddSubMenu(new TextIcon(&quot;lnkSettings&quot;, &quot;Settings&quot;, &quot;Icn_Settings_16.png&quot;));
                if (IsHireOrderAttached)
                    quotations.AddSubMenu(new TextIcon(&quot;lnkHiredEquipments&quot;, &quot;Hired Equipments&quot;, &quot;Icn_New_16.png&quot;));
                detailsGroup.AddMenu(quotations);
                #endregion

                #endregion

                #region Others
                MenuGroup otherGroup = menuGroups.Find(mg =&gt; mg.Title == GROUP_OTHERS);
                if (otherGroup == null)
                {
                    otherGroup = new MenuGroup(GROUP_OTHERS);
                    menuGroups.Add(otherGroup);
                }
                var exportLink = otherGroup.Menus.Find(m =&gt; m.ID == &quot;lnkExcelExport&quot;);
                if (exportLink != null)
                {
                    otherGroup.Menus.Remove(exportLink);
                }
                if (IsExternalReferenceEditable)
                    otherGroup.AddMenu(new TextIcon(&quot;lnkUpdate&quot;, &quot;Update&quot;, &quot;Icn_New2_16.png&quot;));

                #endregion

                #region Reports
                if (displayReportsWO)
                {
                    LargeButton newMenuReports = (LargeButton)otherGroup.Menus.Find(m =&gt; m.ID == MENU_REPORTS_ID);
                    if (newMenuReports == null)
                    {
                        newMenuReports = new LargeButton(MENU_REPORTS_ID, MENU_REPORTS, &quot;Icn_Reports.png&quot;);
                    }

                    newMenuReports.AddSubMenu(new TextIcon(&quot;lnkViewPDF&quot;, &quot;Work Order Details&quot;, &quot;Icn_Pdf_16.png&quot;));
                }
                #endregion

                menuGroups.Insert(menuGroups.Count - 1, detailsGroup);

                DisplayReportsWO = true;
                return menuGroups;
            }
        }

        //public override MenuArray Menus
        //{
        //    get
        //    {
        //        DisplayNew = false;
        //        MenuArray m = base.Menus;
        //        foreach (BrixMenu bm in m)
        //        {
        //            if (bm.Name.Equals(&quot;Others&quot;))
        //            {
        //                foreach (BrixMenu sm in bm.subMenus)
        //                {
        //                    if (sm.Name.Equals(&quot;Excel Export&quot;))
        //                    {
        //                        bm.subMenus.Remove(sm);
        //                        break;
        //                    }
        //                }
        //                //If Hire Order Equipment module is uploaded, show the Sub Menu.
        //                if (IsHireOrderAttached)
        //                    bm.subMenus.Add(new BrixMenu(&quot;lnkHiredEquipments&quot;, &quot;Hired Equipments&quot;, &quot;Icn_Settings.gif&quot;));
        //                bm.subMenus.Add(new BrixMenu(&quot;lnkRetentionRelease&quot;, &quot;Retention Release&quot;, &quot;Icn_Settings.gif&quot;));
        //                bm.subMenus.Add(new BrixMenu(&quot;lnkChecklists&quot;, &quot;Checklists&quot;, &quot;Icn_Settings.gif&quot;));
        //                break;
        //            }
        //        }

        //        var mi = new BrixMenu(&quot;lnkNew&quot;, &quot;New&quot;, &quot;Icn_New.png&quot;);
        //        mi.SubMenuWidth = 200;
        //        mi.subMenus = new MenuArray();
        //        mi.subMenus.Add(new BrixMenu(&quot;lnkNewWO1&quot;, &quot;New &quot; + ItemNameAbbr + &quot; based WO&quot;, &quot;Icn_AddCO.png&quot;));
        //        List&lt;string&gt; ModuleComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);
        //        if (ModuleComponents.Contains(&quot;Activities&quot;))
        //            mi.subMenus.Add(new BrixMenu(&quot;lnkNewWO2&quot;, &quot;New Activity based WO&quot;, &quot;Icn_AddCO.png&quot;));
        //        //If Hire Order Equipment module is uploaded, show the Sub Menu.
        //        if (IsHireOrderAttached)
        //            mi.subMenus.Add(new BrixMenu(&quot;lnkNewWO3&quot;, &quot;New Equipment Hire Order&quot;, &quot;Icn_AddCO.png&quot;));
        //        if (DisplayCreateVersion)
        //            mi.subMenus.Add(new BrixMenu(&quot;lnkCreateVersion&quot;, &quot;Create Version&quot;, &quot;Icn_Version16.png&quot;));
        //        m.Insert(0, mi);

        //        var billing = new BrixMenu(&quot;lnkBill&quot;, &quot;Billing&quot;, &quot;money.png&quot;);
        //        billing.SubMenuWidth = 200;
        //        billing.subMenus = new MenuArray();
        //        billing.subMenus.Add(new BrixMenu(&quot;lnkBillSettings&quot;, PayEstimateName + &quot; Settings&quot;, &quot;Icn_Settings.gif&quot;));
        //        billing.subMenus.Add(new BrixMenu(&quot;lnkPayEstimate&quot;, PayEstimateName, &quot;Icn_DocMgmt16.gif&quot;));
        //        if (IsPrePaymentsAttached)
        //        {
        //            billing.subMenus.Add(new BrixMenu(&quot;lnkPrePaymentSettings&quot;, &quot;Pre-Payment Settings&quot;,
        //                                              &quot;Icn_Settings.gif&quot;));
        //            billing.subMenus.Add(new BrixMenu(&quot;lnkPrePayment&quot;, &quot;Pre-Payment&quot;, &quot;Icn_DocMgmt16.gif&quot;));
        //        }
        //        if (IsMOHAttached)
        //        {
        //            List&lt;string&gt; ModuleComponentsCONTMGT = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CONTMGT);
        //            if (ModuleComponentsCONTMGT.Contains(&quot;MaterialOnHand&quot;))
        //                billing.subMenus.Add(new BrixMenu(&quot;lnkMOHPayment&quot;, &quot;Material On Hand&quot;, &quot;Icn_DocMgmt16.gif&quot;));
        //        }
        //        m.Insert(4, billing);

        //        //BrixMenu approvals = new BrixMenu(&quot;lnkApprovals&quot;, &quot;Approvals&quot;, &quot;Icn_Approve.png&quot;);
        //        //approvals.SubMenuWidth = 200;
        //        //approvals.subMenus = new MenuArray();
        //        //approvals.subMenus.Add(new BrixMenu(&quot;lnkApprove&quot;, &quot;Approve&quot;, &quot;Icn_Approve16.PNG&quot;));
        //        //approvals.subMenus.Add(new BrixMenu(&quot;lnkUnApprove&quot;, &quot;Unapprove&quot;, &quot;Icn_Unapprove16.png&quot;));
        //        //m.Insert(5, approvals);

        //        var quotations = new BrixMenu(&quot;lnkQuotations&quot;, &quot;Quotations&quot;, &quot;Icn_Reports.png&quot;);
        //        quotations.SubMenuWidth = 200;
        //        quotations.subMenus = new MenuArray();
        //        if (DisplayReqforQuotation)
        //            quotations.subMenus.Add(new BrixMenu(&quot;lnkReqForQuot&quot;, &quot;Request for Quotation - PDF&quot;,
        //                                                 &quot;Icn_viewPDF.gif&quot;));
        //        if (displayExport)
        //            quotations.subMenus.Add(new BrixMenu(&quot;lnkExcelExport&quot;, &quot;Request for Quotation â€“ Excel&quot;,
        //                                                 &quot;Icn_exportxl.gif&quot;));
        //        quotations.subMenus.Add(new BrixMenu(&quot;lnkReceiveQuot&quot;, &quot;Receive Quotation&quot;, &quot;Icn_DocMgmt16.gif&quot;));
        //        m.Insert(6, quotations);

        //        //if (BL.Instance.GetLockStatus(Request[&quot;ContractID&quot;].ToInt32_2()))
        //        {
        //            DisplayReportsWO = true;
        //            //BrixMenu newMenuReports = new BrixMenu(&quot;lnkReports&quot;, &quot;Reports&quot;, &quot;IcnReports.png&quot;);
        //            //newMenuReports.SubMenuWidth = 200;
        //            //newMenuReports.subMenus = new MenuArray();
        //            //newMenuReports.subMenus.Add(new BrixMenu(&quot;lnkViewPDF&quot;, &quot;Work Order Details&quot;, &quot;Icn_viewPDF.gif&quot;));
        //            ////if (DisplayReqforQuotation) newMenuReports.subMenus.Add(new BrixMenu(&quot;lnkReqForQuot&quot;, &quot;Request for Quotation&quot;, &quot;Icn_viewPDF.gif&quot;));
        //            //m.Insert(7, newMenuReports);
        //        }

        //        return m;
        //    }
        //}

        public override void CustomizeToolBarMenu(ToolBar toolBar)
        {
            base.CustomizeToolBarMenu(toolBar);
            toolBar.GetMenuReference(&quot;lnkCopyWO&quot;).OnClientClick = &quot;if(lnkValidation(&#39;&quot; +
                                                                           Convert.ToInt32(ValidateSelection.OneItem,
                                                                                           CultureInfo.CurrentCulture) +
                                                                           &quot;&#39;, &#39;&quot; + mwGrid.ClientID + &quot;&#39;, &#39;&quot; +
                                                                           QueryStringName + &quot;&#39;))&quot;;
        }

        public override string ParentIDKey
        {
            get { return &quot;ContractID&quot;; }
        }

        public string FormName
        {
            get { return &quot;XWRKORD&quot;; }
        }

        public int ParentModuleId
        {
            get { return 0; }
        }

        public string ListPrimaryKey
        {
            get { return &quot;WorkOrderID&quot;; }
        }

        public int PID
        {
            get { return 0; }
        }

        public override void SetUIDetails()
        {
            header = &quot;Work Order List&quot;;

            //Disabling the Role Selection Combo Box
            string currency = LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL);
            DisableRoleSelection = true;

            //Hidden Columns
            ModifyColumnProperties(&quot;Multi&quot;, true, null, null, null, false);
            ModifyColumnProperties(&quot;IsQuotationAwarded&quot;, true, null, null, null, false);
            ModifyColumnProperties(&quot;HasFinalPE&quot;, true, null, null, null, false);
            ModifyColumnProperties(&quot;WOType&quot;, true, null, null, null, false);
            ModifyColumnProperties(&quot;RetentionReleaseDate&quot;, true, null, null, null, false);
            ModifyColumnProperties(&quot;ExtReference&quot;, !IsExternalReferenceEditable, null, null, null, false, &quot;Customer WO No.&quot;);
            ModifyColumnProperties(&quot;Description&quot;, false, null, null, null, false, &quot;Description&quot;);
            ModifyColumnProperties(&quot;TotalAmount&quot;, false, null, PlatformAppSettings.FORMAT_AMOUNT, null, false, &quot;WO Amount (&quot; + currency + &quot;)&quot;);
            ModifyColumnProperties(&quot;EstAmount&quot;, false, null, PlatformAppSettings.FORMAT_AMOUNT, null, false, &quot;Estimated Amount (&quot; + currency + &quot;)&quot;);

            //Display of Toolbar buttons - based on Contract is locked or not
            if (Request != null) //For BrixTests
            {
                bool isLocked = BL.Instance.GetLockStatus(Request[&quot;ContractID&quot;].ToInt32_2());
                bool isModuleEnabled = BL.Instance.ShouldModulebeEnabled(Request[&quot;ContractID&quot;].ToInt32_2());
                bool IsIssueEnabled = BL.Instance.VerifyModuleSettings(Request[&quot;ContractID&quot;].ToInt32_2(), &quot;WORKORD&quot;);

                EnableNew = EnableEdit = EnableDelete = displayCreateVersion = isLocked &amp;&amp; isModuleEnabled;

                //Create version is disabled for NCC Phase II
                //displayCreateVersion = false; //Enabled for NCC Phase III

                displayOtherDropMenu = displayExport = displayReqforQuotation = isLocked;

                displayApplyFilter = EnableGridDblClick = displaySettings = HasHierarchicalGrid = true;

                //TODO: Merge - Not taking care of quntity planning here
                DisplayWorkOrderIssueWorkflow = false;

                displayApprove = false;

                //Disable old WO details report - New sql reports are added 
                //if (BL.Instance.GetLockStatus(Request[&quot;ContractID&quot;].ToInt32_2()))
                //    DisplayReportsWO = true;
                if (displayNew || displayEdit) //Enabled for NCC Phase III
                    displayCloseOut = isLocked &amp;&amp; isModuleEnabled;
            }

            if (IsExternalReferenceEditable)
                EnableGridDblClick = false;
            InstanceIDColumn = &quot;WorkOrderID&quot;;
            CreateDateColumn = &quot;ApprovedOn&quot;;
        }

        public override void SetGridColumnProperties&lt;T&gt;(T grid)
        {
            //ToDo: handle this block.
            //Code commented temporarily
            /*
            if (IsExternalReferenceEditable &amp;&amp; MWGrid.ColumnExists(&quot;ExtReference&quot;))
            {
                grid.Columns.FromKey(&quot;ExtReference&quot;).Type = ColumnType.Custom;
                grid.Columns.FromKey(&quot;ExtReference&quot;).HTMLEncodeContent = true;
            }
            */
        }

        protected override void SetModuleLevelPermissions(List&lt;string&gt; permissions)
        {
            bool isLocked = BL.Instance.GetLockStatus(Request[&quot;ContractID&quot;].ToInt32_2());
            bool isModuleEnabled = BL.Instance.ShouldModulebeEnabled(Request[&quot;ContractID&quot;].ToInt32_2());
            //Button Visibility according to Permissions set here

            //Close Out is disabled for NCC Phase II
            if (displayNew || displayEdit) //Enabled for NCC Phase III
                displayCloseOut = isLocked &amp;&amp; isModuleEnabled;
            if (displayReqforQuotation &amp;&amp; !permissions.Contains(&quot;View&quot;)) displayReqforQuotation = false;

            displayCreateVersion = permissions.Contains(&quot;Version&quot;) &amp;&amp; isLocked &amp;&amp; isModuleEnabled;

            displayApprove = false;
            //displayCreateVersion = false;
        }

        public override BrixFilter[] GetApplyFilterLabels()
        {
            List&lt;string&gt; coreComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);
            if (coreComponents.Contains(&quot;RateAnalysis&quot;))
            {
                var filters = new BrixFilter[5];
                filters[0] = new BrixFilter();
                filters[0].Title = &quot;Work Order No&quot;;
                filters[0].Name = &quot;WorkOrderNo&quot;;
                filters[0].FilterType = BrixFilter.Type.Text;

                filters[1] = new BrixFilter();
                filters[1].Title = &quot;Status&quot;;
                filters[1].Name = &quot;Status&quot;;
                filters[1].FilterType = BrixFilter.Type.Combo;
                filters[1].DataTextField = &quot;Text&quot;;
                filters[1].DataValueField = &quot;Value&quot;;
                Dictionary&lt;int, string&gt; dicStatus = new Dictionary&lt;int, string&gt;();
                dicStatus[WOConstants.WO_STAGE_DRAFT] = &quot;Draft Request&quot;;
                dicStatus[WOConstants.STAGE_DRAFT_AMENDMENT] = &quot;Draft Amendment&quot;;
                dicStatus[WOConstants.STAGE_APPROVE_AMENDMENT] = &quot;Approved Amendment&quot;;
                dicStatus[WOConstants.WO_STAGE_APPROVED] = &quot;Approved Request&quot;;
                dicStatus[WOConstants.WO_STAGE_ISSUED] = &quot;Issued&quot;;
                dicStatus[WOConstants.WO_STAGE_CLOSED] = &quot;Closed&quot;;
                filters[1].DataSource = GetComboDataSource(dicStatus);

                filters[2] = new BrixFilter();
                filters[2].Title = &quot;Contractor&quot;;
                filters[2].Name = &quot;Contractor&quot;;
                filters[2].FilterType = BrixFilter.Type.Text;

                filters[3] = new BrixFilter();
                filters[3].Title = &quot;With Material&quot;;
                filters[3].Name = &quot;WithMaterial&quot;;
                filters[3].FilterType = BrixFilter.Type.Radio;
                filters[3].Values = new Dictionary&lt;string, string&gt;();
                filters[3].Values[&quot;Yes&quot;] = &quot;1&quot;;
                filters[3].Values[&quot;No&quot;] = &quot;0&quot;;
                filters[3].Values[&quot;NA&quot;] = &quot;2&quot;;

                filters[4] = new BrixFilter();
                filters[4].Title = &quot;Work order Type&quot;;
                filters[4].Name = &quot;WorkOrderType&quot;;
                filters[4].FilterType = BrixFilter.Type.Radio;
                filters[4].Values = new Dictionary&lt;string, string&gt;();
                if (coreComponents.Contains(&quot;Activities&quot;))
                    filters[4].Values[&quot;Activity based WO&quot;] = &quot;A&quot;;
                filters[4].Values[&quot;BOQ based WO&quot;] = &quot;W&quot;;
                if (IsHireOrderAttached)
                    filters[4].Values[&quot;Equipment Hire Order&quot;] = &quot;E&quot;;

                return filters;
            }
            else
            {
                var filters = new BrixFilter[4];
                filters[0] = new BrixFilter();
                filters[0].Title = &quot;Work Order No&quot;;
                filters[0].Name = &quot;WorkOrderNo&quot;;
                filters[0].FilterType = BrixFilter.Type.Text;

                filters[1] = new BrixFilter();
                filters[1].Title = &quot;Status&quot;;
                filters[1].Name = &quot;Status&quot;;
                filters[1].FilterType = BrixFilter.Type.Combo;
                filters[1].DataTextField = &quot;Text&quot;;
                filters[1].DataValueField = &quot;Value&quot;;
                Dictionary&lt;int, string&gt; dicStatus = new Dictionary&lt;int, string&gt;();
                dicStatus[WOConstants.WO_STAGE_DRAFT] = &quot;Draft Request&quot;;
                dicStatus[WOConstants.STAGE_DRAFT_AMENDMENT] = &quot;Draft Amendment&quot;;
                dicStatus[WOConstants.STAGE_APPROVE_AMENDMENT] = &quot;Approved Amendment&quot;;
                dicStatus[WOConstants.WO_STAGE_APPROVED] = &quot;Approved Request&quot;;
                dicStatus[WOConstants.WO_STAGE_ISSUED] = &quot;Issued&quot;;
                dicStatus[WOConstants.WO_STAGE_CLOSED] = &quot;Closed&quot;;
                filters[1].DataSource = GetComboDataSource(dicStatus);

                filters[2] = new BrixFilter();
                filters[2].Title = &quot;Contractor&quot;;
                filters[2].Name = &quot;Contractor&quot;;
                filters[2].FilterType = BrixFilter.Type.Text;

                filters[3] = new BrixFilter();
                filters[3].Title = &quot;Work order Type&quot;;
                filters[3].Name = &quot;WorkOrderType&quot;;
                filters[3].FilterType = BrixFilter.Type.Radio;
                filters[3].Values = new Dictionary&lt;string, string&gt;();
                if (coreComponents.Contains(&quot;Activities&quot;))
                    filters[3].Values[&quot;Activity based WO&quot;] = &quot;A&quot;;
                filters[3].Values[&quot;BOQ based WO&quot;] = &quot;W&quot;;
                if (IsHireOrderAttached)
                    filters[3].Values[&quot;Equipment Hire Order&quot;] = &quot;E&quot;;

                return filters;
            }


        }

        protected static DataTable GetComboDataSource(Dictionary&lt;int, string&gt; values)
        {
            DataTable dtTemp = new BrixDataTable();
            dtTemp.Columns.Add(&quot;Value&quot;);
            dtTemp.Columns.Add(&quot;Text&quot;);
            dtTemp.AcceptChanges();

            DataRow drNew;

            foreach (KeyValuePair&lt;int, string&gt; value in values)
            {
                drNew = dtTemp.NewRow();

                drNew[&quot;Value&quot;] = value.Key;
                drNew[&quot;Text&quot;] = value.Value;

                dtTemp.Rows.Add(drNew);
            }

            return dtTemp;
        }

        public override void HandleNew()
        {
            Response.Redirect(string.Format(&quot;~/Modules/WORKORD/NewWorkOrder.aspx?&quot; + Constants.QRY_PROJECTID + &quot;=&quot; +
                             (Request.QueryString[Constants.QRY_PROJECTID] ?? string.Empty) + &quot;&amp;&quot; +
                             WOConstants.QRY_CONTRACTID + &quot;=&quot; +
                             (Request.QueryString[WOConstants.QRY_CONTRACTID] ?? string.Empty) +
                             &quot;&amp;ParentContext=CONTMGT&quot;), true);
        }

        public override void HandleEdit()
        {
            string selWOID = GetSelectedItemFromGrid();
            if (!String.IsNullOrEmpty(selWOID))
            {
                int WOID = 0;
                int.TryParse(selWOID, out WOID);
                WorkOrderDTO w = WORKORDManager.Instance.GetWorkOrderDetails(WOID);
                if (w == null)
                    throw new Exception(&quot;The work order may have been deleted by another user.&quot;);
                //string WOType = &quot;A&quot;;

                var selectedRow = MWGrid.GetSelectedRow(mwGrid);
                if (selectedRow != null)
                {
                    string WOType = (MWGrid.GetCellValue(selectedRow, &quot;Type&quot;).Equals(&quot;Equipment Hire Order&quot;) ? &quot;Hire&quot; : &quot;Work&quot;);
                    //if (SelRow.Cells.FromKey(&quot;Status&quot;).Value.ToString2().Equals(&quot;Approved Amendment&quot;))
                    //    throw new Exception(&quot;An Approved &quot; + WOType + &quot; order Amendment cannot be edited.&quot;);
                    //if (SelRow.Cells.FromKey(&quot;IsLatest&quot;).Value.ToString2().ToLower2().Equals(&quot;false&quot;) &amp;&amp; !SelRow.Cells.FromKey(&quot;Status&quot;).Value.ToString2().Equals(&quot;Draft Amendment&quot;))
                    //    throw new Exception(&quot;A read-only &quot; + WOType + &quot; order instance cannot be edited.&quot;);
                    //if (SelRow.Cells.FromKey(&quot;Status&quot;).Value.ToString2().Equals(&quot;Issued&quot;))
                    //    throw new Exception(&quot;The selected &quot; + WOType +
                    //                        &quot; order instance has been issued.You can only create a version.&quot;);
                    if (!MWGrid.GetCellValue(selectedRow,&quot;MaxWOID&quot;).ToString2().Equals(selWOID))
                        throw new Exception(&quot;This Read-Only Work Order Instance cannot be edited.&quot;);
                    if (MWGrid.GetCellValue(selectedRow,&quot;Status&quot;).ToString2().Equals(&quot;Closed&quot;))
                        throw new Exception(&quot;A closed &quot; + WOType + &quot; order instance cannot be edited.&quot;);
                }
                if (w.WorkOrderType.Equals(&quot;E&quot;))
                {
                    if (MWGrid.GetCellValue(selectedRow,&quot;Status&quot;).ToString2().Equals(&quot;Draft Amendment&quot;) ||
                        MWGrid.GetCellValue(selectedRow,&quot;Status&quot;).ToString2().Equals(&quot;Approved Amendment&quot;))
                        Response.Redirect(
                            string.Format(CultureInfo.CurrentCulture,
                                          &quot;~/Modules/WORKORD/NewWorkOrder.aspx?Type=E&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;ParentContext=CONTMGT&amp;WOType=E&amp;Version=true&amp;IsEditVersion=true&quot;,
                                          Request[WOConstants.QRY_PROJECTID], Request[WOConstants.QRY_CONTRACTID], WOID),
                            false);
                    else
                        Response.Redirect(
                            string.Format(CultureInfo.CurrentCulture,
                                          &quot;~/Modules/WORKORD/NewWorkOrder.aspx?Type=E&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;ParentContext=CONTMGT&amp;WOType=E&quot;,
                                          Request[WOConstants.QRY_PROJECTID], Request[WOConstants.QRY_CONTRACTID], WOID),
                            false);
                }
                else if (w.WorkOrderType.Equals(&quot;A&quot;))
                {
                    if (MWGrid.GetCellValue(selectedRow,&quot;Status&quot;).ToString2().Equals(&quot;Draft Amendment&quot;) ||
                        MWGrid.GetCellValue(selectedRow,&quot;Status&quot;).ToString2().Equals(&quot;Approved Amendment&quot;))
                        Response.Redirect(
                            string.Format(CultureInfo.CurrentCulture,
                                          &quot;~/Modules/WORKORD/NewACTIWorkOrder.aspx?Type=E&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;ParentContext=CONTMGT&amp;Version=true&amp;IsEditVersion=true&quot;,
                                          Request[WOConstants.QRY_PROJECTID], Request[WOConstants.QRY_CONTRACTID], WOID),
                            false);
                    else
                        Response.Redirect(
                            string.Format(CultureInfo.CurrentCulture,
                                          &quot;~/Modules/WORKORD/NewACTIWorkOrder.aspx?Type=E&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;ParentContext=CONTMGT&quot;,
                                          Request[WOConstants.QRY_PROJECTID], Request[WOConstants.QRY_CONTRACTID], WOID),
                            false);
                }
                else
                {
                    if (MWGrid.GetCellValue(selectedRow,&quot;Status&quot;).ToString2().Equals(&quot;Draft Amendment&quot;) ||
                        MWGrid.GetCellValue(selectedRow,&quot;Status&quot;).ToString2().Equals(&quot;Approved Amendment&quot;))
                        Response.Redirect(
                            string.Format(CultureInfo.CurrentCulture,
                                          &quot;~/Modules/WORKORD/NewWorkOrder.aspx?Type=E&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;ParentContext=CONTMGT&amp;Version=true&amp;IsEditVersion=true&quot;,
                                          Request[WOConstants.QRY_PROJECTID], Request[WOConstants.QRY_CONTRACTID], WOID),
                            false);
                    else
                        Response.Redirect(
                            string.Format(CultureInfo.CurrentCulture,
                                          &quot;~/Modules/WORKORD/NewWorkOrder.aspx?Type=E&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;ParentContext=CONTMGT&quot;,
                                          Request[WOConstants.QRY_PROJECTID], Request[WOConstants.QRY_CONTRACTID], WOID),
                            false);
                }
            }
        }

        public override void HandleView()
        {
            string selWOID = GetSelectedItemFromGrid();
            if (!String.IsNullOrEmpty(selWOID))
            {
                int WOID = 0;
                int.TryParse(selWOID, out WOID);
                WorkOrderDTO w = WORKORDManager.Instance.GetWorkOrderDetails(WOID);
                if (w == null)
                    throw new Exception(&quot;The work order may have been deleted by another user.&quot;);

                if (w.WorkOrderType.Equals(&quot;E&quot;))
                    Response.Redirect(
                        string.Format(CultureInfo.CurrentCulture,
                                      &quot;~/Modules/WORKORD/ViewWO.aspx?&quot; + Constants.QRY_PROJECTID + &quot;=&quot; +
                                      (Request.QueryString[Constants.QRY_PROJECTID] ?? string.Empty) +
                                      &quot;&amp;&quot; + WOConstants.QRY_CONTRACTID + &quot;=&quot; +
                                      (Request.QueryString[WOConstants.QRY_CONTRACTID] ?? string.Empty) +
                                      &quot;&amp;WOID={0}&amp;ParentContext=CONTMGT&amp;WOType=E&quot;, WOID), false);
                else if (w.WorkOrderType.Equals(&quot;A&quot;))
                    Response.Redirect(
                        string.Format(CultureInfo.CurrentCulture,
                                      &quot;~/Modules/WORKORD/ViewACTIWO.aspx?&quot; + Constants.QRY_PROJECTID + &quot;=&quot; +
                                      (Request.QueryString[Constants.QRY_PROJECTID] ?? string.Empty) +
                                      &quot;&amp;&quot; + WOConstants.QRY_CONTRACTID + &quot;=&quot; +
                                      (Request.QueryString[WOConstants.QRY_CONTRACTID] ?? string.Empty) +
                                      &quot;&amp;WOID={0}&amp;ParentContext=CONTMGT&quot;, WOID), false);
                else
                    Response.Redirect(
                        string.Format(CultureInfo.CurrentCulture,
                                      &quot;~/Modules/WORKORD/ViewWO.aspx?&quot; + Constants.QRY_PROJECTID + &quot;=&quot; +
                                      (Request.QueryString[Constants.QRY_PROJECTID] ?? string.Empty) +
                                      &quot;&amp;&quot; + WOConstants.QRY_CONTRACTID + &quot;=&quot; +
                                      (Request.QueryString[WOConstants.QRY_CONTRACTID] ?? string.Empty) +
                                      &quot;&amp;WOID={0}&amp;ParentContext=CONTMGT&quot;, WOID), false);
            }
        }

        protected string GetTypeGrid()
        {
            var selectedRow = MWGrid.GetSelectedRow(mwGrid);
            if (selectedRow != null)
                return MWGrid.GetCellValue(selectedRow, &quot;Type&quot;).Substring(1, 1);
            return string.Empty;
        }

        public override int HandleDelete()
        {
            int retValue = 0;
            string selWOID = GetSelectedItemFromGrid();
            if (!String.IsNullOrEmpty(selWOID))
            {
                int WOID = 0;
                int.TryParse(selWOID, out WOID);

                WorkOrderDTO w = WORKORDManager.Instance.GetWorkOrderDetails(WOID);
                string WOType = (w.WorkOrderType.Equals(&quot;Equipment Hire Order&quot;) ? &quot;Hire&quot; : &quot;Work&quot;);

                if (w == null)
                    throw new Exception(&quot;The &quot; + WOType + &quot; order may have been deleted by another user.&quot;);

                var selectedRow = MWGrid.GetSelectedRow(mwGrid);
                if (selectedRow != null)
                {
                    if (MWGrid.GetCellValue(selectedRow,&quot;Status&quot;).ToString2().Equals(&quot;Draft Amendment&quot;) ||
                        MWGrid.GetCellValue(selectedRow,&quot;Status&quot;).ToString2().Equals(&quot;Approved Amendment&quot;))
                        throw new Exception(&quot; You can not delete a Work Order Amendment &quot;);
                    if (!MWGrid.GetCellValue(selectedRow,&quot;Status&quot;).ToString2().Equals(&quot;Draft Request&quot;))
                        throw new Exception(&quot;Only a Draft &quot; + WOType + &quot; Order Instance can be deleted.&quot;);
                    if (MWGrid.GetCellValue(selectedRow,&quot;IsLatest&quot;).ToString2().ToLower2().Equals(&quot;false&quot;))
                        throw new Exception(&quot;A Read-Only &quot; + WOType + &quot; Order Instance cannot be deleted.&quot;);
                }
            }

            selWOID = FilterIdsToDeleteBasedOnWFDefinitions(FormName, PID.ToString2(), Request.QueryString[&quot;ContractID&quot;], selWOID);
            if (selWOID.Split(&#39;,&#39;).Length &gt; 1)
            {
                Logging.Logger.Log(Resources.MessageResources.Enumerations.LogType.Error, &quot;More than one record exists in mapping table for Combination of keys - FormInstanceID and FormID&quot;, Constants.MODID_WORKORD);
                throw new Exception(&quot;An internal exception occured.Cannot delete record.Please contact support team.&quot;);
            }

            if (!String.IsNullOrEmpty(selWOID))
            {
                int WOID = 0;
                int.TryParse(selWOID, out WOID);

                retValue = WORKORDManager.Instance.DeleteWorkOrder(WOID);
                if (retValue == -2)
                {
                    throw new Exception(&quot;Only draft or approved instances can be deleted.&quot;);
                }
                else
                    ForceDeleteWorkflowsForThisForm(selWOID, FormName);
            }

            return retValue;
        }

        public override void HandleGridRowInitialization&lt;T&gt;(object sender, T row)
        {
            if (row is GridDataItem)
            {
                int status = 0;
                Int32.TryParse(MWGrid.GetCellValue(row, &quot;Status&quot;).ToString2(), out status);
                MWGrid.SetCellValue(row, &quot;Status&quot;, (status == WOConstants.STAGE_DRAFT
                                                         ? &quot;Draft Request&quot;
                                                         : (status == WOConstants.STAGE_APPROVED
                                                                ? &quot;Approved Request&quot;
                                                                : (status == WOConstants.STAGE_ISSUED
                                                                       ? &quot;Issued&quot;
                                                                       : (status == WOConstants.STAGE_DRAFT_AMENDMENT
                                                                              ? &quot;Draft Amendment&quot;
                                                                              : (status ==
                                                                                 WOConstants.STAGE_APPROVE_AMENDMENT
                                                                                     ? &quot;Approved Amendment&quot;
                                                                                     : &quot;Closed&quot;))))));
                MWGrid.SetCellValue(row, &quot;Type&quot;, MWGrid.GetCellValue(row, &quot;Type&quot;).ToString2().Equals(&quot;Work Order&quot;)
                                                      ? ItemNameAbbr + &quot; based Work Order&quot;
                                                      : MWGrid.GetCellValue(row, &quot;Type&quot;));
                if (!MWGrid.GetCellValue(row, &quot;IsLatest&quot;).ToString2().ToLower2().Equals(&quot;true&quot;))
                {
                    MWGrid.SetRowBackColor(row, Color.LightGray);
                }

                if (IsExternalReferenceEditable &amp;&amp; MWGrid.ColumnExists(row, &quot;ExtReference&quot;))
                {
                    //ToDo: To be done
                    //Code commented temporarily 
                    /*
                    if (row.Cells.FromKey(&quot;ExtReference&quot;).Row.HasParent)
                    {
                        row.Cells.FromKey(&quot;ExtReference&quot;).AllowEditing = AllowEditing.No;
                    }
                    else
                    {
                        row.Cells.FromKey(&quot;ExtReference&quot;).AllowEditing = AllowEditing.Yes;
                        row.Cells.FromKey(&quot;ExtReference&quot;).Style.BackColor = Color.Yellow;
                    }
                    */
                }
            }
        }

        public override string HandleMenuItem(string eventString)
        {
            string retVal = String.Empty;
            if (eventString.Equals(&quot;New &quot; + ItemNameAbbr + &quot; based WO&quot;))
            {
                HandleNew();
            }
            else if (eventString.Equals(&quot;New Activity based WO&quot;))
            {
                Response.Redirect(&quot;~/Modules/WORKORD/NewACTIWorkOrder.aspx?&quot; + Constants.QRY_PROJECTID + &quot;=&quot; +
                                  (Request.QueryString[Constants.QRY_PROJECTID] ?? string.Empty) + &quot;&amp;&quot; +
                                  WOConstants.QRY_CONTRACTID + &quot;=&quot; +
                                  (Request.QueryString[WOConstants.QRY_CONTRACTID] ?? string.Empty) +
                                  &quot;&amp;ParentContext=CONTMGT&quot;);
            }
            else if (eventString.Equals(&quot;New Equipment Hire Order&quot;))
            {
                Response.Redirect(&quot;~/Modules/WORKORD/NewWorkOrder.aspx?&quot; + Constants.QRY_PROJECTID + &quot;=&quot; +
                                  (Request.QueryString[Constants.QRY_PROJECTID] ?? string.Empty) + &quot;&amp;&quot; +
                                  WOConstants.QRY_CONTRACTID + &quot;=&quot; +
                                  (Request.QueryString[WOConstants.QRY_CONTRACTID] ?? string.Empty) +
                                  &quot;&amp;ParentContext=CONTMGT&amp;WOType=E&quot;);
            }
            else if (eventString.Equals(&quot;Settings&quot;))
            {
                Response.Redirect(
                    string.Format(CultureInfo.CurrentCulture, &quot;~/Modules/WORKORD/Settings.aspx?PID={0}&amp;ContractID={1}&amp;ParentID={1}&quot;,
                                  Request[WOConstants.QRY_PROJECTID], Request[WOConstants.QRY_CONTRACTID]), false);
            }
            else if (eventString.Equals(&quot;Update&quot;))
            {
                //ToDo : Handle this block
                //Code commented temporarily
                /*
                foreach (UltraGridRow ugr in brixGrid.Rows)
                {
                    if (ugr.Cells.Exists(&quot;ExtReference&quot;) &amp;&amp; ugr.Cells.FromKey(&quot;ExtReference&quot;).IsEditable())
                    {
                        string selWONO = ugr.Cells.FromKey(&quot;WorkOrderNo&quot;).Value.ToString();
                        string updatedValue = ugr.Cells.FromKey(&quot;ExtReference&quot;).Value.ToString2();
                        string updateQuery = &quot;UPDATE WORKORDMain SET ExtReference = &#39;&quot; + updatedValue.Replace(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;) + &quot;&#39; \nWHERE WorkOrderNo = &#39;&quot; + selWONO + &quot;&#39;&quot;;
                        ComponentHelper.Instance.ExecuteNonQuery(updateQuery);
                    }
                }
                */
            }
            else
            {
                string selWOID = GetSelectedItemFromGrid();
                int WOID = 0;
                int.TryParse(selWOID, out WOID);
                WorkOrderDTO w = WORKORDManager.Instance.GetWorkOrderDetails(WOID);
                if (eventString.Equals(&quot;Work Order Details&quot;))
                {
                    if (!String.IsNullOrEmpty(selWOID))
                    {
                        //Modified the context for generating EquipmentHireOrder reports
                        if (w.WorkOrderType.Equals(&quot;A&quot;))
                            Response.Redirect(
                               string.Format(CultureInfo.CurrentCulture,
                                             &quot;~/Common/BrixReportPage.aspx?Context=ACTI-WO&amp;MODID=WORKORD&amp;ParentID={0}&amp;WOID={1}&amp;code=WOR&amp;PID={2}&amp;ParentModuleID=CONTMGT&quot;,
                                             Request[&quot;ContractID&quot;], WOID, Request[&quot;PID&quot;]), false);
                        else if (w.WorkOrderType.Equals(&quot;E&quot;))
                            Response.Redirect(
                               string.Format(CultureInfo.CurrentCulture,
                                             &quot;~/Common/BrixReportPage.aspx?Context=HIREQUP&amp;MODID=WORKORD&amp;ParentID={0}&amp;WOID={1}&amp;code=WOR&amp;PID={2}&amp;ParentModuleID=CONTMGT&quot;,
                                             Request[&quot;ContractID&quot;], WOID, Request[&quot;PID&quot;]), false);
                        else
                            Response.Redirect(
                               string.Format(CultureInfo.CurrentCulture,
                                             &quot;~/Common/BrixReportPage.aspx?Context=WORKORD&amp;MODID=WORKORD&amp;ParentID={0}&amp;WOID={1}&amp;code=WOR&amp;PID={2}&amp;ParentModuleID=CONTMGT&quot;,
                                             Request[&quot;ContractID&quot;], WOID, Request[&quot;PID&quot;]), false);
                    }
                    else
                        throw new Exception(&quot;Select Atleast One Record.&quot;);
                }
                else if (eventString.Equals(&quot;Request for Quotation - PDF&quot;))
                {
                    if (!String.IsNullOrEmpty(selWOID))
                    {
                        if (w.WorkOrderType.Equals(&quot;E&quot;))
                            Response.Redirect(
                               string.Format(CultureInfo.CurrentCulture,
                                             &quot;~/Common/BrixReportPage.aspx?Context=HIREQUP&amp;MODID=WORKORD&amp;ParentID={0}&amp;WOID={1}&amp;code=REQFORQUOT&amp;PID={2}&amp;ParentModuleID=CONTMGT&quot;,
                                             Request[&quot;ContractID&quot;], WOID, Request[&quot;PID&quot;]), false);
                        else if (w.WorkOrderType.Equals(&quot;A&quot;))
                            Response.Redirect(
                               string.Format(CultureInfo.CurrentCulture,
                                             &quot;~/Common/BrixReportPage.aspx?Context=ACTI-WO&amp;MODID=WORKORD&amp;ParentID={0}&amp;WOID={1}&amp;code=REQFORQUOT&amp;PID={2}&amp;ParentModuleID=CONTMGT&quot;,
                                             Request[&quot;ContractID&quot;], WOID, Request[&quot;PID&quot;]), false);
                        else
                            Response.Redirect(
                               string.Format(CultureInfo.CurrentCulture,
                                             &quot;~/Common/BrixReportPage.aspx?Context=WORKORD&amp;MODID=WORKORD&amp;ParentID={0}&amp;WOID={1}&amp;code=REQFORQUOT&amp;PID={2}&amp;ParentModuleID=CONTMGT&quot;,
                                             Request[&quot;ContractID&quot;], WOID, Request[&quot;PID&quot;]), false);
                    }
                    else
                        throw new Exception(&quot;Select Atleast One Record.&quot;);
                }
                else if (eventString.Equals(&quot;Close Out&quot;))
                {
                    if (!String.IsNullOrEmpty(selWOID))
                    {
                        #region Validation

                        var selectedRow = MWGrid.GetSelectedRow(mwGrid);
                        if (selectedRow != null)
                        {
                            if (!MWGrid.GetCellValue(selectedRow,&quot;Status&quot;).ToString2().Equals(&quot;Issued&quot;))
                                throw new Exception(&quot;Only an Issued Work Order Instance can be closed.&quot;);
                            if (!MWGrid.GetCellValue(selectedRow,&quot;MaxWOID&quot;).ToString2().Equals(selWOID))
                                throw new Exception(&quot;This Read-Only Work Order Instance cannot be closed.&quot;);
                        }

                        #endregion

                        Response.Redirect(
                           &quot;~/Modules/WORKORD/CloseOut.aspx?PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;WOType={3}&amp;ParentContext=CONTMGT&amp;&quot;
                               .Format2(Request[WOConstants.QRY_PROJECTID], Request[&quot;ContractID&quot;], selWOID,
                                        w.WorkOrderType ?? &quot;W&quot;));

                        isMenuClickHandled = true;
                    }
                }
                else if (eventString.Equals(&quot;Create Version&quot;))
                {
                    string moh = GlobalizationUtility.SetResource(&quot;Pre-Payment&quot;, false);
                    if (!String.IsNullOrEmpty(selWOID))
                    {
                        if (WORKORDManager.Instance.GetWorkOrderDetails(WOID) == null)
                            throw new Exception(&quot;The work order may have been deleted by another user.&quot;);

                        var selectedRow = MWGrid.GetSelectedRow(mwGrid);
                        if (selectedRow != null)
                        {
                            if (!BL.Instance.ShouldModulebeEnabled(WOID, &quot;WORKRAB&quot;))
                                throw new Exception(
                                    &quot;The amendment is in progress for the associated work order. Request denied.&quot;);
                            if (MWGrid.GetCellValue(selectedRow, &quot;IsLatest&quot;).ToString2().ToLower2().Equals(&quot;false&quot;) &amp;&amp;
                                (!MWGrid.GetCellValue(selectedRow, &quot;Status&quot;).ToString2().Equals(&quot;Draft Amendment&quot;))
                                &amp;&amp; (!MWGrid.GetCellValue(selectedRow, &quot;Status&quot;).ToString2().Equals(&quot;Approved Amendment&quot;)))
                                throw new Exception(&quot;Version cannot be created for a read-only work order instance.&quot;);
                            if (!MWGrid.GetCellValue(selectedRow, &quot;Status&quot;).ToString2().Equals(&quot;Issued&quot;))
                                throw new Exception(
                                    &quot;The selected work order instance has not been issued. You can only create a version for an issued work order instance.&quot;);
                            else if (MWGrid.GetCellValue(selectedRow, &quot;Status&quot;).ToString2().Equals(&quot;Closed&quot;))
                                throw new Exception(&quot;A closed work order instance cannot be edited.&quot;);
                        }

                        if (!BL.Instance.ShouldModulebeEnabled(WOID, &quot;WORKVER&quot;))
                        {
                            throw new Exception(&quot;There exists unapproved &quot; + PayEstimateName +
                                                &quot;(s) for the selected work order. Request denied.&quot;);
                        }

                        if (w.WorkOrderType.Equals(&quot;E&quot;))
                            Response.Redirect(
                               string.Format(CultureInfo.CurrentCulture,
                                             &quot;~/Modules/WORKORD/NewWorkOrder.aspx?Type=E&amp;PID={0}&amp;ContractID={1}&amp;WOID={2}&amp;Version=true&amp;ParentContext=CONTMGT&amp;WOType=E&quot;,
                                             Request[WOConstants.QRY_PROJECTID], Request[WOConstants.QRY_CONTRACTID],
                                             WOID), false);
                        else if (w.WorkOrderType.Equals(&quot;A&quot;))
                            Response.Redirect(
                               string.Format(CultureInfo.CurrentCulture,
                                             &quot;~/Modules/WORKORD/NewACTIWorkOrder.aspx?Type=E&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;Version=true&amp;ParentContext=CONTMGT&quot;,
                                             Request[WOConstants.QRY_PROJECTID], Request[WOConstants.QRY_CONTRACTID],
                                             WOID), false);
                        else
                            Response.Redirect(
                               string.Format(CultureInfo.CurrentCulture,
                                             &quot;~/Modules/WORKORD/NewWorkOrder.aspx?Type=E&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;Version=true&amp;ParentContext=CONTMGT&quot;,
                                             Request[WOConstants.QRY_PROJECTID], Request[WOConstants.QRY_CONTRACTID],
                                             WOID), false);
                    }
                    else if (String.IsNullOrEmpty(selWOID))
                        return &quot;Select Atleast One Record.&quot;;
                }
                else if (eventString.Equals(PayEstimateName + &quot; Settings&quot;))
                {
                    if (WOID == 0)
                        throw new Exception(&quot;Please select an issued work order.&quot;);
                    var selectedRow = MWGrid.GetSelectedRow(mwGrid);
                    if (selectedRow != null)
                    {
                        if (!MWGrid.GetCellValue(selectedRow,&quot;Status&quot;).ToString2().Equals(&quot;Issued&quot;))
                            throw new Exception(&quot;Only for an issued work order instance the user can define the &quot; +
                                                PayEstimateName + &quot; settings.&quot;);

                        Response.Redirect(
                           string.Format(CultureInfo.CurrentCulture,
                                         &quot;~/Modules/PAYESTM/Settings.aspx?PID=&quot; + Request[Constants.QRY_PROJECTID] +
                                         &quot;&amp;ContractID=&quot; + Request[WOConstants.QRY_CONTRACTID] + &quot;&amp;ParentID=&quot; + Request[WOConstants.QRY_CONTRACTID] + &quot;&amp;WOID=&quot; + WOID), false);
                    }

                    isMenuClickHandled = true;
                }
                else if (eventString.Equals(PayEstimateName))
                {
                    if (WOID == 0)
                        throw new Exception(&quot;Please select an issued work order.&quot;);
                    var selectedRow = MWGrid.GetSelectedRow(mwGrid);
                    if (selectedRow != null)
                    {
                        if (!MWGrid.GetCellValue(selectedRow,&quot;Status&quot;).ToString2().Equals(&quot;Issued&quot;))
                            throw new Exception(&quot;Only for an issued work order instance the user can create a bill.&quot;);

                        string woType = MWGrid.GetCellValue(selectedRow,&quot;WOType&quot;).ToString2();
                        //Response.Redirect(
                        //string.Format(CultureInfo.CurrentCulture,
                        //              &quot;~/Common/BrixListPage.aspx?context=PAYESTM&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;WOType={3}&quot;,
                        //              Request[Constants.QRY_PROJECTID], Request[WOConstants.QRY_CONTRACTID], WOID,
                        //              woType), false);
                        WOID = WOManager.Instance.GetLatestWorkOrderID(WOID);

                        Response.Redirect(string.Format(CultureInfo.CurrentCulture,
                                         &quot;~/Common/BrixListPage.aspx?context=PROCMGT&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;POType=WORKORD&amp;POTypeInstanceID={2}&quot;,
                                         Request[Constants.QRY_PROJECTID], Request[WOConstants.QRY_CONTRACTID], WOID), false);
                    }

                    isMenuClickHandled = true;
                }

                //else if (eventString.Equals(&quot;Approve&quot;))
                //{
                //    if (!String.IsNullOrEmpty(selWOID))
                //    {
                //        if (w.Status &lt; WOConstants.STAGE_APPROVED || w.Status == WOConstants.STAGE_DRAFT_AMENDMENT)
                //        {
                //            UserDetail ud = UserDetail.GetCurrentUserDetail();
                //            DataTable dt = WOManager.Instance.ApproveWorkOrder(selWOID.ToInt32_2(), SubmitionDate, ud.UID, true, w.WorkOrderType).Tables[0];
                //            if (dt.Rows.Count &gt; 0)
                //                throw new Exception(dt.Rows[0][0].ToString2());
                //        }
                //        else
                //        {
                //            throw new Exception(&quot;Selected Record is Already Approved&quot;);
                //        }
                //    }
                //    else
                //        throw new Exception(&quot;Select Atleast One Record.&quot;);
                //}
                //else if (eventString.Equals(&quot;Unapprove&quot;))
                //{
                //    if (!String.IsNullOrEmpty(selWOID))
                //    {
                //        UserDetail ud = UserDetail.GetCurrentUserDetail();
                //        DataTable dt = WOManager.Instance.ApproveWorkOrder(selWOID.ToInt32_2(), SubmitionDate, ud.UID, false, w.WorkOrderType).Tables[0];
                //        if (dt.Rows.Count &gt; 0)
                //            throw new Exception(dt.Rows[0][0].ToString2());
                //    }
                //    else
                //        throw new Exception(&quot;Select Atleast One Record.&quot;);
                //}
                else if (eventString.Equals(&quot;Receive Quotation&quot;))
                {
                    var selectedRow = MWGrid.GetSelectedRow(mwGrid);
                    if (selectedRow != null)
                    {
                        if (!MWGrid.GetCellValue(selectedRow, &quot;Status&quot;).ToString2().Equals(&quot;Draft&quot;) &amp;&amp;
                            !MWGrid.GetCellValue(selectedRow,&quot;Status&quot;).ToString2().Equals(&quot;Draft Request&quot;) &amp;&amp;
                            !MWGrid.GetCellValue(selectedRow, &quot;Status&quot;).ToString2().Equals(&quot;Draft Amendment&quot;))
                        {
                            if (MWGrid.GetCellValue(selectedRow, &quot;Status&quot;).ToString2().Equals(&quot;Issued&quot;))
                            {
                                if (w.WorkOrderType.Equals(&quot;E&quot;))
                                    Response.Redirect(
                                        string.Format(CultureInfo.CurrentCulture,
                                                      &quot;~/Modules/WORKORD/ViewWO.aspx?&quot; + Constants.QRY_PROJECTID + &quot;=&quot; +
                                                      (Request.QueryString[Constants.QRY_PROJECTID] ?? string.Empty) +
                                                      &quot;&amp;&quot; + WOConstants.QRY_CONTRACTID + &quot;=&quot; +
                                                      (Request.QueryString[WOConstants.QRY_CONTRACTID] ?? string.Empty) +
                                                      &quot;&amp;WOID={0}&amp;ParentContext=CONTMGT&amp;WOType=E&amp;Tab={1}&quot;, WOID, WOConstants.TAB_QUOT), false);
                                else if (w.WorkOrderType.Equals(&quot;A&quot;))
                                    Response.Redirect(
                                        string.Format(CultureInfo.CurrentCulture,
                                                      &quot;~/Modules/WORKORD/ViewACTIWO.aspx?&quot; + Constants.QRY_PROJECTID + &quot;=&quot; +
                                                      (Request.QueryString[Constants.QRY_PROJECTID] ?? string.Empty) +
                                                      &quot;&amp;&quot; + WOConstants.QRY_CONTRACTID + &quot;=&quot; +
                                                      (Request.QueryString[WOConstants.QRY_CONTRACTID] ?? string.Empty) +
                                                      &quot;&amp;WOID={0}&amp;ParentContext=CONTMGT&amp;Tab={1}&quot;, WOID, WOConstants.TAB_QUOT), false);
                                else
                                    Response.Redirect(
                                        string.Format(CultureInfo.CurrentCulture,
                                                      &quot;~/Modules/WORKORD/ViewWO.aspx?&quot; + Constants.QRY_PROJECTID + &quot;=&quot; +
                                                      (Request.QueryString[Constants.QRY_PROJECTID] ?? string.Empty) +
                                                      &quot;&amp;&quot; + WOConstants.QRY_CONTRACTID + &quot;=&quot; +
                                                      (Request.QueryString[WOConstants.QRY_CONTRACTID] ?? string.Empty) +
                                                      &quot;&amp;WOID={0}&amp;ParentContext=CONTMGT&amp;Tab={1}&quot;, WOID, WOConstants.TAB_QUOT), false);
                            }
                            else
                            {
                                if (w.WorkOrderType.Equals(&quot;E&quot;))
                                    Response.Redirect(
                                       string.Format(CultureInfo.CurrentCulture,
                                                     &quot;~/Modules/WORKORD/NewWorkOrder.aspx?Type=E&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;ParentContext=CONTMGT&amp;Tab={3}&amp;WOType=E&quot;,
                                                     Request[WOConstants.QRY_PROJECTID],
                                                     Request[WOConstants.QRY_CONTRACTID], WOID, WOConstants.TAB_QUOT),
                                       false);
                                else if (w.WorkOrderType.Equals(&quot;A&quot;))
                                    Response.Redirect(
                                       string.Format(CultureInfo.CurrentCulture,
                                                     &quot;~/Modules/WORKORD/NewACTIWorkOrder.aspx?Type=E&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;ParentContext=CONTMGT&amp;Tab={3}&quot;,
                                                     Request[WOConstants.QRY_PROJECTID],
                                                     Request[WOConstants.QRY_CONTRACTID], WOID, WOConstants.TAB_QUOT),
                                       false);
                                else
                                    Response.Redirect(
                                       string.Format(CultureInfo.CurrentCulture,
                                                     &quot;~/Modules/WORKORD/NewWorkOrder.aspx?Type=E&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;ParentContext=CONTMGT&amp;Tab={3}&quot;,
                                                     Request[WOConstants.QRY_PROJECTID],
                                                     Request[WOConstants.QRY_CONTRACTID], WOID, WOConstants.TAB_QUOT),
                                       false);
                            }
                        }
                        else
                            throw new Exception(&quot;Please approve the record before going to receive quotation&quot;);
                    }
                    else
                        return &quot;Select Atleast One Record.&quot;;
                }
                else if (eventString.Equals(&quot;Hired Equipments&quot;))
                {
                    var selectedRow = MWGrid.GetSelectedRow(mwGrid);
                    if (!String.IsNullOrEmpty(selWOID) &amp;&amp; w.WorkOrderType.Equals(&quot;E&quot;) &amp;&amp;
                      MWGrid.GetCellValue(selectedRow, &quot;Status&quot;).ToString2().Equals(&quot;Issued&quot;))
                    {
                        WOID = WOManager.Instance.GetLatestWorkOrderID(WOID);
                        Response.Redirect(
                           string.Format(CultureInfo.CurrentCulture,
                                         &quot;~/Common/BrixListPage.aspx?context=HIREQUP&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&quot;,
                                         Request[WOConstants.QRY_PROJECTID], Request[WOConstants.QRY_CONTRACTID], WOID),
                           false);
                    }
                    else
                        return &quot;Select an issued equipment hire order.&quot;;
                }
                else if (eventString.Equals(&quot;Retention Release&quot;))
                {
                    var selectedRow = MWGrid.GetSelectedRow(mwGrid);
                    if (selectedRow != null)
                    {
                        if (!String.IsNullOrEmpty(selWOID) &amp;&amp;
                            MWGrid.GetCellValue(selectedRow, &quot;Status&quot;).ToString2().Equals(&quot;Closed&quot;) &amp;&amp;
                            (MWGrid.GetCellValue(selectedRow, &quot;HasFinalPE&quot;).ToString2().Equals(&quot;True&quot;) ||
                             MWGrid.GetCellValue(selectedRow, &quot;HasFinalPE&quot;).ToString2().Equals(&quot;1&quot;)))
                        {
                            if (MWGrid.ColumnExists(selectedRow, &quot;RetentionReleaseDate&quot;) &amp;&amp;
                                MWGrid.GetCellValue(selectedRow, &quot;RetentionReleaseDate&quot;).ToDateTime_MWCulture().Date &gt; MWDateTimeHelper.MWToday)
                                return
                                    &quot;Cannot create retention release before the retention release date mentioned in the final &quot; +
                                    PayEstimateName + &quot; for the selected work order.&quot;;
                            WOID = WOManager.Instance.GetLatestWorkOrderID(WOID);
                            Response.Redirect(
                               string.Format(CultureInfo.CurrentCulture,
                                             &quot;~/Common/BrixListPage.aspx?context=RETNRLS&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&quot;,
                                             Request[WOConstants.QRY_PROJECTID], Request[WOConstants.QRY_CONTRACTID],
                                             WOID), false);
                        }
                        else
                            return
                                &quot;The work order is not closed and final &quot; + LocalizationManager.GetString(KeyConstants.LOC_PAY_ESTIMATE) + &quot; is not approved for the selected work order. Request denied.&quot;;
                    }
                }
                else if (eventString.Equals(&quot;Checklists&quot;))
                {
                    var selectedRow = MWGrid.GetSelectedRow(mwGrid);
                    if (selectedRow != null)
                    {
                        WOID = WOManager.Instance.GetLatestWorkOrderID(WOID);
                        string isReadOnly = &quot;N&quot;;

                        if (MWGrid.GetCellValue(selectedRow, &quot;Status&quot;).ToString2().Equals(&quot;Closed&quot;) ||
                            MWGrid.GetCellValue(selectedRow, &quot;Status&quot;).ToString2().Equals(&quot;Issued&quot;))
                            isReadOnly = &quot;Y&quot;;

                        Response.Redirect(
                           string.Format(CultureInfo.CurrentCulture,
                                         &quot;~/Common/BrixChecklist.aspx?Context=WORKORD&amp;PID=&quot; +
                                         Request[WOConstants.QRY_PROJECTID] + &quot;&amp;ParentID=&quot; + WOID + &quot;&amp;IsReadOnly=&quot; +
                                         isReadOnly + &quot;&amp;ContractID=&quot; + Request[WOConstants.QRY_CONTRACTID]), false);
                    }
                    else
                        return &quot;Select a work order.&quot;;
                }
                else if (eventString.Equals(&quot;Pre-Payment&quot;))
                {
                    var selectedRow = MWGrid.GetSelectedRow(mwGrid);
                    if (!String.IsNullOrEmpty(selWOID))
                    {
                        if (MWGrid.GetCellValue(selectedRow, &quot;Status&quot;).ToString2().Equals(&quot;Issued&quot;))
                        {
                            WOID = WOManager.Instance.GetLatestWorkOrderID(WOID);
                            DataTable dtPrepaymentRules =
                                WORKORDManager.Instance.GetRecoveryRetentionDetails(WOConstants.MODULE_NAME,
                                                                                    selWOID.ToInt32_2()).Tables[0];
                            if (dtPrepaymentRules.Rows.Count &gt; 0)
                                Response.Redirect(
                                   string.Format(CultureInfo.CurrentCulture,
                                                 &quot;~/Common/BrixListPage.aspx?context=CONTMOH&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&quot;,
                                                 Request[WOConstants.QRY_PROJECTID],
                                                 Request[WOConstants.QRY_CONTRACTID], WOID), false);
                            else
                                throw new Exception(
                                    &quot;The work order does not have Pre-Payment rules associated with it. Request denied.&quot;);
                        }
                        else
                            throw new Exception(
                                &quot;Only for an issued work order instance the user can define the Pre-Payments.&quot;);
                    }
                    else
                        throw new Exception(&quot;Select Atleast One Record.&quot;);
                }
                else if (eventString.Equals(&quot;Pre-Payment Settings&quot;))
                {
                    var selectedRow = MWGrid.GetSelectedRow(mwGrid);
                    if (!string.IsNullOrEmpty(selWOID))
                    {
                        if (!MWGrid.GetCellValue(selectedRow, &quot;Status&quot;).ToString2().Equals(&quot;Issued&quot;))
                            throw new Exception(
                                &quot;Only for an issued work order instance the user can define the Pre-Payment settings.&quot;);
                        else
                        {
                            WOID = WOManager.Instance.GetLatestWorkOrderID(WOID);
                            //DataTable dtPrepaymentRules = WORKORDManager.Instance.GetRecoveryRetentionDetails(WOConstants.MODULE_NAME, selWOID.ToInt32_2()).Tables[0];
                            //if (dtPrepaymentRules.Rows.Count &gt; 0)
                            Response.Redirect(
                                 string.Format(CultureInfo.CurrentCulture,
                                               &quot;~/Modules/CONTMOH/Settings.aspx?PID=&quot; + Request[Constants.QRY_PROJECTID] +
                                               &quot;&amp;ContractID=&quot; + Request[WOConstants.QRY_CONTRACTID] + &quot;&amp;ParentID=&quot; + Request[WOConstants.QRY_CONTRACTID] + &quot;&amp;WOID=&quot; + WOID + &quot;&amp;WONo=&quot; + MWGrid.GetCellValue(selectedRow, &quot;WorkOrderNo&quot;).ToString2()),
                                 false);
                            //else
                            //    throw new Exception(&quot;The work order does not have prepayment rules associated with it. Request denied.&quot;);
                        }
                    }
                    else
                        throw new Exception(&quot;Select Atleast One Record.&quot;);
                }
                else if (eventString.Equals(&quot;Material On Hand&quot;))
                {
                    if (!string.IsNullOrEmpty(selWOID))
                    {
                        var selectedRow = MWGrid.GetSelectedRow(mwGrid);
                        if (!MWGrid.GetCellValue(selectedRow, &quot;Status&quot;).ToString2().Equals(&quot;Issued&quot;))
                            throw new Exception(
                                &quot;Only for an issued work order instance the user can define the Pre-Payment settings.&quot;);
                        else
                        {
                            WOID = WOManager.Instance.GetLatestWorkOrderID(WOID);
                            Response.Redirect(
                               string.Format(
                                   &quot;~/Common/BrixListPage.aspx?context=MONHAND&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&quot;,
                                   Request[Constants.QRY_PROJECTID], Request[WOConstants.QRY_CONTRACTID], WOID));
                        }
                    }
                }
                else if (eventString.Equals(&quot;Copy&quot;))
                {
                    //Call an SP pass work order id 
                    //Copy the existing work order major attributes and create a new WO
                    //Get the new work order id and attach workflow
                    //Redirect to Edit page
                    if (!String.IsNullOrEmpty(selWOID))
                    {
                        if (WORKORDManager.Instance.GetWorkOrderDetails(WOID) == null)
                            throw new Exception(&quot;The work order may have been deleted by another user.&quot;);

                        Response.Redirect(
                               string.Format(CultureInfo.CurrentCulture,
                                             &quot;~/Modules/WORKORD/NewWorkOrder.aspx?IsCopy=true&amp;PID={0}&amp;ContractID={1}&amp;WOID={2}&amp;ParentContext=CONTMGT&quot;,
                                             Request[WOConstants.QRY_PROJECTID], Request[WOConstants.QRY_CONTRACTID],
                                             WOID), false);
                    }
                    else if (String.IsNullOrEmpty(selWOID))
                        return &quot;Select Atleast One Record.&quot;;
                }
                else
                {
                    return base.HandleMenuItem(eventString);
                }
            }
            return retVal;
        }

        private void SetWOGridColumns(UltraWebGrid grid, WorkOrderDTO WODTO)
        {
            ColumnsCollection cols = grid.Columns;
            // Formatting for Equipment Hire Order
            if (WODTO.WorkOrderType.Equals(&quot;E&quot;))
            {
                cols.FromKey(&quot;EquipmentID&quot;).Hidden = true;
                cols.FromKey(&quot;UnitID&quot;).Hidden = true;
                if (WODTO != null &amp;&amp;
                    (WODTO.Status &lt; WOConstants.STAGE_ISSUED || WODTO.Status == WOConstants.STAGE_DRAFT_AMENDMENT ||
                     WODTO.Status == WOConstants.STAGE_APPROVE_AMENDMENT))
                {
                    cols.FromKey(&quot;ActualUnitCost&quot;).Hidden = true;
                    cols.FromKey(&quot;WorkOrderAmount&quot;).Hidden = true;
                }
                else if (WODTO != null)
                {
                    cols.FromKey(&quot;ActualUnitCost&quot;).Header.Caption = &quot;Work Order Unit Cost in &quot; +
                                                                    LocalizationManager.GetString(
                                                                        KeyConstants.LOC_CURRENCY_SYMBOL);
                    cols.FromKey(&quot;WorkOrderAmount&quot;).Header.Caption = &quot;Work Order Amount in &quot; +
                                                                     LocalizationManager.GetString(
                                                                         KeyConstants.LOC_CURRENCY_SYMBOL);

                    cols.FromKey(&quot;ActualUnitCost&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;
                    cols.FromKey(&quot;ActualUnitCost&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                    cols.FromKey(&quot;WorkOrderAmount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                    cols.FromKey(&quot;WorkOrderAmount&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                }
                cols.FromKey(&quot;Number&quot;).Header.Caption = &quot;No. of Equipments Required&quot;;
                cols.FromKey(&quot;EstimatedUnitCost&quot;).Header.Caption = &quot;Estimated Unit Cost in &quot; +
                                                                   LocalizationManager.GetString(
                                                                       KeyConstants.LOC_CURRENCY_SYMBOL);
                cols.FromKey(&quot;EstimatedAmount&quot;).Header.Caption = &quot;Estimated Amount in &quot; +
                                                                 LocalizationManager.GetString(
                                                                     KeyConstants.LOC_CURRENCY_SYMBOL);

                cols.FromKey(&quot;Duration&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                cols.FromKey(&quot;Duration&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;Quantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                cols.FromKey(&quot;Quantity&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;EstimatedUnitCost&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;
                cols.FromKey(&quot;EstimatedUnitCost&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;EstimatedAmount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                cols.FromKey(&quot;EstimatedAmount&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
            }
            else
            {
                if (WODTO.WorkOrderType.Equals(&quot;A&quot;))
                {
                    // for activity based work order
                    cols.FromKey(&quot;UnitPrice&quot;).Hidden = true;
                    cols.FromKey(&quot;Quantity&quot;).Hidden = true;
                    cols.FromKey(&quot;SubItemID&quot;).Hidden = true;
                    cols.FromKey(&quot;SubItem&quot;).Header.Caption = &quot;Sub Item&quot;;
                    cols.FromKey(&quot;ActivityName&quot;).Header.Caption = &quot;Activity&quot;;
                    cols.FromKey(&quot;ActivityID&quot;).Hidden = true;
                }
                else
                {
                    // for normal work order
                    cols.FromKey(&quot;AvailableQuantity&quot;).Header.Caption = &quot;Available Quantity&quot;;

                    if (WODTO != null &amp;&amp; WODTO.Status &gt;= WOConstants.STAGE_ISSUED)
                    {
                        cols.FromKey(&quot;UnitPrice&quot;).Hidden = false;
                        cols.FromKey(&quot;UnitPrice&quot;).Header.Caption = &quot;Rate&quot;;
                        cols.FromKey(&quot;UnitPrice&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;
                        cols.FromKey(&quot;UnitPrice&quot;).AllowUpdate = AllowUpdate.Yes;
                        cols.FromKey(&quot;UnitPrice&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                        cols.FromKey(&quot;UnitPrice&quot;).CellStyle.BackColor = Color.Yellow;
                    }
                    else
                    {
                        cols.FromKey(&quot;UnitPrice&quot;).Hidden = true;
                    }
                    if ((grid.Columns.FromKey(&quot;UnitPrice&quot;) == null) || (grid.Columns.FromKey(&quot;UnitPrice&quot;).Hidden))
                    {
                        //colExists = false;
                        //grid.Columns.Add(new UltraGridColumn(&quot;Rate&quot;, &quot;Rate&quot;, ColumnType.NotSet, &quot;0.0000&quot;), true);
                        //grid.Columns.FromKey(&quot;Rate&quot;).Format = Constants.FORMAT_UNIT_PRICE;
                        //grid.Columns.FromKey(&quot;Rate&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                        //grid.Columns.FromKey(&quot;Rate&quot;).CellStyle.BackColor = System.Drawing.Color.Yellow;
                    }
                    else
                    {
                        grid.Columns.FromKey(&quot;UnitPrice&quot;).Move(grid.Columns.FromKey(&quot;UnitPrice&quot;).Index + 1);
                    }
                }
                // form both
                cols.FromKey(&quot;ItemID&quot;).Hidden = true;
                cols.FromKey(&quot;LineNo&quot;).Header.Caption = &quot;Line No.&quot;;
                cols.FromKey(&quot;StandardItemNo.&quot;).Header.Caption = &quot;Standard Item No.&quot;;

                if (cols.Exists(&quot;WOQuantity&quot;))
                {
                    cols.FromKey(&quot;WOQuantity&quot;).Header.Caption = &quot;WO Quantity&quot;;
                    cols.FromKey(&quot;WOQuantity&quot;).AllowUpdate = AllowUpdate.Yes;
                    cols.FromKey(&quot;WOQuantity&quot;).CellStyle.HorizontalAlign = HorizontalAlign.Right;
                    cols.FromKey(&quot;WOQuantity&quot;).CellStyle.BackColor = Color.Yellow;
                }
            }
        }

        public override string HandleMenuItems(string eventString,
                                               UltraWebGridExcelExporter UltraWebGridExcelExporter1, string filter = &quot;&quot;)
        {
            string error = String.Empty;
            switch (eventString)
            {
                case &quot;Request for Quotation â€“ Excel&quot;:
                    string selWOID = GetSelectedItemFromGrid();
                    if (String.IsNullOrEmpty(selWOID))
                    {
                        error = &quot;Select Atleast One Record.&quot;;
                        break;
                    }
                    try
                    {
                        int WOID = 0;
                        int.TryParse(selWOID, out WOID);

                        #region Exporting the Excel Sheet

                        WorkOrderDTO WODTO = WOManager.Instance.GetWorkOrderDetails(WOID);

                        if (WODTO.WorkOrderType.Equals(&quot;E&quot;))
                        {
                            UltraWebGridExcelExporter1.WorksheetName = &quot;Equipment Hire Order Equipments&quot;;
                            UltraWebGridExcelExporter1.DownloadName = WODTO.WorkOrderNo + &quot;_Equipments.XLS&quot;;
                            WODTO.WorkOrderItems.Tables[0].TableName = &quot;Equipment&quot;;
                        }
                        else
                        {
                            UltraWebGridExcelExporter1.WorksheetName = &quot;Work Order &quot; + ItemNameAbbr + &quot;s&quot;;
                            UltraWebGridExcelExporter1.DownloadName = WODTO.WorkOrderNo + &quot;_&quot; + ItemNameAbbr + &quot;s.XLS&quot;;
                            WODTO.WorkOrderItems.Tables[0].TableName = ItemNameAbbr;
                        }

                        var grid = new UltraWebGrid(&quot;grd_Temp&quot;);

                        var book = new Workbook();
                        if (WODTO.WorkOrderType.Equals(&quot;A&quot;))
                        {
                            //When there are no activities in the WO, instead of opening a blank Excel file, the alert message is shown.
                            if (WODTO.WorkOrderActivities.Tables[0].Rows.Count == 0)
                            {
                                throw new Exception(&quot;No activities are attached to the work order.&quot;);
                            }
                            UltraWebGridExcelExporter1.WorksheetName =
                                WODTO.WorkOrderActivities.Tables[0].TableName = &quot;Activities&quot;;
                            //grid.DisplayLayout.ViewType = ViewType.OutlookGroupBy;
                            var selectedRow = MWGrid.GetSelectedRow(mwGrid);

                            foreach (DataRow dr in WODTO.WorkOrderActivities.Tables[0].Rows)
                            {
                                if (MWGrid.GetCellValue(selectedRow, &quot;IsQuotationAwarded&quot;).ToBoolean2())
                                {
                                    dr[&quot;Amount&quot;] = Convert.ToDecimal(dr[&quot;UnitCost&quot;]) *
                                                   Convert.ToDecimal(dr[&quot;Quantity&quot;]);
                                }
                                else
                                {
                                    dr[&quot;Amount&quot;] = Convert.ToDecimal(dr[&quot;ContractUnitCost&quot;]) *
                                                   Convert.ToDecimal(dr[&quot;Quantity&quot;]);
                                }
                            }
                            grid.DataSource = WODTO.WorkOrderActivities.Tables[0];
                            grid.DataBind();

                            string costColumn = &quot;ContractUnitCost&quot;;
                            if (MWGrid.GetCellValue(selectedRow, &quot;IsQuotationAwarded&quot;).ToBoolean2())
                                costColumn = &quot;UnitCost&quot;;

                            ColumnsCollection cols = grid.Columns;

                            (new List&lt;string&gt;
                                 {
                                     &quot;WorkOrderID&quot;,
                                     &quot;ActivityID&quot;,
                                     &quot;Amt&quot;,
                                     &quot;ActID&quot;,
                                     (costColumn == &quot;ContractUnitCost&quot; ? &quot;UnitCost&quot; : &quot;ContractUnitCost&quot;),
                                     &quot;UnitID&quot;,
                                     &quot;TempID&quot;,
                                     &quot;PreVerActID&quot;,
                                     &quot;Number&quot;,
                                     &quot;Length&quot;,
                                     &quot;Width&quot;,
                                     &quot;Height&quot;
                                 }).ForEach(x =&gt;
                                                {
                                                    if (cols.Exists(x))
                                                        cols.FromKey(x).Hidden = true;
                                                });
                            cols.FromKey(&quot;ActivityName&quot;).Header.Caption = &quot;Activity&quot;;

                            cols.FromKey(costColumn).Header.Caption = &quot;Unit Cost&quot;;
                            cols.FromKey(costColumn).Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;
                            cols.FromKey(costColumn).CellStyle.HorizontalAlign = HorizontalAlign.Right;

                            //cols.FromKey(&quot;Number&quot;).Format = Constants.FORMAT_AMOUNT;
                            //cols.FromKey(&quot;Length&quot;).Format = Constants.FORMAT_AMOUNT;
                            //cols.FromKey(&quot;Length&quot;).Header.Caption = AMP3ApplicationSettings.Instance.Dim1Title;
                            //cols.FromKey(&quot;Width&quot;).Format = Constants.FORMAT_AMOUNT;
                            //cols.FromKey(&quot;Width&quot;).Header.Caption = AMP3ApplicationSettings.Instance.Dim2Title;
                            //cols.FromKey(&quot;Height&quot;).Format = Constants.FORMAT_AMOUNT;
                            //cols.FromKey(&quot;Height&quot;).Header.Caption = AMP3ApplicationSettings.Instance.Dim3Title;

                            cols.FromKey(&quot;Quantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                            cols.FromKey(&quot;Amount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;

                            //grid.Columns.FromKey(&quot;ActivityName&quot;).IsGroupByColumn = true;
                            book = UltraWebGridExcelExporter1.Export(grid);
                            grid.Rows.Clear();
                            grid.Columns.Clear();
                            grid.DataSource = WODTO.WorkOrderItems.Tables[0];
                            grid.DataBind();
                        }
                        //When there are no Items in the WO, instead of opening a blank Excel file, the alert message is shown.
                        else if (WODTO.WorkOrderType.Equals(&quot;E&quot;))
                        {
                            if (WODTO.WorkOrderItems.Tables[0].Rows.Count == 0)
                            {
                                throw new Exception(&quot;No Equipments are attached to the work order.&quot;);
                            }

                            DataTable dtEquipment = WODTO.WorkOrderItems.Tables[0];
                            grid.DataSource = dtEquipment;
                            grid.DataBind();
                        }
                        else
                        {
                            if (WODTO.WorkOrderItems.Tables[0].Rows.Count == 0)
                            {
                                throw new Exception(&quot;No &quot; + ItemNameAbbr + &quot;s are attached to the work order.&quot;);
                            }

                            DataTable dt = WODTO.WorkOrderItems.Tables[0];
                            foreach (DataRow dr in dt.Rows)
                            {
                                if (WODTO != null &amp;&amp; WODTO.Status &gt;= WOConstants.STAGE_ISSUED &amp;&amp;
                                    WODTO.Status != WOConstants.STAGE_DRAFT_AMENDMENT &amp;&amp;
                                    WODTO.Status != WOConstants.STAGE_APPROVE_AMENDMENT)
                                {
                                    dr[&quot;Amount&quot;] = Convert.ToDecimal(dr[&quot;UnitPrice&quot;]) *
                                                   Convert.ToDecimal(dr[&quot;WOQuantity&quot;]);
                                }
                                else
                                {
                                    dr[&quot;Amount&quot;] = Convert.ToDecimal(dr[&quot;ContractUnitPrice&quot;]) *
                                                   Convert.ToDecimal(dr[&quot;WOQuantity&quot;]);
                                }
                            }

                            grid.DataSource = dt;
                            grid.DataBind();
                            var selectedRow = MWGrid.GetSelectedRow(mwGrid);
                            string costColumn = &quot;ContractUnitPrice&quot;;
                            if (MWGrid.GetCellValue(selectedRow, &quot;IsQuotationAwarded&quot;).ToBoolean2())
                                costColumn = &quot;UnitPrice&quot;;

                            ColumnsCollection cols = grid.Columns;

                            (new List&lt;string&gt; { (costColumn == &quot;ContractUnitPrice&quot; ? &quot;UnitPrice&quot; : &quot;ContractUnitPrice&quot;) })
                                .ForEach(x =&gt;
                                             {
                                                 if (cols.Exists(x))
                                                     cols.FromKey(x).Hidden = true;
                                             });
                        }

                        SetWOGridColumns(grid, WODTO);

                        if (WODTO.WorkOrderType.Equals(&quot;A&quot;))
                        {
                            book.Worksheets.Add(ItemNameAbbr);
                            UltraWebGridExcelExporter1.Export(grid, book.Worksheets[ItemNameAbbr]);
                        }
                        else
                            book = UltraWebGridExcelExporter1.Export(grid);

                        #endregion
                    }
                    catch (Exception ex)
                    {
                        error = ex.Message;
                    }
                    break;
                default:
                    error = HandleMenuItem(eventString);
                    break;
            }
            return error;
        } 

        public override void SetHierarchicalGridProperties(DataSet sourceDataSet)
        {
            //ToDo: HierarchicalGrid not handled. Revisit this block
            //Code temporarily commented 
        /*
            setGridColumns(brixGrid.Bands[0].Columns);
            brixGrid.Bands[0].ColHeadersVisible = ShowMarginInfo.Yes;
            brixGrid.Bands[0].Indentation = 25;
            brixGrid.Bands[0].IndentationType = IndentationType.Flat;
            brixGrid.Bands[0].RowExpAreaStyle.Width = Unit.Pixel(0);
            if (!IsExternalReferenceEditable)
                brixGrid.Bands[0].Columns.FromKey(&quot;ExtReference&quot;).Hidden = true;

            if (HasHierarchicalGrid &amp;&amp; sourceDataSet.Tables.Count &gt; 1 &amp;&amp; sourceDataSet.Tables[1].Rows.Count &gt; 0)
            {
                if (!IsExternalReferenceEditable)
                    brixGrid.Bands[1].Columns.FromKey(&quot;ExtReference&quot;).Hidden = true;
                setGridColumns(brixGrid.Bands[1].Columns);
                brixGrid.Bands[1].SelectTypeRow = SelectType.Single;
                brixGrid.Bands[1].Indentation = 25;
                brixGrid.Bands[1].IndentationType = IndentationType.Indented;
                brixGrid.Bands[1].RowSelectors = RowSelectors.No;
                brixGrid.Bands[1].RowExpAreaStyle.Width = Unit.Pixel(0);
                brixGrid.Bands[1].ColHeadersVisible = ShowMarginInfo.No;
            }
         */
        }

        private void setGridColumns(ColumnsCollection cols)
        {
            cols.FromKey(&quot;ParentID&quot;).Hidden = true;
            if (cols.Exists(&quot;WOType&quot;)) cols.FromKey(&quot;WOType&quot;).Hidden = true;
            if (cols.Exists(&quot;HasFinalPE&quot;)) cols.FromKey(&quot;HasFinalPE&quot;).Hidden = true;
            cols.FromKey(&quot;WorkOrderNo&quot;).HTMLEncodeContent = true;
            cols.FromKey(&quot;WorkOrderNo&quot;).Header.Caption = &quot;Work Order No.&quot;;
            cols.FromKey(&quot;WithMaterial&quot;).Header.Caption = &quot;With Material&quot;;
            List&lt;string&gt; coreComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);
            if (!coreComponents.Contains(&quot;RateAnalysis&quot;))
            {
                cols.FromKey(&quot;WithMaterial&quot;).Hidden = true;
            }

            cols.FromKey(&quot;WorkOrderID&quot;).Hidden = true;
            cols.FromKey(&quot;ContractID&quot;).Hidden = true;
            cols.FromKey(&quot;ContractorID&quot;).Hidden = true;
            cols.FromKey(&quot;IsLatest&quot;).Hidden = true;
            if (cols.Exists(&quot;MaxWOID&quot;)) cols.FromKey(&quot;MaxWOID&quot;).Hidden = true;

            if (cols.Exists(&quot;WorkOrderDate&quot;))
            {
                cols.FromKey(&quot;WorkOrderDate&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_DATE;
                cols.FromKey(&quot;WorkOrderDate&quot;).Header.Caption = &quot;Work Order Date&quot;;
            }
            if (cols.Exists(&quot;VersionNo&quot;))
            {
                cols.FromKey(&quot;VersionNo&quot;).Header.Caption = &quot;Version Number&quot;;
                //cols.FromKey(&quot;VersionNo&quot;).Move(cols.FromKey(&quot;WorkOrderNo&quot;).Index + 1);
            }

            if (cols.Exists(&quot;Contractor&quot;))
            {
                cols.FromKey(&quot;Contractor&quot;).Header.Caption = &quot;Sub Contractor&quot;;
            }

            if (cols.Exists(&quot;TotalAmount&quot;))
            {
                cols.FromKey(&quot;TotalAmount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                cols.FromKey(&quot;TotalAmount&quot;).Header.Caption = &quot;WO Amount&quot;;
                cols.FromKey(&quot;TotalAmount&quot;).CellStyle.HorizontalAlign =
                    cols.FromKey(&quot;TotalAmount&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;TotalAmount&quot;).CellStyle.Padding.Right =
                    cols.FromKey(&quot;TotalAmount&quot;).Header.Style.Padding.Right = new Unit(&quot;2px&quot;);
            }

            if (cols.Exists(&quot;EstAmount&quot;))
            {
                cols.FromKey(&quot;EstAmount&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                cols.FromKey(&quot;EstAmount&quot;).Header.Caption = &quot;Estimated Amount&quot;;
                cols.FromKey(&quot;EstAmount&quot;).CellStyle.HorizontalAlign =
                    cols.FromKey(&quot;EstAmount&quot;).Header.Style.HorizontalAlign = HorizontalAlign.Right;
                cols.FromKey(&quot;EstAmount&quot;).CellStyle.Padding.Right =
                    cols.FromKey(&quot;EstAmount&quot;).Header.Style.Padding.Right = new Unit(&quot;2px&quot;);
            }
            if (cols.Exists(&quot;RowNum&quot;))
                cols.FromKey(&quot;RowNum&quot;).Hidden = true;
            if (cols.Exists(&quot;RetentionReleaseDate&quot;))
                cols.FromKey(&quot;RetentionReleaseDate&quot;).Hidden = true;
            if (cols.Exists(&quot;IsQuotationAwarded&quot;))
                cols.FromKey(&quot;IsQuotationAwarded&quot;).Hidden = true;


        }

        public override Brix.Platform.BusinessLayer.BL.CIDictionary HierarchicalGridColumnMapping
        {
            get
            {
                Brix.Platform.BusinessLayer.BL.CIDictionary mapping = new Brix.Platform.BusinessLayer.BL.CIDictionary();
                mapping.Add(&quot;WorkOrderNo&quot;, &quot;WorkOrderNo&quot;);
                mapping.Add(&quot;VersionNo&quot;, &quot;VersionNo&quot;);
                if (IsExternalReferenceEditable)
                    mapping.Add(&quot;ExtReference&quot;, &quot;ExtReference&quot;);
                mapping.Add(&quot;WorkOrderDate&quot;, &quot;WorkOrderDate&quot;);
                mapping.Add(&quot;Status&quot;, &quot;Status&quot;);
                mapping.Add(&quot;Type&quot;, &quot;Type&quot;);
                mapping.Add(&quot;WithMaterial&quot;, &quot;WithMaterial&quot;);
                mapping.Add(&quot;Contractor&quot;, &quot;Contractor&quot;);
                mapping.Add(&quot;CreatedBy&quot;, &quot;CreatedBy&quot;);
                mapping.Add(&quot;TotalAmount&quot;, &quot;TotalAmount&quot;);
                mapping.Add(&quot;EstAmount&quot;, &quot;EstAmount&quot;);
                mapping.Add(&quot;Description&quot;, &quot;Description&quot;);
                mapping.Add(&quot;WF_Status&quot;, &quot;WF_Status&quot;);
                mapping.Add(&quot;WF_PendingOnRole&quot;, &quot;WF_PendingOnRole&quot;);
                return mapping;
            }
        }

        public override DataSet GetList(int pageSize, string sortOrder, string filter, ref int CurrentPage,
                                        out int count)
        {
            #region Override SortOrder for Image Cols

            sortOrder = string.IsNullOrEmpty(sortOrder) ? DefaultSortColumn + &quot; DESC&quot; : sortOrder;
            //sortOrder = DefaultSortColumn + &quot; DESC&quot;;

            if (!string.IsNullOrEmpty(sortOrder) &amp;&amp; sortOrder.Contains(&quot;img_&quot;))
                sortOrder = sortOrder.Replace(&quot;img_&quot;, string.Empty);
            sortOrder = sortOrder.Split(new char[1] { &#39; &#39; }, StringSplitOptions.RemoveEmptyEntries)[0].Trim() + &quot; &quot; +
                        sortOrder.Split(new char[1] { &#39; &#39; }, StringSplitOptions.RemoveEmptyEntries)[1].Trim();

            #endregion

            int contractID = 0;
            if (String.IsNullOrEmpty(Request[&quot;ContractID&quot;]) || String.IsNullOrEmpty(Request[&quot;PID&quot;]))
                Response.Redirect(&quot;~/Common/BrixListPage.aspx?context=PROJECT&quot;, true);
            else
                int.TryParse(Request[&quot;ContractID&quot;], out contractID);

            DataSet dsWO = WORKORDManager.Instance.GetWOList(contractID,
                                                             (1 + (pageSize * (CurrentPage == 0 ? 0 : CurrentPage - 1))),
                                                             pageSize, sortOrder, filter);
            DataTable dtParent = dsWO.Tables[0], dtChild = dsWO.Tables[1];

            if (dtParent.Rows.Count &gt; 0)
            {
                if (dtChild.Rows.Count &gt; 0)
                {
                    var dr =
                        new DataRelation(&quot;ParentChild&quot;, dsWO.Tables[0].Columns[&quot;WorkOrderID&quot;],
                                         dsWO.Tables[1].Columns[&quot;ParentID&quot;]);
                    dsWO.Relations.Add(dr);
                }
            }
            else
            {
                if (dtChild.Rows.Count &gt; 0)
                {
                    //Case when filtered on close out
                    dsWO.Tables.Remove(dtParent);
                }
            }

            int rowCount = WORKORDManager.Instance.GetWOCount(contractID, filter);
            if ((rowCount % pageSize) == 0)
                count = rowCount / pageSize;
            else
                count = rowCount / pageSize + 1;
            if (count == 0) CurrentPage = 0;
            return dsWO;
        }

        public override void ApplyToolBarCustomisation(ToolBar toolBarArg)
        {
            base.ApplyToolBarCustomisation(toolBarArg);
            List&lt;string&gt; permissions = ModuleManager.Instance.GetPermissionByUserOrRole(&quot;WORKORD&quot;, UserDetail.GetCurrentUserDetail().UID,
                            UserDetail.GetCurrentUserDetail().RID, Request.QueryString[&quot;PID&quot;].ToInt32_2());
            List&lt;string&gt; ModuleComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);
            List&lt;string&gt; WOComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_WORKORD);
            if (!(BL.Instance.GetLockStatus(Request[&quot;ContractID&quot;].ToInt32_2())) ||
                !BL.Instance.ShouldModulebeEnabled(Request[&quot;ContractID&quot;].ToInt32_2()))
            {
                toolBarArg.GetMenuReference(&quot;lnkCopyWO&quot;).Enabled = false;
                toolBarArg.GetMenuReference(&quot;lnkNewWO1&quot;).Enabled = false;
                if (ModuleComponents.Contains(&quot;Activities&quot;))
                    toolBarArg.GetMenuReference(&quot;lnkNewWO2&quot;).Enabled = false;
                //If Hire Order Equipment module is uploaded.
                if (IsHireOrderAttached)
                    toolBarArg.GetMenuReference(&quot;lnkNewWO3&quot;).Enabled = false;
                if (toolBarArg.GetMenuReference(&quot;lnkCreateVersion&quot;) != null)
                    toolBarArg.GetMenuReference(&quot;lnkCreateVersion&quot;).Enabled = false;
            }
            if (!permissions.Contains(&quot;Create&quot;))
            {
                if (toolBarArg.GetMenuReference(&quot;lnkNewWO1&quot;) != null)
                    toolBarArg.GetMenuReference(&quot;lnkNewWO1&quot;).Enabled = false;

                if (toolBarArg.GetMenuReference(&quot;lnkCopyWO&quot;) != null)
                {
                    toolBarArg.HideMenu(&quot;lnkCopyWO&quot;);
                }
            }
            if (!permissions.Contains(&quot;CreateAWO&quot;))
            {
                if (ModuleComponents.Contains(&quot;Activities&quot;) &amp;&amp; toolBarArg.GetMenuReference(&quot;lnkNewWO2&quot;) != null)
                    toolBarArg.GetMenuReference(&quot;lnkNewWO2&quot;).Enabled = false;
            }
            if (!permissions.Contains(&quot;CreateEHO&quot;))
            {
                if (toolBarArg.GetMenuReference(&quot;lnkNewWO3&quot;) != null)
                    toolBarArg.GetMenuReference(&quot;lnkNewWO3&quot;).Enabled = false;
            }
            if (!permissions.Contains(&quot;Version&quot;))
            {
                if (toolBarArg.GetMenuReference(&quot;lnkCreateVersion&quot;) != null)
                    toolBarArg.GetMenuReference(&quot;lnkCreateVersion&quot;).Enabled = false;
            }
            if (!permissions.Contains(&quot;ApproveWO&quot;)) //lnkApprovals lnkApprove lnkUnApprove
            {
                if (toolBarArg.GetMenuReference(&quot;lnkApprove&quot;) != null)
                    toolBarArg.GetMenuReference(&quot;lnkApprove&quot;).Enabled = false;
                if (toolBarArg.GetMenuReference(&quot;lnkUnApprove&quot;) != null)
                    toolBarArg.GetMenuReference(&quot;lnkUnApprove&quot;).Enabled = false;
            }
            if (toolBarArg.GetMenuReference(&quot;lnkWorkOrderIssue&quot;) != null)
            {
                if (!permissions.Contains(&quot;IssueWO&quot;) &amp;&amp; toolBarArg.GetMenuReference(&quot;lnkWorkOrderIssue&quot;) != null)
                    toolBarArg.GetMenuReference(&quot;lnkWorkOrderIssue&quot;).Enabled = false;
            }
            if (toolBarArg.GetMenuReference(&quot;lnkIssueHistory&quot;) != null)
            {
                if (permissions.Contains(&quot;Create&quot;) || permissions.Contains(&quot;CreateAWO&quot;) ||
                    permissions.Contains(&quot;Version&quot;) || permissions.Contains(&quot;Edit&quot;))
                    toolBarArg.GetMenuReference(&quot;lnkIssueHistory&quot;).Enabled = true;
                else
                    toolBarArg.GetMenuReference(&quot;lnkIssueHistory&quot;).Enabled = false;
            }
            if (!CheckUserPermissionForBilling())
            {
                if (toolBarArg.GetMenuReference(&quot;lnkBillSettings&quot;) != null)
                    toolBarArg.GetMenuReference(&quot;lnkBillSettings&quot;).Enabled = false;
                if (toolBarArg.GetMenuReference(&quot;lnkPayEstimate&quot;) != null)
                    toolBarArg.GetMenuReference(&quot;lnkPayEstimate&quot;).Enabled = false;
            }
            if (CacheManager.Instance.IsIntegrated(PID))
            {
                toolBarArg.GetMenuReference(&quot;CalSubmitionDate(); return false;&quot;);
                SubmitEvent = &quot;Approve&quot;;
                SubmitionDateLabel = &quot;Approve Date:&quot;;
            }

            if (!WOComponents.Contains(&quot;WorkOrderCopy&quot;) &amp;&amp; toolBarArg.GetMenuReference(&quot;lnkCopyWO&quot;) != null)
                toolBarArg.HideMenu(&quot;lnkCopyWO&quot;);

            toolBarArg.Bind();
        }

        protected bool CheckUserPermissionForBilling()
        {
            List&lt;string&gt; permissions = ModuleManager.Instance.GetPermissionByUserOrRole(&quot;PAYESTM&quot;, UserDetail.GetCurrentUserDetail().UID,
                            UserDetail.GetCurrentUserDetail().RID, Request.QueryString[&quot;PID&quot;].ToInt32_2());
            if (permissions.Contains(&quot;Visibility&quot;) || permissions.Contains(&quot;View&quot;))
            {
                return true;
            }
            else
                return false;
        }

        public string PerformIssueServerValidation(string key)
        {
            var selectedRow = MWGrid.GetSelectedRow(mwGrid);
            string errMessage = &quot;&quot;;
            if (selectedRow != null)
            {
                if (MWGrid.GetCellValue(selectedRow,&quot;Status&quot;).Equals(&quot;Issued&quot;))
                {
                    if (key.Equals(&quot;ReOpen&quot;))
                        errMessage = &quot;Issued Work Order cannot be reopened.&quot;;
                    else
                        errMessage = &quot;The selected Work Order is already Issued.&quot;;
                    return errMessage;
                }
                if (key.Equals(&quot;Approve&quot;))
                    if (!MWGrid.GetCellValue(selectedRow,&quot;IsQuotationAwarded&quot;).ToBoolean2())
                    {
                        errMessage = &quot;A Quotation should be awarded inorder to the Issue the Work Order.&quot;;
                        return errMessage;
                    }
            }
            return string.Empty;
        }

        //public override string HandleApprove()
        //{
        //    string selWOID = GetSelectedItemFromGrid();
        //    int WOID = 0;
        //    int.TryParse(selWOID, out WOID);
        //    WorkOrderDTO wDTO = WORKORDManager.Instance.GetWorkOrderDetails(WOID);
        //    WorkOrderStatus = wDTO.Status;
        //    UserDetail ud = UserDetail.GetCurrentUserDetail();
        //    string userFullName = ud.FirstName + &quot; &quot; + ud.MiddleName + (string.IsNullOrEmpty(ud.MiddleName)
        //                                                                    ? ud.LastName
        //                                                                    : &quot; &quot; + ud.LastName);
        //    wDTO.IsVersion = (wDTO.Status == WOConstants.STAGE_APPROVE_AMENDMENT) ? true : false;
        //    wDTO.ModifiedBy = userFullName;
        //    wDTO.ModifiedByID = ud.UID;
        //    wDTO.ModifiedOn = Convert.ToDateTime(ApproveDate);

        //    int issueWO = woManager.IssueWO(wDTO);

        //    if (issueWO &gt; 0)
        //        return string.Empty;
        //    else if (issueWO == -2)
        //        return &quot;One or more checklists are not completed. Request denied&quot;;
        //    else
        //        return &quot;Error in DB Script Execution&quot;;

        //}

        public override bool PerformServerValidation(string key)
        {
            var selectedRow = MWGrid.GetSelectedRow(mwGrid);
            if (selectedRow != null)
            {
                string WOType = (MWGrid.GetCellValue(selectedRow,&quot;Type&quot;).Equals(&quot;Equipment Hire Order&quot;)
                                     ? &quot;Hire&quot;
                                     : &quot;Work&quot;);
                if (MWGrid.GetCellValue(selectedRow,&quot;Status&quot;).Equals(&quot;Issued&quot;))
                    if (key.Equals(&quot;ReOpen&quot;))
                        throw new Exception(&quot;Issued &quot; + WOType + &quot; order cannot be reopened.&quot;);
                    else
                        throw new Exception(&quot;The selected &quot; + WOType + &quot; order is already issued.&quot;);
                if (key.Equals(&quot;Approve&quot;))
                {
                    if (MWGrid.GetCellValue(selectedRow,&quot;Status&quot;).Equals(&quot;Draft Request&quot;) ||
                        MWGrid.GetCellValue(selectedRow,&quot;Status&quot;).Equals(&quot;Draft Amendment&quot;))
                        throw new Exception(&quot;Only approved &quot; + WOType + &quot; order can be Issued&quot;);
                    else if (!MWGrid.GetCellValue(selectedRow,&quot;IsQuotationAwarded&quot;).ToBoolean2())
                        throw new Exception(&quot;A quotation should be awarded inorder to issue &quot; + WOType + &quot; order.&quot;);
                }
            }

            return true;
        }

        public override void SetSubmitionDates(WebDateChooser submitionDate)
        {
            HttpSessionState session = HttpContext.Current.Session;
            submitionDate.CalendarLayout.Culture = DateFormatCulture.GetDateFormatCulture();
            var attribs = (ListModelContextAttribute[])
                          GetType().GetCustomAttributes(typeof(ListModelContextAttribute), true);
            string selectedIds = GetSelectedIds();
            if (string.IsNullOrEmpty(selectedIds))
                return;
            DataSet dtMinMaxDates =
                WOManager.Instance.GetMinMaxSubmitionDates(session[Constants.EIS_ADDITIONAL_INFO].ToString2(),
                                                           selectedIds.ToInt32_2(), &quot;WORKORD&quot;, attribs[0].Table,
                                                           InstanceIDColumn, &quot;CreatedOn&quot;, false);
            DateTime dtMinDate = WOManager.Instance.GetWOStartDate(selectedIds.ToInt32_2());
            if (dtMinMaxDates != null &amp;&amp; dtMinMaxDates.Tables.Count &gt; 0 &amp;&amp; dtMinMaxDates.Tables[0].Rows.Count &gt; 0)
            {
                submitionDate.MinDate = (DateTime)dtMinMaxDates.Tables[0].Rows[0][&quot;MinDate&quot;];
                submitionDate.MaxDate = dtMinDate;
            }
        }

        public override string GetEditPageURL(string pID, string parentID, string instanceID, string context)
        {
            string url = string.Empty;
            WorkOrderDTO w = WORKORDManager.Instance.GetWorkOrderDetails(instanceID.ToInt32_2());
            if (w.WorkOrderType.Equals(&quot;E&quot;))
            {
                if (w.Status &gt; 3)
                    url = string.Format(CultureInfo.CurrentCulture,
                                        &quot;~/Modules/WORKORD/NewWorkOrder.aspx?Type=E&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;ParentContext=CONTMGT&amp;WOType=E&amp;Version=true&amp;IsEditVersion=true&quot;,
                                        pID, parentID, instanceID);
                else if (w.Status == 3)
                    url = string.Format(CultureInfo.CurrentCulture,
                                      &quot;~/Modules/WORKORD/ViewWO.aspx?&quot; + Constants.QRY_PROJECTID + &quot;=&quot; +
                                      (pID ?? string.Empty) +
                                      &quot;&amp;&quot; + WOConstants.QRY_CONTRACTID + &quot;=&quot; +
                                      (parentID ?? string.Empty) +
                                      &quot;&amp;WOID={0}&amp;ParentContext=CONTMGT&amp;WOType=E&quot;, instanceID);
                else
                    url = string.Format(CultureInfo.CurrentCulture,
                                        &quot;~/Modules/WORKORD/NewWorkOrder.aspx?Type=E&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;ParentContext=CONTMGT&amp;WOType=E&quot;,
                                        pID, parentID, instanceID);
            }
            else if (w.WorkOrderType.Equals(&quot;A&quot;))
            {
                if (w.Status &gt; 3)
                    url = string.Format(CultureInfo.CurrentCulture,
                                        &quot;~/Modules/WORKORD/NewACTIWorkOrder.aspx?Type=E&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;ParentContext=CONTMGT&amp;Version=true&amp;IsEditVersion=true&quot;,
                                        pID, parentID, instanceID);
                else if (w.Status == 3)
                    url = string.Format(CultureInfo.CurrentCulture,
                                      &quot;~/Modules/WORKORD/ViewACTIWO.aspx?&quot; + Constants.QRY_PROJECTID + &quot;=&quot; +
                                      (pID ?? string.Empty) +
                                      &quot;&amp;&quot; + WOConstants.QRY_CONTRACTID + &quot;=&quot; +
                                      (parentID ?? string.Empty) +
                                      &quot;&amp;WOID={0}&amp;ParentContext=CONTMGT&quot;, instanceID);
                else
                    url = string.Format(CultureInfo.CurrentCulture,
                                        &quot;~/Modules/WORKORD/NewACTIWorkOrder.aspx?Type=E&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;ParentContext=CONTMGT&quot;,
                                        pID, parentID, instanceID);
            }
            else
            {
                if (w.Status &gt; 3)
                    url = string.Format(CultureInfo.CurrentCulture,
                                        &quot;~/Modules/WORKORD/NewWorkOrder.aspx?Type=E&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;ParentContext=CONTMGT&amp;Version=true&amp;IsEditVersion=true&quot;,
                                        pID, parentID, instanceID);
                else if (w.Status == 3)
                    url = string.Format(CultureInfo.CurrentCulture,
                                      &quot;~/Modules/WORKORD/ViewWO.aspx?&quot; + Constants.QRY_PROJECTID + &quot;=&quot; +
                                      (pID ?? string.Empty) +
                                      &quot;&amp;&quot; + WOConstants.QRY_CONTRACTID + &quot;=&quot; +
                                      (parentID ?? string.Empty) +
                                      &quot;&amp;WOID={0}&amp;ParentContext=CONTMGT&quot;, instanceID);
                else
                    url = string.Format(CultureInfo.CurrentCulture,
                                        &quot;~/Modules/WORKORD/NewWorkOrder.aspx?Type=E&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;ParentContext=CONTMGT&quot;,
                                        pID, parentID, instanceID);
            }

            return url;
        }

        public override string GetViewPageURL(string pID, string parentID, string instanceID, string context)
        {
            string url = string.Empty;
            WorkOrderDTO w = WORKORDManager.Instance.GetWorkOrderDetails(instanceID.ToInt32_2());
            if (w.WorkOrderType.Equals(&quot;E&quot;))
            {
                if (w.Status &gt; 3)
                    url = string.Format(CultureInfo.CurrentCulture,
                                        &quot;~/Modules/WORKORD/NewWorkOrder.aspx?Type=V&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;ParentContext=CONTMGT&amp;WOType=E&amp;Version=true&amp;IsEditVersion=true&quot;,
                                        pID, parentID, instanceID);
                else if (w.Status == 3)
                    url = string.Format(CultureInfo.CurrentCulture,
                                      &quot;~/Modules/WORKORD/ViewWO.aspx?&quot; + Constants.QRY_PROJECTID + &quot;=&quot; +
                                      (pID ?? string.Empty) +
                                      &quot;&amp;&quot; + WOConstants.QRY_CONTRACTID + &quot;=&quot; +
                                      (parentID ?? string.Empty) +
                                      &quot;&amp;WOID={0}&amp;ParentContext=CONTMGT&amp;WOType=E&quot;, instanceID);
                else
                    url = string.Format(CultureInfo.CurrentCulture,
                                        &quot;~/Modules/WORKORD/NewWorkOrder.aspx?Type=V&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;ParentContext=CONTMGT&amp;WOType=E&quot;,
                                        pID, parentID, instanceID);
            }
            else if (w.WorkOrderType.Equals(&quot;A&quot;))
            {
                if (w.Status &gt; 3)
                    url = string.Format(CultureInfo.CurrentCulture,
                                        &quot;~/Modules/WORKORD/NewACTIWorkOrder.aspx?Type=V&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;ParentContext=CONTMGT&amp;Version=true&amp;IsEditVersion=true&quot;,
                                        pID, parentID, instanceID);
                else if (w.Status == 3)
                    url = string.Format(CultureInfo.CurrentCulture,
                                      &quot;~/Modules/WORKORD/ViewACTIWO.aspx?&quot; + Constants.QRY_PROJECTID + &quot;=&quot; +
                                      (pID ?? string.Empty) +
                                      &quot;&amp;&quot; + WOConstants.QRY_CONTRACTID + &quot;=&quot; +
                                      (parentID ?? string.Empty) +
                                      &quot;&amp;WOID={0}&amp;ParentContext=CONTMGT&quot;, instanceID);
                else
                    url = string.Format(CultureInfo.CurrentCulture,
                                        &quot;~/Modules/WORKORD/NewACTIWorkOrder.aspx?Type=V&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;ParentContext=CONTMGT&quot;,
                                        pID, parentID, instanceID);
            }
            else
            {
                if (w.Status &gt; 3)
                    url = string.Format(CultureInfo.CurrentCulture,
                                        &quot;~/Modules/WORKORD/NewWorkOrder.aspx?Type=V&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;ParentContext=CONTMGT&amp;Version=true&amp;IsEditVersion=true&quot;,
                                        pID, parentID, instanceID);
                else if (w.Status == 3)
                    url = string.Format(CultureInfo.CurrentCulture,
                                      &quot;~/Modules/WORKORD/ViewWO.aspx?&quot; + Constants.QRY_PROJECTID + &quot;=&quot; +
                                      (pID ?? string.Empty) +
                                      &quot;&amp;&quot; + WOConstants.QRY_CONTRACTID + &quot;=&quot; +
                                      (parentID ?? string.Empty) +
                                      &quot;&amp;WOID={0}&amp;ParentContext=CONTMGT&quot;, instanceID);
                else
                    url = string.Format(CultureInfo.CurrentCulture,
                                        &quot;~/Modules/WORKORD/NewWorkOrder.aspx?Type=V&amp;PID={0}&amp;ContractID={1}&amp;ParentID={1}&amp;WOID={2}&amp;ParentContext=CONTMGT&quot;,
                                        pID, parentID, instanceID);
            }

            return url;
        }

        public override bool HasAttachments { get { return true; } }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[33,9,33,68,0],[37,17,37,18,0],[37,19,37,40,0],[37,41,37,42,0],[42,17,42,18,0],[42,19,42,36,0],[42,37,42,38,0],[47,17,47,18,0],[47,19,47,71,0],[47,72,47,73,0],[50,9,50,111,0],[56,38,56,42,0],[56,43,56,47,0],[60,17,60,18,0],[60,19,60,84,0],[60,85,60,86,0],[66,17,66,18,0],[66,19,66,101,0],[66,102,66,103,0],[71,17,71,18,0],[71,19,71,101,0],[71,102,71,103,0],[76,17,76,18,0],[76,19,76,101,0],[76,102,76,103,0],[81,17,81,18,0],[81,19,81,32,0],[81,33,81,34,0],[87,13,87,14,0],[88,17,88,62,0],[91,17,91,64,0],[91,64,91,89,0],[91,89,91,91,0],[91,17,91,91,0],[92,17,92,42,0],[93,17,93,18,0],[94,21,94,65,0],[95,21,95,50,0],[96,17,96,18,0],[97,17,97,83,0],[97,83,97,102,0],[97,102,97,104,0],[97,17,97,104,0],[98,17,98,39,0],[99,17,99,18,0],[100,21,100,58,0],[101,17,101,18,0],[102,17,102,83,0],[103,17,103,120,0],[104,17,104,115,0],[105,17,105,61,0],[106,21,106,113,0],[108,17,108,41,0],[109,21,109,116,0],[110,17,110,42,0],[111,21,111,115,0],[112,17,112,43,0],[113,21,113,53,0],[114,17,114,92,0],[118,17,118,67,0],[121,17,121,88,0],[124,17,124,107,0],[126,17,126,43,0],[127,17,127,18,0],[128,21,129,88,0],[130,21,130,110,0],[131,17,131,18,0],[132,17,132,35,0],[133,17,133,18,0],[134,21,134,129,0],[135,21,135,76,0],[136,25,136,117,0],[137,17,137,18,0],[138,17,138,47,0],[142,17,142,97,0],[143,17,143,116,0],[144,17,144,44,0],[145,21,145,123,0],[146,17,146,35,0],[147,21,147,132,0],[148,17,148,128,0],[149,17,149,109,0],[150,17,150,37,0],[151,21,151,107,0],[152,17,152,41,0],[153,21,153,117,0],[154,17,154,50,0],[160,17,160,62,0],[160,62,160,86,0],[160,86,160,88,0],[160,17,160,88,0],[161,17,161,40,0],[162,17,162,18,0],[163,21,163,62,0],[164,21,164,48,0],[165,17,165,18,0],[166,17,166,61,0],[166,61,166,85,0],[166,85,166,87,0],[166,17,166,87,0],[167,17,167,40,0],[168,17,168,18,0],[169,21,169,57,0],[170,17,170,18,0],[171,17,171,49,0],[172,21,172,96,0],[177,17,177,38,0],[178,17,178,18,0],[179,21,179,90,0],[179,90,179,113,0],[179,113,179,115,0],[179,21,179,115,0],[180,21,180,48,0],[181,21,181,22,0],[182,25,182,108,0],[183,21,183,22,0],[185,21,185,115,0],[186,17,186,18,0],[189,17,189,71,0],[191,17,191,41,0],[192,17,192,35,0],[193,13,193,14,0],[291,9,291,10,0],[292,13,292,48,0],[293,13,297,100,0],[298,9,298,10,0],[302,17,302,18,0],[302,19,302,39,0],[302,40,302,41,0],[307,17,307,18,0],[307,19,307,36,0],[307,37,307,38,0],[312,17,312,18,0],[312,19,312,28,0],[312,29,312,30,0],[317,17,317,18,0],[317,19,317,40,0],[317,41,317,42,0],[322,17,322,18,0],[322,19,322,28,0],[322,29,322,30,0],[326,9,326,10,0],[327,13,327,40,0],[330,13,330,95,0],[331,13,331,41,0],[334,13,334,76,0],[335,13,335,89,0],[336,13,336,81,0],[337,13,337,77,0],[338,13,338,91,0],[339,13,339,126,0],[340,13,340,98,0],[341,13,341,144,0],[342,13,342,149,0],[345,13,345,33,0],[346,13,346,14,0],[347,17,347,94,0],[348,17,348,109,0],[349,17,349,118,0],[351,17,351,108,0],[356,17,356,90,0],[358,17,358,104,0],[361,17,361,55,0],[363,17,363,40,0],[368,17,368,47,0],[369,21,369,67,0],[370,13,370,14,0],[372,13,372,45,0],[373,17,373,44,0],[374,13,374,46,0],[375,13,375,45,0],[376,9,376,10,0],[379,9,379,10,0],[389,9,389,10,0],[392,9,392,10,0],[393,13,393,90,0],[394,13,394,105,0],[398,13,398,43,0],[399,17,399,63,0],[400,13,400,73,0],[400,74,400,105,0],[402,13,402,99,0],[404,13,404,36,0],[406,9,406,10,0],[409,9,409,10,0],[410,13,410,109,0],[411,13,411,57,0],[412,13,412,14,0],[413,17,413,49,0],[414,17,414,47,0],[415,17,415,52,0],[416,17,416,49,0],[417,17,417,62,0],[419,17,419,47,0],[420,17,420,45,0],[421,17,421,44,0],[422,17,422,63,0],[423,17,423,51,0],[424,17,424,53,0],[425,17,425,83,0],[426,17,426,73,0],[427,17,427,82,0],[428,17,428,87,0],[429,17,429,79,0],[430,17,430,67,0],[431,17,431,67,0],[432,17,432,71,0],[434,17,434,47,0],[435,17,435,49,0],[436,17,436,48,0],[437,17,437,62,0],[439,17,439,47,0],[440,17,440,52,0],[441,17,441,50,0],[442,17,442,63,0],[443,17,443,70,0],[444,17,444,48,0],[445,17,445,47,0],[446,17,446,47,0],[448,17,448,47,0],[449,17,449,54,0],[450,17,450,51,0],[451,17,451,63,0],[452,17,452,70,0],[453,17,453,59,0],[454,21,454,66,0],[455,17,455,57,0],[456,17,456,41,0],[457,21,457,69,0],[459,17,459,32,0],[462,13,462,14,0],[463,17,463,49,0],[464,17,464,47,0],[465,17,465,52,0],[466,17,466,49,0],[467,17,467,62,0],[469,17,469,47,0],[470,17,470,45,0],[471,17,471,44,0],[472,17,472,63,0],[473,17,473,51,0],[474,17,474,53,0],[475,17,475,83,0],[476,17,476,73,0],[477,17,477,82,0],[478,17,478,87,0],[479,17,479,79,0],[480,17,480,67,0],[481,17,481,67,0],[482,17,482,71,0],[484,17,484,47,0],[485,17,485,49,0],[486,17,486,48,0],[487,17,487,62,0],[489,17,489,47,0],[490,17,490,54,0],[491,17,491,51,0],[492,17,492,63,0],[493,17,493,70,0],[494,17,494,59,0],[495,21,495,66,0],[496,17,496,57,0],[497,17,497,41,0],[498,21,498,69,0],[500,17,500,32,0],[504,9,504,10,0],[507,9,507,10,0],[508,13,508,52,0],[509,13,509,41,0],[510,13,510,40,0],[511,13,511,36,0],[515,13,515,20,0],[515,22,515,53,0],[515,54,515,56,0],[515,57,515,63,0],[516,13,516,14,0],[517,17,517,41,0],[519,17,519,44,0],[520,17,520,45,0],[522,17,522,40,0],[523,13,523,14,0],[525,13,525,27,0],[526,9,526,10,0],[529,9,529,10,0],[530,13,534,63,0],[535,9,535,10,0],[538,9,538,10,0],[539,13,539,56,0],[540,13,540,48,0],[541,13,541,14,0],[542,17,542,30,0],[543,17,543,49,0],[544,17,544,84,0],[545,17,545,31,0],[546,21,546,98,0],[549,17,549,65,0],[550,17,550,41,0],[551,17,551,18,0],[552,21,552,129,0],[560,21,560,97,0],[561,25,561,101,0],[562,21,562,96,0],[563,25,563,105,0],[564,17,564,18,0],[565,17,565,49,0],[566,17,566,18,0],[567,21,568,108,0],[569,25,573,36,0],[575,25,579,36,0],[580,17,580,18,0],[581,22,581,54,0],[582,17,582,18,0],[583,21,584,108,0],[585,25,589,36,0],[591,25,595,36,0],[596,17,596,18,0],[598,17,598,18,0],[599,21,600,108,0],[601,25,605,36,0],[607,25,611,36,0],[612,17,612,18,0],[613,13,613,14,0],[614,9,614,10,0],[617,9,617,10,0],[618,13,618,56,0],[619,13,619,48,0],[620,13,620,14,0],[621,17,621,30,0],[622,17,622,49,0],[623,17,623,84,0],[624,17,624,31,0],[625,21,625,98,0],[627,17,627,49,0],[628,21,634,97,0],[635,22,635,54,0],[636,21,642,88,0],[644,21,650,88,0],[651,13,651,14,0],[652,9,652,10,0],[655,9,655,10,0],[656,13,656,61,0],[657,13,657,37,0],[658,17,658,81,0],[659,13,659,33,0],[660,9,660,10,0],[663,9,663,10,0],[664,13,664,30,0],[665,13,665,56,0],[666,13,666,48,0],[667,13,667,14,0],[668,17,668,30,0],[669,17,669,49,0],[671,17,671,84,0],[672,17,672,100,0],[674,17,674,31,0],[675,21,675,108,0],[677,17,677,65,0],[678,17,678,41,0],[679,17,679,18,0],[680,21,681,108,0],[682,25,682,92,0],[683,21,683,104,0],[684,25,684,107,0],[685,21,685,108,0],[686,25,686,109,0],[687,17,687,18,0],[688,13,688,14,0],[690,13,690,132,0],[691,13,691,47,0],[692,13,692,14,0],[693,17,693,216,0],[694,17,694,120,0],[697,13,697,48,0],[698,13,698,14,0],[699,17,699,30,0],[700,17,700,49,0],[702,17,702,74,0],[703,17,703,36,0],[704,17,704,18,0],[705,21,705,93,0],[708,21,708,72,0],[709,13,709,14,0],[711,13,711,29,0],[712,9,712,10,0],[715,9,715,10,0],[716,13,716,37,0],[717,13,717,14,0],[718,17,718,32,0],[719,17,719,92,0],[720,17,731,103,0],[732,17,734,91,0],[735,17,735,97,0],[736,17,736,18,0],[737,21,737,66,0],[738,17,738,18,0],[740,17,740,93,0],[741,17,741,18,0],[755,17,755,18,0],[756,13,756,14,0],[757,9,757,10,0],[760,9,760,10,0],[761,13,761,42,0],[762,13,762,73,0],[763,13,763,14,0],[764,17,764,29,0],[765,13,765,14,0],[766,18,766,66,0],[767,13,767,14,0],[768,17,772,61,0],[773,13,773,14,0],[774,18,774,69,0],[775,13,775,14,0],[776,17,780,70,0],[781,13,781,14,0],[782,18,782,53,0],[783,13,783,14,0],[784,17,786,116,0],[787,13,787,14,0],[788,18,788,51,0],[789,13,789,14,0],[804,13,804,14,0],[806,13,806,14,0],[807,17,807,60,0],[808,17,808,30,0],[809,17,809,49,0],[810,17,810,84,0],[811,17,811,62,0],[812,17,812,18,0],[813,21,813,56,0],[814,21,814,22,0],[816,25,816,57,0],[817,29,820,99,0],[821,30,821,62,0],[822,29,825,99,0],[827,29,830,99,0],[831,21,831,22,0],[833,25,833,75,0],[834,17,834,18,0],[835,22,835,76,0],[836,17,836,18,0],[837,21,837,56,0],[838,21,838,22,0],[839,25,839,57,0],[840,29,843,99,0],[844,30,844,62,0],[845,29,848,99,0],[850,29,853,99,0],[854,21,854,22,0],[856,25,856,75,0],[857,17,857,18,0],[858,22,858,58,0],[859,17,859,18,0],[860,21,860,56,0],[861,21,861,22,0],[864,25,864,73,0],[865,25,865,49,0],[866,25,866,26,0],[867,29,867,105,0],[868,33,868,106,0],[869,29,869,105,0],[870,33,870,109,0],[871,25,871,26,0],[875,25,878,66,0],[880,25,880,51,0],[881,21,881,22,0],[882,17,882,18,0],[883,22,883,63,0],[884,17,884,18,0],[885,21,885,89,0],[886,21,886,56,0],[887,21,887,22,0],[888,25,888,87,0],[889,29,889,106,0],[891,25,891,73,0],[892,25,892,49,0],[893,25,893,26,0],[894,29,894,85,0],[895,33,896,116,0],[897,29,899,123,0],[900,33,900,119,0],[901,29,901,106,0],[902,33,903,159,0],[904,34,904,110,0],[905,33,905,103,0],[906,25,906,26,0],[908,25,908,81,0],[909,25,909,26,0],[910,29,911,101,0],[914,25,914,57,0],[915,29,919,60,0],[920,30,920,62,0],[921,29,925,60,0],[927,29,931,60,0],[932,21,932,22,0],[933,26,933,60,0],[934,25,934,61,0],[935,17,935,18,0],[936,22,936,76,0],[937,17,937,18,0],[938,21,938,35,0],[939,25,939,84,0],[940,21,940,69,0],[941,21,941,45,0],[942,21,942,22,0],[943,25,943,101,0],[944,29,945,81,0],[947,25,950,175,0],[951,21,951,22,0],[953,21,953,47,0],[954,17,954,18,0],[955,22,955,62,0],[956,17,956,18,0],[957,21,957,35,0],[958,25,958,84,0],[959,21,959,69,0],[960,21,960,45,0],[961,21,961,22,0],[962,25,962,101,0],[963,29,963,119,0],[965,25,965,95,0],[971,25,971,78,0],[973,25,975,127,0],[976,21,976,22,0],[978,21,978,47,0],[979,17,979,18,0],[1012,22,1012,66,0],[1013,17,1013,18,0],[1014,21,1014,69,0],[1015,21,1015,45,0],[1016,21,1016,22,0],[1017,25,1019,111,0],[1020,25,1020,26,0],[1021,29,1021,105,0],[1022,29,1022,30,0],[1023,33,1023,65,0],[1024,37,1030,143,0],[1031,38,1031,70,0],[1032,37,1038,134,0],[1040,37,1046,134,0],[1047,29,1047,30,0],[1049,29,1049,30,0],[1050,33,1050,65,0],[1051,37,1056,47,0],[1057,38,1057,70,0],[1058,37,1063,47,0],[1065,37,1070,47,0],[1071,29,1071,30,0],[1072,25,1072,26,0],[1074,29,1074,112,0],[1075,21,1075,22,0],[1077,25,1077,61,0],[1078,17,1078,18,0],[1079,22,1079,65,0],[1080,17,1080,18,0],[1081,21,1081,69,0],[1082,21,1083,95,0],[1084,21,1084,22,0],[1085,25,1085,78,0],[1086,25,1090,35,0],[1091,21,1091,22,0],[1093,25,1093,73,0],[1094,17,1094,18,0],[1095,22,1095,66,0],[1096,17,1096,18,0],[1097,21,1097,69,0],[1098,21,1098,45,0],[1099,21,1099,22,0],[1100,25,1103,102,0],[1104,25,1104,26,0],[1105,29,1106,145,0],[1107,33,1109,87,0],[1110,29,1110,82,0],[1111,29,1115,60,0],[1116,25,1116,26,0],[1118,29,1119,204,0],[1120,21,1120,22,0],[1121,17,1121,18,0],[1122,22,1122,59,0],[1123,17,1123,18,0],[1124,21,1124,69,0],[1125,21,1125,45,0],[1126,21,1126,22,0],[1127,25,1127,78,0],[1128,25,1128,49,0],[1130,25,1131,101,0],[1132,29,1132,46,0],[1134,25,1138,117,0],[1139,21,1139,22,0],[1141,25,1141,55,0],[1142,17,1142,18,0],[1143,22,1143,60,0],[1144,17,1144,18,0],[1145,21,1145,69,0],[1146,21,1146,56,0],[1147,21,1147,22,0],[1148,25,1148,101,0],[1149,25,1149,26,0],[1150,29,1150,82,0],[1151,29,1153,116,0],[1154,29,1154,66,0],[1155,33,1159,101,0],[1161,33,1162,123,0],[1163,25,1163,26,0],[1165,29,1166,113,0],[1167,21,1167,22,0],[1169,25,1169,75,0],[1170,17,1170,18,0],[1171,22,1171,69,0],[1172,17,1172,18,0],[1173,21,1173,69,0],[1174,21,1174,56,0],[1175,21,1175,22,0],[1176,25,1176,102,0],[1177,29,1178,121,0],[1180,25,1180,26,0],[1181,29,1181,82,0],[1184,29,1188,41,0],[1191,25,1191,26,0],[1192,21,1192,22,0],[1194,25,1194,75,0],[1195,17,1195,18,0],[1196,22,1196,65,0],[1197,17,1197,18,0],[1198,21,1198,56,0],[1199,21,1199,22,0],[1200,25,1200,73,0],[1201,25,1201,102,0],[1202,29,1203,121,0],[1205,25,1205,26,0],[1206,29,1206,82,0],[1207,29,1210,114,0],[1211,25,1211,26,0],[1212,21,1212,22,0],[1213,17,1213,18,0],[1214,22,1214,53,0],[1215,17,1215,18,0],[1220,21,1220,56,0],[1221,21,1221,22,0],[1222,25,1222,87,0],[1223,29,1223,106,0],[1225,25,1229,60,0],[1230,21,1230,22,0],[1231,26,1231,60,0],[1232,25,1232,61,0],[1233,17,1233,18,0],[1235,17,1235,18,0],[1236,21,1236,61,0],[1238,13,1238,14,0],[1239,13,1239,27,0],[1240,9,1240,10,0],[1243,9,1243,10,0],[1244,13,1244,51,0],[1246,13,1246,49,0],[1247,13,1247,14,0],[1248,17,1248,59,0],[1249,17,1249,54,0],[1250,17,1252,75,0],[1253,17,1253,18,0],[1254,21,1254,66,0],[1255,21,1255,67,0],[1256,17,1256,18,0],[1257,22,1257,40,0],[1258,17,1258,18,0],[1259,21,1261,107,0],[1262,21,1264,108,0],[1266,21,1266,112,0],[1267,21,1267,102,0],[1268,21,1268,109,0],[1269,21,1269,103,0],[1270,17,1270,18,0],[1271,17,1271,86,0],[1272,17,1274,106,0],[1275,17,1277,104,0],[1279,17,1279,100,0],[1280,17,1280,92,0],[1281,17,1281,100,0],[1282,17,1282,92,0],[1283,17,1283,111,0],[1284,17,1284,101,0],[1285,17,1285,105,0],[1286,17,1286,99,0],[1287,13,1287,14,0],[1289,13,1289,14,0],[1290,17,1290,53,0],[1291,17,1291,18,0],[1293,21,1293,61,0],[1294,21,1294,60,0],[1295,21,1295,61,0],[1296,21,1296,73,0],[1297,21,1297,78,0],[1298,21,1298,62,0],[1299,17,1299,18,0],[1301,17,1301,18,0],[1303,21,1303,93,0],[1305,21,1305,83,0],[1306,21,1306,22,0],[1307,25,1307,66,0],[1308,25,1308,75,0],[1309,25,1309,111,0],[1310,25,1310,81,0],[1311,25,1311,101,0],[1312,25,1312,86,0],[1313,21,1313,22,0],[1315,21,1315,22,0],[1316,25,1316,65,0],[1317,21,1317,22,0],[1318,21,1318,115,0],[1319,21,1319,22,0],[1325,21,1325,22,0],[1327,21,1327,22,0],[1328,25,1328,109,0],[1329,21,1329,22,0],[1330,17,1330,18,0],[1332,17,1332,54,0],[1333,17,1333,68,0],[1334,17,1334,86,0],[1336,17,1336,47,0],[1337,17,1337,18,0],[1338,21,1338,79,0],[1339,21,1339,78,0],[1340,21,1340,98,0],[1341,21,1341,83,0],[1342,17,1342,18,0],[1343,13,1343,14,0],[1344,9,1344,10,0],[1348,9,1348,10,0],[1349,13,1349,41,0],[1350,13,1350,33,0],[1353,21,1353,64,0],[1354,21,1354,55,0],[1355,21,1355,22,0],[1356,25,1356,62,0],[1357,25,1357,31,0],[1360,21,1360,22,0],[1361,25,1361,38,0],[1362,25,1362,57,0],[1366,25,1366,91,0],[1368,25,1368,61,0],[1369,25,1369,26,0],[1370,29,1370,106,0],[1371,29,1371,109,0],[1372,29,1372,84,0],[1373,25,1373,26,0],[1375,25,1375,26,0],[1376,29,1376,107,0],[1377,29,1377,120,0],[1378,29,1378,85,0],[1379,25,1379,26,0],[1381,25,1381,65,0],[1383,25,1383,51,0],[1384,25,1384,61,0],[1385,25,1385,26,0],[1387,29,1387,85,0],[1388,29,1388,30,0],[1389,33,1389,102,0],[1391,29,1392,94,0],[1394,29,1394,77,0],[1396,29,1396,36,0],[1396,38,1396,48,0],[1396,49,1396,51,0],[1396,52,1396,92,0],[1397,29,1397,30,0],[1398,33,1398,105,0],[1399,33,1399,34,0],[1400,37,1401,86,0],[1402,33,1402,34,0],[1404,33,1404,34,0],[1405,37,1406,86,0],[1407,33,1407,34,0],[1408,29,1408,30,0],[1409,29,1409,83,0],[1410,29,1410,45,0],[1412,29,1412,68,0],[1413,29,1413,101,0],[1414,33,1414,57,0],[1416,29,1416,67,0],[1418,29,1433,49,0],[1433,49,1433,50,0],[1433,50,1434,53,0],[1434,53,1434,72,0],[1434,72,1435,57,0],[1435,57,1435,87,0],[1435,87,1436,49,0],[1436,49,1436,50,0],[1436,50,1436,52,0],[1418,29,1436,52,0],[1437,29,1437,86,0],[1439,29,1439,83,0],[1440,29,1440,114,0],[1441,29,1441,104,0],[1451,29,1451,112,0],[1452,29,1452,108,0],[1455,29,1455,76,0],[1456,29,1456,47,0],[1457,29,1457,50,0],[1458,29,1458,78,0],[1459,29,1459,45,0],[1460,25,1460,26,0],[1462,30,1462,66,0],[1463,25,1463,26,0],[1464,29,1464,80,0],[1465,29,1465,30,0],[1466,33,1466,102,0],[1469,29,1469,84,0],[1470,29,1470,59,0],[1471,29,1471,45,0],[1472,25,1472,26,0],[1474,25,1474,26,0],[1475,29,1475,80,0],[1476,29,1476,30,0],[1477,33,1477,113,0],[1480,29,1480,75,0],[1481,29,1481,36,0],[1481,38,1481,48,0],[1481,49,1481,51,0],[1481,52,1481,59,0],[1482,29,1482,30,0],[1483,33,1485,89,0],[1486,33,1486,34,0],[1487,37,1488,88,0],[1489,33,1489,34,0],[1491,33,1491,34,0],[1492,37,1493,88,0],[1494,33,1494,34,0],[1495,29,1495,30,0],[1497,29,1497,50,0],[1498,29,1498,45,0],[1499,29,1499,77,0],[1500,29,1500,69,0],[1501,29,1501,101,0],[1502,33,1502,58,0],[1504,29,1504,67,0],[1506,29,1508,46,0],[1508,46,1508,47,0],[1508,47,1509,50,0],[1509,50,1509,69,0],[1509,69,1510,54,0],[1510,54,1510,84,0],[1510,84,1511,46,0],[1511,46,1511,47,0],[1511,47,1511,49,0],[1506,29,1511,49,0],[1512,25,1512,26,0],[1514,25,1514,55,0],[1516,25,1516,61,0],[1517,25,1517,26,0],[1518,29,1518,63,0],[1519,29,1519,100,0],[1520,25,1520,26,0],[1522,29,1522,76,0],[1525,21,1525,22,0],[1526,21,1526,41,0],[1527,21,1527,22,0],[1528,25,1528,44,0],[1529,21,1529,22,0],[1530,21,1530,27,0],[1532,21,1532,57,0],[1533,21,1533,27,0],[1535,13,1535,26,0],[1536,9,1536,10,0],[1539,9,1539,10,0],[1564,9,1564,10,0],[1567,9,1567,10,0],[1568,13,1568,52,0],[1569,13,1569,39,0],[1569,40,1569,77,0],[1570,13,1570,43,0],[1570,44,1570,85,0],[1571,13,1571,66,0],[1572,13,1572,75,0],[1573,13,1573,75,0],[1574,13,1574,109,0],[1575,13,1575,58,0],[1576,13,1576,14,0],[1577,17,1577,60,0],[1578,13,1578,14,0],[1580,13,1580,55,0],[1581,13,1581,54,0],[1582,13,1582,56,0],[1583,13,1583,52,0],[1584,13,1584,40,0],[1584,41,1584,79,0],[1586,13,1586,46,0],[1587,13,1587,14,0],[1588,17,1588,101,0],[1589,17,1589,82,0],[1590,13,1590,14,0],[1591,13,1591,42,0],[1592,13,1592,14,0],[1593,17,1593,77,0],[1595,13,1595,14,0],[1597,13,1597,43,0],[1598,13,1598,14,0],[1599,17,1599,78,0],[1600,13,1600,14,0],[1602,13,1602,44,0],[1603,13,1603,14,0],[1604,17,1604,101,0],[1605,17,1605,74,0],[1606,17,1607,102,0],[1608,17,1609,94,0],[1610,13,1610,14,0],[1612,13,1612,42,0],[1613,13,1613,14,0],[1614,17,1614,99,0],[1615,17,1615,79,0],[1616,17,1617,100,0],[1618,17,1619,92,0],[1620,13,1620,14,0],[1621,13,1621,39,0],[1622,17,1622,54,0],[1623,13,1623,53,0],[1624,17,1624,68,0],[1625,13,1625,51,0],[1626,17,1626,66,0],[1629,9,1629,10,0],[1634,13,1634,14,0],[1635,17,1635,121,0],[1636,17,1636,59,0],[1637,17,1637,55,0],[1638,17,1638,49,0],[1639,21,1639,65,0],[1640,17,1640,63,0],[1641,17,1641,49,0],[1642,17,1642,45,0],[1643,17,1643,61,0],[1644,17,1644,57,0],[1645,17,1645,55,0],[1646,17,1646,59,0],[1647,17,1647,55,0],[1648,17,1648,59,0],[1649,17,1649,55,0],[1650,17,1650,69,0],[1651,17,1651,32,0],[1652,13,1652,14,0],[1657,9,1657,10,0],[1660,13,1660,99,0],[1663,13,1663,80,0],[1664,17,1664,69,0],[1665,13,1666,111,0],[1670,13,1670,32,0],[1671,13,1671,101,0],[1672,17,1672,87,0],[1674,17,1674,69,0],[1676,13,1678,91,0],[1679,13,1679,48,0],[1679,50,1679,74,0],[1681,13,1681,41,0],[1682,13,1682,14,0],[1683,17,1683,44,0],[1684,17,1684,18,0],[1685,21,1687,78,0],[1688,21,1688,44,0],[1689,17,1689,18,0],[1690,13,1690,14,0],[1692,13,1692,14,0],[1693,17,1693,44,0],[1694,17,1694,18,0],[1696,21,1696,50,0],[1697,17,1697,18,0],[1698,13,1698,14,0],[1700,13,1700,83,0],[1701,13,1701,44,0],[1702,17,1702,45,0],[1704,17,1704,49,0],[1705,13,1705,28,0],[1705,29,1705,45,0],[1706,13,1706,25,0],[1707,9,1707,10,0],[1710,9,1710,10,0],[1711,13,1711,56,0],[1712,13,1713,108,0],[1714,13,1714,111,0],[1715,13,1715,110,0],[1716,13,1717,87,0],[1718,13,1718,14,0],[1719,17,1719,74,0],[1720,17,1720,74,0],[1721,17,1721,61,0],[1722,21,1722,78,0],[1724,17,1724,41,0],[1725,21,1725,78,0],[1726,17,1726,77,0],[1727,21,1727,85,0],[1728,13,1728,14,0],[1729,13,1729,49,0],[1730,13,1730,14,0],[1731,17,1731,70,0],[1732,21,1732,78,0],[1734,17,1734,70,0],[1735,17,1735,18,0],[1736,21,1736,54,0],[1737,17,1737,18,0],[1738,13,1738,14,0],[1739,13,1739,52,0],[1740,13,1740,14,0],[1741,17,1741,113,0],[1742,21,1742,78,0],[1743,13,1743,14,0],[1744,13,1744,52,0],[1745,13,1745,14,0],[1746,17,1746,70,0],[1747,21,1747,78,0],[1748,13,1748,14,0],[1749,13,1749,50,0],[1750,13,1750,14,0],[1751,17,1751,77,0],[1752,21,1752,85,0],[1753,13,1753,14,0],[1754,13,1754,52,0],[1755,13,1755,14,0],[1756,17,1756,71,0],[1757,21,1757,79,0],[1758,17,1758,73,0],[1759,21,1759,81,0],[1760,13,1760,14,0],[1761,13,1761,74,0],[1762,13,1762,14,0],[1763,17,1763,114,0],[1764,21,1764,86,0],[1765,13,1765,14,0],[1766,13,1766,72,0],[1767,13,1767,14,0],[1768,17,1769,85,0],[1770,21,1770,83,0],[1772,21,1772,84,0],[1773,13,1773,14,0],[1774,13,1774,50,0],[1775,13,1775,14,0],[1776,17,1776,76,0],[1777,21,1777,84,0],[1778,17,1778,75,0],[1779,21,1779,83,0],[1780,13,1780,14,0],[1781,13,1781,57,0],[1782,13,1782,14,0],[1783,17,1783,82,0],[1784,17,1784,41,0],[1785,17,1785,54,0],[1786,13,1786,14,0],[1788,13,1788,109,0],[1789,17,1789,50,0],[1791,13,1791,31,0],[1792,9,1792,10,0],[1795,9,1795,10,0],[1796,13,1797,108,0],[1798,13,1798,84,0],[1799,13,1799,14,0],[1800,17,1800,29,0],[1803,17,1803,30,0],[1804,9,1804,10,0],[1807,9,1807,10,0],[1808,13,1808,61,0],[1809,13,1809,36,0],[1810,13,1810,37,0],[1811,13,1811,14,0],[1812,17,1812,80,0],[1813,17,1813,18,0],[1814,21,1814,46,0],[1815,25,1815,78,0],[1817,25,1817,83,0],[1818,21,1818,39,0],[1820,17,1820,43,0],[1821,21,1821,93,0],[1822,21,1822,22,0],[1823,25,1823,107,0],[1824,25,1824,43,0],[1826,13,1826,14,0],[1827,13,1827,33,0],[1828,9,1828,10,0],[1858,9,1858,10,0],[1859,13,1859,61,0],[1860,13,1860,37,0],[1861,13,1861,14,0],[1862,17,1864,48,0],[1865,17,1865,80,0],[1866,21,1866,46,0],[1867,25,1867,96,0],[1869,25,1869,101,0],[1870,17,1870,43,0],[1871,17,1871,18,0],[1872,21,1873,93,0],[1874,25,1874,97,0],[1875,26,1875,98,0],[1876,25,1876,117,0],[1877,17,1877,18,0],[1878,13,1878,14,0],[1880,13,1880,25,0],[1881,9,1881,10,0],[1884,9,1884,10,0],[1885,13,1885,68,0],[1886,13,1886,93,0],[1887,13,1888,98,0],[1889,13,1889,51,0],[1890,13,1890,51,0],[1891,17,1891,24,0],[1892,13,1895,98,0],[1896,13,1896,93,0],[1897,13,1897,115,0],[1898,13,1898,14,0],[1899,17,1899,94,0],[1900,17,1900,51,0],[1901,13,1901,14,0],[1902,9,1902,10,0],[1905,9,1905,10,0],[1906,13,1906,39,0],[1907,13,1907,98,0],[1908,13,1908,45,0],[1909,13,1909,14,0],[1910,17,1910,34,0],[1911,21,1913,68,0],[1914,22,1914,40,0],[1915,21,1920,95,0],[1922,21,1924,68,0],[1925,13,1925,14,0],[1926,18,1926,50,0],[1927,13,1927,14,0],[1928,17,1928,34,0],[1929,21,1931,68,0],[1932,22,1932,40,0],[1933,21,1938,86,0],[1940,21,1942,68,0],[1943,13,1943,14,0],[1945,13,1945,14,0],[1946,17,1946,34,0],[1947,21,1949,68,0],[1950,22,1950,40,0],[1951,21,1956,86,0],[1958,21,1960,68,0],[1961,13,1961,14,0],[1963,13,1963,24,0],[1964,9,1964,10,0],[1967,9,1967,10,0],[1968,13,1968,39,0],[1969,13,1969,98,0],[1970,13,1970,45,0],[1971,13,1971,14,0],[1972,17,1972,34,0],[1973,21,1975,68,0],[1976,22,1976,40,0],[1977,21,1982,95,0],[1984,21,1986,68,0],[1987,13,1987,14,0],[1988,18,1988,50,0],[1989,13,1989,14,0],[1990,17,1990,34,0],[1991,21,1993,68,0],[1994,22,1994,40,0],[1995,21,2000,86,0],[2002,21,2004,68,0],[2005,13,2005,14,0],[2007,13,2007,14,0],[2008,17,2008,34,0],[2009,21,2011,68,0],[2012,22,2012,40,0],[2013,21,2018,86,0],[2020,21,2022,68,0],[2023,13,2023,14,0],[2025,13,2025,24,0],[2026,9,2026,10,0],[2028,51,2028,52,0],[2028,53,2028,65,0],[2028,66,2028,67,0]]);
    </script>
  </body>
</html>