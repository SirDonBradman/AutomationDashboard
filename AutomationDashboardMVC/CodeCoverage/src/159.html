<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Construction Vertical\Addon Modules\Contract Manager\Item Postings\CreatePosting.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Drawing;
using System.Globalization;
using System.Runtime.Serialization;
using System.Web.UI.WebControls;
using Aurigo.AMP3.Common;
using Aurigo.AMP3.ContmgtDTO;
using Aurigo.AMP3.CONTMGTITMPOSTDTO;
using Aurigo.AMP3.ContractManager;
using Aurigo.AMP3.ContractManager.BusinessLayer;
using Aurigo.AMP3.ContractManager.DTO;
using Aurigo.AMP3.Core.BusinessLayer.BL;
using Aurigo.AMP3.Core.IntegrationConnector;
using Aurigo.AMP3.Core.UserControls;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.AMP3.LibraryBL;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.Brix.Construction.ContractManager.BusinessLayer.BL;
using Aurigo.Brix.Core.WebUiHelper;
using Aurigo.Brix.Platform.BusinessLayer.DataResouces;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.Common;
using Infragistics.Documents.Excel;
using Infragistics.WebUI.UltraWebGrid;
using Infragistics.WebUI.UltraWebGrid.ExcelExport;
using Infragistics.WebUI.WebSchedule;
using Activity = Aurigo.AMP3.Core.BusinessLayer.DTO.Activity;
using System.Web;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.Brix.Platform.BusinessLayer.UserControls;
using System.Web.Script.Serialization;
using Aurigo.Brix.Platform.BusinessLayer.BL;
using System.Web.UI;
using Aurigo.Brix.Platform.BusinessLayer.AbstractModels;
using System.Web.UI.HtmlControls;

namespace Aurigo.AMP3.CONTMGTITMPOSTUI
{
    public partial class CreatePosting : BrixPageBase, IWorkflowEnabled, IXMLControl
    {
        protected global::Infragistics.WebUI.WebDataInput.WebNumericEdit txtgrpQnty;
        //protected global::Aurigo.Brix.Platform.BusinessLayer.UserControls.AutoComplete stdItemNumber;
        protected global::Aurigo.Brix.Platform.BusinessLayer.UserControls.PickerGrid pickerIPItem;
        protected global::Infragistics.WebUI.WebDataInput.WebNumericEdit wdpComplete;
        protected global::Infragistics.WebUI.WebSchedule.WebDateChooser dtPostedDate;
        protected global::System.Web.UI.UserControl ucItemPicker;

        #region Fileds and Properties

        private const string MODULEID = &quot;ITMPOST&quot;;
        private int workOrderIndex
        {
            get
            {
                int woIndex = -1;
                Int32.TryParse(ViewState[&quot;workOrderIndex&quot;].ToString2(), out woIndex);
                return woIndex;
            }
            set { ViewState[&quot;workOrderIndex&quot;] = value; }
        }
        private int contractorIndex
        {
            get
            {
                int contIndex = -1;
                Int32.TryParse(ViewState[&quot;contractorIndex&quot;].ToString2(), out contIndex);
                return contIndex;
            }
            set { ViewState[&quot;contractorIndex&quot;] = value; }
        }
        private int primeContractorId
        {
            get
            {
                int primeIndex = -1;
                Int32.TryParse(ViewState[&quot;primeContractorId&quot;].ToString2(), out primeIndex);
                return primeIndex;
            }
            set { ViewState[&quot;primeContractorId&quot;] = value; }
        }
        private readonly string WOID = string.Empty;
        private readonly string[] fmt = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY.Split(&#39;.&#39;);
        private readonly NumberFormatInfo info = new NumberFormatInfo();
        private char _PostMore;
        private bool bRate;
        protected UltraWebGridExcelExporter excelExporter;
        protected UltraWebGrid gridActivity;
        private RateAnalysisControl rateAnalysisDetail;
        private string status = string.Empty;
        private bool allowContractorDPRIP;
        private List&lt;string&gt; _moduleComponents, ModuleComponentsIP;

        private int ItemID
        {
            set { ViewState[&quot;IPItemID&quot;] = value; }
            get { return (ViewState[&quot;IPItemID&quot;] == null) ? 0 : ViewState[&quot;IPItemID&quot;].ToInt32_2(); }
        }

        private List&lt;string&gt; ModuleComponents
        {
            get
            {
                if (_moduleComponents == null)
                {
                    _moduleComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);
                }
                return _moduleComponents;
            }
        }

        private int PostingID
        {
            set { ViewState[&quot;IPID&quot;] = value; }
            get { return (ViewState[&quot;IPID&quot;] == null) ? 0 : ViewState[&quot;IPID&quot;].ToInt32_2(); }
        }

        private int ContractID
        {
            get { return Request[&quot;ContractID&quot;].ToInt32_2(); }
        }

        private string Mode
        {
            set
            {
                ViewState[&quot;IPMODE&quot;] = string.IsNullOrEmpty(value) ? &quot;New&quot; : value;
                _IsNew = null;
                _IsEdit = null;
                _IsView = null;
            }
            get { return (ViewState[&quot;IPMODE&quot;] == null) ? string.Empty : ViewState[&quot;IPMODE&quot;].ToString2(); }
        }

        //public int ParentInstanceID
        //{
        //    set { hdnParentInstanceId.Value = value.ToString2(); }
        //    get
        //    {
        //        return string.IsNullOrEmpty(hdnParentInstanceId.Value)
        //                   ? 0
        //                   : Convert.ToInt32(hdnParentInstanceId.Value, CultureInfo.CurrentCulture);
        //    }
        //}

        private bool hideWorkflowButtons
        {
            set { ViewState[&quot;HideWorkflowButtons&quot;] = value; }
            get
            {
                return (ViewState[&quot;HideWorkflowButtons&quot;] == null)
                           ? false
                           : bool.Parse(ViewState[&quot;HideWorkflowButtons&quot;].ToString2());
            }
        }

        private bool hideToolBar
        {
            set { ViewState[&quot;hideToolBar&quot;] = value; }
            get { return (ViewState[&quot;hideToolBar&quot;] == null) ? false : bool.Parse(ViewState[&quot;hideToolBar&quot;].ToString2()); }
        }

        private bool IsRFINoRequired { get; set; }

        /// &lt;summary&gt;
        /// Gets the Project Mode : I-Integration, L-Live
        /// &lt;/summary&gt;
        private string ProjectMode
        {
            get { return (CacheManager.Instance.IsIntegrated(PID) ? &quot;I&quot; : &quot;L&quot;); }
        }

        /// &lt;summary&gt;
        /// Gets the Integration Cutoff Date
        /// &lt;/summary&gt;
        private DateTime IntegrationCutoffDate
        {
            get { return (DateTime)Session[Constants.APP_IntegrationCutoffDate]; }
        }

        /// &lt;summary&gt;
        /// Gets the Default Record Date
        /// &lt;/summary&gt;
        private DateTime DefaultRecordDate
        {
            get
            {
                if (String.IsNullOrEmpty(Request[&quot;DWRID&quot;]) || ProjectMode.Equals(&quot;L&quot;))
                    return MWDateTimeHelper.UtcToday;
                else
                    return (ITMPOSTBL.Instance.GetDWRDate(Request[&quot;DWRID&quot;].ToInt32_2()) ??
                            (DateTime)Session[Constants.APP_DefaultRecordDate]);
            }
        }

        private string StrModuleId
        {
            get
            {
                if (ViewState[&quot;ModuleID&quot;] == null)
                    ViewState[&quot;ModuleID&quot;] = &quot;ITMPOST&quot;;

                return ViewState[&quot;ModuleID&quot;].ToString();
            }
            set
            {
                ViewState[&quot;ModuleID&quot;] = value;
            }
        }

        private int ParentInstanceID
        {
            get
            {
                if (ViewState[&quot;ParentInstanceID&quot;] == null)
                    ViewState[&quot;ParentInstanceID&quot;] = ContractID;

                return ViewState[&quot;ParentInstanceID&quot;].ToInt32_2();
            }
            set
            {
                ViewState[&quot;ParentInstanceID&quot;] = value;
            }
        }

        private bool HasWorkOrders { get; set; }

        public BrixFormModel model { get; set; }

        public XMLFormManagerModel managerModel { get; set; }

        #endregion

        #region ItemDivEnums enum

        public enum ItemDivEnums
        {
            ItemPicker = 1,
            CreatePosting = 2,
            RateAnalysis = 3,
            SubItems = 4,
            ResourcePicker = 5,
            ItemActivity = 6
        }

        #endregion

        #region &quot;Activities&quot;

        private void BindActivityGrid(string moduleID, int parentInstanceID, int itemID)
        {
            DataSet activityList = ITMPOSTBL.Instance.GetActivitiesForPostings(moduleID, parentInstanceID, itemID,
                                                                               ((ddlSubItem.SelectedIndex != -1 &amp;&amp;
                                                                                 !string.IsNullOrEmpty(
                                                                                     ddlSubItem.SelectedValue))
                                                                                    ? (int?)
                                                                                      ddlSubItem.SelectedValue.ToInt32_2
                                                                                          ()
                                                                                    : null),
                                                                               null,
                                                                               ((cboWOs.SelectedIndex != -1 &amp;&amp;
                                                                                 cboWOs.SelectedIndex != 0 &amp;&amp; !string.IsNullOrEmpty(cboWOs.SelectedValue))
                                                                                    ? cboWOs.SelectedValue.ToInt32_2()
                                                                                    : 0), PostingID);

            if (activityList.Tables.Count &gt; 0)
            {
                if ((Request[&quot;PostingID&quot;] == null))
                {
                    for (int i = 0; i &lt; activityList.Tables[0].Rows.Count; i++)
                    {
                        //activityList.Tables[0].Rows[i][&quot;Original Quantity&quot;] = activityList.Tables[0].Rows[i][&quot;Quantity&quot;];
                        activityList.Tables[0].Rows[i][&quot;Number&quot;] =
                            activityList.Tables[0].Rows[i][&quot;Quantity&quot;] = 0;
                    }
                }

                activityList.AcceptChanges();

                gridActivity.DataSource = activityList.Tables[0];
                gridActivity.DataBind();

                gridActivity.DataKeyField = &quot;ActivityID&quot;;

                gridActivity.DisplayLayout.ColFootersVisibleDefault = ShowMarginInfo.Yes;

                ColumnsCollection cols = gridActivity.Columns;

                if (cols.Exists(&quot;IsComplete&quot;))
                {
                    cols.FromKey(&quot;IsComplete&quot;).Type = ColumnType.CheckBox;
                    cols.FromKey(&quot;IsComplete&quot;).AllowUpdate = AllowUpdate.Yes;
                }

                // RIGHT ALLIGN AND SET THE FOOTER TO SHOW THE TOTAL
                string[] NumericColumns = { &quot;Percentage&quot;, &quot;Quantity&quot;, &quot;Original Quantity&quot; };
                foreach (string column in NumericColumns)
                    if (cols.Exists(column))
                    {
                        cols.FromKey(column).CellStyle.HorizontalAlign =
                            cols.FromKey(column).Header.Style.HorizontalAlign =
                            cols.FromKey(column).Footer.Style.HorizontalAlign = HorizontalAlign.Right;

                        cols.FromKey(column).Footer.Total = SummaryInfo.Sum;

                        cols.FromKey(column).Format = (column.Equals(&quot;Percentage&quot;))
                                                          ? &quot;##0.00&quot;
                                                          : AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                    }


                // SET THE FORMAT QUANTITY FOR NUMERIC FIELDS
                string[] formatColumns = { &quot;Number&quot;, &quot;Dimension1&quot;, &quot;Dimension2&quot;, &quot;Dimension3&quot;, &quot;RemainingQty&quot; };
                foreach (string formatCol in formatColumns)
                {
                    if (cols.Exists(formatCol))
                    {
                        cols.FromKey(formatCol).CellStyle.HorizontalAlign =
                            cols.FromKey(formatCol).Header.Style.HorizontalAlign =
                            cols.FromKey(formatCol).Footer.Style.HorizontalAlign = HorizontalAlign.Right;
                        cols.FromKey(formatCol).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                    }
                }

                // ADD ALL THE HIDDEN COLUMNS&#39; NAMES TO THE FOLLOWING LIST
                var HiddenColumns = new List&lt;string&gt;(new[]
                                                         {
                                                             &quot;ActivityID&quot;, &quot;ItemID&quot;, &quot;UnitID&quot;,
                                                             &quot;UnitIDDim1&quot;, &quot;UnitIDDim2&quot;, &quot;UnitIDDim3&quot;, &quot;Complete&quot;,
                                                             &quot;ModuleID&quot;,
                                                             &quot;ParentInstanceID&quot;, &quot;ReferenceActivityID&quot;, &quot;IsDefault&quot;,
                                                             &quot;ItemQuantity&quot;,
                                                             &quot;ReferenceCount&quot;, &quot;OrgNumber&quot;, &quot;IsAfterLock&quot;, &quot;UnitDim1&quot;,
                                                             &quot;UnitDim2&quot;,
                                                             &quot;UnitDim3&quot;, &quot;IsDefaultSubItemActivity&quot;,
                                                             &quot;AssociatedResourceID&quot;
                                                         });

                bool showItemColumns = true;
                //Set this to true if we have to show all item related columns such as Name, Description etc. 
                //Set this to false if we have to show only basic columns such as Original Quantity, Remaining quantity and Posting Quantity.

                if (!showItemColumns)
                    HiddenColumns.AddRange(new[]
                                               {
                                                   &quot;Name&quot;, &quot;Description&quot;, &quot;Unit&quot;, &quot;Dimension1&quot;, &quot;Dimension2&quot;, &quot;Dimension3&quot;,
                                                   &quot;Quantity&quot;, &quot;Percentage&quot;, &quot;New Quantity&quot;, &quot;IsComplete&quot;
                                               });

                if (Mode == &quot;View&quot;)
                    HiddenColumns.Add(&quot;RemainingQty&quot;);

                
                if (cols.Exists(&quot;Dimension1&quot;) &amp;&amp; !ModuleComponents.Contains(&quot;ItemDimension1&quot;))
                    HiddenColumns.Add(&quot;Dimension1&quot;);
                if (cols.Exists(&quot;Dimension2&quot;) &amp;&amp; !ModuleComponents.Contains(&quot;ItemDimension2&quot;))
                    HiddenColumns.Add(&quot;Dimension2&quot;);
                if (cols.Exists(&quot;Dimension3&quot;) &amp;&amp; !ModuleComponents.Contains(&quot;ItemDimension3&quot;))
                    HiddenColumns.Add(&quot;Dimension3&quot;);
                if (cols.Exists(&quot;Percentage&quot;) &amp;&amp; !ModuleComponents.Contains(&quot;Activities&quot;))
                {
                    HiddenColumns.Add(&quot;Percentage&quot;);
                    HiddenColumns.Add(&quot;IsComplete&quot;); //Hiding complete column if activities are not there
                }

                foreach (UltraGridColumn col in cols)
                    col.Hidden = HiddenColumns.Contains(col.Key);

                // CHANGE THE HEADERS OF THE COLUMNS IF REQUIRED
                cols.FromKey(&quot;Percentage&quot;).Header.Caption = &quot;Weightage&quot;;
                cols.FromKey(&quot;Number&quot;).Header.Caption = &quot;Posting Quantity&quot;;
                cols.FromKey(&quot;Quantity&quot;).Header.Caption = &quot;Total Qty&quot;;
                if (cols.Exists(&quot;RemainingQty&quot;))
                    cols.FromKey(&quot;RemainingQty&quot;).Header.Caption = &quot;Remaining Qty&quot;;
                cols.FromKey(&quot;Dimension1&quot;).Header.Caption = AMP3ApplicationSettings.Instance.Dim1Title;
                cols.FromKey(&quot;Dimension2&quot;).Header.Caption = AMP3ApplicationSettings.Instance.Dim2Title;
                cols.FromKey(&quot;Dimension3&quot;).Header.Caption = AMP3ApplicationSettings.Instance.Dim3Title;
                cols.FromKey(&quot;UnitDim1&quot;).Header.Caption = &quot;Unit &quot; + AMP3ApplicationSettings.Instance.Dim1Title;
                cols.FromKey(&quot;UnitDim2&quot;).Header.Caption = &quot;Unit &quot; + AMP3ApplicationSettings.Instance.Dim2Title;
                cols.FromKey(&quot;UnitDim3&quot;).Header.Caption = &quot;Unit &quot; + AMP3ApplicationSettings.Instance.Dim3Title;

                string[] editableColumns = {
                                               &quot;Number&quot;, &quot;Dimension1&quot;, &quot;UnitDim1&quot;, &quot;Dimension2&quot;, &quot;UnitDim2&quot;,
                                               &quot;Dimension3&quot;, &quot;UnitDim3&quot;, &quot;IsComplete&quot;
                                           };

                if (status != &quot;A&quot;)
                {
                    foreach (string editablecol in editableColumns)
                        if (cols.Exists(editablecol)) cols.FromKey(editablecol).AllowUpdate = AllowUpdate.Yes;
                    cols.FromKey(&quot;Number&quot;).CellStyle.BackColor = Color.Yellow;
                }

                for (int i = 0; i &lt; gridActivity.Rows.Count; i++)
                {
                    if (gridActivity.Rows[i].Cells.FromKey(&quot;Dimension1&quot;).Value == null)
                        gridActivity.Rows[i].Cells.FromKey(&quot;Dimension1&quot;).AllowEditing = AllowEditing.No;
                    if (gridActivity.Rows[i].Cells.FromKey(&quot;Dimension2&quot;).Value == null)
                        gridActivity.Rows[i].Cells.FromKey(&quot;Dimension2&quot;).AllowEditing = AllowEditing.No;
                    if (gridActivity.Rows[i].Cells.FromKey(&quot;Dimension3&quot;).Value == null)
                        gridActivity.Rows[i].Cells.FromKey(&quot;Dimension3&quot;).AllowEditing = AllowEditing.No;
                }

                cols.FromKey(&quot;Name&quot;).Width =
                    cols.FromKey(&quot;Original Quantity&quot;).Width =
                    cols.FromKey(&quot;New Quantity&quot;).Width =
                    cols.FromKey(&quot;IsComplete&quot;).Width =
                    cols.FromKey(&quot;Quantity&quot;).Width = Unit.Pixel(100);

                if (cols.Exists(&quot;RemainingQty&quot;))
                    cols.FromKey(&quot;RemainingQty&quot;).Width = Unit.Pixel(100);

                cols.FromKey(&quot;Number&quot;).Width =
                    cols.FromKey(&quot;Dimension1&quot;).Width =
                    cols.FromKey(&quot;Dimension2&quot;).Width =
                    cols.FromKey(&quot;Dimension3&quot;).Width =
                    cols.FromKey(&quot;Percentage&quot;).Width = Unit.Pixel(75);

                cols.FromKey(&quot;Description&quot;).Width = Unit.Pixel(150);
                cols.FromKey(&quot;Unit&quot;).Width = Unit.Pixel(50);

                if (!showItemColumns)
                {
                    #region Formattimg the New item posting grid

                    cols.FromKey(&quot;Original Quantity&quot;).Move(0);
                    cols.FromKey(&quot;RemainingQty&quot;).Move(1);
                    cols.FromKey(&quot;Number&quot;).Move(2);

                    cols.FromKey(&quot;RemainingQty&quot;).Width =
                        cols.FromKey(&quot;Original Quantity&quot;).Width =
                        cols.FromKey(&quot;Number&quot;).Width = gridActivity.Width.Value.ToInt32_2() / 3;

                    #endregion
                }
                if (cols.Exists(&quot;Nos/Qty&quot;))
                    cols.FromKey(&quot;Nos/Qty&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;

                if (cols.Exists(&quot;New Quantity&quot;))
                    cols.FromKey(&quot;New Quantity&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;

                if (cols.Exists(&quot;Total Qty&quot;))
                    cols.FromKey(&quot;Total Qty&quot;).Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;

                if (cols.Exists(&quot;WOCoeff&quot;))
                    cols.FromKey(&quot;WOCoeff&quot;).Hidden = true;

                foreach (UltraGridColumn col in cols)
                {
                    col.HTMLEncodeContent = true;
                }

                // hdnAmountDigits.Value = CoreDatabaseHelper.GetDigitsAfterDecimal(Constants.FORMAT_QUANTITY).ToString2();
            }
        }

        protected override void HandleDataFromWorkFlow()
        {
            var dsContractData =
                BrixWorkflowManager.Instance.GetResultantDataFromWorkFlow&lt;DataSet&gt;(ViewState[&quot;Context&quot;].ToString2());
            if (!(dsContractData == null || dsContractData.Tables == null || dsContractData.Tables.Count &lt; 1))
            {
                HideMenu(&quot;lnkErrorLog&quot;, true);
            }


        }

        public override Dictionary&lt;string, string&gt; PassInformationToWorkFlow()
        {
            Dictionary&lt;string, string&gt; ds = base.PassInformationToWorkFlow();
            ds.Add(&quot;Context&quot;, ViewState[&quot;Context&quot;].ToString2());
            ds.Add(&quot;msgID&quot;, ViewState[&quot;msgID&quot;].ToString2());
            return ds;
        }

        private void HandleLogView(object sender, EventArgs e)
        {
            try
            {
                #region Exporting Error Log

                var grid = new UltraWebGrid(&quot;grd_Temp&quot;);
                excelExporter.DownloadName = &quot;StatusUpdateErrorLog.XLS&quot;;
                var book = new Workbook();

                var dsContractData =
                    BrixWorkflowManager.Instance.GetResultantDataFromWorkFlow&lt;DataSet&gt;(ViewState[&quot;Context&quot;].ToString2());
                BrixWorkflowManager.Instance.DeleteResultantDataFromWorkFlow(ViewState[&quot;Context&quot;].ToString2());

                if (!(dsContractData == null || dsContractData.Tables == null || dsContractData.Tables.Count &lt; 1))
                {
                    #region Naming of tables

                    dsContractData.Tables[0].TableName = &quot;ItemPosting&quot;;
                    dsContractData.Tables[1].TableName = &quot;Activities&quot;;
                    dsContractData.Tables[2].TableName = &quot;Resources&quot;;

                    DataTable dtIP = dsContractData.Tables[&quot;ItemPosting&quot;];
                    DataTable dtIPActivity = dsContractData.Tables[&quot;Activities&quot;];
                    DataTable dtIPResources = dsContractData.Tables[&quot;Resources&quot;];

                    #endregion

                    ExportGridData(dtIP, &quot;Item Posting&quot;, book, grid, excelExporter);
                    ExportGridData(dtIPActivity, &quot;Item Posting Activities&quot;, book, grid, excelExporter);
                    ExportGridData(dtIPResources, &quot;Item Posting Resources&quot;, book, grid, excelExporter);
                }

                #endregion
            }
            catch (Exception ex)
            {
                throw new Exception(ex.Message);
            }
        }

        private void ExportGridData(DataTable dt, string sheetName, Workbook book, UltraWebGrid grdTemp,
                                    UltraWebGridExcelExporter expGrid)
        {
            grdTemp.Rows.Clear();
            grdTemp.Columns.Clear();
            if (dt != null)
            {
                if (dt.Rows.Count == 0)
                {
                    dt.Rows.Add(dt.NewRow());
                }
                grdTemp.DataSource = dt;
                grdTemp.DataBind();
            }
            book.Worksheets.Add(sheetName);
            expGrid.Export(grdTemp, book.Worksheets[sheetName]);
        }

        #endregion

        #region IWorkflowEnabled Members

        public void CancelHandler(object sender, bool bAfterSave, out string sRedirectTo)
        {
            throw new NotImplementedException();
        }

        public new string FormInstanceId
        {
            get
            {
                int id = String.IsNullOrEmpty(Request.QueryString[&quot;PostingID&quot;])
                             ? -1
                             : int.TryParse(Request.QueryString[&quot;PostingID&quot;], out id) ? id : -1;
                return id.ToString();
            }
        }

        public string FormKey
        {
            get
            {
                if (dtPostedDate.Value != null)
                {
                    return string.Format(&quot;&quot; + LocalizationManager.GetString(&quot;LOC_STDPAYITEM&quot;) + &quot;:{0},Posted Date: {1}&quot;, lblStditemno.Text,
                        ((DateTime)dtPostedDate.Value).ToString(AMP3ApplicationSettings.Instance.FORMAT_DATE, CultureInfo.CurrentCulture));
                }
                else return &quot;-1&quot;;
            }
        }

        public string FormName
        {
            get { return &quot;XITMPOS&quot;; }
        }

        public string ClientValidationFunction
        {
            get { return Mode == &quot;View&quot; ? string.Empty : &quot;ValidateBeforePost()&quot;; }
        }

        public bool IsOldWorkflow
        {
            get { return true; }
        }

        public int PID
        {
            get { return Request.QueryString[&quot;PID&quot;].ToInt32_2(); }
        }

        public int ParentModuleId
        {
            get
            {
                int id = String.IsNullOrEmpty(Request.QueryString[&quot;ContractID&quot;])
                             ? -1
                             : int.TryParse(Request.QueryString[&quot;ContractID&quot;], out id) ? id : -1;
                return id;
            }
        }

        public string PostCancelRedirectUrl
        {
            get { return GetReturnUrl(); }
            //String.Format(CultureInfo.CurrentCulture, &quot;~/Common/BrixListPage.aspx?context=ITMPOST&amp;PID={0}&amp;ContractID={1}&quot;, PID, ParentModuleId); }
        }

        public string PostSaveRedirectUrl(string sSavedToken = &quot;&quot;)
        {
            string redirectUrl = &quot;&quot;;
            //In case of postmore, we are no longer redirecting to same page - this is handled by WorkflowEnabledSaveHandler(false)
            //so we no longer need different redirect urls after save. Also, we dont need different urls for edit / view.
            redirectUrl = &quot;~/Common/BrixListPage.aspx?context=ITMPOST&amp;ContractID={0}&amp;PID={1}&amp;ParentID={0}&quot;.Format2(ContractID, Request[&quot;PID&quot;], ProjectMode);
            if (!string.IsNullOrEmpty(Request[&quot;DWRID&quot;]))
                redirectUrl = (redirectUrl + &quot;&amp;DWRID={0}&quot;).Format2(Request[&quot;DWRID&quot;]);
            return redirectUrl;
        }

        public bool SaveHandler(object sender, out string sSavedInstanceToken, out string sErrors,
                                out string sRedirectTo)
        {
            sSavedInstanceToken = &quot;&quot;;
            sErrors = &quot;&quot;;
            sRedirectTo = &quot;&quot;;

            if (Mode != &quot;View&quot;)
            {
                int subItemValue = 0;
                int.TryParse(ddlSubItem.SelectedItem.Value, out subItemValue);

                int? dtoId;

                int cboselected = (cboWOs.SelectedIndex == 0 || string.IsNullOrEmpty(cboWOs.SelectedValue)) ? 0 : int.Parse(cboWOs.SelectedValue);
                string cboSelectedItem = (cboWOs.SelectedItem == null) ? null : cboWOs.SelectedItem.Text;
                SaveItemPosting((DTOItemPosting)ViewState[PostConst.ITEM_POSTING_STR],
                                cboWOs.SelectedIndex, cboSelectedItem, ddlSubItem.SelectedIndex, subItemValue,
                                cboselected, PostingID, lblQtyPlaced.Text, lblRemainingQty.Text, txtRemarks.Text,
                                txtStationTo.Text,
                                txtStationFrm.Text, chkMark.Checked, chkItemComplete.Checked, wdpComplete.ValueDecimal,
                                txtgrpQnty.ValueDecimal, Request[&quot;DWRID&quot;], ddlContractor.SelectedItem.Text,
                                ddlContractor.SelectedValue, HasWorkOrders, ddlWorkByContractor.SelectedItem.Text, ddlWorkByContractor.SelectedValue, primeContractorId,
                                (DateTime)dtPostedDate.Value, Mode, ContractID, _PostMore,
                                Request[&quot;PostingID&quot;], ItemID, UserDetail.GetCurrentUserDetail().UID,
                                UserDetail.GetCurrentUserDetail().UserName, UserDetail.GetCurrentUserDetail().UserID,
                                &quot;IP&quot;,
                                IsRFINoRequired, ddlRFINo.Items.Count,
                                (IsRFINoRequired
                                     ? (string.IsNullOrEmpty(ddlRFINo.SelectedValue)
                                            ? 0
                                            : ddlRFINo.SelectedValue.ToInt32_2())
                                     : 0),
                                out dtoId, out sSavedInstanceToken, out sErrors, out sRedirectTo);

                if (sSavedInstanceToken == &quot;0&quot;)
                    sSavedInstanceToken = PostingID.ToString();
                else
                    PostingID = sSavedInstanceToken.ToInt32_2();

                int post = 0;
                int.TryParse(sSavedInstanceToken, out post);

                rateAnalysisDetail.ParentInstanceID = post;
                rateAnalysisDetail.LoadItem(dtoId.GetValueOrDefault(0));

                SavingActivity(_PostMore, post, gridActivity, Request[&quot;PostingID&quot;], ItemID);
                if (((AttachmentsControl)attachments).HasAttachments())
                {
                    ((AttachmentsControl)attachments).ParentModuleID = Constants.MODID_CONTMGT;
                    ((AttachmentsControl)attachments).ParentInstanceID = ParentInstanceID.ToInt32_2();

                    if (!((AttachmentsControl)attachments).SaveAttachments(PostingID.ToString2(), Constants.MODID_ITMPOST,
                                                                           UserDetail.GetCurrentUserDetail().UID,
                                                                           UserDetail.GetCurrentUserDetail().UserName,
                                                                           &quot;ItemPosting Attachments&quot;))
                    {
                        ShowError(ResourceFactory.Instance.GetString(&quot;Error in uploading attachments.\\n Item Posting created successfully.&quot;));                        
                    }
                }
                
            }
            else
                sSavedInstanceToken = PostingID.ToString();

            return true;
        }

        #endregion

        protected override void OnPreInit(EventArgs e)
        {
            base.OnPreInit(e);

            SetManagerModel();
            if (managerModel != null)
                managerModel.OnPreInit(model, new XmlFormArgs());
        }
        protected override void OnInit(EventArgs e)
        {
            if (string.IsNullOrEmpty(Mode))
                Mode = Request[&quot;Mode&quot;];


            #region Rate Analysis

            rateAnalysisDetail = (ucRateAnalysis as RateAnalysisControl);
            rateAnalysisDetail.ModuleID = MODULEID;
            rateAnalysisDetail.BackClicked += BtnBackRateAnalysis_Click;
            rateAnalysisDetail.EnableViewState = true;
            rateAnalysisDetail.isOverheadsShown = false;

            #endregion

            InitializeIPItemPicker();

            hdnAmountDigits.Value = CoreDatabaseHelper.GetDigitsAfterDecimal(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY).ToString2();
            //stdItemNumber.Columns = &quot;ItemID,Item|StandardItemNo,&quot; + LocalizationManager.GetString(&quot;Standard Item No.&quot;) + &quot;|Description,Description|Unit,Unit|UnitPrice,Unit Price|Quantity,Total Quantity|RemainingQty,Remaining Quantity&quot;;
            //stdItemNumber.InitPickerParams += new Brix.Platform.BusinessLayer.UserControls.AutoComplete.InitParams(stdItemNumber_InitPickerParams);
            //stdItemNumber.InitPickerNewSchema += new Brix.Platform.BusinessLayer.UserControls.AutoComplete.InitParams(stdItemNumber_InitPickerNewSchema);
            //stdItemNumber.EnsureAjaxParams += new Brix.Platform.BusinessLayer.UserControls.AutoComplete.EnsureAjax(stdItemNumber_EnsureAjaxParams);

            XmlFormArgs args = new XmlFormArgs();
            if (managerModel != null)
                managerModel.OnInit(model, args);
            
            base.OnInit(e);

        }

        //New Picker Grid Impln
        private void InitializeIPItemPicker()
        {
            pickerIPItem.InitializePicker(&quot;/api/IP&quot;, GetWIPItemGridColumns(), &quot;ItemID&quot;);
            //pickerIPItem.TriggerButton.Style.Add(HtmlTextWriterStyle.Display, &quot;none&quot;);
            pickerIPItem.TriggerButton.Text = &quot;...&quot;;
            pickerIPItem.EnableMultiSelect = false;
            pickerIPItem.PostBackAfterSelect = true;
            string json = &quot;{}&quot;;
            pickerIPItem.OptionalParamaters = pickerIPItem.BuildOptionalParameters(json);
            pickerIPItem.OnGridLoad += new PickerGrid.GridLoad(pickerIPItem_OnGridLoad);
            pickerIPItem.OnItemSelected += new PickerGrid.SelectedItems(pickerIPItem_OnItemSelected);
        }

        void pickerIPItem_OnItemSelected(PickerGrid grid, List&lt;Dictionary&lt;string, object&gt;&gt; selectedRows)
        // private void ucAutoComplete_ItemSelected(string selectedDisplay, string selectedValue, string sAdditionalData, List&lt;Dictionary&lt;string, string&gt;&gt; selectedElems, out string postSelectData)
        {
            int itemId = 0;
            //postSelectData = selectedDisplay + sAdditionalData;
            if ((selectedRows.Count &gt; 0) &amp;&amp; (selectedRows[0].ContainsKey(&quot;ItemID&quot;)))
            {
                if (!int.TryParse(selectedRows[0][&quot;ItemID&quot;].ToString(), out itemId)) return;
                if (itemId == ItemID) return;
                SelectStandardItem(itemId);
            }
        }

        //New Picker Grid Impln
        void pickerIPItem_OnGridLoad(PickerGrid grid)
        {
            string json = &quot;{&quot;;
            json += &quot;\&quot;ModuleID\&quot;:\&quot;&quot; + StrModuleId + &quot;\&quot;,&quot;;
            json += &quot;\&quot;ParentInstanceID\&quot;:\&quot;&quot; + ParentInstanceID + &quot;\&quot;}&quot;;
            pickerIPItem.OptionalParamaters = pickerIPItem.BuildOptionalParameters(json);
        }

        //New Picker Grid Impln
        private List&lt;PickerColumnDetails&gt; GetWIPItemGridColumns()
        {
            bool showBaseUnitCostAsPrice = false;
            
            if (!(ModuleComponents.Contains(&quot;ItemMargin&quot;) &amp;&amp; ModuleComponents.Contains(&quot;ItemDiscount&quot;)))
                showBaseUnitCostAsPrice = true;

            string Currency = LocalizationManager.GetModuleCurrency(&quot;CONTMGT&quot;, null, Session[Constants.EIS_ADDITIONAL_INFO].ToString());
            //List&lt;AutoComplete.TColumn&gt; gridCols = new List&lt;AutoComplete.TColumn&gt;(new AutoComplete.TColumn[] {
            //                                         new AutoComplete.TColumn{ColId=&quot;ItemID&quot;,Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;ModuleID&quot;,Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;ParentInstanceID&quot;,Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;LineNo&quot;,Caption=LocalizationManager.GetString(KeyConstants.LineNo)},
            //                                         new AutoComplete.TColumn{ColId=&quot;StandardItemNo&quot;,Caption=LocalizationManager.GetString(KeyConstants.LOC_PAY_ITEM_NO)},
            //                                         new AutoComplete.TColumn{ColId=&quot;Description&quot;},
            //                                         new AutoComplete.TColumn { ColId = &quot;ContainerName&quot;, Caption = LocalizationManager.GetString(&quot;Container&quot;) },
            //                                         new AutoComplete.TColumn{ColId=&quot;AlternateID&quot;,Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;RowNum&quot;,Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;Quantity&quot;,Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY, Caption= &quot;Quantity&quot;},
            //                                         new AutoComplete.TColumn{ColId=&quot;ContractQuantity&quot;, Hidden = true},
            //                                         new AutoComplete.TColumn{ColId=&quot;BaseUnitCost&quot;,Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE, 
            //                                             Caption = showBaseUnitCostAsPrice ? string.IsNullOrEmpty(Currency) ?LocalizationManager.GetString(KeyConstants.LOC_UNIT_PRICE) : &quot;Unit Price In &quot; + Currency : &quot;Base Unit Cost&quot;,
            //                                             Hidden = !showBaseUnitCostAsPrice},
            //                                         new AutoComplete.TColumn{ColId = &quot;UnitPrice&quot;,Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE,Caption = string.IsNullOrEmpty(Currency) ?LocalizationManager.GetString(KeyConstants.LOC_UNIT_PRICE) : &quot;Unit Price In &quot; + Currency, Hidden = showBaseUnitCostAsPrice},
            //                                         new AutoComplete.TColumn{ColId=&quot;Amount&quot;,Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT,
            //                                                                  Caption = string.IsNullOrEmpty(Currency) ?
            //                                                                            LocalizationManager.GetString(KeyConstants.LOC_AMOUNT) :
            //                                                                            &quot;Amount in &quot; + Currency},
            //                                         new AutoComplete.TColumn{ColId=&quot;UnitID&quot;, Hidden = true},
            //                                         new AutoComplete.TColumn{ColId=&quot;Unit&quot;, Caption=LocalizationManager.GetString(&quot;Unit&quot;)},
            //                                         new AutoComplete.TColumn{ColId=&quot;AccountingCode&quot;,Caption=&quot;Accounting Code&quot;},
            //                                         new AutoComplete.TColumn{ColId=&quot;RemainingQty&quot;,Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY,Caption=&quot;Remaining Quantity&quot;},
            //                                         new AutoComplete.TColumn{ColId=&quot;IsComplete&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;IsNonContract&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;IsMustBid&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;CreatedBy&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;CreatedOn&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;LastUpdatedOn&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;LastUpdatedBy&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;Number&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;Dimension1&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;Dimension2&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;Dimension3&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;Notes&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;Margin&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;Discount&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;UnitCost&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;OverheadCost&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;ReferenceItemID&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;ReferenceItemType&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;ISIN&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;TimeStamp&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;ContainerID&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;Path&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;SubItemCount&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;GroupID&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;GroupName&quot;, Hidden=true},
            //                                         new AutoComplete.TColumn{ColId=&quot;IsReWork&quot;, Hidden=true}});

            ////AutoComplete.GridInfo inf = new AutoComplete.GridInfo();
            ////inf.Cols = gridCols.ToArray();
            ////return inf;
            //return gridCols;


            List&lt;PickerColumnDetails&gt; gridColumns = new List&lt;PickerColumnDetails&gt;();
            List&lt;string&gt; allColumns = new List&lt;string&gt;() {&quot;ItemID&quot;,&quot;ModuleID&quot;,&quot;ParentInstanceID&quot;,&quot;LineNo&quot;, &quot;StandardItemNo&quot;, &quot;Description&quot;, &quot;ContainerName&quot; ,
                &quot;AlternateID&quot;,&quot;RowNum&quot;, &quot;Quantity&quot;,&quot;ContractQuantity&quot;,&quot;BaseUnitCost&quot;,&quot;UnitPrice&quot;,&quot;Amount&quot;,&quot;UnitID&quot;,&quot;Unit&quot;,&quot;AccountingCode&quot;,&quot;RemainingQty&quot;,&quot;IsComplete&quot;,&quot;IsNonContract&quot;,
                &quot;IsMustBid&quot;,&quot;CreatedBy&quot;,&quot;CreatedOn&quot;,&quot;LastUpdatedOn&quot;,&quot;LastUpdatedBy&quot;,&quot;Number&quot;,&quot;Dimension1&quot;,&quot;Dimension2&quot;,&quot;Dimension3&quot;,&quot;Notes&quot;, &quot;Margin&quot;,&quot;Discount&quot;,&quot;UnitCost&quot;,&quot;OverheadCost&quot;,
                &quot;ReferenceItemID&quot;,&quot;ReferenceItemType&quot;,&quot;ISIN&quot;,&quot;TimeStamp&quot;, &quot;ContainerID&quot;,&quot;Path&quot;,&quot;SubItemCount&quot;,&quot;GroupID&quot;, &quot;GroupName&quot;, &quot;IsReWork&quot;};

            Dictionary&lt;string, string&gt; visibleColumns = new Dictionary&lt;string, string&gt;();

            visibleColumns.Add(&quot;LineNo&quot;, &quot;Line No&quot;);
            visibleColumns.Add(&quot;StandardItemNo&quot;, LocalizationManager.GetString(KeyConstants.LOC_PAY_ITEM_NO));
            visibleColumns.Add(&quot;Description&quot;, &quot;Description&quot;);
            visibleColumns.Add(&quot;Path&quot;, LocalizationManager.GetString(&quot;Container&quot;));
            visibleColumns.Add(&quot;Quantity&quot;, &quot;Quantity&quot;);
            // visibleColumns.Add(&quot;Amount&quot;, string.IsNullOrEmpty(Currency) ? LocalizationManager.GetString(KeyConstants.LOC_AMOUNT) : &quot;Amount in &quot; + Currency);
            visibleColumns.Add(&quot;Unit&quot;, &quot;Unit&quot;);

            if (ModuleComponents.Contains(&quot;ShowAccountingCode&quot;))
                visibleColumns.Add(&quot;AccountingCode&quot;, &quot;Accounting Code&quot;);

            //visibleColumns.Add(&quot;RemainingQty&quot;, &quot;Remaining Qty&quot;);
            if (showBaseUnitCostAsPrice)
            {
                visibleColumns.Add(&quot;BaseUnitCost&quot;, string.IsNullOrEmpty(Currency) ? LocalizationManager.GetString(KeyConstants.LOC_UNIT_PRICE) : &quot;Unit Price In &quot; + Currency);
            }
            else
            {
                visibleColumns.Add(&quot;BaseUnitCost&quot;, &quot;Base Unit Cost&quot;);
                visibleColumns.Add(&quot;UnitPrice&quot;, string.IsNullOrEmpty(Currency) ? LocalizationManager.GetString(KeyConstants.LOC_UNIT_PRICE) : &quot;Unit Price In &quot; + Currency);
            }


            List&lt;string&gt; qtyColumns = new List&lt;string&gt;() { &quot;Quantity&quot;, &quot;RemainingQty&quot; };
            List&lt;string&gt; rateColumns = new List&lt;string&gt;() { &quot;BaseUnitCost&quot;, &quot;UnitPrice&quot; };
            List&lt;string&gt; amtColumns = new List&lt;string&gt;() { &quot;Amount&quot; };
            List&lt;string&gt; integerColumns = new List&lt;string&gt;() { &quot;LineNo&quot; };
            //List&lt;string&gt; dateColumns = new List&lt;string&gt;() { &quot;PostingDate&quot; };

            int colWidth = 0;

            foreach (string col in allColumns)
            {
                if (!visibleColumns.ContainsKey(col))
                {
                    PickerColumnDetails tCol = new PickerColumnDetails { Caption = col, ColumnName = col, Hidden = true };
                    gridColumns.Add(tCol);
                }
                else
                {
                    switch (col.ToUpper())
                    {
                        case &quot;LINENO&quot;: colWidth = 75; break;
                        case &quot;STANDARDITEMNO&quot;: colWidth = 100; break;
                        case &quot;DESCRIPTION&quot;: colWidth = 425; break;
                        default: colWidth = 200; break;

                    }
                    PickerColumnDetails tCol = new PickerColumnDetails { Caption = visibleColumns[col], ColumnName = col, Hidden = false, Width = colWidth, Type = &quot;string&quot; };
                    if (qtyColumns.Contains(col))
                    {
                        tCol.Format = AMP3ApplicationSettings.Instance.FORMAT_QUANTITY;
                        tCol.Type = &quot;number&quot;;
                    }
                    if (rateColumns.Contains(col))
                    {
                        tCol.Format = AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE;
                        tCol.Type = &quot;number&quot;;
                    }
                    if (amtColumns.Contains(col))
                    {
                        tCol.Format = AMP3ApplicationSettings.Instance.FORMAT_AMOUNT;
                        tCol.Type = &quot;number&quot;;
                    }
                    if (integerColumns.Contains(col))
                    {
                        tCol.Type = &quot;number&quot;;
                    }
                    //if (dateColumns.Contains(col))
                    //{
                    //    tCol.Format = AMP3ApplicationSettings.Instance.FORMAT_DATE;
                    //    tCol.Type = &quot;date&quot;;
                    //}
                    gridColumns.Add(tCol);
                }
            }
            return gridColumns;
        }

        protected override void CreateChildControls()
        {
            try
            {
                base.OnInit(null);
                base.CreateChildControls();

                var menuGroups = new List&lt;MenuGroup&gt;();
                MenuGroup generalGroup = new MenuGroup(&quot;General&quot;);
                if (Mode == &quot;View&quot;)
                {
                    generalGroup.AddMenu(new LargeButton(&quot;lnkBack&quot;, &quot;Back&quot;, &quot;Icn_Back.png&quot;));
                    //CreateToolBarMenu(Menus, null);
                }
                if (AllowSave)
                    generalGroup.AddMenu(new LargeButton(&quot;lnkSave&quot;, &quot;Post&quot;, &quot;Icn_Save.png&quot;));
                if (Mode != &quot;View&quot;)
                {
                    if (AllowSave)
                        generalGroup.AddMenu(new TextIcon(&quot;lnkImport&quot;, &quot;Post More&quot;, &quot;Icn_AddMore_16.png&quot;));
                    generalGroup.AddMenu(new TextIcon(&quot;lnkCancel&quot;, &quot;Cancel&quot;, &quot;Icn_Cancel_16.png&quot;));
                }
                if (generalGroup.Menus.Count &gt; 0)
                    menuGroups.Add(generalGroup);
                CreateToolBarMenu(menuGroups, null);

                //if (MainToolBar.GetMenuReference(&quot;lnkErrorLog&quot;) == null)
                //    MainToolBar.AddMenu(new BrixMenu(&quot;lnkErrorLog&quot;, &quot;Error Log&quot;, &quot;Icn_tables .png&quot;, 55));
                if (MainToolBar.GetMenuReference(&quot;lnkErrorLog&quot;) == null)
                {
                    generalGroup.AddMenu(new LargeButton(&quot;lnkErrorLog&quot;, &quot;Error Log&quot;, &quot;Icn_Errorlog.png&quot;));
                }
                if (MainToolBar.GetMenuReference(&quot;lnkErrorLog&quot;) != null)
                {
                    MainToolBar.GetMenuReference(&quot;lnkErrorLog&quot;).Click += HandleLogView;
                    MainToolBar.HideMenu(&quot;lnkErrorLog&quot;);
                }


                if ((IsWorkflowAssociated(FormName)))
                {
                    if (Mode == &quot;Edit&quot;)
                    {
                        DataSet ds =
                            ComponentHelper.Instance.ExecuteDataSet(ItemPostingStoredProcedure.usp_CONTMGTGetItemPosting,
                                                                    null,
                                                                    new object[] { ContractID, ItemID, PostingID, Mode, WOID });
                        if (ds.Tables[0].Rows.Count &gt; 0 &amp;&amp; ds.Tables[0].Rows[0][&quot;Status&quot;].ToString() == &quot;A&quot;)
                        {
                            MainToolBar.HideMenu(&quot;lnkSave&quot;);
                        }
                    }
                }
                ChildControlsCreated = true;
            }
            catch { }
        }

        protected override void CustomizeToolBar()
        {
            if (MainToolBar.GetMenuReference(&quot;lnkSave&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkSave&quot;).Click += btnPost_Click;
                // MainToolBar.GetMenuReference(&quot;lnkSave&quot;).Attributes.Add(&quot;onclick&quot;, &quot;ValidateBeforePost();return false;&quot;);
                MainToolBar.GetMenuReference(&quot;lnkSave&quot;).OnClientClick += &quot;javascript: return ValidateBeforePost();&quot;;
                MainToolBar.GetMenuReference(&quot;lnkSave&quot;).ToolTip = &quot;Post&quot;;
            }

            if (MainToolBar.GetMenuReference(&quot;lnkImport&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkImport&quot;).Click += btnPostMore_Click;
                //MainToolBar.GetMenuReference(&quot;lnkImport&quot;).Attributes.Add(&quot;onclick&quot;, &quot;ValidateBeforePost();return false;&quot;);
                MainToolBar.GetMenuReference(&quot;lnkImport&quot;).OnClientClick += &quot;javascript: return ValidateBeforePost();&quot;;
                MainToolBar.GetMenuReference(&quot;lnkImport&quot;).ToolTip = &quot;Post More&quot;;
                MainToolBar.GetMenuReference(&quot;lnkImport&quot;).CausesValidation = false;
            }

            if (MainToolBar.GetMenuReference(&quot;lnkCancel&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkCancel&quot;).Click += btnCancel_Click;
                MainToolBar.GetMenuReference(&quot;lnkCancel&quot;).CausesValidation = false;
            }

            if (MainToolBar.GetMenuReference(&quot;lnkBack&quot;) != null)
            {
                MainToolBar.GetMenuReference(&quot;lnkBack&quot;).Click += lnkBack_Click;
                MainToolBar.GetMenuReference(&quot;lnkBack&quot;).ToolTip = &quot;Back&quot;;
            }
        }

        protected override void OnPreRender(EventArgs e)
        {
            if (!String.IsNullOrEmpty(Request[&quot;Mode&quot;]) &amp;&amp; Request[&quot;Mode&quot;] == &quot;View&quot; &amp;&amp;
                MainToolBar.GetMenuReference(&quot;lnkSave&quot;) != null)
                MainToolBar.HideMenu(&quot;lnkSave&quot;);

            //if (rateAnalysisDetail.Visible == true)
            //{
            //    MainToolBar.HideMenu(&quot;lnkSave&quot;);
            //    MainToolBar.HideMenu(&quot;lnkImport&quot;);
            //}
            //else
            //    MainToolBar.ShowMenu(&quot;lnkSave&quot;);

            if (Request[&quot;Mode&quot;] == &quot;Edit&quot; &amp;&amp; bRate)
            {
                MainToolBar.HideMenu(&quot;lnkImport&quot;);
            }
            else
            {
                if (MainToolBar.GetMenuReference(&quot;lnkImport&quot;) != null)
                    MainToolBar.GetMenuReference(&quot;lnkImport&quot;).Visible = true;
            }
            // Hide workflow buttons if set to true : This is viewstate property so will be remembered across the post backs and 
            // is being reset in the showdiv function
            if (hideWorkflowButtons)
                HideWorkflowButtons();

            if (hideToolBar)
                MainToolBar.Visible = false;

            if (!string.IsNullOrEmpty(rateAnalysisDetail.RAPageTitle) &amp;&amp; DivRateAnalysis.Visible == true)
                PageTitle = rateAnalysisDetail.RAPageTitle;

            base.OnPreRender(e);
        }

        protected void Page_Load(object sender, EventArgs e)
        {
                       
            ModuleComponentsIP = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_ITMPOST);

            //Allow selection of contractors in IP with DWR
            allowContractorDPRIP = ModuleComponentsIP.Contains(&quot;CONDPRIP&quot;);

            UIHelper.DisableRoleSelection(Page);

            if (!string.IsNullOrEmpty(Request[&quot;Mode&quot;]) &amp;&amp; (Request[&quot;Mode&quot;] == &quot;View&quot; || Request[&quot;Mode&quot;] == &quot;Edit&quot;))
            {
                PostingID = Request[&quot;PostingID&quot;].ToInt32_2();
                bRate = true;
                if (!IsPostBack)
                {
                    LoadAttachments();
                    ((AttachmentsControl)attachments).ReadOnly = (Request[&quot;Mode&quot;] == &quot;View&quot;);
                }
            }

            if (Mode == &quot;Edit&quot; &amp;&amp; string.IsNullOrEmpty(Request[&quot;Mode&quot;]))
                PostingID = rateAnalysisDetail.ParentInstanceID;

            if (String.IsNullOrEmpty(Request[&quot;PID&quot;]) || String.IsNullOrEmpty(Request[&quot;ContractID&quot;]))
            {
                Response.Redirect(
                   &quot;~/Common/BrixListPage.aspx?Context=ITMPOST&amp;ContractID={0}&amp;PID={1}&amp;ParentID={0}&quot;.Format2(ContractID,
                                                                                               Request[&quot;PID&quot;]), true);
            }

            //permissions
            DTO contractDTO = BL.Instance.GetContract(ContractID, FetchSet.All);


            ViewState[&quot;ContractDTO&quot;] = contractDTO;

            if (contractDTO.ContainsModule(&quot;WORKORD&quot;))
            {
                //DataSet ds = ITMPOSTBL.Instance.GetWorkOrdersForContract(ContractID);
                //if (ds.Tables.Count &gt; 0 &amp;&amp; ds.Tables[0].Rows.Count &gt; 0)
                HasWorkOrders = true;
                //else
                //    HasWorkOrders = false;
            }
            else
                HasWorkOrders = false;

            if (HasWorkOrders)
            {
                divContractorOnly.Style.Add(&quot;display&quot;, &quot;none&quot;);
                divContractorWO.Style.Add(&quot;display&quot;, &quot;block&quot;);
            }
            else
            {
                divContractorOnly.Style.Add(&quot;display&quot;, &quot;block&quot;);
                divContractorWO.Style.Add(&quot;display&quot;, &quot;none&quot;);
            }

            var strPermList = (List&lt;string&gt;)Context.Items[Constants.MODULE_PERMISSIONS];
            btnPost.Enabled =
                btnPostMore.Enabled =
                (contractDTO.Locked == &quot;Y&quot;) &amp;&amp; strPermList.Contains(PostConst.POSTING_CREATE) ||
                strPermList.Contains(PostConst.POSTING_EDIT);

            if (!string.IsNullOrEmpty(Request[&quot;Mode&quot;]) &amp;&amp; Request[&quot;Mode&quot;] == &quot;Edit&quot;)
                btnPostMore.Visible = false;

            if (contractDTO.ContainsModule(&quot;CONTRFI&quot;))
            {
                DataTable dtTemp = BL.Instance.GetRFISettings(ContractID);
                IsRFINoRequired = dtTemp.Rows.Count &gt; 0
                                      ? (dtTemp.Rows[0][&quot;IsReqForPosting&quot;].ToBoolean2() &amp;&amp;
                                         (HasWorkOrders ? (ddlContractor.SelectedItem == null ||
                                         ddlContractor.SelectedValue.Split(&#39;,&#39;)[1].Equals(&quot;P&quot;)) : (ddlWorkByContractor.SelectedItem == null ||
                                         ddlWorkByContractor.SelectedValue.Split(&#39;,&#39;)[1].Equals(&quot;P&quot;))))
                                      : false;
            }
            else
                IsRFINoRequired = false;

            info.NumberDecimalDigits = (fmt.Length &gt; 1) ? fmt[1].Length : 0;
            pickerIPItem.Title = &quot;Please select &quot; + LocalizationManager.GetString(&quot;an Item&quot;);

            if (!IsPostBack)
            {
                workOrderIndex = -1;
                contractorIndex = -1;

                DataTable dtUnits = BL.Instance.GetMeasSys(Session[Constants.EIS_ADDITIONAL_INFO].ToString2(),
                                                           contractDTO.MeasSysID);
                rateAnalysisDetail.MeasSysID = (contractDTO.MeasSysID == null) ? 0 : Convert.ToInt32(contractDTO.MeasSysID);
                rateAnalysisDetail.BindUnits(dtUnits, &quot;Unit&quot;, &quot;ID&quot;);

                lblError.ForeColor = Color.Red;

                try
                {
                    if (contractDTO.IsDeleted == &quot;Y&quot;)
                        throw new Exception(&quot;Cannot create postings on Deleted Contracts.&quot;);
                }
                catch
                {
                    Response.Redirect(
                       &quot;~/Common/BrixListPage.aspx?context=CONTMGT&amp;PID=&quot; + Request[PostConst.PROJECT_ID], true);
                }

                txtRemarks.Attributes.Add(&quot;maxLength&quot;, &quot;1000&quot;);


                if (!String.IsNullOrEmpty(Mode))
                {

                    dtPostedDate.MaxDate = (ProjectMode == &quot;I&quot;) ? IntegrationCutoffDate.ToMWDateTime().AddDays(-1) : MWDateTimeHelper.MWToday;
                    dtPostedDate.MinDate = (ProjectMode == &quot;I&quot;) ? DefaultRecordDate.ToMWDateTime() : DateTime.MinValue;

                    if ((Mode == &quot;View&quot; || Mode == &quot;Edit&quot;))
                    {
                        rateAnalysisDetail.ParentInstanceID = PostingID;
                        lnkSubItems.Enabled = lnkRateAnalysis.Enabled = true;
                        LoadItemPosting();
                        BindActivityGrid(MODULEID, PostingID, ItemID);
                        if (!string.IsNullOrEmpty(Request[&quot;DWRID&quot;]))
                        {
                            cboWOs.Enabled = false;
                        }
                        ddlWorkByContractor.Enabled = ddlContractor.Enabled = false;
                    }
                    else
                    {
                        btnPostMore.Visible = true;
                        PopulateContractors();
                        dtPostedDate.Value = (ProjectMode == &quot;I&quot;) ? DefaultRecordDate.ToMWDateTime() : MWDateTimeHelper.MWToday;
                        if (!String.IsNullOrEmpty(Request[&quot;DWRID&quot;]))
                        {
                            PopulateDWRDetails(Request[&quot;DWRID&quot;].ToInt32_2());
                        }
                    }
                }
                SetLocalizedStrings();

                ViewState[&quot;Context&quot;] = DateTime.UtcNow.Ticks.ToString2() + UserDetail.GetCurrentUserDetail().UID;
                ViewState[&quot;msgID&quot;] = &quot;msgID_&quot; + DateTime.UtcNow.Ticks.ToString2();

            }
            if (Mode == &quot;View&quot;)
                MakeReadOnly();

            if (IsRFINoRequired)
            {
                trRFINumber.Style.Value = &quot;display:block&quot;;
                dtPostedDate.AutoPostBack.ValueChanged = true;
                dtPostedDate.ValueChanged += dtPostedDate_ValueChanged;
            }

            gridActivity.DisplayLayout.ClientSideEvents.AfterExitEditModeHandler = &quot;UpdateGridData&quot;;
            lnkRateAnalysis.OnClientClick = string.Empty;
            if (PostingID == 0)
            {
                lnkRateAnalysis.OnClientClick = &quot;return confirmSave()&quot;;
            }

            if (DivRateAnalysis.Visible == true)
                PageTitle = &quot;Resource Consumption&quot;;

            if (Request[&quot;Mode&quot;] == &quot;New&quot;)
                PageTitle = &quot;New Item Posting&quot;;

            if (Request[&quot;Mode&quot;] == &quot;Edit&quot;)
                PageTitle = &quot;Edit Item Posting&quot;;
            if (Request[&quot;Mode&quot;] == &quot;View&quot;)
                PageTitle = &quot;View Item Posting&quot;;

            List&lt;string&gt; components = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CONTMGT);
            if (!contractDTO.ContainsModule(&quot;WORKORD&quot;))
            {
                txtQuantity.InnerText = &quot; Quantity (Contract) :&quot;;
                txtQuantityPlacedDate.InnerText = &quot;Quantity Placed to Date (Contract) :&quot;;
                txtQuantityRemaining.InnerText = &quot;Quantity Remaining (Contract) :&quot;;
            }

            if (!components.Contains(&quot;IPResConsumption&quot;))
            {
                lnkRateAnalysis.Style.Add(System.Web.UI.HtmlTextWriterStyle.Display, &quot;none&quot;);
                tdCost.Style.Add(&quot;display&quot;, &quot;none&quot;);
                lblCost.Style.Add(&quot;display&quot;, &quot;none&quot;);
                trAmountRow3.Style.Add(&quot;display&quot;, &quot;none&quot;);
            }

            if (!(ModuleComponents.Contains(&quot;ItemMargin&quot;) &amp;&amp; ModuleComponents.Contains(&quot;ItemDiscount&quot;)))
            {
                tdUnitCost.InnerText = &quot;Unit Price&quot;;
                tdUnitPrce.Style.Add(&quot;display&quot;, &quot;none&quot;);
                lblUnitPrice.Style.Add(&quot;display&quot;, &quot;none&quot;);
            }

            if (!IsPostBack)
            {
                if (ModuleComponents.Contains(&quot;Activities&quot;))
                    tdActivities.InnerText = &quot;Activities&quot;;
                else
                {
                    tdActivities.InnerText = &quot;Item&quot;;
                    tdActivityCount.Style.Add(&quot;display&quot;, &quot;none&quot;);
                    lblActivityCount.Style.Add(&quot;display&quot;, &quot;none&quot;);
                }
            }


            //Call Manager model pageload to implement customization.
            XmlFormArgs args = new XmlFormArgs();
            if (managerModel != null)
                managerModel.OnPageLoad(model, args);

        }

        private void dtPostedDate_ValueChanged(object sender, WebDateChooser.WebDateChooserEventArgs e)
        {
            if (!string.IsNullOrEmpty(txtStdItemNo.Text))
                LoadRFINumbers();
        }

        private void PopulateDWRDetails(int DWRID)
        {
            DWR dwrObj = BL.Instance.GetDWRDetails(DWRID);
            if (dwrObj.WorkOrderID.HasValue)
            {
                if (cboWOs.Items.FindByValue(dwrObj.WorkOrderID.ToString2()) != null)
                {
                    cboWOs.SelectedValue = dwrObj.WorkOrderID.ToString2();
                }
                else
                {
                    string woNumber = dwrObj.WorkOrderNo;
                    if (!dwrObj.IsLatestWO) woNumber += &quot;(Old)&quot;;
                    var liWorkOrder = new ListItem(woNumber, dwrObj.WorkOrderID.ToString2());
                    cboWOs.Items.Add(liWorkOrder);
                    cboWOs.SelectedIndex = cboWOs.Items.IndexOf(liWorkOrder);
                }
                StrModuleId = &quot;WORKORD&quot;;
                ParentInstanceID = dwrObj.WorkOrderID.ToInt32_2();
            }
            if (HasWorkOrders)
            {
                ListItem liContractor = ddlContractor.Items.FindByValue(dwrObj.ContractorValueType);
                if (liContractor != null)
                    ddlContractor.SelectedIndex = ddlContractor.Items.IndexOf(liContractor);
            }
            else
            {
                ListItem liContractor = ddlWorkByContractor.Items.FindByValue(dwrObj.ContractorValueType);
                if (liContractor != null)
                    ddlWorkByContractor.SelectedIndex = ddlWorkByContractor.Items.IndexOf(liContractor);
            }
            cboWOs.Enabled = false;
            ddlContractor.Enabled = false;
            ddlWorkByContractor.Enabled = (allowContractorDPRIP &amp;&amp; !HasWorkOrders);
        }

        private void MakeReadOnly()
        {
            txtRemarks.ReadOnly = txtgrpQnty.ReadOnly = rateAnalysisDetail.ReadOnly = txtStationFrm.ReadOnly = txtStationTo.ReadOnly = true;
            btnCancel.Visible = wdpComplete.Visible = chkRememberCur.Visible = chkRemberPrev.Visible =
                                                                               chkMark.Visible =
                                                                                cboWOs.Visible =
                                                                                pnlHdnFields.Visible =
                                                                                ddlSubItem.Enabled = false;
            ddlRFINo.Enabled = false;
        }

        private void SetLocalizedStrings()
        {
            PageTitle = Mode + &quot; &quot; + LocalizationManager.GetString(KeyConstants.LOC_ITEM_POSTING);
            hdnItem.Value = LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR);
            tdPI2.InnerText = LocalizationManager.GetString(KeyConstants.LOC_PAY_ITEM_NO) + &quot; :&quot;;
        }

        private void PopulateContractors()
        {
            DataTable dTable = BL.Instance.GetContractors(ContractID);
            string primeContractorsValue = &quot;&quot;;
            if (dTable.Rows.Count &gt; 0)
            {
                primeContractorsValue = dTable.Select(&quot;CType = &#39;P&#39;&quot;)[0][&quot;ValueandType&quot;].ToString2();
                primeContractorId = dTable.Select(&quot;CType = &#39;P&#39;&quot;)[0][&quot;ContractorID&quot;].ToInt32_2();
            }

            ddlContractor.DataSource = dTable;
            ddlContractor.DataTextField = &quot;Contact&quot;;
            ddlContractor.DataValueField = &quot;ValueandType&quot;;
            ddlContractor.DataGroupField = &quot;ContractorType&quot;;
            ddlContractor.DataBind();

            DataTable dTable1 = BL.Instance.GetContractors(ContractID, true);
            ddlWorkByContractor.DataSource = dTable1;
            ddlWorkByContractor.DataTextField = &quot;Contact&quot;;
            ddlWorkByContractor.DataValueField = &quot;ValueandType&quot;;
            ddlWorkByContractor.DataGroupField = &quot;ContractorType&quot;;

            ddlWorkByContractor.DataBind();

            if (ddlContractor.Items.Count &gt; 0)
                ddlWorkByContractor.SelectedIndex = ddlContractor.SelectedIndex =
                       ddlContractor.Items.IndexOf((ddlContractor.Items.FindByValue(primeContractorsValue)));
            contractorIndex = HasWorkOrders ? ddlContractor.SelectedIndex : ddlWorkByContractor.SelectedIndex;
        }

        private void LoadItemPosting()
        {
            if (Mode == &quot;View&quot;)
            {
                MakeReadOnly();
            }

            DTOItemPosting dto = null;
            try
            {
                dto = ITMPOSTBL.Instance.GetItemPosting(ContractID, Request[&quot;ItemID&quot;].ToInt32_2(), PostingID,
                                                        Request[&quot;Mode&quot;], null);
                if (dto.Postings.Status.Equals(&quot;A&quot;) || !(String.IsNullOrEmpty(Mode) || Mode != &quot;View&quot;))
                    MakeReadOnly();
            }
            catch
            {
                Response.Redirect(&quot;~/Common/BrixListPage.aspx?context=CONTMGT&amp;PID=&quot; + Request[PostConst.PROJECT_ID],
                                 true);
            }
            ItemID = dto.ID.GetValueOrDefault(0);
            dto.ContractID = ContractID;
            ViewState[PostConst.ITEM_POSTING_STR] = dto;

            if (!(IsWorkflowAssociated(FormName)))
            {
                if (Mode == &quot;Edit&quot; &amp;&amp; ((ViewState[PostConst.ITEM_POSTING_STR] as DTOItemPosting).Postings.Status == &quot;A&quot;
                                       || (ViewState[PostConst.ITEM_POSTING_STR] as DTOItemPosting).Complete == &quot;Y&quot;))
                {
                    ShowNotificationMessage(&quot;Item postings is approved.&quot;, NotificationType.Success);
                    //lblError.ForeColor = Color.Green;
                    MakeReadOnly();
                }
            }

            if (!String.IsNullOrEmpty(Request[&quot;Status&quot;]) &amp;&amp; Request[&quot;Status&quot;] == &quot;A&quot;)
            {
                ShowNotificationMessage(&quot;Item postings is approved.&quot;, NotificationType.Success);
                //   lblError.ForeColor = Color.Green;
                MakeReadOnly();
            }

            if ((ViewState[PostConst.ITEM_POSTING_STR] as DTOItemPosting).Complete == &quot;Y&quot;)
            {
                string errMsg = &quot;Item postings not allowed. The &quot; +
                                LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR) + &quot; is marked complete.&quot;;
                ShowNotificationMessage(errMsg, NotificationType.Error);
                // lblError.ForeColor = Color.Green;
                MakeReadOnly();
            }

            if (Mode == &quot;Edit&quot;)
            {
                chkItemComplete.Checked = (dto.Postings.BidItemComplete == &quot;Y&quot; ? true : false);
                chkMark.Checked = (dto.Postings.Attention == &quot;Y&quot; ? true : false);
                wdpComplete.ValueDecimal = dto.Postings.PercentComplete.ToString2().ToDecimal2();
                txtStationFrm.Text = dto.Postings.FromStn;
                txtStationTo.Text = dto.Postings.ToStn;
                txtRemarks.Text = dto.Postings.Remarks;
                dtPostedDate.Value = (dto.Postings.PostedDate &gt; dtPostedDate.MaxDate
                                          ? DateTime.UtcNow
                                          : dto.Postings.PostedDate);
                hfContID.Value = HasWorkOrders ? dto.Postings.ContractorID.ToString2() : dto.Postings.WorkByContractorID.ToString2();
                hfContType.Value = HasWorkOrders ? dto.Postings.ContractorType.ToString2() : dto.Postings.WorkByContractorType.ToString2();


                //populate the contractors for this contract
                PopulateContractors();

                ddlWorkByContractor.SelectedIndex = ddlContractor.SelectedIndex = -1;
                if (!String.IsNullOrEmpty(hfContID.Value))
                {
                    if (
                        ddlContractor.Items.FindByValue(dto.Postings.ContractorID.ToString2() + &quot;,&quot; +
                                                        dto.Postings.ContractorType.ToString2()) != null)
                        ddlContractor.Items.FindByValue(dto.Postings.ContractorID.ToString2() + &quot;,&quot; +
                                                        dto.Postings.ContractorType.ToString2()).Selected = true;
                    if (
                       ddlWorkByContractor.Items.FindByValue(dto.Postings.WorkByContractorID.ToString2() + &quot;,&quot; +
                                                       dto.Postings.WorkByContractorType.ToString2()) != null)
                        ddlWorkByContractor.Items.FindByValue(dto.Postings.WorkByContractorID.ToString2() + &quot;,&quot; +
                                                        dto.Postings.WorkByContractorType.ToString2()).Selected = true;
                }
                else
                {
                    if (ddlContractor.Items.FindByText(&quot;--Select One--&quot;) != null)
                        ddlContractor.Items.FindByText(&quot;--Select One--&quot;).Selected = false;
                    if (ddlWorkByContractor.Items.FindByText(&quot;--Select One--&quot;) != null)
                        ddlWorkByContractor.Items.FindByText(&quot;--Select One--&quot;).Selected = false;
                }
                int itemID = (Request[&quot;ItemID&quot;] != null) ? Request[&quot;ItemID&quot;].ToInt32_2() : 0;
                string[] contractorDetails = HasWorkOrders ? ddlContractor.SelectedValue.Split(&#39;,&#39;) : ddlWorkByContractor.SelectedValue.Split(&#39;,&#39;);
                if (contractorDetails.Length &gt; 1 &amp;&amp; contractorDetails[1] == &quot;S&quot;)
                    PopulateWO(contractorDetails[0]);
                if (cboWOs.Items.FindByValue(dto.Postings.WOID.ToString2()) != null)
                {
                    cboWOs.SelectedIndex =
                        cboWOs.Items.IndexOf(cboWOs.Items.FindByText(dto.Postings.WorkOrderNo.ToString2()));
                    //cboWOs.Items.FindByText(dto.Postings.WorkOrderNo.ToString2()).Selected = true;
                    ddlWorkByContractor.Enabled = ddlContractor.Enabled = false;
                    cboWOs.Enabled = false;
                }
                else if (contractorDetails.Length &gt; 1 &amp;&amp; contractorDetails[1] == &quot;S&quot;)
                {
                    string woNumber = dto.Postings.WorkOrderNo;
                    woNumber += &quot;(Old)&quot;;
                    var liWorkOrder = new ListItem(woNumber, dto.Postings.WOID.ToString2());
                    cboWOs.Items.Add(liWorkOrder);
                    cboWOs.SelectedIndex = cboWOs.Items.IndexOf(liWorkOrder);
                }
                else
                    cboWOs.Enabled = false;

                contractorIndex = HasWorkOrders ? ddlContractor.SelectedIndex : ddlWorkByContractor.SelectedIndex;
                workOrderIndex = cboWOs.SelectedIndex;
            }
            else
            {
                lblPercentComplete.Text = dto.Postings.PercentComplete.ToString2();
                txtRemarks.Text = dto.Postings.Remarks;
                lblItemComplete.Text = (dto.Postings.BidItemComplete == &quot;Y&quot; ? &quot;Yes&quot; : &quot;No&quot;);
                lblMarkForAttn.Text = (dto.Postings.Attention == &quot;Y&quot; ? &quot;Yes&quot; : &quot;No&quot;);
                lblPostedDate.Text = dto.Postings.PostedDate.ToMWDateTimeString_FormatDate();
                lblContractor.Text = dto.Postings.Contractor.ToString2();
                lblWorkByContractor.Text = dto.Postings.WorkByContractor;
                txtgrpQnty.Enabled = false;
            }
            PopulateSubItems();
            if (ddlSubItem.Items.FindByValue(dto.Postings.SubItemID.ToString2()) != null)
                ddlSubItem.Items.FindByValue(dto.Postings.SubItemID.ToString2()).Selected = true;

            lblItem.Text = dto.StdItemID;
            lblLineno.Text = dto.LineNo;
            lblLS.Text = (dto.Prorated == &quot;N&quot; ? &quot;Yes&quot; : &quot;No&quot;);
            txtStdItemNo.Text = dto.StdItemID;
            lblStditemno.Text = dto.Desc;
            lblUnit.Text = dto.UnitID.ToString2();
            lblUnitPrice.Text =
                dto.UnitPrice.Value.ToString(
                    LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) + AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE,
                    CultureInfo.CurrentCulture);
            lblUnit.Text = dto.Postings.Unit;
            lblContractQty.Text = dto.Qty.Value.ToString(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY, CultureInfo.CurrentCulture);

            lblStationFrm.Text = dto.Postings.FromStn;
            lblStationTo.Text = dto.Postings.ToStn;
            lblWo.Text = dto.Postings.WorkOrderNo;

            lblRemainingQty.Text = (dto.Postings.QtyRemaining != null)
                                       ? dto.Postings.QtyRemaining.Value.ToString(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY,
                                                                                  CultureInfo.CurrentCulture)
                                       : string.Empty;
            lblQtyPlaced.Text = (dto.Postings.QtyPlacedToDate != null)
                                    ? dto.Postings.QtyPlacedToDate.Value.ToString(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY,
                                                                                  CultureInfo.CurrentCulture)
                                    : string.Empty;

            lblPercentItemCompleteTillDate.Text = (dto.Postings.PerItemCompleteTillDate != null)
                        ? dto.Postings.PerItemCompleteTillDate.Value.ToString(AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE,
                                                                      CultureInfo.CurrentCulture)
                        : string.Empty;

            lblCostPlacedtoDate.Text = (dto.Postings.CostPlacedtoDate != null)
                                           ? dto.Postings.CostPlacedtoDate.Value.ToString(
                                               LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) +
                                               AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture)
                                           : string.Empty;
            lblCostRemaining.Text = (dto.Postings.CostRemaining != null)
                                        ? dto.Postings.CostRemaining.Value.ToString(
                                            LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) +
                                            AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture)
                                        : string.Empty;
            if (dto.Postings.WOID.HasValue &amp;&amp; dto.Postings.WOID.Value &gt; 0)
            {
                lblCostPlacedtoDate.Text += ((dto.Postings.WOCostPlacedtoDate != null)
                                                 ? &quot;/&quot; +
                                                   dto.Postings.WOCostPlacedtoDate.Value.ToString(
                                                       LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) +
                                                       AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture)
                                                 : string.Empty);
                lblUnitPrice.Text += ((dto.Postings.WOUnitPrice != null)
                                          ? &quot;/&quot; +
                                            dto.Postings.WOUnitPrice.Value.ToString(
                                                LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) +
                                                AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE, CultureInfo.CurrentCulture)
                                          : string.Empty);
                lblRemainingQty.Text += ((dto.Postings.WOQtyRemaining != null)
                                             ? &quot;/&quot; +
                                               dto.Postings.WOQtyRemaining.Value.ToString(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY,
                                                                                          CultureInfo.CurrentCulture)
                                             : string.Empty);
                lblQtyPlaced.Text += ((dto.Postings.WOQtyPlacedToDate != null)
                                          ? &quot;/&quot; +
                                            dto.Postings.WOQtyPlacedToDate.Value.ToString(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY,
                                                                                          CultureInfo.CurrentCulture)
                                          : string.Empty);
                lblCostRemaining.Text += ((dto.Postings.WOCostRemaining != null)
                                              ? &quot;/&quot; +
                                                dto.Postings.WOCostRemaining.Value.ToString(
                                                    LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) +
                                                    AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture)
                                              : string.Empty);
                lblContractQty.Text += ((dto.Postings.WOQuantity.HasValue)
                                            ? &quot;/&quot; +
                                              dto.Postings.WOQuantity.Value.ToString(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY,
                                                                                     CultureInfo.CurrentCulture)
                                            : string.Empty);
            }

            hdnWOQty.Value = (dto.Postings.WOID.HasValue &amp;&amp; dto.Postings.WOID.Value &gt; 0)
                                 ? dto.Postings.WOQtyRemaining.ToString2()
                                 : dto.Postings.QtyRemaining.ToString2();
            if (Mode == &quot;Edit&quot; &amp;&amp; !String.IsNullOrEmpty(hdnWOQty.Value))
                hdnWOQty.Value =
                    (hdnWOQty.Value.ToDecimal2() + dto.Postings.PostedQty.GetValueOrDefault(0).ToDecimal2()).ToString2();
            lblUnitCost.Text = (dto.Postings.UnitCost != null)
                                   ? dto.Postings.UnitCost.Value.ToString(
                                       LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) +
                                       AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture)
                                   : string.Empty;
            lblContractCost.Text = (dto.Postings.ContractCost != null)
                                       ? dto.Postings.ContractCost.Value.ToString(
                                           LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) +
                                           AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture)
                                       : string.Empty;
            //this.txtgrpQnty.NumberFormat.NumberDecimalDigits = info.NumberDecimalDigits;
            txtgrpQnty.ValueDecimal = dto.Postings.PostedQty.GetValueOrDefault(0);

            if (dto.Postings.WOID.HasValue &amp;&amp; dto.Postings.WOID.Value &gt; 0 &amp;&amp; dto.Postings.WOQtyPlacedToDate.HasValue &amp;&amp;
                dto.Postings.WOUnitPrice.HasValue)
                lblAmtPlaced.Text =
                    (dto.Postings.WOQtyPlacedToDate * dto.Postings.WOUnitPrice).Value.ToString(
                        LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) + AMP3ApplicationSettings.Instance.FORMAT_AMOUNT,
                        CultureInfo.CurrentCulture);
            else if (dto.Postings.QtyPlacedToDate.HasValue &amp;&amp; dto.UnitPrice.HasValue)
                lblAmtPlaced.Text =
                    (dto.Postings.QtyPlacedToDate * dto.UnitPrice).Value.ToString(
                        LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) + AMP3ApplicationSettings.Instance.FORMAT_AMOUNT,
                        CultureInfo.CurrentCulture);
            else
                lblAmtPlaced.Text = string.Empty;
            SetCost();
            SetActivityCount(MODULEID, PostingID, ItemID);
            if (IsRFINoRequired)
            {
                LoadRFINumbers();
                ddlRFINo.SelectedValue = dto.Postings.RFIID.ToString2();
            }

            status = dto.Postings.Status;
        }

        private void PopulateSubItems()
        {
            DataTable dt = ItemManager.Instance.GetSubItemData(Constants.MODID_CONTMGT, ContractID, ItemID).Tables[0];
            var li = new ListItem(&quot;&lt;No Sub Items&gt;&quot;, &quot;&quot;);
            ddlSubItem.Items.Clear();
            if (dt.Rows.Count == 0)
                ddlSubItem.Items.Add(li);
            else
            {
                ddlSubItem.DataSource = dt;
                ddlSubItem.DataTextField = &quot;Description&quot;;
                ddlSubItem.DataValueField = &quot;SubItemID&quot;;
                ddlSubItem.DataBind();
            }
        }

        private void GetPostingDetails(int itemId)
        {
            bool IsWO = (cboWOs.SelectedIndex &gt;= 0 &amp;&amp; !cboWOs.SelectedValue.Equals(&quot;Select&quot;));
            DTOItemPosting dto = ITMPOSTBL.Instance.GetItemPosting(ContractID, itemId, null, null,
                                                                   (!IsWO)
                                                                       ? null
                                                                       : (int?)cboWOs.SelectedValue.ToInt32_2());
            ItemID = dto.ID.GetValueOrDefault(0);
            if (dto == null)
            {
                string errMsg = LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR) +
                                &quot; is marked complete in item postings. Cannot post the &quot; +
                                LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR) + &quot;.&quot;;
                ShowNotificationMessage(errMsg, NotificationType.Error);
                ViewState[PostConst.ITEM_POSTING_STR] = null;

                lblQtyPlaced.Text =
                    lblPercentItemCompleteTillDate.Text =
                    lblRemainingQty.Text =
                    lblUnitPrice.Text =
                    lblContractQty.Text =
                    lblAmtPlaced.Text =
                    lblCostPlacedtoDate.Text =
                    lblCostRemaining.Text =
                    lblUnitCost.Text =
                    lblContractCost.Text = String.Empty;

                return;
            }

            dto.ContractID = ContractID;
            ViewState[PostConst.ITEM_POSTING_STR] = dto;

            if (dto.Complete != null &amp;&amp; dto.Complete.ToUpper2() == &quot;TRUE&quot;)
                chkItemComplete.Checked = true;
            lblLineno.Text = dto.LineNo;
            lblStditemno.Text = dto.Desc;
            txtStdItemNo.Text = dto.StdItemID;
            lblUnit.Text = dto.Postings.Unit;
            lblLS.Text = dto.Prorated.Equals(&quot;N&quot;) ? &quot;Yes&quot; : &quot;No&quot;;
            lblQtyPlaced.Text = (dto.Postings.QtyPlacedToDate != null)
                                    ? dto.Postings.QtyPlacedToDate.Value.ToString(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY,
                                                                                  CultureInfo.CurrentCulture)
                                    : string.Empty;

            lblPercentItemCompleteTillDate.Text = (dto.Postings.PerItemCompleteTillDate != null)
                        ? dto.Postings.PerItemCompleteTillDate.Value.ToString(AMP3ApplicationSettings.Instance.FORMAT_PERCENTAGE,
                                                                      CultureInfo.CurrentCulture)
                        : string.Empty;

            lblRemainingQty.Text = (dto.Postings.QtyRemaining != null)
                                       ? dto.Postings.QtyRemaining.Value.ToString(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY,
                                                                                  CultureInfo.CurrentCulture)
                                       : string.Empty;
            lblUnitPrice.Text = (dto.UnitPrice != null)
                                    ? dto.UnitPrice.Value.ToString(
                                        LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) +
                                        AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE, CultureInfo.CurrentCulture)
                                    : string.Empty;
            lblContractQty.Text = (dto.Qty != null)
                                      ? dto.Qty.Value.ToString(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY, CultureInfo.CurrentCulture)
                                      : string.Empty;
            if (IsWO &amp;&amp; dto.Postings.WOQtyPlacedToDate.HasValue &amp;&amp; dto.Postings.WOUnitPrice.HasValue)
                lblAmtPlaced.Text =
                    (dto.Postings.WOQtyPlacedToDate * dto.Postings.WOUnitPrice).Value.ToString(
                        LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) + AMP3ApplicationSettings.Instance.FORMAT_AMOUNT,
                        CultureInfo.CurrentCulture);
            else if (dto.Postings.QtyPlacedToDate.HasValue &amp;&amp; dto.UnitPrice.HasValue)
                lblAmtPlaced.Text =
                    (dto.Postings.QtyPlacedToDate * dto.UnitPrice).Value.ToString(
                        LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) + AMP3ApplicationSettings.Instance.FORMAT_AMOUNT,
                        CultureInfo.CurrentCulture);
            else
                lblAmtPlaced.Text = string.Empty;
            lblCostPlacedtoDate.Text = (dto.Postings.CostPlacedtoDate != null)
                                           ? dto.Postings.CostPlacedtoDate.Value.ToString(
                                               LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) +
                                               AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture)
                                           : string.Empty;
            lblCostRemaining.Text = (dto.Postings.CostRemaining != null)
                                        ? dto.Postings.CostRemaining.Value.ToString(
                                            LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) +
                                            AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture)
                                        : string.Empty;
            lblUnitCost.Text = (dto.Postings.UnitCost != null)
                                   ? dto.Postings.UnitCost.Value.ToString(
                                       LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) +
                                       AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture)
                                   : string.Empty;
            lblContractCost.Text = (dto.Postings.ContractCost != null)
                                       ? dto.Postings.ContractCost.Value.ToString(
                                           LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) +
                                           AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture)
                                       : string.Empty;
            if (IsWO)
            {
                lblCostPlacedtoDate.Text += (dto.Postings.WOCostPlacedtoDate != null)
                                                ? &quot;/&quot; +
                                                  dto.Postings.WOCostPlacedtoDate.Value.ToString(
                                                      LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) +
                                                      AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture)
                                                : string.Empty;
                lblUnitPrice.Text += (dto.Postings.WOUnitPrice != null)
                                         ? &quot;/&quot; +
                                           dto.Postings.WOUnitPrice.Value.ToString(
                                               LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) +
                                               AMP3ApplicationSettings.Instance.FORMAT_UNIT_PRICE, CultureInfo.CurrentCulture)
                                         : string.Empty;
                lblRemainingQty.Text += (dto.Postings.WOQtyRemaining != null)
                                            ? &quot;/&quot; +
                                              dto.Postings.WOQtyRemaining.Value.ToString(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY,
                                                                                         CultureInfo.CurrentCulture)
                                            : string.Empty;
                lblQtyPlaced.Text += (dto.Postings.WOQtyPlacedToDate != null)
                                         ? &quot;/&quot; +
                                           dto.Postings.WOQtyPlacedToDate.Value.ToString(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY,
                                                                                         CultureInfo.CurrentCulture)
                                         : string.Empty;
                lblCostRemaining.Text += (dto.Postings.WOCostRemaining != null)
                                             ? &quot;/&quot; +
                                               dto.Postings.WOCostRemaining.Value.ToString(
                                                   LocalizationManager.GetString(KeyConstants.LOC_CURRENCY_SYMBOL) +
                                                   AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture)
                                             : string.Empty;
                lblContractQty.Text += (dto.Postings.WOQuantity.HasValue)
                                           ? &quot;/&quot; +
                                             dto.Postings.WOQuantity.Value.ToString(AMP3ApplicationSettings.Instance.FORMAT_QUANTITY,
                                                                                    CultureInfo.CurrentCulture)
                                           : string.Empty;
            }
            hdnWOQty.Value = (IsWO) ? dto.Postings.WOQtyRemaining.ToString2() : dto.Postings.QtyRemaining.ToString2();
            if (Mode == &quot;Edit&quot;)
                hdnWOQty.Value =
                    (Decimal.Parse(hdnWOQty.Value, CultureInfo.CurrentCulture) +
                     dto.Postings.PostedQty.GetValueOrDefault(0)).ToString2();

            PopulateSubItems();
        }

        private string GetReturnUrl()
        {
            string redirectUrl = &quot;~/Common/BrixListPage.aspx?context=ITMPOST&amp;ContractID={0}&amp;PID={1}&amp;ParentID={0}&quot;.Format2(
                ContractID, Request[&quot;PID&quot;]);
            if (!string.IsNullOrEmpty(Request[&quot;DWRID&quot;]))
                redirectUrl = (redirectUrl + &quot;&amp;DWRID={0}&quot;).Format2(Request[&quot;DWRID&quot;]);

            if (!IsNew)
            {
                string msgID = ViewState[&quot;msgID&quot;].ToString();
                if (!string.IsNullOrEmpty(msgID))
                {
                    string msg = BrixWorkflowManager.Instance.GetResultantDataFromWorkFlow&lt;string&gt;(msgID);
                    Session[&quot;WorkflowErrOnLastPage&quot;] = msg;
                    BrixWorkflowManager.Instance.DeleteResultantDataFromWorkFlow(msgID);
                }
            }
            return redirectUrl;
        }

        protected void ddlSubItem_SelectedIndexChanged(object sender, EventArgs e)
        {
            UpdateActivityGrid();
        }

        private void UpdateActivityGrid()
        {
            txtgrpQnty.Value = 0;
            // Issue : NCC-20051, Description : After resource consumption when we are changing the sub item, the activity grid is not getting binded.
            if (!string.IsNullOrEmpty(Request[&quot;PostingID&quot;]))
                BindActivityGrid(MODULEID, PostingID, ItemID);
            else
                BindActivityGrid(Constants.MODID_CONTMGT, ContractID, ItemID);
            foreach (UltraGridRow ugr in gridActivity.Rows)
            {
                if (ugr.Cells.Exists(&quot;Number&quot;))
                    ugr.Cells.FromKey(&quot;Number&quot;).Value = 0;
                if (ugr.Cells.Exists(&quot;Dimension1&quot;) &amp;&amp; ugr.Cells.FromKey(&quot;Dimension1&quot;).Value != null)
                    ugr.Cells.FromKey(&quot;Dimension1&quot;).Value = 0;
                if (ugr.Cells.Exists(&quot;Dimension2&quot;) &amp;&amp; ugr.Cells.FromKey(&quot;Dimension2&quot;).Value != null)
                    ugr.Cells.FromKey(&quot;Dimension2&quot;).Value = 0;
                if (ugr.Cells.Exists(&quot;Dimension3&quot;) &amp;&amp; ugr.Cells.FromKey(&quot;Dimension3&quot;).Value != null)
                    ugr.Cells.FromKey(&quot;Dimension3&quot;).Value = 0;
                if (ugr.Cells.Exists(&quot;Quantity&quot;))
                    ugr.Cells.FromKey(&quot;Quantity&quot;).Value = 0;
                if (ugr.Cells.Exists(&quot;New Quantity&quot;))
                    ugr.Cells.FromKey(&quot;New Quantity&quot;).Value = 0;
            }
        }

        protected void cboWOs_SelectedIndexChanged(object sender, EventArgs e)
        {
            txtStdItemNo.Enabled = true;
            if (cboWOs.SelectedIndex &gt; 0)
            {
                StrModuleId = &quot;WORKORD&quot;;
                ParentInstanceID = cboWOs.SelectedValue.ToInt32_2();
                workOrderIndex = cboWOs.SelectedIndex;
            }
            else
                txtStdItemNo.Enabled = false;
        }

        protected void ddlContractor_SelectedIndexChanged(object sender, EventArgs e)
        {
            string[] id = ddlContractor.SelectedValue.Split(&#39;,&#39;);
            cboWOs.Items.Clear();
            if (id[1].Equals(&quot;P&quot;))
            {
                StrModuleId = &quot;ITMPOST&quot;;
                ParentInstanceID = ContractID;
                workOrderIndex = -1;
            }
            else
            {
                PopulateWO(id[0]);
                StrModuleId = &quot;WORKORD&quot;;
                ParentInstanceID = !string.IsNullOrEmpty(cboWOs.SelectedValue) &amp;&amp; cboWOs.SelectedValue != &quot;Select&quot; ? cboWOs.SelectedValue.ToInt32_2() : 0;
            }
            contractorIndex = ddlContractor.SelectedIndex;
        }

        protected void ddlWorkByContractor_SelectedIndexChanged(object sender, EventArgs e)
        {
            contractorIndex = ddlWorkByContractor.SelectedIndex;
        }

        private void PopulateWO(string contractorID)
        {
            try
            {
                cboWOs.DataSource = ITMPOSTBL.Instance.GetWorkOrdersforContractor(ContractID,
                                                                                  int.Parse(contractorID,
                                                                                            CultureInfo.CurrentCulture))
                    .Tables[1];
            }
            catch
            {
                //do nothing
            }
            cboWOs.DataTextField = &quot;WorkOrderNo&quot;;
            cboWOs.DataValueField = &quot;WorkOrderId&quot;;
            if (cboWOs.DataSource != null)
            {
                cboWOs.DataBind();
                if (((DataTable)cboWOs.DataSource).Rows.Count &gt; 0)
                {
                    StrModuleId = &quot;WORKORD&quot;;
                    ParentInstanceID = cboWOs.SelectedValue.ToInt32_2();
                }
                else if ((HasWorkOrders ? ddlContractor.SelectedValue.Split(&#39;,&#39;)[1] : ddlWorkByContractor.SelectedValue.Split(&#39;,&#39;)[1]).Equals(&quot;S&quot;))
                    txtStdItemNo.Enabled = false;
            }
            cboWOs.Items.Insert(0, new ListItem(&quot;Select&quot;, &quot;Select&quot;));
            workOrderIndex = cboWOs.SelectedIndex;
            txtStdItemNo.Enabled = true;
        }

        protected void lnkBack_Click(object sender, EventArgs e)
        {
            string redirectUrl = &quot;~/Common/BrixListPage.aspx?Context=ITMPOST&amp;ContractID={0}&amp;PID={1}&amp;ParentID={0}&quot;.Format2(
                ContractID, Request[&quot;PID&quot;]);
            if (Request != null)
            {
                if (!string.IsNullOrEmpty(Request[&quot;DWRID&quot;]))
                {
                    redirectUrl += &quot;&amp;DWRID=&quot; + Request[&quot;DWRID&quot;];
                }
                if (!string.IsNullOrEmpty(Request[&quot;DWRMode&quot;])
                    &amp;&amp; Request[&quot;DWRMode&quot;].Equals(&quot;View&quot;))
                {
                    redirectUrl += &quot;&amp;Mode=View&quot;;
                }
            }
            Response.Redirect(redirectUrl, true);
        }

        protected void btnPost_Click(object sender, EventArgs e)
        {
            if (btnPost.Enabled &amp;&amp; (ViewState[&quot;ContractDTO&quot;] as DTO).Locked == &quot;Y&quot;)
                WorkflowEnabledSaveHandler(true);
            else if ((ViewState[&quot;ContractDTO&quot;] as DTO).Locked == &quot;N&quot;)
            {
                ShowNotificationMessage(&quot;Items are not locked cannot create a posting&quot;, NotificationType.Error);
                // lblError.ForeColor = Color.Red;
            }
        }

        protected override bool CanShowWorkflowButtons() { return IsNew ? false : true; }

        protected void btnPostMore_Click(object sender, EventArgs e)
        {
            _PostMore = &#39;Y&#39;;
            if (btnPostMore.Enabled &amp;&amp; (ViewState[&quot;ContractDTO&quot;] as DTO).Locked == &quot;Y&quot;)
            {
                if (_PostMore == &#39;N&#39; || (_PostMore == &#39;Y&#39; &amp;&amp; chkItemComplete.Checked))
                    WorkflowEnabledSaveHandler(true);
                else
                {
                    WorkflowEnabledSaveHandler(false);
                    // this is a post more and you need to stay on posting page to post more
                    CreateNewWorkflow = true; // this will create a new workflown and assign to this new posting
                    HandlePostMore();
                    InitializeWorkflowListForNewMode();
                }
            }
            else if ((ViewState[&quot;ContractDTO&quot;] as DTO).Locked != &quot;Y&quot;)
            {
                ShowNotificationMessage(&quot;Items are not locked cannot create a posting&quot;, NotificationType.Error);
                // lblError.ForeColor = Color.Red;
            }
        }

        protected void btnCancel_Click(object sender, EventArgs e)
        {
            string redirectUrl = GetReturnUrl();
            Response.Redirect(redirectUrl, true);
        }

        protected void lnkRateAnalysis_Click(object sender, EventArgs e)
        {
            if (txtgrpQnty.ValueDecimal &lt; 0)
            {
                Page.ClientScript.RegisterStartupScript(GetType(), &quot;showAlert&quot;,
                                                        &quot;ShowError(&#39;Resource Consumption will not be allowed for negative quantity postings&#39;);&quot;,
                                                        true);
                return;
            }
            if (ddlSubItem.SelectedItem.Text != &quot;&lt;No Sub Items&gt;&quot;)
                rateAnalysisDetail.SubItemID = ddlSubItem.SelectedValue.ToInt32_2();
            bRate = true;
            if (ItemID != 0)
            {
                if (Mode != &quot;View&quot;)
                {
                    _PostMore = &#39;-&#39;;
                    bRate = true;
                    WorkflowEnabledSaveHandler(false);
                    Mode = &quot;Edit&quot;;
                }
                ShowDiv(ItemDivEnums.RateAnalysis);
                rateAnalysisDetail.LoadItem(ItemID);

                SetCost();
            }
        }

        private void SelectStandardItem(int itemId)
        {
            GetPostingDetails(itemId);
            if (!String.IsNullOrEmpty(Request[&quot;DWRID&quot;]))
            {
                PopulateDWRDetails(Request[&quot;DWRID&quot;].ToInt32_2());
                if (allowContractorDPRIP &amp;&amp; !HasWorkOrders)
                {
                    ddlWorkByContractor.SelectedIndex = contractorIndex;
                    ddlContractor.Items.FindByValue(primeContractorId + &quot;,P&quot;).Selected = true;
                }
            }
            else
            {
                if (HasWorkOrders)
                    ddlWorkByContractor.SelectedIndex = ddlContractor.SelectedIndex = contractorIndex;
                else
                {
                    ddlWorkByContractor.SelectedIndex = contractorIndex;
                    ddlContractor.Items.FindByValue(primeContractorId + &quot;,P&quot;).Selected = true;
                }
                if (workOrderIndex &gt; 0 &amp;&amp; cboWOs.Items[workOrderIndex] != null)
                    cboWOs.SelectedIndex = workOrderIndex;
            }
            if (IsRFINoRequired)
            {
                LoadRFINumbers();
            }
            ShowDiv(ItemDivEnums.CreatePosting);
            lnkRateAnalysis.Enabled = lnkSubItems.Enabled = true;
            SetActivityCount(Constants.MODID_CONTMGT, ContractID, itemId);
            cboWOs.Enabled = ddlContractor.Enabled = ddlWorkByContractor.Enabled = false;
            BindActivityGrid(Constants.MODID_CONTMGT, ContractID, itemId);
        }

        private void LoadRFINumbers()
        {
            ddlRFINo.Items.Clear();
            DataTable dtRFINumbers = ((DTOItemPosting)ViewState[PostConst.ITEM_POSTING_STR]).RFINumbersforItem;
            var dtValidRFINumbers = new DataTable();
            dtValidRFINumbers.Columns.Add(&quot;RFIID&quot;);
            dtValidRFINumbers.Columns.Add(&quot;RFINumber&quot;);
            dtValidRFINumbers.AcceptChanges();
            DateTime RFIDate = (Convert.ToString(Request[&quot;Mode&quot;]) == &quot;View&quot;)
                                   ? Convert.ToDateTime(lblPostedDate.Text, DateFormatCulture.GetDateFormatCulture()).
                                         Date
                                   : dtPostedDate.Value.ToDateTime_MWCulture().Date;
            foreach (DataRow RFINumber in dtRFINumbers.Select(&quot;RFIDate &lt;= &#39;&quot; + RFIDate.Date + &quot;&#39;&quot;))
            {
                DataRow newRow = dtValidRFINumbers.NewRow();
                newRow[&quot;RFIID&quot;] = RFINumber[&quot;ID&quot;];
                newRow[&quot;RFINumber&quot;] = RFINumber[&quot;RFINumber&quot;];
                dtValidRFINumbers.Rows.Add(newRow);
            }
            UIHelper.BindDropDownData(ddlRFINo, dtValidRFINumbers, &quot;RFINumber&quot;, &quot;RFIID&quot;);
        }

        private void BtnBackRateAnalysis_Click(object sender, EventArgs e)
        {
            DisableItemSelection(true);
            ShowDiv(ItemDivEnums.CreatePosting);
            SetCost();
        }

        private void SetCost()
        {
            decimal cost = 0.0M;
            if (ItemID != 0)
            {
                cost = ItemManager.Instance.GetUnitCost(ItemID, MODULEID, PostingID).ToDecimal2();
                lblCost.Text = cost.ToString(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture);
            }
        }

        private void BtnBackItemActivity_Click(object sender, EventArgs e)
        {
            DisableItemSelection(true);
            ShowDiv(ItemDivEnums.CreatePosting);
            SetActivityCount(MODULEID, PostingID, ItemID);
            //if (itemActivity.ItemCompleted &amp;&amp; !chkItemComplete.Checked)
            //    chkItemComplete.Checked = true;
        }

        private void DisableItemSelection(bool isDisable)
        {
            if ((string.IsNullOrEmpty(Request[&quot;Mode&quot;]) &amp;&amp; Mode == &quot;Edit&quot;) || (Mode == &quot;New&quot; &amp;&amp; !isDisable))
            {
                txtStdItemNo.Enabled = !isDisable;
            }
        }

        private void SetActivityCount(string moduleID, int parentInstanceID, int itemID)
        {
            if (itemID != 0)
            {
                DataRow dr =
                    ItemManager.Instance.GetItemActivities(moduleID, parentInstanceID, itemID, &quot;Y&quot;).Tables[0].Rows[0];
                lblActivityCount.Text = dr[&quot;ActivityCount&quot;].ToString2();
                if (dr[&quot;ActivityCount&quot;].ToInt32_2() &gt; 0)
                {
                    //this.txtgrpQnty.NumberFormat.NumberDecimalDigits = info.NumberDecimalDigits;
                    txtgrpQnty.Value = ((moduleID == &quot;ITMPOST&quot;) ? dr[&quot;PostedQuantity&quot;].ToDecimal2() : 0m);
                    txtgrpQnty.ReadOnly = true;
                }
            }
        }

        private void ShowDiv(ItemDivEnums divType)
        {
            DivPosting.Visible = (ItemDivEnums.CreatePosting == divType);
            DivRateAnalysis.Visible = (ItemDivEnums.RateAnalysis == divType);
            hideWorkflowButtons = true;
            hideToolBar = false;
            switch (divType)
            {
                case ItemDivEnums.CreatePosting:
                    PageTitle = Mode + &quot; &quot; + LocalizationManager.GetString(KeyConstants.LOC_ITEM_POSTING);
                    hideWorkflowButtons = false;
                    MainToolBar.Visible = true;
                    break;
                case ItemDivEnums.RateAnalysis:
                    {
                        PageTitle = &quot;Resource Consumption&quot;;
                        hideToolBar = true;
                        MainToolBar.Visible = false;
                    }
                    break;
                case ItemDivEnums.ResourcePicker:
                    PageTitle = &quot;Select Resource&quot;;
                    MainToolBar.Visible = false;
                    break;
            }
        }

        private void HideMenu(string buttonID, bool bUnHide)
        {
            if (bUnHide) MainToolBar.ShowMenu(buttonID);
            else MainToolBar.HideMenu(buttonID);
        }

        private void HandlePostMore()
        {
            GetPostingDetails(ItemID);
            if (!String.IsNullOrEmpty(Request[&quot;DWRID&quot;]))
            {
                PopulateDWRDetails(Request[&quot;DWRID&quot;].ToInt32_2());
                if (allowContractorDPRIP &amp;&amp; !HasWorkOrders)
                {
                    ddlWorkByContractor.SelectedIndex = contractorIndex;
                    ddlContractor.Items.FindByValue(primeContractorId + &quot;,P&quot;).Selected = true;
                }
            }
            else
            {
                if (HasWorkOrders)
                    ddlWorkByContractor.SelectedIndex = ddlContractor.SelectedIndex = contractorIndex;
                else
                {
                    ddlWorkByContractor.SelectedIndex = contractorIndex;
                    ddlContractor.Items.FindByValue(primeContractorId + &quot;,P&quot;).Selected = true;
                }
                cboWOs.SelectedIndex = workOrderIndex;
            }
            if (chkRemberPrev.Checked)
                txtStationFrm.Text = txtStationTo.Text;
            else if (!chkRememberCur.Checked)
                txtStationFrm.Text = string.Empty;
            wdpComplete.ValueDecimal = 0;
            txtStationTo.Text = string.Empty;
            chkRememberCur.Checked = chkRemberPrev.Checked = chkMark.Checked = false;
            txtRemarks.Text = string.Empty;
            decimal cost = 0.0M;
            lblCost.Text = cost.ToString(AMP3ApplicationSettings.Instance.FORMAT_AMOUNT, CultureInfo.CurrentCulture);
            //this.txtgrpQnty.NumberFormat.NumberDecimalDigits = info.NumberDecimalDigits;
            txtgrpQnty.ValueDecimal = 0.0m;
            Mode = &quot;New&quot;;
            PostingID = 0;
            DisableItemSelection(false);
            BindActivityGrid(Constants.MODID_CONTMGT, ContractID, ItemID);
            PageTitle = &quot;New Item Posting&quot;;
            //itemActivity.ActivityList = null;
        }

        private static void SaveActivities(int postingID, UltraWebGrid grdActivity, string PostID, int ItemID)
        {
            var dto = new Activity();

            foreach (UltraGridRow ugr in grdActivity.Rows)
            {
                SaveItemActivity(postingID, PostID, ItemID, dto, ugr);
            }
        }

        private static void SaveItemActivity(int postingID, string PostID, int ItemID, Activity dto, UltraGridRow ugr)
        {
            if ((PostID != null))
                dto.ActivityID = Convert.ToInt32(ugr.Cells.FromKey(&quot;ActivityID&quot;).Value.ToString());

            dto.Description = (ugr.Cells.FromKey(&quot;Description&quot;).Value != null)
                                  ? ugr.Cells.FromKey(&quot;Description&quot;).Value.ToString()
                                  : String.Empty;
            dto.Name = (ugr.Cells.FromKey(&quot;Name&quot;).Value != null)
                           ? ugr.Cells.FromKey(&quot;Name&quot;).Value.ToString()
                           : String.Empty;
            dto.ModuleID = MODULEID;
            dto.ParentInstanceID = postingID;
            dto.ItemID = ItemID;
            dto.IsComplete = (ugr.Cells.FromKey(&quot;IsComplete&quot;).Value != null)
                                 ? Convert.ToBoolean(ugr.Cells.FromKey(&quot;IsComplete&quot;).Value.ToString())
                                 : false;
            dto.Percentage = (ugr.Cells.FromKey(&quot;Percentage&quot;).Value != null)
                                 ? Convert.ToDecimal(ugr.Cells.FromKey(&quot;Percentage&quot;).Value.ToString())
                                 : 0;
            dto.Number = (ugr.Cells.FromKey(&quot;Number&quot;).Value != null)
                             ? Convert.ToDecimal(ugr.Cells.FromKey(&quot;Number&quot;).Value)
                             : 0;
            dto.ReferenceActivityID = (PostID == null) ? Convert.ToInt32(ugr.Cells.FromKey(&quot;ActivityID&quot;).Value) : 0;

            dto.UnitID = (ugr.Cells.FromKey(&quot;UnitID&quot;).Value != null)
                             ? Convert.ToInt32(ugr.Cells.FromKey(&quot;UnitID&quot;).Text)
                             : 0;

            dto.Unit = (ugr.Cells.FromKey(&quot;Unit&quot;).Value != null) ? ugr.Cells.FromKey(&quot;Unit&quot;).Text : String.Empty;
            if (ugr.Cells.FromKey(&quot;Dimension1&quot;).Value != null)
                dto.Dimension1 = Convert.ToDecimal(ugr.Cells.FromKey(&quot;Dimension1&quot;).Value);

            if (ugr.Cells.FromKey(&quot;Dimension2&quot;).Value != null)
                dto.Dimension2 = Convert.ToDecimal(ugr.Cells.FromKey(&quot;Dimension2&quot;).Value);

            if (ugr.Cells.FromKey(&quot;Dimension3&quot;).Value != null)
                dto.Dimension3 = Convert.ToDecimal(ugr.Cells.FromKey(&quot;Dimension3&quot;).Value);

            dto.Quantity = Convert.ToDecimal(ugr.Cells.FromKey(&quot;Quantity&quot;).Value);
            dto.IsAfterLock = false;

            ItemManager.Instance.SaveActivity(dto);
        }

        public static void SaveItemPosting(DTOItemPosting ItemPostingstr,
                                           int cboWO,
                                           string WONo,
                                           int SubItem,
                                           int SubItemName,
                                           int WOID,
                                           int PostingID,
                                           string QtyPlaced,
                                           string RemainingQty,
                                           string Remarks,
                                           string StationTo,
                                           string StationFrom,
                                           bool Mark,
                                           bool ItemComplete,
                                           decimal percentComplete,
                                           decimal PostedQty,
                                           string sDWRID,
                                           string Contractor,
                                           string ContractorID,
                                           bool HasWokOrders,
                                           string WorkByContractor,
                                           string WorkByContractorID,
                                           int primeContractorId,
                                           DateTime dtPostedDate,
                                           string Mode,
                                           int ContractID,
                                           char PostMore,
                                           string PostID,
                                           int ItemID,
                                           int? iCurrentUid,
                                           string sCurrentName,
                                           string sUserId,
                                           string flag,
                                           bool IsRFINoRequired,
                                           int rfiCount,
                                           int rfiValue,
                                           out int? dtoId, out string sSavedInstanceToken, out string sErrors,
                                           out string sRedirectTo)
        {
            sSavedInstanceToken = &quot;&quot;;
            sErrors = &quot;&quot;;
            sRedirectTo = &quot;&quot;;

            DTOItemPosting dto = ItemPostingstr;
            if (dto == null)
            {
                dto = new DTOItemPosting();
                dto.ID = ItemID;
                dto.ContractID = ContractID;
            }
            dtoId = dto.ID;

            if (String.IsNullOrEmpty(dto.ID.ToString2()))
                throw new Exception(&quot;Please select an existing or an &quot; +
                                    LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR) +
                                    &quot; which is not marked complete.&quot;);

            bool isNC =
                ItemManager.Instance.GetItemDetails(Constants.MODID_CONTMGT, ContractID, ItemID).IsNonContract.
                    ToBoolean2();
            if (IsRFINoRequired &amp;&amp; rfiCount == 0 &amp;&amp; !isNC)
                throw new Exception(LocalizationManager.GetString(&quot;LOC_RequestForInspection&quot;) + &quot; number is mandatory for making a posting against contract &quot; +
                                    LocalizationManager.GetString(KeyConstants.LOC_ITEM_ABBR) + &quot;.&quot;);

            Decimal qtyTotal = 0;
            string s = string.Empty;
            dto.Postings.PostedQty = 0;
            if (dto.Prorated == &quot;N&quot; &amp;&amp; (qtyTotal &gt; 1 || qtyTotal &lt; -1))
            {
                throw new Exception(&quot;Invalid quantity value. Lumpsum items must have Quantity ranging from -1 to 1.&quot;);
            }

            dto.Postings.WorkOrderNo = (cboWO &lt; 1) ? null : WONo;
            dto.Postings.SubItemID = (SubItem &lt; 0) ? null : (int?)SubItemName.ToInt32_2();
            dto.Postings.WOID = (cboWO &lt; 1) ? null : (int?)WOID.ToInt32_2();
            dto.Postings.PostingID = PostingID; // BrixDatatypeHelper.ToInt32_2(Request[&quot;PostingID&quot;]);
            if (QtyPlaced.Contains(&quot;/&quot;))
            {
                dto.Postings.QtyPlacedToDate = QtyPlaced.Split(&#39;/&#39;)[0].ToDecimal2();
                dto.Postings.WOQtyPlacedToDate = QtyPlaced.Split(&#39;/&#39;)[1].ToDecimal2();
            }
            else
            {
                dto.Postings.QtyPlacedToDate = QtyPlaced.ToDecimal2();
            }
            if (RemainingQty.Contains(&quot;/&quot;))
            {
                dto.Postings.QtyRemaining = RemainingQty.Split(&#39;/&#39;)[0].ToDecimal2();
                dto.Postings.WOQtyRemaining = RemainingQty.Split(&#39;/&#39;)[1].ToDecimal2();
            }
            else
            {
                dto.Postings.WOQtyRemaining = RemainingQty.ToDecimal2();
            }

            dto.Postings.Remarks = (Remarks.Length &gt; 1000) ? Remarks.Substring(0, 1000) : Remarks;
            dto.Postings.Status = PostConst.DRAFT;
            dto.Postings.ToStn = StationTo;
            dto.Postings.FromStn = StationFrom;
            dto.Postings.Attention = Mark ? &quot;Y&quot; : &quot;N&quot;;
            dto.Postings.BidItemComplete = ItemComplete ? &quot;Y&quot; : &quot;N&quot;;
            dto.Postings.PercentComplete = percentComplete;
            dto.Postings.PostedQty = PostedQty;
            dto.Postings.PostedBy = iCurrentUid;
            if (!string.IsNullOrEmpty(sDWRID))
                dto.Postings.DWRID = sDWRID.ToInt32_2();

            string hdnCONTID = string.Empty;
            if (HasWokOrders)
                hdnCONTID = (Contractor != &quot;--Select One--&quot;) ? ContractorID : null;
            else
                hdnCONTID = (WorkByContractor != &quot;--Select One--&quot;) ? WorkByContractorID : null;

            if (!String.IsNullOrEmpty(hdnCONTID))
            {
                //------------------CHECK THIS CONTRACTORID FORMAT
                string[] strContr = hdnCONTID.Split(&#39;,&#39;);
                if (HasWokOrders)
                {
                    //If the contract has WOs then both the contract columns will have the same value
                    dto.Postings.WorkByContractorID = dto.Postings.ContractorID = strContr[0].ToInt32_2();
                    dto.Postings.WorkByContractorType = dto.Postings.ContractorType = strContr[1];
                }
                else
                {
                    //Otherwise, the work by contractor will have the selected value and the Contractor will have the prime contractor value
                    dto.Postings.WorkByContractorID = strContr[0].ToInt32_2();
                    dto.Postings.WorkByContractorType = strContr[1];

                    dto.Postings.ContractorID = primeContractorId;
                    dto.Postings.ContractorType = &quot;P&quot;;
                }
            }
            else
            {
                dto.Postings.ContractorID = null;
                dto.Postings.ContractorType = null;
            }
            if (dtPostedDate != null)
                dto.Postings.PostedDate = dtPostedDate.ToUtc();
            else
                dto.Postings.PostedDate = null;

            if (dto.Postings.PostedDate != null &amp;&amp; dto.Postings.PostedDate &gt; DateTime.UtcNow)
            {
                throw new Exception(&quot;Posting Date should not be greater than current date.&quot;);
            }

            if (dto.Postings.ContractorType == &quot;S&quot; &amp;&amp; (dto.Postings.WOID == null) &amp;&amp; flag == &quot;IP&quot;)
            {
                throw new Exception(&quot;Selected sub contractor doesnot have any workorder. Cannot post.&quot;);
            }

            if (IsRFINoRequired &amp;&amp; !isNC) dto.Postings.RFIID = rfiValue;

            DataSet ds = ComponentHelper.Instance.ExecuteDataSet(ItemPostingStoredProcedure.usp_CONTMGTGetItemPosting,
                                                                 null,
                                                                 new object[] { ContractID, ItemID, PostingID, Mode, WOID });
            if (ds.Tables[0].Rows.Count &gt; 0 &amp;&amp; ds.Tables[0].Rows[0][&quot;Status&quot;].ToString() == &quot;A&quot;)
            {
                sSavedInstanceToken = PostingID.ToString();
            }
            else
            {
                int newPostingID = ITMPOSTBL.Instance.CreatePosting(dto, Mode, sCurrentName, sUserId);
                if (newPostingID == -1)
                    throw new Exception(&quot;Cannot update the Item Posting.The Item Posting has been deleted.&quot;);
                if (newPostingID == -2)
                    throw new Exception(&quot;Cannot update the Item Posting.The Item Posting has already been Approved.&quot;);
                sSavedInstanceToken = newPostingID.ToString();

                if (dto.ID.HasValue &amp;&amp; dto.Postings.PostingID.GetValueOrDefault(0) == 0)
                {
                    Mode = &quot;Edit&quot;;
                    PostingID = newPostingID;
                    ItemManager.Instance.CopyRateAnalysisFromSrcItem(Constants.MODID_CONTMGT, ContractID,
                                                                     dto.ID.GetValueOrDefault(0), MODULEID, newPostingID,
                                                                     dto.ID.GetValueOrDefault(0), false);
                    ItemManager.Instance.CopySubItemsFromSrcItem(Constants.MODID_CONTMGT, ContractID,
                                                                 dto.ID.GetValueOrDefault(0), MODULEID, newPostingID,
                                                                 dto.ID.GetValueOrDefault(0), false);
                }
            }
            dto.ItemPostingNo = sSavedInstanceToken;
        }

        protected override void SetModes()
        {
            base.SetModes();
            string mode = null == Mode ? &quot;&quot; : Mode.ToLower();
            _IsNew = string.IsNullOrEmpty(Request.QueryString[&quot;PostingID&quot;]) || mode == &quot;new&quot;;
            _IsEdit = (!(bool)_IsNew) &amp;&amp; (mode != &quot;view&quot;);
            _IsView = !(bool)_IsNew &amp;&amp; !(bool)_IsEdit;
        }

        public static void SavingActivity(char postMore, int post, UltraWebGrid gridActivity, string postingID,
                                          int ItemID)
        {
            if (postMore != &#39;-&#39;)
                SaveActivities(post, gridActivity, postingID, ItemID);
        }

        private void SetManagerModel()
        {
            model = BrixFormModel.GetInstance(&quot;XITMPOS&quot;, &quot;XITMPOS&quot;, Request, Response);

            if (!string.IsNullOrEmpty(model.form.ManagerDLL) &amp;&amp; !string.IsNullOrEmpty(model.form.FormManagerClass))
            {
                managerModel = AMP3InterfaceFactory.GetInstance&lt;XMLFormManagerModel&gt;(model.form.ManagerDLL,
                                                                                 model.form.FormManagerClass);
            }
        }

        private void LoadAttachments()
        {
            ((AttachmentsControl)attachments).InstanceID = (Request[&quot;PostingID&quot;] == null) ? &quot;0&quot; : Request[&quot;PostingID&quot;];
            ((AttachmentsControl)attachments).SrcType = Constants.MODID_ITMPOST;
            ((AttachmentsControl)attachments).LoadAttachments();
        }

        #region IXMLControl Members
        public object[] ParentFormInstanceID
        {
            get {
                int id = String.IsNullOrEmpty(Request.QueryString[&quot;PostingID&quot;])
                            ? 0
                            : int.TryParse(Request.QueryString[&quot;PostingID&quot;], out id) ? id : 0;
               
                return new object[] { id.ToString() }; }
        }

        public HtmlGenericControl XMLContainterDiv
        {
            get { return divExtension; }
            set { throw new NotImplementedException(); }
        }

        public void HandleInjectionSaveException(object model, Exception ex, string parentFormInstanceId)
        { }

        public void HandleInjectionAfterSave(object model, string parentFormInstanceId)
        { }

        public bool SkipDefaultXMLInjectionSave { get; set; }

        #endregion
    }

    [CustomResourceType(&quot;Forms&quot;, &quot;XITMPOS&quot;)]
    public class PerformIPOperation : FormsCustomResource
    {
        public PerformIPOperation()
        {
            _Namespace = &quot;Forms&quot;;
            _Path = &quot;Forms.Contract.IP&quot;;
            _Name = &quot;PerformPostOperation&quot;;
            _Desc = &quot;Perform Item Posting Operations&quot;;

            _InParameters = new[] { &quot;Operation,System.String&quot; };
            _OutParameters = new[] { &quot;IsSuccessful,System.Boolean&quot;, &quot;Message,System.String&quot; };
        }

        public override void ExecuteDerived()
        {
            string operation = GetInputParam(&quot;Operation&quot;).ToString();
            //If MSP is not there, there is no need for this context, even if its null we can igone it. 
            //This page is mainly for pinellas and Lincoln who dont use MSP.
            string context = GetInputParam(&quot;Context&quot;) == null ? &quot;&quot; : GetInputParam(&quot;Context&quot;).ToString();
            switch (operation.ToUpper())
            {
                case &quot;VALIDATEAPPROVE&quot;:
                    ValidateApproveIP(context);
                    break;
                case &quot;APPROVE&quot;:
                    ApproveIP(context);
                    break;
                case &quot;UNAPPROVE&quot;:
                    UnApproveIP(context);
                    break;
            }
        }

        private void ValidateApproveIP(string context)
        {
            bool bApprove = true;
            int iCurrentUser = 1;
            string currentUserId = GetInputParam(&quot;_CurrentUserId&quot;).ToString();
            int.TryParse(currentUserId, out iCurrentUser);
            try
            {
                string retValues = ITMPOSTBL.Instance.ValidateUpdatePostingStatus(InstanceId, Constants.MODFEAT_APPROVE, false,
                                                                          iCurrentUser);
                string[] retVal = retValues.Split(&#39;@&#39;);
                if (retVal.Length &gt; 1 &amp;&amp; !String.IsNullOrEmpty(retVal[1]))
                {
                    throw new Exception(retVal[1]);
                }
            }
            catch (Exception ex)
            {
                bApprove = false;
                SetOutParam(&quot;IsSuccessful&quot;, bApprove, &quot;System.Boolean&quot;);
                SetOutParam(&quot;Message&quot;, ex.Message, &quot;System.String&quot;);
                throw new Exception(ex.Message);
            }
        }

        private void ApproveIP(string context)
        {
            bool bApprove = true;
            string sMsg = &quot;&quot;;

            int iCurrentUser = 1;
            string currentUserId = GetInputParam(&quot;_CurrentUserId&quot;).ToString();
            int.TryParse(currentUserId, out iCurrentUser);
            try
            {
                string retValues = ITMPOSTBL.Instance.UpdatePostingStatus(InstanceId, Constants.MODFEAT_APPROVE, false,
                                                                          iCurrentUser);
                string[] retVal = retValues.Split(&#39;@&#39;);
                if (retVal.Length &gt; 1 &amp;&amp; !String.IsNullOrEmpty(retVal[1]))
                {
                    throw new Exception(retVal[1]);
                }
                else
                {
                    sMsg = string.Empty;

                    #region EIS Integration

                    if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.MSP))
                    {
                        var eisList = new EISItemPostingListModel();
                        eisList.Context = context;
                        sMsg = eisList.EISApproveIP(InstanceId)?.Message;
                        if (!string.IsNullOrEmpty(sMsg) &amp;&amp;
                            sMsg.Contains(
                                &quot;MSP: The Project is exclusively checked out. Please check in the Project and re-try the operation.&quot;))
                        {
                            ITMPOSTBL.Instance.UpdatePostingStatus(InstanceId, &quot;Draft&quot;, false, iCurrentUser);
                            throw new Exception(sMsg);
                        }
                        if (!String.IsNullOrEmpty(sMsg) &amp;&amp;
                            !(sMsg.Contains(&quot;approved sucessfully&quot;) ||
                              sMsg.Contains(&quot;MSP: Status Update successfully completed&quot;) ||
                              sMsg.Contains(&quot;Contract is not mapped&quot;) ||
                              sMsg.Contains(&quot;MSP: This Contract is not mapped to Microsoft Project.&quot;)))
                            throw new Exception(sMsg);
                        else
                        {
                            if (GetInputParam(&quot;msgID&quot;) != null)
                                BrixWorkflowManager.Instance.StoreResultantDataFromWorkFlow(GetInputParam(&quot;msgID&quot;).ToString(), sMsg);
                        }
                    }

                    #endregion

                    bApprove = true;
                    SetOutParam(&quot;IsSuccessful&quot;, bApprove, &quot;System.Boolean&quot;);
                    sMsg = (String.IsNullOrEmpty(sMsg)) ? &quot;Approved Successfully&quot; : sMsg;
                    SetOutParam(&quot;Message&quot;, sMsg, &quot;System.String&quot;);

                    ITMPOSTBL.Instance.CreateWorkPosting(InstanceId.ToInt32_2());
                }
            }
            catch (Exception ex)
            {
                bApprove = false;
                SetOutParam(&quot;IsSuccessful&quot;, bApprove, &quot;System.Boolean&quot;);
                SetOutParam(&quot;Message&quot;, ex.Message, &quot;System.String&quot;);
                throw new Exception(ex.Message);
            }
        }

        private void UnApproveIP(string context)
        {
            bool bUnApprove = true;
            string sMsg = &quot;&quot;;

            int iCurrentUser = 1;
            string currentUserId = GetInputParam(&quot;_CurrentUserId&quot;).ToString();
            int.TryParse(currentUserId, out iCurrentUser);
            try
            {
                string retValues = ITMPOSTBL.Instance.UpdatePostingStatus(InstanceId, &quot;Draft&quot;, false, iCurrentUser);
                string[] retVal = retValues.Split(&#39;@&#39;);
                if (retVal.Length &gt; 1 &amp;&amp; !String.IsNullOrEmpty(retVal[1]))
                {
                    throw new Exception(retVal[1]);
                }
                else
                {
                    #region EIS Integration

                    if (IntegrationConnectorManager.Instance.IsIntegrationConnectorAttached(RegisteredEIS.MSP))
                    {
                        var eisList = new EISItemPostingListModel();
                        eisList.Context = context;
                        sMsg = eisList.EISUnApproveIP(InstanceId);

                        if (!String.IsNullOrEmpty(sMsg) &amp;&amp;
                            !(sMsg.Contains(&quot;Undo Status Update successfully completed&quot;) ||
                              sMsg.Contains(&quot;Contract is not mapped&quot;) ||
                              sMsg.Contains(&quot;MSP: This Contract is not mapped to Microsoft Project.&quot;)))
                            throw new Exception(sMsg);
                    }

                    #endregion

                    ProcurementWorkPosting.Instance.DeleteWorkPostingByReferenceID(InstanceId, &quot;ITMPOST&quot;);
                    bUnApprove = true;
                    SetOutParam(&quot;IsSuccessful&quot;, bUnApprove, &quot;System.Boolean&quot;);
                    sMsg = &quot;Un Approved Successfully&quot;;
                    SetOutParam(&quot;Message&quot;, sMsg, &quot;System.String&quot;);
                }
            }
            catch (Exception ex)
            {
                string msg = ex.Message.Replace(&quot;LOC_PAY_ESTIMATE&quot;, LocalizationManager.GetString(KeyConstants.LOC_PAY_ESTIMATE));
                bUnApprove = false;
                SetOutParam(&quot;IsSuccessful&quot;, bUnApprove, &quot;System.Boolean&quot;);
                SetOutParam(&quot;Message&quot;, msg, &quot;System.String&quot;);
                throw new Exception(msg);
            }
        }
    }


    [DataContract]
    public class ItemPickerParams
    {
        [DataMember]
        public string ModuleId;
        [DataMember]
        public string ParentInstanceId;
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[57,13,57,14,0],[58,17,58,34,0],[59,17,59,86,0],[60,17,60,32,0],[61,13,61,14,0],[62,17,62,18,0],[62,19,62,55,0],[62,56,62,57,0],[67,13,67,14,0],[68,17,68,36,0],[69,17,69,89,0],[70,17,70,34,0],[71,13,71,14,0],[72,17,72,18,0],[72,19,72,56,0],[72,57,72,58,0],[77,13,77,14,0],[78,17,78,37,0],[79,17,79,92,0],[80,17,80,35,0],[81,13,81,14,0],[82,17,82,18,0],[82,19,82,58,0],[82,59,82,60,0],[84,9,84,53,0],[85,9,85,101,0],[86,9,86,73,0],[92,9,92,46,0],[98,17,98,18,0],[98,19,98,49,0],[98,50,98,51,0],[99,17,99,18,0],[99,19,99,98,0],[99,99,99,100,0],[105,13,105,14,0],[106,17,106,47,0],[107,17,107,18,0],[108,21,108,107,0],[109,17,109,18,0],[110,17,110,42,0],[111,13,111,14,0],[116,17,116,18,0],[116,19,116,45,0],[116,46,116,47,0],[117,17,117,18,0],[117,19,117,90,0],[117,91,117,92,0],[122,17,122,18,0],[122,19,122,60,0],[122,61,122,62,0],[128,13,128,14,0],[129,17,129,83,0],[130,17,130,31,0],[131,17,131,32,0],[132,17,132,32,0],[133,13,133,14,0],[134,17,134,18,0],[134,19,134,105,0],[134,106,134,107,0],[150,17,150,18,0],[150,19,150,60,0],[150,61,150,62,0],[152,13,152,14,0],[153,17,155,87,0],[156,13,156,14,0],[161,17,161,18,0],[161,19,161,52,0],[161,53,161,54,0],[162,17,162,18,0],[162,19,162,120,0],[162,121,162,122,0],[165,40,165,44,0],[165,45,165,49,0],[172,17,172,18,0],[172,19,172,80,0],[172,81,172,82,0],[180,17,180,18,0],[180,19,180,81,0],[180,82,180,83,0],[189,13,189,14,0],[190,17,190,87,0],[191,21,191,54,0],[193,21,194,81,0],[195,13,195,14,0],[201,13,201,14,0],[202,17,202,51,0],[203,21,203,55,0],[205,17,205,57,0],[206,13,206,14,0],[208,13,208,14,0],[209,17,209,47,0],[210,13,210,14,0],[216,13,216,14,0],[217,17,217,59,0],[218,21,218,64,0],[220,17,220,66,0],[221,13,221,14,0],[223,13,223,14,0],[224,17,224,55,0],[225,13,225,14,0],[228,38,228,42,0],[228,43,228,47,0],[230,38,230,42,0],[230,43,230,47,0],[232,51,232,55,0],[232,56,232,60,0],[253,9,253,10,0],[254,13,266,102,0],[268,13,268,47,0],[269,13,269,14,0],[270,17,270,52,0],[271,17,271,18,0],[272,26,272,35,0],[272,37,272,74,0],[272,76,272,79,0],[273,21,273,22,0],[275,25,276,76,0],[277,21,277,22,0],[278,17,278,18,0],[280,17,280,46,0],[282,17,282,66,0],[283,17,283,41,0],[285,17,285,58,0],[287,17,287,90,0],[289,17,289,63,0],[291,17,291,47,0],[292,17,292,18,0],[293,21,293,75,0],[294,21,294,78,0],[295,17,295,18,0],[298,17,298,93,0],[299,17,299,24,0],[299,26,299,39,0],[299,40,299,42,0],[299,43,299,57,0],[300,21,300,45,0],[301,21,301,22,0],[302,25,304,103,0],[306,25,306,77,0],[308,25,310,110,0],[311,21,311,22,0],[315,17,315,113,0],[316,17,316,24,0],[316,26,316,42,0],[316,43,316,45,0],[316,46,316,59,0],[317,17,317,18,0],[318,21,318,48,0],[319,21,319,22,0],[320,25,322,106,0],[323,25,323,107,0],[324,21,324,22,0],[325,17,325,18,0],[328,17,339,61,0],[341,17,341,45,0],[345,17,345,38,0],[346,21,350,51,0],[352,17,352,36,0],[353,21,353,55,0],[356,17,356,95,0],[357,21,357,53,0],[358,17,358,95,0],[359,21,359,53,0],[360,17,360,95,0],[361,21,361,53,0],[362,17,362,91,0],[363,17,363,18,0],[364,21,364,53,0],[365,21,365,53,0],[366,17,366,18,0],[368,17,368,24,0],[368,26,368,45,0],[368,46,368,48,0],[368,49,368,53,0],[369,21,369,66,0],[372,17,372,73,0],[373,17,373,76,0],[374,17,374,71,0],[375,17,375,49,0],[376,21,376,83,0],[377,17,377,104,0],[378,17,378,104,0],[379,17,379,104,0],[380,17,380,112,0],[381,17,381,112,0],[382,17,382,112,0],[384,17,387,46,0],[389,17,389,35,0],[390,17,390,18,0],[391,21,391,28,0],[391,30,391,48,0],[391,49,391,51,0],[391,52,391,67,0],[392,25,392,54,0],[392,55,392,111,0],[393,21,393,79,0],[394,17,394,18,0],[396,22,396,31,0],[396,33,396,60,0],[396,62,396,65,0],[397,17,397,18,0],[398,21,398,88,0],[399,25,399,105,0],[400,21,400,88,0],[401,25,401,105,0],[402,21,402,88,0],[403,25,403,105,0],[404,17,404,18,0],[406,17,410,70,0],[412,17,412,49,0],[413,21,413,74,0],[415,17,419,71,0],[421,17,421,69,0],[422,17,422,61,0],[424,17,424,38,0],[425,17,425,18,0],[428,21,428,63,0],[429,21,429,58,0],[430,21,430,52,0],[432,21,434,97,0],[437,17,437,18,0],[438,17,438,44,0],[439,21,439,103,0],[441,17,441,49,0],[442,21,442,108,0],[444,17,444,46,0],[445,21,445,105,0],[447,17,447,44,0],[448,21,448,59,0],[450,17,450,24,0],[450,26,450,45,0],[450,46,450,48,0],[450,49,450,53,0],[451,17,451,18,0],[452,21,452,50,0],[453,17,453,18,0],[456,13,456,14,0],[457,9,457,10,0],[460,9,460,10,0],[461,13,462,118,0],[463,13,463,111,0],[464,13,464,14,0],[465,17,465,47,0],[466,13,466,14,0],[469,9,469,10,0],[472,9,472,10,0],[473,13,473,78,0],[474,13,474,65,0],[475,13,475,61,0],[476,13,476,23,0],[477,9,477,10,0],[480,9,480,10,0],[482,13,482,14,0],[485,17,485,57,0],[486,17,486,73,0],[487,17,487,43,0],[489,17,490,122,0],[491,17,491,112,0],[493,17,493,115,0],[494,17,494,18,0],[497,21,497,72,0],[498,21,498,71,0],[499,21,499,70,0],[501,21,501,75,0],[502,21,502,82,0],[503,21,503,82,0],[507,21,507,85,0],[508,21,508,104,0],[509,21,509,104,0],[510,17,510,18,0],[513,13,513,14,0],[514,13,514,33,0],[515,13,515,14,0],[516,17,516,49,0],[518,9,518,10,0],[522,9,522,10,0],[523,13,523,34,0],[524,13,524,37,0],[525,13,525,28,0],[526,13,526,14,0],[527,17,527,40,0],[528,17,528,18,0],[529,21,529,46,0],[530,17,530,18,0],[531,17,531,41,0],[532,17,532,36,0],[533,13,533,14,0],[534,13,534,44,0],[535,13,535,65,0],[536,9,536,10,0],[543,9,543,10,0],[544,13,544,49,0],[550,13,550,14,0],[551,17,553,97,0],[554,17,554,38,0],[555,13,555,14,0],[561,13,561,14,0],[562,17,562,48,0],[563,17,563,18,0],[564,21,565,140,0],[567,22,567,34,0],[568,13,568,14,0],[573,17,573,18,0],[573,19,573,36,0],[573,37,573,38,0],[578,17,578,18,0],[578,19,578,81,0],[578,82,578,83,0],[583,17,583,18,0],[583,19,583,31,0],[583,32,583,33,0],[588,17,588,18,0],[588,19,588,65,0],[588,66,588,67,0],[594,13,594,14,0],[595,17,597,98,0],[598,17,598,27,0],[599,13,599,14,0],[604,17,604,18,0],[604,19,604,41,0],[604,42,604,43,0],[609,9,609,10,0],[610,13,610,37,0],[613,13,613,157,0],[614,13,614,57,0],[615,17,615,86,0],[616,13,616,32,0],[617,9,617,10,0],[621,9,621,10,0],[622,13,622,38,0],[623,13,623,26,0],[624,13,624,30,0],[626,13,626,32,0],[627,13,627,14,0],[628,17,628,38,0],[629,17,629,79,0],[633,17,633,147,0],[634,17,634,106,0],[635,17,652,99,0],[654,17,654,48,0],[655,21,655,64,0],[657,21,657,65,0],[659,17,659,30,0],[660,17,660,61,0],[662,17,662,60,0],[663,17,663,73,0],[665,17,665,93,0],[666,17,666,72,0],[667,17,667,18,0],[668,21,668,96,0],[669,21,669,103,0],[671,21,674,103,0],[675,21,675,22,0],[676,25,676,144,0],[677,21,677,22,0],[678,17,678,18,0],[680,13,680,14,0],[682,17,682,60,0],[684,13,684,25,0],[685,9,685,10,0],[690,9,690,10,0],[691,13,691,31,0],[693,13,693,31,0],[694,13,694,38,0],[695,17,695,66,0],[696,9,696,10,0],[698,9,698,10,0],[699,13,699,44,0],[700,17,700,40,0],[705,13,705,74,0],[706,13,706,52,0],[707,13,707,73,0],[708,13,708,55,0],[709,13,709,57,0],[713,13,713,38,0],[715,13,715,140,0],[721,13,721,50,0],[722,13,722,38,0],[723,17,723,50,0],[725,13,725,28,0],[727,9,727,10,0],[731,9,731,10,0],[732,13,732,89,0],[734,13,734,53,0],[735,13,735,52,0],[736,13,736,53,0],[737,13,737,32,0],[738,13,738,90,0],[739,13,739,89,0],[740,13,740,102,0],[741,9,741,10,0],[745,9,745,10,0],[746,13,746,28,0],[748,13,748,85,0],[749,13,749,14,0],[750,17,750,85,0],[750,86,750,93,0],[751,17,751,38,0],[751,39,751,46,0],[752,17,752,44,0],[753,13,753,14,0],[754,9,754,10,0],[758,9,758,10,0],[759,13,759,31,0],[760,13,760,61,0],[761,13,761,74,0],[762,13,762,90,0],[763,9,763,10,0],[767,9,767,10,0],[768,13,768,50,0],[770,13,770,105,0],[771,17,771,48,0],[773,13,773,137,0],[831,13,831,85,0],[832,13,835,147,0],[837,13,837,90,0],[839,13,839,53,0],[840,13,840,111,0],[841,13,841,62,0],[842,13,842,84,0],[843,13,843,56,0],[845,13,845,48,0],[847,13,847,65,0],[848,17,848,73,0],[851,13,851,41,0],[852,13,852,14,0],[853,17,853,175,0],[854,13,854,14,0],[856,13,856,14,0],[857,17,857,70,0],[858,17,858,172,0],[859,13,859,14,0],[862,13,862,89,0],[863,13,863,91,0],[864,13,864,71,0],[865,13,865,75,0],[868,13,868,30,0],[870,13,870,20,0],[870,22,870,32,0],[870,33,870,35,0],[870,36,870,46,0],[871,13,871,14,0],[872,17,872,54,0],[873,17,873,18,0],[874,21,874,123,0],[875,21,875,43,0],[876,17,876,18,0],[878,17,878,18,0],[879,21,879,43,0],[881,40,881,54,0],[881,55,881,61,0],[882,48,882,63,0],[882,64,882,70,0],[883,45,883,60,0],[883,61,883,67,0],[884,34,884,49,0],[884,50,884,56,0],[887,21,887,175,0],[888,21,888,50,0],[889,21,889,22,0],[890,25,890,88,0],[891,25,891,46,0],[892,21,892,22,0],[893,21,893,51,0],[894,21,894,22,0],[895,25,895,90,0],[896,25,896,46,0],[897,21,897,22,0],[898,21,898,50,0],[899,21,899,22,0],[900,25,900,86,0],[901,25,901,46,0],[902,21,902,22,0],[903,21,903,54,0],[904,21,904,22,0],[905,25,905,46,0],[906,21,906,22,0],[912,21,912,43,0],[913,17,913,18,0],[914,13,914,14,0],[915,13,915,32,0],[916,9,916,10,0],[919,9,919,10,0],[921,13,921,14,0],[922,17,922,35,0],[923,17,923,44,0],[925,17,925,56,0],[926,17,926,67,0],[927,17,927,36,0],[928,17,928,18,0],[929,21,929,94,0],[931,17,931,18,0],[932,17,932,31,0],[933,21,933,94,0],[934,17,934,36,0],[935,17,935,18,0],[936,21,936,35,0],[937,25,937,108,0],[938,21,938,100,0],[939,17,939,18,0],[940,17,940,50,0],[941,21,941,50,0],[942,17,942,53,0],[946,17,946,73,0],[947,17,947,18,0],[948,21,948,107,0],[949,17,949,18,0],[950,17,950,73,0],[951,17,951,18,0],[952,21,952,88,0],[953,21,953,57,0],[954,17,954,18,0],[957,17,957,54,0],[958,17,958,18,0],[959,21,959,40,0],[960,21,960,22,0],[961,25,964,129,0],[965,25,965,109,0],[966,25,966,26,0],[967,29,967,61,0],[968,25,968,26,0],[969,21,969,22,0],[970,17,970,18,0],[971,17,971,45,0],[972,13,972,14,0],[973,13,973,18,0],[973,19,973,20,0],[973,21,973,22,0],[974,9,974,10,0],[977,9,977,10,0],[978,13,978,65,0],[979,13,979,14,0],[980,17,980,80,0],[982,17,982,117,0],[983,17,983,74,0],[984,13,984,14,0],[986,13,986,67,0],[987,13,987,14,0],[988,17,988,86,0],[990,17,990,119,0],[991,17,991,81,0],[992,17,992,84,0],[993,13,993,14,0],[995,13,995,67,0],[996,13,996,14,0],[997,17,997,84,0],[998,17,998,84,0],[999,13,999,14,0],[1001,13,1001,65,0],[1002,13,1002,14,0],[1003,17,1003,80,0],[1004,17,1004,74,0],[1005,13,1005,14,0],[1006,9,1006,10,0],[1009,9,1009,10,0],[1010,13,1011,65,0],[1012,17,1012,49,0],[1022,13,1022,52,0],[1023,13,1023,14,0],[1024,17,1024,51,0],[1025,13,1025,14,0],[1027,13,1027,14,0],[1028,17,1028,71,0],[1029,21,1029,78,0],[1030,13,1030,14,0],[1033,13,1033,37,0],[1034,17,1034,39,0],[1036,13,1036,29,0],[1037,17,1037,45,0],[1039,13,1039,106,0],[1040,17,1040,60,0],[1042,13,1042,33,0],[1043,9,1043,10,0],[1046,9,1046,10,0],[1048,13,1048,103,0],[1051,13,1051,76,0],[1053,13,1053,49,0],[1055,13,1055,116,0],[1056,13,1056,14,0],[1057,17,1057,62,0],[1058,17,1058,30,0],[1059,17,1059,33,0],[1060,17,1060,18,0],[1061,21,1061,39,0],[1062,21,1062,94,0],[1063,17,1063,18,0],[1064,13,1064,14,0],[1066,13,1066,73,0],[1067,17,1067,65,0],[1069,13,1069,101,0],[1070,13,1070,14,0],[1071,17,1073,119,0],[1074,13,1074,14,0],[1077,13,1077,81,0],[1080,13,1080,52,0],[1082,13,1082,55,0],[1083,13,1083,14,0],[1086,17,1086,38,0],[1089,13,1089,14,0],[1091,17,1091,39,0],[1093,13,1093,31,0],[1094,13,1094,14,0],[1095,17,1095,64,0],[1096,17,1096,63,0],[1097,13,1097,14,0],[1099,13,1099,14,0],[1100,17,1100,65,0],[1101,17,1101,62,0],[1102,13,1102,14,0],[1104,13,1104,89,0],[1105,13,1108,62,0],[1110,13,1110,85,0],[1111,17,1111,45,0],[1113,13,1113,55,0],[1114,13,1114,14,0],[1115,17,1115,75,0],[1116,17,1121,47,0],[1122,13,1122,14,0],[1124,17,1124,41,0],[1126,13,1126,77,0],[1127,13,1127,94,0],[1129,13,1129,29,0],[1130,13,1130,14,0],[1131,17,1131,37,0],[1132,17,1132,38,0],[1134,17,1135,83,0],[1136,17,1136,125,0],[1137,17,1137,69,0],[1139,17,1139,48,0],[1142,17,1142,18,0],[1143,21,1143,54,0],[1144,25,1144,93,0],[1145,17,1145,18,0],[1146,17,1146,22,0],[1147,17,1147,18,0],[1148,21,1149,113,0],[1150,17,1150,18,0],[1152,17,1152,64,0],[1155,17,1155,49,0],[1156,17,1156,18,0],[1158,21,1158,143,0],[1159,21,1159,120,0],[1161,21,1161,60,0],[1162,21,1162,22,0],[1163,25,1163,73,0],[1164,25,1164,78,0],[1165,25,1165,43,0],[1166,25,1166,71,0],[1167,25,1167,69,0],[1168,25,1168,26,0],[1169,29,1169,52,0],[1170,25,1170,26,0],[1171,25,1171,85,0],[1172,21,1172,22,0],[1174,21,1174,22,0],[1175,25,1175,52,0],[1176,25,1176,47,0],[1177,25,1177,129,0],[1178,25,1178,69,0],[1179,25,1179,26,0],[1180,29,1180,78,0],[1181,25,1181,26,0],[1182,21,1182,22,0],[1183,17,1183,18,0],[1184,17,1184,39,0],[1186,17,1186,114,0],[1187,17,1187,83,0],[1189,13,1189,14,0],[1190,13,1190,32,0],[1191,17,1191,32,0],[1193,13,1193,33,0],[1194,13,1194,14,0],[1195,17,1195,59,0],[1196,17,1196,63,0],[1197,17,1197,72,0],[1198,13,1198,14,0],[1200,13,1200,101,0],[1201,13,1201,58,0],[1202,13,1202,32,0],[1203,13,1203,14,0],[1204,17,1204,72,0],[1205,13,1205,14,0],[1207,13,1207,49,0],[1208,17,1208,52,0],[1210,13,1210,42,0],[1211,17,1211,48,0],[1213,13,1213,43,0],[1214,17,1214,49,0],[1215,13,1215,43,0],[1216,17,1216,49,0],[1218,13,1218,108,0],[1219,13,1219,56,0],[1220,13,1220,14,0],[1221,17,1221,66,0],[1222,17,1222,90,0],[1223,17,1223,84,0],[1224,13,1224,14,0],[1226,13,1226,58,0],[1227,13,1227,14,0],[1228,17,1228,94,0],[1229,17,1229,53,0],[1230,17,1230,54,0],[1231,17,1231,59,0],[1232,13,1232,14,0],[1234,13,1234,105,0],[1235,13,1235,14,0],[1236,17,1236,53,0],[1237,17,1237,57,0],[1238,17,1238,59,0],[1239,13,1239,14,0],[1241,13,1241,29,0],[1242,13,1242,14,0],[1243,17,1243,61,0],[1244,21,1244,59,0],[1246,17,1246,18,0],[1247,21,1247,53,0],[1248,21,1248,66,0],[1249,21,1249,67,0],[1250,17,1250,18,0],[1251,13,1251,14,0],[1255,13,1255,50,0],[1256,13,1256,38,0],[1257,17,1257,54,0],[1259,9,1259,10,0],[1262,9,1262,10,0],[1263,13,1263,58,0],[1264,17,1264,34,0],[1265,9,1265,10,0],[1268,9,1268,10,0],[1269,13,1269,59,0],[1270,13,1270,45,0],[1271,13,1271,14,0],[1272,17,1272,86,0],[1273,17,1273,18,0],[1274,21,1274,75,0],[1275,17,1275,18,0],[1277,17,1277,18,0],[1278,21,1278,58,0],[1279,21,1279,44,0],[1279,45,1279,65,0],[1280,21,1280,94,0],[1281,21,1281,51,0],[1282,21,1282,78,0],[1283,17,1283,18,0],[1284,17,1284,41,0],[1285,17,1285,67,0],[1286,13,1286,14,0],[1287,13,1287,31,0],[1288,13,1288,14,0],[1289,17,1289,101,0],[1290,17,1290,42,0],[1291,21,1291,93,0],[1292,13,1292,14,0],[1294,13,1294,14,0],[1295,17,1295,107,0],[1296,17,1296,42,0],[1297,21,1297,105,0],[1298,13,1298,14,0],[1299,13,1299,36,0],[1300,13,1300,43,0],[1301,13,1301,84,0],[1302,9,1302,10,0],[1305,9,1305,10,0],[1306,13,1306,141,0],[1307,13,1311,108,0],[1312,13,1312,38,0],[1313,9,1313,10,0],[1316,9,1316,10,0],[1317,13,1317,99,0],[1318,13,1318,87,0],[1319,13,1319,98,0],[1320,9,1320,10,0],[1323,9,1323,10,0],[1324,13,1324,71,0],[1325,13,1325,47,0],[1326,13,1326,39,0],[1327,13,1327,14,0],[1328,17,1328,101,0],[1329,17,1329,97,0],[1330,13,1330,14,0],[1332,13,1332,47,0],[1333,13,1333,53,0],[1334,13,1334,59,0],[1335,13,1335,61,0],[1336,13,1336,38,0],[1338,13,1338,78,0],[1339,13,1339,54,0],[1340,13,1340,59,0],[1341,13,1341,65,0],[1342,13,1342,67,0],[1344,13,1344,44,0],[1346,13,1346,47,0],[1347,17,1348,110,0],[1349,13,1349,111,0],[1350,9,1350,10,0],[1353,9,1353,10,0],[1354,13,1354,32,0],[1355,13,1355,14,0],[1356,17,1356,32,0],[1357,13,1357,14,0],[1359,13,1359,39,0],[1361,13,1361,14,0],[1362,17,1363,80,0],[1364,17,1364,104,0],[1365,21,1365,36,0],[1366,13,1366,14,0],[1367,13,1367,18,0],[1368,13,1368,14,0],[1369,17,1370,40,0],[1371,13,1371,14,0],[1372,13,1372,50,0],[1373,13,1373,41,0],[1374,13,1374,57,0],[1376,13,1376,51,0],[1377,13,1377,14,0],[1378,17,1379,118,0],[1380,17,1380,18,0],[1381,21,1381,101,0],[1383,21,1383,36,0],[1384,17,1384,18,0],[1385,13,1385,14,0],[1387,13,1387,86,0],[1388,13,1388,14,0],[1389,17,1389,97,0],[1391,17,1391,32,0],[1392,13,1392,14,0],[1394,13,1394,91,0],[1395,13,1395,14,0],[1396,17,1397,116,0],[1398,17,1398,73,0],[1400,17,1400,32,0],[1401,13,1401,14,0],[1403,13,1403,32,0],[1404,13,1404,14,0],[1405,17,1405,96,0],[1406,17,1406,82,0],[1407,17,1407,98,0],[1408,17,1408,59,0],[1409,17,1409,56,0],[1410,17,1410,56,0],[1411,17,1413,70,0],[1414,17,1414,134,0],[1415,17,1415,140,0],[1419,17,1419,39,0],[1421,17,1421,86,0],[1422,17,1422,59,0],[1423,17,1423,18,0],[1424,21,1426,106,0],[1427,25,1428,114,0],[1429,21,1431,111,0],[1432,25,1433,120,0],[1434,17,1434,18,0],[1436,17,1436,18,0],[1437,21,1437,82,0],[1438,25,1438,91,0],[1439,21,1439,88,0],[1440,25,1440,97,0],[1441,17,1441,18,0],[1442,17,1442,94,0],[1443,17,1443,148,0],[1444,17,1444,81,0],[1445,21,1445,54,0],[1446,17,1446,85,0],[1447,17,1447,18,0],[1448,21,1449,109,0],[1451,21,1451,81,0],[1452,21,1452,44,0],[1453,17,1453,18,0],[1454,22,1454,86,0],[1455,17,1455,18,0],[1456,21,1456,64,0],[1457,21,1457,41,0],[1458,21,1458,93,0],[1459,21,1459,51,0],[1460,21,1460,78,0],[1461,17,1461,18,0],[1463,21,1463,44,0],[1465,17,1465,115,0],[1466,17,1466,55,0],[1467,13,1467,14,0],[1469,13,1469,14,0],[1470,17,1470,84,0],[1471,17,1471,56,0],[1472,17,1472,93,0],[1473,17,1473,86,0],[1474,17,1474,94,0],[1475,17,1475,74,0],[1476,17,1476,74,0],[1477,17,1477,44,0],[1478,13,1478,14,0],[1479,13,1479,32,0],[1480,13,1480,90,0],[1481,17,1481,98,0],[1483,13,1483,42,0],[1484,13,1484,41,0],[1485,13,1485,63,0],[1486,13,1486,47,0],[1487,13,1487,42,0],[1488,13,1488,51,0],[1489,13,1492,49,0],[1493,13,1493,46,0],[1494,13,1494,136,0],[1496,13,1496,55,0],[1497,13,1497,52,0],[1498,13,1498,51,0],[1500,13,1503,55,0],[1504,13,1507,52,0],[1509,13,1512,40,0],[1514,13,1518,59,0],[1519,13,1523,56,0],[1524,13,1524,75,0],[1525,13,1525,14,0],[1526,17,1531,66,0],[1532,17,1537,59,0],[1538,17,1542,62,0],[1543,17,1547,59,0],[1548,17,1553,63,0],[1554,17,1558,61,0],[1559,13,1559,14,0],[1561,13,1563,74,0],[1564,13,1564,73,0],[1565,17,1566,122,0],[1567,13,1571,51,0],[1572,13,1576,55,0],[1578,13,1578,83,0],[1580,13,1581,51,0],[1582,17,1585,53,0],[1586,18,1586,86,0],[1587,17,1590,53,0],[1592,17,1592,50,0],[1593,13,1593,23,0],[1594,13,1594,59,0],[1595,13,1595,33,0],[1596,13,1596,14,0],[1597,17,1597,34,0],[1598,17,1598,73,0],[1599,13,1599,14,0],[1601,13,1601,42,0],[1602,9,1602,10,0],[1605,9,1605,10,0],[1606,13,1606,119,0],[1607,13,1607,57,0],[1608,13,1608,38,0],[1609,13,1609,36,0],[1610,17,1610,42,0],[1612,13,1612,14,0],[1613,17,1613,44,0],[1614,17,1614,58,0],[1615,17,1615,57,0],[1616,17,1616,39,0],[1617,13,1617,14,0],[1618,9,1618,10,0],[1621,9,1621,10,0],[1622,13,1622,95,0],[1623,13,1626,114,0],[1627,13,1627,50,0],[1628,13,1628,29,0],[1629,13,1629,14,0],[1630,17,1632,97,0],[1633,17,1633,73,0],[1634,17,1634,62,0],[1636,17,1645,57,0],[1647,17,1647,24,0],[1650,13,1650,41,0],[1651,13,1651,57,0],[1653,13,1653,75,0],[1654,17,1654,48,0],[1655,13,1655,41,0],[1656,13,1656,42,0],[1657,13,1657,47,0],[1658,13,1658,46,0],[1659,13,1659,66,0],[1660,13,1663,52,0],[1665,13,1668,40,0],[1670,13,1673,55,0],[1674,13,1678,52,0],[1679,13,1681,54,0],[1682,13,1682,102,0],[1683,17,1686,53,0],[1687,18,1687,86,0],[1688,17,1691,53,0],[1693,17,1693,50,0],[1694,13,1698,59,0],[1699,13,1703,56,0],[1704,13,1708,51,0],[1709,13,1713,55,0],[1714,13,1714,22,0],[1715,13,1715,14,0],[1716,17,1721,64,0],[1722,17,1727,57,0],[1728,17,1732,60,0],[1733,17,1737,57,0],[1738,17,1743,61,0],[1744,17,1748,59,0],[1749,13,1749,14,0],[1750,13,1750,119,0],[1751,13,1751,32,0],[1752,17,1754,79,0],[1756,13,1756,32,0],[1757,9,1757,10,0],[1760,9,1760,10,0],[1761,13,1762,45,0],[1763,13,1763,57,0],[1764,17,1764,86,0],[1766,13,1766,24,0],[1767,13,1767,14,0],[1768,17,1768,62,0],[1769,17,1769,50,0],[1770,17,1770,18,0],[1771,21,1771,107,0],[1772,21,1772,60,0],[1773,21,1773,89,0],[1774,17,1774,18,0],[1775,13,1775,14,0],[1776,13,1776,32,0],[1777,9,1777,10,0],[1780,9,1780,10,0],[1781,13,1781,34,0],[1782,9,1782,10,0],[1785,9,1785,10,0],[1786,13,1786,34,0],[1788,13,1788,61,0],[1789,17,1789,63,0],[1791,17,1791,79,0],[1792,13,1792,20,0],[1792,22,1792,38,0],[1792,39,1792,41,0],[1792,42,1792,59,0],[1793,13,1793,14,0],[1794,17,1794,48,0],[1795,21,1795,59,0],[1796,17,1796,101,0],[1797,21,1797,63,0],[1798,17,1798,101,0],[1799,21,1799,63,0],[1800,17,1800,101,0],[1801,21,1801,63,0],[1802,17,1802,50,0],[1803,21,1803,61,0],[1804,17,1804,54,0],[1805,21,1805,65,0],[1806,13,1806,14,0],[1807,9,1807,10,0],[1810,9,1810,10,0],[1811,13,1811,41,0],[1812,13,1812,42,0],[1813,13,1813,14,0],[1814,17,1814,41,0],[1815,17,1815,69,0],[1816,17,1816,55,0],[1817,13,1817,14,0],[1819,17,1819,46,0],[1820,9,1820,10,0],[1823,9,1823,10,0],[1824,13,1824,66,0],[1825,13,1825,34,0],[1826,13,1826,35,0],[1827,13,1827,14,0],[1828,17,1828,41,0],[1829,17,1829,47,0],[1830,17,1830,37,0],[1831,13,1831,14,0],[1833,13,1833,14,0],[1834,17,1834,35,0],[1835,17,1835,41,0],[1836,17,1836,155,0],[1837,13,1837,14,0],[1838,13,1838,59,0],[1839,9,1839,10,0],[1842,9,1842,10,0],[1843,13,1843,65,0],[1844,9,1844,10,0],[1847,9,1847,10,0],[1849,13,1849,14,0],[1850,17,1853,32,0],[1854,13,1854,14,0],[1855,13,1855,18,0],[1856,13,1856,14,0],[1858,13,1858,14,0],[1859,13,1859,50,0],[1860,13,1860,51,0],[1861,13,1861,43,0],[1862,13,1862,14,0],[1863,17,1863,35,0],[1864,17,1864,67,0],[1865,17,1865,18,0],[1866,21,1866,45,0],[1867,21,1867,73,0],[1868,17,1868,18,0],[1869,22,1869,148,0],[1870,21,1870,50,0],[1871,13,1871,14,0],[1872,13,1872,70,0],[1873,13,1873,51,0],[1874,13,1874,41,0],[1875,9,1875,10,0],[1878,9,1878,10,0],[1879,13,1880,45,0],[1881,13,1881,33,0],[1882,13,1882,14,0],[1883,17,1883,61,0],[1884,17,1884,18,0],[1885,21,1885,65,0],[1886,17,1886,18,0],[1887,17,1888,58,0],[1889,17,1889,18,0],[1890,21,1890,49,0],[1891,17,1891,18,0],[1892,13,1892,14,0],[1893,13,1893,50,0],[1894,9,1894,10,0],[1897,9,1897,10,0],[1898,13,1898,84,0],[1899,17,1899,50,0],[1900,18,1900,70,0],[1901,13,1901,14,0],[1902,17,1902,113,0],[1904,13,1904,14,0],[1905,9,1905,10,0],[1907,58,1907,59,0],[1907,60,1907,88,0],[1907,89,1907,90,0],[1910,9,1910,10,0],[1911,13,1911,29,0],[1912,13,1912,88,0],[1913,13,1913,14,0],[1914,17,1914,87,0],[1915,21,1915,54,0],[1917,17,1917,18,0],[1918,21,1918,55,0],[1920,21,1920,46,0],[1921,21,1921,38,0],[1922,21,1922,56,0],[1923,17,1923,18,0],[1924,13,1924,14,0],[1925,18,1925,70,0],[1926,13,1926,14,0],[1927,17,1927,113,0],[1929,13,1929,14,0],[1930,9,1930,10,0],[1933,9,1933,10,0],[1934,13,1934,49,0],[1935,13,1935,50,0],[1936,9,1936,10,0],[1939,9,1939,10,0],[1940,13,1940,45,0],[1941,13,1941,14,0],[1942,17,1944,63,0],[1945,17,1945,24,0],[1947,13,1947,66,0],[1948,17,1948,85,0],[1949,13,1949,26,0],[1950,13,1950,29,0],[1951,13,1951,14,0],[1952,17,1952,36,0],[1953,17,1953,18,0],[1954,21,1954,37,0],[1955,21,1955,34,0],[1956,21,1956,55,0],[1957,21,1957,35,0],[1958,17,1958,18,0],[1959,17,1959,52,0],[1960,17,1960,53,0],[1962,17,1962,27,0],[1963,13,1963,14,0],[1964,9,1964,10,0],[1967,9,1967,10,0],[1968,13,1968,39,0],[1969,13,1969,57,0],[1970,13,1970,14,0],[1971,17,1971,66,0],[1972,17,1972,60,0],[1973,17,1973,18,0],[1974,21,1974,73,0],[1975,21,1975,95,0],[1976,17,1976,18,0],[1977,13,1977,14,0],[1979,13,1979,14,0],[1980,17,1980,35,0],[1981,21,1981,103,0],[1983,17,1983,18,0],[1984,21,1984,73,0],[1985,21,1985,95,0],[1986,17,1986,18,0],[1987,17,1987,80,0],[1988,21,1988,59,0],[1989,13,1989,14,0],[1990,13,1990,33,0],[1991,13,1991,14,0],[1992,17,1992,34,0],[1993,13,1993,14,0],[1994,13,1994,49,0],[1995,13,1995,66,0],[1996,13,1996,75,0],[1997,13,1997,90,0],[1998,13,1998,75,0],[1999,9,1999,10,0],[2002,9,2002,10,0],[2003,13,2003,36,0],[2004,13,2004,112,0],[2005,13,2005,53,0],[2006,13,2006,52,0],[2007,13,2007,56,0],[2008,13,2008,47,0],[2009,13,2012,85,0],[2013,13,2013,20,0],[2013,22,2013,39,0],[2013,40,2013,42,0],[2013,43,2013,99,0],[2014,13,2014,14,0],[2015,17,2015,61,0],[2016,17,2016,51,0],[2017,17,2017,62,0],[2018,17,2018,52,0],[2019,13,2019,14,0],[2020,13,2020,90,0],[2021,9,2021,10,0],[2024,9,2024,10,0],[2025,13,2025,40,0],[2026,13,2026,49,0],[2027,13,2027,23,0],[2028,9,2028,10,0],[2031,9,2031,10,0],[2032,13,2032,33,0],[2033,13,2033,29,0],[2034,13,2034,14,0],[2035,17,2035,99,0],[2036,17,2036,122,0],[2037,13,2037,14,0],[2038,9,2038,10,0],[2041,9,2041,10,0],[2042,13,2042,40,0],[2043,13,2043,49,0],[2044,13,2044,59,0],[2047,9,2047,10,0],[2050,9,2050,10,0],[2051,13,2051,108,0],[2052,13,2052,14,0],[2053,17,2053,51,0],[2054,13,2054,14,0],[2055,9,2055,10,0],[2058,9,2058,10,0],[2059,13,2059,29,0],[2060,13,2060,14,0],[2061,17,2062,119,0],[2063,17,2063,73,0],[2064,17,2064,57,0],[2065,17,2065,18,0],[2067,21,2067,107,0],[2068,21,2068,48,0],[2069,17,2069,18,0],[2070,13,2070,14,0],[2071,9,2071,10,0],[2074,9,2074,10,0],[2075,13,2075,74,0],[2076,13,2076,78,0],[2077,13,2077,40,0],[2078,13,2078,33,0],[2079,13,2079,29,0],[2082,21,2082,107,0],[2083,21,2083,49,0],[2084,21,2084,48,0],[2085,21,2085,27,0],[2087,21,2087,22,0],[2088,25,2088,60,0],[2089,25,2089,44,0],[2090,25,2090,53,0],[2091,21,2091,22,0],[2092,21,2092,27,0],[2094,21,2094,51,0],[2095,21,2095,49,0],[2096,21,2096,27,0],[2098,9,2098,10,0],[2101,9,2101,10,0],[2102,13,2102,25,0],[2102,26,2102,57,0],[2103,18,2103,49,0],[2104,9,2104,10,0],[2107,9,2107,10,0],[2108,13,2108,39,0],[2109,13,2109,57,0],[2110,13,2110,14,0],[2111,17,2111,66,0],[2112,17,2112,60,0],[2113,17,2113,18,0],[2114,21,2114,73,0],[2115,21,2115,95,0],[2116,17,2116,18,0],[2117,13,2117,14,0],[2119,13,2119,14,0],[2120,17,2120,35,0],[2121,21,2121,103,0],[2123,17,2123,18,0],[2124,21,2124,73,0],[2125,21,2125,95,0],[2126,17,2126,18,0],[2127,17,2127,55,0],[2128,13,2128,14,0],[2129,13,2129,39,0],[2130,17,2130,56,0],[2131,18,2131,46,0],[2132,17,2132,51,0],[2133,13,2133,42,0],[2134,13,2134,46,0],[2135,13,2135,86,0],[2136,13,2136,44,0],[2137,13,2137,33,0],[2138,13,2138,118,0],[2140,13,2140,44,0],[2141,13,2141,26,0],[2142,13,2142,27,0],[2143,13,2143,41,0],[2144,13,2144,75,0],[2145,13,2145,44,0],[2147,9,2147,10,0],[2150,9,2150,10,0],[2151,13,2151,38,0],[2153,13,2153,20,0],[2153,22,2153,38,0],[2153,39,2153,41,0],[2153,42,2153,58,0],[2154,13,2154,14,0],[2155,17,2155,71,0],[2156,13,2156,14,0],[2157,9,2157,10,0],[2160,9,2160,10,0],[2161,13,2161,34,0],[2162,17,2162,100,0],[2164,13,2166,50,0],[2167,13,2169,43,0],[2170,13,2170,37,0],[2171,13,2171,46,0],[2172,13,2172,33,0],[2173,13,2175,42,0],[2176,13,2178,38,0],[2179,13,2181,34,0],[2182,13,2182,117,0],[2184,13,2186,34,0],[2188,13,2188,114,0],[2189,13,2189,63,0],[2190,17,2190,91,0],[2192,13,2192,63,0],[2193,17,2193,91,0],[2195,13,2195,63,0],[2196,17,2196,91,0],[2198,13,2198,83,0],[2199,13,2199,37,0],[2201,13,2201,52,0],[2202,9,2202,10,0],[2242,9,2242,10,0],[2243,13,2243,38,0],[2244,13,2244,26,0],[2245,13,2245,30,0],[2247,13,2247,49,0],[2248,13,2248,29,0],[2249,13,2249,14,0],[2250,17,2250,44,0],[2251,17,2251,33,0],[2252,17,2252,45,0],[2253,13,2253,14,0],[2254,13,2254,28,0],[2256,13,2256,58,0],[2257,17,2259,71,0],[2261,13,2263,34,0],[2264,13,2264,59,0],[2265,17,2266,102,0],[2268,13,2268,34,0],[2269,13,2269,37,0],[2270,13,2270,40,0],[2271,13,2271,72,0],[2272,13,2272,14,0],[2273,17,2273,119,0],[2276,13,2276,66,0],[2277,13,2277,91,0],[2278,13,2278,77,0],[2279,13,2279,48,0],[2280,13,2280,41,0],[2281,13,2281,14,0],[2282,17,2282,85,0],[2283,17,2283,87,0],[2284,13,2284,14,0],[2286,13,2286,14,0],[2287,17,2287,71,0],[2288,13,2288,14,0],[2289,13,2289,44,0],[2290,13,2290,14,0],[2291,17,2291,85,0],[2292,17,2292,87,0],[2293,13,2293,14,0],[2295,13,2295,14,0],[2296,17,2296,73,0],[2297,13,2297,14,0],[2299,13,2299,99,0],[2300,13,2300,51,0],[2301,13,2301,44,0],[2302,13,2302,48,0],[2303,13,2303,55,0],[2304,13,2304,69,0],[2305,13,2305,60,0],[2306,13,2306,48,0],[2307,13,2307,49,0],[2308,13,2308,47,0],[2309,17,2309,57,0],[2311,13,2311,45,0],[2312,13,2312,30,0],[2313,17,2313,84,0],[2315,17,2315,96,0],[2317,13,2317,50,0],[2318,13,2318,14,0],[2320,17,2320,58,0],[2321,17,2321,34,0],[2322,17,2322,18,0],[2324,21,2324,107,0],[2325,21,2325,99,0],[2326,17,2326,18,0],[2328,17,2328,18,0],[2330,21,2330,79,0],[2331,21,2331,69,0],[2333,21,2333,67,0],[2334,21,2334,55,0],[2335,17,2335,18,0],[2336,13,2336,14,0],[2338,13,2338,14,0],[2339,17,2339,50,0],[2340,17,2340,52,0],[2341,13,2341,14,0],[2342,13,2342,38,0],[2343,17,2343,64,0],[2347,13,2347,94,0],[2348,13,2348,14,0],[2349,17,2349,94,0],[2352,13,2352,99,0],[2353,13,2353,14,0],[2354,17,2354,105,0],[2357,13,2357,42,0],[2357,43,2357,73,0],[2359,13,2361,126,0],[2362,13,2362,97,0],[2363,13,2363,14,0],[2364,17,2364,60,0],[2365,13,2365,14,0],[2367,13,2367,14,0],[2368,17,2368,103,0],[2369,17,2369,40,0],[2370,21,2370,110,0],[2371,17,2371,40,0],[2372,21,2372,119,0],[2373,17,2373,63,0],[2375,17,2375,89,0],[2376,17,2376,18,0],[2377,21,2377,35,0],[2378,21,2378,46,0],[2379,21,2381,106,0],[2382,21,2384,102,0],[2385,17,2385,18,0],[2386,13,2386,14,0],[2387,13,2387,53,0],[2388,9,2388,10,0],[2391,9,2391,10,0],[2392,13,2392,29,0],[2393,13,2393,62,0],[2394,13,2394,94,0],[2395,13,2395,59,0],[2396,13,2396,55,0],[2397,9,2397,10,0],[2401,9,2401,10,0],[2402,13,2402,33,0],[2403,17,2403,71,0],[2404,9,2404,10,0],[2407,9,2407,10,0],[2408,13,2408,88,0],[2410,13,2410,116,0],[2411,13,2411,14,0],[2412,17,2413,111,0],[2414,13,2414,14,0],[2415,9,2415,10,0],[2418,9,2418,10,0],[2419,13,2419,120,0],[2420,13,2420,81,0],[2421,13,2421,65,0],[2422,9,2422,10,0],[2427,17,2427,18,0],[2428,17,2430,95,0],[2432,17,2432,55,0],[2432,56,2432,57,0],[2437,17,2437,18,0],[2437,19,2437,39,0],[2437,40,2437,41,0],[2438,17,2438,18,0],[2438,19,2438,55,0],[2442,9,2442,10,0],[2442,11,2442,12,0],[2445,9,2445,10,0],[2445,11,2445,12,0],[2447,51,2447,55,0],[2447,56,2447,60,0],[2455,9,2455,36,1],[2456,9,2456,10,1],[2457,13,2457,34,1],[2458,13,2458,41,1],[2459,13,2459,44,1],[2460,13,2460,55,1],[2462,13,2462,65,1],[2463,13,2463,95,1],[2464,9,2464,10,1],[2467,9,2467,10,1],[2468,13,2468,70,1],[2471,13,2471,106,1],[2472,13,2472,41,1],[2475,21,2475,48,0],[2476,21,2476,27,0],[2478,21,2478,40,1],[2479,21,2479,27,1],[2481,21,2481,42,1],[2482,21,2482,27,1],[2484,9,2484,10,1],[2487,9,2487,10,0],[2488,13,2488,34,0],[2489,13,2489,34,0],[2490,13,2490,79,0],[2491,13,2491,59,0],[2493,13,2493,14,0],[2494,17,2495,89,0],[2496,17,2496,56,0],[2497,17,2497,75,0],[2498,17,2498,18,0],[2499,21,2499,52,0],[2501,13,2501,14,0],[2502,13,2502,33,0],[2503,13,2503,14,0],[2504,17,2504,34,0],[2505,17,2505,73,0],[2506,17,2506,69,0],[2507,17,2507,49,0],[2509,9,2509,10,0],[2512,9,2512,10,1],[2513,13,2513,34,1],[2514,13,2514,30,1],[2516,13,2516,34,1],[2517,13,2517,79,1],[2518,13,2518,59,1],[2520,13,2520,14,1],[2521,17,2522,89,1],[2523,17,2523,56,1],[2524,17,2524,75,1],[2525,17,2525,18,0],[2526,21,2526,52,0],[2529,17,2529,18,1],[2530,21,2530,41,1],[2534,21,2534,112,1],[2535,21,2535,22,0],[2536,25,2536,69,0],[2537,25,2537,51,0],[2538,25,2538,74,0],[2539,25,2541,135,0],[2542,25,2542,26,0],[2543,29,2543,110,0],[2544,29,2544,55,0],[2546,25,2550,104,0],[2551,29,2551,55,0],[2553,25,2553,26,0],[2554,29,2554,64,0],[2555,33,2555,134,0],[2556,25,2556,26,0],[2557,21,2557,22,0],[2561,21,2561,37,1],[2562,21,2562,77,1],[2563,21,2563,90,1],[2564,21,2564,67,1],[2566,21,2566,82,1],[2567,17,2567,18,1],[2568,13,2568,14,1],[2569,13,2569,33,0],[2570,13,2570,14,0],[2571,17,2571,34,0],[2572,17,2572,73,0],[2573,17,2573,69,0],[2574,17,2574,49,0],[2576,9,2576,10,1],[2579,9,2579,10,1],[2580,13,2580,36,1],[2581,13,2581,30,1],[2583,13,2583,34,1],[2584,13,2584,79,1],[2585,13,2585,59,1],[2587,13,2587,14,1],[2588,17,2588,117,1],[2589,17,2589,56,1],[2590,17,2590,75,1],[2591,17,2591,18,0],[2592,21,2592,52,0],[2595,17,2595,18,1],[2598,21,2598,112,1],[2599,21,2599,22,0],[2600,25,2600,69,0],[2601,25,2601,51,0],[2602,25,2602,67,0],[2604,25,2607,104,0],[2608,29,2608,55,0],[2609,21,2609,22,0],[2613,21,2613,107,1],[2614,21,2614,39,1],[2615,21,2615,79,1],[2616,21,2616,55,1],[2617,21,2617,67,1],[2618,17,2618,18,1],[2619,13,2619,14,1],[2620,13,2620,33,0],[2621,13,2621,14,0],[2622,17,2622,131,0],[2623,17,2623,36,0],[2624,17,2624,75,0],[2625,17,2625,62,0],[2626,17,2626,42,0],[2628,9,2628,10,1]]);
    </script>
  </body>
</html>