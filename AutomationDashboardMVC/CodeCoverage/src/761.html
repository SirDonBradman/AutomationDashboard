<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Masterworks\MasterworksRelease\.Net\Platform\Business Layer\BL\DocumentManager.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Aurigo.AMP3.Common;
using Aurigo.AMP3.DataAccess.Core;
using Aurigo.AMP3.DocumentManagementDAC;
using Aurigo.AMP3.DocumentManagementDTO;
using Aurigo.AMP3.LinksBL;
using Aurigo.AMP3.Logging;
using Aurigo.AMP3.ModuleManagementBL;
using Aurigo.AMP3.ProjectBL;
using Aurigo.AMP3.Resources.MessageResources;
using Aurigo.AMP3.Resources.TerminologyResources;
using Aurigo.AMP3.UserManagementBL;
using Aurigo.Brix.Platform.BusinessLayer.AbstractModels;
using Aurigo.Brix.Platform.BusinessLayer.BL;
using Aurigo.Brix.Platform.BusinessLayer.Controller;
using Aurigo.Brix.Platform.BusinessLayer.DataAccessHelper;
using Aurigo.Brix.Platform.BusinessLayer.DTO;
using Aurigo.Brix.Platform.BusinessLayer.Utility;
using Aurigo.Brix.Platform.BusinessLayer.XMLForm;
using Aurigo.Brix.Platform.CoreUtilities.Utility;
using Aurigo.Common;
using Aurigo.Common.Utility;
using CacheProvider;
using ICSharpCode.SharpZipLib.Core;
using ICSharpCode.SharpZipLib.Zip;
using Infragistics.WebUI.UltraWebNavigator;
using Newtonsoft.Json;
using pdftron.FDF;
using System;
using System.Collections.Generic;
using System.Configuration;
using System.Data;
using System.Data.SqlTypes;
using System.IO;
using System.Linq;
using System.Net;
using System.Net.Http;
using System.Runtime.InteropServices;
using System.Security.Permissions;
using System.Text;
using System.Text.RegularExpressions;
using System.Transactions;
using System.Web;
using System.Web.UI;
using System.Xml.Serialization;


namespace Aurigo.AMP3.DocumentManagementBL
{
    public class DocumentManager : SingletonManagerBase&lt;DocumentManager&gt;
    {
        private const string IMGPATHCATEGORY = &quot;~/Images/IcnFolder.gif&quot;;
        private const string IMGPATHCATALOG = &quot;~/Images/IcnPage.gif&quot;;
        private const string docmgmtRelPath = &quot;~/Modules/DOCMGMT/&quot;;

        Dictionary&lt;string, Type&gt; customizePageModelObjects =
            CustomizePageModel.GetModelObjects()
                .Where(x =&gt; x.Key.Equals(&quot;DocumentCustomizePageModel&quot;, StringComparison.InvariantCultureIgnoreCase))
                .ToDictionary(x =&gt; x.Key, x =&gt; x.Value);

        Dictionary&lt;string, object&gt; customizePageData = null;
        public System.Web.UI.Page AssociatedPage { get; set; }

        private string SharePointRootFolder;

        private readonly DocumentWebService docservice;

        private Dictionary&lt;int, string&gt; associationTypes;

        private List&lt;string&gt; docTypes;
        public List&lt;string&gt; DocTypes
        {
            get
            {
                if (docTypes == null)
                {
                    var client = new LeadHttpClient();
                    HttpResponseMessage response = client.GetResponse(&quot;/api/Factory/GetSupportedFileFormats&quot;);
                    if (response.StatusCode == HttpStatusCode.OK)
                        docTypes = response.Content.ReadAsAsync&lt;List&lt;string&gt;&gt;().Result;
                }
                return docTypes;
            }
        }

        public Dictionary&lt;int, string&gt; AssociationTypes
        {
            get
            {
                if (associationTypes == null)
                {
                    associationTypes = new Dictionary&lt;int, string&gt;();
                    DataSet assnTypes = GetAllAssociationTypes();
                    if (assnTypes.Tables.Count &gt; 0 &amp;&amp; assnTypes.Tables[0].Rows.Count &gt; 0)
                    {
                        foreach (DataRow r in assnTypes.Tables[0].Rows)
                        {
                            associationTypes.Add(r[&quot;AssociationTypeId&quot;].ToInt32_2(), r[&quot;AssociationType&quot;].ToString2());
                        }
                    }
                }
                return associationTypes;
            }
        }



        private DocumentManager()
        {
            docservice = new DocumentWebService();
            SharePointRootFolder = docservice.defaultSharePointDocumentFolder;
        }

        public bool IsSharePoint
        {
            get { return docservice.IsSharePoint; }
        }

        public string StoragePath
        {
            get { return docservice.docStoragePath; }
        }

        public string GetStoragePath(string CompanyCode)
        {
            return docservice.GetStoragePath(CompanyCode);
        }

        [DllImport(&quot;urlmon.dll&quot;, CharSet = CharSet.Auto)]
        private static extern int FindMimeFromData(IntPtr pBC, IntPtr pwzUrl, byte[] pBuffer, int cbSize,
            IntPtr pwzMimeProposed, int dwMimeFlags, out IntPtr ppwzMimeOut,
            int dwReserved);

        public CustomizePageModel GetCustomPageModelInstance()
        {
            CustomizePageModel cpm = null;
            foreach (KeyValuePair&lt;string, Type&gt; kvp in customizePageModelObjects)
            {
                cpm = CustomizePageModel.GetInstance(kvp.Key);
            }
            return cpm;
        }

        /// &lt;summary&gt;
        /// gets the miemtype of the doc
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;dataBytes&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;mimeProposed&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private static string MimeTypeFrom(byte[] dataBytes, string mimeProposed)
        {
            if (dataBytes == null)
                throw new ArgumentNullException(&quot;dataBytes&quot;);

            IntPtr suggestPtr = IntPtr.Zero, outPtr;
            string mimeRet = (!String.IsNullOrEmpty(mimeProposed)) ? mimeProposed : String.Empty;

            int mimeData = FindMimeFromData(IntPtr.Zero, IntPtr.Zero, dataBytes, dataBytes.Length, suggestPtr, 0,
                out outPtr, 0);

            if (mimeData == 0 &amp;&amp; (outPtr != IntPtr.Zero))
            {
                return Marshal.PtrToStringUni(outPtr);
            }
            return mimeRet;
        }

        /// &lt;summary&gt;
        /// gets the master tree control populated with the folders
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public void LoadMasterTree(UltraWebTree UltraWebTree1)
        {
            UltraWebTree1.Nodes.Clear();

            Node rootNode = CacheBroker.Get&lt;Node&gt;(RedisKeyConstants.FolderTree, regionName: AMP3ApplicationSettings.Instance.RedisRegionName);

            if (rootNode != null)
            {
                UltraWebTree1.Nodes.Add(rootNode);
            }
            else
            {
                UpdateTreeCache(UltraWebTree1);
            }

            //web tree personalization
            UltraWebTree1.CollapseAll();
            if (HttpContext.Current.Session[&quot;viewstateDocuments&quot;] != null &amp;&amp;
                HttpContext.Current.Session[&quot;viewstateDocuments&quot;].ToString2() != &quot;&quot;)
            {
                string expandnodes = HttpContext.Current.Session[&quot;viewstateDocuments&quot;].ToString2();
                Array a = expandnodes.Split(&#39;|&#39;);
                for (int i = 0; i &lt; a.Length; i++)
                {
                    if (a.GetValue(i).ToString2() != &quot;&quot;)
                    {
                        if (UltraWebTree1.Find(a.GetValue(i).ToString2()) != null)
                            UltraWebTree1.Find(a.GetValue(i).ToString2()).Expanded = true;
                    }
                }
            }
            //web tree personalization
        }

        /// &lt;summary&gt;
        /// updates the tree cache
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;UltraWebTree1&quot;&gt;&lt;/param&gt;
        public void UpdateTreeCache(UltraWebTree UltraWebTree1)
        {
            string sPath = HttpContext.Current.Request.Path;
            sPath = sPath.Remove(sPath.LastIndexOf(&quot;/&quot;, StringComparison.CurrentCultureIgnoreCase) + 1);

            //create root node for tree
            var DocRootText = LocalizationManager.GetString(&quot;Documents&quot;);
            var rootNode = new Node(DocRootText, &quot;0&quot;, sPath + &quot;Images/folder.gif&quot;, sPath + &quot;Homepage.aspx&quot;, &quot;&quot;);
            UltraWebTree1.Nodes.Add(rootNode);

            BuildMasterTree(rootNode);

            CacheBroker.Put(RedisKeyConstants.FolderTree, rootNode, timeout: TimeSpan.FromMinutes(3), regionName: AMP3ApplicationSettings.Instance.RedisRegionName);
        }

        /// &lt;summary&gt;
        /// adds the nodes(folders) of the document tree from the DB 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;node&quot;&gt;&lt;/param&gt;
        private static void BuildMasterTree(Node node)
        {
            //build child nodes for tree
            //int folderid = BrixDatatypeHelper.ToInt32_2(node.Value);
            int folderid = node.Tag.ToInt32_2();
            string sPath = HttpContext.Current.Request.Path;
            sPath = sPath.Remove(sPath.LastIndexOf(&quot;/&quot;, StringComparison.CurrentCultureIgnoreCase) + 1);

            //Dictionary&lt;int, object&gt; FolderObj = DocumentComponent.Instance.GetSubfolders(folderid);
            Dictionary&lt;int, Folder&gt; FolderObj = DocumentComponent.Instance.GetSubfolders(&quot;&quot;, &quot;0&quot;, folderid);
            foreach (var kvp in FolderObj)
            {
                var folderdtobj = (Folder)kvp.Value;
                string fpath = &quot;Documents.aspx?folid=&quot; + folderdtobj.FolderId;

                var newNode =
                    new Node(folderdtobj.FolderName.ToString2(), folderdtobj.FolderId.ToString2(),
                        sPath + &quot;Images/folder.gif&quot;, sPath + fpath, &quot;&quot;);
                node.Nodes.Add(newNode);
                BuildMasterTree(newNode);
            }
        }

        public void GetXmlForTree(int projId, int instanceId, int rid, string platform, string moduleid,
            Dictionary&lt;string, string&gt; depModules, TNode parentNode, string parentModuleID = &quot;&quot;, Dictionary&lt;string, string&gt; additionalQSValues = null)
        {
            Folder rootfolder = GetInstanceRootFolder(instanceId, moduleid);
            if (rootfolder == null)
                return;
            string fpath = string.Empty;

            fpath = &quot;~/Common/BrixListPage.aspx?context=DOCMGMT&amp;FID=&quot; + rootfolder.FolderId + &quot;&amp;PID=&quot; + projId + &quot;&amp;IID=&quot; +
                    instanceId + &quot;&amp;MID=&quot; + moduleid;

            if (additionalQSValues != null)
            {
                foreach (KeyValuePair&lt;string, string&gt; qsParam in additionalQSValues)
                {
                    fpath = string.Format(&quot;{0}&amp;{1}={2}&quot;, fpath, qsParam.Key, qsParam.Value);
                }
            }

            var DocRootText = LocalizationManager.GetString(&quot;Documents&quot;);
            var documentRootNode = new TNode(DocRootText, fpath,
                nodeType:
                    (rootfolder.PermissionFolderID == rootfolder.FolderId ? NodeType.PermissionIcon : NodeType.None), useHtmlEncoding: true);
            TNode docNode = parentNode.Nodes.Find(x =&gt; x.description == DocRootText);
            if (docNode == null)
            {
                //if (CheckForPermission(projId, rootfolder.FolderId, &quot;ViewF&quot;) &amp;&amp; CheckForPermission(projId, rootfolder.FolderId, &quot;Visibility&quot;))
                //for the folder to come in tree, only visibility permission is required
                if (CheckForPermission(projId, rootfolder.FolderId, &quot;Visibility&quot;))
                    parentNode.Nodes.Add(documentRootNode);
            }

            var documentsubRootNode = new TNode(&quot;System Folder&quot;, &quot;&quot;, useHtmlEncoding: true);
            //Put all the system document folder inside another folder
            // dont add below folder if we dont want to show system folders inside the left tree based on the component table
            List&lt;string&gt; ModuleComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);

            //Commenting below code as it adds 2 times at the end if we dont comment

            //if (!ModuleComponents.Contains(&quot;HideSystemFolderInTree&quot;))
            //    documentRootNode.Nodes.Add(documentsubRootNode);

            string depfpath = string.Format(&quot;{0}DocumentView.aspx?PID={1}&amp;parent={2}&amp;context={3}&amp;module=&quot;,
                docmgmtRelPath, projId, instanceId, string.IsNullOrEmpty(parentModuleID) ? moduleid : parentModuleID);

            DataTable dtProjectAssc = DocumentComponent.Instance.GetProjectAssociation(projId, null); //&quot;SUBMTAL&quot;

            string strModID = string.Empty;
            if (moduleid == &quot;LANDMGT&quot;)
                strModID = Constants.MODID_LANDMGT_Submittals;
            else if (moduleid == &quot;CONTMGT&quot;)
                strModID = Constants.MODID_CONTMGT_Submittals;
            else if (moduleid == &quot;ESTMATE&quot;)
                strModID = Constants.MODID_ESTMATE_Submittals;
            if (string.IsNullOrEmpty(strModID))
                strModID = Constants.MODID_PROJECT_Submittals;

            //Fetch first level Dependency modules for view-only
            if (depModules == null &amp;&amp; dtProjectAssc.Rows.Count &gt; 0)
            {
                depModules = new Dictionary&lt;string, string&gt;();
                //ModuleId, ModuleName
                foreach (DataRow dr in dtProjectAssc.Rows)
                {
                    switch (dr[&quot;ModuleId&quot;].ToString())
                    {
                        case &quot;CONTMGT&quot;:
                            break;
                        case &quot;ESTMATE&quot;:
                            break;
                        case &quot;LANDMGT&quot;:
                            break;
                        case &quot;CHKPRJL&quot;:
                            break;
                        case &quot;CHKCONL&quot;:
                            break;
                        case &quot;CHKESTL&quot;:
                            break;
                        default:
                            if (!string.IsNullOrEmpty(strModID))
                            {
                                List&lt;string&gt; permissionsForSubmittal = ModuleManager.Instance.GetPermissionByUserOrRole(strModID, UserDetail.GetCurrentUserDetail().UID, rid, projId);
                                if (permissionsForSubmittal.Contains(&quot;Visibility&quot;))
                                    depModules.Add(dr[&quot;ModuleId&quot;].ToString(), dr[&quot;ModuleName&quot;].ToString());
                            }
                            else
                                depModules.Add(dr[&quot;ModuleId&quot;].ToString(), dr[&quot;ModuleName&quot;].ToString());
                            break;
                    }
                }
            }
            if (depModules != null)
            {
                if (moduleid == &quot;CONTMGT&quot;)
                {
                    depModules.Remove(&quot;CHKCONL&quot;);
                }

                foreach (var kvp in depModules)
                    if (kvp.Key == Constants.MODID_CONTMGT_Submittals)
                        documentsubRootNode.Nodes.Add(new TNode(&quot;Submittals&quot;, depfpath + &quot;SUBMTAL&quot;,
                            nodeType: NodeType.ClosedFolder, useHtmlEncoding: true));
                    else
                        documentsubRootNode.Nodes.Add(new TNode(LocalizationManager.GetString(kvp.Value),
                            depfpath + kvp.Key, nodeType: NodeType.ClosedFolder, useHtmlEncoding: true));
                //Put all the system document folder inside another folder      
            }
            // dont add below folder if we dont want to show system folders inside the left tree based on the component table
            ModuleComponents = ModuleManager.Instance.GetModuleComponenets(Constants.MODID_CORE);
            if (!ModuleComponents.Contains(&quot;HideSystemFolderInTree&quot;) &amp;&amp; documentsubRootNode.Nodes.Count &gt; 0)
                documentRootNode.Nodes.Add(documentsubRootNode);
            //--------
            BuildFolderTree(documentRootNode, rootfolder.FolderId, projId, instanceId, moduleid, additionalQSParams: additionalQSValues);
        }

        public void BuildFolderTree(TNode parentNode, int folderid, int parentId, int instanceId, string moduleid, string parentKey = &quot;PID&quot;, Dictionary&lt;string, string&gt; additionalQSParams = null)
        {
            Dictionary&lt;int, Folder&gt; folders = DocumentComponent.Instance.GetSubfolders(moduleid, instanceId.ToString(), folderid);
            foreach (var kvp in folders)
            {
                Folder folder = kvp.Value;
                if (!folder.ParentInstanceId.HasValue &amp;&amp; string.IsNullOrEmpty(folder.ParentModuleId))
                {
                    //if (CheckForPermission(parentId, folder.FolderId, &quot;ViewF&quot;) &amp;&amp; CheckForPermission(parentId, folder.FolderId, &quot;Visibility&quot;))
                    //for the folder to come in tree, only visibility permission is required
                    if (CheckForPermission(parentId, folder.FolderId, &quot;Visibility&quot;))
                    {
                        //Folder icon should be displayed if there are no sub folders
                        if (parentNode.NodeType != NodeType.PermissionIcon &amp;&amp; parentNode.NodeType != NodeType.ArchiveFolder)
                            if (folders.Count &lt;= 0)
                                parentNode.NodeType = NodeType.ClosedFolder;
                            else if (folders.Count &gt; 0)
                                parentNode.NodeType = NodeType.None;

                        NodeType folderNodeType = folder.PermissionFolderID == folder.FolderId ? NodeType.PermissionIcon : NodeType.ClosedFolder;

                        if (folder.FolderType == FolderType.ArchiveFolder)
                            folderNodeType = NodeType.ArchiveFolder;

                        string folderPath = &quot;~/Common/BrixListPage.aspx?context=DOCMGMT&amp;FID={0}&amp;{4}={1}&amp;IID={2}&amp;MID={3}&quot;.Format2(folder.FolderId, parentId, instanceId, moduleid, parentKey);

                        if (additionalQSParams != null)
                        {
                            foreach (KeyValuePair&lt;string, string&gt; qsParam in additionalQSParams)
                            {
                                folderPath = string.Format(&quot;{0}&amp;{1}={2}&quot;, folderPath, qsParam.Key, qsParam.Value);
                            }
                        }

                        TNode childNode = new TNode(folder.FolderName, folderPath, nodeType: folderNodeType, useHtmlEncoding: true);


                        parentNode.Nodes.Add(childNode);
                        BuildFolderTree(childNode, folder.FolderId, parentId, instanceId, moduleid, parentKey, additionalQSParams);
                    }
                }
            }
        }

        /// &lt;summary&gt;
        /// gets the document DTO collection from the DAC for the folder
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;FolderId&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;Dictionary&lt;int, object&gt;&lt;/returns&gt;
        public List&lt;Document&gt; GetFolderDocuments(int FolderId)
        {
            return DocumentComponent.Instance.GetFolderDocuments(FolderId);
        }

        public DataTable GetDocumentsByFolder(int FolderId)
        {
            return DocumentComponent.Instance.GetDocumentsByFolder(FolderId);
        }

        /// &lt;summary&gt;
        /// gets the document DTO collection from the DAC for a module
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;ModuleID&quot;&gt;ModuleID&lt;/param&gt;
        /// &lt;param name=&quot;qryInstanceIDs&quot;&gt;Query that returns module instance IDs&lt;/param&gt;
        /// &lt;returns&gt;Dictionary&lt;int, object&gt;&lt;/returns&gt;
        public DataTable GetModuleDocuments(string ModuleID, string qryInstanceIDs)
        {
            return DocumentComponent.Instance.GetModuleDocuments(ModuleID, qryInstanceIDs);
        }

        /// &lt;summary&gt;
        /// adds a subfolder by calling the DAC method
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;folderid&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;int&lt;/returns&gt;
        public Dictionary&lt;int, Folder&gt; GetSubfolders(string ModuleId, string InstanceId, int FolderId)
        {
            return DocumentComponent.Instance.GetSubfolders(ModuleId, InstanceId, FolderId);
        }

        public string GetFullFolderName(int FolderId)
        {
            return GetFullFolderName(GetFolderDetails(FolderId));
        }

        public string GetFullFolderName(Folder FolderDTO)
        {
            if (FolderDTO != null &amp;&amp; !string.IsNullOrEmpty(FolderDTO.ListPath))
                return FolderDTO.ListPath;
            return SharePointRootFolder;
        }

        /// &lt;summary&gt;
        /// adds a subfolder by calling the DAC method
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;FolderDTO&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;int&lt;/returns&gt;
        public int AddFolder(Folder FolderDTO)
        {
            try
            {
                if (IsSharePoint &amp;&amp; FolderDTO.CreateSharePointFolder)
                    docservice.CreateFolder(FolderDTO);
                return DocumentComponent.Instance.AddFolder(FolderDTO);
            }
            catch
            {
                return -1;
            }
        }

        /// &lt;summary&gt;
        /// gets the fodler name of the selected folder from tree
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;folderid&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;string foldername&lt;/returns&gt;
        public string GetFolderName(int folderid, bool getDisplayName = false)
        {
            return DocumentComponent.Instance.GetFolderName(folderid, getDisplayName);
        }

        /// &lt;summary&gt;
        ///  Gets the full folder path from root folder by giving folderid
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;folderid&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;getDisplayName&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public string GetFullFolderPath(int folderid)
        {
            return DocumentComponent.Instance.GetFullFolderPath(folderid);
        }

        /// &lt;summary&gt;
        /// gets the parent folder name of the selected folder from tree
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;folderid&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;string foldername&lt;/returns&gt;
        internal string GetParentFolderName(int folderid)
        {
            return DocumentComponent.Instance.GetParentFolderName(folderid);
        }

        /// &lt;summary&gt;
        /// gets the fodler details
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;folderid&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;folder dto obj&lt;/returns&gt;
        public Folder GetFolderDetails(int folderid)
        {
            return DocumentComponent.Instance.GetFolderDetails(folderid);
        }

        /// &lt;summary&gt;
        /// Returns the top one folder detail based on input param (use it only for hidden folder, unused module id)
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;folderName&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;moduleId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;instanceId&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public Folder GetFolderDetails(string folderName, string moduleId, string instanceId)
        {
            return DocumentComponent.Instance.GetFolderDetails(folderName, moduleId, instanceId);
        }

        /// &lt;summary&gt;
        /// updates the folder details
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;FolderDTO&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;int&lt;/returns&gt;
        public int ModifyFolder(Folder FolderDTO)
        {
            ModifyandSubFolderPointFolder(FolderDTO);
            return FolderDTO.FolderId;
        }

        public int ModifyFolder_ReturnStatus(Folder FolderDTO)
        {
            return ModifyandSubFolderPointFolder(FolderDTO);
        }

        public int ModifyandSubFolderPointFolder(Folder folder)
        {
            if (IsSharePoint)
                docservice.ModifyFolder(folder);
            int status = DocumentComponent.Instance.ModifyFolder(folder);

            if (status == 0) return status;

            Dictionary&lt;int, Folder&gt; subfolders = GetSubfolders(folder.ModuleId, folder.InstanceId, folder.FolderId);
            foreach (Folder subfolder in subfolders.Values)
                ModifyandSubFolderPointFolder(subfolder);

            return status;
        }

        /// &lt;summary&gt;
        /// deletes selected folder document
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;folderID&quot;&gt;&lt;/param&gt;
        /// &lt;returns name=&quot;int&quot;&gt;&lt;/returns&gt;
        public int DeleteFolderDocuments(int folderID)
        {
            try
            {
                if (!IsSharePoint)
                {
                    Dictionary&lt;int, string&gt; dictColl = DocumentComponent.Instance.GetStorageIDs(folderID);
                    //delete document from file repository
                    foreach (KeyValuePair&lt;int, string&gt; kvp in dictColl)
                        docservice.DeleteDocument(kvp.Value.ToString2());
                }
                return DocumentComponent.Instance.DeleteFolderDocuments(folderID);
            }
            catch (Exception ex)
            {
                Logger.Log(Enumerations.LogType.Error, ex.Message, Constants.MODID_DOCMGMT);
                throw new Exception(&quot;DeleteFolderDocuments = &quot; + ex, ex);
            }
        }

        /// &lt;summary&gt;
        /// checks whether fodler contains docs/subfolders
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;ids&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;int&lt;/returns&gt;
        public int CheckDocumentStatus(string ids)
        {
            return DocumentComponent.Instance.CheckDocumentStatus(ids);
        }

        /// &lt;summary&gt;
        /// checks whether document name already exists
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;docname&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;folderid&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        internal int CheckDocumentName(string docname, int folderid)
        {
            return DocumentComponent.Instance.CheckDocumentName(docname, folderid);
        }

        /// &lt;summary&gt;
        /// deletes selected folder&#39;s subfolders
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;folderId&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;int status&lt;/returns&gt;
        internal int DeleteSubfolders(int folderId)
        {
            return DocumentComponent.Instance.DeleteSubfolders(folderId);
        }

        /// &lt;summary&gt;
        /// deletes selected folder from DB
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;folderID&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;int status&lt;/returns&gt;
        public int DeleteFolder(Folder folder)
        {
            if (IsSharePoint)
                docservice.DeleteFolder(folder);
            return DocumentComponent.Instance.DeleteFolder(folder.FolderId);
        }

        public string GetFileName(string storageID)
        {
            return DocumentComponent.Instance.GetDocumentDetails(storageID).DocName;
        }

        /// &lt;summary&gt;
        /// opens the doc for viewing 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;storageID&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;byte array &lt;/returns&gt;
        public byte[] ViewDocument(string storageID)
        {
            Document doc = DocumentComponent.Instance.GetDocumentDetails(storageID);
            return docservice.OpenDocument(doc.FolderDetails, storageID, doc.DocName);
        }

        public WebResponse DownloadDocumentFromSharepoint(string storageId)
        {
            Document doc = DocumentComponent.Instance.GetDocumentDetails(storageId);
            return docservice.GetSharePointStream(doc.FolderDetails, storageId, doc.DocName, doc.SPName);
        }

        /// &lt;summary&gt;
        /// gets the mime type of the document selected
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;typeid&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;string&lt;/returns&gt;
        public string GetMIMEType(int typeid, string company = null)
        {
            return DocumentComponent.Instance.GetMIMEType(typeid, company);
        }

        public void CopyMetaDataFromSourceToDest(int sourceDocID, int destDocID, BrixFormModel model)
        {
            //Get all display fields and evaluate and pass their values

            if (model != null)
            {
                DataSet dsMD =
                    ComponentHelper.Instance.ExecuteDataSet(
                        DocumentStoredProcedure.usp_DOCMGMTGetDocumentMetaDataDetails, null, model.form.TableName,
                        sourceDocID.ToString());

                ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                    DocumentStoredProcedure.usp_DOCMGMTDeleteMetaData, null, model.form.TableName, destDocID.ToString());

                if (dsMD.Tables.Count &gt; 0 &amp;&amp; dsMD.Tables[0].Rows.Count &gt; 0)
                {
                    DataTable dtMetadata = dsMD.Tables[0];
                    StringBuilder docMetadataQuery = new StringBuilder();
                    StringBuilder docMetadataValQuery = new StringBuilder();
                    docMetadataQuery.Append(&quot;Insert into  &quot; + model.form.TableName + &quot;(&quot;);
                    docMetadataValQuery.Append(&quot; Values (&quot;);

                    foreach (DataRow row in dtMetadata.Rows)
                    {
                        foreach (DataColumn col in dtMetadata.Columns)
                        {
                            xControl xc = model.form.GetControl(col.ColumnName);
                            if (col.ColumnName == &quot;DocId&quot;)
                            {
                                docMetadataQuery.Append(col.ColumnName + &quot;,&quot;);
                                docMetadataValQuery.Append(&quot;&#39;&quot; + destDocID + &quot;&#39;,&quot;);
                            }
                            else if (xc != null &amp;&amp; (xc.Type == ControlType.Display || xc.ReEvaluate))
                            {
                                xc.Value = xc.Value.Replace(&quot;{_Form:instanceID}&quot;, destDocID.ToString());

                                docMetadataQuery.Append(col.ColumnName + &quot;,&quot;);
                                string val = xc.EvaluateControlValue();
                                val = xc.CheckForDateAndSetFormat(xc, val);

                                if (!string.IsNullOrEmpty(xc.DBType) &amp;&amp;
                                    (xc.DBType.ToLower() == &quot;int&quot; || xc.DBType.ToLower().StartsWith(&quot;numeric&quot;)) &amp;&amp;
                                    string.IsNullOrEmpty(val))
                                    docMetadataValQuery.Append(&quot;NULL,&quot;);
                                else
                                    docMetadataValQuery.Append(&quot;&#39;&quot; + val + &quot;&#39;,&quot;);
                            }
                            else
                            {
                                docMetadataQuery.Append(col.ColumnName + &quot;,&quot;);
                                string val = row[col.ColumnName] == null ? &quot;&quot; : row[col.ColumnName].ToString();
                                if (xc != null)
                                    val = xc.CheckForDateAndSetFormat(xc, val);

                                if (!string.IsNullOrEmpty(xc.DBType) &amp;&amp;
                                    (xc.DBType.ToLower() == &quot;int&quot; || xc.DBType.ToLower().StartsWith(&quot;numeric&quot;) ||
                                     xc.DBType.ToLower().Contains(&quot;date&quot;)) &amp;&amp; string.IsNullOrEmpty(val))
                                    docMetadataValQuery.Append(&quot;NULL,&quot;);
                                else
                                    docMetadataValQuery.Append(&quot;&#39;&quot; + val + &quot;&#39;,&quot;);
                            }
                        }
                    }

                    docMetadataQuery =
                        new StringBuilder(docMetadataQuery.ToString().Substring(0, docMetadataQuery.Length - 1));
                    docMetadataValQuery =
                        new StringBuilder(docMetadataValQuery.ToString().Substring(0, docMetadataValQuery.Length - 1));

                    if (docMetadataQuery.ToString2() != &quot;&quot;)
                    {
                        Dictionary&lt;string, object&gt; dic = null;
                        docMetadataQuery.Append(&quot;)&quot;);
                        docMetadataValQuery.Append(&quot;)&quot;);
                        docMetadataQuery.Append(docMetadataValQuery.ToString());
                        ComponentHelper.Instance.ExecuteNonQuery(docMetadataQuery.ToString2(), dic);
                    }
                }
            }
        }

        public void CopyDocuments(int sourceFolderID, int destFolderID, int instanceId, string moduleId, Document doc,
            string PID, BrixFormModel model, ref bool docExists, ref string DocDetails, ref bool status)
        {
            int docid = 0;

            Dictionary&lt;string, string&gt; additionalParams = null;
            var MetadataTableName = &quot;&quot;;

            if (model != null)
            {
                MetadataTableName = model.form.TableName;
            }
            if (!string.IsNullOrEmpty(MetadataTableName))
            {
                additionalParams = new Dictionary&lt;string, string&gt;();
                //Temporary fix to create a dictionay with metadata Col name and vals
                DataSet dsMD =
                    ComponentHelper.Instance.ExecuteDataSet(
                        DocumentStoredProcedure.usp_DOCMGMTGetDocumentMetaDataDetails, null, MetadataTableName,
                        doc.DocId.ToString());
                if (dsMD.Tables.Count &gt; 0)
                {
                    DataTable dtMetadata = dsMD.Tables[0];
                    dtMetadata.TableName = &quot;Properties&quot;;
                }
                if (dsMD.Tables.Count &gt; 0)
                {
                    foreach (DataColumn col in dsMD.Tables[0].Columns)
                    {
                        if (col.ColumnName != &quot;DocId&quot;)
                        {
                            additionalParams.Add(col.ColumnName, dsMD.Tables[0].Rows[0][col.ColumnName].ToString());
                        }
                    }
                }
            }

            CustomizePageModel cpm = GetCustomPageModelInstance();
            int returnValue = 0;
            if (cpm != null)
            {
                additionalParams.Add(&quot;DocName&quot;, doc.DocName);
                additionalParams.Add(&quot;FolderID&quot;, destFolderID.ToString());
                additionalParams.Add(&quot;MID&quot;, moduleId);
                additionalParams.Add(&quot;IID&quot;, instanceId.ToString());
                customizePageData = cpm.GetData(null, mode: &quot;CheckExistingDocument&quot;,
                    callerContext: &quot;DocumentCustomizePageModel&quot;, additionalParameters: additionalParams);
                returnValue = customizePageData[&quot;Result&quot;].ToInt32_2();
                if (returnValue == -1)
                {
                    docExists = true;
                    DocDetails += (DocDetails != &quot;&quot; ? &quot;,&quot; + doc.DocId.ToString() : doc.DocId.ToString());
                    status = false;
                }
            }
            if (returnValue == 0)
            {
                if (cpm != null &amp;&amp; doc.StorageId == &quot;&quot;)
                {
                    //call customized function if its is a placeholder
                    Dictionary&lt;string, object&gt; additionalParameters = new Dictionary&lt;string, object&gt;();
                    additionalParameters.Add(&quot;ProjectID&quot;, PID.ToString2());
                    additionalParameters.Add(&quot;Document&quot;, doc);
                    additionalParameters.Add(&quot;FolderId&quot;, destFolderID);
                    customizePageData = cpm.GetData(null, mode: &quot;CopyPlaceHolder&quot;,
                        callerContext: &quot;DocumentCustomizePageModel&quot;, additionalParameters: additionalParameters);
                    returnValue = customizePageData[&quot;Result&quot;].ToInt32_2();
                    if (returnValue == -1)
                    {
                        docExists = true;
                        DocDetails += (DocDetails != &quot;&quot; ? &quot;,&quot; + doc.DocId.ToString() : doc.DocId.ToString());
                        status = false;
                    }
                    else
                    {
                        docid = returnValue;
                    }
                }
                else
                {
                    Stream stream = GetStream(doc.StorageId);
                    byte[] fileBytes;
                    using (var memoryStream = new MemoryStream())
                    {
                        stream.CopyTo(memoryStream);
                        fileBytes = memoryStream.ToArray();
                    }

                    var ud = UserDetail.GetCurrentUserDetail();
                    docid = SaveAndAutoSuperSeed(doc, destFolderID, fileBytes, ud.UID, ud.UserName, moduleId,
                        instanceId.ToString(), PID, additionalParams);

                    List&lt;string&gt; CheckComponents =
                        Aurigo.AMP3.ModuleManagementBL.ModuleManager.Instance.GetModuleComponenets(
                            Constants.MODID_DOCMGMT);
                    string action = doc.DocumentOperationType == &quot;C&quot; ? &quot;Copy&quot; : &quot;Transmit&quot;;
                    if (CheckComponents.Contains(&quot;LogActivities&quot;))
                    {
                        string dfname =
                            HttpUtility.HtmlEncode(DocumentManager.Instance.GetFolderName(destFolderID.ToInt32_2(),
                                getDisplayName: true));
                        string sfname =
                            HttpUtility.HtmlEncode(DocumentManager.Instance.GetFolderName(sourceFolderID.ToInt32_2(),
                                getDisplayName: true));
                        string message = &quot;&quot;;
                        string activity = &quot;&quot;;

                        if (action == &quot;Copy&quot;)
                        {
                            message = string.Format(&quot;Copied document {0} from folder {1} to folder {2}&quot;,
                                doc.DocName + &quot;.&quot; + doc.DocType, dfname, sfname);
                            activity = &quot;Copied Document&quot;;
                        }
                        else
                        {
                            message = string.Format(&quot;Transmitted document {0} from folder {1} to folder {2}&quot;,
                                doc.DocName + &quot;.&quot; + doc.DocType, dfname, sfname);
                            activity = &quot;Transmitted Document&quot;;
                        }

                        Dictionary&lt;string, object&gt; additionalParam = new Dictionary&lt;string, object&gt;();
                        additionalParam.Add(&quot;FolderId&quot;, sourceFolderID.ToString());
                        additionalParam.Add(&quot;DestFolderId&quot;, destFolderID.ToString());
                        Dictionary&lt;string, object&gt; resultObject = DocumentManager.Instance.GetLogMessage(doc.DocId,
                            action, additionalParam);
                        if (resultObject.ContainsKey(&quot;message&quot;) &amp;&amp; resultObject.ContainsKey(&quot;activity&quot;))
                        {
                            message = HttpUtility.HtmlEncode(resultObject[&quot;message&quot;].ToString());
                            activity = resultObject[&quot;activity&quot;].ToString();
                        }

                        DocumentManager.Instance.UpdateActivityLog(&quot;Document&quot;, docid,
                            String.Format(
                                &quot;&lt;ACTION&gt;{0}&lt;/ACTION&gt; &lt;DOCNAME&gt; &lt;![CDATA[{1}]]&gt; &lt;/DOCNAME&gt; &lt;FOLDER&gt;  {2} &lt;/FOLDER&gt; &lt;FOLDERID&gt;  {3} &lt;/FOLDERID&gt;&lt;PROJECTID&gt;{4} &lt;/PROJECTID&gt;&quot;,
                                activity, doc.DocName, dfname, destFolderID, HttpContext.Current.Request[&quot;PID&quot;]),
                            message, UserDetail.GetCurrentUserDetail().UID);
                    }
                }
            }
            //copy metadata only if the metadatatable name exist as it will throw error without the table name
            if (model != null &amp;&amp; docid &gt; 0)
            {
                CopyMetaDataFromSourceToDest(doc.DocId, docid, model);
            }
        }

        private int SaveAndAutoSuperSeed(Document sourceDoc, int FID, byte[] fileBytes, int UID, string UName,
            string MID, string IID, string PID, Dictionary&lt;string, string&gt; additionalParams)
        {
            string filename = sourceDoc.DocName;
            string storageid = string.Empty;

            if (additionalParams != null)
            {
                additionalParams.Add(&quot;Operation&quot;, &quot;Copy&quot;);
            }
            int result = DocumentManager.Instance.SaveDocument(FID, filename, fileBytes, UID.ToInt32_2(), UName,
                DateTime.UtcNow, string.Empty, MID, false, IID, MID, additionalParams);
            if (result &gt; 0)
            {
                LinksManager.Instance.AddLinks(filename, IID, MID, result.ToString(), &quot;DOCMGMT&quot;,
                    UName, null, string.Empty, FID.ToInt32_2(), null, sourceDoc.DocumentOperationType,
                    sourceDoc.DocId.ToString2());

                List&lt;string&gt; CheckComponents =
                    Aurigo.AMP3.ModuleManagementBL.ModuleManager.Instance.GetModuleComponenets(Constants.MODID_DOCMGMT);
            }
            else if (result == -1)
            {
                try
                {
                    DataTable dt = DocumentManager.Instance.GetDocumentList(FID, UserDetail.GetCurrentUserDetail().UID, filename);

                    string docId = string.Empty;
                    if (dt != null &amp;&amp; dt.Rows.Count &gt; 0)
                    {
                        storageid = dt.Rows[0][&quot;StorageId&quot;].ToString2();
                        docId = dt.Rows[0][&quot;DocId&quot;].ToString2();
                    }

                    bool result1 = DocumentManager.Instance.CheckOut(FID.ToInt32_2(), storageid, UID.ToInt32_2());
                    if (result1)
                    {
                        result1 = DocumentManager.Instance.CheckIn(FID.ToInt32_2(), storageid, string.Empty, filename,
                            fileBytes, UID.ToInt32_2(), UName, PID.ToInt32_2());
                    }
                    else
                    {
                        Document doc = DocumentManager.Instance.GetDocumentDetails(storageid);

                        if (doc.CheckedBy == UID.ToInt32_2())
                        {
                            result1 = DocumentManager.Instance.CheckIn(FID.ToInt32_2(), storageid, string.Empty,
                                filename, fileBytes, UID.ToInt32_2(), UName, PID.ToInt32_2());
                        }
                        else
                        {
                            Aurigo.AMP3.UserManagementDTO.User userDTO = UserManager.Instance.GetUserDTO(doc.CheckedBy);
                            throw new Exception(&quot;Request denied. The file \\\&quot;&quot; + filename +
                                                &quot;\\\&quot; already exists and is checked out to &quot; + userDTO.FirstName + &quot; &quot; +
                                                userDTO.LastName + &quot;.&quot;);
                        }
                    }

                    result = docId.ToInt32_2();
                }
                catch
                {
                    Document doc = DocumentManager.Instance.GetDocumentDetails(storageid);
                    Aurigo.AMP3.UserManagementDTO.User userDTO = UserManager.Instance.GetUserDTO(doc.CheckedBy);
                    throw new Exception(&quot;Request denied. The file \\\&quot;&quot; + filename +
                                        &quot;\\\&quot; already exists and is checked out to &quot; + userDTO.FirstName + &quot; &quot; +
                                        userDTO.LastName + &quot;.&quot;);
                }
            }
            else if (result == -3)
            {
                throw new Exception(&quot;One or more Document(s) are already Exists in the projects. Request denied.&quot;);
            }
            return result;
        }

        public void MergeDocuments(int sourceFolderID, int destFolderID, int instanceId, string moduleId, int PID,
            Document destinationDoc, Document sourceDoc, BrixFormModel model)
        {
            //string docId = string.Empty;
            //string storageId = &quot;&quot;;

            try
            {
                byte[] fileBytes;
                var UID = 0;
                var UName = &quot;&quot;;
                UserDetail ud = UserDetail.GetCurrentUserDetail();
                UID = (ud != null) ? ud.UID : sourceDoc.UpdatedBy;
                UName = (ud != null)
                    ? (ud.FirstName + (string.IsNullOrEmpty(ud.MiddleName) ? &quot;&quot; : &quot; &quot; + ud.MiddleName) +
                       (string.IsNullOrEmpty(ud.LastName) ? &quot;&quot; : &quot; &quot; + ud.LastName)) + &quot;(&quot; + ud.UserName + &quot;)&quot;
                    : string.Empty;

                Stream docstream = GetStream(sourceDoc.StorageId);

                using (var memoryStream = new MemoryStream())
                {
                    docstream.CopyTo(memoryStream);
                    fileBytes = memoryStream.ToArray();
                }

                if (string.IsNullOrEmpty(destinationDoc.StorageId))
                {
                    string[] storageIds = docservice.SaveDocument(GetFolderDetails(destFolderID), destinationDoc.DocName,
                        fileBytes, false, null);
                    SaveDocumentContent(storageIds[0], destinationDoc.DocName, Path.GetExtension(destinationDoc.DocName),
                        fileBytes, destinationDoc.DocDesc);
                    destinationDoc.StorageId = storageIds[0];
                    destinationDoc.SPName = storageIds[1];
                    destinationDoc.DocSize = Math.Round(docstream.Length.ToDecimal2() / 1024, 2).ToString2() + &quot;KB&quot;;
                }
                else if (!string.IsNullOrEmpty(destinationDoc.StorageId))
                {
                    bool result = DocumentManager.Instance.CheckOut(destFolderID.ToInt32_2(), destinationDoc.StorageId,
                        UID.ToInt32_2());
                    if (result)
                    {
                        result = DocumentManager.Instance.CheckIn(destFolderID.ToInt32_2(), destinationDoc.StorageId,
                            string.Empty, destinationDoc.DocName, fileBytes, UID.ToInt32_2(), UName, PID.ToInt32_2());
                        destinationDoc.DocSize = Math.Round(docstream.Length.ToDecimal2() / 1024, 2).ToString2() + &quot;KB&quot;;
                    }
                    else
                    {
                        if (destinationDoc.CheckedBy == UID.ToInt32_2())
                        {
                            result = DocumentManager.Instance.CheckIn(destFolderID.ToInt32_2(), destinationDoc.StorageId,
                                string.Empty, destinationDoc.DocName, fileBytes, UID.ToInt32_2(), UName, PID.ToInt32_2());
                            destinationDoc.DocSize = Math.Round(docstream.Length.ToDecimal2() / 1024, 2).ToString2() +
                                                     &quot;KB&quot;;
                        }
                        else
                        {
                            Aurigo.AMP3.UserManagementDTO.User userDTO =
                                UserManager.Instance.GetUserDTO(destinationDoc.CheckedBy);
                            throw new Exception(&quot;Request denied. The file \\\&quot;&quot; +
                                                Path.GetFileName(destinationDoc.DocName) +
                                                &quot;\\\&quot; already exists and is checked out to &quot; + userDTO.FirstName + &quot; &quot; +
                                                userDTO.LastName + &quot;.&quot;);
                        }
                    }
                }

                //Update DestinationDocument Details 
                destinationDoc.DisplayDocName = sourceDoc.DisplayDocName;
                destinationDoc.DocDesc = sourceDoc.DocDesc;
                destinationDoc.DocName = sourceDoc.DocName;
                destinationDoc.DocType = sourceDoc.DocType;
                destinationDoc.DocTypeDesc = sourceDoc.DocTypeDesc;
                destinationDoc.VersionNo += 1;
                destinationDoc.UpdationDate = MWDateTimeHelper.UtcNow;
                destinationDoc.UpdatedBy = (ud != null) ? ud.UID : sourceDoc.UpdatedBy;
                destinationDoc.DocumentOperationType = &quot;MR&quot;;
                DocumentComponent.Instance.UpdateDocument(destinationDoc, destinationDoc.DocumentOperationType);

                //Copy metadata 
                //TODO: This should be moved to customization code using Customized page model.
                if (model != null)
                {
                    CopyMetaDataFromSourceToDest(sourceDoc.DocId, destinationDoc.DocId, model);
                }
            }
            catch (Exception ex)
            {
                Document doc = DocumentManager.Instance.GetDocumentDetails(destinationDoc.StorageId);
                Aurigo.AMP3.UserManagementDTO.User userDTO = UserManager.Instance.GetUserDTO(doc.CheckedBy);
                throw new Exception(ex.Message);
            }
        }

        public Dictionary&lt;string, object&gt; GetLogMessage(int docId, string action,
            Dictionary&lt;string, object&gt; additionalParam = null)
        {
            Dictionary&lt;string, object&gt; resultObject = new Dictionary&lt;string, object&gt;();

            foreach (KeyValuePair&lt;string, Type&gt; kvp in customizePageModelObjects)
            {
                CustomizePageModel cpm = CustomizePageModel.GetInstance(kvp.Key);
                if (cpm != null)
                {
                    Dictionary&lt;string, object&gt; cpmRequest = additionalParam;
                    cpmRequest.Add(&quot;DocId&quot;, docId);
                    cpmRequest.Add(&quot;Action&quot;, action);
                    customizePageData = cpm.GetData(null, mode: &quot;GetLogMessage&quot;,
                        callerContext: &quot;DocumentCustomizePageModel&quot;, additionalParameters: cpmRequest);
                    resultObject = (Dictionary&lt;string, object&gt;)customizePageData[&quot;Result&quot;];
                }
            }

            return resultObject;
        }

        public Dictionary&lt;string, object&gt; GetLogMessageForFolder(int FolderId, string action,
            Dictionary&lt;string, object&gt; additionalParam = null)
        {
            Dictionary&lt;string, object&gt; resultObject = new Dictionary&lt;string, object&gt;();

            foreach (KeyValuePair&lt;string, Type&gt; kvp in customizePageModelObjects)
            {
                CustomizePageModel cpm = CustomizePageModel.GetInstance(kvp.Key);
                if (cpm != null)
                {
                    Dictionary&lt;string, object&gt; cpmRequest = additionalParam;
                    cpmRequest.Add(&quot;FolderId&quot;, FolderId);
                    cpmRequest.Add(&quot;Action&quot;, action);
                    customizePageData = cpm.GetData(null, mode: &quot;GetLogMessageForFolder&quot;,
                        callerContext: &quot;DocumentCustomizePageModel&quot;, additionalParameters: cpmRequest);
                    resultObject = (Dictionary&lt;string, object&gt;)customizePageData[&quot;Result&quot;];
                }
            }

            return resultObject;
        }

        public bool ValidateDocumentForMerge(Document sourceDocument, Document destinationDocument)
        {
            foreach (KeyValuePair&lt;string, Type&gt; kvp in customizePageModelObjects)
            {
                CustomizePageModel cpm = CustomizePageModel.GetInstance(kvp.Key);
                if (cpm != null)
                {
                    Dictionary&lt;string, object&gt; cpmRequest = new Dictionary&lt;string, object&gt;();
                    cpmRequest.Add(&quot;SourceDocument&quot;, sourceDocument);
                    cpmRequest.Add(&quot;DestinationDocument&quot;, destinationDocument);
                    cpm.GetData(null, mode: &quot;ValidateDocumentForMerge&quot;, callerContext: &quot;DocumentCustomizePageModel&quot;,
                        additionalParameters: cpmRequest);
                }
            }
            return true;
        }

        /// &lt;summary&gt;
        /// adds the document to the DB and the to file repository
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;folderID&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;filePath&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;fileBytes&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;author&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;authorName&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;creationDateInUtc&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;description&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        [EnvironmentPermission(SecurityAction.Demand, Unrestricted = true)]
        public int SaveDocument(int FolderId, string filePath, byte[] fileBytes, int author, string authorName,
            DateTime creationDateInUtc, string description, string srcModuleID = null, bool isTemplete = false,
            string instanceID = null, string srcModuleCode = null, Dictionary&lt;string, string&gt; additionalParam = null, DocumentType documentType = DocumentType.Document)
        {
            if (AMP3ApplicationSettings.Instance.IsFileTypeBlocked(Path.GetExtension(filePath).TrimStart(&#39;.&#39;)))
            {
                throw new Exception(&quot;The file \\\&quot;&quot; + Path.GetFileName(filePath) + &quot;\\\&quot; cannot be uploaded. File type is not supported.&quot;);
            }
            int typeid;

            //get the filename from filepath
            int indx = filePath.LastIndexOf(&quot;\\&quot;, StringComparison.CurrentCultureIgnoreCase);
            string filename = filePath.Substring(indx + 1, filePath.Length - (indx + 1));

            string jpgtype =
                filename.Substring(filename.IndexOf(&quot;.&quot;, StringComparison.OrdinalIgnoreCase) + 1,
                    filename.Length - (filename.IndexOf(&quot;.&quot;, StringComparison.OrdinalIgnoreCase) + 1)).
                    ToLower2();
            if ((jpgtype == &quot;jpg&quot;) || (jpgtype == &quot;jpeg&quot;))
                typeid = 6;
            else
            {
                //get the typeid from mimetype
                string mimeType = MimeTypeFrom(fileBytes, &quot;&quot;);
                typeid = DocumentComponent.Instance.GetTypeId(mimeType);
            }

            //string path = GetFullFolderName(FolderId);
            //call webservice to add the doc to file repository
            string[] storageid = docservice.SaveDocument(GetFolderDetails(FolderId), filename, fileBytes, false, null);

            if (String.IsNullOrEmpty(storageid[0]))
                return 0;

            //add the document to document content table
            if (AMP3ApplicationSettings.Instance.appSettings.ContainsKey(&quot;DocumentReadWriteLocation&quot;) &amp;&amp;
                AMP3ApplicationSettings.Instance.appSettings[&quot;DocumentReadWriteLocation&quot;].ToString() != &quot;FILESYSTEM&quot;)
                DocumentComponent.Instance.SaveDocumentContent(storageid[0], filename, Path.GetExtension(filename), fileBytes, description);

            //create DTO and add to DB
            var docdto = new Document();
            docdto.DocName = filename;
            docdto.DocSize = Math.Round(fileBytes.Length.ToDecimal2() / 1024, 2).ToString2() + &quot;KB&quot;;
            docdto.DocType = typeid;
            docdto.ParentId = 0;
            docdto.VersionNo = 1;
            docdto.FolderId = FolderId;
            docdto.Status = false;
            docdto.StorageId = storageid[0];
            docdto.XMLInfo = &quot;&lt;XMLInfo&gt;&lt;/XMLInfo&gt;&quot;;
            docdto.DocDesc = description;
            docdto.CreationDate = creationDateInUtc;
            docdto.Author = author;
            docdto.AuthorName = authorName;
            docdto.CheckedBy = 0;
            docdto.SrcModuleID = srcModuleID;
            docdto.SPName = storageid[1];
            docdto.IsTemplate = isTemplete;
            docdto.SrcModuleCode = srcModuleCode;
            docdto.SrcID = instanceID;
            docdto.DocumentType = documentType;

            int returnValue = 0;
            //The below piece make a call to customer code and get the operation done as defined in customized model.
            bool handled = false;
            foreach (KeyValuePair&lt;string, Type&gt; kvp in customizePageModelObjects)
            {
                CustomizePageModel cpm = CustomizePageModel.GetInstance(kvp.Key);
                if (cpm != null)
                {
                    handled = true;
                    Dictionary&lt;string, object&gt; cpmRequest = new Dictionary&lt;string, object&gt;();
                    cpmRequest.Add(&quot;Document&quot;, docdto);
                    cpmRequest.Add(&quot;AdditionalParam&quot;, additionalParam);
                    customizePageData = cpm.GetData(this.AssociatedPage, mode: &quot;SaveDocument&quot;,
                        callerContext: &quot;DocumentCustomizePageModel&quot;, additionalParameters: cpmRequest);
                    returnValue = customizePageData[&quot;Result&quot;].ToInt32_2();
                }
            }
            //if not handled in customer code, do the default platform action. 
            if (!handled)
            {
                returnValue = DocumentComponent.Instance.AddDocument(docdto);
            }


            docdto.DocId = returnValue;
            //Once a document is saved, we will call the after save record model&#39;s

            Dictionary&lt;string, Type&gt; dicObj = AfterSaveRecordModel.GetModelObjects();

            foreach (KeyValuePair&lt;string, Type&gt; kvp in dicObj)
            {
                var Savemodel = AfterSaveRecordModel.GetInstance(kvp.Key);
                if (Savemodel != null)
                    Savemodel.SaveDetails(docdto, null, &quot;Save&quot;, &quot;SAVE_DOCUMENT&quot;);
            }


            return returnValue;
        }

        public bool UpdateDocumentContent(int docID, int FolderId, string filename, byte[] fileBytes, string description)
        {
            //call webservice to add the doc to file repository
            string[] storageid = docservice.SaveDocument(GetFolderDetails(FolderId), filename, fileBytes, false, null);

            if (String.IsNullOrEmpty(storageid[0]))
                return false;

            //add the document to document content table
            if (AMP3ApplicationSettings.Instance.appSettings.ContainsKey(&quot;DocumentReadWriteLocation&quot;) &amp;&amp;
                AMP3ApplicationSettings.Instance.appSettings[&quot;DocumentReadWriteLocation&quot;].ToString() != &quot;FILESYSTEM&quot;)
                DocumentComponent.Instance.SaveDocumentContent(storageid[0], filename, Path.GetExtension(filename), fileBytes, description);

            //create DTO and add to DB
            Document docdto = DocumentManager.Instance.ViewDocumentDetails(docID);

            docdto.DocId = docID;
            docdto.DocName = filename;
            docdto.DocSize = Math.Round(fileBytes.Length.ToDecimal2() / 1024, 2).ToString2() + &quot;KB&quot;;
            docdto.StorageId = storageid[0];
            docdto.UpdatedBy = UserDetail.GetCurrentUserDetail().UID;
            docdto.UpdationDate = DateTime.UtcNow;

            return (DocumentComponent.Instance.UpdateDocument(docdto, &quot;FU&quot;) &gt; 0);
        }
        internal Dictionary&lt;int, string&gt; GetAnnoationsForFolderId(int folderId)
        {
            var docIdAndAnnotationsDictionary = new Dictionary&lt;int, string&gt;();

            DataSet docIdsAndItsAnnotation = DocumentComponent.Instance.GetDocIdsAndItsAnnotationIdsForFolder(folderId);
            if (docIdsAndItsAnnotation.Tables.Count != 0 &amp;&amp; docIdsAndItsAnnotation.Tables[0].Rows.Count != 0)
            {
                for (int i = 0; i &lt; docIdsAndItsAnnotation.Tables[0].Rows.Count; i++)
                    docIdAndAnnotationsDictionary.Add(Convert.ToInt32(docIdsAndItsAnnotation.Tables[0].Rows[i][&quot;DocID&quot;]),
                         JsonConvert.SerializeObject(docIdsAndItsAnnotation.Tables[0].Rows[i][&quot;ValidAnnotationIds&quot;].ToString()));
            }
            return docIdAndAnnotationsDictionary;
        }

        public void SetAssocaitaedPage(System.Web.UI.Page page)
        {
            this.AssociatedPage = page;
        }

        public string GetOnBeforeUploadScript()
        {
            string script = string.Empty;
            foreach (KeyValuePair&lt;string, Type&gt; kvp in customizePageModelObjects)
            {
                CustomizePageModel cpm = CustomizePageModel.GetInstance(kvp.Key);
                if (cpm != null)
                {
                    customizePageData = cpm.GetData(null, mode: &quot;GetOnBeforeUploadScript&quot;,
                        callerContext: &quot;DocumentCustomizePageModel&quot;, additionalParameters: null);
                    script = customizePageData[&quot;OnBeforeUploadScript&quot;].ToString2();
                }
            }
            return script;
        }

        public bool ValidateMetadataForDocumentUniqueness(int docId, int projectId, System.Web.UI.Page page)
        {
            foreach (KeyValuePair&lt;string, Type&gt; kvp in customizePageModelObjects)
            {
                CustomizePageModel cpm = CustomizePageModel.GetInstance(kvp.Key);
                if (cpm != null)
                {
                    Dictionary&lt;string, object&gt; cpmRequest = new Dictionary&lt;string, object&gt;();
                    cpmRequest.Add(&quot;ProjectID&quot;, projectId);
                    cpmRequest.Add(&quot;DocID&quot;, docId);
                    customizePageData = cpm.GetData(page, mode: &quot;ValidateMetadataForDocumentUniqueness&quot;,
                        callerContext: &quot;DocumentCustomizePageModel&quot;, additionalParameters: cpmRequest);
                    return customizePageData[&quot;Result&quot;].ToBoolean2();
                }
            }
            // No Metadata validation for platform. So return true.  
            return true;
        }

        public string ValidateMetaDataExcel(CustomizePageModel cpModel, string DocumentNames, string StorageFolderGuid,
            string MetaDataFileName, int projectID, int FolderID, Page context, string storagePath)
        {
            if (cpModel != null)
            {
                string filePath = string.Empty;
                Dictionary&lt;string, string&gt; additionalParameters = new Dictionary&lt;string, string&gt;();
                additionalParameters.Add(&quot;FileNames&quot;, DocumentNames);
                additionalParameters.Add(&quot;MetaDataFileName&quot;, MetaDataFileName);
                additionalParameters.Add(&quot;StorageFolderGuid&quot;, StorageFolderGuid);
                additionalParameters.Add(&quot;ProjectID&quot;, projectID.ToString2());
                additionalParameters.Add(&quot;FolderID&quot;, FolderID.ToString2());
                customizePageData = cpModel.GetData(context, mode: &quot;ValidateMetaDataExcel&quot;,
                    callerContext: &quot;DocumentCustomizePageModel&quot;, additionalParameters: additionalParameters);
                string returnValue = customizePageData[&quot;Result&quot;].ToString();
                return returnValue;
            }
            else
            {
                UploadMetadata CheckMD = new UploadMetadata();
                string excelUploadRecordInfo = string.Empty;

                CheckMD.ProjectId = projectID;
                CheckMD.FolderId = FolderID;
                CheckMD.DOCNames = DocumentNames;

                return CheckMD.ValidateMetadataExcel(storagePath, MetaDataFileName, DocumentNames, ref excelUploadRecordInfo);
            }
        }

        public void SaveExcelMetaData(string Ids, int projectID, int FolderID, string StorageFolderGuid,
            string MetaDataFileName, Page context)
        {
            CustomizePageModel cpModel = GetCustomPageModelInstance();
            Dictionary&lt;string, string&gt; additionalParameters = new Dictionary&lt;string, string&gt;();
            additionalParameters.Add(&quot;FileIDs&quot;, Ids);
            additionalParameters.Add(&quot;StorageFolderGuid&quot;, StorageFolderGuid);
            additionalParameters.Add(&quot;MetaDataFileName&quot;, MetaDataFileName);
            additionalParameters.Add(&quot;ProjectID&quot;, projectID.ToString2());
            additionalParameters.Add(&quot;FolderID&quot;, FolderID.ToString2());

            if (cpModel != null)
            {
                cpModel.GetData(context, mode: &quot;SaveMetaDataExcelForBulkUpload&quot;,
                    callerContext: &quot;DocumentCustomizePageModel&quot;, additionalParameters: additionalParameters);
            }
            else
            {
                //Dictionary&lt;string, object&gt; dtparams = additionalParameters as Dictionary&lt;string, object&gt;;
                string documentIDS = Convert.ToString(additionalParameters[&quot;FileIDs&quot;]);
                string StoragemdFolderGuid = Convert.ToString(additionalParameters[&quot;StorageFolderGuid&quot;]);
                string mdFileName = Convert.ToString(additionalParameters[&quot;MetaDataFileName&quot;]);

                string storagePath = HttpContext.Current.Server.MapPath(&quot;~/TempUploads/&quot;);
                string fileName = Path.Combine(storagePath, StoragemdFolderGuid, mdFileName);

                UploadMetadata CheckMD = new UploadMetadata();
                CheckMD.ProjectId = Convert.ToInt32(additionalParameters[&quot;ProjectID&quot;]);
                CheckMD.FolderId = Convert.ToInt32(additionalParameters[&quot;FolderID&quot;]);

                CheckMD.DOCIds = documentIDS;
                CheckMD.SaveExcelMetaData(fileName);

                if (File.Exists(fileName))
                    File.Delete(fileName);

                DeleteAllDirectoriesAndAllFiles(Path.Combine(storagePath, StorageFolderGuid));
            }
        }

        private void DeleteAllDirectoriesAndAllFiles(string path)
        {
            if (!Directory.Exists(path))
                return; ;

            string[] subDirectories = Directory.GetDirectories(path);

            foreach (string directory in subDirectories)
            {
                DeleteAllDirectoriesAndAllFiles(directory);
            }

            string[] files = Directory.GetFiles(path);

            foreach (string file in files)
            {
                File.Delete(file);
            }

            Directory.Delete(path);
        }

        public void UpdateDocDetails(int docId, string comments, string description, string UpdateType, int linkId = -1,
            bool IsTemplate = false)
        {
            Document docdto = ViewDocumentDetails(docId); //Document docdto = GetDocumentDetails(storageId);            
            if (docdto.VersionNo == 1 || UpdateType == &quot;UL&quot; || UpdateType == &quot;UD&quot;)
                docdto.DocDesc = description;
            //  docdto.DocDesc = string.IsNullOrEmpty(description) ? docdto.DocDesc : description;
            else if (docdto.VersionNo &gt; 1 &amp;&amp; UpdateType != &quot;UL&quot;)
            {
                DocumentComponent.Instance.SaveVersiondescription(docId, docdto.VersionNo, description);
            }
            docdto.XMLInfo = string.IsNullOrEmpty(comments) ? docdto.XMLInfo : comments;
            docdto.IsTemplate = IsTemplate;
            docdto.UpdationDate = MWDateTimeHelper.UtcNow;
            docdto.UpdatedBy = UserDetail.GetCurrentUserDetail().UID;
            DocumentComponent.Instance.UpdateDocument(docdto, UpdateType, linkId);
        }

        /// &lt;summary&gt;
        /// changes status of doc to checked out
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;DocId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;IsLocalCopy&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;StorageId&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public byte[] CheckOutDocument(int FolderId, int DocId, string StorageId, bool IsLocalCopy)
        {
            // change status of doc in DB
            DocumentComponent.Instance.CheckOutDocument(DocId);
            if (IsLocalCopy)
            {
                //call web service and get file stream
                Document doc = GetDocumentDetails(StorageId);
                byte[] filebytes = docservice.OpenDocument(doc.FolderDetails ?? GetFolderDetails(FolderId), StorageId,
                    doc.DocName);
                return (filebytes.Length != 0) ? filebytes : null;
            }
            return null;
        }

        ///// &lt;summary&gt;
        ///// changes the status of doc from checked out to checked in
        ///// &lt;/summary&gt;
        ///// &lt;param name=&quot;FilePath&quot;&gt;&lt;/param&gt;
        ///// &lt;param name=&quot;FileBytes&quot;&gt;&lt;/param&gt;
        ///// &lt;param name=&quot;StorageId&quot;&gt;&lt;/param&gt;
        ///// &lt;param name=&quot;OverWrite&quot;&gt;&lt;/param&gt;
        ///// &lt;param name=&quot;checkindesc&quot;&gt;&lt;/param&gt;
        ///// &lt;returns&gt;&lt;/returns&gt;
        //[EnvironmentPermissionAttribute(SecurityAction.Demand, Unrestricted = true)]
        //public int CheckInDocument(int FolderId, string FilePath, byte[] FileBytes, string StorageId, bool OverWrite,
        //                           string checkindesc)
        //{
        //    int typeid;
        //    int result;
        //    UserDetail ud = UserDetail.GetCurrentUserDetail();

        //    //get the filename from filepath
        //    int indx = FilePath.LastIndexOf(&quot;\\&quot;, StringComparison.CurrentCultureIgnoreCase);
        //    string filename = FilePath.Substring(indx + 1, FilePath.Length - (indx + 1));
        //    //get file size from file bytes
        //    decimal f = FileBytes.Length.ToDecimal2();
        //    string filesize = Math.Round(f / 1024, 2).ToString2() + &quot;KB&quot;;

        //    //get doc details of document to check in
        //    int versionno = 0, docid = 0;

        //    Document dtobject = DocumentComponent.Instance.GetDocumentDetails(StorageId);
        //    if (dtobject != null)
        //    {
        //        docid = dtobject.DocId.ToInt32_2();
        //        versionno = DocumentComponent.Instance.GetVersion(docid);
        //    }
        //    string[] sid;
        //    if (OverWrite)
        //    {
        //        //call webservice to add the doc to file repository
        //        sid = docservice.SaveDocument(dtobject.FolderDetails ?? GetFolderDetails(FolderId), dtobject.DocName, FileBytes, true, StorageId);

        //        return String.IsNullOrEmpty(sid[0]) ? 0 : DocumentComponent.Instance.CheckInDocument(docid, checkindesc);
        //    }

        //    //call webservice to add the doc to file repository
        //    sid = docservice.SaveDocument(dtobject.FolderDetails ?? GetFolderDetails(FolderId), dtobject.DocName, FileBytes, false, null);

        //    if (String.IsNullOrEmpty(sid[0]))
        //        return 0;

        //    //get the typeid from mimetype
        //    string mimeType = MimeTypeFrom(FileBytes, &quot;&quot;);
        //    typeid = DocumentComponent.Instance.GetTypeId(mimeType);

        //    //add a new version of the document to DB
        //    var docdto = new Document();
        //    docdto.DocName = filename;
        //    docdto.DocSize = filesize;
        //    docdto.DocType = typeid;
        //    docdto.ParentId = docid;
        //    docdto.VersionNo = versionno + 1;
        //    docdto.FolderId = HttpContext.Current.Session[&quot;FolderId&quot;].ToInt32_2();
        //    docdto.Status = false;
        //    docdto.StorageId = sid[0];
        //    docdto.XMLInfo = &quot;&lt;XMLInfo&gt;&lt;/XMLInfo&gt;&quot;;
        //    docdto.DocDesc = checkindesc;
        //    docdto.CreationDate = DateTime.UtcNow.ToString2();
        //    docdto.Author = ud.UID;
        //    docdto.AuthorName = ud.UserName;
        //    docdto.CheckedBy = 0;
        //    docdto.SPName = sid[1];

        //    result = DocumentComponent.Instance.AddDocument(docdto);
        //    if (result &gt; 0)
        //    {
        //        return result;
        //    }

        //    return 0;
        //}

        /// &lt;summary&gt;
        /// gets the details of the document
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;storageId&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;DTO object&lt;/returns&gt;
        public Document GetDocumentDetails(string storageId)
        {
            return DocumentComponent.Instance.GetDocumentDetails(storageId);
        }

        public List&lt;DocumentVersion&gt; GetVersionDetails(Document doc)
        {
            if (docservice.IsSharePoint)
                return docservice.GetVersionsFromSharepoint(doc.FolderDetails,
                    string.IsNullOrEmpty(doc.SPName) ? &quot;{0}_{1}&quot;.Format2(doc.StorageId, doc.DocName) : doc.SPName);
            else
                return GetVersions(doc);
        }

        public List&lt;DocumentVersion&gt; GetVersionDetailsFromSP(Document doc)
        {
            return docservice.GetVersionsFromSharepoint(doc.FolderDetails,
                string.IsNullOrEmpty(doc.SPName) ? &quot;{0}_{1}&quot;.Format2(doc.StorageId, doc.DocName) : doc.SPName);
        }

        public List&lt;DocumentVersion&gt; GetVersions(Document docDTO)
        {
            List&lt;DocumentVersion&gt; dv = new List&lt;DocumentVersion&gt;();
            DocumentVersion baseVer = new DocumentVersion()
            {
                VersionLabel = &quot;Version {0}&quot;.Format2(1),
                Created = docDTO.CreationDate.Value.ToMWDateTime(),
                CheckInComment = docDTO.DocDesc,
                Url = docDTO.StorageId,
                Major = 1,
                CreatedBy = docDTO.AuthorName.ToString2()
            };
            DataSet versions = DocumentComponent.Instance.GetVersions(docDTO.DocId);
            if (versions != null &amp;&amp; versions.Tables.Count &gt; 0 &amp;&amp; versions.Tables[0].Rows.Count &gt; 0)
            {
                baseVer.Url = &quot;{0}_v2&quot;.Format2(docDTO.StorageId);
                foreach (DataRow dr in versions.Tables[0].Rows)
                {
                    dv.Add(new DocumentVersion()
                    {
                        VersionLabel = &quot;Version {0}&quot;.Format2(dr[&quot;VersionNumber&quot;]),
                        Created = dr[&quot;CreatedOn&quot;].ToMWDateTime(),
                        CheckInComment = dr[&quot;Comments&quot;].ToString2(),
                        Url =
                            dr[&quot;VersionNumber&quot;].ToInt32_2() == docDTO.VersionNo
                                ? docDTO.StorageId
                                : &quot;{0}_v{1}&quot;.Format2(docDTO.StorageId, dr[&quot;VersionNumber&quot;].ToInt32_2() + 1),
                        Major = dr[&quot;VersionNumber&quot;].ToInt32_2(),
                        CreatedBy = dr[&quot;CreatedByName&quot;].ToString2()
                    });
                }
            }
            dv.Add(baseVer);
            return dv;
        }


        public DataSet GetVersions(int docId)
        {
            return DocumentComponent.Instance.GetVersions(docId);
        }

        /// &lt;summary&gt;
        /// changes status of checked out document 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;DocId&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        internal int UndoCheckOut(int DocId)
        {
            return DocumentComponent.Instance.UndoCheckOut(DocId);
        }

        /// &lt;summary&gt;
        /// deletes selected document from the DB nad repository
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;DocId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;StorageId&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public int DeleteDocument(int DocId, string StorageId)
        {
            Document dto = null;
            if (IsSharePoint)
                dto = GetDocumentDetails(StorageId);
            int result = DocumentComponent.Instance.DeleteDocument(DocId);

            if (result == 1)
            {
                if (IsSharePoint &amp;&amp; dto != null &amp;&amp; dto.FolderDetails != null)
                    docservice.DeleteDocumentfromSharePoint(dto.FolderDetails,
                        string.IsNullOrEmpty(dto.SPName) ? &quot;{0}_{1}&quot;.Format2(StorageId, dto.DocName) : dto.SPName);
                else
                    docservice.DeleteDocument(StorageId);
            }

            return result;
        }

        /// &lt;summary&gt;
        /// deletes selected document from the DB nad repository
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;DocId&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public int DeleteDocument(int DocId)
        {
            Document dto = ViewDocumentDetails(DocId);
            int result = DocumentComponent.Instance.DeleteDocument(DocId);

            if (result == 1)
            {
                if (IsSharePoint &amp;&amp; dto != null &amp;&amp; dto.FolderDetails != null)
                    docservice.DeleteDocumentfromSharePoint(dto.FolderDetails,
                        string.IsNullOrEmpty(dto.SPName) ? &quot;{0}_{1}&quot;.Format2(dto.StorageId, dto.DocName) : dto.SPName);
                else
                    docservice.DeleteDocument(dto.StorageId);
            }

            return result;
        }

        /// &lt;summary&gt;
        /// gets the details of the document for viewing
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;docid&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public Document ViewDocumentDetails(int docid)
        {
            return DocumentComponent.Instance.ViewDocumentDetails(docid);
        }

        public Document ViewDocumentDetailsFor(string company, int docid)
        {
            return DocumentComponent.Instance.ViewDocumentDetailsFor(company, docid);
        }

        public Document GetDocumentWithDocIDandVerNo(string company, int docid, int versionNo)
        {
            return DocumentComponent.Instance.GetDocumentWithDocIDandVerNo(docid, versionNo, company);
        }

        /// &lt;summary&gt;
        /// deletes all attachments of the module from the Documents table as well as all links from Links table
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;ModuleID&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;FolderID&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        internal int DeleteAttachments(string ModuleID, int FolderID)
        {
            //delete all links of module attachments from links table
            return (LinksManager.Instance.DeleteAllLinks(ModuleID) &gt; 0)
                ? DocumentComponent.Instance.DeleteAttachments(FolderID)
                : 0;
        }

        public int CreateFolderForModule(string ModuleId, string ParentModuleId, int? ParentInstanceID)
        {
            int folderId = DocumentComponent.Instance.GetParentFolderIdForModule(null, ModuleId, ParentModuleId,
                ParentInstanceID);
            if (folderId == 0)
            {
                Folder parentFolder = GetInstanceRootFolder(ParentInstanceID.Value, ParentModuleId);
                DataRow module = ModuleManagementBL.ModuleManager.Instance.GetModuleDetails(ModuleId);
                if (module != null)
                {
                    Folder folder = new Folder();
                    folder.ModuleId = ModuleId;
                    folder.InstanceId = &quot;0&quot;;
                    folder.ParentInstanceId = ParentInstanceID;
                    folder.FolderName = module[&quot;ModuleName&quot;].ToString2();
                    folder.FolderDesc = &quot;{0} documents&quot;.Format2(module[&quot;ModuleName&quot;]);
                    folder.ParentId = parentFolder.FolderId;
                    folder.ParentModuleId = ParentModuleId;
                    folder.ListID = parentFolder.ListID;
                    folder.ListPath =
                        &quot;{0}{1}&quot;.Format2(
                            !string.IsNullOrEmpty(parentFolder.ListPath)
                                ? &quot;{0}{1}&quot;.Format2(parentFolder.ListPath, &quot;/&quot;)
                                : string.Empty, folder.FolderName);
                    folderId = Instance.AddFolder(folder);
                }
            }
            return folderId;
        }

        public int CreateFolderForDummyModule(string ModuleId, string ParentModuleId, int ParentInstanceID,
            string FolderName)
        {
            Folder parentFolder = GetInstanceRootFolder(ParentInstanceID, ParentModuleId);
            Folder folder = new Folder();
            folder.ModuleId = ModuleId;
            folder.InstanceId = &quot;0&quot;;
            folder.ParentInstanceId = ParentInstanceID;
            folder.FolderName = FolderName;
            folder.FolderDesc = &quot;{0} documents&quot;.Format2(FolderName);
            folder.ParentId = parentFolder.FolderId;
            folder.ParentModuleId = ParentModuleId;
            folder.ListID = parentFolder.ListID;
            folder.ListPath =
                &quot;{0}{1}&quot;.Format2(
                    !string.IsNullOrEmpty(parentFolder.ListPath)
                        ? &quot;{0}{1}&quot;.Format2(parentFolder.ListPath, &quot;/&quot;)
                        : string.Empty, folder.FolderName);
            return Instance.AddFolder(folder);
        }

        public int GetParentFolderIdForModule(string InstanceID, string ModuleId, string ParentModuleID,
            int? ParentInstanceId)
        {
            return DocumentComponent.Instance.GetParentFolderIdForModule(
                (InstanceID.Contains(&quot;-&quot;) ? ParentInstanceId.Value.ToString2() : InstanceID),
                // fix for checklist documents
                ModuleId, ParentModuleID, ParentInstanceId);
        }

        public Folder GetInstanceRootFolder(int instanceid, string moduleid)
        {
            return DocumentComponent.Instance.GetInstanceRootFolder(instanceid, moduleid);
        }

        public DataTable GetProjectsRootFolder(List&lt;string&gt; projects, bool isSingleProjectMode)
        {
            return DocumentComponent.Instance.GetProjectsRootFolder(projects, isSingleProjectMode);
        }

        public DataTable GetDocumentList(int folderId, int currentUserId, string docName = null, string docDesc = null, int? CreatedBy = null, string CurrentRole = &quot;&quot;)
        {
            return ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTGetDocsByFolder, null,
                    folderId, docName, docDesc, CreatedBy, CurrentRole, currentUserId).Tables[0];
        }

        public string CreateDocumentList(string ListName, string Description)
        {
            if (IsSharePoint)
                return docservice.CreateList(ListName, Description);
            else
                return string.Empty;
        }

        public void RenameDocumentList(string ListId, string ListName, string Description)
        {
            if (IsSharePoint)
                docservice.RenameList(ListId, ListName, Description);
        }

        public bool CheckIn(int folderId, string storageId, string comments, string fileTitle, byte[] docstream,
            int userId, string userName, int projectId)
        {
            try
            {
                string mimeType = MimeTypeFrom(docstream, &quot;&quot;);
                int typeid = DocumentComponent.Instance.GetTypeId(mimeType);
                Document docdto = GetDocumentDetails(storageId);
                docdto.DocName = fileTitle;
                docdto.DocSize = Math.Round(docstream.Length.ToDecimal2() / 1024, 2).ToString2() + &quot;KB&quot;;
                docdto.VersionNo += 1;
                docdto.XMLInfo = comments;
                docdto.DocType = typeid;
                docdto.UpdationDate = MWDateTimeHelper.UtcNow;
                UserDetail ud = UserDetail.GetCurrentUserDetail();

                docdto.UpdatedBy = (ud != null) ? ud.UID : userId;
                var UID = 0;
                var UName = &quot;&quot;;

                UID = (ud != null) ? ud.UID : userId;
                UName = (ud != null)
                    ? (ud.FirstName + (string.IsNullOrEmpty(ud.MiddleName) ? &quot;&quot; : &quot; &quot; + ud.MiddleName) +
                       (string.IsNullOrEmpty(ud.LastName) ? &quot;&quot; : &quot; &quot; + ud.LastName)) + &quot;(&quot; + ud.UserName + &quot;)&quot;
                    : userName;

                if (IncrementXrefMasterFileVersion(docdto, comments, UID, UName, projectId))
                {
                    if (!IsSharePoint)
                    {
                        if (AMP3ApplicationSettings.Instance.appSettings.ContainsKey(&quot;DocumentReadWriteLocation&quot;))
                        {
                            if (AMP3ApplicationSettings.Instance.appSettings[&quot;DocumentReadWriteLocation&quot;].ToString() ==
                                &quot;FILESYSTEM&quot;)
                            {
                                string versionedFile = Path.Combine(docservice.docStoragePath,
                                    &quot;{0}_v{1}&quot;.Format2(storageId, docdto.VersionNo));
                                if (File.Exists(versionedFile))
                                {
                                    File.Delete(versionedFile);
                                }
                                File.Move(Path.Combine(docservice.docStoragePath, storageId), versionedFile);
                            }
                            else if (
                                AMP3ApplicationSettings.Instance.appSettings[&quot;DocumentReadWriteLocation&quot;].ToString() ==
                                &quot;DBVARBINARY&quot; ||
                                AMP3ApplicationSettings.Instance.appSettings[&quot;DocumentReadWriteLocation&quot;].ToString() ==
                                &quot;DBFILESTREAM&quot;)
                            {
                                ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                                    DocumentStoredProcedure.usp_DOCMGMTUpdateStorageID, null, storageId,
                                    docdto.VersionNo);
                                DocumentComponent.Instance.SaveDocumentContent(storageId, fileTitle,
                                    Path.GetExtension(fileTitle), docstream, comments);
                            }
                        }
                        //UserDetail ud = UserDetail.GetCurrentUserDetail();
                        DocumentComponent.Instance.CreateVersion(docdto.DocId, comments, docdto.VersionNo, userId,
                            userName, &quot;{0}_v{1}&quot;.Format2(storageId, docdto.VersionNo));
                    }
                    docservice.CheckInDocument(docdto.FolderDetails ?? GetFolderDetails(folderId), storageId, comments,
                        fileTitle, docstream, docdto.SPName, docdto.VersionNo - 1);
                    DocumentComponent.Instance.UpdateDocument(docdto, &quot;CI&quot;);
                }
            }
            catch (Exception ex)
            {
                Logging.Logger.Log(Enumerations.LogType.Error, ex.StackTrace, Constants.MODID_DOCMGMT);
            }
            return true;
        }

        private bool IncrementXrefMasterFileVersion(Document ChildDoc, string comments, int userId, string userName,
            int projectId)
        {
            var success = true;

            try
            {
                Document masterDoc = DocumentManager.Instance.GetMasterDocDetails(ChildDoc.DocId);
                if (masterDoc.DocId &gt; 0 &amp;&amp; masterDoc.ChildAssociationType.ToUpper() == &quot;XREF&quot;)
                {
                    byte[] fileBytes = ViewDocument(masterDoc.StorageId);

                    bool result1 = CheckOut(masterDoc.FolderId, masterDoc.StorageId, userId);
                    if (result1)
                    {
                        result1 = CheckIn(masterDoc.FolderId, masterDoc.StorageId,
                            &quot;xref file &#39;&quot; + ChildDoc.DocName + &quot;&#39; checked in by &#39;&quot; + userName
                            + &quot;&#39; with comments : &quot; + comments, masterDoc.DocName, fileBytes, userId, userName, projectId);


                        //The below piece make a call to customer code and get the operation done as defined in customized model.
                        //Update ReadOnly metadata as per the customer requirement
                        foreach (KeyValuePair&lt;string, Type&gt; kvp in customizePageModelObjects)
                        {
                            CustomizePageModel cpm = CustomizePageModel.GetInstance(kvp.Key);
                            if (cpm != null)
                            {
                                Dictionary&lt;string, object&gt; cpmRequest = new Dictionary&lt;string, object&gt;();
                                cpmRequest.Add(&quot;DocDto&quot;, masterDoc);
                                cpmRequest.Add(&quot;PID&quot;, projectId);
                                customizePageData = cpm.GetData(this.AssociatedPage,
                                    mode: &quot;UpdateMetaDataForReadOnlyFields&quot;, callerContext: &quot;DocumentCustomizePageModel&quot;,
                                    additionalParameters: cpmRequest);
                            }
                        }

                        List&lt;string&gt; CheckComponents =
                            Aurigo.AMP3.ModuleManagementBL.ModuleManager.Instance.GetModuleComponenets(
                                Constants.MODID_DOCMGMT);
                        if (CheckComponents.Contains(&quot;LogActivities&quot;))
                        {
                            var FolderId = masterDoc.FolderId;
                            var DocName = masterDoc.DocName;
                            var folderName =
                                HttpUtility.HtmlEncode(DocumentManager.Instance.GetFolderName(FolderId,
                                    getDisplayName: true));
                            string message;
                            string activity;
                            Dictionary&lt;string, object&gt; additionalParam = new Dictionary&lt;string, object&gt;();
                            additionalParam.Add(&quot;FolderId&quot;, masterDoc.FolderId.ToString());
                            Dictionary&lt;string, object&gt; resultObject =
                                DocumentManager.Instance.GetLogMessage(masterDoc.DocId, &quot;CheckedIn&quot;, additionalParam);
                            message = HttpUtility.HtmlEncode(resultObject[&quot;message&quot;].ToString());
                            activity = resultObject[&quot;activity&quot;].ToString();
                            DocumentManager.Instance.UpdateActivityLog(&quot;Document&quot;, masterDoc.DocId,
                                String.Format(
                                    &quot;&lt;ACTION&gt;{4}&lt;/ACTION&gt; &lt;DOCNAME&gt; &lt;![CDATA[{0}]]&gt; &lt;/DOCNAME&gt;&lt;FOLDER&gt;  {1}&lt;/FOLDER&gt;&lt;FOLDERID&gt;  {2} &lt;/FOLDERID&gt;&lt;PROJECTID&gt;{3} &lt;/PROJECTID&gt;&quot;,
                                    DocName, folderName, FolderId, projectId, activity), message, userId);
                        }
                    }
                    else
                        throw new Exception(&quot;Master Document is already Checked Out. Request denied.&quot;);
                }
            }
            catch (Exception ex)
            {
                success = false;
                throw new Exception(ex.Message);
            }

            return success;
        }

        public void CreateVersionforFS(int docId, string comments, int versionNo, int UID, string userID,
            string storageId)
        {
            DocumentComponent.Instance.CreateVersion(docId, comments, versionNo, UID, userID,
                &quot;{0}_v{1}&quot;.Format2(storageId, versionNo));
        }

        public bool CheckOut(int FolderId, string storageId, int userId)
        {
            try
            {
                Document docdto = GetDocumentDetails(storageId);
                if (IsSharePoint)
                    return docservice.CheckOutDocument(docdto.FolderDetails ?? GetFolderDetails(FolderId), storageId,
                        docdto.DocName, docdto.SPName);
                docdto.CheckedBy = userId;
                return (DocumentComponent.Instance.UpdateDocument(docdto, &quot;CO&quot;) &gt; 0);
            }
            catch (Exception ex)
            {
                Logging.Logger.Log(Enumerations.LogType.Error, ex.StackTrace, Constants.MODID_DOCMGMT);
            }
            return true;
        }

        public bool UndoCheckOut(int FolderId, string storageId)
        {
            try
            {
                Document docdto = GetDocumentDetails(storageId);
                if (IsSharePoint)
                    docservice.UndoCheckOutDocument(docdto.FolderDetails ?? GetFolderDetails(FolderId), storageId,
                        docdto.DocName, docdto.SPName);
                DocumentComponent.Instance.UpdateDocument(docdto, &quot;UC&quot;);
            }
            catch (Exception ex)
            {
                Logging.Logger.Log(Enumerations.LogType.Error, ex.StackTrace, Constants.MODID_DOCMGMT);
            }
            return true;
        }

        public DataTable GetDocumentTemplates()
        {
            DataSet d =
                ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTGetDocumentTemplatesByID,
                    null, null);
            if (d.Tables.Count &gt; 0 &amp;&amp; d.Tables[0].Rows.Count &gt; 0)
                return (d.Tables[0]);
            else
                return (null);
        }
        internal AnnotationIds GetDocumentAnnoationIdsForSync(int docId, int linkId, int versionNo, string lastSyncedAt)
        {
            AnnotationIds result = new AnnotationIds();
            DataSet d = ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTGetAnnotationIdsForSync,
                null, docId, linkId, versionNo, lastSyncedAt);
            List&lt;string&gt; allAnnotationIds = new List&lt;string&gt;();
            List&lt;string&gt; newOrModifiedAnnotationIds = new List&lt;string&gt;();
            List&lt;string&gt; AnnotationInstanceIdsWithServerModifiedOn = new List&lt;string&gt;();
            if (d.Tables.Count &gt;= 1)
            {
                allAnnotationIds = (d.Tables[0].AsEnumerable().Select(r =&gt; r.Field&lt;int&gt;(&quot;Id&quot;).ToString()).ToList());
                newOrModifiedAnnotationIds = new List&lt;string&gt;();
                AnnotationInstanceIdsWithServerModifiedOn = (d.Tables[1].AsEnumerable().Select(r =&gt; r.Field&lt;string&gt;(&quot;Id_AurModifedOn&quot;).ToString()).ToList());
            }
            result.AllAnnotationIds = allAnnotationIds;
            result.NewOrModifiedAnnotationIds = newOrModifiedAnnotationIds;
            result.AnnotationInstanceIdsWithServerModifiedOn = AnnotationInstanceIdsWithServerModifiedOn;
            return result;


        }
        public Dictionary&lt;int, string&gt; GetDocumentTypes()
        {
            Dictionary&lt;int, string&gt; result = new Dictionary&lt;int, string&gt;();
            DataSet d = ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTGetDocumentTypes,
                null, null);
            if (d.Tables.Count &gt; 0 &amp;&amp; d.Tables[0].Rows.Count &gt; 0)
            {
                d.Tables[0].Rows.Cast&lt;DataRow&gt;().ForEach(x =&gt; result.Add(x[&quot;ID&quot;].ToInt32_2(), x[&quot;Name&quot;].ToString2()));
            }
            return result;
        }

        internal DataTable GetDocumentAnnoationsForInstanceIds(string commaSeparatedAnnotationInstanceIds)
        {

            DataSet d = ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTGetAnnotationdsForInstanceIds,
                null, commaSeparatedAnnotationInstanceIds);
            if (d.Tables.Count &gt;= 1)
            {
                return d.Tables[0];

            }
            return new DataTable();


        }

        internal DataTable GetAnnotationsForDocIds(string commaSeparatedDocIds)
        {

            DataSet d = ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTGetAnnotationsForDocIds,
                null, commaSeparatedDocIds);
            if (d.Tables.Count &gt;= 1)
            {
                return d.Tables[0];

            }
            return new DataTable();


        }

        internal int InsertUpdateAnnotation(Annotation annotation)
        {
            annotation.InstanceId = annotation.InstanceId &gt; 0 ? annotation.InstanceId : null;
            return ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(DocumentStoredProcedure.usp_DOCMGMTCUDAnnotation,
               null, annotation.DocId, annotation.VersionNo, annotation.LinkId, annotation.AnnotationXML, UserDetail.GetCurrentUserDetail().UserID, UserDetail.GetCurrentUserDetail().UID, annotation.AnnotationId, annotation.InstanceId);
        }

        internal int DeleteMultipleAnnotations(string AnnotationInstanceIdAndDocIds)
        {
            return ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(DocumentStoredProcedure.usp_DOCMGMTDeleteMultipleAnnotations,
              null, AnnotationInstanceIdAndDocIds);
        }



        public int SaveDocumentType(int documentId, string PID, int documentTypeID)
        {
            Dictionary&lt;int, string&gt; result = new Dictionary&lt;int, string&gt;();
            return
                ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                    DocumentStoredProcedure.usp_DOCMGMTCUDocumentType, null, documentId, PID, documentTypeID);
        }

        public DataTable GetDocumentTemplate(int InstanceID)
        {
            object[] param = new object[1];
            param[0] = InstanceID;
            DataSet d =
                ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTGetDocumentTemplatesByID,
                    null, param);
            if (d.Tables.Count &gt; 0)
                return (d.Tables[0]);
            else return (null);
        }

        public string GetDefaultDocumentTemplate()
        {
            String docTempId =
                ComponentHelper.Instance.ExecuteScalar(DocumentStoredProcedure.usp_DOCMGMTGetDefaultDocumentTemplate,
                    null, null).ToString2();
            if (!string.IsNullOrEmpty(docTempId))
                return docTempId;
            else
                return (null);
        }

        public string GetDefaultDocumentMetaData()
        {
            String docMetaDataId =
                ComponentHelper.Instance.ExecuteScalar(DocumentStoredProcedure.usp_DOCMGMTGetDefaultDocumentMetadata,
                    null, null).ToString2();
            if (!string.IsNullOrEmpty(docMetaDataId))
                return docMetaDataId;
            else
                return (null);
        }

        public string DeleteFolderContents(Folder folder)
        {
            if (folder.FolderId == 0) return string.Empty;
            try
            {
                //delete folder documents
                DeleteFolderDocuments(folder.FolderId);

                //delete sub folders 
                Dictionary&lt;int, Folder&gt; folderobj = Instance.GetSubfolders(folder.ModuleId, folder.InstanceId,
                    folder.FolderId);
                if (folderobj.Count != 0)
                {
                    foreach (var kvp in folderobj)
                        DeleteFolderContents(kvp.Value);
                }
                //delete folder
                Instance.DeleteFolder(folder);
            }
            catch (Exception ex)
            {
                return ex.Message;
            }

            return String.Empty;
        }

        public void InstantiateDocumentTemplate(string ModuleID, int InstanceID, int DocTemplateID)
        {
            //Folder rootInTemplate = Instance.GetInstanceRootFolder(DocTemplateID, &quot;LIBRARY&quot;);//This is done for,On creating the new estimates,document templates are coming by default so we have to pass moduleid           
            Folder rootInTemplate = Instance.GetInstanceRootFolder(DocTemplateID, ModuleID);
            if (rootInTemplate.FolderId &gt; 0)
            {
                Folder rootInProject = Instance.GetInstanceRootFolder(InstanceID, ModuleID);
                CreateDocumentTemplateRecursive(ModuleID, InstanceID, DocTemplateID, rootInTemplate, rootInProject);
            }
        }

        public void InstantiateDocumentTemplate(Folder rootInModule, int DocTemplateID)
        {
            Folder rootInTemplate = Instance.GetInstanceRootFolder(DocTemplateID, &quot;LIBRARY&quot;);
            //This is done for DocumentTemplate in Library            
            if (rootInTemplate.FolderId &gt; 0)
                CreateDocumentTemplateRecursive(rootInModule.ModuleId, rootInModule.InstanceId.ToInt32_2(),
                    DocTemplateID, rootInTemplate, rootInModule);
        }

        internal void DoDocuments(Folder rootInTemplate, Folder rootInProject)
        {
        }

        internal void CreateDocumentTemplateRecursive(string ModuleID, int InstanceID, int DocTemplateID,
            Folder rootInTemplate, Folder rootInProject)
        {
            List&lt;string&gt; CheckComponents =
                Aurigo.AMP3.ModuleManagementBL.ModuleManager.Instance.GetModuleComponenets(Constants.MODID_DOCMGMT);
            DoDocuments(rootInTemplate, rootInProject);
            Dictionary&lt;int, Folder&gt; Folders = Instance.GetSubfolders(&quot;LIBRARY&quot;, DocTemplateID.ToString(),
                rootInTemplate.FolderId);
            //// Add Documents to Root Folder.
            //if (CheckComponents.Contains(&quot;CopyTemplateDocuments&quot;))
            //{
            //    AddDocuments(rootInTemplate.FolderId, rootInProject.FolderId, InstanceID, ModuleID);
            //}
            foreach (KeyValuePair&lt;int, Folder&gt; kvp in Folders)
            {
                Folder folder = new Folder();
                folder.InstanceId = InstanceID.ToString();
                folder.ParentId = rootInProject.FolderId;
                folder.FolderName = kvp.Value.FolderName;
                folder.FolderDesc = kvp.Value.FolderDesc;
                folder.ModuleId = ModuleID;
                folder.ListID = rootInProject.ListID;
                folder.ListPath =
                    &quot;{0}{1}&quot;.Format2(
                        !string.IsNullOrEmpty(rootInProject.ListPath)
                            ? &quot;{0}{1}&quot;.Format2(rootInProject.ListPath, &quot;/&quot;)
                            : string.Empty, kvp.Value.FolderName);

                Instance.AddFolder(folder);
                CreateDocumentTemplateRecursive(ModuleID, InstanceID, DocTemplateID, kvp.Value, folder);
                if (CheckComponents.Contains(&quot;CopyTemplateDocuments&quot;))
                {
                    AddDocuments(kvp.Value.FolderId, folder.FolderId, InstanceID, ModuleID, true);
                }
            }
        }

        /// &lt;summary&gt;
        /// Add Documents from Source Folder(Library) to Destination(Project) Folder.
        /// &lt;/summary&gt;
        internal void AddDocuments(int sourceId, int destId, int instanceId, string moduleId, bool isCheckDuplicate = false)
        {
            DataTable dt = DocumentComponent.Instance.GetDocumentsByFolder(sourceId);
            if (dt != null &amp;&amp; dt.Rows.Count &gt; 0)
            {
                foreach (DataRow dr in dt.Rows)
                {
                    Document doc = DocumentComponent.Instance.ViewDocumentDetails(dr[&quot;DocId&quot;].ToInt32_2());
                    Stream stream = GetStream(dr[&quot;StorageId&quot;].ToString2());
                    byte[] fileBytes;
                    using (var memoryStream = new MemoryStream())
                    {
                        stream.CopyTo(memoryStream);
                        fileBytes = memoryStream.ToArray();
                    }

                    bool insertToDB = true;
                    if (isCheckDuplicate)
                    {

                        DataTable dtDoc = DocumentComponent.Instance.GetDocumentsByNameAndFolderId(dr[&quot;DocName&quot;].ToString2(), destId);
                        if (dtDoc != null &amp;&amp; dtDoc.Rows.Count != 0)
                        {
                            insertToDB = false;
                        }

                    }

                    if (insertToDB)
                    {
                        string[] storageid = docservice.SaveDocument(GetFolderDetails(destId), doc.DocName, fileBytes, false,
                         null);
                        Document dtoNewDoc = new Document();
                        dtoNewDoc.Author = doc.Author;
                        dtoNewDoc.AuthorName = doc.AuthorName;
                        dtoNewDoc.CheckedBy = doc.CheckedBy;
                        dtoNewDoc.CheckedByName = doc.CheckedByName;
                        dtoNewDoc.CreationDate = DateTime.UtcNow;
                        dtoNewDoc.DocDesc = doc.DocDesc;
                        dtoNewDoc.DocName = doc.DocName;
                        dtoNewDoc.DocSize = doc.DocSize;
                        dtoNewDoc.DocType = doc.DocType;
                        dtoNewDoc.DocTypeDesc = doc.DocTypeDesc;
                        dtoNewDoc.ParentId = 0;
                        dtoNewDoc.VersionNo = 1;
                        dtoNewDoc.FolderId = destId;
                        dtoNewDoc.Status = false;
                        dtoNewDoc.StorageId = storageid[0];
                        dtoNewDoc.XMLInfo = &quot;&lt;XMLInfo&gt;&lt;/XMLInfo&gt;&quot;;
                        dtoNewDoc.SrcModuleID = &quot;PROJECT&quot;;
                        dtoNewDoc.SPName = storageid[1];
                        dtoNewDoc.IsTemplate = false;
                        int docid = DocumentComponent.Instance.AddDocument(dtoNewDoc);
                        LinksManager.Instance.AddLinks(doc.DocName, instanceId.ToString2(), moduleId, docid.ToString2(),
                            &quot;DOCMGMT&quot;,
                            doc.AuthorName, null, doc.DocDesc, destId);
                    }
                }
            }
        }

        /// &lt;summary&gt;
        /// Gets the effective permissions for a folder.  Permissions are inherited from the parent folder
        /// if not explicitly set on the child folder.  If no permissions are set then it is assumed that
        /// no role permissions are active and all roles can access the folder
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;FolderID&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        protected int[] GetEffectivePermissions(int FolderID)
        {
            bool bPermissions = false;
            int[] RoleIds;
            DataTable dt;

            do
            {
                Folder f = Instance.GetFolderDetails(FolderID);
                object[] prmtrs = new object[1];
                prmtrs[0] = FolderID;

                DataSet ds =
                    ComponentHelper.Instance.ExecuteDataSet(
                        DocumentStoredProcedure.usp_DOCMGMTGetFolderPermissionsByFolderID, null, prmtrs);
                dt = ds.Tables[0];
                if (dt.Rows.Count != 0)
                    bPermissions = true;
                else
                    FolderID = f.ParentId;
            } while (!bPermissions &amp;&amp; FolderID != 0);

            // if bPermissions is true then there are explicit role permissions otherwise all roles have access
            if (bPermissions)
            {
                RoleIds = new int[dt.Rows.Count];
                for (int i = 0; i &lt; dt.Rows.Count; i++)
                    RoleIds[i] = dt.Rows[0][&quot;RoleId&quot;].ToInt32_2();
            }
            else
                RoleIds = new[] { -1 };

            return (RoleIds);
        }

        //public void WriteServerFiletoBrowser(HttpResponse httpResponse, string localFile)
        //{
        //    httpResponse.Clear();
        //    httpResponse.AddHeader(&quot;Content-disposition&quot;, &quot;attachment; filename=&quot; + Path.GetFileName(localFile));
        //    // Total bytes to read: 
        //    // Read the bytes from the stream in small portions. 
        //    using (var fs = new FileStream(localFile, FileMode.OpenOrCreate, FileAccess.Read, FileShare.Read))
        //    {
        //        long bytesToRead = fs.Length;
        //        while (bytesToRead &gt; 0)
        //        {
        //            // Read the data into the buffer and write into the 
        //            var buffer = new Byte[1024];
        //            int length = fs.Read(buffer, 0, 1024);
        //            httpResponse.OutputStream.Write(buffer, 0, length);
        //            httpResponse.Flush();
        //            // only the remaining. 
        //            bytesToRead = bytesToRead - length;
        //        }
        //    }
        //    httpResponse.End();
        //}
        public void WriteFiletoBrowserOnCheckOut(HttpResponse httpResponse, int docID)
        {
            WriteFiletoBrowserForOnCheckOut(ConnectionHelper.GetCurrentCompany(), httpResponse, docID);
        }

        public void WriteFiletoBrowserForOnCheckOut(string company, HttpResponse httpResponse, int docID)
        {
            Document dtobject = Instance.ViewDocumentDetailsFor(company, docID);
            string contentType = string.Empty;
            if (!docservice.IsSharePoint)
            {
                string mimetype = Instance.GetMIMEType(dtobject.DocType.ToInt32_2(), company);
                contentType = (String.IsNullOrEmpty(mimetype) || mimetype == &quot;0&quot;)
                    ? &quot;application/octet-stream&quot;
                    : mimetype;
            }
            string downloadFileName = GetDownloadFileName(dtobject);
            docservice.WriteFiletoBrowserFor(company, httpResponse, dtobject.FolderDetails, dtobject.StorageId,
                downloadFileName, contentType, dtobject.SPName);
        }

        private string GetDownloadFileName(Document doc)
        {
            string fileName = string.Empty;
            foreach (KeyValuePair&lt;string, Type&gt; kvp in customizePageModelObjects)
            {
                CustomizePageModel cpm = CustomizePageModel.GetInstance(kvp.Key);
                if (cpm != null)
                {
                    Dictionary&lt;string, int&gt; additionalParameters = new Dictionary&lt;string, int&gt;();
                    additionalParameters.Add(&quot;DocumentId&quot;, doc.DocId);
                    additionalParameters.Add(&quot;VersionNumber&quot;, doc.VersionNo);
                    customizePageData = cpm.GetData(null, mode: &quot;GetDownloadFileName&quot;,
                        callerContext: &quot;DocumentCustomizePageModel&quot;, additionalParameters: additionalParameters);
                    fileName = customizePageData[&quot;DownloadFileName&quot;].ToString();
                }
            }
            if (string.IsNullOrEmpty(fileName))
            {
                fileName = doc.DocName;
            }
            return fileName;
        }

        public void ValidateExcelCustomized(string Ids, int projectID, int FolderID, Page context)
        {
            CustomizePageModel cpModel = GetCustomPageModelInstance();
            if (cpModel != null)
            {
                Dictionary&lt;string, string&gt; additionalParameters = new Dictionary&lt;string, string&gt;();
                additionalParameters.Add(&quot;FileIDs&quot;, Ids);
                additionalParameters.Add(&quot;ProjectID&quot;, projectID.ToString2());
                additionalParameters.Add(&quot;FolderID&quot;, FolderID.ToString2());
                cpModel.GetData(context, mode: &quot;CheckandValidateMetadata&quot;, callerContext: &quot;DocumentCustomizePageModel&quot;,
                    additionalParameters: additionalParameters);
            }
        }

        public string ValidateFileNameForCheckIn(int docId, string checkedOutFileName, string checkInFileName)
        {
            bool handled = false;
            string ValidateError = &quot;&quot;;
            foreach (KeyValuePair&lt;string, Type&gt; kvp in customizePageModelObjects)
            {
                CustomizePageModel cpm = CustomizePageModel.GetInstance(kvp.Key);
                if (cpm != null)
                {
                    handled = true;
                    Dictionary&lt;string, string&gt; additionalParameters = new Dictionary&lt;string, string&gt;();
                    additionalParameters.Add(&quot;CheckedOutFileName&quot;, checkedOutFileName);
                    additionalParameters.Add(&quot;CheckInFileName&quot;, checkInFileName);
                    additionalParameters.Add(&quot;DocId&quot;, docId.ToString());
                    customizePageData = cpm.GetData(null, mode: &quot;ValidateFileNameForCheckIn&quot;,
                        callerContext: &quot;DocumentCustomizePageModel&quot;, additionalParameters: additionalParameters);
                    if (customizePageData.ContainsKey(&quot;Result&quot;))
                        ValidateError = customizePageData[&quot;Result&quot;].ToString2();
                }
            }
            if (!handled)
            {
                if (checkedOutFileName.ToUpper2() != checkInFileName.ToUpper2())
                    ValidateError = &quot;Document name should be {0}. Request denied.&quot;.Format2(checkedOutFileName);
            }
            return ValidateError;
        }

        public int ValidateDocumentForMergeAndGetDestinationDocId(Document doc, int destinationFolderId)
        {
            int documentId = 0;
            DataTable dt =
                ComponentHelper.Instance.ExecuteDataSet(
                    DocumentStoredProcedure.usp_DOCMGMTGetSourceDocDetailsByFolderIdAndDocId, null, destinationFolderId,
                    doc.DocId).Tables[0];
            if (dt != null &amp;&amp; dt.Rows.Count &gt; 0)
            {
                documentId = Convert.ToInt32(dt.Rows[0][&quot;DocId&quot;]);
            }
            else
            {
                throw new Exception(&quot;Request Denied. Original Document has been deleted&quot;);
            }

            return documentId;
        }

        public void WriteFiletoBrowser(HttpResponse httpResponse, int docID)
        {
            //Document dtobject = Instance.ViewDocumentDetails(docID);
            //string contentType = string.Empty;
            //if (!docservice.IsSharePoint)
            //{
            //    string mimetype = Instance.GetMIMEType(dtobject.DocType.ToInt32_2());
            //    contentType = (String.IsNullOrEmpty(mimetype) || mimetype == &quot;0&quot;)
            //                      ? &quot;application/octet-stream&quot;
            //                      : mimetype;
            //}
            //docservice.WriteFiletoBrowser(httpResponse, dtobject.FolderDetails, dtobject.StorageId, dtobject.DocName, contentType, dtobject.SPName);
            WriteFiletoBrowserFor(ConnectionHelper.GetCurrentCompany(), httpResponse, docID);
        }

        public void WriteFiletoBrowserFor(string company, HttpResponse httpResponse, int docID)
        {
            Document dtobject = Instance.ViewDocumentDetailsFor(company, docID);
            string contentType = string.Empty;
            if (!docservice.IsSharePoint)
            {
                string mimetype = Instance.GetMIMEType(dtobject.DocType.ToInt32_2(), company);
                contentType = (String.IsNullOrEmpty(mimetype) || mimetype == &quot;0&quot;)
                    ? &quot;application/octet-stream&quot;
                    : mimetype;
            }
            string downloadFileName = GetDownloadFileName(dtobject);
            docservice.WriteFiletoBrowserFor(company, httpResponse, dtobject.FolderDetails, dtobject.StorageId,
                downloadFileName, contentType, dtobject.SPName);
        }

        public Stream GetVersionFileFromSP(string url)
        {
            return docservice.GetVersionFileFromSP(url);
        }

        bool IsGuid(string IsValidGUID)
        {
            Regex isGuid =
                new Regex(
                    @&quot;^(\{){0,1}[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}(\}){0,1}$&quot;,
                    RegexOptions.Compiled);
            bool isValid = false;
            if (IsValidGUID != null)
            {
                if (isGuid.IsMatch(IsValidGUID))
                    isValid = true;
            }
            return isValid;
        }

        public void WriteVersiontoBrowser(HttpResponse httpResponse, string url, string docName, string type)
        {
            if (IsSharePoint &amp;&amp; type == &quot;SP&quot;)
                docservice.WriteVersiontoBrowser(httpResponse, url, docName, string.Empty);
            else if (!IsSharePoint &amp;&amp; type == &quot;FS&quot;)
            {
                string storageid = url.Contains(&quot;_v&quot;) ? url.Split(&#39;_&#39;)[0] : url;
                if (IsGuid(storageid))
                {
                    object prmtrs = new object();
                    prmtrs = storageid;
                    DataSet ds =
                        ComponentHelper.Instance.ExecuteDataSet(
                            DocumentStoredProcedure.usp_DOCMGMTCheckStorageIDExists, null, prmtrs);
                    //DataSet ds = ComponentHelper.Instance.ExecuteDataSet(&quot;select StorageId from DOCMGMTDocument where StorageId=&#39;&quot; + storageid + &quot;&#39;&quot;);
                    if (ds != null &amp;&amp; ds.Tables.Count &gt; 0 &amp;&amp; ds.Tables[0].Rows.Count &gt; 0)
                    {
                        Document dtobject = Instance.GetDocumentDetails(url);
                        string contentType = string.Empty;
                        if (!docservice.IsSharePoint)
                        {
                            string mimetype = Instance.GetMIMEType(dtobject.DocType.ToInt32_2());
                            contentType = (String.IsNullOrEmpty(mimetype) || mimetype == &quot;0&quot;)
                                ? &quot;application/octet-stream&quot;
                                : mimetype;
                        }
                        string downloadFileName = GetDownloadFileName(dtobject);
                        docservice.WriteVersiontoBrowser(httpResponse, url, downloadFileName, contentType);
                    }
                }
            }
        }

        public Stream GetStream(string storageId)
        {
            if (docservice.IsSharePoint)
            {
                Document dto = Instance.GetDocumentDetails(storageId);
                WebResponse response =
                    docservice.GetSharePointStream(dto.FolderDetails ?? GetFolderDetails(dto.FolderId), storageId,
                        dto.DocName, dto.SPName);
                return response.GetResponseStream();
            }
            else
            {
                return (new MemoryStream(docservice.OpenDocument(null, storageId, null)));
            }
        }

        public DataSet GetFolderPermissions(int projectId, int folderId, int rid = 0, int uid = 0)
        {
            return DocumentComponent.Instance.GetFolderPermissions(projectId, folderId, rid, uid);
        }

        public bool CreateUpdateFolderPermissions(string xmlPermissions)
        {
            if (string.IsNullOrEmpty(xmlPermissions))
                return false;

            return DocumentComponent.Instance.CreateUpdateFolderPermissions(xmlPermissions);
        }

        public bool CheckForPermission(int projectId, int folderId, string feature)
        {
            List&lt;string&gt; featureCodes = GetPermissions(projectId, folderId);
            return featureCodes.Contains(feature);
        }

        public bool CheckForPermission(int projectId, int folderId, string feature, int userID, int roleID, string roleName)
        {
            List&lt;string&gt; featureCodes = GetPermissions(projectId, folderId, userID, roleID, roleName);
            return featureCodes.Contains(feature);
        }

        public List&lt;string&gt; GetPermissions(int projectId, int folderId)
        {
            return GetPermissions(projectId, folderId, UserDetail.GetCurrentUserDetail().UID, UserDetail.GetCurrentUserDetail().RID, UserDetail.GetCurrentUserDetail().RoleName);
        }

        public List&lt;string&gt; GetPermissions(int projectId, int folderId, int userID, int roleID, string roleName)
        {
            List&lt;string&gt; features = new List&lt;string&gt;();
            List&lt;int&gt; userRoleIds = new List&lt;int&gt;();

            bool isAdmin = false;
            if (userID == Constants.USRMGMT_ADMIN_UID)
                isAdmin = true;

            if (UserManager.Instance.IsUserAdministrator(userID))
                isAdmin = true;

            if (!isAdmin)
                isAdmin = UserManager.Instance.GetUserRolesBasedOnProjectId(userID, projectId, roleID, roleName)
                    .ContainsKey(Constants.USRMGMT_ADMIN_RID);

            int roleId = 0;

            if (!isAdmin)
            {

                if (ModuleManager.Instance.IsEffectivePermissionOfRoles())
                {
                    if (projectId != 0)
                    {
                        DataTable dtUserRoles = ProjectManager.Instance.GetProjectUserRoles(projectId, userID);
                        foreach (DataRow row in dtUserRoles.Rows)
                            userRoleIds.Add(row[&quot;RoleID&quot;].ToInt32_2());
                    }
                    else
                    {
                        Dictionary&lt;int, string&gt; userRoles = new Dictionary&lt;int, string&gt;();
                        int userId = UserDetail.GetCurrentUserDetail().UID;
                        userRoles = UserManager.Instance.GetAssignedRolesOfUser(userId);
                        userRoleIds.AddRange(userRoles.Keys.ToList());
                    }
                }
                else
                    userRoleIds.Add(roleId);
            }
            else
            {
                roleId = 0;
                userRoleIds.Add(Constants.USRMGMT_ADMIN_RID);
            }

            DataSet ds = DocumentComponent.Instance.GetFolderPermissions(projectId, folderId, roleId, userID);
            if (ds.Tables.Count &lt; 1) return null;

            foreach (DataRow row in ds.Tables[0].Rows)
            {
                if (row[&quot;Permission&quot;].ToString() == &quot;1&quot; &amp;&amp; userRoleIds.Contains(row[&quot;RoleId&quot;].ToInt32_2()) &amp;&amp; !features.Contains(row[&quot;FeatureCode&quot;].ToString()))
                    features.Add(row[&quot;FeatureCode&quot;].ToString());
            }
            return features;
        }

        private List&lt;int&gt; GetUserRolesForProject(int projectId)
        {
            int roleId = UserDetail.GetCurrentUserDetail().RID;

            List&lt;int&gt; userRoleIds = new List&lt;int&gt;();

            bool isAdmin = false;
            if (UserDetail.GetCurrentUserDetail().UID == Constants.USRMGMT_ADMIN_UID)
                isAdmin = true;

            if (UserManager.Instance.IsUserAdministrator(UserDetail.GetCurrentUserDetail().UID))
                isAdmin = true;

            if (!isAdmin)
                isAdmin = UserManager.Instance.GetUserRolesBasedOnProjectId(UserDetail.GetCurrentUserDetail().UID,
                    projectId,
                    UserDetail.GetCurrentUserDetail().RID, UserDetail.GetCurrentUserDetail().RoleName)
                    .ContainsKey(Constants.USRMGMT_ADMIN_RID);
            if (!isAdmin)
            {
                if (ModuleManager.Instance.IsEffectivePermissionOfRoles())
                {
                    roleId = 0;
                    DataTable dtUserRoles = ProjectManager.Instance.GetProjectUserRoles(projectId,
                        UserDetail.GetCurrentUserDetail().UID);
                    foreach (DataRow row in dtUserRoles.Rows)
                        userRoleIds.Add(row[&quot;RoleID&quot;].ToInt32_2());
                }
                else
                    userRoleIds.Add(roleId);
            }
            else
            {
                roleId = 0;
                userRoleIds.Add(Constants.USRMGMT_ADMIN_RID);
            }

            return userRoleIds;
        }

        public List&lt;string&gt; GetFolderPermissions(int folderId, int projectId, string moduleId, int instanceId, int userId, int roleId = 0, bool convertToLowercase = false)
        {
            List&lt;string&gt; features = new List&lt;string&gt;();
            List&lt;int&gt; userRoleIds;
            if (projectId != 0)
                userRoleIds = GetUserRolesForProject(projectId);
            else
            {
                userRoleIds = new List&lt;int&gt;();
                Dictionary&lt;int, string&gt; userRoles = new Dictionary&lt;int, string&gt;();
                userRoles = UserManager.Instance.GetAssignedRolesOfUser(userId);
                userRoleIds.AddRange(userRoles.Keys.ToList());
            }


            DataSet ds = DocumentComponent.Instance.GetFolderPermissions(folderId, projectId, moduleId, instanceId, userId, roleId);
            if (ds.Tables.Count &lt; 1) return features;

            foreach (DataRow row in ds.Tables[0].Rows)
            {
                if (row[&quot;Permission&quot;].ToString() == &quot;1&quot; &amp;&amp; userRoleIds.Contains(row[&quot;RoleId&quot;].ToInt32_2()) &amp;&amp;
                    !features.Contains(row[&quot;FeatureCode&quot;].ToString()))
                    features.Add(convertToLowercase ? row[&quot;FeatureCode&quot;].ToString().ToLower() : row[&quot;FeatureCode&quot;].ToString());
            }
            return features;

        }

        public DataTable GetDocumentMetadata()
        {
            DataSet d = ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTGetDocumentMetadata,
                null, null);
            if (d.Tables.Count &gt; 0)
                return (d.Tables[0]);
            else return (null);
        }

        public DataRow GetDocumentMetadataByID(string id)
        {
            object[] prmtrs = new object[1];
            prmtrs[0] = id;
            DataSet d = ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTGetDocumentMetadata,
                null, prmtrs);
            if (d.Tables.Count &gt; 0 &amp;&amp; d.Tables[0].Rows.Count &gt; 0)
                return d.Tables[0].Rows[0];
            else return null;
        }

        public bool InheritPermissionFromParent(int folderId)
        {
            return
                ComponentHelper.Instance.ExecuteScalar(DocumentStoredProcedure.usp_DOCMGMTInheritPermissionFromParent,
                    null, folderId).ToBoolean2();
        }

        public int AddDocumentDBEntry(string fileName, string storageID, string moduleType, string description, int author, string authorName, DateTime creationDate)
        {
            FileInfo fi =
                new FileInfo(Path.Combine(
                    Convert.ToString(ConfigurationManager.AppSettings[&quot;DocumentStorageLocation&quot;]), storageID));

            //create DTO and add to DB
            Document docdto = new Document();
            docdto.DocName = fileName;
            docdto.DocSize = Convert.ToString(Math.Round(Convert.ToDecimal(fi.Length) / 1024, 2)) + &quot;KB&quot;;
            docdto.DocType = 6; //will need work on thios
            docdto.ParentId = 0;
            docdto.VersionNo = 1;
            //TODO : need to verify this method call and its parameters
            docdto.FolderId = GetParentFolderIdForModule(string.Empty, string.Empty, moduleType, null);
            docdto.Status = false;
            docdto.StorageId = storageID;
            docdto.XMLInfo = &quot;&lt;XMLInfo&gt;&lt;/XMLInfo&gt;&quot;;
            docdto.DocDesc = description;
            docdto.CreationDate = creationDate;
            docdto.Author = author;
            docdto.AuthorName = authorName;
            docdto.CheckedBy = 0;

            return DocumentComponent.Instance.AddDocument(docdto);
        }

        public void DownloadZipToBrowser(List&lt;string&gt; zipFileList, string zipFile = &quot;Download.zip&quot;)
        {
            HttpResponse Response = HttpContext.Current.Response;
            Response.ContentType = &quot;application/zip&quot;;
            // If the browser is receiving a mangled zipfile, IIS Compression may cause this problem. Some members have found that
            //    Response.ContentType = &quot;application/octet-stream&quot;     has solved this. May be specific to Internet Explorer.

            Response.AppendHeader(&quot;content-disposition&quot;, string.Format(&quot;attachment; filename=\&quot;{0}\&quot;&quot;, zipFile));
            Response.CacheControl = &quot;Private&quot;;
            Response.Cache.SetExpires(DateTime.UtcNow.AddMinutes(3));
            // or put a timestamp in the filename in the content-disposition

            byte[] buffer = new byte[4096];

            ZipOutputStream zipOutputStream = new ZipOutputStream(Response.OutputStream);
            zipOutputStream.SetLevel(3); //0-9, 9 being the highest level of compression

            foreach (string fileName in zipFileList)
            {
                string[] file = fileName.Split(&#39;|&#39;);
                if (File.Exists(file[0]))
                {
                    Stream fs = File.OpenRead(file[0]); // or any suitable inputstream

                    ZipEntry entry = new ZipEntry(Path.GetFileName(file.Length == 1 ? fileName : file[1]));
                    entry.Size = fs.Length;
                    // Setting the Size provides WinXP built-in extractor compatibility,
                    //  but if not available, you can set zipOutputStream.UseZip64 = UseZip64.Off instead.

                    zipOutputStream.PutNextEntry(entry);

                    int count = fs.Read(buffer, 0, buffer.Length);
                    while (count &gt; 0)
                    {
                        zipOutputStream.Write(buffer, 0, count);
                        count = fs.Read(buffer, 0, buffer.Length);
                        if (!Response.IsClientConnected)
                        {
                            break;
                        }
                        //Response.Flush();
                    }
                    fs.Close();
                }
            }
            zipOutputStream.Close();

            Response.Flush();
            Response.End();
        }

        public void AddCommentLog(CommentLogDTO dtoCommentLog)
        {
            DocumentComponent.Instance.AddCommentLog(dtoCommentLog);
        }

        public void DeleteCommentLog(string commentLogIds)
        {
            DocumentComponent.Instance.DeleteCommentLog(commentLogIds);
        }

        public DataSet GetCommentLog(CommentLogDTO dtoCommentLog)
        {
            return DocumentComponent.Instance.GetCommentLog(dtoCommentLog);
        }

        public void UpdateCommentLog(CommentLogDTO dtoCommentLog)
        {
            DocumentComponent.Instance.UpdateCommentLog(dtoCommentLog);
        }

        public DataSet SearchAllDocuments(int projectID, string searchMode, string allWords, string exactWords,
            bool includeSynonyms, string notContains,
            string author, string title, string tags, string fileTypes, int lastModified, int folderId,
            bool recursiveSearch, int roleId,
            int createdBy, int createdOn, int modifiedBy)
        {
            return DocumentComponent.Instance.SearchAllDocuments(projectID, searchMode, allWords, exactWords,
                includeSynonyms, notContains, author, title, tags, fileTypes, lastModified, folderId, recursiveSearch,
                roleId, createdBy, createdOn, modifiedBy);
        }

        public void DeleteDocumentContent(string docIds)
        {
            DocumentComponent.Instance.DeleteDocumentContent(docIds);
        }

        public DataSet GetAllDocumentFolders(string moduleId, int instanceId, int RoleId, string strProjectDocument,
            string strEstimteDocument, string strContractDocument, string strSystemFolders = &quot;No&quot;)
        {
            return DocumentComponent.Instance.GetAllDocumentFolders(moduleId, instanceId, RoleId, strProjectDocument,
                strEstimteDocument, strContractDocument, strSystemFolders);
        }

        public void UpdateActivityLog(string Type, int EntityId, String Activity, string LogMessage, int UID = 0)
        {
            DocumentComponent.Instance.UpdateActivityLog(Type, EntityId, Activity, LogMessage, UID);
        }

        public DataSet GetRecentActivities(int NoRecords, int ProjectID, int RoleId)
        {
            return DocumentComponent.Instance.GetRecentActivities(NoRecords, ProjectID, RoleId);
        }

        public DataSet GetAllFilesAndFolders(int folderId, int instanceId, string moduleCode, string roleIds)
        {
            return DocumentComponent.Instance.GetAllFilesAndFolders(folderId, instanceId, moduleCode, roleIds);
        }

        public DataSet GetAllFolders(int folderId, int instanceId, string moduleCode)
        {
            return DocumentComponent.Instance.GetAllFolders(folderId, instanceId, moduleCode);
        }

        public void UpdateDocumentDetails(int folderId, string docXml, string docMetadataQuery)
        {
            ComponentHelper.Instance.ExecuteNonQueryWithVariableParameters(
                DocumentStoredProcedure.usp_DOCMGMTUpdateDocumentDetails, null, docXml, folderId);
            if (!string.IsNullOrEmpty(docMetadataQuery))
                ComponentHelper.Instance.ExecuteNonQuery(docMetadataQuery);
        }

        public DataSet GetAssociatedDocs(int docId, int? associationType = null)
        {
            return DocumentComponent.Instance.GetAssociatedDocs(docId, associationType);
        }

        public DataSet GetMissingAssociatedDocs(int docId)
        {
            return DocumentComponent.Instance.GetMissingAssociatedDocs(docId);
        }

        public DataSet GetAllDocumentsandFoldersWithRootFolder(string moduleId, int instanceId, int RoleId,
            string strProjectDocument, string strEstimteDocument, string strContractDocument, string strSystemFolders)
        {
            return DocumentComponent.Instance.GetAllDocumentsandFoldersWithRootFolder(moduleId, instanceId, RoleId,
                strProjectDocument, strEstimteDocument, strContractDocument, strSystemFolders);
        }

        public void CreateAssociation(int MasterDocId, string AsosciatedDocPath, int? AssociatedDocId,
            int AssociationTypeId, int projectId, int versionNo)
        {
            DocumentComponent.Instance.CreateAssociation(MasterDocId, AsosciatedDocPath, AssociatedDocId,
                AssociationTypeId, versionNo);
        }

        public void CreateAssociation(int MasterDocId, string AsosciatedDocPath, int? AssociatedDocId,
            int AssociationTypeId, int projectId)
        {
            DocumentComponent.Instance.CreateAssociation(MasterDocId, AsosciatedDocPath, AssociatedDocId,
                AssociationTypeId);
            if (AssociatedDocId != null)
            {
                List&lt;string&gt; CheckComponents =
                    Aurigo.AMP3.ModuleManagementBL.ModuleManager.Instance.GetModuleComponenets(Constants.MODID_DOCMGMT);
                if (CheckComponents.Contains(&quot;LogActivities&quot;))
                {
                    Document doc = DocumentManager.Instance.ViewDocumentDetails(AssociatedDocId.ToInt32_2());
                    Document Masterdoc = DocumentManager.Instance.ViewDocumentDetails(MasterDocId);
                    string mfoldername = DocumentManager.Instance.GetFolderName(Masterdoc.FolderId, getDisplayName: true);
                    string fname = DocumentManager.Instance.GetFolderName(doc.FolderId, getDisplayName: true);
                    string message;
                    string activity;
                    Dictionary&lt;string, object&gt; additionalParam = new Dictionary&lt;string, object&gt;();
                    additionalParam.Add(&quot;FolderId&quot;, doc.FolderId.ToString());
                    additionalParam.Add(&quot;RefDocId&quot;, AssociatedDocId.ToString());
                    Dictionary&lt;string, object&gt; resultObject =
                        DocumentManager.Instance.GetLogMessage(AssociatedDocId.ToInt32_2(), &quot;Associate&quot;, additionalParam);
                    message = HttpUtility.HtmlEncode(resultObject[&quot;message&quot;].ToString());
                    activity = resultObject[&quot;activity&quot;].ToString();
                    DocumentManager.Instance.UpdateActivityLog(&quot;Document&quot;, AssociatedDocId.ToInt32_2(),
                        String.Format(
                            &quot;&lt;ACTION&gt;{7}&lt;/ACTION&gt;&lt;DOCNAME&gt;&lt;![CDATA[{0}]]&gt;&lt;/DOCNAME&gt;&lt;AssociationType&gt;{1}&lt;/AssociationType&gt;&lt;MasterFile&gt;{2}&lt;/MasterFile&gt;&lt;MasterFolder&gt;{3}&lt;/MasterFolder&gt;&lt;FOLDER&gt;{4}&lt;/FOLDER&gt;&lt;FOLDERID&gt;{5}&lt;/FOLDERID&gt;&lt;PROJECTID&gt;{6}&lt;/PROJECTID&gt;&quot;,
                            doc.DocName, DocumentComponent.Instance.GetAssociationType(AssociationTypeId),
                            Masterdoc.DocName, mfoldername, fname, doc.FolderId, projectId, activity), message);
                }
            }
        }

        /// &lt;summary&gt;
        /// Gets all the documents in the Project.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;projectID&quot;&gt;Project ID for which the documents are to be fetched.&lt;/param&gt;
        /// &lt;returns&gt;DataSet with details of the documents for the project.&lt;/returns&gt;
        public DataTable GetDocumentsByProject(int projectID)
        {
            DataSet ds = DocumentComponent.Instance.GetDocumentsByProject(projectID);

            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0)
                return ds.Tables[0];

            return new DataTable();
        }

        /// &lt;summary&gt;
        /// Deletes all the documents that are associated to master documents by the specified assocaition type.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;masterDocID&quot;&gt;Document ID of the master document for which the associated documents are to be deleted.&lt;/param&gt;
        /// &lt;param name=&quot;associationType&quot;&gt;The type of association to be deleted.&lt;/param&gt;
        public void DeleteAllAssociatedDocs(int masterDocID, int associationType)
        {
            DocumentComponent.Instance.DeleteAllAssociatedDocs(masterDocID, associationType);
        }

        public DataSet GetAllAssociationTypes()
        {
            return DocumentComponent.Instance.GetAllAssociationTypes();
        }

        public Document GetMasterDocDetails(int AssociatedDocId)
        {
            return DocumentComponent.Instance.GetMasterDocDetails(AssociatedDocId);
        }

        public void DeleteAssociations(string DocIds)
        {
            DocumentComponent.Instance.DeleteAssociations(DocIds);
        }

        /// &lt;summary&gt;
        /// Compresses a folder to Zip file and downloads it.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;folderPath&quot;&gt;Path of the folder to compress&lt;/param&gt;
        /// &lt;param name=&quot;zipFile&quot;&gt;Name of the file while downloading&lt;/param&gt;
        public void DownloadZipToBrowser(string folderPath, string zipFile = &quot;Download.zip&quot;)
        {
            HttpResponse Response = HttpContext.Current.Response;
            Response.ContentType = &quot;application/zip&quot;;
            // If the browser is receiving a mangled zipfile, IIS Compression may cause this problem. Some members have found that
            //    Response.ContentType = &quot;application/octet-stream&quot;     has solved this. May be specific to Internet Explorer.

            Response.AppendHeader(&quot;content-disposition&quot;, string.Format(&quot;attachment; filename=\&quot;{0}\&quot;&quot;, zipFile));
            Response.CacheControl = &quot;Private&quot;;
            Response.Cache.SetExpires(DateTime.UtcNow.AddMinutes(3));
            // or put a timestamp in the filename in the content-disposition

            byte[] buffer = new byte[4096];

            ZipOutputStream zipOutputStream = new ZipOutputStream(Response.OutputStream);
            zipOutputStream.SetLevel(3); //0-9, 9 being the highest level of compression

            // This setting will strip the leading part of the folder path in the entries, to
            // make the entries relative to the starting folder.
            // To include the full path for each entry up to the drive root, assign folderOffset = 0.
            int folderOffset = folderPath.Length + (folderPath.EndsWith(&quot;\\&quot;) ? 0 : 1);

            CompressFolder(folderPath, zipOutputStream, folderOffset);

            zipOutputStream.IsStreamOwner = true; // Makes the Close also Close the underlying stream
            zipOutputStream.Close();

            Response.Flush();
            Response.End();
        }

        private void CompressFolder(string path, ZipOutputStream zipStream, int folderOffset)
        {
            string[] files = Directory.GetFiles(path);

            foreach (string filename in files)
            {
                FileInfo fi = new FileInfo(filename);

                string entryName = filename.Substring(folderOffset); // Makes the name in zip based on the folder
                entryName = ZipEntry.CleanName(entryName); // Removes drive from name and fixes slash direction
                ZipEntry newEntry = new ZipEntry(entryName);
                newEntry.DateTime = fi.LastWriteTime; // Note the zip format stores 2 second granularity

                // Specifying the AESKeySize triggers AES encryption. Allowable values are 0 (off), 128 or 256.
                // A password on the ZipOutputStream is required if using AES.
                //   newEntry.AESKeySize = 256;

                // To permit the zip to be unpacked by built-in extractor in WinXP and Server2003, WinZip 8, Java, and other older code,
                // you need to do one of the following: Specify UseZip64.Off, or set the Size.
                // If the file may be bigger than 4GB, or you do not need WinXP built-in compatibility, you do not need either,
                // but the zip will be in Zip64 format which not all utilities can understand.
                //   zipStream.UseZip64 = UseZip64.Off;
                newEntry.Size = fi.Length;

                zipStream.PutNextEntry(newEntry);

                // Zip the file in buffered chunks
                // the &quot;using&quot; will close the stream even if an exception occurs
                byte[] buffer = new byte[4096];
                using (FileStream streamReader = File.OpenRead(filename))
                {
                    StreamUtils.Copy(streamReader, zipStream, buffer);
                }
                zipStream.CloseEntry();
            }

            string[] folders = Directory.GetDirectories(path);

            foreach (string folder in folders)
            {
                CompressFolder(folder, zipStream, folderOffset);
            }
        }

        public void SaveDocDetails(string FID, string PID, string IID, string MID, string UID, string UName,
            Dictionary&lt;string, string&gt; additionalParams, string fileInfoName, string fileInfoFullName,
            byte[] byts, List&lt;string&gt; folderPermissions, string CheckinComment, out int result,
            bool requireValidation = true)
        {
            try
            {
                string storageid = string.Empty;
                result = DocumentManager.Instance.SaveDocument(FID.ToInt32_2(), fileInfoFullName, byts, UID.ToInt32_2(), UName,
                    DateTime.UtcNow, string.Empty, MID, false, IID, MID, additionalParams);
                if (result &gt; 0)
                {
                    LinksManager.Instance.AddLinks(fileInfoFullName, IID, MID, result.ToString(), &quot;DOCMGMT&quot;, UName, null, string.Empty, FID.ToInt32_2());
                }
                else if (result == -1)
                {
                    throw new Exception(&quot;Request denied. The file \&quot;&quot; + fileInfoName + &quot;\&quot; already exists in the project.&quot;);

                    #region CODE TO SUPERSEDE DOCUMENT
                    //COMMENTING IT FOR NOW. WE MIGHT NEED IT LATER
                    //try
                    //{
                    //    object[] parameters = new object[4];
                    //    parameters[0] = FID;
                    //    parameters[1] = fileInfoName;
                    //    parameters[2] = null;
                    //    parameters[3] = null;

                    //    DataTable dt =
                    //        ComponentHelper.Instance.ExecuteDataSet(DocumentStoredProcedure.usp_DOCMGMTGetDocsByFolder, null, parameters).Tables[0];


                    //    string docId = string.Empty;
                    //    if (dt != null &amp;&amp; dt.Rows.Count &gt; 0)
                    //    {
                    //        storageid = dt.Rows[0][&quot;StorageId&quot;].ToString2();
                    //        docId = dt.Rows[0][&quot;DocId&quot;].ToString2();
                    //    }

                    //    if (!folderPermissions.Contains(&quot;CheckOut&quot;))
                    //        throw new ApplicationException(
                    //            &quot;The current role does not have required permissions to check-out the existing document.&quot;);

                    //    bool result1 = DocumentManager.Instance.CheckOut(FID.ToInt32_2(), storageid, UID.ToInt32_2());
                    //    if (result1)
                    //    {
                    //        if (!folderPermissions.Contains(&quot;CheckIn&quot;))
                    //            throw new ApplicationException(
                    //                &quot;The current role does not have required permissions to check-in the existing document.&quot;);

                    //        result1 = DocumentManager.Instance.CheckIn(FID.ToInt32_2(), storageid, CheckinComment,
                    //            fileInfoName, byts, UID.ToInt32_2(), UName, PID.ToInt32_2());
                    //    }
                    //    else
                    //    {
                    //        Document doc = DocumentManager.Instance.GetDocumentDetails(storageid);

                    //        if (doc.CheckedBy == UID.ToInt32_2())
                    //        {
                    //            result1 = DocumentManager.Instance.CheckIn(FID.ToInt32_2(), storageid, string.Empty,
                    //                fileInfoName, byts, UID.ToInt32_2(), UName, PID.ToInt32_2());
                    //        }
                    //        else
                    //        {
                    //            Aurigo.AMP3.UserManagementDTO.User userDTO =
                    //                UserManager.Instance.GetUserDTO(doc.CheckedBy);
                    //            throw new Exception(&quot;The file \\\&quot;&quot; + Path.GetFileName(fileInfoFullName) +
                    //                                &quot;\\\&quot; already exists and is checked out to &quot; + userDTO.FirstName +
                    //                                &quot; &quot; + userDTO.LastName + &quot;.&quot;);
                    //        }
                    //    }

                    //    result = docId.ToInt32_2();
                    //}
                    //catch (Exception ex)
                    //{
                    //    throw new Exception(&quot;Request denied &quot; + ex.Message);
                    //}
                    #endregion
                }
                else if (result == -3)
                {
                    //throw new HttpResponseException(Request.CreateResponse(HttpStatusCode.NotAcceptable, &quot;One or more Document(s) are already Exists in the projects. Request denied.&quot;));
                    CustomizePageModel cpModel = DocumentManager.Instance.GetCustomPageModelInstance();

                    if (cpModel != null)
                    {
                        Dictionary&lt;string, object&gt; addParam = new Dictionary&lt;string, object&gt;();

                        addParam.Add(&quot;DocumentNumber&quot;, additionalParams[&quot;DocumentNumber&quot;]);
                        addParam.Add(&quot;DocName&quot;, fileInfoName);
                        addParam.Add(&quot;PID&quot;, PID);
                        addParam.Add(&quot;UID&quot;, UID);
                        addParam.Add(&quot;UName&quot;, UName);
                        addParam.Add(&quot;FileBytes&quot;, byts);

                        Dictionary&lt;string, object&gt; r = cpModel.GetData(null, &quot;AutoSuperSedeDocument&quot;, &quot;&quot;, addParam);

                        if (r.ContainsKey(&quot;IsSuccess&quot;) &amp;&amp; (bool)r[&quot;IsSuccess&quot;] == true)
                        {
                            result = r[&quot;DocID&quot;].ToInt32_2();
                        }
                        else
                        {
                            string message = (string)r[&quot;AutoSupersedeDocumentMessage&quot;];
                            throw new Exception(message);
                        }
                    }

                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
        }

        /// &lt;summary&gt;
        /// Gets the document details required to redirect to document list page.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;docId&quot;&gt;Document id for which details are required&lt;/param&gt;
        /// &lt;returns&gt;DataSet with document details&lt;/returns&gt;
        public DataSet GetDocumentDetailsForURL(int docId)
        {
            return DocumentComponent.Instance.GetDocumentDetailsForURL(docId);
        }

        /// &lt;summary&gt;
        /// Deletes all the associations for a document.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;docIds&quot;&gt;DocId of the document for which associations is to be deleted.&lt;/param&gt;
        public void DeleteAllAssociationsForDocument(string docIds)
        {
            DocumentComponent.Instance.DeleteAllAssociationsForDocument(docIds);
        }

        public void DeleteSelectedAssociationsForDocument(DataTable associationToBeRemoved)
        {
            DocumentComponent.Instance.DeleteSelectedAssociationsForDocument(associationToBeRemoved);
        }

        /// &lt;summary&gt;
        /// Send Email Notification when Document is Checked In
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;docId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;docname&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;folderName&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;projectId&quot;&gt;&lt;/param&gt;
        public void SendDocumentCheckInNotification(int docId, string docname, string folderName, int projectId)
        {
            DataSet dsDetails = DocumentComponent.Instance.GetCheckinNotificationDetails(docId, projectId);
            if (dsDetails != null &amp;&amp; dsDetails.Tables.Count == 2)
            {
                string toAddress = string.Empty;
                string body = string.Empty;
                string subject = string.Empty;
                ProjectDTO.Project project = ProjectManager.Instance.GetProjectDetails(projectId);
                UserDetail usr = UserDetail.GetCurrentUserDetail();
                DataTable dtUsers = new DataTable();
                if (dsDetails.Tables[0] != null &amp;&amp; dsDetails.Tables[0].Rows.Count &gt; 0)
                {
                    dtUsers = dsDetails.Tables[0];
                }
                if (dtUsers.Rows.Count &gt; 0)
                    dtUsers = dtUsers.DefaultView.ToTable(true, &quot;Email&quot;, &quot;Name&quot;);
                if (dsDetails.Tables[1] != null &amp;&amp; dsDetails.Tables[1].Rows[0] != null)
                {
                    subject = dsDetails.Tables[1].Rows[0][&quot;Subject&quot;].Equals(DBNull.Value)
                        ? string.Empty
                        : dsDetails.Tables[1].Rows[0][&quot;Subject&quot;].ToString2();
                    body = dsDetails.Tables[1].Rows[0][&quot;Body&quot;].Equals(DBNull.Value)
                        ? string.Empty
                        : dsDetails.Tables[1].Rows[0][&quot;Body&quot;].ToString2();
                }
                if (!string.IsNullOrEmpty(body) &amp;&amp; dtUsers.Rows.Count &gt; 0)
                {
                    foreach (DataRow dr in dtUsers.Rows)
                    {
                        if (!dr[&quot;Email&quot;].Equals(DBNull.Value))
                        {
                            Mailer.SendEmail(dr[&quot;Email&quot;].ToString2(), subject.Format2(docname),
                                body.Format2(dr[&quot;Name&quot;].ToString2(), docname, folderName, project.ProjectName));
                        }
                    }
                }
            }
        }

        public DataSet GetDocumentMetadataDetails(int docId, string revisionNumber, DateTime updatedOn)
        {
            return DocumentComponent.Instance.GetDocumentMetadataDetails(docId, revisionNumber, updatedOn);
        }

        public List&lt;Document&gt; GetDocumentBasedOnDocID(string DocIDs)
        {
            return DocumentComponent.Instance.GetDocumentBasedOnDocumentID(DocIDs);
        }

        public DataTable GetFolderMappingForMD(string selectedMetadata)
        {
            return DocumentComponent.Instance.GetFolderMappingForMD(selectedMetadata);
        }

        public DataTable GetFolderRulesForMD(string selectedMetadata)
        {
            return DocumentComponent.Instance.GetFolderRulesForMD(selectedMetadata);
        }

        /// &lt;summary&gt;
        /// Gets a document.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;docId&quot;&gt;DocId of the document to be retrieved.&lt;/param&gt;
        /// &lt;returns&gt;Byte Array containing the document&lt;/returns&gt;
        public byte[] GetDocumentAsByteArrayByID(int docId)
        {
            Document doc = ViewDocumentDetails(docId);

            return ViewDocument(doc.StorageId);
        }

        public void SaveDocumentContent(string storageId, string docName, string docType, byte[] docstream,
            string docDesc)
        {
            DocumentComponent.Instance.SaveDocumentContent(storageId, docName, docType, docstream, docDesc);
        }

        /// &lt;summary&gt;
        /// Gets the annotation details created by the specified user.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;docID&quot;&gt;DocId of the document on which the annotations are done.&lt;/param&gt;
        /// &lt;param name=&quot;userID&quot;&gt;UserId of the user who created the annotation.&lt;/param&gt;
        /// &lt;param name=&quot;versionNo&quot;&gt;Version No of the document.&lt;/param&gt;
        /// &lt;returns&gt;DataTable containing the details of the annotation.&lt;/returns&gt;
        public DataTable GetAnnotationDetailsByUser(int docID, int userID, int versionNo)
        {
            DataSet ds = DocumentComponent.Instance.GetAnnotationDetailsByUser(docID, userID, versionNo);

            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0)
                return ds.Tables[0];

            return new DataTable();
        }

        /// &lt;summary&gt;
        /// Saves annotation to the database.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;dto&quot;&gt;DocumentAnnotation object containing details of the annotation.&lt;/param&gt;
        public void SaveAnnotations(DocumentAnnotation dto)
        {
            DocumentComponent.Instance.SaveAnnotations(dto);
        }

        public byte[] MergeDocumentWithAnnotation(DocumentAnnotation docAnnotation, Document document)
        {
            string tempFile = Path.GetTempFileName();
            string tempFileWithAnnotation = Path.GetTempFileName();
            DocumentWebService docservice = new DocumentWebService();
            byte[] documentBytes = docservice.OpenDocument(document.FolderDetails, document.StorageId, document.DocName);

            string annotationData = string.Empty, docName = &quot;&quot;;

            if (docAnnotation.DocumentID != 0)
            {
                annotationData = docAnnotation.AnnotationData;
                docName = docAnnotation.DocumentName;
            }

            if (documentBytes.Length &lt; 1)
                throw new Exception(&quot;Requested document could not be found.&quot;);

            pdftron.PDF.PDFDoc doc = new pdftron.PDF.PDFDoc(documentBytes, documentBytes.Length);
            doc.InitSecurityHandler();

            if (!string.IsNullOrEmpty(annotationData))
            {
                File.WriteAllText(tempFile, annotationData);
                FDFDoc docAnnot = new FDFDoc(FDFDoc.CreateFromXFDF(tempFile));
                doc.FDFMerge(docAnnot);
            }

            doc.Save(tempFileWithAnnotation, pdftron.SDF.SDFDoc.SaveOptions.e_linearized);
            return File.ReadAllBytes(tempFileWithAnnotation);
        }

        /// &lt;summary&gt;
        /// Gets the annotation details.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;documentAnnotationId&quot;&gt;ID of the annotation to be retrieved.&lt;/param&gt;
        /// &lt;returns&gt;DocumentAnnotation object containing details of annotation.&lt;/returns&gt;
        public DocumentAnnotation GetAnnotationDetails(int documentAnnotationId)
        {
            DataSet ds = DocumentComponent.Instance.GetAnnotationDetails(documentAnnotationId);

            if (ds == null || ds.Tables.Count == 0)
                return new DocumentAnnotation();

            DataRow dr = ds.Tables[0].Rows[0];

            return DocumentAnnotation.FromDataRow(dr);
        }

        /// &lt;summary&gt;
        /// Gets list of annotations for consolidation.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;docId&quot;&gt;DocId of the document for which annotations are required.&lt;/param&gt;
        /// &lt;param name=&quot;versionNo&quot;&gt;VersionNumber of the document for which annotations are required.&lt;/param&gt;
        /// &lt;returns&gt;List&lt;DocumentAnnotation&gt; object containing list of annotations.&lt;/returns&gt;
        public List&lt;DocumentAnnotation&gt; GetAnnotationsForConsolidation(int docId, int versionNo)
        {
            List&lt;DocumentAnnotation&gt; annotList = new List&lt;DocumentAnnotation&gt;();
            DataSet ds = DocumentComponent.Instance.GetAnnotationsForConsolidation(docId, versionNo);

            if (ds == null || ds.Tables.Count == 0)
                return annotList;

            annotList = DocumentAnnotation.FromDataTable(ds.Tables[0]);

            return annotList;
        }

        /// &lt;summary&gt;
        /// Gets the list of reviewed documents for a document.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;docId&quot;&gt;DocId of the document whose reviewed documents are required.&lt;/param&gt;
        /// &lt;returns&gt;DataTable containing details of the reviewed documents.&lt;/returns&gt;
        public DataTable GetAllReviewDocuments(int docId)
        {
            DataSet ds = DocumentComponent.Instance.GetAllReviewDocuments(docId);

            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0)
                return ds.Tables[0];

            return new DataTable();
        }

        /// &lt;summary&gt;
        /// Gets the Project Id from the document id.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;docId&quot;&gt;DocId of the document for which projectid is required.&lt;/param&gt;
        /// &lt;returns&gt;ProjectId&lt;/returns&gt;
        public int GetProjectIdFromDocumentId(int docId)
        {
            return DocumentComponent.Instance.GetProjectIdFromDocumentId(docId);
        }

        public int GetProjectIdFromDocumentId(int docId, int folderId)
        {
            return DocumentComponent.Instance.GetProjectIdFromDocumentId(docId, folderId);
        }

        public int GetProjectIdFromFolderId(int folderId)
        {
            return DocumentComponent.Instance.GetProjectIdFromFolderId(folderId);
        }

        /// &lt;summary&gt;
        /// Deletes all the annotations related to the documents specified, including all versions of the document.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;docid&quot;&gt;DocIds of the documents whose annotations are to be deleted&lt;/param&gt;
        public void DeleteAnnotations(string docIds)
        {
            DocumentComponent.Instance.DeleteAnnotations(docIds);
        }

        public string GetOnUploadStartScript()
        {
            string script = string.Empty;

            foreach (KeyValuePair&lt;string, Type&gt; kvp in customizePageModelObjects)
            {
                CustomizePageModel cpm = CustomizePageModel.GetInstance(kvp.Key);
                if (cpm != null)
                {
                    customizePageData = cpm.GetData(null, mode: &quot;GetOnUploadStartScript&quot;,
                        callerContext: &quot;DocumentCustomizePageModel&quot;, additionalParameters: null);
                    script = customizePageData[&quot;GetOnUploadStartScript&quot;].ToString2();
                }
            }
            return script;
        }

        /// &lt;summary&gt;
        /// Gets the MIME type id from the File extention
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;filetype&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public int GetTypeID(byte[] fileBytes)
        {
            string mimeType = MimeTypeFrom(fileBytes, &quot;&quot;);
            return DocumentComponent.Instance.GetTypeId(mimeType);
        }

        public void SaveAttachmentMetadata(int linkId, string metaDataXML)
        {
            DocumentComponent.Instance.SaveAttachmentMetadata(linkId, metaDataXML);
        }

        public DataSet GetAttachmentMetadata(string linkIds)
        {
            return DocumentComponent.Instance.GetAttachmentMetadata(linkIds);
        }

        public DataTable GetAllLinksOfDocument(int docId)
        {
            DataSet ds = DocumentComponent.Instance.GetAllLinksOfDocument(docId);
            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0)
                return ds.Tables[0];
            else
                return null;
        }

        public bool CheckDocumentExistsInProject(string docName, int projectID)
        {
            return DocumentComponent.Instance.CheckDocumentExistsInProject(docName, projectID);
        }

        public DataTable GetFoldersHierarchy(int instanceId, string moduleID, string roleIds, bool showProjectDocs,
            bool showEstimateDocs, bool showContractDocs, int userId, int PID)
        {
            object[] parameters = new object[8];
            parameters[0] = instanceId;
            parameters[1] = moduleID;
            parameters[2] = roleIds;
            parameters[3] = showProjectDocs ? &quot;Yes&quot; : &quot;&quot;;
            parameters[4] = showEstimateDocs ? &quot;Yes&quot; : &quot;&quot;;
            parameters[5] = showContractDocs ? &quot;Yes&quot; : &quot;&quot;;
            parameters[6] = userId;
            parameters[7] = PID;

            DataSet ds = DocumentComponent.Instance.GetFoldersHierarchy(parameters);
            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0)
                return ds.Tables[0];
            else
                return null;
        }

        public DataTable GetDocumentDetailsForSyncEstimate(int instanceId, string moduleId, int userID, int PID,
           string deletedFolderIds, string deletedDocIds, string existingDocIds,
           string offlineFolderFromMobileDevice, string onlineFolderFromMobileDevice,
           string offlineDocsFromMobileDevice, string onlineDocsFromMobileDevice, string existingAnnotationIds)
        {
            DataSet ds = DocumentComponent.Instance.GetDocumentDetailsForSyncEstimate(instanceId, moduleId, userID, PID,
                deletedFolderIds, deletedDocIds, existingDocIds,
                offlineFolderFromMobileDevice, onlineFolderFromMobileDevice,
                offlineDocsFromMobileDevice, onlineDocsFromMobileDevice, existingAnnotationIds);
            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0)
                return ds.Tables[0];
            else
                return null;
        }

        public DataTable GetDocumentDetailsForSyncEstimate(string projectDetailsJSON, int userId)
        {
            List&lt;SyncEstimateDocumentDetails&gt; projectDetails =
                JsonConvert.DeserializeObject&lt;List&lt;SyncEstimateDocumentDetails&gt;&gt;(projectDetailsJSON);
            DataTable dtResults = new DataTable();
            dtResults.Columns.AddRange(new[] {
                new DataColumn(&quot;PID&quot;, Type.GetType(&quot;System.Int32&quot;)),
                new DataColumn(&quot;AllFoldersCount&quot;, Type.GetType(&quot;System.Int32&quot;)),
                new DataColumn(&quot;OfflineFoldersCount&quot;, Type.GetType(&quot;System.Int32&quot;)),
                new DataColumn(&quot;AllDocumentsCount&quot;, Type.GetType(&quot;System.Int32&quot;)),
                new DataColumn(&quot;OfflineDocumentsCount&quot;, Type.GetType(&quot;System.Int32&quot;)),
                new DataColumn(&quot;OfflineDocumentsAnnotationsCount&quot;, Type.GetType(&quot;System.Int32&quot;)),
                new DataColumn(&quot;AllDocumentsSizeInKB&quot;, Type.GetType(&quot;System.Int32&quot;)),
                new DataColumn(&quot;OfflineDocumentsSizeInKB&quot;, Type.GetType(&quot;System.Int32&quot;)),
                new DataColumn(&quot;OfflineDocumentsAnnotationsSizeInKB&quot;, Type.GetType(&quot;System.Int32&quot;))
            });

            foreach (SyncEstimateDocumentDetails projData in projectDetails)
            {
                int contractID = 0;
                object objContId = ComponentHelper.Instance.ExecuteScalar(StoredProcedure.usp_CONTMGTGetTopContract, null,
                    projData.PID);
                if (objContId != null)
                    contractID = objContId.ToInt32_2();
                if (contractID &gt; 0)
                {
                    string downloadedDocuments = string.Empty;
                    var serializer = new XmlSerializer(typeof(List&lt;SyncEstimateDownloadedDocumentDetails&gt;), new XmlRootAttribute(&quot;XMLRoot&quot;));
                    using (var stream = new StringWriter())
                    {
                        serializer.Serialize(stream, projData.DownloadedDocuments);
                        downloadedDocuments = stream.ToString();
                    }

                    string downloadedAnnotations = string.Empty;
                    var serializer1 = new XmlSerializer(typeof(List&lt;SyncEstimateDownloadedAnnotationDetails&gt;), new XmlRootAttribute(&quot;XMLRoot&quot;));
                    using (var stream = new StringWriter())
                    {
                        serializer1.Serialize(stream, projData.DownloadedAnnotations);
                        downloadedAnnotations = stream.ToString();
                    }

                    DataTable dt = GetDocumentDetailsForSyncEstimate(contractID, Constants.MODID_CONTMGT, userId, projData.PID,
                        projData.DeletedFolderIDs, projData.DeletedDocumentIDs, downloadedDocuments,
                        projData.OfflineFolderIDs, projData.OnlineFolderIDs,
                        projData.DocumentIDsMarkedOffline, projData.DocumentIDsMarkedOnline, downloadedAnnotations);

                    if (dt != null &amp;&amp; dt.Rows.Count &gt; 0)
                        dtResults.ImportRow(dt.Rows[0]);
                }
            }
            return dtResults;
        }

        public DataTable GetPaginatedFoldersForProject(int PID, UserDetail userDetails, int lastSyncedFolderId, int pageSize,
            bool showSystemFolders, int systemFolderParentID, string systemFolderParentName, out bool hasMoreRows)
        {
            hasMoreRows = false;

            int contractID = 0;
            object objContId = ComponentHelper.Instance.ExecuteScalar(StoredProcedure.usp_CONTMGTGetTopContract, null,
                PID);
            if (objContId != null)
                contractID = objContId.ToInt32_2();
            if (contractID &gt; 0)
            {
                DataSet ds = DocumentComponent.Instance.GetPaginatedFoldersForProject(PID, contractID, Constants.MODID_CONTMGT,
                    userDetails.UID, lastSyncedFolderId, pageSize, showSystemFolders, systemFolderParentID, systemFolderParentName);
                if (ds != null &amp;&amp; ds.Tables.Count &gt; 1)
                {
                    int remainingRows = ds.Tables[1].Rows[0][&quot;RemainingRows&quot;].ToInt32_2();
                    if (remainingRows &gt; 0)
                        hasMoreRows = true;

                    return AddPermissions(ds.Tables[0], PID, userDetails);
                }
            }
            return null;
        }

        private DataTable AddPermissions(DataTable dtFolders, int PID, UserDetail userDetails)
        {
            //Get all applicable permissions
            Dictionary&lt;string, bool&gt; permissionDic = new Dictionary&lt;string, bool&gt;() {
                {&quot;Visibility&quot; , false},
                {&quot;CreateSF&quot;, false},
                { &quot;EditF&quot;, false},
                { &quot;DeleteF&quot;, false},
                { &quot;Upload&quot;,false},
                { &quot;EditD&quot;, false},
                { &quot;ViewD&quot;, false},
                { &quot;DownloadD&quot;, false},
                { &quot;DeleteD&quot;, false},
                { &quot;Copy&quot;,false}
            };


            //Add PermissionJsonArray column
            if (!dtFolders.Columns.Contains(&quot;PermissionJsonArray&quot;))
                dtFolders.Columns.Add(&quot;PermissionJsonArray&quot;);

            foreach (DataRow row in dtFolders.Rows)
            {
                Dictionary&lt;string, bool&gt; folderPerms = new Dictionary&lt;string, bool&gt;(permissionDic);

                int folderId = row[&quot;FolderID&quot;].ToInt32_2();
                GetPermissions(PID, folderId, userDetails.UID, userDetails.RID, userDetails.RoleName).ForEach(p =&gt;
                {
                    if (folderPerms.ContainsKey(p))
                        folderPerms[p] = true;
                });

                string permissionJson = JsonConvert.SerializeObject(folderPerms);
                row[&quot;PermissionJsonArray&quot;] = permissionJson;
            }

            return dtFolders;
        }

        public DataTable GetPaginatedDocumentsForFolder(int folderId, int currentUserId, int lastSyncedDocId, string lastSyncedDate, int pageSize, out bool hasMoreRows)
        {
            hasMoreRows = false;
            DataSet ds = DocumentComponent.Instance.GetPaginatedDocumentsForFolder(folderId, currentUserId, lastSyncedDocId, lastSyncedDate, pageSize);
            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0)
            {
                int remainingRows = ds.Tables[1].Rows[0][&quot;RemainingRows&quot;].ToInt32_2();
                if (remainingRows &gt; 0)
                    hasMoreRows = true;

                return ds.Tables[0];
            }
            return null;
        }

        public string GetValidLinkIdsForFolder(int folderId)
        {
            object linkIds = DocumentComponent.Instance.GetValidLinkIdsForFolder(folderId);
            if (linkIds != null)
                return linkIds.ToString();
            else
                return string.Empty;
        }

        public void CreateOrUpdateDocumentOfflineSettings(string type, string typeInstanceId, int PID,
           int userID, DateTime modifiedOn, bool isOffline)
        {
            DocumentComponent.Instance.CreateOrUpdateDocumentOfflineSettings(type, typeInstanceId, PID,
                userID, modifiedOn, isOffline);
        }

        public void GetOfflineSettingsForFolder(int projectId, int folderId, int userId, out bool isOffline, out bool isOfflineBecauseOfParent)
        {
            DocumentComponent.Instance.GetOfflineSettingsForFolder(projectId, folderId, userId, out isOffline, out isOfflineBecauseOfParent);
        }

        public Stream GetDocumentSteam(string storageID)
        {
            string storageConfiguration = string.Empty;
            if (AMP3ApplicationSettings.Instance.appSettings.ContainsKey(&quot;DocumentReadWriteLocation&quot;))
                storageConfiguration =
                    AMP3ApplicationSettings.Instance.appSettings[&quot;DocumentReadWriteLocation&quot;].ToString();

            StorageConfiguration config = (StorageConfiguration)Enum.Parse(typeof(StorageConfiguration), storageConfiguration, true);
            Stream file = null;
            switch (config)
            {
                case StorageConfiguration.DBVARBINARY:
                    file = ReadFromDBVarBinary(storageID);
                    break;
                case StorageConfiguration.DBFILESTREAM:
                    file = ReadFromDBFileStream(storageID);
                    break;
                case StorageConfiguration.FILESYSTEM:
                    file = ReadFromFileSystem(storageID);
                    break;
            }
            return file;
        }
        public void CreateAnnotation(int docID, int versionNo, int linkID, string annotationFile)
        {
            string annotationName = UserDetail.GetCurrentUserDetail().UserID + &quot;_&quot; + MWDateTimeHelper.MWNow.ToString(&quot;yyyyMMddHHmmss&quot;);
            DocumentComponent.Instance.CreateAnnotation(docID, versionNo, linkID, annotationFile, UserDetail.GetCurrentUserDetail().UserID, UserDetail.GetCurrentUserDetail().UID, annotationName);
        }

        public void UpdateAnnotation(int docID, int versionNo, int linkID, string annotationFile, int annotationID)
        {
            DocumentComponent.Instance.UpdateAnnotation(docID, versionNo, linkID, annotationFile, UserDetail.GetCurrentUserDetail().UserID, UserDetail.GetCurrentUserDetail().UID, string.Empty, annotationID);
        }

        public string GetAnnotation(int docID, int annotationID)
        {
            string result = string.Empty;
            DataSet ds = DocumentComponent.Instance.GetAnnotation(docID, annotationID);
            if (ds.Tables.Count &gt; 0 &amp;&amp; ds.Tables[0].Rows.Count &gt; 0)
            {
                result = ds.Tables[0].Rows[0][&quot;AnnotationFile&quot;].ToString2();
            }

            return result;
        }

        public int GetLinkIdForDocument(int docId, string moduleId, int srcId)
        {
            int result = 0;
            DataSet ds = DocumentComponent.Instance.GetLinkIdForDocument(docId, moduleId, srcId);
            if (ds.Tables.Count &gt; 0 &amp;&amp; ds.Tables[0].Rows.Count &gt; 0)
            {
                result = ds.Tables[0].Rows[0][&quot;LinkID&quot;].ToInt32_2();
            }

            return result;
        }

        public void UpdateFormInstanceTimestamp(int linkID)
        {
            DocumentComponent.Instance.UpdateFormInstanceTimestamp(linkID);
        }

        private Stream ReadFromDBVarBinary(string storageId)
        {
            byte[] buffer =
                (byte[])
                    ComponentHelper.Instance.ExecuteScalar(&quot;select DocumentContent  from DOCMGMTDocumentContent where StorageID={0}&quot;, storageId);

            return new MemoryStream(buffer);
        }

        private Stream ReadFromDBFileStream(string storageId)
        {
            using (TransactionScope transactionScope = new TransactionScope())
            {
                string query =
                    &quot;select DocumentContent.PathName()As Path,	GET_FILESTREAM_TRANSACTION_CONTEXT() As TransactionContext from DOCMGMTDocumentContent where StorageID={0}&quot;;

                DataSet ds = ComponentHelper.Instance.ExecuteDataSet(query, storageId);

                // check for existence of the table and row
                if (ds.Tables[0] != null &amp;&amp; ds.Tables[0].Rows.Count &gt; 0)
                {
                    string filePath = ds.Tables[0].Rows[0][&quot;Path&quot;].ToString();
                    byte[] transactionContext = (byte[])ds.Tables[0].Rows[0][&quot;TransactionContext&quot;];


                    SqlFileStream sfs = new SqlFileStream(filePath, transactionContext, FileAccess.Read);
                    byte[] data = new byte[sfs.Length];
                    sfs.Read(data, 0, Convert.ToInt32(sfs.Length));
                    Stream stream = new MemoryStream(data);
                    return stream;
                }
            }

            return null;
        }

        private Stream ReadFromFileSystem(string storageId)
        {
            //get the document storage path
            DocumentWebService dws = new DocumentWebService();
            string storagePath = dws.docStoragePath;

            //get the file
            string filePath = Path.Combine(storagePath, storageId);

            return new FileStream(filePath, FileMode.Open, FileAccess.Read);
        }

        internal DataTable ValidateOfflineFolderSettings(string folderIds, int userId, bool checkForOffline)
        {
            DataSet ds = DocumentComponent.Instance.ValidateOfflineFolderSettings(folderIds, userId, checkForOffline);
            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0)
                return ds.Tables[0];
            else
                return null;
        }

        internal DataTable GetAnnotationDetailsForDocumentList(string docAnnotationsXML)
        {
            DataSet ds = DocumentComponent.Instance.GetAnnotationDetailsForDocumentList(docAnnotationsXML);
            if (ds != null &amp;&amp; ds.Tables.Count &gt; 0)
                return ds.Tables[0];
            else
                return null;
        }

        internal void LockDocumentForSigning(int docId, string lockedBy)
        {
            DocumentComponent.Instance.LockDocumentForSigning(docId, lockedBy);
        }

        public void UnlockDocumentForSigning(int docId)
        {
            DocumentComponent.Instance.UnlockDocumentForSigning(docId);
        }

        public void ConvertToPDF(string inputFilePath, string outputFilePath)
        {
            if (!string.IsNullOrWhiteSpace(inputFilePath) &amp;&amp; !string.IsNullOrWhiteSpace(outputFilePath))
            {
                HttpResponseMessage response = new HttpResponseMessage();
                var client = new LeadHttpClient();
                string fileExtension = Path.GetExtension(inputFilePath);

                using (Stream inputfile = File.OpenRead(inputFilePath))
                {
                    response = client.PostStreamResponse(string.Format(&quot;/api/Converter/ConvertToPDF?inputFileType={0}&quot;, fileExtension), inputfile);
                }

                if (response.StatusCode == HttpStatusCode.OK)
                {
                    using (Stream outputfile = response.Content.ReadAsStreamAsync().Result)
                    {
                        using (FileStream output = new FileStream(outputFilePath, FileMode.Create))
                        {
                            outputfile.CopyTo(output);
                        }
                    }
                }
                else
                {
                    string errorMessage = response.Content.ReadAsStringAsync().Result;
                    Logger.Log(Enumerations.LogType.Error, errorMessage, &quot;LeadTools Document Conversion API&quot;);
                }
            }
        }

        public bool CheckIsUserAuthorisedForInboxDocument(int userID, int DocID)
        {
            return DocumentComponent.Instance.CheckIsUserAuthorisedForInboxDocument(userID, DocID);
        }
    }

    public enum StorageConfiguration
    {
        DBVARBINARY,
        DBFILESTREAM,
        FILESYSTEM
    }

    public class DocumentsBreadCrumb : BreadCrumbBase
    {
        public DocumentsBreadCrumb()
        {
        }

        public DocumentsBreadCrumb(string folderId)
        {
            FID = folderId;
        }

        private string _folderId;

        private string FID
        {
            get
            {
                if (string.IsNullOrEmpty(_folderId))
                    _folderId = HttpContext.Current.Request.QueryString[&quot;FID&quot;];
                return _folderId;
            }
            set { _folderId = value; }
        }

        public override string Title
        {
            get { return LocalizationManager.GetString(&quot;Documents&quot;); }
        }

        public override string URL
        {
            get
            {
                string pid = HttpContext.Current.Request.QueryString[&quot;PID&quot;];
                //string FID = HttpContext.Current.Request.QueryString[&quot;FID&quot;];
                string IID = HttpContext.Current.Request.QueryString[&quot;IID&quot;];
                string MID = HttpContext.Current.Request.QueryString[&quot;MID&quot;];
                return string.Format(&quot;/Common/BrixListPage.aspx?context=DOCMGMT&amp;FID={0}&amp;PID={1}&amp;IID={2}&amp;MID={3}&quot;, FID,
                    pid, IID, MID);
            }
        }

        public override BreadCrumbBase parent
        {
            get { return new ProjectBreadCrumb(); }
        }
    }

    [Context(Name = Constants.MODID_DOCMGMT)]
    public class DocumentBreadCrumb : BreadCrumbBase
    {
        public DocumentBreadCrumb()
        {
        }

        public DocumentBreadCrumb(string folderId)
        {
            FID = folderId;
        }

        private string _folderId = &quot;&quot;;

        private string FID
        {
            get
            {
                if (string.IsNullOrEmpty(_folderId))
                    _folderId = HttpContext.Current.Request.QueryString[&quot;FID&quot;];
                return _folderId;
            }
            set { _folderId = value; }
        }

        private Folder FolderDetails
        {
            get { return DocumentManager.Instance.GetFolderDetails(Convert.ToInt32(FID)); }
        }

        public override string Title
        {
            get
            {
                return (FolderDetails.ParentId == 0)
                    ? LocalizationManager.GetString(&quot;Documents&quot;)
                    : FolderDetails.FolderName;
            }
        }

        public override string URL
        {
            get
            {
                string pid = HttpContext.Current.Request.QueryString[&quot;PID&quot;];
                //string FID = HttpContext.Current.Request.QueryString[&quot;FID&quot;];
                string IID = HttpContext.Current.Request.QueryString[&quot;IID&quot;];
                string MID = HttpContext.Current.Request.QueryString[&quot;MID&quot;];
                return string.Format(&quot;/Common/BrixListPage.aspx?context=DOCMGMT&amp;FID={0}&amp;PID={1}&amp;IID={2}&amp;MID={3}&quot;, FID,
                    pid, IID, MID);
            }
        }

        public override BreadCrumbBase parent
        {
            get
            {
                Folder parentFolder = DocumentManager.Instance.GetFolderDetails(FolderDetails.ParentId);
                if (FolderDetails.ParentId == 0)
                    return new ProjectBreadCrumb();
                else if (parentFolder.ParentId == 0)
                    return new DocumentsBreadCrumb(FolderDetails.ParentId.ToString());
                else
                    return new DocumentBreadCrumb(FolderDetails.ParentId.ToString());
            }
        }
   
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[55,9,57,29,1],[57,29,57,116,1],[57,116,58,36,1],[58,36,58,41,0],[58,41,58,48,1],[58,48,58,55,0],[58,55,58,57,1],[55,9,58,57,1],[60,9,60,61,1],[61,52,61,56,0],[61,57,61,61,0],[73,13,73,14,0],[74,17,74,38,0],[75,17,75,18,0],[76,21,76,55,0],[77,21,77,111,0],[78,21,78,66,0],[79,25,79,88,0],[80,17,80,18,0],[81,17,81,33,0],[82,13,82,14,0],[88,13,88,14,0],[89,17,89,46,0],[90,17,90,18,0],[91,21,91,70,0],[92,21,92,66,0],[93,21,93,90,0],[94,21,94,22,0],[95,25,95,32,0],[95,34,95,43,0],[95,44,95,46,0],[95,47,95,71,0],[96,25,96,26,0],[97,29,97,120,0],[98,25,98,26,0],[99,21,99,22,0],[100,17,100,18,0],[101,17,101,41,0],[102,13,102,14,0],[107,9,107,34,1],[108,9,108,10,1],[109,13,109,51,1],[110,13,110,79,1],[111,9,111,10,1],[115,17,115,18,1],[115,19,115,50,1],[115,51,115,52,1],[120,17,120,18,0],[120,19,120,52,0],[120,53,120,54,0],[124,9,124,10,0],[125,13,125,59,0],[126,9,126,10,0],[134,9,134,10,1],[135,13,135,43,1],[136,13,136,20,1],[136,22,136,52,0],[136,53,136,55,1],[136,56,136,81,1],[137,13,137,14,0],[138,17,138,63,0],[139,13,139,14,0],[140,13,140,24,1],[141,9,141,10,1],[150,9,150,10,1],[151,13,151,35,1],[152,17,152,62,0],[154,13,154,44,1],[155,13,155,98,1],[157,13,158,32,1],[160,13,160,58,1],[161,13,161,14,1],[162,17,162,55,1],[164,13,164,28,0],[165,9,165,10,1],[172,9,172,10,0],[173,13,173,41,0],[175,13,175,143,0],[177,13,177,34,0],[178,13,178,14,0],[179,17,179,51,0],[180,13,180,14,0],[182,13,182,14,0],[183,17,183,48,0],[184,13,184,14,0],[187,13,187,41,0],[188,13,189,85,0],[190,13,190,14,0],[191,17,191,100,0],[192,17,192,50,0],[193,22,193,31,0],[193,33,193,45,0],[193,47,193,50,0],[194,17,194,18,0],[195,21,195,57,0],[196,21,196,22,0],[197,25,197,83,0],[198,29,198,91,0],[199,21,199,22,0],[200,17,200,18,0],[201,13,201,14,0],[203,9,203,10,0],[210,9,210,10,0],[211,13,211,61,0],[212,13,212,105,0],[215,13,215,74,0],[216,13,216,113,0],[217,13,217,47,0],[219,13,219,39,0],[221,13,221,165,0],[222,9,222,10,0],[229,9,229,10,0],[232,13,232,49,0],[233,13,233,61,0],[234,13,234,105,0],[237,13,237,109,0],[238,13,238,20,0],[238,22,238,29,0],[238,30,238,32,0],[238,33,238,42,0],[239,13,239,14,0],[240,17,240,53,0],[241,17,241,79,0],[243,17,245,73,0],[246,17,246,41,0],[247,17,247,42,0],[248,13,248,14,0],[249,9,249,10,0],[253,9,253,10,1],[254,13,254,77,1],[255,13,255,36,1],[256,17,256,24,0],[257,13,257,41,1],[259,13,260,53,1],[262,13,262,44,1],[263,13,263,14,1],[264,17,264,24,1],[264,26,264,62,1],[264,63,264,65,1],[264,66,264,84,1],[265,17,265,18,1],[266,21,266,93,1],[267,17,267,18,1],[268,13,268,14,1],[270,13,270,74,1],[271,13,273,142,1],[274,13,274,56,1],[274,56,274,84,1],[274,84,274,86,1],[274,13,274,86,1],[275,13,275,33,1],[276,13,276,14,1],[279,17,279,83,1],[280,21,280,60,1],[281,13,281,14,1],[283,13,283,93,1],[286,13,286,111,1],[293,13,294,119,1],[296,13,296,102,1],[298,13,298,44,1],[299,13,299,39,1],[300,17,300,63,0],[301,18,301,44,1],[302,17,302,63,1],[303,18,303,44,1],[304,17,304,63,0],[305,13,305,48,1],[306,17,306,63,1],[309,13,309,68,1],[310,13,310,14,0],[311,17,311,63,0],[313,17,313,24,0],[313,26,313,36,0],[313,37,313,39,0],[313,40,313,58,0],[314,17,314,18,0],[315,21,315,55,0],[318,29,318,35,0],[320,29,320,35,0],[322,29,322,35,0],[324,29,324,35,0],[326,29,326,35,0],[328,29,328,35,0],[330,29,330,65,0],[331,29,331,30,0],[332,33,332,183,0],[333,33,333,84,0],[334,37,334,108,0],[335,29,335,30,0],[337,33,337,104,0],[338,29,338,35,0],[340,17,340,18,0],[341,13,341,14,0],[342,13,342,36,1],[343,13,343,14,1],[344,17,344,43,1],[345,17,345,18,1],[346,21,346,50,1],[347,17,347,18,1],[349,17,349,24,1],[349,26,349,33,1],[349,34,349,36,1],[349,37,349,47,1],[350,21,350,71,1],[351,25,352,86,1],[354,25,355,106,1],[357,13,357,14,1],[359,13,359,98,1],[360,13,360,109,1],[361,17,361,65,0],[363,13,363,138,1],[364,9,364,10,1],[367,9,367,10,1],[368,13,368,131,1],[369,13,369,20,1],[369,22,369,29,1],[369,30,369,32,1],[369,33,369,40,1],[370,13,370,14,1],[371,17,371,43,1],[372,17,372,102,1],[373,17,373,18,1],[376,21,376,85,1],[377,21,377,22,1],[379,25,379,125,1],[380,29,380,52,1],[381,33,381,77,0],[382,34,382,56,1],[383,33,383,69,1],[385,25,385,146,1],[387,25,387,75,1],[388,29,388,69,1],[390,25,390,190,1],[392,25,392,56,1],[393,25,393,26,0],[394,29,394,36,0],[394,38,394,74,0],[394,75,394,77,0],[394,78,394,96,0],[395,29,395,30,0],[396,33,396,115,0],[397,29,397,30,0],[398,25,398,26,0],[400,25,400,133,1],[403,25,403,57,1],[404,25,404,132,1],[405,21,405,22,1],[406,17,406,18,1],[407,13,407,14,1],[408,9,408,10,1],[416,9,416,10,0],[417,13,417,76,0],[418,9,418,10,0],[421,9,421,10,1],[422,13,422,78,1],[423,9,423,10,1],[432,9,432,10,0],[433,13,433,92,0],[434,9,434,10,0],[442,9,442,10,1],[443,13,443,93,1],[444,9,444,10,1],[447,9,447,10,0],[448,13,448,66,0],[449,9,449,10,0],[452,9,452,10,0],[453,13,453,80,0],[454,17,454,43,0],[455,13,455,41,0],[456,9,456,10,0],[464,9,464,10,1],[466,13,466,14,1],[467,17,467,70,1],[468,21,468,56,0],[469,17,469,72,1],[471,13,471,18,0],[472,13,472,14,0],[473,17,473,27,0],[475,9,475,10,1],[483,9,483,10,1],[484,13,484,87,1],[485,9,485,10,1],[494,9,494,10,0],[495,13,495,75,0],[496,9,496,10,0],[504,9,504,10,0],[505,13,505,77,0],[506,9,506,10,0],[514,9,514,10,1],[515,13,515,74,1],[516,9,516,10,1],[526,9,526,10,0],[527,13,527,98,0],[528,9,528,10,0],[536,9,536,10,1],[537,13,537,54,1],[538,13,538,39,1],[539,9,539,10,1],[542,9,542,10,0],[543,13,543,61,0],[544,9,544,10,0],[547,9,547,10,1],[548,13,548,30,1],[549,17,549,49,0],[550,13,550,74,1],[552,13,552,29,1],[552,30,552,44,1],[554,13,554,117,1],[555,13,555,20,1],[555,22,555,38,1],[555,39,555,41,1],[555,42,555,59,1],[556,17,556,58,1],[558,13,558,27,1],[559,9,559,10,1],[567,9,567,10,1],[569,13,569,14,1],[570,17,570,35,1],[571,17,571,18,1],[572,21,572,107,1],[574,21,574,28,1],[574,30,574,59,0],[574,60,574,62,1],[574,63,574,71,1],[575,25,575,74,0],[576,17,576,18,1],[577,17,577,83,1],[579,13,579,33,0],[580,13,580,14,0],[581,17,581,93,0],[582,17,582,74,0],[584,9,584,10,1],[592,9,592,10,0],[593,13,593,72,0],[594,9,594,10,0],[603,9,603,10,0],[604,13,604,84,0],[605,9,605,10,0],[613,9,613,10,0],[614,13,614,74,0],[615,9,615,10,0],[623,9,623,10,1],[624,13,624,30,1],[625,17,625,49,0],[626,13,626,77,1],[627,9,627,10,1],[630,9,630,10,0],[631,13,631,85,0],[632,9,632,10,0],[640,9,640,10,0],[641,13,641,85,0],[642,13,642,87,0],[643,9,643,10,0],[646,9,646,10,0],[647,13,647,85,0],[648,13,648,106,0],[649,9,649,10,0],[657,9,657,10,1],[658,13,658,76,1],[659,9,659,10,1],[662,9,662,10,0],[665,13,665,31,0],[666,13,666,14,0],[667,17,670,49,0],[672,17,673,122,0],[675,17,675,76,0],[676,17,676,18,0],[677,21,677,59,0],[678,21,678,74,0],[679,21,679,77,0],[680,21,680,91,0],[681,21,681,61,0],[683,21,683,28,0],[683,30,683,41,0],[683,42,683,44,0],[683,45,683,60,0],[684,21,684,22,0],[685,25,685,32,0],[685,34,685,48,0],[685,49,685,51,0],[685,52,685,70,0],[686,25,686,26,0],[687,29,687,81,0],[688,29,688,59,0],[689,29,689,30,0],[690,33,690,79,0],[691,33,691,84,0],[692,29,692,30,0],[693,34,693,102,0],[694,29,694,30,0],[695,33,695,105,0],[697,33,697,79,0],[698,33,698,72,0],[699,33,699,76,0],[701,33,703,63,0],[704,37,704,73,0],[706,37,706,82,0],[707,29,707,30,0],[709,29,709,30,0],[710,33,710,79,0],[711,33,711,112,0],[712,33,712,48,0],[713,37,713,80,0],[715,33,717,105,0],[718,37,718,73,0],[720,37,720,82,0],[721,29,721,30,0],[722,25,722,26,0],[723,21,723,22,0],[725,21,726,114,0],[727,21,728,120,0],[730,21,730,60,0],[731,21,731,22,0],[732,25,732,63,0],[733,25,733,54,0],[734,25,734,57,0],[735,25,735,81,0],[736,25,736,101,0],[737,21,737,22,0],[738,17,738,18,0],[739,13,739,14,0],[740,9,740,10,0],[744,9,744,10,0],[745,13,745,27,0],[747,13,747,64,0],[748,13,748,40,0],[750,13,750,31,0],[751,13,751,14,0],[752,17,752,58,0],[753,13,753,14,0],[754,13,754,58,0],[755,13,755,14,0],[756,17,756,69,0],[758,17,761,47,0],[762,17,762,43,0],[763,17,763,18,0],[764,21,764,59,0],[765,21,765,57,0],[766,17,766,18,0],[767,17,767,43,0],[768,17,768,18,0],[769,21,769,28,0],[769,30,769,44,0],[769,45,769,47,0],[769,48,769,70,0],[770,21,770,22,0],[771,25,771,55,0],[772,25,772,26,0],[773,29,773,117,0],[774,25,774,26,0],[775,21,775,22,0],[776,17,776,18,0],[777,13,777,14,0],[779,13,779,67,0],[780,13,780,33,0],[781,13,781,29,0],[782,13,782,14,0],[783,17,783,62,0],[784,17,784,75,0],[785,17,785,55,0],[786,17,786,68,0],[787,17,788,106,0],[789,17,789,71,0],[790,17,790,39,0],[791,17,791,18,0],[792,21,792,38,0],[793,21,793,106,0],[794,21,794,36,0],[795,17,795,18,0],[796,13,796,14,0],[797,13,797,34,0],[798,13,798,14,0],[799,17,799,56,0],[800,17,800,18,0],[802,21,802,104,0],[803,21,803,76,0],[804,21,804,63,0],[805,21,805,72,0],[806,21,807,114,0],[808,21,808,75,0],[809,21,809,43,0],[810,21,810,22,0],[811,25,811,42,0],[812,25,812,110,0],[813,25,813,40,0],[814,21,814,22,0],[816,21,816,22,0],[817,25,817,45,0],[818,21,818,22,0],[819,17,819,18,0],[821,17,821,18,0],[822,21,822,62,0],[824,28,824,65,0],[825,21,825,22,0],[826,25,826,53,0],[827,25,827,60,0],[828,21,828,22,0],[830,21,830,64,0],[831,21,832,71,0],[834,21,836,54,0],[837,21,837,92,0],[838,21,838,67,0],[839,21,839,22,0],[840,25,842,56,0],[843,25,845,56,0],[846,25,846,45,0],[847,25,847,46,0],[849,25,849,46,0],[850,25,850,26,0],[851,29,852,82,0],[853,29,853,58,0],[854,25,854,26,0],[856,25,856,26,0],[857,29,858,82,0],[859,29,859,63,0],[860,25,860,26,0],[862,25,862,103,0],[863,25,863,84,0],[864,25,864,86,0],[865,25,866,54,0],[867,25,867,105,0],[868,25,868,26,0],[869,29,869,98,0],[870,29,870,76,0],[871,25,871,26,0],[873,25,877,77,0],[878,21,878,22,0],[879,17,879,18,0],[880,13,880,14,0],[882,13,882,44,0],[883,13,883,14,0],[884,17,884,71,0],[885,13,885,14,0],[886,9,886,10,0],[890,9,890,10,0],[891,13,891,49,0],[892,13,892,45,0],[894,13,894,42,0],[895,13,895,14,0],[896,17,896,59,0],[897,13,897,14,0],[898,13,899,88,0],[900,13,900,28,0],[901,13,901,14,0],[902,17,904,50,0],[906,17,907,121,0],[908,13,908,14,0],[909,18,909,35,0],[910,13,910,14,0],[912,17,912,18,0],[913,21,913,131,0],[915,21,915,49,0],[916,21,916,57,0],[917,21,917,22,0],[918,25,918,73,0],[919,25,919,65,0],[920,21,920,22,0],[922,21,922,115,0],[923,21,923,33,0],[924,21,924,22,0],[925,25,926,81,0],[927,21,927,22,0],[929,21,929,22,0],[930,25,930,95,0],[932,25,932,62,0],[933,25,933,26,0],[934,29,935,95,0],[936,25,936,26,0],[938,25,938,26,0],[939,29,939,121,0],[940,29,942,73,0],[944,21,944,22,0],[946,21,946,48,0],[947,17,947,18,0],[948,17,948,22,0],[949,17,949,18,0],[950,21,950,91,0],[951,21,951,113,0],[952,21,954,65,0],[956,13,956,14,0],[957,18,957,35,0],[958,13,958,14,0],[959,17,959,116,0],[961,13,961,27,0],[962,9,962,10,0],[966,9,966,10,0],[971,13,971,14,0],[973,17,973,29,0],[974,17,974,32,0],[975,17,975,67,0],[976,17,976,67,0],[977,17,980,36,0],[982,17,982,67,0],[984,24,984,61,0],[985,17,985,18,0],[986,21,986,52,0],[987,21,987,56,0],[988,17,988,18,0],[990,17,990,68,0],[991,17,991,18,0],[992,21,993,49,0],[994,21,995,60,0],[996,21,996,62,0],[997,21,997,59,0],[998,21,998,117,0],[999,17,999,18,0],[1000,22,1000,74,0],[1001,17,1001,18,0],[1002,21,1003,42,0],[1004,21,1004,32,0],[1005,21,1005,22,0],[1006,25,1007,119,0],[1008,25,1008,121,0],[1009,21,1009,22,0],[1011,21,1011,22,0],[1012,25,1012,73,0],[1013,25,1013,26,0],[1014,29,1015,123,0],[1016,29,1017,59,0],[1018,25,1018,26,0],[1020,25,1020,26,0],[1021,29,1022,91,0],[1023,29,1026,73,0],[1028,21,1028,22,0],[1029,17,1029,18,0],[1032,17,1032,74,0],[1033,17,1033,60,0],[1034,17,1034,60,0],[1035,17,1035,60,0],[1036,17,1036,68,0],[1037,17,1037,47,0],[1038,17,1038,71,0],[1039,17,1039,88,0],[1040,17,1040,61,0],[1041,17,1041,113,0],[1045,17,1045,35,0],[1046,17,1046,18,0],[1047,21,1047,96,0],[1048,17,1048,18,0],[1049,13,1049,14,0],[1050,13,1050,33,0],[1051,13,1051,14,0],[1052,17,1052,102,0],[1053,17,1053,109,0],[1054,17,1054,49,0],[1056,9,1056,10,0],[1060,9,1060,10,0],[1061,13,1061,88,0],[1063,13,1063,20,0],[1063,22,1063,52,0],[1063,53,1063,55,0],[1063,56,1063,81,0],[1064,13,1064,14,0],[1065,17,1065,82,0],[1066,17,1066,33,0],[1067,17,1067,18,0],[1068,21,1068,77,0],[1069,21,1069,52,0],[1070,21,1070,54,0],[1071,21,1072,104,0],[1073,21,1073,92,0],[1074,17,1074,18,0],[1075,13,1075,14,0],[1077,13,1077,33,0],[1078,9,1078,10,0],[1082,9,1082,10,0],[1083,13,1083,88,0],[1085,13,1085,20,0],[1085,22,1085,52,0],[1085,53,1085,55,0],[1085,56,1085,81,0],[1086,13,1086,14,0],[1087,17,1087,82,0],[1088,17,1088,33,0],[1089,17,1089,18,0],[1090,21,1090,77,0],[1091,21,1091,58,0],[1092,21,1092,54,0],[1093,21,1094,104,0],[1095,21,1095,92,0],[1096,17,1096,18,0],[1097,13,1097,14,0],[1099,13,1099,33,0],[1100,9,1100,10,0],[1103,9,1103,10,0],[1104,13,1104,20,0],[1104,22,1104,52,0],[1104,53,1104,55,0],[1104,56,1104,81,0],[1105,13,1105,14,0],[1106,17,1106,82,0],[1107,17,1107,33,0],[1108,17,1108,18,0],[1109,21,1109,94,0],[1110,21,1110,70,0],[1111,21,1111,80,0],[1112,21,1113,59,0],[1114,17,1114,18,0],[1115,13,1115,14,0],[1116,13,1116,25,0],[1117,9,1117,10,0],[1134,9,1134,10,1],[1135,13,1135,112,1],[1136,13,1136,14,0],[1137,17,1137,140,0],[1142,13,1142,94,1],[1143,13,1143,90,1],[1145,13,1148,32,1],[1149,13,1149,59,1],[1150,17,1150,28,0],[1152,13,1152,14,1],[1154,17,1154,63,1],[1155,17,1155,73,1],[1156,13,1156,14,1],[1160,13,1160,120,1],[1162,13,1162,52,1],[1163,17,1163,26,0],[1166,13,1167,118,1],[1168,17,1168,141,0],[1171,13,1171,41,1],[1172,13,1172,39,1],[1173,13,1173,101,1],[1174,13,1174,37,1],[1175,13,1175,33,1],[1176,13,1176,34,1],[1177,13,1177,40,1],[1178,13,1178,35,1],[1179,13,1179,45,1],[1180,13,1180,52,1],[1181,13,1181,42,1],[1182,13,1182,53,1],[1183,13,1183,36,1],[1184,13,1184,44,1],[1185,13,1185,34,1],[1186,13,1186,46,1],[1187,13,1187,42,1],[1188,13,1188,44,1],[1189,13,1189,50,1],[1190,13,1190,39,1],[1191,13,1191,48,1],[1193,13,1193,33,1],[1195,13,1195,34,1],[1196,13,1196,20,1],[1196,22,1196,52,0],[1196,53,1196,55,1],[1196,56,1196,81,1],[1197,13,1197,14,0],[1198,17,1198,82,0],[1199,17,1199,33,0],[1200,17,1200,18,0],[1201,21,1201,36,0],[1202,21,1202,94,0],[1203,21,1203,56,0],[1204,21,1204,72,0],[1205,21,1206,104,0],[1207,21,1207,75,0],[1208,17,1208,18,0],[1209,13,1209,14,0],[1211,13,1211,26,1],[1212,13,1212,14,1],[1213,17,1213,78,1],[1214,13,1214,14,1],[1217,13,1217,40,1],[1220,13,1220,86,1],[1222,13,1222,20,1],[1222,22,1222,52,1],[1222,53,1222,55,1],[1222,56,1222,62,1],[1223,13,1223,14,1],[1224,17,1224,75,1],[1225,17,1225,39,1],[1226,21,1226,82,1],[1227,13,1227,14,1],[1230,13,1230,32,1],[1231,9,1231,10,1],[1234,9,1234,10,0],[1236,13,1236,120,0],[1238,13,1238,52,0],[1239,17,1239,30,0],[1242,13,1243,118,0],[1244,17,1244,141,0],[1247,13,1247,83,0],[1249,13,1249,34,0],[1250,13,1250,39,0],[1251,13,1251,101,0],[1252,13,1252,45,0],[1253,13,1253,70,0],[1254,13,1254,51,0],[1256,13,1256,82,0],[1257,9,1257,10,0],[1259,9,1259,10,0],[1260,13,1260,79,0],[1262,13,1262,121,0],[1263,13,1263,110,0],[1264,13,1264,14,0],[1265,22,1265,31,0],[1265,33,1265,80,0],[1265,82,1265,85,0],[1266,21,1267,130,0],[1268,13,1268,14,0],[1269,13,1269,50,0],[1270,9,1270,10,0],[1273,9,1273,10,0],[1274,13,1274,40,0],[1275,9,1275,10,0],[1278,9,1278,10,0],[1279,13,1279,42,0],[1280,13,1280,20,0],[1280,22,1280,52,0],[1280,53,1280,55,0],[1280,56,1280,81,0],[1281,13,1281,14,0],[1282,17,1282,82,0],[1283,17,1283,33,0],[1284,17,1284,18,0],[1285,21,1286,98,0],[1287,21,1287,84,0],[1288,17,1288,18,0],[1289,13,1289,14,0],[1290,13,1290,27,0],[1291,9,1291,10,0],[1294,9,1294,10,1],[1295,13,1295,20,1],[1295,22,1295,52,0],[1295,53,1295,55,1],[1295,56,1295,81,1],[1296,13,1296,14,0],[1297,17,1297,82,0],[1298,17,1298,33,0],[1299,17,1299,18,0],[1300,21,1300,94,0],[1301,21,1301,60,0],[1302,21,1302,52,0],[1303,21,1304,104,0],[1305,21,1305,69,0],[1307,13,1307,14,0],[1309,13,1309,25,1],[1310,9,1310,10,1],[1314,9,1314,10,0],[1315,13,1315,33,0],[1316,13,1316,14,0],[1317,17,1317,48,0],[1318,17,1318,100,0],[1319,17,1319,70,0],[1320,17,1320,80,0],[1321,17,1321,82,0],[1322,17,1322,78,0],[1323,17,1323,76,0],[1324,17,1325,110,0],[1326,17,1326,77,0],[1327,17,1327,36,0],[1330,13,1330,14,0],[1331,17,1331,63,0],[1332,17,1332,61,0],[1334,17,1334,47,0],[1335,17,1335,45,0],[1336,17,1336,50,0],[1338,17,1338,127,0],[1340,9,1340,10,0],[1344,9,1344,10,0],[1345,13,1345,71,0],[1346,13,1346,96,0],[1347,13,1347,54,0],[1348,13,1348,78,0],[1349,13,1349,76,0],[1350,13,1350,74,0],[1351,13,1351,72,0],[1353,13,1353,33,0],[1354,13,1354,14,0],[1355,17,1356,110,0],[1357,13,1357,14,0],[1359,13,1359,14,0],[1361,17,1361,88,0],[1362,17,1362,106,0],[1363,17,1363,96,0],[1365,17,1365,91,0],[1366,17,1366,94,0],[1368,17,1368,63,0],[1369,17,1369,88,0],[1370,17,1370,86,0],[1372,17,1372,46,0],[1373,17,1373,53,0],[1375,17,1375,43,0],[1376,21,1376,43,0],[1378,17,1378,95,0],[1379,13,1379,14,0],[1380,9,1380,10,0],[1383,9,1383,10,0],[1384,13,1384,41,0],[1385,17,1385,24,0],[1385,25,1385,26,0],[1387,13,1387,70,0],[1389,13,1389,20,0],[1389,22,1389,38,0],[1389,39,1389,41,0],[1389,42,1389,56,0],[1390,13,1390,14,0],[1391,17,1391,60,0],[1392,13,1392,14,0],[1394,13,1394,55,0],[1396,13,1396,20,0],[1396,22,1396,33,0],[1396,34,1396,36,0],[1396,37,1396,42,0],[1397,13,1397,14,0],[1398,17,1398,35,0],[1399,13,1399,14,0],[1401,13,1401,36,0],[1402,9,1402,10,0],[1406,9,1406,10,1],[1407,13,1407,58,1],[1408,13,1408,83,1],[1409,17,1409,46,1],[1411,18,1411,65,0],[1412,13,1412,14,0],[1413,17,1413,105,0],[1414,13,1414,14,0],[1415,13,1415,89,1],[1416,13,1416,44,1],[1417,13,1417,59,1],[1418,13,1418,70,1],[1419,13,1419,83,1],[1420,9,1420,10,1],[1430,9,1430,10,0],[1432,13,1432,64,0],[1433,13,1433,29,0],[1434,13,1434,14,0],[1436,17,1436,62,0],[1437,17,1438,34,0],[1439,17,1439,67,0],[1441,13,1441,25,0],[1442,9,1442,10,0],[1529,9,1529,10,1],[1530,13,1530,77,1],[1531,9,1531,10,1],[1534,9,1534,10,0],[1535,13,1535,41,0],[1536,17,1537,116,0],[1539,17,1539,41,0],[1540,9,1540,10,0],[1543,9,1543,10,0],[1544,13,1545,112,0],[1546,9,1546,10,0],[1549,9,1549,10,0],[1550,13,1550,68,0],[1551,13,1559,15,0],[1560,13,1560,85,0],[1561,13,1561,100,0],[1562,13,1562,14,0],[1563,17,1563,66,0],[1564,17,1564,24,0],[1564,26,1564,36,0],[1564,37,1564,39,0],[1564,40,1564,63,0],[1565,17,1565,18,0],[1566,21,1577,24,0],[1578,17,1578,18,0],[1579,13,1579,14,0],[1580,13,1580,29,0],[1581,13,1581,23,0],[1582,9,1582,10,0],[1586,9,1586,10,0],[1587,13,1587,66,0],[1588,9,1588,10,0],[1596,9,1596,10,0],[1597,13,1597,67,0],[1598,9,1598,10,0],[1607,9,1607,10,0],[1608,13,1608,33,0],[1609,13,1609,30,0],[1610,17,1610,53,0],[1611,13,1611,75,0],[1613,13,1613,29,0],[1614,13,1614,14,0],[1615,17,1615,78,0],[1616,21,1617,116,0],[1619,21,1619,58,0],[1620,13,1620,14,0],[1622,13,1622,27,0],[1623,9,1623,10,0],[1631,9,1631,10,1],[1632,13,1632,55,1],[1633,13,1633,75,1],[1635,13,1635,29,1],[1636,13,1636,14,1],[1637,17,1637,78,1],[1638,21,1639,120,0],[1641,21,1641,62,1],[1642,13,1642,14,1],[1644,13,1644,27,1],[1645,9,1645,10,1],[1653,9,1653,10,1],[1654,13,1654,74,1],[1655,9,1655,10,1],[1658,9,1658,10,1],[1659,13,1659,86,1],[1660,9,1660,10,1],[1663,9,1663,10,0],[1664,13,1664,103,0],[1665,9,1665,10,0],[1674,9,1674,10,0],[1676,13,1678,21,0],[1679,9,1679,10,0],[1682,9,1682,10,1],[1683,13,1684,35,1],[1685,13,1685,31,1],[1686,13,1686,14,1],[1687,17,1687,101,1],[1688,17,1688,103,1],[1689,17,1689,36,1],[1690,17,1690,18,1],[1691,21,1691,50,1],[1692,21,1692,48,1],[1693,21,1693,45,1],[1694,21,1694,64,1],[1695,21,1695,74,1],[1696,21,1696,87,1],[1697,21,1697,61,1],[1698,21,1698,60,1],[1699,21,1699,57,1],[1700,21,1704,68,1],[1705,21,1705,59,1],[1706,17,1706,18,1],[1707,13,1707,14,1],[1708,13,1708,29,1],[1709,9,1709,10,1],[1713,9,1713,10,0],[1714,13,1714,91,0],[1715,13,1715,42,0],[1716,13,1716,40,0],[1717,13,1717,37,0],[1718,13,1718,56,0],[1719,13,1719,44,0],[1720,13,1720,69,0],[1721,13,1721,53,0],[1722,13,1722,52,0],[1723,13,1723,49,0],[1724,13,1728,60,0],[1729,13,1729,47,0],[1730,9,1730,10,0],[1734,9,1734,10,1],[1735,13,1738,61,1],[1739,9,1739,10,1],[1742,9,1742,10,1],[1743,13,1743,91,1],[1744,9,1744,10,1],[1747,9,1747,10,0],[1748,13,1748,100,0],[1749,9,1749,10,0],[1752,9,1752,10,1],[1753,13,1754,98,1],[1755,9,1755,10,1],[1758,9,1758,10,1],[1759,13,1759,30,1],[1760,17,1760,69,0],[1762,17,1762,37,1],[1763,9,1763,10,1],[1766,9,1766,10,1],[1767,13,1767,30,1],[1768,17,1768,70,0],[1769,9,1769,10,1],[1773,9,1773,10,1],[1775,13,1775,14,1],[1776,17,1776,63,1],[1777,17,1777,77,1],[1778,17,1778,65,1],[1779,17,1779,44,1],[1780,17,1780,105,1],[1781,17,1781,39,1],[1782,17,1782,43,1],[1783,17,1783,41,1],[1784,17,1784,63,1],[1785,17,1785,67,1],[1787,17,1787,67,1],[1788,17,1788,29,1],[1789,17,1789,32,1],[1791,17,1791,54,1],[1792,17,1795,32,1],[1797,17,1797,93,1],[1798,17,1798,18,1],[1799,21,1799,39,1],[1800,21,1800,22,1],[1801,25,1801,115,1],[1802,25,1802,26,1],[1803,29,1804,46,1],[1805,29,1805,30,1],[1806,33,1807,86,1],[1808,33,1808,64,1],[1809,33,1809,34,0],[1810,37,1810,64,0],[1811,33,1811,34,0],[1812,33,1812,110,1],[1813,29,1813,30,1],[1814,34,1818,48,0],[1819,29,1819,30,0],[1820,33,1822,55,0],[1823,33,1824,88,0],[1825,29,1825,30,0],[1826,25,1826,26,1],[1828,25,1829,88,1],[1830,21,1830,22,1],[1831,21,1832,84,1],[1833,21,1833,77,1],[1834,17,1834,18,1],[1835,13,1835,14,1],[1836,13,1836,33,0],[1837,13,1837,14,0],[1838,17,1838,104,0],[1839,13,1839,14,0],[1840,13,1840,25,1],[1841,9,1841,10,1],[1845,9,1845,10,1],[1846,13,1846,32,1],[1849,13,1849,14,1],[1850,17,1850,99,1],[1851,17,1851,95,1],[1852,17,1852,18,0],[1853,21,1853,74,0],[1855,21,1855,94,0],[1856,21,1856,33,0],[1857,21,1857,22,0],[1858,25,1860,123,0],[1865,25,1865,32,0],[1865,34,1865,64,0],[1865,65,1865,67,0],[1865,68,1865,93,0],[1866,25,1866,26,0],[1867,29,1867,94,0],[1868,29,1868,45,0],[1869,29,1869,30,0],[1870,33,1870,106,0],[1871,33,1871,69,0],[1872,33,1872,66,0],[1873,33,1875,71,0],[1876,29,1876,30,0],[1877,25,1877,26,0],[1879,25,1881,58,0],[1882,25,1882,71,0],[1883,25,1883,26,0],[1884,29,1884,63,0],[1885,29,1885,61,0],[1886,29,1888,60,0],[1891,29,1891,107,0],[1892,29,1892,92,0],[1893,29,1894,119,0],[1895,29,1895,98,0],[1896,29,1896,76,0],[1897,29,1900,107,0],[1901,25,1901,26,0],[1902,21,1902,22,0],[1904,25,1904,104,0],[1905,17,1905,18,0],[1906,13,1906,14,1],[1907,13,1907,33,0],[1908,13,1908,14,0],[1909,17,1909,33,0],[1910,17,1910,49,0],[1913,13,1913,28,1],[1914,9,1914,10,1],[1918,9,1918,10,0],[1919,13,1920,59,0],[1921,9,1921,10,0],[1924,9,1924,10,1],[1926,13,1926,14,1],[1927,17,1927,65,1],[1928,17,1928,34,1],[1929,21,1930,56,0],[1931,17,1931,43,1],[1932,17,1932,86,1],[1934,13,1934,33,0],[1935,13,1935,14,0],[1936,17,1936,104,0],[1937,13,1937,14,0],[1938,13,1938,25,0],[1939,9,1939,10,1],[1942,9,1942,10,1],[1944,13,1944,14,1],[1945,17,1945,65,1],[1946,17,1946,34,1],[1947,21,1948,56,0],[1949,17,1949,73,1],[1950,13,1950,14,1],[1951,13,1951,33,0],[1952,13,1952,14,0],[1953,17,1953,104,0],[1954,13,1954,14,0],[1955,13,1955,25,1],[1956,9,1956,10,1],[1959,9,1959,10,1],[1960,13,1962,33,1],[1963,13,1963,66,1],[1964,17,1964,38,1],[1966,17,1966,31,0],[1967,9,1967,10,1],[1969,9,1969,10,0],[1970,13,1970,56,0],[1971,13,1972,63,0],[1973,13,1973,64,0],[1974,13,1974,74,0],[1975,13,1975,89,0],[1976,13,1976,37,0],[1977,13,1977,14,0],[1978,17,1978,76,0],[1978,76,1978,105,0],[1978,105,1978,117,0],[1978,17,1978,117,0],[1979,17,1979,65,0],[1980,17,1980,101,0],[1980,101,1980,146,0],[1980,146,1980,158,0],[1980,17,1980,158,0],[1981,13,1981,14,0],[1982,13,1982,56,0],[1983,13,1983,76,0],[1984,13,1984,106,0],[1985,13,1985,27,0],[1988,9,1988,10,0],[1990,9,1990,10,0],[1991,13,1991,76,0],[1992,13,1993,29,0],[1994,13,1994,66,0],[1995,13,1995,14,0],[1996,17,1996,63,0],[1996,63,1996,117,0],[1996,117,1996,119,0],[1996,17,1996,119,0],[1997,13,1997,14,0],[1998,13,1998,27,0],[1999,9,1999,10,0],[2002,9,2002,10,0],[2004,13,2005,60,0],[2006,13,2006,37,0],[2007,13,2007,14,0],[2008,17,2008,36,0],[2011,13,2011,36,0],[2014,9,2014,10,0],[2017,9,2017,10,0],[2019,13,2020,45,0],[2021,13,2021,37,0],[2022,13,2022,14,0],[2023,17,2023,36,0],[2026,13,2026,36,0],[2029,9,2029,10,0],[2032,9,2032,10,0],[2033,13,2033,94,0],[2034,13,2035,236,0],[2036,9,2036,10,0],[2039,9,2039,10,0],[2040,13,2041,52,0],[2042,9,2042,10,0],[2047,9,2047,10,0],[2048,13,2048,76,0],[2049,13,2051,111,0],[2052,9,2052,10,0],[2055,9,2055,10,0],[2056,13,2056,44,0],[2057,13,2057,35,0],[2058,13,2060,34,0],[2061,13,2061,36,0],[2062,17,2062,38,0],[2063,18,2063,32,0],[2064,9,2064,10,0],[2067,9,2067,10,1],[2068,13,2070,45,1],[2071,13,2071,50,1],[2072,17,2072,34,1],[2074,17,2074,31,0],[2075,9,2075,10,1],[2078,9,2078,10,1],[2079,13,2081,45,1],[2082,13,2082,54,1],[2083,17,2083,38,0],[2085,17,2085,31,1],[2086,9,2086,10,1],[2089,9,2089,10,1],[2090,13,2090,38,1],[2090,39,2090,59,0],[2092,13,2092,14,1],[2094,17,2094,56,1],[2097,17,2098,38,1],[2099,17,2099,42,1],[2100,17,2100,18,1],[2101,21,2101,28,1],[2101,30,2101,37,1],[2101,38,2101,40,1],[2101,41,2101,50,1],[2102,25,2102,57,1],[2103,17,2103,18,1],[2105,17,2105,47,1],[2106,13,2106,14,1],[2107,13,2107,33,0],[2108,13,2108,14,0],[2109,17,2109,35,0],[2112,13,2112,33,1],[2113,9,2113,10,1],[2116,9,2116,10,0],[2118,13,2118,93,0],[2119,13,2119,45,0],[2120,13,2120,14,0],[2121,17,2121,93,0],[2122,17,2122,117,0],[2123,13,2123,14,0],[2124,9,2124,10,0],[2127,9,2127,10,1],[2128,13,2128,94,1],[2130,13,2130,45,1],[2131,17,2132,66,1],[2133,9,2133,10,1],[2136,9,2136,10,1],[2137,9,2137,10,1],[2141,9,2141,10,1],[2142,13,2143,117,1],[2144,13,2144,56,1],[2145,13,2146,42,1],[2152,13,2152,20,1],[2152,22,2152,51,0],[2152,52,2152,54,1],[2152,55,2152,62,1],[2153,13,2153,14,0],[2154,17,2154,46,0],[2155,17,2155,59,0],[2156,17,2156,58,0],[2157,17,2157,58,0],[2158,17,2158,58,0],[2159,17,2159,44,0],[2160,17,2160,54,0],[2161,17,2165,67,0],[2167,17,2167,44,0],[2168,17,2168,105,0],[2169,17,2169,71,0],[2170,17,2170,18,0],[2171,21,2171,99,0],[2172,17,2172,18,0],[2173,13,2173,14,0],[2174,9,2174,10,1],[2180,9,2180,10,0],[2181,13,2181,86,0],[2182,13,2182,49,0],[2183,13,2183,14,0],[2184,17,2184,24,0],[2184,26,2184,36,0],[2184,37,2184,39,0],[2184,40,2184,47,0],[2185,17,2185,18,0],[2186,21,2186,108,0],[2187,21,2187,76,0],[2189,28,2189,65,0],[2190,21,2190,22,0],[2191,25,2191,53,0],[2192,25,2192,60,0],[2193,21,2193,22,0],[2195,21,2195,44,0],[2196,21,2196,42,0],[2197,21,2197,22,0],[2199,25,2199,135,0],[2200,25,2200,68,0],[2201,25,2201,26,0],[2202,29,2202,48,0],[2203,25,2203,26,0],[2205,21,2205,22,0],[2207,21,2207,36,0],[2208,21,2208,22,0],[2209,25,2210,32,0],[2211,25,2211,61,0],[2212,25,2212,55,0],[2213,25,2213,63,0],[2214,25,2214,61,0],[2215,25,2215,69,0],[2216,25,2216,66,0],[2217,25,2217,57,0],[2218,25,2218,57,0],[2219,25,2219,57,0],[2220,25,2220,57,0],[2221,25,2221,65,0],[2222,25,2222,48,0],[2223,25,2223,49,0],[2224,25,2224,53,0],[2225,25,2225,50,0],[2226,25,2226,60,0],[2227,25,2227,67,0],[2228,25,2228,59,0],[2229,25,2229,57,0],[2230,25,2230,54,0],[2231,25,2231,87,0],[2232,25,2234,72,0],[2235,21,2235,22,0],[2236,17,2236,18,0],[2237,13,2237,14,0],[2238,9,2238,10,0],[2248,9,2248,10,0],[2249,13,2249,39,0],[2254,13,2254,14,0],[2255,17,2255,64,0],[2256,17,2256,49,0],[2257,17,2257,38,0],[2259,17,2261,106,0],[2262,17,2262,35,0],[2263,17,2263,40,0],[2264,21,2264,41,0],[2266,21,2266,43,0],[2267,13,2267,14,0],[2267,15,2267,54,0],[2270,13,2270,30,0],[2271,13,2271,14,0],[2272,17,2272,50,0],[2273,22,2273,31,0],[2273,33,2273,50,0],[2273,52,2273,55,0],[2274,21,2274,67,0],[2275,13,2275,14,0],[2277,17,2277,40,0],[2279,13,2279,30,0],[2280,9,2280,10,0],[2305,9,2305,10,1],[2306,13,2306,104,1],[2307,9,2307,10,1],[2310,9,2310,10,1],[2311,13,2311,81,1],[2312,13,2312,47,1],[2313,13,2313,42,1],[2314,13,2314,14,1],[2315,17,2315,95,1],[2316,17,2318,32,1],[2319,13,2319,14,1],[2320,13,2320,69,1],[2321,13,2322,65,1],[2323,9,2323,10,1],[2326,9,2326,10,1],[2327,13,2327,44,1],[2328,13,2328,20,1],[2328,22,2328,52,0],[2328,53,2328,55,1],[2328,56,2328,81,1],[2329,13,2329,14,0],[2330,17,2330,82,0],[2331,17,2331,33,0],[2332,17,2332,18,0],[2333,21,2333,98,0],[2334,21,2334,71,0],[2335,21,2335,78,0],[2336,21,2337,114,0],[2338,21,2338,81,0],[2339,17,2339,18,0],[2340,13,2340,14,0],[2341,13,2341,48,1],[2342,13,2342,14,1],[2343,17,2343,40,1],[2344,13,2344,14,1],[2345,13,2345,29,1],[2346,9,2346,10,1],[2349,9,2349,10,0],[2350,13,2350,71,0],[2351,13,2351,33,0],[2352,13,2352,14,0],[2353,17,2353,100,0],[2354,17,2354,58,0],[2355,17,2355,78,0],[2356,17,2356,76,0],[2357,17,2358,65,0],[2359,13,2359,14,0],[2360,9,2360,10,0],[2363,9,2363,10,1],[2364,13,2364,34,1],[2365,13,2365,39,1],[2366,13,2366,20,1],[2366,22,2366,52,0],[2366,53,2366,55,1],[2366,56,2366,81,1],[2367,13,2367,14,0],[2368,17,2368,82,0],[2369,17,2369,33,0],[2370,17,2370,18,0],[2371,21,2371,36,0],[2372,21,2372,104,0],[2373,21,2373,88,0],[2374,21,2374,82,0],[2375,21,2375,73,0],[2376,21,2377,114,0],[2378,21,2378,65,0],[2379,25,2379,81,0],[2380,17,2380,18,0],[2381,13,2381,14,0],[2382,13,2382,26,1],[2383,13,2383,14,1],[2384,17,2384,81,1],[2385,21,2385,112,1],[2386,13,2386,14,1],[2387,13,2387,34,1],[2388,9,2388,10,1],[2391,9,2391,10,0],[2392,13,2392,32,0],[2393,13,2396,42,0],[2397,13,2397,49,0],[2398,13,2398,14,0],[2399,17,2399,67,0],[2400,13,2400,14,0],[2402,13,2402,14,0],[2403,17,2403,91,0],[2406,13,2406,31,0],[2407,9,2407,10,0],[2410,9,2410,10,0],[2421,13,2421,94,0],[2422,9,2422,10,0],[2425,9,2425,10,0],[2426,13,2426,81,0],[2427,13,2427,47,0],[2428,13,2428,42,0],[2429,13,2429,14,0],[2430,17,2430,95,0],[2431,17,2433,32,0],[2434,13,2434,14,0],[2435,13,2435,69,0],[2436,13,2437,65,0],[2438,9,2438,10,0],[2441,9,2441,10,0],[2442,13,2442,57,0],[2443,9,2443,10,0],[2446,9,2446,10,0],[2447,13,2450,44,0],[2451,13,2451,34,0],[2452,13,2452,37,0],[2453,13,2453,14,0],[2454,17,2454,49,0],[2455,21,2455,36,0],[2456,13,2456,14,0],[2457,13,2457,28,0],[2458,9,2458,10,0],[2461,9,2461,10,0],[2462,13,2462,46,0],[2463,17,2463,92,0],[2464,18,2464,52,0],[2465,13,2465,14,0],[2466,17,2466,81,0],[2467,17,2467,39,0],[2468,17,2468,18,0],[2469,21,2469,50,0],[2470,21,2470,40,0],[2471,21,2473,100,0],[2475,21,2475,90,0],[2476,21,2476,22,0],[2477,25,2477,78,0],[2478,25,2478,59,0],[2479,25,2479,54,0],[2480,25,2480,26,0],[2481,29,2481,98,0],[2482,29,2484,44,0],[2485,25,2485,26,0],[2486,25,2486,81,0],[2487,25,2487,108,0],[2488,21,2488,22,0],[2489,17,2489,18,0],[2490,13,2490,14,0],[2491,9,2491,10,0],[2494,9,2494,10,0],[2495,13,2495,41,0],[2496,13,2496,14,0],[2497,17,2497,71,0],[2498,17,2500,50,0],[2501,17,2501,53,0],[2504,13,2504,14,0],[2505,17,2505,91,0],[2507,9,2507,10,0],[2510,9,2510,10,0],[2511,13,2511,99,0],[2512,9,2512,10,0],[2515,9,2515,10,0],[2516,13,2516,54,0],[2517,17,2517,30,0],[2519,13,2519,93,0],[2520,9,2520,10,0],[2523,9,2523,10,1],[2524,13,2524,77,1],[2525,13,2525,51,1],[2526,9,2526,10,1],[2529,9,2529,10,0],[2530,13,2530,103,0],[2531,13,2531,51,0],[2532,9,2532,10,0],[2535,9,2535,10,1],[2536,13,2536,178,1],[2537,9,2537,10,1],[2540,9,2540,10,1],[2541,13,2541,56,1],[2542,13,2542,53,1],[2544,13,2544,34,1],[2545,13,2545,55,1],[2546,17,2546,32,1],[2548,13,2548,66,1],[2549,17,2549,32,1],[2551,13,2551,26,1],[2552,17,2553,63,0],[2555,13,2555,28,1],[2557,13,2557,26,1],[2558,13,2558,14,0],[2560,17,2560,75,0],[2561,17,2561,18,0],[2562,21,2562,40,0],[2563,21,2563,22,0],[2564,25,2564,112,0],[2565,25,2565,32,0],[2565,34,2565,45,0],[2565,46,2565,48,0],[2565,49,2565,65,0],[2566,29,2566,72,0],[2567,21,2567,22,0],[2569,21,2569,22,0],[2570,25,2570,91,0],[2571,25,2571,76,0],[2572,25,2572,89,0],[2573,25,2573,71,0],[2574,21,2574,22,0],[2575,17,2575,18,0],[2577,21,2577,45,0],[2578,13,2578,14,0],[2580,13,2580,14,1],[2581,17,2581,28,1],[2582,17,2582,62,1],[2583,13,2583,14,1],[2585,13,2585,111,1],[2586,13,2586,37,1],[2586,38,2586,50,0],[2588,13,2588,20,1],[2588,22,2588,33,1],[2588,34,2588,36,1],[2588,37,2588,54,1],[2589,13,2589,14,1],[2590,17,2590,161,1],[2591,21,2591,65,1],[2592,13,2592,14,1],[2593,13,2593,29,1],[2594,9,2594,10,1],[2597,9,2597,10,1],[2598,13,2598,64,1],[2600,13,2600,53,1],[2602,13,2602,34,1],[2603,13,2603,86,1],[2604,17,2604,32,1],[2606,13,2606,97,1],[2607,17,2607,32,1],[2609,13,2609,26,1],[2610,17,2613,63,0],[2614,13,2614,26,1],[2615,13,2615,14,0],[2616,17,2616,75,0],[2617,17,2617,18,0],[2618,21,2618,32,0],[2619,21,2620,64,0],[2621,21,2621,28,0],[2621,30,2621,41,0],[2621,42,2621,44,0],[2621,45,2621,61,0],[2622,25,2622,68,0],[2623,17,2623,18,0],[2625,21,2625,45,0],[2626,13,2626,14,0],[2628,13,2628,14,1],[2629,17,2629,28,1],[2630,17,2630,62,1],[2631,13,2631,14,1],[2633,13,2633,32,1],[2634,9,2634,10,1],[2637,9,2637,10,1],[2638,13,2638,56,1],[2640,13,2640,32,1],[2641,17,2641,65,1],[2643,13,2643,14,0],[2644,17,2644,47,0],[2645,17,2645,83,0],[2646,17,2646,81,0],[2647,17,2647,63,0],[2648,13,2648,14,0],[2651,13,2651,133,1],[2652,13,2652,37,1],[2652,38,2652,54,0],[2654,13,2654,20,1],[2654,22,2654,33,1],[2654,34,2654,36,1],[2654,37,2654,54,1],[2655,13,2655,14,1],[2656,17,2657,71,1],[2658,21,2658,128,1],[2659,13,2659,14,1],[2660,13,2660,29,1],[2662,9,2662,10,1],[2665,9,2665,10,1],[2666,13,2667,29,1],[2668,13,2668,36,1],[2669,17,2669,38,1],[2670,18,2670,32,0],[2671,9,2671,10,1],[2674,9,2674,10,0],[2675,13,2675,45,0],[2676,13,2676,28,0],[2677,13,2678,31,0],[2679,13,2679,66,0],[2680,17,2680,44,0],[2681,18,2681,30,0],[2682,9,2682,10,0],[2685,9,2685,10,0],[2686,13,2688,50,0],[2689,9,2689,10,0],[2692,9,2692,10,0],[2693,13,2695,112,0],[2698,13,2698,46,0],[2699,13,2699,39,0],[2700,13,2700,106,0],[2701,13,2701,32,0],[2702,13,2702,33,0],[2703,13,2703,34,0],[2705,13,2705,104,0],[2706,13,2706,35,0],[2707,13,2707,42,0],[2708,13,2708,52,0],[2709,13,2709,42,0],[2710,13,2710,48,0],[2711,13,2711,36,0],[2712,13,2712,44,0],[2713,13,2713,34,0],[2715,13,2715,67,0],[2716,9,2716,10,0],[2719,9,2719,10,0],[2720,13,2720,66,0],[2721,13,2721,54,0],[2725,13,2725,114,0],[2726,13,2726,47,0],[2727,13,2727,70,0],[2730,13,2730,44,0],[2732,13,2732,90,0],[2733,13,2733,41,0],[2735,13,2735,20,0],[2735,22,2735,37,0],[2735,38,2735,40,0],[2735,41,2735,52,0],[2736,13,2736,14,0],[2737,17,2737,53,0],[2738,17,2738,42,0],[2739,17,2739,18,0],[2740,21,2740,56,0],[2742,21,2742,108,0],[2743,21,2743,44,0],[2747,21,2747,57,0],[2749,21,2749,67,0],[2750,21,2750,38,0],[2751,21,2751,22,0],[2752,25,2752,65,0],[2753,25,2753,67,0],[2754,25,2754,57,0],[2755,25,2755,26,0],[2756,29,2756,35,0],[2759,21,2759,22,0],[2760,21,2760,32,0],[2761,17,2761,18,0],[2762,13,2762,14,0],[2763,13,2763,37,0],[2765,13,2765,30,0],[2766,13,2766,28,0],[2767,9,2767,10,0],[2770,9,2770,10,1],[2771,13,2771,69,1],[2772,9,2772,10,1],[2775,9,2775,10,0],[2776,13,2776,72,0],[2777,9,2777,10,0],[2780,9,2780,10,1],[2781,13,2781,76,1],[2782,9,2782,10,1],[2785,9,2785,10,0],[2786,13,2786,72,0],[2787,9,2787,10,0],[2794,9,2794,10,0],[2795,13,2797,59,0],[2798,9,2798,10,0],[2801,9,2801,10,1],[2802,13,2802,70,1],[2803,9,2803,10,1],[2807,9,2807,10,1],[2808,13,2809,76,1],[2810,9,2810,10,1],[2813,9,2813,10,0],[2814,13,2814,101,0],[2815,9,2815,10,0],[2818,9,2818,10,0],[2819,13,2819,97,0],[2820,9,2820,10,0],[2823,9,2823,10,0],[2824,13,2824,112,0],[2825,9,2825,10,0],[2828,9,2828,10,0],[2829,13,2829,95,0],[2830,9,2830,10,0],[2833,9,2833,10,0],[2834,13,2835,99,0],[2836,13,2836,57,0],[2837,17,2837,76,0],[2838,9,2838,10,0],[2841,9,2841,10,1],[2842,13,2842,89,1],[2843,9,2843,10,1],[2846,9,2846,10,1],[2847,13,2847,79,1],[2848,9,2848,10,1],[2852,9,2852,10,1],[2853,13,2854,96,1],[2855,9,2855,10,1],[2859,9,2859,10,0],[2860,13,2861,47,0],[2862,9,2862,10,0],[2866,9,2866,10,0],[2867,13,2868,36,0],[2869,13,2869,41,0],[2870,13,2870,14,0],[2871,17,2872,121,0],[2873,17,2873,63,0],[2874,17,2874,18,0],[2875,21,2875,110,0],[2876,21,2876,100,0],[2877,21,2877,123,0],[2878,21,2878,111,0],[2881,21,2881,99,0],[2882,21,2882,78,0],[2883,21,2883,81,0],[2884,21,2885,123,0],[2886,21,2886,90,0],[2887,21,2887,68,0],[2888,21,2892,113,0],[2893,17,2893,18,0],[2894,13,2894,14,0],[2895,9,2895,10,0],[2903,9,2903,10,0],[2904,13,2904,86,0],[2906,13,2906,51,0],[2907,17,2907,37,0],[2909,13,2909,36,0],[2910,9,2910,10,0],[2918,9,2918,10,0],[2919,13,2919,94,0],[2920,9,2920,10,0],[2923,9,2923,10,1],[2924,13,2924,72,1],[2925,9,2925,10,1],[2928,9,2928,10,1],[2929,13,2929,84,1],[2930,9,2930,10,1],[2933,9,2933,10,1],[2934,13,2934,67,1],[2935,9,2935,10,1],[2943,9,2943,10,0],[2944,13,2944,66,0],[2945,13,2945,54,0],[2949,13,2949,114,0],[2950,13,2950,47,0],[2951,13,2951,70,0],[2954,13,2954,44,0],[2956,13,2956,90,0],[2957,13,2957,41,0],[2962,13,2962,88,0],[2964,13,2964,71,0],[2966,13,2966,50,0],[2967,13,2967,37,0],[2969,13,2969,30,0],[2970,13,2970,28,0],[2971,9,2971,10,0],[2974,9,2974,10,0],[2975,13,2975,55,0],[2977,13,2977,20,0],[2977,22,2977,37,0],[2977,38,2977,40,0],[2977,41,2977,46,0],[2978,13,2978,14,0],[2979,17,2979,54,0],[2981,17,2981,69,0],[2982,17,2982,59,0],[2983,17,2983,61,0],[2984,17,2984,54,0],[2995,17,2995,43,0],[2997,17,2997,50,0],[3001,17,3001,48,0],[3002,24,3002,73,0],[3003,17,3003,18,0],[3004,21,3004,71,0],[3005,17,3005,18,0],[3006,17,3006,40,0],[3007,13,3007,14,0],[3009,13,3009,63,0],[3011,13,3011,20,0],[3011,22,3011,35,0],[3011,36,3011,38,0],[3011,39,3011,46,0],[3012,13,3012,14,0],[3013,17,3013,65,0],[3014,13,3014,14,0],[3015,9,3015,10,0],[3021,9,3021,10,1],[3023,13,3023,14,1],[3024,17,3024,49,1],[3025,17,3026,92,1],[3027,17,3027,32,1],[3028,17,3028,18,1],[3029,21,3029,154,1],[3030,17,3030,18,1],[3031,22,3031,39,0],[3032,17,3032,18,0],[3033,21,3033,125,0],[3097,22,3097,39,0],[3098,17,3098,18,0],[3100,21,3100,104,0],[3102,21,3102,41,0],[3103,21,3103,22,0],[3104,25,3104,96,0],[3106,25,3106,92,0],[3107,25,3107,63,0],[3108,25,3108,50,0],[3109,25,3109,50,0],[3110,25,3110,54,0],[3111,25,3111,57,0],[3113,25,3113,117,0],[3115,25,3115,88,0],[3116,25,3116,26,0],[3117,29,3117,61,0],[3118,25,3118,26,0],[3120,25,3120,26,0],[3121,29,3121,88,0],[3122,29,3122,58,0],[3124,21,3124,22,0],[3126,17,3126,18,0],[3127,13,3127,14,1],[3128,13,3128,33,0],[3129,13,3129,14,0],[3130,17,3130,26,0],[3132,9,3132,10,1],[3140,9,3140,10,1],[3141,13,3141,79,1],[3142,9,3142,10,1],[3149,9,3149,10,0],[3150,13,3150,81,0],[3151,9,3151,10,0],[3154,9,3154,10,1],[3155,13,3155,102,1],[3156,9,3156,10,1],[3166,9,3166,10,0],[3167,13,3167,108,0],[3168,13,3168,66,0],[3169,13,3169,14,0],[3170,17,3170,49,0],[3171,17,3171,44,0],[3172,17,3172,47,0],[3173,17,3173,99,0],[3174,17,3174,68,0],[3175,17,3175,53,0],[3176,17,3176,87,0],[3177,17,3177,18,0],[3178,21,3178,51,0],[3179,17,3179,18,0],[3180,17,3180,44,0],[3181,21,3181,82,0],[3182,17,3182,88,0],[3183,17,3183,18,0],[3184,21,3186,78,0],[3187,21,3189,75,0],[3190,17,3190,18,0],[3191,17,3191,75,0],[3192,17,3192,18,0],[3193,21,3193,28,0],[3193,30,3193,40,0],[3193,41,3193,43,0],[3193,44,3193,56,0],[3194,21,3194,22,0],[3195,25,3195,63,0],[3196,25,3196,26,0],[3197,29,3198,113,0],[3199,25,3199,26,0],[3200,21,3200,22,0],[3201,17,3201,18,0],[3202,13,3202,14,0],[3203,9,3203,10,0],[3206,9,3206,10,0],[3207,13,3207,108,0],[3208,9,3208,10,0],[3211,9,3211,10,0],[3212,13,3212,84,0],[3213,9,3213,10,0],[3216,9,3216,10,0],[3217,13,3217,87,0],[3218,9,3218,10,0],[3221,9,3221,10,0],[3222,13,3222,85,0],[3223,9,3223,10,0],[3231,9,3231,10,0],[3232,13,3232,55,0],[3234,13,3234,48,0],[3235,9,3235,10,0],[3239,9,3239,10,0],[3240,13,3240,109,0],[3241,9,3241,10,0],[3251,9,3251,10,0],[3252,13,3252,106,0],[3254,13,3254,51,0],[3255,17,3255,37,0],[3257,13,3257,36,0],[3258,9,3258,10,0],[3265,9,3265,10,0],[3266,13,3266,61,0],[3267,9,3267,10,0],[3270,9,3270,10,0],[3271,13,3271,54,0],[3272,13,3272,68,0],[3273,13,3273,70,0],[3274,13,3274,122,0],[3276,13,3276,49,0],[3276,51,3276,63,0],[3278,13,3278,47,0],[3279,13,3279,14,0],[3280,17,3280,63,0],[3281,17,3281,54,0],[3282,13,3282,14,0],[3284,13,3284,42,0],[3285,17,3285,79,0],[3287,13,3287,98,0],[3288,13,3288,39,0],[3290,13,3290,55,0],[3291,13,3291,14,0],[3292,17,3292,61,0],[3293,17,3293,79,0],[3294,17,3294,40,0],[3295,13,3295,14,0],[3297,13,3297,91,0],[3298,13,3298,62,0],[3299,9,3299,10,0],[3307,9,3307,10,0],[3308,13,3308,96,0],[3310,13,3310,52,0],[3311,17,3311,49,0],[3313,13,3313,47,0],[3315,13,3315,55,0],[3316,9,3316,10,0],[3325,9,3325,10,0],[3326,13,3326,81,0],[3327,13,3327,102,0],[3329,13,3329,52,0],[3330,17,3330,34,0],[3332,13,3332,72,0],[3334,13,3334,30,0],[3335,9,3335,10,0],[3343,9,3343,10,1],[3344,13,3344,82,1],[3346,13,3346,51,1],[3347,17,3347,37,1],[3349,13,3349,36,0],[3350,9,3350,10,1],[3358,9,3358,10,0],[3359,13,3359,81,0],[3360,9,3360,10,0],[3363,9,3363,10,1],[3364,13,3364,91,1],[3365,9,3365,10,1],[3368,9,3368,10,1],[3369,13,3369,82,1],[3370,9,3370,10,1],[3377,9,3377,10,0],[3378,13,3378,66,0],[3379,9,3379,10,0],[3382,9,3382,10,1],[3383,13,3383,42,1],[3385,13,3385,20,1],[3385,22,3385,52,0],[3385,53,3385,55,1],[3385,56,3385,81,1],[3386,13,3386,14,0],[3387,17,3387,82,0],[3388,17,3388,33,0],[3389,17,3389,18,0],[3390,21,3391,98,0],[3392,21,3392,86,0],[3393,17,3393,18,0],[3394,13,3394,14,0],[3395,13,3395,27,1],[3396,9,3396,10,1],[3404,9,3404,10,0],[3405,13,3405,59,0],[3406,13,3406,67,0],[3407,9,3407,10,0],[3410,9,3410,10,0],[3411,13,3411,84,0],[3412,9,3412,10,0],[3415,9,3415,10,0],[3416,13,3416,78,0],[3417,9,3417,10,0],[3420,9,3420,10,0],[3421,13,3421,82,0],[3422,13,3422,51,0],[3423,17,3423,37,0],[3425,17,3425,29,0],[3426,9,3426,10,0],[3429,9,3429,10,0],[3430,13,3430,96,0],[3431,9,3431,10,0],[3435,9,3435,10,1],[3436,13,3436,49,1],[3437,13,3437,40,1],[3438,13,3438,38,1],[3439,13,3439,37,1],[3440,13,3440,58,1],[3441,13,3441,59,1],[3442,13,3442,59,1],[3443,13,3443,36,1],[3444,13,3444,33,1],[3446,13,3446,85,1],[3447,13,3447,51,1],[3448,17,3448,37,1],[3450,17,3450,29,0],[3451,9,3451,10,1],[3457,9,3457,10,0],[3458,13,3461,97,0],[3462,13,3462,51,0],[3463,17,3463,37,0],[3465,17,3465,29,0],[3466,9,3466,10,0],[3469,9,3469,10,0],[3470,13,3471,102,0],[3472,13,3472,51,0],[3473,13,3483,16,0],[3485,13,3485,20,0],[3485,22,3485,58,0],[3485,59,3485,61,0],[3485,62,3485,76,0],[3486,13,3486,14,0],[3487,17,3487,36,0],[3488,17,3489,35,0],[3490,17,3490,39,0],[3491,21,3491,56,0],[3492,17,3492,36,0],[3493,17,3493,18,0],[3494,21,3494,63,0],[3495,21,3495,142,0],[3496,28,3496,59,0],[3497,21,3497,22,0],[3498,25,3498,84,0],[3499,25,3499,65,0],[3500,21,3500,22,0],[3502,21,3502,65,0],[3503,21,3503,145,0],[3504,28,3504,59,0],[3505,21,3505,22,0],[3506,25,3506,87,0],[3507,25,3507,67,0],[3508,21,3508,22,0],[3510,21,3513,117,0],[3515,21,3515,57,0],[3516,25,3516,57,0],[3517,17,3517,18,0],[3518,13,3518,14,0],[3519,13,3519,30,0],[3520,9,3520,10,0],[3524,9,3524,10,0],[3525,13,3525,33,0],[3527,13,3527,32,0],[3528,13,3529,22,0],[3530,13,3530,35,0],[3531,17,3531,52,0],[3532,13,3532,32,0],[3533,13,3533,14,0],[3534,17,3535,133,0],[3536,17,3536,55,0],[3537,17,3537,18,0],[3538,21,3538,91,0],[3539,21,3539,43,0],[3540,25,3540,44,0],[3542,21,3542,75,0],[3544,13,3544,14,0],[3545,13,3545,25,0],[3546,9,3546,10,0],[3549,9,3549,10,0],[3551,13,3562,15,0],[3566,13,3566,68,0],[3567,17,3567,62,0],[3569,13,3569,20,0],[3569,22,3569,33,0],[3569,34,3569,36,0],[3569,37,3569,51,0],[3570,13,3570,14,0],[3571,17,3571,100,0],[3573,17,3573,60,0],[3574,17,3575,17,0],[3575,17,3575,18,0],[3575,18,3576,21,0],[3576,21,3576,52,0],[3576,52,3577,25,0],[3577,25,3577,47,0],[3577,47,3578,17,0],[3578,17,3578,18,0],[3578,18,3578,20,0],[3574,17,3578,20,0],[3580,17,3580,82,0],[3581,17,3581,61,0],[3582,13,3582,14,0],[3584,13,3584,30,0],[3585,9,3585,10,0],[3588,9,3588,10,0],[3589,13,3589,33,0],[3590,13,3590,152,0],[3591,13,3591,51,0],[3592,13,3592,14,0],[3593,17,3593,87,0],[3594,17,3594,39,0],[3595,21,3595,40,0],[3597,17,3597,37,0],[3599,13,3599,25,0],[3600,9,3600,10,0],[3603,9,3603,10,0],[3604,13,3604,92,0],[3605,13,3605,33,0],[3606,17,3606,43,0],[3608,17,3608,37,0],[3609,9,3609,10,0],[3613,9,3613,10,0],[3614,13,3615,48,0],[3616,9,3616,10,0],[3619,9,3619,10,1],[3620,13,3620,142,1],[3621,9,3621,10,1],[3624,9,3624,10,0],[3625,13,3625,56,0],[3626,13,3626,103,0],[3627,17,3628,106,0],[3630,13,3630,134,0],[3631,13,3631,32,0],[3632,13,3632,28,0],[3635,21,3635,59,0],[3636,21,3636,27,0],[3638,21,3638,60,0],[3639,21,3639,27,0],[3641,21,3641,58,0],[3642,21,3642,27,0],[3644,13,3644,25,0],[3645,9,3645,10,0],[3647,9,3647,10,0],[3648,13,3648,136,0],[3649,13,3649,196,0],[3650,9,3650,10,0],[3653,9,3653,10,0],[3654,13,3654,208,0],[3655,9,3655,10,0],[3658,9,3658,10,0],[3659,13,3659,42,0],[3660,13,3660,88,0],[3661,13,3661,68,0],[3662,13,3662,14,0],[3663,17,3663,77,0],[3664,13,3664,14,0],[3666,13,3666,27,0],[3667,9,3667,10,0],[3670,9,3670,10,0],[3671,13,3671,28,0],[3672,13,3672,98,0],[3673,13,3673,68,0],[3674,13,3674,14,0],[3675,17,3675,69,0],[3676,13,3676,14,0],[3678,13,3678,27,0],[3679,9,3679,10,0],[3682,9,3682,10,0],[3683,13,3683,76,0],[3684,9,3684,10,0],[3687,9,3687,10,0],[3688,13,3690,146,0],[3692,13,3692,45,0],[3693,9,3693,10,0],[3696,9,3696,10,0],[3697,20,3697,78,0],[3698,13,3698,14,0],[3699,17,3700,172,0],[3702,17,3702,88,0],[3705,17,3705,73,0],[3706,17,3706,18,0],[3707,21,3707,79,0],[3708,21,3708,100,0],[3711,21,3711,106,0],[3712,21,3712,56,0],[3713,21,3713,68,0],[3714,21,3714,60,0],[3715,21,3715,35,0],[3717,13,3717,14,0],[3719,13,3719,25,0],[3720,9,3720,10,0],[3723,9,3723,10,0],[3725,13,3725,63,0],[3726,13,3726,53,0],[3729,13,3729,68,0],[3731,13,3731,77,0],[3732,9,3732,10,0],[3735,9,3735,10,0],[3736,13,3736,119,0],[3737,13,3737,51,0],[3738,17,3738,37,0],[3740,17,3740,29,0],[3741,9,3741,10,0],[3744,9,3744,10,0],[3745,13,3745,108,0],[3746,13,3746,51,0],[3747,17,3747,37,0],[3749,17,3749,29,0],[3750,9,3750,10,0],[3753,9,3753,10,0],[3754,13,3754,80,0],[3755,9,3755,10,0],[3758,9,3758,10,0],[3759,13,3759,72,0],[3760,9,3760,10,0],[3763,9,3763,10,0],[3764,13,3764,105,0],[3765,13,3765,14,0],[3766,17,3766,74,0],[3767,17,3767,51,0],[3768,17,3768,73,0],[3770,24,3770,71,0],[3771,17,3771,18,0],[3772,21,3772,148,0],[3773,17,3773,18,0],[3775,17,3775,62,0],[3776,17,3776,18,0],[3777,28,3777,91,0],[3778,21,3778,22,0],[3779,32,3779,99,0],[3780,25,3780,26,0],[3781,29,3781,55,0],[3782,25,3782,26,0],[3783,21,3783,22,0],[3784,17,3784,18,0],[3786,17,3786,18,0],[3787,21,3787,87,0],[3788,21,3788,111,0],[3789,17,3789,18,0],[3790,13,3790,14,0],[3791,9,3791,10,0],[3794,9,3794,10,0],[3795,13,3795,100,0],[3796,9,3796,10,0],[3808,9,3808,37,0],[3809,9,3809,10,0],[3810,9,3810,10,0],[3812,9,3812,52,1],[3813,9,3813,10,1],[3814,13,3814,28,1],[3815,9,3815,10,1],[3822,13,3822,14,1],[3823,17,3823,53,1],[3824,21,3824,80,0],[3825,17,3825,34,1],[3826,13,3826,14,1],[3827,17,3827,18,1],[3827,19,3827,37,1],[3827,38,3827,39,1],[3832,17,3832,18,1],[3832,19,3832,69,1],[3832,70,3832,71,1],[3838,13,3838,14,1],[3839,17,3839,77,1],[3841,17,3841,77,1],[3842,17,3842,77,1],[3843,17,3844,36,1],[3845,13,3845,14,1],[3850,17,3850,18,1],[3850,19,3850,50,1],[3850,51,3850,52,1],[3857,9,3857,36,1],[3858,9,3858,10,1],[3859,9,3859,10,1],[3861,9,3861,51,0],[3862,9,3862,10,0],[3863,13,3863,28,0],[3864,9,3864,10,0],[3866,9,3866,39,1],[3866,9,3866,39,0],[3871,13,3871,14,1],[3872,17,3872,53,1],[3873,21,3873,80,1],[3874,17,3874,34,1],[3875,13,3875,14,1],[3876,17,3876,18,0],[3876,19,3876,37,0],[3876,38,3876,39,0],[3881,17,3881,18,1],[3881,19,3881,90,1],[3881,91,3881,92,1],[3887,13,3887,14,1],[3888,17,3890,48,1],[3891,13,3891,14,1],[3897,13,3897,14,1],[3898,17,3898,77,1],[3900,17,3900,77,1],[3901,17,3901,77,1],[3902,17,3903,36,1],[3904,13,3904,14,1],[3910,13,3910,14,1],[3911,17,3911,105,1],[3912,17,3912,49,1],[3913,21,3913,52,1],[3914,22,3914,53,1],[3915,21,3915,87,1],[3917,21,3917,86,0],[3918,13,3918,14,1]]);
    </script>
  </body>
</html>